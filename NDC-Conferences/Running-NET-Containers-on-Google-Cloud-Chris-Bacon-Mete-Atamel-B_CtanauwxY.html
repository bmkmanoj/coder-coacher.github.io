<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Running .NET Containers on Google Cloud - Chris Bacon &amp; Mete Atamel | Coder Coacher - Coaching Coders</title><meta content="Running .NET Containers on Google Cloud - Chris Bacon &amp; Mete Atamel - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Running .NET Containers on Google Cloud - Chris Bacon &amp; Mete Atamel</b></h2><h5 class="post__date">2018-02-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/B_CtanauwxY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">cool let's get started hello everyone my
name is Metta Tamil
a Google based in London and I'm Chris
and I'm a software engineer also based
in London I people so today we're going
to be talking about running net
containers on Google cloud and one thing
that we didn't mention we actually have
a Google home and what we're gonna do is
we're gonna get Google which is this
yeah it's Google home Mini and we're
going to be getting Google mini talk to
Nick container running on Google cloud
we didn't mention this in the title
abstract because I was talking to Chris
about what we should do about our talk
and then he said well why don't we just
use Google home and I'm like do you know
how it works he's like well I don't know
we'll figure it out yes so that's kind
of like the little surprise that we have
so the agenda of the talk is that first
of all I'm curious who is here running
any kind of service in the cloud today
in any cloud okay a few people and who
is running on Google cloud Google people
yes yeah so that's why like I want to do
a liberal introduction or what is Google
cloud because whenever I talk about
Google cloud people ask me is this Gmail
is a Google Drive or what is it so we
just want to do a little bit of
introduction people had a cloud who knew
who knew go ahead card okay so more than
half that was better than the last time
I asked because last time I was at this
conference when I asked no one knew so
this at least this time people know and
hopefully next to you people will be
using Google cloud and did you know you
can run c-sharp code on Google cloud
yeah yeah okay sure okay that's not
surprising cool and then once we do the
intro we're gonna be talking about the
running net containers on Google cloud
so that's the point of the talk when it
comes to running the containers on
Google cloud you have two choices
appengine flex and cube editors engine
so we'll talk about both and the what
the differences are and things like that
and then we're going to move away from
the computer side of it and talk a bit
about the services and we're going to
demonstrate the vision API and my than
if you're in Scott Guthrie's keynote
talk this morning so we're going to
demonstrate a vision API much like he
did but a slightly different aspect of
vision api's obviously Google's vision
API not Microsoft and looking a bit of
bigquery as well and demonstrating a bit
of bigquery
and then we were finished by looking at
maintaining your app and looking at the
stackdriver suite of debugging
monitoring tools and we're hoping to
demonstrate tracing error reporting and
logging see if we get time and it all
works yeah the idea with Sec drivers
that it's a central place to do all your
logging debugging tracing and for me the
debugging part is really really
important because you can put a
breakpoint in production and then it
gets hit and then it gives you a
snapshot and then your source still runs
so you don't have to stop anything but
sadly that a we can't demonstrate that
practically I try to get it again
yesterday but due to embarassing
technical reasons we can't show that
today okay why we will strip we will be
crashing our app and then we'll see the
error reporting there so at least we can
crash our app right okay okay hope
you're not crashing it too much just
once so that we can show it all right so
let's get started with the introduction
what is Google Cloud well it's it's a
collection of services for your
application for you to build your
applications so in terms of services we
have compute so that's how you deploy
your application we have compute engine
which is what we virtual machines are
called in Google cloud so you can have a
Windows server you can have a Linux
server with all these different
configurations and operating systems and
then once you have it it's yours and you
can do whatever you want
there's App Engine which is kind of like
app services in an Asscher
there's kubernetes engine for running
containers in production and get that
managed by kubernetes there's cloud
functions which is kind of like as your
functions but in Google Cloud there's a
container registry to store your
containers and there's a container
builder to build your containers I won't
go through these one by one but
basically for storage there's sequel and
no sequel databases I wanting to point
out is quite spanner
class spanner it's the sequel database
that scales horizontally kind of like
cosmos DB for networking you can set up
all sorts of networking things like web
balancers and private networks and and
peering and VPN things like that there's
big data that Google is known for so
there's bigquery that we're gonna show
you it's a data warehousing solution
fully managed
there's data flow for processing data in
the cloud
there's their proc for running Hadoop
and spark in Google cloud what else do
we have that we have machine learning so
we have what so machine learning ap is
such as vision API that we're gonna demo
speech API translation API these are
basically pre-built models that we have
and we're just exposing it to four with
an API call and then there's also cloud
machine learning so if you want to build
your own models there's an open source
project called tensor form and we make
building tensor for models easy and
scalable with cloud machine learning so
you can use that to train your models in
a scalable way and you can also use it
to to strobe your models so you it gives
you a way to basically serve your train
models and then there's things like I
didn't security and then there's more
like management tools with stack driver
that will show you and then more
developer tools like with SDKs and we
have IDE plugins and powershell
commandlets and all that kind of stuff
so it's a whole platform to do pretty
much whatever you want now in terms of
deploying your code when it comes to
deploying your code to Google Cloud and
and in any card in general first there's
this spectrum right there's this
spectrum of customisable versus managed
so the more manage things are they
usually are less customizable and vice
versa in terms of highly customizable we
have compute engine so if you want to
get a virtual machine and you want to
define what kind of CPU should have you
can you if you want to define what kind
of memory it should have what kind of
operating you should have so once once
you define those you can get a compute
engine with Windows or Linux and you can
store whatever you want so it's highly
customizable but at the same time you're
fully responsible of it right so there's
no management of it so you're fully in
charge of it if you store something on
top of it you need to maintain it if
there's a new version you need to
upgrade that so it's yours to keep
now on the other also we have something
called cloud launcher so a launcher is
kind of like a marketplace for deploying
solutions to Google cloud so for example
we have something called s without net
solution where it deploys Windows Server
as we don't net is a sequel server on
compute engine with one click and I'm
going to show
an example of the short way on the other
side of the spectrum we have card
functions so you seen these before
earlier with as your functions but but
it's basically the same kind of
functionality where you just define a
function and you deploy it and Google
manages the function for you so you're
not exposed to any virtual machines or
any kind of containers or anything like
that it's just a function that you
define what what the input is what the
output is and how it gets triggered and
then it just maintains for you the only
difference here is that we only support
no J's right now but we want to support
more languages going forward and then
somewhere in the middle we have
appengine the idea wipe engine is that
instead of defining a function you're
defining an application and this
application have can have multiple
services so you can have a front-end it
can have a back-end and they can talk to
each other but the idea is the same you
do you define your application and you
deploy it and under the covers it runs
on virtual machines but you're not
really exposed to that what those
virtual machines and you don't have to
worry about them because it's managed by
that by App Engine for you and then
sometimes you need more control you need
to be able to define your containers you
need to be able to define your container
cluster and get the container cluster
managed by kubernetes so for those kind
of use cases we have something called
kubernetes engine which used to be
called container engine up until
recently but we renamed to cube and the
engine recently and so the idea with
kubernetes engine is that you we give
you a cube in this cluster with one
command you have a master that's managed
by Google and then you have nodes where
you can schedule the containers and then
you can research your cluster you can
add more nodes and things like that and
we'll show you some examples of this as
well and then we have container builder
to build containers in the in the cloud
and be a continuous tree where you can
store your containers for your project
and they can be private and public
depending on what you want to do so
that's kind of like the spectrum that we
have so today we're going to be focusing
mostly on kubernetes engine that's what
our demo is based on but I just want to
let you know that there's other options
as well and just a quick word about
Google's infrastructure so Google is
quite well known as being one of the
leaders in the quality and reliability
of its infrastructure and the good news
is is that if you run in Google cloud
you are running on that infrastructure
and that's an important point to make
you're not running on some kind of
alternative infrastructure which is run
prett from google's own products you are
running on exactly the same I mean
probably not the exact same actual CPUs
but you're running in the same data
centers using the same network
infrastructure and you've got the same
there's the same sort of teams of
engineers who are who are maintaining
and are on-call for making sure that
everything runs as it should and on a
personal note a few years ago I used to
work on one of these teams that was on
court I was on call for the Android Play
Store and I can assure you that there
really are teams of highly dedicated
engineers working 20 hours a day 306
days 307 million a year making sure that
everything functions as it should and if
it does start to go wrong they fix it
straight away and we have extremely good
monitoring tools so hard most of the
time you'll never know anything was even
starting to go wrong it'll be fixed
before you know it this is just a
impressive-looking map of google's some
of Google's networking infrastructure
Google does own fiber globally and these
dots are all data centers or points of
presence or edge cash positions and you
use all this so for example if you use
Google CDN service your your files
whatever it is will be cached in all
these locations globally to be as close
to the user as possible and Google works
hard to make sure that traffic from the
internet gets onto Google's networks as
quickly as possible because we know are
know as a good quality so users globally
get routed onto our networks and then
route it to wherever your services are
being provided for right so we're now
going to look at some specific compute
infrastructure now so if you are an
asp.net classic developer then you're
running on Windows and you can use
compute engine to deploy your speed on
applications on to what I was saying
which are VMs so this is a as meta
you're saying earlier this is an
unmanaged product so you're responsible
for making sure all your software is up
to date and you've got the right number
of VMs and they've got enough memory and
kind of stuff but it does let you fairly
easily deploy s1 or let applications and
you use it much like you would use any
VM anywhere that they're pretty focused
on the VMS are you gonna demo that now
or yeah let's do that let me just show
you how to get an Windows Server quickly
so here I am in Google Cloud console and
on here we have all the different
products on Google cloud that we'll go
through later but what I want to show
you right now is call it launcher this
is a marketplace for different solutions
on Google Cloud and one of them is
called asp.net framework so this
solution will get you a Windows Server
and is seek Express and I set up the
framework installed on compute engine so
if you want to get one on one of these
what you can do is you can say launch on
compute engine and make solve it bigger
so let's give this a name is p.net and
they see london then you can choose your
zone so since we're in Europe let's just
choose your West and then machine-type
you can fully customize it so you can
say I want course from one to ninety six
and every time I look at this it
increases last time it was 64 now it's
96 so I just go with something like six
cores may be and then memory you can
choose whatever you want up to 30 for 39
gigs but that guy is higher if you're
using more CPS yep or you can also
choose one of the pre-configured ones so
if you want to get a small instance you
can choose that so let's just choose one
of those in terms of Windows service we
support 2008 2012 2016 so let's choose
the latest one and then we can have
persistent disk or SSDs and you can
specify the size here and then you can
also define the firewall rules like so
HTTP HTTP web deploy an RDP
so I'll just keep those as default and
hit deploy and within a minute or two
we'll have a Windows server running and
then you can use Visual Studio to deploy
application there all right so that's
that's all it takes to get a Windows
application for your traditional
application but of course the world is
moving to containers and so if you're
using SP donat core and you have a
containerized deploy me I want to do
then
App Engine flex and kubernetes engine
are the two ways to as methods or II
saved kubernetes engine allows a bit
more control
App Engine is sort of click and go and
auto scaling and
all that good stuff yeah and you also
have some tools and libraries that you
might need yes if you need Microsoft
sequel server then much like net shows
you the cloud launcher for asp.net we
also have a cloud launcher for sequel
server unfortunates not yet and managed
service that that's coming hopefully
sometime fairly soon but you can
certainly easily start up a sequel
server and we have a visual studio
plug-in which I'll be showing you later
and which helps you do things like
container engine deployments I'll be
demonstrating that and we have many
dotnet libraries which all open source
on github by the way and they let you
access all of well not quite all yet but
working towards all of Google services
like vision and bigquery and all these
things and then we have powershell
commandlets is that yes we mentioned and
then let me just show you the visual
slip like Visual Studio plugin real
quickly so I'm here in Visual Studio and
the way to install this then it's just
an extension so you would go to
extension oops
extensions and updates' it pops up yeah
then in here
you can just search for Google Cloud and
then the Google cloud tools for Visual
Studio is the one so I already have the
installed so but if you don't have it
you can just double click and it will
install once it is installed then under
tools you can go to Google Cloud tools
and then there's something called Google
Cloud Explorer so this is how you would
see your project from visual studio so
if you click here the first thing is I'm
logged in here so that's me and then
these are all the different projects
that I have in Google Cloud so I'll
choose that time as my project and then
under here you can see your App Engine
applications so for example in App
Engine I have one service called default
and it has two versions and this first
version version 0 is getting a hundred
percent of the traffic I can see my
virtual machines so this is the list of
my virtual machines and you can actually
right click so this is the nd seal and
the one that we just created we can
right click and open a remote desktop
session or things like that and then you
can see other things as well so you can
see cloud storage which is a place to
store files you can see costs equal for
your management
- : Postgres instances and cloud pub/sub
which is a publish/subscribe messaging
type of framework and then if you want
to deploy your application you can
basically come here right-click and then
there's gonna be another thing here
publish to the google cloud so you click
here and then it gives you some options
so this is a dotnet core application so
it's giving me two options App Engine
flex or container engine which is
kubernetes engine so I can choose
whatever I want to deploy and then you
can deploy it directly from usual studio
so this is just to give you an idea how
it works let's go back here yeah now
let's talk about the containers the
point of this talk who is using
containers today few people anyone
doesn't know what a container is don't
be shy ya know okay so just to explain
it's basically a way to virtualize
application containers so in the past we
have virtual machines where you
virtualize the whole operating system
and everything that goes on top of it so
with containers it's pretty much the
same idea except you're not virtualizing
the whole operating system you're
virtualizing your your application and
the dependencies or your application so
this way it's much more lightweight than
virtual machines it's started with Linux
processes but now Microsoft has windows
containers as well so you can also have
windows containers even though they are
much larger than Linux containers it's
it works so they're lightweight and
isolated so you can have multiple
containers on a single operating system
they're very easy to deploy so you can
deploy a container within seconds and
they're introspective also you can
actually get it into containers as if
it's a virtual machine and see what's
happening and for me the most important
part is that they are composable so you
can start with a base image that you
depend on for example if I'm building an
asp.net core application I can use the
base image from Microsoft and then I can
build my image on top and then if
someone else needs my image they can
build their image on top of me so you
can compose all these images and each
layer is cache independently so if you
have multiple images
needing the same base image you get it
once on your machine and then from then
on everyone else can use that same image
as well so that's what containers are in
case you haven't realized in terms of
how to deploy containers we to Google
Cloud as I mentioned there's two options
appengine
and kubernetes so let's talk about
appengine flex now so App Engine flex in
my mind is the easiest way to deploy
containers to Google cloud the idea what
appengine flex is that you deploy your
container and let google manage it for
you and scale it for you so by default
when you deploy it you it gets deployed
to two virtual machines but it gets auto
scale automatically up to 20 virtual
machines depending on the world you get
dashboards for different kinds of
metrics you get versioning so every time
you deploy your application you get
different versions or your application
that I'm going to show you once you have
your versions you can split the traffic
so you can do a/b testing or you you
know or you can maybe do canary
deployment stuff like that and auto
scaling as I mentioned is automatic so
by default you get auto scaling with App
Engine so let's take a look at that
quickly so I already deployed an
application to App Engine so I just want
to show you how it looks like so this is
App Engine on Google cloud and I should
probably show you here App Engine is
under so under compute you see that
compute engine virtual machines and App
Engine is right here and the first thing
that I want to look at is that services
so in App Engine you can have this
notion of services these are kind of
like micro services the way you do my
association in App Engine in this case I
only have one service it's the default
service but you can have multiple as
many as you want
then under versions these are the
different versions of my application
that I deployed so I have version 0 on
my application getting a hundred percent
of the traffic and running on two
instances on to virtual machines but
then I also have another version that I
deployed before the talk it's not
getting any traffic yet since I have
different merchants I can all by the way
and these words is they each get their
own URLs so you can test them
individually but let's say I tested
version four I want to see I want to get
I wanted to get more traffic so what I
can do is I can come here and I can do
split traffic and then I will add
version 4 and let's say I want it to get
50% of the traffic I can easily do this
it's save and with this now the other
version will also get the traffic so if
you go back here and yeah you can see
that they're each getting 50% of traffic
and if you really want to see the
instances you can come here and their
instance
and you can see that these versions they
are just basically just running on
virtual machines they can SSH into them
if you need to but usually you don't
have to care about this and the last
thing that I want to show you is the
dashboard so under the dashboard you can
choose your version and then you can see
bunch of metrics like latency traffic VM
traffic CPU I mean this is a demo app so
I don't have any metrics here but if you
had a real app you would see all the all
kind of metrics in here so you get this
all all by default and all you have to
do is just from your application you
install Google Cloud SDK and just do a
g-cloud app deploy and give a version
name and that's it what we do is we take
your application we build a container
for it in the cloud we hosted in
continue registry and then we do play to
App Engine flex and then you get all
this for free so it's the easiest way to
run containers so normally we build the
container for you but you can also
specify a docker file and you can tell
us what kind of content you want to run
and we'll build that container for you
as well all right so that's App Engine
flex the second thing the second way of
deploying containers is by a cube
editors engine but before we talk about
cube and its engine let's now talk about
our application because it's going to
use kubernetes engine and then we'll
talk about the details of communities
and how it works afterwards yes so we're
going to be demonstrating a few things
in the next half hour 40 minutes and
we're gonna be using this exciting app
that it's described here so I want to
talk you through what yeah halli app is
architected very briefly because it's
using Google home and cuneta engine and
be persistent and dialogue flow which
are things you may or may not be aware
of and something to very quickly
describe what they do so this is a
Google home Mini you've probably seen
these these are this is a conversational
device so we're going to be having
conversations with this if it's working
hey Google you're there I'm here what
can I do for you nothing quite yet and
that what that's doing is that's ending
the conversation to a server size notice
cool well to Google assistant which is
what does the the speech recognition the
kind of sentence parsing I can only help
with the first request okay I don't know
what that's gonna do now what do you
need to do a quick laptop so just swap
the left as quickly and then I can show
you what the dialogue flow looks like
which isn't what we're concentrating on
in this talk but just so you can see
kind of how the conversational side of
it is configured plugging in wires is
difficult right okay my laptop is turned
off and decided not to turn back on you
know it's working so don't look flow
I'll show in a moment is where you
configure your well they're called
intense and they are example sentences
that you want to recognize and then
launch actions from so you build up
excellent so this is this is the
dialogue flow web interface so these are
all my intents and you can see things
labeled big query door things and vision
dot things so if we just quickly look at
we're going to be looking at vision and
one of the thing is we're going to be
doing these in the vision API actually
the Search API is looking for pictures
so here you've got examples of the kind
of phrases I might say to search for
pictures and the highlighted bit is the
bit that's a parameterised word and the
Google assistant will fill in that
parameter with whatever word I actually
say instead of dogs you can search for
things that aren't dogs like cats for
example so that's the dialogue flow the
dialogue flow you can figure it with a
web hook as a Scott was talking about
this morning and I'll just briefly show
you that there's nothing very
complicated about this you you go to
fulfillment and then here there is a URL
so that's the URL that will be called
every time a conversation intent is
triggered and that URL points to an
application running on google kubernetes
engine which will demonstrate in a
moment and then from cube nest engine we
have some code that based on the intents
you you talk will call into the vision
API bigquery and Google search and and
various other things so just to
demonstrate this works well we'll try
out now a couple of things to say before
we start this first of all I'm going to
be saying those magic words that start
this device so if any of you have
actually you don't cuz I've already said
them I was going to say everyone has
phones with Google assistant active I'd
like to turn them off or something
otherwise you'll all be responding to
the conversation secondly this is what's
called a test application so it's not
deployed so the first thing I always
have to do is ask Google to let me talk
to my test app and I'll literally be
saying that every time we use this and
thirdly once the conversation once I
start the conversation I can't stop so
once you start the conversation it
assumes the only thing I'm talking to is
it so I can't stop and explain things
and as I go along
so all of these I'll do some
conversations and then we can discuss
them afterwards and lastly this is all
highly experimental we've never done
this demo before we've never tried it in
a room with anyone else apart from me in
it and being conversational it doesn't
always go quite as planned and in fact
sometimes it thinks I'm saying things
that I'm sure I've never said so with
all those caveats aside let's see what
we can do so what I'm going to do I'll
describe I'm gonna do first and not this
what I'm going to try and do is talk to
my test application and just ask it
where the server side is running and
hopefully it'll tell us now one thing
that isn't on this diagram is what it's
also doing is its pushing out
information onto this web page here just
so we can come to it give us some more
details about what's going on in the
back end so all this is the website
talking to the same server that this is
being fulfilled by and it's got a
WebSocket
open it just pushes information down
down to here okay wish me luck hey
Google talk to my test app
sure here's the test version of my test
app okay ready what environment are you
running in running on google kubernetes
engine at location Europe West one C on
cluster named NGC demo goodbye
it worked that's good news so it knows
it's running on Cuban a fuse now I'll
just quickly show you the code that's
actually doing that and and I do
apologize for the quality of this code I
was going to tidy up I was going to tidy
up yesterday but unfortunately the whole
demo nearly fell apart yesterday and so
I was busy repairing that right so we
have a platform describe and so you can
see here that what I'm doing is calling
this platform door instance acing so
this platform class is defined by one of
our Google supplied open source support
libraries and I'm just the instance
acing just returns an instance of the
platform class that tells us where it's
running and so ignore the next few lines
so you can see here as a switch
statement looking a platform doctype and
it knows about so GAE is can guess
Google App Engine GCE is Google compute
engine which is the VMS and the one we
had was gke which was kubernetes engine
and so you can see here these lines here
correspond exactly to what came down to
the web browser we were just looking at
now oh and then this is this just say
thing at the bottom this is just how in
my code you you send things to say you
back to the Google home and so that's
good news and so what I'll do now is I'm
just going to prove that as meta was
saying earlier you can deploy to
kubernetes engine from visual studio
using the plugin so I'm going to change
some code and then we'll try it out so
you may have noticed might ask to talk
to the test that the very first thing it
said was ok ready
so let's find the code that says that
that's here ok ready
so instead let's change that to say
about hello NDC London there we go and
now to deploy to keeping this engine we
right-click on the project you say
publish to Google Cloud we're deploying
to container engine now here it gives me
a list of all the clusters that I have
available which I've set up previously
so we're using the indc demo cluster you
can specify how many replicas you need
now sadly and slightly embarrassing Lee
I have to deploy to one because the
state for this application is being
managed just in memory so I have to make
sure everything goes to the same
instance obviously this isn't
productionize and then we just say
publish and it's now going to check the
state of the cluster and in just a
moment it should say you already have an
application running on this cluster with
this name do you want to update it and I
will say in just a moment any second now
come on this is this is now using the
internet so it's possible you know Wi-Fi
here maybe is oh there we are so I'm
gonna say update and then we leave it
this takes about 30 seconds between 13
40 seconds if everything is working
properly and then next time we talk to
this listen out for what it says at the
beginning okay and in the meantime I can
explain what kubernetes is a little bit
so alright so what is given it is most
of you probably know it's a Greek word
that everyone mispronounces it's true
actually the right way of saying
kubernetes is given it is but I guess it
came out in the in the US and everyone
started saying it cuban it is and now I
want mispronounces it and I know this
because I'm from Cyprus and Greek is one
of the languages there so anyway but it
was great to do this talk in Greece and
everyone knew what I'm talking about
because you know I know a kubernetes it
came from an internal system at Google
called bork so at Google we've been
using containers for a long time for
more than ten years and we built work to
manage containers so people who worked
on bork they at some point they decided
to create kubernetes for everyone else
so the idea accumulated is that you you
think in terms of applications and not
in terms of machines anymore
because in kubernetes you basically
define your container and let kubernetes
manage those containers and schedule
them and make sure that they are running
so it gives you all the tools basically
to run containers in production for me
the greatest thing about kubernetes is
that it runs everywhere so you can run
on your machine you can run in Azure you
can run in Google Cloud you can even
have cumulative clusters spanning
multiple cloud providers if you want to
so that's the great thing about it at
the very high level this is how it looks
like so there's a master managing the
cluster and then you have notes the
actual virtual machines where you can
schedule containers but as a user you
don't really care you only talk to the
master either through the API or CLI or
user interface and in this cube entities
world container has given in this world
this is how a micro service looks like
so you start with a container that's
where your quiz and in this container
lives in some kind of registry usually
in Google Cloud this is Google's own
container registry from there you create
what's called a pod template so part is
the smallest unit that communities can
schedule it's either a single container
or it can be also multiple containers
grouped together and from then on you
tell queue by this is what you want so
there's something called replication
controller in communities in this case
we are saying we want three replicas or
three copies of this pod running at all
times and replication control will look
at the nodes that you have and it will
create these parts and it was scheduled
to look to those nodes and it will make
sure that they are running and if if one
of the nodes goes down then replication
control we detect that and it will
reschedule it to some other node and
once you have your pods running you can
label them with different kind of name
value pairs and that and then with
labels you can group them so you can
group pods into what called services so
a service in communities it's kind of
like a load balancer for your pods so
once you book your pods using labels in
a service then this service can be
attached to an external world balancer
and then people from outside they can
hit your load balancer both your service
and then get your pods so in this world
your your micro service is basically a
combination of your code via the
container and also what Kuban it is
provides the replication controller
watching your we'r pods and service
exposing your pods and there's much more
I'm just giving you the bare minimum but
that's what kubernetes is in my services
world
and as I mentioned Cabela's runs
everywhere but we have something called
google kubernetes engine it's basically
kubernetes as a service so it's a way of
running cuban it is in england cloud in
a really easy way so with one command
g-cloud container clusters create you
can create a communities cluster that
will give you a master managed by google
it will also give you some notes to
schedule containers then you can do like
cluster resizing with g-cloud container
clusters resize and then you can resize
from three to five with this command so
it makes it really easy to get a cluster
and then resize it what else can you get
so the master is fully managed as I
mentioned you get auto scaling or your
notes so you can set up auto scaling so
that the notes can auto scale depending
on the world you can get auto upgrade so
if there's a new version of cuba's like
that that comes in it can be able to
upgrade it if you want to you can get
auto repair so if your note is not in a
good state kubernetes can detect that
and you can replace it with a new note
and you get like 99.5 SLA out-of-the-box
and we are we are looking to improve
this and so that you have you know
multiple masters and more SOA is going
forward it's worth pointing out that
night when I'm saying
SLA might sound not great but that's
only for the master and if the master
goes down the trustor carosone working
fine it's just that you don't have
access to this order management API yeah
so you can't schedule new pods but UK
your application still runs so it's not
that big early and then even the
components so the actual nodes where
your schedule containers the X somewhat
manage in the sense that everything
that's logged goes to stack driver and
it's being monitored and there's you can
set up error reporting so if there's an
error in your pods you can sit in
stackdriver so those are kind of managed
as well all right so let's cube and it
is and we want to now talk about the
machine learning and Big Data part of
our application so I'll just talk about
those quickly first of all this is a
graph showing the directories containing
deep learning models at Google you know
and then you can see the graph from 2012
to today it is exponential so there's a
lot of deep learning happening at Google
so that is that internal to Google in
terms of you okay yeah so these are all
the products and there's there's
probably more using deep machine
learning and you can see the trend and
this is true not just for google but for
many big companies so
machine learning is becoming real big
and in terms of using machine learning
there's basically two ways of using
machine learning and I call it the easy
way and the hard way so the easy way is
that someone figures out machine
learning and they build a model and then
they give you an API to use that machine
learning right and that's what Microsoft
did show today at the demo with their
vision API we also have many trained
models with vision and speech and stuff
like that so we trained it and then we
create a model and then we give you an
API to use that and the second way of
using machine learning is to actually
create and serve your own machine
learning because sometimes what's given
to you like with vision API maybe you
have you have custom images and you want
to do something custom with that so you
can't really take vision API use it
so in those use cases you want to
actually build your own machine learning
model for that there's something called
tensorflow
it's an open source project and you can
take that and run it on google cloud and
train it and use and use cloud machine
learning to serve the model that you
created in terms of pre-built
models in google cloud me a bunch of
them speech API vision API jobs API
there's video intelligence API where you
can actually pass a video and it will
tell you all the things about the video
the scenes and the labels and stuff like
that we're gonna be using vision API
today
so let me just show you quickly how it
looks like and then we'll show our
application all right so there's a demo
here and in any machine learning demo
you have to show the pictures of the cat
right that's what happened today so
that's what we gotta do there as well so
in this demo we will basically pass in
an image to vision API and we will look
at what we get back so we pass in this
image and then in the in the end what
you get is a JSON with some labels and
then this graphical tab shows us the
same information in a graphical way so
what we are getting back is bunch of
labels we have seen that this is a cat
99% and this is an animal 86% and it's
even telling us that this is a British
Shorthair type of cat 93% so you got
some labels you can see the colors in
the picture so these are the colors in
the picture and then you can also see if
this image is an other image or medical
image or image stuff like that I just
want to show you one more example
if you if you pass in some text for
example like this then you get the same
labels but then you can also pick up the
text in the picture and then if you pass
in people we don't do face detection or
people so we don't identify people but
we can detect the expressions of people
so if we if we come here and if I turn
this on you can see that we detected
these people and we can also detect
their expression so this person - I
guess it's this person right here it's
joyful yeah they're pretty much all
joyful but you can basically detect
people's faces and their expressions so
that's vision API you want to go back to
and then in our application we use
originated there so you do so now will
attempt to conversationally use the
Visionnaire guy and then we'll look at
some code right hey google talk to my
test app okay let's get the test version
of my test app hello NDC London search
for some pictures of London hang on okay
let's use the vision ml service found
some pictures of London
what now select the fourth picture what
is the index for picture for selected
please describe this picture this
picture is labeled landmark waterway
City sky tourist attraction and
Parliament
so what landmark is in this picture this
picture is labeled landmark waterway
City sky tourist attraction and
Parliament what in what landmark is here
I miss that
what landmark is here one more time what
should I recognize in this picture this
picture is labeled landmark into a city
sky tourist attraction and Parliament's
go back to the pictures okay looking at
all images now let's select the fifth
picture what is the index five picture
five selected are there any landmarks in
this picture this picture contains Big
Ben
goodbye it's very stressful running
these alright so just to show you using
the image API there the vision API and
it is wonderfully simple to code these
things up so ignore all the mess of this
code that's not going on so vision
described so this is what what got
called when I asked it to describe the
image and you can see right I get in I
should have made that lots of asserts
clear what it is how do you make that
into her
so we get an instance of the vision API
and just to show you how to do that
right right about this that uses this
kate here so you use this image
annotator client dot create method and
this image and in the annotator client
is in the google cloud vision dot v1 API
package sorry which is anyone new get
and the source code is all available on
github and we call create now normally
you can do this in a parameter this
fashion so actually that literally is
all the code you need the only reason I
had to put a channel in here was because
I was having a slight trouble with the
authentication which normally you
wouldn't have so it's normally literally
just one line of code to return that and
then if we go back to the to go back to
the flow and then we just call this
method hit so we just call the tech
levels and there's an async version and
a sync version as you'd expect we use
the image doc from URI and that allows
us to give it a URL so we don't have to
pass it the actual sort of bits of the
image we just pass the URL you can also
pass it the bits if you want and then I
asked just for a maximum of ten results
and then that returns this read a list
of entity annotation which we then so
yes we buy that labels we then just
order that by the score so we order by
descending for the score so we read them
out in
the most important order and then we
just select the description and that's
just a string of the list of labels that
you heard read to you so it's not
difficult to use and we also had the
landmark API which is very very similar
say vision landmarks and as you'd expect
you just call a single method detect
landmarks in this case a sink and that
is returns again and she lines up a read
any list of entity annotations which is
the landmarks oh so there we go
yep yep so that was a vision API and the
next thing that we use in our
application is something called big
query so big query is massively parallel
processing query bah-bah-bah it's
basically a data warehousing solution
from Google that's fully managed so
behind me bigquery there's a little
compute power and there's a lot of
storage what you do is you just point to
the data that you care about we ingest
that and then you just run queries
against it and the key thing here is
that the queries happen really really
fast and then they happen in a fully
managed way so you don't have to worry
about clusters you don't have to worry
about the number of machines everything
is taking care for you basically the
quarry and you assign it to our indexing
at all
yeah there's no indexing so every time
it does full scan but it does it really
fast that it doesn't even matter so let
me just show you a quick example of this
so this is the bigquery console that you
can get to from Google Cloud console and
in bigquery you get bunch of public data
sets that you can actually play with so
these data sets they're from week for
example in just Wikipedia although
Wikipedia I mean just all github hack
your news stuff like that and you can I
think up to one terabyte you can query
for a month for free something like that
that's true although it's surprisingly
easy to use up that one terabyte really
quickly yeah if you don't write your
query correctly then you can use it but
basically a lot of queries you can run
for free if you are curious you can go
there and then you have these public
datasets so what I did here is that I
want to see what are the most popular
packages in dotnet world so what we did
is we have this sequel query that does
some records
matches against github data that we have
and it looks for the using line and then
it picks out the the packages and then
it counts them and groups them stuff
like that I bigquery expert in my team
fairly - how far maybe you've seen him
help me to write this so don't ask me to
explain what it does but I can pass you
the code if you want so it basically
does a regular expression matching oh
this and then then it groups it groups
them and then counts them basically so
if you run this you can see the curve
running and I guess we had the results
one before but let's get fresh results
so this is searching all of the github
data basically searching all public
repos on github yes and must be
questioned and yeah and then it's doing
a full scan of it and then it's doing
regular expression match against that so
looking at all the code finding the
using lines and then then figuring out
the actual package names and then
counting them right so once that so
that's done in like 30 seconds and it
processed 30 gigs of data and then what
we have any guesses what's the most
popular package system what system what
just system just system well I think we
have oh yeah that's there in the
template isn't it so as soon as you
create a class it puts systems palacios
generic yeah maybe that's why yeah so
the system collection of generic and
then system runtime but well there's
linked I remember seeing JSON package
before but maybe yeah maybe that was the
one that I filtered system out and then
the rest was like hey Jason surely these
are namespaces not packages cuz oh yeah
we are looking for the main spaces here
yes
so yeah that's what big bit core is and
in our application we used it so let
Chris explain that you wanna yes so
there's quite a lot of these public
datasets and they're quite fun to play
around with so as meta said the whole
hacker news I assume everyone here reads
hacker news and if you don't it's quite
worth reading so the whole every
everything that's been hacking news is a
public dataset and it's updated I think
daily says always up-to-date and another
interesting data set is there's a
weather Oh climate rather data set
giving global temperatures back to 1930
or something like that which I'll just
demonstrate so first of all we're going
to use the hacker news publicly police
which yes I do I do want to spit back to
there okay hey Google let me talk to my
test app let me talk to my tests up
something went wrong try again in a few
seconds hey Google let me talk to my
test app there was a glitch try again in
a few seconds oh no there's a glitch I
wonder if we can find out what it is in
fact this will give us a good
opportunity just to look at the Google
developer console for the kind of
kubernetes based items on here so you've
already seen this developer console and
if we go down here here's the compute
engine and App Engine that meta was
talking about earlier and here we have a
compute engine so sorry kubinashi's
engine so here we can show the clusters
so I've got three clusters under my
account here we're using this NBC demo
cluster so this gives us details of this
cluster so we can see I've got three
machines in the cluster it's in Europe
various other bits of information and
then if we go here we can see the
workloads that are currently running on
this cluster so I only have one one job
running and it's the obviously the one
that's servicing this or trying to
service this and it's called MDC test
server and we can see here that this is
running on so we've got just one managed
pod and you remember I deployed it just
to a single replica and this is this is
that replica and if we go into the pod
here and you say this is the pod details
and just tells us like when it was
created so that would mean today just a
few minutes ago
and it says it's running so so that
tells you the containers running in the
pod so we can see the container
so it's exposed on port 8080 nine four
four three which is correct and we can
also look at the log so that's going to
get the looks otherwise isn't working
let me try one more time hey Google
talked to my test app sorry something
went wrong try again in a few seconds is
so sad so sad okay well we might not
never demonstrate this I did tell you I
warned you it was all very very
experimental so what this was going to
do was it was going to do a query into
the hacker news
dataset and list you you could say
something like tell me the top article
on the first of January this year and it
would then query the dataset and return
that number and it also tell you how
much data it scanned and how long it
took so because I have done this before
I can tell you that the hacker news
report that dataset is roughly six
hundred megabytes in size so much
smaller than the github dataset and it
took about it will take between two and
three seconds to scan that so that's
suitable for interactive use and then
also I was gonna demonstrate the weather
dataset which is bigger that's about
five five gigabytes and again took about
three seconds to scan so it's pretty
performant for the data s of that size
well they strictly speaking those are
really big data that they're in the in
the you know few terabytes range so
that's not that's not big and bigquery
can handle much much larger data sets
than that and the time used to scan that
data is not linear so it's not like you
know you go up an order magnitude and
data size and it goes up in the world
magnitude in type of scan it scales
better than linear much better than
linear to be clear on that right oops
right doctor do you want to show any
other code yes yes I would to show you
some code good idea so this is the big
query so the big hurry how can use so
this is almost as simple to use as the
vision API except of course you do have
to write the correct queries so this is
the SQL
note sorry that's not the right on that
sphere that's the weather one let's go
to the hacking V I can use one which is
here no it's not yes here it is okay so
you have to write some SQL and this
looks remarkably like SQL you're
familiar with because it's been designed
to be very very similar and you can see
there's a select I'm saving the title
and the URL from the table now the table
is defined just in the line above and
that's kind of like a help that get
bigquery don't get table method is sort
of a helper method that means you don't
have to understand the exact format to
write the table naming which isn't
complicated but it just simplifies life
to go to use that help method we have a
where clause we have an order by clause
and have a limit flaws and you'll see
also we have a we have a parameter here
and this works much like you'd expect
parameter rights as you go through SQL
queries to work and here we just create
an array of our parameters and we create
a big query parameter here and then we
pass that into the into the
into the big crater execute query async
method there and we just passing the
query in the parameters and it does
pretty much what you expected to do yeah
it runs it synchronously and returns the
results into result which is a bigger
result type and a big crew result type
lets you then iterate through the rows
of the result obviously how many you
getting unlimited it to ten so I've only
got ten results if you've got hundreds
of thousands tens of thousands of
results
that's paginate 'add and you can control
how much or little of that those rizal
should get back and we handle the the
slight complexities of using the
pagination api it's all kind of hidden
from you although in our API design we
always allow you to drop down to kind of
the next layer down in the ease of API
stack so if you wish to directly access
the low-level pagination API you can but
generally you ain't need to so there we
are that's it simple as that yes cool so
that's bigquery and then the last thing
we in the last five minutes I want to
just talk about stack very quickly so
writing these apps is fun but then you
need to maintain them right you need to
monitor them you need to log so for that
we have something called stack cramming
Google Cloud so it has logging so it's a
central place to see your logs
monitoring to monitor your application
error reporting catches all the errors
and then displays it in a central place
where you can see all the stats about
all different kinds of errors and the
stack trace and stuff like that
tracing traces the HTTP calls from your
application and then it shows you what's
happening and how long each call takes
and if there's parallel calls you can
see them in parallel as well it's very
useful for debugging and seeing
performance problems and finally
debugging for me is the biggest one in
debugging as I mentioned before you set
a breakpoint in your live code and then
when that where breakpoint gets hit it
takes a snapshot of the state and then
your application continues running right
so you can see the snapshot you can get
the data or the stack trace that you
need but then your application keeps
running so it gives you all these tools
and the other great thing about stack
driver is that it works against AWS and
Google cloud as well so if you have
resources running in AWS and Google you
can see them in a single place which is
nice so that's what stuck driver is and
we can just create to show you some of
the stat driver for this functionality
and fortunate I can show you most of
this without having a working app over
there so first of all I'll just show you
trace so this lets you trace calls to
the network course so if we go down here
to the stack driver section and we go to
trace then we can know view so this is
showing overall latency for calls that
we made earlier in this talk and if we
go to the trace list if I cut it down to
one hour then each of these blue blobs
here was one of the conversation items I
have with the app and this is the
latency of each of those calls and
you'll see that some of them are up in
that this millisecond so to cadiz two
seconds some of the higher because when
we were calling into the vision API that
can take a second or two so if we go and
look at a particular conversation pick a
trace rather we can select this one here
which we did 15 minutes ago and we can
see that this so we get that we get a a
timeline of a call so what this is doing
is when the call first of all comes into
the SP Donaire core application that's
running on Cuba's engine that happens at
time zero and we responded at time one
thousand seven hundred milliseconds
roughly here and within so that sums up
the entire sort of response to requests
and then inside that we can create extra
traces that show if we've got specific
actions that are happening inside that
request we can break up we can create
traces that showed just those requests
so from here to here which you can see
all that took most of the time this is
I'll show you some code in a moment this
is where we're dealing with the chat
request this is where we're actually
answering a particular intent in the
flow
this here is the court of vision don't
landmarks so you can very clearly see
that it's the vision dot landmarks cool
that is taking all the time in this
request which is expected there's very
little extra processing going on and if
I just quickly show you some code then
we can see we have a conversation
controller so you see this here
trace adult start span and so each of
those blue lines was a span and you can
create nested spans which are the kind
of they each span you saw listed are
ones that are nested so we created and
talking in a span here called flow which
is where you saw a span why we saw a
span here so the third one down is
called flow as you think ants a bit
small the third flow you down there well
it's called flow so that was the spam we
saw in this code here so everything
within that in that using statement goes
into that span and you can do a lot more
complex stuff than this and if we
unfortunately we didn't get the big
query cool was going here but if it did
when you make a big query call - it's
doing quite a few lower level API calls
under the hood and you can see them all
in this trace which is which is nice
okay sounds trace how much time do you
have one minute
can you see errors maybe well I can't
make it crash because it doesn't work
but we're seeing we will see the arrows
yes so you've got error reporting
so this this ego if yes no this is when
I did this earlier and protested so if a
top-level exception escapes out of your
app or other within the asp.net core
context if it escapes out of your
controllers before using MVC then error
what is called error reporting can catch
it and it lists them all here so this
half of this one happened a while ago
we're not testing it this morning and so
this was a stack overflow exception what
I did have I had it so you could tell
the app to crash which was a beautiful
thing
how many apps do you know that you can
tell to crash and they do and you could
tell it what exception you wanted it to
crash with as well and and so obviously
we have to stop crash with a stack
overflow exception and this is where it
would be where it's reported when that
happens and it gives you so it parses
the stack trace and it gives you so here
at happen in floats the s-line fabrizzio
and if our code if the code for this was
stored in the cloud source repository
this link would take you straight there
this code isn't there so won't but we
can just go and look so if you look at
the float of cs line 5 6 8
this is loaded up so yes we're just down
here and you'll see my beautiful how to
crash an app function so 9 5 6 8 is
indeed stack overflow exception so
that's it that's it yeah yep all right
that was it
thanks very much
and I don't think we have time for
questions but we've got about Google
cloud booth so if you have any questions
just stop by there we're gonna be there
for the rest of the day and we'll be
here just in the next few minutes a talk
Thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>