<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Chatbots - the next UI - Azadeh Khojandi &amp; Jordan Knight | Coder Coacher - Coaching Coders</title><meta content="Chatbots - the next UI - Azadeh Khojandi &amp; Jordan Knight - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Chatbots - the next UI - Azadeh Khojandi &amp; Jordan Knight</b></h2><h5 class="post__date">2017-09-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_Ktn9ZbCx5E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone I'm as and I work in the
commercial software engineering team at
Microsoft I have more than 10 years
experience in developing software before
I joined Microsoft I was mainly working
with content management systems like
site core and Umbraco I am a sidecar MVP
and I'm co-organizer of Sydney site core
user group
also I'm co-organizer of care ski Sydney
in these photos you can see my happy
life at Microsoft I'm absolutely proud
to be part of the team who helps
organizations with their digital
transformation by adopting new
technologies hey guys i'm i'm jordan i
mean the same team it's as teams called
commercial software engineering and
we're actually a global team of
engineers that freed up from direct
product work at Microsoft to go and help
organizations startup student enterprise
all that sort of things build um
solve it the most difficult problems the
way we like to think of it is that we're
a team of friendly geeks that help
organizations do some awesome shit and
so we actually do a lot of bot work and
we work across a lot of different
projects and things like that we fills a
whole range of organizations in stable
want to show you some of the learnings
that we've had building bots
over the last year or so before I
started my first used to build a whole
range of apps for platforms like Xbox
and iOS and Android and things like that
with with Xbox it on that one device you
get the devii which is the Kinect
movement you know wave hand wavy
controls you get the new e which is the
natural user interface which is voice
control and Xbox it's we call it the
10-foot experience which means that the
users far away from the screens you have
to design this very differently and then
we built apps for iOS and Android and
cross-platform app dev where you've got
a whole different input paradigm again
so small screen or perhaps tablet and if
you're doing xamarin apps you've got
iOS and all of a sudden the same app
you're building for uwp on desktop so
there's all these different display
paradigms that we handle
and so over the years we've seen many
different paradigms in computing that we
as engineers and software devs software
dev teams have to have to think about
and think about how to handle from
screens in the 80s the internet
searching web producing web pages for
people to look at now it's that's all
about apps and social and what we want
to show you today is how you can take
the engineering concepts that you've
checked that you've learned over the
last you know a long time since the 80s
we've been building these concepts and
apply them to this new natural user
language natural language user interface
chat BOTS and digital assistants and
anything that can basically understand
humans in a natural form without having
to be a computer UI that the humans have
to learn instead and so right now you
things are really heating up and I want
to just quickly touch on why chat BOTS
are so important at the moment why we're
all of a sudden all talking about them
there's a couple of reasons for that
firstly because of the rise of the
mobile computation device being in
people's pockets they're using it more
for social stuff and more for organizing
their day what's actually happening is
people are starting to really use the
the chat tools like your messengers and
your skypes and things like that in fact
these are spending most of their time in
those apps compared to other apps in the
stores and think and so it's the
platform that we now need to deliver our
software to we need to be there and we
need to be able to interact with those
users in that in that area if they're
chatting to their friend why can't they
or a pizza or a book a haircut or check
their bank account or anything like that
why did I have to change to somewhere
else we've got the technology now to be
able to go and deliver that new
experience to them and and that's the
next part of it it's this it's this it's
this capability for us as engineers to
to deliver AI based solutions in the
past it's been up to n AI team with data
scientists and people building out
machine learning based systems and
things to to actually go and deliver
these intelligent systems but what what
we're doing is we're democratizing that
we're taking advanced AI systems
produced by research teams like MSR
Microsoft Research and others
and making them available through a
restful endpoint which means it becomes
an engineering problem we now as
engineers are able to solve for and
deliver a I based chat systems and so
part of our talk today is around that as
engineers what do we do and how we apply
all that knowledge that we've had over
the last number of years to that problem
and so first up as it's going to give
you guys a refresher on how to get
started with it with a new bot and then
later on we're going to level up that
bot and we're going to apply a lot of
the engineering concepts that we've
learned to to that to that specific new
you are the new chat based UI all right
today is Friday and we are getting
closer to the weekend let's talk about
drinks first I love drinking cocktails
but I have no idea how to make them
let's make a chat bot that you can ask
how to make a cocktail and it returns
back the cocktail recipe sounds like a
fun sample to do on Friday isn't it yeah
all right
for doing that I'm going to use your
generator to scaffold my project I'm
going to name it the cocktail master it
returns back if I can talk the cocktail
recipes I'm going to pick type a scrip
as my default language typescript
provides type safety and when it goes to
debugging and refactoring it saves us
from a massive headache and I'm going to
pick Louise as my default dialog to make
sure generator brings all of the code
that I need to integrate my chat bot
with Louise and violets generator is
downloading my node module let's look
into the Lewis Lewis is an AI tool that
uses natural language processing and
machine learning to analyze the text
based on the model that you define for
example in our scenario we want to know
how to if user asked how to make a
cocktail when you work with Louise there
are three concepts that you need to know
intent our trends and entity we want to
know the intention of the user which is
how to make a cocktail right so we
define our intent as how to make a
cocktail then we provide some samples
like how to make margarita do you know
how to make margarita what's in
margarita they are showing the same
intention the intention is how to make a
cocktail right and the information that
we want to extract from the text is the
cocktail name we don't care about
anything else but we want to know that
what the cocktail name is and return
back the cocktail recipe right we can
define our entity and label it into our
samples after we train and publish our
Luis it will give us the the end point
that if we call that end point with the
text it returns back the top-scoring
intent with extracted entities
okay let's dig into the code I'm going
to use Visual Studio code as my code
editor I found it's really easy to work
with Visual Studio code when you are
working with nodejs
and typescript projects as you can see
similar to any node application we have
packages that JSON in a packages that
JSON we have bot builder which is node
module a sticker that Microsoft provides
to Bill chat BOTS it supports to create
a chatbot that can support to interact
to support different type of interaction
with user it also has built-in
functionality to work with via Microsoft
cognitive services log Louise and Q&amp;amp;A
maker 30 env is a node module that you
can read config settings from dot env
file and it injects it to process that
env and Resta file is a node module to
create restful endpoints TLC config is a
configuration that type a script looks
into to transpile type of script files
into the JavaScript and I'm going to add
extra flag which is watch what watch
does is as soon as I taught ESC it not
only transpired all of the type of
script file into the JavaScript it also
goes to watch mode and as soon as I
change any type of script file it
automatically updates the relevant
JavaScript
as you can see I have up to tears and
you guessed it right it's the starting
point of the application and what it
does it opens an endpoint and listens to
all of the post messages that sends to
API slash messages and but the TS is the
place that we define our but object
right and the second parameter is where
we define our default dialogue the
default dialog is as soon when you send
a message to the chat pod and title has
no idea what the messages it's a default
dialogue it can be a message or they can
be a series of messages to explain the
user what it does and how it the user
can use it right let's test it and let's
change the chat button explain what our
chat bot does which is you know showing
you how to make a cocktail right I'm
going to open a javascript file and type
of skill file side by side so you can
see as soon as I change it
type rescue file it automatically
updates the JavaScript file if I change
it to a message and say hi I am a
cocktail master you can ask me how to
make
so you can see it automatically updates
my javascript file what I really like in
Visual Studio code is it not only
provides a terminal that you can write
your comment line without opening a new
windows prompt and type your comment
there and leaving your code editor it
also gives you the chance to have
multiple channels so I can easily create
a new terminal and write another command
here and I can navigate through the
terminals easily right to improve my
development environment I'm going to
install a new node module called node ma
NPM install what node month does it
traps the node application and as soon
as it sees any JavaScript changes in a
path that Noah application is running it
automatically updates and restarts the
node server now you can see I have a
very nice flow of dev environment when I
change my type of script file it
automatically TSC which looks into it
and updates my JavaScript file and as
soon as any JavaScript and file changes
happens node man pick it up and restarts
a node server so I don't need to shuffle
around the terminal type command so it
automatically brings everything all
together
alright now I'm going to add my start
scrip if I type NPM start as you can see
node man takes over and it runs the node
application and it opens the fourth port
for me
now let's the test test the chat but for
testing a chat but I'm going to use but
emulator but emulator is a desktop
application that Microsoft framework has
it and you can test your chat but
locally or remotely and for testing it
locally you only need to provide the
endpoint and as soon as I provide the
endpoint and type message it returns
back to our default area at the moment
our chat bot is part of few words he has
no idea about the message so if I send
lull it returns back the default dialog
because there is no analyzing the text
behind it now let's add functionality to
analyze the text and return back a
correct relevant message
so for doing that I need to go to the
party s and you can see but builder has
a built-in functionality to analyze the
text one of them is a you can integrate
it with Luis that I saw the model I
showed you the model so what you can do
is you can easily copy the endpoint that
Luis provides and paste it in your dot a
and B file I know that I copied some
extra rubbish and when we go to but the
tears Knight recognize the text so now
we have we know that if user sends we
know the top in intent or top-scoring
intent now we need to register I dialog
similar to normal conversation in chat
pod to manage the conversation flow we
are using dialogues now we can easily
register our dialogue and say if the
top-scoring
intent is matching with a dialogue name
go and follow the steps in the dialogue
and it's not magic our generator
includes a dialogue for us so what I
need to do is go to the the location of
my Luis dialogue and make sure that the
name of dialogue is matching with my
intent name which is how to make a
cocktail all right
so if I update the name and ID and we
need to extract a cocktail name right so
what we need to do is we need to make
sure that we extract the cocktail name
from the entity from their text so what
happens is if we can't find if Louis can
extract the cocktail name we go to the
next step and I said you said blah
if not we asked user please provide the
cocktail knife so it's so not test
unless that's it so I said if I ask her
to make margarita it said you said
margarita if I ask where is the nearest
pop we all know what the intention is
but we haven't trained our model to
endure understand that and it defaults
back to the default dialogue he falls
back to the default dialogue okay so the
next step is instead of sending back a
boring message
you set the cocktail name we need to
actually return back the cocktail recipe
I'm going to in turn into great Ida our
code with a free open-source API which
is called the cocktail DB it has more
than 3000 cocktail recipes I highly
recommend you guys to go and check it to
impress your partner or your friends
right okay so for doing that I'm going
to create a service to call
the API the first thing I'm going to do
because I picked type a scale and I like
really to have type and type the type
services so first I'm going to define my
interface of my dt object and i call it
i cocktail tears and to save some time i
I created some code snippet right and my
interface has only four properties title
instruction ingredients and image now
I'm going to call it write a service to
call the API
as you can see it's a very simple class
with one method it gets the cocktail
name and maximum number of cocktail
recipes that we want to return back and
it returns back an array of cocktails
the next step is integrate or service
and import our class took and call it in
our dialog so I can easily import it
because the relevant address I need to
provide relevant address
and instead of sending the boring
message I'm going to call the cocktail
DB that get cocktails provide the
cocktail name we got from users and
maximum result that we want to return
back so if I ask how to make ma carita
so you can see now I have a recipe and
nice cards and information cards that it
shows it shows the image of the cocktail
and the cocktail name and the cocktail
recipe and I can see all of them ok the
resolution is not as good as I expected
but you get the idea
yay all right so now you can see here I
am so I have I defined a car and I
showed it in as a carousel and I
attached it to the session and I send it
back now you saw that we we built a
fully functional chat bot in less than
15 minutes you can tweet it hashtag
impressed we saw hot how we know how to
make a chat but in less than 15 minutes
and week you can VIN hackathons all
right okay so that's a really fantastic
canonical example of how you go about
getting started with doing a chat bot
what I want to do now is is take that
and level it up and show you guys some
of the stuff that we've been working on
over the last year or so arounds how we
put together BOTS in the real world and
how we deliver those in a nice way so
taking away software concepts I was
talking about before making code bases
that are manageable and easy for new
devs on the code base to come and get
started as well as less experienced
developers all that stuff that over the
years we've learned and we'd like to
know how to apply to to the current
stuff to this to this new paradigm
natural language user interfaces um
and so we're actually gonna do
show you guys some code base that we've
put together to valve or github we call
it boiler so opposed to bot builder this
is the boilerplate code it's not it's
not an NPM package or anything like
hidden away in a library or NuGet or
anything like that it's actually some
code that you generate either using our
bot boiler yeoman generator or you can
go off to the github repo and grab that
and salt itself so we've got this github
repo here we'll show you the URL for
that at the end but essentially it's got
a lot of instructions on how to get
started and just some samples on how to
how to how to use it or what everything
like that I'm you might notice I'm
actually going to do my demo today on a
Mac so as you did we just you know code
and building bots on on Windows there
I'm gonna do the same thing on a Mac all
these tools are available on iOS sorry
on their eyes on Mac and Windows and
also lonex so if you're using Linux just
stop you can do that there as well so
what I've actually got here is I've got
a pre generated project running that
I've set up just just just to save a bit
of time we've seen our yeoman generator
works earlier what I'm gonna do is I'm
gonna replicate what as just did in the
in the base example there and I'm gonna
do it in in the enterprise-e I guess way
using some of those other concepts so
first off I'm gonna go and create a new
cocktail search dialog which is that
dialog that as was just using to make it
easier to use this pot boiler code we've
got a Visual Studio extension that we've
created called block boiler helpers so
it's got some snippets in there you can
use to help create some dialogues and
other other little things and we going
to keep adding things to that outside so
it's all under the BB snippet thing so
if you just type BB it's going to show
up there and we can create a single
dialog so no need to remember all that
stuff that you need to include in
everything I'm gonna call this guy the
cocktail search dialog it's got little
tabs in there that you can move between
the thingies the fields I'm just gonna
paste them in um the trigger at the
moment sit - a regex
which means that when that reg X matches
that word trigger
it's got
call this dialogue I'm gonna change that
to be a string instead because I wanted
to match one of those Lewis intense that
as we're showing before so the match of
Lewis intent all I have to do to change
to get out to work is just change this
piece of text here that's how to make a
cocktail if I spelled that wrong it's
gonna be bad
okay so it's as easy as that I'm just
gonna clear out steps down here and I
just quickly have a look at the
structure of this guy so before in as it
is okay I'm going to switch back to
another Visual Studio code over here
that I've been running this is the
dialogue that we saw before
can you guys see that okay down the back
tell me to zoom I think I know this is a
button to zoom but anyway so but what it
is is we've got these waterfall steps
and they're in an array and they're
JavaScript functions that are pass
through the Ray that's the regular
example I guess what I've actually got
over here is a nice es6 I think it's a
six anyway class and it's a it's more
typescript D you can see that it's
extending in implementing interfaces but
essentially what it's doing is exposing
steps as more like methods I guess then
then those functions in the array and
then so they're nice and easy to write
and separate and everything like that
and they also get the context of the
object so later on we can do this dot
and access things which you wouldn't be
able to do from the other ones in that
alright the other thing is that then
weeks then we export them from the
waterfall so we can sort of control
which steps get explored in what order
and play with it in everything like that
it's not it's not sort of hard-coded
into the into the way that arrays
situated we're going to do is just
quickly go here just session in dialogue
with a high from the new search dialog
cool say that guy what I'm gonna do is
run the same watch tools that as was
working with before I don't need to
explain them so this is running the type
script watcher I'm gonna create a new
terminal here I'm gonna go in p.m. run
Apple watch
it's better typos um and now it's
running when I edit it's going to reload
and everything like that
you'll notice here that's actually
written out some of the dialogues that
the that the apps already got I will
zoom in on that some basic dialogue will
still I guess some sample stuff to
actually go in in this template code in
this in this boilerplate code to go and
add these dialogues to the bot we don't
actually go across into the block code
and start digging through and adding
them manually and things we're using
conventions where we're configuring the
bot as opposed to I guess coding it in
many ways so what we've got instead is
this dialog index file and anything that
we export from here is going to be
automatically picked up by the framework
code and add it to the bot so i can just
go import cocktail search dialogue from
terrace cocktail search dialog alright
and I'll just add it to the exports here
so importing in exporting out save that
no one's gonna go and reload it and
they're gonna save the other guy first
that's what's going on there save this
guy now no bond will reload and then you
can see the cocktail search dialog
showing up so it's composing the bot
instead using conventions super easy for
new devs on the project to pick up the
way that's working is we've got a
startup file that's if you've ever done
any a spinet core similar similar I
guess work these this file is actually
creating an IFC container using the
inverse of a JavaScript IOC it's it's
just like a typescript JavaScript de-ice
a container it's really quite good and
what's doing is it's composing that it's
adding some services and adding all
sorts of stuff it's got some cool stuff
around it to text if you're running in
functions or lambda or if you're using
Resta Phi and you're like a machine and
actually will adjust the services that
are injected so that way abstracts away
a lot of the complexities around
different server hosts and things like
that but the whole idea of it is that
it's composing our app instead of
putting it together in that sort of big
you know single file lots of stuff going
down lots of methods and things like
that
so you see here I'm actually bringing in
that that dialog index guy there from
from before where we added where we
export the other dialog from and if I go
down into register dialogues it's
Liberty through each of them and then
registering them on the ioc container
oops sorry
so it's actually going hey you a
function cool yep I'm gonna go and add
you onto the container has an i dialog
and we can label them if they diversify
so later on I can say hey give me back
everything that's an idea log that it
that is called dialogue which is cool
because it means we can pull them out
later to do testing on them as well we
can also pull them out in the main app
of course we can also register our own
things so I've got this I cocktail
service he registered I implemented I
cocktail service and the concrete is a
cocktail service that I've already
written so again things are available we
can access them in unit tests or in
natural dialogues and things like that
the way it the way your comes together
I'm switching out to the bot service
file this is the main service so we're
ecstatic was composing the IFC container
and getting everything ready this is
what actually goes and applies it and
boots the app so we're injecting in some
dialogues because we're going to need
those we can inject anything in there if
we want the whole idea of this code is
that you can modify it it's not tucked
away this you're meant to modify this
you meant to customize it and everything
like that it's really it's just a
starting point it's creating the bottom
like we saw before and it's enabling
Louis and doing all that sort of stuff
all tucked away and then it's taking the
dialogues and it's actually adding them
to the bot in the way that you would if
you were to go and do it manually so
we're not sort of intercepting deep into
the bot builder framework and and doing
all this black magic you can actually
see the cue and pull it apart and it's
really quite simple the way it goes
together with our trigger action still
and all that sort of stuff so it's meant
to be simple so what I'm going to do is
instead of booting up that guy yet I'm
gonna go
Dave this particular dialogue from from
unit tests instead so that I can
validate it's working without having
ever actually typed something to the
bottom I'm gonna do a simple example of
that first in this system we're using a
unit test framework called Ava which is
a modern JavaScript unit test framework
it's pretty cool it's quite powerful and
really easy to use to use it
I've actually got another folder here
for tests so before we were working out
of source which is the output of the app
and everything like that we got another
one called test and it's got its own
test config and everything like that
which means that we actually have to
build that separately so I'm gonna do
that
NPM run just watch build okay so there's
another TSC running so right now I've
got like if I switch through them or
look what it's done they build up a
little collection of stuff
NPM they can go run together I don't
have to stop the other output build
which I'm gonna use in the emulator to
actually start doing unit tests as well
NPM run tests watch Ava it's gonna go
and actually run my tests across
everything and you can see there I've
got probably it's gonna go to six yeah
there we go cool I got a mostly passing
ones and one failing one and that's this
guy because it's not making any
assertions it's a silly test it doesn't
make assertions these tests are really
easy I can go t dot here which is the
test the test thingy their test context
then you sell the stuff it's all testy
stuff you can do there we go
like they're just decisions so I think
ot that is true true
that's just saying true is true cool
save it now like everything else we've
been doing it's actually monitoring so
it's just done a transpiler javascript
avers also detected to change the
JavaScript code and rerun the test now
that's that's only one test he was doing
that thing where knows the impact of
changed code and just runs the tests ago
and then I'm dead or impacted so that's
pretty sweet right so we're going to go
and do he's adding some code I to know
how to work snippets now no more
greenberg a so we're gonna do is
actually go and pull in the cocktail
service off the ioc container
this is sort of using it more like a
service like hey I'm actually injecting
it but the ideas the same I grab the
cocktail service I'm gonna go make sure
that that's truth II just want to make
sure it's there you know because I might
have stuffed up the registration or
something like that there we go cool
it's still passing that's something at
least and then what I can do is I can
soothe actually like using typescript a
bit like I'm a I'm a c-sharp Dave I'm
Seto Dave by trade so I really love the
way that you can do stuff like this in
high strip equals away this cocktail
service so don't get cocktails and you
get a Manhattan
yeah I got a result I want to make sure
I've limited to two I'm just gonna go
tea you know ease resolved on things
length - that's my assertion that's just
probably enough for now just to prove
that the things working you say it's
gone off actually you've got the data
and it's it's check that the result is -
so I've got to wait and that I think I'm
the tests are now failing so I've
changed it there and you can see it's
outputting exactly what's happened so I
think you a lot of info about that and
in fact this case is probably yeah show
me where the test failed and everything
so Avis it's pretty cool it's a good way
to dev and certainly obviously it's a
good way to do unit testing and stuff
like that as well I actually use it a
lot in this way just to actually dev my
apps them to keep running them and
especially with bots you start if you if
you're dead being deep into dialogues
like and you've got three dialogues in
or something like that you don't have to
keep going like hi hi you know to do
that every time you want to just get
straight in there actually just begin
the test in the dialogue you're working
on so that's not going to do now I've
got these other dialogue tests they're
empty and they just they just got this
basic assertion in there just making
sure that you know we're not fairly well
the news first is amelia go back in into
my cocktail search dialog here and
implement step 1
cool
what I've got here is actually a very
common pattern with bots you wonders I'm
checking the safety entities present in
the Lewis intent that gets passed in via
the args argument it doesn't have to be
there so you can actually fire a little
sentence without having the entity
present it still fires intent just says
sorry the entity is not here but I think
they're tending to do this so what you
do is if the enemy is present you just
go straight to the next step and passing
the entity's because you've already got
it but if it isn't present then what you
do is you ask for it and prompt the user
very common pattern what I want to do is
actually test that in a unit test so
making sure that if the entities present
go down one path you see any isn't
present go down the other path so let's
do that we've got our cocktail service
tests the main cocktail search tests I'm
amazing at naming things to two main
tests so I'm going to test one in one
and the reverse of that and the other so
what I need to do first is go up here
and grab myself the dialog that I want
to test I'm just gonna grab it in the
constructor of the unit test itself just
so I don't have to do it for everyone
just be cool
so I'm resolving the dialogue that's
actually in the base class so this these
unit tests are extending or inheriting
from test base they'll go into that guy
there and what it's actually doing is
it's going to the container and it's
getting a named of type T that is being
registered with the dialog that we saw
before with a name of whatever is in
that dialogue name it should be called
dialogue name that very well but anyway
and that's that's gonna be the cocktail
salad so
go back so got a socialite there I might
just make sure that it's truthy truthy
there we go say that test make sure it's
passing
awesome to pass because there's two
tests in this file now I need to do is
grab out the function so the beauty is
is because of the way those waterfall
steps are actually set up and exposed
from this dialog that I've just got I
can go funky curls this time school
search dialog dot waterfall zero it's
the first one on it um now I've got a
handle to the instance of that function
which is pretty cool it means I can call
it mmm experiment with it and everything
like that which is I guess the first
look at why we're rewriting those
dialogues in that way so we can pull
them out like this before we actually go
and call it we need to have we need some
way to discriminate or to to test that
we've actually using it in the right way
so we've got a ver test framework what
we've also got here is another another
framework called sign-on which is a
ability to to mock and spy and stub
methods and and all sorts of stuff in
unit tests so then you can validate this
stuff happened the way that you thought
the first example of that is the next so
so might just go back to the to the
cocktail search dialog here and in step
1 have a look at the parameters they get
passed and it takes a session the arcs
which are any so I can passing whatever
and it takes next which is a function
and it's nice that next pass scene
because means that we can actually pass
in a next there only next something else
which is one of these stubs so we'll do
that so we only have our next equals
sign on dots by now instead of calling
the real next whatever that might have
been it's gonna whenever we call next
it's going to record the call count it's
going to record what it was called with
and then later on we can check to see
what that what happened there during the
calls the next one is let's just go back
to the cocktail search darling for a
minute is this build it up prompt start
text and that's not being passed in and
so this actually looks like one of those
it's a more global style thing it's not
it's not coming in from anyway local
it's part of the SDK
they've got builder SDK so we need to
stub that guy as well so we're going to
go text spy they're on the next and we
can stab other methods we don't have to
actually stub just you know like we did
before we created a stub so we going to
start building up prompts and we're
gonna stab the text method there cool so
now when we call builder prompts our
text passing the session passing the the
prompt to do we can go hey were you
called with that or not so we can ship
that so now we can start to think about
the session object which is actually a
big javascript object or a big object in
the in the SDK it's fired up and created
for you and there's a lot of stuff that
goes you know it the actual I can't just
go over session equals new build a
session here it takes these five session
options if you don't have a look at that
there's a heap of stuff on it's a big
object with all sorts of more objects
off and it's really hard to create but
lucky we sign on we can just go hey can
you just mock the whole thing and don't
worry about it
so I can grab out this session stop get
session yeah I'm just going so look at
that it's going to sign on hey can you
please create me a study instance of
this entire thing and session
what building a session is new able it's
got a constructor this doesn't run that
so that way we don't get into strife by
passing in nothing to it and instead
what it does it just makes all of the
all the methods on session spy so we can
actually see anything anywhere in the
framework calling that anything that
calls it that expects something back
we'd have to do a better mock of it but
for now we're not really doing much with
it so we can just pass it in and we're
good to go so we've got that session
object there now cool let's call func
passing the session yeah really the args
so what's going into that dialogue who's
coming out of Luis and it's a bunch of
intense and an entity maybe and things
like that what I did earlier is actually
just ran it and just out put it into
Jason and captured it
so I've got one here that we can use
okay here's the Jason object literal
that big object there oh there we go
so you can see that entities is empty so
just going to double check quickly test
gets our cocktail no entity cool the
right one so nobody's there so we want
to make sure that it calls the building
up prom stop texting this one so I'm
going to pass that args into the first
one there and of course next okay first
step is we've modified something in the
SDK build a dot build it up prompts text
so we want it we need to go text by
don't restore to actually turn it back
to the old function the beauty in
JavaScript and it's a beauty and a curse
is that you can do what the hell you
want you can replace method you can do
all sorts of stuff it's really handy if
you're mocking but just remember be a
good citizen and clean up after yourself
or else we would have left our spy on
that object for everything else into use
and certainly would have been behaving
atomically this unit test it would have
been affecting other things because
party sdk so remember to restore them
now the next thing is that we can do is
we can go hey next t dot he's he's not
next cold okay
I'll do that differently today is next
colqhoun see right okay so we don't want
to wrinkle because it's got to go down
the build at a proms task and then we
can go t dot is t dot called are so true
and that one's going to be text by which
is there builded up promise or text or
cold with cold with the session and
let's have a look back here it's getting
cold with the session and this piece of
text so just to make sure that's also
happening back into tests they said in
alright so it's getting cool with that
session object so it's actually storing
the object to reference a memory like
that and it's getting called with that
piece of text
okay what have I done wrong oh I didn't
say feelin ya cool
thank you thank you you any pride no you
can't you're eligible works of stuff um
so basically yeah you can see that it's
checking those two things are being
cooled if I just make a small change
here there we go and it's we get in that
error again so they're saying basically
that object was not the same you can see
there was called with that instead of
the other thing so it's it's working
damn I'm going to invert that unit test
now so that way I can just basically
grab in copy the chest okay replace that
obviously we need different arcs so
sorry I'm gonna grab another set of args
that actually have thin 10 present so
I've typed something different this time
it's got the entities here he's passing
really it's a Manhattan I've asked for
the Manhattan this time obviously I want
to make sure that next this time he's
called because it's skipping over the
Builder and text by dr. cold with two
you know years cool count
cool hopefully a good day all right -
bus deliver though for that it's the
time all right so that's a fairly basic
unit test of how you can directly test
the methods in those dialogues by
marking out things it's got to finish
that dialogue off so we can actually see
the guy running so step two is bit more
coding here okay so what I've actually
just done is brought in some more code
first thing we notice is this codes
actually trying to call this doc
cocktail service now that wasn't
wouldn't be possible in the existing
waterfall steps method methodology you
can see it's gotten to wait there so
this is got to be an async method so
these guys support async which is
awesome I don't have a desktop cocktail
service yet so I need to inject it so
I'm just going to go up here and go
private cocktail service my cocktail
service see here arm there's a cool
thing
with typescript in visual studio you're
actually having it include only imported
that yet but as soon as I press enter
actually goes out and finds it and adds
an important for me for model contracts
they ain't gonna change that a bit
someone important everything from there
I'm gonna need some more stuff no
important everything from model
contracts Esteves okay so I got the
private cocktail service in the
constructor I can ask for a cocktail
service of type moral contracts dot a
cocktail service well actually I can one
feature of typescript is it interfaces
unavailable runtime and that's what I
need to know what I'm trying to get so
what else you have to do is use these
six decorators I need to actually tell
it what I need to inject it's just a
little bit of it's the only thing that's
quite and I'm not quite super happy with
with the way that I inject things here
but it's mainly because I'm just used to
c-sharp where you can do that so I'm
gonna just grab in the
cocktail service here you can see that
let's get injected so I've just taken a
dependency on that I haven't told
anywhere else because we're using IC and
stuff I can just grab any service that's
available and start injecting here they
have to change any other code I don't
have to change my unit tests either it's
they're just going to work because
that's how injection works so the
dependencies are managed by the object
itself and then I can just go this dot
underscore cocktail services cocktail
service save it and there we go the
dependency has been picked up and like
as is code before I'm taking the result
of that and I'm just looping through and
putting out a hero card to use now all
this time I've been doing the unit tests
I have actually still been running in
versafine so it actually is it's been
loading and reloading over here so what
I can do is I can go into the bot
framework emulator it runs on the Mac as
well when you guys show me how to make a
cocktail
and this is path 1 and it goes okay sure
what kind of cocktail looking for that's
this is the building up prompt oh no
it's working because I did the unit
tests
I want a Manhattan please it's gonna go
off and find some Manhattan's show me
how to make a man pattern alright so
this time I went down the other path I
went straight to next and show me how to
make a Manhattan so you can see those
two things weapon okay alright so I
mentioned before that this code is
flexible and everything can run on
functions it's actually built around on
AWS lambda as well hello at the moment
snot will get will do that next and it
also runs locally so what I want to do
now is show you how cool it is how easy
it is to actually dev here and have it
all sharp and as you ER and have it
actually run live whilst I'm doing it
here and to do that actually write a
little tool called K scratch well it is
it's a little no NPM thingy where you
can grab the publish profile out of your
out of your app service which is where
the functions
and you can then go and upload things up
to up to as you are and have it run
immediately you can also have it show
the logs locally so in Visual Studio
code I can see what the functions are
doing and running and I can also have it
monitor for changes so we've got unit
tests getting built and then run and
output getting built in rs.25 being
reloaded and we're also going to start
pinging things up to Azure as well so to
demonstrate that what I'm going to do is
I've got kudu running here yeah what
kudu is it's this little app that runs
in every single as your app service and
as your app services where functions run
and also they can also run websites and
all sorts of other things but
essentially this little app it's got an
API so you can send stuff to it that's
how a scratch works well it's called K
scratch scratch it's almost like I can
run PowerShell on my host up here I can
do a bunch of stuff but essentially for
now I can actually just see the file so
here's some here it is there it's empty
I'm gonna go back into my thingy here
put me off your session keeps talking to
me on Twitter
okay so I'm gonna bring that over here
so I can see that you can just see their
files there so just keep an eye on that
I'm gonna need another I'm gonna need
another prompt here I'm gonna go into
the output directory I'm gonna go into
the run directory which is where some
stuff is so look LS s looks like some
stuff in case - you it's actually gonna
go grab it and there's boom Citgo up -
as your it's actually sitting up on as
you are now ready to go it's gonna be
cold because I deleted the whole lot so
I'm just gonna quickly just run an NPM
install it shouldn't take too long so
I've got the modules sitting there
already but as I'm running that NPM
install I can go KS myself or log Stream
output grabs the log stream out of these
your app services going to pop it out
here and - you four are for mitering so
yeah what's in you means that floats
over stuff later - twice so we just ruin
the demo but anyway um but now I can see
that log streams they are putting here
NPM still running it everything's just
warming up this it's hard to do this
demo without having a cold unfortunately
you see it's actually popping out some
work stream stuff there that's my
go big again blog stream stuff coming
out and the MPM restores appear to have
worked with them PM you nib I think I
had someone said the other day you
didn't npm install the other dana didn't
get any errors it was amazing all right
so I got mine if I just refresh this guy
here I can say go the bot functions
showing up just appeared I'm just going
to quickly just press run on that guy
just to again warm it up this is going
to take a little bit so what I'm gonna
do while I'm doing that it actually is
getting young casual the npm modules so
it gets really quick on the next one but
this one's gonna take a second
so here's tip over here is cocktail bar
what it is is basically the bot
framework has a devta bar frame icon we
go and register your bots the pop
connector is what talks to skype slack
everything like that and your book code
runs on your server on Azur on a dual
function or whatever and that's where
you write your biet and the block
connector abstract away the their
clients so the web client or direct line
or skype or slack you don't have to
worry about which one it is you just
write the same piece of code like what
I've just done it the connector where
has been anything else we've got to
register the bottom connector you get it
an app ID that password things like that
it's really easy to do
but what I've done here is this is my
bot I've got some configurations you can
see there's a URL for my bot there which
is actually that is your function that I
just uploaded this is all stuff I've
obviously prepared earlier it's gonna
see if that guy's actually running yet
boom alright it's running immediately
now what I can do though is I actually
popped this guy out here and go test the
bot so I can go show me how to make a
and this may not work the first time I
don't know why but sometimes it doesn't
see just try that again
go to your
always gives me a heart attack when the
stuff happens like there's a bit of
black magic like this I think five times
it worked last time so just make sure
this happens here see if there's any
outputs there's some outputs there
something's happen you try
see that didn't fight off okay okay so
what was doing there though see how it
goes okay searching for Manhattan what I
do is I'm actually just go I can move my
hand a search on Mac there we go it's
like commands f6 always buttons a weird
it says okay come with searching and
it's gonna go find that piece of code
I'm gonna go cool it's emotional just
really make a stand out what's it down
here it's gonna check it's gonna type
script compiled it's actually going and
setting it up so it's uploading it has I
edit it so sometimes it doesn't restart
the bot unfortunately so I got to go
into the output here and just touch the
app function sometimes it does I don't
know work by uploading this you'll see
the BOK will actually go coolest the
block codes changed there we go cool
sorry loading up on here I can go show
me how to make man this time that codes
already running up there just gonna wait
a second the reason why so slow as this
is all over in the u.s. normally would
deploy your bot in the u.s. data center
and this would be a lot quicker also the
fact that see those pools so different
Madden now here show me to make a
Manhattan I'm donating my cocktails like
beer just so you know if you buy me
drinks take it make Manhattan cool see
that actually so it's running locally as
well this is still running on a local
machine so you can easily div using live
servers and this obviously wouldn't
wouldn't dev to production like that
without you could fit I wouldn't but so
that's that's pretty cool um I've just
got I just want to spend just two
minutes on something and then I'm gonna
finish up before I mentioned in this in
the search dialog there this pattern
here that they finding an entity and
then asking to get to fill the data for
it if it's not there otherwise just
continue on it's actually quite common
and over the year we've noticed that
there's quite a few different patterns
like this that show up it's all we've
done is part
pop boilers actually made it so then
consider them to write code to implement
these scenarios which meant sooner you
can just configure them instead and
we're working on more more scenarios now
and I know that other people out there
in the community are working on similar
things like this too to make it a bit
easier to work on these dialogues and
make them a bit more flexible and things
so what I've got here is I'm going to go
and add some more functionality to my
bot so first first one is hey can I
please find box by ingredient are
sohbats cocktails by ingredients I want
to show me what cocktails can be maybe
vodka and it's saying the end of the
ingredient needs to come in from Louis
or else ask for it and if you need to
ask for it use this text the second type
is give me around and cocktail okay
format that this time no no fields and
just you don't obviously need to ask for
what type of round and cocktail it goes
okay let me get some random up in here
now the interesting thing is that before
I was calling a method from my local bot
so kind of you know if I'm doing
configuration it kinda doesn't really
make sense after then go and write code
anyway but this one here is actually
going off and calling for that
information from another as your
function or it could be from another
doctor container that's running with
this one or anything like that the whole
idea is I can feel these guys and have a
whole range of services that they can
call on as long as they're implementing
the right interface I can save that guy
there and just got a quickly make sure
that those two are included on the
container up here okay save that
I should close tweet us you know and I
can show you showing me random cocktail
and now instead of having to actually
write the code it goes and uses that
configuration and calls that web service
and shows me the random cocktail but I
really did just add that piece of
functionality just now with that one
little bit of tax it's pretty awesome so
that's what we were working on
it's so new the product team hasn't even
heard of it yet it's fantastic but if
you want to know how to work it and get
started with this then please come up
and say so after all it's gonna show you
some links now and things like that but
that's that's the main main demo be it
done okay these are the links that you
know if you like to know more about chat
bots we are we really recommend you to
go and have a look we have a growing
community on Stack Overflow if you ask
any question we get notification on
Stack Overflow these are the tags that
you need to use so if you ask any
question about regarding chat bots
you're always we are friendly people you
always can reach out to us on Twitter
and we you know we love to hear that how
you are planning to use chat bots in
your organization we might be able to
help so this is the slide that I
recommend you to take your photo all
right we have what is it too quick all
right I slide it okay
all right so these are two other talks
about chatbots that are showing that how
you can use chat bots in a different
aspects Nigel and wish so Nigel speaks
in room 203 and which speaks at 6 for 20
at room one so there are really
interesting talks and very very great
presenters so I highly recommend them to
go and have a look and thanks for
listening to this talk and happy Friday</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>