<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>From Monolith to Serverless - Rajpal Wilkhu | Coder Coacher - Coaching Coders</title><meta content="From Monolith to Serverless - Rajpal Wilkhu - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>From Monolith to Serverless - Rajpal Wilkhu</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6HEpWGql-ak" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone my name is Raj I'm really
humbled to be here to be honest this is
amazing I was at NBC London and that was
totally amazing and this event is even
another level this is really good and
thank you very much for coming to my
talk and I'm really humbled to be you
know sign in front of you giving this
talk let me dig deeper in terms of what
this talk is all about I'll be sharing a
couple of stories with you my learnings
in fact it's just not my learning is my
team's learnings with with here I've
done a couple of these sessions on
service this one's slightly different
I'll start off with a bit of text bit of
pictures some more texts and then a
better demo at the end so there will be
some code for everyone to take away with
to just download play around with
serverless
a lot of stuff I'm going to talk in the
presentation here I've tried to create a
demo based on that so that you know you
can play with some of the concepts so
Who am I I'm just a software engineer
like most of the guys here I am NOT the
expert on a Douglas lambda energy or
functions I've done lots of talks I work
on both and in fact Google as well so I
have a little startup that uses as your
lambda and Google at the same time we
use the best pieces of everything and
cost very little and we we excel as a
start-up but what I'm talking about here
is mainly somewhere something I work
with a team of friends we work with a
company a pharmaceutical company and we
kind of moved their software from a 20
year old kind of platform in a
datacenter somewhere - no service so I'm
going to talk about the journey a couple
of examples and then we go through some
code so I always work in teams I've
never worked alone even in the startup
I've we're three of us and we pair as
much as we can we learn from each other
so none of these learning the mind they
are my friends right my teammates and
I'm just sharing bits of everything with
you I'm going to share a bit of post
cultures or because I thought I missed
that in common web presentations before
if they've been more technical a bit too
a bit of what services and the process
behind it and I'm hoping someone you
know will have their own startup when
they leave this session session so
server lists for me has been a journey
how many people know what services oh
perfect this is brilliant
so for me service has been a real
journey and it takes a journey to really
appreciate serverless I think that's my
when I first started I was a you know
control control instrumentation engineer
I was writing software for power
stations power generation transmission
and I was in the middle of Kenya in the
middle of the jungle somewhere and you
know writing software for power station
and I had my own service which is
amazing so had these really beautiful
services SPARC ultrasparc Sun
Microsystems servers were beautiful yeah
they were you know there was the servers
and me in the middle of the jungle and I
loved it it was brilliant right and if
you look at a spec of this actually came
across this and the spec of this is like
you know look at the RAM on it you know
eight sticks of ram one gig your phone's
have more memory than this right and you
know the computing power but you guess
what it's still going where you can buy
this server it's still after so many
years you can still buy it and we use
these servers to run power stations
right you know they were amazing these
servers add up then I kind of moved away
from one server and siring more kind of
platform agnostic stuff with C++ it was
amazing so I'd lo the service and we
also wrote software for Linux which is
really good we never wrote software for
Windows because you could never run a
power station on Windows Majan that
rebooting so a network management system
that's my next domain I went into a bit
more high level and then I site doing
more with Windows and to be honest I was
afraid of Windows initially I loved
Windows when I saw looking at a kernel
level it's actually quite impressive to
be honest you won't hear a lot
developers say that but there's a lot of
lessons in the kernel you can learn from
from all these kernels and then as I go
to operating system management works
with Microsoft on the system center side
of things we managed thousands of
Windows servers and Windows machines
mainly on the power management side of
it and I got introduced to virtual
machines you know these are amazing you
know virtual service this is the future
right I thought this is brilliant and
then as y'all came along and a lot of
people must have had bad experiences
really joke before because it's changed
a lot but I loved it I thought this is
amazing
right and I wanted to do more of it and
started joined a price comparison engine
which is go compared you know they they
do a tea price comparison engines where
they compare broadband you know
different prices give you the best deals
and we moved a whole environment into
AWS PPC and it was all infrastructure as
code you know scaled out handled 80
websites
it was brilliant beautiful right and
then I joined another takeaway company
this is a I don't know if you just eat
where we're basically we created the
whole platform based on AWS as a base
platform still easy to still scaling but
we had a problem so right now it's a
three o'clock
not a lot of people order takeaway right
people leave work and order takeaway so
traffic goes up by this time adjusting
we had lots and lots of servers just
sitting there idle waiting for that
first takeaway to come across right and
then we discover service and this was
this change in my life actually
it was brilliant and I started my
startup at that time so my startup is
all about wine I like drinking wine and
I'm also kind of a a couple of friends
we created a platform where we got these
little merchants in the UK who provide
really good value wines really good
wines actually but they don't know how
to sell these wines online so we give
them a platform to you know make sure
that they can actually present these
wines to the end-user and give them
platform to actually sell wines online
and it's all built on a jaw so we use
that's all initio actually it's as your
AWS and Google so when you've someone
buys wine they don't come to you because
you're not as your or their own urine a
double yes
come to you because they want a really
good service we found that actually you
can use the best of both if you're in
the cloud key on the cloud there's
nothing a double yes as you're about it
right you use the best of everything
including Google so Google has been good
good to us as a start-up as well so we
use Google now so that that icons got
three icons now so that's my journey and
I'm going to kind of take you through
this journey with me through this
project because I'll tell you what like
there was a time where I thought you
know AWS ec2 is amazing right
you know scale out this is amazing this
is this is the future and now my mindset
has changed because I kind of wrote a
lot of code to manage infrastructure
right which is around a.m. is anyone
done am I here right you know build am i
is build you know environments from
cloud formation you know go through all
the pain of managing them ec2 machines
you've got a thing about scaling out
availability zones and then you come
across server this way you know you you
don't have to do any of that it's
beautiful and I'll explain through to my
journey right so I'm going to use an
example my last example was the legacy
application worked with this
pharmaceutical company working on
clinical trials and drugs the right kind
of drugs and it was a it was a really
nice domain actually you know helping
discover better drugs and speeding that
up it's a it's an interesting domains
and I was kind of humbled to actually
work in that but we had a we had a
requirement and that was this
requirement where this 20 year old
software service company bought Lassa
Lassa software and they just jumped it
up together it was you know legacy
software and the bill they wanted single
products on this so that lots of
products they wanted one product and
that product did should do everything
the old product does right so it needs
to do everything but it must look
prettier than the competitors right so
they had competitors in at least you
look pretty it must scale it must
perform better right
it must be extensible it must be done
really quickly and it must be within the
same sub budgets right so they came up
with a budget you know we need we need
all this
Thanks 20 years of software in six
months maybe not right and everything is
a must what we heard though because you
know from experience right we actually
had to provide the customers with the
best software something that they needed
and this software was giving them
something but they had nothing to tell
them what the customers were using or
you know what what they were getting out
of it so we needed something that give
them that support their needs right and
they should renew the subscription so
keep the old customers for the new
customers we wanted to give them
something more simple because your
product had a lot of baggage I mean I'll
give an example I'll make this up right
so the I bought this laptop in 2012 this
is my third Mac and I have 17-inch Mac
and that was beautiful you know that big
screen and he had a DVD and I bought it
because of the DVD player and when the
new laptop came out I was like come on
Apple where's the DVD player right and I
have never used one time has changed
right how many people here use you know
has I actually missed anything any of
that anyone missed a DVD there no
probably not
things have changed so software changes
requirements change the world changes
but legacy software rarely changes right
but you can't blame them in the olden
days it was really expensive to release
software when I say expensive I'm
comparing this to develop the salaries
right so in the olden days to release
some software it was you know big deal
right it was huge because they actually
lived somewhere and you just have to do
everything is one thing so just to do
everything is one thing develop you know
release it infrastructure was expensive
you do and bland you know we needing
service I remember they went and bought
these servers at my previous place the
Sun Microsystems and they based it on
the old service so they went looked at
the old services of one this we need ten
of these and they cleared a whole flow
to bring these service when they came
the sellers are smaller so you have this
room big room with like little servers
in the middle of the room and your
things change and but you can't change
them you can't say now I don't want this
service I want to split them up you know
and do something else to them so you
have to share
as much as we could right so we just
plunked software as much as you could on
some some hardware and then you had DBA
these guys actually were the Kings right
because you know they're there they're
there they own the day oh man you know
and this is the most expensive part of
your system so yeah these DBS were Kings
I couldn't change anything right and you
had different teams right yet operations
teams because these guys were experts in
that solaris box right they were like
the kings of that box the devs were
Kings on what they lived and as
developers we just wrote software that
lived on that right and actually user
interfaces or primitive we've changed
you know things have changed quite a lot
since then right so yet this is compared
to develop the salary's things have
changed though right so this software
was actually big ball of mud right no
real domain expert so you know there was
one guy who you know new things left
couple years there's no one no expert a
developer's only told what they were
told to do right they didn't actually
get involved there was no test lot
sequence everyone seen this right
this is classic legacy right lots and
lots of sequel databases cross joins all
the logic all the domain logic is in
stop seizures triggers and then a
different team will manages it because
actually they have all the knowledge
about dealing in production right and we
had some organization challenges right
big releases if you've got different
teams releasing software they've got to
do it in a project management way you
can't blame them in a way so kind of the
waterball affordable thing was kind of
accidental I think and also they you
couldn't do things in that world in a
different way so they had a project
based waterfall development right six
monthly releases yeah the team the
current team keeps things going right
the developers you know they've got
they're the experts of the old system
right the basically different team knows
about how to operate it right they had a
separate innovations team so you know
developers want the current developers
they just deal with the system the new
guys get to do new stuff right and the
domain is clinical trials and drugs
right so that was a challenge we faced
when we sir first died
and then what we do is we did did we
actually start with we thought actually
what what do we do so this is a software
its classic right
you have servers is SP net vb.net and
XML beautiful and then FTP servers SMTP
this is lots of database so this is one
product and there are lots of products
like this in a day center right and then
they had another side of it where you
know the scientists actually added
information to the data I've drawn two
sides of it
those databases at the top are the same
I've drawn a left and right version
actually about this this is pretty cool
I've got this side but this was actually
sequel replication so it's the same
databases but they replicate the data
because they got locking right of course
because these rights and these reads you
know they've got to manage it so they've
got a whole duplicate infrastructure to
manage that right so this is the legacy
application right and the whole thing
gets deployed as one right you must have
come across this right anyone who's
worked with legacy seen this so times
have changed all right cost of releasing
has dramatically gone down right and
this patterns and you know these
automation right things have changed and
then cost of infrastructure you go
Amazon Microsoft Google you know
releasing this you know the platforms
this is amazing right it gives us
another view of things right so we
thought we'll approach the problem from
a different from a business point of
view right forget about what legacy does
right let's look at what they do from a
business point and we start decomposing
the application and you find that
actually you know clinical trials that
are provided to the user and user are
very different from the clinical trials
that the scientists actually looks at is
it's a different representation almost
right and the the the actual
investigators who are live working on
these drugs they're looking for some
questions and answers right whereas the
guy and the back end is just managing
and providing the best way of their it's
a complete different view of things and
there can be different applications so
we split everything up right and these
are the kind of domains we are calling
bounding bounded contest context from
the area
book if you guys have come across that
and then we kind of split up further
right so we're going to look at one
content discovery which is the front end
which is what people pay for so this is
a search classic Search application
visualizations and fear sequel databases
lots and lots of queries lots of saw
procedures just hammering the database
right we thought this is this needs to
change right so how do we kind of set
this out right so we kind of picked all
the bits that are to do with content
discovery and decided actually you know
what we can provide capabilities in
terms of their own data sets their own
view of things and rather than actually
pulling the data from the sequel
databases we can push data into those
stores right so these stores live closer
to the features right there specific for
the features and basically the the
sequel database somehow sends events
right and these tools actually saw these
events so we thought this is a good
model and exactly a well-known lot of
people do this is his command query
separation right so how do we start
right service of course right extreme
lean no service right now but we had a
CI server who has no choice
that was the server and then now put an
HTML page and a spade and s3 API gateway
a lambda so API gateway is a provides
the ability to create if you go if in
the MVC world let's say Web API world
this is kind of your routing controller
side of things but you don't host it
you just get Amazon to host it and you
say whenever you get the endpoint this
route make sure you call my function
which is your lambda and Amazon does it
so this is not a web server that runs
all the time this is every time you hit
Amazon with the request they'll spin up
your lambda and the leg security so we
started off simple and then we are
single elastic search query so some of
these stores were elastic search some of
these were kind
you know document databases and we were
off right let's let's recap on what
services right so I'm going to kind of a
talk about serverless
just a brief service overview basically
here you have servers but they're not
yours right and your record runs in
these little processes they're not yours
either right
basically you the Amazon or your they
pick up your code and they run it anyway
right will be some docker container and
when they finish the freeze your
container and then next time you call it
they unfreeze it and then run your code
right and you're not guaranteed to get
the same container so it's stateless
right they also self provision auto
scale so there's nothing to setup from a
point of view I need to put in three
availability zones they manage
everything for you right so it's
infinite scale you can call thousand
lambdas in in parallel that's the soft
limit you can bring up Amazon and
increase it but that's off limits to
protect you right there's a
pay-as-you-go pricing model if you don't
use it you're not paying for it right if
you put a server in there and the
servers are being used you pay for it
right so here you just pay for what you
use and you get automation as part of it
so an example is so the for example is
let's say s3 who's using s/3 s/3 is a
good example where we just pay for what
you use right it's there you don't
provision it also scales you know is
robust and then you get functions as a
unit of application logic this is your
code that you put against those services
that add the business part of it right
so this is the infrastructure part of it
this is the business part of it right
and then those things give out events
and you can actually also publish events
right so you can be that service model
as well right so every time you get some
gear or something triggers put some
something on s3 for example s3 will call
you and I will see an example of this
right same server list though is a big
learning right so once you start off on
that path there's a lot of things that
in your kind of life time you learn
you've got a unlearn right because you
used to in some ways to work with
servers and this is actually a bro
new world and as a team you care about
certain things you can't care about like
as a team you know you want to keep on
improving right going faster and faster
right and in a safe way you want to be
taking code every little line of code
you write right you put him into CI it
should go out into production if it's
got the right test you just don't want
to build it and keep it it's that's
waste right I do you any line a code you
put into your repos should go out right
that's where the value is so you want to
provide continuous value and then lots
of little experiments so the so the
previous who's in the previous session
here that's pretty interesting if I was
talking about experiments and he was
saying that 80% of experiments fail and
they will write experiments do fill so
any decision that you make will fail any
software you put put out there in front
of users there is 80% of chance that you
get it wrong right but you get it wrong
then you learn and you want to get it
right so that 20% of chance you want to
make lots of these little mistakes so
you can actually keep on moving forwards
you want to focus on the core business
problem and this is my problem with the
server server world where we had a
takeaway system and we wanted to provide
takeaway to to experience to our users
but we found that a lot of the best
developers were not actually working on
the business logic they were working on
infrastructure stuff right this is like
you know the messaging side of things or
they were working on basically the ami
ami side of thing or the platform side
of things and you find that in companies
your best engineers actually end up
doing the infrastructure work and if you
look at what Eric Evan says in his book
he says put your best engineers on the
business side of things there should be
working on your core domain well in
reality that never happens right because
actually good engineers love the
challenge right it's the infrastructure
is a challenge and you'll find that most
of the time the code that actually goes
stale is the infrastructure code because
infrastructure change if your business
changes then the business code changes
right but the infrastructure changes all
the time so you find you're an endless
kind of battle for rewriting your
infrastructure code or refactoring it
because things have changed
so focus on the core business problem
right and reduce costing commitment to
the new system so you want to develop
something quick right so it doesn't work
you haven't committed to it you haven't
bought a server right you want to
basically roll back quickly the
experiment fails roll forward some
different different level right so how
does serverless help in our aims right
this this is what I'm going to take you
on a journey now so you need to focus on
the core business problem right and
that's what surveillance allows you to
do so this is pretty bit logic with
triggers so the previous session I did
at NDC London was all about wine
drinking and the startup where we scan
wine labels and work out which wine you
know you've kind of images all about and
we're using Amazon Amazon image
recognition to the service Amazon
recognition now this service is
developed by the Amazon Prime developers
I don't want to write any code there to
do that I've got a whole team and just
picking our service using that service
in my system gave me the business value
right that service cost 1 million
requests to Amazon recognition is one
dollar eight million requests is one
dollar eighty cents why would I want to
write something like that right so pick
it up right it gives you triggers use it
right so it's logic developed by amazing
engineers better than you right well if
some some you know hopefully your custom
code functions as a service so here
you're basically writing your code right
and use valving little functions and
I'll tell you the invented Vantage of
these in a bit right so there's no
infrastructure code so you're not
writing code that's tying you to Amazon
or your really yeah if you write your
function your binding says if you get
data in a blob storage or something call
my function you never write that code
that says go and talk to blob storage or
when you get an event from s3 you'd ever
say let me write some the put the AWS
SDK in my code and get any Paul s/3 s/3
calls you and there's no s3 code in your
function right which is the nice thing
you don't write infrastructure code
never s3 changes you know your function
we wouldn't change your automatic
scaling I mentioned this like it's
amazing so you're not worrying about
scalability as such you do but not at
the level of ec2 right and constant
commitment to new systems is really
important because as a team who's got
these little experiment and you want to
go really quickly right you don't want
to commit on something so you only use
and you only pay for things when you use
them so the pay-as-you-go model is
really good you're not tied to code or
cloud platform if you decide it obvious
it's good for this I'm going to use
machine learning in Azure and I'm going
to use bigquery in Google which is what
we do right I can do it all I don't have
to write code that's very AWS
specifically as you're specific and my
code doesn't tie to those platforms
I go to my scaling in terms of if I get
more customers I just pay for those
right I don't I don't pay for servers
that do nothing so what does prediction
look like now so I showed you a system
before right and after service I'll take
you through the Jenny looks like this
don't be don't be worried so I'm going
to go through this right so the first
part is the actual data center that's
the legacy sequel databases and what we
did was we we wrote this little thing
that took changes in the database and
created events so here's your kind of
events that got just based on the date
of that changes in those old databases
and I push into API gateway with a
lambda that lambda is almost your
anti-corruption layer what it does is it
validates events and actually tags the
the event before he goes into Kinesis
which is that there right so Canisius is
a queue right you pay for it you don't
manage it but it has cue semantics plus
pops up so you can subscribe to the
events of Kinesis and it's Auto scales
so you get more data through it scales
out right you don't manage that right so
you keep on pushing events is good for
IOT as well the push events you get
events out and you are multiple
subscribers so we have little lambdas
that take data from the queue
and push them out into into the
different reach stores now this is
different so if you had to write an ec2
instance there write your code would be
sitting there q falling a Canisius
saying you know is there anything on the
queue is there anything on the queue is
there anything on queue something goes
of the queue it does something right
then you have to manage how many
machines do I have you know which
machine gets which you know thing right
which event goes where in in the lambda
case Amazon Kinesis will call your
lambda and it maintains a pointer to
where you are in the stream so if
something goes wrong with the lambda
let's say that's blown up right yeah it
will retry yeah so you don't write the
retry logic and that might be fine that
maintains the pointer so actually
everything goes through a lambdas and
you don't write the logic about pulling
event streams or anything ladder that
just gets cold so let's look dig a bit
deeper right that's you can see with I'm
asking multiple read stores according to
the model on the other side on the other
side of things so this is the UI we
built so it's a react single page app
that talks to that gets gets the HTML
from the cloud front via s3 so it's just
pushed your bucket API gateway endpoints
right
calling lambda so every time we do a get
or a post yeah so multiple read stores
every time we do a get or post a lambda
gets called and that goes and read
something out of the elasticsearch aware
of that bet 10 point is right so that's
the other if you put it together it
looks like this and I promised you it
was going to be simple any probably
thinking oh my god why is that right
there's a lot not there so this is the
kind of the the front-end side of things
this is the kind of ingestion side of
things and ideally what we're doing is
that's the original legacy databases
that is the new application these are
the read stores and actually it looks
very complicated however the code that
we write is only in those lambdas layer
lambdas and they're only about few lines
of code they're not very big yes and we
choose the language we write them in so
here oh sorry
let's go back one level here we write
these lambdas in JavaScript no Jess
there's some written in c-sharp you can
write them in PHP you can write them in
Perl whatever language you you kind of
is supported by aw lambda and and and as
your functions so if your functions will
look very similar to this yeah so when
you get a new feature what do we do
which is write a new endpoint new lambda
new read store right so feature in our
world in the world of serverless
is that right a whole vertical slice so
every time we add it have to add a new
feature we don't change what's there we
add a new vertical slice that slice is
completely added in an extensible way
right so when new feature comes it's a
new function you might be a new endpoint
and a new store but everything is a new
function okay so how do we kill the old
system the old system was a pain so we
had the old system there we wrote some
tests what we call life for life tests
we drove the old system and we drove the
new system and we compared them because
the business logic in here is 20 years
old and in multiple places the business
logic here in the oh sorry here and here
is is in one place right the business
logic here is everywhere so we wrote
test to test that's the old system some
of the new system behaves like the old
system and that worked really well you
can't do TDD and follow BDD with the
with the lambda I'll show you an example
later you can spin a whole to spin the
whole lambda in memory so what is a
lambda it takes something input and
gives you some output right and if you
look at functional programming as such
which is you know quite interesting as
well you know it's simple the world you
write little functions lambda is
actually functional programming at the
architecture level so what you're doing
is writing these functions and tying
them up with with events and that's all
is your lambda is doesn't have any state
it takes pair of input convert it to
output and you can test that and we
actually test
everything in memory we spin up
elasticsearch DynamoDB in memory and we
test it edge to edge we don't have unit
tests around certain bits we just test
input and output the boundaries of
everything and actually if you got
because it's so cheap I'll show you some
pricing you can just spin up another
account and test it in there it doesn't
cost it costs like zero if you you're
using for testing so it's actually quite
nice and where you know that yeah it
costs nothing to test you can just spin
up more environments monitoring is key
so Google and legs and we kind of use
the application monitoring stack kick
stack where we converted chronographic
Rivanna you get events off card watch
we'll see that in a bit and in the same
case in the azure world very similar for
almost nothing when you push it with
your function or lambda monitoring and
logging is kind of included for free
right so that's a bit of a mission
that's our dashboard from graph owner we
have lots of these so that I I thought
put put some of these up because we do
application level monitoring so we
actually send out custom metrics from my
lambdas and that's very easy to do so
you can actually monitor what your
lambdas are doing right so you have an
overview of the whole thing so that's
how queues at the moment entity queues
going up and down with data coming in
and you can monitor events when things
get deployed right and when things get
started and soft I'm one of those
briefly over how the team function right
and then jump into the demo so we follow
something called modern agile which is
basically to me it's it's actually agile
it's a real kind of close definition to
the English definition of agile well it
kind of has three four principles but
I've kind of reordered them I think the
the make safety as the prerequisites is
probably the number one principle make
people also myth number two and then I
think three and four kind of come for
free so one thing service has done for
us is actually changed the way we work
and silver lace and modern agile
actually are kind of
I think if you do surveillance you kind
of fall into the modern agile pluff kind
of world really easily so let's look at
each one quickly so make safety a
prerequisite right so safety fail no
blame culture security so it's safe to
fell you can easily roll back a single
function or roll forward it's really fun
and single function it's easy right
because it's a little function it takes
a few seconds to roll forwards roll back
right there's no you got to come and
still if the the kind of no blame
culture world as well because things in
this function world everything is that
important because you design it that way
the little functions when things go
wrong they retry anyway you can rewind
streams you can do a lot that actually
helps you recover in that world and
actually moving as a team learning as
you make mistakes is actually really
good so the more mistakes you make the
better as a team as long as those
mistakes are not expensive security if
you look at an application in AWS or a
Joe you give the whole application
access to a lot of services because it's
all code there but in the functions
world your Security's just run the
functions each function is allowed to do
let's say I've written function that
kind of reads from s3 or writes to s3 I
just have enough permissions on that
function to give it that capability so
security is really tight you can encrypt
data or at rest you have soft and hard
limits so Amazon gives you some soft
limits this is like you know if you do
write some loop and then you know your
prior you loop some lambdas and hits you
do hit the thousand lambdas concurrency
limit there's some protection in place
and if you really want to go beyond as
you give give Amazon a call or small
request I'll increase it for you
refactoring is really important right so
refactoring with you a lot of these
tests we want to improve our tests all
the time right our test inputs and
outputs we want to spin them up in
memory wanna test edge to edge if your
functions are really small you can
create lots and lots of really good
tests that don't couple directly to the
code itself but
test the behavior right and actually you
always improve and design a code design
as well because your behaviors kind of
protected by the inputs and outputs of
each function so this is what we did
with the customers basically their each
customer was able to interact with this
file slack we gave them feedback we move
to physical boards so we started with
the you know JIRA and in kind of the the
agile world we found that physical
boards a lot quicker and whiteboards
so we put a car there and the Kanban
model with love features little features
that go all the way to production moves
it keeps us moving really quickly right
so physical boards are wholly
recommended you have to be on call for
the software you build so we kind of
instill this that every person who
writes the software needs to be on core
operations side of it monitor the system
to go frana
look at Google our links as well and you
find that you learn a lot from
monitoring your system in production
because the customers use it and this
next bit we actually hammer the system
in production so you can leave your
production data you know code going and
then maybe performance test it but the
best performance test is how much the
system when the customers are using it
right because you find hot spots there
right your monitoring will pick things
up right when you release every time
that you could have never picked up
right if you if you didn't if you had
natural traffic right we do brown bags
book clubs I think you've got to create
that environment of learning and making
little experiment little little mistakes
and it pays off right so this is from
you know the the keeping things lean
Eric Ries this book Alex Aman Turing I
can't say more about that you kind of
continuously learning yeah all the time
you spinning up functions if you I think
we're deploying probably almost every 10
minutes right
a function goes out and adds more value
to the system
we kind of facility the environment for
you innovating so you know all the
developers actually feed into each
experiment and we go feature toggles so
if you write something that's not going
to be visible we still deploy it to
production we just toggle it off you
just make sure that your code always
keeps on going all the way to production
even if it's not visible in production
at that particular time it's actually
going out because you're actually
changing the system so we've got frigid
feature toggles that total things off in
production so deliver value continuously
what service gives you it brings stacks
up in minutes so I showed you that
features each end point each a lambda is
is its own kind of stack and you can
actually add features really easily and
you can tear them down what we do in our
dev environment is when developers go
home at 7:30 we tear down everything at
around 8 o'clock
yeah 8:00 8:30 the whole environment
comes down this Devon obstruction yeah
and in the morning at 6 o'clock the
whole environment comes up from scratch
right everything including the lambdas
and we ingest the data again and this
does this happens every Monday to Friday
and it helps us find problems as well
and it also helps us exercise the fact
that we can actually spin things up
really quickly if you want a new
environment is really easy physical
Kanban board is amazing right we it's
like those cards allow us to work on
little things if you write very little
on a card you know that feature is
defined by that card there's not much
you can get on a card and this does
little bit kind of flow really quickly
small incremental changes in production
keep on deploying to production yeah
don't keep sale code that's service kind
of teaches as that each function is
really small if the deployment takes a
couple of seconds why not and we do a
lot of pairing more programming I'll see
our pattern is very similar to everyone
you know we basically do little things
which are different we test in memory so
we will spin elasticsearch in memory we
will test things against you know things
like Lassiter we can use dynamo dynamo
light or Dynalite to spend dynamic
DynamoDB in memory testing their energy
in the ajob world it's even easier you
go like yes DK helping you there you
can't spin up lamda I'm going to show
you spinning up a lambda in memory
deploying the dev is cheap we've got a
cheap environment that costs nothing and
then we run accept incense and smoke
test at the end right and promotion so
quick demo right so I thought what could
I do
as a demo we should be exciting so I
kind of came up with this let's go
through this something related to this
so I did wines and bottles last time I
was really exciting I thought let me
take the NDC of the website because the
website doesn't have a search function I
really want to find things I always
actually scrape the website save to s3
every time as three I have a lambda
listing on s3 right that will basically
what we'll do is actually create
populated search index in algo Leah and
I'll provide a little react application
all it does is handles queries algo Leah
right so I spun this up in about two
hours I apologize for the day I you I
I'm gonna you a sec expert so I'm going
to spin this up so p.m. run so I've got
I'll spin this up locally has a dev
environment let's go to so I'll start up
on port 8080 right let's start here
and we'll go through the code in a bit
so this is what I ended up with right so
this is kind of querying my index right
it's created a couple of facets right
you can see the facets here these all
come from this website so I scraped NBC
Oslo so let's go to NBC oh so calm I
hate hit agenda and I went through all
the talks and I drill down into each
talk in my lambda right and I created a
populated search index so in here I can
just type in Raj and it homes in on you
know Raj finds me
maybe Damian right Damian gives me the
time I can click when I say I want to
basically see all the talks of Wednesday
gives me a nice little interface that
allows me to find fine talks and I built
it for myself I thought you know be
interesting to demo this and show the
code so how many lines of code do you
think this took including the lambda and
the react app 200 lines of code right so
let's look at this so I have two lambdas
here right and an exporter that exports
the data from NDC özil agenda into this
bucket here so this is how I declare a
lambda right this is my exporter that's
my handler memory size timeout 60
seconds where you get five minutes max
and that's my ura I want to scrape I'll
show you the code in a bit this is just
the declaration this will get pushed
from the deploying point of view this is
my indexer so here I'm saying when you
get an s3 event from that bucket I want
you to call this lambda and when you get
this lambda this is the environment I
want you to use I don't know why is the
agenda here that's better bugged but I
have a key that talks to algo Leah algo
leah is a free kind of ter search I'll
show you what I'll go Leah looks like
and an API key and my lambda will get
cold every time I scrape a page from NDC
özil and put it into the bucket
I have only given permissions to these
lambdas to just list things in s3 and
put things in s3 so you can see that the
permissions model is
on each function so what does the lambda
actually look like right so let's look
so that's the handler so handler Jess
let's expand this okay so I have two
functions one function says write get
the tox bucket which I passed in as
environment yeah
extract from the talk extractor from the
site on that URI
every talk I get back yeah save it into
the bucket so this lambda all it does it
scrapes the site and writes it into the
bucket that's all it does every time I
range in the bucket this lambda gets
called so I get an event records map so
I get a list of Records yeah and here
what I'm doing is basically mapping each
record right looking into the bucket and
then going in the index index from the
bucket okay so I'm going look in the
bucket and actually get the data and add
to the index and that's about it right
so what happens is if I console.log this
lets let's push this right so
console.log this I won't try this on
this is made up now
let's see what the event looks like okay
so I'm going to stream by that vent I'm
going to push this so let's go in here
I'm going to deploy that lambda all
right so so gob deploy I've got a couple
of cut-offs that maybe not in there cop
deploy here yeah
oh sorry yeah thank you very much it's
like whoa so that's going to deploy my
lambda and all it's going to do is push
into AWS we're going to look into Ariel
yes these are my two lambdas I've got a
exporter and an indexer and the indexer
basically looks like that those are my
keys of view and I've got the runtime
tells me no Jess these are the wrong
times I have I can pick any language and
this is my trigger which is s3 every
time I get a got something in that
bucket my lambda is going to get cold
right and I got monitoring for free so
you can see I have monitoring here and
if I go to logs cloud watch right
I have logs and card watch for that if I
look in an old log you'll see that
there's no logging as such just tells me
it took this long and this is how much
can get billed for so one way I've just
added some logging here I'm going to
just deployed it so what I'm going to do
I'm going to NDC discovery that's me
lambdas there if I cap serverless can
everyone see this by the way I'm sorry
it's the talk sorry yeah these are my
lambdas if I Kat service sorry all right
that's my service lambda I'm going to
expand this a bit and I have two lambdas
which is the indexer an exporter I'm
going to kick off the exporter locally
in memory so here what I'm doing I'm
just going to find service command here
I'm just going to invoke the function
exporter give you the stage Oslo in the
region US EU s1 okay I'm going to kick
off that lambda that lambda is going to
go out and scrape the end if yours the
website again right I'm running so it
runs on a schedule that should trigger
my lambda and it should actually every
time it writes into the bucket I should
get something into my indexer so
hopefully if so in vacations
occasions let's come back so it saves
those talks into into the bucket and if
we go into the cloud watch console so
that was 1547 which is now phallic in
here maybe bit earlier you will see yeah
there's my head look so this is the
event that comes from s3 and you can see
that actually lambda gives me that and
based on that information I can make
decisions okay so that's my logging and
your logging for free this is free
logging right all I did was a console
log okay so which brings me to the end
I'm going to basically one more slide
which is this time to build two hours
lines of code 230 lines I the react side
is this one page free auto-scaling
high-availability
it scales zero cost I put in here
two million requests per month per
lambda and I got 40 cents per month I
don't think you're going to call it two
million times right so forty cents per
month for two million calls by lambda
and our Golia is ten thousand indices
free so all that application was for
free it scales out
yeah and it's two hundred and thirty
lines of code right and there are some
challenges lambdas take time to wake up
you have to keep them awake right the
first time they wake up you have to spin
up container it takes a couple of
seconds we've seen four or five seconds
and then milliseconds after that right
it averages out we basically help check
our lumps that lambdas keep them awake
and then n2n debugging is a bit of a
nightmare sometimes but if your test and
you spin them up in memory that kind of
negates that to some extent they also
Amazon a release x-ray that basically
looks into tracing into your lambda
functions and provides kind of a fewer
for all your lambdas right so that's it
guys questions I hope this was useful
please ask questions right the shawl
looks very similar to this I didn't
cover as
in fact zero but it is actually the same
concept yeah thank you very much well
any questions yeah sure yes I did yes
but it's not you know limited service
framework so what I do in in Bacau calm
I have of one repository where I deploy
using server less into Azure functions
and into AWS lambda so serverless
framework gives me that capability to
work across cloud providers and one
thing I didn't actually show when I push
that lambda this is in the question side
of it so you'll see I have CI pipeline
that basically builds things in the
background so these are my lambda
projects for Bako this is the new one
the NDC or the one every time I push
code in here it deploys so I would CI
server for my 230 line code that
basically triggers and that's just one
liner so server list gives you that
capability which is the server let's
frame up side of it so service framework
gives you a loss nice little tools
around it spinning up in memory pushing
into you know a SS or ratio in a
platform agnostic way it's very nice so
you have some differences as your
functions have a different concept so
let's say who's who's an azure developer
here okay I've used as your functions
right so my here one of my usual
functions in Bacau is one-liner right
and all it does is return data from
table storage right so my liner from
table storage says get the data and
return the data okay in my bindings
Jason I say called this function from
table storage and from an HTTP call so
when I'm a PHP call
I get a table storage leg records at the
same time I get bindings so one concept
that's missing in edge of this lambda is
the concept of bindings where where I
can say you know tie this to this and
when I in a belief lambda when I write
to an s3 bucket I do have to write that
infrastructure code there is that in a
row you don't you just put the lambda I
put and then in the binding you say take
this output and put it into table
storage so you don't write that code
either
so there's another concept in there's
your functions which is really powerful
called bindings and it gives you more
power and but they are good at little
things each of them so a double slam
that gives you some good bits as your
function keys gives you a lot of good
bits welcome so the original database is
going to go we are going to basically
convert that to DynamoDB as a single
source of truth plus s3 the the problem
with the all databases so when I go when
we solve these databases so these are
sequel databases that you know handle
all those queries when I terminal
service on to this box right if you have
an open process manager and you look at
the CPUs this thing you can't see the
gauges there's so many CPUs on this box
to handle the sequel databases and a
load that they've reached the limit on
those boxes and they want to move them
to AWS but it's a tough job so
eventually these sequel databases will
go because they don't actually they are
very legacy and linked to the java
application so they have a Java desktop
application which they run it's linked
mainly to that we're going to put in a
lot more machine learning put in a lot
more kind of ways of authoring the
content which is using services again so
we don't have to build it and it
provides a lot more value than the java
application build you know 20 years ago
so they will go yeah understand they're
not they're gone at the moment they're
still there we could transition them off
exactly yes so there were some other
databases that in the pipeline we go to
the source of truth which is the actual
database now we're going to rewrite the
bit that manages so2 source of truth so
we've written the bit that makes money
so this is the end users then the
internal application which is the
internal optical users with tackling
that as a second step yes we are
yeah we are yeah any more questions
oh you sorry
um it's a mind shift this so I presented
like the process flow mainly for the
developers because to be honest it's you
got to be thinking in the lean way so
have a look at modern agile
I think I'm not you know I put that
there mainly for the developers to show
that agile moved on you know you know
it's not the the kind of agile we new
people still follow the the old kind of
approaches but modern agile have a look
at that use that as a basis for pushing
some of the learnings lean startup read
the Lean Enterprise book what we've done
is there's a new book called DevOps
handbook by J's humble we started kind
of reading that within the team and you
know you get everyone interested from
developers to kind of some of the kind
of guys business guys and as you work
through these books and learn more about
how things work things automatically
change it's all knowledge right so but
yeah it's you look at modern agile and
read lots of books within the team
it helps questions
yes so there are cases where you do have
to maintain state like a workflow maybe
is that were over so each of those
environments have the ability to to
transfer a kind of a workflow like
system so it'll be SS step functions
that crew allows you to create a little
workflow and call lambdas and manage
that work flow through lambdas so you
can do things that way you can save
stake in the data area in a datastore in
s3 we do that for our Kinesis
so Kinesis is a kind of a stream some of
that data is so huge it's megabytes you
know connect clinical data can be big so
what we do we don't pass it through the
queue we just save it on s3 and pass a
key on the other side we get 5,000 keys
at a go we go back to s3 pull the data
out which is megabytes right and then
write them into the elastic search or
write them into time ODB whichever so we
want to write them into and you can't
write some state step functions allow
you to a little workflow and is
equivalent in Azure but I really
designed really small functions and keep
the state in the client thinks that's
possible I'm sorry it's a that's a so we
went through lots of iterations of that
so we one of the iterations was we
looked at the this what we sent on the
wire so before we push into Kinesis and
we saved the hash of the jason that we
pushed and every time we compare we got
the data back from the database we
compare the hash and then we send
changes if there were changes or if
there were and then we move to more like
database specific changes so so change
tracking in within the database when
things are written you can query
Selin change tracking database in sequel
server and tell you what's what changes
have occurred yeah there's many ways
it's very hard with sequel because
sequel is set based and you want to
convert into events the new system that
we're going to build
is not going to be it's going to be more
event based so what you're going to get
out of the content authoring side of is
here's some content that's changed is a
new clinical trial is a change to a
clinical trial those events will go
straight into the case into the stream
the old events will just come from the
database and hopefully that that whole
system will become an event based system
so I hope that answers it it's a it's a
challenge with sequel but you can do it
you can query the database and you can
save hashes and do changes the
old-school way which is what we start
off with and then you can ask sequel to
give you changes I'm sorry sure oh no no
sure sure if the problem is still
procedures was you can't test them right
so it's very hard to to test out
procedures right I remember going
through a whole journey of testing so
procedures with my man right but this is
testable code and it is code that you
write so when you in your let's say you
want to interface with machine learning
it's Python isn't before language you
got the choice of language is code right
the events themselves the advantage you
get is the scale so if I if I scrape all
those talks in NBC at once unless the
NDC had thousand talks and I hope and if
she gets that big right you would get
thousand lambdas in parallel right you
and you don't have to worry about scale
with a database you have to worry about
that
each lambda is stateless there's no
state so you don't have to worry about
that you can test each bit its
predictability right and I think
database was very close to database if
you have lots of requests with the
problem with ISO procedures is that you
can't take a slow procedure out from
sequel and execution or a different
machine it has to be executed on the
sequel box right yeah that makes sense
so if I call loss stop sieges that same
Socrates is actually executed on one
single box and
a box only scales vertically but with
lambda it executes anywhere right and
the advantage you get is that you
actually can write test run a lambda
code so in some extent you can visualize
your system that way if you're
visualizing your sequel system as events
that's a good thing to be honest but is
all about event based programming for
questions so I'll be around to ask me
questions guys is your functions Google
Cloud functions and if you're
interesting you know using this very
startup as well I can give you a lot of
tips yeah I've been through some Jenny's
thank you very much guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>