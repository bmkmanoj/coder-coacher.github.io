<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Extending and Optimizing Xamarin.Forms Mobile Apps - James Montemagno | Coder Coacher - Coaching Coders</title><meta content="Extending and Optimizing Xamarin.Forms Mobile Apps - James Montemagno - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Extending and Optimizing Xamarin.Forms Mobile Apps - James Montemagno</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iUkgBfBrnmA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right awesome so I have so much
content I want to get started right away
because my first time ever doing this
talk and it's so much goodies I was
actually really excited I knew is going
to be a good session when I got excited
putting together a slide deck and all
these demos and like things actually
worked and I was like it's going to be
awesome so many of you today are
developing with xamarin in general at
all mobile apps cool viewer how many of
you with your hands raised are doing
damron native developments like iOS
storyboards Android XML few of you and
xamarin forms close going to be a little
bit for everyone I'm going to focus on
xamarin forms I'm also going to talk
about some futures and some really
exciting technology that's coming down
the line for this fall so a lot of what
you're going to see today is available
today whether it's in stable today in a
pre-release and nougat and then some of
the stuff at the end I'm going to talk
about which will be coming out this fall
I'm so excited about it I put all the
code all the slides that are all in that
link I was like I'm going to put it
right in the beginning this time instead
of at the end if you're on my talk
earlier today it's also on that
SlideShare and on my github as well and
I put links to everything already so
you'll have everything you need
so I'm James Vaughn - magma I'm a
principal program manager here once I
want to take another picture you can
take a picture those pictures Victor's
going to take the pictures there you go
it's just my name - that's the easiest
part all right a few more and good to
late I'm James Monson Magnum a principal
program manager at Microsoft I worked as
a Merrin before that for nearly three
and a half years and before that I was
actually a customer of xamarin for two
years at a small start-up building all
of their mobile applications for iOS
Android and Windows
I joined xamarin four years ago because
I love the technology I love the ability
to create great native applications and
the tools that I loved and the best
programming language ever created
c-sharp I live in this bright sunshiny
city of Seattle Washington where it's
exactly like it is outside today all the
time where I drink all of our coffee
which I've had about four or five cups
here in Oslo today and it built great
mobile apps this is what I love doing I
love my city I love coffee and I love
apps and often I'm talking about all of
them at the same time
so so we're gonna have some bunch of
cool demos today a bunch of different
applications if you have any questions
at all at any time feel free to reach
out at me that's my direct email goes
right into my inbox I swear it's right
there that's my blog and that's me on
Twitter and github so if you have any
questions just google my name and these
are all in that slide I guess that
earlier if you want to hear more from me
after NDC and I travel all the way back
through right kvitko all the way back to
Seattle you can listen to me every
single week on a podcast I do called
merge conflict which is super cool and I
also have a show on channel 9 called the
xamarin show that when I came up with
myself because I'm real original titles
the show about Samer
it's actually really cool we have people
in the community come on talk about
stuff that they're building and a bunch
of new stuff internally that we're
working on so be sure to check out that
stuff I also have a bunch of stickers
and stuff down here please take those at
the end you don't call them right now
but at the end cool so if you're brand
new to zaman which a few of you are we
have this great approach what we call
xamarin and xamarin natives which
enables developers to build out a shared
C sharp business logic base for all
their applications your models view
models restful service called sequel
integrations azure integrations things
are the same that are just net code
because we have a dotnet runtime that
runs superfast on iOS Android Mac and of
course Windows so traditionally you
build out separate user interfaces with
iOS storyboards Android XML and windows
Amal this is what I fell in love with
six years ago when I started with
xamarin and if you're looking for super
optimized like sub to second start time
and access to every single control and
everything like that this is amazing and
that's where you want to be so so
there's tons of applications today that
are building up these native user
interfaces using that shared logic which
is around usually on average 70% of all
code in the application but developers
kept asking us over and over again for
some way to share even more code or
perhaps write the user interface just
once but not lose that xamarin native
goodness and that's what xamarin forms
comment comes in it enables you to build
a shared logic base but also a shared UI
code base on top of it and what we did
is we abstract
things that were common across iOS
Android and Windows into a common zamel
markup so you have a button and well
it's a button in the sam'l when it
actually gets rendered on the page it's
still a native UI button Android widget
button or a button over on Windows so
you're still getting access to that
native capability but it is a framework
so there's obviously a little bit of
overhead that you're going to have there
and also some implications that you're
on this layer on top of a native layer
but we didn't want to lose that native
goodness that's why I kind of fell in
love with Zam reforms because I was a
sam'l developer myself so data binding
and navigation all came natural to me
what's cool here is that no matter how
you're building was amethyst mines amber
and 101 really quick is that
everything's included and everything's
open source including xamarin forms when
Microsoft acquired xamarin we made
everything free included in your visual
studio subscription and we open-source
everything under MIT so you'll see even
see some statistics today about the
contributions that have been made to
xamarin forms from the community so it's
great there is that if you want to
change some stuff in xamarin forms you
don't want to wait around for us you're
going to simply pull down the source
code building yourself and have your own
custom build as a more forms
there's tons of companies that are
taking advantage of that today because
they want to do some crazy custom stuff
that we're probably never going to pull
into the into xamarin forms so you can
build everything in Visual Studio I'm
going to for PC or Mac I'm going to be
doing everything kind of impulse with
some demos in both today and xamarin
forms my brief 101 overview for anyone
that's coming in as I talked about that
shared code layer of when you might want
to do the traditional or xamarin forms
and what you can notice here is that
that shared c-sharp logic is still the
same so my models view models Russell's
service calls are the same it's just how
much of xamarin forms you want to opt in
for there's a whole bunch of goodies
that we're going to talk about today
there's pages layouts navigation data
binding animation a bunch of services
built into it there's tons of pages and
layouts so you can decide between master
detail navigation tab controller and
different ways of laying out your
controls and then of course there's
great controls what we're going to talk
about today is not a 101 session this is
the 5 minutes of 101
we're going straight into the deeper
dive of what xamarin forms is capable of
and some of the new technology that's in
there this is the stuff that's in the
box but you can always leverage and
create your own and we have a great
ecosystem of different partners such as
sync fusion DevExpress and telluric that
are creating great controls for your
applications so at a high level if we
are looking at a xamarin forms
application there would be a bunch of
sam'l it's like a login page or have a
stack layout two entries and a button
and while it's all zamel it's just
against the xamarin formed schema so the
sam'l looks the same because it is sam'l
but some of the controls and properties
are different so we're seeing is that
we're inside of a tab page so I get iOS
tabs with icons on the bottom Android
with material design and a Windows 10
application so the application that I'm
going to be optimizing extending today
is this weather application I use it all
the time and I love it because it's
simple but we can make it real complex
real fast
so this is the same application running
on all three platforms and I'm going to
talk about the shared code and then
we're going to optimize it so it's
inside of tabs so here I've already
searched for Oslo so I have my weather
that's coming in here I'm tethered
against my phone so we'll see how this
all works I have the forecast here and
if I come in to my iOS simulator and
type in Oslo Norway and we'll use metric
for every one they get whether they
should go out grab our weather and it's
yeah thirteen point eight three I can
get my forecast here and I can see all
the forecast that's coming in very
similar to Seattle actually we can see
12 and rain very similar so there you go
we're the same so this application was
all built-in xamarin forms I'm going to
talk about the structure here so what I
have is something very similar to any
xamarin application here I'm using a
shared project you could be using a PCL
or a dotnet standard library I'm a big
fan of shared projects so this is all my
shared code so I've sells controls
helpers interfaces services views and
view models and my full app it's not too
complex I just have I have this weather
service here that's going to go out and
I use this open weather map API to grab
some JSON deserialize it into this
weather route and then pull it in
whether it's the city or GPS that I'm
pulling in I also have a view model here
that's going to go out and has this
weather service and some data binding
for location to use GPS if I'm Imperial
or not I'm using some plugins so I can
automatically save the Imperial settings
the temperature things like that and
then I go out and I decide if I want to
use GPS and actually use another plugin
for xamarin to get the geolocation or
just enter the location here and then I
use some c-sharp stuff to format up the
text now everything that's happening
here is I just have it basically in a
tabbed page where I'm creating my new
weather view model and two views nothing
crazy
and I have my weather view here my
weather view I'm just stacking
everything I'm a big fan of stack
layouts and putting stuff together I
have an entry here what's kind of unique
about that is as I toggle it's not that
one they use GPS this enables and
disables automatically and what I'm
using is a newer feature called triggers
so what I'm saying is for this entry box
listen to this trigger and when this
trigger happens do something to a
property so what I'm saying here is
whenever this data trigger happens which
is a binding to the use GPS whenever
that changes back and forth
set being able to fall so when this is
true set this to false and it will
automatically do the reverse so I don't
have to set up additional data bindings
or anything like that I can just
actually put that into my code which is
kind of cool I have a few other stack
layouts in here such as a label and a
switch some buttons in here and I have a
stack layout that's going to put some
padding around this activity indicator
for me that's my base and I also have a
forecast view here which is going to be
a list view of different items I have a
little bit of platform customization
built right into the zamel to do on
platform so on iOS the the separator
color is transparent and then I just
have a view cell where I'm stacking up
an image stack loud and a few labels in
there so that's the base of what we're
working on today so let's talk about
some stuff that's built into xamarin
forms that's awesome you may be using or
may not be using today there's a lot
built in there and the first thing is
compiled time zamel all the zamel
traditionally had to be parsed and
inflated at runtime this was how xamarin
forms was first kind of created in fact
when it was first created many moons ago
and zamel didn't even exist but everyone
wanted zamel so we added sam'l so what
happened here is that we wanted to
actually make sam'l faster because
parsing it and inflating it at runtime
is slow and also that means it also has
to bundle in your entire sample into
your application so we added this thing
called compiled sam'l or sam'l see
you'll often hear it which parses it and
turns it into an intermediate language
into il that can automatically be booted
up super fast in the runtime this can be
turned on at an assembly level here we
can say sam'l compilation compile and
that will do it for our entire assembly
so anything that's in there so you could
have multiple assemblies and you can
choose that on each assembly this is an
opt-in a compilation flag I've been
using it since it came out I've had no
issues really it's come along quite a
few long ways but you can also do it at
a class level so that means if you have
a single page but maybe it's crazy
complexion using tons of custom controls
and all this other stuff you may want to
skip it
so if you skip it then at compile time
that zamel will still be put in to your
application
adding compile time sam'l does a few
things for you which I'll kind of
highlight it does some error checking at
build it'll obviously reduce your app
size because your sam'l is compiled and
your app is faster in general just by
one single flag there's a bunch of other
stuff built in a lot of people always
want to use these crazy ioc containers
and dependency service and add all these
crazy nougats
you don't have to because it's built
into xamarin forms we have a dependency
service that's super optimized and
xamarin forms uses it itself it's really
nice so essentially when you want to
reach down into native functionality for
iOS Android or Windows you can simply
use the built-in dependency service and
I'm going to demo a bunch of these
features in a row we also have a
messaging Center to do pub/sub so here
for instance you could send messages
across the wire from one page to another
page or from one view model to another
view model this allows you to
essentially loosely couple your pages or
your your data or maybe have your your
actual iOS core application talk to your
xamarin forms page and cross
communication this is built right into
the box so there's nothing else that you
need to do and it's optimized for
xamarin forms so here for instance I can
subscribe to messages which is based on
a string so this add new and whenever
that happens I just give it a function
that will be executed so on the details
page I will send a message with an
expense and then that will get triggered
back into my master page so I can add it
into my expense list when you have
really complex parts of data we have
these things called data templates so in
this example of these monkeys that are
chatting normally you'd have these of
this ListView with all these different
cells and you might try to shove a bunch
of logic in there so well if it's the
receiver then make it blue and data bind
to this color and then shift it to the
right or hide things and collapse things
so data templates allow you to optimize
your ListView and have multiple cell
types built-in that
our super optimize and I'm going to demo
all this additionally I talked a little
bit about this earlier is the platform
customization so being able to come in
and for any property say if you're on
iOS Android or Windows to automatically
set different properties and
additionally you can do this on phone or
tablet or desktop you can say on idiom
so on idiom gives you the different
aspects so let me show you a bunch of
these different features I'm going to
point out a few things as we go through
some code so the first thing I'm going
to do is talk about how to actually
improve this so the first thing here is
is the main application how can we
improve it so if you have a legacy
xamarin forms application you may not
have upgraded to the latest app compat
so this is on by default now but we can
see I get material design material
theming and I get that because I went
into my Android application and I
inherited from xamarin forms app compat
activity so there's kind of two flavors
of Android with xamarin forms there's a
forms activity in a forms app compat
activity there's a few resources and
style that you set up but that will
essentially Navy you to get this
actually super nice app compat it's all
fragment based so actually just turning
that under your application makes it a
lot faster so that's one thing I didn't
kind of highlight in slides but it's
there what I can do up here actually is
we can notice that I have this assembly
export of compile so that's that sam'l
compilation so if I actually just say
skip on here so one flag
I have this in my shared project so it's
in everything but what's nice here is if
I come into this application and for
some reason and my weather view is going
to drag it over here I spelt padding
wrong and I'm now if I come into my
let's say iOS application and I build it
again I've spelled padding wrong but
when I build it no sam'l compilation or
anything is going to happen on this
actual application so when it builds and
compiles it's going to tell me that
everything
is totally fine and working just great
the problem there is that when I run my
application since there's a typo in my
tamil that's going to crash because it
won't be able to find this padding so by
turning on the sambal compilation flag
which here I can actually come in and do
it on just a single page so if I put it
above this class instead of assembly I
can say zamel compilation here bring in
the xamarin form zamel namespace and
i'll say dot compile now when I come in
and I compile this up just for that view
we should see that I should get some new
errors I'm going to pin this out there
we go right there so to say no property
binding of padding was found at all and
I've been able to turn this on and
essentially find all my crazy typos that
are going on and as soon as I fix that
boom it'll be good to go of course you
probably want to turn on the assembly
level see how everything's performing
and then kind of go from there so that
will build up everything successful when
the error goes away so let's go ahead
back into here and we'll go ahead and
turn on the whole application so it's
nice and fast
there we go and compile cool so other
little tiny things so some parts of this
code that I've optimized are actually
the ListView so inside the ListView
there's this hidden flag called caching
strategy caching strategy was added
quite a long time ago but it's not on by
default so how would anyone know about
it that's a great question so a lot of
these things eventually we're going to
make just on by default but a lot of
things are still opt-in so caching
strategy has two different types of
properties that you can set one is
retain element which is the default and
this essentially will create a new cell
every single time as you scroll so if
you're like dang it all my list views a
little bit slow and laggy why is that
well it's because retain element is on
when you go ahead and toggle it to
recycle element this will cache all of
your cells so it will measure the screen
sylars 10 cell so it caches tensou
it will automatically recycle all the
data bindings and that cell for you with
the xamarin evolve conference
application that I built that's open
source by turning on this one flag for
all my beta testers I did a trial and
error cause like how big of a difference
does it make
so I turned it off by default and the
first thing that our MVPs told me write
this one list when I go like this really
fast it's a little bit slow and I go
well no one's going to use it like this
and they're like well we're going to use
it like that because we're going to see
how good of an app you made and I said
okay so I turned it on and everything
was super butter smooth so does that one
flag is super-powerful when you're
actually using your list views to
optimize them I talked a little bit
about data template selectors so here
for instance this ListView just has a
item template built in so what I've done
is I said well wouldn't it be cool if
it's raining maybe I'll make the black
background blue and I'll put it on the
right-hand side and I'll change some of
the different colors and properties what
I normally have to do is shove tons of
stuff in that view cell and say is it
raining and then show this thing is it
not raining hide this thing and do value
converters and all this stuff so what I
did is kind of like that monkey chat
application is I created two cells
I took the exact same zamel and I put it
into a view cell so it's kind of highly
review usable and I put it into a grid
so there's grid column definitions and I
have the same things here for the
display temperature and the display date
and I created another one called my rain
data template so here I have a different
background color for it I have a display
icon and I set different text colors and
properties for this actual view cell to
set up the data template selector is
crazy super simple so what I do is I
create a little class this weather
template selector and I inherit from
data template selector inside of here I
create two private read-only data
templates which will be initiated for
the first time right here
let's say create a new data template of
this type and this this template this
template type knows that it's a cell so
when I go to definition it knows that
it's a view cell and then there's one
method that you override which is the on
selected template so as it's scrolling
through your list it will automatically
call this method it will pass you the
object that is being data bound and all
I do inside of here is I say if it's
rainy return the rain data template
selector if not return normal so now
back inside of this animal here what I
can do is I can actually delete this
entire item template here I'm going to
go up into this content page I'm going
to add a few attributes up here the
first thing is I'm going to need to get
access to it so my namespace is my
weather dot cell it's in the my weather
assembly here I'm going to add a Content
page resource here so this essentially
says for this page I'm going to use a
data template called my weather or
called weather template selector and I'm
going to give it a key of weather
template selector so what's unique here
is that I'm doing it at the page level
yes I could suppose that I could expose
it in my app saml and I could expose
everything in my abs amel but then
you're going to have a slow startup time
because now you're having this huge app
saml that gets loaded so only load
resources when you need to so now what I
can do is on the actual ListView I'm
going to add an item template and set it
to a static resource of the weather
template selector so now when I rerun
this application with just those few
modifications as a compile times amble
on I'm now using this new weather
template selector that's built in on top
of here and we're going to build it up
and redeploy it on to any of the three
different platforms so here I'll just
redeploy it on iOS here give it a second
to launch
pop-pop-pop-pop
so if they get weather so now when I go
over to my forecast view now we can see
that I actually have the different
templates that are being selected
automatically right here and if I come
in to my selector and I actually put a
breakpoint here I can actually go down
and start scrolling a little bit on this
page and I automatically hit that break
point where I can then inspect to the
actor actual weather route that's coming
in so you can still debug this all that
data binding is happening and I'm
caching all these cells automatically in
that data template selector it's
obviously little Oaks I'm tethering via
my phone here so it's a little bit
strange normally not my at-home setup
but it's what was working this morning
so I can actually see these different
bindings coming in in place which is
really cool and I just have to change a
few lines of code to optimize it well
it's nice here as a added bonus is that
I've now break in these templates out of
that zamel right so I could then reuse
them elsewhere into my application kind
of reducing my app size so now they're
highly reusable view cells and I find
that if you look at some of the apps
that I've built I have a lot of view
cells that I'm just reusing in different
pages alright let's talk about a few
other zamel optimizations and the first
thing I'm going to do here is come into
the sample and I mentioned I have a lot
of stack layouts but all these stack
layouts are actually causing performance
issues on startups of this application
because what has to happen is I have to
create a full layout add this create
another layout that's inside of it put
down multiple views another layout and
I'm stacking up layouts inside of
layouts inside of layouts in fact you
can see inside of here I'm only using a
layout to add padding around that actual
thing so the first thing that we want to
do is this is silly that's terrible I
know I have old code littered everywhere
because we didn't have one property
called margin and now we have margin and
now you can add margin to any single
control so if you have a zamaron forms
application where you have padding for
no good reason because we all do it's
okay start adding margin and that's all
you
need to do it'll totally fix it but it's
still not good enough because I'm using
these stack layouts which we all want to
use because they're super easy but what
I really should be using is a grid so
actually at the grid code here I'm going
to talk about why this is way better
here so I'm going to go and copy this
code up and delete everything boom and
do it here so the grid in xamarin forms
is super optimized because it's a single
layout that I can then host multiple
layouts inside of by default everything
can be set to auto Heights so it will
automatically configure it for me or of
course Auto expanding Heights here
what's unique is that it's still all the
same elements and controls that I had
earlier but I can now specify what grid
row grid columns a grid span if I want
to go across and you can say well James
I see that you're doing something dirty
because you have a stack layout inside
of this other one and you just had one
before and yeah if I wanted to further
optimize it even more then I would add
additional rows and make these all auto
inside of here but I wanted to group
these all together but even putting
inside this one grid I've removed about
three or four different layouts of this
application so we're not using a grid be
aware of trying to look at that first to
actually start optimizing your
application so recycle element caching
strategies sam'l compilation app compat
using a grid using margins and here you
can use the same margin and thickness
everything here boom good good good good
what else did I talk about on their
dependency service the dependency
service allows you to reach down into
the platform specific code for iOS
Android or Windows so you don't need
your own dependency service or any IOC
container everything is built into
xamarin forms and everything is based on
interfaces so everything is super nifty
so let's say I wanted to create some
toast and a little pop up that maybe
doesn't interact with the user interface
so here I'm going to specify an i toast
and inside of here I have a simple
method in my interface that's called
make toast
so I'm just going to do this on one of
the platforms you can do it on one or
all of them and we go ahead and do this
on Android because I know there's a
toaster inside of it you can go into my
helpers and I have a toaster here I
think it's funny that I called it a
toaster and I implement the one method
called make toast so what I can do at
this point is I can come in and I can
say VAR I'll grab the context and I'll
say forms the context it always has
access to the current context since I'm
inside the Android application and I can
actually cast that as an activity so
it's always in activity there we go
and what I can do now is I could simply
say contacts dot make are the toast
or Madeira
has activity contacts activity I'm silly
toe stock sometimes you do xamarin forms
for so long you forget how to do
anything so make text there we go and
I'm going to pass in my context which I
guess didn't even need to be Mac tivity
so we don't have to cast it that's good
save some stuff there and then what I
can do is simply pass in my message and
then what I'll do is I'll say toast
length dot short now what I can do at
this point is I've implemented this
single method here I can come up and use
this assembly export and say dependency
and this dependency I'm going to go
ahead and zoom in for everyone's I like
zooming this dependency here is a
xamarin forms dependency and it takes a
type so I'm not really necessarily
registering a interface but I'm reg
ain't doing type of toaster here of my
class and what this will do is that
startup when it registers all the
dependencies it'll see all the
interfaces that I implement and then I
can go and grab it now if you don't want
to use this assembly export because you
like James I don't like that what you
could actually do is come into your main
activity here and you can say dependency
service dot register and then you can
pass in different properties here of the
specific type in implementation so here
if you want to be very verbose you can
say the the type here would be I toast
and then toaster for instance and we can
bring in those specific namespaces my
interfaces and there we go so if you're
more in the vein of only registering
certain dependencies you can do this as
well where I'm explicitly doing it for
the interface I'm going to go and leave
it on the assembly because I just do it
cuz I think it's really easy and super
simple to use that a export and then
when I want to use it here I can
simply come into this weather view and
we'll just say I don't know something
silly like on appearing and what I can
now at this point say is do I have a
toaster
so toaster and I'll say dependency
service dot yes and I'll give it the
interface of I toast toast there now
it's unique about this is I'll go ahead
and bring in this namespace is it asks
us for this dependency fetch and by
default it's global so it'll only create
one ever you can also set it up to do a
new instance every single time you call
it but we'll leave it in with the global
instance because I only want one toaster
anytime so since I've only implemented
on one what I'll do is also say toaster
dot and I'll say make toast and I'll say
hello Oslo here we go cool so now I'm
reaching in and I'm accessing some
xamarin or some Android specific
capabilities of this application without
having to do really any work at all I
just specify my interface which is now
going to be testable I can make sure
that this is registered with my
dependency service and then I can go
ahead and redeploy it over here on my
Android device so give it a second to
recompile and redeploy there we go
and ideally what are the wrong
to steer oh I know what I did wrong I
didn't actually show it smart
dot I'm glad that no one told me
appreciate that dot show and that we
should run it like a Android there we go
just to prove that it works there we go
such until I work and
I don't know I have a break point up
here expounds going to go away there it
is perfect absolutely there awesome
so I'm reaching in getting some native
functionality without doing a lot of
work and that's what's super important
so that's just stuff that's kind of been
baked in for a little bit but then
you're probably saying well James I've
kind of optimized it a little bit I'm
learning about the optimizations but how
do I take it a step further what else
can I do
when I really need to spice up my
application so we've covered a lot of
those slides and those main things that
I show but I want to take it a step
further I'm going to talk a little bit
about custom renderers if you've done
any xamarin forms work you probably done
a lot of custom renders and you've
probably done way too many because you
should be using a lot of custom renders
you should use only them when you need
to custom renderers are awesome though
because they allow you to overwrite the
base functionality of any xamarin forms
control or implement any of your own
custom controls in your application
because if you think how xamarin forms
works even today is it has a button and
every single view has its own renderer
so you can create your own my button and
then completely override it on android
iOS or Android this is pretty cool
however what I often find people doing
is creating a custom renderer to change
one or two properties if you're doing
that you're doing it wrong because what
I'm going to talk about next after I
talk about custom renders is what you
want to do so this is only when it's
something crazy out-of-the-box that you
really need to optimize for some good
examples are a full custom page maybe
it's like a page from my iOS application
that I want to pull in maybe it's like
something crazy where I'm taking a
circle and cutting it out or I'm adding
a full calendar some control that
doesn't exist or in this instance maybe
I want to add ads to this application
this is the perfect use case for a
custom render
think of an ad it could be a Google
AdMob ad it could be an apple ad it
could be some other Microsoft ad this is
something that's never going to exist in
xamarin forms because who knows what
type of ad you want to use so to create
an ad inside of this application in a
cup
render it's really quite simple what I'm
going to do first to implement a custom
renderer because it's a full control is
inside my xamarin forms application I
have an ad control view and here there's
literally no code inside of it it just
says hey I am a xamarin forms view which
means that I'll inherit from all of the
xamarin forms properties so background
color all that different stuff that's in
there margin padding I get access to all
that I'm just a view so this is what
I'll actually be accessing inside of my
sam'l now some other things you may put
on top of here are additional properties
and getters and setters that you may
want to listen for so for instance if
this ad had an ID or you want a
different refresh rates you can add
additional bindable properties right
inside of here but for this ad view I'm
not going to do anything I'm going to
have this ad view over on Android first
and that's what we're going to take a
look at so I create this Android Android
control view renderer and this is how
it's implemented the first thing that
we're going to see is that I inherit and
I bring in a few things first as I'm
using Google play's ads inside of Google
Play services so AdMob integration there
and that's the only thing the only using
statement that I brought in there into
the actual Android application so what
this is telling xamarin forms is that
I'm a view renderer and I am going to be
of type add view control which is my
custom control and the actual native
widget is an ad from Google and that's
how it's going to know to actually
inflate the base control so I have a few
properties in here I have an ad size
which is coming from that Google AdMob
integration the ad view I have a method
that I created by myself that's going to
return this ad view so I only create it
once I have the ad unit ID so I set up
all my AdMob and firebase stuff behind
the scenes earlier this week I go and
create a new ad view I set the size I
set the ID
I create some params so it automatically
inflates it I say
load the ad done the only thing that I
really need to implement inside of this
is one override that says on element
changed so I have access to the control
so if the control hasn't been created
yet I say hey go create that add and
then I'm going to set the native control
set native control is strongly typed
because I told it that it is of type add
view so it's going to actually pass it
down so literally in less than 50 lines
of code I've brought in my add into this
application so now if I come back into
my weather view up top here I've added
this controls so I had all my custom
controls there and I add a new xmlns:a
namespace I come down to the bottom and
I'm going to say add control our sam'l
intellisense surprisingly it's smart
enough to know that it's actually in
that namespace and it lays down all that
stuff for me I don't have anything else
installed if I want to I could set like
background colors or I guess that's red
I could say grid dot Rho equals 4 and
grid column span equals 2
so it spans across boom now I've access
to that full control and I can go ahead
and deploy yet again onto this
application and what we'll see on the
bottom and since it's in an emulator is
a test ad coming from Google
so there's the background-color I think
have to do one more thing because it's
work through earlier what did I do
negative ten I think get to do that just
to kind of get rid of any of the spacing
that's in there it should work for this
gift for that's good
there it is perfect now we have our ad
so now our ad popped up it's there I
think probably if I waited long enough
earlier would have showed up too but I
don't like to wait
seeing it probably is going through my
HSPA+ so cool so now I have this ad add
this custom renderer built inside of it
and that's a great use case when you
actually need to have some control it
doesn't exist in xamarin forms into your
application but I said you're probably
using custom render is wrong and you
probably have way too many of them what
often developers want to do is get
access to a few properties in a xamarin
forms control that doesn't that isn't
exposed because everything in xamarin
forms is an abstraction so what we want
to do is use effects effects are the
most powerful thing I'm going to say
that like a thousand times because
everything is the most powerful thing
it's one of the most powerful and easy
things to implement in your application
so effects are like a custom renderer
but super light they allow you to extend
any control and change properties of any
native control there's no methods or
events to implement or override or
anything like that really everything is
optional so you can implement it on one
platform two platforms all the platforms
and they're all string lis type two
which I'll talk about here in a second
there's only two methods that a an
effect cares about beyond attached and
on detached so on attached says hey this
is about to show up what do you want to
do and on detached allows you to simply
set it back if you want to so let me
show you what we can do here in action
of these controls so let's say I'm
coming into this application and I want
to I have this the iOS version of it
here and I have this text box so it's
just using a default out of the box text
box here but maybe I want to change that
there's a few properties that I could do
to modify this application or maybe I
want to actually do some of highlighting
when I actually tap on this and change
the effect of it so what I can do is
come in to my shared code and I have an
effects folder right here
and I have this entry background effect
that's the first thing that I'm going to
do and I create this effect so I can
actually access it from the data binding
so this is called an entry background
effect and it's this routing effect so
it's a little bit of boilerplate code
and we can see inside here that I'm
expecting this my weather dot entry
background effect to be my routing
string I'll show you where that all
comes from so in one or all of my
applications I can come in to let's say
iOS here and I have an entry background
effect so what I do first is I export
the effect you see I'm doing a lot of
assembly things in here I'm saying entry
background effect of entry background
effect inside my entire application I
give it a resolution group name my
weather think of it as your company name
so or your app name and this is where
all effects are going to live so this
allows effects to be distributed easily
so if I'm creating some you're creating
some we can go back and forth so inside
of here it's very very simple I have a
non detached and unattached on detached
I do nothing and unattached here the
first thing I do is I set the border
style to line so I give it a line out
line so I can modify it and I also set
the background color to this RGB color
that I'm storing now I could just stop
at that point and say hey listen I get
this this border on it what I would like
to do is actually take it a step further
and listen for changes so I don't have
to do this but I'm going to where I'm
going to listen for element changes and
whenever the focus changes I'm going to
change the background color either from
white or to the background color so
toggle it back and forth and that's it
on and off and I could even investigate
those properties to and from so it's a
few lines of code again under 20 30
lines of code there's a lot of white
space I can come back into my weather
view I'm just going to go ahead and grab
this entry effect I've gone ahead and
brought in my effects namespace and down
here I can start layering some more
zamel so here I say effects entry
background effect and it will know how
to route it automatically so I set my
iOS project back as my startup
and deploy it one more time here what
we're going to see is just in a few
lines of code I'll have a new line entry
and whenever I highlighter or focus it
or unfocus it the background is going to
change automatically there we go
there we go so now we have this border
and when I tap on it now it's actually
purple color when I tap off of it
ideally I guess it's always focused I'm
not going to be the best example of it
being unfocused it should toggle back
and forth inside of it so I can see the
weather and I can change the actual
properties that I don't have access to
in xamarin forms but I didn't implement
it in Android and I didn't implement in
uwp because I don't have to it'll
automatically be smart enough to know
that I didn't implement on those other
actual platforms let's say I want to
take it even a step further and I want
to do some other things we have these
effects that are very simple so there is
nothing else on this effect at all but
effect can be can expose additional
properties on to the actual control we
call those attached properties so what I
did is I created a shadow effect the
shadow effect I can add to any label
that will actually give it a drop shadow
in the code but what I've done is I've
added additional bindable properties so
I'm kind of extending an existing
control but making it so I can add data
bindings for color radius the distance
for the drop shadow and what I do inside
of here is this is what my each platform
would implement so if it has a shadow
set has shadow get color set color and
what I'm doing here is I'm essentially
applying getting and setting values onto
the bindable property just like any
property like the text the background is
bindable we're extending xamarin forms
so there's distances and I just set up
all that stuff inside of here I also
have a few methods like on has shadow
change that I can listen to and I can
add or remove different effects I saw my
routing effect called label shadow
effect so I'm going to implement this
now in each of the different platforms
so here on iOS for instance I have a
label shadow and I'm essentially
extending this control here is the label
shadow I'm going to set the opacity the
shadow opacity to one on the layer I
have a few properties it's very simple
on iOS to essentially set the corner
radius get the shadow
set the offset of the shadow that's on
here and then i additionally listen for
property changes so if i map
data-binding i have a slider that's
moving back and forth it will
automatically update it so I don't have
to extend or create my own custom
control I'm just going to add on top of
it the same thing is true over here for
Android I put in a very similar code but
I'm actually using some text views and
color distances and I'm actually setting
a shadow layer on top of it on top of
this control so it's actually very very
simplistic there's not a lot of code
inside of here except to just listen for
the different properties so it's cool is
when I come back into my actual zamel I
can grab a little bit different label
that's inside of here let's save this
condition that's right here we'll go
ahead and replace it I'll set the font
size a little bit bigger though just so
we kind of have it the same so what
we're going to see is that we have these
attached properties so they're custom
shadow effects properties that we've
extended and all this code is on the
github so you can grab and sale this as
well done
so here the label knows that there's
this effect which has a has shadow as a
radius of five and five I can even use
on platform on top of it for my custom
properties which is awesome
so there's black or red for instance
over there so now with just a few
changes inside of here I can take these
core these core changes and then compile
it up and are not to change China's ammo
I don't have to override a custom
control I'm still using the base label I
can actually make these generic so they
work on anything but I've done it here
just for the label specifically there
we'll go and launch it one more time
then
come on get weather then here is our
beautiful drop shadow that I put in and
just a few lines of code but with those
attach properties so I'm not changing
the core functionality I can easily
update and remove them
cool custom renders effects attached
properties let's talk about what's new
and next in the next ten or so minutes
that I have left there's been tons of
features and enhancements that I can't
fit into a single hour-long presentation
we have a whole bunch of new stuff
that's coming out including deep linking
embedding new enhancements to master
detail pages embeddable native controls
and some new blur effects and a bunch of
these actual effects that are built into
the platform so you saw I did some here
but a lot of them are actually built
into xamarin forms automatically so one
thing that we've done is we've been
super aggressive with our bug triage so
we attempt to review every single new
issue within 24 hours and the better the
steps the quicker the resolution
obviously we've also done a vast
optimization of our performance in in
terms of startup time and also ListView
in sam'l compilation we're seeing on the
right-hand side is actually a sam'l
compiled sam'l in the like
reddish-orange versus non compiled sam'l
the actual inflation time that was done
by Matthew Robbins who does a really
cool plugin for visual studio format
called M fraktur and you can see that
using zamel compilation is often five
times faster in the actual improvement
and we're continuing that with every
release so we're tweaking all the
improvements as time goes on we also
have these things called fast renderers
and compression this is something that
you won't have to do anything at all and
it's coming out in the current preview
release and the next releases of xamarin
forms so on top we have a normals Ameren
forms application and what gets we have
a grid we have a stack layout and some
other grids and some other properties
inside of it and what we're seeing on
the bottom could be iOS Android or
Windows 10 and here's the uwp
representation of it that
she gets displayed at the end of the day
so we have two panels some other panels
a Content view is a panel a label
renderer and a text block so what we're
doing here is we're just have kind of
some unnecessary labels like why do we
have a label renderer and a text block
why do we have additional panels for no
good reason well is this kind of legacy
and we have to shipping it back and
forth so what we've done is we've added
automatic layout compression that says
what are things that are similar that we
can get rid of so that panel instead of
having multiple panels inside of panels
we can press them down into a single
panel and we handle the layout for you
automatically so right now instead of
all the stack layouts that you have to
do and you're doing stack without inside
of stacked layout will automatically
compress them and strip out anything
that you aren't using automatically you
won't have to do any work at all on top
of this though what we're seeing here is
that we can still do better there's a
label render and a text block a button
render and a and a button so to remove
more layers and get more optimization
we're creating these things called fast
renderers that will just happen
automatically and we're starting with a
few of them that will take this
compression and even minimize it down
even more into just a few if not less
than what the representation is in
xamarin forms this will all come for
free and some of the advanced
performance gains that we're doing in
addition to this we're adding a new
layout which I think everyone is going
to love it's called the Flex layout flex
layout comes a lot from the web world
but essentially the idea is that a lot
of times content is wrapping around over
and over again so the flex layout is
going to be an addition it's inspired by
CSS flexbox and it's used for like
flowing items but really good for
adaptive layouts when it comes to iPad
big phones back and forth so what it
will do is they'll be very similar to
your grid for instance but you have a
flex layout and you add a bunch of stuff
into it and you can set the height and
the width of it and automatically the
flex pay it will automatically wrap your
elements automatically the heights and
the widths and everything for you so
that'll be coming down the pipe so if
you're doing a lot of work with
renderers or effects just know that
you'll be wanting to look at
this control to really optimize your app
we're coming to new platforms forever
we've had Windows support you WP support
iOS and Android we're not done we've
recently added Samsung Tizen support
well the Samsung team did which runs on
50 million plus Samsung everything
televisions wearables mobile you name it
I'm going to show you the Mac OS support
and also we're adding WPF and Linux
support via gtk so from your savings
example everything will just work so
this is an application of a media hub
that's running on a Tizen television on
the right-hand side and a phone on the
left-hand side all from xamarin forms
because they have their own dotnet
runtime that runs on Tizen and I also
have a little tip calculator that the
team is using to actually run on an in
Boonton Dex desktop running dotnet since
obviously mono is powered on Linux and
of course xamarin forms can can control
and lay down native gtk controls which
is really awesome from all the controls
that you have I'm also going to show you
really quick what it takes to put your
application on another platform so in a
switch over here really quick to my Mac
and I have this in a branch inside that
github repo that I did earlier let's
close out of Skype for business I'm
going to open up visual studio for Mac
and today inside of the 2.3.5
pre-release we have xamarin Mac support
so I took all that same code that we had
literally just a few seconds ago in the
weather application I'm just going to go
ahead and boot it up really quick here
i've upgraded all of my nougats to the
latest pre-release of xamarin forms and
i've added as amber and Mac application
so over here we can see I have android
iOS I just removed the uwp one but it
has all of my other helpers that were in
here and I have a Samara Mac application
I have some packages that I've added
such as on a standard HTTP all that
stuff and then all the xamarin forms
plugins and things like that that I'm
using there's not a lot that I actually
have to do inside this application
inside of the
app delegate of the Mac application I
simply inherit from forms application
delegate very similar to iOS I go ahead
and set the rectangle width and height
that I want and when it's done
launching I just load the xamarin forms
application that's it inside my main I
simply say that that is my startup
delegate and with that with literally no
other changes to my zamel so it's going
to be the prettiest Mac application but
it's totally going to be a Mac
application it'll actually start up and
run locally on my Mac so I'll give it a
second to compile and boot up there it
is there we go so I can come in I can
see what my weather is there it is using
all xamarin or exam or Mac native
controls
there's my list view there's all my
items everything coming in and I could
of course use all my templates and
everything like that this is kind of the
tab structure that they have today so
it's pretty awesome it's already done
and you can take advantage of it and
you're getting a native Mac application
right there cool all right three minutes
left quick alright back to the PC
alright so let's talk about the last bit
in pieces here available today is two
three five pre-release of this is
actually retarget xamarin forms to a
dotnet standard library 1.1 which is
super awesome we've added additional
accessibility support fast renders on
android are available for button image
and label them OC has been improved even
more and it has over 160 bug fixes and
improvements and enhancements the future
though that I see is maybe you're not
creating as a mer forms application
today maybe you're still in the xamarin
Native world like I am all the time I go
back and forth for my application but
you want to dabble in the world of
xamarin forms forever it's been one or
the other you could mix and match the
world easily you could do it but it
wasn't easy so what we've done is we've
added xamarin forms embedding this is a
3.0 feature that will come out this fall
and what it does is it allows you to
take any xamarin forms sam'l content
page or c-sharp page and embed it into a
native
samer an application with just a few
lines of code so if you think about a
xamarin application with ios and android
there you have to build the user
interface over and over again instead of
going all in on xamarin forms we can add
just a little bit of xamarin forms
goodness into it and we can then extend
it into any other type of application
because we have another product called
the embedded native 4000 to embed dotnet
applications into Java and Swift
applications what's cool about this is
it works anywhere networks with
dependency servicing messaging Center
and we really plan to take it to all
sorts of different platforms because we
want xamarin forms everywhere so I have
one more application that I'm going to
show you and switch over to and what I
have is an image search application and
this is going to use Bing image search
to essentially load all of my to go out
I can search for anything and it's a
xamarin native application so if I
actually come inside of here we can see
that I have a Android and iOS project I
have a full storyboard with a collection
view I have a bunch of resources and
layout so when I go into my main Android
XML I have a recycler view and I have
items in detail so this is just a
xamarin native application and what I
wanted to do was see how easy it would
be to extend this application with
xamarin form so let that spin up here in
a second
so I've already structured it in an mvvm
way so I have image results I've Bing
image results I have an emotion engine
to do cognitive services on it and I
already had a view model so what I
wanted to do was extend it with xamarin
forms I'm gonna say that's going to spin
up or not close everything there we go I
want to do extend it with xamarin forms
as they hey can I just take a little bit
of zamel and this content page and add a
details page whenever I navigate and
click on an item so this is where
xamarin forms embedding comes in so what
I do inside of iOS is whenever I tap on
an item I simply come in right here and
I pull in the xamarin forms libraries I
create the sam'l
details page and what I do here is I say
van Rijn forms page create a
uiviewcontroller for me it'll
automatically give me a uiviewcontroller
and then I can use my native apps
application to push the view controller
when I come over into my Android
application I have a details page very
similar the only difference that I do
here is that I create my details page
and it's a create fragment so I create
one or the other so it's cool here is
that I'm now able to take an existing
xamarin native application which gives
me the benefit of access to every single
control optimizing super fast startup
time and bring in pages of reusable
xamarin forms logic so we'll give this a
second to spin up here and that zamel is
one zamel then shared across iOS Android
and Windows but it also supports so if I
search for some monkeys inside of here
for instance I can go get all my monkeys
up up up up come on come on phone
there we go I assume I have like one bar
of anything perfect so I have like a
recyclerview
I have some images that aren't loading
for some reason but I can tap on an item
and this will actually go into the
xamarin forms page I can actually
analyze images and I can actually get
all of this right here from xamarin
forms so that's all coming in across the
wire and that's being shared obviously
with my iOS application so if I set my
start up here I set that over to my
iPhone I could set that same thing up on
my simulator and we'll see if it's here
I think I already have it image search
there we go should be able to tap on
this do it monkey's tap on one of them
and it gets navigated across with my
super crappy Wi-Fi but it's all it works
and I'm sharing that same exact page and
the images automatically for me so now I
can go in and modify the saml and bring
it in I really think that's the future
of xamarin forms and xamarin native
together we're making it super easy to
combine the worlds so of course you can
get all this information from xamarin
comm I have my slides and my source code
there we have xamarin University that's
awesome I super appreciate it if you
follow Henry and it's a device to grab a
green piece of paper and put it in there
I love it if you guys have any questions
at all feel free to reach out to me at
any time I would love to talk to you
more and have a great rest of NBC thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>