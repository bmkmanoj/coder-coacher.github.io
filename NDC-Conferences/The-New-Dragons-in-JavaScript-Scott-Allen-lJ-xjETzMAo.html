<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The New Dragons in JavaScript - Scott Allen | Coder Coacher - Coaching Coders</title><meta content="The New Dragons in JavaScript - Scott Allen - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The New Dragons in JavaScript - Scott Allen</b></h2><h5 class="post__date">2016-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lJ-xjETzMAo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everybody how are we today enjoying
the conference
good I love the NDC conferences I've
been doing them for years now they're my
favourite conference and I'm not just
saying that because I'm here so this
talk is all about the new javis new
features of the JavaScript language I
was very excited two years ago when I
found out that there was a new
specification coming for the JavaScript
language and looking at the JavaScript
and looking at that specification I
could see that this was a huge step
forward for the JavaScript language I
mean it had been years since anything
significant really meaty had been added
to the JavaScript language and I was
very excited to start working with these
new features even before the
specification was final and that was
possible because back then when it was
still called equi script six there were
trans powers available so I could start
writing this code into projects and not
really worry about it screwing up in
production because the transpilers would
just put it into yes five code and I
knew everything would work in the
browser so that was all great but it's
been two years now of working with some
of these new features and I've
discovered that just like ancient
cartographers when they were drawing out
maps of the world there are some of
those areas that just haven't been fully
explored areas where ships just kind of
disappear we don't know why so they used
to draw dragons and other mythological
beasts on the map just to represent
those areas where you need to be a
little bit cautious if you're venturing
into that area so my goal in this
presentation is maybe you've looked at
some of these features or using some of
these features maybe not but over the
last two years I've picked up on areas
where developers run into problems and
where things don't work like you would
expect them to work and we will start as
an example with arrow functions how hard
could they be they're actually one of
the one of those features of Equus Kuk
2015 where I've seen people struggle
most so I'll also give you a little bit
of an overview of what these
specifications are just in case you
haven't worked with some of these new
languages but if you're a c-sharp
developer error functions are just like
lambda expressions in c-sharp almost I
well the rules are almost the same for
example this first bit of code here that
represents an executable function which
I think my computer just got very
unhappy again yeah there we go strange
patterns on the screen so I think I
might have to reboot real quick one
second I'm gonna focus on this for just
a second and as soon as I get back up
and running I will yeah I'm gonna have
to completely reboot that's uh
unfortunate you know another laptop
might not be a bad idea I always have to
get the slides off a onedrive or
something I'll try it once more here but
while this is rebooting let me just tell
you that error functions are almost just
like the functions lambda expressions in
c-sharp that is if I want to write an
arrow function that only takes one
parameter I have to do a hard reset here
I don't need parentheses around that
parameter but if I have an error
function that takes two parameters I
need the parentheses and all of this
would look glorious if it was actually
on the screen interesting that it did
that when I put the pen on the screen to
annotate it we'll try it one more time
here we're almost there see if we get a
display
yes okay see me login let me try to
bring this out press that button
carefully let's try the pen real quick
okay so far so good
no one breathe this
as defining a piece of executable code
that takes one parameter X and it goes
to the expression x times X so just like
in c-sharp if I just want to write a
simple expression that's gonna be the
return result I don't need a return
statement I don't need curly braces or
anything like that ad is taking two
parameters X and y that I'll return X
plus y and again we're defining
something that I can execute so I can
say square the result of adding 3 and 5
and log that out it would be a 64 error
functions are beautiful because
JavaScript is a very functional language
there's lots of api's that are
higher-order functions so they're
functions that you can pass in other
functions to do work a good example is
the map function that's now available on
an array instead of saying numbers dot
map function keyword parentheses and all
that noise that used to be in JavaScript
I can now just say numbers dot map and
here's a little lambda expression and
goes to end times 2 so I'll double
everything in the array so arrow
functions look good but they are it's
important to note that arrow functions
are not a replacement for the function
keyword there's a couple places where
you cannot use error functions
it's syntactically illegal for example
to use arrow functions to define a class
member and then there's other places
where error functions just don't work
like you would expect so let's talk
about a few this scenarios and here's
one scenario that comes up here's a
piece of code right here where someone
is saying I want to take these numbers
and I want to map them into objects
where I would expect to get back three
objects that would be value : wand are
you calling two value : three but what I
will actually get back is an array with
three undefined values in it because
when the JavaScript runtime evaluates
this expression with the curly braces it
doesn't see that as me trying to return
an object literal it sees that as me
trying to open up a code block to
perform some work and with it once you
start a code block with curly braces you
do need an explicit return statement if
I want it as a return value : n for
everything in that array so what
JavaScript sees is some code that it
executes some returns undefined how is
that even syntactically legal
it's still syntactically legal because
technically JavaScript we don't use this
very often but it does have labels in
the language you can add a label to a
line of code so what javascript is
seeing there's a label called value that
just points to the expression end but it
doesn't produce the result we want so
don't do that the easy fix in that
particular case yes I could use an
explicit return statement and I can also
wrap this thing with parentheses and
then the JavaScript runtime will say oh
okay
what you really want here is an
expression that is an object literal and
build an object that has a value
property and I'll stick in inside of
there from the array so then I'd get
back to value one value to value three
making sense
interesting hopefully this is what you
came to see good the other special
characteristic about error functions
that you probably know if you've worked
with this feature is how they preserve
the lexical this reference so here's an
example of an object that will not work
correctly because when I say numbers dot
for each here's a function please add
and to sum what is the this reference
well it's not going to be pointing to
this adder object that I'm inside of
because the this reference we know in
JavaScript it's dynamic its slippery
it's set up by the call context so when
for each calls my function for each
isn't gonna call my function and pass in
and and set up this reference for me
appropriately so this is probably
referencing the window object and I'm
gonna be getting an error cannot read
properties some if I try to execute that
code one of the things they did with
error functions which is kind of
borrowed from CoffeeScript fat arrows is
that when you define an arrow function
it's going to preserve the lexical value
of the this reference in other words
since this arrow function is defined
inside of a function that is inside of
this object and assuming add gets
invoked correctly this arrow function is
always always always going to be using a
this reference that is exactly the same
as
this reference that would be outside of
the arrow function inside this function
so am I making sense no what's wrong
just that expression okay yes yes yes a
little jet lag so I'm a little leery
about what I might be doing wrong here
on front stage that kind of worked so
that will actually refer to this dot sum
and I will get back a result that is
equal to 6 which is what I would expect
that's nice and it's very useful in a
number of scenarios but it's also you
have to be aware that it can be
dangerous in a couple scenarios I'll
explain why in just a minute but before
I get there this code works just so
we're clear that's an error function
that's being defined inside of a
function so it'll capture that this
reference and the specification talks
about that this reference becoming
static it's no longer dynamically
determined it's sort of pre down into
that error function and no one can
change it but what about this bit of
code where I have this this object
member defined as an arrow function in
an error function inside of there it's
not immediately obvious when you write
that code you might say well I have an
error function here and it's inside my
object but the scope for that will be
taken from the scope from this error
function and the scope of this for this
error the scope of this for that line of
code it's not inside of a function so
it's whatever this is right here
where that's being luckily define so I
could very easily be ending up with a
this reference that is still pointing to
the window object or you know whatever
this was inside of whatever that object
was inside of that makes some sense so
too many error functions there and then
the other thing to keep in mind about
error functions is that you cannot bind
apply or call to change this reference
any longer so any other normal function
in JavaScript that's too clear with the
function keyword I can get a reference
to that function I can say function dot
bind here
you're this reference to use or function
dot apply I'm gonna invoke this function
and pass in your this reference but with
air functions it does not work once the
this once the this pointer has been
captured by the error function there's
nothing you can do to change it
so in this example I have my object
adder and now I'm trying to define an
arrow function that I'm going to bind
onto that adder so I'm trying to say
here's what you'll use as a this
reference but it's not going to work
react programmers run into the salaah
because they try to define functions and
bind them to the object that they're
going to be working with and when they
define them using arrow functions they
can run into trouble what are some other
scenarios where you run into trouble
with that well let me start with this
exact an example actually if you're
using jQuery it's quite common to wire
up like a button click event and then
when jQuery invokes your callback
function because it's been clicked
jQuery will try to set up to this
reference so we can pass it in as the
Dom element that was clicked on
unfortunately jQuery won't be able to do
that any longer if you define the
callback as an arrow function because
again you can't use a function dot bind
or call or apply to manipulate the this
reference anymore so this piece of code
that this reference will not be you the
one that jQuery tried to set up for you
it'll be whatever it captured inside of
whatever whatever scope were in so
instead of setting name on the Dom
element chances are you're setting the
name of the window or the name of the
module or something like that
the place where I first ran into this
and discovered it what should my dismay
was inside a Jasmine unit test I thought
well this is really nice I'll just start
defining my unit test as arrow functions
but if you've ever used jasmine you can
set up a test context in jasmine and
attach things to it this reference
inside of like before each calls just to
keep track of things and have them
available inside of the it throughout
all of your tests and then Jasmine when
it invokes this function to execute the
unit test it tries to set up at this
pointer so you can get to the test
context but if it's an arrow function
you don't get the test context so I had
test failing and trying to figure out
why and I thought maybe it was
bug in the transpiler and that's when I
actually dug into the JavaScript
specification and saw oh this is
actually how error functions work and I
also found out then when I looked in the
specification error functions have a
couple other idiosyncrasies let's call
them because they're not normal
functions they don't have their own
implicit arguments variable whatever the
arguments are there will be whatever the
arguments were for maybe the function on
inside oh so if I try to add three and
five even though I'm passing in two
things this implicit arguments variable
here would return zero because maybe I'm
inside of a function that had zero
arguments that making some sense so
don't rely on some of those typical
function behaviors and implicit
variables that you would get when you're
using error functions let's talk about
template literals for a second template
literals are that new feature in equi
script 2015 where I can use the backtick
so not a single quote not a double quote
but a backtick and then the JavaScript
runtime will evaluate the dollar sign
curly brace expressions that are inside
of the string and if I had x and y
defined before I reach that exact line
of code JavaScript would produce
something like three plus five equals
eight because it would actually evaluate
all this stuff but a lot of people when
they hear the word templates they think
naturally that okay I can define a
template like this and then reuse it
with different objects so I'd be able to
define a template and then later on give
it some X or Y and tell it to format
itself but that's not how it works it's
literally just inline there we need to
find the template any of the variables
that you are using inside of that
template they have to be available in
the scope and the JavaScript runtime if
it doesn't find X or Y it'll say
something is not defined and then people
say well why are they templates then why
don't we just call the string
interpolation well the original
specifications for this actually called
them quasi literals so they're kind of
faked literals they're not really
literals but it's tava script so it has
to be a little bit quirky right you can
make them reusable though
so here I'm just gonna define template
now as a function that takes two
parameters x and y and it returns the
template literal X plus y equals x plus
y and so now all I have to do is invoke
that function and pass in my model data
so invoke template pass in two and two
and I get back to string two plus two
equals four and if you want to get a
little bit fancier you can use a feature
in equi script 2015 an SD structuring so
this syntax right here I don't have a
slide on destructuring you know think
curly brackets on the left hand side of
an assignment statement or in the list
of parameters to a function they D
structure an object so this is creating
two variables x and y and what it will
do is pull the X property and the Y
property out of an object that I pass in
and so now I had the ability to invoke
this template and sort of pass in a
model object right I pass in an object
that has some properties and there's a
template literal in there that'll spit
it out so now it feels a little more
template D feels a little more like
handlebars or something like that
great so speaking of destructuring some
people don't like the crazy syntax that
you can now do with equi script 2015 and
plus some other features in the future
and actually i do have here something
under structuring so what is
destructuring destructuring strike some
people as funny but square brackets on
the right hand side of an assignment
that's constructing something so I'm
constructing an array using an array
literal square brackets on the left hand
side of an assignment is d structuring
so it's creating new variables x and y
and then it's trying to pull in this
case element sub-zero an element sub 1
out of whatever is on the right hand
side so I would get out of this bit of
code X is 22 and Y is 44 very good that
one's a simple example but you can get a
little bit weirder so here's an example
where I have an object with and so
there's a radius structuring and there's
an object de structure
object destructuring well object
literals are when you have curly
brackets on the right hand side of an
expression object D structuring is when
you have the curly brackets on the left
hand side of an assignment so this is
actually creating two new variables
state and country state is going to have
a default value of New York but it's
also going try to try to read the state
property out of address since there is a
state here of Maryland that's where I
live in the United States the result of
this would be state the state would be
pointing to a string Maryland country
however since there's no country in my
address object it would be get that
default value of USA so that's where
people start to feel a little bit
uncomfortable with the structuring why
don't we just write the code a little
more explicitly but then you can also do
really crazy stuff with it so here's an
object literal defining an employee with
the first name it's a complex object
because I have an address inside of
their State Maryland country USA and my
favorite numbers not really but whatever
this is a destructuring assignment down
here because the curly braces are on the
left hand side I'm trying to pull out
the first name property and fine that'll
be equal to a Scott this is defining a
state variable it's gonna drill into the
address of the employee and pull out the
state of Maryland and this little quirky
expression here is saying go into
favorite numbers skip the first element
of the array pull out the second one
that would be a 55 so now I have three
new variables first name state and
second and they would be equal to Scott
Maryland and 55 that's a little bit odd
until you're used to it but it gets
better
or weirder depending on how you think
about it what's this produce
yeah it's a variable-length and since a
string has a length property will be
getting in the length of that string out
of it which is uh looks to be for right
WT question where four characters even
more interesting I'm gonna put a couple
different operators together so first of
all you might have heard of the bang
bang operator bang bang you're a boolean
it's a way to do a type coercion in
JavaScript so what I know value is true
so first I'll nod it to get it into a
boolean but that's the opposite of what
I want so I'll not it again to get a
true out so let's combine that with some
other syntax so what is this syntax this
is the spread syntax that's part of equi
script 2015 spreading allows me to take
an array and then spit out the
individual elements of that array into
another array I can also use it when I
invoke a function to take an array and
spread the array across the parameters
to that function so if I wanted to
invoke a function that took three
parameters I could invoke it and do dot
dot dot numbers and one would go to the
first parameter to begin the second
parameter three the third parameter but
in this example I'm taking numbers and
spreading them into an array so I'll get
back an array one two three four five
six kind of like flattening now in the
next version of echo script which you
can already take advantage of because
transpilers like babel allow you to turn
on features that aren't part of an
official specification yet they're still
coming in the future but in the future
specification you can also spread
objects so I want to take this data
object and then I want to build a new
object result that'll have some
additional data in it but spread data
into it so result will actually have X&amp;amp;Y
properties after that is evaluated
making sense so far so now I can't
remember what library this is in I can't
remember it's in redox it seems to me
it's something reactive related what in
earth does this do
well what is trying to do is first
determine the spread operator has a very
low priority first determine if there is
data or not but not not data and if
there is data the result of that will be
this piece of the ternary expression and
the dot dot dot means we will spread
data into this result and the whole goal
of this is that if we don't have data
what I want to spread here is this false
condition which is I just want to spread
in default is true into that object but
a lot of people look at this dot dot dot
bangbang and start to say maybe things
have gone too far I don't know but
that's actually in a github project if
you do some searching what about this
Const keyword I've been using constant
let were introduced in atmosphere of
2015 and a lot of people these days are
saying use Const whenever possible that
should be your default when you're
declaring a variable use Const and
constant means means no more assignments
to that variable and it makes it easier
to reason about use let if you have to
do an assignment but Const what it
should do is if I defined a variable X
equals 2 but then I try to reassign it
somewhere later in the code I should get
a type error I'm trying to assign to a
constant variable so in this case if
this is really something I had to do I
should be using let here or maybe even
bar but just so you know Const doesn't
mean immutable so I cannot declare
constant numbers equals some array
literal and expect that to prevent
someone from pushing or popping or
slicing that array that works if that's
something I wanted to do I could use the
object up freeze epi you know that would
prevent someone from pushing something
in that would generate a type error
should generate a type area and let's
talk about collections a little bit so
mm-hm they did do some good new things
to prevent crazy errors in JavaScript
you know if you invoke the array
function and you pass in three
parameters that will give you back an
array that has those parameters as
values in the array but if you invoke
the array function and only pass in one
thing it assumes you want an array of
that size so it doesn't build an array
with a 10 in it it builds an array with
10 undefined in it and that becomes a
problem that's actually something that
I've seen people run into when they're
doing a little bit of dynamic
programming and doing a raid call and
they're not sure how many parameters
they might have to pass in just so you
know if you're ever in that situation
there is now an array of which is the
API you should be using when you really
want to create an array given some
parameters and it takes a VAR args it
takes a variable number of arguments so
I could pass in 10 11 12 and it will
build me an array with 10 11 and 12 in
it and what's interesting about there's
another one arrayed up from which is
actually kind of odd what it will do is
it will look at this object that you
pass in the first parameter to see if
it's iterable or to see if it has a
length property and if it just has a
length property internally it just sets
up a loop from I equals 0 to I is less
than length and in this case I'm just
demonstrating that you can also pass in
a callback function that takes the value
that it found at that index and the
indexing the key that it used to get in
there like 0 1 2 3 or 4 or 5 so what
this would do is just build build
actually an array that has the value 0 1
2 3 4 in it fascinating I hear you say
tell me more all right there's new some
new data structures in atmosphere of
2015 you should just be aware of how
they work there's a new set so sets
shouldn't have duplicates in them but
it's just doing a reference or a value
value comparison where if I create a new
set and try to add 9 twice they'll only
be 1 9 in there which makes sense but if
I try to add two arrays that's two
different objects that the set sees so
it's going to happily accept those two
different arrays
and the set size will be to make sense
like to a lot of people when they see
this I think right you just have to be
aware that that is the behavior if I
were to try to add the same object
reference twice so the same array I try
to add twice then the set dot size would
just contain the one just contain that
arraign wouldn't add it twice a lot of
people have asked over the last year if
there's a literal notation for map or
set map is another new type that was
defined by Xmas tree of 2015 we have
array literals and this nice syntax to
create an array yes there's something
similar for mapper set and the answer is
no we have array literals we have object
literals and that's still just the only
literals we have if I want to create a
new map this is sort of the quirky
syntax to create a map I pass in array
an array of arrays where each array
inside of here contains the key value of
the key and then the value for classes
this is where things start to get
interesting again so typically when
people are teaching equi script 2015 or
describing these features they tell you
that classes are syntactic sugar for
what we've always done in other words if
I define a class with a constructor and
it has some methods like do work and it
has a property like get and set name
behind the scenes all that really is
doing it's just what we used to do which
is let me define a constructor function
and then let me modify the prototype
object of that constructor function and
add some members to it because every
object that is instantiated from that
constructor function will have its magic
prototype reference point to that
prototype object therefore every object
that is instantiated from this
constructor function will have do a do
work method and a name property that has
a getter and setter and for the most
part this is true from the most part you
can think of classes this way that when
I'm writing a class it's really just
behind the scenes D sugared into
what I've always been doing perhaps if
you've ever used this approach to
JavaScript programming if you you know
like the object-oriented style but there
are some important differences between
implementing employee using this style
and implementing employee using this
style one such difference is in hoisting
so if you're familiar with the term
hoisting in JavaScript you typically
associate it with evil powers right it's
not something that we typically like but
it does allow me to write code like this
I can define a function down here at the
bottom of my javascript file but thanks
to hoisting that symbol employee is
actually available right from the start
when I am executing code at the top of
this file therefore if I write code that
says consti equals new employee that's
going to work just fine even though I
have employee defined below the same is
not true for classes if I try to define
a class at the bottom of the file
because it's a utility class and I kind
of want to push it out of sight and do
some real work at the top this is not
gonna work it's gonna throw a reference
err classes classes actually do hoist
but they but they're not legal to use
when they hoist so you should get a
reference to air for those and so what
do I mean when I say classes hoist but
they're not available to use there's
this wonderful term in the atmosphere of
2015 specification they talk about this
thing called the temporal dead zone the
tdz I think is a fantastic name for a
movie a temporal dead zone but what
they're talking about is that there is a
period of time where and here's another
example let var variables hoist right if
I have if I was using var X equals two X
is available everywhere inside of that
function right that's what hoisting does
but if I declare that variable X with
let like it here is here on the slide
technically X is hoisted it is available
right from the top of the function but
the specification also says that that is
it
temporal deadzone until you reach the
line of code where X is actually
formally declared with let or const if
anyone tries to access X the runtime has
to throw a reference here so yeah
javascript another difference if I
define employee or he meant well the
example here is I'm defining a
constructor function human manipulating
the prototype to add a do work method to
humans that are instantiated from that
constructor function if I want to do
some reflection that is iterate through
a new human and find out what is
available inside the for in loop will
give me back do work as an available
thing inside of a human but if I define
human or well in this case horse as a
class and I try to for in through a new
horse that methods is not seen so you
cannot reflect as easily over something
that has been defined with the class and
that trips people I've seen that trip
repeat I've seen that trip people up a
bit what if I really wanted to do that
what if I really wanted to for in over a
horse and find out what's inside of it
well I can't exactly for in but what I
can do is I can use object get prototype
of an instance of a horse and then
there's an API object get own property
names on that thing that I get back from
get prototype of and this is if I want
to find the available methods on an
object that would actually tell me in it
just in addition to do work actually
that would tell me about the constructor
too so it's telling me yes there's a
constructor there and there's a thing
called do work there so slightly
different API this is a four of loop by
the way how many people in there four of
just a few so four in has always been in
JavaScript and it iterates over the
available keys that are in an object or
in an array for of actually pulls out
values so if I four of over an array I
actually get the values that are inside
whereas for in gives me the indexes and
I have to use them to index into the
array so for office nights new is
required so paranoid JavaScript
developers in the past when they used to
construct when they wrote constructor
functions quite often they wrote some
defensive programming in there that used
operators like instance of to make sure
that no one was invoking the constructor
without using the new keyword but in
Equus BER 2015 you don't have to do that
if you buy the class and someone tries
to invoke the constructor for that class
and I don't have one defined here but it
wouldn't matter even if I had a
constructor there so that's that's the
word constructor with curly braces I
would get a type error if I tried to
invoke horse without using the new
keyword so I don't have to do that
anymore but this being JavaScript what's
interesting is I can define a
constructor and still return whatever
the heck I want and that works and
that's legal because it's JavaScript so
I say new horse and I get back something
with a name a jiffy and no do work
method right let's talk about modules so
I have to tell you when I first looked
at the specification and I saw that
there was going to be modules in
JavaScript I thought yes my prayers have
been answered
I've been wanting something like this
for 10 years now you know every other
language I work with c-sharp and Java in
the past and Python and Ruby and
everything has some ability to
encapsulate code and modernize it and
spread things across the file system and
I don't have to do weird things in the
language just to architectural hook
things up to work these days there are
times when I look at modules and I think
yes I am being punished for what I have
asked for that's a quote from Oscar
Wilde he any Oscar Wilde fans out there
he writes some really wonderful prose
English fellow and he's written plays
and books and all sorts of interesting
things you I'm sure you've probably seen
a movie or something that was inspired
by one of us were
so what are modules in accra script 2015
first of all they're beautiful because
when I write code that is targeting equi
script 2015 I no longer have to worry
about this syntactic noise that litters
every dot j/s file out there no more if
ease to control scope no more use strict
because in Ekta scrip 2015 if you're in
a module you were in a strict mode by
default all of that goes away I can open
up a dot j s file and just start writing
code and I don't have to worry about
anything leaking out into the global
scope by default it doesn't happen
anymore instead I can start writing
things in a file and I can pick what I
explicitly want to export to the outside
world for them to consume so inside of
this file if I write a function work
unless I explicitly export that thing no
one else can see it no one else can use
it no one else can touch it and I can
either export it by using the export
keyword right there so I could say
export function work and it would be
published some people like to write all
their code and then put their exports
down at the bottom so they're easy to
find you just always scroll to the
bottom of the file oh that's what I'm
exporting so here I'm exporting to
things exporting work exporting the
person class you can export functions
you can export classes you can export
variables you can export just about
everything a necklace crip 2015 also has
a slightly diffusing diffusing confusing
concept of a default export which we'll
talk about here in just a second but
it's basically a way of saying alright
if someone wants to import from me and
they haven't specified exactly what they
want to import they get the person class
that's basically what that syntax is
saying there's also a syntax that allows
you to roll things up and this is quite
useful if you were building a library or
you want to build an API it's even quite
useful inside of applications sometimes
this is basically saying hey take
everything from this module creatures
and export it and also take everything
from the humans modules and export it
and so now I have a module that other
people can work with without knowing
about these lower level modules
creatures and humans and referring to
them directly
modules by the way if you haven't seen
this syntax before you don't have to
specify a file extension but this is
literally saying in this folder there
should be a creatures dot JS file and
that's what I wear when I grab exports
from so you can use pass and relative
pass to navigate to the the modules that
you want and then there's imports so
when someone has exported something I
can import things so I can import person
and animal from lib these names have to
match the names that are being exported
so someone exported person I have to
import person be very careful if you
forget to use the curly braces because
if you don't have the curly braces
you're asking for the default export and
so I've seen a lot of people use the
import statement and this thing is
undefined and they don't know why
because hey that module I see it exports
the human person but unless it's an a
default export do I have enough pen mark
up on here yet unless it's a default
export you don't get anything here and
if they do have a default export you can
name this whatever you want so they
could be exporting foo and I could be
importing bar and it would work there's
also the ability to just say I'm gonna
import everything and this becomes kind
of like a namespace so import everything
put it in this lib variable and now I
can say libbed up this or libbed up
personal animal fascinating I hear you
say so
some important behaviors to understand
about this first of all let me back up a
second
it's very so when I first looked at this
syntax I thought oh this is quite clever
I can imagine this thing exporting some
sort of module object and this over here
is doing a destructuring so what I'm
doing is creating a local variable
called animal and it's just sort of D
structured out of that module that's not
what that does not what's happening at
all the specification refers to these as
bindings that is not destructuring
and here's why that's significant let's
say I have a module that exports a
simple variable counter equals zero and
it also exports a function that I can
use to increment
counter and add one to it some other
module imports that counter and tries to
manipulate it
that's a syntax here because these
bindings are you can think of them as
Const they're immutable I cannot change
counter and you might say well you know
am I getting a copy of that counter
what's really happening here it's it's
really quite bizarre until you sit down
and think through it and look at the
specification you would think a
primitive value like a number you would
be getting a copy of it in this other
module but that's actually not what is
not what's happening if I import counter
and increment I can look at counter and
it's a zero sorry and if I if I invoke
increment which is jumping back into
this module to increment this counter I
see that change in my other module you
can also so don't think of these as
simple variables think of them think of
them as bindings and they're almost like
two C++ developers a pointer to a
pointer right now I'm getting a pointer
to that other number that's over there
and when I look at counter I'm referring
to that counter really that's in the
other module yes sorry and think of it
like a singleton so they'll all see the
same counter yep the question was if if
I imported it somewhere else into a
second module you know does it see that
same value for counter and the answer is
yes you can almost think of this like a
singleton and each each module gets a
binding to it and the bindings are live
so a slightly different example we're
gonna have a we're gonna export an
object now with the name of Oscar and
then just some functions to do things
like reset to a new object and inspect
the name that that module knows about
this behaves pretty much like you would
probably expect I can set the creatures
name when I import creature that's an
immutable binding but creature dot name
is just a property on that thing so I
can change the name and if I look in
that other module
you know what name does it see it sees
Winnie because my module changed it and
if I reset things that reset to my
binding so my creature goes B goes back
to being named Oscar because now we're
looking at this object being sense
what's the default value of this inside
of a module it's undefined just so you
know unlike when you're not inside of a
module and this is the window object or
you know something else so you might be
looking at this and saying well Scott
why do you feel punished when you're
using modules it's because the
atmosphere of 2015 specification was
very clear that they wanted a static
syntax for modules and you can get into
situations where you start importing a
lot of things or you do a lot of
bookkeeping right this is actually from
a unit test in the angular 2 framework
where we're trying to write tests using
epoch 2015 2015 modules first we have to
import things from the test framework
then we have to import some of our
infrastructure that helps us test things
then we have to import the things that
we actually want to test and then we
have to import some other helpers down
here so there's what 40 some lines of
imports before I even get to the test
code now that's an extreme example but
it can sometimes feel tiresome you just
want to use this thing that's in another
file and it used to be so easy in
JavaScript but now I have to manage
these imports to actually formally bring
it in and I would expect overtime
tooling is going to help us solve this I
know jetbrains webstorm already has a
feature where if you just type that
you're using creature it'll say oh do
you want me to add an import statement
for it you know which is kind of nice
but you and if you come from an odious
background or if you've ever used common
jas or any of these other module
informal module specifications
community-based specifications that have
been out there for modules you might say
well can't I do something dynamic like
this is the kind of code people write
might write with node to say I want to
go out and require sorry down here I
want to require a bunch of files that I
find so I just want to write some code
to go in a directory loop through all
the files that are fine their files that
are found there and dynamically import
them that doesn't work with atmospheric
2015 again the specification when they
were designing the module syntax for
JavaScript they didn't want dynamic
stuff they wanted modules to be very
explicit and very static and give tools
the ability to parse a JavaScript file
and analyze the import statements
without actually executing JavaScript
code and they felt that that would
enable a number of good tooling benefits
as well as a number of good runtime
optimizations so modules feel a little
bit inflexible sometimes you don't have
any wiggle room you have to specify
specific module names and import
specific symbols that you want the other
interesting thing about modules is that
the module syntax that we're looking at
is complete and written in stone and
it's not going to change it is
officially part of the specification
what the specification does not provide
any guidance on however is how those
statements should actually behave in a
browser or an environment or an
environment like nodejs they basically
say here's the syntax now you guys
figure out what's gonna happen which
means it's impossible to use any of this
code without running through a tool that
will stitch together modules for you you
know you have to use a transpiler you
have to use a tool that's going to emit
code that will work in the browser and
get rid of the import statements right
now there's two and this is another big
source of pain for me with modules
originally when I started working
modules I selected this tool called
system Jas system Jas is a tool that
gives you an API like hey I went to
dynamically import this module it's
going to be the main entry point for my
application and once system Jas brings
that file in it might see that that
means Jas file imports some other things
so and it'll just go out and grab
everything that you need and kind of it
can do it all dynamically to just fetch
things the reason I initially wanted to
use system Jas is because system Jas
system Jas says that or the whole goal
behind system Jas is that it's trying to
implement the future specification for
how module loaders should behave so
someday in the future or perhaps when
our grandchildren are programming there
will be a finished specification for how
module loading works and system Jayesh
should reflect exactly what that
specification says my frustrations with
system Jas are that it is not a finished
specification it's little changes in
api's change and you can do you can have
a perfectly working system one morning
and then do an NPM update and get a new
version of system Jas and all hell
breaks loose and nothing works
so I've kind of been off of system Jas
for about six months now I might revisit
it next year when things are better or
you know cool closer perhaps oh so one
problem of system Jas is changing
standards and other problem is
performance actually the aralia team ran
into the system Jas since its trying to
follow the specifications it builds on
top of specifications like the promise
specification so when you try to import
a module it'll return a promise and you
can wait for that promise to resolve to
know hey my module was now arrived in
the browser unfortunately some browsers
and system Jas I should mention when
it's loading a large application it's
building up hundreds perhaps thousands
of promises to do all those resolution
work and in some browsers promises don't
perform very well I think it was
Internet Explorer that was taking some
version of Internet Explorer would take
six minutes to load an application where
in Chrome it was a hundred milliseconds
and it's all because of the promis
implementation in Internet Explorer they
actually had a regression bug that was
causing a problem so it's not a perfect
world
I moved away from system J s and from
the last about six months I've been
using a tool called web pack web pack is
one of a number of tools that understand
equi script 2015 modules it understands
commonjs modules it understands AMD
modules it understands UMD modules and
knows how to work with typescript and
Babel and all the transpilers it's just
one of those Swiss Army knife tools that
does everything a lot of people use
webpack and completely replace things
like grunt and gulp because you can use
webpack to make an entire build system
and the whole essence of web pack is
that it's a tool that you're gonna run
at build times that before things get to
the browser and then you're going to
tell that here's the entry point for my
application please go to entry j/s web
pack oh look at that file see that it
has a couple of import statements it'll
say ok let me go to those files and they
have import statements so again it just
goes through the tree dependencies puts
all the JavaScript files together into a
single one or you can build multiple
files too if you want in this case we'd
be doing a single output into a file
called bundle dot J ass and voila you
know everything's resolved and I don't
have to worry about a runtime module
loader or any of that stuff web pack has
just given me JavaScript that I can put
into the browser using regular script
tags and everything works and again web
pack is just one of those tools that
slices and dices and does everything so
if I want web pack to package up my CSS
files and my HTML templates and fonts
and all this other stuff that'll put
everything together even if it has to
base64 encode things so web pack is cool
but I still do have some concerns over
web pack I've seen a tendency in some
applications where the application code
becomes web pack a-- fide
a good example would be this is a piece
of angular 2 code which everything
appears normal here but I want to point
out this require statement that require
statement is not an angular API it's not
a browser API it's nothing that no one
understands but webpack understands it
so when web pack is processing this echo
script 2015 or typescript file you can
see that require and say oh you want to
bring in an HTML template
let me also build that into your
JavaScript file so everything's put
together and that's nice because now my
application can be served from perhaps
just a single file I don't have to send
down templates and all this other stuff
but it always worries me when
applications take a dependency on tools
because in the world of JavaScript how
long the tools stick around you know
Bower was a pretty hot tool like three
years ago how many people still use it I
mean there there's a lot of people still
use it but you know how many of the cool
kids still use it I've also seen library
and framework authors struggle with
modules and dependencies I mean I'm
building let's say I want to build a
framework 1x probe 2015 how do I publish
that to other people to use and do I
need to build things ahead of time do we
need to compile everything to the
universal module definition that works
with all sorts of different modules
except equi script 2015 modules and what
do I do about the polyfills that I
require do I build them into my library
or do I force you to load them in the
browser there's just all sorts of crazy
things that go on with modules and then
the tooling in the space that you need
things like web pack and the transpilers
and although NPM this install this an
NPM install that to me it's often like
being on the ship that's on that ocean
right there there are some days that are
very exciting you're living on the edge
you're swirling around in the ocean and
everything is great and it's just so
exciting and then there's days where you
get like really close to that hole and
you just think the whole projects going
down and you're gonna die and you just
want to get out of this world and get
back to something sane like C sharp or
something you know something that
someone has thought through
perhaps excluding asp.net cooler but
anyway it's nuts things break all the
time so if you are going to embark on a
something that's going to use at my
script 2015 I hope I haven't scared you
I hope I've just prepared you it will be
the future and if you do it today
yeah maybe things are still a little bit
early so you're gonna experience some
pain the biggest pain to me really is
the tooling and setting up a build
process and all of that is extremely
complicated and brittle and fragile
anyway I'm gonna be sticking around for
work questions I'll let you go since
it's a last session of the day you
probably want to get out of here and do
something interesting but if you want to
contact me that's my email address I can
send you the slides or whatever that's
me on Twitter that's my website that's
where I do videos and I think SSW is
holding some ask me anything session
downstairs with me after this so if you
want to come down there I can answer
questions there thank you for coming out
have a great conference</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>