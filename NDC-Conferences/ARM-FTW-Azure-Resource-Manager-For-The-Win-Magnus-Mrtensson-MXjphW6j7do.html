<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ARM FTW – Azure Resource Manager For The Win - Magnus Mårtensson | Coder Coacher - Coaching Coders</title><meta content="ARM FTW – Azure Resource Manager For The Win - Magnus Mårtensson - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>ARM FTW – Azure Resource Manager For The Win - Magnus Mårtensson</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MXjphW6j7do" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to the session
where I managed to get to acronyms in
the title hey sorry so um when you run a
your applications in the cloud there's a
couple of ways you can do it the main
ways is to either just happy-go-lucky
and do stuff and that can be really
really fun and there's also then the
other path and that is to try to figure
out how to do it really well both of
them are very valid I'm not saying one
is better than the other and you know
they're quite enjoyable both of them and
I'm here to talk to you today about
specifically figuring out understanding
what the platform is about so let's talk
about you first are you all using Azure
everyone using Azure yeah right so you
have asher subscriptions hands at one
hand up for everyone who have anything
in Azure in production that's a lot of
you right and so i i've seen hopefully
you'll learn something good in this
session that's the plan that's the goal
that's what I'm here for
I've seen you know people who have been
on Asscher since many years and they
still have done very little of this
right little of the stuff that's in my
in my talk so everyone is in good
company no problem there i'm of course
magnus Martinson i run my own company
lofty soft I'm a consultant with Azure
and stuff I've what's the first person
to become an azure NTP in the Nordic
countries so I've been here for a long
time and I that's my my job is to help
people get on Azure and be productive
and do good things that's what I do if
you have any reason to contact me at all
don't hesitate to shoot me an email
tweet something nice on Twitter right
now because I have really really bad
self self esteem so in boost me up
I'm tech kidding I I would be amiss if I
didn't mention the global Asha boot camp
because it's one of those you know
community things that I love and I'm
passionate about 250 locations was the
last global attribute campus was the
fifth in order
it's all over the world it's one
specific day there's going to be a new
one sometime next year in the spring and
it's it's massive
it's just a day of Community Fund around
the world and to end the event it's like
30 hours right it starts in New Zealand
timezone in the morning and it ends when
the people over and actually Hawaii is
not on the map but it ends when Hawaii
goes to the beach right so basically
that's that's the event it's cool oh so
about you know ten years ago Microsoft
created their cloud platform right and I
think many of you have seen this slide
or a similar slide this is not entirely
up to date I I keep bumping up the
number of regions there it's 40 now
right not all of them in production but
40 regions around the world the reason
most recent addition was Africa which is
cool finally cloud cloud provider in
Africa but this right when people see
this they go whoa that's a lot and
there's more than this right there's so
many things in the platform how do we
handle it all what do we do how do we
get like wrap our head around this and
be affected in this how do we even know
which pieces to use but before you start
thinking about how to use these specific
services to to build your you know your
dream solution and make a gazillion
dollars or what have you
before that understanding what the
platform is about how it takes how it's
how it's really really wired up can help
you a lot because there are all these
concerns that you will run into how do
we handle these things deployments and
monitoring and billing and access
control and more how do we do that in a
good way I've seen so many customer
cases where I'm called in to help them
sort of see you know the forest there's
lots of trees in the way right it's come
back to that analogy actually later but
it's it's difficult to handle this beast
and if they see their their Asscher
consumption bill going up up up and they
don't actually they don't understand
anymore what's going on
so Asher quite recently it's been around
for a while created this new deployment
model called the Asha resource manager
you are aware that they moved from
another model previously in the blue
portal which is now called a classic
portal right but the old portal the
classic blue portal had one model
underneath called a sure service
management ASM and then Microsoft moved
over to a new model called a RM resource
management instead and that's the thing
that underpins the portal that we use
today so what they did was they required
every service that wanted to be exposed
in the platform to implement this
provider contract and that way it's you
know extensible to infinity right you
can add more more services just you know
remember maybe some of you have used the
old classic portal and this this
scrolling list on the left-hand side
kept getting longer and longer it was
just cumbersome it didn't really work
that older model was about handling one
resource at a time this new model is
about handling many resources together
and you know from the other end of
things from your end of things there are
lots of different tools that you can use
to to take advantage of this provider
contract and in between it exposes a
restful api that you can talk to we're
going to look at that as well so what do
you do with the resource manager again
you deploy stuff and you can deploy your
resources quickly and in one go you can
organize or it helps you organize your
resources into groupings that make sense
to you so that you know that that group
of resources over there that's that app
and maybe that's over there that's the
testing environment so that helps you
with that and it also helps you with
access control
there's role based access control
involved here and that that got
implemented at the same time of the
resource management model so it all kind
of starts with the resource groups a
resource group is an empty bucket that's
how I like to think of it you have to
have a bucket for every resource you
must have a bucket you have to say that
resource goes in that bucket now I'm not
talking about bucket since in the sense
of of storage buckets a lot of AWS stuff
here but I like to think of it as a
container for your stuff and all
resources must be in a container but a
resource group that you create Cree if
created in a data center you say I
create this resource group in like West
Europe or somewhere but the resources
can be anywhere and and the reason for
that is that the metadata of your
resource group definition has to exist
in a data center somewhere that's why
it's L a sure which one it doesn't
actually matter it could be anyone but
that the resources you know logically if
you have a web application deployment
with multiple regions well then all
those resources may be in different
regions around the world so it's just
some way for you to organize and there's
not multiple levels or anything there's
one level there's like subscription
bucket your stuff so let's let's go and
you know I've been talking for a while
let's go and look at a template because
resource groups and templates Asha
resource management templates is what
it's all about and here is the sort of
the simplest possible template it's
actually a null template it doesn't do
anything it's empty
but it shows you that what the sort of
the headlines the headings of resource
groups are there are not more than these
the parameters where variables resources
and from output so input output and your
stuff in between it's actually not more
difficult than that so we're going to
run this template but I want to also
show you this second template I wanted
to create the simplest template it
doesn't have any input it doesn't have
any output but it has one resource it
specifies one resource and can you can
you tell me what resource that is anyone
it's a storage account correct it says
right there it's a Microsoft top storage
slash storage account that's the type of
it it has a name and such an allocation
and it specified so a template is a
string of JSON if you will right it's
just it's just a definition let's go to
execute this thing and I'm doing that
from PowerShell in this case first I
need to create my empty bucket and I'll
do that by saying new resource groups
when I do that when I do that if we go
up to the portal here here's a sure and
I click on resource groups actually I
didn't show you that it was empty first
see hopefully we got Internet and stuff
it's slow but it's going to work yeah so
it's loading up but it's really slow and
that's fine conference Wi-Fi Wow that's
horribly slow and there's nothing there
ah there is risk don't worry elevator
music thank you for that and there it is
so there's my resource group my arm for
the wind resource group that I just
created from the command-line right that
my empty bucket and it's entirely empty
so if I run this this template that we
had the null template that I showed you
if I run that what's going to happen you
think so I'm submitting my template to
the empty template to Azure and it's
validating it and it's checking you know
should let's let's go and execute this
thing it's a valid template cool let's
execute it it's done so it doesn't do
anything right it's a valid template but
it's empty so instead I'm going to show
off my mad powershell skills by
selecting from that line which means
that I can skip to the other other
template right and let's run that and
here we go so it's executing now the
other template with one resource group
the one that had one storage account in
it and it's going to take a few seconds
for Asher to actually provision my
storage account so this thing the
verbose thing puts out puts all the blue
stuff
and so we can see and it comes back in
at pings and things if you don't do -
verbose you're going to just wait until
it's done at least now you get some
pretty blue text so they're resource
storage created since this has listed
some of the hill little cases we'll see
if I have to hook up to maybe the wired
I didn't actually know that there was
wired access let's see if I can just
works it's fine so there it is there's
the resource that we defined right and
there's one more thing that I'd like to
call out here early and it's the mode it
says mode incremental there are two
modes incremental is default and that
means that whatever I have in my
resource sorry whenever I have in my
template go ahead and add that to my
resource group and you can only execute
a template against one resource group at
a time and the other mode is complete
complete means all the stuff that I have
in my template that's the stuff that's
going to be in my resource group and
please remove everything else that it's
also in that group so be careful with
that you might inadvertently like delete
stuff if you go with complete mode but
sometimes that's what you want
you want to have your templates be the
only source of truth for the resource
group okay question spots yes the yes
the complete mode will be the truth so
if you have a a web application deployed
with an extension and you deploy a
template with complete mode without that
extension I'm pretty sure it's going to
go ahead and remove those because all
those extensions and things they are
resources so they will be killed off so
yeah be careful and know what you're
doing when you're doing that so
templates are declarative you can read
them and you can you know even if you've
never seen a template before you can
like read through it and figure out what
it contains
if you run them you know if you rerun a
template if I go and do this again this
I can do this all day it's going to go
and validate my template and it's going
to go and see hey let's deploy these
resources oh there's a storage account
hmm that storage account already exists
so I guess we're done right so it's it's
item potent you can fire this off any
number of times it's not going to do
anything
the subsequent times right so that's
exactly to your point if you make yes
yeah yeah sure sure I mean it's going to
it's kind of like you can think of it
like what's the thing you do for servers
desired state configuration it's kind of
like that but for resources
so it'll whenever you tell it to do it
will do it if you do it again nothing
happens it's already done so you can do
it all day and and it's easy to deploy
now multiple services to multiple
regions I just had one and again my
samples in this in this presentation
they will be simple because you know
it's intended to be simple so you have
resource groups and you have your
resources which is better here here's a
web application that's a server with a
database on it and there's a storage
account do I deploy them to one resource
group because they're one application or
do I deploy them to separate resource
groups which which is better when you
think one and it depends so do they have
the same life cycle maybe but not
necessarily it depends on your logic so
again yes I had to put it depends on a
slide right we hate that but it's true
you decide and if you have multiple
different applications maybe accessing
the same database it's highly likely
that the database is something you want
to keep for a very long time the web
application may come and go right but
the database is probably data you want
to keep so in that case there's a
there's a case to be had for actually
putting them in separate resource groups
and also if you add access control to
the mix maybe you want a DBA to access
the database but a DBA should access the
web application No
so all of those environments I mean how
many environments do you have which ones
do you have development what do you have
test and you have six seven seven right
right so you can have multiple test
environments of course load test
environment manual test environment you
can have productions in multiple regions
maybe you have separate resource groups
for that at least you have lots of
different environments for your stuff
right you have many and you know fair
question is do I need to have a template
for each of my environment
kind of feels a little bit redundant and
and of course you don't have to have
that you usually have one template for
your environment and then you pair that
up with parameter files so it looks like
this here's my other template which is
just just a little bit more complicated
it's still simple it has a few
parameters so it has a website name a
SKU name which is the name of the size
of my web application it can be from
free to a premium tier you have to
choose one and then there's a SKU
capacity which is how many instances of
my web application should I have so down
below in the resources section I have
and this is this is a little bit funny
actually I have here a a web the type of
this this resource is web Microsoft bug
web / server farms and as we just do you
have server farms and Azure really yeah
it's the thing that they in the portal
call that the app service plan right now
every tech guy knew what a server farm
was and I bet the tech people said yeah
so this resource is called a server farm
and then some marketing person was like
farm farm and what are we peasant no we
can't have a called farm so let's think
of another name so we'll go with app
service plan because that's so much
better
and then tech guys as well as what's an
app service plan and I know what a
server farm is right and the same so I
have I have that specified here
if you there's a little function they're
calling to my resource group and getting
the location so I'm intending to deploy
my my server farm to the same location
that I specified for my resource group
in this case and then the second so the
thing is that every web application in
Azure must belong to a server farm or an
app service plan so you have to have
both of these resources here and the
second resource as you can see it's a
Microsoft up web slash site and the same
thing there right so we have websites on
Azure and then somebody said no no no
we're calling everything an act now site
is you know the 80s the new name is is
app so it's Web Apps annasher right but
underneath the covers the resource is a
site so you know server farms and sites
that's what we have but we're calling
them apps and you can see here that the
this resource depends on the farm
resource so when when asher sees this
when the resource manager sees this
template is going to figure out that hey
i need to deploy this the server farm
first and then the site that's what
that's what it's going to do or not
maybe not deploy is the name maybe
provision is the name so in my
parameters then i have a parameter file
here for my development environment it
has a name and it has a tag to it
actually will talk more about tags later
but it this is going to go with the
defaults queue which is free tier and
it's going to go with the default number
which is one so i'm going to get one
free instance when I run this template
my test environment it's a slightly
larger machine it's the b1 tier but
other than that I have one instance so
the testers can do their thing and then
I have the production environment it
runs on the S ones here so it's a
standard sized peer and it has two
instances so what I want to do now of
course is define here in my you know in
my powershell script i want to define
these three environments and i'll point
to each of the the parameter files i
have a nice script block here which will
yes each script block will run in its
own process I have to log into Azure
select the intended subscription and
create a resource group if it's not
there and then do my deployment and then
I for each over that and I do a start
job in the background one for each so if
I run get job now there's nothing there
there's no there's no job in the
background for those of you who didn't
know you can run things on the
background thread and in PowerShell so
I'll fire this fire this off and it
starts 3 background jobs it's now
running that little script block for
each of my environments with each with a
separate parameter file so this is
actually in parallel running three
deployments on Azure right and and I
since it's in the background I can still
do stuff here in my environment and I
can see if i refresh here it comes back
in its s yep you got three deployments
running here or three script sections
running if I go up to a sure hopefully
should have already that so the new
resource groups are there and
deployments are happening to them so you
can do this and think about scenarios
such as continuous deployment
maybe continuous testing why not I've
seen a lot of cases now where people are
starting to build scenarios where they
run a test suite after each build right
so they build a code they run a template
to deploy an environment to Azure they
run the deployment to that environment
now they have their application in the
cloud and then they run a load test
automatically on that environment and
then they go and delete the environment
again so we'll just run your you only
pay for the environment in Azure while
you're running the load test and after
the load test is done the environment is
gone it's pretty efficient and and many
people are not at a point where they can
do that but it really should be right
really should be because it's cool it's
way cool so let's see what we have
hopefully here well if I drill down into
each of these environments you're going
to see that it has indeed the number of
of resources and
nice of the resources that I specified
so here we go that's the one of my
server farms my app service plan there
and my web application and so on for
each for each of my environments
right now when you do start using arm
and those kinds of things there are of
course some help for you I mean this is
Microsoft after all so we have all the
expected tools I've shown you with your
studio code of course there's Visual
Studio and the portal we've seen that as
well you can go into and interact with
the resources and use the tooling now I
love this picture it's it's one of my
favorite pictures it's it's the picture
that reminds us that we're humans right
and I hate that but it is it's the
picture and this is of course it's an
auto mobile right it's it's a wagon
which is able to be mobile on its own
without a horse right and that was
really terrifying to some people when
they started rolling down the street
with no horse it's like oh my goodness
it's it's the wagon of death it's the
devil's carriage so they kind of when
some of them they put like a horse's
head on the front of the carriage to
sort of soften the blow for people right
and and some of the early designs of
these had a whip holder as well because
you know if you don't have a whip hold
we're going to put the whip right so you
need that and and and this sort of is
the backdrop of the conversation about
the fact that again we are human and the
cloud and templates and you know
infrastructure as code this JSON crap
that's kind of new to a lot of us
especially if you're not a developer if
you're at an IT person you like I've
never needed JSON templates before and
what do I do now like I have to start
using one of those tools like Visual
Studio code Visual Studio are you
kidding me no I won't do it but you
really should it's a lot of fun it's a
lot of power involved right it this
enables IT to be Superman right and
women right super people amazing stuff
because no
when you walk into the IT department and
say I'd like to have a database so
they'd look up you're like yeah here's a
form you fill out the form and then
maybe like we have some new parts coming
in some new memory and RAM and stuff and
some disks we're going to upgrade the
sequel server and that's going to be
like 14 days maybe
and then I'll process your request and
then at some point you may have a
database possibly if you ask me really
nicely right you want a database sure
click there you go right I mean it's
it's so vastly different it's an it's an
entirely new proposition you want 200
databases
no problem right so really a command
line is of course the method of choice
for many 90 people and and we asked tabs
if there is dev people in the house
right should also really use this I
basically shown you all you need to know
about our arm templates from the command
line it's like create resource group
make deployment it's like two to
commandlets and of course both
PowerShell is actually now open-source
and on Linux which is so weird and and
azure the cross-platform command-line
interface there the azure CLI it's
awesome by the way you go on the command
prompt you go in Z and then you tell it
what to do a Z group creates you create
a group in Azure Wow really cool I love
them both I used PowerShell here because
I wanted to do that background thread
thing but I used them both equally it's
transparent to me just choose one or you
suppose I don't care and from code so
I've seen this is actually a little bit
difficult to read but it's fluent at
least so you can like tack on any any
number of configurations you want so you
can create an application
I had this customer once and they have
their own load testing service their own
software that they ran and their
customers could go to their portal and
requisition a load test and say I'd like
to have a load test and here's the end
points you're going to load test on and
la-da-da this this size of a load test
etc order quick and then their
application went and provisioned some
VMs in Azure with their load testing
agent on it
and just fire them all up and run them
collect all the data and shut down and
remove all the instances so you can do
it from code easily now I'm going to
tell you the secret about a sure boss
for effect the secret about a sure is
that there ain't nothing going on but
the rest okay it's actually not that
difficult and this is a good thing too
to have seen and and figure out and I
think I think you're really going to
love this if you browse to let me zoom
in on that in case you haven't been
there if you browse to resources that I
sure calm and some of this functionality
is now showing up in the portal as well
but it started over here and I still
like this site if you go to resources
that I show calm you can start drilling
down into the resources you have and see
this sign in that I have here I have
access to a few subscriptions let's go
to the MVP sponsorship thing that I'm
using for these demos and here are my
resource groups right you've seen me
create them so there they are
and let's drill into one of them let's
go to the production environment and
there's some in the web the web resource
provider has a server farm and a site
there and I can see I can drill down and
see the site and all the properties on
my site I can see the server farm there
and the properties on that and I can
drill down and see everything I can find
there's rudimentary documentation there
I can find how to use PowerShell to
deploy that environment and I think I
could literally copy this out and create
a template from this if I wanted to but
I can also do edits in here it's really
cool so if I go in here and I say hey um
this server farm things why don't we see
if I can scroll down yeah again why
don't we change the capacity of this
farm from two to eight let's let's do
eight instances instead and if I do a
put request against this I will now
submit my changed environment back to
the to the API and if all went well we
can go back to asher and go to my
production
environment there and we can see my farm
the one that I just changed right now
you can see the farm and we can drill
down into it
and go to the scale out which is the
number of instances and check actually
was on the previous screen as well but
eight right so that's the change that I
just made
I went from two instances to eight and I
submitted it back to the API and I said
hey make this change and actually just
whoops there you go eight so I now have
eight instances on my web front-end tier
for my production environment I'm going
to remove that later that's actually
costing me real money or scoffing
Microsoft money in this case but why I
brought you here why I drill down like
this Westy to sort of give you the
secret right and here's the secret let's
let's focus in on the secret here we're
on the management endpoints here so
we're on management assure calm and then
you see flash subscriptions and that's
the subscription identifier so it's not
a secret or anything it's the unique ID
for this subscription no secret slash
resource groups and then the resource
group name with parameters prod it's the
name of my resource group and then slash
providers and then that's their a
provider name Microsoft up web slash
server farms and I'm trying to scroll to
the right there
it's not really going all the way to the
right let me escape this and then that's
the name of the of the website write the
name of my application so this whole
thing you're seeing there you know
subscriptions subscription name
resources resource name and then my
resource in there I mean what's what's
that remind you of what is that
what's a URL in a URI right it's the
endpoint to which you talked if you want
to do stuff with your site that's one
and that's important so I can do stuff
like I can say actually let's go to the
web application and do that for fun I
can go there and I if I if I talk to
that endpoint and I and I put a slash a
slash stop at the end and I I run this
command
that actually we'll talk to the API and
say I want to stop this website right
now so I just stopped my eight infants
if they're not taking any traffic so I
can do that I can talk to the API direct
but more importantly what I wanted you
guys to think about is that this whacked
that like this you know subscription
resource thing it's like you know if
your subscription is the root of a tree
your research group will be the branches
and the resources will be the leaves
right so it's a tree a substantial
subscription is in fact a tree and if
you have many of them you have a little
forest going so you all thought that the
cloud was a cloud it's not the secret is
that is actually a forest right so now
you know and essentially there's power
in that because it's like huh it's not
so strange is it I can wrap my head
around you know I I can understand a
forest I get that you know so I came
back to the forest metaphor that I used
earlier so cool so that's what it is
and and and and again there's tremendous
power and knowing this and understanding
this all of a sudden it's very tangible
right and you can it's organized it's
it's free and I wanted to show you this
if you are new to this and I find myself
going back to this resource time and
time again this it's you know you fight
you go to your favorite Bing and n
search github ash or templates you will
get to that repository and there's like
you know a couple of hundred in there
how many four hundred and ninety three
contributors and in there there's lots
and this you know it's reasonably
certain that there's a template for
doing most things right you can create
VMs Linux or whatever and you can create
a whole SharePoint deployment search
resource you can go here and start like
looking at the resources and trying to
figure out what they should look like
you can even copy these of course and
start doing your deployments based on
these things you know if I if I say find
a virtual machine let's see if I can
find one just one okay maybe I should
find Windows instead
sorry so find windows so any any one of
these let's say I go and do a service
bus you know service bus topic there's a
button there that says deploy to Azure
and that will actually take you over to
your subscription you can actually
deploy the exact template so that's
pretty cool and you can do that with all
these resources it's a good place to get
started so any any thoughts on that
questions so now we have the most yes
question over there yeah yeah so a
concurrency good question I I would say
that a sure that the the API will handle
them something you know not they will
serialize it will be in some order and
if people are trying to do updates at
the same time you'll get strange results
nobody knows exactly what in what
happens at the end yeah but but they
will not run in parallel they will run
one after the other on the service side
on the management API if you can call
the API cross-platform so you can call
the API from anything that can reach the
internet because it's a it's an it's an
HTTP rest based endpoint and and the
Microsoft has built SDKs or JD case or
what have you for different platforms
and different everything and if you
really want to you can do your own HTTP
calls exactly like I did just now when I
stopped where I changed the number of
instances and stuff I did it in the
browser of course but of course that
made an HTTP request to the restful api
oh yeah authentication and stuff all
that yeah so yeah you can authenticate
you will authenticate every actual
subscription always has an active
directory right attack attach to it so
that you will access your resource is
actually a good segue into into access
we're going to talk about that now
yes so you will authenticate of course
once you are authenticated you have some
kind of access and are allowed to
perform certain actions on the on area
management API and what a great segue
actually into role based access control
so I thank you for that and role based
access control was also implemented the
model before Auerbach for Asher was
either you had access to a subscription
or you didn't right and everybody was a
co administrator and I see a lot of
people are still doing this today and
it's completely and utterly wrong to do
it that way it's completely possible to
do it and a lot of folks are doing it
because they started using Azure before
Auerbach existed so I went to this
customer a bank a bank customer and they
are like their their main lead architect
he was like so proud showing me all the
resources here all our thirteen Asscher
subscriptions and all of our you know
they had stuff like 168 web applications
and all their stuff and he's showing me
the portal look at all this greatness
and all the time understanding them
thinking so you're signing in with a
Microsoft account
not even a corporate account when you're
signing in with a Microsoft account and
you don't even have multi-factor
two-factor authentication on this so you
are literally one password away from
giving somebody root access to all your
stuff like which security audit would
that ever pass I mean it's even it's
unthinkable
and so really am and I mean it in a nice
positive way but please you have to use
this correctly and using it correctly
means that you will sign in you can
allow you can assign granular
permissions to users or groups of users
and there are built-in roles you can
have an owner role a contributor role a
read a role but you can also go and
customize your roles and create custom
roles I'm not going to show that here
today because of time but you certainly
could so the general layout this is a
Microsoft slide that I copied there
looks like stuff glossary up there in
the middle and he has some subscriptions
and he gives access
as contributors to some of his managers
and the manager goes down and he creates
resource groups and he assigns access to
the resource groups to his Deb's you can
see that there's a if you saw like you
can see that this is a deaf guy here
it's very important that we sort of have
our our you know persona straight so he
has a t-shirt says 404 so you'll know
he's a dev and and then down there you
can actually grant specific access to
the resources themselves it's completely
possible I rarely do it there are cases
but it's not very common most commonly I
will use sort of resource groups as my
division right if you can see that maybe
you can so maybe you have a DBA and the
DBA should have access to the database
resource only not the other resources in
the same resource group that may or may
not be there so you can give access to
down to resources and you can give
specific access you can manage this
resource you can update it you can make
changes and stuff but you're not allowed
to delete it and then there are lots of
specific levels of access that you can
put and how to get to it is that you
click on the little people and the
portal everything has a little people
symbol and you click on that and you
start in the portal you assign you can
do definitely do this from the command
line as well I creates access and assign
access and that sort of stuff but
basically that's how it's done and you
know key learnings here is that you
should really really not use Microsoft
accounts anymore you should never sign
into Azure on a Microsoft account
because you can sign in with your
corporate accounts so you should do that
you can always do that and if you don't
know how to rewire all of your
subscriptions to point to your corporate
Active Directory I can show you you know
contact me afterwards if you want to
know how to do this it's not difficult
it's a one-time thing it's you know you
have to like it's there's a there's
chicken bones and voodoo and and you
know the blood of a virgin and stuff
involved but once you get it done then
then you you you have all of your
subscriptions lined up properly and you
assign access from your corporate
accounts and and also we have the
notion that you should be using groups
you put people in a group a team of
developers and you assign access to the
group not the individuals and and go
with leaf privilege again developers may
have read access on the production
environment they can see it but they
shouldn't really change it that's the
domain of the of the the DevOps guy he
has access to change the production
environment the developers can see it
and they can look there at the
configuration of it but there they
shouldn't accidentally be able to UPS I
deleted the production database it
shouldn't be possible right
I ran I'm who shoot I ran my template
against the wrong at the wrong resource
that should not be possible and and you
have to limit access because of these
things and of course there's always the
case of the disgruntled employee right
but you give specific access and you
monitor the change every time you make a
change in access anytime you make a
change to a resource all of that is
monitored right there's a there's an
audit log here so I can quickly jump
into Azure here and take a look at maybe
this resource group here and it has an
activity log it's not a lot of
activities there but I can go in and see
yeah so there's been website updates
I've been there's been some deployments
and stuff there's an audit trail for
anything that happens to your resources
and to access for the resources and you
should monitor this you should have
alerts firing off like if somebody you
could you know drill down to the
specific JSON which is part of the audit
trail and from here you can set alerts
on anything anything that happens you
can add activity log alerts and that
alert can go to an email alias it can go
in the US I think still only you can go
to a text message and and could also go
to a web hook so from a web hook you can
do anything so maybe you want to be
alerted if the site is scaling out maybe
that's a good thing that it's scaling
out auto-scaling lots of traffic to the
site but maybe you want to know about
that and follow up and see why are we
scaling out that we're having so many
requests to our service right now
that's cool probably hopefully it's
great but that might be a thing you want
to be alerted by right so so that can
totally be done and it should be done
and for access specifically you should
definitely follow up when somebody
assigns access there should be somebody
checking y-yes so in that can you hook
up the alerts to a resource template so
typically how you would or you mean
configure the alerts
yeah so you mean after the the after the
alert fires something else happens or
you mean when you deploy them yes yes
you can you can you can put most things
in the templates and and have that as
part of the deployment probably these
things too so you can configure your
alerts and stuff using the command line
and you can have a script for that and
you should you should have a script for
that and should be able to verify that
yes this environment has indeed all the
alerts and stuff that we intend
absolutely good good question
now there's another thing that most
people don't do and don't know about if
the fact that you can assign tags to
resources and that gives you the ability
to sort of divide the bill right you can
you can am i missing a couple of slides
there this is interesting quick check
okay so tagging you have it was right
you have maybe your resources you want
to know how many resources you have and
to whom do they belong you know
this database over there whose database
of that can I delete it is it important
is it production is it testing who knows
right so you can tag your resources and
it looks like this and the templates you
can set for instance the Department tag
Rd in this case you can do whatever
right in terms of tags because tags are
every resource any resource including
resource groups can have 15 key value
pairs just a string in a string and you
specify exactly those
tags and I did here for my environment
and if I click on the little label icon
there it'll show up all the tags that I
have and I did this right
I gave them some tags my deployments
that I just did so that they have a
department it's R and D and we're on
being here and then I have an
environment tag for specific resources
so if I click on one of these tags I can
go hey Rd and all of these resources
belong to Rd ok cool well what's the
development environment it's those
resources and where's the the where is
the production environment it's those
resources so key value pairs enough
helps you and those key value those
those tags show up also on the bill at
the end of the month which means that
you can give that to the Excel people
and and they love that stuff right they
can go in and split the bill every which
way and calculate how much Rd is costing
and how much that production environment
is costing and that sort of stuff you
can make graphs from this and it's
really really powerful and most people
don't know about the tags and they don't
use them and again you really should and
and then there's more there's policies
that you can apply to to your
subscriptions policies lets you
customize a rule define a rule which is
applied to your subscription it's
different from role based access control
a policy is sort of on the subscription
not on the person right there are the
identity signing in you can apply this
and enforce you know such things as
naming conventions which types of
instances can be deployed I mean
developers might think it's really funny
to deploy a godzilla-sized machine
because it's really powerful and it's
also super expensive so you could
actually have a corporate policy saying
no godzilla-sized machines right and you
know well it's fun it's expensive you
can specify specific regions maybe you
have a geo compliance thing we're not
allowed to deploy outside of Europe or
something like that and so the structure
of them is this it's a little bit of
JSON again it's if something then either
deny audits or append so a couple of
examples of that if the location
field of my resource is not with Europe
or northern Europe then deny the
deployment so you're only allowed to
deploy in Europe or in these two regions
specifically here's one if the if there
is a tag that does not if if the tags do
not contain the key cost center denied
the deployment this is evil manager
right the manager enforces a policy that
says you must have you shall tag or you
shall not deploy right that's what that
means so it's evil manager there's
actually nice manager as well and that's
this version here it's a little bit
smaller text but it says that there's a
if all of the following is true there's
tag there's a tag section and there's a
tags but cost center that doesn't exist
then appended the deployment with a tag
cost center and label it Rd so that's
actually this is nice manager version
right it helps you because that applies
the Rd cost center tag to every
deployment that's made and and I think
that's smart to do on the R&amp;amp;D like if
people are Andy is deploying resources
over and over again and trying different
things out there actually doing what
they're supposed to be doing there are
nding
right they should be doing that and back
in the days in the past you kind of
divided access again access was either
it was binary right either you had no
access or full access so the way people
divided environments you know separated
environments from each other was by
having separate subscriptions right and
also it's easy to see because you get
one bill for one subscription you could
see this is the Rd subscription and here
so much R&amp;amp;D costs because it says right
here now today in a second and today you
don't have to do that you can you can
have one subscription for your entire
enterprise so long as you know the
amount of number of resources it's
there's a finite number of resources to
a subscription but still my point is
valid yes
yep yeah so if the developers used the
portal and and you apply the evil
manager principle thou shalt have a tag
you can't use the portal anymore because
you can't actually put tags on things in
the portal when you create them you have
to first create them and then apply the
tag so effectively that very
well-thought exactly that and basically
you're disabling the use of the portal
by using that evil manager principle
there so they have to use template muha
so yeah evil manager so when a policy is
evaluated you can block or modify the
request an audit event is always
generated and any alert can be generated
based on the events so if somebody tries
to deploy or godzilla-sized machine they
get denied and there's an audit trail
you know exactly who did it hahaha you
can go and check and see who deleted the
database right there's a blame game here
and but yeah point here is that it's
very precise everything you ever do is
going to be logged and the policies will
be evaluated as part of the deployment
that you make so typically you have
maybe like a set of policies each in its
own individual little JSON file and you
execute them from the command line on
your subscription and you apply the
policy if you can apply the policy on a
scope subscription resource group
resource you can you know have a policy
which is a subscription why'd thou shalt
tag or not deploy you can you can do
that and you can also go down to like
specific resource groups and say inside
of this resource group you are not
allowed to deploy virtual networks I
don't know they could be anything so
there's lots of power there I guess what
I've been talking about here now is that
you can remove human error error-prone
stuff you can have security control you
can do things as such as have really
drastic cost savings auto scaling of
course is one but here you can deploy
environment do testing in the lead
environments
run environment you can run these things
all day long it's really powerful and
you know that your environment is
exactly what it's supposed to be when
you run the template maybe with complete
you know that this environment is
exactly the same every time I deploy it
there's not going to be a human error
it's not going to be any mistakes and
this is also good for you know the last
line there in fact I don't know if you
know but you can't say that we're just
once you have to say three times so it's
automation automation automation right
that's very important you have to do
automation automation automation
otherwise you know you're you're
spending time your time that you should
be focusing on your business on your
development efforts on the tasks on the
task board doing manual labor and we
should never do that it's just unheard
of really if you think about it and if
anything of the stuff that I've been
talking about today is new to you
awesome go home and apply this
immediately and learn about this because
it's worth it you'll learn about it once
and then you use it forever and it saves
you time so before I wrap up I'd like
maybe I don't know if it's obvious I
kind of like talking about this stuff I
love this and and if you have any
thoughts again afterwards you should
email me and stuff but any any final
questions and thoughts yes so what you
can do that's a great question what you
can do is you can go and manually deploy
your environment and Azure use the
portal use whatever means and go into
ploy and do the thing and once you have
your environment exactly like you want
it you can go and say here's my resource
group here's my production environment
now it's it's set up exactly the way we
want it and then you click on automation
script and you get a full template of
the entire environment
no I know and there are some edge cases
but I wanted to show everybody but
mostly here's the template for this
exact environment I can copy it from
here and I can save that template and I
can customize it and then I have the
template that I need but yes there are
some cases with I myself I'm struggling
currently specifically with deploying
the the VM Diagnostics extension to a
scale set there's there some s right
there and so it's not you know it's not
perfect it's going to help you a lot but
if you have a specific question do we
email me on that specific question and I
can help you with it now figure out ask
the right person I have some access into
Microsoft and I can go in and put this
on the correct desk any other questions
No so everything I said was completely
obvious and maybe I was very clear I
don't know Muller we still have about
five minutes but let me wrap up as I
started out I said that you know there
are some new things you need to learn
you can be happy you're lucky you can be
that and you should you should be happy
but but if you are doing things randomly
and don't really have control in some
cases I've seen a poor rate of cloud
adoption in an organization the tech
people really wanted to do it but they
couldn't figure out how much things were
going to cost and that sort of thing so
when they told that to the managers they
didn't the managers were asking like how
much is this going to cost us and they
didn't have the proper answers and the
managers too said well then we're not
doing it right actually they didn't
sound so happy when they said it them
more like a demand we're not doing that
because you don't know what it's going
to cost you can't tell me these things
well now you can right so there is no
excuse for anything anymore and invest
in this because seriously you learn at
once and then you you enjoy it forever
if you really want to know more stuff
I'm also going to plug my workshop I do
have a workshop two days we go through
everything in detail and we learn how to
write templates and and do policies and
access control and that stuff it's a
really really handy thing to do
so email me if you want to know more
about that
and with that I am done thank you for
listening today</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>