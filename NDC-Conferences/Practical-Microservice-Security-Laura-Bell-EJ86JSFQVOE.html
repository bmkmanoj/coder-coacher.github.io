<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Practical Microservice Security -  Laura Bell | Coder Coacher - Coaching Coders</title><meta content="Practical Microservice Security -  Laura Bell - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Practical Microservice Security -  Laura Bell</b></h2><h5 class="post__date">2016-09-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/EJ86JSFQVOE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so it's still just about morning so good
morning ish my name is Laura you may
remember me from such talks on Wednesday
as bootstrapping security if you were
not in that room you missed out and you
should feel really bad and as penance
you can go and watch the video
afterwards so that'll be fun
think of it as homework before you've
even begun we're here today to talk
about buzzwords and security today's
buzzword microservices don't be offended
though I like to play around with the
fact that we kind of keep catching new
technologies to the people sat to over
the far side you seem lovely hi hello
I'm still gonna look at you and point
you out if you want to join the rest of
us you're more than welcome but please
stay where you are if you're comfortable
right so let's get started
this slide is as much for the viewers at
home who are going to watch the videos
is for you please note that almost
everything in a space you should know as
engineers moves relatively quickly and
as such a nice talk that I do today in
six months might have advice that
doesn't make sense anymore so whenever
you come into a talk like this always
remember that this is only really good
from this moment in time and always go
and have a look up and check if kindness
has changed before putting this into
your production environments and going
yellow so I run a small company it's
very small where five people were based
out of Auckland across the way we bring
security into very fast-paced life
cycles and we do that in six countries
for those two clients but I'm not here
to sell what I do there I'm here because
this is my window in my office I spend
as much time cutting code sadly and my
team would rather I stop then I do
advisory and teaching and training and
speaking so a lot of what I'm talking
about today isn't from some nice
beautiful textbook that will you know
bestow the world of knowledge it's
because I screwed this up it's because I
see this every day the Dan dirtying code
now I know most of you add net
developers please forgive me I'm a
Python developer and before that I was a
PHP developer
before that I did Java and before that I
did COBOL which is basically the worst
family tree of skills you can have as a
developer so this is my Kanban board
it's a window
it's post-it notes it's for an
open-source project that I write and
this is me I write bad code I help other
people write code that sucks lesser than
mine hopefully in today's talk we have a
lot to cover and it's going to come with
a couple of caveats firstly I'm not a
massive fan of the code on screen demos
I can open a terminal
I can type some green letters and hit
enter with a flourish and you will all
feel satisfied that I am therefore
technically qualified to speak to you
today but I'm not going to waste your
time there's going to be a few tools and
things I mentioned that you can go away
and play with but they're really well
documented there are good tutorials out
there and the slides have links in them
so if you follow me on the Twitter which
lady underscore nerd you can get those
links and you can have a play so please
don't judge me on my lack of demos I
just don't think we is a good use of our
time at this point with too much to
cover and this is what we're going to
get through we're going to talk about a
couple of security fundamentals because
for some of you you've actually not
spent most of your life in the dark
places on the internet so there's a few
things we have to remember we're going
to look at some prevention techniques in
microcircuit X's so how do we stay safe
how do we stop people from attacking us
or make it harder to attack and then
we're gonna look at detection and
survival because the sad thing about
security is that it's almost guaranteed
eventually you will get compromised
that's going to happen now that's sad
makes everyone sad makes me sad but if
we're prepared to survive it doesn't
have to be the end of our companies and
the end of our tools it is just another
day it's another issue much like a
scaling problem as an issue and that
mistake and deployment to production
that kind of makes everything cry is a
bit of an issue we can get past these
things so let's start with some
fundamentals now things I'm not going to
do in this talk we literally have Sam
Newman in this conference he wrote a
book on this we have many many talks
about how to do the micro services if
you've not been to one of those before
or not read the book stick with it
you're going to be fine today
but I'm not going to spend 20 minutes
explaining what a microservices to you
we're going to jump in a little bit
further ahead so just as a refresher
this is what applications used to look
like you made code it made squares we
called the monoliths that's great how
many of you are the caretaker or
custodian for a monolith yes how many of
you a greenfield site and your
application already looks like this in
its entirety these are the people to be
jealous off so everyone else in the room
go find those people and find out where
the jobs are because actually most of us
end up building this first it's actually
a rare company that goes you know what
MVP break great idea let's put it on the
world and I'm going to micro service
from the start the only people who do
that are the people selling micro
services as a consultancy or as an
advisory service or it's literally their
business model most of it right
something terrible in a language that
probably wasn't designed for that
purpose at 2:00 in the morning when we
just had inspiration
that's how products exist and if you
have code on the internet you aren't
proud of that's still in this state yeah
absolutely we all do that's the reality
of software but we're talking about
moving from this monolith to these micro
services distributing it out these are
not new ideas it's been going around for
a very long time service-oriented
architectures way back in the day before
we got so good with buzzwords did some
of the same stuff break it down split it
up make it loosely coupled and
everything will work in a blissful
utopia if we can go faster we can spread
things between teams you know all of
these things I don't need to bore you
with this there are advantages we know
that but what we don't often stand up on
stages and do is go actually sometimes
this sucks and it's hard actually we
can't always do all of these bits and
there's consequences to doing it I'm not
saying go back to monolith that's saying
you know don't check monorail and think
it's the end of the world you know
everything is changing it's a bright new
future this kind of feels like what
we're doing with micro services these
days now I'm a security person I spent
about 12 years doing bad things to
computer systems
lying cheating and stealing is basically
what I do but I now do that for defense
so I work with organizations to help
protect from people like me which is
kind of nice I've got some knowledge of
how this is gonna work I care about
three things now in my industry were
really bad with acronyms and we decided
CIA was a really trustworthy acronym for
security but either way indulge me
this is various text book as you get
from my talks we carry out
confidentiality so if I have a secret I
want to make sure only the people I've
given permission to have that secret can
get to it makes sense right integrity if
I have a box indulge me I have bad
analogies for everything I've got a box
I'm going to put it on the table I have
an apple they place the Apple in the box
I do magic and that's what my systems
doing magic and at the other side there
should be an apple it should still be in
the same state that I'm expecting it to
be in because I control all of the magic
in that box if I put my Apple into my
box and a banana comes out the other
side and I'm like what what just
happened here we've probably got a
problem if how many of you in finance
any financial system Z people mm-hmm how
happy would your boss be if you put 1
million dollars in and 2 million dollars
came out for no real logical reason hmm
they'd be happy for five minutes and
then socks happens and then we all cry
because sarbanes-oxley really doesn't
like it when numbers magically mutate
into new ones even if they're good for
our business and availability let's not
forget secure systems have got this bad
reputation for being horrible unusable
piles of crap if it's unusable or you
can't get to it or it's slow in any way
it's not secure so availability talks
about as being available to our
customers we're not subject to denial of
service those kind of attacks in fact
anyone who's done any threat modeling
before will recognize this this is
stride this is Microsoft's open source
threat assessment modeling kind of
language I recommend you go and read
their stuff for a Microsoft stuff it's
actually kind of accessible and good for
humans so that's a good change
stride tells us the types of attacks
we're going to be subject to because the
world is are able to a stood place and
people want your stuff we're gonna do
spoofing and tampering we're gonna
disclose information I'm gonna try and
find all of your deep dark secrets by
the easiest way possible and in a world
of microservices where we split things
up and we've changed the way we're
thinking about our applications it's
actually a different way for us to think
about this kind of risk we can't just
apply this to an entire system anymore
we have to do it to something that's
distributed so let's talk about pretend
protection first things first
gonna go through a couple of basics but
I'm gonna send you up to some other
sources of information because there's a
few caveats if you're a developer and
you've not heard of OWASP for example
there's some basics you might want to
just go and read about it's not my job
today you've if you sat through Detroit
hunt you will start to get some of the
feelings sort of things you should
probably already know Scott Hanselman
and his first talk on the first day in
this keynote showed Stack Overflow posts
and I love Stack Overflow I deal with
people in 12 different languages most
learnt in most months and I can see in
code where Stack Overflow has gotten
involved because suddenly the coding
style shifts or suddenly magic happens
and suddenly a node developer who's node
every day is suddenly writing Python in
a very strange way in micro service
space the advice going out is the same
as wider application there is no like
special micro service version of
application security some of the floor
still exists if your place for going for
security guidance is currently Stack
Overflow I feel bad for you so this is
literally pulled from Stack Overflow in
the last it was about four or five weeks
ago the gist is somebody had asked how
do I store my passwords fantastic great
awesome there's quite steady sane
guidance for doing this it's been around
a while in fact the guidance evolves
over time and yet the big green tick
answer still remains md5 with a salt now
if you don't know why that's significant
again go and have a think md5 is no
longer considered any
we're near suitable for passwords and
it's the subtlety of this that I like
that this is what scares me because it
doesn't look like an obvious troll it
doesn't look like an obvious mistake
it's not somebody going a rock 13 then
we'll just saw them in plain text
because no one's going to see them that
looks like somebody thought about it
there looks like an engineer wrote it
and that's scary
so watch where you're getting your
guidance from so first link you should
go and go to if you're not familiar with
OWASP that's okay I'm not going to judge
you publicly please go and check out
their stuff they have a lot of things
they will stop down but they have cheat
sheets like this one and the rest
security cheat sheet is actually a
really good place to start
when you're thinking about API driven
development or micro services or
anything in this field the next thing
I'm going to ask you to do we start
minding your language because as you
start to see when we start getting into
some of the specifics of the
architecture we're really bad at
language my two least favorite words in
the entire universe of authentication
and authorization and as a community as
engineers not just security people we
abbreviate these two exactly the same
thing and use them in the same document
next to each other so for the purposes
of this talk and so that I don't confuse
anyone who's not used to separating
these terms out I'm going to talk about
authentication and authorization
separately so authentication you're
allowed in the door authorization
what you can do when you get there if
you work in an environment where they
throw these kind of terms around loosely
all the time or acronyms I do want you
to start calling out the absolute tripe
that's going on around you because this
is dangerous when we start assuming we
know what language means we get into
real security problems so let's talk
about our architectures now I do my
designs and my slides in a very simple
way I don't need to show you six lines
of flask in pythons go look I did a
micro service let's imagine each square
is one of our services I've used color
in this and little letters on them I
apologise for the white on the green it
looks less horrible on a screen each of
these services has different attributes
let's talk about authentication and
authorization from an it but
authentication so in this example we've
got our white bit in the middle so
normally there is something in the
middle of every system that is where the
real business happens right if you're in
a financial processing system there's
going to be some batch craziness in the
backend written in some awful language
from like millions of years ago and that
lives somewhere in the middle I'm
writing the edges and pulling out you're
going to have different services for
different things and they're going to
have different needs when it comes to
authentication so we've got a four
Authenticator just standard
authentication so we're talking
usernames and passwords we're talking
about certificate perhaps if you're not
a username and password kind of place or
a key if you're doing systems or systems
we've got use on the Greenes
unauthenticated
we don't need to get we don't need to
authenticate people to use this there's
a lot of use cases for services that you
don't have to authenticate against I
don't believe we need a world with more
passwords I think that's been going
badly wrong for 15 years so we've got
two fa we've got unauthenticated and
authenticated and across your
architecture step one of protecting it
is starting to map it out like this and
start mapping the authentication
requirements to each bit it's okay to
have different requirements in different
bits you don't have to leverage the same
stuff across the place there's a cost
and a benefit to making these choices
the trick is to be consistent and planet
and one of the problems of micro service
architectures is you devolve them over
teams so I have customers who have 180
developers and they have 300 micro
services because they're full-on micro
service happy we've gone gone deep with
this one but the trouble is those teams
actually there's no central
architectural point in that organization
there is no person who says well ok team
number seven you're good to go you go
make another one and we're gonna add it
and here's your consistent piece from
the middle and here's our guidance as a
whole the teams are autonomous only if
you like being autonomous in your work
choosing what you do and how you
implement it I'm hoping some of you
because if not get a production-line job
because that's what coding becomes when
you have no autonomy it's add button 3
to page 2 click commit nobody wants that
job but if you're going to be autonomous
we've got to figure out a way to be
consistent
got to articulate things like our
authentication one of the biggest flaws
I see in these kind of things is getting
it inconsistent and not understanding
what you've got where visibility is hard
in micro services especially when you
have a lot of them now you've got three
micro-services for your little demo yeah
you're good you can see all the code on
two screens if you've got 300 that's
hard authorization so we decided how we
can get in but what on earth can we do
when we get there you don't want to be
able to pivot through your services as
an attacker moving from an untrusted
service a simple one to get in to
through to the trusted ones by a
byproduct of how you're trusting the
services together that's how an attacker
works they will take a network of
connected things with hosts on a network
or services or people people work just
as well and they will hop between them
trying to get towards something more
interesting more valuable our
authorization has to be considered
across the whole piece and that's not
just as a service because a service
let's face it we have some variable
definitions of what our microservices
I'm going to come back to that when we
talk about service decomposition it has
to be per object it has to be per
endpoint and per method so that's a lot
more visibility over authorization
authentication we are used to you do not
want to get to a point where by virtue
of the fact that your users are on
multiple devices at once or it's a
legitimate use case that you can be in
multiple places at once that cached
information or strange access routes can
give you more information than others it
will give you an example LinkedIn how
many of you are on that cesspool of
employment nonsense yeah we Ola ID we
none of us actually have a shared
understanding of why we're there we're
just kind of weirdly nodded to each
other across a room and go like
occasionally when someone goes bacon
right why am i mentioning LinkedIn well
for it's not a security flaw so please
don't take this as LinkedIn has problems
I'm not dropping zero-day for a very
long while they had a mobile app and a
mobile X
and they had the online experience now
that business model revolves around
getting people to pay for the upgraded
experience you can see who's stalking
you today and you can stalk people more
efficiently in their mobile app for a
very very long time you could see a lot
more information in the free version
than you could in their static website
and it was by virtue of the permissions
they had on those services and those
endpoints were much more generous in the
mobile space than they were in the
desktop space now from a security point
of view is this a problem well maybe it
really was good for stalking people but
from a business model point of view and
let's face it business model equals
profit equals you still have a job at
the end of the week that's a problem
because suddenly they use a basic I'm
not giving you $100 a year I'm just
gonna go use the mobile app protecting
your business model is actually a
security concern authentication and
microservice architectures in any
distributed does tend to start boiling
down to tokens we're passing tokens or
certificates or strings around with us
it's very very rare that we're passing
user names and passwords in fact if you
know one of an architecture that is
passing user names and passwords all the
way around through it stop completely
just don't ever do that please ever and
the same rules apply with these tokens
as any other token in our system this is
where Microsoft's people get horribly
disappointed that I'm about to tell you
things that are just normal web
application security your token should
be high quality you should store them
somewhere sensible you should have them
a good length so that you can't brick
force them generate all of the
permutations over time and guess because
that token is valuable now I like to
give mobile devices as an example of why
we have to think about is consciously
any mobile devs in the room other than
Nigel okay what's the big difference
between the storage on Android and the
storage on iPhone when it comes to
storing tokens and things what are the
two distinct things you've got to worry
about encryption local storage doesn't
work the same between mobile devices
between versions of mobile devices if
you're unlucky enough to be been playing
in the Android space where you're
choosing to store your tokens whether
it's a
local storage or encrypted storage
whether your application does some form
of authentication and therefore you can
get to the encrypted sort of storage all
of these things matter if you've got one
part of your architecture or one
endpoint where you can go and just lift
a token up that's what I'm gonna do I'm
not gonna go after the hard target
worries you know somewhere in the depths
of an encrypted system I'm gonna go for
the plaintext version you've got
compiled into a god-awful flash
application and don't kid me I know the
world still revolves around god-awful
flash applications because I do threat
assessments on them right more basics
input validation how many of you know
you're supposed to do input validation
yes good how many of you feel you're
good at this yeah okay it's getting
better the frameworks are getting better
they're helping us in fact helping us to
a point where we've forgotten we need to
do it sometimes and we just the frame
what's gonna do it's fine we have to be
very careful in validating in
microservices because we're doing a lot
more data exchange it's not the case of
the data comes in from an untrusted
source into our big monolith from the
user in and it's gone through one trust
boundary we've come into our application
but we're now going between many
different trust areas that data is
flowing a lot more freely input
validation doesn't need to happen just
from when the user or another system
outside your control comes in but
between components themselves you have
to assume any component in your
architecture could be compromised and
therefore their input should be treated
as untrusted and most of us don't do
that because that's a lot of work we're
taking a burden of validation in a tiny
component and we don't want that so
building up good shared libraries for
this kind of thing and standard
approaches decorators interceptors
whatever your language calls them is
really really crucial so you don't have
to reinvent this for every time I'll
come back to this with the services now
let's talk about this service
decomposition because it's all very well
we think input validation is important
we've been saying that as a community
for 15 years and we still suck at it
this bits new however service
decomposition is not a skill that most
developers innately have if you do if
you're just gloriously gifted at this I
am envious
the service decomposition is really hard
turning a big jumbled mess of joyful
code into tiny little things that work
with a single responsibility for example
isn't intuitive a lot of us because of
that engineering brain we have have that
temptation to over engineer everything
we have built so it always grows a
little bit at a time we squish things
together because we want to make it
generic or shared or or reusable and all
of this complicates things and this is
what we do we've a lot of our
organizations split naively don't review
and then end up with this kind of
propagation of slightly strange naive
services now again if you're one of
these glorious people who you know you
write the books on microservices and
you're good at this great but I deal in
humans I deal in real developers with
real code bases that really are full of
dragons I'll give you an example naive a
dissection nice don't decomposition into
micro-services leads to some really
funny things if we go back to our
authentication problem now real world
example where we've seen services that
have been split from a big really kind
of old crusty data set and it's really
nice because we were able to split these
functions out and in fact we've used
different languages of different things
and it's really nice one of the things
we did in this example not we I mean her
client but I get suited to hell him back
if I mention client names so he can say
we had cz2 of our services I started to
use JWT because they're using more
mature frameworks they have j TT JWT
available to them it's good good token
system what's that what's that little
green one at the bottom base64 yeah you
can there's those Easter eggs in my
slides so if you have a C base64 I do
recommend you go and figure out what it
says but for the people you just went to
I'm get a Google basic C for decoder if
you've got one service that you know is
using an old technology and can't use a
modern frameworks or was split off early
and you perhaps haven't matured your
approach to things like authentication
you can end up with a fragmented
authentication space where one service
particularly is it's getting a little
bit crusty it's kind of rotting in the
background a little bit and we don't
always have the luxury of going back to
all of our services equally after we you
know change your an approach and
applying it through now we'll come back
to this in terms of orchestration layers
and how this can help but in a world
where you have just purely split it
you've got a chance that one or two of
your services those older services where
you didn't know what you were doing so
well are going to cause you trouble
later and you have to be very conscious
about going back to look at them I know
the reality of my code base is it's very
rare that you get to go back and look at
your oldest code especially if it's not
breaking and causing someone else pain
security is never the reason you're
going to get to go back to that little
bit size and complexity does really vary
in micro services now in the beautiful
blissful paradise you know you go do
your flask example in the Python world
and it's five lines of code you go into
your browser and open it up hello world
job done fantastic you write 14,000
lines of node and you get back the same
result I've seen a lot of micro services
that I'm calling more macro services or
mono micro services where we've taken
monoliths and just hunk massive chunks
of them out or we've got lots of teeny
tiny micro services around the edge for
new things and in the middle is the
clergy big monolith you've just created
an API wrapper around it and it is this
familiar to anyone anyone writing
software like that this is how the
banking world works fundamentally the
trouble we have with this is when they
are not equally sized they are very
different to protect a big clunky not
quite a micro service micro service is
very very different to a very slim line
one and when we modify our approaches to
have this uniform everything's micro
service now we might oversimplify for
those bits of our architecture that
aren't like that at all and those are
the bits of the code that we tend to
a lot of fragility in service dependency
especially if we have one of these older
legacy things in the middle of a micro
service architecture gets really messy
because you can't in many of these
systems take a piece out without other
pieces hurting and that actually breaks
one of the principles that we try and
embrace in micro services right we want
them to be loosely coupled and not
reliant on each other but the reality is
if we have this legacy if we're not
green fields this isn't going to work
that well straight out of the box
there's going to be bits that you cannot
help but fail around and choosing how
you're going to fail if that bit fails
is going to be interesting how is your
app going to behave how is it going to
tell your user what's going on does it
need to tell your user what happens if
something that is just a one-off a batch
processing type of job over in this
weird service if that fails how does
that cascade through your system if one
of your endpoints is subject to denial
of service not because somebody loves
you particularly but maybe your hosting
provider is having a bad day or a number
of reasons why that service particularly
is having a bit of trouble how does that
affect the wider architecture scaling is
also slightly troublesome
well actually it's easier than it's ever
been in existence which makes it
troublesome by default because now we
just tick a box that goes Auto scale
fabulous great hey what does that even
mean for a security people we we we hate
magic which just generally it terrifies
us wherever somebody says well know if
the scaling things just gonna take care
of that for us we worry most of the time
scaling is okay because it's just going
to you know stand ups exactly the same
instance just in multiple endpoints but
you have to understand what that does to
your attack surface did you just go from
one endpoint that was relatively easy to
control too many which bits of your
platform as-a-service are actually going
to help or hinder you at this point and
how can you keep track of what you
actually look like out on the internet
that's really important if somebody
compromises your Microsoft's
architecture or in fact your platform of
the service because a beautiful thing
you can do as an attacker and I have a
strange idea of beautiful I do apologize
auto scaling means auto scaling of all
things so if I compromised your AWS
account through your web application
because that's a thing and I want to
mine bitcoins because I like shiny
things and bitcoins lead to shiny things
if your auto-scaling
do you think this works in my favor as
an attacker because I can tell you it
does I can just set it up once and you
scale it for me I like this you probably
won't as a business probably worth
looking at how do you know if you've
scaled for the right reasons is there a
security reason that you've scaled that
you probably need to be scurrying about
and do you have enough awareness and
alerting your environment spot that some
of you are sat there going it's okay we
bought Apogee or level seven or whatever
orchestration layer you've decided is
the one of choice today there are many
they are it will equal in all of this so
please don't take this as a slur on
anyone in particular but there's an
entire category of software i am also
scared by things that stand between
things one rule want to rule them all
scares me as a security person as an
attacker and as a defender it's scary as
an attacker I'm very lazy you might have
300 different services doing different
things that's great and all I don't want
to have to figure out what each one of
them does and what every endpoint is and
where your external integration points
are I won't bother doing that at all if
you have one of these because this is
the central brain of the operation right
for most of it is directing traffic is
doing your routing it might even do some
nasty DNS jiggery-pokery if you've
gotten the right one in those we have
hooks in two different bits of the the
system and in fact most of these to end
up hooked into quite core systems and
I'll show you on a diagram very briefly
in a bit they scare me because they are
really well marketed this is a literal
quote from one of their websites you can
protect your api's from all top ten
threats great fantastic we've got the
right words such as sequel injection XSS
an application DDoS absolutely
distributed denial service I don't want
this like what sales people around the
world are like rubbing their hands in
glee at the money that will roll in an
adaptive threats such as bad BOTS
I've been doing this 12 years and I have
no idea what a black bad bot is this
this is I I'm I've got images of actual
robots like I really don't like you
today I'm gonna shoot you with the pew
pew lasers this is marketing material
this this is a thing we can't vouch for
this just off the bat we have to be able
to hold those central components
orchestration layers to a very high
standard because we are trusting them
with a lot of our heavy lifting we've
got our authentication tapped into it if
you're using single sign-on or sam'l or
any of that kind of nonsense it tends to
hook into these places we are attackers
you are very lazy to I say we a lot as
an attacker but I do actually mean every
single one of you because you can cause
as much bedlam in your company as
everyone else in the world I want you to
reevaluate look at your permissions look
at your life and see what damage you can
cause if you get really bored say next
week sometime sit at your desk and go
right I've got twenty minutes and only
do this in theory because crime is
illegal but plan what you would do to
cause a ruckus in your new nice shiny
architecture because I bet you can come
up some really amazing things because
you know where it all lives you know
where the skeletons are and if you can
do that you can start to plan your
attacks and you'll find the simplest way
to do it so there are features in
orchestration is that really really
scare me and I'm not easily scared I
literally live in dark places if you see
any of these features these are the
things I want you start thinking about
and I'm not saying don't use an
orchestration there please use one
they're a good idea but do it
consciously and let's talk about these
one by one
so impersonation I work for vendor
number three and I have an orchestration
layer product that is in your network
providing things for all of your
services great fantastic you raise a
support query with me and I'm trying to
figure out what the hell just went wrong
and try and get you back up and running
this is a pretty standard playwright
managed service is a thing support
contracts are a thing if I as a vendor
can impersonate you as a systems
administrator and play around pretending
to be you this should scare you you
should never have an account or a
facility in one of these tools where I
can in purse
someone who has production
administration access because we break
one of our rules we break the idea of
non-repudiation which was up on that
strategy list earlier that idea that
every action in our system has to be
able to be linked to an individual to a
human if we can't link it to whether
it's actually Nigel or if it's someone
pretending to be Nigel we can't
investigate when something goes wrong
and that's dangerous you'd actually fail
a lot of compliance checks for a start
but it's dangerous for many reasons
investigation mode is the same thing how
many of you work on a data set that has
actual human details in it like people
information most of us that's you know
with people writing systems for people
that's what we do how many of you have
ever googled for yourself or looked for
yourself in a data set or for someone
you know I know that's what we do we're
also very curious as a species we are
ridiculously bad at security just by
default we're not wired for this if you
have any kind of mode in this thing
where you can just interrogate anything
on the fly or see any session live great
power great responsibility please be
careful with these things it's a breach
of privacy for most cases and sometimes
it's going to screw up your compliance
and others you can see a lot from this
and as an attacker if I can see this I
can learn a lot about your environment
demo accounts on production this isn't
new to micro services you should be
spotting some things here raise your
hand if you know the demo account or a
backdoor access to a production server
anywhere in the world yep yep and those
are the ones with the really bad
passwords for the record those ones that
you set the password to ten years ago
and haven't changed because yeah it's
fine SSL interception and analysis
there's a lot of deep packet inspection
being touted around we can tell you
intelligently what the deep runnings of
your application is and to do that we're
stripping the SSL off we're putting it
all back together at the end after doing
some magic in the middle that's very
powerful technology and you can do a lot
of good protective things with it but
it's also incredibly incredibly
dangerous if poorly configured it's
going to leave your data exposed and you
really want to be careful of that you
also want to be careful are they sending
that data
anywhere else because if it's a hosted
one so it's out in the cloud it's not in
your environment there's a very good
chance there are multiple customers
using the service that's how business
works and you want to make sure they're
not taking stats they're not taking any
kind of aggregated or anonymize data
from this SSL interception because
there's a lot in there
and even if they've doing it for the
right reasons there's good intention
it's probably going to go horribly
horribly wrong if your orchestration
layer doesn't allow you to have
two-factor authentication
it should no longer be your
orchestration layer I'm just gonna say
that
now that two-factor could be you need to
be on the right IP and have a
certificate it could be a little wizzy
app on your phone NIST the National
Institute of Standards and Technology in
the US as and I said that two-factor via
SMS is no longer considered secure so
please bear that in mind
you know these technology and the
guidance is changing if you aren't doing
two-factor on anything production or
anything core castration please rethink
your life choices so how we're going to
do this well we're going to learn to
choose some right technologies we're
going to restrict access to them monitor
them aggressively configure them well
change assumption test regularly none of
this is Microsoft specific please apply
this to every part of your entire
existence and I'll give you a few things
you should go and do news to help with
this particularly with choosing the
right technology because this all falls
over if we choose the wrong one to begin
with there are golden rules that nobody
ever talks about everyone sees a
security company and they assume that
the security company must really know
how to do secure development turns out
as an industry we're worse the new lot I
I will openly you know hold my hands up
I am as bad as everyone else and it
makes us quite arrogant
things like this happen these are the
same anyone who's on my talk the other
day same fight different reason look
this is Travis Travis works for project
zero Google he's a menace to all sorts
of software and this day he was
particularly interested in Symantec he
tends to just go and wyms and you never
really know what he's going to destroy
next Symantec have been having critical
vulnerability after critical
vulnerability in there
system that this one particularly is
really interesting if you get a chance
go and look at traffic Travis's feed and
his bug reports and and things he
discloses and project serious stuff
they've got flaws in their software that
has been bad practices 2005 that their
frameworks and languages already have
built-in functions for they're just not
using them this includes remote code
execution so somebody else running their
own garbage on your service escalation
of privilege so coming in as a normal
person and making yourself God and this
is semantics so we've got this kind of
preconceived bias that we see certain
names and we go well it's that company
and therefore we should trust it please
I do ask you hold your security vendors
to as higher standard as you hold
yourself if that standard isn't very
high work on that and just because when
you get these these tweets they're all
in a row for him and just in the middle
just the sclerosing if any of you have
the Fitbit scales anyone got those they
talk to your wireless and tell you that
you've had a bad day in at kakie there
is a remote code execution on Fitbit
scales so if you've never patched
Internet of Things devices it does end
very well there's some socks that can
compromise your network now and some
bathroom scales so welcome to the future
please be a part of the solution not the
problem ok so here's two things I want
you to go and look at for this section
firstly get used to this website this is
nist national issues sciences and
technology they govern the Seavey's the
the details of where vulnerabilities
live so whenever you're choosing a
technology i want you to go and look it
up now i will apologize in advance for
my entire community we suck at web
design this is like 1997 glorious
standard of web design but it's useful
because when you're picking a tool you
need to have something to look at how
many times have they had a vulnerability
in the last 12 months has that runner
ability been resolved how serious was it
how quickly did they resolve it from the
time it was published through to the
time it was put there there's a lot to
you can get just from looking at this
and it's open its public beta there
there's no dahhh genus here this is the
government of the USA they
tend to not do bad things to you too
often the second one is this one and
this is from Google again open source
completely open source the code is there
you can go fork it download it do what
you like with it
don't judge it's not in languages that
don't net people tend to speak very
often it's the vendor security
assessment questionnaire now it is full
sets of questionnaires but you can write
your own custom questionnaires and you
can host it on your own infrastructure
or you can host it on the cloud where
ever you like and you can send it
through to vendors so as part of that
choosing a vendor process you have a
right to ask them questions about their
security and this gives you a structure
to ask them all sorts of things about
their policies for things do they have
an instant response plan if their server
center went up in a ball of flames
what's their backup plan now they're not
going to give you like the world of
details here but you'll get a feel for
what they're saying and if there's
enough depth or if they're even
answering it if the vendor refuses to
answer security questions or just send
you to a salesperson go try another
vendor we live in a place where actually
is a lot of competition here so go home
and play with a Google vendor security
assessment questionnaire there is a live
hosted version you can go and play
around with it there are some quirks so
that it is limited you know anything
that is made generic and open-source and
public is not going to fit every case
for you but your engineers and the best
thing about this is open-source so
instead of crying we could just fork it
and make it work for us so let's talk
about Identity and Access Management
because that's important too this is one
of the oldest principles we've been
trying to teach you the security
community for 15 years we are not good
at teaching the idea that you should
only have enough permission to do the
job you do at that time
now that doesn't just go for human
actors in your system so like yourself
making sure that you don't have access
to systems you don't need but also all
of the system components so Pokemon got
in trouble for this recently right for
them the problem came from the scoping
of their application what they were
asking for from the user what data they
accessed when we talk about our system
components we tend to get in trouble
with this in databases where we give
lots and lots of permissions or all have
one database account or rule them all
and share it between all of our services
regardless of what they're doing
what I'm going to ask you to do is as
you decompose your services decompose
the roles across them so there will be
non-human roles there will be demons and
services that are interacting there will
be third party integration points that
are going to sending you data in might
be interacting with api's and things you
have exposed to them you're going to
have human actors you're going to have
technical human actors like yourself
where you're deploying code or changing
code are using it you don't have
administrators who will actually be
helping your customers find love and
support in the app and then you've got
users and it's not as simple as having
these five things lay down going yep
I've done a list it's really about
understanding at each point how much the
permission they need and how this needs
to translate that down from their
accounts to the accounts of the the
systems or its integrating with so
databases third-party services please
please please if you work on a system
that has gone down the road of fine
grained permissions instead of roles
please please be the voice of reason in
this a lot of people go it's okay I'll
just feature flagging or our permission
flag and you know each account you can
just like really fine drain the
permissions and then you can do it per
user and it's great and you end up with
a glorious check box based form where
you can tick things and or a horrible
database query if you didn't get as far
as good forms the problem with fine
grained permissions versus roles is it
gets complex I worked on the system two
years ago where we went in to have a
look and had looked at their
fine-grained permissions and there were
nine hundred and eighty seven distinct
permissions that could be set per user
nine hundred eighty seven the
application was ten years old these
things they grow over time now the
problem with nine hundred and eighty
eight seven distinct things is there are
combinations now I won't do the maths
for you can go and do the maths of how
many particular permutation czar of nine
hundred eighty seven different options
because once you've got that many
options and permutations you can't
rationally look at them all and see
where the risk is you can't even see it
we ended up visualizing this in d3
pulling the fine-grained permissions out
of a database and visually displaying it
as a graph with you know crazy Venn
diagram meets graph
because that was the only way we could
communicate what this actually looked
like access wise if you can't
communicate what access looks like you
can't protect things because you can't
say well this is the border of what is
normal this is what this should look
like obviously once you've got your
rolls in place you have to audit it not
just because auditors are fun and happy
people you should have more in your life
but because you want to make sure that
it's actually working as intended that's
pretty common sense right
we'll come back to that in detection how
many of you are in though we've gone
cloud hey WS is your Google Cloud a few
how many of you are still in the
self-hosting that's fine too I don't
judge if you have opportunities to get
into cloud environments these platform
of service things can help you out a bit
here and there's a few links I'm going
to show you of things you can go and
check out because we're about to move
into our immutable architectures and
your platform as-a-service is going to
help you with this your platforms and
service has a lot more to lose than you
do if they screw up they don't just lose
one person they lose all of their client
base and as a result they have very
well-equipped security teams and I know
a lot of them personally they're very
good people so by using some of these
well the risk is there and your data
might not live where you one type you
know if you ever want to rant about data
sovereignty with me you know I accept
cake but your platform service is going
to help you they have in AWS for example
really mature role based access controls
and Identity and Access Management it's
voodoo to configure I'm going to be
square with you you're going to get this
wrong the first 20 times you try and do
it but it's really powerful and it can
stop you having to do this yourself in
the application so if you're using a
platform as a service please go and
investigate that and let's talk about
your architecture as a whole we should
be aware of immutable architectures by
now how many of you are like it I know
what that is who's sitting Bravin wants
tell me Dakka Dakka Dakka
yeah or if you're not linear like no
docker vagrant or ansible or puppy door
chef there's like there's you could
probably make a song now of the joyous
words are out there on the internet
about this the idea is that we do not
have pet servers we have
yeah I don't I don't like her at all but
you know knows no special snowflakes
everything is replaceable you are just a
cog in a giant machine and nobody cares
if you exist next day right the
beautiful thing about immutable
architectures is it forces you to
articulate your architecture in a way
that can be coherent Li and repeatedly
assessed now I do host reviews or used
to host reviews where somebody would
give me a linux shell and go go at it
tell me if it's configured securely
that's not a fun process that is not a
repeatable process and that's not one
that you're going to be able to do all
of the time our mutual architectures
regardless of which hipster technology
you've decided to do it with will give
you this option I'll give you a couple
of tools you can go and actually do this
for yourself if you can audit it you can
change check it over time so if you've
done if you're doing continuous
integration for example you can do
audits of this kind of thing in a
continuous integration fashion over your
architecture so that if something
changing you're in your configuration of
your hosts you are alerted in the same
way if your code does you can also do
testing over it I've got a team I work
with do beautiful things with Ruby
slightly dirty if you used to being a
Linux this admin but they do all of
their configuration rapid in Ruby and
all of that configuration in frustration
infrastructure and an architecture has
unit tests we have unit tests for
infrastructure how many of you of do
that already because if you do that's
awesome fantastic that guy can tell you
more about it most people don't the ops
side is completely foreign so they do
not do testing testing is I turn it on
it seems to work and I can ping it on
the right port I know this out I looked
after Linux service it was fun times it
also avoids configuration creep one of
the big scary things in this space is
the propensity we have to change them
quickly over time and we introduced a
lot of problems because of it so if we
can stop configuration creep we can spot
when something changes now as an
attacker I'm going to get into your
systems and I'm going to start changing
things I'm going to bring my tools with
me because your tools suck and mine it
better and I've got an ego and I like
that in some cases we clean up previous
attackers so we will get into a host
fight
there is already mal weather and that
malware is causing us trouble so we'll
clear that out for you patch you and
then we'll set up base and if you can
see this if your architectures are
alerting unchanged then you can prevent
it
so the typical actions there we go
that's what I want to do retaining
access installing tools removing other
actors gathering pivot you can't do it
in a mutable can't do it in lambda
either so as an attack place as
offensive people we struggle when you
get this right so please make us work
for our money make it hard for me to
stay around a long time if I can stay in
your systems for a long time I will it's
cozy and warm and I can get more stuff
over time if I can only get in do
something quick and then have to get out
that's still not ideal for you but it's
way better than the other options so
here's some things you should go look at
a little bit of homework so if you've
caught dakka dakka dakka dakka mushroom
mushroom you can go look at Doc
Adventure Security which is a lovely
reasonable script you can audit your
docker containers and it's open source
it's written by doctor themselves they
are lovely people if you are AWS you can
use AWS inspector which checks for
security flaws I could do entire talks
on these tools alone but then you would
die of brain overload and if you like
the Netflix Netflix cult of tooling they
have security monkey which does similar
things I can order a wider range of
devices every tall I'm mentioning is
either free to use or super super cheap
in AWS I don't like big expensive vendor
things so let's talk about a few things
before we get into the section so first
things first how many if you write in
more than one language every day yep
how do you like the idea that you can
bring new languages in and try new
technologies because it's fun yeah most
of us do because we don't want to write
Java forever you don't want to write
Java ever you're in a dotnet conference
so it's like a really bad day trouble is
it this is what we end up like we're end
up like kids in a candy shop and our
micro-service architectures those
literally it's encourage to use the
right technology and the right service
for the right job so you don't get stuck
in net land if this service over here
would be better off in Erlang
please don't do that that's a really bad
idea but you get the point you can
theoretically choose whatever your
technology like just serve
purpose of that service trouble is you
need to make sure you're choosing the
right language for each job and that's
not always clear because some people
like me we do silly things like talk at
conferences and somewhere in the room
someone who'll go you know what would be
cool I could do my project in this
language in this new technology in this
thing and we get excited and that's
great
but we don't always choose the right
language for the job and not all
languages are equal
I try to be quite equal opportunities in
my slander of languages but no does fall
foul of me many times the newer
languages have less maturity their teams
have not figured out how to do things
like checking the dependencies in their
repos yet to check if they're actually
sane and safe to use so you need to
compensate you're using newer
technologies don't stop using them just
take a little bit more time when you're
judging which libraries and frameworks
to use and how you're going to protect
them I over use this analogy but I'll do
it anyway every technology is a puppy
every technology you bring into your
infrastructure is a puppy so if you've
got many of them that's great they're
adorable you're gonna want to play with
them and do awesome things and tell your
friends that you've got a new puppy and
I've caught no JFS and it's great but
puppies poop on carpets that's fine you
can handle this for one puppy everyone
you know you can get passed in and make
your way in the world if your
infrastructure like looks like this and
what you thought was a Java shop is
actually 12 languages you've got a lot
of poop a real a lot of poop that's a
lot of technologies to go monitor and
watch a lot of technologies to update
and patch and a lot of places to go and
follow for good guidance so please use
this wisely just because you can it
doesn't mean you should I'm not trying
to spoil your fun mostly to reiterate
some tools that you can go and help with
this so if you do open source libraries
that IO is free it's very very cheap for
paid Oh wasp has the dependency checker
which will help you if you'll put it
into your build pipeline it integrates
with maven and ant and Jenkins awana it
will tell you when you do your bills
you've got out-of-date dependencies that
have security flaws you should not
continue so that's a nice easy way for
you to do that so just ten minutes left
and we're just going to talk about
detection
I literally talk for hours on detection
but this is just a flavor of what you
need to think about with your micro
services log all the things now that's
that's really easy to say when you've
got one monolith and one log at log
place and they will end up in a nice
polite way and it's all super simple
super simple this does not work well or
simply with micro sources especially if
you've gone down the multiple puppy's
route of technology choices because
suddenly you've got a lot of different
styles of logs and a lot of different
types of data available to you the
important thing is where you keep your
logs now as an attacker when you get
into a system often the thing I'm doing
before I leave on the way out is I'm
cleaning up the logs after me I'm gonna
just flush those out clean them down if
you're really lucky I'm bad at that and
you can see there's a gap in the logs if
you're really unlucky and I have a bit
of time you won't know it's happened
it will just be moments that don't exist
anymore make sure your logs are stored
somewhere outside your architecture
somewhere secure somewhere immutable you
can't change away from your production
environments poorly managed logs are a
security problem for two reasons firstly
was this I can go and ferret around in
them and delete things I can also learn
a lot from your logs how many of you do
the silly log debug send everything in
my stack to the log when you're
debugging I do from time to time the guy
is shaking his head I like you you've
got style I'm gonna be honest Eddy and
my logs even say you know giraffe Womble
what the hell just happened and here's a
stack trace you know well it looks not
good but I'm human I'm alright with that
it's not just the normal day-to-day logs
there's all sorts of information that
you aggregate in time over there you can
find your customer information you find
technical information and I can take out
your architecture with a denial of
service attack against a login site and
here's how it works
most architectures that put in
centralized logging do it relatively
naively and a lot of people don't like
using cloud-based logging solutions like
ray guns and was the world so they keep
it inside their network those systems do
not get the same love and attention as
the rest of your shiny micro services
people because the ops people don't have
as much budget they just got told you
were gonna fire a whole lot of text
files
or log files and just go do your thing
so they might be using technologies that
are a lot lot older than you're used to
it's very easy to denial service a
network that is poorly implemented
whether it's logging but you go after
that point you need to make sure the
Earth architecture your choices will
survive your logging system disappearing
and tell you that it happened both parts
of that are really important so it's
loosely mindful the other thing is if
you look at big famous hacks if you want
to read a really glorious hack attack
Phineas Fisher attacked hacking hacking
hacking group out of Italy and published
a giant PDF of how he did it now what
was interesting it was an application
stuff he was attacking he went after an
a Geass server there was inside and
architecture much like this because the
Naga server was in the middle of all of
this untrusted backup servers often have
production root accesses built into them
octopus deploy any doctopus users and
this goes for all deploying software I'm
not out covers are lovely please you
know be nice to them there is an ability
in that tool to write custom scripting
that will run with a permission level on
a host that you can do that it's host
level scripting is in there
those are powerful tools and there's an
attacker if you can compromise one of
those you get all of that so don't worry
about each individual service if you've
got these components in there give those
some love to and then watch your logs
actually watching them I know this bit
is painful if Finn is painful and you
know you don't like watching logs
because it's boring and nothing ever
happens and yeah and you know that
you've got a dashboard that nobody looks
at because it was there to please some
board members and to spend some budget
then don't make yourself watch logs make
your security interrupt-driven
so get good alerting set rules upset
regex off I don't care what tools you
use you can look at my other talk and
I'll give you some ideas as to what you
can do here but get it sending something
that you can't ignore if you live your
entire life in slack it should be
telling you very loudly with animated
gifts in slack that everything is on
fire if you live in your inbox because
you're in one of those painful sort of
outlook you
then having an email filtering system
that sends everything to death and all
is probably not helpful make sure it's
getting to the place you're gonna see it
doesn't matter where that place is it's
gonna be individual for every single one
of you but you have to be able to see
this because if you're not watching
you've got a lot of moving parts a hell
of a lot now and they're written in
different technologies by different
people over time and some of them are
older and some of the manure and some of
them are giant little white boxes that
they look teeny tiny on the architecture
diagram but a giant monoliths that
nobody can touch because dragons live
there and if you're not watching that
then you'll never see someone come in
and you'll never see what they get up to
and that's normally a really short path
for not having a job at the end of it so
that's a bit of a rambling journey
through Microsoft security we've had a
look at prevention we've looked at some
basics we looked at the detection I've
given you some tools and some things you
can go and read because seriously
there's so much to cover we could have
spent a whole half-day workshop on this
and still have more questions if you
have any questions please do ask but if
whether you are here and you just want
to get to hear or whether you're here
and you've no intention but you're
curious or whether you're here already
and you want to avoid going backwards in
time and and in creating monoliths
because you got lazy or someone was
rushing
please remember that security isn't just
something for the end and it's not just
something for a team that sits outside
of your place to come and think about
it's actually you lot are going to be
the key to securing these so please
little steps in all of your little tiny
pieces and hopefully we'll do something
good any questions hello hi gentlemen
where the microphones gonna come to
harass you so what's your opinion on
using wefts web application firewalls I
say so the question is what's my opinion
using web application files I like web
application firewalls theoretically so
web application firewall sits in front
of your application it looks at all the
traffic coming in going and it says well
that looks like this it looks at the
post requests and the get requests and
whatnot and it largely like all security
monitoring tools is basically just regex
with a pretty wrapper that's great sort
of but only if you tune it
only if you take it out of monitoring
mode and you put it into enforcing mode
and it's given some power to do
something what I tend to see is people
spend $50,000 on a web application
firewall if they've got an enterprise
they put it in front of their
architecture and they leave it in this
monitoring mode where it's just
generating alerts but not doing anything
at that point it's not doing security
it's an expensive cat5 cable and you
should probably not be doing that if
you're not in the position to turn it on
and tune it back and that does take time
a lot of time and the right people then
it's not worth the spend you'd be better
spending your money on something else hi
any open-source tools for you know
security testing web api api's any any
open source tools like for web apps you
have that okay so the funny thing about
security tooling is you don't need to
use security tools when I do my security
testing of api's I actually tend to be
using postman a lot I use the same dev
tools I used to build them to break them
other things that are really cool there
are some open-source see kind of
security testing frameworks out there so
BDD security for example and gauntlet
and you can write the same kind of test
harnesses you do for normal functional
testing and api's but with a security
feel to them so they're testing the
security things so that's I would
actually recommend instead of looking
for a new tool we angle the tools you're
already using and just bring a focus to
that because new tools as complex to
your life you're already busy so just
kind of do it we already doing it also
you developers your tooling is so much
better than ours in every possible way
we just want to use it in a slightly
more mischievous manner anything else
well I will be around shortly in the
corridor if anyone wants to come say hi
that would be lovely
you've been lovely I was here we did a
thing have fun</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>