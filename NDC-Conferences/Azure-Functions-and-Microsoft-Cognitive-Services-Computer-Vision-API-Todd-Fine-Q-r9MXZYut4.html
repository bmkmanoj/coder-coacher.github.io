<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Azure Functions and Microsoft Cognitive Services Computer Vision API - Todd Fine | Coder Coacher - Coaching Coders</title><meta content="Azure Functions and Microsoft Cognitive Services Computer Vision API - Todd Fine - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Azure Functions and Microsoft Cognitive Services Computer Vision API - Todd Fine</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Q-r9MXZYut4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's see if this works everybody hear
me okay yeah okay all right my goals for
today include not falling off the stage
and not spilling my coffee not saying
you guys are third or anything like that
but that's what I'm focused on at the
moment so my name is Todd fine I work
for a company called winnow left I'll
tell you just a little bit about myself
in the company in a minute and today
we're going to talk about Asha functions
I wanted to do something a little
real-world with it which is we are going
to create an azure function that
monitors a storage account for incoming
picture files and any time a picture
file comes in an image file comes into
that storage account we're going to pass
it off to the computer vision API and
analyze it for adult or inappropriate
content I'll explain how real-world that
is in a second because it's basically
happening all around us have any of you
guys worked with Azure functions so far
I'm just kind of curious maybe five 10%
okay
I would actually be interested if you
guys hang around or we talk at the Q&amp;amp;A
at the end to see what you're doing with
it because I've only started using them
relatively recently it's a fairly new
feature with an azure but I've been
really surprised at the way that my
developers and my company is actually
using it I initially thought of it as
something that's you know the
microservices terms use the Nano
services terms used it's a function
right so you're thinking tiny little
things going on but even in this demo I
mean we're going to pass something off
and do you know vision analysis on it to
basically the machine learning algorithm
so you can use it for all kinds of
things that you've never maybe thought
about and one of the things I wanted to
get you thinking about is when you're
architecting a solution is an azure
function appropriate and here's a new
way that I can do things in a kind of
microservices architecture so that's
kind of why I'm doing the stop there's
actually two or three reasons which I'll
kind of talk about as I go along and I
want to see how other people are using
it too because I just like to learn
stuff so let me tell you a little bit
about actually I'll have a slide myself
and I want to talk about myself but I've
been developing I mean unofficially
since I was a teenager but officially
you know a host of different different
kind of context I actually did some
software development I was a software
manager versed in electronic warfare
systems way back for the
u.s. Navy wasn't in the military I was a
civilian but that was some really fun
stuff it's still out there around the
world in ships and planes and most of
the stuff that I've been doing for the
last 20 years or all of it has been
probably what you guys are doing line of
business applications you know building
software for either my internal
companies or corporations or in my case
for external customers so that's when
elect I mean we're a software
development and training company if you
don't know us we've won lots of little
awards and things like that I won't go
into it but if you do know us for the
people in this room you probably know us
through this all the books that have
been written by our owners and employees
over the years some of them are the more
well-known names like Jeffrey Richter
and John Robbins was the bug Slayer
columnist and MSDN that kind of a thing
so that's how most people know it even
though even though training is only
about 20% of our revenue but that's kind
of where the name came from so before I
get started I wanted to show you where
you can get all the code and all the
resources for this presentation and I'll
put this up again at the end during QA
what you're looking at is two or three
public github repos so there's two or
three reasons or ways that this talk
came about one of them is that as
winter-like that's the company in my
other role is a Microsoft Rd which is
like Microsoft MVP I do not work for
Microsoft at all we build a lot of stuff
for Microsoft and Microsoft's customers
so that first one and I'm going to show
you this github repo a little later on
when we have to deploy something - and
it takes about a minute or two and
there's a delay so I'll bring it up but
we build a lot of training workshops
actual code actual products for
Microsoft this this talk was originally
built for Microsoft Research that's when
MSR stands for their and actually I'll
show you this here right now we'd like
to make it a little hard for me to see
so here's a couple of those repos this
is the one for MSR Microsoft Research
this is one for Microsoft Tech community
this stuff we've actually built for MSR
to target data scientists and
universities worldwide to get them up
to do workshops and not like a training
class but like jumpstart workshops go in
these universities talk to these data
scientists to be honest win the hearts
and minds of data science people around
the world the Charter came down from
very high up at Microsoft saying you
know you remember the 80s when Apple won
the education war and Apple's
mackintoshes and we're all over
education and schools everywhere and
Microsoft is lost out don't let that
happen again with data science we want
to win the war and they're just devoting
a lot of money to it so the reason I'm
bringing this up which isn't directly
ready to the talk but you can see that
the Azure functions which one is system
look like okay it's over here all this
stuff is absolutely free okay it's there
for you to use Microsoft isn't
advertising it we built it for
Microsoft's technical resources they're
using it when they go out and talk to
customers and we built it for
Microsoft's customers or targets that
they're going in and enterprises it's
all free but it's not advertised
anywhere if you look at any of these
topics and go oh I'd like to learn about
it I'll guarantee you that it's a better
way to do it than just looking online at
various sites and finding like a little
ten minute video from the Microsoft
Azure site about Azure functions each of
these is a little one-hour workshop that
steps you through in great detail how to
do it's really well done and I'll show
you example of it when we have to sit
around for a minute or two wait for
something to deploy but I just wanted to
kind of give you that too to help out
because it's very useful our guys use it
all the time whenever they want to learn
something new that's it's in this is
about 40 of them so far okay so I
mentioned that this talk came about a
few ways one of them was because we were
working with Microsoft Research and
trying to figure out what kind of topics
we wanted to hit the other way is this
this is this is real it happened a few
months back we use slack internally for
our internal messaging system and the
developers are always just talking about
the latest JavaScript framework or
whatever the current you know thing of
the day is and they were all discussing
something about JavaScript the
philosophy of coding and JavaScript and
functions and all this kind of stuff and
suddenly I see this pop up it's from one
colleagues and he said ha I posted this
link to Facebook on this JavaScript
article and immediately received a
notification that it was removed for an
appropriate content because of that
nudity okay so now I'm obligated to say
why my colleague posted nudity it was
the cover of a JavaScript book but it
had like think of like a Greek or Roman
statue that kind of duty so just so you
know he wasn't posting pornography to
Facebook but within seconds it came down
so how does that happen right there's
not hordes and hordes of Facebook people
looking at the billions of posts and all
the images and deleting them it's got to
be automated it's got to be some kind of
algorithm and we're she learning process
that looks at images and figures out if
they're appropriate or not or tries to
and does a bad job in this case believe
it or not because it's a book that's
published and that's exactly what we're
going to build today and you're going to
see how crazy simple it is I'm from I'm
old enough as you can tell that I still
have this instinct when I have to build
something to go okay I'm going to create
a big project and create an app and I
could do all this stuff what we're
starting to see is you don't have to do
that you have these microservices
options available to you different kinds
of components and as your functions is a
great one so what we're going to do is
create this simple as your function no
app no asp.net project no worker roles
we're just going to stick a little
function up it doesn't we want and do
all this in a tiny tiny bit amount of
code so this was a perfect example when
we were talking to Microsoft Research
and go and what topics will here we
wanted as your functions they're all
about cognitive services and artificial
intelligence now right we said hey let's
just repeat this so that's what we're
going to build today it's part of the
inspiration for this talk so what are
add your functions just think you know
I'm gonna probably do about 10 15
minutes of slides and then no more side
it's going to be just building this
whole demo the rest of the time so as
your functions are just small pieces of
reusable methods just think of it
exactly like it probably pops in your
mind I'm going to take a function or a
method I just want to do that I want to
stick it in the cloud and be able to
call it but because it's on the cloud
right I can scale it I can manage it
it's got the hosting environment you can
do all these things with it and you
don't have to create any kind of calm
gated framework or app so they use the
term serverless all the time because
you're not building these services
around it you're not kind of hosting an
asp.net or anything we're just digging
it on the cloud they use nano services
because I guess they already use micro
services sometime they have to call it
something else but to me it's just micro
services it's just another way to do
things put a bunch of methods up or
functions up to do explicit things and
you only pay for the time that this code
is executing that can be different I'm
not an expert on Google and AWS but what
I've seen is that some of the other
platforms have come tiers of servers you
buy like you buy this tier and you pay
for it as long as it doesn't go beyond X
level that's what you pay then you pay
for the next year on Azure it's just
time slicing it's like going back to
this to the 70s it's just paying for
whatever time slices you're using on
this function so it's pretty cheap it
supports any language you could possibly
want almost JavaScript Python c-sharp
PowerShell bash everything but to me the
more important thing is that the
integration is integration sounds like
you're glomming a huge a bunch of stuff
together I guess I'll call it a inner
operation or Interop it can trigger on
almost anything and that's that's part
of the value right you have to be able
to trigger this function on almost
anything you want easily and you're
going to see how easy it is when we do
the demo so you can trigger it on
basically any event within adjure you
can have functions interoperate with
each other you can trigger it on
third-party apps like and onedrive or
dynamic things like that it's got all
these templates that you'll see in a
second so it's got a pretty rich tooling
set even though it's fairly new and that
that tool set is kind of expanding
greatly as quickly I should say so what
are some common scenarios I can't even I
could probably do three pages of them
timer based processing when you're doing
kind of cleanup you just want something
to execute every once in a while event
processing real-time streaming I mean
we're going to do something it's not
really streaming right it's going to
trigger every time an image file hits a
storage container but I talked to
somebody I'm wondering at these here
somewhere in the audience that we had
like the Biergarten thing a couple days
ago
and he said well we're doing something
similar we're streaming real-time video
from drones and analyzing that so you
can use agile functions for that as well
the last one I put on there because
about four weeks ago I was sitting in we
called it a war room with a Microsoft
sales team we were we had three days to
put the POC together for the city of
Atlanta in the US and because it's
Microsoft I should say because it
salespeople I guess they're the same
kind of everywhere they wanted to throw
the kitchen sink at this POC we had
three days to do it so here's a list
like this and the day before they
started going it will you know dev tools
you want to sell dev tools can we get a
xamarin app as part of this and we'll
look sharable quite a xamarin app
tonight and then the final one was let's
get BOTS in there too you know because
that probably gives them even more money
if the city of Atlanta does bot so we
were like I don't know if we have time
to do a bot service for this and I'm
talking with my agile architect he goes
you know I can do it I'm just going to
write a quick as your function the cost
on the bot service and does XYZ and I
never would have thought of that you
know even a year ago I'm going to write
an app to do this or a service to do
this but no you can do almost anything
with these Iser functions and the way to
trigger the bot server so I won't get
into but it was just you know how are we
going to tell it when to come in it was
like nothing you just create this
template boom and you go off and you'll
see that so it is really flexible I keep
mentioning these templates I so far have
never like from the ground up written
and as your function meaning like
started a project part of it is because
the portal does it doesn't require you
to yet you you'll see when we do the
Azure function it says what kind do you
want and it kind of gives you some
chrome around it some little tiny
framework when actually framework I just
mean a couple files with some starter
code but you're going to see one or two
screens it just says tell me what
language you want tell me what kind of
trigger you want tell me what kind of
function you want and you click it and
then all you got to do is fill in the
function and you can see on the right
all the different kinds of stuff you can
do and that just expands I won't say
daily but it's kind of expanding
continuously github web hooks HTTP
trigger queue triggers you can see at
the top we're going to do a blob trigger
and there's much more
you can do so there's three main
categories or the way azor is kind of
grouping them of as your functions I
don't necessarily agree with these the
way they've done it but we're just but
it's really just informational the first
ones timer function apps that run it
intervals or manually whatever you want
usually you're using cron expressions to
kind of specify how it's going to run or
what it's going to run that can be used
for anything of course but people
usually use it for you know cleanup
data management checking for state
monitoring something that kind of a
thing the second is the one we're going
to do which is being a processing stuff
run when it's triggered by some kind of
data event and that's much more kind of
normal for probably the people in this
room right you're always doing some kind
of data get to do something to it or
with it so it's great for credence
create read update delete we're going to
use it for moving content because we're
going to take these image files and do
something with them depending on what
the computer vision API says you can
access data across services you're not
limited to some little tiny you know
container or box that you have to live
in it's made to work across all your as
your services and these have in-and-out
parameters because there's a piece of
data so you can kind of pass that name
in and out and the last kind of expands
things greatly because you have web lock
and API functions so you know you can
talk to other services you can again
interrupt with github or TFS or onedrive
all that kind of stuff now I haven't
done anything personally with that but
my developers have and it's going to be
just as easy as what you're going to see
in the demo so again I didn't want to go
into detail on this I'd rather just show
you stuff but we can kind of loop back
around the end if you guys have
questions and again everything you see
from the PowerPoint deck to the demo
script to the images to the code is all
available on those kids hub repos so
what is the function look like it's it's
really a collection of four things
there's a run method or a run file that
contains the azure function so you're
going to see that in the in the code
these there's a function app you create
but that could
function app can have one or more
functions in it so we're only going to
create one function but you can have two
three four whatever you want so there's
a function file containing the bindings
and you'll see that as well we're going
to have one binding to a blob storage
container then there's a project file
which you can have it has to specify
dependencies right we're going to have a
dependency on the azure storage so we're
going to have one little tiny project
JSON file and then there's the app
setting so we're going to hit every one
of these but that's way overstating
we're going to do because it's going to
take us almost no time except for that
run file to just show you three lines of
code you go oh here's the binding here's
the project file it's that simple and I
only included this for completeness so
that if you guys ever want the deck you
can have the slide there's no reason for
me to go and do it but this kind of
shows you what kind of triggers you can
have for the various types of as your
function so we're going to do blob
storage you can see there's a trigger
for that as an input it as an output
that kind of thing this is really just
extra information for anybody that wants
to look at this deck so how do you test
it I have two answers for you the first
answer is what you see on the screen
command-line tools curl what we're going
to do to test it is we're just going to
upload a bunch of files into this
storage container and see if it works
but you can eat so we're going to use as
a few explorers just going to really use
file explorer there's all kinds of ways
you can test it but in the fall or even
now if you have the preview this is not
the current Visual Studio preview it's
the fall preview that's coming out
version 15.3 if you're going online
looking for it they're building all this
functionality finally into Visual Studio
so all that tooling is in there and then
you can just do a function at project
what you can't do now doesn't show up
and you can pre compile it you can do
testing and you can do you know
one-click employer to the cloud all that
kind of stuff it's not in studio now but
it will be in the fall and you can
actually get the preview already so I
the extent I've played with this is
downloading the preview going okay
there's a new project called type yeah
it does what it said it does and I just
heard a hello world thing and publish it
and it work oh my go
we're going to do everything in this
demo in the portal so just to remind you
what we're going to do again today and
I'm going to show you a visual of it in
a second we're going to create an azure
function app with one function in it
that function will be bound to a blob
storage container and just monitor it
for incoming files image files
I mean JPEGs to be specific every time
it sees an image file it's going to take
that entering the byte array pass it off
to the cognitive services computer
vision API and that the settings on that
computer vision call will be set to say
check it for adult content check it for
racy content sometimes thats line goes
weird in different countries but you
know inappropriate but not really really
bad is it you know how bad is it type of
thing it'll actually score it and I'm
going to log some metadata just so we
can see kind of what the computer vision
API did so accepted images will be moved
from the original blob container to an
accepted blob container and the rejected
images will go to a rejected blob
container so I just realized last night
like I've had this up there I've done
this off like five times but that's
completely wrong because what's
happening here is here's the function
app with one function in it and that's
going to monitor this blob container
call it uploaded here's the image files
coming in when it sees it that the
function app triggers and passes that
file off the cognitive services API all
that's correct the problem is in just
this visual if it's accepted it goes to
the accepted container if it's rejected
it goes here it's not the cognitive
services app that's doing that it's this
as your function I do it wrong
months and months ago would never notice
to last night and nobody because easier
to you guys are pretty good
you guys are always telling us like what
we're doing wrong and it's actually
helpful I actually welcome it but nobody
noticed it so I'm sure I've done other
things wrong feel free to yell out I've
heard that Norwegians don't do that but
I want you to go for it
let's do this demo
and I'll probably have because I always
like to lower the bar a little bit and
do any simply go back to this because
I'm going to come back to this visual a
couple times okay we don't need this
anymore
we're going to come back here so some
things that have happened with this demo
is and you'll see it in the code so I've
commented out some some code some code
lines is there's some strange things
going on with cognitive services
sometimes they're moving its location
from data center to data center so about
three weeks ago I did this talk in
Roseland Brussels and somebody else
who's another famous speaker I mean I
didn't know he's in a different city in
the US doing the same top and if this
demo doesn't work it doesn't blow up
it's just at the very end when we do all
this stuff and I go and look just
nothing happens it's just a blank screen
that's all that happens because
something went wrong with either a data
center latency or things like that so
what they had done is they had moved the
endpoint for the computer vision API
from West us data center to West Central
us but they not told anybody
so me and another speaker done this talk
didn't work at all and that evening we
get back to the hotel was not a good day
you know and we get this long email from
Microsoft going I'm so sorry
we removed the data endpoint we didn't
change any documentation we didn't tell
anybody and you know what can you do but
so strange things have happened I did
this literally 15 minutes before this
talk to make sure that didn't happen
again but you never know because we're
going to be talking to different data
centers so let's get going how much time
do we have
all right we're this is not a long demo
you're going to get some free time at
the end of this it usually takes about
20 minutes so you're going to have three
networking time after this so I'll blow
this up a little bit the first thing
we're going to do right is we're going
to create a new function app so you go
to new this is the new Azure portal or
the current add reports to say compute
and usually down at the bottom there's
function at
by the way the other thing that happened
once to me you guys probably already
know this is one time I did this and it
wasn't there and the audience was
helpful and they said hey so if they
don't include everything there there's
this new link see all and that's where
it was but it's always there and then it
wasn't and it's the first thing I do you
know I guess I shouldn't tell you all
the ways I've screwed up on my previous
presentation so I just said new function
app and let's call this funk at MDC
what's the date six one six so just have
a unique name and I don't want to do it
like that
6:16 funk at NEC six exam I'm going to
use my visual studio subscription we're
going to create a new resource group for
this now for those of you who don't know
a sure or what a resource group is at a
high level it's just a way to combine
everything in your as your thing that
you're doing all your resources into one
group so you can manage it all at once
because something is using 20 different
types of azure components you want to
delete it you don't want to go in and
find them all and delete them you just
want to say I want to delete my my thing
so this is going to combine everything
that we're using which isn't much into a
resource group with this name now
there's a couple ways to host this these
hosting plans I've included extra slides
in here again for anybody that downloads
the slide deck to explain what these are
but basically it's just different
pricing plans depending on how you're
using it you know how often it's being
called what it's doing there's different
ways to consume it or host it that
charge you like one uses VMs and one
doesn't that kind of a thing so I'm just
going to use what's called a consumption
plan let's try West Europe and I'm going
to let it create a new storage account
that's what this is we don't need
application insight so I'm going to pin
this to the dashboard but trying to make
sure itit threw up any of this flunk app
resource group consumption plan West
Europe this is the stuff that's
important now for cognitive services I'm
going to have to use West u.s. at least
last time I
check so let's create that should switch
over to the dashboard and start
deploying this takes a minute or two so
what I thought I would do for this
minute or two is go back over to these
github repos so I mentioned that all the
stuffs in there here's functions I
didn't show you what's in it but I
pulled this down because this is what
I'm doing my talk from so you can see it
here this is exactly from the github
repo with a couple extra decks in it
that I put together for different
conferences so it's got the deck it's
got you know the code for it it's got
any resources need everything's here it
also has an hol a hands-on lab or a demo
script so you can see that most of these
we do in multiple languages sometimes
it's Python or R this one was built in
both C sharp and JavaScript let's just
kind of put that down so we can watch
the background and it's also in
different I guess I would say format so
we have an HTML we have a markdown file
let me just show you what this looks
like if you guys decide you want this or
any of those other workshops so this is
basically if you're doing a training
session with people which you want to do
like a hackathon or something then it's
a hands-on lab right if you want to go
to your local user group or your company
and say let me show you this stuff but
it's a demo script but this this I'll
call it a demo script it has everything
that I'm doing in here very details it's
got every screenshot of everything there
you go what I just did but it also
explains it so you can learn it's not
meant to be up like a formal class but
we want people to understand it so
there's explanations all along the way
of what you're doing and why and all
these hands-on labs or demos scripts so
I'm going to get rid of that because I
can see that it has deployed in the
background and here's our function app
our running function app so now we have
done step one which is just this blue
box we haven't done the yellow box so
you might think the next thing that I do
is create the function app but instead
I'm going to create these three
containers and get that out of the way
so here's our function app let's go to
the dashboard
I'm actually going to pin this resource
group to the dashboard - so I'm just so
we can all get to it all easily so let's
go and pin that to the dashboard not
doing anything real yet that's the funks
that's a resource group here's the
function app and this function app has R
I'm sorry this research group has our
func app it's got our hosting plan it's
got our storage account that's what that
is the storage account
I love horizontal scrolling it's just a
great idea so let's go over yeah
now I have a I have a lot of complaints
I've given to Microsoft about the new
Azure portal but it actually is getting
better and better I'm actually on the
verge of liking it but one thing I
really do like is this storage account
view because it really consolidates all
your storage your Azure storage stuff in
one place you know queues and tables and
files so we're going to go to these
blobs or a blob storage account there's
nothing in it we're going to create
these three containers the first one was
called uploaded and you can do different
kind of access types for a container but
we're just going to leave it private so
we have the uploaded container spelled
correctly another way that I can screw
up this presentation not saying I did if
any of you guys saw the spectacular
failures talk yesterday I was like oh hi
I got I got a story I got a story they
should let me up there but they had it
all pre set up so we had an accepted
container so uploaded accepted one more
will be rejected
and now we have our three one two three
spelled correctly containers so the next
thing so now we're just to keep going
back to this now we've created this blue
box we've created each of these blue
rectangles now we can finally create our
adjure function so let's do that
so now we're going to go over to our
function app and the way you create and
you here's our function app here the way
you create a new function is just to
click on this plus sign and now you
start to see these templates so there's
a few ways you can do this you can kind
of do these big remember these big three
categories timing time or data
processing web book and that really does
everything for you almost and kind of
gives you a little wizard you can also
pick all these languages c-sharp
JavaScript F sharp you see down here you
can do it in power shell or bash or
anything that you want we're going to do
a custom function because I want to have
something to demo here so I'm going to
click on this and create our own custom
function and you still get a lot of help
look at all these templates do you want
to hook into github do you want to do a
generic web book do you want to do an
HTTP trigger or a cue trigger or timer
trigger we want to do a blob trigger and
again I can also pick my language so
I'll just do a blob trigger and c-sharp
and it asks you for just a few
parameters so let's call ours blob image
analysis and it's asking for a pass so
what's it mean by path here's what it
means it'll be obvious when I take it in
the path that we're looking at is that -
that uploaded container and the
parameter is this the file name that's
what that that's the in parameter for it
so uploaded that's just the format they
use uploaded slash name as the input
parameter we don't have to worry about
that should be good to go blob image
analysis uploaded boom and this
shouldn't take that long maybe 10
seconds or so
not even that okay so now you have your
run function this is your function
there's some other files I'll show you
in a second and this is just obviously
nothing's in it it's your template and
you type in what you want to do
so I have some code here two little
pieces of it now audiences are weird
sometimes they say you're faking it
unless I'm typing in every line of code
but the purpose is not for you to watch
me type the purpose is to see on as your
function works so let me take you
through this I put a lot of comments in
so that you guys can see it if you're
downloading the repo so here's our run
function that is basically what is run
when the function is triggered and
that's called every time because we we
have a binding to the blob storage I'll
show you that in a minute every time a
file comes into that blob storage
container the uploaded container this
run function runs and all this is doing
is using a helper function called
analyze image async I'll show you that
in a second so it turns that image file
into a byte array and passes it off to
this helper function everything else you
see here is really just some log info
that I put in and after it gets the
results back from the computer vision
API it takes that and says look did it
come back as adult content all right put
it in the rejected container did it not
everything's okay put it in the
exception container that's all you're
seeing here so again here's this
function that calls the computer vision
API eyes look at that it's right below
right here so it takes in an application
setting which I'll talk about again
later that's so you can call in to the
cognitive services API you can API key
and this is the call it's right here
this is really the one line of code that
does it all and this isn't a cognitive
services talk those talks are also in
the github repo if you want to kind of
learn about that but basically you have
one call that is calling into the
cognitive services API and asking it is
to spy okay or not so you can see my
previous talks that that messed up is
when they moved West us to what central
us and didn't tell anybody so I have
another one in here just to show you
guys that you have to call in to the
right data center at the moment they're
expanding it to the data centers around
the world but for the moment it's not
everywhere so I'll show you why I still
have this comment West US thing in here
minute and the rest of it which isn't
very long there's only about a hundred
lines of codes here total it's just some
helper functions to move those blobs
around and put some blob metadata in
there if I didn't do that this would be
half the size if you've got 50 lines of
code which is mostly comments in white
space anyway so you can see there's just
not much here putting some metadata in
there changing that image problem to a
byte array and here are some classes
there's this really almost nothing here
so I will select all this and we will
stick it in here and I'll push save so
you could say it's you can see its own
kind of little almost development Meier
it has and again once visual studio
comes out in the fall the new the
previous out there right now you'll be
able to do all this within the visual
studio environment but we've obviously
done all of our stuff right here in this
portal so there is something else we
have to do you can look at the rest of
your project files here this is the run
file that we just did let's add another
file and I'll show you what this is I'm
sure you've heard of this file before
project that JSON what are we going to
put in there that's my one other tiny
little piece of code we have to tell it
the project dependency on Azure storage
so that's all that's in here well get
rid of that we'll stick this in here
I'll click Save so we have our run file
that you've seen we have our project
file which this this is that third thing
member I showed you so you have almost
every component of this little function
that I've showed you now this little
spot I'm sorry slide you have the xql
code you have the dotnet quorum project
references the function configuration to
show you now and then the app settings
I'll show you right after let's go back
to this slide because this is pretty
much all built now so what is this
function JSON that third thing there's
your binding and you can see it's a blob
trigger that's the type
it's got an input parameter and the path
is this uploaded name exactly what we
still be stuck in the that little
template description when it asks us for
it so let's go back here
everything's saved we should be good to
go except for one thing
write down where is it here it's asking
we have to get an application saying we
get an API key to call into cognitive
servers it's just like you do with
anything in Azure or I'm sure AWS second
I think you have to have a key that says
you're allowed to go in and call this
thing there's a couple ways to get that
key the first one so remember this my my
demo fail West get central US West us so
in the slide sorry I'm jumping around I
gave you this URL here you can get your
API key here that's not how we're going
to do it for this demo I'll explain why
in a second but if you guys don't have
an add your account you're like this is
pretty cool but I'm not really into this
or I'm an 80s guy I don't wanna take the
time I don't want to give Microsoft a
password or whatever you can go right to
this site here's the URL and you can
play with all these cognitive services
api's so you just go right to this site
you click create it's going to ask me to
login I'm not going to one of this I'm
not going to bother to log in but you
log in with you don't have to even
create a new password you can use your
Facebook one or LinkedIn one and then it
just gives you a free account for a
while and gives you an API key as part
of it it's a very simple screen there's
not much to do but then you can start
playing with it without having to set up
any kind of an azure account so I'm not
going to do this here's the key though
if you use this URL and use this free
account you must use west central US
that's what they move to my demo didn't
work I was using that that that website
for the the key it'll give you a key you
stick it in application settings which
you'll see me do and make sure you use
west central US but we're not going to
do it that way we're going to do it a
different way because we want to make
this a production-ready system
supposedly right so what we're going to
do is we're going to add the compute
vision API to our Azure resource group
to the stuff that we're working on so
I'm going to go new AI in cognitive
services and right at the top you see
computer vision API and now we have to
create a new one of this and we're that
some visions cloth vision app and you
see six one six use my subscription this
is key this is where I've messed up
before I'm going to use West us because
I have to use West us because that end
point remember in the code like which I
can't flip to now like I can flip to it
here this is the cognitive services call
it's at West us so you want it in West
us pricing here there's a couple
different pricing tiers to use I'm going
to use a cheap one for this demo this
time for the resource group I want to
use the one we're already using I want
it all together so I'll say func app
resource group little signature thing it
needs so West us this is the important
part right there I'll pin this to the
dashboard I'll create it and this would
only take yeah this is only take 15 or
20 seconds so I'm not going to go into
anything else there you go so that
worked the only reason I did this was to
get this access key so I can call into
my vision app which I just put in my
same resource group so everything I
haves all together so I'm going to click
on this little link for the access key
and I'll show you the last way that I
just just demo blew up on me I'm going
to copy this key and because I have a DD
and I can't really focus you know easily
I'm either completely focused for 18
hours and coffee staying up all night
like we all do coding or I'm just
totally you know a mess I never noticed
this little message that says notice
when you generate these keys they might
take up to 10 minutes to take effect so
that got me on a demo I was going
through it really fast and then it just
didn't work didn't give me any
didn't work and only later did I notice
the little notice that says right it has
to be red and blinking for me to notice
something like that so if this demo
doesn't work it's going to because of
that thing right there because I don't
want to make you wait 10 minutes but it
nine times out of 10 it works fine and
then just that I don't want to batch
Microsoft nothing - with Microsoft it's
just we're trying to do a demo instead
of something production we're being
careful about it but I copied this key
and that was the entire reason I created
this this vision app so let's go to our
function app and set that application
setting so how do I do that this is our
function app here's our function that we
just built there's a couple ways to put
in settings the one that says settings
where you think it would go is really
just the most basic stuff there's almost
nothing there but when you go to
platform features you get this rich set
of tooling or not tooling but settings
you can do for for deployment slots and
proxies and custom domains and all kinds
of stuff we're going to go to
application settings let me just bring
this code up one more time see exactly
what I'm doing we're going here we're
going to look get an application setting
it's called subscription key that's the
name we gave it in the code so I'm going
to scroll down here to app settings and
we're going to call this subscription
subscription key and we're going to put
in that key that we copied subscription
key we'll save it and I'll just save it
up to the cloud it takes about 15
seconds
usually there you go
all right close that so if I go back to
this as your function well this is
another thing that's that's interesting
so if you do this well I just keep going
on with my story so nice oh did you see
that when I brought it up it just was a
blank screen for a bit sometimes that
will be like that for 30 seconds and you
go everything I just lost on my work
it's just grabbing it back from wherever
it's stored in the in the data center
and sometimes it takes sometimes it's
instant sometimes it's not so there is a
log file down here that you can see that
you can click run and test this out
which I guess I could do but I'm not
going to bother do that right now but
it'll compile it and you can see if
there's any errors in there since I know
I get everything perfect right
I'm just not going to bother to do that
and now we're done we've done this
entire thing here we have our three blob
containers we raise our vision app we
have our function app with one function
in it all we have to do is test it out
so how are we going to test it out make
sure all these files are still here that
looks good this was built for us we have
this alright yeah I was waiting for it
usually it just sits there and and runs
this thing let's try to run it and see
that nothing okay hello on the reason
it's showing an exception typically is
because there's no file for it to get so
I've made it run and there's no file for
it to get the of and anything yet so
we're probably okay let's just test this
thing out how are we going to test it
we're going to go over to our blob
storage again let me refresh the screen
so you can see our resource group
so now you have you can see that our
vision apps part of our resources go
back over to our storage to our blobs -
uploaded container and what I'm going to
do is I'm going to upload some image
files let me show you what these image
files look like so there's nine files
some of them have no people in it some
of people in it some of people with a
little skin showing a slightly funny
thing that happened when I first saw
this my same colleague you put that
little slack message up about the nudity
did this his talk this talk the first
time with just the woman and I said to
him you can't come into these
conferences and just show that the the
potentially racy thing is a woman in a
bikini you can't just do that which he
still does so I added the guy because
this is a gender-neutral presentation
that I'm doing here I mean but what you
think about the score I mean this could
be offensive in a Muslim country or some
of that Guinness never knows it got to
be a little careful so I just decided to
be equally I don't know if it's careful
or equally offensive or not but the idea
if I didn't screw anything up let me
just move this back here to large icons
if there's nine image files here two of
them and their image three image three
be potentially could be offensive to
somebody depending on you know I guess
who you are but that's the kind of thing
that if you could post on a public
website or Facebook that they might go
eh what are you doing and this automated
machine learning algorithm will take it
away or give you a warning so I'm going
to upload those files to this uploaded
container okay
here they are let's go open here's the
first moment of truth so when I click
upload sometimes this is instant
sometimes there's a little latency but
you shouldn't see a bunch of errors you
see a bunch of errors either I did
something wrong or some weird data
center things going on because we're
talking to West Europe and we're talking
to West us let's find out
boom boom boom boom boom that's a good
sign
how many are there 1 2 3 4 5 6 7 8 9 ok
so we got all of these pictures up there
in the uploaded container right there
here that as your function should have
triggered 9 times passed it off to the
computer vision API and done something
with it so just so you know what happens
when this demo doesn't work it's this
nothing happens at all you just go look
and then there's no errors there's
nothing you're trying to figure out what
went wrong let's go over here ah 1 2 3 4
5 6 7 so that's good so at this point I
actually know the whole thing worked
because what it did is it triggered on
each one of these and there's seven of
them that are probably ok there's two of
them that might not be right so there's
seven files there let's look at the
rejected folder and it's three and its
3b so it all worked now how did it score
I mean what did it actually do we did
write that you had that log metadata we
wrote metadata to the blob file let's go
over here and tell you what we will
close all this down close all this down
let's go to as your storage Explorer so
here is our as your storage blob
container hopefully you guys can see
that here's our I'm sorry here's our
shores account here's our blob container
here's a rejected folder double click on
it there's our three two files I'm
looking right into my Azure storage
account so let's look at what these are
so if there's three in there three
because I have one fun more funny thing
to say 3 is the woman 4 is the man
right let's look at look at the man
first so you can click on mystical
properties I know it's a little hard to
see so I'll read it for you and here's
that metadata that I wrote just a room
just to remind you delight was like -
associated the codes it's that little
helper function where whenever it wrote
a blob that was rejected I put some
metadata in here because I wanted to see
how the how it was scored so what you
see is this is for the man is it adult
content no what's the adult content
score or adult scored only 2% definitely
not pornographic or anything right is it
racy yeah it looks like it could be racy
the racy score is 45% for the man all
right let's see what the woman is I
think this is kind of funny no well
there it is okay
is it adult no she scored slightly
higher instead of 2% when it's 15% is it
racing 87% so I want you to look at
these pictures now and I want you to ask
yourself just for fun what's that
computer vision machine learning I print
I'm doing because obviously the man has
more skin showing but he's not
inappropriate really hardly at all but
the woman in the bikini is twice is
inappropriate according to this
algorithm was her so there's definitely
some sexism going on and this cognitive
services API but anyway I want to kind
of end and I'll again I'll post those
URLs I want to kind of end oops
going back to our portal for a second
and I'm not trying to to make this any
kind of revolutionary thing but I never
would have thought of doing something
like this and a quick as a function but
if all you want to do is say there's
image files I want to do something with
it in the past I always would have
written an app to do it or I would have
written a service to do it you know or
worker roles to process it but all I
want to do is say image file do
something this is totally appropriate
but it's doing a big chunk of stuff in
the background you can now scale it
manage it to deployment plots with it do
proxies monitoring I can do all the
stuff you can do with Azure - man
scale you can do different consumption
plans and stick it in the VM you can do
all this stuff because it's on the cloud
and all you're doing is is sticking a
stupid little function up there and that
run algorithm and now you have a
different kind of way of doing a
Microsoft services architecture you're
not doing something service fabric app
which is you know everything's
appropriate in its context and for its
purpose but this is a real different way
of doing I would say micro services and
we're starting to use it more and more
and more as people are just getting used
to the fact that oh this is a different
way to do it it's new to me I'm not sure
yet and we're using it in major
architectures more and more so I would
encourage you to check it out and just
learn about it and see if it's something
you can starting at start to add to your
toolkit because the world is going this
way in a lot of ways in AWS they call
them lambdas it's a big thing it's it's
it's evolving rapidly and it's now
something that's part of every
architecture discussion we have is hey
do we want to do X or Y with an azure
function so let me just post this this
slide again so you can see it and we
still have ten minutes left so any
questions for me about anything at all
relating relating to this I can't really
see that well but okay
so you're talking about so the question
was what I think is the tooling around I
guess various thing versioning and
DevOps and as your functions you want me
to talk specifically to add your
functions or just in general okay
because DevOps we're a big DevOps shop
and I love that tooling so the Azure
functions I mean as you can see I think
two things one is that that portal that
screen and I showed you with where did
the app settings and it shows that the
function app literally a month and a
half ago that was not it didn't look
anything like that it there wasn't even
a menu across the screen it's the same
thing I didn't tell you every story of
my panic for this demo but literally
David for a demo I went to that screen
and my app settings were gone they were
like where'd you get app settings and I
called you know my colleague is like oh
now you go here that was just
there's no announcements for this so the
my frustration with the tooling around
this is actually a good and bad thing
it's evolving so rapidly and they change
it in an almost daily basis and it's
frustrating if you're a presenter you
know it's not nearly as frustrating for
your developer because you're doing your
stuff and you know it's all going to
work it's just moving around so that
portal changes so fast it just kills us
sometimes on it but it's not it's not
changing and messing things up it's just
evolving and getting better
it's a order of magnitude better than it
was three months ago
just that one screen and now in Visual
Studio in the fall you're going to have
it in the visual studio tooling I'm
curious to see how what my devs do with
that are they going to do it to a visual
studio or just kind of continue to do it
in the portal I mean our environment is
Visual Studio code or Visual Studio
depending on your eclipse or whatever
the thing we're doing there's just so
many options so that was a really bad
answer I like how it is now it's getting
better so fast I don't want to say
anything negative about it my main
frustration has been those four or five
times where I told you here's how I
screwed up the demo because things
changed in the Microsoft side I wouldn't
say it's it the awesome level yet I
would say three four months ago it was
basic and now it's good and I anticipate
that you know being Microsoft you know
version 2 and then version 3 it'll
probably really good soon so I'm not
upset about it it's just been evolving
so fast it's a little hard for me to
answer but I'm happy with it now so five
years we won't be look who knows what
we'll be doing in five years right right
yeah yeah well that's that's kind of for
any I mean you're a developer right
you've been in either your own company
or customers and so I so some of you
guys are internal or I guess I would
call them corporate developers you're
building stuff for your company and then
some of you I'm sure consultants or
contractors and you're going to do it
through extra to external companies and
all kinds of different customers one of
the cool things about being consulting
which is what we are is you get to go
into so many customers and you know you
see this much wow these are these guys
are bright and then a lot of times
you'll see these guys are bright but
they're a mess and then you'll see of
course you know the other ones like
they're not bright and they're a mess
but you really learn you really learn so
much and when you see these big
architectures if anything's more than
five years old
I mean five years ago none of this was
here they were doing completely
differently and even if it's a good
architecture once you get five ten
fifteen years into legacy code it's
you're you're you're just gone there's
just nothing you have to rewrite it you
have to keep it up-to-date so as another
bad answer for you but that's why under
Street fun right I mean you're always
learning you're always challenged this
stuff is really cool I mean when I when
my the guy named Ken use and a guy in
that war room three three half weeks ago
he was like I'll just write an answer
function called the bot service like
what are you talking about I literally
was like can you do that he's like oh
yeah and I had no clue I mean because
I'll be honest so I was a developer for
many many years now I faked being a
developer you know I'm kind of in the
management side now which I resisted for
a long time but then it's just a new
challenge it's been kind of fun and in
the Microsoft Research stuff and Ardie
stuff keeps me
keeps me honest a little bit anything
else yes I so I think the question was a
comedy and how many kind of places are
examples if you found it useful and do
you do it you know by itself or in
combination so I'll answer the first the
second one first absolutely in
combination you know we're not building
an app that say there's this big thing
to do when it's going to be 1300 as your
functions at all but suppose you were
doing something that is a to the answer
to your first question is we've
definitely definitely finding it useful
it's still new to us so I think our main
challenge isn't really as much as how do
you architect it so what's appropriate
for it and if you have something like
exactly like what I showed you just want
to do this one thing I'm not trying to
do 12 other things with that image file
and then do this that and the other I
just want to do this hey I already have
an azure app or an azure thing maybe or
or maybe I don't even have everything in
Azure but I just want to do this one
thing it's it's um I don't want to say
atomic but there's a better word for it
it's a simple reusable thing that does
one thing now we always think Hayes is
an azure function appropriate but if
you're an architect you don't want to
have something with 85 things in it that
you're trying to manage so one way you
can do it is and you can abuse this I
can have that as your function app we
had one function in it typically you'll
have more than that you'll have a bigger
context of something you're doing maybe
it's going to be called content analysis
and one thing is adult content one thing
is you know security one thing some of
that you could have two or three or four
those at functions in the function at
okay so you don't have to have 50 of
those function apps you could have one
function
and two or three or four now you can
abuse it there's already stuff out there
when somebody creates an as your
function and it's 2,000 lines of code or
you know is that now still appropriate
for a natural function maybe maybe not
is it appropriate of a function app with
35 functions in it probably not you're
probably not taking advantage of
anything anymore so you still have to be
an architect and think it through and
I'll be honest I don't might it my you
know management semi management level
now I always have my archetypes up here
and see what they think and so I don't
have a really great answer for you but
my answer is still real enough that you
have to think about architecture no
matter you do in service fabric you're
doing the estrogen whatever that's why I
say at the beginning I was curious if
any of you guys have been doing it
because I want to learn myself but still
relatively new it was an AWS well before
as you're brought in as your functions
ad beside lambdas so I'm kind of
surveying my friends with you AWS stuff
and lambdas it's been around a little
more there but if you read the just the
news articles on it you'll hear lamb
those lambdas lambdas people are
starting to really use it and I'm
curious too it's one thing to build a
workshop level app you know a
medium-sized app but then you go into
Exxon or slumber J or whatever and you
have a million lines of code what are
you gonna do with it then I don't really
have all the answers yet but I'm trying
to learn just like you guys are we're
almost out of time but yes
couldn't even see you sorry if yes so
one thing let me show you something if
it's still it's still up see if I can do
it real quick yeah here it is see these
slots
it says preview for proxies preview
slots and I actually have a slide on the
appendix slide on that for you guys so
you can do deployment plots and
everything just like you can with like
if you're doing a web app that kind of
thing I've never tried personally to
build it into the continuous deployment
aspect of visual you know when you do
visual studio and CI and you're doing
visual studio team system and doing that
whole pipeline I'm assuming you can but
I've never personally done it so I want
to be careful what I say but I do know
you can already do things like
deployment slots and swaps and things
like that it feels like it's the normal
stuff you can deploy it in the fall
preview from visual studio just like you
deploy a web app so I'm guessing yes but
I don't want to be definitive about it I
haven't done that yet so I'm going to
start packing up so whoever else comes
to your next can and get in here but
I'll be I'll be around and happy to talk
let me just kind of thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>