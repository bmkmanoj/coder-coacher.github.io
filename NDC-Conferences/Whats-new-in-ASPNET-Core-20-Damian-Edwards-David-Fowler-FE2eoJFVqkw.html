<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What’s new in ASP.NET Core 2.0 - Damian Edwards &amp; David Fowler | Coder Coacher - Coaching Coders</title><meta content="What’s new in ASP.NET Core 2.0 - Damian Edwards &amp; David Fowler - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>What’s new in ASP.NET Core 2.0 - Damian Edwards &amp; David Fowler</b></h2><h5 class="post__date">2017-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FE2eoJFVqkw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right it is good evening at 11:40 is
it evening afternoon I don't think I
slept last night so if I collapse on
stage you'll know why let's try not to
have that happen
hello everybody back at NBC Oslo I am
Damien Edwards on the asp.net team did
it feller and his team as well so we're
going to talk about stuff in a spinet
core - who was using a Jeanette core one
of some description today Wow look at
that
who loves it keep the hands up that's
awesome so we released a preview a first
preview of the next major version which
is a little quick I'll be honest we only
released but we really want to what last
June that the tools didn't our party
have until March this year so the one I
wasn't really until March in some ways
and here we are in June we're already
talking about - oh so we released a
preview want to build anyone tried out -
oh yeah pp one no one no one a couple of
hands like one there's a big waving okay
good good we're going to take you
through we had all code we're going to
show a bunch of stuff that in - oh
there's a bunch of stuff that's into her
that we're not going to show smaller
things things like that standard -
that's a really big deal
bringing back like tens of thousands of
AP is into definite standard I thought
their core - and they spin their core -
will support on that standard - so
that's a really big deal and there's a
lot of little minutiae things under the
covers as well but we're going to focus
on some demo level stuff so without
further ado alright so let's start by
using them so I'm gonna demo on the Mac
so I'm not sure yet at all today no I'll
show you this at the very end so get
used to it so you can't see that that
good point two minutes up
louder oh yeah perfect
okay good alright so in Kamiya line
alguna new we have a new Don a new
internet 2.10 type everyone saw this
it's a new template engine so I can
create all kinds of new templates I can
acquire templates from the internet as
well and install an excel templates from
new game from new get so it's pretty
cool some there's been only third-party
ones for F sharp time for angular and
then reacts in whatever whatsoever so
I'm going to create a razor pages
project you'll have a page of dollars
you can create project and keep going so
we have a new thing new feature in MVC
razor pages anyone looked at razor pages
yet one hand I see one hand here the
gentleman watch a razor pages is awesome
so we're going to build map and razor
pages I'm going to show some more rays
of pages features later on but yeah so
just think of it as it's MVC it is MVC
it's the same framework it's the same
view engine it's just that you can put
stuff in a page file rather than putting
in the controller so that new razor
enter so creating a template for rigid
pages and it should restore as well okay
the next new feature restoring on new
template or open my vs closed I should
see a new project I went to Zen mode
another just not yet considers it let's
go into the program man first and start
up with open e to files and then I'll
close that and in its neck or 2.0 we try
to simplify the template a bit by adding
of adding on a painted his um method
called create default builder if you
recall in want my old this code was kind
of like post equal you know new web host
builder it had youth Kestrel
it had used content route I much
different stuff on this thing so we
chose to make it a bit simpler in 2.0 so
we added this create default visit which
kind of has a bunch of defaults put into
it including reading from config Ville I
didn't config by default frappe settings
audition adding the VI configuration to
the actual VI container I am logging for
console on for debug what's to do I
think it just uses Kestrel obviously
I've cast early add ice Express if you
if you're on if you are on is almeida
let ice support for you you've mentioned
that the puts configuration in the div
container so that you can get to your I
configuration instance throughout your
application we also configure that
configuration with your number of
sources by default it's basically what
you saw in the templates before so
there's an app settings adjacent app
settings dot environment Jason you a
secret environment variables all that
type of stuff so that's all just default
and you can change it you don't have to
use that API you can either go back to
the very manual bill your website
builder yourself or you can change
things off that API and then compose on
top of it just like you can still add
logging right if I do configure logging
I can add more things here so this is a
change from 1.0 where logging was
configured in start class not configured
in the program main and it's also a new
method called configure app
configuration it was called configure
configuration but that's one it kind of
where to do your configure configuration
to get all the configure ratio you could
just do this and say context builder and
you can add more things here dot won't
compile I can do builder dot add Locker
secret side after key vault etc etc you
can compose on top of the default loader
as well right
alright and they're in here they're
earlier because they're all in DI now so
configuration before wasn't in DI
logging wasn't really in DI only the
logo factory right but now all this
stuff gets set up as part of the web
host and it's available to use super are
in the DI container alright so let's
look at my program means I'm sorry my
start path no I should see
we now get my configuration in
constructor before this which I've seen
you two in the constructor you had to
ask why this hair it's nice for a bunch
of reasons if your test before you have
to kind of work on the fact that that
you had to read from
twelve in the star conductor they can
pass in a different configuration in
your test from like in memory or
wherever else and passing it via on di
questa near then what we had in 1.0 and
another big change is on logging so
logging we made it so in one point all
you had a call here that was inject the
I forgot factory like I find it love
your factories and then we call factory
dot console an ad lock or whatever and
we configure here in 2.0 we've made a
lot of lager configuration and intrinsic
so now by default every one provider
gets this pluggable config by default so
you're in 1x we only supported that on
the console logger it was a specific
detail of the console lager provider but
it's super useful you can change the
logging verbosity and who you're
listening to logs from while the
application is running just by changing
this file and the configuration gets
reloaded on the fly right so now that's
available to all logger providers in a
snare core which is kind of nice let's
show that so if I die tonight run this I
think I have the in variable set where
I'm in debug you know no all right
export asp net core environment equal
development play button i run this now
it should say development I will show
you logging and perfect let me like
sleep quest hit this URL she was
different that's a super tiny browser
you have there there we go let's zoom
all the way ok good it's runs I have a
bunch of logs having here by default for
the console I can go into the app
settings development Jason and I can say
I want Microsoft to be warning only
pivot no reloads I'll hit a five again
refresh refresh refresh refresh I know I
can't that did that even prove it to you
okay well does by one
debug because you got MEK it can make it
more if we get a lot more stuff I'll
refract this note and it should show a
bunch of stuff from Lake there we go
Kestrel and yeah true rotor different
stuff right Castle showing the actual
tracking you for the request because
it's coming from config you don't have
to put it in the app settings but JSON
file you can put it in anything that you
plug in with your configuration provider
so you get past those things for
environment variables we know whatever
you want so alright so let's do although
environment variables don't get reread
on the fly they don't say files we can
detect changes from our environment
variable right alright so one other big
change we made to dynacord 2.0 we made a
big change to our security system so if
you've been using the authentication
system and virus right there staring at
me so I hope nothing bad it was kind of
broken it was a relic of what we had in
katana so katana was the Owens back
forest for Microsoft asp.net core before
core and we kind of ported it verbatim
to Donette core and it had a bunch of
issues that were very intricate but it
caused bigger because she was like
across the board so we made a big change
in 2.0 to mix to make it so that
different kinds of authentication
providers are how they move from
middleware to services and there's a
single off middleware that kind of
married me and talking together we made
it better
really much better yeah so I think there
was we maybe had a same way but we made
a mistake in one one so we don't try and
break people obviously in minor releases
but it turned out the security system
for the old system design introduced an
unintended behavior that we didn't even
realize and so we didn't know people had
suffered depending on that behavior and
then we inadvertently broke that
behavior by by fixing it in one one so
the behavior no longer worked and that
broke a whole bunch of people who relied
on the behavior so we worked with those
people in the community into Oh to
redesign the system so that it was a lot
more I guess it's strict but you can't
do things the wrong way is designed to
work the way that people weren't where
actually ended up using it so yeah it is
but it's very um very strict now all
right so I'll just do services dot out
authentication I believe this wasn't
here before
at ostentation
services that add cookie middleware so
this is new before you had a musical
middleware in the actual configure
pipeline line services we've moved those
things to be services instead like a
newly configured 50 middleware options
and say I want login path to be slash
login for example so technically this
isn't a middleware anymore correct yeah
this one autumn it'll wear and then
different things plug into a different
scheme there's a single call to a use of
indication middle in the pipeline if you
notice we have to have the entire a
fidelity API is available to you in 2.0
enough to like to find the package yeah
so before this would have been find a
package adjacent file do restore out of
package over and over and 2.0 we added
this thing called the uber package so we
call it in terms of meta meta package
and it's super simple to single line
you're in your CS price that has
Microsoft based on the court all the
name crap I mean I didn't name it I
named it so I think we threw around a
few names and no one came out of a
better one than to almost dot then
overdue most then you can't have one
that's like mooster that one we have
that more this is literally everything
we added everything everything we ship
including all the third-party
dependencies you have everybody
providers like reticence equal live and
it may sound scary it's everything it's
so scary but it's not as bad as you
think it's going to be known because
there are other features that make it
also but you get to see all the API you
have to hunt for anything if we ship it
it's in there you get to see it by
default which is really cool there's a
question from this gentleman right here
hang on this gentleman happens to be
John's me all right oh my god see him
but I could hear him so let me do that
again there's a question from John ski
yes
all right so the question is can you as
part of like packaging the app at the
end
can you seal the dependencies so that
button after prototyping so that you can
kind of trim trim into the actual
concrete things that you have do you
want that then to be preserved in the
project forevermore no you know I'll do
that there's no there's no gesture for
that today yes there is a product that
and even the thing that we know exists
that that is going to be released in a
couple of weeks as a prototype doesn't
quite do that but it gets you a little
closer to that we take the requestor so
if you want to test you jointly helps us
out but it is super nice for development
cuz I can see all the API is like at
once my god is there I can find Twitter
and so one what kind of a troll thing
that we did it's not troll it's kind of
a half troll these things are completely
defecated so this was there to make it
show the errors in the actual IDE but
you can't use it anymore so if you have
if you upgrade from one of the tool and
you have cookie middleware or Twitter or
Google is laughing - and you're crying
we'll be like sorry bro but and you read
it occupies your lace there we but you
read the docs and then you say then you
go okay this is much better because we
designed a better system into please
below
alright so let's add Twitter because why
not
options okay if couldn't help the
intellisense client was it was a
consumer key and consumer secret I love
how all the different all providers use
different names so they have secrets and
identifies that's super helpful
so are you just being assassinated from
the back so divine
I'll protect you we'll use configuration
and by default we also enable user
secrets if anyone here ever checked in
stuffing into the people that shouldn't
be in their passwords connection strings
you're all lying everyone is not credit
card numbers I've searched github I've
seen it
let's lift the good test machine key ok
moving I'm just reading over this diary
is going to come up here drag you up to
date all right so here we are we have a
graph editor to services and we're
reading the configuration from
configuration huh mom so now I want to
actually set the configuration keys so I
say you Twitter mm-hmm at runtime so I
have a secret top secret file on disk
that is super secretive that has okay
good good you made it small so I'm gonna
have to I'm gonna have to like do the
keys keep after the talk but what if I
look at my
put it in NDC Oslo practice maybe
yeah notes okay so this is gonna be
recorded but like don't look don't look
I use my keys my keys alright so Twitter
consumer consider consumer secret so I'm
going to use the dotnet command line
tool dotnet user secrets which is
included by default with the template
every console is like super small
alright I'll go into the folder the NDC
we have two talks by the way so this is
Pakwan have a popsicle as well
okay it's you're wondering why two dogs
one keeping okay for dotnet user secret
all my default pretty nice set Twitter
consumer key with that
and then the other one is Twitter
consumer secret which is super secret
please don't copy my clip is a really
good one
please don't look you're racist sweeper
slowly oh you better say ah almost worth
painful yeah yeah good hide it quick
alright one more thing I want to do
before I continue I want to ads on that
watch then we use watch before because
you all use vs they don't use BS code
like in real life's not for a joke looks
like every day every day and they don't
so that I used eh like at some random
points I'm the UPS kool-aid no matter
what yes yes the via star Jesus want to
we've done that call 16 others good
perfect I'm going to add dotnet watch I
think I know the name of the stars Isis
dotnet why is this extensions done that
do you know why we had has done it
because it's it's a tool for Catalan CLI
arbitrary because naming is hot David
Leslie botnet watch our tools I'll run a
restore in that folder and I'll do net
watch run nope nope group it started it
did something tried alright there we go
not be can write good without home to
worry about having to refresh the page
over and over yes perfect alright
so all these super complicated and I
won't even explain why I'm going to fix
this
I'm going to fix it anyway and just show
you like how complicated Berry's fault
because you helped design a system so
you can blame him afterwards so I know
it's my fault you have to set all the
options so we don't have any good
defaults here yet we may change this as
soon as we leave this conference there
are no good default I'm going to set the
defaults to configure 10 occasion so
there's five verbs for for
authentication there's a fennec aid
there's forbid there's challenge they're
sending an understandable if you wonder
what they mean you read the document
they should go to hit list super yeah I
what time tomorrow 10:20 read goodbye
talking tell you about those those five
verbs and way not by default
no there's nothing by default Oh what no
this is I'm going to hard codes like
these three names should we just stop
and then get a Barry stop tomorrow maybe
we should and then we'll just continue
little learn we're suffering I'm just
gonna all right so default science game
default challenge and default indicates
game so when you go to Twitter and then
come back from Twitter to sign in to the
actual site Twitter storing it attendee
into some cookie cookie well into
something and I'm saying
whenever Twitter comes back sign into
cookies so I'm using cookies distort
Twitter's our ID and name from that
handshake right cool so this should be
fine now should work okay good let's add
some UI so I can log in at any rate the
page a new thing I'll go to pages and I
will type from the command line and
there is a be attempted for this there's
like a dotnet found new project for
inner pages new razor types of project
and in your project ID page anyway okay
so I wait there's this new like super
cool it's not working though so I won't
read anywhere oh but it didn't
autocomplete plug-in coming for types
and reason I feel like so I assault it
is super really not ready yet but it's
kind of cool I've done it top
autocomplete in bash
power felt the combined names so the new
page laughs n log in and namespace but I
call this project did you call it my MDC
talk one lowercase and lugging me about
pages alright have a page now my page
folder and says no one has seen where
the pages the immunity baby you can
explain what it is if I hide right
unless the model white circle and that's
a method that will run when a get
request comes in why is it better than a
NBC return view there's a lot less stuff
you have to do in letters I get it to
run razor but you get all the power of
MVC like use literally nothing you can't
do here that you would normally do when
returning of you in fact you can do more
stuff that's really fun and if you know
all you can't do for when you're doing
pages stuff for engineering HTML stuff
often so alright I'll do a little bit
more of this later awesome so we're
gonna inject a new authentication
service or me I think I think it's
Nellie's 2.0 i authentication I can't
type it out someone step in using first
case in court identification and I'll
inject the I authenticate
scheme provider seconds get all the
schemes that were added to the autism so
by default so by default it'll give you
the schemes for cookie Twitter Google
windows become of you additive services
I want to get just Twitter so I'll show
you how to get that right now so
scheming provider I'm going to do the
designs where I store variables in a
local field and then this is super
annoying by the way I hate doing this
does the Rosel digs up but now at some
point time you go to Esther's so I can
clear a property here that will be
available in the view itself capture the
authentication schemes
Get Set property and on get I'll just
set this these schemes to be this scheme
provided get request handler schemes
these aren't the same I get all schemes
get all schemes returning things like
cookie and Windows get requests on those
schemes gives you schemes that are all
outbound late for Twitter for build the
eternal ones so I can make this async
async void and terrible no I don't need
to add a front-end for this so in my
front end I'll render out the links for
this and I just copy and pasted okay
well I like watching you type HTML it's
always fun
no no not even going to therapy I'm
going to copy the page from my other
project is right here just have a preach
and everything on a page that's a lot or
each loop in a button it's super short
you look at that that is quicker even
talking you can copy that you guys
better than you talking to that there we
go all right so I'm printing all the
schemes that are in the DI system and if
I run this page I should have well it's
a good log in it explodes ha
malformed type helper Oh copy place
there Oh another one
the name space Riding Hood illustrate is
definitely going to be your name space
you think fun
can't find the model so thought he
didn't work any worse a good import you
broke it off this was working before
hardly very good our model at page a
page means it's disarray the page login
model that's try very nice plain people
get signal issues login same namespace
we got it in the other ones or text is
on page is either oh is that different
okay that looks going through the bug
you me someone help help help
hmm logging model pays model blah blah
blah blah so this works you just change
them fully qualified oh okay Stephanie
the model
this
you don't know what's working I'll just
check your watch what the hell okay when
all goes wrong what do you do normally
close everything
hello everything you restart yes you
reboot your computer let's delete your
hard drive you start from scratch
alright botnet run it's not what anymore
that's bigger on the login link you just
restart the top of that left pocket
really what arable haha okay you were
right all along it's just not going to
pull us to the license there's a forum
here that has each scheme Twitter
whatever I'm going to Google I have a
button here that has the scheme limiter
in a value field looks like it's slowing
athle pull it'll pull up to the actual
the page the code behind and it will run
my my own reaction so I'm going to add a
dot a non-public contours here public so
we've got a method that will run on get
will have another one that runs on
thyroid on toast and it needs to roughly
return and that's an action result so
this is familiar right alright so now
we're going to say this takes a scheming
from the actual the button that about
yet known value will return challenge
the scheme and I will redirect to
the kitchen properties redirect your a
flash or yeah I should be good enough
what's good enough so I'm going to pause
I'm going to click on Twitter
it'll challenge Twitter which means good
food calm get my authentication
credentials come back to my website to
the principal I know there's anything
cathedra changes is going to work for
the first time like third-party or never
works so fun
you either paste the key wrong or you
didn't fill in all the fields on your
Twitter app or you're not using hvs or
you can't use localhost you edit your
host file if everybody authors just no
way that's not going to like first time
for first time or you'll forget your
Twitter password that you think oh my
goodness - dude how do I know that
worked didn't do anything I took nothing
changed I don't trust you I could copy
some prove it copy something you know it
read it it's a copy from my notes and I
put hanging in the nav bar some
wonderful UI in and that word oh no whoa
that was a paste copy this wonderful
piece of code that look into the actual
deal page and says where does it go I
don't know it goes in there somewhere
there you go that's right that's not how
it looks face hello that looks right all
right little bang I'm logged in print
the name and show a button for logos but
I'm logged in sure I'm not what that's
logging right refresh ok
says David fell okay that doesn't work
because you don't have a look at link
yet let's fix that okay looks like the
others David fell I believe you know
work someone here all right my twitter
name missing right here alright so in
start-up I'm going to add a piece of
code that will handle the log in log out
button mm-hmm and I could do a
controller but instead I'll show a
lesser-known
way of doing that which is routes
directly so I can do use rudder and I
can say
routes and I can type properly and say
routes dot map post logout this should
be a sync context so you're just going
to route to a delegate basically that's
nice and lightweight so whenever someone
says whenever I wrote this logout it'll
call me Ella gate I can just say
contacts dot so this will trick this
will trip you up authentication it's
still there in 2.0 but it's deprecated
but it's deputy right now it is so thank
you it will be if I run this it will it
might just do nothing
I'm not telling me it's not working so
say what you want to do is use this
would be a thing I'll show you an
upgrade set from one school right now
you just do this easy and then control a
lot out like you bring it in thank you
message you're confusing but we did that
to aid to aid my erasers yeah otherwise
you just like not use your app doesn't
compile at all you don't get any any
indication as to why so when that
happens I'm going to just redirect
response redirect to slash all right
perfect
so no I wait five seconds for what to
reach out my app telling something is
happening too quick there you go back on
logout that works nice login Twitter
photo boom I wasn't too bad all coughing
all right some more features we added
some more stuff well I'm a little
concerned about that mendon a kid just
going to bring down 500 megabytes and
stuff into my app you should be yeah so
can we look at what happens let's do a
publish and see what happens to
applications all right so I have my
application right here trade the one
outpatient practice schedule over here
so you do one other one let's compare it
to well compared to a NDC Oslo 2017 100
101 apps
and because of a super awesome bug
somewhere open anybody somewhere at some
point in time in some product second
type 2017 is in any type of completion
for that I have two national folders so
dumb all right I have to add a global
dissing that says please use the wall
point one tooling because the two points
or tooling can't create one of projects
temporarily in the first period of time
very little difference in someone so
it's somewhere in your curse on my so
it's like okay I can't believe I can't
cut into that version is 100 101 okay
104 I 103 oh no I just thought net
version left I ain't stoppin a version a
little done ultimate so you can change
the version I've done it CLI if you just
adequately listen to your folder that's
kind of nice alright so that net new NBC
dur will create a project in the 33
million three hundred 30 milliseconds
dotnet restore that project I will run
dotnet publish gosh see release publish
the application and we will open bin
least net corrupt one oh Sh
look at the output so 1.0 we had terms
of my default and I was doing in the Mac
I'm so sorry
how do i zoom in I don't look a lot like
10 stuff alright that small that's the
100 no app okay now in 2.0 1/2 which
references more right let's do a new app
in this new NBC demo tool in the
clashing dotnet new MVC
which robbery stopping by the way so it
doesn't improve on it ravage darling on
new new project creation alright so let
me do the same thing dotnet publish
actually you release and if I open up
the same same Oh beside you see it no
it's a few happens then lease tool
publish boom look at that this is a bug
but what's the fun if I'm not that one
Lib sequel late by lips are so lavender
so we have a now that we have this meta
package that contains the world right we
don't want to publish all that in your
output that would be bad that would make
your apps enormous and so we have a new
feature in their core too called the
runtime store that allows you to
basically take the runtime assets from a
nuga package and place them in a global
location on the machine it optimizes
them as part of doing that it basically
engines them uses a new version of the
tool called question which pre gets the
assemblies as well and then during
publish you can specify a manifest that
says when I publish my application
please assume that all these things
these runtime assets from these packages
are already available on the target
server and by default phrase from their
core to because all of our stuff comes
with don't know core to that's just all
set up for you by default you can add
your own stuff to it you can create your
own manifest and you can trim out
anything that you want out of the output
of your publishers as long as you
install the stuff in the runtime store
on the service of your deploying to so
that means that these apps are only like
four megabyte in the output vs. 16 mega
something for those similar in 1x and
they just one more thing there one more
thing one more thing free compiled views
DLL what is that
so we also now by default precompile of
your razor views and pages on publish so
you don't there's no views here you can
simply no views folder we've all pages
folder we pre compile that as part of
the publish step using a tool that's
already configured in your in your
dependencies and that means that you
don't have to pay the cost of pausing
your razor jigging it compiling
all that stuff at startup time the real
expense is learning Rosalind your
application when your app starts on your
web server okay because roles is really
big
what's the difference not sure that all
right so I have two apps 101 - oh let's
add some code to time how I paid to boot
yet so like one of our first just in
that word folder
I can't autocomplete NBC
although 2017 one point one app let's go
into code and add some code change this
to be start do it using to be good
citizens those things even though the
process will end or afterwards skill
yeah stopwatch do great on the whole
thing very scientific measurement copy
to stop time the hole for you want to
yeah okay so I find a perk letters on a
programming oh yeah the whole thing
climb the whole thing probably as many
different like three milliseconds in
okay no okay you know if the demo goes
bad it's my soul I stole on me you
change the whole on me that's why all
right
stop watch the stop little printout took
blah see sharp step into index in those
seconds okay we'll make a request so we
can happy time the first request as well
as the start time of the application
client equals new HTTP client and we
will make a request to because I know
the port is going to be get string
5,000 you thought that and never do this
don't do this don't do this
dawn block but it's fine because it
started it's fine all right great
let me copy this code just the new up
yeah all that the old one this is the
old and you look further use Kestrel you
know I use more things this will be a 1
X s yep ok so you're going to publish
this and then we'll run it we'll see how
long it takes
let me shut your folder I don't trust it
that's fine
publish no compile errors that's not so
good alright let me go to bin release my
crap 1 1 publish and run dot Laos
dotnet and contents too bad Oh
autocomplete is drilling me and
efficiently be perfect dotnet NBC Oslo
27 to 1.1 app dot yellow explosion what
combo is running still running
everything go away watch try that again
alright so it took three seconds 3.1
seconds ok good average this is how
everyone benchmarks right
how many measurements does it take
before it's like legit
17:17 is how we burn the next 20 minutes
at the thought so Ketchel works ok click
measure mark Castro at least I thought
we just hit f5 in the browser and hold
it down like this alright so let's run
be I call the other one like a weird
name and new NBC to a demo that was
clever so if we take 3 seconds to Tex
with the first one would round it down
to 3 seconds but yep
this clover can do the same thing I've
got a to our lab linking all games got a
sign saying this code right here it's a
little bit trickier and by tricky I mean
declare variable stopwatch
one result this camping perfect looks
good done it publish that see relief
takes a little longer to publish because
we're pretty compiling the views we've
got a release up to publish a star net
super small donation you'll see and one
DLL one second we get a under second you
know how how we move the stopwatch
we may just okay now it's actually
timing the whole thing when we oh it's
under seconds over it does it run it a
few times will must be Akash's on late
flip there's on the three birds
seventeen seventeen times
look at that get a quick out what a
feature now it's going on again anyway
so that's alright a lot quicker right
and this is incredibly simple side you
have its fall nearly funny project so
you can imagine a bigger side takes a
lot longer to pre-compile trees and
stuff so alright good
there a few more small fringe features
that are kind of nice in tool was my op
again it was taught one this isn't
taught to open this code I'm back here
wonderful so what if you want to count
the number of requests what was the
thing again it costs number requests and
then you have a so this new thing called
I hosted service about your time you
want to do background work in your
application but have it coordinated with
the life is the web host so you could
just spin up a background thread right
but then you have to actually shut down
correctly rather than just like crash
when the application goes away
so we have a new interface called I
hosted service that you can put in the
VI container and then the web host will
discover those when it's starting up and
call start method on them basically and
then it'll run it'll do whatever you do
in your hosted service and then when the
app shuts down it gives you an
opportunity to be notified when it's
when it's shut down as well and before
you could have used the I believe is
called the I efficient lifetime right
but it wasn't very friendly it was more
event an event based model so I would
view and iistened lifetime and have like
thanked popped in to me and I would say
a lifetime dot started dot register a
callback yeah this is more out of
service to the container double get
activated via API and passed a bunch of
contact who does background work in any
of their web apps today anyone like yeah
ok quite a lot of people going exercise
we have a feature for this now so look
at this
I'm going to add a new file call that
request counter or service yes and
namespace my name space public request
counter service device from a hosted
service and it has to start and stop
into all preview - these are both
asynchronous so you can do getting stuff
in the startup and stuff I'm using
preview alright now this not synchronous
it's all synchronous and I will write
some code to print out the request count
every second okay so first we need
request out maybe in the start of
classes out of class called adequate
class err not great both horribly let's
call it request count and it will have
add one
and we'll have a reset and it will
expose a property so it kind of feels
press expose a property called the
request and they'll see Shopify this
thing yeah I feel good
alright let's increment this safely
because it's multi-threaded request one
actually add reset we'll just like we
said looking to beer also pretty simple
service exchange no all right
and then I will add it to the container
I'll do service about at singleton
request count
I will services add singleton I hosted
service as the actual interface request
counter service and
what do you want
didn't resolve
what I thought cannot be used
no interest conversion of that to this
you implemented I think it did it looks
right just biggest card just copping out
again
alright service is an odd singleton I
hosted service not that's why ah quest
counter service now we need to keep a
piece in there that will count the
requests every time the request
something so I'm going to add a new
thing that's a new feature that we added
for a very obscure scenario maybe my
counter middleware and this guy is the
same in space and it will be a new thing
called an i middle ER yeah we have in
your face enough middle work no claps
who's written a custom middleware in
there I hope you do anyone so people
there's no two hands okay goodnight
those interface from other where before
there wasn't one is very convention
based we added one yeah
so wonder if it had any features one
addresses it gets activated per request
versus the activated once bro and I'm so
you can inject Sculptra versus more
easily then I'm to do like resolve
servers from the actual context right so
my country middleware will get access to
the request count and it will just say I
hate this thing why do I type count
equals clouds and then the compiler goes
are you sure you want it and I'm like my
done underscore and then I just resolve
this thing alright every sharp is better
than this
it's okay I need your sharper
to turn tasks but complete ass perfect
so this guy will add 1 to the count
every time a request comes in and in my
startup CS I will say I do have to add
the numeral to the Container because it
is going to get resolved as night
meddler so I need to add my my count
Riddler and the very last piece I'm
going to loop every second and print out
the actual press film pretty simple
I'm with taking a logger and I take in
an ilogger of request counter service
because that's convenient
this is lovely thing let me try
something else again
all right that I need the request count
and do the same thing nope
and start I'm going to do a bunch of
stuff here see if I can get it we click
- you can't the running task so I'm
going to create a top athlete does a
loop forever and does this actual
background printing out of stuff and it
will start off here so I'll just feel
like run create this method I'll just do
well you have to return from stop you
get on just block on stop block start
that would be bad Apple and start that
would be bad ok so you need to kick off
your background where I can get up at
the time all right let's create
cancellation cooking this is Lee correct
this is you this is super correct okay I
lost John later whether this is correct
it's correct that cancellation certain
source and when I end the actual night
and stop let's say cancel just stops
running and I will with the task
complete don't block until until it's
not if they think if you can see away
this okay perfect almost perfect and in
here I'm going to take in account
sufficient open I'm just loop until this
is done
I'm not requested this will be then
we'll just do away task delay delay
second my possum is open and I will log
a number of requests count and this will
be account that request now I'll just
say count reset ok so we have a hosted
service that takes another service that
you're using to track the number of
requests yo if he's a middleware that
also takes that service that things it
today that there are requests and then
the hosted service periodically gets a
number of requests prints it and then
clears it out and keeps going and I'll
stop and it'll slow the entire thing and
it should try to pass it don't whine
gracefully okay alright let's try to
this should the block code should just
work the first time
no I'm not
this is a feature of a log and blogging
that preserved the names of the actual
arguments that if you went citizen like
Sarah log or Cabana lots plastering
those things they can actually start
bike you can search by these names of
these categories that could do that that
would be different different yes my
sketch the catch so I think this is
we're expecting this works I think it's
nice
let's add one more log here so you can
see it stopped yeah okay so the log
information starting counter service let
me do we do plan to build more on top of
this like a background pass runner so
you have to relative code to do like a
simple box yeah we do have a we have
some examples of this right now that for
example will DQ from a rabid MQ thing no
it's good second talk it's good we'll
talk about that later on today but you
can imagine having a bit of background
work in your app there's D queuing from
some message bus of some description and
then reacting to it in your app you
might use it for cash and validation or
something like that right
lots of file yep okay let's try to let's
try this
I always get scared when I see the topic
code in a web application that it's
perfect okay it's fine okay so it's up
the application and it should say
starting counter service
there it goes every second on your
request very good
we might get something else answered no
I'm was everyone I can't tell but but
but
are you resetting it every time you
print it but okay but but I could do
this and say warning yeah only okay and
then we only have logs for this thing
our house like in request request be
very quick when you get back across or
after the reset
where'd you point it logging it's us oh
my production wait this season console
warning I might be right app is it
is it Wednesday huh
I hope so in the other day I mean I am
yep good yep we're wrong at they look
the same that make more really hard it's
better than being in the wrong database
window when you issue that delete
command I've never done of course why
isn't it counting someone pee bucket for
me we don't have time to debug well you
either fix to the next text 10 seconds
or they all think you're a further two
three four Oh up easy fix easy fix okay
I haven't never reset it you'll have to
restart the outer oh yes and that 29
2013 okay when this already oh yeah okay
intentional implementation detail
that was totally not one remember worked
okay and the crashes we're going to end
well that's great I'm gonna let you try
and give the weight because the weight I
kind of gave it away not crash I'm going
to take it pants you can you should show
I'm going to show some other stuff that
we build the top of that that actually
work yeah I think it is working on so
there's another thing we built called AI
hosting startup instead of a I hosted
service which allows you to inject code
basically into the application at
startup time and then have it be called
by the web host build Ares here but the
code damned is like Cyrus as I call it
virus I call it fire it's on a virus I
know it's a friendly virus a good virus
and so we use this now to when you
deploy your a snake or to application to
Azure if you're so inclined and user we
can automatically like that application
insights for you and so there's a you
guess or a little experience in the
portal it says do you want to turn up
inside you say yes and then it kind of
inject stuff into your code into your
into your application the next time it
starts up you start seeing stuff get
tracked automatically which is kind of
nice so here's an app that we built over
the last couple days that's tracking
stuff and have insights and the other
thing it does now is it tracks my
dependencies as well so it's tracking
all these outgoing HTTP calls from my
application automatically I didn't have
to do anything in my app to do this I
didn't even have to reference
application insights this is just by
default as a result of this new ability
to inject stuff into the application at
runtime
now we also use in vs if I hit f5 now
this is basically the same map that
David was just working on but I'm in
Visual Studio still working but working
because it has less code yes if I hear
that five and start debugging the
application if I go back to visual
studio you'll note up here I don't know
if you've ever seen this there's an
application insights experience in
Visual Studio that's active while you're
debugging now it has nothing to do with
Azure when it's running in this mode
okay it's not sending anything to Asia
it's collecting app insights events from
my running application and we do all the
work automatically in vs to inject the
correct configuration and the jet code
the correct code to turn on tracing and
so you get all the traces from Eastern
Air Corps funnel them to your
application insights experience in
Visual Studio did you just figure out
what it was
I can hear that five a few times to
create some requests and I'm going to
hit Search here again and so I can see
I've got a bunch of different types of
things going on I've got a lot of trees
messages but I've got 13 requests and I
could choose to search with just those
and then you can click on though I have
two fab like most are particularly
useful but I could go to the get page
here and then over here on the right you
get all the properties that you would
normally get with a good tracing system
a good analytic system so you get that
by default and visual studio which is
really nice and then if you deploy it to
a zoo you can choose to turn that on
without having to change any code in
your application which i think is pretty
cool the other thing we did to do with
diagnosing stuff at debug time or when
you're running I just need to close and
reopen this due to bug at the moment if
I don't debug the application but I just
control f5 I launch without debugging I
still want to be able to see logs coming
from application that's always been a
problem in Visual Studio because we run
behind if' Express and so now though if
I go to the output window and I flip
this you can see we've got a spinet core
web server here and so while you look
your request counter is actually working
in this version so it's actually I can
see the traces right in here inside
Visual Studio which is kind of nice okay
I don't get the colorization because
it's not the console logger as such if
you're being funneled through a whole
bunch of other things but I get it
inside my application inside Visual
Studio while the application is running
over here which is pretty cool so very
quickly a couple things I wanted to show
you in my startup I've registered a tag
helper component which is a new feature
down here so at a copper component is
like a tag over but not quite it looks
like a tag helpers that's the same
interface but you can't interact with it
you can't like use it in a page the idea
is that they live in the dependency
injection system and they automatically
attach themselves to particular to
particular elements this one cares about
whether it's running in the body element
and if it does it puts HelloWorld at the
top so this system is designed to allow
you to silently inject in generally
diagnostic type code into the into the
front page into the front end of your
application like inject JavaScript or
tracking IDs or those types of things
because you can attach to the body tag
or the head tag just by putting
something in di and because you can add
stuff to di either by the hosting
startup that we just talked about the
Bridget application incites users or you
can build an extension method for
example that hangs off web post so you
can build something down here that
people call you and you use migrate
thing and that can put stuff in the DI
container that could do something that
results in some JavaScript being
rendered on the page which is kind of
cool and in the last minute I just
wanted to quickly show you a little bit
more about razor pages so we just showed
you some read-only stuff I want to give
you a quick example of a quote form so I
have a customers page here assuming my
app is still running because you never
know once I've been fiddling around I
can hit create over here I can hit
Damien Edwards or don't do it's got
validation as you know it's a standard
type of thing right and it's all it's
what you'd expect identity framework I
went back to the customers page and said
it was created successfully if I hit f5
the message goes away so you know it's
temporary which is good but hit delete
the similar thing happens customer
deleted if I hit f5 it goes away right
that type of stuff is a little laborious
to build today we've built a couple of
features that makes that simple and you
can use them from both raise the pages
has a lot of nice features but a couple
of them you can use from controllers as
well so I'm going to open up my page
model and you look at this and go well
it's pretty basic right is my page model
takes in a DB context I have a customer
property which I bind to the page okay
which is nice I have this message
property which is backed by temp data
and I can now back properties in
controllers or pages with temp data
automatically using this temp data
attribute that's implemented as a filter
so I don't have to deal with that
tempdata bag garbage with a string and
stuff to get stuff out and recast it
it's also there's something else is
going to say that the government was and
then down here we've got some really
nice support for routing with pages
because pages is built right on top of
MVC we get all the URL generation
goodness of routing that's built into
MVC so I can do things like relative
page links and so I can take the folder
of pages moving around my application
and all the link generation still works
because I can have those sibling pages
talk to each other or refer to each
other by way of things like
relative URLs which is really really
nice so you can see here all I'm doing
is setting the message property in here
and then the next time round because the
temp data is going to get read once by
the request and then rendered by the
actual page which is here note back on
the index sorry over here here's my show
message show that message on the index
page if I crave one or show one if I
delete one so I encourage you to have a
look at raiser pages if you're doing any
type of HTML in an ethernet cord today
we think it is a superior way of doing
server-side HTML then using views you
can use it together you can render views
from pages you can share layout all the
type of stuff it is the same view engine
so I do strongly encourage you to take a
look our time is up if we have another
talk later on today to talk about crazy
future ideas that I'm not going to
commit to at all but if you're at all
interested in what we're thinking about
beyond this year like these are features
that some of them might gain to the
release at the end of the year but a lot
of these are things that we're thinking
about for beyond that so I encourage you
to come to that if you'd like to see
those types of things otherwise thanks
for coming and learning about these
connect or to please download the
preview and give us some feedback and
we'll see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>