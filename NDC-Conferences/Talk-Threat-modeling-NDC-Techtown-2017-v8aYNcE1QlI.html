<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Talk: Threat modeling - NDC Techtown 2017 | Coder Coacher - Coaching Coders</title><meta content="Talk: Threat modeling - NDC Techtown 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Talk: Threat modeling - NDC Techtown 2017</b></h2><h5 class="post__date">2017-11-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/v8aYNcE1QlI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm Alan afterall I work at a
Norwegian company called back and I
blank sorry here in in Oslo not too far
from here I used to work at a company
called back for 10 years and then I
worked for f-secure for one year and
I've been doing more and more security
work during my development career let's
say and one of the things that I've
found taken an interest in the last
years is something called threat
modeling and it's great to see so many
of you here because I think this is an
important topic that would be useful for
a lot of it's getting increasingly
important for developers I think so just
quickly I do all kinds of stuff I'm
still a developer but I also do security
testing a penetration testing stuff like
that I'm also a bug bounty hunter now so
I securities everything I do basically
except for kids and family I build
open-source tools I'm also a head of the
OS Norway chapter so yeah if we're going
to secure a system that can be quite
hard how do we know what secure actually
means secure can be many things and if
we don't think about it if we we will
end up kind of optimizing in the wrong
places if we go to a conference typical
developer conference people will talk
about things like yeah making stuff
bulletproof with technology or if you're
not using technology your software is
never going to be safe and the thing is
that most of these technologies they are
just optimizing a part of the pipeline
and if we're not thinking about it as a
whole is that's not going to work so
there is no free lunch we're not going
to magically make our systems secure and
threat modeling is not going to
magically make your system secure either
but it's a part of a bigger puzzle so to
build secure assists to build secure
systems we need to do threat modeling as
one exercise but we also need to apply a
set of other practices we need to have a
secure development lifecycle which
consists of a lot of activities but
today I'm going to focus on
at modeling a thing to note though is
threat modeling takes time it's not
something that you can do in an hour and
then just leave it and then and this is
true for security as a whole as well
it's not something that you can kind of
do let's this week we're going to do
security or we're gonna do security just
before the release because that's our
perk I will fix everything then and our
systems are going to be perfect this is
something that needs to be continuous so
you could you could kind of look at
security like UX or other things that
need continuous effort in when we talk
about security flaws and bugs quickly
come up like what is the security bug
and what is the security flaw and bugs
are things that we typically make wrong
when we write the code so let's say we
write a piece of code and we
accidentally introduce a buffer overflow
or a sequel injection vulnerability in
the code that's a bug a flow on the
other hand is more like a design thing
so maybe our system has a problem if you
kind of look at the wider picture so
from from the code perspective it looks
safe but if you try to call things in
the wrong order or things like that then
your system becomes vulnerable and the
company's digital they say that around
50 percent of all security issues are
flaws and 50 percent are bugs and we've
tended to focus a lot on the bugs
through the last years like we we talk
about things like sequel injection and
cross-site scripting and buffer
overflows and things that are very much
in the bug space but we need we need to
talk more about floss and we need to
focus more on floss and that's what
threat modeling brings so what are the
benefits of threat modeling well it
helps us define these design flaws early
and of course finding stuff early is
important because if we can find it
early we can fix it early and it gets
cheaper if we create a whole application
and then we decide oh we have a design
foe in here it might be very hard to fix
it very expensive to fix it but if you
can find it early that's a lot better
it can also help us to guide how
implemented softer how we decide the
software because we can start to draw
things out and then we can figure out oh
if we do it like this is going to be
really hard to secure this stuff on the
other hand if we do it in another way
it's going to work perfectly flat
modeling also has a huge benefit in
increasing security awareness in the
team especially if you bring everyone in
the team in to do the exercise it can
also improve privacy because privacy and
security goes hand-in-hand in many ways
of course there are some issues there as
well sometimes security people want to
have a lot of information and from a
privacy perspective you don't want that
information but thinking about what
you're storing in where has a privacy
benefit this is a quote from a
participant in a threat modeling session
that I was facilitating for a company
now I finally understand how the system
works and it was not because the guy was
stupid or anything it was just he had
now often in a team there will be some
people working on something and someone
else will be working on something else
and the guys over here they won't know
exactly how the software here works but
after the threat modeling session
everyone in the team had the same
picture of the software now been talking
a lot about threat modeling but I
haven't said what it is
so what is threat modeling well this is
a picture from Oslo and we're kind of
doing threat modeling every day if we're
going into a city and we want to cross
the street we check is there any chance
of me getting hit by a car or a tram
if we're going to a different City maybe
we check some guidebooks watch is it
okay to bring an expensive camera on the
street or will I get mugged how much
money should I bring like if you go to
I've heard that if you go to to Rio you
shouldn't bring your credit card but you
should bring enough cash for the mugger
to be happy if he mugs you so it's a you
have to think differently in different
places of the world we also think about
this when we buy a bike lock like what
are the chances of my bike getting
stolen if I have this really cheap block
or if I buy a more expensive lock so we
kind of do
threat modeling all the time but for
different things not for software then
what's a threat I'm gonna highlight two
things there a threat could be this is
from from
Wikipedia I think like a threat could be
a person or thing likely to cause damage
or danger but it could also be the
possibility of trouble danger or ruin
and when we talk about threat modeling
we often talk about both of these
because there are many ways of doing
threat modeling we could do acid based
threat modeling in which case we focus
on the the acids that we have okay we
have these pieces of data we have these
pieces of hardware we have these things
here and we can try to focus on how can
we protect those assets if we go with
attacker centric threat modeling we're
kind of trying to figure out who would
attack us and what are their
capabilities well the one that I've been
doing most is the last one called
software centric threat modeling and
that's where we're trying to do trying
to focus on the software that we're
building and how it can be abused and I
think this is the one that's most fitted
for developers to participate in so when
should we do threat modeling I really
like this Chinese proverb the best time
to plant a tree was 20 years ago the
second best time is now point being that
if you haven't done threat modeling
already now it's the best time to start
but you should do it as early as
possible and I have already mentioned
why well because if we can catch flaws
early we can fix them early while
there's still time and it doesn't become
that hard or expensive to fix them we
should also do threat modeling whenever
we do a large architectural change to
our software so let's say we're moving
things around maybe we're splitting out
into a couple of micro services
integrating with some new system all
those kinds of things are triggers for a
new round of threat modeling we could
even do like small versions of threat
modeling for features like we implement
a new feature we do a quick threat
modeling just how will this affect our
security but how how do we do threat
modeling well if we're going to follow
like the
the full scope of a threat model this is
kind of the the stages that we will go
through we might not want to do all of
them every time but this is a is a good
start
so scoping this is super important if
you if your scope is too wide you're
going to spend too much time and you're
going to get lost in the details if you
narrow the scope too much
well the accuracy is lowered because you
do not there might be stuff that you
won't catch because your your your focus
is too narrow maybe the threat is when
these two components are interacting and
you're only focusing on one of them but
it's important to kind of start out
broad and then get more detailed as time
goes by the next thing we want to do is
to model the system and there are many
ways of modeling the system Adams
Shostak who is a he wrote like the Bible
of threat modeling and he works at
Microsoft he came up with this all
models are wrong some models are useful
point being that if I'm gonna I'm gonna
propose a way to do threat modeling but
if that doesn't work for you stop
drawing your systems in that way and do
it some some other way that works for
you I also like this quote from ina
Hurst and Nichole and he said if you're
going to navigate through a swamp you
don't want a generic map of a swamp and
the point being here that often our
documentation of our system they are
very generic like how many of you have
seen like okay so we have a a typical
three layer architecture so our only
architecture drawing is like a
presentation layer business layer data
layer that's all we have and it doesn't
really model our system because that can
model any system it's the generic map of
a swamp so we want something that that
models our system that's detailed enough
but we don't want to spend too much time
on it either it can't be super detailed
in such a way that we will stop keeping
it up to date
so granularity is a pacer role here we
we need to start with an overview
detail as we go through storytelling one
of the biggest mistakes that people make
when they start doing threat modeling is
to get too detailed too early so we we
can we can also split our diagram into
sub diagrams if something becomes too
complex or too repetitive we can split
it into a sub diagram and just reference
it and these are some of the trigger
words that you can use to figure out if
you need to detail your system more if
you're trying to tell a story using the
current model and it and you kind of
pick up on these words like oh sometimes
there's a different path through okay
then there's something missing in this
diagram I attended a a threat modeling
training I've been doing threat modeling
for for quite a few years but I tended a
training about a year ago where they
they kind of taught me a different way
of drawing systems that I've ever done
before and at first it looked a really
really strange but after doing it for
quite a few threat modeling sessions it
actually makes a lot of sense and I
found that it gives the best results for
now and it's the same approach that Adam
show static has in his book it's called
data flow diagrams and we have these
elements in a data flow diagram so an
external entity is something that we
talk to communicate with but not not
something that is in scope for the
current thing we can't we're not going
to change that thing as a part of this
threat modeling session but we have to
communicate with a talk with it and
think about threats related to it a
datastore can be a database it can be a
file system it could be a cache it could
be any place that we store stuff and
sometimes we want to spit a physical
data store into several data stores in
the drawing to make things simpler so
maybe everything is stored in one
database but we draw it out as different
data stores a process is something that
processes handles moves data around
because data can't move on its own and a
data flow is the direction that data
flows and often that will be the the
least intuitive thing about these
drawings because the arrows will appear
too
in the wrong direction trust boundaries
are where change of trust levels occur
so I'll show you an example so let's say
we're building an RSS web reader just
for a simply Sam so we have a user and
we have our web app and we have some
data flows between so the user can
submit the couple of RSS feeds that he
wants to see and then it gets data back
and probably the user can log in and
things like that and at this point the
arrows are in both directions so there's
nothing weird about it we have some user
data this could be stored in a database
it could be stored in on the filesystem
it doesn't really matter and we're
storing data there and we're also
reading it back so we are Arrow's going
in both directions we have some static
content because this is a web app we
have some JavaScript files and images
and stuff and now we only have an arrow
in that direction because we're only
reading from that data store and we're
also reading from RSS feeds all over the
web so the arrow goes in that direction
if you were drawing our communications
diagram you would typically put this
arrow in the other direction because the
web app is contacting the server that
has the RSS feed but in this case we're
reading the data so the arrow goes in
that direction and this is the part that
tends to confuse people this is one of
the trust boundaries that we have here
clearly here we're crossing the internet
so there's a change in trust level
between the user and the web app we can
completely control the web app we can
not control what the user is doing of
course if we have a separate server with
a separate database maybe it's hosted
somewhere else or maybe in a different
firewall so we might have a boundary
there as well but there's more threats
on b1 than b2 of course there's also a
threat boundary here because once again
we're traversing the internet to grab
this RSS feed and pull it into our
system to display it to the user so
there there will be different places in
our drawings where we will put these
first boundaries now we can start
telling stories about this thing
maybe the users they want to be it we
should be possible for them to have a
profile picture so maybe we spit things
out a bit so we have a
we now have split things up from a web
server and we have a REST API and we
send the the picture in it goes to the
to the web server it goes to the REST
API and then is stored in the static
content so now you can see eros going to
static content from two places and
immediately if you're interested in
security and you think about these
things you can think about such things
as well how do we know that the the web
server and the rest type API are
treating this image in the same way how
do we know that they both see this as a
JPEG for instance because you can have
polyglot files that are valid in many
different formats and so you could be
able to trick the web server into
displaying something that the rest api
thought was an image but those are the
kind of threats that we could find but
we've forgotten about stuff in this
because usually we also have analytics
like Google Analytics or some other
statistics tool so now you say I changed
the browser the user from the user to a
browser instead because we can control
some of the code over there we can't we
can't change the browser code or some of
you can but normally we don't say we
don't assume that we're going to change
the browser but we're changing the code
that runs in the browser in this case
it's our code that causes the browser to
contact the analytic server so there are
some there might be some new stuff in
here one important thing here is that
I've numbered everything and the numbers
are not intended to be a sequence the
numbers are meant because we are
supposed to be able to talk about this
stuff and reference these data flows so
if I was going to all the time say well
you know the arrow that goes from the
rest api to the static content it would
be cumbersome to talk about it but i can
just say you know DF 9 in DF 9 we have
such-and-such threat maybe it doesn't
make that much sense in in spoken
language but at least when we kind of
typed this out later
we can just reference the arrows by
numbers so those are just identifies
they're not meant to indicate sequence
sometimes though it is useful to
indicate sequence but then we might also
want to draw it as a sequence diagram
but it might sometimes be useful so as
Adam Shostak said
all models are wrong some models are
useful sometimes we want to use
something else once we kind of drawn out
this diagram we want to validate it like
have all the data flows been annotated
do we have all these numbers now this
data magically appear well at least in
the first drawing data kind of magically
appears how did the static continent end
up here or how did data and come in here
well we know that because we have two
errors but here we don't
so how there's something kind of a
process thing missing here but from the
applications perspective maybe that's
okay
this data magically move we're not
supposed to have errors from one data
store to another or one data store and
to some magical entity somewhere so data
needs to be moved by a process and also
are we storing data without it being
used I had an interesting session I
think it was actually this week where we
figured out that they were storing data
that they weren't using so why are you
storing it well we used to use that yeah
but you're not using anymore maybe you
should remove it yes we should remove it
so you can you can find all kinds of
stuff in there and I thought the the
opening keynote today was interesting
with talking about simplicity and
talking about removing stuff because
that's one of the things we'll see when
we start drawing out these systems in
this way that well why are we putting
things there what this looks really
complex and things are moving in all
kinds of weird places where it shouldn't
so it's it can be an interesting
exercise just from a pure architecture
perspective now once we've kind of drawn
out this stuff we need to start
identifying the threats because that's
the important part here the goal of this
exercise is to find the problems that we
might have in our in our system so the
first thing we can do then is to try to
rate the threat boundaries and the
reason why we rate the threat boundaries
is because the most important threats
are going are usually amongst the most
important boundaries so this is just an
example rating so so if if one
these boundaries is the Internet then
there's a big attack surface there but
if it's between two systems in a trusted
Network then maybe it's less of an
interesting boundary also things like if
it's web general what the web opens up a
huge attack surface if it's mobile maybe
we forgot stuff so me we might want to
increase the rating of the boundary just
because of that I also think that it's
important when you're doing a threat
modeling session to focus on issues that
cannot easily be found otherwise so
don't focus too much on traditional bugs
focus more on flaws so don't think too
much about well what if there's a buffer
overflow in this thing with it might be
interesting because you might say well
if this thing is breached what happens
to the rest of the things around it but
I would first start with things that are
typical design problems and then maybe
move to the more nitty-gritty details
later Microsoft at some points suggested
this as a way for finding threats and
this is a useful tool for finding
threats it's not meant for
categorization so if you find a threat
it's not important to try to figure out
is this a spoofing threat or information
disclosure threat the the point of this
is it's a way to find the the threats so
I'm going to go through them quickly so
spoofing is pretending you or something
you have is something else than it is so
you can try to you can kind of call it
anti so you could spoof an IP you could
spoof a user account you could spoof a
file you could spoof a process spoofing
certificates have been very popular with
mobile apps because some of them allow
self-signed certificates although all
these kinds of things spoofing display
name that can also be interesting what
happens if I can in your system I can
have a display name administrator and
then I start sending messages to your
users and it all appears to come from
the user account administrator well I
might be able to fish some stuff just
because I put a diss pane in there that
made me look like I had more authority
than I had
so the control that we want here is
authentication we want to ensure that
nothing can be spoofed or as little as
possible can be spoofed and we probably
also want to have some kind of input
validation of things like display names
and things like that the next point is
tampering so tampering is about changing
things that you're not supposed to be
able to change this could be modifying
data across the wire
it could be tampering with a database it
could be tampering with a file or a link
to a file
it could be modifying memory one process
modifying the memory that another
process is reading it could be all these
kinds of things where we're messing
around with data that we're not supposed
to be able to mess around with so in
this case we want some kind of integrity
protection this could be signing things
it could be using certificates it could
be all kinds of stuff where we're
protecting the integrity of the data
repudiation is around not being able to
deny that you did something so if in a
typical banking application this might
mean someone trying to say well it
wasn't I who did this it wasn't I who
who I have never received this message
from you so you cannot give me any any
penalty because I've never received this
thing I've been a victim of fraud
someone stole my account so maybe having
good logs audit logs etc those are good
things to kind of be able to see these
things or be able to prove these things
an attacker might be interesting trying
to fake log messages and and kind of
destroy our log or make sure our log
looks like it has been something has
been done that hasn't been done as well
which is kind of on the border of
tampering the next one is information
disclosure so we could leak stuff we
could leak all kinds of things because
we could have unencrypted channels
unencrypted communication channels we
could have publicly exposed belongs we
could have publicly exposed databases we
could leak information about the
internal workings of our systems such as
versions and frameworks everything where
we accidentally or
just because we didn't think about it we
are leaking information
a typical example here is also things
like accidentally pushing passwords and
keys to github those will be picked up
immediately by someone with less nice
reasons for doing it so in this case we
want confidentiality so we might want to
encrypt stuff we might want to configure
our systems so that they don't expose
things that we don't want to we might
also want to remove data data that we're
not needing anymore and here gdpr and
privacy comes in like if we're removing
data it can't be stolen because it's not
there anymore
the last one is elevation of a no sorry
denial service sorry
denial of service is stopping the
environment from responding and in this
case it could mean overloading all kinds
of stuff in our application stack it
doesn't have to be a distributed denial
of service attack where you have
multiple actors around the world all
posting stuff to your system it could be
the one rest call or the one call that
you have in your system that's really
expensive and then firing a lot of
requests towards that one call from one
machine can be enough to take down the
system it could be filling up the disk
let's say you have an image upload
feature that we just implemented and you
have a limited space disk and then you
have no limit on the size of the images
that can be uploaded and then you fill
up the disk by uploading large images
and then the system just goes down so in
this case we we we need some kind of
availability control so we might want
clustering we might want network
equipment to stop distributed denial of
service attacks we might want to move
out the the data storage from the hosts
storage of the OS so the those do not
affect each other etc etc and now the
last one is elevation of privilege
elevation of privilege means calling
functions on a higher authorization
level that and then you're supposed to
so it could mean that an anonymous user
is allowed to call functions that are
only supposed to be available if you're
logged in or maybe you're logged in but
you can call admin functionality that
you're not supposed to be able to call
it could also be remote code execution
because then you're kind of yours maybe
you're sitting anonymously out on the
internet and
can send a piece of coating and have it
run on the server so it's running on a
different operation level than it's
supposed to so in this case we want to
have proper authorization controls now
that we kind of have this toolkit in
place we can think about where we want
to apply these things on these external
entities we want to think about whether
or not they can be spoofed or whether or
not they can deny that they did
something on a process itself we think
about the full stride on a data store we
think about things like can someone
tamper with a this data store does it
leak information and can someone stop it
from working and if it's a log we also
think about repudiation can someone fake
log messages or do anything else to this
log on data flows themselves we think
about can someone tamper with the data
as it's flowing here
can it do we leak information while the
data is flowing here or can someone stop
this data from flowing altogether please
don't try to reinvent everything try to
figure out everything there are a lot of
good resources online if you haven't
done this before
oh as ASVs is a set of controls it's a
huge set of controls actually but it's a
really good read and I highly recommend
you read through it at least once you
have a Capek you have also have tools
that can help you
Microsoft has created a threat modeling
tool that kind of follows this process
but I don't necessarily want to use it
but also iris risk have created a threat
modeling tool where you can kind of
model your system and it will
automatically give you some threats that
you might want to think about and os
missiles are coming up with something
you call the OWASP threat dragon this is
the Microsoft threat modeling tool so
you can see the drawing is there using
the same elements in this model up here
as I just showed you like you have the
external things that are a square or a
rectangle you have the processes that
are circles and then you have a data
store all the way over to the left in
this case they've also annotated with
different controls so you can see
they've annotated with HTTPS here
and they're kind of labeling some of
these these are data flows and and this
tool actually also try to generate a lot
of threats for you and make you think
about the full stride for the different
elements another tool that came out of
Microsoft which is kind of interesting
is this this is a card game and a card
in this game you can play it if you can
find a threat that's relevant to your
system so you divide out all the cards
and then you can okay I can I've
uncovered the threat such-and-such and
I'm gonna play this card and then you
get points of course the the full goal
of this tool is to help you find threats
not to win the game but you can kind of
get me gamified a bit and OS has come
out with a similar thing called the
cornucopia which is more angled towards
web applications while the the
microserver scene is more for every kind
of application so they're very very much
the same to just have a little bit of a
different focus when we've found all
these threats we want to document them
so we want to have this is a simple way
of doing it like we have a an ID for the
threat we have which elements of the
diagram is involved in this threat and
then we have a description of course the
descriptions are very generic they could
be longer they could be more in that
depth but you get the point the point is
you have an ID you have a set of
elements that the threat is around and
then you have a description of the
threat so if we have an application
looking something like this what are the
threats that could be in here so we have
a simple mobile app that might be
running on iOS or Android we have a
mobile API and we have some user data
well sometimes or I get the impression
sometimes that developers these days
they don't think about threats at all so
if I do something like this some of you
might recognize what this is all about
so this was a Norwegian company at Emma
Tuson they had a new app that came out
and they haven't really thought about
was it what you could do in this app
because they kind of moved security all
the way to the left outside a song
that's not can't be trusted so if you
just modified the URLs that this app was
communicating with the server you could
steal other people's data you could even
steal their masked credit cards because
they thought that because you were
logged in to the to the app or at least
I'm not sure they thought that but
that's the way the application worked if
you were logged into the app you had
full access to the entire API there was
no access control but if they had drawn
it like this instead it gets immediately
clear that there is a trust boundary
here and if we start to think about
spoofing here it becomes clear that well
what happens if we try to spoof a user
towards this API ah interesting
we immediately see it this is kind of
the way that the app was working I'm not
sure that that was of course not what
they intended but that was kind of the
way that they were they were thinking
based on just the code like that they're
the all the secure decisions are made
out there it doesn't really matter well
I should have thought of it like this
the next one the next example is a
insurance app that was recently had a
security vulnerability so in this case
you could ask for information about a
car based on the license plate the
problem was that they revealed a lot of
information in the calls where you asked
for information about the car you would
get back all kinds of information about
who owned this car things like you could
you could ask for the the Norway's Kings
car and you'd get information about that
so you there are a lot of things here
that shouldn't be exposed so this is a
classic example once again of
information leakage that was in in this
thing
also the the guy who found this stuff he
found that there were you could run
these requests and you could find
hard-coded usernames and passwords for
this service and this was a service that
wasn't intended to be used externally
so you can imagine this as the simple
model of this so we have the mobile app
all the way to the left we have their
system here with some user data and then
they were asking for information about
cars from this web service down here but
this web service the use case for this
web service was it was intended to be
used back into backin it wasn't intended
to be used directly out there so but if
we started to think about information
leak across this we might have
investigated what's actually happening
here and we might have seen that this
data that we weren't supposed to have
was actually flowing in the wrong
direction out there out across the
boundary into a place where we have no
control so I don't mean to make fun of
these apps I'm just finding them to be
interesting examples of where threat
modeling could help solve some issues so
back to our RSS thing so maybe we want
to instead of uploading this image to
our user data store to true to our own
file system maybe we want to upload it
to a CDN because Syrians are everywhere
and it's faster etc etc so maybe we
create an upload service and in this
case you can see I've actually used
sequences so now we start we upload the
image the image goes to the CDN we get
the URL back we pass that to the user
and then we pass it to the rest API so
just by looking at this at least I can
immediately see an issue here what
happens if the user
between 3 &amp;amp; 4 decides to change the URL
we then know that this URL will the rest
api will just store happily store this
URL in the database or really do some
kind of a check I don't know maybe it
will maybe it won't this is something to
think about why are we doing it this way
so this is a design flaw it could be a
design flaw it at least is someone
something we need mitigation for once
we've found a set of threats we need to
rate them and rating threats can be kind
of hard the easiest way to go is
probably to just do relative rating so
is this threat more important than this
threat and but we can we can use other
sources as well
so we could use we could come up with a
set of doomsday scenarios what's the
worst thing that could happen to our
company and if any of the threats are
dragging us towards one of those
doomsday scenarios then maybe we we want
to put that on the top we if we've done
risk analysis we can use the results of
risk analysis and see do they any of
these threats help us or help an
attacker into getting our systems
exposed to one of these risks well okay
maybe we can we can rate them
accordingly Microsoft used to use
something called dread they're not using
it anymore but it has some interesting
properties because it was about how easy
is it to discover this threat or this
bug or this flaw how easy is it to
reproduce this this vulnerability how is
it is it to exploit it how many users
does it affect etc etc so you kind of
try to put some numbers on things to get
a number at the end you could also use
something like CBS s which is a common
way of scoring vulnerabilities in
systems so once we rated them of course
if that's all we do and we don't fix
them well we haven't gotten much for
further so we need to plan some kind of
mitigation of these bugs so we need to
ensure that we've at least tried to
cover all the threats with mitigations
we might find that sometimes we can't
mitigate the threat and sometimes we
don't want to mitigate the threat maybe
if we're implementing a webshop and we
find that well one of the biggest
threats we have in our webshop is credit
card data okay maybe we can instead of
processing credit cards yourself we can
transfer that risk to someone else and
we could say well we'll use nets or
someone else and they'll handle the
payment and we'll just be the webshop
not the payment processor so you can
transfer risk to someone else you
normally what you want to do is apply
standard mitigation so for instance if
there's a data connection that's
unencrypted you encrypt it you add TLS
but sometimes you can't
and then you have to create your own
mitigations but that's something you
really should try to avoid doing because
it's really hard to get it right
sometimes you your only options is to
just accept that there is a
vulnerability in the design because it's
going to be too costly to fix it and
maybe the risk or the impact of this
threat isn't as bad as it could be maybe
if if it's like a small information
leakage and no one really cares about it
well maybe it's okay to leave it there
but at least you know about it and maybe
think about it again some time later
down the road so we we want to figure
out which mitigations we have and
document those as well and you can see
here I have one mitigation that covers
two threats and this is very common that
this is why I'm splitting between this
is the threat and this is the mitigation
it's because well sometimes we can fix
many threats with just one single thing
the end result of this is that we need
to document this somehow I find that our
I used to draw threat models on
whiteboards such as this one but at some
point I found that that's a bad idea and
the reason why is once you start drawing
out the system some of these boxes are
going to be in the wrong spot you need a
new box in between them and it's really
hard to move boxes on a whiteboard but
if you draw them in let's say Gliffy and
confluence or if you draw them in Vishu
or some some where you can actually move
things around and just put that up on a
projector it actually becomes easier to
move things around so it's a bit more
cumbersome to begin with but it's
actually easier to move things around
and get the proper structure a bit as
the session goes on once we've kind of
documented the model and we've
documented all the threats a thing that
I really like to do is well is to have a
second a last column here when it comes
to the mitigation and just link in the
issue tracker so I register a case in
the issue tracker and I link that in
here so it's really easy to check the
status is this mitigation in place well
I can click this link and I can see it
and or if you're using conference and
GRU will magically get the green thing
but at least there is a link between the
threat model and what you're actually
doing because if you're all you have is
this document lying in your drawer or at
this document in the wiki somewhere and
no one cares about it
well the whole threat modeling session
was a waste but if as long as you can
link them together it really becomes a
much better process in the end so you
try to summarize this threat modeling it
helps us uncover design flaws this is
one of the most important properties of
threat modeling but I also think that
drawing it in in this way provides a
language for us to discuss security and
vulnerabilities because we can now
gather all the developers in a room we
can draw out as the system and one of
the things I often find interesting is
how much developers will disagree about
what system contacts which system at one
company I was this is a long time ago as
doing a threat modeling where they had a
they had the firewall zone and it was
supposed to be only connections out of
this firewall zone not into it and while
we were doing the threat modeling
session one of the guys said well this
thing is contacting this thing that sits
inside this firewall zone and the other
the other guys were like no no no it's
not possible to contact something inside
there from the outside and it turned out
the guy was right there was a connection
from the outside into a firewall zone
where they were supposed to be no
connections so just by drawing it out in
this way we found a design flaw that you
can't find by inspecting code also it
increases the understanding of the
system because as I mentioned you you
might have developers over here that are
working on a tiny feature and the
developers over here are working on
another feature and you don't
necessarily know what the other guys are
doing you know that they're working on
this feature this thing but you don't
know how it works but after one of these
sessions hopefully everyone understands
more of the system to kind of end this I
I really recommend this book you should
list you should read at least the three
first chapters of this book but the more
them and the better it's a really good
book and this focus is on the type of
threat modeling that I've just been
talking about and then last but not
remember thanks a lot</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>