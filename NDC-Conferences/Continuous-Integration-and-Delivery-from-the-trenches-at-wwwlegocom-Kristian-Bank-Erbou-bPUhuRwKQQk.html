<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Continuous Integration and Delivery - from the trenches at www.lego.com -  Kristian Bank Erbou | Coder Coacher - Coaching Coders</title><meta content="Continuous Integration and Delivery - from the trenches at www.lego.com -  Kristian Bank Erbou - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Continuous Integration and Delivery - from the trenches at www.lego.com -  Kristian Bank Erbou</b></h2><h5 class="post__date">2016-08-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bPUhuRwKQQk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right and good morning everybody
nice you could be here okay pleasant
night at as well i did for sure this
talk is going to be about continuous
integration and delivery in respect of
my work I work currently at the lego
which probably all of you know I have
background as a net of that as net
developer I've been working with various
companies I've started out with just eat
which was actually founded here in Oslo
if if you didn't know I didn't know any
money on it others did but not me but
was quite a fun journey anyway um and
then I've been at ebay and a nonprofit
organization and before I came at Lego
I'm not the best program out there and I
come back to that um because I attended
a session yesterday where two guys were
from Microsoft from the aspnet core team
we're talking about how they were
optimizing the inner workings and memory
allocation and stuff like that you know
in terms of getting the estimate call to
perform better and I'm not that kind of
program that's that's not me that's not
what I do and I'm much better at pattern
recognition and and trying to understand
that the watts and things and and hmm
and I'll come back to that they run I
like automating things and I'm tend to
have a pragmatic approach towards things
this session will cover a little bit of
background in respect of what I do at
Lego and what Lego is all about how do I
fit in in the larger scheme of things in
Lego because it's an enterprise
organization with 17,000 employees and I
think you need that background in order
to understand the problems that me and
the team I'm part of our trying to solve
as all talk just touch up on that then a
bit up on a bunch security what is
security and when you talk security you
people have their own subjective feeling
on what security is but I think we need
to elaborate a bit on what your courage
is in terms of understanding how to
implement security in the solution so
that we about to provide and then
finally from the trenches I've collected
a few examples of what we've done my
experiences from the past failures I've
made others made all I could all them
probably have something to do with
providing keg in the end and the
retrospective and there will be cold
it's fun of you this is a developer
conference and if there if you were
project managers and people feel some
some people tend to fill up there an
entire day's work with meetings and
writing agendas and stuff like that and
running around in circles and nothing
gets produced they the shoulders kind of
meets on top of their head whether you
see that there will be code so it's kind
of funny to see from up here when that
happens your developers shoulders down
please there will be code and that's
okay so Lego what is Lego in essence we
have behind if you go to www Lego come
you'll end up seeing this the front page
of of our website it's actually a around
180 websites and we support 25 languages
in our last annual report we say that we
have almost 20 million unique visitors
per month we have a youtube channel with
1.3 billion visitors or actions however
your measured in 2015 we measure things
and millions and billions so it's quite
a large website we make apps lots of
them AB skits and we have some very
clever people who are able to write and
produce apps for kids foo
hardly can speak they can't spill they
don't know the words they don't know the
letters but there it even and so they're
actually able to navigate and play a
game and have a good experience in it I
don't know how they do it the guys who
make the apps and stuff but the right
letter and we do that a lot and games of
course each website is a product and a
product could be the Ninjago side or the
city side or the Star Wars like oh
whatever side there's a few examples of
them here m and we have in terms of how
they are produced we have product teams
in India responsible for given sites we
may have a city product and a team in
india and Denmark are responsible for
maintaining and implementing footage on
the city side as well as the Angry Bird
site as well as the friend site and elf
sites etc etc behind the product teams
which are very product focused they just
churn out code in terms of in terms of
the of the product that they're
responsible for we have a platform teams
and they work on a global level they
provide nougat packages for our psyche
or CMS platform for instance the these
sites are building of one cycle and we
have platform teams responsible for the
cycle we have some we have a team which
are entirely focused on tracking for
instance and we have a team responsible
for well they produce things and
gimmicks far for app development as well
they're kind of more horizontally folk
focused where proteins are strictly
vertical they can have several verticals
that they're responsible for and then we
have assistant team which is me with
friends
we manage all this by using safe by all
means I'm no expert in safe you're
welcome to come ask me about safe if if
you're interested safe is scaled agile
framework for enterprises the guy who
invented scrum in its sense he wrote a
book about it and became quite an a de
facto author of what scrum is my cone I
think it was he wrote a book and a lot
of courses and earned a pocket of money
and then enterprises started to pick up
so and 10 years has passed and he wrote
another book about scrum for enterprises
and made a bucket of money and that's
where we are today that's called safe
it's essentially how you scale scrum
teams in enterprise organizations that's
what we do I think it works for us it
has drawbacks of course everything does
but we have the numbers to prove that
people's their work satisfaction and and
the the visibility in when 20 teams are
working together the pendency mappings
and how risks are being escalated it
works much better than before safe was
introduced into our organization so come
ask me please but no detailed questions
if on release trains and stuff like that
this is a system team
there's me I have no idea why I ended up
being the two-headed Eagle a two-headed
snake I don't know then we have a guy
named alberto italian he knows about
embedded programming then we have
Michael who's actually sitting right
over there watch it hi Michael ah who's
Barbosa I think from Pirates of the
Caribbean yeah Michael it's the he knows
about a school and stuff like that
Casper knows about test automation
testing things and he knows about that
net development as well just like I do
I'm the I see myself as regard myself as
being the developer who knows how
developers think how they act what they
their core values and stuff like that
not that the others don't know but
that's my background and you have a guy
named yonas who is more an architect has
an architectural background and the nose
is able to read 2,000 pages in the book
and actually remember those two thousand
pages I can't do that either and we have
a product owner with assaults and lives
fighting the rest of the business
flagging them off I think if something
needs to be prioritized go to him if
business once something needs something
grooming needs to be done go to your
neck and then we have our
self-proclaimed snowplow who is trying
to mingle things with the organization
and is he is our manager he proclaims
himself to be a snowplow and tries to
remove impediments and stuff like that
what we do in the system team we are
responsible for everything below the
platform teams from the platform teams
and down we are responsible for our
software process orders for instance we
have the responsibility for our static
code analysis tools everything that all
the other teams are using both platforms
teams and proud teams and we are also
responsible for the build and deployment
pipeline because that is something all
the other teams are using as well
including platform teams so we are the
foundation of the mother of everything
actually it's fun place to be in because
you get to know a lot of things and
that's where that's where I fit in
because when you have so much knowledge
about how the business is working on a
on a horizontal level you start to see
patterns emerging you can't see them
when you were in a product team and it
just churning our code and you have a
psycho website and you have very strict
deadlines you just need to get things
done but in terms of an order of being
able to change things you need insight
from all the private all the product
teams and and look like then the
platform teams and in order to be able
to see whether friction is and how to
improve the bill pipeline it can do that
by being in a priority so I fit in very
nicely where I belong right now that's
what we do in system team we do
automation we actually you can say that
we're just maintaining and providing
features for an assembly line people's
stuff in code and deewana at one end and
magic happens and you have ended up
having artifact an artifact which is
which you can put in a package put it in
stock and deliver somewhere else at the
end of the pipeline and that's what we
do
a large part of what we do is also to
provide api's for the developers we try
to enable them to be creative to do what
they think is right for the task at hand
we're not the kind we try not to be a
constraint was at some point we are a
constraint because in terms governance
contradicts total freedom of and to do
what you want and we need governance in
terms of security i'll come back to that
and so sometimes we are perceived as
being a constraint but we try not to be
we want to enable our developers in all
the teams to be self serviced for
instance and be able to do whatever they
want and we've come quite far but we're
not there yet because we are located
where we are bearing the foundation of
everything there's also a support
process where if you have a problem and
you don't know where to go come to us
and then because when I started a year
and half back we had people who are
running around in circles because they
didn't know where to go if they had a
problem with which nobody owned with a
product that nobody owned or how do I
get access to this system that nobody
really wants to touch every Enterprise
have them so and people started running
off to Michael he almost never did
anything else than supporting people and
didn't have time to features because
being said being a supporter is it's a
rewarding place to be and everybody
likes a fireman you come out and put out
the fire and people have either wore off
again with a good experience but it
doesn't help the business very much you
don't you don't have time to implement
features and and help the business in
the long run you just put out fires all
the time and this it in the system team
we we decided to swim lane or the task
switching involved and call it the DS
developers upon two years for digital
solutions which is the department
department on part of
so one week at a time we have support
and there's one guy doing on the task
switching and all the other guys are
working on the assembly line in plain
implementing features to ask me about
how to do support I think we have good
reasoning behind the things that we're
doing but that nuts that's not the focus
for now that will be a totally different
talk then these suggest on the top of my
head the technologies that we need to
know a little bit about all of us some
of us need to know the how about
technology some of us need to know how
to set up a how to set up get how it
works our HTML or Amazon Web Services a
Mac pearl whatever but we all need
insistent team need to know where each
of these technologies fit in and
technologies emerge every day developers
when you enable developers to think
independently they start to be creative
as they are uncontrollable I know I'm
one of them so so and you need to keep
an open mind essentially to be able to
work in the system team it's not for
everybody and you you have to be quite
clever I think in terms of being able to
keep up I don't know a lot about node.js
for instance but I know it's something
we'll use heavily I don't know how you
do it but I have a quite a good feeling
of what it is and how it fits in just
for an example
Lego has grown dramatically during the
past years and we have growing pains
right now we're transitioning into a
global organization and in terms of
scalability that causes growing pains
the solutions we implement and the
example I provides you two year
afterwards is an example of how we try
to provide solutions that scale if we
take technical technical debt for
instance when implementing a solution we
might implement a solution implement a
feature with a certain amount of
technical debt our manual labor involved
and that's okay but we have to consider
that Lego into a three or five years
will maybe be twice as big so the manual
labor introducing to we introduce today
might be a magnitude of two or four
times in just a few years from now if we
grow in the expected growth rate how do
we utilize offline resources how do we
scale the organization and implement IT
for the organization which is also
scaling that is one of the major pain
points to nail that one right and errors
do happen but we try to which and then
the paradigm of of giving people the
responsibility is as a major cultural
change because before when you have
maybe eight or ten twelve teams you can
and you know every team that you're that
are working for you you can you can be a
dictator in in in many senses that
doesn't work anymore when you have 25 or
35 teams maybe 40 or 50 teams in a few
years from now I think now we have about
25 teams and we're growing rapidly so we
have to provide infrastructure and
organizational organizational units and
to enable them to work effectively today
as well as in two years from now
so
mm-hmm
a little bit about legal on security
security is immensely important I don't
think anybody disagrees but what is
security in itself how do we define
security in terms of Lego figure it's
one of the most powerful brands out
there in terms of trustworthiness
loyalty there's a company called Brand
Finance I think it is that measures and
rates all large companies throughout the
world lesser rate them against each
other and Lego has been in the top ten
for eight or ten years I think and in
the terms of loyalty to our business etc
etc they have lots and lots of
parameters to measure upon and that
doesn't that comes from somewhere in
terms of what we do and in terms of
preventing data leakage we need to
ensure that people trust Lego because
we're not selling labor boxes to kids
we're selling liquor boxes to the
parents and if they don't trust Lego to
be able to ensure the safety of their
child's data they won't buy anything
from us all that we are unable to enter
to to to earn as much money as we do on
selling liquor boxes as we do we also
have multiple ip's intellectual property
owners that enables us to build star
wars lego towers is owned by disney for
instance and we have a strategic
partnership with disney that enables us
to build star wars lego if we have a
data leakage if we for somehow
compromised data that
that falls back on Disney somehow we
might not be able to build star wars
lego anymore we're not might not be able
to do that and they will have a show is
a huge impact on on what the what leg
was able to do also we can't trust all
our employees we have 17,000 of them so
what do you do how do that sense of
security is important to us but how do
we implement it in our everyday how do
we begin doing that and back to basics
in our everyday you're in a meeting
you're in a meeting with might be
grooming a new feature you have your
stakeholders and they have non technical
staff there and you start talking you
start we want this and we want that and
I would like to have etc etc and
somebody starts questioning are we safe
how do we ensure that this solution is
safe in terms of how do we protect our
data our can we tell our users that how
do marketing until our users that we are
safe and somebody stands up and says
what if i told you that we have
beautiful specific encryption algorithm
and everybody dies a little in that room
it just doesn't work very well energy
leaves just evaporates because you have
a technical guy who's not talking at ice
height with an untechnical stakeholders
that you have and you need to you need
to protect your stakeholders from from
guys like that I'm the one of those guys
I it happens all the time but
nevertheless it's important to try to
talk in a in a in language that your
stakeholders can understand so you don't
say Greendale and AES and stuff like
that to stake holes they don't
understand you and because you're the
technical expert nobody dares to
question say can you explain in human
language what you actually mean nobody
very it's very rare to experience
project managers and stakeholders who
are just marketing people whatever
questioning a developer on whatever the
developer says because he see the expert
he makes things happen I haven't
shuriken very nice meeting like that if
you are in a technical center if you
have technical technically savvy people
present at the meeting of course is ok
to talk tech stuff of course it is but
we need to propose an alternative for
the people who are responsible and we
want to be accountable for security but
tottenham don't know about encryption
algorithms we need to propose an
alternative so instead he should have
set this we have secrets now we have a
heavy stakeholder because everybody
knows the concept of a secret it's just
wording but it's immensely important I
think trying to get people to understand
what is happening what is what is the
inner workings of the features that we
are providing if we have secrets it
doesn't have its secret as a secret is a
secret that's what it is you don't have
to elaborate on it won't have to talk
anymore anymore about it it's just a
concept
people are smiling why is it why is this
funny it's because I haven't I have a
son he's 10 years old and he was looking
on my shoulder when I was preparing for
this for this event and he SAT for a
while and we came to this slide and he
look and he said that's just plain
stupid and he's ten years old and so he
understands he's ten years old he
understands he doesn't even know what
what i'm doing and what i'm working on
and while i'm going to Norway but he
understands this image because it's the
absurdity is so obvious wouldn't it be
rewarding in a in a fantastic
sensational way if we could talk about
security with our stakeholders in terms
of images like that if they could
understand that what they are asking for
is essentially this that a solution that
doesn't solve anything security by
obfuscation for instances is just
exactly that image but people don't get
it if they even if they don't know text
know tech stuff they might not get it
and we're responsible for providing them
with the information in a context they
know and and can take into account we
their own once we can do it and the end
goes would be for them to take ownership
of the security features within that
solution so I have a proposal for you on
the next slide oh yeah the part that the
part that I wanted to elaborate on this
that there are terms from the main
driven design it's been eons since i
since i read the book is from eric evans
who wrote about the main driven design
coined the term he said that you need to
build a ubiquitous language which is a
shared language between the developers
and stakeholders and everybody on board
on a project should use the same terms
within the domain of whatever they're
trying to accomplish what if we used in
terms of security that security is wall
building you have an asset on one side
you have a threat on the other side you
want to betray put protect the asset so
build a wall it's a kinds of easily
understood everybody knows what a wall
is so you look at the image they had
barbarians and one side they kept
flooding the whatever ming dynasty was
at 3,000 3,000 years ago so the builder
war three thousand kilometres long and
problem solve but and we need to be able
to explain through our stakeholders and
to ourselves that what we are trying to
do is wall building and then you can
start having a discussion where to build
those walls how high should they be do
they need to have barbed wire on the top
for instance do we need to have
crocodiles in a tent outside and
landmines in whatever or do we just need
a fence maybe a meter high because it's
not that big a threat or it's just very
very rare that we're even going to be
exposed and a wall that high made out of
what would be perfectly fine perfectly
fine
there's a gotcha another catch catch 22
I think it's called I found some members
in the report is from 2007 and if you
look at this image you have assets you
have threats you build a wall it's very
clear where the threat is located people
tend to forget that threats very often
emerge from the inside so you can build
all the walls you want but you need to
build walls and establish procedures
within within your within your castle as
well you can't just say that you've
locked everybody artificially and now
you're safe that's the one of the most
common misconceptions I could think of
the Panama papers for instance I think
they had security in their organization
I don't know if they still exist that
Mossad fonseca had the proper procedures
they need to log in every morning when
they went out to work but still they
were compromised they had a data leakage
for the benefit of everybody in this
room I think that they had customers and
they I don't think the trustworthiness
is very high at the moment at their
customers yet what Snowden is another
example and as they do have procedures
and they say and they know stuff but
data was leaked anyway so take that into
account when discussing where to build
walls it's very important that you don't
underestimate where the threats are
located and how security breaches happen
to haven't read the entire reporter I
have to do it even though is 10 years
old I think those numbers still apply
for today
what we have to keep in mind when
discussing security in order to enable
stakeholders to take ownership is to
keep technology out of the equation once
you start talking security in terms of
the technologies on this slide and you
are trying to explain something to
people under aware of technologies they
might not know what a certain it is and
get and how pearl and puppet fit into
the image you've lost you lost your
stakeholder and you've essentially lost
a very important part of being in a
being in a project and team building in
all sorts of things you need to keep
technology out of the equation on a high
level in order to establish that you
bigoted language which is so important
when you have technical and
non-technical people trying to gain a
common understanding of the problem at
hand as a funny stars to this one was
actually Michael who was we were sitting
at a planning meeting we have bimonthly
planning sessions as part of safe and we
were bored I think just a bit and and
then we started discussing how you could
explain what security is and how you do
not apply security and you do not build
a solution and then unlike bill about
baking a cake you need you can't just
provide it as a topping afterwards you
need to bake it into the cake and
because I think the meeting stop a bit
early because lack of energy and
whatever so I went down to and then shop
and we built this the day after and you
would be surprised how many project
managers managers in general everybody
both developers and none developers have
commented on that exactly in on that
exact image all the LEDs that we know of
scalability usability security but you
can't it's hard to explain why they're
important to plan for
but that image I think we I think we
actually got to somebody just by
building that it took maybe I now and I
think the I've brought it as an example
today because it just worked it was
immensely important in terms of getting
people to understand gave providing them
with an image that they can use to when
stories needed to be prioritized for
instance I develop asked me if this
rules out the clarity of taxing code of
course it doesn't there's a good
question but it does not because you
just need to plan for scalability and
security Union all the ills you need to
plan it for them ahead you can apply
them in different fashions that that's
not really the point here you just need
to you just need to plan for them and
not forget them and keep them take them
into account every time that's what the
damage is that image is trying to to to
tell
all right from the trenches
usually a user groups and if I'm giving
talks there I tend to take questions but
comes me afterwards I'd be happy to
answer every everything and if I can't
I'll just point to Michael and run away
all right down to basics you have a
secret this is an example of a secrets
file I just made them up homeboy Homer
Simpson doesn't work for legal by the
way this could be a file with secrets it
could be any configuration file out
there how many of you I think how many
of you have checked out I checked in
files into source of posters with
secrets hidden usernames passwords etc I
think everybody has yes and it's wrong
because then it's not a secret anymore
and you probably don't know who who had
who had access to those secrets and
where they did they take them with them
did they take a copy of that file Wow
your secrets today so in order to
protect secrets like that we always say
check everything needs belongs in the
source repository is a fundamental term
if in everything that we do
infrastructure as code and everything is
good and code code code code but if you
want to protect your secrets it Scott
Hanselman wrote about it and he said
that it's Hendley you need in order to
protect them you need to keep them out
of your source control and out of your
source repository and I think he's right
because you can't protect anything that
you've checked in and shared social
process always contradict the concept of
keeping secrets a secret because source
across the Tories are essentially
sharing text files and so you don't want
them in there stop doing it I still do
it but
I shouldn't do it so I try to provide an
example that how you how you not how do
you avoid checking in secrets into your
social project or ease and this is a
very low key example I was thinking
about what is the minimal Viable Product
what is the absolutely least you can do
in order to get your secrets protect
them get them out of sorts of pro story
but still have a means of deploying them
in a fairly rare fairly decent fashion
and they said this will work in
continuous a great integration and can
use delivery scenarios as well of course
that rob banks but essentially if you do
nothing today if you just check it in
and everything works you should do
something well you should try to
convince your fellow colleagues that you
need to do something what you can do and
I'm turning 180 degrees if you can
create a source repository which you can
lock down and lock down good that means
you know exactly who has access to it
and you can prevent anybody from peeking
into it you can create a social process
or otherwise you don't and create your
secrets in whatever format that you like
plain text is fine you can encrypt them
if you want but how do you protect the
the keys used for encryption if they are
available on the server right if you
have an encrypted file and the key right
next to it with a plaintext password
your y encrypted and but if you have a
source repository that's fine if you
don't then don't you can just have a
shared folder and and and and add
permissions
permission from that chair and then you
know who have access to it so you do
that you create your secrets in a file
share somewhere you might want to invent
a convention for your files this is just
out of my head something like that and
then from that you push your files with
your application servers this is very
low key this will work for startups
small companies it's not enterprise-e it
has drawbacks how do how do your copy
function does it cover over a secure
line for instance do you open up for men
in the middle attacks etc etc etc there
are many attack vectors here but in
terms of governance this is much much
better than having nothing at all and
then you need to refactor your source
code to look for that expect to find a
secret a secret file at your desired
location and for the love of God do not
put all secrets in one file because you
will when you copy that file and if you
break the schema or something happens so
if your code is unable to read that file
and every secret isn't is in one file
you just obliterated all your
applications I've been that it's not fun
and so don't do that you can by creating
and maintaining is some sort of
convention to watch the products and the
things that you want to store secrets
for you're in a much better place and
the scales immensely well as well why do
you want to provide secrets for
applications who don't need them for
instance why do they need to get access
and be aware of secrets they are never
going to use so split it up separate
files
this is a connection string for just an
example there's a UAE user ID and a
password in there is a regular SQL user
account and it is eternally there are a
number of drawbacks that I'd like to
show you because when you see that at
first it doesn't really it's not a
problem you think but what happens if
you have a data leak it if you leak data
and you want to roll your passwords what
happens is that you are unable to roll
your password you have locked yourself
down entirely because of that user name
and that password has been distributed
across 50 applications so you need to
change 50 applications in order to
change your password and that's hideous
and not very fun from a security
perspective you essentially rule out
these two use cases you are unable to
solve them if you provide your secrets
to your applications in terms of
connection strings like that you are
unable to set up automation in creating
a database for instance because your
configuration file needs secrets and you
are unable to roll passwords for
application day and databases if you
have security procedures and audits
stuff like that they might propose that
your role passwords on a general on on a
schedule every three months perhaps 90
days and that's a good practice and that
enforces better code better in terms of
narrowing down the attack vectors and
your ability to to handle accordingly if
you click data
so how to solve it you need an API some
users are sitting to the left they talk
and interact with a navy I've in order
to gain access to the secrets and you
have audibility and everything in a
database somewhere this applies to many
systems there are third-party vendors
out there who we have one at Lego where
we store our secrets Active Directory
fits nicely into this image as well you
can interact with Active Directory
through PowerShell that's your API so
you can create users and get users and
roll passwords in whatever one thing you
have to keep in mind this is this is the
very abstract image of what you need to
do we need to interact with an API and
what you need to be sure of is that if
you have an API and you provide your
secrets you want to make sure that the
secrets and all the databases sure
because if you are compromised what
would prevent a hacker from changing
your audit logs as well if your database
is not secure I would do that is out if
I was a hacker I would take all your
secrets and delete every trace of me
ever being there but that's just me
that's what I that's what I would do so
in you need to have a audibility in on
the API and on the data that you're
trying to store please don't roll your
room yeah unless you're working for a
company who are providing that exactly
functionality that exact functionality a
hackers are so clever and unless you are
really really really good at security
this is by where basically that's what
I'm trying to say don't roll your own
and most of you this is a you're mostly
founded in a in a Microsoft Internet
well so you have active directory it
works very well very well
go in that direction before going
somewhere else mm-hmm so we have a
developer he wants to create a database
oh he's part of a billet and deployment
pipeline maybe he's deploying a website
for the very first time so he built it
the builders green a deployment kicks
off and somewhere along the line the
bill pipeline figures that it has no
database so we need to create a database
how do we do that how do we seal off
secrets from the developer he doesn't
have to provide he shouldn't provide any
secrets at all but we need to create a
database and provide credentials for
login authentication authorization for
that database without the developer
being aware how do we do that with an
API well first we create some secrets
the building deployment pipeline needs
to interact with the API and it needs to
have proper authorization to be able to
create secrets as well how your API gets
access to creating secrets that's
entirely up to you but it's an important
factor to keep in mind that somewhere
along the line you need to build
interest in your building deployment
pipeline in order in order for it to
interact very intimately with your
secret store that's a figure that's a
feature in itself how do you narrow down
the attack vectors how do you not open
up your building deployment pipeline for
fun for intrusions and and and how to
explain it and how do you ensure that
your building deployment pipeline is not
open for attacks because it is able to
interact with your secret store keep
that in mind so oh yeah and I just I rid
of I just put up post and there's a
convention based and I'm training in
their administrative user that's the
example I'm trying to provide so it's
created a database is created from a
vanilla database or an image or
something like that and then the build
pipeline applies authorization for that
admin user it gets the user just being
created it's only the developer doesn't
do anything and then a script you can
provide the build pad line provides the
script fires the script against a new
database being created the DB foo with a
user and the password that the developer
is completely unaware of that's how you
do it this is an SQL user if it was an
Active Directory user you would the code
would be different bear in mind but this
is just to give you an example that hint
on how your shield off your developer
from getting snow secrets he should be
totally unaware of and how to automate
your pipeline and still being able to
create databases and stuff that needs
secrets but still maintaining that you
want one hundred percent automation and
you want you to shield off developers
from stuff that he shouldn't know
anything about to protect him as well as
you and the pill built on line goes on
secrets in various environments they
differ they secrets in dev and QA and
live and whatever environment you have
they might change they might be it
should be different and this pipe like
the example here applies or enables
different environments to have different
secrets so that's one use case
automation that was the first one from
the slide if you slide back another one
is which is very common what we are
trying to accomplish at Lego is that a
developer needs access to a secret
during his deployment we don't want that
in source control but he needs it it
could be a certificate for AWS
deployment it could be a username
password for creating a website it could
be well find your own example it could
be anything but he needs some we need to
provide him with secrets in a secure
fashion and we don't want them in source
control he's not supposed to check in
those secrets in the sauce control how
do you do it using API n equations now
what we have is that we have an system
administrator it could be the developer
it might not at Lego we have a different
Department I'm with digital solutions
and somewhere over there I'm going to
complete a different part of the
organization somebody is paying for our
AWS accounts for instance just an
example so he needs to create secrets
which effectively is being paid with a
certain cost center somewhere so it ends
up on the on the correct account so it
could be that system administrator who
creates the secrecy the secrets for the
building deployment pipeline or it could
be the developer just having it in to a
system somewhere else is a different
rule
need to distinguish the two so secret
secrets being created and made available
for the building department pipeline
then along the way we made a feature
which unlocks those secrets during the
deployment pipeline and we made what I
later came to know as a essentially we
just build it and somebody find out that
we made a template pattern I'm not
familiar with patterns maybe 15 years
ago when i was starting but this is a
template pattern we housekeep we're
doing a lot of housekeeping and firing
off a script that the developer owns
they are the proud owners of their own
deployments they just need to respect a
certain contract that our deployment
pipeline enforces and one of them is
that we have a parameter where we store
where we they get access to unencrypted
secrets yes or encrypt it because they
need them unencrypted in order to for
instance create a new website using
powershell they don't they have a
convention for getting access to that
secret they know if they obey that
convention they can they can get
actually to that specific actress from a
secret from this list this item I want
the user name or the password or
whatever so by obeying the convention
they can get access to two secrets so we
provide them with a partial object which
for them to use and this is enabling
them to be creative they can request
somebody to create them with other to
create secrets for them or they can
create on themselves and they can write
their own deploy their own deployment
script if they want files deploy
differently in different environments go
do they don't have to interact with us
they just write code and make it happen
but we still have governance we're able
to roll that password if we want to it's
immensely strong I think I'm quite happy
about it actually
so
right final example this is a part of
our deployment pipeline and this is an
example of what happened when we perform
the security audit on on the template
pattern we just implemented here we have
people in Lego who knows immensely much
about security and thank God for them
they they are very helpful in terms of
nailing down the weakest part of the
link in the things that we do because
we're developers we think in sunshine
scenarios and when things working hey
we're happy and then comes a security
audit and user stories start to emerge
what we have here is that we have a step
where we extract keys from us from our
secure store that is that's the
unlocking that the chain lock was just
being unlocked on this image that's this
one and then we have the deployment
script being invoked at that step and
then he started our security auditor he
asked what what happens in the middle
how does secrets get from the step above
to the deployment script in the button
oh well we just stored as a privateer
and boom which has to have unencrypted
secrets in our log files in every other
step between those two arrows available
for everybody with read access to that
deployment pipeline to use and see and
this group so what we have to do and we
we would we never thought about it with
we just hate work for the way it works
for us our users are happy they can use
it but we weren't finished and it's an
important it's important to reiterate
and think negative in a
think in non sunshine errors have people
help you uncover that you don't open up
for you can do so you can do so much but
if we have left if we had left
unencrypted secrets in unemployment
pipelines and in our log files we hadn't
accomplished anything and this is a
level of security we need when being a
company like later because if we have
too many of those essentially it's
Sunday we've lost and I think we'll get
compromised so we need to keep a high
standard what we have to do here was to
encrypt the keys that we just extracted
with a credential that nobody is aware
of that's of functionality embedded in
in the in the workflow engine which is
deploying code it can create a Krenzel
for a credential for you that you're
totally unaware of so we can use that to
encrypt the secrets we just extracted
and decrypt it in the deployment step so
even us the administrators of our
deployment pipeline cannot see we can
just see a base64 encoded string that's
all that's how we solve that particular
problem and that's the standard that you
need to have in order to ensure and show
to the world that we're doing our very
best our utmost experienced people are
working on ensuring your kids data
within our systems
final note I think it's quite funny but
you can / engineer so much when you're
doing security and you need to challenge
the assumptions all the time that's
basically what I'm trying to say with
with that image because you can do
security in it within a year but try to
keep in mind which walls you're trying
to build and this one poses again you
don't do that ever I will find you and
haunt you and kill you with a spoon if
you do slowly so please don't I'm quite
aware that many developers a Lego will
probably watch this so I know who you
are I can find you you own the deploy
script so I can see the checking last
yes all right hmm security is all about
removing how and ensuring trust that's
what it is if you ever need to explain
what security is use those terms and
elaborate upon it you should build walls
the right size and the right in the
right place and have a discussion about
where to build the walls how high should
be how wide should they be to need to
building cannons and guns and crocodiles
and stuff
I haven't touched much upon auditing but
if you can show how people interact in
your systems who's accessing secrets how
they're being accessed which systems
have access to with which parts of your
system you're in a very good place I
have an example of Magnus properties
marina where I rolled a password for
work account which effectively shut down
an aisle pipeline it took my team 30
seconds to look into the locks and see
that I was the one who had last made the
update and yes I had to buy cake in that
respect but it's immensely important
that you think in terms of you think in
order bility and visualize and make it
transparent who's accessing secrets both
systems as well as people who is reading
secrets is equally important as who is
updating them never underestimate peer
pressure I will never forget to double
check and triple check that I've got the
right account the next time I roll
something for sure get your stakeholders
on board try to create a shared language
for company it's a gentleman a manifesto
it's not modalities but it's been around
for four years for the kids it's
important don't forget if you start a
project start with a security feature
because walking skeletons win by
starting with security you will be
forced to start integrating stuff
together if you have a totally green
field application you should kick off
and start with the login function for
instance or whatever function interacts
with various parts of your system where
security is involved if you need to
exchange the credit certificates start
with that as well as if you're in doubt
do a security feature it will uncover
where where to build your walls and
proof of concepts will test
if you're building your walls in the
quraían fashion and eventually you'll
get a good dialogue kicked off by doing
the security features first if you don't
know where to start penetration tests
provide great value just bear in mind
that they should be the Kickstarter of a
dialogue it's not just an we have so
many errors 72 error go fix now we're
safe that doesn't work that way then
you're doing it wrong but it can be they
will find something all the time these
companies they what that's what they do
for a living trying to penetrate systems
and show your report and they're very
very good at it then go by so you can
buy systems for a few hundred dollars
and just run them internally and that's
a good place to start you don't have to
buy get people to do it for you you can
get off you can come pretty far by doing
it yourself but getting somebody from
the outside to do it they will have a
totally different perspective of your
infrastructure than you have because you
know cluttered in it and work with it
every day so don't see the weak points
the way that an eventual attacker will
do it
symbol is often more secure and if
you're in doubt if you make things too
complex too hard to understand you're
also probably opening up attack vectors
that you are unaware of so the simple
solution for distributing secrets for
instance is better even though it has
numerous drawbacks it's better than
doing nothing and then doing nothing and
you can overcome with five things in in
a way that you're actually better off
not doing anything at all that's all I
have for you please remember to vote I
appreciate feedback and I know the
conference does it well so and come to
me if you have questions thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>