<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ASP.NET Core for Angular, React, Knockout etc  developers - Steve Sanderson | Coder Coacher - Coaching Coders</title><meta content="ASP.NET Core for Angular, React, Knockout etc  developers - Steve Sanderson - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ASP.NET Core for Angular, React, Knockout etc  developers - Steve Sanderson</b></h2><h5 class="post__date">2016-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/C6MPSLgsGGs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the back alright cool I'll just give a
minute for people to keep on walking in
but while we do I want to do my
customary how much of these technologies
are people using things so can I give me
a quick show of hands if you use angular
react knockout or some other thing like
that in your day to day work yeah
everyone okay that's not surprising how
many of you specifically angular then
all right that's that's like probably
more than a half and react that's most
of the remainder probably like third and
knockout oh actually that's another
third so some of you using more than one
things anything else Aurelia
yeah that's smallish but that's not
reach 100 yet so that's reasonable okay
cool
all right then so yeah my name is Steve
and I work at Microsoft on the asp net
team and my particular area of focus is
trying to make sure that everything that
we build is going to give you a really
good experience as a client-side
application developer so whatever
technology package that you like to use
we want to make sure that it's so it's
all going to fall together quite nicely
for you so let's think for a little
minute before we start looking at some
code about the history of how we've got
to where we are now and whether or not
it's already good or bad or to what
extent so let's start by taking a little
step back in history we'll go as far
back into recorded history as we can
right at the very beginning of when
historians can first start recording
history which is 2003 and we'll think
about the sort of skills that you need
it as a web developer back then okay so
if you wanted a job in this industry
right then you would need to be able to
do some HTML you'd write some JavaScript
probably for some validation logic or to
make some annoying pop-ups appear or
something like that you would be doing
some styling with CSS you would
inevitably be writing some sequel to
talk to a relational database and you
will be doing some server-side
programming with ASP net PHP or some
Java based thing probably okay so how
have things changed since then what's
the landscape and what are we asking now
if not our rocks
our web developers but our typical
bog-standard entrance to the industry
well these days it's not enough just to
know JavaScript obviously there's quite
a lot of different languages that
compile to JavaScript that you're going
to have to be familiar with typescript
notably but also different versions of
JavaScript itself different standards
es2015 es 2016 and so on that they'll
have to get used to after that you need
to start thinking about what frameworks
you want to use you enter this murky
world of picking your favorite
client-side Model View library as well
as your favorite libraries for all kinds
of other tasks like to do with rendering
3d graphics or anything else so lots of
libraries that you're going to have to
learn that enough that alone is not
quite enough to write your application
because you have to make some other
choices for example what kind of
client-side application architecture do
you want to use it's not just MVC these
days we've now got things like redux and
other members of the flux family that
are bidding for our attention there okay
so when you've got all this stuff
together you can probably start to write
some code but then you need to think
about how it's going to get into the
browser and get executed there are many
many different systems for packaging
bundling and distributing code and for
actually getting it to load inside
browsers for making references between
modules and so on that you have to
understand the pros and cons of
different options there but you don't
just write these bundles by hand
obviously you're going to need to use
some sort of build tool and there are
many many many different built tools
that you need to trade off and make the
right choice among now for the really
old-school ones among you could use
something like gulp or grunt but to be
honest they weren't like they were
around in 2014 so most of us have moved
on numerous times since then and these
days we'll be using things like web pack
and roll-up and something that someone
came up with this morning or whatever
okay and that's not to even mention any
of the advances that have happened in
the world of styling which is a whole
discipline in its own right which I know
very little about but they've got their
whole collection of technologies now in
order to write effective and
maintainable Styles okay so that's a
good portion of your application but as
well as that these days we also now are
concerned about the different platforms
that our code is need to to run on it's
not just desktop browsers anymore
obviously it's not even just mobile
which themselves have got a whole set of
different capabilities and UI
interaction paradigms now we also need
to think about if we're building a
really modern application maybe our
client side code doesn't just run on the
client maybe it's a universal or
isomorphic app where our JavaScript runs
on the server just as well as it runs in
the browser and transparently switches
between the two so there's so many
different concepts that are all coming
together to make a couldn't current-day
web application so how does this fit
into the bigger picture then because
when we think about the the technology
landscape as a whole what we see is that
over time all technologies get more and
more streamlined and simplified and
approachable except for web development
over time just get more and more and
more complicated and why is this so I
did a bit of research into it and it
might have just been my jet lag or it
might be mine a genius I don't know but
I've come up with some some ideas about
what's actually going on so I did a bit
of research using this advanced research
tool called
Google Trends and it confirmed what we
all know which is that JavaScript
frameworks have been growing and growing
and growing in their pull on human
attention since 2011 and you you can
easily confirm this for yourself right
because after this talk you can go out
into the street and you can ask anyone
that walks past like what's the biggest
change that's happened in the world over
the last five years and every one of
them will say the proliferation of
JavaScript frameworks right because
that's easily the biggest shift in human
culture over that period but is this
just a standalone thing or does this tie
in with some other cultural or political
shifts that are going on well I think
that I might be onto something here
because if we plot this alongside the
terrifying global rise in extreme
right-wing politics we'll see they seem
to correlate a little bit I mean easy
just a coincidence that they seem to
have grown at the same rate at the same
time really be a conscious and if you're
not convinced about this look what
happens if I also overlay the scary rise
of superhero reboot movies right
definitely something is going on here
and I know whenever you show a graph
like that all the scientists in the room
they all just want to jump up and down
and show correlation equals causation
yeah yeah we
think that's right so yeah we know okay
yeah so it's pretty convincing evidence
that something is driving this whirring
growth and complexity for us as
JavaScript developers so what are we
going to do to fight back against that
well in the asp net team we are trying
to make lives better for ourselves and
for everyone else and we can't solve all
of these problems we can't take on the
the you know the superhero reboot movies
thing but we can try and help you with
your single page applications and that's
what I'm going to be talking to you
about in this talk so here are a few
sort of high-level ideas one it is that
we can try and make sure that whatever
code you write on the client is going to
play very nicely with the code that you
write on your server and that means
having the right set of packages and API
and hook points and so on that the sort
of server-side and client-side code can
play together nicely another thing would
be to accept the fact that today your
JavaScript probably doesn't just run on
the client but may well need to run on
the server too there are lots of reasons
why you might want to have server-side
JavaScript and we'll be getting into
that later in this talk and then finally
and sort of more obviously just making
sure that you have a really good
developer experience and that starts
with your file new project and it runs
through all the deployment and debugging
and everything like that and that will
be a major part of what I talk about in
this talk today so that's where I'm
going to start in fact I'm going to
start with the experience of getting
started with you the new project and and
I'm going to run you through a set of
project templates that I've been
prototyping lately and are now out in
beta form and these are some project
templates for angular 2 current version
of angular 4 react for knockout and for
react with redux now these are not the
only client-side technologies obviously
someone in the front row with a really a
t-shirt on and if I were to go through
the list they're probably twenty other
JavaScript frameworks represented in
this room so the idea here is not just
that you can only use one of those four
but rather that the underlying
technologies that provide the
functionality I'll cover in this talk
are available to you to use in whatever
kind of project you want whether it's
for a different client-side application
framework or for just some crazy project
structure that you come up with on your
own and I'll be showing you that
later on in this talk okay so let's get
started and I'll talk you through the
process of creating a project and then
we'll look at some of the features that
we're putting in to make sure that you
have a really good developer experience
so let's say that we want to make a new
angular 2 project that works with asp
net core so you can get these beta
project templates today and you do that
by getting them as yeoman templates
yeoman is a node based project
scaffolding system we've shipped asp net
templates on your M for quite a long
time and these spar templates are
underman right now we will probably also
make them available through other
methods in the future but for now if you
want to get them you will go to any
machine that's got no Jes installed and
write this npm install globally yo
that's for yeoman and then generate or
SP net core spa single page application
press go and wait for it to fetch all
the stuff I will not wait for it because
I don't have an internet connection so
it would not work very well but I've
already got it installed so that's fine
and then you can create your new project
so let's do that right now I'll do make
do my new thing okay let's go into there
and I can say yeoman please create for
me a SP net core single page application
and it will say okay fine what framework
do you want to use here are some options
for you okay let's say we want angular 2
what's the name of your project doesn't
matter we'll just let it do that and it
will now restore all the dependencies
and we've got a nicely structured
project that I'm going to talk you
through now obviously this restore
process won't work in the absence of an
internet connection so we'll kill that
and we will delete that and we'll go
into the one that I already prepared
okay so here's my file new angular
project and let me get that started and
then I'll start showing you some of the
code and some of the things that we can
do that so I'm going to go what is it
now dotnet watch run so I'm going to run
the dotnet over my SP an application
there and it's watching for any changes
to c-sharp files and it will recompile
and we saw if it sees any and it says ok
I'm listening on port 5,000 okay so
let's put that into our browser and
we'll see what comes up there
and we will see overside there we go
that's about all right so we will see
our starting point for an application
and it looks a little bit different to
the normal file new projects for SP no
plication x' the reason for that is that
those normal file new projects are
largely designed with some sort of
public facing website in mind but the
kind of navigational structure and
layout that you probably won't use for a
single page application is probably a
bit different because you're probably
going to be building something like an
administrator console or a dashboard or
something like that otherwise you
wouldn't be using these sort of
technologies and the slightly different
layout but it's just bootstraps so
obviously you can change it to look and
be laid out anyway anything that you
like anyway it starts with a bit of
information about some of the features
and technologies in there and let me
just quickly run through some other
stuff so it's got a few different pages
and it's got back forward navigation
this is purely client-side navigation so
it's not doing request to the server
every time I move backwards or forwards
it's within the single page application
we've got this very very simple example
of an angular 2 component which just has
a button and when you click it it counts
how many times you've clicked it so that
gives you a very simple sense of how you
can write something like that and it's
also got an example of how you could
fetch some data from your asp net server
on the back end and display that in a
grid so let's have a look at some code
that's in there let's see is actually
structured and here is my code and you
can probably see if you used any asp net
MVC applications in the past or ASP net
core then it's more or less like those
it's got all the normal server-side
stuff we've got our controllers folder
we've got views we've got startup CS and
so on the main things that are different
about it is that we've got this client
app folder up here which has got the
whole angular 2 application in it and
we've got a bunch of extra config files
down here at the bottom to do with
typescript and web pack which we'll talk
about later on in this talk so what's in
this client app folder well it's all the
stuff that you need for a normal angular
2 kind of application for example we've
got a routing configuration this is a
client-side routing so this is matching
all those different URL patterns that
you were seeing me navigate through a
minute ago and that references these
different component
that can get rendered for example there
is this counter component and if we have
a look at the code for that it's pretty
nice and simple so is written with
typescript and it says right let's
import the angular libraries and we'll
give it this name ng and we'll tell
angular to regard this class as being a
component and the logic for it is really
simple we just have a current count
member property it starts off at zero
and whenever we call this method it goes
up by one not too hard and that's all
linked together with this template
counter HTML and inside there you can
see that all we do is use angular to
view syntax to display the current count
and we've got a button that when you
click it it increments the count pretty
straightforward and that's how that
works ok so pretty predictable kind of
stuff so what are we really contributing
with this project templates how are they
different from what you would have just
set up immediately within 2 minutes on
your own anyway well there's quite a lot
of fiddly plumbing going on if you want
to have some more advanced features that
are representative of 2016 style web
development and I'm going to walk you
through some of these things and they
are a pain to set up and that's
essentially what we're taking the work
away from you of having already done
that in advance so let me run through
some of them the first one is kind of a
bit boring and I'm not going to show you
any code for it so you've got a server
side routing configuration in Ospina
you've also got a client side routing
configuration in angular react really or
whatever else you like now you want
these things to work together nicely and
so we've got a little bit of helper code
in there that just make sure those the
server-side configuration understands
that there's going to be some quiet side
routing as well and they don't conflict
in any awkward way okay not very
interesting not going to demonstrate it
but more interesting is some of the
stuff that we've put in to help you
build your code in an effective
efficient productive and fun manner
build helpers so what does this mean and
how does this help you let me show you a
little example I'll show you something
that doesn't work very well and then
we'll figure out how we can fix it using
these build helpers so let's say we want
to make a change to our code let's say
we've got this counter page here and
some kind of business analyst comes in
and they say well yes I've analyzed your
business practices
and I found out that your staff could be
at least a hundred percent more
efficient if every time this button was
collected it went up into instead of
once because then they would get twice
as much work done per unit of time and
you say okay yeah that makes sense I
understand where you get paid the big
bucks now so I will go and implement
that amazing new business process that
you've just invented that so you go into
your source code and you say okay I'm
going to change this page now I'll
rename it so instead of counter is
called double counter very good and will
change the typescript code as well will
change it so that when you increment it
goes up by two instead of by one very
good and I'll save that as well let's
see what effect this has shall we
I'll go back to my browser and I'll hit
reload and it has no effect whatsoever
it still says counter and it still goes
up by one so why is that well it's
because it's a typescript application
and obviously typescript has to be
compiled it's not understood natively by
the browser and in this particular case
we are using webpack as a build and
bundling system that has got a lot of
powerful functionality I'll give you a
few hints about what we're doing with
that later but for now let's just say we
want to use webpack to recompile stuff
so we can do that very easily for
example we can go into a command line
window and manually just run web pack if
we want to and that will work it will
work absolutely fine
it will recompile everything and it's
rebuilt my j/s and my CSS stuff now if I
come back here and I hit reload then
when it comes up we've now got double
counter and it does in fact go up by two
pay rises all around brilliant but it's
not that great for you as a developer
because you have to keep remembering to
recompile stuff all the time which is a
bit of a drain on your limited mental
was I'm not sorry it's it it's an
inefficient use of your valuable
valuable time that's why I'm n okay so
you want to rid yourself of this
unpleasant task of having to run web
pack on the command line what you're
going to do well maybe you set up some
sort of filesystemwatcher
that's just going to see whenever a file
changes on disk it's going to run web
pack for you well that will work but
it's not great because you never really
know how long it's going to take to
compile you never know when it's read
finished when you can safely refresh in
the browser are you going to get a
consistent set of files when you do
refresh where the compiler error is
going to go
all that sort of thing can we do a
little bit better than that and this is
where we come to webpack dev middleware
this is a feature of web pack where the
compiler for web pack instead of exiting
when it's finished it can stay in memory
and it can keep all the intermediate
compilation states there so that it's
ready to recompile very quickly using
all the cached intermediate states and
it can also expose a kind of it's a bit
like a virtual file system that
represents the output from the compiler
and then we can serve that virtual file
system to the browser so the browser is
always seeing the compiled output even
though it's not even on disk and it's
smart enough to say that if a request
comes in welcome pleasures in progress
it will just block it until it's got a
consistent set of files so you can just
hit refresh as soon as you like it will
probably be done more or less instantly
because it was already in memory but
even if not it will wait the right
amount of time before completing the
request so how can we use that well we
have made that available in these
templates in fact it's enabled by
default but I just took it out just
before this demo just so that I could
show you the effect of it not being
there and then the effect of putting it
in so if you'd actually done it as a
file new project you would see some
lines of code in there already like this
this says if it's if we're in
development mode then we're going to use
webpack dev middleware now this is only
useful in development time technically
you could do this in production but
there isn't really much of a good reason
to be dynamically recompiling your
application when people are requesting
the in production because you could just
build it once and then serve it from
disk and that would be more predictable
on fast but in development it's pretty
useful to be doing this ok so let's see
the effect of this I'll come back over
here and I'll hit reload and initially
it will just look the same but now I'm
going to go and change my code again
I'll change it to triple counter now the
business analyst didn't even come up
with this one this is my invention okay
the idea with this one is that instead
of going up with two so we're going to
go up with threes okay so just bear with
me we'll see what happens all right so
now I'm not going to run webpack on the
command line manually at all I just hit
reload and immediately my astonishing
innovation is right there for us all to
see okay so yeah
banks so it's pretty good right but I
still don't think this is as efficient
as we could get because I had to press
the reload button manually just then and
you may be thinking that you know in the
scale of all human suffering that
anyone's ever had to ensure that
pressing reloads not bad but if that's
your attitude then to be honest I'm
disappointed in you and you should
consider a different career because
laziness is such a virtue for a
developer but there are other reasons as
well where it's highly desirable not to
have to reload the page for example you
may have a debugging session in process
and if you reload then you just wiped
that all out and that there are other
reasons and I'm going to get to some of
that later in this talk so this brings
us onto hot module replacement this is a
feature where we can see if the output
of web packs virtual file system has
changed and if it has we can push the
changed code into the browser directly
and update your application without it
reloading the page so let's see this at
work now this is another feature that
would be there by default if I hadn't
taken it out for this talk so let me put
it back in and then you'll see what
effect that has I'm now saying hot
module replacement equals true that's
all I have to do so I'll wait for my
code to recompile there in the web
server to come back up and probably
happened about now so I'll hit reload
now when we'll see again initially it
looks the same but now watch what
happens when I change my code I'm tired
of this sort of slightly improving it so
I'm going to change to ultimate counter
and I'm going to make it go up by the
biggest number I can okay I press save
and you'll see that I didn't even switch
back to the browser but it's already
updated right there and I'm going to
change it to go up by the biggest number
I know which is 10 and when I press save
there I can go back to the browser and
now it will indeed go up by tens and I
didn't have to reload at all it has not
refreshed the page it's just changed the
running code okay
I'll show you some examples of why
that's even more useful later on okay so
that's a hot replacement what else have
we got in terms of build helpers well
we've also got the ability to produce
different builds depending on whether
you are targeting a development
environment or a production environment
I'm sure that all of you in your
existing code pretty much
already have some distinction between
dev builds and production builds so what
does that look like in this kind of
setup and and how is that actually
controlled okay let me show you so as I
mentioned before as I mentioned about
ten times now we're using webpack and as
it happens webpack is configured through
these config files now we've got four
different ones here and I know that
looks a little bit overwhelming why do
you really need for different config
files well the truth is that really
there's only one and that's this one at
the top web pack config and the others
are just overrides for different
scenarios for example we've got this dev
config file okay and what that says is
that if we're in dev mode we're going to
include source maps in the build output
whereas if we are in prod mode we will
not include source maps but we will use
uglify to minify the code we've also got
this vendor file I'll explain that in a
moment but first let's see how much of a
difference this actually makes okay so
let's see how big the bundle of code
that worship into the browser is right
now so let's go into the browser Devo
dev tools and we will see how much stuff
it's loading so I'll do a hard refresh
and we'll see that right now to load
this simple application it's doing 11
requests and transferring 3.8 megabytes
of JavaScript which is a fairly
disturbingly large amount of code but
that's because we're including all of
the source maps not just for our code
but in this case for all of angular as
well which is enormous so you would not
want to be shipping all that to
end-users in production so let's see
what a difference it makes if we Shippo
switch over into a production build okay
so I'm going to stop my web server here
and I'm going to change into a
production configuration and then I'm
going to run web pack and I'm first I'm
going to tell it to run with this vendor
config how many of you already do venn
during of your JavaScript libraries
small number I bet it's not a very
well-known term in Microsoft circles
basically the idea is that you've got
the code that you write and then you've
got all the third-party library code
like which in this case would be angular
2 and bootstrap and some other stuff
probably
now the third-party code is tends to be
massive compared with yours for example
angular 2 on its own even after
minification is 1.9 megabytes is mad
and to compile that web pack has to do
tons of static analysis over it all to
link all these modules together and
figure out you know if it all if it all
builds correctly and that in this case
is taking 15 seconds you don't want to
wait that amount of time every time you
make any change to your own code so with
the vendor in system we can split that
into a separate bundle that you don't
rebuild most of the time and then
there's at your code that just builds
really fast so now we've rebuilt that we
can just rebuild our code and that I'll
go through much quicker doesn't have to
do any analysis on angular 2 and it
produces this nice compact little bundle
just containing the stuff for this
application ok so now I've done that
let's run the application again and see
what effect that has
so that's running well now and I'm going
to hit reload and we'll see how much
network traffic this moves now we'll see
it's now gone down from 11 to 8 requests
and from 3.8 to 2.1 megabytes so 2.0
megabytes still kind of disturbingly
massive right for a small application
it's kind of fundamental today because
angular or 2 on its own is 1.9 Meg's but
that problem is going to get a lot less
very soon because as soon as we can
switch the server to web pack 2 we will
get a feature called tree shaking which
is just a ridiculous name for dead code
in MLA elimination so any parts of the
angular libraries that you're not using
will get stripped out and the angular 2
team have got a proof of concept that
shows a hello world angular project
dropping down to about 50 kilobytes with
the tree shaking gone so that's the sort
of size reduction that you should be
getting when you do a production build
and we'll do pretty soon ok so that's a
fairly substantial improvement ok right
then what else we've been thinking a
little bit about the efficiency of
shipping this this application to the
client right now but let's think about
the efficiency of actually starting up
and executing the code on the client
let's see how long it takes right now so
every time I hit reload you'll see that
we see the word loading appear in the
top left there and it takes what like
half a second or 1 second or something
let's measure it quite precisely shall
we
I'm going to use this timeline tool here
and I'll hit reload and
Roma's going to measure how long it took
and we should see that if we zoom in a
little bit after zoom out okay the
screen changes from loading to loaded
about what seven hundred milliseconds
something like that okay so that's the
time it's taking to ship this bundle of
code to the browser and then for the
browser to pause this big bundle of
JavaScript and start executing the code
okay
now you might think that's not too bad
700 milliseconds like under a second
that's a fast application what's the
problem here well that is not fast
because this is an incredibly artificial
scenario like for one thing I'm running
on localhost and literally on the same
machine as my web server which is like
the most insanely fast network
connection you can imagine so that's not
very realistic and the other thing is
this is a pretty fast laptop and some of
your users are probably going to be
using like a $50 Android phone or
something like that so the CPU in their
machine is going to seriously struggle
to even remotely approximate the
performance of a decent laptop it could
easily be 10 or 20 times as long to for
the application to start up in their
case they may well be waiting 10 seconds
plus before they actually even see it
get beyond the loading thing for them so
what can we do about that and can you
imagine also if an even worse scenario
occurred like the the absolute nightmare
that keeps us all sweating at night like
this imagine if someone didn't have
JavaScript enabled what are they going
to actually see in that case let's see
if I hit reload now what we will see is
the word loading and that's just going
to stay on the screen forever which is
not an optimal user experience in my
professional opinion so can we do
anything about that well this is where
we get into pre rendering or you could
call it having a universal app or an
isomorphic app or whatever you want to
call it basically can we take all of the
JavaScript for your application and can
we run it on the server just like it
runs on the client because we've got a
pretty smart server on the back end
there can't it manage this well yes it
can so let me show you how we can do
that again this is a feature that is
enabled by default when you create a new
project with these templates
and I've taken it out just so I can demo
it to you so it would have had some code
in here this is my main razor view for
this application and inside there you
see I've got this app element and this
is where my angular 2 application is
getting bootstrapped into and what you
would normally have seen in there is a
couple of tears peanut core tag helpers
like this so what I'm saying here is a
SP net use these libraries that I've pre
installed to pre render a JavaScript
module which is at this location client
app boot server ok so let's see that
that's there and that is in fact here
and as you can see from the filename
extension it's a typescript file type
script can't be executed directly it has
to be compiled first and that is why I'm
also specifying the location of my web
pack config now this is pretty cool
because it means you can write your
client-side application in any language
that web pack can compile which is like
any language that compiles to JavaScript
obviously probably plus quite a few
other things and all of those can
therefore run birth on the client and by
this system on the server too so if I
just save that now let's see if this
actually works I'll switch back over
here and even though I still got
javascript disabled completely in the
browser when I hit reload takes a moment
to come up the first time but we will
see that the angular 2 application just
pops up even though there's no
JavaScript enabled in the browser and I
can still navigate around which is
pretty nice ok and let's see how much
faster this is actually now then so if I
go on to the network tab and I'm going
to hit hard reload then when we can
actually see that here it is we can see
that the application there was getting
rendered in 98 milliseconds so that's
the time it's taken to execute the
angular application on the server there
and ship the rendered HTML of the
application down to the browser so
that's pretty good improvement but we
can make it better still because this is
a razor view and razor views allows us
to do all kinds of cool things for
example I could take the section of the
markup here and I could just wrap it all
up in a cache tag there so I can say
well after you've computed this once for
any other request to this URL just use
that same pre-rendered markup and let's
see what effect that has
so now I'll reload once and the first
time it has to populate the cache but
the second time I run it it should be
pretty quick and we're seeing in this
occasion it's delivered the entire
render and angular application to the
browser in three milliseconds which is
pretty phenomenally fast and that's
obviously just as fast as any
traditionally server rendered
application is ever going to be now I've
just shown you that it works in a sort
of limited way without JavaScript in
that you can never get around because
these are just regular hyperlinks it's
all going to work fine but not
everything is going to work like that
for example this button here if I click
it nothing's going to happen well how
could it work because that button
obviously is wired up to some angular
event and there's no angular because
there's no client-side code so obviously
that's not going to work so this is not
really designed for the scenario where
you don't have JavaScript I mean
arguably it does help in that scenario
with search engine optimization but for
actual end users realistically you
probably are not going to support this
scenario the main reason why this is
actually useful is just for the sheer
performance of having your application
rendered really quickly so the
application loads essentially instantly
there's never there's no loading stage
as far as the client is concerned it's
pre rendered on the server and then in
the background the client-side code is
loading and as soon as it's loaded then
it takes over and the client-side logic
works exactly like it normally would
okay so that is doing some pre rendering
on the server okay now there are quite a
few other features that are in these
templates that I'm not going to have
time to demonstrate in too much detail
so I'm just going to skip through a few
of them now one of them is a feature
called cache priming this is another
performance feature the idea here is
that there's a very common pattern in
single page apps where you render your
initial UI and send it down to the
browser and then the very first thing
the browser does is it makes an ajax
request back to the server to fetch some
data which is not that smart really
because if the server knew the client
was going to ask for that data why
didn't it just send that data in the
initial page that would have saved an
entire HTTP request so the idea of cache
priming is that you can specify a list
of endpoints in your MVC application
that the client is going to make a
request to and then we will pre evaluate
those requests embed them in the page
and then when
and the client-side code was going to
make an AJAX request to that endpoint we
will intercept it giving the data that
we've already got and it will just
resolve the request immediately without
even talking to the server so it's just
a simple performance feature that we've
also got some helpers for validation as
you can probably guess angular 2 has got
a client-side validation thing as well
as react and well you know everything's
got validation and you can't really get
away from that and on the server in ASP
now obviously you've got a server-side
validation feature as well in terms of
angular we found that it was necessary
to have a bit of helper logic to make
these two things play together nicely so
if you have a server-side validation
message you want it to appear at the
right place in an angular 2 form well
we've got some helpers to make sure that
actually happens and then another
feature lazy loading this is a feature
that's unique to the knockout template
at the moment we would be very happy to
have that feature in the angular and
react in any other templates as well as
long as somebody can come up with a
plausible way of doing it with those we
just haven't found one yet but for the
knockout one it's very straightforward
so basically the idea is that as part of
the build process you can nominate some
different parts of your application that
will be split off by web pack into
separate bundles you don't even have to
think about giving names to them or
anything else you just define a certain
navigation point and the code that's
reached from that will go into a
separate bundle on disk with some
auto-generated name and then it will
automatically get loaded on demand as
the user navigates around so it's
completely transparent to the user it
just means that you're not shipping the
whole application upfront you're just
sending it incrementally as the user
moves around okay so that's a bunch of
features for these templates but so far
I've only shown you the angular one I
want to show you a couple of features in
the react templates before we move on to
some some other topic okay so let me
show you one thing that you can do
really well with the react Templer okay
I'm going to stop this angular
application here and I'm going to move
into react spa which I've created before
which is basically a file new react
project with the yeoman templates and
I'm going to switch back into
development mode and start that running
and so when that comes up
let's go here let's see what the react
template looks like well not
surprisingly it looks essentially the
same they are all of these templates
produce more or less the same looking
application slightly different
information on this home screen here but
the same functionality same examples of
what you can do just now implemented in
a react style okay but one thing that
the react library can do really well
quite a lot better than how things are
set up in the angular template at the
moment is that when it does the hot
module replacement it can preserve the
state of the application very reliably
and this starts to show why it's useful
that we're not refreshing the page when
you make a change to your code so let me
show you an example let's say that we've
been playing around with the application
for a minute and we've got a certain
state in the browser's memory like in
this case I've got a current count value
of 6 and now let's say I want to make a
change to my code okay let's see the
code for counter shall we so I'm going
to show you my react single page
application here and we'll find the
counter component yep so again it's a
pretty simple bit of component it's
written in typescript it imports the
react library it defines in typescript
an interface to represent the sort of
state that we've got here it sets the
initial state to be a count of 0 it's
got an increment method that sets the
count to be one more than it was before
and we've got a render which displays
the current count and it's got a button
that when you click it it increments the
count now one thing that's a little bit
different about react is that it's kind
of strict about the way that you manage
state and it's quiet kind of determined
that your state needs to be kept in a
sort of an official place that we act
knows about and some in some ways that
makes you a bit more restricted in the
way that you can write your code but it
also comes with some benefits in terms
of what we can do for you if you follow
that pattern so let's say that I want to
make some change to my code now I'm
going to make a similar change to before
so I'll change this now to a super
counter and I'll press ctrl s and the
hot module replacement should kick in
and we'll see in the browser that it
changes to super counter but it has not
lost the state of the application it's
just updated the code
without losing that state and I could
change the procedural logic as well
let's make it go up in tens now for
example and when I switch back to the
browser it will now be going up in tens
even though it's still got its state as
before and I can do other things too
likes let's say that when we display the
current count instead of just displaying
it normally I'm going to display it
current count times two when I save that
it's going to change from 46 to 92 and
then I can change it back and it will
change back so this is pretty nice this
really starts to feel like you've got
this live flow between your IDE and the
application that's running in your
browser and it deals even with things
that can go wrong as well so let's say
for example I make a mistake
blue blah whatever I'd to call some
function that doesn't even exist I press
save what's it going to say nothing oh
there we go it's done it it's now said
cannot phone in blah okay so I fix my
obvious error in my code I'll save it
again the error goes away and my
application still there it still hasn't
lost its state so this provides an
extremely fluid and flexible kind of
development experience for you and this
is why it's really useful that we're not
throwing away the application state each
time you change something and in fact if
you want to take that a step further you
can look at the react and redux template
how many of you using redux right now
that's more than I thought that's that's
probably like more than five percent
okay so redux is a for those of the rest
of you Redux is an application
architecture it's not strictly speaking
tied to react but it's very often used
with react because it kind of came out
of that community and works very well
with that the idea of react is of Redux
is that it's it tracks all the states
that your application has been through
and the way that it's transitioned
between each of these stays and the
benefit of doing that is that you can
always understand the state that your
applications in if something goes wrong
you can trace backwards through all the
different transitions that it's been to
and see exactly what caused whatever
particular thing to go wrong actually
caused it and this plays really nicely
with this sort of hot module replacement
system so let me give you an example of
that I'll kill this application and
switch over to the react redux spa and
I'll start that running so when that
comes up I'm going to load that in the
browser and again the reactor Redux
template looks more or less the same as
all the other ones it's got the same
three things in it but now implemented
with a Redux architecture okay so let's
do the same thing that we did before I'm
going to get a particular stay in the
browser's memory in fact actually I'm
going to do it a navigation as well so
let's say we start on counter I switch
to home switch back to counter I'll
press the button quite a few times and
let's say that as this stage something
went wrong and you don't know why so by
now because you're using redux you can
pop up in the Redux developer tools and
this will give us a list of all the
different state transitions the
application has gone through for example
we can see that we did a location change
in the URL history we can see that these
increment count secured we can see this
one is where we went from 2 up to 3 and
we can trace back through that we've
also got this sort of crowd-pleasing UI
here where we can display this little
slider and using the slider we can jump
backwards and forwards through time we
can see exactly how the user has
navigated around and what happened as
they press buttons and what effect that
had okay and this is really cool if you
want when you're implemented a new
functionality or when you discover some
kind of a problem because you can change
your code and see what effect that would
have had on the the actions that the
user performed so as an example let's
say that we want to have some new rule
that whenever the count is more than 10
will display a special message but it's
not doing that right now it's just
displaying the count so let's see if we
can implement this new feature in our
application I'll switch over to the
counter under react redux spa and I'm
not going to go through the code but
this is the little bit where it actually
displays the current count and I'll
change it so that I'll say if that value
is less than 10 then we'll display it
otherwise we'll display this this
special message stop clicking now ok so
when I save that and switch back will
it's immediately changed to stop
clicking now because of the hot module
replacement but as I move the slider we
can see exactly when that message would
have appeared we can replay the user's
actions throughout this the whole
history of the redux star there with
respect to our updated code which is
particularly cool if you for example
you've reproduced a bug but you're not
quite sure how you can slide back to
before it happened you can make a change
to your code to see if that's going to
fix it and then you can try just moving
the slider along and see if whatever
problem you experienced has gone away
now so that is the sort of very friendly
and modern development experience that
we're trying to make available to you
with these sorts of templates ok so
that's enough about these project
templates I want to spend the last bit
of the talk going through some of the
technology that underpins this and look
at one or two other ways that you could
use it in different types of projects so
behind these project templates are a
bunch of new get packages which contain
a lot of the logic and functionality for
tying in with all these different
services that I've been showing you so
for example we've got packages called
angular services and react services
which deal with providing a lot of
functionality for those type of
applications and like I've been saying
repeatedly we don't just want you to be
limited to those things we want you to
be able to create your own stuff as well
for other client-side technologies or
for just whatever other type of project
you want to build and the functionality
that these things have in common is all
coming from a new get package called
spar services and this deals with common
facilities like being able to pre-render
parts of your application on the server
having all these tie-ins with web pack
with doing the tie-ins between server
and client routing and other things like
that and this is agnostic to whatever
type of client-side framework we are
using and you can use that with some
other framework if you want to now as
for how that works internally like how
does it actually do the JavaScript
rendering on the server well it makes
use of a yet another new get package
call node services and as you can
probably guess from the name the way
that works is that it makes use of
node.js internally so internally in a
hidden headless way it spins up
instances of nodejs whenever it needs to
and it's got a very fast RPC layer that
allows it to pass in vacations into
nodejs and get the result out and it
deals with all the messy stuff around
process lifetime management recovery
from errors propagating errors that have
occurred in node through into your
dotnet application in the right kind of
way all the serialization and all that
kind of stuff so that you don't have to
deal with that and you can make use of
these libraries or whatever level is
useful for you in your application for
example if you just want to execute
JavaScript code on the server but you're
not interested in it any of the other
sparse stuff then you can just take a
dependency on node services directly and
then you've got a JavaScript execution
on the server so why would you want to
do that anyway well probably the most
compelling reason for running JavaScript
on the server is the fact that you get
access to all of the infrastructure from
NPM NPM the node package manager
repository is the biggest collection of
open source software in the world that
has ever existed and anything you can
think of is probably on there under 25
different modules and so you know you
can get whatever functionality you like
from there and some things are only
going to be there for example if you
want to do some sort of translation at
runtime on the server that's going to be
written in JavaScript and so you're
going to need to be running JavaScript
on the server or let's say you want to
do something that there isn't
particularly great support in dotnet
core for right now like image processing
or audio processing there aren't
particularly great libraries for that
under donate call right now but there's
tons of stuff on NPM so wouldn't we call
if you could just use that from your asp
net project as just as easily as if it
was a no library well not quite as
easily but not far off so let me show
you an example let's say we want to do
some dynamic runtime image resizing on
the server so I'm going to kill this
react application here and I'm going to
switch over into empty asp net course i
now this is not a single page
application this is just a standard file
new asp net application the sort of
thing that comes out of Visual Studio
today and I'm going to get that running
so let's start that up and we'll see
what that looks like
and what sort of functionality we want
to put into that so let's go to the home
page for that and you'll see that it
looks like any other SP net file new
project thing the only thing about it
I've changed is here on the about page
you see that we've got a directive
that's come down from the marketing
department that says we need an image of
a parrot right here okay
important business requirements so let's
see if we can put our parrot image in
right there so we'll find the MVC view
that is rendering that will go into
views home about here and you'll see
this as where the mark-up is and this is
where we need to make the image appear
okay now just to save us a bit of time
I've already got hold of an image of a
parrot right here it is in lovely this
is what we want to have showing up in
the page so a very simple and obvious
way of doing that would be to have a
plain old image tag okay so we can just
drop our image tag in there let's see if
that works
shall we will that work well I'll hit
reload and well it it sort of works but
is probably not what they really wanted
okay obviously it's the wrong size and
we could resize it on the client if we
wanted we could say width equals
whatever but that's not a very smart
move because we're still sending this
massive image down to the client and if
we look at the size of that image let's
find out it is two and a half megabytes
there so that's not what we really want
that we want to resize it
now you could resize it and a sort of
one-time basis manually in Photoshop but
don't do that that's not cool why is
cool is doing it at runtime on the
server so let's do that
obviously the real reason is because you
want to do it two different sizes at
runtime and other things that justify
your job okay right so instead of doing
just having a a pointer directly to the
file on disk I'm going to change that
now so that it refers to this other URL
I've just pre fixed it with resize and
I've put a query string parameter width
equals 300 now how are we going to make
our application respond to this URL with
a resized image well one way that we
could do that is we could set up a
controller and we could put some logic
in there so I've created this images
controller and there's no logic in there
just yet
but let's start putting some in shall we
okay
so here's a starting point let's just
walk through this slowly this because
there's quite a bit of code in here the
first thing says this action is going to
respond to any request that starts with
resize slash and then the rest of the
URL is considered to be a variable
called image path okay and it's going to
run asynchronously and it's going to
receive this image path as a string it's
also going to receive the width as an
int that's going to come from the query
string and we're also going to ask the
dependency injection system to give us
an instance of I hosting environment so
what's that well the use of it in this
case is that it gives us the ability to
read files out of the dub-dub-dub
root directory in a nice safe fast way
where we don't have to worry about
directory traversal bugs or anything
like that
so we can very quickly say okay is there
a file under the dub-dub-dub root
directory that matches this image path
if not we'll just return a 404 not found
but if there is well we return this
message we don't really want to return a
message but we're just building this up
incrementally so let's hit save on that
and I'll go back over here and we'll see
what effect this has so if I reload now
our image tag will be pointing to that
action method which returns a string so
it's not going to work obviously because
the browser wants us to return an image
but we've actually returned a string so
we get in this broken image instead but
that's okay because we're just building
this up let's see what the actual
response from the server was so I'll
open this into a new tab and you'll see
that it did hit the code that we just
wrote and it has indeed match the
request to a particular file on disk and
it's correctly parsed of the width out
of the URL okay so that's good now we
can put in some logic that actually does
some resizing and like I've been saying
we'll do this using node services so
that we can use the node image resizing
libraries and the way we can do that is
like this we'll say okay dependency
injection system please give me an
instance of inode services and what does
that let us do well let's get some
intellisense so then we'll be able to
find out shall we so I'm just switching
over to the empty asp net thing and when
the intellisense starts we'll be able to
say node services what have you got for
us okay you've got various things the
important one in this case is invoke
async and that allows us to run some
code inside nodejs for example we might
have some code like this we'll say okay
node services i want to invoke a
JavaScript module called image resize
ojs and we can pass an arbitrary set of
parameters to it in this case we'll pass
the physical path of the file we want to
resize and the width that we want to
resize it to and we'll get back a string
and we'll just return that string to the
browser okay so if that's going to work
I better actually create this file image
resizer yes so I'll do a new file image
resizer yes and I can start putting some
node.js code in here right now that
we're going to invoke and so a simple
sort of hello world example would be
like this well export a function which
creates a message just a hello world
style message that includes the current
date and we'll send that back to asp net
we can do that a synchronously so we've
got a callback we'll say there's no
errors we're just going to give you back
this message and SP note will then pass
that through to the browser so if this
all works when I come back here and hit
reload instead of getting the message
from dotnet code we're now going to see
this message that comes back from our
node code okay and every time I hit
reload it's going to you know produce a
different time because the asp net is
making this code very fast very quickly
and to note we're getting the message
back and we're sending that on to the
browser so now we can put in any
JavaScript logic we like and because
this is actually node we can make use of
anything from the whole NPM ecosystem in
the middle of our application for
example we could use this npm module
called sharp sharp is a very popular
fast and robust image map ulation
library and I can make use of that to do
actual resizing for example I can say
all right then sharp I want you to read
this image from this physical path I
want you to resize it to this particular
max width and then you I want you to not
save that on disk but just pipe the
resulting binary data back as a stream
to the result okay and then back in
dotnet world we can say it's not given
as a string anymore it's now giving us a
binary stream so that will arrive as a
standard net binary stream and we can
return that to the browser so we'll say
we turn file and we can give it this
result stream
and we need to give it a mime type as
well image/jpeg you could infer that
dynamically from the file name or
something but this is fine for this demo
so I'll hit save on that and let's see
if this actually works and we get back
an image in the browser now so I'll hit
reload and indeed we do so we get our
300 pixel wide image we could change it
to other sizes and it's going to work
out correctly and then back over here on
the about page I hit reload and
hopefully we will indeed see our actual
parrot roughly the right size and let's
check that it really is a lot smaller
now so I'll come over here and I'll hit
reload and we'll see that the image has
gone down to 10 kilobytes now it's quite
a lot more reasonable okay
so that is giving you a lot of
additional possibilities as a developer
to use node code in the middle of your
application not just for image resizing
but for obviously anything else that it
does last thing I'm going to show you in
this talk is a new feature that I just
put into these libraries last week and
that is the ability to debug your
server-side node code which is written
in typescript or JavaScript or whatever
in just the same way that you debug it
when it's running on the client this is
really useful because sometimes you
might have something in your application
that only works properly on the client
and seems to fail for some reason when
it works on the server and you'll be
thinking how on earth am I going to
track that down like how do I debug this
stuff you know how I'm sure you were all
very familiar with how to debug
client-side code using your browser's
debug tools and you'll all be familiar
with how to debug your server-side code
in c-sharp with visual studio or vs code
or whatever else you like but it's
certainly not obvious about how you go
in to debug your JavaScript or type
scripts code when it's running on the
server so that's a feature that we just
put in last week and you can do it like
this so you go to the place where node
services is registered with your
dependency injection container and if it
isn't registered then you can add it in
to the config like this and pass it this
flag launched with debugging true it's
all you have to do so now I've done that
when my application comes back up which
is now if I rerun this we should see
that amongst the plethora of other
useful messages we get this nodejs
debugging is enabled to debug run node
inspector you need to install if you
haven't already
now I have installed it already so in
some other command line window I can run
node inspector and it will say all right
I'm working you can visit this URL in
some browser window and start debugging
your server-side code so let's put that
URL into my browser and what you'll see
comes up is something that looks exactly
like the normal client-side debugging
tools but now it's showing you the
server-side code so this list of stuff
over here
is all the code that's on the server you
can see all my node modules there and
importantly you can see this image
resizer JS file which we've just read
and I wrote it in JavaScript so you're
seeing it in JavaScript if I'd written
in typescript you would be seeing it in
typescript here because it correctly
passes through all the source maps so
you can see the original language you
can set breakpoints on it and debug it
in the normal way so I'll set a
breakpoint right there and when I hit
reload you'll see debugger paused where
we're debugging now and I've got my
breakpoint here I can hover over and see
the variables and so on and you can do
all the other stuff that you normally do
with your client-side debugging for
example you can even go in and just
start changing the code in memory
without even changing it on disk so
let's say I want to put negate I think
that's the right syntax I hope so I'm
going to press save on that come over
here and hit reload and oh it's hit the
breakpoint again press f8 and now we've
got our psychedelic negated pirate okay
and you can do all the other things that
you do you can do performance profiling
and everything like that so all the
normal debugging and performance related
tools that you're used to work for your
server-side JavaScript just as they do
for client-side as well ok so there we
go that is all I'm going to have time to
talk about in this talk so if you want
to try out any of this code then please
do so please go to this github repo that
I've put up on the screen here this
contains a lot of general useful
information it contains all of the code
that you've seen here it contains all of
the implementation code for all the
libraries that I've been talking about
here the node services JavaScript
angular services spar services whatever
all that stuff is on there the project
templates are all there and there's also
a ton of documentation on how you can
use these libraries
in your application in different ways
and you know how you can get started
with using them so please check that out
and post some issues or some feedback
and tell us what you think about that
and two last things I need to say to you
one is if you've got any questions about
this stuff I would be very happy to
answer them I've been roped into doing
some sort of ask me anything thing
immediately after this session so if you
come down to level 2 after this you can
ask me whatever questions you want about
any of this and the other thing is
please remember to evaluate this session
on the way out you hold the power to
control next year's agenda so express
your opinion about whether you want more
or less of this sort of thing please do
the evals and that is all</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>