<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Docker, FROM scratch - Aaron Powell | Coder Coacher - Coaching Coders</title><meta content="Docker, FROM scratch - Aaron Powell - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Docker, FROM scratch - Aaron Powell</b></h2><h5 class="post__date">2017-09-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/i7yoXqlg48M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you all for coming I don't
recognize any of you nor can I recall
why I'm here now without further ado my
name is Aaron Powell and this is doctor
from scratch there's some contact
details and stuff if you want to find me
afterwards or follow me on Twitter or
anything like that
I'll also be around the ratify booth
just around the corner for most of the
day if you want to come and have a chat
after this talk so obviously this is a
talk about docker where we talk about
docker we talk about a whole bunch of
different things we talk about things
like immutable infrastructure or you
know doing containerized architectures
using micro services and deploying them
into cloud infrastructure using
kubernetes or d cos or swarm we talk
about how we can use docker to make our
development environment almost identical
to our product and production
environment how we you know we build
this stuff and we ship it and nothing
changes as we roll across all the
different environments that we're using
within our application we have no
rollback we always roll forward and all
that kind of stuff this is not a talk
about that part of docker we are not
going to be covering off things like
kubernetes or anything like that this is
a talk about the basics this is a talk
targeted of people that may be doctors
been something that I've wanted to learn
but have just never found the time or
it's something that you've heard about
but you don't even know what it's what
its concepts are how to use it all right
what value it could bring into what
you're building as applications or
anything like that this is a talk where
we're going to start from scratch and
throughout the course their talk will
understand what I mean why and why I'm
putting the emphasis emphasis on from
scratch so there's a bunch of other
docket content that we'll cover off all
the stuff that I showed in the previous
slides there are things about oh you
know doing casted architecture in
production and all that kind of stuff so
kind of this could be a entry point to
you know maybe I want to go and learn
some more about that afterwards
hopefully that's what you take away from
this talk but I said this is a this is
intended to help you get started with
docker and kind of talk about my
experience when I first was getting into
docker and working out where to go from
there so I want to just start with some
useful terminology so that we understand
a bit about what docker is and some of
the
concepts that are going to introduce
over the course of this talk so that we
can understand them in the context of
what we're going to be doing so first
off I just want to clarify docker is not
a virtual machine docker is about
isolation it's it's come from like Linux
in the UNIX world a concept called
chroot which is basically creating user
space isolation with inside of the
kernel so you are almost running
something that is a full-blown Linux
kernel with inside of it but it's still
separate from the other processes are
running it's often thought about almost
like process isolation as well many
technologies that I'm going to use a lot
is the idea of an image an image is your
starting point when building something
from docker an image is used to baseline
a bunch of reproducible output if think
about it from I'm I'm a developer from
oh that's my background I'm not an ops
person so you think of things in
developer context and when I think about
an image from an oo programming
perspective an image is a class
definition from that we then have
containers a container is a running
image it's made from some kind of image
that we started with so it's the
implementation of a class it's an object
created from a class again using an oo
programming analogy there often times
when I when I was first getting started
with docker or when I'm talking to
people about docker they'll often
confuse the the idea of an image in a
container and think that the words you
used interchangeably but they're not
they're very different concepts and
we'll see how that happens and what the
differences are as we start doing some
of the demos shortly and the final bit
of terminology I wanna talk about is the
host the host is the machine that is
running docker I'm running a Windows
laptop I'm gonna be using Linux docker
containers so that kind of works a
little bit differently than if I was
running a native Linux laptop I'm not
going to be talking about Windows
containers I think there's some other
content to it throughout the week if
you're interested in Windows containers
because there's some
fundamental differences between Linux
and windows containers but basically the
crux of it is the host is the machine
that docker is installed on for all
intent and purpose docker is installed
on my Windows machine and I'm gonna be
working with Linux how that works I can
chat to afterwards if you want to
understand some of the nitty-gritty
internals but I won't dive too much into
that so we tend to interact with docker
from a command line this is a standard
command that you might be running with
docker so it's made up of the docker CLI
tool that we work with we then provide
that with a command that we're gonna
execute against docker in this case it's
a run command we have some options that
we pass to run a - high tea flag and a -
- erm and I'll talk about what those do
throughout the demos that we do in a
moment we then have some arguments we
pass to the command this is actually
those two arguments here the first is
the image that we're going to be using
so that's a bun - and then some kind of
an execution their executable to run
with inside of the ubuntu container and
this case is gonna be slash bin slash
bash okay so that's enough time spent in
PowerPoint we're gonna spend pretty much
the rest of the talk at a command line
as I go through live demos and we're
going to cross our fingers and hope that
none of my live demos fail I gave this
talk a couple of days ago and I got
through most of them without any
failures but yeah today's a new day so
let's see how how climb the demo guards
are gonna be to me today I'm going to
start with the canonical hello world
example of docker so I've got that
command whoops I probably should close
my slides so they don't actually can see
my command line yeah okay so I've got a
command here then I'm gonna execute
pretty much similar to the one that we
had with inside of the PowerPoint slides
just a moment ago using docker run
platform in a flag
- IT this flag or this argument I'm
passing to run is to say that I want an
interactive document a nurse started so
this allows me to then connect to a city
in essentially and I can type any
interact with that container as it's
been run then we started with the Ubuntu
image and executing the
- so let's run that so here we go I've
been dropped into what looks like a UNIX
prompt
I can run unix commands such as LS a see
here I've got a file system very UNIX
looking file system and now I'm because
now I am running inside of an abort or
image I can make directory call it
through so I can then create something
that sits at the root of this file
system and folder called foo so forth so
my container is up and running I can do
a whole bunch of stuff with that and I
can see what play around with a Linux
machine running on my Windows box I can
also run a command and I'll just add it
from another another shell called PS
which this lists the containers they're
running on my machine so you can see
I've got a container here it's got a
container ID of 49 F 0 0 a and so on and
so forth it started from a named bun to
image had a command it was created 47
seconds ago it was still up 45 seconds
ago it's got a name of loving Ben's
obviously I've got this zoomed a little
bit so wouldn't normally wrap but for
the sake of readability particular for
the people at back of increase the font
size a touch but it would normally
format it a little bit better so there's
there's my running container I can see
it and find some basic information about
it I can either that container drop back
to my command line to come over here and
occupy us again that containers been
stopped
it's not running anymore because I sent
as I exited the application that the
container was running so it shut down
because it's running just a single
process until it till that process is
told to not run any longer I can still
see that container by running docker PS
- I expand it to double - all so this
lists all containers regardless of their
status on the machine PS just list the
current running images running
containers whereas this is listening all
containers started and stopped so you
can see here I have one I was 18 19
seconds ago now I could say docker and
if I wanted to do something with that
container let's say I want to restart it
I can do talk
start and then I need to provide it some
kind of unique identifier for that
container that I want to start in this
case I want to start container ID for 9f
etc etc but because I only have to
provide enough uniqueness the doctor can
work out the rest for me I can give it
just for you give it for nine I tend to
just use two characters because that
tends to be as much uniqueness as you
necessarily need I can use the name
loving bins if I wanted to as well so I
can start that docker PS and we can see
there was up one second ago I can then
attach to it and I'm back on there LS
and we say that file system that we saw
before you can say that the through
folder is still there and all that kind
of stuff if I was to do docker
stop 49 I can then send a stop command
to that running container which can be
coming back over to this terminal say
that containers exited I'm back at my
power shell prompt instead of being my
my bash prompt that I was before so
what's that essentially has done is it
send it sent an exit signal across to
the running container which is then told
the process that's running in that
container to exit and it will gracefully
shut down the final thing I'm just going
to remove that container so docker RM do
some cleanup remove 49 now if I do
docker PS I have nothing left in my
container list either running or stopped
okay so that's a kinetic canonical hello
world example let's go to else alright
so this is where we start saying the
difference between an image in a
container because the image is our
starting point I can make multiple
containers based off of the same image
and that's what i'm doing here i'm
creating three different or Bunter
containers but they're all based off of
the same of one two image i've added a
couple additional flags - t which starts
this container in a detached mode so
while it is still - - I T so it's still
interactive its detached which means
that my terminal is not immediately
connected to it I have to use docker
attached to then attach that current
that container later on passing in a - -
erm flag which essentially means that
when this container stops remove
yourself this is really useful when
you're doing prototyping or demos like
this and stuff like that now I want to
start up a bunch of containers but I
don't want them sitting around like that
that's space on disk that I don't need
particularly I was just testing
something out or prototype typing
something I just wanted to - go away
when I'm done I'm also doing - - name
which is giving this a I'm specifying
the name so instead of getting a
uniquely generated name like loving
underscore Benz I'm saying that these a
named Ubuntu one through three so let's
run that so starting up the multiple
containers and you'll see that it's
output the IDS of each of those
containers have been run and now I can
go over and attach them so I'm just
gonna open up a couple more PowerShell
terminals just resize them a touch okay
so if we do docker attach one to one
docker attach one to two and then I bet
you can guess what I'm attaching to here
I can type correctly okay whoops he'd
entered properly on all of them okay
cool now I'm inside of all three of
these
let's take number one and just make
directory of through it the route we
tell us on that one and then say go to
number two well there you go they
started with the same looking filesystem
there because they're all isolated this
they don't know about each other they
can't talk to each other they they don't
share a file system anything I do on the
file system of one container is not
available to the filesystem of another
container so obviously added a folder to
one but it's not available anywhere else
so I I have that isolation of process so
this batch process is isolated per
container if I was to say docker stop
one to two will stop that one and my
middle PowerShell terminal has dropped
back to just the power shell prompt and
if we do process list all you'll see
that I only have a bunch of one and
three running because the because it had
the - - iron flag it cleaned itself up
when it stopped
cool and let's just take the others I
don't need them open for any longer
we've killed everything that we needed
all right so let's just clean everything
up a little bit focus comes in and let's
go to our next demo all right so I said
that the file system is isolated so I
can't I don't know what happens in a bun
to one in a bun to two I don't have any
way to interact between them but what if
I did want to have something that's
shared between them the these are
transient so far that if I killed them I
removed them I don't have any of the
files that was created within them I've
got no way to get those files back out
and this is where I want to introduce
the concept of Dokka volumes now you see
a new argument that I've included here -
V - V is short for - volume and what
that does is it creates a map point
between the host that the container has
been run from and the container itself
so it takes an argument that got two
parts to it one which is the directory
of the local container the directory on
the host that you want to mount and then
what is the folder on the container that
you want to mount that to so because I'm
running this in a batch file I'm
mounting the current working directory
percent eighty percent and I'm gonna
mount that to a directory called slash
files now this one also introduces
something that I tend to use docker for
and that is like executing a single
process that I maybe don't want to have
on my actual machine I treat my laptop
is a very transient device if it dies I
will take it to the Microsoft Store and
go it's dead and hopefully they'll give
me a new one it doesn't necessarily work
that way but that's the least the hope
so I don't tend to install a whole lot
of software on my machine I'll have some
core tools that I use day-to-day but you
know I had a scenario the other month
where I was doing a technical interview
at ratify and someone had sent me a raw
file of a coding exercise that we get
candidates knew it's a raw file I was
like I checked my watch we're still 2017
I hadn't gone back to 2005 and had not
paid for a winner I stand still
as an i-5 informant I don't remember the
last time I used rare in the wild I had
a similar incidence with 7-zip so like
that one was even more obscure okay so I
don't have anything on my machine that
can unwrap well okay so what's what
would someone normally do they'd go and
download 17 but not me I I'm going to
use this once so I'm gonna find a darker
image that does it I don't actually I
don't need 7-zip long term I just I want
to be able to run a process term eight
and it's gone away and I don't need it
anymore so I found a doctor image out
there max see in something-something
slash Unruh so this uses the UNIX unrack
command and amount a volume of my
machine and then I told to Unruh that
particular file so let's just run that
so this is not the code that the
candidates send me I was not going to
show you that from a privacy standpoint
I did not want to share that and they
say this is something I found in my
inbox from there's a raw file or
something from codeplex from 2010 I
think there it's some really old code
okay cool oh hey I'm need to need to
delete it from when I ran the demo
earlier today and just made sure
everything still worked okay so let's
just try again so here we go it's unring
a whole bunch of you know donate code
dropping that to disk and then I have
here a trunk folder which is then the
contents of that rar file and you'll
have to obviously trust me that that's
the contents of that raw file but you
can see the output window did that
oh there we go that that's how you can
use docker for just like a single run
process you know something you just want
to prototype with or some of you want to
play around with you don't have to go
through the whole effort of installing
three versions of Java because you want
to test across three different Java
runtimes you can just pull down a docker
container of each of the different
versions and test an application against
those so speaking of Java let's go onto
our next demo
so this is not Java this is node there's
that many versions of node and at every
other week there there's either a
preview build or there's a new long-term
service build that's out or something
like that so if you're building
something on node and maybe you're
building like a registry or packaging
something you're publishing an open
source how do you effectively make sure
that that works across quite a large
variety of node versions well the
easiest way is pulled down a docker
image that has all the different
versions that you want to test with
making container from that run your test
inside of it see if it passes there we
go
rather than you know having to install
some like nvm and manage multiple local
installs of nodes and stuff like that
what is Lee use a docker image for that
so run this startup and we have
console.log hello in DC so I'm inside of
the nodejs repple because that's where
I've been dropped by running this this
command you'll notice that I didn't have
a argument past the node colon version
number because I just want to execute
whatever the default command that that
image would run when the container is
created from that in this case it's just
going to execute node XE well sorry it's
not going to execute no taxi is going to
just execute node exits unix so I end up
inside of the node ripple so I can do
like Const FS and then pull in my node
modules if I hey there's another demo
file excellent and then do like FS read
directory of slash and then errors paths
pause so if we just log all that out we
realized that I've fat-fingered
something else and yeah I call the
variable path it and then I called pars
where and output it so but there we go
so that's the inside of then a document
a no so I can use no to inspect that and
you see there it's still a UNIX
filesystem at the at the end of the day
I can see all the same stuff there so I
can traverse it
good food interacting with a particular
single process and this is obviously a
single process that's running with
inside of my container I don't have kind
of the ability to do anything else with
it cool so let's jump out of that clear
it off and we'll go on to number five
okay so this time I'll do something I
want to actually run an application with
inside of node with inside of a
container so I've got a application here
I'm not going to go into the details
about how this node app works I don't
want this to become a node talk I
appreciate that this is probably a
fairly complex node application so I
don't want to I don't want to dwell on
how node works or anything like that but
the crux of it is it's gonna be a web
server so just just trust me that that's
a web server in note so I'm gonna start
up a server I'm gonna bind that to port
3000 and then I want to be able to
obviously get a response from that okay
so we'll run oh sorry I'll just go back
so we're using volume mounting again
you'll see we're mounting the source
into a slash SRC directory
I'm also then running another command
another argument - W which sets the
working directory for the process that's
being executed - slash SRC so the where
I've mounted to the got the image then
and then I'm saying you're gonna execute
instead of just dropping you at the node
ripple I want to execute a particular
node a particular file using the node.js
application so we may execute node and
app J s now if I didn't do so it knows
where that file is because of the / - W
flag if I didn't do that I could do like
slash a slash
app dot jeaious and it would do the
exactly the same thing okay cool so
we'll start that up run that in the
catch mode so the server is up and
running and I can dock a PS see that
yeah cool there we go it's up and
running all right so let's go curl local
host local host 3000
wah-wah-wah we've got an error
it hasn't been able to resolve or you
couldn't connect to the server well but
hang on a sec is it like I didn't fat
figure that right I said it was port
3000 if we go back to abjure yes yep
supposed to listen on port 3000 okay
maybe there's something in the logs so
docker logs node service up and running
if I tell it to follow the logs whether
it's the way the process is definitely
running because it's still trying to
write logs out okay well let's just go
curl again localhost 3000 well then to
crash the process like there's nothing
in my logs that says it's crashed well
what's gone wrong I know what's gone
wrong because I wrote these demos right
so what's happened is the process is
running is listening on that port but I
haven't told it to actually map inbound
connections to that port so let's have a
look at the information about this
container so I can use node inspect and
then provide it with an ID for container
so I've inspected the node container
that we've got running and there is a
network section here and here in lies
the problem the container itself has not
got any ports mapped to it the container
itself is running the container the
application inside of the container is
listening on that port but the container
doesn't have any ports bound to its host
okay cool so we'll just stop the node
container we'll come back over here
that'll leaves in a moment so this is so
this is where stop is useful because
it's sending a because it's sending the
shutdown command to that process it's
not doing like a hard stop it's not just
doing like a kill -
- f or anything on that it's sending the
proper Singh tone processes the commands
across to the process so we'll shut down
gracefully so if you do have an
application running it will then do all
the proper cleanup you know if it's got
a release database connections and stuff
like that it can do all that clean up
nicely before it shuts down it's not
just you've pulled the power from me
okay so let's go to step 6
okay and we'll come back to our run and
now we have a - P flag so that P is that
we're going to do port binding so - P is
port you can have as many - peas as you
want with inside of it and you so you
combine multiple ports to a container so
the process can with some listen on
multiple ports this could be useful if
you're running something like RabbitMQ
is a good example of this it has the
management port and it has the the Q
listening port so you could bind two
ports on that and the the port bindings
kind of similar to the way that we do
volume mounting is something on the host
:
something on the container so in this
case I can map whatever port I want on
my host to port 3000 on the container
and illustrate this I'm at port 8080 on
my host through to port 3000 on the
container so run that again and we pop
that up it's clear and if we curl local
local host I mean you think I'd be
better at writing local host by now like
how many years I've been writing that
out so if I now call on 8080 excellent
there we go we've got our hello world
back as we expected 3000 will still send
back that error that we again that we
would expect because we're not binding
anything to port 3000 on my host it's
not being able to do any any
redirections across to a container so if
we were back as a docker inspect node so
just go back and have a look at what our
network settings now look like you see
the ports is the array of ports has been
flushed out of it we have port 3000 on
TCP so you can map both UDP and TCP
ports into a docker container obviously
I'm only doing TCP in this case
what I pay on the host so if you've got
like multiple Knicks with inside of the
host that you're running doctor on you
can map incoming requests on one
particular nick across to a particular
container if so desired and we're so
that's what the host IP is all about and
then the host port is what port on my
machine so yeah I said you can map
whatever port you want
locally across to whatever port you want
on your server so you can have
everything listening on port 80 with
inside of docking containers but on
local dev or in inside of your
production system before your reverse
proxy they're all running on like random
ports and stuff like that now when you
do port binding you don't have to do the
the host port colon syntax you can just
do I want to buy and like port 3000 well
do is a randomly choose a port on your
machine and then you're gonna have to go
into dock inspect and find out what that
port is and stuff like that just a bit
annoying also we can do docker PS and
we'll see the port information across on
the far right-hand side of that
left-hand side of that right
wait it's back with me anyway you get my
point and we can also say they're all
the different ports so we've got bad
okay so let's just stop know it again
and we're gonna jump over to our next
demo right so I've command that we're
getting was it was starting to get a
little bit big to Rio node application
no we we had to volume out we had to
specify ports we said working
directories a whole bunch of stuff we're
having to set and if I want to get a
colleague on my team to just hey check
out this light little no doubt that I've
written it just it's really useful just
parsing out you're downloading all your
pay slips from your I mean when you're
transitioning between payroll systems
which is something we're actually doing
it right at the moment to having to send
around this like massive command-line
arguments said there you go
somebody's gonna fat-fingered that at
some point and it's like and then I get
the calls like hey you command doesn't
work so I'll okay so how do we make that
a bit more reproducible
well we can start building our own
images to do that and this is where I
want to introduce another file
called dockerfile so a docker file is an
instruction set it's a DSL of how to
create an image in docker and it's there
we then use that to basically execute a
bunch of commands that we can then
create images we can then run it as a
container later on so we always start
with a from command inside of our docker
file because our docker image that we're
creating has to start from something
else I think that the title from scratch
that's what the that was the joke yeah
so in this one this image I'm doing from
node seven seven for particular build of
that I'm saying that this image exposes
port 3000 so that's just telling people
that are going to be starting this is a
container later on that they know that
they're going to need to do some port
mapping should they so desire they can
not do port mapping it's just not gonna
be a very useful application I'm gonna
run a command on that image which is
going to make a directory called slash
SRC and instead of doing volume mounting
so the person doesn't have to volume out
that on their machine and I don't have
to ship them the app.js file I'm
actually going to execute the copy
command which will then copy the file
from my machine into the image it's
copying it into the slash SRC folder and
insert the working directory of slash
SRC and then CMD excuse me is the
command that the container will execute
when it starts up so it's going to
execute node app J s now this time
instead of just by I can't just use
docker run because I'm trying to create
an image here right and docker run is
all about running containers from an
image so to do that first I need to
build an image from my docker file so
this is where we use the docker build
command docker build dash T so I'm gonna
tag that image with something that I can
understand rather than just dealing with
the the massive image ID that I would
normally get that I would get generated
I'm gonna tag this as by no js' app
that's until where to find the docker
file so just saying dot current
directory if I so by convention it will
look for a file named docker file you
can change that in file name to whatever
you want but then you have to specify
another argument that is the name of the
docker file with inside of a working
with inside of a particular directory by
convention docker file is just that is
what people wouldn't be using so online
five would build an image and then on
line seven we're going to do docker run
immediately remove on shutdown we do our
port binding detach and then the nodejs
application so we're going to start that
image has a container I'm not going to
send any commands after that because I
would just want it to execute its
default come in so we run that so the
first thing it's doing the build and
you'll see that it's going through each
step that I've got in that docker file
from a particular base container it'll
pull that down if I don't already have
it
I will actually expose so that that's
put in there so on and so forth and now
I have a built in the end of the day
which I can then start as a container
which I have done and that's 8 6e etc so
I can go back and execute my curl on
localhost any there we go now I can do
docker images and I can list out all the
images that I've got on my machine so
you see there on the top I've got a new
one called nodejs - app was created 33
seconds ago it has a size of 59
megabytes
because that's basically through the
side of the size of an odious image that
I'm using here and I've added a couple
of K over the top of that or maybe want
to K over the top of that obviously I've
got a whole bunch of other images or on
my machine so now I can just do docker
stop node that will stop that container
oh wait no I didn't give it a name I was
I will stop that one shut it down and
then I can remove that image if I don't
want it on my machine anymore SEC
terminate process if we do docker RM I
so we used RM to remove the container RM
I to remove an image and this will be no
js' app and we've deleted a whole bunch
of the stuff that was inside of on disk
for me so I freed up a bit of disk space
oh don't that's how we can create
something that we can ship as a reusable
and that's where you can stop saying
how you would build applications and you
start sharing an application that's a
containerized architecture around it
starts from this docker file is where we
really start with alright so on to a
next demo alright we still had a couple
command-line arguments we had to execute
there though we still had to say that we
you know we wanted to do some port
bindings and so on and so forth
there's another way that we can start up
a docker container and that is with
docker compose docking opposed is really
useful about how we can start describing
an environment that we want to run using
using docker so this by convention uses
a file called docker - compose dot llamo
or dot yml you uses the Yamal syntax to
create that so I've got a very basic
docker compose file here it's got two
components to it it's got services and
it's got networks
services are the containers that you're
gonna start with inside of your docker
file and then networks are how we can do
some isolation I'm not gonna dive too
much in networks right now cuz we're
gonna see networks a bit later on so
here we can predefined a bunch of stuff
though I can predefined my port binding
so I can say the port 8080 is going to
bind on to port 3000 I can specify the
when it's built it's going to build and
a particular doctor file that's gonna be
built from and this if I had multiple
applications I could start writing out
multiple services with the inside of
here now this time we're gonna use a
different command line tool docker -
compose composes it's essentially a
separate product with inside of the
docker family so we we have doc you
compose instead of docker space compose
it's not a command on the docker CLI so
on line 5 I'm using docking paws
specifying the file that I want to use
is by compose file current working
directory dr. Campos Gamal and I'm gonna
say stand up that environment but in
particular I want to stand up the node
service with inside of that compose file
so I've had multiple services I could
stand all of them up by just doing doc
opposed up if I wanted to stand up one I
do doc and compose and in the specific
service name what I'm doing here line
seven is once that process is exited
want to do a doctor can pose cleanup so
document pose are in and I'm just doing
a force RM kill everything with fire so
that's how you would stand up and then
clean up with using docker compose oops
so if we run now you'll see it's doing a
few different things it's creating
creates a network it's creating that
image again because I deleted that image
in the last step of the last demo so
it's got to create that image from
scratch ah
and then it's started that container
from that image we see right at the
bottom node underscore one which is the
name that has been assigned it's up and
running and then if we can do we do our
curl but I won't do that demo again
because we've seen it all run before but
you can see yeah there we go you notice
that the the name was both the image and
the running container have prefix on
them and that's the current working
directory though so doctor from scratch
is my current folder so that's that's
house on that you could use it a compose
file you can control the name and we'll
see that shortly
so it's to exit the nodejs process it's
going to shut down give it a second
while that process is exiting stop there
we go oops clear and then that's done
all that to clean up again alright onto
more demos alright so like I said I tend
not to install software on my machine if
I can help it and as a.net developer so
it does a lot of asp net web dev there's
one thing that you kinda can't get away
with not installing and its sequel
server until docker so I don't actually
have a single server installed on my
machine instead I use sequel server
inside of a dr. container and that's
using the Linux implementation of
Microsoft sequel server from from
Microsoft and I can quite easily start
that up I'm gonna use a compose file
again to do this
just because it simplifies some stuff so
binding Paulette support 1433 which is
the standard sequel server port I'm
creating a new network that are going to
shove all that stuff in there
the image is Microsoft slash mssql Linux
server Linux and then I have to provide
some other stuff I know this is signal
server you've got to accept a license
agreement I'm probably gonna want an sa
password on that so I can connect to it
and be able to interact with that so we
use environment variables here and
that's what that new section in the
compost pile is for we have an
environment section and there's your
environment variables that are going to
be inside of that container so inside of
that container if I was to echo em I
would say except underscore EULA a is y
and we would see my super strong sa
password so we were to run that so this
time using docker compose I'm actually
not building a new image I'm just
running the the baseline sequel server
image there we go it's it's crashed for
some lovely reason that is deep with
inside of sequel server awesome you can
trust me that that would normally work
so what I'm not doing here is I'm not
doing any kind of volume mounting or
anything like that if you if you are
running a database be a sequel server or
Mongo or any kind of anything with
persistent storage you probably gonna
want to volume out so that as the
container is shut down you don't lose
all the data that's in your database or
your you Redis case or whatever it might
be cool I'm not gonna try and debug why
that's failed I've got plenty of other
demos that we can get onto anyway and
hope that none of them also suffer the
same fate because most of them require
sequel server ok ok cool so I'm now I
want to talk about how we can use the
composed to actually start representing
our environment that's what I said that
is is one of the useful aspects of the
compose file is that you can represent
how your whole application in
architecture would look so to do this
I'm just going to stand up I've got a
and asp net core application the runs
inside of the docker container and i
want to this asp net application i
wanted to then talk to a sequel server
but because I don't have sequel server
installed I'm gonna rely on on this and
I just realized I forgot to increase my
font size in every increase in
everything but Visual Studio so Visual
Studio actually has pretty decent
support for docker it does have some
rough edges that I've hit a couple of
times doing these demos and fingers
crossed that I won't get hit by them
right now if they do I'm gonna have to
quickly try and make them work and we'll
just do a little song and dance and
everyone don't watch as things fail but
I've now got two services with inside of
this compose file over the demo app
which is my asp net core application
it's got a docker file that it starts
basis itself off which tells it to use
the a spinet called 1:1 docker image
stuff like that we're going to stand
that up and it's gonna be up and running
and then signal server is also going to
be stood up basically all the same
information that we had previously and
what I'm actually going to be doing is
I'm gonna be putting them on I've got
multiple networks defined so that's the
other thing that I've got in here you
see at the bottom I've got two networks
one web one called web and one called DB
because what I'm starting to do is I'm
finding my architecture that maybe my
sequel server that's not going to be
publicly accessible it's going to be on
a network that's firewall blocked ie you
can't access that from the public
Internet so I'm putting this into a
separate network to the web server but
the web server still needs to be able to
talk to the sequel server so they're
also going to share a network and we'll
see how we can do some fun stuff with
network isolation as we sort of explore
these demos but and I start off by
hitting f5 and watching to see whether
or not visual shio is just going to do
an operation error which is what it has
been doing a couple of times on me
through these demos ok so it's basically
going through this compose file it's
executing a bunch of stuff creating a
couple of images it then has a compile
error which I've not hit
and this is where I started crying a
little to myself no it's actually got a
bunch of stuff hanging around from
earlier on just make sure I have so I
have something up and running I'm just
gonna kill if you don't care about
sending a nice a zip code you could kill
- F sorry I can not kill doctor RM - F
it's like I just want this container to
go away BAM
that'll kill that it that doesn't send a
nice shut down to the process that's
running it's just like bam you're dead
and that's then gonna hopefully and then
RM means it's gonna clean itself up I
just need to clean up some networks
I think yep prune yep let's get rid of
all the networks that I don't actually
need and now hopefully I'll be able to
check what I've got in my images I'm
just gonna remove the demo demo app
image as well so that - I can possibly
remove an image so if I try and remove
an image that the container is running
on it'll stop me if I - F it's just
killed I just like get rid of everything
so that gets rid of that and PSA so I
now actually have to actually have to
kill these images doctor RM - f of 31:55
b and 16 and that is how we kill with
fire anything that's running in dhaka
just pierce make sure everything's gone
images network
alright cool we are hopefully back to
being in a position where I can hit f5
and not have this video complained of me
one of the fun things about doing live
demos is that if you do actually want to
practice you've got to make sure that
you really clean up after yourself of
excellent operation failed in Visual
Studio so this is where we do the song
and dance as my demo is just completely
fall apart I just have to go back
reacts acute all those RMS again around
f5 and thirteen images demo and network
rune prune yes
alrighty we are going to relaunch Visual
Studio the visual shoot docker tooling
it seems that I and this I'm just gonna
like totally my words in about two
minutes time but it seems that if it if
it if you've got visual she running
you've tried to execute cute a bunch of
stuff in docker they have failed it then
sort of hangs around inside a visual
Shiro and you can't refill it which is
really kind of frustrating so you have
to kind of close Visual Studio kill
everything open visual studio cross your
fingers
hit f5 again cry to yourself when it
doesn't work and go thank you for coming
see me outside and I might try and get
it working it at another point yeah I
actually hit that operation exception
earlier today so I'm getting quite good
at recovering from that point as you can
see by the fact they've been able to
just talk through a pretty spectacular
demo failure and visual studio era and a
bunch of stuff like that
alright cool so a web application is up
and running I can have a sequel server
that is also up and running and I can
prove it this time because I have leg
pad here I'm connecting connecting to
localhost for teen or 1433 there is
currently no databases in there other
than the standard sequel server
databases and let's register with inside
of our application demo user this is
where I try and remember what the
password policy that I have on this
application is because I did like ten
attempts to log to register the other
day ah sweet there we go
okay cool so this is talk to the sequel
server the sequel server is gone well
you don't actually have the database
ready that's cool I mean your first
migrations just going to run those give
it a couple moment
so this is the the webserver is talking
to that it's going to run the it's gonna
set up the identity database with the
inside of that because I'm just using
local identity I'm not using anything
there I can refresh the page actually no
when we login instead I'll come back
here that we have created a database
Doc's from scratch inside of a single
server that's running on docker using
here first code migrations from a web
server that's running in docker as well
so this is a this is now starting to
look like what we might want to use as a
production architecture and you're
probably not going to want to use the
sequel where the defaults a spinet core
application in production but you get
the idea I could then go through the
registration process create myself an
account password there we go
register there we go I'm now logged in
as a user now if I was to stop
everything and then start it all back up
that database would still have the data
within side of it so I could then really
login because it's still that same
container is just being shut down and
restarted if I was to remove that
container and then launch the
application again I wouldn't be able to
log in because I would have killed all
that data and this is where volume
outing is useful so you'd mount all the
the directories that sequel server
writes it's um there's actual data base
files - you've mount that as a volume
and then you would basically persist
that across machines or whatnot cool um
the the other thing that if we just do
docker PS that we'll notice is that it's
been given this now the sequel server a
particulars be given this name of demo
app underscore sequel so that's given
some conventions based off of the the
context where that can the compose file
was executed that could be a little bit
annoying for how we want to connect to
that database like what's it actually
named if we want to connect to it well
this is where networks could become
really useful so you see here and
Network section of the sequel database
I've said that the database that's here
the container name is going to be demo
app underscore sequel because I've
specified that but the alias of that
container inside of that network is
called sequel so that when I look at my
app settings and I look at the database
connection string here
I'm just saying sequel 1433 so I don't
really care what the name of that
container that's been started is I don't
even have to specify name I can just
call it lovely Benz if you want to call
it lovely Benz doctor when you first
launch it but the a list that's gonna
have on the network is gonna be sequel
so this is kind of like if you're doing
a hostname hack inside of Windows cool
okay so I'm just gonna kill everything
doctor stop docker REM kill with fire
six a five eight eight and then we're
gonna docker I of demo app dev and
network prune clean up all the networks
that were generated and now I'm going to
check out another demo so like I said
that part of what we hopefully wanted to
do is we want to use networks to start
to say we're gonna you things and maybe
represent something that's behind a
firewall that can't be externally
accessed well I mean I don't want my
signal server publicly accessible I
might have a super strong say password
like this but someone might work it out
so now in the compose file I've actually
removed any port bindings so this sequel
server is not popped out but it still is
exposing a port it's still listening for
connections on that port and it's
listening for them inside of the dock
and network so this is why my demo
application my web application resides
in its web network publicly accessible
and the DB network which is internally
accessible and only things that can
access the database are on that network
so I'll launch this again we'll wait for
visual sugar to crash and then I'll just
cry a little and we'll clean up
everything but we give it a moment
there's still like a whole bunch of
steps in compose before it falls over
hey what expects time okay so so this
will start up and I'm not particularly
interested in the web but that'll open
up again anyway all right so
everything's up and running stop back
the LeapPad
fire was to refresh my sequel server
connection this will ultimately timeout
because I didn't do port binding as we
saw in our no two examples earlier it
won't connect but I can still come here
can it register if we settle the stuff
in here appropriately oops
it'll still talk to the sequel server I
can still say apply migrations so the
website can still talk to the sequel
server but you can't it might be running
on your machine but you do not have
access to it that is unless you go say
docker Network LS so just wanted to find
out the names of the networks okay so
let's create an image oh sorry let's
create create a container and we're
going to join this network that's in use
so docker ran remove - Network so I'm
going to jump onto that network and then
just use the Ubuntu and we'll jump into
bash okay so if I was to go oh actually
not that one
so I said the default Ubuntu image
doesn't have pinging installed that can
be a little bit of a nuisance
so I created one called ping okay so if
I was to go ping SQL can't do anything
if I was to go doc own network sorry
let's just grab that Network again oh so
this time I want to jump on to the
database network docker run
I am network is gonna be that Aaron ping
bin - okay so now if I go ping sequel
there's our sequel server so network
isolation basically means that anything
on that network can talk to anything
else that's on that network but it can't
talk to things that aren't there
so here because I'm on the seat and the
databases network I can talk to it so I
could if I had like this the
command-line utility sink or server I
could be using that to talk to sequel
server but I don't have it and whereas
this one here it doesn't know about the
sequel a sequel host it can't access it
so and that is how we can use network
isolation from compose files two
separate types of our architecture out
all right so I have one more demo that
I'm just gonna let's close visual studio
because I don't need visual Shiro than
that so I said that the the title of
this talk was docker from scratch it's
one I talked a bit about scratch itself
so scratch is kind of a special concept
with inside of docker
everything has to start from a base
image but the most basic base image that
you start from with docker is called
scratch so I created a container or
sorry credit in egde that then you turn
into a run into containers from scratch
the thing is that scratch is really
bare-bones like it is about running a
single process it doesn't give you
anything it doesn't have anything inside
of it it doesn't even have been SH the
most primitive shell in UNIX doesn't
have that doesn't have bash nothing but
if you've got a process that you want to
execute you want to do it's super
lightweight you can do that with with
with scratch so the only way that you
can use scratch I can't do docker run
and specify scratches an image name
because it's technically not an image
name but I can create a docker file this
is from scratch tie back to the title
this case what I'm actually doing is I'm
using docker to run a go application I
was trying to think what was the most
simple application that I could run
inside of it will compile down to a
native process and that was go I know
not
about running go so I copied the hello
world demo so I'm gonna run I have yeah
I love a little go application whoops
somewhere have app go it is really
awesome anyone that knows how to write
go will know that that's really awesome
I'm gonna use talk and run so I'm
actually gonna run a container on line 5
to run the go compiler because I don't
have go installed on my machine so I'm
gonna run the go compiler out of the
container it's gonna generate me a
binary it's gonna because it's volume
outed right back to my Windows machine
I'm then gonna create an image using my
docker file it's going to copy that
binary into the root of the container
there so root of the image I'm then
going to run that and then I'm gonna
remove it all clean up after myself so
there's now we get like the idea here is
we're some to build out a like a basic
build process I'm using docker to
containerize my CI City process I'm
building an application there so here is
the output from go and then we had a
whole bunch of stuff before that which
was compiling go building image running
container cleaning up everything after
itself and that is how you finally
finished with docker from scratch
so just some like closing on okay well
we've covered up across in this talk
scratch is not particularly useful as an
image I just like just gonna be honest
it's it's not a very useful one unless
you're basically creating your own base
images so you're creating a bunt to or
alpine or any other kind of
general-purpose
OS style image with inside of docker or
you'll try to do something super
high-performance particularly obviously
you compiling something down to a native
process then you can use scratch but
it's not gonna be useful for a lot of
things I use P net applications you're
not really gonna run them out of a
scratch image images are really great
for experimenting
running a single user process is really
it's quite powerful I can stand up
something like unwrap because I have no
need to install WinRAR for the like one
time every three or four years that I
need to unwire an archive on my machine
or I can I want to just play around with
something in go because I don't know I
don't really know how to programming go
I don't know if I ever want to become a
go programmer but maybe I want to just
experiment see what it's like basically
try out the basic syntax well rather
than stalling the go duel chain on my
machine I could just run it out of a
container compose is used and it's all
about representing environments that's
what we're doing with the docker compose
file we start building up services with
inside of that to represent the
applications that we want to run and the
dependencies that those applications
have on each other so we could you know
if I have an application that needs
sequel server and a risk
reddish cache or it's using RabbitMQ and
Mongo and a few things like that
I can I define those all the services
and how I can stand them up we use this
client that I was working with to
basically represent their dev
environment because they were using
rabbit and Redis and Mongo and stuff
like that and you'd install Redis on
your first day and I set all that stuff
up on your first day and then six months
later your implement your instance that
being config completely differently to
prod because you've got in there and you
tweak some settings and stuff like that
well using the compose file we can say
this is what the standard environment
looks like and this is how you stand
that up and using all the same configs
that you'd be running in
on a product iron metal that I'm running
on my machine and you're running on your
machine and you're running on your
machine we're running the same thing
removes that well it worked on my
machine well how did you configure your
rhetta's case everyone's running it
exactly the same
I'm Erin pal
that was doctor from scratch thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>