<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Domain Driven Design: The Good Parts - Jimmy Bogard | Coder Coacher - Coaching Coders</title><meta content="Domain Driven Design: The Good Parts - Jimmy Bogard - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Domain Driven Design: The Good Parts - Jimmy Bogard</b></h2><h5 class="post__date">2016-08-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/U6CeaA-Phqo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right good morning everyone
thanks for coming to my oh I defer at
two paws good morning everyone okay
that's about right yeah it's a little
order to be talking about DDT right
that's okay so just a little bit about
myself my name is Jimmy you can find me
on twitter @ @j bug guard this
presentation along with pretty much
everything else i do is on my github at
github comm /j bogart there's a
presentations repository and that's
where you can find every single talk i
do a long with sample code and things
like that
this topic is long with a lot of other
ones you can find me blogging at that
website there and let's get started so
just to set some expectations about this
talk this is a mainly an experience
report of my journey with domain driven
design over the past 10 or so years I
had the privilege or so I guess of
working with two very similar projects
in the exact same space set about three
or four years or parts and so part of
this is looking at all the bad things
and wrong things I did with domain
driven design and then I got to
basically have a do-over
few years later not rebuilding the same
system but a different one where I got
to kind of correct a lot of mistakes we
found with the previous one I don't
often get that privilege usually when I
build a system I try to build it for the
long run and any mistakes I make are
pretty much in there and I have to just
wait for the next project to correct
them this was sort of a unique situation
where was a very very similar domain and
I got to just basically have a do-over
is pretty great my my journey with
domain driven design started probably
around 2005 or so I was one of my first
major products I was working with and
basically the existing system was using
things like type data sets they won't
ever use those things they were amazing
piece of technology that lets you use
designers against your data now it's
horrible
and so that reboot of that product we
were looking around like ways there's
something we can figure out how to belt
better build business oriented systems
and domain driven design seemed like a
really good choice for that so this is
about 10 or so years ago now and
throughout that time from now until then
we've had
a number of different systems that I
have been put in production using
domain-driven design and so this talk is
basically trying to sum up my
experiences and my successes and
failures with DDD over the last 10 years
so let's look at the first system that
we were building this was what is now
tournament termed as a majestic monolith
as anyone heard this term before
majestic monolith so this is a term from
the Ruby on Rails guys to describe a
Ruby on Rails system basically trying to
justify the kind of crazy code you
typically see in there to say it's not a
bad model if that's one of the good
monoliths and we built in this system
this first system we built one of the
the bad kinds of monoliths we'll just
call it majestic because alliteration is
fun right this project started a year
before our company came on the previous
the previous vendor assigned to the
project spent a year just building
documents just writing documents
describing how the system is supposed to
work and have absolutely zero software
to show for it they spent a year just
doing Word documents and I think if if I
could describe a hell for myself it
would probably be a year writing word
documents of documentation so somehow
they were able to do this of building
lots and lots of documents with no
software whatsoever to show for it they
fired that vendor and brought us along
to actually build something and some of
the interesting things about this is one
it was the first agile project for any
Texas government agency this was a this
was a system meant for the entire state
of Texas and no one men had ever done
any sort of agile project before so that
was a new one as well and along with
that because you know they never had an
agile of course so they've never done
any sort of DDD either it's so those two
things put together meant a lot of new
things for this organization the
previous system oh I should describe a
little bit what this is all about so
this this this system was meant to
manage whenever a kid got in trouble you
got a and you're arrested there's a
legal process as you move through the
system and those so the system we were
building it was all about kind of
tracking the progress of those cases
throughout the entire legal process and
it was only meant for miners not adults
so they had kind of different terms for
things a little politically correct so
instead of jail they call it a detention
even though it was a jail like there are
bars on doors and everything but they
call it a detention and so it's really
about trying to build a system to manage
those those kids throughout the entire
process now the way the way city
governments work in the state of Texas
is every single jurisdiction has their
own IT budget and they all build their
own individual systems so what we wind
up having was in the previous system for
all the different cities in the state of
Texas each of them had their own
individual system about how to manage
this process the actual state government
would have a set of laws saying this is
how the kind of the end result should
look like and then this is how things
work in the middle but the actual kind
of business process of how things move
throughout the system it was up to each
individual jurisdiction to completely
make up how that process worked so we
had a number of really large
constituencies like the city of Dallas
and the city of Fort Worth those two
cities are actually only about 40
kilometres or parts but they both have
populations well over well in the
millions but they have two very distinct
systems and now all the other large
cities in Texas had their own individual
system as well and to help with all the
small cities the state of Texas supplied
a kind of a prebuilt got a dummy down
system so that everyone else can use as
well so you had a number of different
systems that all use kind of the same
terms the same legal terms but
internally how the process worked inside
each organization was completely
different and I kind of draw a parallel
to something like e-commerce a lot of
companies I see sells stuff on the
internet when you get behind the scenes
the actual business practices that are
driving those driving and decisions and
driving the processes are all 100%
completely different and that's exactly
what we were running into the new system
to replace all these existing systems
would be it's an
acronym of course because it's a
government sort of thing would be the
juvenile case management system or as we
called it JCMs this new system was
intended so that every single
constituent group inside the state of
Texas would use this one single system
and one of the one of the big reasons
for doing so is that one there were
actually there's no there were no
actually connections between those
previous systems so the kind of real
example we run into is a kid would get
arrested in Dallas and they had family
in Fort Worth so the kid would move to
Fort Worth and they had no idea that he
had a criminal record over in Dallas
some of the worst examples are things
like they go cinamon to live with an
uncle and the Fort Worth documents
actually showed that there was abuse
coming from that uncle and we didn't we
had no idea another legal people at any
idea so there's an altruistic goal here
is to try to increase knowledge sharing
between all those different groups
because the the real goal of this system
was to not have the kid get in any more
trouble so most of the focus was you
know trying to have different very
social programs to help the family and
the kid not legal for the life of crime
and get them on the right path in their
life this system also cover every single
part of the process that the juvenile
could process will be touched throughout
the entire system and I actually have a
gram of this and it's intentionally hard
to read this is a this is a dumbed down
version of the legal process within each
one there's obviously lots of different
business processes definitely like here
they would say something like grand jury
which is just a piece of text on this
the actual grand jury process in the
state of Texas is insanely complicated
we went to one group to see how they
scheduled this this process which is
basically you have to schedule the court
hearing amongst a bunch of other court
hearings and what that lady would do
would she'd put physically all the case
documents on the ground and physically
arrange them to figure out how to best
arrange everything because you had
things like
a defense attorney which is a defense
attorney provided by the state and you
want to have to make that person come
back and forth from their office so they
would try to arrange it by that or you'd
see this kid had multiple counts or
perhaps he gotten there was like he was
in some certain gang and then there's
another gang that was on the same day so
let's add them on dinner like just all
these crazy rules I had in their head
it's just represented by this one little
piece of text on this diagram up here
well our system was meant to handle all
of this picture and it was a very very
very big picture so we started the
project just you know bright-eyed and
bushy-tailed saying you know we're going
to be the first great agile project in
the state of Texas and the first great
Dedede project so what do what is one of
the first thing you do on an agile
project besides writes a year's worth of
documentation yes
yeah motivational posters or
demotivational something like that so
the very first thing we did was create
personas agile personas this was kind of
a big thing this project started about
two thousand seven or eight or so so
that's one of the big things you heard
back then is you had to create personas
for the different kinds of users that
would be using your system so we went
through this process of creating all
these different personas I also could
fit them all on the screen because you
couldn't read it these are just a few of
the samples of them I got about let's
see what 24 on this one there are 72
total personas that were going to be
using this system and now this is the
point where we should have seen maybe
this system was going to be too big but
no we were going to drive on we were
going to we were going to make this make
this system part of it
part of the reason as well as when
you're consulting sometimes you can only
push back with the clients so much
before they fire you so this is another
ones areas like maybe we should have
more than one system and they said maybe
you should shut up and just build it
like this like okay thanks well we'll do
that then so the the behind the scenes
we'd have a lot of conversations about
trying to figure out all these different
kind of groups in the system and
security was defined based on these as
well each one of these each one of these
personas represented typically either
one or a group of people inside an act
County we also had sometimes specific
counties some of the smaller counties in
the state of Texas this like this entire
box might be just like three people but
in other bigger counties like in Dallas
for example they might have a staff in
the hundreds of people that were
performing all this personas so there's
someone like that this picture made a
lot of sense but for a smaller group it
didn't make any sense whatsoever but
again because we were building one
system for everyone we had to make a few
compromises like that now when you have
72 of a thing that's just too many to
reason about so what we had to do was
start to color code these different
personas these personas were actually I
wish had a picture this they sell these
giant post-it notes they're like this
big and we use those post-it notes and
put them on the wall of all these
different personas this was like
literally a whole wall that was filled
with all these different things and we
want to having to buy different colors
of these to try to color code the
different personas in the system so we
we color-coded them based on the
different state agencies I only have
like four colors here but they wind up
being about twelve different colors in
the end of all these different colors of
these different agencies so this again
should have been the first sort of key
in our brains that if I'm having if I'm
having to group different users in the
system based on different kind of roles
and responsibilities and having these
major areas maybe again this is too many
people using this exact same system so
that was our first lesson that's that
chapter at the end of the book of the
mode domain is it one actually written
read the domain driven design book okay
who was actually read it oh okay okay
there's also the ddd quickly book which
again focuses on a lot of the things
that aren't as important and skips the
part at the end evans
Eric Evans actually did a podcast a
couple years ago that was something like
Dedede ten years later and one of the
things he described was if you had to do
the book over again he would have taken
basically the beginning first one or two
sections and cut that down to like ten
pages and put it as an appendix and take
the part on bounded context and try to
make that basically the gist of the
entire book
and that was one of the big things that
we learned from this project is that the
bounded contacts are probably the most
important parts of domain-driven design
and the other stuff is just kind of
intellectual yak shaving sort of thing
yak shaving bike shedding yak bike
shaving something that we just argued
endlessly about so the picture I have
here is actually a picture from the
production system and each of those menu
items is a separate state agency that is
dedicated to that thing and so once you
got inside of that that's when you had
like okay here's the actual system meant
for this individual person I don't know
what half of them actually mean and it
turns out the the product owners didn't
know what half of them meant and any
either because there's not any one
person that has the entire legal system
of the state of Texas in their head so
we had to pull and pick different people
for these different areas so don't
actually knew how everything actually
fit together
but there was one domain model that
everything came from in fact the central
domain model of the system which was
juvenile like you had to scroll down for
all of the different collection
associations that were on this
individual entity because every one of
these things was again a collection of
things associated with it it was
absolutely maddening so that was our
very first lesson that if you're going
to do DDD you should probably do a
little bit of research on what those
bounded context should be we did not we
skipped it and just did one single bound
in context for the entire thing another
area where the cracks began to show were
around some models in our system
especially when we had names of things
that didn't mean anything to anyone but
we had to find some common language that
everyone could share so this is the
concept of the ubiquitous language now
when we have dozens of state agencies
across the state of Texas if you try to
have the term of thing try to be shared
across all those different groups you're
just going to be giving yourself a
headache because no one's going to agree
on exactly what one term it and so what
wind up being happening in our system is
we had to invent very very generic terms
things like
well there's no definition of a person
in the legal system of Texas so this
thing that was very central north system
a person actually had no analog and the
actual domain of anyone's individual
system but it's what we had to do one of
the other things the system was trying
to do was was this idea of having one
source of truth for basically the world
and so if you have the source of truth
for the world you have to have entities
like person because you can't duplicate
data across any amount of context
there's got to be a single person that
goes off the entire lifetime of the
system and so that's what we had here is
a person a person how no one actually
could describe what this thing was other
than when other than it represented a
person in the real world but what I
meant in terms of the legal system never
really had any meeting whatsoever so
that was our next big lesson in the
system is that ubiquitous language
should actually be ubiquitous and maybe
if you don't know what that word means
go look it up and they come back and see
if that actually corresponds to the
things you're actually using in your
system now when we have all these
different government agencies one of the
things that government agencies really
do well is work well with each other
right no not at all
so these dozens and dozens of different
agencies we had a few main ones first
was the law enforcement agency this is
the people that actually be the
arresting officers we had the the
prosecutors they would they would try
the cases against the kids and then we'd
have the court system that would how you
know mandate they would oversee the
legal process and finally the probation
department that's the juvenile probation
department this this JPD people these
are the ones who are actually trying to
help the kids no one else gave two flips
at all like the the cops were just like
we're just out here about to make a
really bad joke but I shouldn't do that
filtered on sorry it's it's early enough
to my filters actually still working so
that's good um so the LA folks they were
just they're just out there responding
the calls and processing arrests that's
really what they're doing on a daily
basis trying to protect and serve
allegedly and they're they're really
they honestly some of us they don't even
know if it's if it's kid or not because
they just see someone getting in a fight
they don't have identification so they
get arrested they take him to jail
and it's through processing than
actually learn Oh actually he's 15 years
old so we actually need to go through
this other specific process so we looked
at we went to these different groups and
said what is what is the thing you're
doing kind of island on a daily basis
what's the what's the kind of most
important thing in your life as whatever
you're doing so the law enforcement
people said the offense and the arrests
that is what we're measured on that is
what we reports to the state's
everything revolves around someone doing
something wrong and us arresting for
them us arresting them for it of course
of course is all about the trial they're
there two mandates and oversee the legal
process and again they don't really care
about what exactly is happening they're
just there to really follow the letter
of the law
the prosecution office is really about
cases they're about managing a flowba
case through its system either getting
it to trial and getting some sort of
outcome or maybe having some sort of
plea agreement or dropping the case
entirely but cases are the most
important thing and finally JPD those
are the people that were always asking
the question but what about the children
what about the children that was just
them so again a thing that we should
have noticed is if we're asking each of
these people what is the most important
core part of your daily work and they
all have completely wildly different
answers that maybe we should go back and
look at that bounded context thing again
but now driving on building the system
like it is anyway so bounded context
have this concept of a core domain and
that was our next lesson that if you are
going to ask all the people in the
system what the core domain is what the
core purposes of the system they should
all the same answer
I don't have the same answer then you
probably need different systems because
all those different groups are going to
have very competing concerns about those
boundary points between those two those
two those different boxes so going on we
asked the different people like what
what does what does a in this case a
juvenile represent in your system like
what what does that thing represent the
juvenile model object we had in her
system so I should say we had the person
thing we also had a subclass which was a
juvenile so we went through an asshole
what does that represent to you what is
this jubilant represent well law
enforcement said form CR - 23 J it was
like a scene from the movie Brazil
literally so then for them they didn't
really care about it being a kid or not
it was just this specific form that
presented an offense and arrest and that
was all what they were about I mean when
you hear like we see like peace police
procedural shows were they're not doing
paperwork half the time it's a dirty lie
because if they do nothing but basically
fill up paperwork all the time of all
these different things that are
happening and that was one of the major
pieces of paperwork they had was to fill
out the details of an offense and an
arrest so for them there is no such
thing as a juvenile there was just a
form they filled out that described the
incident that happened and what the
outcome was on the court side a jus
little case was just something to
adjudicate it was really nothing else
they didn't they didn't really care much
about the details it was just again to
try to follow some legal procedure on
the prosecution side this was an offense
with something to charge for and that
contrasted directly with the probation
department which was an offense being
something he wanted to move past so
while the prosecution wanted to like get
get successful get successfully charged
and convict the kids the probation
department had the exact opposite where
they wanted to drop the charges so it
wasn't on the permanent record and try
to again down a better path in life this
is also this this this conflict back and
forth is something that's I'll talk I'll
talk
little bit later when we act we actually
talk to the prosecution departments
about the system and how much they hated
us for this conflict we put in there so
in addition to a ubiquitous language
needing to be ubiquitous the other thing
we needed to have is consensus about a
specific term so in the the illustration
was the term offense in juvenile if I
asked every single group with that term
even meant they all had different
definitions of that term and again if
people can't agree on what a term means
then it probably have to have some sort
of division of those contexts now I have
run into cases in which I have something
that in the industry there hasn't been a
decision on a sort of ubiquitous term
for something and so sometimes I do have
to work with my product owners to help
drive a consensus to say okay you're
saying this word you're saying that word
it sounds like those mean the same thing
can you just use the same word so you're
not confusing everyone and then like a
year later finally six and they start
using the same word and it's actually
something I have to practice myself like
I will subtly like correct them not in
you know not out you know overtly
correct them but sort of subtly if they
use the wrong word I'll repeat it back
but using the correct word without
saying something like well actually or
something like that so you're dumb it's
okay if your domain does not have a
ubiquitous language it can sense us
around something but you should be able
to drive towards it and if you can't
drive towards it because the word has so
many different meanings across your
different groups that are using it then
again you don't have one system you have
many systems now the last piece is
something I found that is kind of unique
to the domain different design community
that most people are really interested
in talking about the patterns of domain
driven design instead of those chapters
at the end and so this this right here
is actually a picture of one of the
repositories in my system you can also
see there's no there's no closing curly
brace because it continues on down
towards the floor and then over here
probably up the aisle a little bit as
well
so there's a there's a few there's a few
competing patterns for the repository
pattern out there we use both of them in
our system because it started during the
time period with one pair one pattern
was popular and then continued on to
where the other pattern became popular
so we want up just using both and so we
spent a lot of time trying to figure out
what is the best what is the right
pattern for an entity what is the right
pattern for a value object what about
those aggregates how are we going to
distinguish in our object model between
aggregates and just other kinds of
entities and repositories don't even get
me started about repositories let's make
sure those are just right so our system
just really try to focus on getting the
patterns the way they're supposed to be
implemented as opposed to kind of taking
a step back and looking at well you know
barring any of those kind of patterns
that we that we see there what is the
what is the right way to model this kind
of system so if I had to do this part
over again I would not focus on the
structural patterns at all in fact those
are the kind of things that are pretty
easy to refactor towards so in my
systems I would just I would just avoid
putting any of those patterns in place
at the beginning and wait for the code
to kind of tell me that those patterns
are necessary I need to put them in
place we we had a few of those in the
book the DDD the DDD book they call the
the like the refactoring breakthroughs
and we had a couple of those where we'd
have a Friday email saying okay everyone
check in their code because we're going
to have this refactoring over the
weekend and come back and Monday morning
everything's going to be changed so it
turns out that the the structural
patterns we put in place prevented us
from making those refactoring changes
that would have provided a much deeper
insight into our system because those
structural patterns really kind of
hardened and ossify and solidify how you
use your code and if we were able to get
rid of them we would have much better
ability to make those kind of deeper
refactorings in our system not to
mention just the just endless arguments
about the right kind of repository that
were caught right kind of entity none of
our customers care about that like
having a better repository was not going
to provide a better
or experience or like prevent a kid from
getting in trouble so it was just a
complete waste of time
so where the system end up I would still
consider it a success because it's in
production today and it's being used
across the entire state of Texas but
it's a very very large system and not
everyone is happy with it but their
captive audience they have to use it so
Matt it is a very very large system the
final tally and I just pulled this like
a few weeks ago because it's still being
actively developed and added and
features that on to 195 controllers 652
actions 121 different security roles in
the system this is because cities like
Dallas have a lot of different people
and I just feel really bad for those
like small East Texas towns that have to
configure 120 roles to be like Sheila so
sorry Sheila 218 different entities in
the system
184 value objects 352 enumeration 's but
we deploy to about 50 counties in the
state of Texas at this point and there's
about 250 so about 20 percent of the
counties and about 80 percent of the
population of the state of Texas is
going through the system there are a
couple rules in there like if last name
is Bogart then go ahead and just go
ahead and you know drop the case but
those are some Easter eggs so I'm gonna
have a system that's bigger than this in
terms of controllers and actions okay
I've asked a few people that and they're
all like no and we shouldn't that's not
something to be proud of actually we
were proud of this we we actually had
meetings with a with the asp.net MVC
team with Phil hack come down to our
office we're like showing him this like
look how big this is like the biggest
NPC app that you have ever seen he's
like yeah and then looking back he had
this like look in his eye like like we
were crazy but now I know yes indeed he
was a he was right yeah so I haven't
actually met anyone that's built a
system bigger this nor anyone crazier
than us to build a system bigger than
this but I still again call it a success
just because I went to production and
I've worked with so many teams that have
projects usually they build project
Phoenix that never go to production so I
don't feel too bad
that arse actually made a production so
the picture that is usually drawn by the
majestic model of people looks something
like this
you're thus lovely futuristic City
everything's nice and clean and there's
floating roads because those things are
really easy to build and no one ever
needs to change with the directions and
places where those things are but in
reality it's more like district 9 sort
of City where it's just a complete mess
and like aliens are eating cat food and
that sort of thing just all over the
place so that was about three or four
years of my career building that system
and then we get a call about a year
after we were done with that project
that's we get to get a do-over
so we didn't get to replace the existing
system and fix those wrongs because you
really shouldn't do that anyway like
just rewrite a system because don't you
don't like the code what we did have
though is an opportunity to help build
the adult version of the system so we
built the kids version that has their
own sort of legal process and now we're
we're going to be building the adult
system well it turns out that the group
that originally contracted with us that
build the juvenile system actually tried
to build the adult system the exact same
way and failed with someone else
and so they came in to call us to say
okay we're not going to try to build the
entire system not because it's wrong
because but because we don't have the
money for it anymore
we wasted on the other one but we only
have enough money for this one little
part and then it turned out to be a
great great big win for us because we
don't have to worry about fighting them
over let's not build a ginormous single
monolith let's just build one a little
piece and do that one really well so
this projects was way too costly
expensive risky to build a single system
and instead of trying to build one
system for absolutely everyone in the
world we were just going to be focusing
on a single agency at a time and the
agency we're going to start with
actually had the most money in the state
of Texas because believe it or not they
actually care about prosecuting people
more than anything else in Texas like
right below guns is convicting people so
those are the people that had the most
money and that's who we're going to
start with so in that original diagram
that meant that the people that were
worried about did you notice this was
color coded as well so like people
before us it already
like don't don't try to put everything
under one umbrella and so we just had
this one section right here that was
dealing with prosecution and those
prosecution solar services down here
this is the juvenile section so the
juvenile section with those hundreds of
controllers that was only this little
sliver right down here so like trying to
get a single system for the rest of the
adult system would have been absolutely
absolutely impossible so this new system
because we learned her lesson and also
because they didn't have the money to
try to build the entire system we had to
build a system around bounded contexts
so we had a bounded context around a
prosecution agency and inside the
prosecution Department that's when you
had really good names for things in fact
when you go and ask like the prosecution
Department what is the most important
thing in your system is it is it the
defendant no is it the what's the
opposite of the defendant the plaintiff
thank you I need to watch more law and
order procedural shows that sort of
thing yeah so is it the plaintiff no so
what is the most important thing it's
actually the case not the person
involved with the thing it's the actual
case itself that is a thing that
actually moves through the system a case
represents potentially multiple offenses
multiple defendants multiple plaintiffs
multiple offenses multiple incidents
multiple arrests these this one folder
physical folder for some of these cases
represents the thing that moves through
the system for that group now outside of
this prosecution agency if you talk to
what the law enforcement agency courts
are some of these other people like what
about what does a case mean to you
they're like what case I don't care
that's just something my prosecution
buddy tells me over beers but there's no
such thing as a case in my system
probably law enforcement we just have
arrests and we hand the arrest to the
prosecutors and they take him from there
as part of our as part of this effort to
we went talked to the different
prosecution agencies it was kind of
interesting because some of the
prosecution agencies and the prosecutors
used the juvenile system and at the time
we hadn't quite understood what we had
put on people with a single majestic
monolith
and so we asked a couple prosecutors Oh
what we were the people behind the
juvenile system what do you think of
that like literal quote little quotes
and that was a little bit of a little
bit of a shock you know as the as the I
was the tech lead of the previous system
as well so here people like use foul
language for something I built and was
so very proud of and actually wrote you
know dozens and dozens of blog posts
about that system a necessary or someone
like oh that piece of ooh oops so
in this new system the previous system
was all about the kids but if you
remember earlier prosecutors don't care
about the kids they care about the case
going through the system so that meant
the view of the new system was all
centered around a case and in fact the
previous system when you'd actually do
do anything the system and actually to
start with the juvenile so the
prosecutors whenever they wanted to
manage their cases in the system they
had to remember like what was the name
of that kid that this case was about I
got a search for that first oh well then
it pulls up the kid then I go to the
little drop-down list and it goes
prosecutor and then the prosecution that
section there's this tab for cases I
click the cases tab and there's a case
to entry ahead click the oh there's my
case now I got to it and the new system
cases were front front and center in
this system so everything was about how
they manage cases and what status
they're when and how they move through
the system the what did I get in trouble
here for burglary of a rail car by the
way don't steal rail cross in Texas that
is actually a felony there so just word
of warning so the concept of the case
because we were able to focus just on
that core domain of that prosecution
agency meant that the overall system the
domain the interactions could be much
richer because they were able to focus
just on that single just on a single
bound in context so this was the first
lesson we learned from the contrast of
the previous one is when we have a co
very cohesive bounded context that
actually brought us a lot of clarity
into how that prosecution agency works
to have even deeper inside to how to
make their lives better make their jobs
easier the reason why the prosecutor
called our system a piece of crap before
is because it wasn't
for him it was built for the probation
department the probation department does
no idea what the prosecutors are doing
and in fact there's quite a bit of an
adversarial relationship whereas the
stories that the probation department
told us were about how the kids lies
they've stayed on the prosecution side
that they remember all the really bad
cases and so there when I was able to
say oh we held this so-and-so kid and
he's able to come back with like and
some other kid like killed his whole
family were like oh like fade into the
background let's change the subject here
we also to be very careful about the
dummy data we put in the system so
things like Bart Simpson killed Maggie
Simpson and did something with Homer
Simpson they would remember a case that
was just like that so like okay well
just
we're just Borgo a bunch of rail cars
let's just do that because that's no one
no one gets unhappy about that now the
next piece we had was specifically
around the roles and security in the
system in the previous application we
actually made all of the personas the
agile personas and two roles in the
system in admits that they had to
configure 120 different roles no matter
where they deployed this application and
the next version of the system we model
or you our roles and security quite a
bit different what we made was all the
permissions in the system were
hard-coded and that was because you
couldn't just invent new actions that
you could do or new tasks that you could
do so we had a hard-coded list of all
the things you can do the system but
past that it was 100% dynamic so we'd
have a table for the roles that would
tie roles to different users and if you
wanted to have different privileges you
assign that person different roles and
if you're some small East Texas County
where you slip a 50 underneath the desk
to get out of something then you can
just have one role in your system which
is like you know boss hogg sheriff or
something like that I don't know and
then that person can have all the
permissions associated with that system
and what we did make hard-coded though
we're all the permissions the
permissions that a system are also very
task-oriented as well
that meant that every single permission
correspond to an individual an
individual activity that someone could
perform and then finally when we went to
enforcing the permissions we would
enforce them just feed us this kind of
attribute we decorate on controllers the
previous system use role based
authorization which I cannot stress
enough never do role based authorization
gives you no flexibility on how to
associate those activities that people
do to the roles so we'd have roles in
the system there was something like okay
this is a Betty the bartender because
bartenders are no bartenders aren't
users in the system Larry the law
enforcement agents but in some counties
Larry the law enforcement agent actually
was able to do this other thing over
here so we'd have to invent new roles or
like Larry the law enforcement agent
they can also do this other thing except
not that other thing because this other
person complained so instead of trying
to force security throw those roles we
enforce them all through individual
permissions the other really cool thing
we did with this is anytime you had a
link on the page it would check the
controller action to see does this
person have permission to do that
activity they didn't permission to do
that activity the link won't even show
up for them so enforced it when they
actually executed the action and then we
also enforced it in the system so that
we wouldn't even allow them to see
things and do things and they didn't
have the privileges to do so so with a
previous system that had to be built for
everyone in the state of Texas I had to
have this sort of infinite flexibility
in some areas and then super super rigid
in some areas so what a focus system
allowed us to do is to be able to be
flexible and the places we needed to and
rigid on the others where we wanted to
have some commonality across the system
we could only really do this though if
we were to have that like laser focus on
a single bounded context the next one
was a fun one the file management
problem so we went to two different well
I went to a number of different county
agencies but I went to the Dallas County
agency the
prosecution not departments and went to
the Fort Worth prosecution Department
and even though the cities are like
40-kilometer parts and you think would
share a lot of information they're
actually in different Texas counties in
the state of Texas which means they have
completely different IT budgets
departments like they don't really
actually they kind of hate each other
because the forward people were kind of
hipster Dallas is like kind of big-city
they CH think they're better than the
other so what was interesting is when we
went to both departments and asked them
what is the number one problem that
you're running into that you want our
system to solve and they both have the
exact same answer we have a file
management problem great that's great we
have some consensus on something let's
solve that problem we talked to the the
the Fort Worth County Prosecutor's
Department and said okay can you tell me
a little bit more about your file
management problem well it said their
file management problem is they've got
too much data and one of the things they
were doing very recently was having
these police cars have the dashboard
cameras on them to record incidents with
a handy delete button in case there was
something like you didn't want anyone to
see and these the this digital media
would be submitted as part of the
digital as part of the evidence so you
can actually see if someone got arrested
or something you'd have some sort of
video evidence then also pull things
from CCTV as well for you know
convenience stores or the robbery they
can pull that in as well and they just
piled up over time so their biggest
problem was we've got just so much data
there's archival there's archival laws
that say we have to keep this data for
like 20 years and so we're just seeing
this grow and grow and grow because as
we get more and more digital the the
world gets more and more digital a lot
of the evidence becomes more and more
digital as well and there's also laws
that you can't compress things as well
so they'd have to have in the most RAW
format possible because again there's
specific evidence laws for that it's
like oh that's a pretty cool problem to
try to solve that you've got so much
data that you have to worry about trying
to figure out how to how to sort an
archive it and be able to pull it up
efficiently now going to the Dallas side
of things who also said at a file
management problem this was their file
management problem a leaky roof
so their files were still paper-based
this was 2014 2013 and they still had
100 100% paper-based system now the
Dallas Metroplex is something like 6 or
7 million people and boggling like just
boggle the mind that in order to process
all that they were so going through
paper-based documents to manage the
entire process and when you have a leaky
roof it can ruin your cases literally
but they would have time there when we'd
walk in and be like if I sheer panic
going around everyone's just like
buzzing around like bees or something
and we like what's going on today oh we
lost a case oh I mean don't you lose
cases on a daily basis like no we lost
it we can't find it they're going around
like des - des like tits did did jonah
take it over there no no no III
definitely put it back over there and if
they physically lost a case it would
have to be dismissed because that was
like that was everything was in that
there's no copies of that was it so yeah
if I can Aliki roof or someone loses the
kid physically loses a case that
actually loses the case for them in real
life
and they had stories of that where
they've lost I actually lost cases so
the amount of procedures they had in
place to like lock that you know check
out the case put your time down that you
checked it out if you if someone will
come at the end of the day look through
like who has not checked out a case or
checked it back in yet did you take that
home it's not you can't take it home
because then who knows who can get
access to it so just kind of funny to
think they had the same exact problem
but actually two totally different ways
of working it so this is the kind of
thing way to deal with when we're trying
to build a system that's going to work
for both kinds of groups one group that
is heavily process oriented and one is
just heavily digital oriented how did
you can you build a system with
workflows that is trying to manage both
of those different processes this is one
of the big complaints we had with a
previous system because we're trying to
build a system for everyone it was
impossible for us to get consensus about
how the system should work so we wound
up doing a saying guys we're at a time
we just got a you know we got to build
something so let's just do this workflow
and then you can tell us how it's wrong
submit a bug report whatever
now one of the reasons they all hated us
is because we forced their agencies and
do very specific workflows that did not
work for them whatsoever so in the new
system we needed to build a flexible
workflow that can work for both of these
kinds of agencies now yes we would
digitize these people over there but
again they're so far behind the curve in
kind of IT there's the like late adopter
laggard and they're like way off the end
like what's an what's an IT department
sort of thing so we had a build a system
that can handle both of these kinds of
customers so we wound up doing is
building a system that had flexible
workflows in the system so each
individual agency could have whatever
kind of workflow they wanted to in order
to move cases through the system and we
wouldn't tell them or dictate them how
that process should work so in this case
we had specifics we had dynamic statuses
for where that case could be because
while one county could say this is my
business process for a case going
through our internal agency and another
one say actually we just go straight
from the we don't have that person
between the engineer and the customer we
just take the information directly from
them they can drive that workflow
however they wanted to we would have
transitions defining a begin state and
in state and this is just a state
machine right that's all we're trying to
build here and the last thing we did was
we tied security to those transitions as
well so that only specific roles could
potentially do specific kinds of
transitions so not everyone can just
dismiss a case has to be like the chief
prosecutor or whatever they'd have in
there that could do that sort of
activity and because we still need to
have some knowledge of like the base
actions we would still tie them into
kind of a named action as well so if as
a if it was a transition that
represented a very specific thing in the
legal process we could have that in
there as well and finally when some of
the prosecution agencies need to have
something very custom associated with it
we'd include different actions
associated with it so they could have
like this action needs to go to this
custom page that has these fields on it
because when they approve a case for
submission they need to gather some
additional information so we were able
to pull that in as well
the next piece we did with those trip
transitions is that we drove all the
work via these cues and this actually
very well solidified in our head when we
enter the paper-based
agency they actually had physical stacks
of cases on people's desks that
represented where that case was in the
different processes and so what we wound
up doing is modeling that exact sort of
domain and those exact processes in our
system so beyond just the kind of the
the legal model that we needed to model
so the case and offenses arrest we also
needed to have a model for how their
business process worked now none of none
of that model actually existed it was
just how they got stuff done but we
needed to have some sort of model for
that in our system as well so those are
those our next lesson is that sometimes
the model needs a model so that I can so
that I can model the model as it goes
through this as it goes through the
system so not every net every
organization has this sort of issue
where they have very dynamic workflows
and it's something I'm really hesitant
to put in place because I usually try to
push I try to push the groups I work
with to say you really need to figure
out what your business process is and
not just have kind of random things if
you don't have a defined business
process that's where you have like like
every entity has like a note section or
comments section and that comment
section is actually where the business
process occurs it would have comments
section with like dates and names and
like what so yeah your business
processes he actually the know so we
wanted to take that and build a model on
top of that so that we could actually
enforce a business process through the
system now on one thing very
controversial at the time anyway I hope
I've blogged and spoke about it enough
that it's not as controversial then one
of the first things I did was ditch all
of those structural patterns from the
get-go my basic philosophy was I will
not introduce any sort of pattern or any
sort of structure into my system until
the code tells me that it's needed and
the code telling me that's needed is I
don't know kind of like a horse
whisperer kind of thing like the code
has to speak to you somehow but you can
got to just use the basic code smells
from the old Fowler refactoring book as
sort of a guideline to say
these are the things I'm seeing in my
code what can i refactor towards to help
encapsulate those patterns now one of
the things that we had in our system was
the idea of having having requests and
responses being as if being the thing
that we modeled in their system so our
original repository will those eighty
different methods on it
each one of those methods is only ever
used in one spot in the system but when
actually went to the repository it had
everything every kind of data access
thing ever that's why you had that
explosion of methods in there because
every single new kind of query that we
had to do we had to create yet another
method on there or just expose out
aquaria Bowl and just say you know f it
you know here you go do whatever you
want
so when we went to this new process I
did not introduce any sort of pattern
until actually kind of emerged
throughout the system
and the pattern we kind of laid it on
was the CQRS style application where our
requests and responses were modeled
explicitly as individual objects and
then we would have the request handlers
be the actual business logic behind the
scenes what this meant was we didn't
have to have a single repository or a
service helper manager object in her
system the business logic for individual
activities would always reside in these
individual handlers for a specific kind
of request so in this case I'm handling
a specific request to show this is an
index action to show I pulled one of the
simple ones this is to show the aliases
associated with a person on a case so it
makes a query does a list does some
automata projection because I was a tech
lead and that's how I roll
and returns that view model to the end
user now how we're crazy
this query would get it would be 100%
encapsulated behind this single class in
fact if we needed to drop down into raw
sequel because performance reasons or
whatever that's okay because it doesn't
affect the rest of my application when I
had a repository has that single
interface that everyone used they meant
that I couldn't easily switch that thing
out for something else because if I
switched it out in one spot I have to
switch it out in every single spot
in this class I have no abstractions
whatsoever I've got a real in this case
I was using it hibernates a real and
hybrid a container or a session and a
real this is a structure map I think a
real dependency injection container no
abstractions no nothing like that just
use the raw thing as much as possible
and if this needs to change then I only
have this one single spot where I need
to go fix that and we had those cases
come up we had some pages that this the
the trying to go through the domain
model to do my sort of querying that I
need to was impossible so we just drop
down and use something like pet apoco or
in poco those micro ORM things where you
just use in sequel we can just use that
in here instead or we can use and
however to actually let you do raw
sequel as well but doesn't perform quite
as well as the in poco stuff so we were
able to do that and that one specific
spot and didn't affect the rest of our
application so that was the next lesson
we had was to not follow not blindly
follow any sort of pattern advice I
often get questions asked like is there
can I build out a reference Dedede
application and the answer is almost
always no actually the answer is always
no and the reason being is that when you
see a DDD application you're seeing the
end result of hundreds of different
conversations and decisions made up to
that point and there's a lot of
assumptions that if people have been
making and a lot of things that I've
been verified that if you get to the end
and just say that's how we should do it
you're missing out on the important part
which is really the journey of how they
actually got there so when I see when I
see DDD reference applications they're
usually way too simple for me to even
say why would you even use all this
structure it's just way too much work or
I miss so much conversation that I'm
having arguments with myself like well
it should have done it this way well I
wasn't in the room when they made that
decision I don't understand the
constraints they were under so I can't
just blindly put all these sort of
patterns and practices in place I have
to let the journey of the project tell
me where I need to go now when you build
a system that has to that when you build
a system that is not a single monolithic
system with a single database you know
introduced a new problem which is how to
deal with others
whenever I have now one now one system
that has to talk to multiple systems now
I got to worry about integration this is
one of the reasons why people typically
don't try to go down these SOA micro
service bound a context route is because
integration is actually really really
hard and it's even harder when I'm
talking about dealing with other
government agencies that very often do
not really like each other the law
enforcement agents and the prosecution
agency really love each other
we saw that a lot like you can shoot and
kill someone as a cop and you probably
are going to get prosecuted for it
that kind of buddy-buddy in relationship
with other ones they do have not so good
relationship like the indigent defense
the defense attorneys that are doing pro
bono they're representing clients on the
behalf of the state there's not a very
good relationship between these two
people like they don't go to the same
bars that kind of thing and so but we
had to have a system that could allow
each of these different people to talk
to it so we built based on each
individual use case different kinds of
interactions different integrations
based on those specific how how closely
those two agencies work together in real
life for example the law enforcement
agency in prosecution Department beyond
just being buddy-buddy in real life
there's actually a very strong
relationship between those agencies in
the legal system so what I'm doing is
building a very special portal for the
law enforcement agencies to come up they
believe I come up to kiosks in the
prosecution department and with their
arrest reports in hand they be able to
just look at them and type them in as
quickly as possible so on the
prosecution agency side we made things
very lovely looking and you know user
experience out the wazoo all that sort
of thing
the police the police tomorrow didn't
care about that all they cared about was
coming in typing their stuff as fast as
possible and leaving so that's when we
did have a giant forum with a you know
100 different fields on it because that
was the best thing for them but we can
only do that if we talked to them and
said okay what is the most important
thing when you're just doing this
interaction with the prosecution
department we're not trying to replace
your hole in law enforcement system
just this one interaction what is the
most important thing and they said to
get in and out as fast as possible we
don't like typing we already we already
wrote this stuff once what are we going
to write it again can I just give this
to a law clerk and they'll type it up
and law clerks like no you type it up so
we wanted to try to speed that process
much as possible something like the
defense attorney side this is really
interesting because there's a there's a
lot of legal restrictions about what the
defense attorneys can actually see in
the prosecution system there's certain
discovery I don't know that's a word
I've heard on law and order again
there's certain laws that dictate what
kind of information they're allowed to
look at so in that case we went up being
building a completely separate system
that used a rest hypermedia API actually
hypermedia and that portal then
communicated it is very very blocked
about what kind of information they can
see just based on them big a defense
attorney whereas the le.a they can have
access to quite a bit more stuff because
there might be a lot of communication
hey did you have evidence for this oh
here it is let me go ahead and upload it
this was a very very pinched portal so
that was our final lesson
that's microservices and any corruption
leaders are your friend especially when
you have two especially we have to have
integration between different bonded
contexts the way you can help solve
these problems are building any
corruption layers and then going back
and and really trying to drive towards
this micro service concept so that each
individual group can have their own
system that conforms to their own
individual rules final tally of this
system now it is a it was a very large
system but I would say it only dealt
with the prosecution agency so I didn't
feel too terribly bad it had 70
controllers down from close to 200 or so
before 600 actions seems like a lot but
we had like way more Ajax this time
around so it's a lot of control actions
for that a lot of permissions in the
system because we're very very granular
about what people can do and not do in
the system quite a few caught a lot
fewer ended entities in the system 139
zero value objects because we were using
any framework and it doesn't support
value objects so nope 18 ohms and in
this case when I pulled it up the
about a couple months ago we had about
20 counties in the state of Texas
deployed with a prosecution system and
20 happy counties and that was probably
the most important part so favorite
member is this picture this this winner
on the internet JavaScript the good
parts versus JavaScript the definitive
guide it's like aha that's you know this
is actually the good part it's just that
little little sliver there well I guess
it's growing now with like es6 right so
and i had a similar thing with domain
driven design if you try to encapsulate
all the good parts out of the DD book
and try to build your own book for it it
turns out that's actually just the
microservices book so you want to learn
what the good parts of ddd are I would
say just skip this book and go straight
to this one so thank you very much
if you want more information about this
you can find it on my blog or on my
github otherwise thank you for coming
and have a great rest of the conference</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>