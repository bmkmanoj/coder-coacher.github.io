<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Managing Enterprise and Consumer Identity with Azure Active Directory - Nick Pinheiro | Coder Coacher - Coaching Coders</title><meta content="Managing Enterprise and Consumer Identity with Azure Active Directory - Nick Pinheiro - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Managing Enterprise and Consumer Identity with Azure Active Directory - Nick Pinheiro</b></h2><h5 class="post__date">2016-09-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_Iq4FWMGYyg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Ches Ches all right everyone hear me
okay not too bad right success how many
developers and technicians does it take
so I have a very very early version of
early build of Windows 10 that gap has
been built on top of over this entire
time so it was an issue that came out
originally when Windows 10 first came
out with duplicating slides or
duplicating monitors so I think it's
back related to that but all right so
let's get started hello thank you guys
all for making it through almost the
entire day I know we have probably one
session left after this so I'll make
this as fun as exciting as we possibly
can so this is managing enterprise and
consumer identity with Azure ad my name
is Nick Panero
I'm a cloud and software architect and
what we call the azure applications Co
II out of the United States so the CEO
is the circle of excellence what that
basically means is we take on some of
the more challenging as your based
projects that come on our desk so we
just finished up a few pretty fun
projects we worked on the Rio Olympics
or the web app and the web API for that
we worked on one particular solution
that I'm going to bring up today which
is a imagine care it's called an
imagined care app which kind of changes
the way we look at health and wellness
moving forward which is a completely
cross-platform IOT solution all based
out of azure as well with identity built
into it as well alright so as I
mentioned so cloud and Software
Architect and the modern apps global
domain my focus areas are path so
platform as-a-service web mobile api
apps logic apps etc most recently have
been kind of integrating what I've been
working on with Microsoft flow which is
previously released as well as power
apps okay I work a lot on sass solutions
butts a solutions custom sass solutions
that we build for customers rather than
our office 365 or dynamics solutions
that we provide and then I do a lot with
face
book app development as well tomorrow
the second to last session of the day as
well have a different session called
face book development with asp.net and
Azure so that's kind of a summary of a
book that's coming out that a few of us
are working on so it's a pretty cool
session a lot of great tough topics
there as well if you want to take down
any of my contact information next week
we are making the code that is
associated with this deck available we
were waiting for approval for the IP
that we had built out for this solution
to be able to release it out and it'll
make more sense as we go through the
deck so I will be tweeting it out and
sending out a broadcast email so on my
web address Nick Panero comm you'll be
able to subscribe there and get an email
and I'll be sending out the the full
solution for what I would be presenting
today
so the session objectives I kind of want
to keep it I will kind of get a son a
sense of how much experience everyone
has with azure ad and identity and
social identity but want to keep it kind
of a level of 200 or so we'll be
comparing contrasting the various azure
ad service offerings free basic premium
b2b and b2c learn how to provide
enterprise and consumer Identity
Management at no additional cost and
learn how to secure your applications
and API is with Azure Active Directory
when we say at no additional cost it's
really where you're going to be starting
out and you're going to be looking to
build dev test scenarios for these
larger solutions and how you can get
started without consuming a lot of
resources and obviously a cost to it so
again so the agenda high-level overview
of microsoft azure for those who might
not be as up to speed on azure overview
of azure ad will then go into that
little deeper dive into the comparison
between each one of the service
offerings that we just mentioned free
basic premium b2b and b2c and then we'll
start diving down a little deeper for
the developer and look at the graph API
how to create application objects in
Azure ad how to secure not only your
applications but your API apps as well
and how to have your own Roth provider
for your api's and applications and then
we'll actually talk about getting
started with Azure ad for consumer
identity without having to you
as your b2c okay and then Identity
Management so how do how to use that
methodology to create full enrollment
login a forgot password reset password
mechanism for your solution so Azure so
these are some of the marketing slides
that we kind of have to include for
everyone together make sure where
everyone's kind of level set and where
we are how many people here work with
Azure today nice awesome great so I'll
kind of go through these slides pretty
quick
so these are some just some slides it
just came out recently that we've been
showing this is kind of the past story
of azure you've probably seen these any
one of these four diagrams at one given
time or another we kind of I think we
started off here and went to here went
up to there and now pretty much this is
what you see a lot of which is the full
kind of service offering that azure
provides and now what we're really doing
is kind of moving towards framing it
more as a digital transformation for
your organization right engaging your
customers empowering your employees
transforming your products optimizing
your operations I mean I sure is so has
such a large depth and breadth of
service offerings that it's difficult to
just give you an overview of Azure in
one session right so it's more kind of
thinking about it differently and how is
this a value to your organization of
value to your customers of value to
transforming your products and your
solutions moving forward all right some
pretty cool statistics that just came
out recently so there are 1 million
devices per hour coming online by 2020
that are using Azure in any which way
shape or form as a back-end or whatever
the case may be the 12 year average of
all S&amp;amp;P 500 corporations by 2020 will be
on Azure and 60% of computing in the
public cloud by 2025 that's pretty
amazing so 60% of all cloud 60% of all
computing will be in the public cloud by
2025 so less than 10 years from now so
in line with that new kind of angle that
we are providing these overviews of
Azure it really lies on four pillars
right so application innovation data
intelligence openness and flexibility
and Trust and protecting your business
so everything that we will talk about
today will tie back to one of these four
pillars in one way shape or form
so overview of azure ad so everyone's
working with Azure pretty much in the
room how about a sure ad specifically
cool so everyone else is pretty much
using Azure app service maybe Web Apps
maybe some API apps pretty normal bait
okay excellent
so Azure ad as you know is an identity
provider
it's a comprehend comprehensive identity
and access management cloud solution for
your employees partners and customers
alright so today we'll be talking about
B to e which is business to your
enterprise so internal users B to B
which is really just a matter of
configuring your instance of your domain
in appropriate type of way and b2c which
is a completely separate service
offering which allows you to have social
identity built-in allows you to have all
of your identity management tools
generated for you where you can then go
in and customize and then
programmatically modify as well so
that's pretty cool we'll see a little
bit later on in the slide deck we just
released b2c with the large case study
for Real Madrid with over 450 million to
400 million fans that they have so it's
a really really great case study and
it's it's live today so you can download
the Real Madrid app you can get the Real
Madrid website and you'll be using Azure
b2c with full integration Facebook
Google Microsoft account etc so this
slide here is is it really possible to
keep up right so we have users devices
apps data we have enterprises I mean our
employees business partners customers is
it really possible to be able to kind of
manage all of this from one identity
provider and secure and protect against
all new threats with maximum
productivity and integrate with
everything that you have so this is kind
of where we're going to show exactly how
you can do that moving forward and how
you need to kind of reinvigorate a
platoon of stood up in the past a little
bit differently today so this is just a
quick overview of the enterprise mode
mobility and security solution identity
driven you know we have all types of
enterprise mobility offerings internet
cetera
so I'm gonna go to deep into that so
identity at the core of enterprise so
this is kind of we were talking about
earlier so obviously on the on-prem side
majority of every organization has
Windows Server Active Directory stood up
if you have office 365 you have azure ad
a lot of people don't know that everyone
probably here probably does which gives
you leverage to really begin building
solutions on Azure ad as an identity
provider almost immediately look at some
of the animations here so as you can see
in the middle you have single sign-on
mechanism self-service mechanism the
self-service mechanism is really what
we're gonna drill down into today so you
understand the difference of what's
available to you and each one of the
offerings because it that's really where
the the key different the
differentiations are again some pretty
cool statistics just about azure ad
alone not about azure in general 86% of
all fortune 500 companies on the
Microsoft cloud are using Azure ad more
than 9 million directories more than 600
million user accounts excited I won't go
too deep into this but again just some
pretty cool info so we'll start off with
our comparison the next slide is a
pretty busy slot so I'll summarize it
for you but this is what we we show so
in the middle we have our Active
Directory free offering with a limit of
500 objects pretty much your core as
your ad service offering as your ad
basic is really going to allow you to
have the blue section here where we have
premium and basic features which allows
you that service self-service Password
Reset for cloud users and company
branding the company branding portion
comes with premium so with branding you
can change the logos you can you know
change the color and the scheme you can
apply CSS to it that's available in
premium and then once you move up
against the next level would be to see
that's really where you get all the all
the capabilities available to you where
you're able to stand up full social
integration add additional attributes in
Azure store the IDs from their
third-party identity service providers
okay I'm gonna run right by this one
because we already talked about this a
little bit I don't want to waste too
much time we started a little bit late
so again same idea a thousands of apps
one identity okay
just kind of goes to show how you can
integrate your choreography with the
different sass offerings that are in the
gallery today single sign-on internally
and for your consumer based applications
and solutions as well I think we said
the last of the marketing based slides
and we'll start to get into the real
meat of what we came to talk about today
okay so single sign-on we just mention
that all right so everyone here actually
has has everyone created their own azure
ad directory pretty much anyone who is
not one two three okay
so I'll go buy it go go really quick
through creating something or showing
you what a what's already created that
we will be making use of let's just
close this over here
so I've already gone ahead and created a
this is not my machine one second
you sign any username
so we have the multi factor auth setup
so this will send a message to my phone
for me to authenticate
and there we go
so I've created a fictitious domain
already for NDC for example and I'm
going to show the differentiation
between creating just a core azure ad
instance and an attribute of C instance
so if we just go to browse all our
offerings here we go to add your active
directory it's gonna take us to the
classic portal see it again I'm sorry Oh
on the new portal I've heard that it's
in in the next quarter that it's coming
into new portal yeah so a few of us
already have it in our subscriptions I
actually could have it as well you just
basically send your scription ID to the
to the team that's working on it and
they power up the new one so yeah next
quarter
all right here we go so here we see we
have an NDC ad and we have NDC b2c ad so
here so essentially for those who
haven't created an azure ad instance
before it's extremely extremely simple
okay so you just come in here basically
I'm going to go into new you're gonna
select directory app services directory
I click create basically assign a name
I'm sorry we're not on that can you use
to a machine that's not mine there we go
custom create so basically just
assigning a name which I gave NDC the
domain names nd seed is Sydney dot on
Microsoft calm and then I assigned a
country a region of Australia here is
where you would select whether or not
you want to be to see directory that's
automatically you're going to add all
the different attributes that you'll
need to store information from your
social identity providers as well as the
additional attributes that are available
to you and that you can augment as well
programmatically so here we've already
done this so what we're gonna do is well
we'll see that I just created a simple
user for myself Nick at NDC Sydney
dollar Microsoft calm so what we're
gonna do is we'll take a look at let's
see we'll take a look at the graph
Explorer alright to show you how you can
again I had all these links stored on my
machine but let's see if I have them
from head should be graph Explorer the
cloud app net
okay so here this is our basic graph
Explorer for the graph api of azure ad i
could go in here sign in with an account
that i already created so for example my
nick account that i just created
alright it's gonna allow me to fully
browse so this is blogging because i'm
already logged in with my neutropenia
comp i'll use the demo of company then i
can just click here and then i can go
from here for example and look at the
autocomplete options and you can start
drilling down into everything that you
create right from the graph explorer
this will really help you when it comes
time to do programmatic calls using an
HTTP client or whatever the case may be
to see what actual data is there to
validate that you're calling back the
right amount of information all right so
this is just a fictitious demo company
that we have you can see your users your
applications service principals devices
everything contacts whatever the case is
so here we look at applications we're
going to create an application shortly
alright we'll see the ID client IDs and
the client secrets for those
applications set up o auth excite us
everything is here all right so this is
that graph Explorer doc cloud app net
and I have a resources at the at the end
of the deck that you'll be able to use
as well links for all of these so with
Azure b2b and b2c so b2b is really just
business to business right so it's just
the ability of allowing other
directories to tie in to your directory
so you can do that all via the settings
in Azure ad there is no additional
service that you have to sign on to or
an additional cost it's your going to
consume on a monthly basis Rob it's
really just going in setting up those
other directories that your partners
have made you aware of that exist and
giving them access to resources that you
have tied into your azure ad instance so
that's essentially your b2b there's
really not much more than that it's
actually very simple again so here's the
same idea so me to be cross organization
across organization collaboration I need
to let my partners access my company's
apps using their own credentials again
so this is all free with your azure ad
basic instance and it's just really a
matter of how you go about setting it up
the documentation is here at the end as
well in terms of your documentation that
you need to set that up for you
okay so here is B to C so you see at the
bottom I was mentioning the the case
study that was done and this basically
say it says that you know by using Azure
ad b2c we were able to build a fully
customized login page without having to
build custom code and with the Microsoft
solution in place we alleviate our
concerns about security data breaches
and scalability so has anyone used b2c
at all you have yet try to or any issues
you had multi-tenancy okay and we can
talk about that towards the end anyone
else know okay so b2c again where I
showed you in the portal it's basically
just checking that checkbox the creation
time does take a little longer all right
so I have my b2c instance here I might
be to see domain I'm going to go into
here and we'll be able to look at the
differentiation that we see between the
two all right so that's my profile
okay
okay so here you can see you can begin
to customize your branding you can
manage all settings from here you manage
your b2c settings bring that up you can
go in basically what you have to do is
you have to go into each social provider
Facebook LinkedIn the Microsoft account
create an app and each one of those
providers grab your app ID your app
secret come back into the portal add
each one in and then essentially when
you hit your as your be2c login page
those are already going to be available
to you so that can be done within
minutes you don't really need anything
additional than that you don't have to
bring up any of your applications you
don't need to set any additional
security that's already available to you
good
see if this will come up again this time
so basically when you're going in to
manage the b2c settings it's essentially
what I just mentioned it's the ability
of going in and tying in your b2c
instance to all the other service
providers so here we go
loading now
okay so if you go into identity
providers okay so what's the click on
and you can just basically name whatever
identity provider you're gonna be using
so if it's gonna be Facebook you can
name a Facebook or if you have any
naming convention that's specific to
your organization that you want to stick
to you can do so there but here you go
into your at any provider type you're
gonna select your Facebook for example
once that's selected you come in here
say okay to save it and you simply enter
your client ID and client secret and
that follows through to each one of the
additional social providers as well so
that's really again without going we're
going to be going a little deeper but in
order to get b2c stood up that's really
all that you need in terms of
consumption and pricing there is a limit
of up to 50,000 users it's completely
for free on b2c so you can start today
and enable any type of application and
with the number of users that you have
in your instance cannot surpass 50,000
once it does then it begins to get
charged so it's pretty cool before when
your first came out it's still in
preview but the first preview was $50 a
month flat so that has changed since so
you can't start this today so what we're
going to be looking at those
specifically is a different scenario
where any parts back up okay here's the
me at Real Madrid case study and the
solution that we deployed so here you'll
see on the left is there as your b2c
instance if you look at the URL you can
see their domain name there all right so
it's really real mdro Microsoft comm so
that just automatically gets powered up
for them they've completely customized
their login page which you can do and
they're currently using Facebook and
Google as alternative social providers
this is the mobile interface again this
is a completely custom iOS app that
you're seeing here but same idea you
create your views and tie them into your
b2c login and it's it's up and running
for you it's actually quite quite simple
and this is just there
client ID and the scopes that they've
requested for Facebook so the
permissions of data that they've
requested in facebook so here they're
requesting the public profile and the
users email address and then they can
capture that information and then that
will be brought back into B to C and
they can store and B to C or story in
the external data source what is the
first provider oh the fourth oh here so
they only have Facebook Google this is
this is Corey as your ad and that was it
you see a force I'm sorry oh yeah so
default yes they have user accounts on
Azure ad correct so that's how b2c work
so b2c you're tied to your own ad domain
that you have there so you can create
accounts everyone all the accounts
actually get created in AD what happens
is when they select Facebook it goes off
to Facebook grabs the the slash meet
what's called the slash meat endpoint of
their graph API grabs the users data
which includes the public profile that
they're requesting here includes first
name last name if you want email address
it's an additional scope and we'll look
at the Scopes in a little bit do you
have to request but in the public
profile you get first name last name
nickname the profile picture and gender
that's by default so what happens is if
someone comes here clicks in Facebook
clicks on Facebook it goes through b2c
does the actual oauth handshake
validates that it's that user so if they
click on Facebook and they have not
logged in to Real Madrid yet they're
gonna get this pop-up it's gonna say
okay continue is Nick the reply URL
that's set in Azure ad b2c will
eventually return them back to the
homepage of Real Madrid now logged in
and then they already have access to
that users information and they can call
the graph API with the access token that
they received at any point in time from
within their a solution and that's
stored in Azure b2c so you can store it
anywhere you want but a lot of people
just opt to store it there make sense
another question sure
Yeah right and you get back a token and
then you would say and then you keep
database entry and your own system which
said that this period maps and I've got
some additional metadata about that and
that links so when they come in via
Facebook or Google or whatever I'm going
to get that same poet and then I map it
into my systems right so so the oauth
2.0 handshake process works as follows
you go and you're you initially hit your
facebook login with a with a code okay
this is a long string that validates
okay this is official request that's
coming in from an application that we
know of so here's the code now once you
have the code and the user actually
passes here now you can change that code
for an access token the access token has
a time to live the Facebook ones I
believe for 24 hours okay and then you
can request an extended access token the
lasts up to 60 days for Facebook okay
now the access token should or should
not be persisted it's upon you and what
the policies of the solution you're
building as to whether or not you want
to persist them and store them in Azure
ad or in a third party you know storage
provider sequel Azure but if ya so in
your code if you just stick with what
Azure be to see will gives you you'll
get the the 24-hour access token which
will give you access to this user
information for Facebook makes sense but
if you're gonna need that information
for a longer term then from within your
solution so for example let's say here
if they wanted to they could say after
the user signs in comes back I have an
access token now we can request an
extended access token but that's on you
RN that's on the end of your solution to
request make sense and then with that
extended access token for 60 days you
can always call the graph API endpoints
of Facebook to access this information
so that you have the latest and greatest
never have the concept of persisting
your own data about that user you'd
always reach out to the graph it's it's
up to the developer and the requirements
of the solution I personally in mine I I
do per system for performance purposes I
do per system but then I also persist
the last login date so that I check so
depending upon what the requirements
call for if it's let's say if it was you
know greater than a week from the last
time that they logged in I'll go back to
Facebook and get the latest yeah exactly
exactly and through the up to you if you
want to do that or not the information
typically they're requesting here is the
core user information first name last
name email address the profile picture
the profile picture will is a URL that
will always go to their profile picture
it's not just like if I have a profile
picture today and I change it tomorrow
it's still gonna be the same URL that
they add the day or API gives you right
you can and that brings up an excellent
question of the next topic we're gonna
get into
but ya know this is great and I'd rather
questions during the session rather than
not being able to ask okay so we're
gonna government portal we've got health
information in it yeah and it's got my
health record on there so I'm authentic
getting using Facebook how am I going to
get associate that back to my government
record awesome so when I was saying that
all the information eventually goes back
to a sure ad what happens is you get a
UPN that's created behind the scenes in
Azure ad for this Facebook user okay and
that Facebook ID gets mapped with that
UPN that's persistent the Facebook IDs
not going to change your UPN is not
going to change for that user put a key
in my database which is my UPN exactly
yep yep that's
so the UPN has come the old poet I think
it's exactly yeah okay cool I understand
that any other questions before we go
further in over here
yeah yep right you know education on -
is your idea as opposed to just putting
it on your own a great question and that
tomorrow there's also I'm gonna answer
it but there's also a session tomorrow
that I'm doing that specific to face
book development and the options that
you get within the Microsoft stack of
stack of technologies so the main reason
is cross-platform usage so for example
if you spin up a new MVC application
right and you go into the web config put
in the Facebook app ID client ID and
client secret there that's great for
that application so here everything is
stored centrally with Azure ad b2c it's
all centralized so if you have a
solution such as real madrid where you
have a web app iOS mobile app android
windows and you're doing the same thing
across the board it's just talking back
to B to C so that scenario is great for
that single application this is more for
a cross-platform solution if you had a
single API as your authentication end
points instead of invasive you you add
your own wave IP or end point it does
with indication for all of your apps and
effectively yes I mean the same things
and that's exactly what we did for
another solution that I'm gonna talk
about shortly we created an API app in
Azure ad that had using a dhow so Active
Directory authentication the.net library
so used a dal along with the azure ad
graph API so we had methods within our
API app that did the login requested the
access token from Azure ad requested a
refresh token such that it's called an
azure ad so you can do it all you can
put your data logic layer in front of
everything else if you'd like to so this
kind of strips that away from you to
give you a very simple way to get up and
running but yes that's that's definitely
one way that the majority of
organizations are going with yeah
so the refresh token it's a little bit
different so let's say let's say you
have your own API app you want to secure
the API itself okay so you want to
create an application object in Azure 18
so I have this API but I want to secure
the endpoints of the API so that no one
can call it directly and just be able to
call the payload okay so what typically
happens is you might be in the in the
app this particular app was an IOT based
app which it would pull vital
information that was coming from the
Microsoft band via bluetooth over to the
iOS app up to the cloud so that app runs
in the background so the token that you
get when you have your own Olaf provider
in Azure ad it's for 60 minutes for one
hour so because this was an ongoing
thing it would check the expiration date
and time of your current access token
and if they had surpassed it will call a
refresh token all behind the scenes and
the user would be completely unaware
it's happening yeah and then that that
refresh token again is good for another
hour and that process just keeps going
so that's the equivalent of you having
your own graph API right so Facebook has
theirs as your ad has theirs now your
solution has its own as well okay and
you want to secure that API so that's
why you would do that anything else all
right we'll move on quickly
all right so the azure ad b2c directory
where D saw I do want to show you one
thing though as it relates to the
attributes that we just talked about and
storing those attributes and the
Facebook ID etc so let me just bring
that up already had this open okay
so if we just closed this out let me see
how I get there so here we see user
attributes okay it's loading okay so
these are the user attributes that are
available to you in B to C okay and you
can add custom user attributes as well
and assign a particular datatype to them
and as you look and you scroll down here
we'll see right here identity provider
okay so the social identity provider
used by the user to access your
application so that's where their ID
gets stored so if they log in with
Facebook their Facebook ID gets stored
at that attribute right there so you
always have that mapping already
accomplished for you here without having
to do it on your own no no no no so it
actually it actually puts it into a JSON
string and they're there they're you
know yeah so you can D sighs it and see
the Google one see the Facebook one etc
yeah but you also have to make sure that
in your logic when a user does come in
that you're checking both IDs to see if
there's anything related to it typically
what you should really do is always
associate any type of anything that's
getting stored in relation to that user
in your application should get tied to
the azure ad identifier yeah because
that's your single source of truth for
your solution all right
okay somebody's he'll be doing on time
get about another five minutes all right
I'll go by here real quick so what I
wanted to talk about specifically that
people tend to have an issue with in
terms of getting started is the ability
to create a consumer ready solution with
Azure ad for free what you can do but
there is a little bit of customization
that you have to implement for that so
the azure ad graph API as we mentioned
provides programmatic access to Azure ad
to the rest endpoint applications can
use the API to you know run all crud
updates and court operations the graph
API supports the following common
scenarios but there's much much more
creating a user getting users detailed
properties updating a user's properties
checking your users group membership
this right here is a link to all the
endpoints of the API and what you can do
with it application objects so within as
your ad okay one thing that we're going
to do shortly is we're actually gonna
I'll start that up right now
we're going to create an application
object in Azure ad that's representative
of a new application that we're standing
up right so if I go to my NDC domain I'm
gonna navigate here to applications
alright and you'll see that what I did
is I created another applet by default
you get the graph Explorer which is what
we've used and the office 365 management
and then I added a third which is a web
app that we have available on github
which provides all the crud operations
and all the graph API endpoint
functionality for you up you know and
ready to go
and that's in my resources slide towards
the end you'll be able to use so I came
in here and I said okay this is going to
be running from visual studio so it's
gonna be localhost so I'm gonna
configure it with a local host URL
alright so my sign-on URL is localhost
with the port of four four three two two
okay that's my client ID that gets
generated for it there's my key I just
have integrate two keys but you can just
have one alright that's the app ID URI
where people are going to go
and then that's the reply URL so after
you authenticate it's going to send you
back to the reply URL so this is where
we talked about if you have an API that
you want to secure down using the common
dotnet scenario of using authorized
attributes etc and you're in your
methods basically here I'm just securing
access to Windows Azure ad so I can
access graph API from this application
but if I also wanted to give access to
my own custom API in Azure that I have
stored in my same subscription I would
basically come here say add application
it would come up in my list of
applications I would add it and then I
would say what kind of access I wanted
this application object to have to that
API so that when I'm doing things now
from a programmatic perspective in the
application I'm doing it on behalf of
this application object right makes
sense and I have an example which will
make it a little bit clearer
all right
so when you secure a any type of
application via an application object
you have two options I'm going to move
forward and move back real quick so you
can do a native app which is essentially
creating an OAuth provider or you can do
a core web app where it's just securing
the entire web app the full bounds of
the web app so anytime anyone hits that
web app and they're authenticated
they're gonna get redirected to our ad
login it's going to reply URL send them
back with the native API I mean with the
native app setting this right here is
actually going to be you creating your
own ooofff provider for your app so it's
the same scenario as if you were your
own Facebook and Facebook has their
graph API and you need an access token
to access that API in this scenario
you're also going to have your own API
in Azure this application object is
going to stand in front of that that API
and whenever someone tries to hit an
endpoint it's automatically going to
check if that access token is alive or
not and if they need a refresh token or
wherever the cases and then we'll give
them access if they have access to that
particular endpoint for whatever payload
they're trying to call ok so again so as
your ad has its graph API Facebook has
its graph API google has theirs but now
you want to have your own as well for
whatever reason you want you have the
combination of all the user profile
profile properties properties that
you're persisting in your data store but
now you want your partners to access
that information but they're doing it
now through your API which there was a
question you had brought up and then
you're securing your API down there ok
and then holistically you have a
end-to-end solution where you have
either ad b2c built in versus just
having what he had mentioned for example
why not just stand up an MVC application
where I can secure it with Facebook
which is good but it's just for that one
application okay so here right here is
the link to the github repo for the web
application that I secured
I actually had the web application
running on my machine in Visual Studio
but we have the switch machines because
the monitor issues but this will go out
to all the attendees so you can download
it like
and you just basically go in add in your
client ID and client secret for azure ad
and then run it and then it's completely
functional for you and you can run all
graph API cred against it so we just
talked about that what I want to really
talk about is the disk or limitation
where for you to get started and create
a solution completely for free using
Azure ad basic with social identity
allowing consumer based accounts to come
in but you don't want to begin to incur
charges so that's a scenario that we
encountered when we were building out a
most recent solution for a large
hospital or series of hospitals in the
United States called Dartmouth code
dartmouth-hitchcock and they were
building a new solution called imagine
care which kind of changes the way we
look at health and wellness right so
it's all about the future of how any
SmartWatch will be able to send
telemetry up to the cloud and then back
down to physicians to be able to see
your current state what's your vitals
looking like what are your you know
number of steps that you've run what's
your you know history over the last
month looking like any Bluetooth devices
that capture blood pressure and weight
etc they can all come in via the Apple
watch to the iOS app up to Azure
so they wanted to implement the solution
but B to C was already was still in
preview and they were kind of concerned
with going you know going on to it being
in preview so they wanted to use Azure
ad basic but allow social identities and
and allow a consumer based accounts so
here you'll see if you try to create a
new user in Azure ad via the portal you
can create a new user in your
organization a user with an existing
microsoft account a user in another ad
or user in partner companies but if you
notice you can't just create standard
users like if I wanted to come in here
and add Nick Panero at company XCOM as a
user with access to my ad or to add a
new user in I couldn't do that
so the solution we've come up with and
this is the code that we're going to be
releasing that I mentioned earlier on in
the session this will be out next week
so it's it's called getting started with
Azure ad basic with consumer identities
and so what I'm gonna do is run you
through the process of how we went about
creating creating it so how we simulate
the whole a or b to C scenario in a free
offering okay so what do you do when you
need a solution for dev test scenarios
or it can be for production you want to
release a beta version of a solution or
you want to release a production version
of a solution for less than the 500,000
users including external users and your
budget is limited alright so this is the
imagine care solution that I was talking
about
okay so enrollment basically what you do
is using the azure ad graph API and
you'll have a complete application
that's associated with the solution as
well you'll be able to create a new user
and then what it does is it generates
that user principal name behind the
scenes with the prefix of the users
email address and you're a jaray d
domain right so this is what your user
was going to go and register on your
site with okay in the background it
creates this and it stores this as their
email attribute okay the difference is
when they come in to login now the user
is going to come in hat is be presented
with login and password so the user is
going to come in and log in with their
consumer based account right so Nick
Panero a consumer comm the logic of the
solution looks up that UPN based on the
entered email address right because we
had that mapping there now in the
external data store you it also comes in
an azure database that automatically
gets deployed out as well and that data
store does the mapping so as you can see
where we have it - it's a kind of a
duplicate offering of attribute a C but
it's more to allow you to build out dev
test scenarios publish out beta versions
of your solution without beginning to
consume B to C kind of costs so using a
dal you can get that access token that
you're going to need if you're you know
if you're securing a API and get the
Refresh token as well
there's an Associated API app so the
solution comes with a web app an API app
a sequel Azure database obviously you'll
need a an instance of azure you know a
basic free instance of azure is fine and
then your domain that's already built
out and all the directions will be there
for you know building the domain if you
haven't done so yet and then the
identity management so how do you go
about managing when a user forgets their
password or whatever the case is so it
follows suit so it's the same idea we're
on a forgot password operation the user
enters their consumer email address so
they forgot password tool the logic
generates a unique identifier to manage
the request so that's just a good
that'll follow through that with that
request all the way through it looks up
the UPN of the user based off of their
entered email address so now they have
the UPN okay they have the password now
they can actually authenticate to Azure
ad and that's what's actually they are
authenticating with but from the user
perspective they're logging in with in a
consumer account they registered with a
consumer-based account your your your
profile is being stored in Azure ad
basic completely for free so it's an
excellent solution as you're preparing
to go to B to C if you want to send a
user a reset password email okay one
thing that is important this is really
the kicker in this entire deck this
comes down to this PowerShell script
what it is is that with Azure ad basic a
user can change their own password using
the self-service password tool but in
your own custom application if you try
to use the reset password endpoint of
the graph API okay because your applets
being done on the basis of your
application object you have to set you
have to set this particular setting here
where it basically gives company
administrator to your Azure ad
application object so now that that
application object has complete access
to all of those users and all the
properties associated with them
including the password property so it
really comes all down to this and this
is this is the kind of nuts and bolts of
it all so this gets run immediately when
you run the application and get set for
you but this is really the kicker just
want really focus in on that okay and
then here you can just base the creator
view where the user can enter a new
password if they just want to reset
their password so the prior scenario was
a forgot password scenario this is right
here if they just want to reset the
password it's fine because they're going
to be doing so as a logged in user it's
not a problem all right so this is that
endpoint that I just brought up and this
is a patch that you have - it's called
in the solution an HDTV patch it's
called to that endpoint and changes
their password here this is all
encrypted etc but that's actually what's
happening in the JSON of their user
profile property you need to modify this
by default you cannot without running
that PowerShell script so once you do
then you have the full capabilities of
at rabida see in a dev test type of
scenario so these are all the resources
of everything I brought up here you have
a dal you have the graph API QuickStart
all the different operations the graph
API the reset user password that I just
showed the HTTP patch for it the full
API catalog for a graph and then here is
the web app that we secured earlier on
in the session if you want to just get
that down that has all crud operations
for graph API so you can get up and
running with that and deploy that out if
you want to and it's a good management
interface for internal usage alright so
I thought so next week we're going to be
releasing the code for for this solution
for the consumer identity solution so if
anyone wants to get it you just follow
me on Twitter or if you subscribe to the
website I'll be sending out a broadcast
email once that comes out next week so
as I said we've already used it for a
number of different scenarios to get
people up and running and it's a great
kind of proof of concept for you to get
prepared for going over to be to see
alright any additional questions and you
all the running out of time okay but we
got some good questions earlier but yeah
so I have another session tomorrow it's
called Facebook development with asp.net
and Microsoft Azure that really dives
deep into all the touch points of azure
and Facebook so that's tomorrow I
believe at the same time yeah all right
thank you guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>