<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Head to Head: Scott Allen and Jon Skeet  -  Scott Hanselman | Coder Coacher - Coaching Coders</title><meta content="Head to Head: Scott Allen and Jon Skeet  -  Scott Hanselman - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Head to Head: Scott Allen and Jon Skeet  -  Scott Hanselman</b></h2><h5 class="post__date">2016-08-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/H2KkiRbDZyc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I think I'm on yeah hello
hi friends how are you was very lame
Australian yeah it's been a drinking
party last night
cool thanks for coming by this is called
play-by-play this is something that I
rub Connery kind of started we were
going to have actually a slightly larger
panel we can try to get Rachel Reece to
join us she's off doing F sharp at an F
sharp Meetup
so you're gonna have to settle on John
skeet who happens to be what is this
this is your high cycle this is my
profile page profile page you excessive
a meager eight hundred eighty four
thousand reputation putting you as the
number one contributor on stackoverflow
if you died god forbid how many years
would you remain the top person on
stackoverflow as a desert corpse uh so I
think I would probably hit the rep cap
during the week you would still be
hitting the reputation cap well Dead Eye
for a while at least yeah sure during
the week um so yeah I get a load of
votes even if I don't post stuff because
I have a lot of all I've got thirty
three eight thousand answers so that
surely they get you've lapped everyone
else you're being you look far behind
but you've actually got in Mario Kart
you're several laps ahead I think over
the weekends within a year I wouldn't
rep cap that was Brian but I've
certainly hit the red cap every day
since June 2010 excellent so I would
encourage you to go out and Google for
Scott John skeet jokes fast facts
John skeet facts yeah um you know for me
with Chuck Norris right our greatest
American Hero uh yeah there we go Chuck
Norris is one of those great heroes
where they tell jokes like you know when
when Chuck Norris does his push-ups he's
not pushing himself up he's pushing the
earth down
there are a series of those around John
skeet as well these ones over users do
not mark John Skeets answers has
accepted the universe accepts them out
of a sense of justice I should switch to
K school so k Scott changed his name to
Scott to be successful in the Microsoft
world remember years ago but it turns
out that it's worked out really great
for him because he is a top Pluralsight
author and the author of a very popular
blog called ode to code and many of us
learned asp.net
from ode to code and from K Scott Allen
so big round of applause for John skeet
and case
you definitely go and check out their
stuff as well as a great was it an
article it was an e-book on the on what
you need to know about Ekman script that
she did yes oh look its eBook basically
just for the Kindle so a Kindle book
that he recently did on what every
developer needs to know about eccrine
script so check that out okay so the
idea here is that Rob Connery who is
usually the the person that plays my
role goes to Stack Overflow and picks
hard questions and then asks these kind
people on the panel to answer those
questions and what they think about them
so and then wackiness ensues so we have
a whole number of a series of questions
why don't we bring up the the first
question and we'll see how each of these
individuals are going to zoom in on that
real tight okay
a little light reading for us here so
what is the difference between running
iqueryable of tea versus ienumerable of
tea and then there's a very nicely
written example there and we'll both
include deferred execution right there's
that thing in link where it doesn't
really happen until it happens there's a
bit of a Schrodinger's cat aspect to
link that can be a little bit confusing
who wants to go first
can I get fest with a change to the
question I'm not actually I'll edit this
I when you're gonna actually edit the
highly voted question I just got just to
show you that's exactly how I wanted to
start this show was you just going into
admin doing actually the question is
wrong
the question is right but this is not
how you should write either of these
queries basically so this is these are
written as query expressions in c-sharp
introduced in c-sharp three and that's
three lines long and the equivalent of
the first one I love that you're doing
it in a text box without syntax
highlighting thereby increasing the
legend so that's one of the great things
about seashell about Stack Overflow is
you get much better at being able to
write code that will just work first
time really without yeah I sometimes
there are typing what is the little
thingy the little thingy that goes see
and then an arrow is that Andrews
operator or what is that call lambda
expression it's got a lamb but it's a
lambda expression here it's not a lambda
expression if you have C sharp 6 stuff
if you have so say we were in string
write a whole app here
uh is that called a hash rocket or is
that another thing no idea about never
heard of hash rocket I think that may be
a completely different how do you
pronounce that public bool is even
length blah blah blah so I would just
say goes to Oz to me it's you taking it
but importantly this is not a lambda
expression it's the same same syntax as
Flanders and likewise if we did public
bull equals o get a short object really
really bruises and yeah it's it's a
shortcut for curly braces with a return
so an X as strengths for example all
right this was look the same they're you
different they're different based on
country yeah so lambda expressions are
for delegates and expression trees and
this is really just a shortcut a
shorthand for declaring a property or
declaring it but we all know though that
if you do that in your code it makes you
look smarter to your co-workers so you
say that but it's actually true um so
hey guys 1 so you said that no flight my
suspiciously the way that you said that
was that you said that we thought it was
gonna come but it actually is true that
yeah it's a kind of a complan you said
that jokingly and yes it is true that's
X I'm when I was looking at c-sharp sex
for the first time with no time I'm
gonna let you say something soon I I
when I threw him ice cream delivered I
went through and found everywhere that I
could use expression body members and
got rid of half of the return station
body freshened bodied members so
Beyonce's single this is this is an
expression yeah and it's the entire body
of the member which is a property here
and a method here so that's why it's
called expression body members huh um so
I got rid of everywhere that I could
that had a return statement in no time
and about half of my properties and
methods I managed to make expression
body members and the great thing is it
makes you feel like a functional
programmer this is what I use yeah this
looks like I've had Rachel Reese's not
here to call you out on indie balls okay
this feels like it's Haskell now honest
but no it makes it feel a bit more
functional and if you're a fan of
functional programming you know but
still writing c-sharp rather than a shop
it just it feels a bit better okay so so
the against the it looks a bit smarter
okay so don't those go back to judging
the person that wrote the great so those
are wrong these are these are a waste of
space weight when you could just use dot
notation really we'll call it or lambda
notation these these compiled to exactly
the same code but I find those to be
kind of cooler because it feels like you
switched into another world and you're
writing sequel but not right so there's
there's nothing actually wrong with it
it's just it feels a bit of a waste and
if you just have aware or just a select
or even aware under select I would
typically use this notation okay as soon
as you use joins or let let clauses or
anything that uses what's called a
transparent
identify where the the compiler starts
building up anonymous types for you and
doing cunning stuff so that you can have
multiple this is called a range variable
okay if we anytime you have multiple
range variables in scope at the same
time usually from joins also from from j
in DB jobs mm-hmm
yeah the compiler is doing stuff so you
can access c and j at the same time even
though it's one sequence um at that
point it's a pain if you're doing it in
under expression I gather it all works
because the compiler is just doing a
syntactic transformation from this to
the other format but it's definitely
worth being familiar with linked in both
notations okay so you draw it like that
it makes you better question so now I'll
just cancel this what is the difference
right so back to my query will annoy a
new rule why don't you take it from you
okay okay which we brought this this
mainframe here to uh help us understand
John skeet its advance the first thing I
want to do is drill into what is the
difference between ienumerable and
iqueryable really and so let me back up
for a second I have one side zoom out
some movies here that are from an
ienumerable data source and ienumerable
data source just being a list of movies
and I just want to show you how the
limit operator to good movies to good
movie well yeah I figure out when a man
short fish because I'm very glad you
said that
thank you I knew you had blogged about
it years ago as one of those movies that
had questionable technology it was not
mr. robot let's just say if I can get
this on the screen what I'm trying to
show you is that the link extension
methods the link operators they're
composed of a series of extension
methods that are extension methods for
either ienumerable of tea or iqueryable
of tea so if I have an IMU something
with an ienumerable datasource and i go
up and do a dot on it trying to get this
all on the screen at once
we can see that I'm working against
something that takes a funk of tea
source and int or sorry let's do the
first one a funk of tea source and
returns a bool so basically the way
operator I have to take some incoming
source returnable from that function has
to return a bool and then the where
operator itself returns an ienumerable
and just to switch that over real quick
that was really confusing my life yeah
well I'll make this one working for you
the important part here is that if I go
to movies and make them queryable it's
kind of magically making them queryable
for a second so you're looking to be
clear and make sure I understand cuz I
don't understand you were looking at an
ienumerable thing yes and then you were
looking at the where and what where
needed where being an extension method
that gets spot welded on to an
ienumerable yes and now you're looking
at the same where yes on iqueryable and
i notice that it's got more stuff more
stuff and the most important part part
here to notice is that now I no longer
take I can no longer take just a func of
T source and boo I can take an
expression of fun and that's the key
part
it's func versus expression of func
that's one of the key differences
between ienumerable and I'm not
queryable when you say funk I don't get
a smart yeah well so let me let me show
you a funk is a type let's do this let's
run some code if I build a phone I just
need to know if it's okay to not feel
smart or if I need to know this funk was
introduced into c-sharp is an easy way
to describe a delegate so func takes
from one to sixteen generic type
parameters so the intellisense is
beautiful right but basically with the
fun you're talking about that seems way
better generic type parameters ah rainy
night and that's so I'm going to declare
a variable that's going to point to a
method let's call it foo
the last generic type parameter always
describes what that has to return so I
have to return an in and all the type
parameters that come before that
describe the parameters so I'm going to
receive so I have to take two integers
okay turning on let me see if I
understand so the last one is always the
return to make that a string so we can
easily Dan okay that's great yeah so
this so this is any function yes that
takes two intz yes and return
strength let's prove it can be called
whatever yep call it anything okay yep
so it's just a legit it's kind of like
an interface but it's not it's just an
agreement that you hand me a function
that does two intz and returns a string
okay that's our agreement it's not in a
form only ways the delegate is like a
single method interface so single method
interface okay they have a few other
funky things like being able to do funky
things sorry so you can do beginning VOC
and stuff and you can combine delegates
together but the the guts of it is it's
a single method interface so if you
imagine that func wa i func of t0 t1 t
result it would have a method saying
invoke that took a t0 and a t1 and
return the result I think that that we
the normally brained feel overwhelmed
when we hear people talking out in the
hallways or whatever at work and like oh
yeah you just take a func a func up an
expression of T and your eternity but
it's like oh I know I'm not the only one
that thinks that I'm just the only one
that says it out loud everyone else just
wants to keep their jobs I think that
being generic doesn't help on that front
as well yeah yeah although generic type
parameters okay so that makes a lot of
sense I think that right there that's
the kind of like take a screenshot and
go home and study that you know I mean
that's a really great example that one
right there you're add so rank yeah and
and that's using a lambda expression to
sort of sort of declare a method in line
mm-hm but equally Scott could have
created a method that that had the same
body and say hey create me a delegate
that right points to this method okay
yeah I could have pointed it to show
some method the where that comes off of
or hangs off of iqueryable is a lot more
sophisticated allows a lot more
flexibility than the one that hangs off
of ienumerable so they're sort of jewels
of each other okay we've talked about
the one from ienumerable which is
delegate so that's I've got some code I
can execute the code yes then there's
expression of some delegate type like
funk in this case yeah and and that's an
expression tree okay which is no
the code but a description of the code
so it's coders later yeah so what's
important here is that if I have a funk
called the in a variable called add this
is still compiled into code that will
execute without me doing anything so I
can just invoke add and the compiler
will have generated il directly into the
assembly it will be there as if you've
written the method you okay so to be
clear the the instructions that
represent the adding are they in this
case the concatenated of those two
things is compiled and it's compiled
ahead of time and it's available to be
called like any other function out there
in the world absolutely okay it's not
being different execution of that thing
isn't being deferred it's just simply a
funky way of describing a function right
although execution is sort of deferred
in that you're declaring the method yeah
you're not executing it immediately
until until it's got calls add right
you're not calling the method understood
and so we'll talk more about deferred
execution in terms of linked stuff right
a minute okay yes but the difference
here is where Scott's got an expression
of that in fact why don't you add a
console dot write line Andy yes and then
we can see the difference so let me
comment up the slide yeah you see we can
no longer doing in console dot write
line which does a replied through string
yeah on a an expression from the event
of in desert hook can you do it right
line on the funk or just the expression
so yeah you can as you can and it will
give you the name of the method that the
compiler has generated for you behind
the scenes you it when that right line
on each one
let me get followed let's just go back
to add for a second okay and I'll show
how we can get both here you've got a
func that takes to insert returns a
string he does a to string on the thing
right Oh actually yes so it looks like a
yeah we're secure stuff that we see in
the call stack some traps right so it's
not func doesn't override to string so
it gets the exact thing that object dr
string gives you H is just that kind of
makes sense though because that looks
like a function signature that takes
those two things yeah there's no
information about what its gonna do
right ah there's no one for me
and that like really really important
and the important part is when you rap
when you rap a funk with expression you
no longer generating executable code you
can think of the c-sharp compiler
creating a data structure that describes
the code so I can no longer at this
point invoke add that's not going to
work
mmm can I I can't invoke it not yet not
yet I write Li what I want was so one
was so and this is how technologies like
entity framework and linked to sequel
word right you feed them expressions and
they look at the data structure and see
that oh you were calling dot where and
order by and dot select let me translate
that into sequel it's an easy way for
them to do that but one thing I could do
here is I could strip off the expression
part of this and get back a funk of int
+ int and string once my fingers start
working let's call it a D it's ad
executable by walking up to ad and
telling it to compile itself compile
that expression and that would actually
give me code out so now then funk pops
out of compiled yes exactly so if we
console dot write line ah-ha
intellisense yeah CW no or console dot
write line CW there we go write line
both of those let's go ahead and execute
you know that's legal code run this so
an expression gives you a very rich
description of the code that you wrote
yeah basically gives you the code back
on right yeah whereas just having a funk
is a is an opaque block of compiled code
you know all I know is it's a function
that takes two integers and returns a
string so you can't go in the other
direction you can't take a funk and
build an expression tree from it and you
could you could build an expression tree
that just calls the method but that
doesn't give any information about
blocks in there let me see if I've been
paying attention as I may get this wrong
does that mean that I query ball can
take funks then and I enumerable takes
function iqueryable takes expressions
thinking big that's the big difference
and the reason that we saw when Scott
showed intellisense of we're on an eye
queryable you saw four things instead of
two that's because I query rule of T
inherits from my innumerable of T so you
still get to see the ones that take func
but you can kind of ignore them for a
moment you if you're using a query
you want to be using expression trees
and in fact if you don't use expression
trees if you if you have let me edit
this again so yeah so if we had
iqueryable customer all customers I
don't know wait scrolling down that's
very very weird that is suspect yes your
company our browser so that's your
company's open and your company's
operating system uh so if we did a funk
customer predicate is predicate a
familiar word to vocalist it's something
that our judges whether or not yeah it's
like a filter let's call it filter it's
a it's the where what equals what part
right exactly yeah so it's something
that you say does this match the
predicate or not right right yeah um so
the matchy expression it's a matchy
expression a thing that I really feel
like I'm providing value the downside
about using the term filter I found when
writing code is a filter sounds like
it's something that removes things
whereas a matching expression thing is
something that matches things it's a
more positive thing and we want to
include everything where it is better to
be more positive yeah and that's why I
say affirmative that work it's much more
positive so if we if we have suppose we
weren't caring and we just just did
matches equals all customers dot wear
matching expression thing ah okay so
that's where you would ordinarily put
that thing and then you just broke up
what could have been good at - right and
my reason for doing that is to show
something that's bad so the fact that I
queryable of t extends ienumerable of t
means that this code works yeah but it's
not doing the same thing as a
what we if I had the expression version
they behave radically differently right
because that one
the you you've pulled back if you
haven't released the arrow yet you've
kind of had it held there yeah well you
both houses they're held so these are
both deferred so executing either of
these bits of code will do nothing it
will never wear that place right uh
until you start using them so far count
you're saying even at the point where
usually dot wearing you pass it in and
it's still waiting for you to go to the
first one exactly this is creating a
query okay it um and it's not until you
need some results link is lazy it will
wait until you need some results before
it does anything so if we do match his
dot count and matches dot count there
okay yeah so these now look these these
are no longer deferred are they
identical and no you this one is really
nice
this one will entity framework I'm
assuming this identity framework or
something similar will say you know what
you want to do you want to call execute
scaler
of from customers where customer dot
city equals whatever and it will do all
the work on the database and return you
an integer this version will say ah okay
you've given me a funk a delegate I will
fetch all the customers from the
database all the way to your local
machine and check whether each of the
matches against the predicate you've
given because hey you've only given it
to me as a delegate I don't know what
that means I can call it but that's all
I can do with it and I will count how
many match so clearly this is bad news
you don't want to call the enumerable
stuff on I queryable usually but that
sounds like the kind of thing that
people do all the time and then they
complain about darknet sucking I would
say not all the time because normally
you're using one of these or you're
doing it all in if you if I did where C
goes to C dot city you
balls that was it even then that would
do the right thing because overload
resolution would say hey it's an eye
curry rule of T there's something in
iqueryable that works with this I can
convert so interesting and slightly
nerdy interesting thing about this this
expression has no type okay
it's a lambda expression it doesn't have
a type it is convertible to a funk or an
expression of funk depending on your
needs indeed and overload resolution
says can I do anything with iqueryable
if I can't I'll go up to ienumerable but
hey we can do this we'll work with a
queryable because I can convert this to
an expression tree yes it will then do
the right things in other cases if if we
had something in this case it will look
and say is there an iqueryable method
that takes a funk no and I can't convert
from funk to expression of funk so okay
I'll look at the ones the extension
methods on IMO let's do it in the only
way I know how which is bad exactly I'm
gonna cancel again before accidentally
save the changes do you have the power
to do that like are you like a super
it's like a super user world that you
live in it's a court it's not that soup
easier I think gonna say you can't hit
save because it'll be bad well I need
you have the power to change that
question and we write history most
people hey it's like 3000 or something
to to edit without anyone can try to
edit this and then someone else would
say oh no oh I do not think so I just oh
I just broke 3000 oh well there we go so
you could probably edit without without
anyone okay
other people can roll it back across all
right right i I'm not sure whether we've
answered this I have no idea yeah what
the way that I think of of i enumerable
though is that if you're just going
forward then use ienumerable and if you
really have to ask hard questions use
iqueryable uh if you just want to go
forward and want to look at everything
that you get and look at everything you
get then yes ienumerable is is the way
forward but it depends there can be
times where
you want to split something and do some
work because it's work that can be
expressed in sequel and with our new
iqueryable and then you can have an
called dot as enumerable halfway down to
say right don't even try it and convert
the rest of this into expression trees
because sequels not going to handle it
so say you wanted to find all the
customers who have a hash code of zero
hey well yeah hash code doesn't exist in
sequel it's a fairly meaningless
question right but you would do it you
have a run it on every single one right
so there you might want to sue all
customers where the city is city and has
a hash code of zero so you would do dot
where the stuff with the city dot as
enumerable run the rest of it locally
and then dot where again for the second
pass of the filter Gaja last question
who is Stack Overflow user oh I know
he's got six thousand rep is that a
person yeah
or is this one who got deleted I know
that just someone without much
imagination
welcome they're in the top 6% of Stack
Overflow but they haven't been seen in
four years because they asked 50 they
asked a hundred and nine questions some
of which I suspect me why that in the
context of Stack Overflow reputation
long tail is long long time so the
question that we're looking at has six
hundred thirty five votes ah
so questions three thousand rep to stop
its bullying them all these years later
yeah yeah and the question that has I
don't know how much records out he noted
no code asked question on Stack Overflow
the best question we can search money of
all questions of all time why is it
faster to process a sorted array than an
unsorted array because it's already
sorry
but process as in so all they're doing
is something I get reputation just then
okay do you want to answer that question
aren't you no no no hell no no it's been
answered with something that's got 22
other this is this is Eric Lippert I
think he's long enough to keep your nose
pictures of Kieran's or something Eric's
got some fantastic on season Eric
Lippert yeah yeah all right cool right
so that was one question in half an hour
and I thought had one more thing to fall
plio if you don't mind we'll just have
the whole thing be the one question so
in a way I thought the question was kind
of the wrong question to ask also not
because of a difference between
ienumerable and iqueryable which we just
spent what 45 minutes on and we have
five more questions together or
something but it really depends on the
operators are you using so i queryable
ienumerable they can both offer you lazy
evaluation or deferred execution it
really comes down to what operators
you're using against those interfaces so
if you go to the MSDN documentation
every single link operator will have a
description of its behavior and it will
say this operator offers deferred
execution if it's a lazy type of
operator or not so just to demonstrate
that I just want to show you I have a
link query here that's going against
enumerable and I'm using three arbitrary
operators none of them really have to be
there but I'm going to I'm going to
filter something I'm going to take just
ten results and I'm gonna do an identity
projection right so three different
linked operators but I just want to find
out when is this work actually being
done when is the ID of a movie actually
being interrogated to see if it's less
than 100 and I'll do that just by having
a console dot write line hey we're
reading the ID right so now back out in
the program let's just get all the
movies and here's the key if I see start
for each execute if I see that output
before I see that I read the first movie
read the second movie read the third
movie right that means none of that work
was actually done when I called get all
to get all was just again pulling back
on the arrow but right actually exactly
exactly
it's not gonna happen until I for each
so if I run the program real quick
I can see yes I'm starting for each and
then I
interrogate an idea of one thoughtless
starwars IDC like sure they get all
didn't really do anything other than get
ready right at all in a sense it's also
sort of building a data structures
building a state machine is going to
execute when I start trying to pull
things through release the arrow I
notice how that output is interleaved so
we looked at the first movies identifier
and that movie got to go the whole way
through the processing pipeline I got to
write it out and then we looked at the
second movie and it passed the filter
and all of that we wrote it out but then
things change so I can still return
ienumerable here but if I use an
operator like to list to list if you
look in the documentation it does not
offer deferred execution it's what we
call a greedy operator it has to produce
a concrete list result so materializes
the results a little bit writing you
mate yes so the output here is greedily
we went through we looked at every
single movie put everything together and
then built a list and memory and handled
that back to get a reader so does that
mean that if we were using any framework
or something like it and we were not
thinking and in some place we put did to
list in some place we didn't yeah you
would affect our performance and might
not even realize it you absolutely could
you know and I've run into that problem
in big web applications where developers
will do a to list because they know
they'll force it to execute but then
they'll do it to list and pass it to
someone else who does a to list and just
kind of carries on the other thing to be
careful of is there's another category
of operators so let's get rid of the to
list and I can see that I'm doing sort
of the least amount of work possible
here I start before each and then I look
at the movies but let me add an order by
and let's say we went to order by given
a movie well order by the movie title
the defaults ascending order and the
output now would be slightly different
before so we're stole the phone it had
to go and read everything to do exactly
we we still didn't do anything until the
for each tried to execute but once we
started once we tried to pull that first
item back order by is known as a non
streaming operator it's not allowed to
stream data out have to go through the
whole thing which would explain why it's
faster to process a sorted list
exactly
call back and with that I'm done I was
going to very very quickly Justin I
loved it the whole time he was talking
John skeet wrote an entire program so uh
it was just
Scott was demonstrating doing a bit of
diagnostic work putting a
console.writeline in the property in a
property house thing it this there's a
nicer way of doing that um no thanks
that takes a little bit more work once
but it's only the ones I'm gonna go back
over Florida um so own arriving last
extension yeah exactly and so just to
demonstrate how nice link is you
mentioned you've got iqueryable of tea
and ienumerable of tea and there's stuff
on there but there's also parallel query
there's uh a sink enumerable from
systems and extensions a sink or
whatever it is you can you can write
your own link like operators or wherever
you like um and this is just a sort of
everything a lot of people don't do this
enough like you just said you just said
kind of casually with a flip of the hand
you can write your own link operators
yep and and everyone else in the
audience said well you can
but no it is it's relatively easy but
you do need to sort of know what you're
doing in terms of the I took photos
before I put static so you do need to
know what you're doing in terms of
avoiding being greedy when you don't
need to be and documenting sort of
whether it would be greedy or not so we
now have that the main part of the
program is we have a get all that
returns movies we've got Forrest Gump
and big I've got a aware filter then I'm
just going to log what we get to in this
pipeline so I always think of link as a
big pipe but to his toil he said well
this is a greedy operator and this is a
non streamable operator what did you
make so this is a streaming operator
okay
so this doesn't do anything this is
using yield return so iterables in in
c-sharp so this creates a new sequence
so even though this method will be
called when this method gets called it
won't do anything it will prepare
another arrow and when it gets asked for
its first item it will run just until
the first yield return and then say hey
I'm done for the moment here's some data
put me on pause in the middle of the for
loop in the middle of the for each loop
it's returning stuff on each iteration
yes and it sort of dives back into the
middle of it okay um and I don't know
whether we're going to have time to get
to a weight but a weight does exactly
the same kind of thing is actually
building up a state machine behind the
scenes yeah it feels unlikely at this
point that's fine we're on the own
question one so if I run this what I'm
expecting to see is that we'll let's put
something to make it obvious and that
we're look at that you're in there
okay so logged comes out of your your
operator yeah so we expect to see logged
from this what if you put in a console
dot write line in the the way that he
did it in the property as well in name
dot proper in the name yet to see to see
what happens when right so then we would
see
oh this is okay are you upset
it means I can't use an auto prop
anymore yes you really like those I do
especially now they can be read only in
c-sharp six I've only been asking for
that feature for like 12 years
along with using static to be fair
everyone knew that having a read-only
auto prop would be a good idea it's just
they haven't got around to it okay so
okay so now we're expecting
so let's write prop name so I predict
that we will see a prop Forrest Gump
then prop big logging big and then just
big when we get to and nothing will
happen I predict this is the first line
of the output mm-hmm okay so I predict
this first line of output prop Forrest
Gump prop big logging big big and why
and you don't get logging on I don't get
logging on Forrest Gump the clear as we
have it yeah okay so let's see whether
I'm actually right he has to ask if he's
right oh we have hang knows why
name equals value that may be the only
time that that ever have there we go
right so and I've got I've man I've
doing done console i windows + o windows
+ windows plot windows - I lost that I
think I think that's a pro yeah ok
Oh Indies plus you can alt tab but it's
you another app running it it stopped
running it when I hit windows + yeah a
reason super weird that is kind of wait
that's okay okay do it in our minds yeah
um Oh cuz it's reading the key that you
push you said read key in that read line
hmm I didn't do either actually and why
did it oh it did press any key then yeah
because I can't swim had it being just
laughs a couple of those
when in doubt add more that's the right
number fine right uh so oh just minimize
I'm going to fire no just yeah that's
fine right hello is that now readable
okay so that would say big it asks for
four straight three times yeah I do you
know what I put the the where operate to
the wrong way around
I meant to make it only do short ones
it's not any big ones but not big
because that's sure but they're all
doing things uppercut is no you're right
yeah if we do less than five and if I
change it to not print when is - right
instead of query we should print name in
loop
obviously I would normally use
interpolated strings I knew you were
thinking that he suffers he will plus I
was like well yeah shouldn't you use a
string bill that's old-school
not know you want to use Rico I know it
was a joke I was trying to make c-sharp
humor but so yeah so predict fine about
put we get the property call for Forrest
Gump we get the property call for big
twice in fact because the logging bit
needs to fetch the name in order to log
it the string does yeah and then we
fetch the property again because in the
loop we need to call to make a name to
get that and with that so the main point
of all of this which I think we somewhat
lost was that you can write your own
extension methods yes I have a segue and
not not sort of as a gyro segue I have a
thing that Ebert into the stack no but
another extension method that you can
write that I won't write now is a static
tea I don't random
so you can write this so that it returns
you a random element of the source
whilst only reading it once and without
taking any more
just taking a size of one by you you
keep the idea of my current thing that
I'm going to return and you keep a track
of how many you've already read and then
you'll Don the round no no you don't
hold black oh darn it I got to write the
whole thing now I won't get this
absolutely right but I'm I'm using a
double here because I'm going to beat
I'm checking against the run code
deformity says give me the default value
of the standard vote whatever T yeah so
in my null or yeah exactly
that makes sense yeah so this is
something you would not normally do I'd
normally pass in a random
so we're going to keep track of what
we're going to return at the end and
there's our return statement and we say
the probability of replacing what we're
currently looking at what we would
currently return with the one that we've
got in our hands so are we going to do
current is item and we do that if the
next double out of the random number
generator is great to that I want to say
make it less than one over count so it
becomes for some reason slash know about
that you lost the slash I've lost my
slash key go to window run type your
slash copy it in No
okay but the slash key is really do the
clipboard yeah and then paste I have it
there okay I say whoo nu-uh so I have no
idea why you lost slash yeah that's
that's very old one of your extensions
wants it really bad yeah hmm I spotted
that quick mulch yeah possibly so this
is very cool as a way of iterating over
the whole sequence and taking less
taking no more space than it needs a bad
way of doing this would be to call
source dot to array or to list and then
saying alright I have to pick out or
picking one yeah and that would be
terrible if you had a hundred thousand
things in that this is actually a good
segue uh-huh
let's skip over that one dumb question
and go to the random question and zoom
in on this for me okay and by the way
did you know that there's a feature and
I'm going to push down there by the way
there's a feature called larger touch
where you can say use darker larger
larger feedback so then when your finger
is up there they can actually see where
your fingers are code when you're giving
a presentation nice cool what's this
stuff over there that was it's worth I
haven't seen this is this anniversary
edition stuff no no that is
the magnifier thing all right okay sighs
go now whew all right we're good
cool all right so this person is saying
hey I'm migrating a method from dotnet
one one to.net four and they feel that
the implementation of random change so
they pass in a seed value and given that
same seed random not next bytes is
coming back with a different results so
if you scroll down a little bit on
dotnet one one they get those four
numbers and on dotnet 4 they get these
ones and they want to know how to solve
the problem apparently to make a random
4 not reliable predictable Oh make
random reliable so out of interest
before we say anything more how many of
you think it is a reasonable expectation
that you know that this person had a
reasonable expectation okay and as our
interest on Java I think this would be
guaranteed okay to not be random to to
be not random in a particular way so
neither of these are random they're both
pseudo random but they're differently
pseudo random but pseudo to pseudo means
not at all
pseudo means if you squinted it in the
right way so like the way I squint at
Java yeah
pseudo random not at all random so a
pseudo random number generator provides
a stream of numbers or whatever that
looks random to the naked eye but is
actually um there's a word that I'm not
at all predictable predictable based on
it's um it's coming out of our
mathematical algorithms yeah it cannot
be too random right isn't there enough
randomness in the world that they can
just pluck it out of the air I mean it's
that's really there's like quantum stuff
right and if you use secure random sorry
no secure random Java it's a random or
mg cryptography provider right what
switch over you say orangie yeah Oh
wrong number generator crypto service I
thought you said orangie random this is
what you want to use to impress your
co-workers who still use just random RNG
crypto service provider until them yours
is legitimately random yes yeah wouldn't
it be nice because terrorists with the
same kind of interface is this really
random is this the kind of randomness we
can't export to other countries uh
probably so that that will use a
different that can use different random
number generators depending on your
hardware so some hardware has like a
radiation detector in it like mini
Geiger counter that it can use to get
genuinely random stuff backing away from
the parts of the radioactive machines
others might look at sort of heat
signatures of the chip and other things
yeah you're not playing with me no no
that's all I mean it looks at the heat
signatures of the day thank you can be
read on it and it be like and now it's
differently random right yeah so um how
many of you huh see that's of interest
heidi patty yeah so a friend of mine
wrote putty um friend of yours Road uh D
yeah Chuck called Simon - who works on
works in arm in Cambridge he was my best
friend at University of course you were
so if we want to generate if I remember
rightly so look at this please generate
some I me so where's my newfound skills
with Windows Maria please generate some
randomness by moving the mouse over the
bar so you do that and it's generating
entropy so random random bits cuz no one
would ever go and spend the thing
regular predictable category circle it
doesn't how likely is that they'll be
exactly the circle and a little bit of
difference on exactly but always you'll
be huge in terms of the result so you
generate enough and it comes up with
some some stuff hmm and so that's human
generated randomness but yeah there are
various sources of entropy within right
but on a server you have to go and
figure out what's right random around us
so back to Scotts machine RNG crypto
service provider will use a good source
of randomness
why doesn't random just do that because
it's expensive yeah this is like and or
at least an order of magnitude slower
than just using random yeah okay so
should we just not what do we not use
random as why do you feel missing
care like why do they care that the
number change like so must be doing
something wrong if if they noticed no so
it's what they're doing is they're
providing a seed to random so there's
still this word that I can't think
that's like predictable but fancier
sorry deterministic yes right so system
dot random is deterministic you give it
the same input it will give you the same
output and that can be very useful in
tests so say you have a golden
implementation you you're confident that
something is right okay
and it uses random numbers okay and that
makes it really hard to write unit tests
for it yeah I want to check that if I
change the implementation I still get
the same output so I need a predictable
source of random numbers and system dot
random gives you that by ham having
here's a seed it will give you the same
results every time so if I have a
promotion if I run that person's app on
my system and give the same seed I'll
get the same round numbers uncertain so
it depends should we see what your
because it's like well our wait a second
are we generating random numbers are we
just like counting up through PI you
know I mean we're saying I start
marching forward a million numbers and
we'll all get the same values so system
dot random I will take it the seed that
you give it and probably expand it into
a bit more state so it's I think it only
takes a long and I think random has like
hundred 28 bits or 256 bits of state and
then every time you call next double or
next int or whatever it spits out a
number and moves on to another state and
yeah we should all get the same results
from at least the same version of.net
the way I think about it is that there's
this universe of a series of numbers
right and your seed picks one of those
series okay and is this for lack of a
better word is this okay like because I
see people complaining with a claim of
dogmatic about Java claim but whatever
about behaviors like this because they
think that the class called random
should return random so just showing a
fundamental misunderstanding about how
these things work
it is okay that apps that programming
languages computers work this way right
uh depending on what you're building if
you are building a betting site do not
use random right okay if you're doing
anything
where someone has financial or security
gain from being able to predict the next
number then you do not use random you
use our ng crypto service provider and I
presume that there are probably peat in
the extrapolating here since you already
made up that whole story about how the
heat of the thing which I believe but
still I believe um that means that
there's probably like random number
generated cards that I could buy for my
my caught my casino that would be like
hardware-accelerated
random number generator thing all that
must exist right because now that I've
learned all about how random works I
think so and I'm random if you don't
provide a seed it will just take the
current time does that mean that their
seed could be better could you cuz
you're a seed that you could pull out of
thin air that would be better if you
have like a sensor or something ah so
you could get a different seed but the
point of something like our engine
crypto service provider is it doesn't
use a seed and then a predictable
sequence it says each time I will do
something cunning to take genuine times
yeah you can genuinely not predict slow
the next one from the previous and it's
a lot slower yeah so it turns out MSDN
confirms this this this is the
constructor taking a seed and this is
often done when testing apps that rely
on random number generators sure ah
would that be fair to say then that
really no one should be using random
except in their tests no no because you
would use random for something if you've
got some little game that you're that
you're writing that really doesn't
matter too much
um you see how you're not just saying
yes got your right you're you're saying
it all depends on the examples that
you're giving are if you're doing
something trivial that randomness
doesn't really matter use random if
you're serious about randomness you feel
something else
if the randomness has a really important
effect so anything to do with security
haven't helped us anything to do with
safety although safety and randomness
don't tend to go together and definitely
anything to do with money then yeah you
do not use random but for a game so
games are interesting so people do put
money into games so Pokemon go I would
probably not use random
he's catching them as with this is just
this graceful I know now I'm not really
catching at all it's all zubats around
here we have to be we had to go catch
him before we could get into the really
true how many things to be throws him
before it finally hit um but yeah so if
you've got a single-player game and
there's no in-app purchases and no-one's
going to be trying to game it as it were
then sure randoms fine and certainly if
you're if you're trying to say load test
something and that's another interesting
example if you want to write a load test
and you're the input to your algorithm
may well affect the output so may well
affect how long it takes to do something
so for example if we generated a random
array and then tried to process it then
as we know it would be faster if it's
already sorted exactly so if you happen
to get a random sequence that's already
sorted or mostly sorted then you could
get different results out so again if
you provide a seed then it may not
matter what the what that sequence is so
long as you get the same one next time
you run the test do do you all want to
see if we can do the tail call question
in the last five minutes here yeah let's
wrap this up by saying it's it's
slightly unusual that random changed
behavior between dotnet 1.1 and dot F
for hmm but maybe we don't know when to
32-bit to 64-bit we don't know if that's
a sort of a funcle' implementation do
you know where is code two we could
indeed well okay we could look at the
code now we couldn't look at the dot at
one point one get oh yeah you can
isn't it at source of dotnet uh what all
the previous versions yeah isn't it uh
okay let's let's move on it was our
source opened before I remember like
there's no reference source yeah I
wasn't that that yeah that was here's a
version that we could have shipped but
we actually shipped the version over
here crappy to be clear reference
sources the real source the script they
stripped out the swear words in the
comments but it's the real story okay
because there was definitely a version
that shit like there was if there wasn't
a cleaned up version ten years ago but
yes which I think they also called
reference source just that there's
website called source of no net that's
got the real source and they updated
right cool up hey we could either do
that or just we only have what three
minutes we have four minutes three
minutes do you want to
let's do tail call okay yeah there's
only one more question okay unless you
wanted you need to go no okay no no all
right let's bring up that one yeah so
why doesn't dotnet or c-sharp optimized
for tail call recursion the course that
begs the other question what is tail
call recursion now to find out what
title recursion is you call something
that gives you tell call regression
that's like that episode of Star Trek
where they're like I cannot tell a lie
I'm lying
oh this is why I'm gonna do this
whenever I get out of the room right so
right here they've got a function called
foo that does some stuff and then calls
itself so this is a classic kind of
recursive question of course the
function and then you would expect to
look at the call stack and it would go
super deep and 15 20 years ago I would
blow the stack because I've gone too
deep and you probably would know get
have a deep can this deck oh now I
suspect not that I think it's like four
megabytes stack by default I think which
would be just about right for this as I
was doing a Palm Pilot we had a 2k stack
which seems a bigger today
fortunately what's that machines are
bigger today unfortunately right so
let's call foo zero use pasted that code
directly from stack overflow into
production that's what I do all the time
right so this is going to call foo zero
so it's going to recurse a million times
so if we have a form X tack given that
all it needs on the stack is an integer
I don't know it might need a it might
need to inch one for the result of I
plus 1 who knows um and we're gonna see
if we can blow the stack here building
bangs like overflow exception yeah the
irony that you just paste it from stack
over that's actually pretty awesome
okay so tail calls mean that that won't
blow we're done so hang on a tail call
optimized a fail call recursion would
that not mean that we didn't need to go
and go deeper in the stack we could just
kind of go sideways it should be the CCR
compiler being able to look at that
function and saying ah I see the last
thing you're doing is making a function
call to yourself again so let me just
reuse the same stack frame that I just
created
hmm thereby not continually allocating
stack frames
okay so thinking of stack from the
bottom this time you can think either
way so here we have full of 0 and in
full of 1 4 2 4 3 4 4 etc something it
can be optimized with tail calls if you
can say rightful of 0 calls for 1 but
I'm bulb with this stack I'll just put
full of 1 on the same thing 4 2 4 3 4 4
and then so this is a method that
returns void we could return I and
either way you can just say well you
know we don't need to come back we can
just return the same thing and a smart
either compiler or runtime or both can
notice that it can do this switch and
just sort of overlay the new stack on
top of the old stack which is typically
the case if either you don't return
anything or if you return just the
result of the recursion possibly with
some constant things but right I get an
example that doesn't work with this this
is this is not doing tail call
optimization but so it isn't does it
could be it could they're saying why
doesn't dotnet support as if it doesn't
at all well I think the CLR supports it
but the c-sharp compiler doesn't do it
uh or it can do it in certain instances
and so this there's interesting stuff
here uh I'm sorry are you banging out
the Fibonacci sequence for memory yes
yes just checking I this isn't how I
would normally write it but just for the
sake of this isn't how you would
ordinarily write the Fibonacci sequence
from memory I would normally validate my
arguments and handle they always
literally I would ordinarily google it
and pick the first option but that's
okay so the reason that so you do you
John skeet you do you while food can be
tail call optimized fib can't because
who wasn't though no it wasn't but it
logically can be Isaac okay
fib can't be using this implementation
because we make some calls and then we
make some other calls and add the two
together yeah so if you've replaced you
we need to keep remembers it's a tree
over courage exactly and at every point
you sort of recursed down and then
you've got to add the results together
and the fact that you need both of the
results that make it hard there are
other ways that you can implement
Fibonacci that and to Bonacci
ends theoretically right because you
still blow the stack if it needed to go
big enough yeah so if I call fib a
thousand here it would probably actually
take of yeah Wow yeah it would it would
eventually go down and certainly fib a
million would so does dotnet support
tail recursion or not or depends so the
sale our supports a tail call operation
and operator but as far as I'm aware the
c-sharp compiler never omits that but
also the CLR can in certain situations
spot that it can do a tail call even if
you haven't asked it to and sometimes if
you ask it to it doesn't anyway so I
think they fixed it in dotnet for so
that it would always tell away DSS in
what
um so I think F sharp basically forced
the CLR to do it properly so so I'm
looking at quite another question here
that says that there are different
levels at which tail call optimization
is supported right the JIT is
responsible for the optimizations the
c-sharp compile could use tail call the
il opcode but no version of the c-sharp
compile does this it is the jitter who
is permitted to make those optimizations
so you're saying the c-sharp rapado
doesn't do that right really it's up to
the jeddak it could do that but in the
chain of responsibility as they see it
now the jitter ultimately it's always a
legit right I'm Walter mill you know it
is but the G sharp compiler makes it hit
the C shop compiler could give a hint it
doesn't at the moment the F sharp
compiler definitely does it says that
the JIT compiler is permitted to make
optimizations whenever it sees fit but
only the 64 bit jitter does it right and
then there is a it only happens in
release build yeah did you go and
release I'm just gonna go and release
build and there is a blog post in
exquisite detail called tale called JIT
conditions from 2007 that literally has
page after page of all the different
scenarios where if everything's perfect
it'll do it otherwise you want so still
in debug mode but 64-bit this is still
going bang all right
um in release mode
let's see whoo I don't it said it's the
most recent file it permits this is
permit it is um over 30 so I thought I
could have sworn I did that oh I did it
for debug but not for release don't look
at that oh hey look
oh my lord the CLR implementations but
yeah hey what so it does work yeah so we
should go and edit that second little
question tell that person that they saw
well is it's saying that it can it's
it's exactly right oh hey Microsoft
Kinect let's just go into the belly of
the beast uh answers should answer your
question what is the thanks for your
suggestion mmm-hmm
we will continue to look but they
already did it though No
so well this is 2013 why didn't they
just say do it this way and it would
have worked
are you going to write it at the command
line man no I'm gonna see what the what
we are looking at the il yeah so right
so it's still just using call it's not
using Taylor call so how did it work
then because the jet can still decide to
get Edit it's a hint more than err but I
guess what I'm saying is it feels like
the lack overflow question makes it look
like it didn't actually happen that's
right okay um so are you running away oh
yeah you are nothing
oh so next to the call yeah so to be
clear that makes sense though because
you're by looking in there you're seeing
if the c-sharp compiler output it that
doesn't say that it works the fact that
it ran to completion says that it works
exactly yeah so that proves that the JIT
is able to optimize it even without tail
look all right I believe the JIT in 2.0
sometimes even if you make it tail duck
call it won't yeah it's possible that
tail duck call is still advisory but it
now is more but it also as I think that
another way to think about this is it
it's a very visceral example of 64-bit
being good thing in this case we're
usually I do things in 32-bit for like
web apps but release versus debug right
there's all these optimism oh yeah
because if you're in debug and I suspect
if we detach the debugger even to the
release build it would still get when
you're debugging you really want to see
what has logically gone on yep which is
hey I've got these things on the stack
so you wouldn't want it to do the tail
call thing there unless you were trying
to determine whether or not it was going
to tip toe cool cool we are now six
minutes over we are no no let's give a
big hand to case kallen and
and many many thank yous to Rob Connery
who has this idea and continues to do it
and to NDC for allowing us to waste your
time for the last hour oh thank you
enjoy your lunch thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>