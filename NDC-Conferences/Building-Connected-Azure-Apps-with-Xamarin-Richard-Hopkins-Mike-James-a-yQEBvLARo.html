<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building Connected Azure Apps with Xamarin - Richard Hopkins &amp; Mike James | Coder Coacher - Coaching Coders</title><meta content="Building Connected Azure Apps with Xamarin - Richard Hopkins &amp; Mike James - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/NDC-Conferences/">NDC Conferences</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building Connected Azure Apps with Xamarin - Richard Hopkins &amp; Mike James</b></h2><h5 class="post__date">2017-04-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/a-yQEBvLARo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you for coming
the session or one two three four five
eight nine ten and that twelve of you it
is a Friday afternoon so that's more
than double what I thought we'd get yeah
so we're here to talk about how we can
build mobile applications with xamarin
and as your back-end who here has used a
Marin before or some whose uses your
before or a juror
depending on how you want to say it
great stuff I will be focused mostly on
platform as a service with apt service
and rich is going to be covering the
first half which is the backend and
he'll show you how you can create a new
back-end and deploy it and then we'll
switch over to me and I'll be showing
you the front-end which is a fun little
application that I've been building
called beit's news it's in the apps
alright now if you want version 1 which
this is a picture of what we're going to
actually work on today is version 2
which adds some new features the premise
of this application is to pull in
various headlines from numerous sources
like the Daily Mail the daily mash the
onion as well as going into places like
not the onion which is a reddit
subreddit and finding all the amusing
headlines in getting them added and then
we showed it to you in a tinder type
application where you swipe left or
right depending on whether you think
that's a real headline where you think
it's a fake headline that's pretty
simple app but we've got
authentification in there as well and
obviously it works offline and with that
so we show them how we can build
something like this why not so we made a
decision to share the Mac about three
minutes ago so whether everything is
already on there and set up to go we
shall find out so here I've got my a
juror portal I've already kind of logged
in and got everything ready to go so
that we don't waste time with the 15
different login windows that you get
when you go in to adhere these days so
here's my I've got an app service who
sort of actually played around with a G
wrap service for mobile anyone sort of
had a little little play good good so
what I want to do now is as a mobile
developer and and
you know someone who basically just
writes apps what I want to be able to do
is push data to the cloud pull data from
the cloud and not really care about what
goes on in the backend I don't want to
have to spend all my time building out
you know a big kind of back-end asp.net
solution or you know spend a lot of time
configuring back in databases and all
the scalability that goes into that I
just want to be able to say I need some
data
give me some data and that's really what
we're going to look at today when we
build out the backend that's going to
drive mike's app so i'm going to go into
my little menu here so i'm in my app
service and i'm going to look for this
thing here under the mobile section
which is called easy tables
let's give that a second we are on Wi-Fi
only yeah
second world there we go so what I've
got here is the ability to just spin up
as your sequel back tables in a matter
of seconds and the way I'm going to do
that today is I'm going to take an Excel
spreadsheet so Mike's app as he
mentioned is built around strange
headlines that you might find either in
the Daily Mail ya or elsewhere and we're
going to try and determine whether
they're real headlines or whether they
are somewhat fake sometimes with the
Daily Mail it's hard to tell the
difference but that's the whole point of
the app really so I've got an Excel
spreadsheet here and I'm just going to
save this now as a comma separated file
I'll just call it even though it's going
to put an extension I'll just put that
on there just so that I can remember
what it is and it's just going to tell
me that it's going to remove a few
formatting features and now I'm going to
go over to my portal and I'm going to
say let's add this from this add this
comma separated file to create a new
database table so going to my folder
find my CSV file open it and you can see
what it's done already is that it's had
a go at working out what the table
scheme is going to be so I've only got
four columns in this table I've got a
it's initially set them all to string so
I've got the text of the headline I've
got the URL that the headline the actual
real news story on the internet I've got
is it true so which is going to be a
boolean value so let's change that to a
ball and I've got the source and the
source is just going to be a text string
which is going to be kind of Daily Mail
daily mash the onion that kind of thing
and now all I'm going to do I'm just
going to take that little extension that
I put in earlier and I'm going to upload
that
and it's going to import that into Azure
and there's my table and you can see
there was years done is actually it's
also added a whole bunch of other
columns so we've got our created out
update timestamps we've got some version
there and we've also it's also generated
a globally unique ID so we gotta give it
as well and then we've also got one
extra column right at the end there
which is the deleted column which allows
us to do things like soft delete so we
can actually flag something that's being
deleted but not actually remove it from
the table so you know pretty quick and
easy to create a back-end sequel
database tab it it's got it yeah it got
a little bit going for it but perhaps
what the difficult bit now is we need to
build some kind of web service around
this we need to have some kind of Web
API that we can then start you know
making HTTP requests the database
pulling down Jason and being able to
then deserialize that in our application
so under normal circumstances this might
take a bit of time in this particular
case it's already done so if I now go to
my browser again and I go to let me just
remember what I called this I do have
user I'm not the edge you're browsing
guys everything our yeah
then we're very little so apart from
development so you'll just find me
sitting on Stack Overflow or reddit
actually but or you can kind of see what
my most popular things to do are let's
just go back to my web service and then
we can get in that way it's going to be
much quicker so you mentioned that when
you've got these easy tables that you've
now got this web service that's run up
around that that's using nodejs right
absolutely
yeah absolutely so but it's codeless so
you don't really need to know any any
JavaScript or be able to you know build
any kind of do any code on the backend
obviously there's the opportunity to do
that if you want to do something like
for example trying to think of a good
example let's say you're integrating
with something like
notification hubs and you wanted to have
it so that every time you did a table
insert it automatically triggered a
notification that went out to mobile
devices then you might need to write
just a little bit of JavaScript in the
backend to hook those two services up
together but what we can see here is
that my web services up and running so
this is my apt service and now I can go
tables headlines I think I did call it
headlines didn't I yeah I can ruin that
line yeah but we'll find out in a moment
and the first thing it tells me is that
I need to specify the API version so I'm
going to put that in
you
I think it's still two point zero point
zero and this Zumo API version in your
header that you have to provide is
really useful to make sure that Google
doesn't crawl your endpoint and so
Google isn't going to get access to this
because their callers won't have the
header required but for testing you're
going to need it
okay so there's the contents of my table
and now I can start writing filters
against it so I can say using a no data
specification I can see filter equals
and let's say let's pull out everything
that has a source the source column is
equal to what have we got how about the
onion and there you go there's our Jason
so not only just by simply uploading a
comma separated file to Azure it's not
only created and Azure a sequel backed
database for me but it's also given me a
full REST API but I can now start
querying now I have written apps before
that just literally use the raw
endpoints and just pull data out and
deserialize the jason but a much easier
way to do this is to use some of the new
get packages that come from Microsoft to
be able to you to to sort of wrap these
API so that you've got a much more
consistent way to query your data and
you can run things like linked queries
across them and that's really what
Mike's going to do next so that's where
he's going to pick up so god that was
the quickest I've ever done it perfect
I think I'm done so I'm going to take a
step back now you can probably kill my
Mike for the moment and Mike's going to
take over as in the 11 minute back-end
at their house except that I wish all
backends could be built in the 11
minutes don't feel obliged to stick
around Richard daughter's birthday today
so honestly don't feel obliged to stay
and watch this if you want to dash home
and be with loved ones rather than
watching
so this is the front and we've got our
back-end now deployed so we've got a
REST API with an array of headlines that
we can go fetch now rich uploaded that
from a CSV file which was generated in
Excel which is exactly how I did this
for the first version of this app which
is in the App Store today I'm using ez
tables and it uses the nodejs
back-end in app service but in terms of
actually storing that data it's just
going sequel as your so this can scale
to millions and millions of requests
without any problems
there is another option if you're doing
a quick start with in-app service to
have just a sequel Lite database it's
going to save you a little bit of money
and it's going to be quicker on the
deployment as well but actually you're
never going to want to release a
production app that uses a sequel Lite
database in your back-end you're going
to want a proper database of some
description so the second version of
bate News which we're going to see today
actually has a full asp.net back-end
which speaks to sequel and if we have a
bit of time I'll pull up the source code
for this I need to switch over to my
Windows laptop to show you that because
I do all of my asp.net development in
Visual Studio I do all of my mobile
development in xamarin studio which has
now been tweaked to be called Visual
Studio with some new features but it's
still in preview so consuming the
backend I'm going to show you the SDK
where we can get it what it can do we
will talk about how we can set up our
mobile app to consume this REST API that
we've just created how do we work with
that data and then we'll have a look at
authentification as well so the SDKs all
you need to know there are two main as
your client SDKs if you want to interact
with app service now these just wrap a
REST API so you don't have to use these
SDKs if you don't want to you can just
go and cool straight to the REST API
like rich showed where you're going to
get some data back now I would only ever
suggest that route is if you didn't want
offline and you're a bit of an animal
but if you're not an animal and you want
offline you're going to want the SDKs
now to have a fine support you want to
search
as your mobile sequel like store and
that's going to grab all the
dependencies you need if you want online
only so there's no capability for
offline sync then you just grab the your
mobile hind SDK and that way any crud
operations that you do on these tables
you're going to need to be connected to
the Internet it's going to send that
payload off to a shore it's actually
going to run that change on the sequel
server with the sequel Lite store all of
the crud operations you make are at me
happening on a local sequel Lite
database which has got a copy of the
data now in terms of what data you sink
down to device it's a pretty interesting
topic to talk about because you're not
going to want to think everything within
bait news I only think one user into the
user table and that's a currently signed
in user but I think all headlines down
to the device when you add a headline
within bait news I add it to the local
sequel Lite database and then at a later
time I'll go ahead and sink that back up
to the cloud or see if I line only I
wouldn't be able to just store it
offline and sync at a later date so more
useful SDKs that I find myself using in
most of my xamarin apps that consume as
your is your storage there's a great use
case within paint News for this in that
my profile page I use Facebook to
authenticate and I grab the profile
picture well what I want to do is take
that photo store it in Azure storage so
that I'm then not reliant on constantly
having to refresh my Facebook token in
order to just load a little photo got
notification SDKs for notification hub
project oxford vision sdk this should be
really be called cognitive services but
when we go into new get and we're
searching for the cognitive services
SDKs a lot of them are called project
Oxford and that's because cognitive
services is Project Oxford and projects
Oxford was a research project within
Microsoft Research which they've only
just start to commercialize and thus a
lot of the SDKs that we use still use
the old naming convention and then
lastly as your search if your
application has large amounts of data
you're going to want to be able to
search it and as your search is a
managed instance of elasticsearch
very very quick it's very very cheap and
I don't build many apps without adding
in as your search now now it is an
online-only API and the way to get
around doing offline with something like
in your search would be to use a service
locator or dependency injection and swap
out the implementation depending on your
connectivity so if you're online you're
going to call into is your search if
you're offline you would have an offline
version which is just going to search
through your table maybe a little link
statement where it's going to go and
find this this item contains this string
so you can grab these new get packages
you can grab the from you get because
they are and you get packages you can
also grab them from github or our
component store that they're full
xamarin support so you can run it on
xamarin iOS xamarin Android the
online-only sdk you can run on xamarin
Mac as well there's no technical reason
why offline wouldn't work with xamarin
Mac but nobody's implemented it yet as I
say it's open source so if anyone here
really wants to build Mac applications
with a jaw that are offline please do
put in a pull request will always accept
them if they're good enough the SDK is
extremely flexible it's not forcing you
down any avenues or assuming that you've
chosen any particular technologies and
we'll touch on this when we look at a
little library that I've written that
fits on top of this SDK very very
flexible but it can be a little bit
intimidating if anybody's used their
pals they want to use the path server
one perfect well you'll know how easy
the SDK is it's almost idiot-proof it
it's really really simple as anyone used
firebase no one well that's even better
because that's Google and firebase
Google guys hired a lot of the paths
guys pass guys to me is the way that you
should build easy to consume web
backends for mobile the SDKs is just
lovely
these your sdk is nothing like that is
your sdk is a beef that you can distill
it down to small sections which are good
which we've done with the app service
helper library so setting up your app
you're going to need to in it the SDK
and that isn't actually the line that
you want to do to in this it well show
you that in a moment but you're going to
want to initialize the offline storage
so the sequel Lite storage as well as
just set up for that platform now
depending on what platform you're on
there are a couple of lines to get this
started for you on iOS it's two lines of
code for Android and UWT it's just one
line of code to initialize it the reason
you're going to want to initialize it is
to stop things like our linker coming in
and getting rid of classes that you're
actually going to need a linker
obviously removes bits of your codebase
that it thinks you're not using if it
doesn't detect that you're using parts
of the SDK will strip it out which is
the last thing we want here we go here's
the real code so we need to create our
mobile client our mobile client is our
entry point to anything that we want to
do within the SDK and we're going to
pass in the URL for our back-end so in
my case it's going to be HTTP because we
want to be secure no HTTP here so HTTPS
forward slash fate news dot as your
website's net once I've done that I can
go ahead and create my tables in this
case you can see a four that I mobile
service sync table sync table means that
it's offline this supports offline and
it's going to everything we do with this
table so all the crud operation to add
remove the patch that's all happening on
the local sequel Lite database and then
we'll sink that back to Azure a later
point if I wanted this to be online only
and I've gone with that first NuGet
package which isn't the sequel Lite
store this I mobile service sync table
will change that i mobile service table
it's the only change you need to make to
take this online only versus offline
once you've created your tables you need
to define where you're storing the
database is just sequel Lite and then
you need to set up some sync context now
this is just going to boilerplate code
that I don't think we should be having
to write that our net developers I think
this should be abstracted away from us
because it's not that complicated it's
just useless code if you ask me then we
have query and local data so much like
rich tip would be a
data filters we can filter the data that
we're returning from the tables and
remember this is all coming from that
sequel Lite store and here we have some
link on the to do table so you can see
we've got the loveliness of link
relationship advice this one's really
important especially things that are
meant to be proof of concepts on them to
be very quick it's very very easy to get
round references with your relationships
within Azure and this is something I've
found myself doing a lot with
beer-drinking which calls me no end of
issues is that I would have a beer have
a child that would be a review but the
review would have a child that would be
the same beer and so it would be I'd
have autoexpand on to when I'd after
that beer it would just keep expanding
on the back end and it would never
return the objects cuz it's just
inflating and inflating and inflating
keep it simple with your relationships
where you can what I've done with bait
news is rather than having a reference
to the actual object so being like a
virtual answer to the headline I just
had an answer ID and I know that I will
have stored that answer offline so that
we can very very quickly go and look up
that ID on the device at runtime rather
than having to actually expand it and
send it down with the initial query so
that's a very very brief intro to the
the official SDK and I want to show you
the easy way of building or consuming
your from your mobile apps and that's
app service helper library and this is
the library that I wrote with Pierce
bogan this came out of a couple of apps
that we built to Microsoft so bill 2016
we had the my driving demo there's a
little app built for uwp Android and iOS
had an OBD connector so you can plug it
into a car it's going to stream that
data up to IOT hub we're going to run
machine learning on it and then it also
gets fed into an app service which we
can sink down to the device to show you
where you've driven and some performance
stats on that the architecture we used
for that we then reuse for the evolved
application which is a conference app
built with xamarin form
that same architecture was used in beer
drinking and then we used it again in
the cycle demo that we've created and
it's we've just been recycling this
architecture over and over again because
we created it with the as your team as
well as some of our best engineers
within xamarin and so Pierce and I
looked at this architecture and we found
that there's a lot of code reuse that we
could take out and put into a separate
library and that's exactly what we did
with that service helpers so it reduces
the number of lines of code you need to
write to interact with the door down to
four so you need four lines of code and
you're good to go so it's built on top
of the standard is your mobile SDK now
it does have the dependency on the
offline you can't do online only with
this so we're only really targeting
mobile so iOS Android in uwp it's
modular architecture so you can pick and
choose which bits of the SDK do you want
to use so you can drop down into that
low level as your SDK if you really want
to or you can stick with a very high
level abstraction within app service
helpers it's available and you get and
it's open source and it's very
opinionated about the technologies that
you've used to build your apps it's
assuming that you're using as your
sequel on the backend it's assuming that
you're using entity data or entity
framework and that your objects are
inheriting from entity data if that
isn't true
this framework isn't helpful but the
99.9% of our customers I see them using
sequel Azure I see them using entity
framework and this could reduce the
number of lines they write from hundreds
down to just a handful so this is how
you get started and this is reversing
one sort of stable version version to
slightly tweaked or version 1.1 I should
say slightly tweaked in that we also
have a static version of the easy mobile
easy mobile service client so you can
access it from anywhere within your app
without having to new off a new instance
so we create our new easy mobile service
client we initialize it with our URL
just like we with the standard SDK we're
then going to go ahead and register our
object now in this case I'm registering
headline headline here is in inheriting
from entity data
now that class entity data isn't coming
from entity framework like you would
expect it's actually a class that we
roll with in-app service helpers so you
can easily share that model on the back
end and the front end so once we've
registered all of our objects and in the
second version of bate news which will
be shown we have headlines users and
answers we then need to finalize a
schema to say we're done that's all the
objects that we're going to be using
with the database and then we're good to
go start actually consuming as you're
from the SDK you can download it today
I'm on github my codes dotnet app
service helpers you can grab the code as
I say you can also grab this from NuGet
I suggest grabbing the 1.1 preview 13 I
think it is so I want to show you app
service helpers now we'll get rid of
that
you will see the code
that can see it perfect so if we this is
just a standard iOS application this is
Beit News it's not samer informed this
is a traditional-style app this is how I
like to build all of my applications
this is also on github if you want to go
and grab the code for this feel free
download it send in PRS and this version
is version 2 in vb2 so you'll want to
find the branch for that the default
branch obviously being master is just v1
at the moment which is the version in
the App Store
so if we come into the app delegate
which is the main entry point for any
iOS application you're going to see I
put this finish launching method which
I've overridden and this is where I'm
going to set up my application now the
first thing I want to do is if I'm in
debug I want to remove any data that
I've got stored within NS user defaults
energy user defaults is where we saw our
app settings it's not very secure way of
storing your app settings but it is a
very easy way to secure your app
settings and my case I'm storing my
Facebook user ID and my Facebook expiry
date token the expiry date and my
Facebook token string within the user
defaults and I check on launched if I've
got any values in there then I can go
ahead and create an access token and
authorize from pre-existing data but
when I'm in debug I don't want to just
assume that the apps always going to
work on through the auth flow so I want
to real authentic 8 every single time so
I just get rid of all of the
pre-existing data when I'm in debug
and then if we come down to 45 or line
46 I should say you can see this new API
so you can see easy mobile service
client current initialize we pass in our
endpoint URL we go ahead and we register
our table so in this case we've got
headline user and answers and then we
finalize a go to declaration for the
headline you'll see I'm inheriting from
entity data but this is exactly the same
data that rich was having in his
spreadsheet if we follow this as I say
this isn't going to go to entity
framework I wouldn't want you to have to
install the entirety of entity framework
as a dependency to get one class so you
can see we have our ID date time offset
alt let's pop back so updated out we
have our version these are required in
order to make offline sync work as your
is expecting leaves but you shouldn't
have to add these manually to each class
that you have to just inherit from app
service helpers and you're good to go
once I've done once I finalize the
schema that's all I need to do in the
finish launching method and then it's
just a case of getting the app to look a
little bit prettier in terms of that the
data usage will go into the swiped game
view controller so you can see on line
41 I'm actually going to set my
headlines to have some data and I'm
using this new type which is a connected
observable collection now connected
observable collection comes from app
service helper library version 1.1
preview 13 it's a catchy catchy thing
this allows you to have effectively a
connected observable collection it's an
observable collection that any crud
operation you do on it we're eventually
going to sync back to a shore now when I
say eventually we'll do when we want you
don't really have too much say in it
unless you call the API yourself to
forth the table to sync but by default
will handle it for you by default will
handle merge conflicts by take
the latest takes precedence again we're
going to take all of these things that
you would normally have to roll your own
and we abstract it away to make it a
little bit easier for you so I create
the observable connected observable
collection and then I've got my list of
headlines that I can start using within
the actual app so you can see it's very
very easy to to go and fetch data from
the drawer I just had to define some
tables in my app start up and then I
just say I want to create connected
observable collection it's going to go
ahead and it's going to fetch that
object from the backend so it will fetch
all the headlines and it will give it to
me in an extension of observable
collection or an extended observable
collection that I should say so let's
get this running so you can see how it
looks
then even if you don't like the idea of
taking on the dependency such as app
service helpers which I completely
understand you shouldn't just
willy-nilly take on a dependencies you
give it a lot of thought as I say a lot
of the code that's come from this has
just been made more generic to reuse in
other apps but it's come from multiple
different apps that we've built so you
can just come in and take the classes
that you want if you only want to
connected observable collection just
come in and grab that and get rid of the
rest now I will say if you do add the
dependency and you're only using
connected observable collection let's go
through the breakpoints if you're only
using it connected observable collection
then our linker will get rid of the rest
of the code that you don't touch so
that's important your app binary size
isn't going to be massively inflated by
taking on these kind of dependencies so
this might be we'll skip through that or
I've got a wall but I'll talk about it
in a moment how we've done this
there we go and we double checks that
we're authenticated which we are so we
can start playing this game if I hit
start we're going to call into this
swipe table view controller that swipe
game controller up here and we'll call
into the connectable collection so if I
go ahead and let's actually see where
we're using their so we refresh the
headlines down here so let's have a look
pop that there it start
we've not hit a breakpoint yet which is
how we've already loaded that be wife
having and so we have our headline which
we pulled in from Azure again I've not
written any code to sync with this it's
literally five lines of code to get to
this point it was a four to get
everything initialized and then one to
just go off and fetch this and the one
fetch it is just connected observable
collection so we have our headline
ramona's should stop moaning insist
people who've spent their lives moaning
now this is a tinder style application
so we can drag we drag this way if it's
real and we drag this way if it's fake
so which way do you suggest we drag this
is this real to have hands for a real
headline one person thinks real should
have hands to fake most people think
think it is a fake headline so we scroll
off to this side boom and we bring in
the next card ready to go
woman 63 becomes pregnant in mouth with
baby squid after using calamari real
that's quite a lot reals fake oh it's
about 50/50 that's a real headline
that's a Daily Mail and we'll do the
last one
twelve-year-old pulls gun on fast mate
over chicken nuggets real yeah that's a
real one it's really depressing isn't it
you get the idea we've pulled in some
data I'm going to get rid of this and I
actually will talk about author next and
why I do that and have those breakpoints
in very very simple to do all of this
adding crud operations to a jaw we can
come in here mean say a brand new
headline HTTP hello world
at UK me and then we can post it and we
failed the operation but that's gone
into my local story so although that
hasn't synced up to the cloud for some
reason I could have just dropped off the
internet for that brief second that's
now stored on my local sequel light
database so that when I do get next
connected to the Internet that push the
operation isn't going to fail and it's
going to sink back up to the Internet
and that headline will be available for
everybody else to consume yep now you're
going to deal for the most part with
retry for you on bad network
connectivity but once it's gone ahead
and said that this is failed its failed
and you'll need to deal with the retry
logic on it now my advice would be if
you're building for an offline app you
don't really need to tell the user that
that's failed
I've got errors popping up to tell me
itself because I'm still in development
and I don't want to just have to look in
the console logs I just want to be able
to see straight away you should always
build to be offline so that's failed I
shouldn't show the users it's failed I
should just keep it in the offline
storage and at a later date sync it when
I can
now if you're constantly failing maybe
you want to put in there is ten attempts
to try and resend this and it's not then
I might want to prompt the user but I
think that it's a bad form to build an
app around being offline and then
constantly poke the user and be like
you're offline because they know they're
offline because they probably only came
to yours your app because their favorite
app didn't work because it wasn't on the
internet so I want to talk a little bit
about authentification and permissions
so let's stop being lazy and let's do
this right who has used social
authentification so that's like Facebook
Google Microsoft I guess it's perfect
have you done that using the webview or
where you bring up a little webview and
you type in your username and your
password to sign in nobody's done that
you're using the native SDKs or Richards
done it anyone using the native SDKs
okay so that's two of you there are
still people who will plant eight with
these services who have no idea how
they're doing it they're not doing it
with Webb and they're not doing it with
native SDKs interesting so the standard
way that we suggest a Microsoft to
authenticate your users with in-app
service is wrong we know it's wrong we
tell people it's wrong and yet whenever
you watch someone from Microsoft present
on how to do it they'll show you the
wrong version because it's easy and it
doesn't go wrong very often so it's very
easy to demo you have a couple of
options to authenticate your
applications with an app service by
default you have Google you have
Facebook Twitter Microsoft and Active
Directory you can also plug in your own
security provider or auth provider so if
you've got custom authentification say
we had it for xamarin as the Dameron
evolved you can sign up with your
Dameron account we still authenticated
with
a jaw app service but it was all just
custom today I'm going to be showing you
Facebook authentification but with the
native SDK rather than the webview
approach so this is what we call service
ID authentification and this is that
webview authentification so we're
effectively asking the your sdk to do
the auth for us and what it's going to
do is it's going to pop up a webview
with the Facebook web site or the Google
sign-in page you're going to type in
your username and password like an
animal and you're going to hit OK and
it's going to sign you in and eventually
you'll get a user returned to you now
this isn't going to return the Facebook
users to you it's going to return to you
an app service user so you can have your
token that isn't the Facebook token so
if you try and send that token that you
get that through this call up to
Facebook though though that's not ads
going away you got that from and you'll
be rejected the user ID you get back
will be the user ID of the app service
user not the Facebook user it's
basically a black box you'll never get
the token back from Facebook unless you
write custom code on the back end it's a
very hard approach to debug if you're
doing testing properly your back end
will be in different stages so you'll
have a staging or slot flashes so you'll
have staging and you'd have production
minimum Facebook or sent ocation deals
with redirects URLs which will change
depending on which slot you deploy to so
if I deploy to staging this stops
working because my redirect URL is going
to come from production because I can't
turn also education off on production so
it just becomes a real nightmare so this
is the worst way to do authentification
but it's just one line of code so
everyone does it this way but please
stop so I am suggesting and Microsoft's
of the whole suggests that doesn't show
that we use native SDKs and you can find
these from like Google and Facebook and
the Facebook one is a real delight to
use especially kind of version 3 onwards
version 2
the SDK was pretty difficult it was
effectively just that webview but
they've done an awful lot since version
3 so why use a native SDK well they're
going to deal with things like token
refresh for you by default you're going
to get a token that lasts for 60 days
and they will securely store it on the
device using keychain you don't have to
do any code to deal with how to store
that token or how to refresh it it's
just done for you you're going to get a
lot of options that interacts with the
Facebook Graph API in a type safe way
which is something I like I don't like
to work without type safety but it also
can dramatically impact the adoption
rate of your application so there are
four possible identification options if
we look at mobile and iOS in particular
so we have the iOS native that should be
login not logic dialog login dialog
which is unique to iOS 6 is anyone here
still supporting iOS 6 perfect so you
don't need that but if you did need to
support it you would need to roll your
own version of you know make sure that
you call down into this API yourself
Facebook deal with that for you we have
fast app switching to the Facebook
native app this is the way that
everybody wants to authenticate you hit
sign in walk out to the Facebook app
show me the app that it's still the
correctly that's still bait news okay I
accept and then you switch back in to
the app that you initially came from
that is the best user experience
educate your mobile apps then you have
fast apps switch to Safari which we'll
see in the simulator here because
obviously in the simulator I don't have
the Facebook app installed so it can't
switch to that so it falls back to the
SS Safari view controller which has
access to all my cookies and data from
my main browser so I'm already signed
into Facebook so it's still just a nice
click to just sign in and then lastly we
have the one-liner the horrible approach
which we need to stop using which is
just a web-based login so we're going to
be aiming for the two middle one tip so
fast that switching to native app when
we're on iOS 9 iOS 7 8 &amp;amp; 9 iOS 10
they're doing some a be testing to
decide between switch to Safari or
native app they haven't decided Facebook
which one they're going to at 2zf if
you're on iOS 10 you may get either
which is quite exciting so the Facebook
SDK SDK components kind of write this
you've got three separate areas you've
got the call which is where you going to
be doing most of your work so to get
your authentification to happen and to
deal with your current session and
restoring tokens and all of that
loveliness then you have the graph API
which contains a lot of interfaces so
that you can get that type safety still
with the Facebook graph and then you
have some native UI so you can have
access to logging in in fact when I
click to sign in or the log in button
within bate news that is coming from
this SDK that is a Facebook type and
they handle with the full off from that
moment on because I'm using the Facebook
login view I could also use a facebook
friend picker so if I wanted to add a
social element to this so you can go and
easily add your friends
boom it's just an API call and then I
can add native Facebook share sheets and
things to my application as well so it's
not just authentification that you're
unlocking and dealing with token refresh
and storing it securely on all the
devices you're unlocking a whole load of
other features that you can add to your
mobile app to make it more social you
can get it from our component store
which is available on both PC and the
Mac and obviously this SDK support at
iOS
and Android I believe there is a uwp SDK
in the works as well you can also grab
these packages from you get as well I'd
actually recommend grabbing them from
the component store instead if you get
just because the team that maintained
that binding works for the component
store rather than mainly publishing to
new gets kind of an afterthought so I'll
show you through that authentication
approach to do that I'm going to close
all of these real quick the app and if
fat let's be let's be really brave I'll
start start this running on the
simulator but whilst it's doing it I
might just plug in my phone and share
the screen off that there's any horrible
text messages come in and it is very
brave but it may if we're lucky because
I'm on iOS 10 it makes us a native app
switching so it just shows you that the
same code on the simulator is going to
call into either the webview or then a
to that DMD do not disturb that takes
all the fun out of it it's not as good
presentation if you don't have some
concerns about losing a job simple plug
the phone in
but will will I'll talk to you about
what's going on here so I mentioned
right at the beginning but when I'm in
debug I want to get rid of that that pre
stored information I want to force to
refresh my authentication token and to
check that my author logic works so what
I've done is in the view did appear
method which I've overwritten which is a
standard method that comes from UI views
or UI tableview controllers or anything
really that's a UI view controller in
iOS I say
within that okay I've become a visible
I've become visible
have I got stored within my settings a
facebook token and if I do well then
I've also implicated before and I can
probably real authenticate with the back
end with that existing token if I don't
have that token then I need to get the
user to authenticate so in this case I
had that SD bug and I went and cleared
NS user defaults so we can see my my Oh
that's most peculiar so I'm seeing the
pop-up on the screen here which isn't
showing that oh no it is it is sorry my
mistake bad ID so you can see my string
is empty it's got nothing so then we're
going to execute down into the
authentication prompt do you controller
so we're going to new up a new instance
of this view controller and then we'll
show it on the screen which you can see
here this Facebook button comes from the
Facebook SDK that's in that top tier of
UI controls all I've got within my view
is a button that is exactly the same
size and in my view did load for this if
we scroll to the top
don't-don't-don't viewed it up here you
can see my BTN off button I make hidden
but before I've done that I've created
this login view button or login button
and I've given it the frame for the
button that I'm just about to hide so I
can basically swap my button for the
Facebook button which just makes the
designing of this UI a little bit easier
now when I click done
when I click login and we complete that
login process we're going to call off to
this login view completed method which
is where things can get a bit fun I've
got some errors so if we have some
errors within the login that's bad for
us and we need to fix that I then go
ahead and authenticate with the backend
if we come into here and when I say
authenticate with the backend I'm real
authentic ating so I've got enter kated
with Facebook and I said yes this is
Mike James this is confirmed to be him
but I don't really care about myself too
much what I care about is authenticating
with app service so I pass that token
off to app service and they go yep that
still might James but we've created a
user profile for him and these are going
to be his answers and how we track them
and this is his new user ID and that's
how we'll refer to me from forever on so
we create our token here as a J object
we passed in the token string and then
we simply call and you can see this is
calling them easy mobile service client
current mobile service mobile service is
just the standard mobile service class
that comes with is your SDK so this is
me dropping down into the low level API
because that service assumes that you're
not doing authentification properly app
service assumes that you're cheating and
you're doing it the bad way so the API
only exposes the bad way but I needed
access to a lower level API so I just
get the instance of mobile service I
call login async passing my facebook
facebook token that I got from the
Mobile SDK and we're good to go
so if we then come back to once we've
returned from there we have our user we
then go ahead and set our preferences so
that NS user default gets set here and
once we've done that we create and save
the user creating and saving the user is
literally just mooing up a new user
instance setting the properties from the
Facebook details
don't edit it down you can see it here
so Facebook ID we get it from the
Facebook SDK we get the first name last
name we get the profile image URL and
then we've set some defaults and we
throw that into our user table which is
just from App
and we're good to go so you can see we
create the user table we add the item
down here after we've synced it and then
we go ahead and we think it again
so that's nice and simple the the big
thing with authentication and the
Facebook profile
is that you once you've authenticated
with Facebook you don't care about any
of that data anymore you populate your
users and you throw this into a jaw from
that point onwards I only really care
about these your token and how I keep
track of that
now with in-app service helpers we will
keep track of the tokens that get sent
back and we actually use xamarin all to
store those securely on the device for
you so again it's just another little
abstraction within the app service
helpers library to avoid you having to
deal with toast and refresh and how to
store those tokens securely on each
different platform so you only really
care about this access token on the
first ever instance of launching the app
and once you've done that we only care
about as you're at that point sometimes
think if there's anything else
particularly amusing within this app or
interesting to show you that we have 10
minutes I will very briefly talk about
asp.net versus easy tables and why did I
move off easy tables which is v1 if you
go to Bank news dot as your website's
dotnet you will find the v1 API
everything is open in fact I've even
left crud operations open to anyone you
don't have to be authorized or
authenticated to go in and add headlines
to my back-end Superbad practice never
do that with v2 I wanted to add the
ability to scrape faces like the Daily
Mail and to pull in headlines and have
web jobs and I knew I needed to be
writing some c-sharp to do that I didn't
want to use JavaScript for it and I've
got quite far with EZ tables it my
version one of the app is in the App
Store people downloading it and using it
it's working but I wanted more and
JavaScript isn't for me so I rolled the
full asp.net back-end and it's not a
particularly complex back-end in terms
of the code I wrote we come over to
github
I'll do it in the browser that's going
to be easiest
beer-drinking back-end is private
because i published all of my publishing
details within this repository so you
can actually go and hack miles or if you
had this hence why I kept it private
this is beer drinking this isn't the one
we wanted
faint news back end so come into my data
objects and you're going to see
basically the same thing that you saw
before we have everything inheriting
from entity data so I can just drag and
drop this from my front end to the back
end and I've already got some code reuse
there which is very nice to actually
interact with these come from the
controllers so when I'm asking for all
of the headlines I'm calling up to dunt
down there is it get headline and get
all headlines here we go and we've just
returned the query now this is just
created for you when you've got your
data object within Visual Studio and you
want to create a new controller you go
into the controller directory right
click and say add new you say I want it
to be a controller and they'll say is
this an NB C by controller or on a dual
controller a table controller and API
controller and you'll say I want a table
controller and you'll pass in select the
types headline and it's going to
scaffold all of this for you I've not
done any editing apart from to the post
headlines I just checked that we don't
already have a headline with the same
URL in the database and if we do I
return null which is pretty bad practice
but it works I catch it on the client
and then I just log in to application in
sites that I've discarded an entry so
you can grab the entirety of this
project as it's a work-in-progress from
my codes dotnet 8 News Now for v2 with
all the off with the Facebook SDK with
app service 1.1 preview 13 I think it is
with the connected observable collection
and all of that goodness you'll find
that in v2 v1 is a version that you'll
find on the App Store which is a very
very much condensed version without any
social aspects are there any questions
nothing well to be fair it is gone five
on a Friday I can think of places I'd
rather be well we have seven minutes so
we can either leave early or we can all
find questions
you know really kind of if you need
offline sync and if you kind of want to
have all that kind of offline goodness
clashing local data on the device even
if you don't really need that kind of
capability we have a lot of people I
know a lot of developers that still use
some of these for example like the is
your sequel like Store package because
of all of your crud operations are on a
local database on the device you get a
much better performance increase than
having to do all your rights to the
cloud you're not constantly pulling and
pushing data all the time so even if you
don't need that kind of offline
capability and even if you've got
something that perhaps you know you've
got people walking around the warehouse
and they're always going to be on good
Wi-Fi and everything else because you're
not constantly calling out to the
internet all the time and hitting the
cloud then you know that that package is
still a great option for you so you know
don't don't think of it just in terms of
am I going to be constantly online or am
I going to need to kind of have offline
capabilities there's there's something
there for everybody
yeah because by default when you when
you ask to get all items it's going to
return the 5th 50 items out of your
database because it's paging so if if
you're constantly saying hey I want to
get all the headlines please I've just
loaded up the the headline swiped view
controller and now I'm having to call
off to a door and do a round-trip to
return those 50 headlines so that's
quite a lot of wasted bandwidth when I
can do it once store it on the device
and have them forever so yeah is rich
says white right it's not just about
unlocking offline it's about increasing
the performance of your application or
at least perceived performance because
you still want to send that data it's
just you can throw it in a background
thread when the user isn't actually
waiting for it you can fetch it before
they need it and you can sync it when
they don't need it and you can make
rules as well to say I only want to sync
on Wi-Fi I don't want to sync on to G's
or 3ds to make it even faster you had a
question yeah so it depends what
platform you're on depending on the
underlying implementation but it does
rely on httpclient
yeah once you get all the way down in
terms of the way that mono works on iOS
you'll end up with an NS URL session so
that you can use things like ATP which
is apt Transport Security I should
clarify that is apple's thing about
everything's got to be secure now we're
fully compliant with it all and it all
just works there's no extra work that
you have to do because you're talking to
a jaw versus any other web service that
you would talk to
yep very simple to do in fact my
colleague Adrian Hall has an amazing an
amazing web book on this it's a little
eBook so if you check him out Adrian
hall he's the program senior program
manager for app service and we've
managed since the acquisition to get him
to be a big xamarin fan which is
fantastic because he was a called over
man
pourcel so he is currently writing an
e-book which is free you can go and grab
this from the website and it's just a
wealth of information so if you want to
know about things like custom headers
within the client SDK
check out this and most importantly
check out that yeah as I say it's had a
lot of it's had a lot of zamarons you've
got James Bond to magno out there as
well and Pierce spoken we've we've all
been helping him get this book off the
ground so it's a really really good
resource so if you're you know not sure
about the backend check this out if
you're confident on back-end but you're
not sure about the front-end check this
out
so two questions okay I'll go with you
first and then I'll come to you
yep
it's not new Peter what you what you
effectively end up doing is creating an
API controller that you talk to ashore
and then that will then forward it on to
your service and that will return back
whether or not the user is authenticated
so kind of sits as middleware between
your authentification provider and the
client I will show you where you can
find an example of this did it did it
there so if you do github xamarin evolve
project here uses custom morph and
you'll find both the front end with
xamarin form to a UWT iOS and Android
and then the back end is built using app
service to find all the codes you need
to do custom or properly and securely
within this project
you
okay
you can but
advices to avoid showing a webview
because that's where most phishing
attacks happen because they've shown a
fake version of the facebook login or
they can show a fake version of your
login screen and just send the data and
do man in middle attacks and it's just
it's a whole world of badness in general
but if you do have custom off then
you're probably going to want to have
some kind of view that where you send
off the passwords and the username so as
I say I would check out the sample this
sample because we show how to do it
securely which is the most important
thing when you're doing off I always
suggest not to do all for yourself you
shouldn't really have your own or
service you should be relying on
somebody else but we all write hideous
code every now and again sighs I will
allow it there was another question
you'll have to call ask it to sink so
you're going to ask it to either do a
push or a pull so you tend to want to do
a pull before you do a push and so to
effect all of the data and then syncs
the stuff that I've got that's in the
standard SDK you manage that yourself
with app service helper library we
manage that for you it'll also do all
your kind of conflict resolution as well
so if somebody else is written to the
table and you kind of have an update
that goes kind of you know out of
sequence with something else it'll it'll
take care of a lot of that for you cool
well I think we're finished so thank you
very much for attending and thank you
Richard for starting us off with easy
tables welcome</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>