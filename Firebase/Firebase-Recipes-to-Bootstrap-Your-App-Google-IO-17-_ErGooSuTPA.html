<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Firebase Recipes to Bootstrap Your App (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Firebase Recipes to Bootstrap Your App (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Firebase/">Firebase</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Firebase Recipes to Bootstrap Your App (Google I/O '17)</b></h2><h5 class="post__date">2017-05-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_ErGooSuTPA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone welcome to Friday for a
speed boost rapper rap session my name
is Chang and this is our rune you're
both developer advocate at Google
so before we start let's get to know
each other a little bit so you know
proud today how who are three stories
right hand is the first time attending
oh I oh wow it's amazing it's like
almost I know 80% of our lsanty today so
thank you thank you for raising your
hand actually this is also the first
time I in a rudely presents at a Google
i/o session we are very excited about
that and I hope that you have enjoyed
your i/o so far thank you so far base we
had more than 25 a stations at i/o this
year so I believe that you have a thing
or two about it we launched firebase as
a unifying mobile platform but IO last
year with the goal have you quickly
developed high quality apps and grow
your business
frye berries provides you many
ready-made solutions to address common
use cases that are almost every activist
goodness
however with the increasing complexity
of mobile apps the offerings that we
have in firebase is also very broad so I
guess maybe some of you may get confused
on register when you start using
firebase thanks why we come up with this
session to guide you through some of the
popular use cases that many apps is also
implement when they start using firebase
today we'll look at a hypothetical
ecommerce app and see how we can quickly
add new features to it is in private
will show four 5s recipes simply many
use cases that are quite common when you
use firebase
the first recipe is how to link your
existing users into firebase so that you
can make use of all the features that we
have in forbade the second one is
maintaining data consistency in
real-time database without the getting
caught in clients the third one is how
to send push notifications without
spinning up your own server and the last
one is how to use the engagement push
notifications to improve purchase
conversion in your app and Arun can you
show us the first recipe we have today
Sher Khan hello everybody
let's now see how to link your existing
users to firebase but first of all why
does linking matter linking your
existing users to firebase enable secure
access to the real-time database from
your client apps the real-time database
is used in a recom a SAP to add an
in-app chart feature that allows users
to chat with an operator for either
price bargaining or just to clarify
product specifications but first why use
the fire by a firebase real-time
database at all with real-time database
you can listen in real-time to changes
in a cloud database on your client
administra Kess dicuss iOS Android and
the web and the SDK also helps you with
offline handling okay now that we have
real-time sync how can we control access
to the firebase
so that a user sees his or her own
messages and nobody else's real-time
database uses security rules to enforce
access in order to allow users to read
or write only their own data you may
define a rule as shown here
okay so now that we know how to
implement secure access to the real-time
database back to the recipe we have an
existing e-commerce app with its own
authentication back-end and use a model
so the question is how do you integrate
that user model into firebase so that
firebase can identify your users and
give them access to their data inside
the real time database
the answer is using firebase auth real
time database uses firebase
authentication for user authentication
when a user signs into your servers a
JSON web token is generated and that's
how you certify user user identity and
then when the signed-in user accesses
the real-time database the token isn't
used to prove the identity and sign in
to firebase here are the detailed steps
to link your existing users to firebase
first sign in your user via your
existing mechanisms as usual your app
now that you know who your current user
is the next step is to issue a firebase
custom auth token in your server to
represent the current user and finally
use the token to sign in the user to
firebase using firebase client as the
case so assuming that you've already
signed in the user via our existing auth
here is how you issue a custom auth
token for that users in your server
start by initializing the firebase admin
SDK
then use it to issue a custom or token
you only need to specify user ID from
your own art system and firebase admin
SDK will do the rest under the hood for
you for example encoding your token
once you have issued a custom mod token
just return your token to the apt line
okay so now you have custom or token in
your app let's see some code to use the
token to sign in your user to firebase
you need to provide your customers token
as a parameter for the firebase admin
SDK art method call and that's it you
are done you can now go build your
awesome real-time features on real-time
database pretty simple isn't it fun yeah
I agree
thanks Arun so there's already many
high-quality tutorials online on house
implements a chat app with firebase
real-time database so we won't cover the
details of reading and writing from
real-time database in our session today
you can check out our firebase code lab
to get started okay and now it has
implemented a shiny brand-new in-app
chat feature on top of real-time
database let's move to our second recipe
for today how to write your business
code accessing firebase real-time
database without duplicating them in
multiple client apps but wait a minute
why do we need to the wicked business
logic so let's take a look at an example
use case so you entered in our chat
features to your e-commerce app you
allow your users to create conversations
and invite other users to participate in
those conversations then you may have a
data structure like this you have a
conversation notes and a user's notes a
top level under each conversation charts
note you have a user's notes containing
a list of users who are participating in
the particular conversation
and at the same time under each is a
child note you have a conversation snow
containing a list of compositions that
the particular users is participating in
whenever you add a new person to a
conversation you need to make changes to
both conversations users and users
conversations note and make sure that
the data under those notes stay
consistent here is how you command it or
the iOS app very straightforward isn't
it oh and you have an Android app as
well so let's write the same logic for
the Android app this very familiar
similar to the iOS app oh wait re
writing the same business logic once
again and because we also happen web app
then you ended up getting the same
business logic indeed one more time
so one logic duplicated in three claims
imagine when your app froze and you have
a more complicated business logic
maintaining the same logic
implementation across multiple platforms
may increase the risk of having a box
that may destroy in your database
sufficiently but the good news is we
have flower functions for firebase a
product that was released recently to
have you in such situation cloud
function allows you to run server-side
soap in a managed environment that you
don't need to spin up and run your own
server you can write a lot of fun using
cloud functions and then have your apps
trigger the function rather than
implementing the logics in each sign app
okay let's see how we manage we start by
defining our logic what our logic does
is to add users to an existing
conversation so we name is a Doozers
conversation
it takes two input parameters the user
ID of a user we want to add and the
conversation ID of the conversation we
want to add how is the true the output
of our logic is very simple it is this
the status of if our users has been
successfully added to the conversation
or not and next let's look into how we
implement our logic first from our app
we write our loading input in real-time
database and then it will trigger a
cloud function which is where the actual
business logic is implemented and lastly
again from our app we listen to our
logic output in real-time database okay
let's look into the first step writing
logic input into real-time database
here's how we represent a business logic
execution in our database we have a
dedicated location inside our database
under a diesel conversation notes to
represent each logic execution under
each charge note we have an input write
node which contains the input of our
business logic in this case it has send
rotation ID any variety of the users
that we want to add then we have an
output rights node which represents the
output our business logic that we want
to share with our pineap-- here we only
have a status of if our business logic
execution has been successful or not
apply naps stops a logic execution by
pushing a new client note under a
physics conversation we add conversation
ID of the target conversation and use
the ID of these that we want to add to
the input objects and then we write it
so the real-time database and next
lesson implements our business logic
using file function we define our
function so that it will be triggered
every time our pineap-- write a new
logic input to real-time database in our
function firstly we extract our logic
input from the database cloud functions
automatically store our input data into
the trigger event object so you can use
it right away without explicitly
accessing the database then we implement
the core part of our business logic
evading eases conversations and
conversations users accordingly
please be noticed that is am accusing an
atomic a bit
so all this in an atomic abyss will
succeed or fail all together so easily
either conversation and conversation
users both get updated already filled
the nuns of the nose change then finally
once our database of this has completed
we write the result to the corresponding
output node so that our client app and
shows the results so our users and
lastly again from our pineap-- we listen
to our logic output in real time
database
this is very straightforward so we had
our database reference so I love the
execution earlier so all we have to do
is listen to change in each choice node
containing the logic output once we have
the output we show it to oasis
accordingly okay now we have all the
premeditation ready let's do a quick
demo our chorus flip to the demo machine
okay so we have our e-commerce app and
we have an in-app chat features that we
invented
now having conversations with two users
conical and mark in our conversation
we'll go ahead and add another users
there let's say we go and ask home to
our consultation so we will expect that
after a logic execution will have some
edits to conversation to users so that
our conversation will have come under
the list of users who are participating
in that conversation and at the same
time under users conversation we expect
to have Tom added here and have our
conversation and there's a list of
conversations that home is operating in
okay let's go ahead and do it now you
can see that our loving execution has
finished and our planet has put has
added a request to act home to our
conversation and the output of our
loading execution indicates that allows
the execution has succeeded so as a
result we have Tom here in conversations
users and under users conversations we
have our composition under the list of
conversations at home is participating
in and that's it let's get back to the
presentation
everything set up our Jesus conversation
logic even work when the device those of
line the lines of execution will be
pushed to the server once internet
connection is restored with value
writing extra codes to store it locally
by yourself you can do even do more
complicated logic with your function for
example you can do one more step
checking is the requesting users is
indeed participating in the target
conversation before allowing him or her
to add others users say let's go back to
our function and see how we ask the
permission check what do you do is first
check conversations users to see if the
current users is participating in the
target conversation if they are not then
do nothing and mark the logic execution
as fill but if they are then go ahead
and update the database to fly what we
did earlier you can do the permission
check using security as well using
security rules as well but doing the
permission checks inside a file content
as a benefit of centralizing your
database manipulation code in one place
and then you can completely disallow
your client to write to the database and
that has concluded our second recipe on
how to avoid duplicating business logic
implementations by implementing them in
Flour functions now a smooth our recipe
for today's how to send push
notifications bar Phi based farmers
living without creating your own server
let's go back to the chat feature that
reveals earlier with firebase when there
is a new chat message essential
conversation we want to send for
specification to always is activating in
the conversation and let them know that
there is a new method we want to use
firebase domestic climate using OFDM to
send our push notifications
primates climaxes in our FCM is another
widely used firebase products one of the
reason for its popularity is that SEM
provide with a unified API to send push
notification to all of your users no
matter that they are on iOS Android or
web browser you only need to keep track
of your user device instant ID token
that you can get from firebase SDK then
when you need to send a push
notification provide FCM with the token
and the data payload representing your
notification content and SEM will do the
rest for you for example if the target
users is on iOS then SEM will talk with
Apple push notification service on APN
to get your message delivered to your
end-users divine when you send push
notifications you need to authenticate
with SEM using your secrets TT so we
can't do it directly from your client
app because that will lick all your
secret key you might think that you need
to spin up a server to send push
notification but it's no longer the case
it gets 12 constants can do it for you
let's see how we do it so there are
three steps first let's write a cloud
function which listen to new chat
message added to our real-time database
next from the message content compose
and send out push notification DSM and
last make sure to subscribe our pineap--
to the right fzm topic so that users can
receive the message we intended to send
them we'll go into details later
so Dori if you don't know what a SM
topic is at this moment now let's start
with writing a function
assume that we have our chat method
store under a methods note for each
conversation we write our function to
which you go when there's a new message
added we have our function to listen to
changes in methods notes under each
conversations note one session which
means that we have a new message added
with an hour personification for all the
users who are participating the in that
conversation now let's see how we send
push notifications first we'll check the
message content author name and
conversation ID from the trigger event
so that we can use it later to press our
push notification message then from the
author name and message content we
create a SEM payload to represent our
push notification methods that we want
to send to our users next we want to
send our message to our users here I
make use of the FSM feature for topic
messaging to simplify our implementation
what we do is we define a topic for each
conversation we name our topic using our
conversation 90 it gets easy and then
all we need to do is to tell FCM through
our admins SDK to send the payload to
the dedicated topic here you no longer
have to bother about handling and same
token by yourself because SSN have
already have it done under the hood for
you and lastly let's make sure that our
users subscribing to the right that's
the end topic
so when your users draw a conversation
you need to subscribe them to the FCM
topic corresponding to that conversation
and don't forget to unsubscribe them
before when they left when we leave the
conversation so that we won't spend them
with the messages that they don't care
about and now you have your third recipe
on how to send push notifications using
SEM without spinning up your own server
and it's time for me to hand the stage
back to Arun so that he can show you the
last recipe that we have for you today
thanks again Khan so so far we've seen
recipes that help you build and release
your app let's now see how we can
improve conversions in your app using
firebase specifically we are interested
in rien gauging users that add to the
cart but abandon the purchase flow
without making a purchase
by sending them a push notification
gently nudging them to complete the
purchase flow here are the steps we will
take the truck and reach out to the non
purchases first we track when a user
adds an item to the shopping cart next
we listen to this event and write
details to the real-time database we'll
see what those details are and when the
items in the cart are eventually
purchased we listen to the purchase
event as well and remove the purchase
items from the real-time database
periodically a cron job runs and gathers
the list of non purchases and their
items and a push notification is sent to
all the non purchasers now urging
nudging them to complete the purchase
thus hopefully helping with our purchase
conversions we used Google Analytics for
firebase to track and mark the user
action as conversion event cloud
functions both as a trigger based on
analytics events as well as timer base
that we'll see in a minute the real-time
database to store a carte items
temporarily and finally FCM to send out
the push notifications let's see each of
these steps in greater detail when an
item is added to a cart and analytics
event is logged here is some Android
code that shows an example of the add to
cart' event
notice that the item details are added
as event parameters so we know that
cloud functions can listen to and
trigger base and Analytics conversion
events so the in order for that to
happen the art cart at the cart event
also needs to be marked as a conversion
event on the console in order for the
cloud function to get triggered based on
this event
we then define a function that will be
invoked when the add to cart conversion
event is logged
and this function writes the user ID to
the real-time database if you recall a
few slides back we had logged the item
details as the event parameters in our
Android code and these parameters are
accessible to the function here and
these are returned to the real-time
database as well here is a snapshot of
the real-time database when a single
item has been added for a user when the
user adds item to the cart as more items
added to the cart these are also added
to the real-time database the real-time
database acts as a placeholder to
temporarily hold users card data that
has not been purchased yet and when I
make user makes an actual purchase the
purchase details are log to analytics
and also registered as a conversion
event as we know by now and when the
purchase conversion event is generated
another cloud function triggers and
removes the temporary records from the
real-time database here is some
functions code to remove the purchase
items from the real-time database
and now we have a snapshot of the
cleaned-up real-time database all the
deleted items are the ones that have
already been purchased periodically or
at the end of the day the real-time
database now only contains details of
non purchases and their user IDs and the
card items but how do we act upon this
data really will use functions to read
this data from the real-time database in
order to send push notifications to
these users but then again what triggers
this cloud function as we mentioned
earlier cloud functions are not only
prepared by events but it also run based
on time intervals we use functions cron
to trigger our cloud functions functions
cron is really not a feature of cloud
functions
it's powered by a Google App Engine cron
job which periodically posts a message
to Google Cloud pops up which then
triggers our cloud functions the github
repository here shows the source code
for the functions cron and all you need
to do is download and run it the
schedule to trigger a cloud function can
be customized in the amble file as shown
here you can do it for your own app and
when the function can't post a message
to Google Cloud pops up the cloud
function is triggered and sends a push
notification to the end user to the non
purchasers really and can't already
covered how to send push notifications
in the previous recipe so we're not
going to go over it again so the non
purchases now see your reengagement push
notifications and may come back and
finish their purchase so now you know
how to improve purchase conversions
using firebase and that concludes the
recipes for today to recap we saw how to
link your existing app users into
firebase using custom art Okun avoid
duplicating business logic by writing
business logic inside of cloud functions
send push notifications using without a
server using cloud messaging inside of
cloud functions and finally try and
improve purchase conversions by tracking
non purchases via analytics and actively
reaching out and angry
engaging with them via FCM we have shown
you how to use firebase to build an
in-app chat feature within an e-commerce
app however developers have used
firebase for mayor the creative use
cases and let's see a few examples The
Wall Street Journal uses firebase
real-time database to cover their live
coverage event on their website wsj.com
some of the events they've covered
includes the US and French presidential
elections sporting events such as the
Olympics of the Superbowl and also the
Oscar award ceremonies instacart
delivers groceries from local stores to
your doorstep and real-time database
enables they're sharing card use case
where users can collaborate real time to
purchase groceries hello world
no pun intended is a Hungary based
travel and discovery app is there
they're a small start-up they use
multiple firebase features including
cloud storage to store high quality
images and the real-time database as the
main database back-end
they chose the real time database for
its ease of use and flexibility being a
start-up allowed them faster prototyping
and experimentation and smart technology
is a South Africa based company that
does classroom education coordination
and collaboration across both platforms
web and mobile to implement failover
redundancy and seamless recovery using
multiple firebase database instances
standby is a job portal in Japan that
connects employers with job seekers they
use real time database to power the
in-app chart features much like what we
showed earlier today allowing job
seekers to directly charge with
potential employers they also use
firebase Cloud messaging to send out
push notifications and they found that
it resulted in doubling the conversion
rate taps games is a game studio based
in Brazil they use the real-time
database and cloud functions to sync
game States and multiplayer games
that brings us to the end of our
presentation today for the next steps we
see the file based documentation here
you can also keep in touch with us on
Stack Overflow and all the other
discussion forums you got I hope you
enjoyed our session and Google i/o thank
you very much for being here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>