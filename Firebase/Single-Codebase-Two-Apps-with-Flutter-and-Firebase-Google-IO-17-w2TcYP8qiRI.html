<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Single Codebase, Two Apps with Flutter and Firebase (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Single Codebase, Two Apps with Flutter and Firebase (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Firebase/">Firebase</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Single Codebase, Two Apps with Flutter and Firebase (Google I/O '17)</b></h2><h5 class="post__date">2017-05-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/w2TcYP8qiRI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good morning I am Emily Fortuna this is
yet another Emily Emily Shack and we are
both software engineers here at Google
we think flutter is a fantastic way to
easily develop beautiful mobile apps and
like to show you how that's done so
let's say you're a startup and you have
the next amazing world-changing idea you
want to get your app out to market as
soon as possible throughout this talk
will be following one such hypothetical
startup in that very situation the
founders of our startup they looked at
the wider Riot array of chat apps
available to them and they felt like
there just needed to be one more on the
market I mean really what their lives
were missing was the ability to Mema
fiying moments of their lives if we
could take a picture and put text
superimposed in impact style on top
because it's clearly insufficient to be
able to take a picture and put text
above it or below it no you got to put
an image macro style share it with your
friends that will truly elevate the
level of communication in the world so
see what we will see here let's switch
to the device screen and we have our
startups flagship chat app named jet
what you see here if you want to be
old-fashioned and just send a text
message do that hit Send
and if it's the first time you're
sending a message you get requests your
Google authentication credentials are
requested because you don't want anyone
impersonating you when you're sending
beams that is very important and of
course talking to yourself only gets you
so far
so we have this running on another
device an iOS device and you can see it
has the same functionality but it looks
a little bit different it's appropriate
to the device that it's running on so
we've got the nice silver screen a top
bar for iOS we've got the material
design app
for Android we have slightly different
fonts and we have slightly different
behavior for the bottom of the scroll if
you're we've got the end over scroll
glow for Android and the end of scroll
bounce for Apple but so far everything
I've shown you is free standard this is
just a regular chat app where's the
secret sauce well and we're going to hit
the image button she's going to take a
selfie with all of you in the background
say cheese
and now we can add our text for the meme
and there you have it we can share it
with your friends so over the course of
this talk would you believe that this
entire app is written with under 400
lines of code with multiple views
firebase integration Google signed in
integrations everything and we will be
live coding this very app and you can
see how easy it is to get from nothing
to a beautiful flutter app just like you
see here so let's jump back to the
slides and so whether you're a startup
with a harebrained idea or you just our
developer they wants to be efficient
with your code or your time flutter is a
really way to easily develop beautiful
mobile apps our startup founders did
some research some market research and
they found that the target demographic
for their meme chat app for iOS users so
they start they heard about this cool
flutter technology they're like yeah
let's check it out
they start coding it seemed like a
pretty nice way to easily start
developing apps and get their app up and
running good news everyone have a
venture capitalist is interested in
funding our startup the hitch though is
our VC is aside from being a cat an
Android user and we want our VC to be
able to dog food our app as soon
as possible so but this means that our
workload is just double because now we
have to write an iOS app in Android apps
and we're just a small start-up we want
to spend time on adding cool new meme
features we don't want to spend time
writing our app twice but fortunately
because we are already writing in
flutter this is easily solvable problem
it is not doubling our workload so
flutter allows you to write your code
once and have a natural feeling app on
both Android and iOS
all in all flutters development
experience is fast and easy letting you
spend less time developing more cool
features for your app flutter also has
an incredible development process with
hot reload which lets you update your
code on the fly without having to
restart your entire app this means you
can get up and running from nothing
extremely quickly and also lets you
literally see your app come to life
piece by piece and of course we
integrate with firebase now we both know
we are on the firebase stage you
probably have already heard about
firebase here at i/o but for anyone who
hasn't firebase is a mobile platform
that helps you quickly develop high
quality apps with our firebase plugin
you can painlessly integrate with a
remote database that uses real-time sync
you can get usage analytics and you can
easily scale up as needed we're going to
get into the specifics of how we do this
a little bit later on in the talk but
for now let's take a look at how easy it
is to get started writing your very
first flutter app so getting your system
ready to develop letter is actually
really easy just clone the git
repository and then you add flutter to
your path one step set up there's a
really cool tool called flutter doctor
that you run and it will check your
system for dependencies to see if there
any remaining dependencies you need to
install examples of this are if you're
doing iOS development you want to
install developer tools or you want to
make sure that you have Java installed
for Android development of course you
don't have to have both of these
installed but you probably want to have
one
because you are developing a mobile app
in sub capacity all right let's jump
over to the code the code screen plus
our app yes there we go
so we have a IntelliJ up and running and
this is where we're going to be doing
our development intelligent has really
nice plug-ins for flutter and dart gives
you Auto completion nice debugging
support and you can run your devices
from IntelliJ so if you're doing
cross-platform development gone are the
days where you need to have Xcode up and
running and Android studio and switch
between them now you can make your
changes in IntelliJ and just run either
device or both from IntelliJ so we took
up the liberty of writing out the
skeleton of our app because no one wants
to watch us type class definitions
that's boring well give you a little
tour of how this is set up so first we
have our main message or our main
function that calls my app which is the
top level widget for our app my app then
has a chat screen which is going to be
controlling the view and what's display
your chat history taking chats all those
things chat screen has a state which we
that's the real meat and potatoes and
where all the interesting stuff is going
to be happening chat user and chat
message are too glorified structs they
basically are holding the actual
information that we want to store for
the chat message so the text you're
sending in the case of like who's
sending it what their profile picture
looks like all those things those are in
their top message list item chat message
content are the last two widgets that
are controlling how they display on your
screen so chat message content says that
message content that you want to send
how should display on the screen how big
should it be and the chat message list
item holds a chat message content and
also shows controls how to display say
your profile picture and your name all
that laid out of the screen so you see
the name widget in a couple places here
what are widgets
when did your entire app is going to be
made out of widgets your app is one huge
widget which has sub widgets which have
sub widgets all the way down if you're
familiar with the react widgets are just
like components but if you're not
familiar with reacts don't worry so
there's a functional reactive framework
and the key idea is you're using your
model data to describe templates for how
your view should look in all sorts of
different situations the framework
itself is the one that controls how to
change between these different views so
it's a slightly different paradigm for
how you think about programming your UIs
and so rather than your more typical
model view controller setup we have a
controller that's running back and forth
and syncing these two things you've got
your model data describing how your view
should look this means that in practice
it gives you a lot of really nice things
like hot reload which we'll demonstrate
but under the covers while the developer
doesn't have to worry about this this
means that the widgets that are created
are immutable and ephemeral and again
while you don't have to worry about how
to change a view with an immutable
widget it helps save the developer from
avoiding a lot of common bugs like if
you have persistent long-running UI
objects they could get in in the
consistent stage and it's hard to debug
this way it makes programming dynamic UI
is much easier your code ends up being
very modular reusable and like I said it
gives you awesome features like hot
reload because you can just swap out
that little widget for the new piece all
right I've talked a lot and we've been
very patiently waiting for me let's
actually dive into the code so we're
going to open up my app and inside the
build method you see we have a material
app which is our widget itself and
material app has a container which is
incidentally also a widget so right now
we have our apps running on the screen
it's not very exciting looking it's
black because we have a black container
to demonstrate hot lue reload and we're
going to update that black to white
because if you remember from our demo we
did not have a black chat screen
we'll hit the hot reload button at the
top and you'll see very quickly didn't
have to do a full rebuild and updated
the app okay but we can use hot reload
to do much more interesting things than
change the colors of your widgets so
let's change the container to be our
chat screen and we'll update again and
once it's updated you'll see we have a
menu bar at the top so we know what chat
screen were works up or running and then
we've got a little space for in the
middle to have our chat history so let's
dive into actually being able to send
messages we're going to do that inside
chat screen save and there's the build
text composer inside that we're going to
add a text field that will accept text
input and as you can see Emily's putting
this inside of a flexible flexible is
another widget that can in this case
because it's controlling the layout so
it's saying hey take this text field and
I want it expand to take all of the
horizontal space that's available to in
the layout text field is taking a couple
of named parameters you see on submitted
and not changed these are going to be
callbacks that are called when the text
is incidentally some that is in changed
now we've been looking at this code it
looks kind of C style esque but we've
got like named parameters and first-name
functions you may be wondering what are
we programming in and the answer is dart
dart is a modern concise dynamic program
language but it has a lot of really cool
features that allow you to develop your
code quickly without sacrificing quality
and safety so we have a statically typed
mode so you could be sure that your app
is doing what you want and it has a lot
of cool features much more interesting
than name parameters one of which is the
nice asynchronous support that we'll be
exploring later is a talk all right so
now when Emily hits hot reload we should
see the text screen come down
the bottom and you should be able to
send a message nothing happens
that's because we haven't actually
implemented our handle submitted
function so let's go jumps to a little
submitted function which is currently
nothing and we will update that so first
we will clear our text message so that
we can add more messages in the future
and then we're just going to call add
message which adds our text to the list
of messages that we will be displaying
in our history now when we hit hot
reload which I will note so we're doing
more interesting things we're actually
changing some functionality in this case
when you hit Send
it's gone forever no actually not
we just haven't updated our view yet so
we restored the message but we haven't
told the view to update so if you're
like me and you like to use your chat
app for sending for writing novels it's
kind of disappointing because you can't
see anything right now but let's go
update the view to tell it to redraw
that piece so in here we're saying when
that message is added we're telling with
you hey my state has changed you should
go redraw this portion this widget and
so we're doing that by calling set
States and then we add that message to
our list of messages from now when we
hit hot reload we should be able to see
our messages and you can use your chat
app as a novel writing app as well all
right we're good so a user's man we did
some our startup did some testing
because they were really excited but
they were not impressed with the SAP
they Center complaining that looked the
same on every platform and they weren't
shoes real about talking to themselves
so let's make a couple changes to make
it look prettier so we'll go up to the
top and we'll add seaming this is going
to allow us to look a little more
specific to the platform that we're
running on so a theme is another top
level widgets that controls the behavior
of his child widgets and in this case
we're saying
a platformer running on and so now when
we hit hot reload you can see the
message bar colors updating with silver
for iOS we've got our dice material
color for a material style for Android
and then we have our this scrolling
behavior that you would expect and so on
there you go and so why do I keep
harping on natural look and feel well
unlike so the interesting thing about
flutter is flutter is drawing every
single pixel to screen so there are no
crazy native om widgets that you're
going to interfere with your app and
interact in weird ways there's no
webview you have to deal with dart sorry
flutter has spent a lot of time in
making the view feel appropriate to the
user and this gives a lot of really nice
features so if you are trying to debug
you can step through your code and look
all the way in and you can also
customize things as needed it's discuss
if the look is not quite what you want
so we're still talking to our and we
need to add some animation to make this
look a little prettier so we were add
our animation controller
Riaan Stan she ate it and we're going to
pass in a duration which basically tells
how long we're adding our animations in
this case we're making a little bit
longer so that you can see it on the
video screen so one more thing to do
when these messages are being built we
are going to call the earth yeah we're
going to create the animation that will
then build this interview so we do that
by creating this ease out animation it
will use it out of the bottom into the
view and then its child is going to be
the original contain the original chat
message item object there's a lot of
really nice animation support
there's flinging they've got lots of
things to make it feel natural and it's
very custom I
Cybil so once we hit hot reload we
should be able to send a message and it
will animate in know what happened so we
have a bug in our code we will we can
look at our console which there we go
there's no stack trace the we see that
chat message has no instant skater
animation controller in this case the
it's supposed to be a capital C for
animation controller camelcase and I
want to also kind of point out it's cool
that the rest of your app is running is
still showing it's just the part that
when we hit that animation it showed you
the red screen of death so I'm going to
update the C for animation controller we
can hit hot reload this time and now
when she sends a message you should see
the message is beautifully glided to
view look at it go
alright so this is good but we're still
talking to ourselves so I'm going to hop
over on the computer screen Don the Hat
of coding +2 and let Emily talk you
through how to add some plugins and let
you do this
cool meme features that I know you are
all dying to learn about how to do so we
have our basic chat app but we really
want to extend its functionality to add
things like communication with multiple
people we want to add things that make
it look a little bit more official maybe
Google sign-in so in order to do that
we're going to use some plugins and
flutter makes it really really easy to
add plugins to our app so in order to do
that we're going to take a look at our
pub spec yamo file now that's a file
that is inside your flutter project and
that's where all of your dependencies
are declared as you can see we've got
flutter there that's going to be in
every flutter project but we're also
going to
five different plugins we're using image
picker Google sign in firebase off
firebase database and the cloud storage
for firebase plugin so each of these
plugins does something a little bit
different for our app and we're going to
get into what all of those
functionalities are a little bit later
on but the suffice it to say that for
now this is the file that you have to
declare your dependencies in and that
takes care of pulling in all of that
code so you can reference it in the body
of your app just like any other flutter
code so let's go back to our main dart
function ah the first thing that we're
going to add is Google sign-in Google
sign-in is going to enable us to go
through an authorization workflow with
your Google account so here we've added
a call to Google sign-in dot sign-in
what that's doing is making sure that we
go through that workflow once that is
complete we're going to incorporate the
Google username and profile photo from
the Google sign-in information in our
message then once we add our message
with that information we have one more
step which is that we have to have a way
to display that profile photo right now
in our chat message list content class
we're using the circle avatar widget in
order to display our profile photo we're
going to switch that out and use the
Google circle Google users circle avatar
widget which comes for free with the
Google sign-in plugin and that's just
going to make it easy to incorporate
that image from our Google profile so
now once we hit hot reload we're going
to go through that workflow and just a
disclaimer we are already logged in on
both of these devices so we won't see
that workflow now but you did see it at
the beginning of the talk and you can
see that we don't have to sign in more
than once and once we're signed in now
we're seeing our name and profile
picture and we can really tell who's
sending that message
unfortunately this information isn't
super helpful yet because we're still
only talking to ourselves so let's add
some more people to the conversation
with firebase database to use the
firebase database
plug in we're going to have to add two
components we're going to have to make
sure that we're writing our messages to
the firebase database we're going to
have to make sure that we're reading in
our messages from the database the
database is going to make it so that we
can store our messages on a remote
database rather than locally on the
device so that anyone who's
authenticated to that database can read
in those messages and write messages to
it and everyone can see that message
list here you can see we're referencing
firebase auth that's where the firebase
Augen comes into play that's just making
sure that we're all sent 'ok ated to our
database so that not just anybody can
see those messages once we're signed in
now we're going to add a listener that's
that messages reference dot on child
added listen call what that's doing is
while our app is running it's checking
the firebase database synchronously to
make sure that all of the messages in
the database are also reflected in our
app when we see any new messages pop up
we're going to then add them to our
message list and now you can see we've
restarted our app and we are we've seen
the whole we've seen the whole database
populating in our app and that restart
by the way was a hot restart rather than
a full app restart which is sort of
similar to hot reload but just making
sure that we're pulling in all of those
messages from the firebase database as
though we were just starting up our app
so we have one more step which is to
push our messages to the database we're
doing that in a simple messages
reference dot push call that's how we're
referencing our firebase instance so now
if we hot reload then we should be able
to send messages back and forth
and as you can see almost
instantaneously those messages appear on
both devices we felt pretty good about
it too we have a working chat off we can
send messages we can talk to each other
we're feeling great at this point we're
getting really close to our goal
unfortunately we still haven't quite
reached the status quo of chat apps
because we're still only sending text
what we'd really like to do is be able
to send images to do that we're going to
use the image picker and storage plugins
the first thing that we're going to do
is add a button to make sure that we are
referencing those plugins when we want
to add a photo so that button is going
to be an icon button that looks like a
little photo and when the user presses
it it's going to kick off that photo
workflow when we go into that workflow
that's going to incorporate image picker
in order to select an image either from
the device camera itself by taking an
image or from the photo gallery that
image is then going to be sent to
storage where we get back a download URL
to display the image in our app so let's
go ahead and write that handle photo
button press function because right now
that photo button we're seeing isn't
actually doing anything the handle photo
button press function is asynchronous
now we said we were going to get back to
this later in the talk and now is the
time asynchronous functions are very
very cruel in dart they're marked by
that async keyword and they're always
going to return a future which is
basically the same thing as a promise
and the idea is that this function is
going to return immediately but sometime
in the future its actual return value is
going to get there so asynchronous
functions can use the await keyword as
you can see here we have three different
calls to await and that's a way of
treating another asynchronous function
as though it were synchronous so we have
a single line of code we're not passing
in any callbacks we don't have any
nested code and we're able to get the
results of that future before moving on
to the next line of our code so this
function is really
to read we don't have a bunch of nested
code where we're not sure when we're
getting back that future value now we've
called our image picker and our storage
plug-in code and now let's see what
happens when we try and send our image
this time we're going to select an image
rather than taking one from the device
camera pretty good so we have a chat app
that can send text and can send images
and we get really excited about this so
we go to our VC unfortunately our VC is
not very impressed
they say you haven't innovated at all in
the chat space this is exactly what
we've seen before in other chat apps how
can we make this better
our VC threatens to pull funding unless
we can pull it together in the next hour
to come up with a special innovation
this is where our Mema fication is going
to come into play how do we mean if I
our app it's really just going to be a
few lines of code if you can believe it
we're going to add something else to our
handle photo button pressed function
which is a call to the navigator
now the Navigator is a handy widget in
flutter that handles switching off
between views so we have multiple
screens in our app and we don't have to
want we don't want to have to write
ourselves that back button or a closed
button of a dialogue so we're going to
hit let the Navigator handle that we're
just going to push a new screen onto the
onto the new page onto the screen it's
going to be a dialog in this case a
full-screen dialogue it's going to be
called the type meme route that is just
another widget we have written it before
the talk it's about 90 lines of code and
you'll be able to check it out later on
our github if you're interested but it's
basically just in other widgets going to
let us write text on top of images so
we're pushing that widget onto the
navigator and then we're getting back
from it our text overlay that we're
going to write on top of our
then we're going to incorporate that
into our message so that when we see our
message in our messages list it has that
text overlay written on top so let's
take a look at me ma
I think the Hat of coating might be
getting a little bit in the way oh sorry
and now once we send that meme it's
going to appear on both devices there it
goes and we have Nemeth ID our life and
finally just to make sure we didn't
cheat anywhere we still can take
pictures as well with our device camera
so let's see if we can go ahead and do
that we're going to take one more
audience selfie just to prove were legit
so it's everyone smile all right
now we've sent that meme so let's take
this back to our VC we're feeling really
really good about it this time I don't
know about you but I think our VC is
going to like it so let's go back to the
slides just to see how our VC reacts we
have a great success on our hands we get
to take the month off we get millions
more dollars of funding to develop the
latest greatest chat app we're feeling
great and we use flutter to get there so
how did we do that using flutter we were
able to get a natural look and feel for
both iOS and Android just by using one
code base that gave us more time to
develop our extra cool meme feature we
also use hot reload the entire time if
you notice we did not fully restart our
app once during this talk that's pretty
cool also meme chat was pretty simple
too right it took less than 400 lines
that includes everything we didn't get
to show you and everything we did get to
show you on so we got a fully
functioning chat app and I haven't seen
that done in under 400 lines before we
also integrated firebase and a few other
great plugins to let our apps talk to
the world now flutter is in alpha and
there are real shift apps out there in
the wild so shown here are two great
examples of flutter apps both internally
and externally Google on Android and iOS
if you'd like to learn more about
flutter you can visit our website at
flutter do that'll get you everything
you need to know about flutter
documentation getting up and running we
also have two code labs here
on campus at Google i/o so we encourage
you to participate in those those are
basically going to create meme chat
without the memes from start to finish
everything we didn't get to show you and
those will be available after i/o on
Google's code lab website as well
finally there was another talk on
flutter here at i/o unfortunately it
happened a couple hours ago so if you
miss that do not worry
it'll be on YouTube in a couple days and
we really encourage you to check that
out that's about flutter from the
perspective of a designer developer
workflow now if you want to delve into
our code a little bit more than we were
able to show you today you can visit our
github at the following link and don't
worry this link will be on the next
slide thank you so much
we hope that you enjoy flutter as much
as we do and that you find a great use
for it in your everyday work we will be
in the firebase sandbox following our
talk so if any of you have questions for
us or want to chat about anything
flutter related we would love to meet
you there and talk about how flutter can
work for you so please please come talk
to us we'd love to meet you thank you so
much thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>