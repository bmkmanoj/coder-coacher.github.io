<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Supercharging Firebase Apps with Machine Learning and Cloud Functions (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Supercharging Firebase Apps with Machine Learning and Cloud Functions (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Firebase/">Firebase</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Supercharging Firebase Apps with Machine Learning and Cloud Functions (Google I/O '17)</b></h2><h5 class="post__date">2017-05-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RdqV_N0sCpM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Lauren and I'm an engineer on
the firebase team I joined Google just
about a year ago in fact next Tuesday
actually my Google verse 3 as I'm really
excited about that thank you thank you
and so during last year I've been
working on the cloud functions for
firebase team and we launched in beta in
March something called cloud functions
for firebase this is a product that
allows you to run custom server code on
Google servers in response to events
happening in your app you might have
already attended in the talks this week
on cloud functions for firebase as many
powerful applications we are sharing
with you one of them today which is how
to easily add machine learning to your
app so before we dive in you must be
thinking why would I care about machine
learning I'm not trying to build the
next self-driving car maybe you are and
if you are get on you but if you're not
is still useful to you it's not just
something that requires this huge team
of data scientists and engineers it is
something that thanks to Google's
technologies you can implement with one
or two engineers and you can use it to
enhance the user experience of your app
something that is important no matter
what you are building so what do I mean
by that
one example is adding multi-language
support you have big ambitions your app
you don't just want to limit your users
to those that speak English with machine
learning it can be automatically
translating content especially
user-generated content that people that
otherwise do not have a common language
can be connected through your app a
great example of this is closed
captioning for YouTube so this is a
feature that you can turn on where a
machine-learning has automatically not
only transcribed the audio of the video
but also translated it so here we have a
video intro introducing cloud functions
for firebase we only made it in English
but a developer in China can simply turn
on closed captioning in Chinese and
follow along another great example of
how much you learn enhances the user
experience
is providing contextual data that your
app can respond intelligently when the
user does something my favorite example
of this is in google photos so if you've
used it before you might know that when
you upload a photo machine-learning
automatically picks out exactly what's
in each photograph and annotates them
physically later when you're looking for
something you can find it really quickly
so recently I was trying to go back to a
hike that I did that I really enjoyed I
knew is by the ocean I knew is in Marin
County I had no idea what the name of it
was but I knew that I had taken a photo
of a sign so I searched dub ocean inside
Google photos it quickly pulled up all
of these photos of oceans I took in the
last few months I saw the ones that
matched the view I remembered
looked at that date put up the rest of
photos from that day and it turned out
to be the Rocky Point Road trail in Mill
Valley so I was able to go back to that
hike and that was a really magical
experience again machine learning here
was behind the scenes it automatically
detected what was in my photo when I
uploaded I didn't have to manually tag
it to try to remember it later so that
was a really great experience for me so
another example of using machine
learning comes from our partner auger
labs
they're a firebase customer one of the
early users of cloud functions firebase
they make mobile apps for art
communities and galleries that enhance
our viewing experience so they use
machine learning in two ways one they
perform image recognition when someone
snaps a photo of an artwork it knows
exactly which piece it is and pulls up
the relevant information about the
artist about the work secondly they use
machine learning whenever someone
uploads photos of artwork to then
annotate them so they're easily
searchable later so this is a great
example of a company that is making an
app where they're using machine learning
to make the experience of something even
more fun in this case walking through an
art gallery so enough talking about
machine learning you must be really
anxious to see it in action so today I'm
going to show you
a few things so we thought you know we
could just do a demo where we show you a
bunch of machine learning apps and you
know show you how they work but it'll be
even more fun to make a game out of it
and use cloud functions to tie together
a few API is one of the API is really
want to show you is called the cloud
video intelligence API this is something
that Google launched in March in beta
and for the first time you can use
machine learning and a very easy to use
API format to analyze video content so
you might have done speech or vision
before for photos but video content was
prior to this really difficult because
of the massive amounts of data in each
file but now you can easily beat a video
and it'll pull out exactly what's fair
so we did prior to this talk as we found
a few videos cranked it through this API
looked at the label and the game we're
going to play today
is where you as players have to guess
with the video intelligence API guessed
based on what you see so I will demo one
round of the game right now then I'll
invite up Brendan to explain the magic
sauce behind the game then our G will
walk us through the code and last but
not least you all get a chance to play
so we can switch over to the demo screen
please so here we've got one video that
we've cranked through the API I'm going
to play it in a sec and here I've got on
my phone which you can see on the screen
being live-streamed and I'm going to
guess what's in the video so I'm going
to play it right now and the way I
interact with this app is by speaking to
it so this red microphone button I'm
going to press speak when I hold it down
and release and I'm done talking sandé
so what happened that what's happening
now is that the audio is being captured
in a file it gets uploaded to cloud
storage for firebase that kicks off a
cloud function which then analyzes it
for correctness and here I got it
cracked so that was sand so some
browsers may not support microphone
access
in that case you can press this keyboard
button at the top left and type in an
answer and step so I see a lot of Sun
here maybe Sun is something else oh it
turns out it was not Sun you can see
here on my app you've got a score so my
score of 1 correct yes the audience
score of 2 because we of course have a
demo bug and it duplicated my answers
and another thing that we see on the big
screen is you see the audience chord
just like we did before but also a
number of languages so here I've only
spoken in English is only 1 and for that
I'm going to I screw up in China I lived
there until I was 10 so I'm going to
speak in Mandarin here so I select
Mandarin from this list click Submit go
back to microphone so I'm going to say
the Mandarin word for Ocean hi-yah
so here is not only transcribing what
I'm saying but also translating it and
then evaluating it for correctness oh I
see what's going on a lot of you are
playing the game ok not demo fail user
error I'm just kidding but thank you for
participating don't worry you will all
get a chance to play later so I want to
draw your attention to a few things so
here we've got an activity stream of
everything that's happening so the blue
is correct yeses the red is sales
guesses and at the end of each round I'm
going to pull up this summary and you
can see this is the answer key so this
is what the video intelligence API has
pulled out and a few of them we've
guessed a few of them we haven't so if
you can switch back to the slide please
we are going to have Brendan walk us
through what's happening
alright thanks Lauren alright hello
everyone my name is Brendan Lim I'm the
product manager and cloud functions for
firebase so you're probably wondering
how we built the app that Lauren just
demoed so the magic behind the scenes
involves using a variety of cloud
machine learning learning API is on top
of cloud functions for firebase so we'll
quickly go through some of the different
machine learning API and see how we can
use them in our own app to improve the
app experience so first off the cloud
video intelligence API is one of clouds
newest machine learning API you can take
any video I run it through this API to
attack different objects labels and even
scene changes for our app we used to
detect objects in the video these
objects will be the answers that you'll
be trying to guess we all play together
so we also use the cloud speech API to
convert audio to text so when Lauren
spoken in the microphone we ran that
audio through the cloud speech API so we
could extract that text the cloud speech
API also recognizes over 80 different
languages and can even stream text
results in real time so our a place to
submit answers in many different
languages for this we use the cloud
translation API this lets you pass in
any arbitrary string and translate it to
over a hundred different languages so
each possible answer in our app has been
run through this API to build out our
answer Bank so although we're not using
this in our app it's important to
mention another machine learning API one
of the most popular ones so this is the
cloud vision API it allows you to
analyze images to detect individual
objects faces extract text even to
figure out if there are certain
landmarks in your photo so this is an
actual photo of my dog they did a
wonderful job of detecting what type of
dog she is and even notice that there's
a stuff calling the photo so for most
use cases these api's are best
implemented off the client and on your
back-end this lets you have a
centralized place to have Audrey logic
for processing input from multi
users allow you to keep long-running
processes and tasks off the client you
can keep things like secrets as well as
secure logic away from prying eyes but
what if you don't want to do with
setting up and managing your own custom
servers
well we haven't thanks for that as you
may have guessed cloud functions for
firebase
so cloud functions is a programmatic
glue it allows you to write custom
JavaScript code deploy to Google's cloud
which we trigger by firebase and cloud
events also there's no need to think
about servers here cloud functions for
firebase lets you run your mobile
backend code without having to worry
about setting up or managing your own
servers you just write your functions
deploy them and that's it so with cloud
functions for firebase you also don't
have to worry about scaling will
automatically spin up new instances
whenever you need them and also scale
back down to zero once they're done that
way you only pay for what you use so
earlier lauren mentioned our girl abs
one of our partners that uses machine
learning to build ask for our
communities and galleries they use they
enjoyed using cloud functions because
they only had to focus on writing the
functions and that's it so let's quickly
dive in and see exactly how it works
so cloud functions are event-driven that
means your functions listen for an event
once that event is submitted your
function gets triggered which executes
the code in your function so what kind
of events do we support right now
there's support for Google Analytics for
firebase the firebase real-time database
cloud storage for firebase cloud pub/sub
firebase authentication and even HTTP
request for inert I'm for integrating
with third parties so let's see how this
looks with the real use case so say we
have an app that allows users to upload
videos to cloud storage so video upload
will trigger a function that listens for
a particular change on a bucket within
that function you can analyze the video
using the video intelligence API
Taylor's results and store them into the
real-time database
so let's quickly take a look at some
code so this is actually a real example
that we're using in our app so after
user account is created we want to set
their default language to English so
this is super simple for us to
accomplish using cloud functions for
firebase so here we're creating a
function that listens for the user on
create event from firebase off first we
grab the users ID from the event payload
and finally we set the user's default
language to English in the real-time
database using firebase admin and that's
it you can also rely on multiple cloud
colleges to create specific workflows
for instance we have a workflow here
that's comprised of two separate
functions so an audio file is uploaded
the cloud storage which triggers a
function this function analyzes the
audio and transcribed it using the cloud
speech API this send gets written to the
database which triggers another function
that function that was listening for the
write in the database well run that text
through the cloud translation API which
will then save the result back to the
database also as I mention you want to
try and keep secure trust the code off
the client since there are ways to
inspect the client code we use cloud
functions to handle all of our scoring
logic so when someone submits an answer
that gets written to our database which
then triggers a cloud function that
contains all of our scoring logic and
depending whether or not the answers
right will update the users score so
with that I'm going to hand it over to
RJ who's me dive into our code
Thank You Brendan so we thought that
before we let you all play the game we
show you some of the backend code the
cloud functions code that powers at all
we won't be showing you all of it but
what we want to show you is two parts
that we think are most interesting we'll
show you the part that does the judging
of the guesses that you have so if you
type in a guess there's some custom
scoring logic that we do on the back end
and but we'll actually start by showing
you the code that does speech analysis
now if we can switch over to the demo
computer please the code that we're
looking at is no js' this is server-side
code as if you were to run it on your
own server except it runs on ours and
what you see is this looks if you if
you've written in note before this might
look familiar we import two main
dependencies one of them is our
functions module and the other is a
helper module that contains my actual
logic we'll get to that in just a second
what you see next is the set defaults
function that Brendan was talking about
before I folded the actual code but the
structure is exactly as we've seen it on
a slide the the cool thing one of my
favorite features about cloud functions
for firebase is that when you deploy
your code the firebase command line tool
will actually read your code and it will
see that for example in this case set
defaults is an authentication function
that runs when a user gets created and
it will install the function for you
without any further configuration on
your parts it sees this from the code
structure similarly if we scroll down a
little bit here to the analyze speech
function which is the one that I'm going
to show you all of the code for you can
see that this is a cloud function and
that has that acts on a storage trigger
when a storage object change
for example we upload a new storage
object we get an event in this event
triggers this function over here so the
first thing I do this is a little bit of
just housekeeping basically when a
function triggers you might have
triggered it accidentally for example
let's say that I'm cleaning up my
storage bucket so what I'm doing first
is oh if I triggered it accidentally if
this is not actually the event that I've
wanted to get I skip this one but let's
say that as is usually the case I'm
actually getting an event that I'm
interested in I will pull out two pieces
of information from the event that I got
in this case the URL of the file that
was uploaded a publicly available URL as
well as the file name of the object that
was uploaded and then I hand it off to
this other module that I have my my own
custom you might call a business logic
module so why am i using a separate
module the reason for that is because I
care about unit testing and by factoring
out my business logic into a separate
module I can write unit tests for
exactly that module and just treat this
this function as the entry point into my
module now if this is something you're
interested in we won't go into depth on
it in this talk but at 2:30 me and two
other colleagues will be talking about
that more here in a session called cloud
functions testability and open source so
if you're interested in it come back
then for now we'll just dive into my
business logic which is over here so
this is the actual logic of the function
that does speech analysis and the first
thing we do is we parse the file name
that I passed in to get some useful
information like the user ID the
language that the user was speaking when
they were when they were speaking to
their phone at the timestamp of the
speaking and then we formulate a request
that we will send to the cloud speech
API now this is actually deceptively
easy when I started using the cloud
speech API I was expecting to have to do
a lot of work but these would this is
six lines of code to do the entire call
to the cloud speech API which is pretty
cool there's a fun thing here by the way
that I'm using you if you've worked in
JavaScript before you may be looking at
this awake keywords at the speech
recognizer line let me pull it up a
little bit so that people in the back
can see it as well
here we go so this recognized operation
you would intuitively assume and you
would be correct that this is a somewhat
longer running operation it might take a
second and in JavaScript that means it's
usually in a synchronous operation but I
like writing my code in a more like
synchronous reading flow even though it
is asynchronous code and so I'm using
the new awake keywords to block on that
line of code until it finishes and then
I'll just move on to the next this is
basically a more fluid way of writing
promises if you've used JavaScript
before if you've never used JavaScript
or in this case actually typescript
before then don't worry this is actually
just code that executes top to top to
bottom so yay all right so we have asked
the cloud speech API to recognize a
audio segment and it turns that into a
transcription which we match with the
current scene that we're in the scene is
something stored in our database we skip
over it if you accidentally press the
button that didn't actually save any
didn't say anything to your phone just
press the button by accident we skip
over that and then the next thing we do
is the transcription will be a full
sentence that you spoke to your phone so
if you said
Beach uh sand then what we get from the
cloud speech API is beach sand and we
want to be generous to you we want to
give you all of these guesses so we'll
split it into individual words so that
you get the guesses beach and sand and
with that we write that back to our
database as a guess so in just a few
lines of code I've done something that I
at least didn't know how to do two years
ago two years ago I would not have known
how to analyze a an audio file for
speech in any number of languages and
here it was in a few lines of code so
that's pretty cool let why thank you so
I wanted to show you one more part which
is the function that judges the guesses
that we make so in this function this is
again my index file so this is my entry
point this function is a database
function and it triggers when we write
to a certain path in the database the on
that right I get an event that just like
with the speech event I will skip if
it's an event that I'm not that
interested in but in the vast majority
of cases I am interested and I will move
on to extracting a few important pieces
of information and then I call my
business logic again so very similar to
what we saw before even though it's a
completely different type of event
triggering this function the logic is
very much the same and that takes us to
the business logic here judging our noun
starts with filtering out any Pranksters
and then getting some information from
the database again in this case the
language that the user was speaking and
the original English translation of the
word that you said now if the guess did
not have an English translation for us
already in the database then it was
incorrect
but if it did have a translation then it
was correct so we know whether you had a
correct guess or not we give you a score
based on that and then we do a number of
operations to write that score back to
multiple places in the database so why
are we doing this
server-side because all of this logic
you could have done client side as well
right well the reason is we don't trust
you we know that you have laptops we
know you can pull them out and we know
that you can edit the code that runs
client-side you cannot edit this code we
determine whether your guess is correct
or not
not you which we like so with that I
will hand it back to Lauren who is going
to play the game with us can we switch
back to the slides actually sorry say
yeah sounds like yeah just no no stay on
the slide okay looks like yes sorry I
misheard you thank you and if we can go
to I can control this actually the next
slide all right so you've all been
anxious to play some people already want
practice so I expect very high scores
this time say that IO so if you're
streaming in remotely wherever you are
in the world you can also play this game
with us by going on this exact URL you
will be prompted to sign in first so you
can do a Google account a github account
or an email password combination great
and then some browsers will also have a
pop-up that asks you for permission to
access your microphone so if you would
like to be speaking to your phone during
this game at please grant it access you
can also play on your laptop if you
don't have well I guess if you don't
have a phone available you have other
concerns but you can also play on a
laptop great so we can switch back to
the demo computer please okay
so we are going to be playing a new
scene space are you all ready all right
okay let the guessing begin
we only have two languages so far so I
need you guys up the language game you
speak another language tap that English
button on the top left corner switch
over to something else at you know five
that's pretty good I think we can do
better though all right wow you guys are
doing great okay let's see what the
result is oh nice you have to manage to
guess all of the possible answers so
that was galaxy nebula space star
universe and you managed to do it in a
bunch of languages okay
thank some people might be confused
about what scene we're on ok Network
nice we got way more languages this time
great job okay so what the API saw from
this video was animal carnivore which
some of you guessed stray that's really
impressive I did not see a carnivore
when I was looking at this cute puppy
dog pet and the actual breed of the jaw
which was terrier sounds pretty cool and
one of you has really great dog breed
knowledge
eleven languages very nice
awesome okay let's see so this one was
bamboo forest nature tree and vegetation
which unfortunately nobody got right but
I guess safety I saw vegetation from the
scene great we switch back to the slide
please awesome so in conclusion I hope
we've managed to convince you that
adding machine learning will greatly
improve your apps user experience and
can do it easily with cloud functions
for firebase so cloud functions allows
you to scale from zero to plan a scale
it is great for resource intensive tasks
that otherwise would be too would slow
down your client would be too intensive
for your client to do it offers a
trusted environment for your code you
can keep your business logic and the
secret sauce of your app within it and
with cloud function I would start with
Google Cloud machine learning api's you
don't need a PhD to be able to offer
things like multi-language support and
other machine learning experiences for
more contextual and intuitive feel to
your app we use the top three from the
slide and our demo today
but we have other machine learning api's
available to you such as natural
language API and the vision API and I
encourage that encourage you to check
them out as well so thank you very much
for being here with us this morning you
want the source code of the app that we
just played you can find that say that
dot io / source at the three of us will
all be at the firebase sandbox right
after this talk you can come ask your
questions then you can also treat it up
tweet at us with the hashtag IO 17 -
function - ml to let us know what you
thought about our talk today thank you
very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>