<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Google I/O'17: Channel 7 | Coder Coacher - Coaching Coders</title><meta content="Google I/O'17: Channel 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Firebase/">Firebase</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Google I/O'17: Channel 7</b></h2><h5 class="post__date">2017-05-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/KJWLctYlcxU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">   5/19/17
.
   Speakers today.

 5/19/17.

  5/19/17.
   &amp;gt;&amp;gt; Good morning.
  We want them to bring more 
friends to your app or game.  We
 are going the talk a lot about 
Firebase today, if you don't 
know what is Firebase, it's a 
set of tools that handicap you 
develop                      
     help you develop better 
apps, with better performance, 
more flexible and help you grow 
your audience, getting more 
users or players.  If you are 
into this kind of thing, you can
 also earn money with that.  And
 Damien, explain that today.
   DAMIEN MABIN:  So, is to get 
more players in their game     
game.  We made about a year ago,
 we found out that 52 percent of
 people find out about new apps 
or new graims from friends
                     games from 
friends' recommendation and 
after that the app store and, 
but the main thing is, friend 
recommendation.  We focus on 
that, on that experience of 
sharing an app with friends and 
colleagues.
   The way we do that is by 
implementing a referral 
mechanism.  A referral mechanism
 is a circle that starts with 
someone that collision on an   
              click      clicks 
on an invite button, a social 
network or whatever.  Later on, 
someone will click on the link, 
install the app, and click on 
the app, and hey, you got 
invited from someone, please log
 in or something like that.  
Later on, the user will log in, 
and we reroute both the sender 
and the recipient of the invite.
  Finally as we are giving a 
reward, we need to think about 
preventing -- people -- fake 
accounts to claim the reward 
without inviting multiple users.
  We will think about that.
   We start, let me introduce 
this      him from Rockbite, he 
will tell you more about their 
experience.
   &amp;gt;&amp;gt; Thank you, Damien.  Hi, 
everyone.
   (Applause).
   &amp;gt;&amp;gt; I'm from Rockbite games, 
and I'm the develop are of the 
game we are talking about.  This
 is basically a game about      
about, deep town is about mine
     mining, crafting and 
science.  It's a scien fiction, 
and you build fact tries.  Deep 
town                        
factories.  It launched two 
months ago, we had about 200,000
 users.  Over 2 million 
installs, very engaged players
        players.
   Now, in deep town, there are 
things like rare items.  And 
rare items you can get from 
ledge dairy chests.  You can get
 a
 legendary chest, if you invite 
a friend, they will get a chus 
as well              chest as 
well.  Whoever wants to invite a
 friend, they have to click on 
the invite button, and we use 
Firebase dynamic links to 
generate a special -- then we 
use Google share to send e-mail 
or use social media to share the
 link     link.  So, now our 
player can just go ahead and 
share that.  And this is how it 
looks on the other side for a 
lucky friend.  They get kind of 
the share link, very nice and 
beautiful, they click on it, 
they can then go to Google play,
 download the game, play the 
game.  When that happens, we 
take no action, we just remember
 that this person was invited 
about       by a friend.  We let
 them play the game.  Now, after
 they spend some time in the 
game and played the tutorial and
 things like that, this is the 
perfect time for us to take 
action.  Now we can still use 
the Firebase realtime database 
to perform the magic of notify
ing everyone that their work has
 been given.  That allows us to 
skip to make -- having servers
        servers, database, that 
does it for is.  When both of 
place get notification, they can
 open the chest, see the nice 
animation of the chest opening
        opening, and they can 
see what's inside.
   That's pretty simple.  And 
the good part is, you can't 
abuse that, because everyone has
 to play the game for several 
minutes and only then they, both
 of them will get the reward.
   In deep town, we use Firebase
.  We use realtime database in 
order to fix our problem and not
 have to maintain any serves.  
We use analytics in order to 
measure our KPI's, do some 
funnels, things like that.  We 
used remote configure to test 
out members, and things like 
that, that really help us a lot 
by increasing the revenue, by 
the way.  We use crash reporting
 on Google play store and we 
also use notifications to send 
out notifications to people.
   Finally, about some 
numbers        numbers.  Invites
 are great.  Players love 
sending them out.  10 percent 
send out an invite to their 
friends.  That's not the best 
part, it's about qualify of 
users you get.  With the 
statistics, we measured, we can 
see that the invited people are 
more likely to spend time in 
game.  They are actually 
spending 22 percent more time in
 the game.  As a result, 15 
percent revenue increase for 
each user     user.  That's 
pretty cool.
   I guess that's it for -- 
sorry, that's it for deep town
     town.  Thank you very much,
 Damien.
   DAMIEN MABIN:  Okay.  So, the
 plan for today, we prepared a 
smaller demo notification, we 
are going to integrate the 
referral into the game.  Can we 
switch to the phone, please?  
That's a demo app, it's just a 
simple game where you can play 
-- oh, no.  Okay.  Just a simple
 game     game.  Okay.  Let me 
first close it.
  So you can log in the game, 
sign in, like Twitter, FaceBook,
 et cetera, and then you can 
play the game which is a game 
that you need to zap -- 20 
seconds, I'm not too good at 
that game.  It doesn't really 
matter much.  So when you finish
 the game, you get the high 
score that gets sink Ron niez
               synchronize ed, I
 have also             also have
 a user name, all of that is 
started in realtime, stored in 
realtime database.  Can we 
switch back to the slides, 
please?  Sorry.
   Perfect, so, in the game we 
already have some part of 
Firebase, we have analytics to 
understand what people are doing
 in the game, we have reporting,
 we have remote config that lets
 us tweak some part of the game,
 like the last 20 second, we can
 swish it, and we have 
notifications and database 
together that let us, like sign 
in the game and create user 
profile in the realtime database
 that store our progress from 
one de-     device to the other.
   So, when we say we have 
notifications, we have two parts
 of notifications in the game.  
First we have when you first 
launch the dame, because we    
                  game, we don't
 want to ask them to sign in the
 game right away.  We let them 
to switch to Google sign in.  It
 gives us, a user ID from the 
start which lets us store the 
user in the Cloud from the start
.  If you have an anonymous 
users       use     user, asking
 for help, we can display the 
user ID, and you can see the 
progress and help him directly 
from the database.  It also 
gives us the same code pass 
because we always have a user ID
, we save, anonymously or with 
realtime notification,
 a simple code pass in the game.
   Woo we      We willing have
              also have a game 
-- we have currently           
currency or some sort of 
mechanism.  In our case, we 
implemented the game play 
limitation, you can only play 
three times every seven hours, 
that will also be our reroute 
with our mechanism.  If we 
invite one friend, we will be 
able to play four times, two 
friends, you will be able to 
play five times, et cetera.  In 
your game, it might be giving 
coins, it might be giving -- or 
whatever.
   And to implement the 
limitations, we need to install 
information in the user profile 
in the realtime database.  
Things, the top left corner, you
 can see the one which is our 
user ID database.  And we have 
-- one is private field and this
 one is public field.  And the 
private field we store 
information, I'm sorry, in the
    the -- go back.  In the 
private field, we store 
information that is written in 
the log inuser, and the public 
2350E8D, we store information 
that are written from the user 
and read by anyone.
   Like in the public field, you
 find information such as your 
high school, your user name, and
 last time you logged in so we 
can show you if your friends are
 still in the game.  And in the 
private field, we store 
information such as -- that we 
will use later on in our server 
implementation, your -- to send 
notifications to players, but 
also how many times you played 
in the last seven hours, which 
is last play, here is the start 
of the seven hours period, and 
number of plays, one, meaning I 
placed once in the last seven 
hours, that will help us enforce
 the limitation, three plays in 
seven hours.
   We have three different 
vectors there.  We have the -- 
invite, the invite and Firebase,
 when you click on the invite 
button, we are going to query 
Firebase and then we are going 
to share it using a system, we 
are going to -- accept the 
dynamic link, later on, he will 
log in the game, at that point 
we are going to give the reward 
which means -- (?).  Both the 
recipient and the sender, of the
 invite and sending a 
notification to both of them so 
they know they received 
something.  The first thing we 
are going to use is dynamic link
.  Dynamic link is just a smart 
URL which contains a payload.  
In our case, the payload would 
be the user ID of the sender 
invite.  If you send me an 
invite, the -- the dynamic link 
will know the user ID of who is 
able to get     read the public 
information.  So if you have the
 app installed, it will launch 
the app, if it's not installed, 
you will be directed to the app 
store, you will be able to 
install the app and when you 
install it, we don't lose that 
information            
information.  So, now let's see 
with this how we are going to 
obtain the dynamic link from 
Firebase and share it with the 
audience.
   &amp;gt;&amp;gt; Thank you.  Nice.  Now we 
start with -- just a caveat here
, we said it was going to be 
live coding, but it's too much 
content so we can show 
everything, sorry for that.  
Let's start from the Java 
part     part, from the client 
side, we are going to create a 
dynamic link by hand.  Just 
create multiple values, I will 
explain to you what we are doing
 here.  I know it's a long link,
 but let me explain the details,
 the first part we have here is 
a domain, this you can copy from
 your dynamic link dashboard on 
Firebase Console.  If you create
 a project, you have that code 
for yourself already, every 
project has of course one 
different, and you can just put 
it there.  After this, you need 
a link, a fall back link.  Why 
do you need this?  For example, 
if you send an invite to someone
 and your friend opens it on the
 desk top on the browse er, this
 is where he is going to be 
directed to.  If he opens in an 
android or I  IOS, it's going to
 be direct to the app or app 
store depend       depending on 
if it's installed or not.  After
 the fall back link, we can add 
as many parameters as we want.  
For our case, we need a user ID,
 it's the sender, it's the 
person that is inviting someone.
  That's what we are adding here
.  You can add as many 
parameters as you want, you have
 access to this later when your 
user opens the link.  You have 
access to all of these 
parameters.
   Aside from the parameters you
 might sues for your 
infrastructure for keeping the 
flow, you also add some other 
special dynamic link parameters 
that just in case here, we call 
social text, and it means that 
whenever you share this, there's
 going to be a special title, a 
special description, and a 
terminate or, so it makes the 
link clear, it makes more, you 
look at something and it's nice.
  And this is how it is.  Just a
 typical -- from android, I'm 
not going to explain because you
 all know this, I'm using the 
dynamic link here.  We have an 
example here.  So, from our 
small game you have just seen, 
you can click on invite, from 
invite, you can choose wherever 
you want to share.  Remember, I 
just shared the code to share 
something, it will trigger that 
share using something, and 
Google keep, because I'm lazy.  
Here is the link that we just 
created, it's over there, there 
is a very long link.  When we 
save and click on Google keep, 
that's what we see.  So that's 
what's been shared, that's what 
your friend would see on the 
message ing app, on the social 
network, whenever you send this.
   And this looks very good for 
me.  This is working, but, yeah.
   &amp;gt;&amp;gt; It's working but it's not 
so great.  You see the link is 
very, very huge.  You barely see
 the bottom.  I'm sure we can do
 better.  Like the idea is, it's
 very long, too long, that's not
 very appealing.  The good news 
is we can get it -- it's totally
 doable.  The bad news, it 
requires several codes.  Let's 
see how this is going to shorten
 the link.
   &amp;gt;&amp;gt; Okay.  Let's do more work.
  Thank you, Damien.
   Let's do the part of 
obtaining the link from the 
Firebase server.  The good thing
 here is, I don't want you guys 
to -- the server to create a 
machine, all of these kind of 
things, I don't want you to talk
 about this today, it's a lot of
 work and you don't need for 
this task, so we are going to do
 something different, called 
functions for Firebase.  It's a 
way to write code that you run 
on Firebase servers and you 
don't need to worry about 
anything, you just write your 
function and it will be fired in
, whenever that event occurs.  
And this event can be write on 
the realtime database, it can be
 whatever the user indicates or 
whenever he logs out, it can 
also be whenever there is a 
conversion event in analytics, 
it could be if there is an HTTP 
code, it makes creating server 
side code easier, much, much 
easier       easier.
   Today we are going to talk a 
lot about functions and it's in 
JavaScript, so bear with me   
me, let's start with the first 
one.
   To create a dynamic link, I 
will go through all the steps 
with you, don't worry.  First we
 need to export a function.  We 
are -- this serves as a heads up
, you put this on one JavaScript
 file.  That's the function.  We
 are going to start when -- the 
name is created by dynamic link,
 this is also going to be the 
URL we are going to call.  We 
are defining that this is our 
HTTP call, HTTPs call, and from 
there we are going to do some 
tests in order.  First we are 
going to validate a header.  We 
are going to create the dynamic 
link after we create the dynamic
 link with the result of that, 
we are going to save to the user
's profile and then return like 
200, if everything is okay and
 un   ununauthorize it if it's 
not good.  Why I'm validate ing 
the header.  Anyone could access
 this URL from any browse er, I 
don't want just anyone to access
 my end point.  I want to 
validate and make sure that only
 the users from my app are 
assessing the end point.  It 
makes -- I restrict the user 
from my resources.
   How do I do that?  Whenever I
 make this call from the client,
 I will put on the header of 
this, I will put a barrier
         bearer, what I'm doing 
here, oh, I have the bearer, 
nice.  Let's split it and get 
the --  after I have this, I 
will call a method from the 
framework, verify the toab end. 
 I don't                    
token.  I don't need to write 
that.  I just call -- and it 
will return to me the code token
 and the idea of the user.      
             ID.  User.  
Whenever I get here, the user ID
 will be user one, and then I 
can use that on my next step, 
that's created dynamic link with
 the user.  To create the 
dynamic link, before doing that,
 we are going to talk about 
another specific -- from 
Firebase, functions for Firebase
.  Sometimes I deploy my code 
and I want to change some of the
 values that this code is using 
without having to rede-r deploy
           de-ply everything, 
                 de-       re
deploy everything and I don't 
want to   to -- very specific 
values from my code, a -- with a
 key, I don't want to write it 
with an API or URL because it 
might change.  And I want to 
Crist liez            Crist liez
      lies            crystal
        crystallize this as much
 as possible.  We talked about 
jaf VA code, now             
     jaf I code, in the -- I can
 just set a variable like 
Firebase dynamic link HPI point 
to create a dynamic link for me.
  I also have to -- I also want 
to define a domain.  The domain 
I just told you, it's the 5X 
code for your, from your 
dashboard.  And finally, I also 
defined a Web -- key that I get 
from my Firebase Console.  Here 
that's very important, you don't
 want to commit your history 
keys, because anyone can find 
that there and it's really not 
safe     safe.  So you can just 
define this environment, and 
whenever you are functions -- 
you have access to that.  That's
 exactly what you are going to 
do.  The first thing I'm going 
to do is functions.config and 
with that, we are going to 
create my URL to    tore for my 
end point.  I will just add the 
-- key, of course, I will get 
the domain because I'm going to 
use on my request, I'm going to 
make a post request to Firebase 
servers now, and I'm going pass 
this body here.  It's a lot of 
code, I'm not going to go into 
details, but the important thing
 you have to look here is to    
sufficient            suffix, 
osks, short             option
       option, short.  This will
 create a short link for me.  
That's the return of that call
     call, as you can see, the 
short link, a user could 
remember that by hand      head.
  Just remember like the 10 
characters.  And the link is the
 other link we created by hand 
just in case for whatever 
reason.  This is the reason from
             return from that 
call.  And saving link, I just 
put this on the user's profile 
to save in the database, I won't
 take too much time, I create a 
map that's a path from the 
database and a value.  With that
, I will just update.  The map 
here is use ergs, user ID public
 fields dynamic link, I put the 
value, short link.  And I save 
to the database using a specific
 construct that's admin.database
.  Why am I using this?  I don't
 want to worry about who is 
calling this, I don't want to 
worry about that.  I want to 
save to the database.  Whenever 
I do that, I have super powers, 
so of course I can over do that,
 I can keep doing to avoid 
mistakes, in that situation, I 
want to save on this user's 
profile this value.  We will use
 this more often later.  And we 
are just updating what we just 
created the map.  After that we 
just returned to save link, the 
body, sorry, to the user.  
Return 200, that's okay.  So the
 call from the client received 
this dynamic link, and he just 
show in the dialogue that we 
have just seen, it's something 
like this     this.  This is 
what we had before.  The result 
of that call now is this one.  
So maybe Damien is happy now.  
Nice, give me the last work.
   &amp;gt;&amp;gt; Okay.
   DAMIEN MABIN:  Now that we 
shared the dynamic link with 
someone, let's see how we just 
implemented that small Box which
 is -- how we get the value from
 the dynamic link user ID from 
the dynamic link.
   When you implement an android
 app, everyone knows that you 
have a life cycle and the first 
is the -- in your activity.  So,
 that code is -- it's generic 
code.  We coordinate the API, 
that goes back, that will be 
executed evidence time that the 
app is                     
          every time from the 
dierk link     link.  We make 
sure that we actually have the 
dynamic link     link, we have 
some way to -- the parameters in
 it.  And then we get the intent
 that was used to trigger the 
app to get the invitation.  From
 that     that, we get the user 
-- the sender ID, so that's the 
parameter we put in our dynamic 
link.  And that isn't      
isn'ter ID will give it to     
                       isn't 
sender ID, will show from the 
sender.  The only thing that 
does that function, first it 
takes the user ID, it reads the 
public field from the realtime 
database and finds the nickname 
of the user, and then it 
displace above that, just says 
hi,  hey, you get invited, and 
you get a reward.  Let's see how
 it looks like.  Can we switch 
to the phone, please?
   Thank you.
   So, I have the link, sent me 
today.  If I click on it, that 
should open my app and that time
 it works.  I have welcome to --
 cls the name of the app, and 
the nickname for lose          
dr   dr -- now, if the click on 
the game, I get the reward.  
Right now we haven't implemented
 anything yet.  Let's see how we
 are going to give the reward.  
So, now we are going to I am 
plem the Box that contains 
logging to Google -- the 
realtime database saying that 
the userrer has converted 
         converted, he has 
logged in -- to both the sender 
and the recipient of the invite 
and finally sending notification
 to both players.  Next is ways 
to tell us more about 
notifications and Cloud base    
 base --
   LUIZ GUSTAVO MARTINS:  Nice, 
after the user accepts an invite
 and signs in, how does the send
er knows that the friend accepts
 an invite or how to do       do
 I know that I received 
anything?  We are going to send 
a message straight from our 
server called message ing.  You 
can send messages straight from 
your server to specific devices 
to topics to -- a bunch of 
number of people if you want.  
So the idea is that you can, 
it's like notification, there's 
something for your here, come 
back to the game, play a little 
bit more, you got some more 
coins.  This is an API that we 
can call from the comment line 
or -- Firebase that you can just
 type it if you just want to 
test or if you are marketing, 
people want to try a little bit.
  And usually what people have 
to do in the past, you had to 
have your own server, your own 
back end just to call a common 
line     line.  Just to do that,
 of course, with limitation, but
 you had to have a server for 
that.  Today we are going to   
to -- call functions and it's
     it's -- you don't need to 
worry about most of the work.  
Let's start by understanding the
 database and what we need from 
it to do the work.  This is lnl 
the same database that     

saw before.  Fist of them is -- 
this value is written here when 
I start as and anonymous user, 
whenever I sign in, I keep this 
anonymous ID.  I got this from 
my previous nodes, I copied here
, and it's important because I'm
 going to use the fact that I'm 
copying this value here to 
trigger functions for me.  The 
other value that's important is 
you invited by, so user one was 
invited Bayouser          Bayous
 user             by, user 0 to 
the game     game.  I can keep 
track of who invited who.  Only 
invited by one person, and later
 by someone else.  The first one
 gets the reward.
   Let's look back at the code 
and understand how we should 
implement that.  We are going to
 create another called 
functional.  Use the same file
     file, put it below.  This 
is a little bit different.  We 
are going to call this validate 
user invite.  And it's not a Web
 hook anymore.  It's a database 
event.  So whenever there is an 
update on that path, users, user
 ID, private fields anonymous ID
, I'm going to react to that 
whenever there is any -- I'm 
going to to ra react          r 
react to that and do something 
on my server.  I'm going to get 
the values from the program     
    parameters, get the private 
field for that user I just 
showed you guys private field, 
invited by.  I get private field
 from the database, and then I'm
 going to activate an invite.  
Act       Activate an invite, 
it's the system understanding, 
hey, this person was invited by 
this other one, and both of them
 have to receive a gift.  That's
 what I'm going to do here.
   Let's take a look on 
activating invite.  I have 
private field and recipient ID  
 ID.  After this, I have, I know
 from private field, I know who 
is invited by and who is the 
sender rt   , and I will just 
use the database reference that 
I explained to you guys 
previously, our right to this 
users sender ID invited, write 
the map that's recipient ID and 
true.  I know it's love things
             a lot of things, 
but the shot of the database 
will be much easier to 
understand.  Sorry, skip that.  
Let's take a look on the 
database and see how it is   is.
  Here, remember, user one, down
 there, invited by.  Whenever 
the invites that user
 would send, by people, this, 
whenever user clicks on invite
       invite, opens the app and
 signs in, what happens is, I 
will start to write on -- 
invited, I will start to write 
values here.  What we can 
understand here is that user two
, three, and four, they were 
invited Bayouser one.  They 
opened the app, and they signed 
in.  That's what's written here.
  And I use this information to 
continue the flow here.  With 
this in mind, now we have to 
give a reward.  There's no 
reward yet.  Nobody is happy.  
Just doing back end to keep 
track of things.
   Oh.  I will explain Cloud 
message ing, sorry.  Let's take 
a look on code to give rewards
        rewards.  First, it's a 
database function again.  And 
now that's where things is going
 to happen.  Bear with me   me, 
it's long, but the idea is that 
I'm doing the same thing for two
 users.  Technically there's a 
lot of duplicate code here.  It 
is also a database function.  
React to whenever a user,  -- 
users       user ID, recipient I
D, whatever light there.  I'm 
going to get user data from the 
sender and the recipient.  The 
two persons involved in this 
transaction, I will get their 
data so I can start to send the 
notification and later increase 
the rewards        rewards.
   I want to explain, because 
it's just a query.  I have the 
user ID, it's just a query.  
Let's take a look on send 
notification to sender, and then
 increase we    reward.  This is
 dpactly the same           
       exactly the same.  I have
 the sender data and the 
recipient data, why do I need 
both of them?  From the sender, 
I need his token that's on his 
database, I need that to address
 him.  That's the way to send 
notification, you need this 
token.  And from the recipient, 
I need his name because whenever
 we send notification, I want to
 send a notification that has 
some kind of meaning, that 
whenever user looks, sees that 
on the notification, he has some
 information already.  I don't 
want to send hey, there's 
something for you, hey, click 
here.  It has no meaning.  I 
want to explain to him, dame ian
       damian -- user invites, 
both of you have gifts, I will 
click here, I will come back to 
the game.  That's where we 
engage our users, that's the key
.
   After that, I'm going to call
 my -- utility function here, 
send notification, I just create
 a payload and then I call 
what's the important part from 
here is, admin      
admin.message ing.send to device
       device.  That's from the 
maim     maimer and that's how 
you send the notification to 
users.  It's one line.  Quite 
simple, right?  You can do this 
from your function, and you can 
do all kinds of integrations 
here     here.  Let's take a 
look at increase reward.  I 
won't take too much time here.  
Admin      Admin.database, I 
will get the current count of 
rewards you have, and add one.  
Let's see the database how it is
 now.
   Here, sorry.  Sorry.  Here my
 we ward count is three.  That's
 what we should expect whenever 
we add to the invited note, 
every time I add someone there, 
it will increase the reward.  
There is a couple of advantages 
of doing that.  One is if I want
 to test, I can just create a 
user five, put through there and
 the function         function 
-- I put this value directly in 
the database, I can bypass the 
app and everything.  If I want 
to give you a specific user, I 
can come here and change the 
function -- so it rearkts even 
from the app or if you like the 
database itself, let's take a 
look at how it is, how it works.
  So, here, dame mon was 
anonymous, which he clicks and 
says oh, I'm Damien, he click Oz
 that.  What               s on 
that.  What happens, when he 
signs in, I will receive 
notification saying hey, someone
 used your invite and he also 
received a notification, you 
also receive an invite, a gift, 
not invite, a gift.  And that's 
how you give the gift.  You send
 notification.  It's shown there
, and we can still improve what 
we have now.  Dame        
Damien?
   DAMIEN MABIN:  So, until now,
 what we did is just put in the 
realtime database something that
 says we -- but nothing else, 
right?  Like you still need to 
write the code that is going to 
look in the database with the 
amount of account that you have,
 the user can play or cannot 
play.  As you     you all know, 
it's fairly possible that people
 will try to compare with your 
code -- and will try to remove 
the limitation, so you should 
try to enforce the limitation 
when you can.  I know like some 
games play only on-line, so they
 have the logic on-line running 
the se    server, but there is a
 whole range of gray area where 
you have all the logic and hope 
no one will compare with your 
code or in the -- you have on 
this side and part of the logic 
on this side.  And I did that by
 using -- in Firebase.  So, we 
just -- functions which is a way
 to execute JavaScript function 
in the environment server side, 
it contains a lot of logic, like
 from part of the dsm B, we send
 notifications, et cetera, but 
we also have something called 
creating -- Firebase, when the 
clients comes and tries to write
 something in the DB, he is 
doing something that he has the 
right to do.
   And one side, we have 
CloudFunctions, which is very 
fictional, and the other side, 
we have rules which are less 
flexible, but are free to use.  
So what I did is, in the 
realtime database, if you 
remember, we had the node for 
the number of times you played 
in the last seven hours and when
 it started, that seven hours 
period.  I just implemented a 
set of rules that say that if 
someone comes and fries to write
 that he played minus one time, 
it won't work.  If he tried to 
write that he played three times
 instead of, he already played 
like four times before, that 
won't work.  If he tried to 
change the seven hours period 
while -- than the last time, he 
started the seven hours period, 
that still won't work.  The 
server will validate that when 
you write in the DB is correct
         correct.  If that 
succeeds, I will let -- the user
 play, if the -- I want the user
 play.  The cool part is, if I 
disied later on I           
        decide to give five     
five -- per day, I can change 
the rules and it will 
automatically get five free play
.  One little catch,y woo can 
also use                   , , 
we can also use, Firebase -- 
implementing games is usually 
done in -- by most of the people
 out there.  And again use both 
the together.  You can implement
 part of the notification and 
mechanism in July in you want, 
part of the logic for limitation
 using Firebase -- and you might
 know that -- harder to compare 
with     with, .  That will also
 help you enforce limitation.
   Okay.  So, he is going to 
tell us where we are going to go
 next.
   LUIZ GUSTAVO MARTINS:   
That    That 's what we want to 
explain to you guys, IP you 
enjoyed a lot    lot.  If you 
want to enjoy more about 
Firebase, there's a lot of good 
talks here, next one integrate 
ing machine learning, learn 
everything about CloudFunctions,
 to improve from there.  There 
is will how to better protect 
your database, how to test 
better your functions and 
there's an amaze ing section at 
3:30 that will show you lots of 
recipes that you can easily 
implement in your app just by 
using the Firebase and then you 
can improve your app easily.  
With that, just one more detail.
  All the code we have seen here
, the Java part, the server part
, the rules, everything will be 
on -- by next week, so, just -- 
if you need that.  We will post 
it so you can come back to our 
office and what I want you to 
take from this talk, all you 
need to take from there talk, 
     talk -- Monday, and then 
your boss will come to you and 
say okay, you were there 
enjoying the event, everyone was
 happy.  What did you learn?  
What can you add to our app 
today?  You can just say hey I 
can reward for engage many.  
There, you have your promotion. 
 So, you're welcome.
   DAMIEN MABIN:  Just now, like
 we still have one gift to give 
you.  If you -- yeah, if you 
click on, if you get that link, 
you can download the game and 
that will also reward me because
 that's my link.  (  (laughing) 
.  Thank you very much.
   &amp;gt;&amp;gt; Thank you very much.
   (Applause).

 5/19/
17
.
   Single code base
 coab,

 flutter


.
   .
   .
   .
   .
   .
   .
   .
   .
     .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   5/19/17.
   Single codebase, two apps!
   Stage 7.
   10:30 a.m.
  PT.
   Speaker:  Emily fortune in a
                 Em    


   Single codebase, two apps!
   Emily Fortuna and Emily shack
.
        Shack.
   &amp;gt;&amp;gt; BRIDGET FREY:  ,.
   EWA GASPEROWICZ:  
,



Flurt

IOS.  IOS.
Ize,ize,
     ,     .          Is iOS,   
    Is               p
 meme,

      apps!meme I have 
indication

!


   Single codebase, two apps!

Firebase        
Meme chat



5/19/17.
   Secure and seamless sign-in  
      sign-in.  Dominic
 pat remember             
           Dom  

 Dominic
 bat,
                 Dom
     Dominic Battre,
 eej cit

   DAMIEN MABIN:  ,.
   EMILY SHACK:  , Kim Paul
 hams

                            .
   JEFFREY POSNICK:  
   EMILY SHACK:  
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
   .
     .
   &amp;gt;&amp;gt; My name is Lauren, I 
joined Google just about a year 
ago, it's my Google anniversary,
 I'm excited about that.  Thank 
you, so during the last year, I 
have been working on the Cloud 
functions for Firebase team.  We
 lurched in beta                
 launched in March.  This is a 
product, custom server code, 
Google servers in response to 
events happening in your app, 
you might have attended some of 
the talks this week on Cloud 
functions for Firebase, as many 
powerful applications  
            applications we are 
sharing with you one of them 
today which is easily add 
machine learning to your app.
   So, before we dive in, you 
must be thinking, why would I 
care about what she is learning?
  I'm not trying to build the 
next self-driving car, maybe you
 are, if you are    are, get on 
you            good on you, but 
if you are not, it's still use
ful to you, it's something that 
thanks to Google's technology
           technologies, you can
 implement with one or two 
engineers, and can use it to end
     enhance the user experience
 of your app, something that is 
important, no matter what you 
are building.
   So, what I mean by that, one 
example is adding
 multi        multi language 
support, you don't want to just 
limit your user to those that 
speak English, with machine 
learning         learning, it 
could be automatically 
translating content, especially 
user generated content, people 
that don't otherwise have a 
common language can be connected
 through an app.  The great 
example of this is closed 
captions ing for YouTube.  This 
is a feature that you can turn 
on, where machine learning has 
automatically transcribed the 
audio of the video but also 
translated it.  Here we have a 
video introducing Cloud function
s for Firebase, we ls only made 
it in English, but a developer 
in China can simply turn on 
closed captions ing in Chinese 
and follow along.
   Another great example of how 
machine learning enhances the 
user experience is providing 
contextual data so your app can 
respond intelligently had the 
user does something.
   My favorite example of this 
is in Google photos.  So, if you
 used it before, you might know 
that when you up load a photo, 
machine learning automatically 
picks out exactly what's in each
 photograph and annotates them. 
 Later, when you are looking for
 something, you can find it 
really quickly.
   So recently, I was trying to 
go back to a hike that I did 
that I really enjoyed, I knew   
     I knew it was by the ocean,
 I had no idea what the name of 
it was, but I took a picture of 
the sign, I searched ocean, it 
quickly pulled up photos of 
oceans, I saw the ones that 
matched the view I remembered, 
looked at that date, put up the 
photos from that day and it 
turned out to be the rookie  
      rocky rode trail.  I was 
able to go back to that hike.  
Machine learning was behind the 
scenes       scenes.  It 
automatically detected what was 
in my photo, I didn't have to 
manually tag it to rye to 
remember it later      later.  
That was a really great 
experience for me.
   Another example of easy 
machine learning comes from our 
partner, Auger labs, they are a 
Firebase customer, one of the 
early use     users, they make 
mobile apps that enhance our 
viewing experience.  So they use
 machine learning in two ways.  
One, they perform image 
recognition, which someone snaps
 a picture of an artworks and 
knows exactly which piece it is 
and pumps       pump      pulls 
up information about the artist 
and the artwork.  And then they 
annotate them so they usually 
searchable later.  This is a 
great example of a company that 
is making an app using machine 
learning to make the experience 
of something even more fun, in 
this case, walking through an 
art gallery        gallery.
   So, enough talking about 
machine learning.  You must be 
really anxious to see it in 
action.
   So, today I'm going to show 
you a few things.  So, we 
thought, p   you know, we could 
just do a demo and show you a 
bunch of apps and show you how 
they work, but it wub more fun 
to make a game out of the it and
 use cload functions to tie 
together a few APIs, the APIs I 
want to show you is the Cloud 
intelligence, this is Google 
launched in beta in March.  In 
an easy to use format to analyze
 video content.  You might have 
done speech or vision before, 
for photos.  But video content 
was    was, prior to this, 
really difficult because of the 
massive amounts of data in each 
file.  Now you can easily feed 
it a video and it will pull out 
exactly what's there.  So, what 
we did prior to this talk, we 
found a few videos, cranked it 
through the API, looked at the 
labels and the game we want to 
play today is where you as 
players have to guess what the 
video intelligence API guessed 
based on what you see.
   So, I will DLP mow one of the
 games right now and I will 
invite up Brendan to explain it,
 and then RJ will walk us 
through the code and you all 
will get a chance to play.
   So, we can switch over to the
 demo screen, please.  Here we 
have got one video that we 
cranked through the API.  I'm 
going to play it in a second, 
and here I have on my phone, 
which you can see on the screen 
being leave streamed, and -- 
guess what's in the video.  I'm 
going to play it right now.  The
 way I interact with with this 
app is by speaking to it.  This 
red microphone button, I'm going
 to press, speak had I hold it 
down and release when I'm done 
talking.  Sand.  So, what 
happened, what is happening now 
is that the audio is being 
captured in a file, up loaded to
 Cloud sphornlg Firebase,      
              sphornlg Firebase 
                  storage 
Firebase, and then analyzes it 
for correct        correctness 
and here I got it correct.  That
 was sand.  Some browse ers may 
not support microphone access, 
in that case you can press the 
keyboard button at the top left 
and type in an answer instead.  
I see a lot of sun here.  Maybe 
sun is something else.  Oh, it 
turns out it was not sun.
   You can see here on my app, 
you have got a score, so my 
score of one correct guess, the 
audience score of two, because 
we, of course, have a demo bug 
and it duplicate ed my answers. 
 Another thing we see on the big
 screen, you see the audience 
score just like we did before, 
but also number of languages.  
Here I have only spend       
spoken in English, on one for 
that.
   I grew up in China       
chien China, I'm going          
        China, I selected 
Mandarin from in list     list, 
click -- I'm going to say the 
Mandarin word for ocean.  (
speaking Chinese (  (pronoun. 
          (           chai      
Chinese.)  it's also tran late
 ing        late                
translating it.  A lot of you 
are playing the game.  Okay.  
Not demo fail.  User error, I'm 
just kidding.  But thank you for
 participating.  Don't worry you
 will all get a chance to play 
later.  I want to draw your 
attention to a few things.
   So here we have got an 
activity stream of everything 
that's happening the blue the 
correct guesses, the red is 
failed guesses.  And at the end 
of each round, I'm going to pull
 up the summary, you can see 
this is the answer key    key, 
which is a the video 
intelligence has pulled uh    
out, and a few of them we 
haven't.  If you can switch back
 to the slide, please, we are 
going to have Brendan walk 
through what is happening.
   (Applause).
   &amp;gt;&amp;gt; All right.  Thanks, Lauren
, hello, everyone.  My name is 
Brendan Lim, I'm the project 
manager in CloudFunctions for 
Firebase.  You probably wonder 
how we built the app.  It 
involves using a variety of 
Google machine learning on top 
of Cloud functions for Firebase.
  We can see how we use them in 
our own app to improve the app 
experience.
   First off, the Cloud video 
intelligence API is one of Cloud
's newest learning APIs, you can
 run it through to detect 
different objects, labels, and 
even scene changes        
changes.  For our app, we used 
it to detect -- in the video.  
These objects will be what you 
will be trying to guess when you
 all play together.
   We also use the Cloud speech 
to convert audio to text.  So, 
when Lauren spoke into the 
microphone, we ran that through 
the speech API so we can extract
 that text.  The Cloud speech 
API also recognizes over 80 
different languages and stream 
in realtime.
   So, our app answers languages
 in many different languages, we
 use the Cloud transz        
translation API.  This 
translates it into over is 
hundred different languages.  
Each possible hawng has been run
 to build-out our database.  
It's important to mention 
another machine learning API.  
This is a Cloud vision API.  It 
allows you to analyze images to 
detect individual objects, faces
, text, even figure out if there
 are certain landmarks in your 
photo.
   This is an actual photo of my
 dog, wonderful job with 
detecting what type of doing 
there is, and even notice there 
is a stuffed toy in the photo.
   For most cases, these APIs 
are best implemented of a      
off the client and on your back 
end.  This lets you have a 
central        centralize ed 
plays to have logic for process
ing input from multiple users 
and allows            and allow 
you to keep tasks -- keep 
secrets away from prying eyes.  
What if you don't want to deal 
with setting up and managing 
your own custom servers?
   Well, we have this thing for 
that.  As you may have guessed, 
Cloud functions for Firebase.  
So, Cloud functions           
functions is a problematic glue.
  It allows to you write co- , 
deploy to Google's code, 
triggered by Firebase and Cloud 
events.  Also there is no need 
to think about servers here.  
Cloud functions for Firebase 
lets      let's you run your 
code without having to setting 
up or managing your own servers.
  You write your functions, 
deploy them and that's it.
   So, Cloud functions for 
Firebase, you also don't have to
 worry about scaling.  It will 
automatically spin up new 
instances and scale them back to
 0 when they are done.  That way
 you only pay for what you use.
   So, Earl      earlier, Lauren
 mentioned Auger labs, one.  Our
 partners that using machine 
learning to build apps for our 
community and galleries     
      galleries.  They enjoy 
using Cloud functions because 
they only had to focus on 
writing the functions and that's
 it.
   So, let's quickly dive in and
 see exactly how it works.
   Cloud functions are event 
driven.  Once the event goes 
admitted.  Your function gets 
triggered and executes the code 
in your function.  What kind of 
events do we support?  Right now
 there's support for Google 
analytics for Firebase and 
Firebase realtime database  
       database, Cloud storage 
for database, and even -- for 
integrate ing with third parties
        parties.  Say we have an
 app that allows users to up 
load videos to Cloud storage.  
So, video up load will trigger a
 function that lists for a 
particular change on a bucket.  
Within that buption         
function, you can analyze the 
video using the intelligence API
 and take the results and store 
them into the realtime database.
   So, let's quickly take a look
 at some code.  This is 
actuality           actually a 
really example we are using in 
our app.  After a us aer account
 is created, we want to set the 
default to English.  This is 
super simple for us to 
accomplish.  So here we are 
creating a function that listens
 for the user on create events 
from Firebase on   on.
   First we grab the userrer's I
D, and finally, we set the user
's default language in English 
in the realtime database using 
at minute.  That's it.  You can 
also rely on multiple Cloud 
functions to create specific 
work flows, for instance, we 
have a work flow here, two 
functions, audio files, up load 
the the Cloud storage which 
triggers the fudges.  This     
          function.  And this 
translate late it using         
     s it, and this triggers 
another function, the database 
will run that text through the 
Cloud translation API which will
 save the result back to the 
database.
   Also as I mentioned, you want
 to try to keep secure trusted 
-- secure.  We use Cloud 
functions to handle all of our 
scoring lodge can           
logic, and then it sh depending 
on whether or not the answer is 
right, will update the user's 
score.  I'm going to hand it 
over to RJ who is going to be 
diving into our code.
   RJ HUIJSMAN:  Thank you   
                          junior
, thank Brendan               .
   RJ HUIJSMAN:  , thank, 
Brendan.  We won't be showing 
you all of it, but what we want 
to show you is two parts that we
 think are most interesting.  We
 will show you the parts       
part that does the judging of 
the guesses that you have, so if
 you type in a guess, there's 
some custom scork logic that we 
do on the back end.  But we will
 actually start by showing you 
the code that does speech 
analysis.
   Now, if we can switch over to
 the DLP mow computer, please
                          demo 
computer, please.  The code we 
are, looking at is node JS, this
 is server side as if you were 
to run it on your own server 
except it runs on ours.  What y
ou see is, if you have written 
in node before, this might look 
familiar.  We import two main 
dependency ies, one of them is 
our functions module and the 
other is a helper module that 
contains my actual logic.  We 
will get to that in just a 
second.  What you see next is 
the set de-faults           de-
     defaults function that bren
 done           Brendan was 
talking before, it's exactly how
 I   you see it on the slide.  
The cool thing, one of my 
favorite features about Cloud 
functions for Firebase, is that 
'when you deploy your code, the 
Firebase command line tool will 
actually read your code and it 
will see that, for example, in 
this case, set defaults is an 
you a then            
authentication function that run
s whether a user        when a 
user gets created and it will 
install the function for you 
without any further 
configuration on your part.  It 
sees this from the structure  
         code structure.  When 
we scroll down to the analyze 
speech function, which is the 
one I'm going to show you all of
 the code for, you can see that 
this is a Cloud function, that 
has, that acts on a storage 
trigger, when a storage object 
changes, for example, we up load
 a new storage object.  We get 
an event.  And this event 
triggers this function over here
.
   So, the first thing I do, 
this is a little bit of just 
housekeeping, basically.  When a
 function triggers, you might 
have triggered it accidentally  
           accidentally.  For 
example, say I'm cleaning up our
 storage bucket.  If I triggered
 it accidently, if this isn't 
the event I wanted to get, I 
skip this one.  But let's say 
that, as is usually the case, 
I'm getting an event that I'm 
interested in.  I will pull out 
two pieces of information from 
the event that I got, in this 
case, the URL of the file that 
was up loaded, publicly 
available URL    URL, as well as
 the file name of the object 
that was up loaded.  Then I hand
 it off to this other module 
that I have, my own custom, you 
might call it business logic 
module.  So, why am I using a 
separate module in the reason 
for that is because I care about
 unit testing.  And by factoring
 out my business logic into a 
separate module, I can write U  
UNI tests for that module and 
treat this function as the 
entrypoint into my module.
   Now, if this is something you
 are interested in, we won't go 
into depth on it in this talk, 
but at 2:30, me and two other 
colleagues will be talking about
 that more here in a session 
called Cloud functions test 
ability and open source, if you 
are interested in it, come back 
then.  For now, we will just 
dive into my business logic, 
which is over here.  So, this is
 the actual logic of the 
function that does speech 
analysis.
   And the first thing we do is 
we pars the file name that I put
 in to get some useful 
information, like the user ID, 
the language that the user was 
speaking when they were speaking
 to their phone, the time stamp 
of the speaking, and then we 
formulate a request that we will
 send to the Cloud speech API.
   Now, this is actually 
deceptively easy.  When I 
started using the Cloud speech 
API, I was expecting to have to 
do a lot of work.  But these, 
this is six lines of code, to do
 the entire call to the Cloud 
speech API, which is pretty cool
.
   There's a fun thing here, by 
the way, that I'm using.  If you
 have worked in JavaScript 
before, you may be looking at 
this await key word at the 
speech recognize line.  Let me 
pull it up so people in the back
 can see it as well.
   Here we go.  So, this 
recognize operation, you would 
intuitively assume, you would be
 correct that this is a somewhat
 lodge       longer running 
operation, it might take a 
second.  In JavaScript that 
means it's a   a synchronous 
operation.  I like writing my 
code in a sink cron nows flow  
                   synchronous 
flow, I block that line of code 
until it finishes and I will 
move on to the next.  This is 
basically a more fluid way of 
writing promises, if you have 
used JavaScript before.
   If you have never used 
JavaScript, or this      in this
 case typed script before, don't
 worry, this is just code that 
executes top to bottom.  So, 
yeah.
   All right.  So, we have asked
 the Cloud speech API to 
recognize a audio segment.  And 
it turns that into a 
transcription, which we match 
with the current scene that we 
are in.  The scene is something 
stored in our database.
   We skip over it, if you 
dispently press the           
          accidentally, it 
didn't say anything to your 
phone, just press the been by 
accident, we Kip     skip over 
that.  The next thing we do is 
the transcription will be a full
 send attendance that      
                sentence that 
you spoke to your phone, if you 
said beach, sand, then what we 
get from the Cloud speech API is
 beach sand.  And we want to be 
generous to you, we want to give
 you all of these guesses, so we
 will split it into actual words
 so you gets the guesses, beach 
and sand.  With that, we write 
back to our database as a guess.
   So, in just a few lines of 
code, I have done something that
 I at least didn't know how to 
do two years ago.  Two years ago
 I would not have known how to 
analyze an audio file for speech
 in any number of languages.  
And here it was in a few lines 
of code. pretty cool.
   Why, thank you.
   (Applause).
   &amp;gt;&amp;gt; I wanted to show you one 
more part which is the function 
that judges the guess      
guesses that we make.  So, in 
this function, this is, again, 
my index file, so this is my 
entrypoint.
   This function is a database 
function.  And it triggers when 
we write to a certain path in 
the database.
   The, on that right, I get an 
event that just like with the 
speech event, I will skip, if 
it's an event that I'm not that 
interested in, but in the vast 
majority of cases, I am 
interested and I will move on to
 extracting a few important 
pieces of information.
   And then I call my business 
logic again.  So, very similar 
to what we saw before, even 
though it's a completely 
different type of event Trigg 
      triggering this function, 
the logic is very much the same.
  That takes us to the business 
logic here., this starts with 
filtering out any prank sters 
and getting information from the
 database again, in this case, 
the language that the user was 
speaking, and the original 
English translation.  Now, if 
the guess did not have an 
English translation for us 
already in the database, then it
 was incorrect.  If it did have 
a translation, then it was 
correct.  So we know who you had
 a correct guess or not    not. 
 We give you a store based on   
             score based on that
.  And we do a number of 
operations to write that score 
back to multiple places in the 
database.  Why, we doing this 
server side?  Because all of 
this logic you could have done 
client side as well.  Right?  
The reason is, we don't trust 
you.  We know that you have 
laptops, we know that you can 
pull them out and we know you 
can edit the code that runs 
client side.  You cannot edit 
this code.  We determine whether
 your guess is correct or not, 
not you, which we like.
   So, with that, I will hand it
 back to Lauren, who is going to
 play the game with us   us.  
Can with we switch back to the 
slides?
   &amp;gt;&amp;gt; Actually, stay on -- yeah.
  Stay on the slide.  Sorry.  I 
misheard you.  Thank you.  If we
 can go to, I can control this, 
actually.  The next slide.  All 
right.  So, you have all been 
interested in play, some of you 
have already practiced.  I 
expect very high scores this 
time.  Say that.IO.  If you are 
extreme ing in,               
extreme         streaming in, 
you can go on this IO.  You will
 be prompted         prompted, 
you can sign      sign in with 
an Google act or a password 
combination.  Some browse ers 
will also have a pop up that 
discuss you for permission to 
access your microphone, so if 
you would like to be speaking to
 your phone during this game    
 game, plays grant it access.
   You can also play on your 
laptop, if you don't have, or, I
 guess if you don't have a phone
 available, you have other 
concerns, you can also play on a
 laptop.
   Great.  If you can switch 
back to the demo computer, 
please.
   We are going to be playing a 
new scene.  Space.  Are you all 
ready?  All right.  Let the 
guessing begin.
   We only have two languages so
 far.  So I need you guys to up 
the language game, if you speak 
another language, tap that 
English button on the top left 
corner, switch over to something
 else that you know.  Sorry, 
that's pretty good, I think we 
can do better, though       
though.
   All right!
   Wow, you guys are doing great
.  Okay.  Let's see what the 
result is.  Oh, nice.  Yes    
Yes, manage ed to guess all of 
the possible answers, galaxy, 
space, star, universe, and you 
managed to do it in a bunch of 
languages.
   Okay.
  I think some people might be 
confused what scene we are on.  
No, we are good.
   Nice.  We got way more 
languages this time.  Great job.
   Okay.  So, what the API saw 
from in video is animal, 
carnivore, which some of you 
guess et right.           right.
  I did thought see a carnivore.
  Dog, pet, and the actual breed
 of the dog, Terrier, that was 
pretty good.  One of you has 
great dog breed knowledge.
   Is 1 languages, very nice. 

nice.
   Awesome.  Okay.  Let's see, 
this one was bamboo, forest, 
nature, tree, and vegetation, 
which unfortunately nobody got 
right.  But I guess the API saw 
veg accommodation from the    

.  So, in conclusion, IP we 
managed to convince you that 
machining           managed 
machine learning can help you, 
and you can easily do this with 
Cloud base.  From 0 to plan a 
scale, it is great for resource 
intensive tasks that otherwise 
would be too, would slow down 
your client, would be too 
intensive.  It offers a trusted 
environment for your code, you 
can keep your business logic and
 the secret sauce of your app 
within it.
   And with Cloud function, I'm 
sorry, with Google Cloud 
learning APIs, you don't need a 
PhD to be able to offer things 
like multiple tie language 
support                    
                multi language 
support.  We use the top three 
from the slide in our demo today
, but we have other machine 
learning APIs available to you, 
such as natural language, API 
and the vision API, and I 
encourage you to check them out 
as well.
   So, thank you very much for 
being here with us to morning.  
If you want the source code of 
the app we just played, you can 
find that say    that.IOS.  You 
can come, ask your questions, 
you can also tweet at us with 
the hash tag IO17-functions 
dementia ML to        
                functions -- ML.
  Thank you very much.
   (music) .

 5/19/17
.
   Dominic Battre              
Eiji,  kit mur a, kit mur a


   .
   .
   .
   .
   .
   .
   .
     .
   .
   .
   .
   .
   .
   .
   .
   .

 .
   DOMINIC BATTRE:  ,.
   EIFI KITAMURA:  ,.
   KIM PAUL HAMUS:  ,


 5/19/17.
   Google I/    I/    I/glo

      I/O.
   P Secure and seamless sign-in
       sign-in.
   11:30 a.m.  PT.
  Speakers:
            .
   Speakers:  Dominic Battre, 
Eiji kit miewr           mur    
 kit mur         Kitamura
, and Kim Paul Hamus.
  Auth      


           seamless          
seam                  
                I     

   Single codebase, two apps ?.
         apps!
   Speakers:  Emily four tuna
           Fortuna and Emily 
Shack.
   EIFI KITAMURA:  ,.
   EMILY FORTUNA:  ,



Two apps!
   10:30 a.m.  PT.
   Meme chat
                      p meme if 
I           
   Meme-ification   


Jordan Emily              
         I'm Emily Fortuna, and 
this is Emily can sha         
Shack.  It's a beautiful way to 
develop apps and I would like to
 show you how that's done.  
Let's say you are a start up and
 you have the next amazing world
 changing idea.  You want to get
 your app out to market as soon 
as possible.  Throughout this 
talk, we will be following one 
such hypothesis start up in that
hypothetical start up.  They 
looked at a wide array of    
available to them.  And they 
felt like there need to be one 
more on the market.  I mean, 
really, what their lives were 
missing was the ability to meme 
IFY moapts of their lives      
lives,                        
moments of their lives, if we 
can take a picture and put text 
imposed, because it is 
insufficient to put text above 
or below it, you have to put it 
image macro styles        style 
that would truly elevate the 
communication in the world      
world.  So, what we will see 
here, let's swish       switch 
to the device screen.
   And we have our start up flag
 ship meme chat.  What you see 
here, if you want to be old 
fashioned and just send a sphex 
text message, you do that, hit 
send, and if it's the first time
 you are sending a meanl you get
 a request, your Google 
authentication credentials are 
requested, you don't want anyone
 I am inpores nature ing        
  nature                in
                any     anyone 
inpercent nature ing you.  So, 
we have this running on another 
de-    de-advice.  An iOS device
, you can it has the same 
functionality, it's appropriate 
to the device that it's running 
on.  You have the nice silver 
screen, top bar for iOS, we have
 the material design app for 
android, we have several 
different fonts and behavior for
 the bottom of the scroll, if 
you are at the end over scroll
             -- so far 
everything I have shown you is 
pretty standard, this is a 
regular chat app.  I was going 
to hit the image button.  She is
 going to take a sofly with afl 
you               selfie  
           self I with all of 
you                        
selfie with all of you in the 
background.  Say cheese.  Now, 
we can add our text for the meme
.
  And there you have it.  We can
 share it with your friends.
   (Applause)., over the course 
of this talk, would you believe 
that this entire app is written 
with under 400 lines of code, 
with multiple views, sign-in 
integration, everything, we will
 be live coding this very app 
and you can see how easy it is 
to get from nothing to a 
beautiful photo app just like 
you see here.
   Let's jump back to the slides
.  So, whether you are a start 
up with a hair brained idea or 
you just are a develop        
developer that want to be 
efficient with your time, 
Flutter an easy way to 
beautifully develop mobile apps,
 our start up founders did 
research and they found that the
 target demographic for their 
meme chat app were iOS users.  
So, they heard about this cool 
photo technology, they are like,
 yeah, let's check it out.  They
 started coding, it seemed like 
a nice way to easily start 
developing apps and get their 
app up and running.  Good news, 
everyone, venture capitalists 
were interested in funding our 
start up.  The -- is our VC is 
aside tr being a cat, an android
 user.  We want our -- to be 
able to dog foot our app as soon
 as possible.  But this means 
that our workload has just 
doubled.  Now we have to write 
an iOS app and an android app, 
weesh just a small start up.  We
 want to spend time on adding 
cool features, not writing our 
app twice, but because we are 
already writing in Flutter, this
 is an easily sol     solve able
 problem and not double ing our 
workload.
   EMILY SHACK:  Sorks     So, 
Flutter a lowtion you to write 
your app                       
          allows you to write 
your app once.  It's fast and 
easy, letting you spend less 
time developing more cool 
features for your app.  Flutter 
also has an incredible -- which 
lets you update your code on the
 fly without having to start 
your entire app.  This means you
 can get up and running 
extremely quickly and literally 
let you see your app come to 
life piece by piece, and of 
course we integrate with 
Firebase.  Now, we both know we 
are on the Firebase stage, you 
probably have already heard 
about Firebase here, but for 
anyone ho hasn't       hasn't, 
Firebase          Firebase lets 
you develop high quality apps.  
You can painlessly integrate 
that uses realtime sync, you can
 get usage analytics and easily 
scale up as needed.  We are 
going to get into the specific 
how we do this a little bit 
later on in the talk.  But for 
now eats take a look at how easy
 it is to get started alt your 
very fist Flutter app.
   EMILY FORTUNA:  You just get 
to the repository and you add 
Flutter.  There's a really cool 
tool, it will check your system 
to see if there are any 
remaining dependency ies that 
you need to install on Flutter 
Doctor.  You want to make sure 
you have job installed.  You 
don't have to have bof these 
installed, but you probably want
 to have one because you are 
developing a mobile app in some 
capacity.  Let's jump over to 
the Code.  The code screen.  
Plus our app.  Yes.  There we go
.
   So, we have this up and 
running.  And this is where we 
are going to be doing our 
development.  This has really 
nice plug ins     ins, and you 
can run your devices from this. 
 If you are doing cross platform
 development, we need to have X 
code up and running and android 
and 1250UD        studio and 
make your changes in this and 
run either device or both from 
this.  So, we took up the 
liberty of writing out the 
skeleton of our app because no 
one wants to watch us type 
definitions, that's boring.  I 
will give you a tour of how this
 is set up.  P fist we have our 
main function, the top level 
widget for our app.  My app then
 has a chat screen which is 
going to be controlling the view
 and what's displayed, your chat
 history, all those things, chat
 screen has a state, that's the 
real meat and potatoes, where 
all the interesting stuff is 
going to be happening.  Chat 
user and chat message are two 
glorified          glorified -- 
they basically are holding the 
information that we want to 
store for the chat message.  So 
the text you are sending, in the
 case of who is sending it, what
 their profile picture looks 
like, all those things, those 
are in there.  Chat message 
lifts content, the last two 
widgets that are controlling how
 they are displaying on    on 
your screen.  That message 
content that you want to screen,
 how it should display on the 
screen and how big and the chat 
message list item hold the 
content and manies controls how 
to display your profile fict and
          picture and your name 
and all that laid out on the 
screen.  You see the name 
widgets in a couple places, your
 entire app is going to be made 
out of widgets, it's one huge 
widgets which have sub widgets 
all the way down.  If you are 
familiar with react, these are 
just like component, if you are 
not familiar with reacts, don't 
worry, it's a functional react 
tive framework.  The key idea is
 you are using your model data 
to describe templates for how 
your view should look in all 
different situations.  The 
framework it    itself controls 
how to change between these 
different views.  It's a 
slightly different paradigm for 
how you think about programming,
 UI's, and rather than your more
 typical set up, we have the 
controller running back and 
forth and syncing these two 
things, you have your model data
 describing how your view should
 look.  This means that in 
practice, it gives you a lot of 
really nice things like hot re
load, which we will demonstrate.
  Under the covers       covers,
 while the developer doesn't 
have to worry about this, this 
means that the widgets that are 
created are ephemeral.  While 
you don't have to be worried 
about -- it helps save the 
developer from avoiding a lot of
 common bugs,
 like if you have persistent 
long UI objects, they can get in
 inconsistent states and it's 
hard to de-bug.  This way it 
makes programming dynamic U  UI
's much easier, your code ends 
up being mod dollar            
modular, and usable, and hot re
load, you can swap out that ij 
widget           widget nor     
for the new piece, Emily is 
patiently waiting for meef. 
      me.  Let's dive into the 
code.  We are going to open up 
my app.  Inside you see
 a material app, a widget 
itself.  It has a container 
which is also a winl it.  Right
                 widget.  Right 
now we have our app, it's not 
exciting, it's black.  To 
demonstrate hot re   reload, 
Emily is going to update that 
black to white, we will hit the 
hot reload button up at the top,
 and you will see very quickly, 
didn't have to do a full rebuild
, and update ed the app.
   Okay.  But we can use hot re
load to do much more interesting
 things than chain the colors of
 your widgets.  Let's change 
container to VR chat screen.  
And we will update again.  Once 
it's update ed, you will see we 
have a menu bar at the top, so 
we know what chat screen or app 
we are running and we have got a
 little space in the middle to 
have our chat history.
   So let's dive into actually 
being able to send messages.  We
 are going to do that inside 
chat screen state.  And there's 
the build text compose esh  
          composer.  Inside that
 we will add a text field that 
will accept text input.  As you 
can see, em pli is putting this 
inside of a flexible.  Flexible 
is another widget that in this 
case can control the layout.  
It's saying hey, take this text 
field and I want it to expand to
 take all of the horizontal 
space available to, in the 
layout.
   Text field is taking a couple
 of name parameters, you see on 
submitted and -- changed.  These
 are going to be call backs when
 the calls are submitted and 
changed.  We have been looking 
at this code     code, it looks 
kind of C sciel      scielesque,
 but we have name brand function
s, wondering what are we program
ming in?  The answer is dart.  A
 modern device, it has a lot of 
cool features that allow you to 
develop your code quickly 
without sack fiez           
sacrificing qalt and safety  
               quality and 
safety.  We have a mode to be 
sure that your app is doing what
 you want, and it has a lot of 
cool features, much more 
interesting than parameters, one
 we will be exploring later in 
the talk.
   Now, when Emily hits hot re  
 reload, we should see the text 
screen come down at the bottom
       bottom.  And she should 
be able to send a message.  
Nothing happens!  That's because
 we haven't actually implemented
 our handle submitted function. 
 So, let's go down that function
, which is currently nothing and
 we will update that.
   So first we will clear our 
text message so that we can add 
more messages in the future.  
And then we are just going to 
call add message, which adds our
 text to the list of messages 
that we will be displaying in 
our history.
   Now when we hit hot reload, 
which I will note, so, we are 
doing more interesting things, 
actually changing some 
functionality in this case.  We 
hit send.  It's gone forever!  
No, actually not.  We just 
haven't update ed our view yet. 
 So we have stored the message 
but we haven't told the view to 
update.  So if you are like me 
and     and you like to use your
 chat app for writing novels, 
it's kind of disappointing 
because you can't see anything 
right now.
   But let's go update the view 
to tell it to redraw that piece.
   So, in here, we are saying 
when that message is added, we 
are telling you, hey, my state 
has change, you should go, when 
we draw this widget.  We are 
doing that by call set stat and 
we add that message to our list 
of message.  Now when we hit hot
 reload, we should be able to 
see the messages, and you can 
use your chat app as a novel 
writing app as well.  All right!
  We are good.
   (Applause).
   EMILY FORTUNA:  So, users, 
man, we did -- our start up did 
some testing because they were 
really excited but not impressed
 with this app.  They said they 
complained it look the same on 
any platform and they weren't 
thrilled about talking to 
themselves.  Let's make a couple
 changes to make it look 
prettier.  We are go up at the
           up at the top and add
, this is going to look more 
specific to the plom that 
          platform that we are 
running on.  In this case, we 
are saying what platform are you
 running on?  Now when we hit 
hot reload, you can see the 
message bar colors updating, 
with silver for iOS, our nice 
material style for android.  And
 then we have our    our -- this
, the scrolling behavior that 
you would expect and so on.
   There you go.  And so why do 
I keep harping on natural look 
and feel?  Well, unlike       
unlike -- so, the interesting 
thing about Flutter is Flutter 
is drawing every single pixel of
 the screen.  So there are no 
crazy native widgets that you 
are going to interfere with the 
app or interact in weird ways, 
no    .  Flutter has taken a lot
 of time in making the view feel
 appropriate to the user.  If 
you are trying to de-bug, you 
can step through your code and 
also customize things if needed 
if the look is not quite what 
you want.
   So, we are still talking -- 
oh, we need to add some 
animation to make this look alts
 pret      prettier.  We will 
add our animation controller. , 
and we are going to pass in a 
duration, which basically tells 
how long we are going to add 
animation, in this case, a 
little bit longer so you can see
 it on the video screen.
   So, one more thing to do, 
when these messages are being 
built, we are going to call the 
-- create the animation that 
will then build this into view.
   So, we do that.  I create ed 
this ease out animation.  And we
 will's it out of the           
    ease it out at the bottom 
into view, its child is going to
 be the original chat message 
item object.  There's a lot of 
nice animation spowrpt, they 
have got lots of things to make 
it feel natural        natural, 
and it's very customize able.
   Once we hit hot reload, we 
should be able to send a message
.  And it will animate in.
  No!  What's happening?  So, we
 have a bug in our
 code.  We will, if you can look
 at our Console, there we go.  
There is our -- so, chat message
 has in instance -- animation 
controller.  In this case, it's 
supposed to be a capital C, and 
I want to also point out, it's 
cruel that            cool that 
the rest of your app is showing,
 it's just the part when we hit 
that animation, it showed you 
the red screen of death.  We 
update ed the C.  We can reload.
  Now we should see the messages
 beautifully glide into view.
   Look at it go!
   (Applause).
   EMILY FORTUNA:  Almost      
All right.  So, this is good, 
but we are still talking to 
ourselves.  So, I'm going to hop
 over to the computer screen, 
and     and let Emily talk us 
into how to add plug ins and let
 you do the cool meme features 
that you know you all are going 
to die learning about how to do.
   EMILY SHACK:  So, we have our
 basic chat app, but we really 
want to extend the functionality
 like communication with 
multiple people, add things that
 make it look a little bit more 
official.  Maybe Google sign-in.
  In order to do that, we are 
going to use in plug in   ins.  
Flutter makes it easy to add 
them into our app.  We are going
 to take a look at our file.  
Thes        This is a file 
that's inside your Flutter 
project and that's where all of 
your dep sis         dependency 
ies are declared.  We have 
Flutter there, we will also 
going to use five different plug
 ins, imagine picker, Google 
sign-in, and three others.  Each
 of these do bts different for 
our app.  We are going to get 
into what those functionalities 
are.  Sphies it to say,        
             Suffice it to say, 
this is the file you have to 
claim your dependency ies so you
 can reference it in the body of
 your app just like any other 
Flutter code.  Let's go back to 
our main function.  The first 
thing we are going to add is 
soolg sign-in               
Google sign-in, which allows us 
to go into authorization, we 
have added Google sign-in, it's 
making sure we go through that 
work flow.  Once that is 
complete, we are going to incore
 prailt the Google user name 
from the sign in information in 
our message.
   Then once we add our message 
with that information, we have 
one more step, which is that we 
have to have a way to display 
that profile photo.  Right now 
in our chat message list content
 class, we are using the circle 
Avatar widget in order to 
display our profile photo.  We 
are going to switch that out and
 use the Google user circle 
Avatar widget, and that's going 
to make it easy to incorporate 
that imagine from our Google 
profile.  Once we hit hot re   
reload, we are going to go 
through that work flow and as a 
disclaimer, we are already 
logged in on both of these 
devices, you did see it at the 
beginning of the talk.  And you 
can see that we don't have to 
sign in more than once.  Once we
 are signed in, now we are 
seeing our name and profile 
picture and we can really tell 
who is sending that message.
   Unfortunately this 
information isn't super helpful 
yet.  Because we are still only 
talking to ourselves.  Let's add
 some more people to the 
conversation with Firebase I 
object da.  To use the Firebase 
daib plug in, we are           
                    database, we
 have to make sure that we are 
reading in the messages from the
 database.  This is going to 
make it so we can store our 
messages on a remote database 
rather than locally on the 
device.  So anyone who is 
authenticated to that device can
 read in the and write in the 
messages.  Here you can see we 
are referencing Firebase off, 
that's where the off plug in 
comes to play.  That's making 
sure we are authenticated to our
 database so not just anybody 
can see those messages         
messages.
   Once we are signed in, now we
 are going to add a listener
         listener.  What that's 
going       doing, while our app
 is running, it's checking the 
database to make sure
 all of the messages are also 
reflected in our app.  Whenee 
see new messages pop up   up, we
 are going to then add them to 
our message list.  Now you can 
see we have restarted our app, 
and we are, we have seen the 
whole database populate ing in 
our app.  That restart, by the 
way, was a hot restart rather 
than a full app restart which is
 sort of similar to hot reload, 
but just making sure that we are
 pulling in all of those 
messages from the Firebase 
database as though we were just 
starting up our app.  One more 
step, to push it to the database
.  We are doing that in a 
reference, push call, that's how
 we are referencing our Firebase
 data.  Now if we hot reload, 
then we should be able to send 
messages back and forth.
   As you can see, almost in   
instan yowsly,                
in    intn taint yows           
      in    instant yowsly 
appear in both places.
   (Applause).
   &amp;gt;&amp;gt; We felt pretty good about 
it, too.  We can send messages, 
we can talk to each other, we 
are feeling great at this point,
 getting close to our goal.  
Unfortunately we still haven't 
quite reached the stat      
status quo because we are still 
only sending text.  We would 
like to be able to send images, 
to do that we are going to use 
the image picker and storage 
plug ins.  The first thing we 
are going to do is add a button 
to make sure we are referencing 
those plug ins when we want to 
add a photo.  That button is 
going to be an icon button 
afternoon when it user        
                and it's going 
to kick off that work flow.  
When we go into the work flow, 
that's going to incorporate -- 
either from the device camera 
itself by taking an image or 
from the photo gallery, that's 
going to be sent to storage when
 we download an URL to display 
the image in our app.
   Let's go ahead and write that
 handle photo button press 
function.  Right now that photo 
button we are seeing isn't 
actually doing anything.
   That funk is asynchronous, we
 said we were going to get back 
to it later in this talk, now is
 the time.  Asynchronous are 
very cool and dark, and they are
 always going to rurch a future,
 which is basically the same 
thing as a promise.  The idea is
 that this function is going to 
return immediately            
immediately.  But sometime in 
the future,
 its actual return value is 
going to get there.  So, these 
funk      functions be use the 
away, that's a way              
      await.  So we have a 
single line of code, we are not 
passing in any call backs, we 
don't have a nested code, and we
 are able to get the results of 
that future before moving on to 
the next line of our code.  So 
this function is really, really 
easy to read.  We don't have a 
bunch of domestic code when we 
are not sure we are getting back
 that future value.
   Now we have called our image 
picker and storage plug in code 
and now let's see what happens 
when we try and send our image.
   This time we are going to 
select an millennial rather than
 taking one from the device 
camera.  Pretty good.
   (Applause).
   EMILY SHACK:  So, we have a 
chat app that can send Texan can
 send images and we get really 
excited about this.  So we go to
 our -- unfortunately our VC 
goes not very impressed         
 impressed.
   They say you haven't animated
 at all in the chat space.  This
 is exactly what we have seen 
before in other chat apps, how 
can we make this better?  Our VC
 threatens to pull funding up 
less we can come up with 
something in the next hour with 
a special innovation.  This is 
where our meme if I indication 
is going                     
          meme-ification.  It's 
going to be a few lines of code.
  We are going to add something 
else to our handle photo been 
prissed function, which is a 
call to the navigator.  The 
navigator is a handy widget in 
Florida cha handle -- we don't 
want to have to write ourselves 
that back button or closed 
button of a dialogue so we are 
going to let the navigator 
handle that.  We are going to 
push a new screen on to the, a 
new Page on the screen, it's 
going to be a full screen 
dialogue, it's going to be 
called the -- which is another w
idget, we have written it before
, about 90 lines of code, you 
will be able to check it out on 
GitHub       GitHub, but it's 
another widget that is going to 
left us text over images.  We 
are getting back from it our 
text overlay that we are going 
to write on top of our means   
    meme, and then incorporate 
that into our meanl so when we 
see our images, it has the text 
over.  So, let's take a look at 
meme chat.
  I think the hat of coding 
maybe getting a little bit in 
the way.
   EMILY FORTUNA:  Sorry.
   EMILY SHACK:  And now once we
 send that meme, it's going to 
appear on both devices, there it
 goes.  And we have meme-IFIED 
our life.
   And finally, just to make 
sure we didn't cheat nay where 
     where,            anywhere,
 we still can take pictures with
 our device camera.  Let's go 
ahead and see if we can do that.
  We are going to take one more 
audience selfie just to prove we
 are legit.  Everyone smile.  
All right.
   Now we have sent that meme.
   (Applause).
  So let's take this back to our
 VC.  We are feeling really, 
really good about it this time. 
 I don't know about you, but I 
think our VC is going to like it
.  Let's go back to the slides 
to see how our VC reacts.
   (Applause).  We have a great 
success on our hands.  We get to
 take the month off, we get 
millions more dollars of funding
, to develop the latest, 
greatest chat app, we are 
feeling great and we used 
Flutter to get there.  How did 
we do that?
   Using Flutter, we were able 
to get a natural look and feel 
for both iOS and android just by
 using one codebase.  That gave 
us more time to develop our 
extra cool meme feature.  We 
also used hot reload the entire 
time.  If you notice, we did not
 fully restart our app once 
during this talk.  That's pretty
 cool.
   Also meme chat was pretty 
simple to write.  It took less 
than 400 lines, that includes 
everything we didn't get do show
 you and everything we did get 
to show you.  So we got a fully 
functioning chat app.  And I 
haven't seen that done in under 
400 lines before.  We also 
integrated Firebase and a few 
other great plug ins to let our 
app talk to the world.
   Now, Flutter is in alpha.  
And there are real shift apps in
 the wild.  Shown here are two 
great examples both internally 
and external to Google on 
android and iOS.  If you would 
like to learn more about Flutter
, you can visit our website at 
Flutter.IO, that will get you 
everything you need to know 
about Flutter documentation, 
getting up and running.  We also
 have two Codelabs here on 
campus at Google I/O.  We 
encourage to you participate in 
those.  Those are going to 
create meme chat without the 
memes, from start to finish, 
everything we didn't get to show
 you.  Those will be available 
after on Google's website as 
well.  Finally, there was 
another talk on Flutter here on 
I/O.  URL       Unfortunately it
 happened a couple hours ago, if
 you missed that, it will be on 
YouTube in a couple days, that's
 about Flutter from the 
perspective of a designer 
developer work flow.
   Now, if you want to delve 
into our code a little bit more 
than we were able to show you 
today, you can visit at the 
following link and don't worry, 
this link will be on the next 
slide.  Thank you so much.
   (Applause).
   EMILY SHACK:  We hope that 
you enjoy Flutter as much as we 
do and that you find a great use
 for it in your every day work. 
 We will be in the Firebase 
sandbox following our talk.  So 
if any of you have questions for
 us or want to chat about 
anything Flutter related, we 
would love to meet you there and
 talk about how Flutter can work
 for you.  So, please, please 
come talk to us   us, we would 
love to meet you,     you,.
   EMILY FORTUNA:  Thank you so 
much.
   EMILY SHACK:  Thank you.




   .
   .
   .
   .
   .
   .
   .
   .
     .
   .
   .
   .
   .
   .
   .
.
   .

 .
   5/19/17.
   .
   .
   ..
   .
   .
     .
   .
   .
   .
   .
   .
   .
   .
   .
     .
   5/19/17.
   Secure and seamless sign-in
        sign-in.
   Keeping users engaged.
   Stage 7.
30 a.m.  PT.

Log
                  p

speakers:   

   Speakers:  Dominic Battre, 
Eiji Kitamura, and Kim Paul 
Hamus.
   DOMINIC BATTRE:  ,.
   EIJI KITAMURA:  
,.
   KIM PAUL HAMUS:  ,           





  Cred, cresdz.


   DOMINIC BATTRE:  Hello, 
everyone, I'm a software 
engineer on the Chrome Web 
identify I team.  You probably 
all want to provide a great 
experience on your website.  
Especially when it comes to 
personallization, sign up and 
sign-in flows are key to success
.  Today, Eiji      Kim and I  
         Eiji and I will be 
talking about providing security
 for your use ergs.  Let's get 
started.  During the session, we
 want to talk on three important
 areas:  Sign-in, sign up, and 
security         security.  
Where in the latter we will 
focus on two letter 
authentication.  Let's get 
started with sign-in.
   So, this is my inner state of
 mind.  Not right now, but when 
I was thinking about the sign-in
 experiences on the Web    Web. 
 Too often I'm really 
disappointed.  The situation 
where you have got a new phone 
or a new computer and what was 
that password again?  Do I have 
to find them again everywhere?  
And this is not just limited to 
new devices.  When I create an 
account on my desk top computer,
 I want to be signed in 
automatically on my phone as 
well.  Do you know the situation
s where it feels like every time
 you go to that newspaper 
website it asks you to sign in 
again?  Even though you are 
using a password manager, I do I
 have to press that button.  Can
 we make that experience a bit 
better?
   Soy   So, for sign-in flows, 
there are three goals that we 
want to share with you today.  
First, form based sign-in should
 work well for password managers
.  Some websites have 
implementations of sign-in and 
sign up flows which do do not 
allow       allow the -- to 
remember and fill form very well
.  For you as a site owners, 
that's a missed opportunity.  It
 can increase user engagement 
and conversions.  Users enjoy 
the convenience.  It's just one 
thing less to care about.
   No dealing with core fought  
           forgotten passwords 
and typing on these little 
characters.  One special 
character that is impossible to 
find on a small key poured
            keyboard.  We will 
discuss what you can do to help 
password -- (?).  But you know 
what would be even better than 
the password manager filling 
your user name and password into
 the form?  The if the sign-in 
would happen without any action 
on my site.  Goal two is a 
returning user should be able to
 sign in automatically, no 
typing, no buttons, we will talk
 about how the credential 
manager API can help with you 
this goal.
   So, you know what?  Let's get
 rid of sign-in forms, at least 
in most situations.  This is a 
huge opportunity, less clutter, 
less typing, nothing to 
remember, and it works on -- 
pages, when somebody searches 
on-line and they land somewhere 
on your website, not at your 
home Page where you ever the 
sign-in flow, but somewhere on 
your site.
   Let the browse er take care 
of signing you in.
   And that should work, not 
only with passwords but also 
with federated log ins     in   
     logins,         logins 
federated login should be 
support bypass word managers.  
It makes it much more secure.  
This is where Google, FaceBook
         FaceBook, and others 
voach for your identity.  The 
user needs a single account and 
it can be properly secured, with
 all the bells and whistles that
 A, only big providers implement
, and B, only few users care to 
configure for every website they
 have an account with.  So   So,
 I want my password to handle 
federated logins just like in 
the passwords.  And the 
credential a lowses you    
          louse you to store 
information just like it allows 
you to save passwords, the 
information is sent across 
devices anion the life cycle of 
cookies.
   So, let's talk about sign up.
  Even though typical users and 
maybe I should say also Google I
O attendants should be aware of 
the bers practices for passwords
, they reuse passwords across 
different websites and they do 
not allow authentication on 
every website where it's 
possible.  The password, 12345 
has been the most frequently 
used password for the past few 
years, we were secretly hoping 
that maybe 7 would make it this 
year, but no.
   And actually the word 
password
 is also among the top ten.  So,
 this is so sad.
   According to research, 71 
percent of the accounts are 
guarded bypass words used across
 multiple sites, you know what?
 .  That.  A second fact 
authentication,  could improve 
the situation so much, that is 
by far -- less -- as we would 
like it to be.  Maybe that's 
just the usability of 
authentication, where you get a 
text message and you have to 
type it.  It's cumbersome.  We 
will talk more about that later 
in detail.  But we can do better
 in how it becomes simpler for 
users and even more secure.
   So, we postulate.  Sign up 
should be as simple as one tap 
of a button.  Let's get rid of 
sign up forms as well.  Pick    
 Picking a good password and 
memorizing it shouldn't be your 
burden.  The password manager 
should know your identities and 
you tap on one of them and the 
website gets the maim,       
name, e-mail address and the 
password.  In the long term we 
can be more ambitious, we can 
create passwordless accounts.  
We will talk more about that 
later.
   So, finally there is security
.  It's a huge problem and we 
want to fix that.  Many real 
opportunities I had with this 
technology.  How many modern 
phones contain fingerprint 
scanners, wouldn't it be cool to
 use that for bio met tic 
authentication
, securing information on the 
Web?  We want to share with you 
details on what we are working 
with with the working group of 
(?).  Our end goal is that oity 
become a first class citizen of 
the Web.  We want one API, the 
credential management API to 
manage your identity for 
passwords, identity providers, 
second factors, bio metric re   
reauthentication, for sign-in 
and for sign up.  The browse er 
should take care of identity 
management and simplify the 
process to pressing a button.  
Here we want to show how you can
 help us help your users.
   What you see on this slide is
 the outline of our presentation
.  At the same time this is 
where we try to get you 
motivated to help.  There are 
two things where you can help us
 today.  We will talk how you 
can help the password manager 
doing a great job for our users 
for form based
 sign in, and this alone should 
get you more signed in users.  
Then we will talk about, then 
building on this, we will talk 
about how using the credential 
management API allows to you 
automatically sign in users and 
how it provides better support 
for federated credential 
management.  Then we will give 
you an Outlook to two API     
APIs that are not ready to be 
used yet.  We want to share our 
vision for getting I had are of 
sign-in forms and making sign up
 simple and we want to talk 
about two factor authentication,
 no ways of doing this.      
               (new ways of 
doing this.) .  We recognize 
that passwords are not going to 
go away any time soon.  Please 
help us do a good job for your 
users.  You see two screen shots
 of the friendly management 
password Chrome, asking you 
whether you want to save it and 
fill it in later in the website.
  We have shared with you at the
 50th release of Chrome that 
Chrome fills 9 billion forms and
 passwords every month.  This is
 huge.  But it's not always 
working perfectly.
   So, here are the top three 
issues where the Chrome password
 manager struggles           
struggles with today.  First, 
broken markup and improper 
annotation           
annotations.  This determines 
what data to save for the user
     user.  And there are 
unnotice nl            
unnoticeable form smitionz, 
          submissions.  And then
 finally mixing
 hsm TT               mix HTTP 
and HTTPS.  So, let's go into 
each one of these issues.
   A way of keeping the password
 manager from doing its job 
properly is to -- maybe you have
 a search Box somewhere and the 
login in somewhere else.  
Similar problems occur if you 
combine the sign-in and sign up 
forms or the text field into the
 same form element.  Of course, 
please do not use MT or 
duplicate name and IT attributes
.  These are used to identify 
the fields in the forms.  
Figuring out the meaning of -- 
is really difficult.  Think 
about the sign up form.  It has 
a name, e-mail address, a phone 
number       number, but which 
one is expected to be used to 
identify the user later during 
sign-in?  Could be ig    
anything, right?  You can help 
the password manager by telling 
it explicitly what is the user 
name that you want to see later.
  And you can do that by setting
 the auto complete attribute to 
one of our form fields to user 
name.  And this provides us so 
much better user experience.
   And you can also please tell 
us the semantics of password 
fields.  In a field we are 
presenting the current password 
which it's supposed to fill in, 
or is it a new password where we
 can offer password generation?
   So, I   unnotice ed form 
submissions.  It's built on one 
principal,            
principle           principle, 
we and want to save the password
 when login succeeded.  To use 
that, if the login failed, then 
typically the management Page 
contains another login form so 
the user has a second chance to 
type their password and this 
time correctly.
   If there's no such login form
 on the Page, we assume that the
 login succeeded and then we can
 ask the user whether they want 
to sai that password  
                 save that 
password.
   If you are using or the fetch
 API to login the user, there is
 no navigation event.  When 
should we check that the form is
 gone?  Woe would love     
             We would love you 
forever if you could move the 
form, and second, history 
replace state to simulate a 
navigation, that simulated 
navigation triggers our -- check
 whether the login form is gone 
and then we can offer to save a 
password.
   Third.  Chrome loves HTTPS.  
Please use it sense pli      
     sensibly          sensibly,
 but a void pitfalls.  We see 
code like this, that's an 
insecure page.  The Page posts 
the form to an HTTPS end point. 
 People think, hey, this is 
secure, the password is sent 
over an encrypted connection.  
It's not secure.  The HTTPS Page
 is not secure, it's easy to 
inject JavaScript and that Java
Script can steal credentials or 
you can modify the target 
against your other credentials. 
 The problem we observe quite 
often, the user     userrer 
lands on an insecure H  HTTP and
 then they -- the home Page 
which has user name and password
 like you have here.  But the 
sign up Page is on a secured HTT
PS Page, now the user saves the 
password during the sign up flow
, but it would be totally 
irresponsible if we were to take
 that password and store it and 
fill it into the insecure HTTP 
Page, that creates a bad user 
experience.
   And then HTTPS, embed it into
 my Page.  That's not really 
different from a security 
perspective.  The I frame can be
 silently swapped for a spoof 
version and credentials can be 
easily stolen.  So, please, if 
you allow the user to sign in 
your intielt, move on to HTTPS 
but on all pages.  And we have 
provided some instructions and 
tips for you at the URL that you
 can see on the left on the 
screen.
   And you know what?  If you 
help us improve the reliability 
of password managers, people may
 start to getting
 used to the idea that they 
don't have to memorize and type 
their passwords anymore.  This 
is when people will hopefully 
start using unique and randomly 
generated passwords for website.
   We are in the stage of 
crossing the T egos and dot    
dotting         dot             
   T's and dotting the I's.  
Just to make sure that we are 
crossing -- covering all the 
Edge cases and that users are 
always able to access their 
passwords.  And there's another 
positive side effect of 
generated passwords.  A user who
 doesn't know their password is 
a user who is really hard to 
fish      phish, think about it.
  Less phishing         
phishing, less impact of leaked 
credential afn the users      
     and they spend less time 
signing in.  Wouldn't that be 
tool      cool?  You can take 
the guest work Outlook of -- 
federated login and create an 
even better experience with the,
 for the user when they are 
automatically signed into a 
website without pressing a 
button.  And all of that can 
happen with the credential 
management API.  To talk more 
about that, let me invite Eiji 
on stage.
   (Applause).
   EIJI KITAMURA:  Hello, my 
name is Eiji.  I'm a developer 
at Google working on the -- let 
me talk about how we can make 
the password manager work more 
effectively by improving your 
phones.  Now, let me talk about 
the credential management API 
that enables a seamless sign-in 
experience.  It has roughly 
three benefits:  First, with the
 credential management API, you 
can show a native account to the
 dialogue when a user is trying 
to sign in.  This way users can 
sign in by selecting an account 
with just one tap.
   Second.  Because the 
credential management API -- 
federated accounts such as 
Google or FaceBook, users can 
get a consistent experience for 
selecting an account across one 
that's password accounts and 
also once the -- federated 
accounts.
   So, the credential management
 API allows you to sign in 
automatically.  This is 
typically used for -- login 
session of your website are 
short so that users don't have 
to proactively press the sign-in
 bunch these are helpful if 
users have multiple devices.  
They will be signed this aut
omatically just by opening your 
website.
   We have introduced several 
websites that started using this
 API, Google last year.  They 
have implemented this feature, 
mostly for their desk topic 
version of -- but we are seeing 
more and more of this applied to
 progress Web apps.  For example
, an Indian top 10 website, 
notice        launched this last
 week.  Another example is wego
     wego.  A successful start 
up in sing      Singapore.  ALI 
express from China has
 lawrpd r launch                
 launched the integration, and 
they proved the engagement with 
this API, it's not just -- they 
have achieved 41 percent more --
 user by using the credential 
management API.  Additionally, 
they de-veesed the sign-in few 
    failures by 85 percent and t
he better converse rate by 11 
percent.  Now, let's take a 
closer look into how it work.  
Along with some updates of up 
coming changes to the API, to 
obtain a credittal,  -- by 
giving it password and -- you 
can search by the types of 
credentials you want to achieve.
  With this call, you will 
receive undefined, when there is
 no credit cials stored       
       credentials stored.  If 
there is only one, you can 
receive that immediately, you 
can use that for oughtty 
authentication.  If there are 
more than two credentials store 
and the account with dialogue 
will show up so the user can 
select the one that should be 
passed to your website.
   If you want to let a user to 
sign in automatically, you 
should avoid showing the account
 user.  You can simply add a 
negative true to the call to 
turn off -- in case the user has
 more than one credential stored
, you will receive undefined so 
that you can defer the process 
to the user's explicit sign in 
like tap on the sign in button.
   Starting from Chrome 60, you 
should replace -- with immediate
 yaix -- this is equivalent, but
 enabled some extra -- for the 
API.  For compatibility with 
older version of Chrome, I would
 recommend using -- for the time
 being.  When our user signs out
 of your website, the user 
probably don't want to get sent 
back in automatically at the 
next visit.  To avoid those 
situations, you can call the 
credentials -- made yaix, this 
way                     
mediation, their intention to 
sign in by selecting an account.
   Once you receive a credential
, you can use it to authenticate
 a user.  Because a 
credit        credential aspect 
-- you have to use fit function 
in order to sent that 
credential.  This interests a 
number of restrictions.  We have
 received effected that -- 
cannot use the API because they 
had to send the password as part
 of a -- object.  Or have to 
send the house value of the 
password to their server.  After
 performing a security analysis 
and recognize ing that 
considering it possible from 
JavaScript, did not really 
prevent all adapters effectively
 as we were hoping.  We had 
decide ed to make a change.  
Starting from Chrome 60, you 
will be able to access the -- 
password from JavaScript.  I'm 
really excited about this, 
because it drastically 
simplifies using this API.
   To  Further detect exposure 
of a password can you can check 
if an object returns undefined 
or not.  But frankly, if you are
 -- requires a password as   as 
-- or a house of the password, 
you probably should not call the
 API in order, in older versions
 than Chrome 60.  In that case, 
please check the user
 agent stream.
   You can, of course, start new
 credentials or update existing 
ones using the credential 
management API.  As Dominic 
mentioned, submitting a form 
would trigger or prompt to start
 a credential even without using
 a credential API    API.  By 
authenticate ing a use esh 
through -- and then storing the 
credential only when it succeeds
, you can keep the credential 
information always valid and
 -- you can construct a password
 object with a -- element of the
 sign in form.  Of course, the 
sign-in form needs to be 
properly annotated with complete
 attributes, then -- navigator 
credentials start.  This should 
happen in forms including sign 
in, sign up, and please don't 
forward or apply this to 
password change forms as well.  
That will keep users password 
always up to date.
   By the way, sign in to our 
website using an account like 
Google or book is what we call 
federated login, as Dom Mick 
nengsed                  Dominic
 mentioned.
  Google uses -- connect, 
FaceBook uses OS two and the 
other uses OS one.  When you 
store a federated account, you 
are not storing credential 
information such as an ID 
talking for already connect or 
max is talking for    for -- 
instead, you are storing strings
 that represents -- a provider 
and I  ID for that user.  And 
option,        option,ly, some 
other information as you can see
 on the slide.
   One important update to API
    API, credentials is about 
showing credentials across 
origins.  Access to credentials 
and     API has been restricted 
by the same policy.  In Chrome 
57, we will have introduced 
media that's sharing of 
credentials between sub domains.
  This is useful when websites 
-- the domain is different from 
-- for example, desk top and 
mobile.
   There are also cases where 
you want to let users sign in 
using the credential that is 
stored to, are totally     
         a delt totally 
different domain.
   To associate one origin to 
another, you may use something 
code -- (?) links.  Create 
adjacent file that looks like 
this, at both --
 this way you can declare these 
two or more doe nains can share 
credentials with each other.  
Okay.  So, that's the credential
 management API.  To learn more 
about it, please visit G.C
O cl credentials API.  So far we
 have been talking about how to 
improve the experience by 
looking at input from the users.
  API does a great job about 
letting users forget about their
 passwords.  Let's move on to 
the sign up API and see how we 
can create stronger credentials.
   John Wayne published a report
 that says 58 percent of U   US 
consumers that passwords have 
prohibited them from create ing 
a new report.  I want to share a
 password how they save their 
passwords fl we all the to bring
 that very sign up flow you are 
going to see to the Web, but 
first,ness how you would create 
an account with hot air tonight 
in their old flow.  Hotel to 
noit         tonight.  You have 
to enter an e-mail address, a 
password and your name.  This is
 a lot of typing for a mobile 
phone
.  Additionally you would have 
to verify the e-mail address by 
I can cling on our             
       clicking on our link in a
 con     confirmation e-mail.  
Here is what you see in the new 
flow is that -- tops and become,
 the a little bit is shown 
immediately.  It lists accounts 
registered on the film or 
struggling for passwords.  This 
enabled account creas with a 
single tap.  When the user taps 
on one of the items, the e-mail 
address, and -- are shared with 
the website.  The cool part of 
this is that open ID   ID -- 
supports -- that are issued by 
the provider.
   So, if you click on that 
Gmail address, the website gets 
an ID talking with Google and 
does not even ask you for a 
password.
   Also, they have proof that 
you own that e-mail address, so 
there is no need to send an 
e-mail address as a verification
.
   This flow create ed 23 r 23 
higher converse rate and about 
two thirds of all accounts are 
created this qai.  The        
        this way.  The whole 
flow is regular from -- but 
there are two important 
differences:  First, the user 
sees what they
 share, their name, e-mail 
address, and maybe -- but no 
permission to access their 
address book or   or -- on their
 behalf.  Users are much less 
confident to click on the -- and
 rightfully           
rightfully, so I would say.  
Second:  Because everything is 
needed with the environment, 
secure environment, there is no 
clumsy direct flow that move the
 user away from your site or on 
the app.  Everything is very 
smooth.  You can learn more 
about this expense at G.shields.
   And I don't knowly, a team at
 Google is prototyping this as a
 JS library.  We will be looking
 on bring this feature natively 
to the browse er later this year
.  So, if you are interested to 
become an access partner, please
 go to this website so you can 
reach out us.
   So, we have shared a lot 
about managing ID password 
credentials and further log in  
 incredentials.  Now, let me 
invite Kim to talk about what we
 are working on to reduce the 
risk of credentials by bring 
security key factors and bring
ing -- to the Web.
   (Applause).
   KIM PAUL HAMUS:  Thanks, hi  
 hi, I'm Kim, I'm a software 
engineer on joolg's teams.  So  
 So, let's talk about second 
factor off.  Let me start by 
recapping the motivation 
authentication.  You already 
know that passwords           
have problems, they mentioned 
some of the down side, it takes 
the compromise of one website to
 compromise that account for ult
 many others                 
multiple oirs     oirs, even if 
you were super human and had 
unique 14 character passwords 
that you forgot or use the 
password manager to do it for 
you, this can still be hacked.  
And sometimes users simply give 
their password away by typing 
this      them in forms and 
typing them in this         in 
this manner is fishing.  One of 
our studies found that they will
 trick nearly half of targeted 
users.  Even the ladies yes Page
, containing only one input will
 strike about three percent of 
users.  If you have a large user
 base, that's still a lot of 
users.  So it's clear that 
protecting your account is only 
a passion word and puts your 
account at risker.  One solution
 is you are probably familiar 
with, it's good for one login, 
unfortunately these also have 
down sides.  SMS codes have -- 
you could go ahead an OTP gong 
will to               gng     
Dongle and they are a little 
froo      fra jiel.  Generally 
you have to coich the code off 
the website.  And security wise,
 they still aren't perfect.  
Users can be tricked into typing
 them into a fake form.
   So we really wanted to make 
it easier to be a security 
conscious user.  Our answer to  
  to these problems was a 
security key.  Security case can
 come into multiple factors, it 
can be a USB device, a -- 
possibly your phone.  But they 
interact directly with browse
 ers, no typing in of codes, one
 relationship where it can work 
on many websites.  Our stats 
show these faster and OPT, and 
best of all, they protect 
against password phishing.  You 
may already have heard of 
security keys, we are using them
 at Google and overall several 
other companies that use them as
 well.  Currently using a 
protocol standardize ed the el: 
 It stands for fast identify I 
did on-line          
              identity on-line. 
 Well, this is Web 
authentication, next generation 
protocol for the Web and 
standard identification with the
 CC.  It's not in Chrome yet, 
but we wanted to give you a 
heads up that it's coming and 
show you what it will look like.
  First take a look at Hugh 
security keys might be used.  
This is our fast and final 
Google login Page, you enter
       ender your name and 
password.  You will notice I 
need to use my security key.  I 
actually have a a small USB 
plugged in all the time.  So I 
just reached in and tapped it 
and I'm in.  This is the use of 
a portable key.  In any case, 
the top action provides a 
graphic that     that, that a 
real human being is logging in, 
and not a hack     hacker.  Here
 you can see it also works for 
mobile environments, for 
example, using a bluetooth 
device our mobile phone, you 
would just press that button.
   So, now that I showed you how
 it would actually look to a 
user, let's take a look, kind of
 at a high level.  Two steps:  
Fist is a one time registration 
operation, one time security and
 then account        account.  
This is to let you know that you
 are a security key user to use 
it on success        successful 
logins.  I would going into my 
account, I would set up OTP, 
similar.  I would say I want to 
registered my security -- this 
tells your security key to 
generate a public and private 
key pair for the can.  The 
public key isn't sent back to 
the server, it stores at that 
registration             
registration.  That's the first 
step.  The second step is simply
 getting         -- every time 
you want to sign in.  Here you 
can see that the browse er sends
 the secret password to the 
sefer server, that is vulnerable
 in all     all the wades I 
mentioned before.  The server 
notion I'm a              knows 
I'm a security key user.  It 
asks for and provides a 
challenge that real person is 
here.  Using -- it proves I am 
end died here.  This has several
 key parts, first is the 
physical touch or action, .  
Second is freshness, this makes 
the proof resistance against use
 and bind it to the specific 
session.  Third is the origin, 
you could also include -- that 
identifies the connection.  You 
take all of this together, the 
browse er packages it up and 
asks the security key to sign it
 with the private key stored for
 the registration and after the 
key is tapped, it does.  So, 
because the security key was 
previously registered, the serve
 err already knows my public key
 and is able to verify it in the
 data that they flame       
proclaim.  So now let's take a 
look at the actual API.  Like I 
said before, two phases       
phases.  The first is 
registration too tell the 
website that you have one of 
these keys.  The call to do this
 is navigator.credits, you 
specify a type.  At a minimum 
you provide the information 
about the client, the relying 
party and the ewe neck challenge
.  You send the information 
about the credential including 
the public key back to the 
server.
   Now, every success of time 
the user wants to log in, the 
party can request suggestion, so
 you use the -- you make the 
call to November gate that 
credential.get.  It's the same A
PI, you specify a credential 
instead of saying password or   
or -- this asks for that touch 
at the key to do the signing, 
and the resulting assertion is  
 is -- this proves that a real 
user is logging in.  These are 
two API campus        calls that
 are sim and unique.
  So you have seen the API, you 
have seen how it's going to be 
used.  Something else cool about
 -- it will support bio metrics 
for fast Erie generation, 
security shows it's a -- a 
typical used case would be 
banking, you are logged in to 
your banking app or you timed 
out and -- for some reason, you 
want to get back in.  You would 
hope the bank would verify that 
it was actually you.  So, using 
the exact same -- on API, if you
 have a bio metric capable 
device, they can request, and 
know who you are and con formula
 the lok.  You will be able to 
use your fingerprint to login on
.  You might have a   an app, 
and browse er will not, and 
that's what this will provide.  
I know that's a brief 
introduction, again, the APIs 
aren't available yet, but you 
don't have to wait to use 
security keys themselves, you 
can use them using an existing 
API, and -- has APIs, definitely
 get a security key, add it to 
your Google account, whatever 
accounts you can.  And here are 
some resources to get you 
started.
   But in the mean time, if you 
do want to learn more about Web 
FM, you can read the actual spec
, it's public, feel free to join
 the mailing list and watch for 
updates.  Back to Dominic to 
wrap up.
   (Applause).
   DOMINIC BATTRE:  All right.  
So, at the beginning of this 
presentation, we shared our goal
.  The goal to have one API to 
manage all of your identity 
needs.  For sign-in with a 
password, federated login, two 
hard      hardware token and    
and -- prints.  We hope by know 
the puzzle pieces connect to the
 big pirkt.  We hope that you 
will help us getting the 
password manager working for 
your websites so user stop 
relying on their one, two, three
 passwords that they type into 
every website and hopefully this
 allows us to get users to use 
generated passwords soon.
   So, already today you can 
start using the credential 
management API to keep your 
users signed in across devices 
and you don't need to see -- 
fill forms as often as they used
 to.  We have seen how the 
credential management API allows
 to you store and retrieve user 
names and passwords but also 
information about federated 
login.
   We shared with you our vision
, that we want to facilitate 
entire sign up flows with 
convenient browse er, and we 
have talked about our ongoing 
work on you a then cake.  This 
will facilitate two major use 
cases, securing accounts with 
unphishable second factors and 
convenient authentication using 
for example fingerprints.  Both 
using the API.  Everything we 
talked about today will be 
covered by API.  We hope that 
this gist you more sign-in users
 and moves them to more secure 
accounts.  We want to continue 
from here and we hope that we 
got you excited.  Please speak 
to us and let us know what you 
think.  We are G  G, right 
across the -- that's where the 
mobile Web and map sandbox is.  
So, thank you very much for 
attending the session.
   (Applause).
Test. This is a test. 
The next éè éè 
is 
Off 
The Roc
ks&quot;. 
This text is being provided in a
 realtime format. 
Communication Access Realtime 
Translation (CART) or captioning
 are provided in order to f
acilitate communication 
accessibility and may not be a 
totally verbatim record of the 
proceedings. 
This is a test of the captioning
 that will be 
provided for this session. 
 before where radio are on a a a
 a
COB: 
 Conventional
hanks for during Let's talk 
about  and Hello, how everybody,
 howyou  everybody doing today? 
make seaworthy  Not acceptable. 
 are you doing apps 
for the Come  there you 
go. 
We focus on Chrome and web  
while I'mand  still enjoying 
winter here which isHelp  good 
news. developers  Thanks for 
coming our and  things   about 
storytelling  age ofLighthouse 
that will make your  
conversationallife easier. from 
Michigan  so I point to I'm  
Orenon  I'mhand,  from a 
companygo blue. Michigan 
actually self-proclaims  from 
Pullstring. to have  Thank you
most of Lighthouses  Googleany 
state in  andthe country.  
recognitionWe  relatives, um, in
  let's get started with the 
talk. about Brendan.  go, um,
cool back  I work at 
Pullstring.com and this is a 
picture of the Pullstringit uses
 CSS transforms.  domain.  I'll 
do twoKENNY: You  slideson 58the
  ofelse.  to
&amp;gt;&amp;gt; ERIC BIDELMAN: 2010  thenot  
becausea lot of  everything else
 is afor  forstuff. is cool  
conversation. where  Authorclick
 the that don't click.  
immigration analytics 
collaboration,is  for text
moment. We hired Brendan  form 
for Androidbecause  and we saw 
his demo. home. 
&amp;gt;&amp;gt;  inKENNY: I  andhave  if you 
want
&amp;gt;&amp;gt;  to go toERIC BIDELMAN:  
diddy and have backboth  with 
youactually  you can with the 
Google home andSanta  Google for
 thetracker  nice year. It  For
is  kind today's talkfun.  going
 toA PWA that  startall  back 
this is Robertthe  McKeelatest  
who wrote aPolymer,  very fancy 
book calledweb components,  a 
service worker, story.  There's
are  quotesgames that  it. every
 day.  McKee hasThis  madeis  a
my  out offavorites  educating
where can  peoplegive  in the 
screen playand shave.  tradeHe 
is cool  to buildHe is a jolly 
guy.  and craft dialog
&amp;gt;&amp;gt; BRENDAN KENNY:  proudly ERIC 
speaking. That's brutal.  
motivateThat's a fun  of that 
talkone. We  in the ways ofonly 
 motifs challengeson our  andbut
 Open and  which ispeople  the 
pointlearn  of as from the apps 
we build.  talk.  Thehere to 
talk to you about Lighthouse. 
Lighthouse  -- is a for web that
 helps of your app not just PWA 
but web practices. It is also 
quality think is really You want
 to have the ability to take 
requests a community but your 
app fast always fast and the 
Progressive App requirements. 
don't want to guy. This was me 
in January where did push to an 
my latency from 2 to 4X because 
I doing way database It was a 
You see the went down. Wouldn't 
it nice to us prevent 
also heard about web apps before
 say want go this journey 
building a Progressive You've 
probably our developers on 
Google.com. is to think about if
 to build it. It's a manual 
process. your site, a worker all
 that entails. home screen, you 
on If you go right? is a lot you
 have to think about. Again, 
wouldn't nice if  Mr.was tool 
help with this stuff? Turns out 
tools nothing They've existed in
 thousands signs help us the 
road give us Lighthouses to 
ships at sea guide and stay away
 the coastline. said this great 
model. Let's take and build a 
tool does this for web 
developers. We reworlded 
definition web developers. 
Lighthouse is a beacon of light 
that guides web developers, it 
keeps you on the fast path and 
allows you to know your site is 
accessible and using best 
practices and your PWA and 
performing. 
Last year Paul Irish sitting in 
the front row here. 
&amp;gt;&amp;gt; BRENDAN KENNY: Looks so 
young. 
&amp;gt;&amp;gt; ERIC BIDELMAN: He introduced 
Lighthouse. We were a bunch of 
automated checks for progressive
 web apps and had a sweet, fancy
 logo done in MSPaint as every 
alpha project should have at the
 time. We've done a lot of work 
since then. Today we're talking 
about Lighthouse 2.0. A year 
later the Open Source project is
 still Open Source but we have a
 bunch of new stuff in 
Lighthouse. So we still have the
 Progressive Web App checks. 
Lighthouse will go through your 
site and we'll demo it and tell 
you what you need to do to be a 
Progressive Web App. We have a 
ton of other stuff. Best 
practices. Are you using the 
latest and greatest best 
practices on the web? As the web
 continues to evolve Lighthouse 
will adopt the practices and 
write audits for them. Is your 
site performing? It is great to 
have a Progressive Web App but 
if it isn't performing no one 
will use that experience. We 
have a ton of new stuff for 
performance. Lastly there is a 
whole section dedicated to 
accessibility. I often forget 
about accessibility when I build
 this. Lighthouse can basically 
guide you through this process 
and tell you what you're 
missing. 
We also have a fancily new logo 
which is animated and awesome 
new Twitter handle with four 
underscores. It's really 
important. 
&amp;gt;&amp;gt; BRENDAN KENNY: Don't forget 
that. The first day we created 
it, it had more followers than 
me. Not fair. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Everybody 
follow Brendan. Let's demo and 
show of Lighthouse. 
&amp;gt;&amp;gt; BRENDAN KENNY: Let's try it 
out. If we can switch. If you've
 been over to the Mo web tent. A
 simple app. You put in a URL in
 the test box and it tests your 
app. We've done a simulation. 
Marketing app for trarking 
scripts and business wanted some
 extra features here and as a 
result your page has gotten 
slow. Let's load the page. I 
want to use it. I start typing 
in the URL. It is still loading 
and just erased my progress. We 
want to benchmark this in 
Lighthouse. The most popular way
 so far has been through the 
Lighthouse extension, it's in 
the web store. Web go up here 
and a simple click to get 
Lighthouse started. It will 
actually clear things out, try 
and load this as a mobile device
 would throttling network to try
 to simulate that and it 
refreshes a few times so it can 
take a look. Does it work 
offline? Does it work with a 
clear -- how does the 
accessibility look? Here you can
 see the checklist that Eric 
went through before. At the top 
is the Progressive Web App 
checklist. How your site is done
 as a Progressive Web App and 
there are four things we need to
 do. Get a service worker is a 
big one. Maybe work on a 
security. But we have seven 
things that we're already doing.
 We're doing okay. We weren't 
even trying. 
&amp;gt;&amp;gt; 
the next is the performance sex.
 Here you can see a great 
breakdown of some key metrics 
that we'll talk about at the 
show so far and we'll talk more 
about in a little while and see 
them in context with the screen 
shots of the page load and down 
here accessibility. That's a 
great one that a lot of people 
feel like they have be experts 
before they even start on making
 their site properly accessible.
 Lighthouse is a great tool to 
help you get started and make 
sure you do this and that and 
you have a bunch of things 
you're doing great on so far, 
good job. Finally best 
practices. Don't use doc to doc 
right. Make your your anchors 
have the proper opener, external
 sites. Super easy. I don't know
 why anybody --
&amp;gt;&amp;gt; ERIC BIDELMAN: It's a 
one-button press. You get a lot 
of information. I'm a power 
user, right? Maybe I want to 
tweak some things and change 
some default settings in my 
house. What do you have for us? 
&amp;gt;&amp;gt; BRENDAN KENNY: Funny you ask.
 I have a terminal back here. 
Just for people like you. 
Lighthouse is also a tool that 
is as simple as MPM install 
Lighthouse and then do 
Lighthouse -- test the same demo
 server and then I'll add the 
pro move view to open up the 
report. There are a bunch of 
options where you can also do 
things like turn off network 
throttling. Emulate a different 
device. 
&amp;gt;&amp;gt; ERIC BIDELMAN: It's doing the
 same thing as what the 
extension was doing. 
&amp;gt;&amp;gt; BRENDAN KENNY: In the 
background here you can see 
Chrome is loaded and it's going 
trying to load the page. Running
 a bunch of audits and tests and
 then you have the exact same 
report. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Very cool. 
I can use it in note if I'm in 
that environment which we'll 
talk about. 
&amp;gt;&amp;gt; BRENDAN KENNY: Right. 
&amp;gt;&amp;gt; ERIC BIDELMAN: What if I 
don't really want to install 
anything? Is there a better way?
&amp;gt;&amp;gt; BRENDAN KENNY: Installing 
things is a lot of work. If 
you're a web developer and 
already have Chrome installed. 
You might have used this week. 
In Chrome canary now you already
 have Lighthouse in DevTools. 
Here is Lighthouse already 
installed for you. Run audit and
 boom, there you go. 
&amp;gt;&amp;gt; ERIC BIDELMAN: That logo 
follows you everywhere now. 
Awesome. Same Open Source 
project is running in all three 
environments and into the Chrome
 DevTools. 
&amp;gt;&amp;gt; BRENDAN KENNY: If it's a 
little intimidating. Contribute 
to Lighthouse and it gets put 
into DevTools. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Everybody can 
have code in DevTools now. Thank
 you, Brendan. Switch back
&amp;gt;&amp;gt; BRENDAN KENNY: Talk about 
performance metrics. Those look 
fancy. 
&amp;gt;&amp;gt; ERIC BIDELMAN: You saw some 
of the performance section in 
Lighthouse, something we deeply 
care about. Many of you care 
about it, too. Let's face it. 
Performance is actually really 
hard and hard to maintain 
performance. A developer comes 
in and changes something, you 
don't know if your app will have
 that level of performance it 
once had. So there are some 
metrics out there. You have 
heard of things like window 
unload. These are old school 
metrics. Are they good things we
 should be thinking about in 
2017, Brendan? 
&amp;gt;&amp;gt; BRENDAN KENNY: It really 
depends. So maybe window 
download is there when your page
 is ready but you have a service
 side render page and bring in 
JavaScript and it's going to be 
a few seconds after that your 
page is ready. Hard to say 
whether it really reflects when 
your site loads. 
&amp;gt;&amp;gt; ERIC BIDELMAN: You don't know
 if you should care about it or 
not. People tell me reduce the 
size of your JavaScript bundle. 
You want to load less things. Is
 it something good or bad to 
consider? 
&amp;gt;&amp;gt; 
&amp;gt;&amp;gt; BRENDAN KENNY: It's great 
advice. On the other hand 
sometimes it's a trade-off. 
Sometimes you want to go for a 
size increase for a much larger 
performance increase. Maybe you 
are bringing down service side 
render to assets or 
pre-computing something that 
would take a long time to do on 
the phone. Size increase isn't a
 bad thing. It is hard to make 
the choices. 
&amp;gt;&amp;gt; ERIC BIDELMAN: It is hard to 
know. One thing we're focused on
 in Lighthouse is using the 
elevation of these user 
performance -- user-centric 
metrics since as first paint, 
first meaningful paint and time 
tainter active. The user 
experience. Are your images and 
scripts loaded but what the user
 perceives during the page load.
 Let's walk through them 
in context. 
&amp;gt;&amp;gt; BRENDAN KENNY: Yeah, so sure,
 you press enter. Start 
navigating your page and first 
paint is really when the first 
pixel changes on the screen. T
hat could be, you know, 
background color, it could be 
something like this just like s
ome vague structure. Next up is 
first contentful paint. The f
irst content is drawn to screen.
 It might not be the most i
mportant content but something 
appeared and been painted to the
 screen. So next up is first 
meaningful paint. That's an 
attempt to measure what actually
 matters to the user. So maybe 
that's content of a story, maybe
 that's the major search box 
that is the primary element of 
the page. Something that 
captures hey, as a user I'm 
looking at this and saying this 
is what I came to the site for. 
Next up is visually ready and 
time to interactive. Just 
because something is painted on 
the screen doesn't mean its 
usable. Everything is ready to 
go on a site and you try to do 
anything and nothing happens 
because JavaScript is spinning 
in the background. 
&amp;gt;&amp;gt; ERIC BIDELMAN: You're typing 
the input and it Canucks it. 
&amp;gt;&amp;gt; BRENDAN KENNY: And you want 
to smash the screen. 
Everything is loaded but I'll 
look at the activity and when it
's able to respond to the input 
that's when time to interactive 
fires and you're finished. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Loaded and 
ready to go. Cool. 
&amp;gt;&amp;gt; BRENDAN KENNY: This puts the 
performance part of the 
Lighthouse report into a little 
more perspective. You can see 
all those metrics kind of put 
into context with the page load 
and you can see as the page l
oads, you know, really early on 
that page has the full layout of
 the page but time interactive d
oesn't fire for quite a while. 
&amp;gt;&amp;gt; ERIC BIDELMAN: It's a 
JavaScript bundle. We have 
targets for each of these where 
you think you should be hitting.
 That's important, too. 
&amp;gt;&amp;gt; BRENDAN KENNY: Yeah. 
&amp;gt;&amp;gt; ERIC BIDELMAN: What the 
metric is you should be 
targeting. Let's say I'm a d
eveloper and I want to integrate
 with Lighthouse. Maybe I'm a
lready tracking performance 
metrics and I want to zest in my
 performance metrics with the 
awesome metrics we just talked 
about that Lighthouse is giving 
you. 
&amp;gt;&amp;gt; BRENDAN KENNY: There was a 
great talk yesterday 
web performance and talked about
 how they're great metrics and 
useful to be user-centered. But 
you know your site better than 
anybody does. If you can go out 
and measure the exact moment 
your element is ready you should
 do it. 
&amp;gt;&amp;gt; ERIC BIDELMAN: We can do that
 by writing custom audit that 
plugs into Lighthouse. Before we
 do this, let's get this out of 
the way. The most boring part of
 the presentation which is a l
ittle terminology and 
architecture. Is that okay? 
ENNY: Yeah, you get to do it. 
&amp;gt;&amp;gt; ERIC BIDELMAN: I'll do the 
boring part. In order to u
nderstand how Lighthouse works 
you have to understand how t
hings are set up. The first is 
we're just a bunch of node code.
 The Lighthouse portion at the 
top. On top of that we interface
 with Chrome and the Chrome 
DevTools protocol. Anything the 
DevTools can do the API can do 
as well. It's super powerful and
 how we interface and write a 
custom audit. We have the 
Lighthouse runner that is the 
controller for Lighthouse. In 
this there are three different 
things. The 
first is gatherers. In some 
cases we inject JavaScript to 
evaluate something 
and that's what the gagtsers are
 doing. It's why we have a 
couple different gather passes 
and makes sure the service 
worker serves something off l
ine. A bunch of other stuff like
 that that we need separate runs
 for. Gathers interface with 
chrome called the driver and it 
talks to DevTools protocol. 
We're built on the stack of 
giants. Everything below us is 
--
&amp;gt;&amp;gt; BRENDAN KENNY: You can b
asically do do anything you want
 in Chrome through the DevTools 
protocol. Lighthouse can do 
anything you need it to do. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Lighthouse co
nnects to Chrome and opens and 
starts running the page and 
testing things. When gatherers a
re done they return artifacts 
and then that's to an audit. A p
ass or fail check and applies 
scoring. In the report you see 
scores and a check and an X if 
you did bad. Those are what 
audits are returning. Returning 
and evaluating these things. 
That hands off a big JSON blob 
of a
ll the data and we go into 
report generation. Report is 
basically categorizing these 
things. The progressive web 
section and accessibility 
section. Gathering, auditing and
 reporting. That gives you a 
Lighthouse report. With that 
we're all on the same page. We 
can write a custom audit. 
&amp;gt;&amp;gt; BRENDAN KENNY: This isn't 
something we emphasize a lot but
 since the beginning we've 
written Lighthouse to be super 
-- Lighthouse is like a really 
nice test runner with a bunch of
 functions already built for the
 tests to make difficult things 
pretty easy. So as Eric was 
saying there are three steps. 
We'll do all three of these to 
write our own thing. This 
is that demo page. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Do you want to
 show the metric? 
&amp;gt;&amp;gt; BRENDAN KENNY: Yeah, let's 
switch over. The developer of 
this page is already thinking 
about performance and they feel 
guilty it takes six seconds for 
the search box to start working.
 They did the basics they could 
start with. They logged into how
 long it takes to do that and we
 can open you have DevTools and 
go to the console. You can see 
the logging and the console just
 so they can fill guilt every 
time the page loads. Five 
seconds, not very fashion and 
saving it to a global variable. 
We'll do the most simple thing 
and set it to global variable 
name, site metrics. Searchable 
time. The time it takes to get 
to a searchable state. It's 
about 5,000 milliseconds. We 
know that global variable is in 
the page and we want to use 
Lighthouse to retrieve that. 
Let's switch back over to the 
slides. And so step one we need 
to gather that global variable. 
So in Lighthouse every gatherer 
extends from a base class that 
sets things up for you and life 
cycle methods. During a page 
load when you want to run, 
gather or code. The first stage 
is called the before pass. It 
can set things up or set 
throttling up or something like 
that. In this case we want the 
global variable. Instead we go 
to after mass. After pass fires 
after the page is fully loaded 
and everything has settled down.
 Nothing seems to be loading 
anymore. Lighthouse calls after 
pass from us. In this case all 
we'll do is get the driver, 
which talks to the debugger 
protocol and then there is a 
bunch of helper methods to make 
a lot of things easy. One of 
them is evaluate ASYNC. It runs 
it and returns what the result 
is. 
&amp;gt;&amp;gt; ERIC BIDELMAN: It's the same 
variable we saw in console. 
&amp;gt;&amp;gt; BRENDAN KENNY: It's the 
string we ran in the DevTools 
console and just like in the 
console it will return that 
object with property searchable 
time. We'll return the results 
of that here and Lighthouse will
 take it and bundle it up as the
 artifact and use the same name 
as the gatherer. Now let's go on
 to the next stage and actually 
audit our results. 
Just like gatherers. Every audit
 extends from the audit base 
class. They have the metal 
object that tells Lighthouse who
 to you categorize it. What 
description to use to tell your 
users how to fix this or 
something like that. But the 
most important thing is this 
required artifacts there. That 
tells Lighthouse I'll neat the 
artifact from the gatherer 
stage. Every audit has an audit 
method called with artifacts. In
 there is our site gatherer 
artifact and searchable time. 
Then we'll get the searchable 
time and the audit at the bottom
 is it less than four seconds? 
If it's below four seconds we 
pass. If it's above four seconds
 we fail and we get a red X in 
the Lighthouse report and that's
 an audit. 
&amp;gt;&amp;gt; ERIC BIDELMAN: You show us 
four seconds because why not? 
&amp;gt;&amp;gt; BRENDAN KENNY: A reasonable 
thing. Come on. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Should have an
 input before four seconds. 
&amp;gt;&amp;gt; BRENDAN KENNY: The last thing
 we need to do is make 
configuration file for 
Lighthouse. To tell it how to 
find the gatherer, the audit and
 how to run them. Something like
 this you can extend from the 
Lighthouse run and that tells it
 run all the normal passes, 
audits and gatherers you 
normally do some my audit can be
 in the same context, same 
report as all the rest. So as 
Eric was saying we have the 
number of times we reload the 
paths. Let's put it into the 
first pass of Lighthouse. Load 
audit to the list of audits lite
 house runs in the default 
configuration and let's make a 
category in the report for our 
site called my site metrics. 
That's the best name we can come
 up with for our presentation 
and we're going to say hey, give
 it -- have this audit in there 
and if there were more audits 
they would be averaged together 
and add a nice weight average. 
So we have a pre-recorded video.
 So we just for this thing you 
can do the start. See what it's 
running. It is Lighthouse. 
Passes the config path and URL. 
It is running,
&amp;gt;&amp;gt; ERIC BIDELMAN: This is 
running Lighthouse with all the 
stuff by default. 
&amp;gt;&amp;gt; BRENDAN KENNY: If you cog 
down to the bottom you can see 
my site metrics, amazing. You 
can see that six seconds for 
this run and it failed. We got a
 zero on my site metrics and now
 you can say oh, well, we need 
to do better. 
&amp;gt;&amp;gt; ERIC BIDELMAN: This is great.
&amp;gt;&amp;gt; BRENDAN KENNY: We can run any
 audit we want. We can write and
 have it available for our site 
and so we can know when we're 
doing terrible. But if only 
there was a way -- oh wait, 
yeah, there is a nice slide 
here. If only there was a way we
 could automate it so I don't 
have to run Lighthouse every 
time, I could just have a 
machine check it for me. That 
would be the ideal. 
&amp;gt;&amp;gt; ERIC BIDELMAN: We can do 
that. 
&amp;gt;&amp;gt; BRENDAN KENNY: We can do that
&amp;gt;&amp;gt; ERIC BIDELMAN: That's not a 
problem. So you can use 
Lighthouse programmatically. 
People forget about this. They 
come and say can you add this 
feature to Lighthouse or this 
audit? We're just node. You can 
write a program that uses 
Lighthouse any way you want. 
Lighthouse is just one required 
statement away. Kaoefp that in 
mind. So a cool example of this 
we'll just write a couple of 
lines of code and show you how 
to use Lighthouse from node for 
JavaScript. You require 
Lighthouse. We have the Chrome 
launcher that is part of 
Lighthouse's code base. It 
launches Chrome with a debugger 
port open. It finds Chrome on 
your machine, selects canary or 
stable. 
&amp;gt;&amp;gt; BRENDAN KENNY: Turns out some
 background processes so it 
traces cleaner and not trying to
 download dictionary items or 
something. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Turns off some
 Chrome features when you use 
Lighthouse. We'll launch Chrome 
that way. I'll launch Chrome and
 use Lighthouse. You can use 
promises if you want. It's 
keeping the code cleaner. This 
will take the URL we want to 
test, the page we want to test 
and take a flags object. You 
want to pass any flags to 
Lighthouse and also a place 
holder for the configuration 
file if we have the custom 
config that Brendan just showed 
you how to write. In this method
 the first thing you do, no 
surprise, just launch Chrome. 
It's the method you call and it 
returns a promise and then when 
Chrome selects the port we stash
 that port and we'll forward 
that on to Lighthouse. Chrome is
 launched, set it up for us and 
then we actually just run 
Lighthouse. This is also going 
to return a promise and when 
Lighthouse returns we give it 
the URL and it will give us a 
bunch of JSON. We'll forward it 
all to Lighthouse. We can kill 
Chrome and shut it down using C
hrome.kill and return the 
results to the caller. When you 
use this message you give it the
 URL you want to test. 
Example.com in this case and we 
want the results in 
JSON rather than default HTLM 
file. 12 lines of code. Not hard
 to use it programmatically. 
That's what we're joining. If 
you've joined it at the mobile 
web sandbox. Apologize for the 
live streamers who don't have 
it. It is using Lighthouse in 
node using the hue lights API to
 control the lights based on the
 score you get when you run a 
URL. This is the big Lighthouse.
 I put in a URL Chrome 
status.com or something. That's 
a PWA that does pretty well and 
changes the color of the light 
screen. 
&amp;gt;&amp;gt; BRENDAN KENNY: Come over and 
try your site and you can get a 
satisfying green glow or red or 
fog horns that show you. 
&amp;gt;&amp;gt; ERIC BIDELMAN: There are some
 surprises. Check out the code 
that's on GitHub under that URL 
for the big Lighthouse. Another 
thing people often want to do is
 integrate with GitHub and pull 
requests and Travis. A lot of 
doing work on there. You can do 
that as well using Lighthouse. 
You want this little beacon of 
light following you wherever you
 go. 
&amp;gt;&amp;gt; BRENDAN KENNY: You want 
Lighthouse watching your back. A
 little Lighthouse telling you 
good job. 
&amp;gt;&amp;gt; ERIC BIDELMAN: You want to 
know if somebody sends you a 
request if your Lighthouse score
 will drop. We have to demo 
this. This is totally doable. I 
have a pull request on the left.
 I don't know what it does. 
Don't care because Lighthouse is
 going to help me. On the right 
Travis is going to do its normal
 thing and build this pull 
request, run my scripts and gulp
 stuff. As that's happening 
we'll see the log output go 
through. We'll check out and see
 what the pull request does and 
look at the changes. Let's pop 
over and see. There is like -- 
there is a script tag. There is 
this delay thing and like the 
seconds thing and scary. It 
looks questionable. So let's let
 Lighthouse decide. I don't know
 if it's good or bad but let's 
determine that through magic. So
 we're building the PR. What 
will happen here is that after 
this is done, our little helper 
script is basically going to 
send these changes, the pull 
request changes to my staging 
server and deploy it to a 
staging URL. Lighthouse will 
test the URL, return the results
 and modify the pull request.  
if we do that you can see the 
helper script called Lighthouse,
 a minimum score of 96 or above 
in order to pass this pull 
request. Eventually when all 
this stuff comes back Lighthouse
 will finish auditing the pull 
request changes and tell me oh 
oh, this is not a good change. 
#, I promise this won't hurt 
your performance. Not true. I 
have a 93 out of 96 and I wanted
 a 96. 
&amp;gt;&amp;gt; BRENDAN KENNY: Thanks, 
Lighthouse. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Thanks, 
Lighthouse, yeah. This is very 
simple to set up. We have some 
example code if you want to 
check that out at the top there.
 Again it's normal Travis. Do 
everything you are normally 
doing like building your scripts
 and all that good stuff. Then 
the magic comes in after 
success. So I have a little 
shell script that deploys the 
pull request to app engine 
if you're using Firebase or 
other server you can deploy your
 own stuff and run Lighthouse 
JavaScript fires. Tests it on a 
helpedless ve, of Chrome in the 
Cloud and returns the score. The
 score I want to achieve and the
 URL I want to test. It's the 
staging server URL on app 
engine. That's how you use 
Lighthouse to get that little 
light everywhere on GitHub and 
Travis. 
Another thing that just actually
 happened was Chrome launched 
headless mode in Chrome 59. 
Very cool F. if you fire up 
Chrome -- great for headless 
testing. Travis, automated 
environments where you don't 
need a full Chrome you want to 
do browser testing. Do some cool
 stuff from the command line. 
You can create a PDF. A screen 
shot. Dump the dom. Curl the 
page and get the HG -- if you 
want to scale down to a mobile 
device, for instance. So if you 
want to use headless Chrome with
 Lighthouse you can totally do 
that. We talked about the Chrome
 launcher module we have in the 
Lighthouse source. You create 
the launcher and pass an 
additional flag called Chrome 
flags. Normal Chrome flags. Easy
 to use Lighthouse with headless
 Chrome. 
&amp;gt;&amp;gt; BRENDAN KENNY: Yeah. 
&amp;gt;&amp;gt; ERIC BIDELMAN: All right. 
That's a lot of stuff. I'm kind 
of tired and sleepy from lunch. 
&amp;gt;&amp;gt; BRENDAN KENNY: The lion is 
yawning, not roaring. 
&amp;gt;&amp;gt; ERIC BIDELMAN: Let's recap 
what we talked about before we 
close out here. Basically if you
 are building on the web this is
 your web app, okay? You don't 
want to be that guy. Definitely 
want to use Lighthouse and test,
 integrate. It is awesome and 
we're trying to make Lighthouse 
as user friendly as possible. 
Don't forget about the useful 
tool that could help you not do 
that. 
&amp;gt;&amp;gt; BRENDAN KENNY: Everywhere you
 can run Lighthouse. A Chrome 
extension. Chrome web store, 
super easy, easy to use and drop
 in any time. Lighthouse is 
available as a node module tool.
 We just shipped the newest 
version of Lighthouse to MPM. 
The newest version and --
&amp;gt;&amp;gt; ERIC BIDELMAN: There are 
commands you can use to tweak. 
&amp;gt;&amp;gt; BRENDAN KENNY: Block specific
 resources and do all sorts of 
customization that you wouldn't 
be able to do with extension. 
One thing we didn't talk about 
is webpage test. That's a super 
popular tool that people use to 
test their websites and a great 
way to share reports after 
you're done with them. Webpage 
test has Lighthouse integrated 
into it. There is a Lighthouse 
check box. Click that and at the
 top of the report, the 
Lighthouse score will appear and
 you can see the full Lighthouse
 report. Super easy to share. 
Available right now, actually. 
And then as a couple of people 
have mentioned throughout I/O it
 is available in Chrome DevTools
 in canary. Try it out and see 
what your score is any time as 
long as you have canary 
installed. That's where we are 
right now. Eric, what's next? 
&amp;gt;&amp;gt; ERIC BIDELMAN: I don't know, 
what is next? What is next? 
There are some slides. One thing
 we want to do is be wherever 
developers are. So another place
 that you often go to is http 
archive. They run hundreds of 
thousands of URLs and have all 
the interesting data and surface
 that publicly. They're 
considering integrating with 
Lighthouse. Hopefully you can 
see how many URLs are 
progressive web apps and what 
are their scores. That's what 
they're excited about. You can 
see the shape of the web over 
time. Another one I want to give
 a shout-out to a caliber. A 
testing tool. They're 
integrating with Lighthouse and 
you can get Lighthouse results 
in this tool and you can see 
their scores PWA best practices 
same Lighthouse stuff. They're 
consuming Lighthouse and you can
 actually track your performance
 over time, which really awesome
 UI for that. On the roadmap for
 Lighthouse itself there is a 
ton of stuff we want to do that 
we haven't had time to do yet. A
 lot of new audits. We could 
test anything, really and love 
to have your help contribute 
some of those audits. Js code 
coverage. Not using CSS Celek 
tors or not. There are a lot of 
things you have to think about 
to work with crawlers, UX. Are 
you popping up and scroll the 
page? These are things we can 
automate using Lighthouse and 
tell you if you're doing them 
well or if you can improve. 
Security and some other ones. 
There is also a bunch of stuff 
we want to do on the core team 
as well. What happens after page
 load for single page apps? 
Maybe you have an app behind the
 log-in screen and test after 
the page loads and use 
Lighthouse for that. Faster 
auditing to make the process 
faster. When we add more stuff 
it will get slower. We want to 
make it as fast as possible. 
More integrations and making it 
easier for folks to contribute. 
Brendan showed you how to create
 a custom audit. We can make 
that even easier. 
The good stuff is I'll throw 
this out for a brief moment. If 
you want to get Lighthouse on 
MPM. You can install it. We have
 extensive documentation for 
reference material for all the 
audits we have on 
developers.Google.com. If you 
want to write your own audit to 
work with Lighthouse check out 
the DevTools 
protocol reference. All the 
APIs. 
&amp;gt;&amp;gt; BRENDAN KENNY: Crazy amount 
of information you can get from 
the browser and a crazy number 
of things you can do to the 
browser. 
In the GitHub, we have great 
recipes in there that you can 
copy and paste to get started 
with the scripting Lighthouse 
and doing your own thing. 
Brendan and I are talking about 
Lighthouse but the rest of the 
Lighthouse keepers, we have some
 people working internally at 
Google on this on the DevTools 
team and also we have some folks
 in the community that are 
helping us build Lighthouse. It 
is not just a Google project. We
 have a ton of help from the 
outside, too. Hopefully you can 
help us out and build some 
stuff. Shout out to Lighthouse 
keepers. I'm Eric Bidenman and 
this is Eric Kenny. Don't forget
 about four underscores. Thanks,
 guys. 
&amp;gt;&amp;gt; Thank you for joining this 
session. Ambassadors will assist
 for designating you through the
 exits. We'll make room for 
those who have registered for 
the next session. If you've 
registered for the next session 
in this room we ask you leave 
and return via the registration 
li
ne outside. Thank you. 
(Session ended at 3:10 p.m.
 CT)
Services 
provided by:
Caption First, Inc.
P. O. Box 3066
Monument, CO 80132
800-825-5234
www.captionfirst.com
This text is being provided 
in a realtime format. 
Communication Access 
Realtime Translation (CART) or 
captioning are provided in order
 to facilitate communication 
accessibility and may not be a 
totally verbatim record of the 
proceedings. 
&amp;gt;&amp;gt; Welcome. Please fill in the 
seats near the front of t
he room. Thank you. 
&amp;gt;&amp;gt; Welcome. Thank you for 
joining. Our s
ession will begin soon. 
&amp;gt;&amp;gt; DOUG SWANSON: Good afternoon,
 everyone. How have you been 
enjoying I/O? It makes me sad 
it's almost over. 
We have a few more sessions and 
then we all go home. Those of us
 in developer relations will 
have a party tonight. Awesome, 
I'm looking forward to that. My 
name is Doug Stevenson. A 
developer advocate on the 
Firebase team and working 
closely with the Cloud Functions
 team on getting that product up
 and running. We launched it in 
March at Cloud Next. First I 
wonder if you've ever thought 
about how to build a 
transactional multi-player 
realtime game trading system? 
Imagine how you might build that
 in a standard three tier 
architecture. You have a client 
app that users are using to 
perform the trade. Then they 
will need to be connected by 
some 
socket to some middle ware 
server. It will have to maintain
 the state of the trade and keep
 things in sync. We can expect 
there are changing conditions 
since it's realtime. The client 
needs to stay up to date. If 
there is a game there needs to 
be some place to store the state
 of the game. Traditionally it 
would be a sequel database or 
something but have to have a 
trigger system. Things are 
happening in the state of the 
game that's reflected in the 
database those changes have to 
get 
proxyed to the client. Maybe the
 users are figuring out which 
items they want the trade or the
 prices of items are changing 
dynamically. There needs to be a
 way to flow that information 
back an forth. 
Now, it's also important to 
notice that this needs to be 
transactionally safe. You can't 
just float data all around the 
place and expect the transaction
 at the end of the day will 
happen as you expect. There 
needs to be some way to account 
for data contention going on. 
Think about this system. How 
many lines of code do you think 
this would be to implement this?
 Probably a lot. You probably 
also have to worry about things 
like provisioning servers, where
 is the middle ware and the 
sequel and how do you scale it? 
And you have a new set of 
problems. Designing something 
like this is well outside of the
 scope of an I/O talk. I want to
 dumb it down to simple tic 
tac toe. It's a multi-userbase 
system. There are rules for 
engagement. The rules are easy. 
You learned how to play this as 
a child. I did. Everyone knows 
how to play a game of tic tac 
toe. I don't think it's trivial 
to implement if you wanted to do
 something multi-player 
 on the Internet. You have to 
decide at every turn is it even 
the player's turn? You can't 
play out of turn. Are the moves 
they're making within bounds. 
You can't go outside the grid. 
If it an open space? You can't 
move other players' pieces out 
of the way. You top when there 
is three in a row. The game has 
to decide this. If you're 
playing in person you can 
informally agree on when the 
game ends. If you're directing 
it through an online game it 
will have to make the decision. 
I would like to play a game. I 
wrote a tic tac toe game using 
entirely Firebase. If we 
can switch to the demo. There 
will be a URL. Yeah, there is 
reminders. So if you load that 
up I'll try to play -- I'll get 
matched with some of you in the 
audience. Maybe you are on the 
live screen, who knows? I'm 
waiting for an opponent. Someone
 type that URL in. By the way, 
you shouldn't play this game if 
you don't want your name up on 
the screen and forever recorded 
on YouTube. 
Oh, hey, Stephanie, are you in 
the room today? Hi, Stephanie. 
Nice to meet you. All right. 
Looks like it's my turn. 
I'll make a move. I'll warn you,
 I cannot be beat in tic tac 
toe. Oh oh. Stephanie is making 
a move. I have to block. 
Oh, thanks for playing, 
Stephanie. Come and see me at 
the tent and I'll give you a 
prize afterwards. To replay you 
can refresh the browser 
and I'll play again. AVANT, I 
are you in the the room? Also in
 the same row. 
All right. You're first. All 
right. So I'll move up here. 
Notice that I'm actually trying 
to move and the game is 
rejecting my moves. Now, a 
little bit about this. Good job.
 See me in the tent afterwards 
and I'll give you a prize as 
well. Can we switch back to the 
slides, please? All right. So 
like I said this was implemented
 entirely in Firebase. The 
client is quite dumb. It doesn't
 know how to play. It is giving 
me the mechanism to make moves. 
Everything is being decided on 
the server. So what I did is I 
used Firebase hosting, all of 
that is being served up by 
Firebase hosting. When I deploy 
it no matter where you are in 
the world you'll get good 
performance. I used Firebase 
authentication to get locked in.
 I was able to get your name and
 profile picture through a login
 screen and using Firebase 
Realtime Database to store the 
state of the game. All the 
records of all the games is all 
being stored in a Realtime 
Database. It's basically a no 
sequel database. Key value pairs
 and it is realtime in that you 
actually listen to the database 
for changes. If you're 
interested in something you 
figure out its path. You 
register the listener and keep 
that in mind. It's how Realtime 
Database works and there are 
security rules that let you 
determine how users can read and
 write the database. There is 
one other feature I used. I 
won't say what it is. It is not 
a secret but I would like to 
examine what does it look like 
to build tic tac toe with only 
those four components? I think 
it could be done. The secret 
sauce the is database security 
rules. If you don't know about 
them I'll give you an example 
th. is saying the rules and then
 the root level the database 
there is a location called users
 and a wild card under that 
called user. I'm giving that a 
dollar sign to use that sign 
later. Everyone in the database 
can read this location. However,
 I can say that only users who 
have been authenticated can 
write here and user I.D. must 
match the user idea under user. 
We created a space writable by 
one 
user only. You can do validation
 rules. Any value written here 
has to be a string and its 
length has to be 100. It will 
get rejected if 
any of the rules don't match. 
You can do one other thing. You 
can write rules that indicate 
something should be checked in 
another location of the database
 versus some information you 
already have. What this rule is 
saying is users can write to the
 chat location of the database 
but only if their user I.D. is 
listed under another location 
called join. If your user I.D. 
appears under join you can write
 this. It is powerful. You can 
express some pretty profoundly 
complex rules that dictate how 
users with read and write your 
database.  if you write 
complicated rules you end up 
with a bunch of security rules 
that determine how users can 
read and write the base. They 
have to stay in sync. You can't 
change the security rules 
without changing your client 
code. If you change your client 
code you need to change your 
security rules. Powerful but 
inconvenient. That's the fact of
 the matter. When your security 
rules get complex it becomes 
inconvenient and not 
cross-platform. You have all 
this logic in the client that 
needs to be duplicated for 
Android and the web if you're 
supporting those plat foerls and
 it is difficult. When the rules
 get complicated they get long 
and are difficult to test and 
difficult to debug and difficult
 to read as well. It turns out 
there is this Open Source 
project called fire safe. It was
 written by one of the Firebase 
engineer that tries to smooth 
out sof he some of these things.
 With fire safe you can express 
the users for engagement in a 
transactional system and 
generate the security rules for 
you. This is what they look 
like. I think you would agree 
this is hard to read, right? It 
requires a lot of brain power. 
My brain is melting looking at 
it. I won't try to bother to 
unpack it. It's the second stage
 in a 10-stage step of doing an 
end game trade. You imagine this
 times 10 is what your security 
rules look like. There is a rule
 for the person doing the trade,
 what state are they coming from
 and going to. What is the 
signal they're sending to the 
next state and the rules that 
determine how to progress from 
one state to another. This is a 
lot. If I was writing a 
transactional system I wouldn't 
opt to do it this way. If you 
did it this way you would end 
with a state machine that 
determines how clients interact 
with the server and each other 
through the server. 
They are using the server as a 
middleman to negotiate these 
connections. Another problem 
here is if you implement your 
transaction this way, if one of 
the clients disappears at some 
point, the transaction is 
basically dead. You don't have a
 way to recover. So if something
 goes wrong, the whole thing is 
messed up. What you want instead
 is a single source of truth for
 your logic. You don't want to 
split it between the clients and
 security rules. You have it all
 in one place. I use cloud 
functions for fire base to 
implement this. It's -- the 
client doesn't know how to play 
tic tac toe. It lets you move as
 much as you want any time you 
want. Everything is being 
controlled at the server. 
Now, Cloud Functions is part of 
the Google Cloud platform. For 
Firebase we have additions to 
that. It's called Cloud 
Functions for Firebase. You can 
do things like write database 
triggers. If something changes 
in the location of your database
 you can trigger a function and 
have it do some work. You can 
trigger on authentication 
events. When a new user signs in
 you can know that. If a file is
 uploaded to your storage bucket
 you can do something about that
 and write basic webhooks as 
well. When you first deploy your
 code, you don't manage servers 
at all. When you deploy your 
code it goes to Google servers 
and gets published and sits 
there waiting for something to 
happen. So if nothing happens 
you don't pay for anything, 
there is no action. The moment 
users start to use it, it will 
scale up and scale up as much as
 needed to support your app. It 
will also scale down. If your 
users drop off you can scale 
down to zero and you are paying 
nothing if you don't have any 
activity. 
So what I did here is I 
implemented with Cloud Functions
 for Firebase a machine that 
represents a tic tac toe game. 
They express intent. Clients 
just say I want to play or now I
 want to move here or I want to,
 you know, I want to check in 
and I'll talk about all this 
later. But like I said Cloud Fu
nctions decides based on that 
intent what to actually do. The 
clients aren't doing anything o
ther than expressing intent. W
hat I have is a command 
structure. The way I ended up d
oing this I used Realtime 
Database as a proxy. You write 
and say what you want to do. The
 game is updated based on that 
intent. A little pseudocode. It 
grabs the I.D. and builds a path
 to a location that it wants to 
write to. The path is slash 
command slash whatever your user
 I.D. is 
and we create a reference and 
can push data to that lowdation.
 That's wanting to write an 
object. I know where I want to 
write it with a unique I.D. It 
will create a push I.D. A random
 time-based identifier. You can 
find ut what it is on the 
client. Command option has the 
name of the command in there and
 some number of arguments. Maybe
 0 or 2. Now on the Firebase 
side there are security rules 
that protect how users can write
 into commands area. Again 
security rules under commands 
and then under the user I.D. I 
can say no one can read here but
 only that authenticated user 
can write here. Only users can 
issue commands on their own 
behalf. No one can sneak in 
because it's protected by 
security rules. The database 
looks like this. Slash command 
and slash user I.D. and slash 
command I.D. and the command 
object itself. 
That's -- you require Firebase 
functions. This gives you the 
ability to express what a 
function can do. Here I define a
 command or sorry a function 
called command and the reference
 is it looks just like what is 
being sent on the client side. 
Under slash 
command slash some wild card 
slash some wild card. This 
function will trigger with an 
event object that contains 
information about what the user 
is trying to do. I can pull the 
user I.D. out of the wild card 
and command object itself from 
that location database and find 
out that command name says what 
they want to do and act on the 
command name and there are 
hundreds of lines of code 
missing and I will delete the 
command when I'm done. 
So the first thing that you saw 
for those of who played the game
 is you got matched. You were 
all waiting for each other to 
play. Player matching part. How 
does this work? Well the first 
thing we need to do is get two 
players who have expressed 
intent to play and we initialize
 a game and they can 
transact this game. There is a 
simple command for that. Match, 
no arguments. The client sends 
it up saying I want to play. W
hat happens in the database it 
gets pushed in. /command, this 
command is sitting here. Cloud 
Functions says I can do 
something now. The way I 
implement matching. There is 
another location in the database
 with two states it can be in. 
Either empty or there is a UID 
there that indicates someone is 
waiting to play. What the code 
does is flips that toggle. It 
accepts a new person into that 
waiting room, into the lobby or 
it matches the existing person 
with someone else who wants the 
play. 
Now, after we've matched two 
players we need to create some 
sort of game space for them to 
play in. I've designed a simple 
object that contains the player 
1 user I.D. and the player 2 
user I.D. and the list of moves 
and this accumulates all the 
things that both players have 
done and there is an outcome at 
the end. It can be either player
 1 or 2 win and a tie. A move is
 a simple number of the player, 
X and Y coordinate and location.
 This is the game state. This 
holds the state of the game of 
tic tac toe. I'll push this 
under another location of the 
database under slash games. 
We'll generate a random game 
I.D. We don't know what it is 
until the push happens and the 
object under there. We have a 
problem. The clients need to 
know what's in here in order to 
play. They need to know -- you 
know, so we can render on the 
screen what the tic tac toe 
board looks like. The question 
is how do we get the game idea 
to the client so they can listen
 to it. They don't know what the
 game idea is. What we need is a
 way to notify players that 
something changed. The way I 
chose to implement this was to 
create another location of the 
database called/player 
underscore states. There is user
 I.D. that matches the user 
that's playing. What happens is 
the Cloud function will write 
the game I.D. into this location
 telling the user you're in a 
game. Here it is. The clients 
can use that game I.D. to 
construct the path to find the 
state. You get matched and move 
into the game. The client is 
saying I'm in a game and now 
transition to the game screen 
and render what's in the game 
state so the player can see 
what's going on. 
So now we have to figure out how
 the users participate in this 
game. It makes sense to let 
people write their moves into 
the database, that's the first 
logical thing to want to do. But
 I don't actually want to do 
that. I want to assume the 
clients are malicious and send 
me bad data and move out of 
turn. I don't want to have to 
trust my clients. I'm 
fundamentally distrustful. I 
would rather have that decision 
being made on the Cloud function
 side. I'll lock down read 
action. No one can read it -- no
 one can write it but everyone 
can read it. Every game is 
public. Now you can observe the 
game. If you didn't want that 
you could try to lock down 
access to different players. If 
you have the player -- with P1 
and P2 you can say only let 
these players see what's in the 
database. You can do that if you
 want. The security rule for 
player states is also locked 
down to just that user's user 
I.D. When we push data into that
 location only the user can see 
that, right? It's locked down to
 the user I.D. No one else can 
write it. Now we need to 
implement the rest of the state 
machine. I think it's obvious. 
Players have to take turns, have
 to make valid moves, check for 
a win and end the game.  So 
there is a command called move. 
When players are in the game 
they issue a command called move
 and XY coordinates for the 
location. It will get -- the 
Cloud function will trigger and 
handle the move. The only way to
 do it safely is transaction. 
You can move whenever you want. 
You can try to cheat as much as 
you want but this Cloud 
function, because it's 
transactional can do it safely. 
We'll construct a representation
 of the move list, we'll check 
the validity of the move and 
simulate the move and check for 
a win and update the game based 
on that. If someone tries to 
make an invalid move we'll stop 
and update the game. It will 
fail and send a message back to 
the player saying you can't move
 there. We do want to notify the
 players after the move of the 
state change that happened. If 
clients are listening to that 
game data and can see the game 
they saw there was a move. I 
want to personalize it a little 
bit. I don't want the player to 
have to guess if its it's their 
move and if their move was 
rejected if they moved out of 
order. I want to say we have the
 game I.D. but I want to send a 
message to the user saying it's 
your turn now. Waiting for the 
other player. You made an 
invalid move. The game is over. 
We can put messages in here. The
 server decides the messages, 
not the client. The client 
doesn't know how to play. The 
server knows how to play and 
telling the client how to play. 
There is a more generalized 
pattern here. In my system they 
go out through command and 
player states. Imagine a system 
where you have a command and 
response cycle. You push 
commands into the database and 
the Cloud Functions picks it up 
and writes a response back. Now,
 when you push that command in 
you get a push I.D. The client 
knows what that is because it 
pushedist in there and turn 
around and listen to a known 
area for that response. The 
command I.D. is the same. You 
can do this to implement a 
transactional system sand saying
 it looks -- why do I just do an
 http response. There is -- this
 is actually resilient to 
connection problems. I don't 
know if you've ever encountered 
this problem. If you have an app
 making http transactions it 
wants to do a write operation 
but the connection gets cut off.
 Do we know if the write 
finished? We don't know. Is it 
safe to retry it or can the 
server detect if it's a retry? 
We don't know. The context is 
gone and the connection is loss.
 If you use Realtime Database as
 a middleman you push the 
command into the database. You 
don't have to worry about the 
retry. You can be fairly certain
 if the user has a data 
connection it 
will hit a Cloud function once 
and exactly once. There is 
authentication built in here. If
 you use the user I.D. as a way 
of filtering who can write as 
what locations you have 
authentication built in for 
fraoe. you don't have to do that
 like an http connection like 
you would normally and helpful 
for Android 
apps. Android apps have a 
particular problem if you have 
an orientation change activities
 get destroyed and come back and
 you've lost your context and 
figure you out how to 
reconstruct the new activity 
based on an old one. This losing
 of context has to be dealt 
with. You end up using something
 like a loader or headless 
fragment or some other scheme of
 trying to figure out how to 
keep the thing going on in the 
one activity going again in the 
second activity. Those are kind 
of -- I don't like to think 
about those problems. If you use
 Realtime Database as the 
middleman for pushing commands 
to Cloud Functions, 
just remember that string, push 
that in your new activity and 
pick up where you left off. Lis
ten for the response and expect 
it will happen. I think that's 
kind of neat. 
That's how the game works. There
 is a problem with ghosted 
players in this game. Imagine 
you're in a game and you know 
you can't win. What do you do? 
If you don't want to chalk up a 
loss you might kill the app. 
It's unfair. The person who is 
winning should get that win. How
 do you know when someone pulls 
out unfairly? There is a couple 
things you can do here. You 
could do like a scheduled ping 
so if you think maybe I could 
ping the game every once in a 
while and check to see if 
someone is gone or haven't moved
 in a while. You can do that. 
Cloud functions doesn't have a 
way to schedule Cron jobs. But 
we can't do that today. They're 
working on it. If 
you use Realtime Database you 
can remember a a location of the
 database to change if a client 
goes away. I don't really like 
that, either. I think mobile 
connections are kind of flakey. 
I don't know if you know if 
you're on WiFi and switch 
between towers or in the 
basement and don't have a good 
connection for a while. I don't 
want that disconnect to 
sacrifice the game. I would 
rather let the user drive 
through the tunnel and get 
reconnected. If you use a 
disconnect handler you still 
have that problem. I went too f
ar. So instead what I did is I 
implemented a periodic client c
heck in. The client doesn't know
 how to play the game but knows 
how to say I'm still alive. It 
will run a function called 
check-in that will ping the game
 and say I'm still playing, I'm 
still here, I'm not gone yet. 
What happens is again we'll 
create a transaction on that 
game that the user is playing. 
The player 1 looks at player 2 
saying if they haven't checked 
in in a while they'll forget the
 game and the same for player 2.
 It will force player 1 out if 
they've been idle for a long 
time. A way to work around the i
nability to schedule something 
or the inability to, you know, 
just run something at an a
rbitrary time. 
Now, this game I would like to 
Open Source. I haven't Open 
Sourceed it yet. I scrambled to 
get it done at the last minute. 
If you want to follow me on 
Twitter I'll post it there. For 
those at home watching on 
YouTube I'll try to get the link
 embedded in the description 
below. Stay tuned if you want to
 see how it works. The project 
is relatively small I with say. 
About 200 lines of JavaScript on
 the client and no framework. 
Cloud function side it's 700 
lines of code. A lot is 
scaffolding and doing the 
transactions. It is not that 
complicated. The client is so d
ead simple and great because you
 don't have to depend on the 
client being compromised. I kind
 of assume that people will hack
 plans and games and you can see
 in this game I'm not trying to 
prevent anyone from hacking 
anything. Everything is 
controlled on the server. 
So how might we improve this? A 
pretty simple game put together 
in a handful of days. How might 
we improve this? So one thing we
 could do is implement a 
leaderboard with a web API and 
remember what users are doing in
 your app. You could create an 
http Cloud function and you can 
 populate it in your website and
 create an in-game chat. 
Everyone wants to know how do 
you use Firebase to put chat in 
the apps. You can do a webhook. 
If you're in a tournament system
 and high profile game and a lot
 of people chatting about it, 
you could use the slack API to 
notify everyone the game 
is complete and what the outcome
 was. You could create 
resistance to bots. You probably
 want to stop that if you are 
playing for money or playing for
 points or playing for rest 
taoej. You probably want to 
validate the user is a real 
user. Google has APIs, you click
 a box and prove that you are 
human. You could wire that up 
into Cloud Functions and make 
sure no one can play until 
they've satisfied that validates
 their humanity basically. And 
that's all I have for today. If 
you have any questions about 
Cloud Functions or Firebase or 
anything I'll be in the tent 
next door. If you have any 
comments or concerns about is 
Cloud Functions right for you or
 Firebase right for you, let me 
know. We have a bunch of people 
over there Firebase staffers, 
myself would love to talk to you
 about how Firebase can work 
for you. We have documentation 
and a YouTube channel, a blog. I
 contribute to all of those. Let
 me know the kind of stuff 
you're interested in. I could 
make material for that. And 
thank you very much. 
I hope you enjoy the rest of 
your day. 
&amp;gt;&amp;gt; Thank you for joining this 
session. Grand Am bass door will
 direct you through the 
designated exits. We'll be 
making room for those who 
registered for the next session.
 If you're registered for the 
next session in this room, 
please clear the room and return
 via registration line outside. 
Thank 
you. 
(Session came to a close at 4:00
 p.m. CT)

&amp;gt;&amp;gt; Welcome. Please fill in the 
seats near the front of t
he room. Thank you. 
&amp;gt;&amp;gt; Welcome, thank you for 
joining. Our session will begin 
soon. 
&amp;gt;&amp;gt; Hello, everyone. Welcome 
to one of the last talks of 
Google I/O. Thank you for being 
here even at 
this hour. I'm R.J. we all work 
on cloud functions. What you 
have here is some of the best 
looking Twitter handles in the 
team. So I created mine just for
 you a week ago but if you want 
to follow a more experienced 
Cloud functioners follow Thomas 
or Abe. Abe is great especially.
 We are here today all three of 
us to talk about Cloud 
Functions, about testing and 
about Open Source. So you might 
wonder to yourself, R.J., why do
 we need 
to talk about this? Because I 
know how to test my code. I've 
been doing this for ages. I know
 everything there is to know 
about Open Source. Well, it 
turns out this is silicon valley
 and we've gone and changed the 
world. And the world of 
serverless looks quite different
 from what we were familiar with
 before. So everything is 
different, right? Nothing we 
know applies anymore. We need an
 entirely new set of best 
practices. Well, not quite. 
There is a small snag, which is 
that best practices take 
practice. They take a lot of 
time to build. So this is not 
something that would just pop 
into existence in the two months
 since we launched Cloud 
Functions into  beta. It is not 
something we could have 
experienced in the few years 
we've been working on 
serverless. It forms over 
literally decades. So we 
actually don't think that you 
should throw out the best 
practices that you know that you
 love, that you're familiar 
with. But the old is the new. 
All you need is a new set of 
tools to apply what you already 
knew, the old best practices 
that you may already be familiar
 with, and then to apply those 
in the new world of serverless 
with a new set of tools. 
So what we want to do today is 
basically do three things. We 
want to bring you into a mindset
 that we think is conductive to 
writing good code and then we 
would like to call out a few 
best practices that roll out of 
that mindset, and then we would 
like to give you a few concrete 
examples of how to apply those 
best practices in a world of 
Cloud Functions. In a world of 
serverless, more generally. So 
let's dive into that mindset. 
This is what we call the Open 
Source mindset. And the Open 
Source mindset is interesting. 
It is good to look at because it
 is one of the most thorough 
mind  sets you can get into when
 you're developing code. Open 
source turns out to be a hard 
place to develop code. For 
example, other people might 
deploy your code. This is true 
whether you want it or not. 
People can just take it and run 
it anywhere. You will have to 
assume, however, that even if 
other people help you out and 
contribute some code, they won't
 maintain it. So the code is 
your problem whether you like it
 or not. You will also have to 
assume that the code will get 
reused because this is something
 we've all done. We copy and 
paste. And most importantly at 
least in my opinion hopefully 
you are doing this for fun. And 
especially with Open Source 
where you are doing this in your
 free time it had better be fun 
or you won't do it. Now, you may
 say to me well, R.J., this is 
all well and good but actually I
 am, you know, in a cushy job, I
 get paid to write code. None of
 this is relevant to me. Why am 
I here other than for the nice 
air conditioning on a hub day? 
We actually think this mindset 
is useful where or how you code.
 If you're in a closed source 
environment in a company, say, 
the same rules are useful to you
 as well. For example, even 
though the number of people that
 deploy your code are fewer, you
 might deploy to a staging 
environment, 17 different 
development environments as well
 as eventually production. Your 
code is most definitely your 
problem. People will call you on
 a weekend if it breaks. Even if
 somebody else breaks it, you 
are the person they know wrote 
the original bit of it so you 
will get called. 
Reuse happens everywhere, not 
just in Open Source. Copy and 
pasting works at your workplace 
as well if it's a closed source 
company. And most importantly 
again, at least in my opinion, 
hopefully your job is fun. So 
with that in mind, I think we --
 I hope to convince you through 
this talk that the stuff we tell
 you, even though it comes from 
a mindset of Open Source, it is 
actually useful no matter how 
you code or where you code. With
 that, let's dive into that 
first assumption, the assumption
 that other people deploy your 
code. 
So from that rolls a best 
practice that we want to share 
with you, which is that you 
should put your configuration in
 the environment. Don't put it 
in configuration files, 
especially don't hard code it 
into any of your code. Put it in
 essentially environment 
variables. This is not new 
advice. This is something that 
you may have heard from places 
like the 12 factor app but we 
want to show you how to do it if
 you're developing in a 
serverless world. 
So let's take a look at Firebase
 hosting. Firebase hosting lets 
you host static files that can 
be your HTML, JavaScript. But if
 you're using something like the
 Firebase SDK which I hope many 
of you will be using or else 
will get a chance to play with 
soon, then you need to configure
 that SDK. That SDK talks to a 
backend which means you need 
things like an API key. That's 
different between your 
production and staging 
environment and everybody's dev 
environments. How do 
you 
avoid coding your API key. The 
second line of code there, you 
see a fire base INIT.js. That 
snippet of code will pull 
environment variables into your 
code andconfiguring your code 
that way. And we have been smart
 enough to set those environment
 variables for you no matter 
where you are either running 
locally using Firebase serve or 
on the Cloud when you run 
Firebase deploy. This is super 
useful. If you now get cloned 
this file and you get Firebase 
to deploy it to a completely 
different project, it will work.
 There is 
no code editing and it's super 
easy to switch between 
environments. This is the front 
end. Let's look at the Cloud 
Functions code. It is actually 
even easier there. This example 
imports the Firebase admin 
module into the environment. 
Same as with the client side, 
you have to initialize it. Do it
 by saying functions config 
Firebase. It will initialize 
your admin SDK and you're ready 
to go. I can deploy it to any 
Firebase project, it will work 
just great. Now with that I 
would like to hand it over to 
Thomas. I'm sorry, I forgot one 
of my slides and this is 
actually one I'm very excited 
about. So sorry. It turns out 
there is, of course, cases where
 you want to put stuff in the 
environment where you can't just
 rely on the environment 
variables that we set for you. 
And that is possible, too. So in
 this example what I'm doing is 
I'm on my command line writing 
Firebase functions config set, 
and then I set some secret, API 
key and configuration value that
 I like. And it's there. It runs
 in my -- it appears in my 
server side environment. I can 
load it in the same way I loaded
 the Firebase configuration 
environments. So it's super easy
 to access. It's great. If you 
are deploying a new project, you
 can clone your environment 
configuration from the one 
project to the other. You do 
that only when you are setting 
up the project, so you copy it 
across once, you edit whatever 
values need to be edited when 
you set up a new project and you
 have a new environment that 
your code can run it. If you 
develop code think to yourself 
can I clone  thex act code, 
deploy it somewhere else and run
 it. That's the goal. Over 
to Thomas. 
(Applause)
&amp;gt;&amp;gt; THOMAS BOULDIN: Thanks, R.J. 
That was worth covering in 
depth. One of my favorite 
features of the Cloud Functions 
SDK for Firebase. So with a show
 of hands, how many of you have 
ever either released software or
 deployed to production? Okay. 
That was about as many as I 
expected. How many of you were 
stressed when 
you did this? That's about 100%.
 So this is actually one of the 
most nerve racking parts of our 
job. I find it absolutely crazy 
how often we fight getting 
ourselves a basic safety net. So
 there is an obvious piece of 
advice that you will see all 
over the Open Source community. 
Add some tests. So before we 
dive into how to test Cloud 
Functions specifically, I'll 
take a quick detour on how to 
test JavaScript code generally. 
That's what we use to write our 
Cloud 
Functions. These are the node 
models that we'll be using 
today. If you want to take a 
quick picture you can look them 
up more later. This tests the 
fibonacci sequence. We're using 
two different tools. This part 
is mocha. Mocha is a test 
runner. It lets you define your 
test suites with the define 
command and your test cases with
 the A command. Define callbacks
 before or after every test 
suite or every test case. Mocha 
will give you a test runner the 
run all your tests and aggregate
 the results in a readable 
summary. The one thing mocha 
doesn't do is actually verify 
any behavior in your app. So for
 that we'll use a second tool, 
Chai. We like using Chai for two
 reasons. One, like mocha, it 
helps you get very human 
readable tests. It reads like 
English so you can understand 
your tests as a contract for the
 expectations in your code. The 
other reason is that Chai is 
incredibly ex tenseible. We'll 
use an extension to Chai later 
on in this talk. Once you've 
written your tests, I highly 
recommend that you wire 
it up to your package.json. It 
supports a scripts field at the 
top level of the file and it's 
called test. You want to do 
this. That way you can just run 
NPM test. You may remember how 
your tests are run. This is the 
industry standard way of testing
 it. If conform to industry 
standard people know how to run 
your tests. If they know how to 
run them it's more likely they 
actually will. 
Back to our regular program. 
Let's talk about Cloud Functions
 specifically. So for many of 
you, this may be your release 
process. 
You followed R.J. advice. You 
have a hacking party and try to 
break your app and if you don't 
see anything you roll out to 
production. I hope this is your 
plan and not just this part. So 
if this is the way you release 
your app, if your needs are so 
complex that you need to do a 
full system test, I can still 
help you automate that middle 
step. Because it turns out the 
Firebase command line tools are 
a node module. 
You can include them in your 
code just like any other 
library. So now we're going to 
write a systems test that 
actually tests our staging 
environment for a live http 
function. We'll use the before 
hook to deploy the current 
project to our staging tier. 
Next we'll create an actual http
 request that is targeting our 
staging tier. We can grab any 
off the shelf http library and 
send a real live request to real
 live servers and verify the 
actual http results. This is a 
very powerful tool for the most 
complex of testing needs. But 
there are some down sides to 
this. Because obviously if you 
are deploying to production and 
talking to an external server it
 will take a lot longer for your
 tests. So you should save this 
technique as a last line of 
defense. 
Another drawback is if you're 
actually targeting the staging 
tier you can't have multiple 
people in your team run your 
system-wide test all at once. 
They'll collide with each other.
 So let's try to make this a bit
 more advanced and go from a 
systems test to an integration 
test. It turns out that just 
like the Firebase tools, the 
code you write with Cloud 
Functions to the library as 
well. You haven't written a 
whole binary. You can inport it 
inside your tests. Here we've 
actually imported an http 
function from our Cloud 
Functions code. You may not know
 this, the thing you create with
 a Cloud function is a callable 
function. You can call it 
yourself. So now instead of 
creating a real live service and
 running a real life network 
request we'll use an extension 
to Chai called Chai http. With 
this we can give a network 
response handler what your http 
functions are and 
created an in-memory web 
service. Now we can do true http
 level testing where here we're 
doing a get request with a query
 parameter against our Cloud 
function. The whole function and
 still verifying the result as 
an http response body. This is a
 great idea for integration 
tests. There is one small 
problem, though. If you followed
 R.J.'s 
advice, this is your index.js. 
This line here is the special 
magic R.J. told you about. As he
 said, it doesn't depend on your
 code, it depends on the special
 environment we create in 
production and a local 
emulateor. Which means this will
 throw an exception if you run 
it in the unit test. But we can 
add another tool to our 
JavaScript tool belt and solve 
that problem. 
We'll use sinon. It creates 
different implementations. We'll
 include the Firebase functions 
library and modify it. We can 
change the behavior so that 
functions.config no longer 
depends on this automatically 
created environment but returns 
a fake object and now we can run
 our integration test. As a 
quick aside and tips about these
 tools. 
Sinon or similar library called 
Nok are great for certain cases.
 In the Firebase functions we 
have behavior that doesn't kick 
in with a minute or so but using
 sinon we can test our behavior 
without waiting a interest in in
 our unit tests. You can use a 
spy to make sure that a callback
 gets called. And if you have a 
dependency on an external 
service news knock to mock the 
entire interface. It isn't the 
most powerful use of sinon. We 
created a side effect and worked
 around it. It's kind of strange
 because if I created another 
test suite I'm going to have to 
add that same boilerplate all 
over again. And if I add a new 
side effect I'll have to modify 
all those test suites. Whenever 
you find yourself rewriting the 
same code over and over again, 
that should be a code smell and 
you should try to think about 
how to approach it differently. 
That brings us to our next 
mentality. 
A sinon code will be reused. If 
code is being copied and pasted 
in the code base and 
if you have to fix the same fix 
several places there is a 
solution for that. Look at how 
you can make your code more 
modular. So let's rewrite our 
actual Cloud function so it is 
more easy to test without those 
side effects. I recommend that 
you treat your index.js like 
your main file. In traditional 
programming people don't often 
test their main file. Instead 
the main file is simple 
boilerplate that composes very, 
very rigorously tested 
libraries. So we can do that 
here as well. We're going to 
move the logic of our fibonacci 
function to a library file 
and include it in index.js. 
If the Cloud verse, it's easy to
 unit test. You don't need an 
in-memory unit server that will 
save a lot of time. There is 
this bit here coupled to the 
fact we're a Cloud function and 
a lot we can do but you'll 
probably write this over and 
over again in your other http 
functions. So instead, just make
 that another library function. 
There are a few benefits. Now he
 know in your http functions you
 have a consistent rendering 
strategy. This one library can 
be tested independently and 
reused. If 
this is your 
index.js I wouldn't hold it 
against you if you didn't unit 
test it but you can focused 
tests with things inside of it. 
Try to make your index.js so 
simple it has little to no 
conditions or loops. Next, try 
to make sure that you have no 
globals in any other files. If 
you need a global make it a 
parameter in your utility 
method. Index it in index.js and
 pass it in. You'll find your 
libraries are dramatically 
easier to test. I even recommend
 this when you are doing things 
like the Firebase app is SDK. 
Take that from index.js. 
Some other tips related to http 
functions. In general you 
shouldn't be building libraries 
that are Cloud function specific
 because you'll have a harder 
time testing them. If you have 
something that's innately 
coupled with the nature of http 
make a stand alone library that 
you call within your Cloud 
function. Here is a more complex
 example in fibonacci. We have 
the Cloud function that's an API
 Forge'ting a user's order 
status. We can create a simple 
testable method. It makes sense 
this is tied to http. You might 
except a session token based on 
cookies, headers, query strings.
 It doesn't have to pollute your
 global code. Now we have the 
isolated http method the best of
 our business logic can be more 
abstract. Get query order status
 takes an authenticated user and
 we can continue from there. So 
I would like to leave you with a
 few more tips on how to improve
 the quality of your code. First
 of all you should always lean 
on industry standard methods or 
tools. Because when you import 
these libraries you aren't just 
importing the dev code but their
 unit tests. And the best way to
 improve your code quality is to
 write less of it. If you find 
your code is getting more 
complex and adding too much edge
 cases, ask yourself how you can
 try to narrow down your scope 
and simplify your app. With 
that, I'll hand it off to Abe to
 add a personal touch to the 
talk. 
(Applause)
&amp;gt;&amp;gt; ABE HASKINS: All right. Thank
 you, Thomas. So far we've been 
talking a lot about code. But 
this last section, this last 
assumption with the Open Source 
mindset is more of a philosophy 
and more of an idea about why 
you are writing code and 
building things in the first 
place. So we want to assume 
we're doing things for fun. I 
think the best way to illustrate
 running a fun project is to 
talk about an actual project 
that I've been running for a 
couple of years. This project is
 called JPEG.Kool. It is the 
most simple service you could 
run. I start evidence about two 
years ago and it has a very 
simple 
functionality. If you put 
JPEG.cool anything why your 
browser it will find an animated
 gift. It will return it to you.
 If you typed that in it will 
get you back on Firebase logo 
and it just returns that as an 
image. If you typed in the 
Google logo it will get you back
 this complicated animated gift 
of the Google logo. It is not 
very consistent in what it 
returns but it will always get 
you something and it is always 
kind of interesting. Here is 
some other interesting ideas if 
you type in fire.GIF you get a 
fire, fire bass, try user names,
 things like that. It will 
return an image. 
It's an interesting project. 
Over the two years I've been 
running this as a side project 
I've got to learn the really 
applied version of this mindset.
 I can go through each of these 
assumptions and see what they 
look like for me in a real 
application. Assumption one, 
assume others deploy your code. 
With JPEG cool no one else has 
deployed the code. I forget how 
to deploy my code. I don't 
remember the commands very well.
 I don't remember how I SSH into
 the box two years ago to set it
 up. I don't remember. I need to
 make any deploy process 
optimized for that. Then I 
assume my code gets reused. The 
core code base hasn't changed in
 two years. However, how I 
deliver it to you has changed 
dramatically. In some cases it 
was running on just a compute 
engine BM. It ran on a Custer 
and now and Google Cloud 
Functions for Firebase. It has 
moved around but the code 
remains the same and has gotten 
reused different ways. People 
ping me when JPEG cool goes 
down. As a small service most of
 the users are my friends, 
family, co-workers, people like 
that and no filter about bugging
 me when it goes down. I'll get 
calls and text messages and 
everything whenever it doesn't 
return an image. That's very, 
very annoying. So if we assume I
 do this for fun, I'm not doing 
it for fun anymore. I'm sick of 
people pinging me. We need to 
optimize for this. We need to 
come up with a situation where I
 can stop thinking about my 
pesky users and have fun having 
the code and thinking about the 
actual problem and always be 
ahead of my users. If something 
does break in production or 
there is some issue, I can be 
aware of it. 
First we need to be able to get 
code out quickly, step one. We 
need to make shipping JPEG cool 
as easy as committing code. We 
don't want to think about 
Firebase deploy. I do it via 
service and continuous 
integration. Firebase has 
continuous integration support 
and provide a token to a 
service. If you aren't familiar 
with it, it's the idea you have 
an externalselves that knows how
 to deploy your code. You set up
 rules and guidelines and 
watches your other repository. 
When you make a change it runs 
it, tests it and ships it out to
 production. Once I've set this 
up, set up my Firebase deploy 
command in my continuous 
integration environment. I know 
a minute later it will be 
shipped to production and that's
 all I have to remember. I won't
 forget 
how to use git. It works well 
when I respond to issues at 2:00
 in the morning. This is part of
 a bigger narrative. We want to 
debug fast. That helps reacting 
fast but doesn't help us debug 
what's wrong with the 
application. If JPEG cool 
doesn't serve up an image it 
could be breaking in a bunch of 
different spots. We need a way 
with a new level of insight into
 our application while it's 
running in production. 
This is stack driver. If you're 
used 
to using Google Cloud or 
Firebase stack driver is related
 to problems of insight in your 
application. If you want to know
 what is happening you'll look 
at stack driver linked in the 
Google Cloud console you'll see 
it there. Just about every part 
of Google Cloud links out to 
stack drive in some way. Your 
app engine throws data into 
stack driver. Every application 
on compute engine logs out 
there. It is deeply integrated. 
M terms of knowing what's 
happening. Stack driver is where
 we'll want to look. The first 
and easiest solution or use of 
stack driver is to let 
it enhance console.log for us. 
It will print out on my terminal
 in my PC, a log file on a 
server. The defacto standard for
 knowing what's going on. This 
is what it looks like. This is 
stack driver logging. These are 
console logs coming from my a
pplication and you can see we 
have time stamps, we have the 
function in this case it's 
request cool or fail cool and we
 have the crazy I.D.s. These 
crazy I.D.s are individual i
nvocations. If we click on one 
of those stack driver logging 
will automatically create a 
filter that allows us to see the
 invocation, and the life cycle 
of that one function. We aren't 
looking at logs from different 
functions overwriting each o
ther. We can step into one and 
figure out what's going on. I 
can see 
that somebody typed in JPEG.cool
 crickets and they got an image.
 That looks good to me. This is 
just the beginning. 
This is console.log improved. 
That is stack driver error 
reporting. Something built in 
when you deploy your Google 
Cloud Functions. A way to know a
ny time something throws an 
error in your functions. In this
 case I have a few different 
errors that have arisen over 
time. Silly mistakes. Cannot r
ead a property. These bubble up 
and get caught by stake driver 
error reporting you can 
configure it to alert you. But 
it lets you know if something is
 breaking in production that you
 are aware of it. If we click on
 one of these we get a graph of 
how often it has been happening,
 when it was last seen. We get 
the stack traits. Step into 
individual occurrences of this 
issue. We get a new level of 
insight without writing any 
code. You aren't importing an 
SDK into the JavaScript code. 
That's the awesomeness that's 
the functions environment. 
This is a type of monitoring 
that is very simple. You aren't 
doing anything, right? You a
ren't importing special things 
or SDK. We can go farther. We 
can actually build custom 
metrics around stack driver and 
all the data that Google Cloud t
hrows into it to get a better 
idea of our service to make sure
 we're confident that our 
service is up. Now JPEG cool has
 a bunch of functions. Here are 
the invocations of different 
functions. Here we see a test 
function called hello world b
eing executed and we have more 
down there that aren't shown. 
One of the most important ones 
here down on that list because 
it doesn't get invoked very 
often is the cash cleaner job. 
If you go like me and download 
animated gifts and throw them 
into a Cloud storage bucket 
you'll find animated gifts are 
big. 100 megabyte big if you're 
randomly grabbing them. It's an 
issue if you're paying for the 
service like I am. If no one has
 accessed this gift in two weeks
 but it is still taking up 100 
megabytes of storage I'll clean 
it up. I do it as a Cron job. A 
Cloud function that triggers 
every day and cleans it out. The
 problem is, if that function 
fails there is something in 
there that makes it not succeed.
 It doesn't get invoked. S
omething happens wrong with the 
Cron process that is triggering 
it I won't know. It is going to 
fail silently and won't ever be 
exposed to my user. I set up a 
daily cleaner job policy. It 
watches invocations of that cash
 cleaning functions and says if 
it doesn't get invoked for a 
given 24-hour period something 
is wrong. If it doesn't get 
triggered we need to know about 
it. That's what this does. This 
is a couple situations 
over the last two months where 
this job hasn't gotten invoked. 
It happened on April 1 and March
 21. My job didn't get invoked. 
As soon as this happened, as 
soon as it started failing it 
sent me a text message and said 
hey, your Cron job isn't working
 anymore. Something is wrong. 
That's great but only half 
the narrative here. Once the job
 got back healthy -- once it was
 healthy again I got another 
text saying hey, the situation 
has been resolved. Your function
 is running well again and 
everything is okay. The 
combination of these checks and 
couple other monitoring checks I
 have, things like that, all set
 up in stack driver monitoring I
 can be confident that JPEG cool
 is always up. If something goes
 down I'll know about it before 
my users. I'll hand it back for 
R.J. for some closing comments. 
(Applause)
&amp;gt;&amp;gt; ROBERT-JAN HUIJSMAN: Thank 
you, Abe. All right. Before we 
send you back into the heat, we 
thought we would quickly recap a
 few of the higher level 
statements that we've made and 
the first was the best practices
 take practice, so don't expect 
that in a world of Cloud 
Functions of serverless that 
we've been talking about we will
 have to completely reinvent the
 wheel. We will keep using the 
best practices that we know and 
love, we just use new and maybe 
better tools to use those in our
 new world. 
Secondly, we would argue that 
you should pay attention to how 
Open Source does development 
even if you don't do Open Source
 development. Because it helps 
you write better code that is 
more robust and more reusable. 
All that good stuff. We would 
like to invite you to meet us in
 the sandbox that is right 
outside here, the tent that says
 Firebase on it. We'll be there 
basically until I/O closes. If 
you comments, questions, 
remarks, find us there, we'd 
love to hear it. Here are useful
 links in case you're curious. 
All of us work on Cloud 
Functions and we would love for 
you to take a look at our 
documentation, play with it. 
Once again, let us know if you 
have any comments. And if you'd 
like to learn more about Cloud 
Functions, about Firebase, about
 the whole back end of the 
serverless 
world check out our 
YouTube.com/Firebase. With that,
 thank you so much. Feel free to
 follow us on Twitter especially
 Abe is addicted. He is very 
entertaining. So I hope to see 
you all outside in our tent and 
thank you so much for being 
here. See you 
next year. 
(Applause)
&amp;gt;&amp;gt; Thank you for joining this 
session. Grand Am bass doors 
will direct you through the 
designated exits and making room
 for those who have registered 
for the next session. If you've 
registered for the next session 
in this room we ask you please 
clear the room and return via 
the registration 
line outside. Thank you. 
(Session ended at 5:10 p.m. CT)
Services provided by:
Caption First, Inc.
Monument, CO 80132
This text is being provided 
in a 
realtime format. 
Communication access realtime 
translation (CART) or captioning
 are provided in order to 
facilitate communication 
accessibility and may not be a 
totally verbatim record 
of the proceedings. 
&amp;gt;&amp;gt; Welcome, thank you for 
joining. Our session will begin 
soon. 
&amp;gt;&amp;gt; Welcome to this session. I'm 
Khanh and this is Arun. We work 
for Google. Before we start, 
let's get to know each other a 
little bit. So in our crowd 
today first raise your hand if 
this is your first time 
attending I/O. Wow, that's 
amazing. Almost, I don't know, 
80% of our audience today. So 
thank you for raising your hand.
 It sls the first 
time I and Arun present at a 
session. I hope you have enjoyed
 y
our I/O so far. 
(Applause)
Firebase. We have more than 20 
Firebase sessions at I/O this 
year so you've heard a thing or 
two about it. We launched 
Firebase as a platform last 
year. How to grow your business.
 Firebase provides you many 
ready-made solutions to address 
common use cases that almost 
every app needs. However, with 
the increasing complexity of 
mobile apps, Firebase is very 
broad. So I guess maybe some of 
you may get confused on where to
 start when you start using 
Firebase. This is why we come up
 with this session to guide you 
through some of the popular use 
cases that many -- when they 
start in Firebase. Today we'll 
look at a hype thet call 
e-commerce app and see how we 
can quickly add new features to 
us using Firebase. We show 
Firebase recipes in use cases 
when you use Firebase that are 
common. The first recipe is how 
to link existing app users into 
Firebase so you can make use of 
all the features we have in 
Firebase. The second one is 
maintaining data consistency 
without getting code inkliex. 
The third one is send push 
notification without a server 
and the last one is how to use 
improve purchase 
conversions in your app. Arun, 
can you show us the first recipe
 we have today? 
&amp;gt;&amp;gt; ARUN VENKATESAN: Sure, Khanh.
 Let's see how we link existing 
users to Firebase. Why does 
linking matter? Linking your 
existing users to Firebase 
enables secure access to the 
Realtime Database from your c
lient apps. The Realtime 
Database is used in an 
e-commerce app tone able a chat 
feature that allows users to 
chat with an operator. But first
 why use the Firebase Realtime D
atabase at 
all? With Realtime Database you 
can -- iOS, Android and web and 
it helps you with offline 
handling. Now that we have r
ealtime sync how can we control 
access to the Firebase so the 
users sees his or her own 
message 
and nobody else's? Realtime 
Database uses security rules to 
enforce access. In order to 
allow users to read or write 
only their own data you may use 
the rule 
as shown here. Okay. So now that
 we know how to implement secure
 access to the Realtime 
Database, back to the recipe. We
 have an existing e-commerce app
 with its own authentication and
 user model. So the question is 
how do you integrate that user 
model into Firebase so that 
Firebase can identify your users
 and give them access to their d
ata inside the Realtime 
Database? The answer is using 
Firebase Auth. Realtime Database
 uses Firebase Auth for user i
dentification. When a user signs
 into your server a web token is
 generated and that's how you 
certify your user identity. And 
then when the signed in users 
accesses the Realtime Database 
the token is used to prove their
 identity and sign into 
Firebase. Here are the detailed 
steps to link your existing 
users to Firebase. First, sign 
in your user via your existing 
mechanisms in your app. Now that
 you know who your current user 
is, the next step is to issue a 
Firebase Auth token on the 
server to represent the current 
user. And finally, use the token
 to sign in t
he user to 
Firebase using Firebase client. 
Assuming you signed in the user 
here is how you issue an custom 
auth token for that user. 
Start by initializing the file 
base admin, then use it to as
sure custom auth token. You only
 need to specify user I dent 
from your own auth system and 
Firebase will do the rest for 
you in coding your token. Once 
you have assured a custom auth 
token, return the token to the 
app client. Okay. So now you 
have custom auth token. Let's s
ee code to use the token to sign
 in your user to Firebase. 
You need to provide a custom 
token as a parameter for the 
Firebase Auth and that's it, 
you're done. You can now go 
build awesome realtime features 
and database. Pretty simple, 
isn't it, Khanh? 
&amp;gt;&amp;gt; KHANH LEVIET: I agree. 
Thanks, Arun. There is already 
many high-quality tutorials 
online how to implement a chat 
app 
with Firebase Realtime Database.
 You can check out our Firebase 
code lab to get started. Now you
 have implemented a new in app 
chat feature on top of database.
 The second recipe today is how 
to 
write your business code and 
accessing them in client app. 
Why do we need it? Is it logic? 
Let's take a look at an example 
use case. So you add the 
features to your e-commerce app 
and allow users to have 
conversations and invite other 
users to those conversations. 
Then you may have a data 
structure like this. You have a 
conversations node and a user 
node, top level. Under each 
conversation note you have a 
users node containing a list of 
users who are participating in 
the particular conversation and 
at the same time under each user
 note you have a conversations 
node containing a list of 
conversations that the users 
are participating in. Whenever 
you add a new person to a 
conversation, you need to make 
changes to both conversations 
users and users conversations 
nodes and make sure the data 
under those nodes stay 
consistent. Here is how you do 
it with the iOS app. Very 
straight forward, isn't it? You 
have an Android app as well. 
Let's write the same logic for 
the Android app, similar to the 
iOS app. Oh, wait. Are we 
writing the same business logic 
once again? Because we also have
 a web app, then you ended up 
duplicating the same logic. One 
more time. One logic in three 
clients. Imagine when you have 
more complicated than this 
logic. Maintaining the same 
logic implementation across 
multiple platforms may increase 
the risk of database 
consistency. But the good news 
is we have Cloud Functions for 
Firebase, a product that was 
released recently just for such 
situations. Cloud Functions 
allows you to run in a managed 
environment that you don't need 
to speed up and run your own 
server. You can write using 
Cloud Functions and then have 
your apps do the function rather
 than implementing the logic in 
each client app. 
Okay. Let's see how we implement
 it. We start by defining our 
logic. What our logic is to add 
users to an existing 
conversation. We name it add 
user to conversation. It takes 
two input parameters to use the 
user you want to add and the 
conversation I.D. we want to add
 it to. The output of our logic 
is very simple. It is the status
 of if our user has been 
successfully added to the 
conversation or not. 
Let's look into how we 
implement our logic. First from 
our app we write input in the 
Realtime Database. And then you 
go through a Cloud function 
where the actual business logic 
is implemented. And lastly again
 from our app we listen to our 
logic output 
in Realtime Database. Okay, 
let's look into the first step 
writing logic into Realtime 
Database. Here is how we 
represent 
a business logic execution in 
our database. We have a 
dedicated location inside our 
database and use add user to 
conversation 
notes to execute it. Under each 
notes we have an input note 
which contains the input of our 
business logic. In this case, it
 has conversation ID and user ID
 of the users we want to add. 
Then we have an output note 
which represents the output of 
business logic. That we want to 
share with our client app. Here 
we only have a status of if our 
business logic execution has 
been successful or not. 
It starts a logic excuse by 
pushing a new client knowed 
under add users conversation. We
 add conversation ID of the 
target conversation and user 
I.D. of the users we want to add
 to the input logic and we write
 it to 
the Realtime Database. Next to 
implement our business logic 
using Cloud Functions. We define
 our function so that it will be
 triggered every time our client
 app writes a new logic input to
 Realtime Database. 
In our function firstly we get 
our logic input from the 
database. Cloud Functions store 
our input data into the trickle 
event object so you can use it 
right away with without 
explicitly accessing the 
database. Then we implement the 
core parts of our business 
logic. User conversations and 
conversations users accordingly.
Please note that I'm using an 
admin database. It will succeed 
or fail all together so users 
conversation and conversation 
users both get updated. If it 
fails, then none of the nodes 
change. Then finally, once our 
database update has completed we
 write the result to the 
corresponding output node so our
 client app can use the results 
to our users. Lastly again from 
our client app we listen to the 
logic output in Realtime 
Database. 
We have our database reference. 
Our logic execution earlier. 
What we have to do is listen to 
change in this nodes containing 
the output. Once we have the o
utput we show it accordingly. 
Now we have all the i
mplementation ready and let's d
o a quick demo. 
We have the e-commerce app and 
the chat features that we i
mplemented and now we're having 
a conversation with two 
users, Kanako and mark. We'll a
dd another users. Let's add Tom 
to our conversation. So we will 
expect that after our logic 
excuse we'll have Tom add to the
 conversation users so our 
conversation will have Tom under
 the 
list of users who are 
participating in that 
conversation, and at the same 
time under users conversation we
 expect to have Tom added here 
and have our conversation and 
the list of conversations that T
om is participating in. Let's go
 ahead and do it. 
You can see that our logic e
xecution has finished and our 
plan 
app has added a request to add 
Tom to our conversation. And the
 output of our logic execution 
indicates that our logic 
execution has succeeded. So as a
 result, we have Tom here in 
conversation users and under us
ers conversations we have 
outcome position under the list 
of conversations that Tom is 
participating in. And that's it.
Let's get back to the 
presentation. 
Everything is set up the add 
users conversation lodge Ickx 
even works when the device goes 
offline. It will be pushed to 
the server once the connection 
is restored without rewriting it
 to store it locally by 
yourself. You can do more 
complicated logic with your 
function. For example, you can 
go one more step. Checking if 
the requesting users is indeed 
participating in the target 
conversation before allowing him
 or her to add the users name. 
Let's go back to our function 
and see how we add 
the permission check. 
What you do is first check 
conversations users to see if 
the current users is 
participating in the target 
conversation. If they are not, 
then do nothing and mark the 
logic execution as failed. If 
they are, go ahead and update 
the database like what we did 
earlier. You can do the 
permission check using security 
rules as well but 
doing the permission check 
inside the Cloud Functions has 
the benefit of centralizing your
 database manipulation code in 
one place and you can completely
 disallow your clients to write 
to the database. 
That is our second recipe by 
implementing them in Cloud 
Functions. Now, let's November 
to our third recipe for today. 
How to send push notification 
without creating your own 
server. Let's go back to the 
chat feature that we reviewed 
earlier the Firebase. When there
 is a new chat message sent to 
the conversation we want to send
 push notification to all users 
participating in the 
conversation and let them know 
that there is a new message. We 
want to use Firebase FCM to send
 the push notification. 
Firebase using 
-- is another 
Firebase product. FCM provides 
it to all users no matter 
whether they're on Android or 
web browser. You need keep track
 of your user device. When you 
send a push notification use the
 token and the -- representing 
the notification content and FCM
 will do the rest for you. FCM 
will target Apple push or APM to
 get your message delivered to 
your user's device. When you 
send a push notification you 
need to authenticate using the 
server key so it comes directly 
from your client app. That will 
-- you may need to speed up the 
server to send push 
notification. That is no longer 
the case because Cloud Functions
 can do it for you. Let's see 
how we do it. So there are three
 steps. 
First, let's write a Cloud 
functions which listens to a new
 chat message added to our 
Realtime Database. 
Next from the message compose 
and send out push notification 
via FCM. And last, make sure to 
subscribe our client app to the 
right FCM topic so users can 
receive the message we intend to
 send them. We'll go into 
details later. Don't worry if 
you don't know what an FSM topic
 is at this moment. Now let's 
start with writing our function.
Assume that we have our chat 
message stored under a message 
node for each conversation. 
We'll write our conversation 
when there is a new message 
added. We have our function to 
listen to changes in message 
notes under each conversation's 
notes. One session mean we have 
a new message added will send a 
push notification to all the 
users participating in that 
conversation. Now let's see how 
we send push notification. 
First we'll take the message 
contained after the name and 
conversation I.D. from the event
 so we can use it later to craft
 our push notification 
message. Then from the name and 
message content we create an FCM
 payload to represent our push 
notification message that we 
want to send to our users. Next 
we want to send our message to 
our users. 
Here I make use of the FCM 
feature called topic message. 
What we do is we define a topic 
for each conversation. We name 
our topic using our conversation
 I.D. because it's easy. And 
then all we need to do is to 
tell FCM through our admin SDK 
to send it to the dedicated 
topic. Here you no longer have 
to bother about handling FCM 
token by yourself because it has
 it done 
for you. 
Lastly, let's make sure our 
users are subscribing to the 
right FCM topic. So when your 
users join a conversation, you 
need to subscribe them to FCM 
topic 
corresponding to that 
conversation. And don't forget 
to unsubscribe them when they 
leave the conversation so that 
we won't spam them with the 
messages they don't care about. 
And now you have 
your third recipe on how to send
 push notification using FCM 
without speeding up your own 
server. It is time for me to 
hand the stage back to Arun to 
show you the last recipe we have
 for you today. 
&amp;gt;&amp;gt; ARUN VENKATESAN: Thanks 
again, Khanh. So far we have 
seen recipes that help you build
 on the listen app. Let's see 
how we can improve 
the app using Firebase. You are 
interested in reengaging users 
that go to the cart and abandon 
the purchase flow without making
 a purchase. By sending them a 
push notification 
gently nudging them to complete 
the purchase flow. Here are the 
steps we'll take to track and 
reach out to the non-purchasers.
 First, we track when a user 
adds an item to the shopping 
cart. Next we listen to this 
event and write details to the 
Realtime Database and we'll see 
what those details are. And when
 the items in the cart are 
eventually purchased, we listen 
to the purchase event as well. 
And remove the purchase items 
from the Realtime Database. 
Periodically they gather the 
list of non-purchasers and their
 items and a push notification 
is sent to all the 
non-purchasers. Nudging them to 
complete the purchase. 
Thus hopefully helping with -- 
we used Google analytics for 
Firebase to mark it as an event.
 Cloud Functions both as a 
trigger based on analytics 
events and timer based that 
we'll see in a minute. The 
Realtime Database to store our 
cart items temporarily. And 
finally FCM to send out the push
 notifications. Let's see each 
of these steps in greater 
detail. When an item is added to
 a cart an analytics event is 
logged. Here are some Android 
code. Notice that item details 
this event. So we know that 
Cloud Functions can listen to 
and trigger based on analytics 
conversion events. So in order 
for that to happen at the cart 
needs to be put as a conversion 
event on the console in order 
for Cloud Functions to get the 
event. We detain a function that
 will be invoked when the 
conversion event is logged and 
this function rights the user 
I.D. to 
the Realtime Database. If the 
recall a few slides back we 
logged the items details in the 
record and these parameters are 
accessible to the function here 
and returned to the Realtime 
Database as well. Here is a 
snapshot of the Realtime 
Database when a single item has 
been added for a user when the 
user adds an item to the cart. 
As more items are added to the 
cart, these are also added to 
the Realtime Database. The 
Realtime Database asks for a 
place to 
hold user's cart data that 
hasn't been purchased yet. When 
a purchase is made the purchase 
details 
are logged to analytics and 
conversion event as we know by 
now. When the purchase 
conversion event is generated 
another Cloud Functions triggers
 and removes the cart from the 
database. Here are some 
functions to remove the 
purchased items from the 
Realtime Database. 
Now we have a snapshot of the 
cleaned up Realtime Database. 
All the deleted items are the 
ones that have been purchased. 
Periodically or at the end of 
the day the Realtime Database 
only contains details of 
non-purchases and the users 
I.D.s and cart items. We use 
functions to Reed the data from 
the Realtime Database in order 
to send push notifications to 
the users. What triggers this 
Cloud function? As we mentioned 
earlier, Cloud Functions are not
 only triggered by events but on
 timing tools. Use functions 
tend to trigger our Cloud 
Functions. It is another feature
 of Cloud Functions powered by a
 Google app that periodically 
posts a message to Google Cloud 
that performs the Cloud 
Functions. The repository here 
shows the score showed for the 
functions and you need to 
download and run it. The 
schedule to trigger the Cloud 
function can be customized so 
you can do it for your own app 
as shown here. And when the 
functions can 
force the message Google Cloud 
pops up and sends a push 
notification to the user for the
 non-purchasers. So the 
non-purchasers now see your 
reengagement push notifications 
and may come back and finish 
their purchase. So now you know 
how to improve purchase 
conversions using Firebase and 
that concludes the recipes 
for today. To recap, we saw how 
to link your existing app users 
into Firebase using custom 
token. Avoid duplicating 
business logic. Send push 
notifications without a server 
inside of Cloud Functions and 
finally, try to improve purchase
 conversions by tracking 
non-purchases by an lit 
particulars and reaching out and
 reengaging with them using FCM 
and used Firebase to build an 
in app chat feature. However, 
Firebase has creative use cases 
and let's see a few examples. 
The &quot;Wall Street Journal&quot; uses 
Firebase realtime database to 
cover their live events. Some 
events covered includes the U.S.
 and French presidential 
elections, sporngt events such 
as the Olympics and Super Bowl. 
And also the Oscar awards 
ceremonies. 
Instacart delivers groceries 
from local stores to your 
doorstep. Realtime Database 
enables the sharing cart where 
users can collaborate realtime 
to purchase groceries. 
Hello world no pun intended is a
 Hungary based travel and 
discovery app, a small 
startup using multiple images. 
They chose the Realtime Database
 for its ease of use and 
flexibility. Being a startup 
allowed them faster property owe
 typing and experimentation. And
 smart technology in South 
Africa based company that does 
classroom education across web 
and mobile. Seamless recovery 
using mult -- stand by connects 
employers with job seekers in 
Japan. They use Realtime 
Database to follow the in app 
chat 
features like what we showed 
today allowing job seekers to 
chat with potential employers 
and send out push notifications 
in cloud messaging and it 
resulted in doubling their 
conversion rate. 
Tapps games is based in Brazil. 
They use the Realtime Database 
in Cloud Functions to sync games
 and multi-played games. That 
brings us to the end of our 
presentation today. For the next
 steps please see the Firebase 
documentation here. Can also 
keep in touch with us on 
stackable flow and other 
discussion forums. I hope you 
enjoyed our session and Google 
I/O. Thank you very much for 
being here. 
(Applause)
&amp;gt;&amp;gt; Thank you for joining this 
session. Grand ambassadors </div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>