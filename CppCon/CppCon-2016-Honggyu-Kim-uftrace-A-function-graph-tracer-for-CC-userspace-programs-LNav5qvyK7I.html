<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2016: Honggyu Kim “uftrace: A function graph tracer for C/C++ userspace programs&quot; | Coder Coacher - Coaching Coders</title><meta content="CppCon 2016: Honggyu Kim “uftrace: A function graph tracer for C/C++ userspace programs&quot; - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2016: Honggyu Kim “uftrace: A function graph tracer for C/C++ userspace programs&quot;</b></h2><h5 class="post__date">2016-10-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LNav5qvyK7I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Hi, I'm Honggyu Kim from LG Electronics.
I'm going to introduce about a new function tracing tool which is called uftrace.
uftrace is newly open-sourced and you can download it from github.
Let's see. There is a function main.
And main function calls foo.
And foo calls bar.
If you compile it, we get this kind of binary.
If you recompile this program with -pg option.
It inserts all the mcount function calls at the entry of each function.
If we execute it with uftrace record, we can record all the trace.
And then we can replay it.
And you can see the result.
And also you don't have to record it.
You can just use the live command.
You can just omit it.
The right block explains about the call chain.
main function calls foo, foo function calls bar and bar just returns.
And this is thread ID.
And this is function duration.
For example, foo function executed this amount of time.
This is timestamp based, not sampling based.
So it provides various filters, but the most important thing is time filter.
Let's say if I put -t 200 nano seconds, it removes all the function calls that are under the 200 nano seconds.
It's very good when you watch the big picture only.
Because there are too many small functions.
So it is removed.
Once the trace is recorded, you can see the report.
This is the summary.
It shows the total time, self time, and the number of calls.
Let's say there is a fibonacci example, which is written in a recursive way.
If we execute it, then it shows the result.
uftrace shows this output.
The main function calls fibonacci functions recursively.
If you want to see the arguments, you can put this option.
It shows fibonacci 5 calls fibonacci 4.
And it goes on and on and on.
You can also see the return value as well.
It means fibonacci 2 returns 1, and fibonacci 1 returns 1.
As a result, fibonacci 5 returns 5.
Once you record it, you can also dump it.
But if you put --chrome option, you can dump it as json format.
This json format can be dumped into a file.
This file can be opened in a chrome browser without any other installation.
You can just go to chrome://tracing.
And then you can open it, then it shows the result.
This is timeline and it goes to the call-depth.
You can also trace STL as well.
There is an example shared_ptr.
It allocates only one single integer.
In the block, the allocated integer is shared with another shared_ptr.
We can recompile it and then we execute it.
And then we can provide more filters.
You can see this kind of result.
This is the internal of STL.
The first block just allocates it.
The second block just add a reference counter only.
The third block just decrements the reference counter.
And then the last block just deallocates it.
You can also analyze clang compiler itself internally.
Those are all clang functions.
You can see the parse AST.
Backend code generation and this kind of things.
I put the time filter here.
If you decrease the time filter, you will see more result.
There is another example.
Fibonacci example can be written in a template meta-programming way.
You can just compile it.
There is a lot of recursive expansion.
I can show you demo here.
This is opened in chrome browser.
You can see here.
It shows a lot of function calls.
If you go here, then you can search.
If you find something here.
There is a really really deep call depth here actually.
If you just zoom in, you can find a log of repeated patterns.
If you search &quot;special&quot;
You can see the repeated pattern here. It shows template specialization.
Another example is V8 JavaScript engine.
You can see the shape of JavaScript engine.
You can magnify it.
You can see a lot of background threads are executed to optimize some JavaScript function calls.
The console output looks just like that.
You can just run uftrace -t 100ms.
This is the entire execution function calls of clang.
If you see the entire, this is too much actually.
You don't want to see everything.
That's it. Thanks very much.</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>