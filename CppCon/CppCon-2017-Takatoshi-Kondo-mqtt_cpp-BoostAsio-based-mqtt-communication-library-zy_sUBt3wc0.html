<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2017: Takatoshi Kondo “mqtt_cpp: Boost.Asio based mqtt communication library” | Coder Coacher - Coaching Coders</title><meta content="CppCon 2017: Takatoshi Kondo “mqtt_cpp: Boost.Asio based mqtt communication library” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2017: Takatoshi Kondo “mqtt_cpp: Boost.Asio based mqtt communication library”</b></h2><h5 class="post__date">2017-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zy_sUBt3wc0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Hello, everyone.
I will introduce mqtt_cpp,
Boost.Asio-based MQTT
communication library.
My name is Takatoshi Kondo.
I am from Japan.
I am working for OGIS.
I am developing scalable MQTT-based
messaging platform named MessagePub+.
It uses mqtt_cpp.
I contribute to some open-source projects.
MQTT is a communication protocol for IoT.
MQTT is based on PubSub model.
It's very lightweight protocol.
It's connection-based protocol,
different from http, rest.
Let me show you the
concept of a PubSub model.
We can use multiple subscribers,
publishers, and topics.
Subscribers can subscribe any topics.
For example, subscriber one
subscribes topic A and B.
Subscriber two subscribes topic B.
Then, publisher one publishes
the message &quot;hello&quot; to topic A.
Then, the message is
delivered to subscriber one.
Publisher two publishes the
message &quot;world&quot; to topic B.
In this case, the message is delivered
to both subscriber one and two.
The left-hand side are
implemented as client.
And the right-hand side
is implemented as server.
In MQTT domain, the server called, broker.
MQTT supports the newest,
ah, Mqtt_cpp supports
the newest version of
MQTT protocol, 3.1.1.
I have a plan to support the
next standard, MQTT five,
currently not accepted
as the standard yet.
It's header only library.
Both asynchronous and synchronous
operations are supported,
like Boost Asio.
You can create client application
using client functionality.
Also, you can create your custom broker
using server functionality.
It's open-sourced, Boost licensed.
Mqtt_cpp support four
variations of MQTT connection.
Here is a protocol stack.
From left to the right, MQTT on TCP.
MQTT TLS on CPP.
It's usually called MQTTS.
MQTT on WSS, TLS version of WebSocket,
and MQTT on WebSocket.
Thank you for Boost Beast,
congratulations Beanie.
Let me show you a code example.
First, include the header file.
Then, define IO service object.
Then create client with IO
subs, object, host name,
and port, and set up MQTT parameters.
Then set up handlers.
In this example, I implemented
only connect to handler.
Connack means connect acknowledgement.
If MQTT connection is
successfully established,
then subscribe topic one.
The Boolean written code
tells continue or not continue
asynchronous process to the library.
Note in the example, though, mqtt_cpp
provides various functions and handlers.
For example, publish function,
receiving message handler,
and close handler, and so on.
After setup, we are finished.
Then, call connect member function.
Finally, call IO subs run member function.
It's basic manner Boost
Asio-based application.
Let me show you a simple demo.
My iPhone becomes an acceleration sensor
and my PC becomes a monitor.
Both connect to the broker on AWS EC2.
The monitor subscribes the
topic for acceleration data.
Then, the acceleration sensor
publishes the data to broker.
The data format is MessagePack.
The broker uses MQTT server.
Both things are on the
monitor web browser for demo.
I use MQTT.js to connect to the broker.
Okay.
This is the demo.
This, if I tilt my iPhone to the right,
the monitor reflect it.
Oh, something wrong?
(audience laughing)
(laughing) Okay.
You don't, ah, maybe
it's connected to wifi.
Ah, okay, time.
Okay, like that.
Very quick response.
Please try it.
Thank you.
(audience applauding)</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>