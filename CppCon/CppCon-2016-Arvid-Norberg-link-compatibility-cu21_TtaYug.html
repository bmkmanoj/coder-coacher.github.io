<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2016: Arvid Norberg “link compatibility&quot; | Coder Coacher - Coaching Coders</title><meta content="CppCon 2016: Arvid Norberg “link compatibility&quot; - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2016: Arvid Norberg “link compatibility&quot;</b></h2><h5 class="post__date">2016-10-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cu21_TtaYug" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right my name is Arvid and I work at
had fun in New York called 2 Sigma 2
Sigma on my spare time I maintain a
library specifically a compile library
not one of these fancy headers at all my
library's so for instance my library has
built congregations you can build a
debug version and a release version
which you can build with the deprecated
functions enabled or you can build them
disabled and a few other configurations
along these lines so imagine that you
have a header for your library that
looks something like this you have a
struct and one of these members was
really mistake taught so you want to get
rid of it so you if the fit under this
build configuration option and then you
have a function that returns this you
have a client that includes your header
file calls this function now it's it's
very important that both the client and
your library is built with the same
build configuration otherwise this
define will be different they were have
different understanding so the layout of
this struct this is basically the same
problem of linking against the wrong
version of MSV c CRT or having
incompatible settings for GOP CX x
debugging if you're familiar with that
so how do you force the client to have
the same coefficient as as the library
there are a few solutions
there's PKG config boost build
surprisingly has a very good support for
propagating requirements stop the the
dependency graph column i learned this
week also has ability to export sort of
requirements turns out not a lot of
people use boost build and mine mike's
experience is that people only use pkg
config after they've been bitten by this
this problem and the symptom is memory
corruption and I get big bug reports I
figured out tell them and then they use
peak echoing so I want to remove myself
from this sort of cycle so what do you
do
you can turn it into a link tomorrow so
basically what I'm ended up doing is
something like this you have as part of
your life where you have one header
that's the buildconfig header so let's
see what's what's going on here so this
looks at the current build configuration
and it traits defines that you know
names either know deprecated or
deprecated asserts or no asserts you
know you can imagine that you have more
of these variations you concatenate
these names using newspapers obviously
then you declare a function with this
name in your library you define an empty
function with this name and then somehow
you force your clients to attempt to
make a call to this function you can do
this through different ways for instance
if you have a main class that basically
you have to instantiate to use remember
you can have its constructor be inlined
make a call to this and then you know
forward that call to the actual
constructor and then you get this
instant and a bug report with this paste
in it it's much more pleasant to handle
however though if you can I would really
recommend doing this this is what I've
started doing where basically you you
make sure that the the binary layout of
your structs are the same and then when
you actually delete this this member you
can delete them both at the same time
and you never sort of really run into
the convertibility issue obviously you
have to pump your SL personal this is
sort of inter as a version also wanna
mention if you are looking for long term
payback compatibility and backwards
compatible compatibility specifically
you should probably look at in what
namespaces instead of hey that's it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>