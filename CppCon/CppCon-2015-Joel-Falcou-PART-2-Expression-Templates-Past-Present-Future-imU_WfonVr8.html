<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2015: Joel Falcou PART 2 “Expression Templates: Past, Present, Future&quot; | Coder Coacher - Coaching Coders</title><meta content="CppCon 2015: Joel Falcou PART 2 “Expression Templates: Past, Present, Future&quot; - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2015: Joel Falcou PART 2 “Expression Templates: Past, Present, Future&quot;</b></h2><h5 class="post__date">2015-10-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/imU_WfonVr8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">but then I enter into Phase two of these
three phases talk okay someone where is
he over there someone mentioned
something I forgot to show you so I will
just show you now that I will use it to
bit more afterwards as I would just take
that okay and I will go somewhere else
maybe some one of you knows these
websites so a GCC dot God board dot org
something just zoom a bit is it readable
yep okay and that's very funny that
stuff you can actually shortcode there
is get compiled and you can have a look
at the assembly on the other side and if
you really really really doesn't want to
want to do you can actually see all
other compilers on other architectures
behave okay that's very very interesting
things to do it's very useful when you
try oh so I got as you see now wonderful
that's really interesting because
sometimes you have you have performance
issues which I especially template or
not and you doesn't up in your friggin
clue what's going on and this stuff is
actually very useful yeah it's ohms but
it's not really ok so just zoom okay
okay so it's either i zoom or I just
assume everything ok so if you look at
their basically what the stuff is doing
is a I don't even know what I print what
do i print already yeah so he is
probably eight and so yeah so if you
look at this yet I just put eight into a
register out into the others and I
just call the injection operator doesn't
have any function calls and if I lessen
the optimization level same there same
there so you really really want to do
low and then now you start the OC
function starting to appear into Z
enthusiasm in emojis so if any oh one we
still get well with what we want okay
but the fair assumption on this is that
you have to rely oh wait no sorry hear
you
you have to put your face faith sorry
into the ability of your compiler to
perform a lot a lot of in lining ok if
you're comparison lining capabilities is
bad you will have probably bad surprises
ok so now so we went through all of this
and we we saw that we have a way to
build arbitrary tree at compile time
containing information about the
structure of an arbitrary expression oh
there is plenty of tricks you can do
with this one trick is that for example
these assignment operators I showed a
bit before there is cases where it
should be good if we have the assignment
operator inside 3 for example let's say
you want to optimize matrix operation of
the form see x equal a time Percy called
a times B and you really really want to
capture that and send it to a proper
blast level three operations but for
doing this you need to cap to see a and
B so by making the plastic whole
operation say something like ok I will
evaluate something into what I need
instead of everything eight times B and
putting in somehow in to see you will
say I will build a tree of plastic or
assignment between C a and B and
evaluate that so sometimes you want to
build an arbitrary bigger tree into some
other operators before calling the
compression point so arbitrary functions
called arbitrary operator scores get
translated into statically represented
three of the expressions that you can
evaluate by doing some three terminals
at the basics but such basics and we had
a lot of stuff to do and one way to do
this is to use tool for that don't
really want to run your own tent
expression templates in giant by n well
you may want to a strongly advise
against it ok for I try to do this
during my PhD and I almost died ok so
and yeah
from the first time but it's fun the
first time ok and it's definitely not
the second time and all the time
afterwards so it's better to rely on
tues ok and one of the two that happens
to exist for this is booth prado there
wasn't a bit much of another tools
that's called feet and Pumbaa maybe
somebody someone of you know about those
names which is basically the great
ancestor of that so what's what's we had
booze Prado as I say writing manual
extraction template game Giants are
quite limited so is far too much
boilerplate if you only want to have
something that has more than two
operators on one terminal types okay
forgot about your weekend and we have
the problems at the data and the travels
of the data are tried together and not
try to mush coupled and it's not easy to
work with other similar but a different
expression template based code because
we have no way to know which expression
is coming from where and you basically
up to special k is everything but
sometimes you really want to have this
cleaned expression coming from library a
interlibrary be which happens to be the
nozzle expressions but that means that B
and a merger information about the
representation of the tree not very
practical so the solution is to find the
generate interface for estrogen
templates I was about to write concepts
when I wrote that but then I forgot
about on cookie could be and this during
interphase asked to be genuine up so you
can actually be arbitrary number of
library based on different templates
while knowing that they are all in terms
of a rebel but yet you can actually
steal you know difference again and what
we need to do is to have a way to
represent transformation of the tree in
more let's say friendly way and one way
to do this is to not reinvent the wheel
and take pages from compilers and try to
orchestrate your transformation into
something like look let's compile your
phases and finally we need to find
solves the extension issues which is
what if I want to take one tree
and turn it into something and take the
exact same tree and process it into a
completely different way without having
to revise your wall each time okay and
that's what this photo try to do and do
this we have to sit down a bit and look
as a bigger picture when I say like one
hour ago that's premier the primary use
of external templates was to limit
temporary generation and improve
performance I lied that's a very very
very very limited view of what we can
use as a problem is it take us basically
12 years to understand that okay so many
issues uploading main objectives is find
a way to implement something called
domain-specific and the dead languages
so first things first what is a
domain-specific language or DSL it's
usually a declarative language which may
or may not be too incomplete that do
only one phase it's very good at solving
one single family of problem okay we'll
use make sorry for you so make it is
it's a dsl it's a small languages that
lets you build bit system we use SQL
yeah same thing you you access that
basis schema with that but you probably
can't write a bit system using up using
SQL okay nobody contacted me move and
we'll use matlab okay same same stuff
dsl's for solving issues of numerical
computation math lab is with more
turing-complete than sqm a look at the
same idea when you write with matlab you
doesn't write your frigging triple loop
whenever you want to make a matrix
multiplication you just right I want the
matrix multiplication and the system do
it for you the proper way or awesome
what matt webb says so it's all only one
family of problem but it solve it the
correct way because it only have one
kind of problem to care about and
usually those kind of languages are
interpreted or
compared into something else with an
external tools so what our dses norman
specific same stuff but invaded language
so and bidding is a bit tricky doesn't
make embedded like in embedded systems
it's anything like in it's hidden it's
basically a library that took on his
head ok see the mentor of a language
it's a library which is designed with
the same basic principle of a
domain-specific languages so instead of
relying on providing an API based on
object and functions that do stuff the
basic design is driven by the fact that
you want to build a library where the
core element could be seen as a
condiment or for special languages and
the operators in the function your prey
on them is made so that so call you
right with it it looks like an external
languages embedded into your C++ that's
what's basically boo spirit does it
looks like a Backes norm form inside C++
accept it just a library and what we do
is that we force our google holds the
process compiler to be turned into
luckily a compiler for this dsl that
happens to generate c++ and then do
whatever and expression 10 pranks are
actually the only solution we are right
now to write something close to dsl's
inside see prosperous and that far more
powerful than let's let's optimize a
bunch of temporaries that means that we
can actually take a bunch of expressions
and take decisions about regeneration
based on so your successions of
operation into these expressions you can
take it slice it we build it in
different way before we do anything we
will be able to pattern match inside it
and so on and so on and that's the real
usage of a different templates what I
say during the break is that if I have
five minutes which I don't I could
actually write a small dsm expression
template-based mattress libraries are
preventable is to advance and I could
probably write a similar code that far
less complex using regular functions
regular operators regular mattress types
let's use move semantics aveo and clever
users of all of this and I'm pretty much
sure that the performance will be quite
close that's an experiment that set up
to do but that's my my gambit and sad so
even if the performance is not the main
focus why are we still doing this that's
so we need it because we need to build
arbitrary expression of laboratory
language and turn it into something else
and the best way to do this is to
capture your iced tea and take decision
about it except you don't really want to
do that all day long by yourself and
that where boost provo kicks in booth
brother it's an expression temperature
get it gives you all the freaking
boilerplate to get all the operators all
the functions decorating the tree
knowing all you want to Travis three in
one way or another and it's all ready to
use don't have to write any other of the
craft we said 24 you just generalize a
way of implementing in an efficient
template in giant and it's May so it's
customizable and it's also compiler took
it because contrary to what we've wrote
very crudely in the first part of this
talk we use concepts to fake faces into
the systems we see that also we build an
expression we can match it against
something that validate so far as the
expression is correct within our
languages that's what's the rest of the
world called a grammar okay and then we
could actually do something when we go
down our tree and find some kind of
patterns at what we called semantic
action in the rest of the world and
that's terms that will come back into
booze Prado and help us build those kind
of let's visit grammar some chases
expression and if it's correct I would
select which kind of semantic actions I
want to provide and apply on this and
get the resulting code and if you build
different library based on booze Prado
the other way to say oh this is this
library and this is a library I know
to do when they get mixed they have to
go into an expression of this author
library and so on so we doubt we r be
able to bear interoperability between
DSS she's very important so because you
really really want your let's say your
your eigen reputation to be put down
inside the Freddy's functions best to do
spirit okay stuff rises so does it works
well first that we need to do is as we
said before we need to generate this
damn tree from a bunch of code that's
basically all you need to write that
replace these 80-something lines of code
i brought before you include this
brother you make a terminal god and you
instantly have all the operators and and
all the operators you want on your
terminal every one of them including the
kruky comma operator including is a very
strange function member access through a
row operator whatever whatever whatever
everything is already there i can write
this code like this it doesn't make any
sense okay if we compiled okay just as
everything and everything is instantly
turn into an 83 as soon as at least one
terminal defined as a boost proto
terminal is anywhere in the expression
so you just need one proto thema node to
contamination your expression and get a
lazy version of it yes
that's what's terminal is it has to be
into a new position somewhere that's a
terminal by definition oh oh yeah yeah
so the question is oh is it really that
much contaminating yeah but it's a
regular the regular rules of language up
and so the example was what if you write
x plus power ends three plus five
welcome Barry will probably come to
three plus five and replace it by eight
and you will end up with the tree which
is X plus eight but you end up with the
tree which is X plus something okay as a
regular rules still apply yeah the same
way you could not change the precedence
of the operators because the language
doesn't let you to do so okay so you can
write this code and we obviously is very
deadly of display export function that
do what it's just written in the can it
just displays of expression so if you
confine that and run it you end up with
something like this which is basically
laid out view of the tree you just built
and boost brother just print to the name
of the function tag every time they find
one and the terminal you get the value
printed as soon as a type reporting to
the terminal as a stream insertion
operator okay if not just bring the type
of the terminal so you just do this and
you have basically eighty percent of
what you need you can visit tree and
inspect it this free expert is very
interesting because you can actually
play with your with your operators and
see what makes sense in terms of your
language design and when you are okay
with what should you should be writing
and matching you can actually do what so
you have a terminal of int in the boost
prada terminal every time everybody put
it you just contaminate everything and
you get a tree okay so okay nice but
what if I really want to do something
with this tree it wasn't like you know
I'm not there to just display it so
that's a bit more complex so I would
switch to a real code because these font
is really
very very too small so which one is it
of information so just just so you will
see it there ok I can actually take it
and put it there ok so that's like 10
lines instead of 70 something not that
that so a booth brother is currently
something which run on on regular c++
don't need ever know 14 just an easy guy
so yeah you got that and you can do
kruky thingy like this example I think
that's this way you do it I never know
how you should be writing that yeah that
should be doing yeah I did something
wrong come on oh no yeah okay oh yeah
yeah of course yeah just died okay what
about that that should be doing it yeah
comecomecome a plasma displays multiply
blah blah blah and so on and so on and
what's the name of this funky a road
star it's called the mem PT on okay
that's that's what we want ok so you can
just write that and just get captured on
itself ok and I think you can also have
stuff like this and that and so on and
so on you basically have everything oh
yeah introduces in the middle for
combiner oh oh yeah of course yeah so
rule number one with exertion template
is text time to compile it's probably
correct it returns directly you made an
error and now the issue is that i'm not
joking actually ok comma comma pressman
is blah blah blah where are the new guys
man PT are subscribed it's the brackets
and function is this so we got
everything ok
and function is a bit strange I put a
function of where that we switched off
and obviously the node is a fun element
node so first one being the one who
calls a function of their attorney okay
but you have everything okay and it just
was so back to this so what I really
want to do is I want to write piece of
gold with some operators I don't want to
write piece of code with whatever
because I want to limit the scope of my
language okay so the first thing we need
to do is find a way to say i build an
expression and what I want to know is is
this expression correct with respect to
my language design so you already worked
with designing a language there from
scratch yeah okay so what you need is
what we call a grammar a brother we say
this is what is authorized in my
languages and if you don't do what I say
your expression or your statement your
program is invalid so what we need to
add is a way to take a lavatory
expression and check if it's much
grammar okay and the way to do this is
to use these funky operators look at
flying Elvin and following so we make us
we make a structure let's say my
expressions my EBA what can it be it's
either a terminal of underscore which
means a terminal of whatever model types
or its plus applied to two sub
expressions very dating the same grammar
or multiplies between tournaments of the
validating the same grammar again okay
if I wrote that using a more classical
way I will probably have written
something like this which is that my EPA
is it's either a terminal okay
or it's an EPA plus EPA or its EPA times
EPA my BNF is a bit rusty but that
should look like this if i'm not
mistaken and taking some shortcuts and
that's exactly what i just wrote okay
except i have to explain it with
whatever syntax the C++ language let me
so the idea is to say we have this or
make sure we also have an end okay let's
say this is what I accept us as a valid
language from from you okay and if you
look at wades done you can actually
refer to yourself inside so you can have
this EPA is an epa of an epa okay i
could have brought something like this
which have meant i want an epa on the
left and whatever on the right and so on
and so on okay so we have a bunch of
constrictor exists that address build a
matching pattern of what is correct okay
so that's a very crude example we get
through a very more complex one little
but yet it's it's actually bit more than
that so obviously i use plus and
multiply but you have everything else ok
you are but you have a constructor for
every operators you want you also have a
generic match sure like binary xfer
unary experts say whatever the tag
whatever the operation if it's binary or
it's okay okay and so on and so on so
what do we do is this which is structure
okay well we we make a terminal of NZ
and I'm asking if does X plus X the type
of X with X match the EPA grammar and
does the type of x / not X match it ok
so i just use data types there ok but
could I put it into a function and
taking the type of your expression in
another way ok just fall for the fuzzy
example and obviously the first match we
return true
cos x plus x is basically terminal plus
terminal terminal match epa so a PA plus
ppl is matched recursively okay and the
other one is not because I don't have
any device and I don't have any
compliments into the grammar okay so if
i take these things and i go there again
I should have forced a true and false
printing whenever you want Troy and
forth and okay i can actually oh sorry I
forgot about that yeah tap tap I should
have made an item a deep side STD small
screen just add tap tap everywhere yeah
true false so what if I i do this I do
that that it works should it and and
with it yeah inclusively tree has to be
converted somehow into a terminal of end
that was floated us as soon as you have
something which is contaminating
everything else is buggered up into the
proper proto expression that match it so
tree is a literal okay so it's a
terminal so it should match terminal of
whatever rules that should be saying
true let's see whatever anyway want okay
true okay ah and I can actually add
stuff there so let's put divide backs
divides okay so i can write that such
just as simple as that just are you
rules and dot and exact it's not device
wasn't even that so oh yeah sorry oh oh
yeah yeah yeah I make to make full of my
using I should have put them
cause multiplies you can sometimes it
doesn't know if it applies all times but
devices device I don't know how you can
call it actually and so now look at look
at if I do this okay let's let's make
something more complex all right now I
have a terminal floats Steen walks
because we don't put any constraint on
the terminal okay and now let's let's
what happens if I do this you can
actually write that I want Daniel
off-road and nothing else and the last
one become photos treason in it's not a
float ok let's go back there yeah this
is a terminal thing let's let's see if
it's true let's see if our intuition is
right also is right let's see if it is
comprised
yeah complies wait what the heck I wrote
I wrote a grammar saying I don't want
that to come by if I match it it
completes a it doesn't match it but when
I printed it just printed like there is
no tomorrow and doesn't care about the
fact it's not a correct expression what
the heck is going on well the fact is
that prota matches is one kind of Travis
all the trees that just happened to
match it but when you build it and you
pass it to this way expert you just
display whatever you give it okay it
doesn't magically do anything more okay
so beware so what we will be needing is
we will see that later is which say
actually I just don't want to match it I
just really want you to prevent the
construction of these three if it
doesn't match anything okay it goes out
to be there but yeah we can actually
take a tree and do whatever we want and
matching the three against the grammar
is basically a recursive descent of the
tree and match with the recursive
definition of the grammar until
something blue apps it just a tree
traversal same for display just three
traversal and three traversal doesn't
care about the fact your expression is
valid for a given grammar to just travel
the damn tree okay first rules okay so i
can actually say okay is it correct that
CeCe's in the shape of a grammar I think
it is so what we do we do next so next
we may want to do something with the
tree like evaluating it okay so we have
a very very similar way of describing a
trend earn a transformation of three
it's called transform so what what do
you want to do whenever you find the
terminal you want to value and whatever
operation get you actually want
natural semantics of the sea professor
murder on it if I do press I want to
glue the price between my values and if
I do times I want the ties between my
values and so on and so on and so on and
that's exactly what we wrote there it's
a balut in a more decent font so it uses
exact same system that for the grammar
for a simple reason that a grammar is
also transforms that happens to say yes
or no is valid it's the same thing but
what we will be doing is we will
associate with each tear each pattern of
sub expression an action so when I match
terminal of something please give me the
value of the terminal that was this
endoscope value means him is value
inside the terminal whenever you find
one and that's one of the shortcut that
actually is built by proto is otherwise
for everything else just cause default
behavior but before calling the default
behavior please call myself on whatever
sub expression you found so that once
this default evening's evaluate every
sub expression with evolved and then
apply the logical basic semantics of the
operator you found plus 2 plus x 2 x and
so on and so on so two lines there is
basically all those operator function
code we wrote in to all our expressions
in the pub before just say that and so
what does it bring us okay see
instructor but what I really want to
function well actually you good Bob evil
is basically a callable function object
so just make an instance of a van and
you call it on an expression just like
this okay make the e you call it on your
expression and this will recursively
applies a pattern-matching and do
whatever you asking him to do okay what
do you think will happen
if our if I add two different rules 14
terminal of anything and one for stamina
of fruit for example that for whatever
reason returns ten times of value okay
one trick is that the orders of the
rules in size or is important they
basically our match from the top to the
bottom so you have to be careful with
that okay so you probably want the most
specialized one under on the top and
going down the street exist so this
build forest cease your recursive
function code systems that will apply
whatever transform you want on yew tree
and again doesn't care about the fact
that you tree may be wrong just takes a
three right whatever be careful without
you so usually what you do is armed and
so you get an expression that come from
you don't know where and you try to see
with the static acid if it matches what
you think it should be and if it matches
then you apply to transform okay that's
one simple way to do so the magic behind
or and when is basically just you know
any reads from every elements providing
a jersey as a function carburettors that
do the operation or doing the types
checking for the grammar and so on and
tall but the interesting point is that a
grammar and the transform is basically
the same a transforming a grammar where
you basically add on each rose as
semantic actions whenever I match this
this is what I want to do in a very
straightforward way and I could actually
write the second evaluation scheme
matching different stuff and passing
them on to the same tree that's
basically what we wanted with the simple
systems I have a tree that is built by
Prado and I have a bunch of function
objects that we present arbitrary
operation on arbitrary trees and I can
take whichever I want into Z transforms
and the right to whichever three are one
it's completely correlated ok just
immediately kind of a grammar
that match something a single one gets
matched something else at the bunch of
transforms and you can call them all
together on the same tree one not a
problem ok so let's see if these things
worse those two sides how is doing
nothing but probably do something anyway
oh don't forget to tap tap it's probably
doing like I don't know which is that
for 699 ok and actually I could do this
well we'll be putting floats because if
not doesn't make any sense so it's
probably some amount yeah probably ok I
don't have to write anything else I know
so yeah we can do this ok oh yeah yeah
and and as I said every operation is
there right ok any operation so let's
say we are that ok and let's make a
terminal of STD array of I don't know
three floats something like this ok it
comes a funny parts let's play a game of
all many braces so I think that such
enough I 5890 ok I don't really want to
be narrowing anything so so that should
be that should be it what so what yeah I
mean aim at why I just saw it and so
that means that i could probably do this
because every operators as the default c
plus for semantic so i guess this was
I we end up with bracket 0 providers a
tree with subscribe between y &amp;amp; 0 and I
asked him to be a barricade with a
classical semantics which we've already
cooked what we call bracket on the other
line array and giving me I don't know
mini five and I needed to to something
that says should be walking okay so
that's live demo bear with me okay i
clicked thank you that should be walking
seven and and just so we will sure what
we are speaking about of course what
what is there but what was the type of
that we know it's for obviously an
expression cannot be anything yet if not
even without blow up already but just to
be sure and so I can win five minutes of
computation time so yeah and look okay i
will probably be make some kind of
effort because that's important do you
see this everybody yeah okay so it's
plus between the terminals that contains
two and the subscribed operator between
0 and this wonderful terminal of st5
raif and mmm te e which is basically is
a mangled name of STD array of three
floats okay ah yeah so so i did not
evaluate why of bracket 0 it be the tree
that say i would do a letter okay sounds
very important everything is lazy
everything from top to bottom yes a
question
yeah it would probably cause the basic
operator to come on your classes and if
it doesn't argue just call to come out
very top of the language and if you're
cool classes are also k sorry the
question was what if I make the terminal
of my crew glass okay what happens that
if he or Michael class class as over 80
plus x whatever if you just call it done
okay so let's see what let's see what
happen if i do y plus y for example
because we obviously doesn't have a
presser arrow on Acra and then we don't
tell you i just have to lose so i think
that would probably blow up if not i
will be disappointed so this probably
should not walk I oh yeah okay so when
it bro ops ii blow ups such as cool
things okay so yeah oh no I was I was I
was me no match for appeared to plus
between STD array of something and is
Thierry also so defaults the default are
transformed just say do whatever you
should be doing with your burritos I
don't care okay but that's that's a
shortcut okay we will go over and see
that actually you can do far more but
does it leave nothing more to that you
just okay due to whatever you need to do
okay there was another question oh so
the question is in the terminal
definition like line 19 you should i
could i use the underscore stuff and so
I can shove whatever I want inside no
you have to have a concrete types what's
a good wake up can be boost
one that's not an issue but now you
cannot just wave anyways whatever but
but look at the things that you have
this terminal or float thing from which
we extract these controlling type nine
nineteen ninety and obviously also watch
dr. and if you see that the same type
son's ear okay that's the same type
cannot be anything else I just did one
using boost terminal but that means what
it means that at a meter of something or
a plus of something something it's three
things it's it's a match pattern in the
grammar is the object representing the
expression as soon as I did current
current IB I did and it's all those its
own default transform plus of something
something put on the other side of a
when just to a plus on whatever it found
so it's three things so transform the
grammar the expression types okay and
everything is starting to a single rock
that and that's the kruky things with
booze Prado because sometimes you look
at the code and you are like what is an
egg is going on I just write three times
the same things with three-time
different meanings that's so one thing
you have to go over because if you think
about it is it's right it's normal so
trillion ition is a way to represent the
grammar I should match and it contains
your operation you should be doing when
you Travis it so I mean as a threesome
antics into the same block different
places makes some sense keyword is so so
what we should be doing next well I want
really want to do something else and
just calling the blue me over 80 from
the language so you can actually write a
custom transform ok so we are just
pushing everything to 11 now so let's
have a look at this one so same things
as beginning okay except I just change a
bit what ever is doing and I say that
when I match a terminal off whatever I
want to value
like before at the end if I didn't match
anything else just do whatever is an
angle should be doing no problem and you
got this monster in the middle which
says when I match plus between two
something okay what I want you to do is
doing this okay probably need to go back
there and what the heck is this thing it
actually reads like it should be doing I
want you to call the custom function on
the evolution of the left child enter a
variation of the right child and we okay
what does it look like it looks like a
function call right it's with round
stuff except cannot be a function call
there okay so buddy is basically a
function types who lower function types
so we use that to you know mimics the
fact that we want to call a function I
think I don't remember if it's we call
that round lambda you remember i have to
to the example so i want to call the
custom function of Z a variation of my
two sub expression okay so left and
right are actually chop cuts to the left
child the right child it's the same kind
of shorter than value of seminars and
you also have a charge 0 1 2 3 4 5 if
you want to get to the end child
directly okay so others it works boost
proto is trying to recognize this kind
of types function types inside
deconstruct it and check what's going on
and that's where are the things get
interesting it would take the written
types of the function time which is
custom there okay and it will look at it
and say is it a colorable object or not
if it's not what I we do is take this
type and call this constructor on it and
I will just be the new type a new value
sir but if the type is credible I will
just call its functional Mariners with
whatever is the evaluation of
what's inside so that's a massive
shortcut to say I want you to be the
function object i just happen to X
wanted two children from the my +
expression a very examines and feed it
to the custom function just a shortcut
for saying this so if Eric was there
probably tell you that if anything is
that booth photo is actually a dsl for
building dsl's don't like the kind of
you know syntactic sugar you want to put
into a dsl so it looks cool okay or I'll
give EDX depends so let's call customs
on the evaluation of my two sub
expression and always custom define well
I've look there so custom is a function
object so it's pretty surprised force 11
okay so beer with the good old result of
kind of time deductions okay ah we have
to flag it as callable by Prado that's
was the inheritance dozen in 14 and
that's retarded double you could have
returned something more complex okay and
you have these 40 more feet operators
function calls that secretary you and
returns something which is T plus two
times one in red because our three what
you want to do with your language when
you do plus it really really mean d + u
times android okay whatever and whenever
I mash a plus i will call that now and
what will be TN you TN you will be well
it will be whatever this part of the
definition of the transform is the
evaluation of the left side 40 and they
were action of the right side for you
and I could actually you know change all
of this as much as I own I could have
another custom operator for a functional
object that we put on top of custom and
so on and so on and so on you can act
with arbitrary large and complex
seemingly function call into this when
construct and proto just reconstruct it
upto zr2 the beginning so let's see how
much is X plus 3 plus x times 3 and does
this rose so it looks kruky it's
probably his okay ah but it gets the job
done yeah probably 550,000 600 something
so 2 times 3 63 plus two is five so 5
plus 6 is whatever we saw upstairs Oh X
plus 3 is not that it's probably two
plus three x 102 lat 600 and 600 plus
something and so on so but well we did
that we did this a variation of the sub
expression before passing them to our
custom but you are not obliged what
happened if i remove the evil before
left and right i would just pass the sub
expression to another function because
what i want to do is problem is maybe
taking those two sub expression and
generate the nozzle tree where they are
put somewhere else so we can actually
write transform is pro pro that say I'm
taking the arbitrary parts of you and
putting it into another place another
shape and I just send you back another
tree because that's what you need you so
we can use this to arbitrary the
constructor tree and we built it in
another way before passing into another
custom transform point them okay so you
can do whatever you want you're not
you're not forced to get the evaluation
of whatever can just take the parts to
construct them we shave them in another
way and so on and so on you have another
versions of every of those plus minus
and so on which leaving the nozzle
namespace which is proto functional and
you can use this if you want to say oh
whenever you match a plus B
you want you to generate the 3a minus B
and you just say when when plus a be
returned functional plus a function of
my newest a be you can just am so
shortcut to say I'm just putting up you
know the the sub three against one Jones
okay so we can match the grammar we can
do transform of this we have a pretty
much set of default we can write our own
function to transforming whatever but
the problem is what we endorsed here are
still what we call negatory the tree the
expression to you manipulate there is as
no frigging semantics it's just a tree
that happens to have audio burrito you
want and you can turn it into whatever
you want but for example if you wanted
to build one of those metrics based here
so where is my operative parents to get
to the IJ element of my matrixes or
where is my dot size where is the actual
semantics of the object I represent they
are not there so we have to add it so if
you don't do anything else what you have
is a very nice terms that build
arbitrary lazy tree and let you
manipulate the way you want but you
don't have any point where to put the
semantics in well except you up but not
yet so others it works when you want to
add semantic onza so we work basically
up to 11 I think we will be basically
apt to go to 12 okay so there is another
more complete example so I bring back
the evil stuff that it just evaluate the
expression the regular way I bring back
all those maps the grammar that match if
your type is correct the concepts that
product puts forward is to say the
following one we need a way to say i
have a naked tree that is been using
those set of rules and i want to give it
this kind of semantics by adding new
members to string member function and
the association of a root set for
building a tree and that says a rap
industry is what protocol a domain the
domain is something
say whenever you build an expression
this way I want it to be rapid with this
kind of semantics and whenever you call
an operator on this decorated tree what
the operator does is remove the
decorations builds a nikka tree and put
it back into the same rapper so you
carry on the fact that if you are for
example 2 matrix is coming from the
matrix domain and you add them you end
up with a tree of an addition between
two matrix of the matrix domain and you
could also have another domain code for
example the vector domain and the vector
domain has a slightly different
semantics and you know that when you do
a multiplication with an expression from
the matrix domain and the vector domain
the resulting expression well where
should it live in the vector domain
because matrix time vectors give you a
vector so we can have different domain
and we can actually order them with some
kind of relationships and we can decide
/ operators if I have a domain domain be
that comments what the domains that go
outside this is a way we can actually
sorry for that we can actually control
the composite semantics of stuff okay
because yeah logically this matrix times
vector doesn't have to live in the
matrix domain into it's a vector okay so
we have this strange notation so let's
make this forward information of expert
that we be our types with all the actual
semantics and we have this domain class
which is inheriting from boost proto
domain of boost proto generator of
expert EPA that's been what that means
that whenever you build an expression
from this domain I want you to generate
it by wrapping it into expert so you
will take the type of my nigga tree and
put it there okay but I want you to do
this if and only if the tree you pass me
is validated by this grammar
second parameters domain so if you write
trap okay using expert you'd want to buy
contrary to before and what do we do now
so we have this link between the world
set and wrapping okay you have the right
to go into this box only if you match
this kind of grammar so what do we do
just have to write the code for the box
so we write a code for expert is it okay
for the zoo yeah correct and what does
he do it either it's from boost phone
extends let's say I want you to extend
this kind of three types whenever its
rapid inside myself and I want you to
enforce the rule of domain okay and so
this give you a lot of boilerplate okay
so I'm just making a typedef because I
don't really want to write all this crap
everywhere so you basically need one
thing you need a constructor that takes
the naked tree and put it into your boss
it doesn't have to do much just pass it
to your show to your parent okay to
proto extent there is a bunch of macros
that control the fact that if you want
to have some special members ended by
proto so we want to use a sign with
proto so use this macro and I simplifies
your return type issues so I said we
always return to the ball and I have my
small operator parents same things like
before and what I do inside this is very
trivial I built I better never rate or
instance by using able and I just call
it on myself whenever you have an
expression of something in Prato its
behave as to something so you can pass
an exper of iced tea to a numerator and
the iterator will just rip the boxing
and the wrapping and just walk on the
naked tree sorry old transparent okay
doesn't have to right into the grammar
that you are rapid into something
then I met another type which is a bit
different I am tired of having to write
terminal of something dot type so I make
another class which I called viable and
I says that the variable is an
expression of a terminal of something
and whenever you pass me a value I would
just stir it into the value of the
terminal using this product of a dual
function there 48 and i will add my own
compression points which was the
operator the accident operator I'm
taking what I'm taking the next pair of
X and what do i do I evaluated using the
function carburetor and I saw the result
into my value dot and I written this now
what can I do i can write this kind of
thing i have a viable of em it's x is
equal to 2 and y and y is equal to X
plus X I'm X plus 3 let me print why
using the information of a writer okay
that's that's a bit okay ah three more
coming any okay so prototypes you build
neck three source negatory has to be put
into a box that give you your actual
language semantics your match which has
a size your your lazy string as as an
empty net or whatever but its its
revenge reverentially transparent proto
doesn't care whenever you pass the buck
surd expression sorry about it about
three to a match or to a transform it
will see through it and apply whatever
you need ok so we can't separate
everything we separate the three
construction with completely independent
we also treat reversals and we
absolutely semantics and everything is
independent and get tied together by
this notion of domain ok so that's a bit
more complicated than what we saw in the
first session where we just being
pulling function there and they're so
everything walked there we have this
level of
abstraction that we have to think about
this is my grammar II of my language
this is a men tip of my language
elements and this is the rules of
transformation that bring me something
from my expression in my languages to
some value in the c++ world or subtypes
okay so session is over I saw so after
the break I will dip into a more intense
example of further which is already
complete okay just to show you what kind
of cookie things we can do and we will
speak about all we can actually do that
be probably a better way and what's as a
limitation of steel having induce Prado
okay or we can probably find a way to
web them okay so see you after the break
if you still have any brain matter left</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>