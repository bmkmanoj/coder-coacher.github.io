<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2017: Matthew Avery “X-Macro: How to avoid repetition” | Coder Coacher - Coaching Coders</title><meta content="CppCon 2017: Matthew Avery “X-Macro: How to avoid repetition” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2017: Matthew Avery “X-Macro: How to avoid repetition”</b></h2><h5 class="post__date">2017-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hXZrGh9kCVs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">My name is Matt Avery and I work
on the security team at Akamai,
and it's my first time here.
Alright? You're here.
Yep, alright so X-Macros,
how to avoid repetition.
Initially, it was going
to be X-Macro, X is going
to give it to you, but
I couldn't find a way
to integrate the DMX song so...
Alright, so I'm just going to start
with a motivating example on
why you'd want to use X-Macros.
So let's say you have
an enum and you want to print out
for debugging or for
logging purposes the string.
Well if you tried just writing
this onto a standard out,
you're just going to get a number, right?
Because enum are its, so in this case,
you're going to get zero.
So, what do you do?
Well, you're going to have to write
a function to do that for you.
So, typically you'll have a switch
with each element in enum,
and you'll return a string for it.
So, now you can kind of wrap that enum,
call the function, and
it will print the string.
The problem is that you can't forget
to update your string conversion function
when you update enum list.
So, we know it's really hard
to not forget things, right?
Like, we can say don't
forget to release your locks,
don't forget to free memory,
or don't forget your
keys, and that's great,
but it's really hard to do.
So, you know, thanks for std::lock_guard,
thanks for constructors
and destructors for RAII,
and I just don't know wherever
I lose my keys where I put them.
So, X-macros is a
solution to this problem.
So, you'll need to do three
things for this example.
The first thing that you want
to do is you want to define
a list of the states.
So here I have my three states,
connected, disconnected, and error.
Cool, and so its wrapped with this X,
hence the name X-macro.
So why do we need to wrap that enum in X?
Well, let's see how we would
implement the enum with the X-macro.
So, you want to declare and define
your enum by implementing the X-macro.
So here's the definition of
the X-macro for the enum.
It looks kind of weird,
just a little quirky,
that's how it is.
And, that's your definition of the enum.
Basically, what the
pre-processor is doing here is,
it's going to expand that to the list,
so you're going to get a bunch of X's.
And, since you defined X, it's
going to expand that again.
And, you get your lovely
enum for yourself to use.
Now, the next thing you want to do is
reuse the X-macro, reuse the list,
but this time you use it for inside
your string conversion function.
So here I'm defining an X-macro
that will expand to case
statements in my switch.
And, now, that's it,
that's all you have to do.
So, if you add a new element,
say you're adding the state connecting,
between connected and disconnected,
you just update your X state
list, and it will update
both the string conversion
function and your enum.
So, you can do a little
bit more advanced things.
You can have multiple
arguments, you can go crazy.
I'm not going to really
explain what this is doing,
you can just go on
Github and check it out.
But, I just have one disclaimer.
Initially, it was going to be X-macros,
use them judiciously, but
I'm just going to say it
in general, macros, use them judiciously.
There you go, thanks.</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>