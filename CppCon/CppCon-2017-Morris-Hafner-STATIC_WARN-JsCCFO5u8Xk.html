<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2017: Morris Hafner “STATIC_WARN” | Coder Coacher - Coaching Coders</title><meta content="CppCon 2017: Morris Hafner “STATIC_WARN” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2017: Morris Hafner “STATIC_WARN”</b></h2><h5 class="post__date">2017-10-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JsCCFO5u8Xk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Yeah, all right.
So I'm going to talk about static_warn.
So, assume, the following problem,
let's assume you've created a
lock-free queue, for example,
and you have probably made --
- [Audience Member]
Microphone, microphone.
Yeah, you have probably
made a structure-like entry,
which contains two 64-bit
integers, on a 64-bit machine.
When then you have decided
to include a static_assert,
to make sure that your
queue is really lock-free
and that code compiles on my frame.
But, for example, it does not
for some reason on my TTC.
Because the static assertion paneled
and maybe you have decided that you want
to share this code with
some older machine.
So maybe you've been too
lazy to back part this code.
- [Audience Member] Speak
into the microphone.
Yeah, maybe you've been too
lazy to back part your code.
So I have come up with this.
So, a simple template with
anti-struct and a bool.
And then I specialize the
bool for the alt case.
Over there.
And the false case, it's
not just deprecated.
And then you, then I have
just created small macros
called static_warn, that just instantiates
a temporary warn_if and immediately
discards it in expression.
And, yeah, this works.
You can see a warning emitted there.
It's a bit noisy.
But let's, look at TTC,
which prints nothing.
And the solution for that problem is
you have two of these parentheses.
(audience laughing)
Yeah, so, let's try this out on MSBC.
Which prints, again, nothing.
And I'm already using parentheses.
And the answer for that problem is.
(computer keys clicking)
Here.
You need to declare default
contractor for some reason.
So now this works, but now
that's only an expression,
so the problem is, you
can't use that static_warn,
for example, inside a struct.
And that's a solution for that problem.
Yeah, so, we use the CP
processor, do a little bit more,
and declare anonymous variables.
So we concat two tokens and then we,
then I concat the counter with the line.
And then I concat that with a warn.
And then I'm instantiating
an anonymous variable
of type warn_if with hitting condition.
And then I can, yeah, and
then I can just use it
and the warning shows up down there.
And you can see the warning, even,
a little bit more clean on GCC.
And even on MSBC, you can see now
that there's a warning
emitted at the right place.
So in the previous version,
you couldn't see that,
where the warning was emitted,
just that a warning was emitted.
And now it can see where was
the variable instantiated.
Yeah, so, if you want the snippet,
you can grab it over that QR code.
But I have a word of
caution: don't use that
as a replacement for
static_assert, obviously.
If you're still using static_assert
to make sure your code doesn't break,
then use static_assert
and not static_warn.
That's mostly just for
code that stays correct
even if the warning is
alerted to false or true.
So, yeah, that's it.
(audience applauding)</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>