<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2014: Lightning Talks - Julian Smith &quot;Introduction to Undodb&quot; | Coder Coacher - Coaching Coders</title><meta content="CppCon 2014: Lightning Talks - Julian Smith &quot;Introduction to Undodb&quot; - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CppCon 2014: Lightning Talks - Julian Smith &quot;Introduction to Undodb&quot;</b></h2><h5 class="post__date">2014-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/j-wT3DdSvIw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so tonight we have our first eight
lightning talkers and it's kind of a
surprise you'll find out as each person
comes up what they want to talk about so
stick around because there's all kinds
of different diverse best thing about
this whole week is everything's so
different so first we have Julian Smith
or are you Julian what's here
there you go come on up Julian I like
this author of an unsuccessful proposal
to add multi methods to C++ ten years
ago and still carries the scars from
writing a crude C++ parser for the
example implementation but now he's
co-founded undo software and he works on
record and replay debugging technology
so you have 15 minutes on this clock all
right knock them out that looks that
Mike is live for you thank you
yeah great I can't see it on that screen
okay
odd isn't it great thank you everybody
so yes I work for undie software as well
as making lanyards we write a reversible
debugger so I'll just give you a quick
demo of what a reversible debugger looks
like so here's a very simple program
thank you
so we're gonna run it and we'll stop at
beginning a mane here we are thinking of
mind how we could step forwards in the
normal way and you can see these values
here changing as we as we step forward
and because it's a reversible debugger
we can go backwards so I can click this
button here and we come back and you'll
notice these values taking restoring
back to their original values and in
particular if you look at said that
contains a sort of a random value when
the program started off and that's being
restored so you can go back as forwards
as much as you like and that's a
reversal debugger so we've been going
sort of maybe 9 or 10 years it was
founded I mean Greg law and we thought
about what you've got 10 people now in
Cambridge and me in Oxford in the UK and
various customers as you can see on that
slide so the first will you buggers well
I'll see you they let you step backwards
as well as forwards
I guess anybody's programmed a compiled
language will have used a debugger at
some point and you've had the problem
way something goes wrong you putting the
debugger you stop somewhere you single
set forward and ah you single step too
far you want to go back again and go
back into a function call debugging is
really frustrating so with the reversal
debugger all those problems go away
because you got a bit more do you want
you just go back and you can go back as
far as many times as you like and home
in homing
so I'm going to give a couple of very
very simple examples today but actually
our software is used on very compute
complicated software projects with
massive programs with loads of memory
lots of shared memory all sorts of
heavyweight sort of programming and one
thing should be clear it's for compiled
code on Linux doesn't work on Mac OS or
Windows there's an interesting quote
which we particularly like from
Kernighan and pike which is about
niversity bugging which is - it's all
about solving a bug is like solving a
murder mystery you've got the end state
you've got the dead body you don't know
what happened before before before the
body was killed with debugging it's the
same thing you've got the end state you
got a core file or perhaps you in the
debugger you've got the stage of the
program right now you don't know what
happened in the past so under DP gives
you a rewind button and we think it's
like CCTV for your code so I'm just
going to give you a slightly more
complicated example just to give you an
idea of how reverse debugging can
simplify life so we've got a base toy
program got a cache
it's the cache of the square roots of
8-bit values and there's a hundred
entries in the cache we've got a
function but enough to forgive me for
going a bit quickly here cos only got 15
minutes a cache calculate function which
given a value he looks in the look seed
up in the cache if it's there it turns
it otherwise it populates a couple of
adjacent entries in the cache and return
and then returns a square root so that's
a obvious simple toy example but it's
sort of character that we all use in
programs that would cash values in some
sort of data structure in memory and
this is not deliberate error obviously
normally we don't have deliberate errors
but it but errors and this sort of cache
sort of data structure are not uncommon
and indeed with this program we'll be
running a test on one for everyone today
until until it either assert fails or
carries on forever
and if I run it
here we go we've hit that cert so
basically we've called Kat calculate is
returning value of square root of zero
but actually you should have been
fifteen we're trying to cut the Catholic
square root of two by five in integer
arithmetic so calculated on the wrong
thing so what we can do with reverse
debugger we set a breakpoint there we're
deep inside a certain moment we can go
back to that break point and then go
reverse step upwards and at this point
we're going to reverse step into cached
calculator here we go
at the end of cache calculate we're
going to go back and see where see
what's happened okay so it looks like
cash calculators found the value in the
cash next we're turning from the cash so
what's the value 255 an eye is ninety
and because I've run east demo before I
already have it preset up so cash
element ninety says if that the square
root of 255 is zero well that's clearly
wrong so what do we do well normally
uribe stock because that happened in the
past that cash that element in the cash
was corrupted we don't know when we
don't know what code did it but with the
reverse debugger we got a rather neat
little trick we're going to set a watch
point on cash element ninety value and
add that and then we're going to run
backwards
I'm gonna run backwards to the most the
time when that cash mo was modified so
reverse continue there you go and here
we are back in cash calculate in the
past and well let's see what's going on
aha well value 2 is minus 1 so we know
something's gone wrong one thing you can
do if you want to you can actually look
at cash out of an 19 getting corrupted
at the moment it has 40 + 6 which is in
an intuitive mythity keys okay if we
step forwards you can see it getting
corrupted it now contains 255 and 0 okay
so well you some of you might have
spotted what's gone wrong but just for
fun we're gonna try and find out why is
about you two got value minus one so
we'll set another watch point on value 2
and we'll run backwards and not
surprisingly it's in this loop here so
what's happened is Valley value itself
is 0 we're looping from value minus 1 so
this bug is the loop he's trying to find
the negative square root of a negative
number so square root has returned some
ridiculous value and it's corrupting the
cash so hopefully you'll be able to see
that you know this sort of technology is
kind of useful in this sort of problem
but more generally this sort of
especially back as watch points are just
so powerful
so I guess one of the key things about
undo TV is that we've worked very hard
on performance obviously in the toy
programs I've just been showing it
doesn't really mean much but actually
even with big programs we're pretty good
at speed so we don't store the result of
every single instruction because that
would be gigabytes of data per second so
instead we do is we we know the
computers generally run
deterministically forwards so we make
snapshots and then to go backwards we
actually go back to snapshot and run
forwards replaying any non-deterministic
input so if your program when it ran the
first time read some data from a socket
we store that data so that when we
replay we can replicate what the
original read did and we do that for all
system calls because the system calls
can modify memory in all sorts of
different ways and we basically we we
know about every single system called in
Linux and we store and replay what they
all do we also have to deal with threats
which is and signals and shared memory
all those things like that
and as an indication of the speed
there's a GDP has a sort of thing called
process record which is a very simple
reverse debugging system but it isn't
really comparable as you can see from
these timings so this is running gzip on
a 16 megabyte file as you can see with
undo DB it's about half the speed and it
uses some extra memory and with gdb
you've got it run takes all day and it
takes gigabytes tens of gigabytes of
memory so if you have to plug in G Z T
to be processed record unfortunately
it's just not helpful with on GDP you
can actually run it in the debugger
running backwards and figure out what's
gone wrong really easily
I won't bore you with this I what I see
you maybe I will
uh-huh the thing about debugging is we
all think we don't need to do it and we
all tell ourselves with pretty good at
writing code that does mouth bugs I
certainly know I write code lots of bugs
the demo I gave earlier along earlier on
Greg asked me to write the code because
he thought I was good at lighting bugs I
think so yeah we all like bugs and it
takes enormous much at that time it
takes enormous amounts of money in our
wages it affects the reputation of the
companies we work for in in ways we
don't really want to think about so any
any improvement in how you can fix bugs
and address the problems is is really
really important so to that end a
personal debug I think could make quite
a difference to many many people
so I'll just sort of finish up now so we
work on unmodified Linux we don't need
any fentanyl patches we don't need any
recompilation we only do the reverse and
the reverse of the cauldron be play
engine we don't do the simple lookup and
things we leave that to another debugger
in the example you were seeing that was
um as gdb with a k' gdb front end but we
work with the total of you debug goes
where the way the replay engine in total
view and in armes ds5 debugging suite so
we don't get involved in the symbols so
you don't need to recompile anything and
as a slide says we work on thread the
signal shared memory all that sort of
thing so as well as effect the first
example of what we're we good at is
effects manifesting themselves a long
time after above that's that's sort of
the cash example it's also a useful when
you get a problem that only occurs very
occasionally if a problem that occurs
every say 1,000 times you run the
program it's very difficult debug to
debug using a normal debugger because
you've done it a thousand times you
eventually catch with me debugger then
you run it you think oh I meant to set a
breakpoint at that function and they go
to run it another thousand times to kind
of catch the bug again with a reversible
debugger you catch it once and you're
done you can go
for as much as you like also you can
investigate unfamiliar code bases
figuring out who called this why do they
call it and go backwards and forwards
really really really useful and aside
from that as you saw we had watch points
you can attach to existing processes and
it's a it's a basically replace from the
command-line replacement for TTP so you
can use it in Eclipse or Emacs or
whatever other debugging environment you
would like to use and then this finally
we have a new product which we're
getting close to releasing now called
the flight recorder where you link our
engine into your code ship it to a
customer it runs on the customer site
and at the customers control they can
tell it to start recording then if it
goes wrong they can save the recording
to a file they ship the file back to you
I'm quite big you might need a few DVDs
and then you can use reversible
debugging on that file to figure out
what happened at the customer site so
you don't have to be you don't have to
reproduce bugs you don't have to depend
on customers giving you a detailed but
example of how to reproduce what they
did to cause a problem
so that's our technology and it's it's
quite exciting I hope you found it
interesting
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>