<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2017: Roland Bock “Making optional optional” | Coder Coacher - Coaching Coders</title><meta content="CppCon 2017: Roland Bock “Making optional optional” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2017: Roland Bock “Making optional optional”</b></h2><h5 class="post__date">2017-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QB0oY5f6q-E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">cool so this is about me feeling stupid
so please bear with me so how do you
construct an optional if you if you look
into the documentation at I don't know
cpp reference for instance or you
construct an optional D for constructed
then if you have a value then you assign
this value to the optional and then you
return it because all the examples that
you see are about returning optionals
right I have a slightly different
situation I want people to to pass
values to my function right so my test
function in this case here that's
expecting an optional so how does the
user provide that optional to me well
the user could do it in the same way as
document and always so D for construct
the optional then in this case I don't
know take take a dollar from the map if
that value is available all right and
then pass that to me that is what's
documented and if that is the way the
canonical way to do it then I'm not
using optional all right I don't like
because well it's building into the
outer context that's awful so how can I
do this in a different way so there is a
function called make optional that
sounds good that sounds promising but
basically what it does is it's
forwarding all the arguments that you
give it to the to the constructor so
well you have to choose a compile time
whether you construct it with a value or
without a value so it's not really
optional all right this should be called
make mandatory I think
so if that's not doing what I want then
well maybe I write my own function right
make really optional it gets a condition
and some factory function and then we
can hide all the ugliness in this
function right so we constructed the
default default constructor for optional
then if the condition is true then we
call the factory function we turn the
thing done and when we call this or it
looks better than before so make really
optional then the condition then some
lambda function that because we don't
want to repeat ourselves captures
everything by reference and then this
this will extract the data if necessary
all right but it's got my assess that
capturing everything by reference is bad
so let's not do that
and then I thought well what we really
want to do is we want to based on a
condition
cause either an optional with a value or
without a value right so that sounds
like a good job for a ternary operator
okay and the good case well we just
passed the optional with a value in the
bad case we passed one with without a
value but I certainly don't want to
write stood optional angled brackets
type because types can be very long like
especially in my library types can be
big right you don't want to write them
so I don't know you should learn to
something different and so I I created a
type say okay not not is something that
can be converted implicitly to any
optional okay so we can do something
like this we can write okay ternary
operator if the condition is true then
we that we passed the the optional with
the value otherwise not which will be
automatically converted to the optional
that we want to have sure so that works
and then I said I would imagine that
this is a real facepalm situation
because I there is something that I saw
in the documentation reference first
knowledge right none of this done for
this case I think
and it can be used to to construct an
optional right so it's not conversion
but its construction it does exactly the
same that I did with my mod thing so
actually I think that this is the the
canonical way to create an optional and
I think that's the documentation which
does this default initialization and and
then then if there isn't if there isn't
value then assign it and then pass it
that's not good that's ugly this should
be the the good one so if you agree then
I don't know update the documentation
update your code make it nicer thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>