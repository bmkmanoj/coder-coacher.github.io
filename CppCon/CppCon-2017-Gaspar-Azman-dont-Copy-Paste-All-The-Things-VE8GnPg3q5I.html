<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2017: Gaspar Azman “(don't) Copy Paste All The Things” | Coder Coacher - Coaching Coders</title><meta content="CppCon 2017: Gaspar Azman “(don't) Copy Paste All The Things” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2017: Gaspar Azman “(don't) Copy Paste All The Things”</b></h2><h5 class="post__date">2017-10-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VE8GnPg3q5I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm Gaspar.
I'm your friendly
neighborhood pedant today
because yesterday, we saw this.
With the advice that we
should copy and paste this
into every class ever
because it's what you want,
it's what plants crave,
and it has electrolytes.
And this was me.
(Gaspar and audience laughs)
With a few changes, this is actually fine,
that is, if we add, well, please pretend
that the move constructor is non-trival.
So if we add these noexcepts,
which are actually necessary,
and those things which strictly are not
but will save your life,
and therefore, this is correct,
this is relatively safe to
copy-paste because it will break
if you do something,
wrong but then, of course,
we all know people who'll
just delete the static_assert.
Because without noexcept,
exceptions do happen.
So the fun case number one
is the throwing destructor, of course.
Now don't do this, but
sometimes you gotta do this.
So this is our unchanged
suggested move constructor,
and, sorry, obviously this
is not what you would do,
but somewhere along the line,
this might end up happening,
so this is for obviousness sake.
So our test driver here is just this main,
and we wanna catch this exception
'cause we know that it's
gonna happen, right,
and that is, in fact, what happens.
We call operator move assign,
and that calls the destructor,
and that throws, and
that unwinds the stack,
and wait, that throws, and
that's what actually happens,
which means we didn't
actually catch the exception
that we meant to catch,
and of course this would
never pass code review, right?
So, of course, the next fun case is
exception on construction, which
is slightly less contrived.
Let's say we have this pointer
with a never_empty guarantee.
This happens because
we do construct it
in every constructor, but please pretend
that's in the initializer list below
because I just needed to insert that throw
'cause bad_allocs do
happen but not always,
you know, in the test.
We even have a no_except destructor,
and we clean up like good citizen.
What could possibly go wrong here,
and we have this copy-pasted
move constructor.
Well, thankfully, we were
lucky and used AddressSanitizer
because by the same mechanism as before
except a few instructions later,
we end up double freeing,
which silently corrupts the heap
and then makes your cat pregnant.
(audience laughs)
So don't copy-paste,
please.</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>