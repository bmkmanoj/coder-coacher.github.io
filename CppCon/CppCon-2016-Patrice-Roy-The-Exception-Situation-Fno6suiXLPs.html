<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2016: Patrice Roy “The Exception Situation&quot; | Coder Coacher - Coaching Coders</title><meta content="CppCon 2016: Patrice Roy “The Exception Situation&quot; - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2016: Patrice Roy “The Exception Situation&quot;</b></h2><h5 class="post__date">2016-10-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Fno6suiXLPs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome welcome to this big and/or
easy room with me I might be making
noise with my my voice from time to time
that's out of habit my name is Betty
Suarez not my first name that's my last
name
and I work at ginger such a book and at
Kadesh in Yahoo a college where I come
from around Montreal around the Montreal
area Who am I now some of you might know
me already those who don't I have a few
kills and a few animals I used to do
flights a fight simulator software
before I started teaching but that was a
while ago because I've been teaching for
about 18 years now and what else yeah I
work a lot with the games people which
led me to this talk to be honest because
the games depaul they hear it exceptions
with a passion some of them at least and
some of them and they're not alone
some of you IRA gets in the room to do
that too I don't hate exceptions as
you'll see but I can understand the
concerns so we have a strange situation
C++ where we kind of depend on this
mechanism that is both very useful and
lacks love it needs more love these days
so what am i planning to do today with
you well since I'm involved with LG 14
where we're studying alternatives to
exceptions for those who don't like them
and since I'm working also at the ISO
C++ standards committee where we we care
about that thing and since I'm also
working at the WG 23 ISO group which is
interested in security and robust
software well I'm concerned by all this
so the cost of exceptions the reasons
why we use them don't the reasons what
we understand or not about it so this is
not a pro or con exception talk I'm
going to try to see how it works what it
does what it doesn't and what are the
alternatives what are the costs in terms
of speed but also in terms of because I
have numbers but I really felt have the
time to show them I make them available
to you guys I in terms of programming
effort also and maybe if I have the time
a few a few dirty tricks because
exceptions are funny sometimes if you're
a creative person and
and there might be things I show you
that you won't want to bring back to
your office which is okay you'll keep
them with you as in here so when I wrote
this proposal for a talk this is
essentially what I wrote so if you read
that that's why you're here right now so
this says exceptions are part of C++
right now I don't think they're going
away I really doubt it they might change
they might change we might have quality
of implementation issues right now they
might not be fast enough for some
purposes there are segments of the
community that don't long why I want it
but this is that going away we have to
find ways to make it work better for
these we have to work on the interface
between the exception aware exception
blind code so there's words go we're
going on and it's g14 is part of the
effort then exceptions lets you focus on
the meaningful they take the effort
involved with error handling away from
the core of your code we're
concentrating on the real stuff and
bring it to a location where you can
actually manage it and think about it
separately arise they tend to pollute
the code so that's in itself something
interesting it helps you program reason
and debug and they're not meant to occur
very often in they're meant to be
exceptional that's the reason for their
name if they occur often you're not
using the right and running mechanism
there are others okay so the ID we die
behind that thing is that when you go to
the tribe lock it's expected to be
relatively fast it might be faster it
may be it should and when you link to
the cache block you kind of assume it's
going to be slow but you don't mind
because it's not supposed to happen and
where it happens well you have things to
do and some people think when you're
using exceptions you should try and
catch in fact you rarely do you should
that's the whole point you shouldn't
care about it unless you really have
something to do I'll try to another
examples of that later on today that's
my my goal at least so what you could
see wiki what you can see here is
essentially essentially what I just said
there are there are concerns there
people don't like their people look like
exceptions because they bring an
alternative control path to your code
and they think it makes the code more
difficult
to reason about I wouldn't go that far I
don't think that's true but I think that
there's some education to be done about
that and it's not being done so there's
an effort in terms of the explaining to
people how to handle that thing that has
to be done that it's done the books but
some people do not read them so it's not
for exceptions today it's not against
exceptions III use them I'm honest I
understand the needs of those who don't
it's the matter of person of perspective
knowing what the alternatives are and
what it means for you so here's where we
go this is the basic example I use when
I teach exceptions myself to those who
have not programmed much so it's a very
naive example but I think it shows well
what you have to do if you don't use
them and what you what are the options
the example is naive but the problem
isn't so it's a matter of integral
division where if you divide by 0 of
course the world is going to collapse
into a black hole and you will disappear
along with your family as already knows
the basic signature is what you have
there's at the basic interface which is
much more deep because least I at least
I gave a tremendous talk about that
yesterday very very insightful this is
very nice and you expect to pass a
numerator and a denominator and get the
quotient as output ok it's that simple
so I am calling that the natural
interface but it's like a pun I know
that the basic interface something much
more complex and and you you you of
course you have to wonder if you pass
something wrong to that function what
will happen as I said the black hole
will occur and you will die but past
that when you expect to have something
more insightful to do such cases because
dying well might not be your first
option you could say so precognition
I think it's unbreak Kaminsky and
although if a browser's name properly
had a few texts on the internet a few
years ago stating that we when you write
the precondition if people break it it's
their damn fault they should have
checked before it's their effort
contracts you could help there's a
number of things you can tell from the
outside but if you're saying it's a
precondition and somebody passes 0
anyway well get with the deserve now for
some people that's not satisfying but
it's
a reasonable approach somebody who takes
that stance we have to say that it's a
valid way of dealing with a thing for
some domains at least this is the wrong
way to do things but but it's the one
you see a lot especially in other
programming languages where they are
taught that when you catch an exception
which you show is you print the stack
trace and then you leave and you let the
program in an incorrect state and
continues running with from values so
hiding exceptions is not good and
letting the problem continue it's not
good either because in this case you're
screening are something Bad's going on
you know and then you still die because
you haven't reactor which is pointless
three but but to be honest I work with
many companies I do I teach with
professionals students undergrads grads
and this is what I see most which are if
I seem to be honest but but I do
recognize that teaching hair and Link
practices is not being done and if it is
it's not being done right and I haven't
seen in my life a real solid course on
that topic which I should probably put
them yeah there's other solutions you
could actually crash voluntarily and
some people do that the games of all
that's probably what they would like to
do they prefer if something bad happens
to crash recover and go ahead because
they don't really care that they're
going to kill anybody if something fails
they're going to lose customers
something goes bad so what they want is
a quick crash say I'm sorry and we start
so terminates fare assert is probably
fair especially when you're debugging
your code because otherwise the you
might be in trouble
abort terminate exists whatever so
something that says something went
really wrong and let's quit it let's
hope it doesn't ship as such but
somebody's whose application domain
allows this could make this into a valid
way of treating the problem it's not
treating a problem but at least the
program is not continuing with wrong
data this is another one it's a bit
radical you die there's an a certain you
die when up
mmm and at least you have a message
outputting I guess so it's a right way
to do things and from the outside well
the interface is respected and you're
cutting the function you have nothing
special to do and normally it works and
if it doesn't work while you're dead
would you accept that but that's ok as
long as it's something you accept it's
part of your mental contract it's ok
sir so people do that III can't find
fault with it as long as their domain is
not subdomain cars or airplanes this is
another way to do it it's very C ish but
it's not invalid we need lots of API is
do that or things to that effect meaning
that if you have an API that users see
like stuff come for example or others
you you can throw exceptions so you're
going to add arguments either as return
value simulated because you're going to
return status codes or you're going to
put a status code as an argument it's
equivalent so this is that it you see
that it works I mean you do your test
you return some arbitrary value in this
case because you don't really care
because people should be checking the
status before doing anything meaningful
fair ok as long as you check because the
problem in this case is they might not
but no-go works for like this it returns
stuff that you can ignore it works see
works like this it's been working for a
long while so it's not bad it's ugly in
terms of style the problem is you have
to change your interface and make it
look like something else than what it is
now you're adding an argument that has
no bearing on the semantics what you're
trying to convey so you're stuck with
something that is awkward it's not wrong
it works but you feel the really when
you do that then you need to go take a
shower it's true it's true but it does
work it has been proven like to work in
many cases I mean we have operating
systems that rely on those techniques
and that work that's ok and the other
way to do this is to return the the
status code I use the bull in this case
but to release more complex and decimal
new or whatever and you get your return
value as an argument
what come does it uses a pointer because
it's see what is the same thing so if
you look at this
well you again as a valid program where
you check the result from your function
and should the result be okay and then
you take the argument otherwise you know
the argument not to be making sense
anyway you're still supposed to do that
so this programmer discipline gives ugly
code but you can say it doesn't work
it's a valid approach and people who
don't like exceptions you can do that
and they're gonna write more client code
sorry that's what's going on with these
you're going to write bar code you're
going to do validation all over the
place but doesn't mean you're off work
and is that it this is cool - I mean
this is essentially wet weather go does
not its language supported but it's okay
I mean the returning to values could
return there one of them is the fact
that network or not and the other one is
the result it's clean the interface is
OK by the way you look at the interface
you pass the arguments you expect and
you get the result with some additional
information it doesn't cost much really
the reason it doesn't cost much with
respect what you would do normally and
there cause actually quite cute I mean
you take it like this you check the
first part which is your result say and
if it's okay then you take your the the
second one it's actually more beautiful
I think more pretty than the latter two
don't know what you think but it seems
better
it looks better to me at least more
functional maybe it preserves the
arguments to their natural state natural
being what we expect for them to be and
this is c plus plus seventeen code which
is actually pretty cool too I mean you
can D structure your return statement
into two variables that are actually
located within your if statement this is
where they live did I after that so you
get both the ok state and the result
state from a single return they are
decomposing two variables and then you
can check one of them because right now
you can do that with c++ 17 that looks
like go so those would like go
i-i'll do it file fault with this it
really looks like what they're used to
and they find that to be nice so why not
you can do that
get yours nothing wrong with that so
okay so far and if you say I want that
this is a good teacher you're right
schoolteachers or C++ 17 we have
compiler writers in the room we love
them when we hope for them to do a good
job I see them this is an eruption you
can return an optional we're going to
have an STD optional in the language
like any time now maybe I'm guessing
some compiler some libraries already app
that so optional is in a variable that's
either either has something or doesn't
it's testable as such I think I use the
right syntax because my compare isn't
supported yet but it essentially works
like this if you're if you cannot do a
job you return something it is
recognizably false in this case it's the
default optional it's wrong otherwise
return an optional that contains
something why not and then if you look
at the result it actually looks good and
you take your variable you test it and
if the test succeeds you check the value
it's a dual interface within a single
object it's pretty cute it works yeah
there's many ways to do things without
exceptions you don't care about them and
they're all essentially equivalent in
terms of costs you could do this suite
to with is equal to 17 because you can
make sure that your optional variable
only lives in the scope of the if as
long as if you want to keep the result
afterwards you let it out somehow but if
you want to encapsulate your tests in
your if statement can do that now cool
okay so this is the persuasive and Tina
actually I actually hope for that these
features are very nice you can do it
with an expected expected it's kind of
an optional extended but that there's no
standard accepted in sequence or 17
there's a proposal on table on the table
the idea is the value or something else
I've got I'd that the color chose so you
can have an error code you can have many
things so the color is essentially this
is like an optional where you can have
something else on a boo it's called that
way so it's a generalizations pretty
cute so in this case and using a an
empty class as return type should a
problem occur
it's a divided by 0 kind of thing and
otherwise I have the result and you can
do something like that too if you want
yeah it's assuming that the result is
testable which is not the case in this
case but it looks like optional code and
something like this suppose there's a
tweak missing for the beaudion state not
much and you can throw it's crazy you
can actually use this exception and if
there's a problem you use no problem and
now what do you throw is because you
can't manage a problem you don't know
what the context is
you can display something where you
display it the graphical display is that
something made with text it is the word
falling apart
is it a spaceship falling down so you
don't know so because of that you need
to take some action and your action is
to signal the problem you can't process
it you can't go forward you don't have
the information to do a correct job and
you don't have the information to
actually do something about it
the other thing you can do is say yeah
so you don't cover up your code you keep
it safe you keep it okay and you throw
it when I'm giving a class or actually
throwing things at people that works and
then they take it and they throw it back
you know as a school because the ping
pong thing is essentially what's going
on for real at some point it ends up in
somebody's ends but it doesn't have to
you don't process it I know what happens
if you throw something and nobody
catches you die but that's right that's
what you some people want to do anyway
if you don't care this is perfect if you
don't care about managing the problem
well you have nothing to do what you
want to do is crash loudly and you want
to debug your code fix it and ship it
without bugs so that's actually good
behavior you're not supposed to swallow
the exceptions you're supposed to either
do something about them or crash and fix
the bug so that it doesn't happen again
so that's the correct thing to do if you
don't catch an exception anywhere that's
been thrown somewhere in your program
and your compiler notices it the
compiler can tell Terminix but that's
okay we expect that so far so good ok so
this is actually cute we have the normal
code we do nothing special it's the
original interface it's the correct
behavior it's efficiently it's
essentially as if someone was broking
the precondition condition and I
in some cases which is expected and
there's no try and there's no catch
which which is one of the point here so
many people hate that because say I'm
going to clutter my code the tries and
catches know you won't know you won't
you won't do that you're going to do
that if you have something to do about
it what would I do here apart from
saying oh them okay - I might try some
user input again and again and again
maybe that's what I really want to do
otherwise you know okay so first people
festive and think of the cute there
because you can actually make sure that
your variables live inside your AF scope
that's cute it's just because I I'm
really looking forward to suppose 470
okay so far so in in most cases there's
no point catching
try blacks are fast catch blocks are
slow but you have to do something about
it if you have nothing to you don't do
it and and if you catch you not
necessary you have to handle the
exception but sometimes what's going on
is you cut the problem not because you
want to manage it because you're
responsible for something you have to
clean up
you are gated some resources that will
not be destroyed that we wrote the code
because you're in a constructor
somewhere and Co secure hasn't completed
so the destructor will pass or something
so you have to do something you have to
close a file you have to whatever rei
helps of course in these cases but
should you be doing some ramen and
memory management sometimes well you
want to catch just just for a little
amount of time because you want to do
some cleaning up repairing the things
you've broken and then you're there to
go go as is you don't hide it say I
catch something and I throw a whatever
nano you you let it get out the way you
got it because you haven't finished it
so you want the ones will actually be
able to do something about it do you
know what occurred if it's an SQL
exception of some kind let it be
it's rather memory you better know about
this question
well if you do that you're going to I'd
what occurred so yeah well if this is
your use case there's always the use
case for everything we're in C++ there's
no feature that has no use be honest but
it would mean my my default reaction
because if you if there's been a
security problem somewhere and you're
returning something of a higher level
and there's no way to know the details
of the security problem you're going to
have trouble managing it okay in that
sense but that would be an interesting
case in these so the my friend here was
saying if the lower level thing hides
the details because you got to divide by
zero but you don't know why and at some
higher level in your management of the
problem you're catching that the reason
why you're do you have a divide by zero
is that there's an overall security
problem should you raise a security
problem yeah you should now in general
you want it you want to let it filter
but to be honest there is always a
reason for everything in C++ so you
always use your mind a guideline is not
a replacement for thinking thank you any
other comment Michael Casey would say
the same thing if you've been to this
class would tell you well it's cool to
do to be told do this or do that
but the one thing you should not stop
doing its thing so thank you okay and if
you got something and you couldn't do
anything about it you just add something
to to to clean well it's near ends you
you just throw it back somebody will
catch a different well there's an
example there that's taken from one of
the classes I gave last weekend it's
it's tightened a bit it's it's a
generator ring I won't show the whole
code just just some piece of it it's a
very very simple thing where I'm doing
manual memory management I have a t-star
you see that and if you look at I have a
pointer to the first element number of
an integer for a number of elements and
integer for the capacity is very simple
stuff so there's from the beginning to
some place you have data and from that
place arm you have let's say empty
objects it's a naive thing good better
and there's a number of my
functions like size and capacity adjust
work and do what you expect and you can
see there the no accept thing that says
that if either won't throw or if it
throws you're dead because you just
broke the contract there was a noise
there yeah damn why they make me fit
because it's a mistake in my part so I'm
going to fix the slide thank you I did
that this morning because I wanted to
have an example so there's the cap the
suppose we turn there Thank You dick man
so that but that's just a typo from a
copy copy paste thing so everyone
understands that it's cap okay thank you
Becky I'm gonna fix up the slides aren't
yet in the folder so it's all going to
stay between us and nobody will know
ever so so you can have some simple
iterators in this case adjust pointers
just to make the code simple fair enough
all those operations are know except by
the way because they're if you're using
your thing and somebody's calling
returning a null pointer and doing
something wrong with it
it's not your problem and you don't have
to throw something they should be using
a low pointer it's their problem and I
put this push back there in both fix the
reason being that it becomes interesting
at this stage it's a naive thing okay
because all the extras in the room will
notice that memory management is very
basic the the if they're seeing if the
container is full because if it's full
we need more space the capacity is taken
and growing my micro because we're going
to allocate memory we're going to copy
objects around in this case because it's
naive and we're cutting T's and copying
it T well it might do anything you don't
know where it is and I locating memory
could throw possibly it makes sense and
you make notice that there's two lines
after that there's the copying of arg2 a
position in the array that is now big
enough to contain it I know that I know
that because if grow failed I'm not
going to the next step so by definition
by construction if I go to that
assignment line I have enough memory to
put the art yeah
and then I'm incrementing the variable
and you can see that I did these two
things in two steps I didn't do size for
an amps plus plus within the brackets in
the third line to make sure that the
assignment which could throw if it
throws I'm not incrementing the number
of events otherwise I will get an
incoherent container which is not seem
to be a good thing in most circles there
was noise in the audience so that the
way it's done there and I did that naive
grow in this case it's very naive
because it doesn't work it's broken and
I solve both bikes so it's not saying
where it's wrong but this is the
function I'm going to look at right now
and and there's so many ways this could
go wrong you did it the first thing it
could go wrong is the new array of T
there so on that line beautiful
I could I could have a allocation
failure because it's too big of an array
we have a block of memory to allocate
given the resources I have at that point
and not only that but I could have a
number of exceptions because I'm
constructing naively many T's in that
array at least new cap and exactly new
cap and each of these constructors could
throw because I don't know what it's
doing it's a tune so it might be a
string a vector of three objects or
whatever music database components
whatever so so that but is that sailed
around here it's not my problem
yeah if that fails my container still
okay my science isn't changed my my
capacity hasn't changed my point to the
first element is still the same it's not
my problem
so if it fails you know what the error
will get out and go to whomever might
want to manage it should be that's the
beauty of exceptions it's not my problem
it becomes my problem after new because
at that point if something happens so
it's in my ants I requested it I got it
but but you might be saying well nothing
bad will happen well the things happen
well
this is a this is not a problem because
failure I don't care it this is not a
problem
this is this one sale okay destructors
with that throw your program is already
dead so you have other problems
you won't recover from that so that's
pretty much okay can't do anything about
it don't worry this is a problem though
because copy is making assignments of
T's to T's which is an operation I don't
know the thing about because I don't
know what T is so each of these
assignments could throw so this is where
I have to protect myself because should
that thing should death think from
something then I'm stuck I'm going to
leak and it's not the memory I'm going
to leak that's bothering me in this case
it's the fact that each of the T objects
could be ending some resources that are
very precious like credit cards but made
suspicious to you but in my life plays a
role so this is what I don't want to let
as is should something fail because it's
something fails there then I have a
problem okay so so so now but now I
decide to try a block it's becoming
bigger but that's the thing you have to
think about you know it's just very very
case where there's a problem with this
one I'm putting my gloves there and
being careful because if something fails
what I have to at least clean up the
memory allocator than the objects are
created and that's pretty much we can do
I can do more than that and I don't know
what being thrown that's why I use the
cache nothing I use that because it's it
could be anything but it doesn't matter
I'm not ending the problem I'm just
catching it along the way like this
doing things as it screaming and moving
like that that's a point long how did it
go that's perfect
alright do what I've done night job and
somebody else will do it's all my job is
done my container is intact
I haven't clicked anything I'm okay so
far so good
of course I can do better because I they
are REI I that's so cool
so should I put my newly constructed
array in a unique pointer which becomes
then responsible for your resource well
when I do my copy thereafter if it fails
my container is still intact and my
resources won't leak because unique
pointer will die variable bath there
will be blood and fire and like legs but
the right thing is I'm not losing
anything
and once the copies been performed the
rest of it is at no risk so I'm doing my
small things taking the pointy roadway
from the unique pointer because it's
done its job it's held it nicely for me
to let me write clean code that goes a
very short it's actually very clean it's
actually very fast and I'm that doing
try-catch or other kind of exception
ending is just being done on its own
there's no leak so exception and link
doesn't have to be complicated making
incense okay good so Aria I really saves
you REI is so cool but you have to be
careful okay because I wasn't ending
anything in this case and should no one
be ending anything well the standard
says things standards do that they say
weird things the more you read that
thing the more you feel strange thank
you
so if you read this it says in some
situations the ending must be abandoned
for less subtle errors and then there
are situations and you're saying well
after company completing the
initialization of the exception object
well there's many things it could occur
but there's the case where the exception
and link mechanism cannot find a handler
so there is no one catching anything
ever ever ever again when the compiler
finds that terminate is called so if
this is not good for you you can have to
put a try-catch somewhere and there's
other things there that give you the
rules the if you had no except and
someone through or if someone through a
No
one cut ever the implementation is
allowed not to clean up anything can
just go away
so if it matters to you you might want
to put at least a try-catch somewhere in
your main just just to make sure because
otherwise you're going to have a quick
exit which is probably what you wanted
but should it should want the global
variable don't think we can end up
properly you might want to be a bit
careful but that's about it yeah
I cut up pieces because it's a big part
so if we surprised that part at least
well just been taking message is evil
and you should be shot no it should be
shot you should be scolded terminating
or a certain makes sense in some cases
you might want to just make a quick log
die restart that's okay and those
situations probably shouldn't happen
just fix your code even in other
languages I had a talk with a guy a
c-sharp guy last year told me I never
let people away in my code with
exceptions here and there I mean when we
get exceptions and debugging Moeller we
fix them and we only keep them for the
really exceptional cases but it doesn't
matter that the language support then
allah-allah it's a bit slower we fix the
code before we ship and you can alter
the signature the the piece there comes
from a tweet then I saw past a few
months ago where you can use macros
simplify your code if you change the
signature it's not necessarily clean or
Pleasant you need discipline you do not
miss any it's painful you could return
rich types like pair up channels
expected and you can throw an exception
that's it there's a performance issue
then there are things you can context
for away or consider you can use with
cast express pretty cool terminate exit
apart for some reason are not comes
expert okay so those options are round
you can a the natural version with an
assert you can actually context for a
way that's possible it's so in those
cases you could have the resolution of
your division at compile time when it's
reasonable why not
so you could do that thing where the
assert will crash if you're doing at run
time you think like this you cannot
consider wait because they're wrecking
into a pass by reference
so those strategies are out if you want
context / functions that have error
management this is our lab show
something it returns a pair is an option
as long as the types that you're
returning in your pair fit in with the
context with paradigm
yoky did this well actually compiled if
you use it it works because it's instant
bulls is very complex parole so that's
an option and of course this is an
option but this might surprise people a
throw is dynamic we're eating now whoa
calm down cuz expiries not always done
at compile time it's at compile time
which makes sense when the really the
context asks for it in this case well
it's going to if you pass it arguments
known at compile time and the
denominator in this case is not no it's
not zero while you're going to get your
computation compile time and if you
visit zero you're going to getting away
the computation at runtime or just one
for depending on your preference but
they depends on the context but you can
actually do that that's working you can
try it of course this is not a play by
ear plea for for small this loss
function
it's pointless just an example so the
point is you take your problem in a
place where you don't know know where
you don't know if you can actually
manage it in this case the context is
not loaned to the called function and
you want to push it away
how much do exceptions or doubt do
errors pollute your normal path
well the when there was the site between
nukes and and Dijkstra way back when I
wasn't born about go to or no-go tools
Knuth was suggesting it we kept keep go
twos at least to push the are ending
away from the normal control flow so
this type of thinking has been around
for a long while now the exceptions
we're using today are business fair
by that is so if we look at the
Excelsior and Ling when you're putting
it in your neural code well this this
small thing it's unreadable its sexual
code that computes two plus three using
calm on a different machine
I believe networks have been doing that
for like 20 years
the thing is there's so much error and
Ling it's very very I just exiting when
there's a problem if there's nothing
being done essentially there's so much
error and link that you don't see the
code anymore and it's not doing much
it's creating an object I think it argue
about getting interface testing it
arguments and showing the result pane
when I do this the students cry blood
and all the green stuff that you see
there it's out all the stuff that's
pointless well it's not pointless
because you don't you can't let yours
break your code but it's all the thing
that you're doing away from the test
you're trying to do if you remove it
well it's it's that more sane not that
much but it's a bit more sane at least
you can actually read the characters
from the room if you make an effort but
there's a number of hrs there all the
red things there are the cases where
we're getting a result that we should
really be checking all those cases
change the signature of our code because
we're not getting the result from the
function we're getting an error code so
we have to work around that and there
are cases where we should be doing more
because right now if we're not checking
we might fail and crash so so if we
clutter everything together yeah you had
the words so that we had two or three
slides ago it works what is it the
easiest way to make your code debuggable
and usable and not sure the sort of
sites that thing did you do that here
interface apart from no except because
now no except this part of the functions
interfaces since it has the 17 take a
function pointer except it's part of
that the D create alternative code paths
for the unusual stuff so you can focus
on real stuff so they don't pollute your
mago path and this separate
disappointment the word disappointment
is one I love it's from Lauren scroll
who s this who went to DEA's dream of 14
Martin meaningly thing last year I think
and I've said well there's so many ways
exceptions are not errors for so we need
a word for all those ways to express
what went wrong in fun disappointments
right yeah out of it
it's very pretty so dissipate the
disappointment handling from
disappointment this detection and and
and I haven't stated it so far but they
can actually be used to signal problems
from from structure instructors for
which none of the other things we've
checked apart room terminate can help us
that's already something I mean it
because think about it if you let your
constructors fail silently you're gonna
have to check your code all over the
place because you have no encapsulation
anymore because you have no object in
your system we can enforce invariance so
your code becomes cluttered with some
people like if statements I don't well
son so some people don't like it because
the alternative code path which is a
good thing for some things people say it
makes my call hard to reason about where
there are things going like go to ZAR
they have none sir none zero cost
I was trying this morning to put slides
with numbers on them and I didn't get
around to it for a time but I do have
the numbers okay what I did last year
for those who were with me I I got
numbers up from small tests on I think I
used two compilers or maybe three I'm
not sure where I checked the cost of a
code that in those problems with returns
and code that handles problems with
exceptions in a number of small
situations including stack unwinding
where you you have a number of recursive
calls and objects are being destroyed
coming back up small strings big strings
vectors of in terms of things and
everything and the numbers worse telling
us the micro benchmarks that we were
selecting mode with the exception and
Link cases except in a weird case with
big strings on Microsoft's
implementation a very specific one and I
wouldn't
bet my life on that special case because
I've been spending a part of my week
with the Microsoft people talking about
the string cases and they're fixing them
right now so there was something very
weird in the implementation that is
going to be okay probably in the next
release there were some very strange
things that they are discovering because
they're playing with string view right
now and they're reviewing their string
sing Oh or we did that so so it's going
to work better I think is going to be
more stable but the numbers exist so
I'll publish them and the the as far as
this morning because I was doing the
numbers this morning before I came in
the we're still exceptions are still
being outperformed by rewritten code in
almost all cases I checked clang clang
on Windows em SVC and GCC but to be
honest some of them are remote things so
I looked at the Machine specs there's
variation in the quality of the results
but internally for each compiler it's
coherent that's the thing so there's
still work to do it doesn't mean that
means we might be doing things better in
Oulu this summer in June I had a chat
with the GCP people and they were
telling me that one of the reasons that
their implementation of efficient is
slow that it was written for machines
that do not exist anymore they were
written for the machines of
architectures from maybe 10 or something
years ago so it probably needs more left
today to be more in tune with the
machines we have today
you don't not applying strategies they
would apply if they were redoing it
actually so we might see a change in a
year or two let's hope that that would
be better
so there you when you're at the
boundaries of code that end those
exceptions and doesn't result in cutters
in the room right now as a nice
technique
where you can make your code with errors
converge on one side and exceptions
converge on the other side you can
bridge between the two Stephanus Dutoit
you did the same thing a few years ago
two years I called them hard life
functions so are ways to handle those
situations where you're at the corner
cases between one world and the other
it's well-documented because what that's
one of the problems some people don't
like exceptions because they're the code
base
that has no exception ending and it's
saying what happens if we throw there's
so much code out there
we won't name them but there's big
companies you can understand that so the
micro benchmarks of next year they were
done with which you can see they're a
number of you the tests that I ran were
these so generating a number of integers
from minus 100 to -100 to this five
billion or something I should tell them
and then I I played around went through
all of them and every time I detected a
negative number that were hundred over
the the bunch
i I either returned an error in one case
or threw something in the other keys so
the thing is it happens not frequently
not as a bunch it's spread out so you
can count it I tried that I tried a
function that we called recursively many
many many times at various deaths one
two three four five up to ten there is
next up to ten I used to go to three two
is that the online compilers they only
give you small time slices and the tests
were too long so they crashed after ten
so i reduced it to ten that doesn't
really matter to be honest because these
numbers were it stable I was getting
like very straight curves in all cases
so it would have just made more numbers
but not better curves so the thing is I
am going down and then at some point is
I don't know it's going wrong so I'm
returning returning returning returning
returning so there's a lot of SOA
returns in one case I'm just throwing
way back up on your side I was hoping
doing that that they just throw there
and catch it every a variant would do a
good job because stack unwinding is what
it's built for that sadly enough that's
not the results that I'm getting so but
you'll be able to play with the coded
numbers if you want I'll add the URL in
the slides today when I have the chance
and you can pick the PDF and play with
it there will be a folder with the
numbers I got and the code that used
I sense the strings are a special case
and I could see that the numbers were
weird on the one compiler at the same
thing with a vector of chars or a vector
maker of chars I think and I got similar
curves okay so the compilers within
themselves were behaving in a coherent
manner they could be faster slower but
there was no case where the exceptions
were outperforming the return codes said
last year I also had a suggestion by
Shanta who said the guy from Adobe was
very very very bright who told me you
should try cases where nothing happens
because maybe Lacan Paris will be smart
enough to realize because that's one
thing you know if you're if you never
throw and if the compiler sees that
maybe it can optimize everything away if
you're putting the ifs you're still
going to do the years but the fact that
you're throwing and know once that
you're making try block button the ones
that were throwing maybe it's detectable
so I tried it I tried to I tried one
with redundant checks which means that
I'm still trying and I'm still doing the
ifs and everything but I'm never
throwing or returning in ever ever ever
ever again cool and another one where
I'm never and not checking no ifs on one
side no try on their side nothing and
there was very stable again and I was
hoping for better numbers they're not
miraculous steady so there's work to be
done
ok the the issue of performance is is
real it's not major but it's real
so it can be annoying for embedded
systems people are very very tight in
memory or on speed or something the size
issue I hadn't measured this morning for
lack of time the numbers I got last year
were about a 3% difference when I added
exceptions or removed it from number
I'll just I'm going to go to the
questions a few seconds so the size
increase was slight but existed a few
percent is that big or not it depends on
your application domain we had a
discussion in June again for other
features where one of the compiler
writers stated that he had measured a
3-person cost for for doing with the
proposal suggested and some people said
well 3% is nothing into no it's big
because that depends on your perspective
so the games people the admitted systems
people
high-frequency trading people 3% it
might annoy you okay so instead because
it's not in your domain that 3% happens
to be important that it's in everybody's
domain in C++ is a big world so that's
the reason why even though it's a very
good mechanism does a job we one have to
work on it a bit because it lacks love
and and and to the there's legitimate
reasons for people to be uncomfortable
with it I'm technical from technical
standpoint at least solo there and let's
zero test I would say for talking about
that's pretty much it I were to make a
reason me about this but I didn't get
around so I just made this question with
you guys so a few things before I take
the questions I've heard a few times
even this week cuz I've been here since
Saturday well the standard library
throws role very rarely it throws in
vector at it froze when your code throws
gets it cleans up and we throws it
doesn't show much by itself so standard
libraries not a big exception user it's
just making sure it's not being
corrupted we envy new exception
guarantees when someone is through
something and throws exceptions for you
let's do that mostly the exceptions come
from new and super were are saying that
maybe you should just die battle-ax is
being thrown just died but there's a
talk this afternoon by a guy named
zubkov I would like to go there I
wouldn't be able who says that he has
ways of ending verella so memory is
interesting things to do with that and
there's a few things but I won't have
time but are cute I'll put the code in
the folder if you're interested I know
that boost graph throws when it finds
something instead of failing because
graphs searches are so complex that
finding something is exceptional
and I really like that because it's not
an error it's an exception so it's the
death the normal case is not finding
something so I agree with everyone says
you should keep exceptions for errors
well yeah in most cases but again c-plus
the big world the canzone dealer is an
from what I know because I had never met
him he's an accountant my said but he
had a problem he wanted to do type
iteration a pointer and make sure that
it could get the pointer out but that
are one of its parents classes well to
do some polymorphic things with it and
the typewriter techniques that we had
get went for the exact exact type and
you found a trick with exceptions to be
able to get either the type is stored in
a pointer or any one of its base classes
it's a nice trick so I'll put the link
in the slide before I put them on you
can go check with the very very nice
trick and and you can cure very very
dirty you can throw a lambda that gets
to a function pointer and that tells you
how to end all the errors but don't do
that but there's many interesting things
you can do it exceptions if you're
creative it's a whole world now if you
to create typical moves do you lose your
job no but it's pretty much a tree so
the the under slides after that there's
a trick but since the time is running
and there are questions I'll take the
questions and put the slides on three
okay guys thank you so you had a
question
it's a good point I don't remember the
code by heart because I was with shaking
it fast this morning but it's a good
point should I have thank you you're
right the reason I was mentioning this
is because it's one of the criticisms we
hear so we and unless g14 at first the
discussions were not based on numbers
internally that's first the real reason
why I started doing this was that
discussing performance without numbers
is very annoying so the bell sharks in
terms of size were very simple I just
compel the same code with very different
Bell
essentially the same settings and I just
check the difference there's a guy whose
name escapes me I think his name is
David who was compiled clang with and
without exceptions just to check and and
who's done I stuff in found that
depending on the context if you do a lot
of i/o sometimes the exceptions perform
much better so so there's it's not the
end all of the generally speaking native
code we have some work to do ah I can
understand that yeah
I use it and and I work with people
really need speed so I personally use it
I don't use it everywhere okay I use it
in constructors since I read generic
code I'm careful
so I try not to beat resources but REI
does mostly job for you
so I use that I I wouldn't use it in
tight look ever unless I have a really
really good reason for that because it
shows too much and on those places but
there's a number of places where it's
fine I wouldn't use it for IO in C++ we
errors in IO are to come and to be
called exceptional I think if they
happened too often so I know that
something will just do that that's where
I would put it but as far as keeping a
code quieren safe for those places
constructors and other places that are
not tight loops I would anticipate no
you don't have to optimize everything in
your code you have to devise the hot
stuff so I would localize them and if I
have pieces of code that really need it
and rest doesn't well you can write to
DLR and Iceland localize them together
and make sure it's on the boundaries
should be escape we have things to do
there are some people who I've been
asking us recently on the mailing lists
if we should catch exceptions from other
languages I think it's just pure evil
there's I would use the pickup's options
for that and our glasses yeah I would
imagine you for trying numbers using
your statements
or even just Co times would be a
generally hard problem because like if
you look at the legs kernel they because
you see they're stuck with this angles
but they wrap everything in Frankfort
so for you to try to measure what would
the impact be with it a bunch of this
students versus an exception would be
incredibly difficult because generally
speaking brain conditions you just make
the problem go away
well it doesn't but does it theory and
then the code size effective if you've
got rid of all new statements right
would be removing seemingly a lot of
code by using exceptions but then the
exceptions add all of the basically
exception logic that's needed to do all
the lookups for how to do to snack on
line mmm so yeah you might be reducing
code size in your in the actual
co-teacher that you're writing but what
gets compiled ends up being relatively
large do the lookup data well it can be
the question is are we doing the right
thing but so far my feeling is we have a
qi thing I think we can I think I'm not
sure we'll be able to reduce the KO size
below the statement level but we can get
close and we're not close enough that's
more the thing that's annoying right now
we don't have a strong statement to say
we're close enough you should really try
it
yeah when we when we wrote that code it
was very obvious that there's definitely
these weird problems you're going to
have so that I would agree with your
statement that it's good in some
scenarios and not good in others you
have to G have to use your damn brakes
that the second thing with the mask is
just have you looked at this go guard
work which presented a couple years ago
with respect to do you state well this
is specifically disco guard no but there
re I have been using now is it there's
an interesting concept there where GSL
finally to be used except for the fact
that it's always execute in the case
where you have exceptions what do you do
building something similar to scope are
built with and if that becomes standard
is going to change a waiver program so
is going to need some more thought
indeed by the US
I'm surprised there's not more
discussions exceptions of dealing with
transactions how do you you know you
brought up the issue of I give that copy
but what it really yeah
maybe you'd like be aware enough stuff
because I'm getting messages from the
back end maybe you'd like to check what
the transactional memory group is doing
to because it's a real problem for them
of course and there I have a number of
techniques and ways to mark the code
know what you do should something fails
in the middle of the transaction and if
the transaction and everything you
commit do you rollback you failed you
all and given it a lot of props
Brett Hall very often in who has a
traditional memory commercial product
probably s thought about that too
interesting yep yeah is the manager the
the chairman of the company but there's
a number of people involved in there
that are here in the room but nothing
room but in the building right now
anything else
yep it's a good question the SG 14 group
right now is working on something with
that respect the Jasmine was talking
about link time optimization today the
the relation of your code to what's hot
and what's not sometimes is not the same
from the perspective of the compiler and
from the perspective the programmer I've
heard people saying well I want the hot
path sometimes to be seen as the catch
because I even though it's not going to
occur often it's what it occurs that I'm
really in a hurry level to do something
so there's it's not an either/or thing
it's tricky a bit so these guys are
working on they're trying to find ways
to use standard attributes because right
now we have a number of non-standard
ways of doing this there's GCC we
decline way or so we're looking for ways
to say Express the Intel
for a compared to the right thing and
it's it's a exceedingly difficult a
number of bright people who have real
problems are trying to find the right
words and right semantics right now for
an actual proposal eventually so it is
an interesting case it's not an
automatic thing it's something that
requires thought so I'm hoping that
these works will give us guidance as to
what we should let the programmer do and
what kind of leeway we should leave the
compilers because the needs of
performance critical code are not always
as evident that we would think it's a
very interesting thing I'm not in that
conversation much I'm reading it and I'm
having a lot of fun there were hands
thank you so much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>