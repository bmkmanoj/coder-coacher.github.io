<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2016: Jon Kalb “unsigned: A Guideline for Better Code&quot; | Coder Coacher - Coaching Coders</title><meta content="CppCon 2016: Jon Kalb “unsigned: A Guideline for Better Code&quot; - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2016: Jon Kalb “unsigned: A Guideline for Better Code&quot;</b></h2><h5 class="post__date">2016-10-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wvtFGa6XJDU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so this is half of a lightning talk duel
between James McNellis and I he he was
commenting on Twitter about signed
unsigned and I took a contrary position
and I said well let's let's fight this
out at lightning talks at CPP con and so
you're going to see mine tonight I'm not
sure when James has scheduled his we
will we'll find that out in the future
so the question is what is this code do
and because we are pressed for time I'm
going to tell you what it's going to
compare a sign and an unsigned integer
and so we have some questions the first
is is this going to compile and yeah it
compiles but is it perhaps undefined
behavior no it's not undefined behavior
but the question is well what's it gonna
what's it going to do what is it going
to print its gonna print else a it's not
less than B well see this is the thing I
think even James McNellis would
understand but negative 1 is less than 1
so so this is kind of the question is
you know is this what you expected now
we all know that C++ programmers are
amazingly good-looking group but more
than that they're in the top half of the
intelligence pool and you are all at CP
Picon so you're even higher up so you
probably did expect this but that's not
the question we have to go after the
question is what will other programmers
expect what will your coworkers expect
or any random sample of the 4.4 million
C++ programmers on the planet what are
they going to expect and the problem is
that most of them are going to be
surprised by the unsigned integer
promotion rules so what kind of advice
can we give them what's the guideline
that's gonna help well we could give
them a guideline like that but I'm not
really gonna go along with that so we're
not gonna do that so we could do that
that's not really that much better is it
ok well I I believe strongly in the
power of positive thinking but I don't
think I don't think we're going to be
able to write non-trivial applications
that never use negative numbers so how
about don't do math on unsigned types
well this was actually advice that I got
from an acknowledged C++ expert when I
was asking about this issue and what he
thought about it and this is what he
said he said this is a private
conversation
and he said well it's an unsigned type
you don't do math on it or we could say
don't mixed don't mix signed an unsigned
because that's that's the real issue
here right it's the it's the promotion
rules but the problem is if you have
them in the same application they're
going to get mixed and so the question
is can you have an application entirely
made up of unsigned types and and I
think that's back to the same rule of
not using negative numbers so here's my
guideline here's my recommendation to
you and that is don't use unsigned for
quantities so what does that mean does
that mean don't use unsigned I mean
isn't aren't integers quantities it
doesn't really mean that treat it like
this unsigned means it's a it's a bit
mask right so that means what that means
low-level hardware operations that means
bitwise logical operations that means
you could use them for say character
sets because the bit represents a
character right maybe have a data
structure that's made of a bits like a
bitmap or a big int those are all
perfectly good way reasons to use your
bit mask object or your unsigned but
don't use things where you're going to
compare magnitudes or where you're going
to perform mathematical operations
because these things are going to have
unexpected promotion rules so I'm
hearing all of course people are going
to be argumentative there's a James
McNellis in every audience so
it came back thank you James so people
say this is a way an excellent way of
documenting my API and I would say no
documentation is a good way to
communicate something about your API
using things like unsigned types to
communicate that it would be a bug if it
were negative is in fact hiding those
bugs if your code actually returned a
negative number because of a bug in your
code and it got cast to an unsigned you
would not see that bug you would be
hiding the bug rather than repeating the
bug which is what we would like to see
so what about this say using unsigned
types gives me a greater range of of
positive values I just don't buy it if
you need that extra bit you're almost
certainly going to eventually what will
run that extra bit of sneeze puts you
over run we don't want that so just use
a larger data type what about this the
standard library used unsigned types on
size T is required to be unsigned all
over the place and that's that's true
you got me it does because they had to
they had to have a way that you know
when you return malloc you might want to
malloc half the size of your address
space in a single call because that's
the kind of thing we do all the time
so the standard requires that size T be
on site that's an ugly wart we may fix
it in you know STD too but that's not
the point the point is that if you're
programming if you can't program in a
language with ugly warts maybe C++ isn't
the language you should be programming
it
so so here my recommendations select the
types for the operations they support
not the range of values
don't use unsigned types in your API
this hides bugs and don't use unsigned
for quantities don't use unsigned for
quantities thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>