<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CppCon 2017: Ben Deane “std:: exchange Idioms” | Coder Coacher - Coaching Coders</title><meta content="CppCon 2017: Ben Deane “std:: exchange Idioms” - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/CppCon/">CppCon</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>CppCon 2017: Ben Deane “std:: exchange Idioms”</b></h2><h5 class="post__date">2017-10-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OqJUBIJOojI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right how many people in here know
about stood exchange many of you you're
a super plus experts how many people
have used to the exchange recently
alright so the exchange is a little
thing that got added in C++ 14 and if
but if you're still on the eleven you
can easily drop it in your own code base
it looks like this of course I added the
context Britain and oh except stuff you
probably can't use context where if
you're on eleven but and it's very
simple it does something very similar to
swap as you can see except it does less
work than swap for when you actually
need exchange and you don't need to swap
you don't need all the pair of swap so
how many of you have code that roughly
looks something like this you've got
some asynchronous subsystem it it
periodically ticks and maybe you've
registered some callbacks and it wants
to go through those callbacks and call
them but because there's some reentrant
see stuff and your clients like you
don't want to impose things on your
clients you want to use a swap an
iterated IAM right so your code might
look something like this if your code
bases look like mine I'm guessing some
of you have seen code like this yes and
by the way Tony has a whole talk about
this well we don't need swap here
there's a simple substitution we can
make we just use that exchange we
exchange callbacks with the empty vector
and we just iterate it we saved a move
we saved a variable so that's kind of
pattern one you might have something of
that pattern another thing you might do
is you know post something to another
thread in a lambda it starts out looking
like this you can see the swap and then
the move into the lambda again it just
becomes a study exchange in the init
capture of the lambda again you save
move and a variable the result of
exchange RV owes into the lamp to
capture well that's great Ben you say
but you know what about thread safety my
code looks like this I have to take
stuff out of the callbacks because I put
underneath a lock because anyone can add
stuff to it
and so how are you gonna do that well I
say no problem
we do this so take a look at what's
happening here there's a lot guard it
lives till the semicolon there's a comma
operator exchange RV owes into your
vector or whatever I think this is very
nice
however what they're also C++ number one
don't pay for you don't use number two
vector is always the right choice right
except in this case as I discovered
because well this vector imply it
implies iteration and therefore it was
the wrong choice for this example as
totally pointed out because you don't
have to on the lock in the loop but as a
pattern as a refactoring as a whole to
this thread safe swap an iterated iam I
think you should start using it it's
more efficient exchange is better than
swap you save a move you don't get the
declaration the initialization split
it's less code it's an idiom thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>