<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>9.14: Loading Animation - p5.js Tutorial | Coder Coacher - Coaching Coders</title><meta content="9.14: Loading Animation - p5.js Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>9.14: Loading Animation - p5.js Tutorial</b></h2><h5 class="post__date">2016-07-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UWgDKtvnjIU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello and welcome to a tutorial about
how to program a loading animation on a
page in JavaScript using p5.js so I have
a p5.js sketch here oh it renders is
this gray square doesn't do anything yet
but when I run it you'll notice it says
loading there and then the sketch pops
up and it took 1355 milliseconds or 1.0
about 1.4 seconds did I round that
correctly I'm not sure so what's going
on here so p5.js actually has built into
itself if there are things to be loaded
before the sketch runs a sort of
automatic loading display so you'll that
sort of comes up automatically the
reason why that comes up is because in
the code I'm using this function called
preload so preload is a function that's
designed to operate synchronously
meaning the rest of the code the set up
function won't actually be triggered
until everything that needs to be loaded
in preload is done so images sounds json
files data files videos all sorts of
media or data assets that you might load
you can load those things in spree load
and then know that they're ready to be
used when set up and draw continue now
this is very convenient for like quick
and dirty testing for I just have a
couple images whatever you don't have to
worry about callbacks and asynchronous
this and that and whatever and you know
to just but once you're maybe a to two
reasons why this might not be so great
for you is number one you might actually
have a ton of stuff to load that it
takes seconds five seconds six seconds
seven seconds for the sketch to load and
you want to see other things start while
stuff is loading in the background
that's one thing I'm going to show you
how to do the other thing is just you
know as you release something onto the
web maybe you just don't want the users
to kind of see this default loading
thing for a little bit and want to
customize and do something special
yourself so that's what I'm going to
look at how do I take things that are
loaded in how do I take books how do I
take things that are loaded in preload
and load them asynchronously so that a
callback can register when they're
loading have other things animate at the
same time okay I got distracted by
looking at a live chat that's going on
look it
anywhere I complete this video okay here
we go
so some go back to the code and actually
honestly what I'm going to do I'm going
to show you eventually what I can do in
terms of all of these images and
multiple mp3 files but I'm going to
simplify for a second and I'm going to
comment out some of this stuff and I'm
just going to load I'm just going to
have one mp3 file load okay so let's run
this again and we can see that one mp3
file took about 811 milliseconds to load
so one thing I want to do is let's come
up with some goofy loading animation so
I'm going to do something really quickly
I'm going to say translate width / 2
height / - I'm going to draw a line from
0 0 to like 100 comma 0 I'm going to say
the stroke weight is 4 and the stroke is
255 and then I'm also going to rotate by
some angle and I'm going to have that
angle and have that angle increase over
time now I am making perhaps a rather
uninteresting loading animation I just
want like a spinning line but you know
this video is not about making an
interesting animation loading animation
it's just about how where to place it
and how to deal with it and then I hope
to see all of your exciting different
creative rainbow-colored loading
animations on the internet after you
watch this video so if I run this you
can see now notice that animation came
up after right because this happens in
draw draw starts after so this is my
loading animation a little spinning line
nothing too fancy so if I were do not
load this song you can see it comes up
basically that comes up basically
immediately so now what if I were to
take this load sound code and put load
sound now in setup notice there is no
delay anymore the one when you call so a
loading function that you call in
preload it has to wait and finish before
goes to set up a loading function that
you call and set up does not stop and
wait before it goes to draw it goes to
draw immediately so how do you know
right if I were to say this song 1
equals load sound and then I were to say
song 1 dot play why did those why did
these get sort of strangely colored I
don't know what Adam is doing the syntax
highlight this stuff but I'm not going
to worry about that if I run this you
can see this is the error I'm going to
get it's not ready to play the file
because it hasn't loaded yet so the way
that this works and I have some other
videos about this is with this idea of a
callback so I can write a callback here
that's called something like sound
loaded so I can add a second argument to
the load function and this is the same
for load image low JSON I can add that
second function and here I can write
that fun I can you know there's lots of
different ways I could write the
function embed it in there anonymously
instead but I'm just going to make it a
separate function outside here and it's
going to have it has an argument which
is the sound object it actually was
loaded and I'm going to say song 1
equals so I'm just going to do this for
right now and then I'm going to say song
1 dot play and now we should see to hear
it there should be a song flag it's got
a little like record scratch at the
beginning so you can see that song as
soon as it floated that thing is
spinning and there was like a little
pause there then now I think up really
shouldn't be there I wonder why that
hiccup is tech side interesting to sort
of like examine and debug that the whole
point of what I'm doing is from avoid a
hiccup like that but let's see what I
could now do is I could create a
variable like finished loading or I
could let me just create a variable
called loading and it was set that
variable equal to true and I could say
here in draw if loading draw this
loading animation otherwise you know I'm
just going to do a green background like
everything is loaded so what I can
actually do is I can put in the callback
that plays the song I could say
loaded equals true so I start with a
boolean variable oh sorry it's called
loading loading equals false so I start
with a loading variable equal to true so
while that's true I draw the spinning
animation and then at some point in the
callback when loading is finished I set
that to false and draw then switches to
the other animation so let's go back and
see spinning spinning green and the
music starts green okay so now here's
the thing so that's part one there's
actually a bit more to it than this
let's just see something kind of
exciting I'm pretty sure I need a stop
button I'm gonna use the tab just for a
second so it doesn't play the song um
now there's another aspect to this I'm
pretty sure that the sound library when
you call when you pass it a callback
like sound loaded you can actually I'll
give it a third callback I think you can
give it a third callback which is like
maybe I'll call it progress and then I'm
going to say I'm gonna have to look at
the reference a second if I get this
wrong but I can write another function
called progress and that callback is
triggered continuously giving you a
percentage of the amount that's loaded
so I'm just going to do put console.log
percent see if this works
no so let's go and look at the p5.js
reference sound file and I'm going to go
and look for ah success callback error
callback and while loading callback so I
think if I want to use this while
loading callback I need to also give it
an error callback which is useful to
have as well so Emma do you like error
and now I just need a function error and
I can just if there were an error like
the file does it didn't exist
I could log that error so here I'm
getting kind of like ballooning my code
which is why when you're just kind of
like sketching out ideas you don't
necessarily want to do all this stuff
but when you get to a finishing stage of
a project and you want to kind of like
add some you know nicer nicest features
you could turn adding other stuff so I
have a call back there's there's three
kinds of events
there's aha I loaded the song
successfully there was an error the song
didn't load and then there's a callback
that's like it's loading it's loading
it's the loading song it's loading it's
loading it's the loading song so let's
see if this works now right you can see
oh this like let's okay let's be a
little bit more thoughtful about this so
I'm going to say percent times 100 and
I'm going to floor it why did I get
negative three hundred eight and then
two twenty nine that is crazy
let's look at the documentation I'm not
sure if I'm either made a mistake or or
there's a bug in p5 so while loading
callback name of the function to call
while is loading that function will
receive a percentage loaded between zero
and one as a parameter huh so I believe
that I have done this correctly and that
I should get whoops
I should get a percent I spelled % wrong
I should get so I'm going to investigate
that later I might come up probably at
the end of this video you might see an
addendum where I fix that because I'll
go and debug that and edit that back on
later but I'm just going to keep going
although what I was going to demonstrate
to you okay cause I'm gonna debug this
I'm back and I couldn't figure out that
error so I'm gonna have to look at it
later and file some sort of like
follow-up video to this but I'm going to
keep moving in this tutorial so what I'm
going to do right now is actually take
out that progress thing since it's not
working for me I'm not going to use it
in this particular but I'm and I'm going
to show you some other stuff and I'm
just going to go back to sound loaded
and I'm going to do this and we're going
to see okay so this is working now
here's the thing what if I have two
sounds song song 1 and song too so now
what I need to do is do song 1 and song
too so you know they should be different
they should be different to different
songs but actually the computer doesn't
know like I just telling it to load the
same mp3 file it's going to take a while
so the issue is what if I want both of
those to have the same call back hmm but
I want the correct one to play when it's
loaded and I want to keep track of the
total number of things loaded oh my
goodness
yikes this is actually a time I walked
into a certain treacherous area here but
this is a time where using a JavaScript
closure would actually be something
quite useful so I'm going to actually
create a function that's called that you
know I'm going to call it a rainbow song
load rainbow song and I'm going to pass
it song 1 and and rainbow dot mp3 you'll
see what I'm going to do in a second and
I'm going to call that function again
now these should really be like two
different mp3 files but I'm just going
to use one mp3 file for right now you'll
see in a minute why I'm doing this so I
have a separate function what I want to
do is say I want the variable song 1 to
go with this mp3 file and you know what
I'm going to do
this is even though it's the same music
what I'm going to do is a hold on reveal
in finder show and finder this is this
is going to make things much less
confusing I'm actually just going to
create two versions of the file because
what you actually would be doing is if
you want to load two songs okay so now
there are two different mp3 files for
all you know they're two different songs
and what I'm going to do here right I
have a two that I want to load so I'm
creating a function called rainbow song
and in that function what does that
function take a rainbow song it takes a
variable like song and it takes a file
name and what I want to do is I want to
load that file into that particular
variable name and then know that it's
loaded and play that particular variable
so here in other words now this load
sound function needs to then go inside
that function okay and what am i loading
I'm actually loading this file name now
so I just created a wrapper function to
call the load sound function and be able
to receive the file name as an argument
why because now what I can do is in this
sound loaded function I can say song
equals that particular sound right this
is a closure I now have access to either
the variable song one or song - I have a
whole video just about this concept that
you could go and look and now what I
will can do is I can say song dot play
so in other words I was able to hear if
I say song 1 equals slowed sound sound
loaded song 2 equals load sound sound
loaded and this is my sound loaded
function I have no way to know what that
callback happens which file was it but
here I now know how to do that because I
have then instead taking the load sound
Oh
a-and made that happen in my own
function that receives arguments this is
essentially how you pass arguments to a
callback I pass arguments to a function
that then defines the callback within
that function so I have access to those
arguments and that's a JavaScript
closure this function is enclosed in
that other function okay
that's a bit of a side topic here but
it's kind of necessary for this type of
thing that you might be doing there's an
error I made a mistake I'm missing a
semicolon somewhere ah yes thank you
very much this is an error the chat
thankfully saved me there so I'm going
to put that I think I've got everything
right now so what I want to do I forget
about the loading animation for a second
what I want to do now is I just want to
do this a console dot log file name so
here I'm going to be able to see the
file that was loaded run this rainbow 1
so you can see those files I now have
access to when they're loaded separately
and I get this like weird little pause
but the first one loads in my animation
I don't know why that's happening the
whole point of doing this is to
eliminate that but ok so I've got my
loading animation going and now what I
can do is I could have a counter you
know I really should be using an array
let's use an array yeah let's use an
array that's how you would do it
probably I'm going to make this an array
and what I'm actually going to do is I'm
going to say 0 1 so I'm just going to
pass in an index into the array it
should be named rainbow 0 right and and
then what I'm going to do is here I'm
going to say songs index and this is now
an index songs index equals sound and
I'm going to say console.log index plus
file name and then songs index so now I
have an array of sounds and only two of
them and you can see they're being
loaded separately 0 &amp;amp; 1
so now I could easily have something
like a counter right so I could say a
counter equals 0 and here whenever the
song is loaded I could say you know
counter plus plus and I could say if
counter equals two then loading equals
false so now I know only stop the
loading animation actually only stop the
loading animation acts after I've loaded
everything and there we go so you can
see it's loading them one at a time and
it's loading them one at a time
pause edit point okay I'm back and what
I'm going to do now is improve the code
with a few cleanup things as well as
show you how to have a loading bar kind
of go through the percentages as a bunch
of things are loading so while I was
taking a quick break there what I did is
I made I added ten songs to a folder so
now what I want is for this sketch to
load all ten so there's a bunch of
improvements I can do here
number one is I can have a variable
called total songs and that's going to
be equal to ten
the other thing I could do is I really
don't need to call this individually
with passing in the index I can really
just write a loop right now I could say
for VAR i equals zero I is less than the
total songs I plus plus and really all I
need to do now is I don't need that
index I can just say I can just say let
me let me dynamically make that file
name let's leave the index there for
right now because I'm going to show you
why now why you may or may not want to
use it and I can just put a sorry I in
the file name so this is my nice saying
like instead of saying load rainbow one
load rainbow to I'm saying loop through
I going from 0 up to ten and loop and
get do rainbow I rainbow eye which is
rainbow zero rainbow 1 rainbow - that's
a song rainbow zero rainbow one ok so
now we should see 0 1 2 3 now notice it
stopped it thinks it loaded after it got
just through - that's because I have
this counter here and really I need to
say when this counter equals total songs
now now that I have of that as a
variable so now I can say it's loading 0
1 2 3
four five six seven eight nine and then
it's finished loading so I'm getting
pretty up doing pretty well here and
let's see let's make a few more
improvements there now one thing is I
don't actually need this index here I
can get rid of the index here because
one thing I could just do and I'm going
to keep the file name here is I can just
say songs dot push sound and that'll
just say anything that's coming and push
it onto the array but there is a slight
issue with this let's see well first of
all the issue is that nothing I'm
loading forever
loading forever what did I miss here
oops I have index still here as an
argument where I just want file name now
and you can see 0 1 2 3 4 5 6 7 8 9 wow
so what I was really expecting to happen
is for those not to come in order they
did come in order which is kind of lucky
but there's no way to guarantee that
they're going to happen in order so if
you care about the order of those things
in the array then you're going to want
to like keep the index as you're calling
the load function but in this case it
didn't really matter so what I'm going
to do now is do something really really
simple in addition is I'm going to say
okay I'm going to draw a rectangle I'm
going to make a stroke of 255 and I'm
going to have no fill and I'm going to
draw a rectangle from 10 10 to like 500
across that's 20 pixels high let's just
see that there whoops that's way too
wide still too wide okay so you can see
now I have a rectangle up at the top and
then what I want to do is draw a
rectangle with no fill I mean I'm sorry
no stroke and I want to give it a fill
like 255 and maybe with some alpha and
then I want to draw that same rectangle
but I want the width to be a variable so
if I do this for example just give that
width equal to Mouse X look as I move my
mouse around
rectangle there's a rectangle inside the
outer one and now since I have that
counter I can say that is something like
200 times the counter divided by total
songs right because a counter is
counting up how many total songs and we
should be able to see here as they're
loading you can see the progress of that
loading bar moving forward oh okay I
like this this will be like like a gif
animation the loading song loading
loading loading loading loading loading
loading motoring loaded okay alright so
that's how to program a loading
animation in p5.js instead of using
preload which I've now commented out you
can call things in set up with callbacks
you can keep track of when the callbacks
are finished you can put things into an
array you can use a closure to keep
track of a whole bunch of things with
the same callback there's a lot to this
but hopefully this gave you some
JavaScript learning and information and
was helpful make your make a nicely
design more beautiful rainbow-colored
perhaps loading animation share it with
me and I would love to check it out ok
thanks for watching this video and for
maybe an addendum on it I'm not sure
just yet or this might be the end I
don't know it'll be a mystery it's a
mystery it's a mystery
I need a sound board really badly
goodbye maybe</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>