<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CircleCI Part 4: Matrix Library Testing and Continuous Integration | Coder Coacher - Coaching Coders</title><meta content="CircleCI Part 4: Matrix Library Testing and Continuous Integration - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CircleCI Part 4: Matrix Library Testing and Continuous Integration</b></h2><h5 class="post__date">2018-02-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Zu380IeA2Lk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right so here we are I am in another
video in my series about unit testing
testament driven development and
continuous integration and I have been
building I have another playlist where
I'm building a simple neural network
library in JavaScript to make some
examples this video is not about how the
neural network library works or what a
neural network is you can go watch those
videos for that but with this video I'm
going to do is I'm going to add tests to
the library and then solicit
contributions from the community to add
more tests and I'm gonna have those
tests run using circle CI which is the
sponsor of this video you can find out
more about circle CI here and then we're
gonna we're gonna have learned something
because this is new to me I have never
other than the contributions I've made
to p5.js really done a test-driven
development workflow before but I'm
excited about it and I think what's
exciting about it is to make
contributing to open source to open more
pathways to make you people feel more
confident in being able to review pull
request to submit pull requests we'll
run those tests and also writing the
tests is a way you can contribute to a
project even if you don't know how the
neural networks work you might be able
to contribute to this project by helping
write a single test for it okay
all that said I've set up a bunch of
things already so I have this github
repository toy neural network in j/s
it's on github I have it locally
I have a package JSON file which has a
which a science jest jest is the testing
framework open-source testing framework
from Facebook that I'm going to use and
that's pretty much all I need and it's
the dependencies are there so I need to
write a test so the first day oh let me
first mention thank you - Carla - beer
on Twitter who did this already I kind
of gave me the idea for this in a way I
set up a series of easy to use automated
unit tests for the current version if
your artificial neural network matrix
library code so here a whole bunch of
tests now Carla used a framework called
Q unit so I'm gonna click on her the
tests here and I'm gonna look under unit
tests and what's useful about this is
you can see Carlos doing something smart
which I'm not going to do which is
actually creating an HTML page to
probably run the tests in the browser to
see how they work but we can look at
this this idea of testing to see if like
matrix addition is working so we can
hopefully use exactly this test but
convert it to the syntax of jest and get
it to run okay I'll be to do that in
this video so what other pieces do I
need so this is the matrix library the
matrix library is a class called matrix
that you can create matrix objects with
and you can multiply those matrices you
can add things to those matrices it's a
math bunch of math code that I need a
mineral Network project so with Jess
something that I can do is I can create
a new file and I can call that file
matrix test dot J s and this is where
I'm going to write any tests that go
along with matrix not J s and so let's
go to the jest again I don't really know
what I'm doing so this is gonna be a bit
of a struggle here so in my previous
videos where I went through a lot of
steps of this I just used this to be
function write expect two plus two to be
which is basically two plus two equals
four but there's actually a function in
Jess that I'm just learning about now
called two equal which will check like
oh is this object equal to this object
it'll recursively go through and check
all the properties of the objects or all
the elements of an array so this should
be the code that I can start with and if
I paste this into my test file now what
I really am testing is adding number two
matrix and I'm gonna go and grab Carla's
code and just kind
grab this much of it at least and I'm
going to do this and so what this is
doing is saying okay make a three by
three matrix and these are all the
numbers in the matrix and add and I'm
gonna instead of having a variable right
now just be simple about this I'm just
add one let's just add one so the new
matrix should be two three four five six
seven eight nine ten so I want to expect
a two a dot data well and I'll call this
m4 matrix I think and mmm to equal and I
should be able to now put in a two
dimensional array with the values in two
three four comma 3 4 5 6 7 comma 8 9 10
so this I believe is now the test right
let's take a look at this all together I
could be doing something wrong here but
right I want to create a matrix object
adding and I'm gonna say adding a scalar
that's the name of the test to a matrix
I'm gonna add the number one to it and
I'm gonna check to make sure the
matrices data actually equals all this
and I probably could have said expect M
equal and then maybe done something like
what an object with data in it would
that be better
I don't know well let's do that let's
try this so just how to curiosity let's
try this to see if it works now I'm not
saying this is the best test there's
probably more ways and just to structure
this that would be more generic I need
to make lots of testers it's just one
but let's just see if this even runs and
I'm missing some important pieces here
clearly so first thing I can do is just
write NPM test and what it's going to do
it's gonna it's going to find that file
but says matrix is not defined so I need
to make sure I export matrix and I say
modules dot export equals matrix and
then in matrix test I'm going to say
constant matrix eat
require dot slash matrix so this should
be I exporting the matrix class and then
importing it here so now it should know
what matrix is when I run that test
running the test now it failed now oh
modules dot export okay I can never get
anything right its module dot exports
can never remember that apparently let's
run the test one more time failed matrix
is not defined Oh funny thing funny
thing
order is important matrix doesn't exist
yet because I haven't defined the class
so this actually has to be at the bottom
let's try this one more time
alright so we got further look at this
it failed because this is what it got it
got those correct numbers two three four
five six seven but what it received also
had columns and rows and I forgot that
in this case my matrix objects if I look
at the constructor have not only the
data but columns and rows so I need to
go back to my test and say expect what
do I really expect it should have data
columns is three and rows is also three
and you know I don't the order shouldn't
matter here the the properties of an
object are not ordered but I like to uh
put columns and rows first and really
rows should be first just in terms of my
mental thinking it's always rows by
columns okay so this should hopefully
the test should pass right and you know
this would be interesting to not have
those be equal okay so let's let's run
this again let's run the test and the
test passed awesome so we've written our
first test now have I done the best job
ever in terms of optimal thoughtful
testing driven development no but I've
got to start I've got an actual
dear if somebody were to try to refactor
if I were to try to refactor my ad
function and do it in a different way
and it didn't actually add the numbers
up correctly this would fail and I would
know but I don't want to do any more
testing what I want to do now was a
couple things there's one important
detail that I've missed because this is
right at the moment just client-side
code only but this requires stuff and
this module export stuff is going to
mess that up but let me at least get
this building on circle C I so this
repository is already on github here and
now I'm going to go to circle CI and I'm
gonna say add a project and I want to
add toy why is it not showing up oh
there it is I just had to refresh I want
to add the project toy neural network
Jas I'm gonna set up the project it's
going I'm going to copy oh it was a as
you might remember if you watch the
previous videos I need to create a new
folder called dot circle CI and in that
folder I could need to create a new file
called config dot yml and then I can go
here and copy to clipboard all of the
settings stuff now I'm gonna leave more
stuff in here this time so I'm gonna
check and just I want to use the same
version of node that I'm using here 8.9
so this is the version of node that it
should run the test wiz I'm gonna leave
this work I don't think I need this
working directory thing that's optional
I definitely need to check out the code
restore cache let's see if this helps
speed it up so this is this should be a
thing where it saves a cache of previous
dependencies that is already installed
so don't have to reinstall them every
time it needs to run the test run is NPM
install I'm using NPM not yarn and then
run the tests is NPM test so I'm gonna
leave all of this here and then I need
to push this the github get status let's
just make sure oh I modified all this
added the tests I modified matrix dot
yes I'm going to oh and look at this
I've got a problem here I've got a typo
that's got to be Circle CI the e key has
anybody watches my videos knows the e
key on my keyboard only works about 75%
of the time often misses it so that
should fix that I'm gonna say good
status again there's dot circle CI I'm
gonna say get ad dot git commit dash M
adding unit tests with circle CI I'm
gonna push this to github and there it
is it's on github I'm going to go over
here to github just to make sure I see
circles I've see it dot circle CI is
here and I should be able to say start
building so I'm gonna click start
building and make sure this test runs
and PM install is happening right now
install song it's creating the cache
yeah Mike failing Oh Oh hmm so why did
the test fail let's take a look
cannot find module dot matrix from
matrix SAS hmm must be a path thing oh
no it's not I just made a silly mistake
a very silly mistake it is kind of a
path thing it is a path thing uh I made
a silly mistake which is that I was
thinking capital M for because it's a
matrix class and I want to reference it
as capital n but the file date the file
here was actually a lowercase M that
file is called major such as and on my
Macintosh II computer thing it didn't
really care about that it worked but the
circle CI servers are obviously clearly
case sensitive in terms of what they're
running so let's get add git commit a
fix upper case issue the worst
description ever push origin master
and I think it will Auto trigger a
rebuild so I'm waiting to see if it does
it automatically yep it's running it's
still running
still running Oh fixed check check
so exact look look look it checked out
the code it restored the cache it run
npm install its save the cache and I ran
NPM test and my test passed
woohoo so now I am going to make it a
moment where all of you can now
contribute and give me some better tests
so what I'm gonna do here is I am going
to do there's a bunch of settings I need
to configure I need to go to settings
I'm gonna go to branches I'm gonna
protect master protect this branch
require status checks I want to make
sure Circle CI is checked and I'm also
going to include myself I don't want to
be able to do anything even though I'm
the administrator I still have to have
my tests passed I'm gonna do save
changes I need to add what I need to do
one more setting which is very important
I'm gonna go back to circle see I look I
have these two projects testing test
test was the build project I made in
previous in my previous video tutorials
where I did this a little bit slower
step by step and I want to check the
settings for toy neural network J s I
want to go to advanced settings and then
I want to check here's the really
important one build forked pull requests
I want to run the test for people not
just from the coding train or official
organization or kind of contributing to
the project who can make a branch within
the repository but people who are just
from the community who have fork the
repository and then are sending back a
pull request I want that so I'm going to
click that too on that will live save
there might be feeling where you have to
like go back and rebuild any pull
request that was like submitted before I
click that
but now going forward they all should be
fine and so I'm pretty much done except
I forgot something important so here's
the thing what I'm actually working on
here is a client-side JavaScript project
at some point I might want to make this
you know a neural network library that
could be
node module and I could have a more
elaborate fancy build process to deal
with all this but right now I'm just
written these matrix dot these tests
just for this matrix a J's file that
lives as part of this web project so
this is actually where it's being
deployed and used as part of a webpage
the problem is I'm running a web server
already if I go and refresh that page
which I just did a second ago now this
is the error I'm gonna get module is not
defined so while the test might run
because I've set up this export of
matrix properly so the test won't run
the client-side JavaScript knows nothing
about node modules and again their
prompt they're sophisticated and better
ways to handle this but I'm gonna do
this with a slightly just like a quick
trick here and I'm going to say here is
that I only want this to happen if I'm
the environment that I'm running is
within node and a way that I can do that
is I can actually I mean ideally I would
just say this if module like if it
exists then I can do that but this
actually won't work because it's still
not defined but a trick that I can do is
I can actually ask for the type of it
because the type of it will return I can
say if I'm just like here if I say type
of module I'm gonna get undefined in
quotes so I can actually just check hey
as long as it's not equal to undefined
then go right ahead so now I should be
able to not have this error in the
browser and watch this gets a let me let
me add this change get status get add
checking if node environment for module
and now oh I didn't mean commit yes
- m3m how many MS are there and commit I
like em okay now remember git push
origin master
I cannot do it I protected myself so I
am now going to say even if I feel so
one thing I probably want to do is I
might as well run I might as well make
sure the tests still work yeah so the
tests work so I can feel pretty
confident it's fine even with that
change notice still recognizing the
module and I can say git push origin
master and then I'll call this branch
module fix I sent it up to github I'm
now going to go back and I'm gonna go
here I'm gonna say compare and pull
requests I'm just gonna create this pull
request and now I am going to wait come
on circle see I give me tell me that my
test it passed oh and somebody approved
these thank you okay now I'm gonna hit
merge merge wonderful so now I have a
project that involves test-driven
development it has unit tests for the
matrix math though it is as a protected
master branch on github and only pull
requests that run passing tests will be
able to be merged so I am now opening
this repository up to the community I
obviously have a lot more work to do on
it to make all the neural network stuff
work and you can imagine what other
tests do I need to write but this is why
this is important this matrix j/s
library is pretty terrible and
inefficient and slow so ultimately I
might like to continuously refactor all
these math functions and so I might
start using like things like reduce or
fill and I want to make sure that I
didn't break the actual math and this
process of test-driven development will
allow me to do that and will allow it'll
make it easier and nicer for those of
you who want to to contribute as well
you know maybe I'll swap out this whole
thing with another matrix math library
and then but use the same function names
and does the code still work there's so
many possibilities so I hope you enjoyed
all
these videos about unit testing
continuous integration and test-driven
development
it's possible that I've actually done
this because I am the least test-driven
development person but I think it's a
good thing I'm hoping to use it more in
project in the future thank you again to
circle CI if you're interested in
signing up you can check out this link
here and for sponsoring these tutorials
and I look forward to seeing you in
future ones I have it one more that I
want to make at some point so there
might be another video in this playlist
if you're watching this right now you
can check it's not there you can
complain in the comments I love
complaints warms my heart goodbye
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>