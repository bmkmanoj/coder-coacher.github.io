<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Coding Challenge #63.2: Texturing Cloth Simulation Part 2 | Coder Coacher - Coaching Coders</title><meta content="Coding Challenge #63.2: Texturing Cloth Simulation Part 2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Coding Challenge #63.2: Texturing Cloth Simulation Part 2</b></h2><h5 class="post__date">2017-03-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FeXnJSCFj-Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome to a coding challenge
you might remember me from a previous
college I say that joke already in that
other video but that was a coda guys
there are code exists to get into parts
it's a coding challenge in two parts
this is the second part so what I'm
going to do in the second part is take
the knowledge from the first part where
I'm looked at how to texture geometry
with an image and apply that to this
idea of a cloth simulation to try to
make a waving flag with an image on it
with our new friends the unikitty so you
can see this is kind of happening here
there's this crazy image that's being
texture to this of to this geometry and
if you didn't watch that video don't
know about how the texture function
works
I would encourage you to go back and
look at that first but we're just going
to get started right here so this for
this is kind of a rare thing that I'm
doing here where I'm not starting from
scratch but I'm actually also building
off code that I built from scratch in a
previous coding job so you can also go
back and watch that one with coding
challenge number 23 d clock but here's
what I'm going to do so let's save that
and now I'm ready okay so let's look at
this the first thing that I want to do
is I want to make this more like looking
like a flag so even before I add the
texture let's make it look like a flag
so a couple things I'm going to do
number one is this is where I lock the
particles so I lock the particles to on
the top so if I remember right I could
say lock one on the top and one on the
bottom and you can see oh that is weird
that is weird so another thing I want to
do is get rid of this rotating right now
because it's making it confusing for me
to see what's going on so let's run this
again and see hmm oh okay wait wait oh
but there's all this okay let's do
something else let's get rid of the
gravity for a second let's take out this
gravity behavior because that's kind of
confusing me what's going on okay so
that's ah so the orientation is also
completely different I forgot about that
I already nted the cloth as this thing
up so what I actually need to do what I
probably could do is just change the way
the scene is rotated let's see how did I
do that so if I if I rotate the whole
scene it's up here on the x-axis it will
be rotate around the x-axis right by 90
degrees will that work
there we go okay so there it is I could
have just changed the way it created but
let's just keep it I'm going to rotate
the whole scene that way and then what I
want to do is I let's not confuse myself
so where it's a gravity pointing is the
gravity what which axis is pointing down
and maybe I should reorient the way I do
the part let's reorient the way to do
the particles because there's going to
be way too hard to figure out if I
rotate the scene right so this is a
better idea look at it I set all the
particles with a fixed Y and X and z are
what are changing which is why X moves
across this way or X moves across this
way and Z moves across this way now I
want Z to be fixed and x and y to move
so all I need to do I think is just
change this to Y and set all the
particle locations to Y and have Z be
some I don't know let's make it zero so
I have a feeling that there's going to
be a bit of a problem here it's going to
be in the wrong place it's at the bottom
that's no big deal I could say Y should
start at Rose negative Rose times W
divided by 2 so that it starts higher up
and you can see there we go now what I
want to I want to want to give myself
some more space here because I'm going
to have this nice flag-waving simulation
so I think I'm going to just give myself
800 and I think X should actually start
at I know I'm just going to sort of
hard-code some stuff in here to like
shift it over a little bit and that's
too much shift it over like this okay so
now there we go
the other thing I'm going to do this is
kind of silly but I might as well is I'm
going to at the end I'm just going to
draw a line stroke 2:55 stroke wait
or and I'm going to draw a line from
where's the first particle the first
particle starts at this location come to
this location and oh boy
line from here is you know I should do a
better job of thinking about how to
organize these as variables but I just
want to quickly put something to make it
look like the flags attached and I'm
going to go from that point all the way
to this same X and then down to the
bottom of the screen there we go
so this is a flag but it's not waving or
doing anything I might need to set it
back on the z-axis or something
depending on how things go but now I
could put that gravity back in so
gravity points down let's look at it
again oh I need to add the gravity
behavior not just look at it and run it
again there we go oh my goodness look at
that flag it's just falling down there's
nothing going on so one thing that I
want to do is push add some wind so I
want to add the wind and you know I
could probably take out the gravity just
in terms of like finessing it here but I
want to push it in that other direction
so the particle are the particles all in
an array the particles are in a 2d array
and I'm doing all this stuff with them
here and then so there's a lot of things
I got to change but one thing that I can
do this is all just setting it up sorry
ah perfect this is this is where I want
this is a loop that draws all the
particles probably as dots or something
so let's take out s dot display so what
I want to see is just the particle oh
you can't see them so what is the
particle display function I would to
take it out so let's I don't know why
that was commented out so let's put that
back in so these are just a particles
and boy they're like they fell quite far
away wow these should be at zero zero
right if I'm trans I don't know I had
that coated fur before it was in the
state so if I'm translated XYZ the
particles should be drawn at zero zero
okay there we go there we go okay so
this looks like what I expected it to
now I can see and I what I was going to
do I think it'll be easier to look at
what's going on also if I really really
increase the resolution of this so
I'm going to make the number of columns
and rows I should have these calculate
based on each other but I'm just going
to make it much so you can see now this
mesh is a less less high resolution so
we can sort of see there too so now what
I want to do what I wanted to do here
and I don't need to display them is I
want to apply a force to them so I'm
using the toxic lips physics engine and
it has a function called apply look oh
it's add force yeah there it is add
force so this is a function that allows
me to arbitrarily add a force to it and
I'm going to add a force like and that
force should be a vector so I'm gonna
call it wind and I'm going to say BEC 2d
win equals the new back 2d and it points
5 comma 0 and oh it needs to be 3d I
forget that I'm in 3d world so 5 comma 0
comma 0 so now we can see the wind is
sort of keeping it more like a flag now
here's the thing it's working it kind of
looks like a flag but it would be much
nicer if that wind were kind of
inconsistent and also maybe there was
some wind along the z axis as well and
no I always just dude Perlin noise in
these types of situations so what do we
do by I'm not even close to the
texturing yet well I'm close to the
texture so let's try to make the wind a
bit more interesting one thing that I
can do I've got this two dimensional
space which is really perfect here so I
can consider an x offset for Perlin
noise and a Y offset for Perlin noise
and I can say the noise value is noise x
offset Y offset and for every column X
off should increment by something and
for every row Y off should increment by
something and then actually this should
probably be at the bottom not that it
really matters and then what I could do
is I could say this is n times 5 and
this is
and minus 0.5 so I managed oh should
probably be different I should use
different values for okay let's let's be
let's be let's be better about this
let's say because I want to make this
look nice
let's say Windex is noise of X off y off
and wind I'm just going to wind Z is
noise of X off Y off and what I'm going
to do is I'm just going to like offset
these but but it just like look at a
different part of a noise space let's
like arbitrarily some other number so
that I get different values for Windex
and wind wind x for wind x and wind Z
and then what I need to do is mask those
you know this is a little bit ability to
use a map here because the range of
going is between 0 and 1 and maybe I
want to always have some wind so between
1 and 5 always pointing in that
direction and then I want to Mac Z
though which has a range between 0 and
1/2 between like negative 1 and 1
because the Z the wind could push in and
out and so now if I do that let's see
what we get
we're getting kind of more like the wind
is kind of changing over time but here's
the thing it's kind of settling in I can
do even better because it's even though
the wind is different in a sort of
smooth way through across all the points
it's not every frame so I can add a
third boy this was like a lot of Perlin
noise stuff for all the texturing stuff
otherwise we add I can add a third
dimension which is really the frames of
animation the time Perlin noise so z is
really the x and y is the noise in the
2d space of the flag and z is every
cycle of animation so what I'm going to
do now is I'm actually going to look at
C off and I think I can just use the
same V off for each object that will
matter and then globally every frame the
off will change by some amount so now I
believe that I'm going to have something
that feels a bit more like wind that's
changing over time it's not really going
to settle in
much I'm sure I could play with the
parameters in the amount but you can see
we've got our flag and I think I kind of
want I think that gravity should maybe
be not so strong so I'm going to just
make the gravity a little bit weaker and
I'm going to go back now to having it be
many many more points which I also think
will be more interesting to look at whoa
okay so I I think I've made the wind a
bit too strong it's like really
stretching it out this is the kind of
thing that really some finesse and some
playing around I'm not going to I'm
going to let you if you download this
code like play with the parameters a bit
more but I could make the wind a little
bit less strong
I stress of the springs is probably a
big factor here so if I go into the
springs they all get made where do I
make the springs they all get made with
a strength of 0.8 so if I made it like a
point one I think it's going to make it
really crazy flimsy look at that not
look at that insanity and I could
probably strengthen it up a bit by
making the strength one which might give
it a little bit more so who knows
whether this is better or worse but now
we're ready right now we're ready to do
the texturing this was the point of this
video in the first place
so how what's where's the geometry that
I can texture so what's actually being
drawn here if I look inside draw you can
see this is actually where the flag is
being drawn every spring is a connection
between two points an S dot display what
does that do it draws a line between
those two points so now what I need to
do is I don't want to do this anymore
that's not going to work for me what I
need to do and I think I I think I want
to do this in another loop because this
is this loop is crazy but I need a loop
of columns and rows I need to render
this with the particles so I need to go
back to a particle dot display particles
index I index J dot display so let's
just make sure this works so now I'm
rendering it as a lot of points and I
just want to make that easier
see but making this point smaller and
you can see that now so this is really
what it is it's a whole lot of points
remember that triangle strip thing all I
need to do is fill it with triangle
strips now from top to bottom
okay could you add one or two more
locked points I definitely could so I
maybe that's a good suggestion maybe
I'll do that I kind of supplemented here
so maybe I'll add that a little bit
later but that's not a bad idea to lock
a few more points to the to the pole and
it wouldn't be too hard to do that would
just be a matter of picking some other
points to add right here okay
so what I need to do now though is I
need the X and I need the Y and what I'm
going to do is I am going to turn off
the physics just for a second so how do
what's the easiest way for me to do that
just comment out physics dot updates so
if I comment out physics dot update open
I don't because I there should be no
physics but I forgot to display anything
so let's want to make sure that still
works so there it is but no physics
there's the flag okay so now I wonder if
my rest length is off to that's
something to think about but so now what
I'm going to do is I'm going to say
begin shape and end shape and I'm going
to say begin shape points and I'm going
to say vertex and oh my goodness I
cannot believe that I really need the V
here just say vertex X Y Z let's see
what we get so now I should get bears my
geometry it's just a set of points okay
we're in good shape okay so now I don't
want I don't want a point when I want
our triangle strips so a triangle string
so this is going to be wildly off but
let's let's run this thing what happened
oh my goodness I can't even make any
sense of this whatsoever let's make sure
there's no fill let's make sure
strokeweight is just one and let's lower
the resolution against boy I business
drives me crazy I want to have a
variable so I'm gonna call this variable
resolution and I'm going to call it and
say it's 1 and then I'm going to say 42
40 divided by resolution for T divided
by resolution we can make this a float I
guess and then I'm going to say with is
w times resolution so this way
Ono's this this needs to be in it okay
this way this should be exactly what I
had before
and then it's hard to see and then if I
change this to 2 I should be able see
the emitter if I change this to 4 we can
see okay so this is not right obviously
it's drawing some crazy mutant triangle
strip thing that's not right so what's
the issue here the main thing is that I
that I think will make this a lot easier
to deal with is that I right now that
loop the the columns is on the outer
loop so it's actually exactly saying for
every column go through all the rows I
could have the triangle surface code
town but to me for whatever reason I
mentally think of it going across so I
actually want to have the columns in the
inner loop so I say for every row go do
all the columns but do the column and
it's really for every why do all the X's
and do the X 2 dou x + y &amp;amp; x + y + the
next one so in other words what I'm
saying is I don't know if that was clear
but I want this to be in here just the
way I'm thinking about it and then what
I want to say is give me two different
Y's like give me y1 I should I need all
of them
x1 why I need x1 y1 and z1 and then I
need the one that's right below it right
because the triangle strip is going to
connect to the row that's below so I
need to say then x2 y2 z2 and what is
the one below J plus 1 J plus 1 J plus 1
so then I can have another vertex
two two two okay so I have two vertices
and now let's take a look at what this
does look array index out about oh of
course
so what's the problem here I can't do
the last row anymore because every every
row I'm looking at two so I have to say
J's lesson rows minus one that'll get
rid of that error and you can see okay
so this kind of looks right but there's
all this stuff like connecting back to
the beginning so the thing is the
triangles trips each row has to be a
distinct to unit so even though I said
begins shape at entry for the whole
thing and when I get to the end when I
get to the end over here it has to
connect all the way back to the
beginning now I still try to do
something clever where it kind of wraps
around but what's going to make it much
simpler is I can just say let's actually
begin the triangle strip for every row
and end the triangle strip for every row
and now you can see that I now have this
whole flag is trying to strip but we're
really close now and I can go back and I
can change the resolution to two and we
can see still the same thing this whole
flag as triangle strips so now what do I
do
here's the good part now what I do is I
need to load the image so it's time to
say P image unikitty then I'm going to
say I don't know why I'm looking at the
bottom unikitty equals load image
unikitty dot jpg and that file just has
to be in the data folder for the
processing sketch which you can see that
it is right there
and now I can say right here texture
unikitty and all I need now are the UV
coordinates so what are the UV
coordinates
well you is a value X what is I and J I
goes between zero and columns and the
image pixels go between zero and
unikitty dot width now I could use
normalized texture coordinates so that
this just goes between zero and
it probably makes things easier it's
kind of nice to do that maybe I should
do that what do you think I'll do that
and let's say texture mode was it normal
this way I can just do this I don't
really need math even I could just take
I and divide it by so this actually
makes things simpler because I can take
AI and divided by column whatever I'm
gonna keep map which I which has
arranged between 0 and columns now it's
an app that between 0 and 1 and V which
has J its range between 0 and rows to
have also between 0 and 1 so now you V
and then the next vertex all I need to
do is redo J and ask for J plus 1 right
because I need the V you can be the same
right it's the same X values but I'm
looking for the pixels in the row below
so V has to be J plus 1 and NZ here oh
my goodness I'm in front of my code so
so so I think this should work rows
minus 1 this is a good point
it really should be called as minus 1
and rows minus 1 I think that's right
rows minus 1 because the arrange is
actually if there's 10 columns the range
between 0 and 9 I think that's right
so I'm going to say V 1 I'm going to say
V 2 V 1 and V 2 so now if we run this we
should see unikitty on the flag there we
go
this is so exciting so unikitty is on
the flag now what we can do is put the
physics back on I need a unikitty song
to play and now we have the unity flag
there is the unikitty flag all of a
sudden it's not stretching out so much
what does I do that seems less crazy
than it was before
and by the way now I really want to just
take off this this one would be a little
bit nicer if I had a non square image
that it could make a little bit wider
also and then the columns and rows
wouldn't have to be equal because a
square flag is a little bit strange
but I'm going to say no stroke I would
really like to maybe increase its wind
or whatever but I think I've done so
here we go you can make your own
creative version of this
it's the unikitty flag I took a
beautiful drawing up in unikitty I have
textured it onto some geometry in
processing I added some physics with the
toxic woods library and it is the
unikitty flag thank you very much and I
will see you good night that's my last
coding challenge ever I feel like what
else could you possibly ever want to
make after this I'm sure I'll be back
I'm very tired right now you're watching
this in the future where it's just like
one video but this is the I'm live
streaming today I mean my our number 5
so see you later in the next video
sometimes I have a good day evening
morning whatever time it is for you go
get somebody a hug
draw a unikitty talk to you later</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>