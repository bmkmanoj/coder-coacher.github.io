<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>12.2: The Depth Image - Kinect and Processing Tutorial | Coder Coacher - Coaching Coders</title><meta content="12.2: The Depth Image - Kinect and Processing Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>12.2: The Depth Image - Kinect and Processing Tutorial</b></h2><h5 class="post__date">2015-11-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FBmxc4EyVjs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello have a prop in this video I'm
going to look at how do you use this I'm
gonna actually look at the code for
using this Microsoft Kinect in
processing using the open Kinect for
processing library now one thing I want
to mention it that I did not mention in
the previous videos that is if you
install the open Kinect for processing
library you need nothing else whatsoever
it just works with the Kinect there is
one exception on Windows 8 with the
Kinect version two you do need to
install an extra driver Lived Usk I will
put that in the description below
but so this is the Kinect version one
model 1414 it would work with this
example but I'm going to show you
instead I have the Kinect version two
over here and you can see the only code
that I filled in so far is having a
variable called connect to so if you're
using the Kinect version one the only
thing you would change this code would
work mostly identically is just say
Kinect instead of Kinect 2 so it's not
connect one and connect two it's just
connect and connect two I'm pretty sure
about that I get that wrong somebody
will correct me ok so uh let's look at
how you get started so I filled in a
little bit of code but the only things
that you need really to get started are
an import statement at the top that
import statement is saying hey I'm here
to use this library you need to declare
a variable this variable is going to
like hold all the information about this
Kinect that you are using so it's the
thing that you're going to create and I
create it by saying new connect to this
now there is a way to use multiple
connects to use a version 1 and version
2 to specify which connect you want to
use that's beyond the scope of what I'm
doing here in this video I'm only going
to look at you just have one connect
connected to one connect connected to
your computer it's the default one all
you need to do is say equals new connect
to this so once you've got that going
what is the next step well you need to
decide what it is you want to do and in
this example all I want to do is use the
depth image so I'm going to say in it
depth so the connect the connect does
the library doesn't start all over the
fiends automatically it's not going to
start getting the infrared image the raw
depth the depth image the video image
it's only going to start using what you
asked for
so in this case I want to say in it
depth and then I also want to say in it
device which will kind of get things
going and by the way this is where if I
had multiple devices I could put an
argument in there and say and it device
zero one or two that type of thing so
once I have that I'm ready to go and I
can run this program and we will see
nothing on the screen so but a lot of
stuff like spit out here which is kind
of promising device firmware serial the
library is going to like put a lot of
stuff in the console which is some basic
information that you can see if it's
working it will say like no nothing
connected if you if you if you don't
have it connected I realize that some
other things I forgot in the first video
but that's okay okay so what's the next
thing that you want to do so let's just
make sure things are working one of the
things the connect gives you is that
depth image because I set in it depth so
in it depth there are two ways I can
look at the depth I can look at the raw
depth values with the connect version -
these are numbers between 0 and 4500
with the connect version 1 these are
numbers between 0 and 2048 these relate
to millimeter measurements but what I
want is get depth image and you can see
I would I'm you doing here is I'm asking
the connect to give me this depth image
and store it in a variable called image
and now what I can do is just draw that
image on the screen to make sure things
are working so we can see here and there
it is so there is the depth image you
can see I've got it and now it's on the
screen so this is the goal of the
library it's pretty easy to work with in
terms of just getting the data so let's
think about what you might want to do so
I think most almost all of the almost
everything that you would do where
you're working with the raw depth data
or with the depth image involves
iterating over all the pixels you want
to look at all the pixels and see which
ones are the ones that are closest you
want to look at all the pixels and see
what's the highest point of the closest
thing or you want to look at all the
pixels and say what's the sort of
topology of the entire thing so all of
those statements I said involved look at
all the pixels so before I get to doing
anything here let's talk about what it
means to look look at all look at all
the pixels so this is something that
I've covered in some other videos a
whole set of videos about
just image processing from you know
JPEGs pngs
webcams that sort of thing and you can
refer back to those I'll make sure I
link to those at this moment of the
video but just to remind you if you have
an image whether it's a depth image or
an RGB image that image is a grid of
pixels and we typically as human beings
look at this there's a thing that's
two-dimensional and it has a bunch of
columns and it has a bunch of rows and
usually we think of the columns as the X
values and the rose as the Y values so
you might think of this as like the
columns numbered like there's five
columns numbered 0 through 4 and there's
four columns numbered 0 through 3 and so
if I were over here
this is pixel 3 comma 1 so this is how I
think of pixels and images and this is
the that's this image over here this
depth image is a big grid of pixels
columns and rows the thing that you have
to remember when working with stuff like
this is that the computer is actually
storing all those depth values all of
those brightness depth values in this
singular one dimensional array 0 1 2 3 4
5 6 7 8 9
etc and those numbers correspond like
this the counting goes across comes down
here comes down here comes down here so
you can see I've got 20 pixels because
I've got a 5 by 4 grid 5 times 4 is 20
the pixels are numbers 0 through 19 so
what we need is a methodology for if
we're thinking of the X Y how do I
convert that to the location that's in
this one dimensional right the index
into that one dimensional right and the
formula for doing that is X plus y times
width and you can see how that works
because if I look at this column index 2
over here 2 plus 5 is 7 7 plus 5 is 12
12 plus 5 is 17 so the width defines
those numbers as they go sort of down
row by row by row so if I say 3 plus 1
times 5 that's 3 plus 5 which is 8 and
you can see that's 8 right here
so this is the formula that you're going
to have to get used to because what I'm
going to add is loops I'm going to say
loop through every column and loop
through every roll row to look at every
spot in this depth array so if I come
back over here we can now add that to
our code so for example I can say right
here for every X from 0 to and I'm going
to say image dot with not I and I'm
going to say for every Y and again if
this this idea of a nested loop is
confusing to you I would refer back to
some previous videos about image
processing but what we can see what I
would like you to see here is how this
is the loop to say I want to look at
every single depth pixel so it could be
I want to search for the closest one I
want to search for the for the farthest
away one right or I want to just
visualize every pixel in 3-dimensional
space so for every X from 0 to the width
for every Y from 0 to the height and now
what I could do is say what is that
index how to apply that formula now X
plus y times image dot width and then
the color is the color that's in that
pixel even though it's a depth value
it's turned into a grayscale color is
the image pixels at that index so this
is now a loop that you will see in just
about all the examples I intend to make
today where I'm looking at every single
pixel and finding its index into the
depth the the into that depth image and
pulling out the color that's there so
what might I do with that I could make a
point in three-dimensional space let's
do let's okay let's do something here
let's turn what we're seeing on the
screen
we run this let's turn this into a lower
resolution grid
so let's look well what I'm going to
change this program to do right now is
just look at every 10 pixels or every 20
pixels and draw a rectangle with that
particular color there so let's do that
real quick and I'm going to say so one
thing I'm going to do is I'm going to
change this to brightness I'm just going
to
look at the I'm going to look at the
brightness of that pixel which is just a
single value between 0 and 255 and I
want to draw a rectangle at X Y now I'm
going up by one pixel so what I want to
do and you'll see this in some of my
examples is I want to introduce a
variable called skip and I'll say skip
equals 20 because that's how many pixels
I'm going to skip instead of looking at
every single pixel right now and look at
every 20 pixels and ever then I'm going
to draw a rectangle at every 20 pixels
and I'm going to fill that rectangle
with that particular color so if we run
this we should see exactly what I had
before but just it's much lower
resolution so that you can see I'm still
looking at all the pixels finding its
color from the from the pixel array and
then drawing a rectangle of some size
arbitrary size 20 at that spot so you
can see as I move around in front of the
Kinect you can see my hands here and you
can start to see like ah this is the
kind of thing that computer vision wise
it might be easy to pick out my hands as
the sort of singular blobs of black
shapes up in front so okay so this is
getting us started now what's the thing
that you might want to do next let's
think about how you might turn this now
into something that's three
three-dimensional so what I might do
here is say like first of all I want
this program one thing I should note by
the way is the Kinect the depth image
that you're getting from the Kinect
version 2 has a width of 512 and a
height of 424 with the version 1 it's
actually 640 by 480 which a little bit
strange that it's higher resolution but
it's a little faster a little more
accurate here I guess there's like this
beam of sunlight coming in which is so
lovely ok so I'm going to add P 3d
because what I want now is for this
program to actually start rendering
something in 3d the other thing that I'm
going to need to do is add push matrix
and pop matrix because what I want to do
is not is set the location of these
squares not by the coordinate of the
rectangle but by through a translation
because ultimately I want to translate
along the 3-dimensional axis so I use
matrix and pop matrix to save and
restore that transformation state these
might be concepts are unfamiliar to you
I will refer you to a different video
about transformations but you can see I
have the same exact thing here so
instead of drawing the rectangle at X Y
I'm now translated X Y and drawn the
rectangle at 0 0 why am I doing this
because now I could add something I
could add a Z here so the first thing I
might try is just say ok well what is
this Z let's make this Z equal to
brightness and you can see here what do
we got we've got as I it's kind of hard
to see but you can see some some
rectangles are further in front than
other ones that are further away so the
brighter ones are closer and the dark
ones are further back this isn't really
this isn't really doing me any good
because actually I think what might make
more sense is to have the closer ones be
four forward and the further ones way be
one behind so I want to essentially
position all these rectangles about
where they actually are in physical
space and so to do that I might do the
map use the map function right because
we know the brightness has a range
between 0 and 255 but what I want is to
now have a Z value this Z value that's
coming out of the screen I want things
that are dark to appear close and things
that are bright to appear far away so
maybe I'll have the things that are dark
to be at 150 units along the z axis and
the things that are bright to be at
negative 150 so I'm taking that range
that's between 0 and 255 and flipping it
to have it map between 150 150 and
negative 150 and then also let's draw
those rectangles a little bit smaller
and honestly I think it might make sense
to also just make them all white so
let's sort of see what we get here oh
and I have the image behind it well so
you can see here as I come forward boy
this is uh this isn't the best
demonstration let me let me do something
here first let me let me comment out
drawing this image and let's let's leave
the colors back in but let's let's
invert the colors
going to do that way try to make this a
little bit better so you can see here as
the problem is there's this wall here
which is what you're seeing there I'm
something else is coming up and skip
this version of Java let's see if I
could turn the Kinect a little bit this
way and you can see as I go back you can
see as I come forward we're getting
these slightly larger larger rectangles
now there's a moment actually where the
Kinect stops seeing anything and that's
if I go way too close to it but it's
since it's giving me a value of zero
it's actually still working here so you
can see that as I move the hand that
things are coming closer and maybe this
range isn't so great I should have
practiced this beforehand so let's like
make that range a bit more extreme and
you can see this is getting a little bit
better now so you can see as I come
forward these rectangles get a little
bigger there's a lot of noise here I
don't have this Kinect in like sort of a
nice spot because there's all this other
stuff in the room like this wall this
table and this laptop but I'm kind of
you can kind of see my form here and my
hands there as they come forward so this
is the basic idea of how you might start
working with the Kinect I'm going to try
to show you some more practical uses of
the Kinect and the next set of videos
but this is the basic idea of looping
through all the pixels looking at their
brightness value and mapping it now the
truth of the matter is if I was really
doing this what I probably would want to
do is actually just look at that raw
depth data if I'm trying to visualize
the data in 3d this is not exactly the
quote/unquote correct way of doing it so
that's what I'm going to show you in the
next video how instead of using the
depth image how you make make use of the
raw depth data those numbers which are
between 0 and 4500 okay thanks for
watching and I'll maybe see you in the
next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>