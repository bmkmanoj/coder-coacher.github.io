<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>12.3: Connecting Client to Server with Socket.io - WebSockets and p5.js Tutorial | Coder Coacher - Coaching Coders</title><meta content="12.3: Connecting Client to Server with Socket.io - WebSockets and p5.js Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>12.3: Connecting Client to Server with Socket.io - WebSockets and p5.js Tutorial</b></h2><h5 class="post__date">2016-04-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/HZWmrt3Jy10" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">part three of making a collaborative
drawing canvas thing in the browser with
p5.js node and sockets so where we last
left off was we had a node server
working with up so cut this code we had
a node server using Express to host a
directory and in that directory was a p5
GS sketch the thing that I need to add
is now that socket connection between
the sketch and the server so that if I
have another sketch I can have messages
going between the from one client to the
server to the other client so let's see
how we get that working so the first
thing I need to do is add the socket IO
package to my what you might call it
node package application thingamabob so
if I go back to terminal I want to say
NPM install socket dot IO
- - save that's going to install socket
IO install install install and you
should see now here in package.json we
now have added socket dot IO as a
dependency for this particular node
application so now that that's there and
I go back to my server I can now start
doing stuff with sockets so the first
thing I want to do is say a socket
equals require socket IO so this is like
an import statement in the same way that
I wanted to use Express Express equals
require Express and now I want to say
socket socket equals require socket IO
now what I want to do though actually is
open a create an actual socket that's
part of this server so the server that's
listening on port 3,000 that's in the
variable server now I have access to
this socket library which socket is of
course a function and so I'm going to
call this variable IO it's going to be
the thing that's going to keep track of
inputs and outputs messages in and out
and I want to say socket I'm going to
call the socket function and give it the
server as an argument
so I've imported the library and the
library exists this looks like a big
function I call that function with the
server that's listening on port 3000 and
I've got that in a variable now once I
have that I want
start dealing with certain events and
the main event the first event that I
just want to deal with is if I have a
new connection so I think what I do is I
say IO dot on connection so sockets work
based on different types you have to
write the idea here is that there's this
socket that's a connection and in the
way that everything in JavaScript always
works is like there's an event and this
code is the stuff that happens when this
event is triggered events for sockets
are like hey I'm connected to you so
that's an event another event is hey
here's a message another event is oh I'm
disconnected now so these are all the
events the first event I want to deal
with is just a new connection event and
I want to have a function to handle that
event and of course I could put an
anonymous function just inside right
here but I'm going to try to make things
a little simple and explicit and I'm
going to say new connection and so that
means and this is wrong I go look up in
my answer key IO dot sockets dot on I
knew I was missing something so I need
to I this is the syntax for that I have
my and did I get the other stuff right
yes I did okay so what I need to say IO
which is the object now the whole
input-output object that's created by
that socket function I want to go inside
that object to this thing called sockets
call the function on to set up a
connection event and I'm now going to
say function new connection and what is
the thing that is exists when there's a
new connection a socket so an argument
is placed in that function and I could
say something like you know console dot
log socket let me run this server now I
am running the server my socket server
is running okay the socket server is
running I'm now going to go into the
breasts here we go into the browser I'm
going to refresh this page going to
connect with a socket I don't see
anything so here's the thing I can set
up a socket server all I want to wait
for connections
but I've also got to write the code in
the client to connect to the server like
let's go back and look at my client code
I don't see anything in here about
connecting to a socket so here's the
thing that I need to do I need to also
have a reference to the sockets library
in the client what libraries is so
socket died let's so let's let's this is
this I'm already confused and I
supposedly know what I'm doing which I
don't really but you know whatever
um so I can look at socket dot IO go to
the socket IO website come on internet
don't fail me now
and you can see socket 1.0 is here and I
can go down and there was something that
I was going to look like and go to
download ah so here right so there is
both a socket IO server and a socket IO
client
this is what I need I need the socket IO
server to run here already written the
code for that now I need socket dot IO
to run on the client so I need to add
that to my client code and one thing
that you'll notice here is a quick way
to do that is actually just to copy this
line here which is referencing the
socket IO JS library via a CDN content
delivery network so I could download the
file and put it in my libraries folder
but this is going to be a little bit
simpler so I'm going to do that and then
I'm going to go to my index.html file
right this is where I'm referencing
library excuse me p5 libraries p5 Dom
libraries p5 . sound let me now add
another line of code here that just
references socket IO so now I'm
referencing that socket library I can
once again hit refresh let's open up the
browser console nothing there nothing
there right I've got the library but now
I need to write some actual code it's so
sad when you just like can't remember
what the code is to write good thing I
already have the example prepared so I'm
going to go to my sketch KS I'm going to
go to the one that I did earlier and I
know that I need the thing that I need
is to create a variable called socket
and
and in setup I want to say socket equals
socket IO connect and then what do I
want to connect to Hey
oops back after a mistake that I
couldn't see which is now quite obvious
to me for some reason I wrote localhost
calm here there should be no calm
localhost is the full name of my local
computer I could also write by the way
the one 27.0 dot zero dot one which is a
special reserved IP address for a local
computer but I'm going to keep that as
localhost so once I now am connecting in
my client I should be able to hit
refresh here and go here you see all
this stuff spit out now so here's the
thing what did I do in the code if in
the server code I said right here in a
new connection console dot log the
socket object the socket object has a
ton of metadata associated with it you
know the IP address and all sorts
information about what's been what's
connecting one thing that I'll do here
is just and we could evaluate look at
all that stuff but that's the sort of
for another day perhaps I'm going to say
socket dot ID and I'm going to say new
connection socket ID so this is a nice
way every single new connection to a
webserver new socket connection to the
server gets automatically assigned an ID
number for tracking it over time that
might be something you make use of so
I'm going to put that in here I'm going
to run I'm going to I'm going to run the
server again I'm going to go back to the
browser I'm going to hit refresh and we
should see new connection I don't know
why I got two new connections I probably
by accident still had it open but then I
can go open up another browser window
and another browser window and another
browser window and you can see all of
these connections are coming in so all
of those instances are all connected to
the server all with a socket connection
so we are in good shape now we have
added the socket dot IO library to both
the client and the server let's review
that for a second in the server we need
to require socket IO can
to this particular web server and write
a function to handle new connections in
the client we need to make sure we've up
sorry imported socket IO J s in the HTML
file and we also need to make sure that
we create open a connection to the
server that has the socket server on it
so that sort of concludes the add
sockets to your thing and the next thing
that we need to do the very last piece
is we want to add code from this client
to send a message to the server we want
to add code to the server to receive
that message and send it out to all
other clients and that's what I'll do in
the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>