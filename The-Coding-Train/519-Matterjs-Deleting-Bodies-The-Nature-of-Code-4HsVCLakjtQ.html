<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>5.19: Matter.js: Deleting Bodies - The Nature of Code | Coder Coacher - Coaching Coders</title><meta content="5.19: Matter.js: Deleting Bodies - The Nature of Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>5.19: Matter.js: Deleting Bodies - The Nature of Code</b></h2><h5 class="post__date">2017-03-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4HsVCLakjtQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay I'm back for more matter is it
mattered is to me to make a nevermind it
was gonna worse than it did okay so what
I want to do this is what I left off in
the last video and the thing that I want
to add to this is a mouse constraint but
you know what there's so pigman I really
should add first which is that even
though there's all of these parts all
these I'm going to call the particles
circles and they leave and then I add
some more I've never actually told my
code or the matter digest engine that
those circles have left the screen we
can now ignore them so it's going to
start to run very very slow after a
while so first of all let me just change
something here to demonstrate this which
is to say instead of adding circles when
I drag the mouse I'm just going to every
time through draw I'm going to add a
circle at the top and just so there's
going to be a new circle every frame so
now it's doing this automatically and
you know I kind of want to move that top
a little further down it's really a good
reason to do this but let's do that yeah
so this is a little better to sort of
demonstrate just logistics so now I move
that a little bit down so we can see
after a while I'm sure this is going to
start running very very very slow so two
things I need to do
number one is I need to remove those
objects from my array when they're off
the screen but number two I probably
also need to tell the physics engine
stop trying to calculate geometry with
them so I know how to remove them from
my array so let's do that first
so here in this this is where I'm kind
of looping during drawing all of them so
I can write add some code something like
if circle dot is off-screen then uh then
circles dot splice I comma one so what
what is what is this doing so this is
the idea here if not if circles index I
if this particular circle is off the
screen then I'm done with it
and slice is a function that were moved
and objects from an array so I want to
remove the I object from the array and
only want to remove one object so this
place allows you to remove like I and
the two after it if I want
but I don't want to do that here so it's
off-screen this will just work right no
it is no idea what is off-screen is
that's not some sort of function that
exists but it's something that I can
write so I go into box j s which really
should be called circle J s I can write
a function call is off-screen and what
do I want to do well first I want the
position of the particle so I could save
our pause equals this body dot position
and now I can say you know there's a lot
of things like evaluate if I'm just
going to do something really easy if
pause dot Y is greater than height plus
like 100 like it's not only at the
bottom it's like 100 pixels below the
bottom then return true and yes yes yes
yes actually so let's do this here
everybody always to place I like this
right silly code like this just to
really kind of illustrate exactly what's
going on if this is true return true
otherwise return false but notice the
way just so that if this is true or turn
truth that's kind of silly this whole
thing evaluates to true or false so
something I can actually do to make my
code a bit more concise it's just return
what this evaluates to so return true or
false is pause y greater than height so
so now we should this should kind of
work and it's actually I'm expecting it
to work so let's just look here at what
was it's called circle dot length 144
145 so that's it's got to be working
right if it's 145 now oh whoa look
what's going on see all this like crazy
flickering what's that's licorice so
this is why you need that what I've done
there's a flaw in what I've done a major
flaw and I do have a video where I go
through this but I'm going to mention it
right now because you don't want to go
find another video so what's the issue
here I'm going to I'm going to do a
quick explanation let's say I have an
array and it has circles in it
a B C D and E and C is actually the one
that's off the screen
C is the one that's off the screen a B D
etc are all on the screen so I checked
zero oh it's on the screen I check one
oh it's on the screen
I checked 200 it's not on the screen
anymore
delete it so I remove it from the array
you know what happens when you remove
something supply something from the
array this is what happens to the array
not those two elements move down one
that's gone so now check three it's fine
what happened I checked a BC and then I
checked e I never actually check D
because when I was checking index two I
removed it and then D slid in the next
two so I just went on check E so this is
what's happening I'm kind of like
skipping them and then I'm also like not
rendering one because it like moves
didn't get rendered which is why it's
flickering so what I actually need to
did a bunch of ways I could resolve this
I'm sure there's like a very fancy
JavaScript using some kind of
sophisticated array function that you
let me know in the comments but a quick
way I can do is just go through the
array backwards I could also do
something like just say I - - like let
me just back up one let's add that into
the code and now we should see we don't
see that flickering problem anymore
because I'm not skipping any so but I
could also loop through the array
backwards and now I could just check to
make sure this is working
you know it's growing but then it went
down so definitely things are being
removed now the thing is though I only
remove them from I only remove them from
the visitors the array
I think matter - jess is still thinking
about them it's still the world matters
like this world is full of circles so
I'm going to figure out if they're
bouncing even though if they're like
thousands of pixels below the screen so
I don't actually know how to do this
let's look at the methods of chess
documentation ah removed generic remove
function removes one or many bodies
constraints or composites to the given
composite optionally searching its
children recursively oh so there's all
this kind of like ways that the bodies
can have relationships that things can
be like sort of tethered together if I
remove lunch I remove all the other ones
but we're not in that sophisticated of a
space right now so I'm just going to say
I think what's going to work is if I go
to box if it's off screen what I might
want to do
is also do something like circles
because I might only do this in other
place like remove from world okay you
guys could think of a better function
name for that remove from world so this
got removed from world equals function
and I'm just going to say world dot
remove world this body so I'm pretty
sure that that and there's a way that we
can test this actually so let's let's
run this so there's how many I probably
shouldn't have let's hold on let's let's
first comment this out so right now I'm
not calling my own remove from world so
I am going in what if I get rid of these
console logging things that are
polluting my probably in the boundary
yeah sorry
okay so there's my array which is called
circles 136 now there's also an array in
matter which I believe is probably
bodies or no world dot bodies I think
the world itself keeps track of
everything that's in it that's an array
dot length nine thirteen quick circles
dot length one forty seven so you can
see matter digest thinks there's nine
hundred thirteen things whereas I think
there's one hundred forty seven so now
what I should be able do and let's be
more precise about this actually let's
just in draw let's console.log B's
console.log circles dot links and then
what did I say a world dot bodies dot
links so let's look at both of these so
we can see that they're kind of working
together until they start to leave the
screen my I'm deleting stuff but this
just keeps going up and up and up and up
not so now what do I do if I put back in
my function where I am additionally not
only removing it from my array but
telling matter digest to remove the body
itself I think we're going to see this
now be correct and there we go right
wait hold on it's not exactly in sync I
mean it's a little bit off why is it off
oh look at this oh boy oh boy
something weird a seven look at this
weird bug certain ones have stopped and
been removed I have a feeling this has
to do with the way that I'm going
through the array oh I know what the
problem is
look at this boy I've been really
careless splice it and then remove I
removed it from the array and there's a
stuff was down and I told to remove the
one after it which wasn't actually
removed from the array so that was a
really bad bug this has got to be first
there might be a different way I could
think about organizing this to protect
myself from that kind of error but this
at least now we should see what we
should see this fixed I mean mouse which
I haven't even done yet okay so let's
look at me refresh here so let's see
here now here we go once they start
getting removed we should see that
they're staying in sync there we go now
one thing you'll notice if I just say no
loop here just to pause the sketch for a
second you'll notice that the thing the
number of things that matter digest
things exist there's always two more
than when I think that's because those
two boundaries so this is this is I
think an interesting question which is
I've introduced a great deal of
redundancy and I'm keeping track of my
like own arrays of stuff but matters
that jazz actually keeps track of
everything itself but I'm doing that
just so I can have total control over
the sort of visual design and management
of the entities and not have to rely on
because I want to keep these things in
separate arrays where as matter that
just the bodies are a keeps everything
in one array but you know there's
reasons why you might not do it one way
or the other but okay so I said this was
going to be that I was going to
introduce the mouse but there was enough
here just in looking at
removing bodies from the world that that
was a pretty good topic for this video
in the next video the next thing I'm
going to add is a mouse constraint where
I can click on these things and drag
them around so I'll see you in that
video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>