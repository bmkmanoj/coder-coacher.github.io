<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Coding Challenge #18: 3D Fractal Trees | Coder Coacher - Coaching Coders</title><meta content="Coding Challenge #18: 3D Fractal Trees - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Coding Challenge #18: 3D Fractal Trees</b></h2><h5 class="post__date">2016-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JcopTKXt8L8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello this video is a follow-up on my
previous space colonization video now I
wish I was talking about outer space
colonization I am NOT I'm talking about
an algorithm called space colonization
which is outlined in this PDF paper here
that you can find a link to in this
video's description and it is possible
with this algorithm to generate trees
like this
so last week time doesn't matter here
but in my previous video I made a
version of this algorithm I actually did
it in JavaScript I'm using a JavaScript
library called p5.js
but I have the same code running now in
processing and I switched over to
processing because the point of this
video is to extend this algorithm into
3d so I want to take and let me run it
here for you I want to take this idea
which is using this branching algorithm
command run please code using this
branching algorithm to take this from a
2d world to 3d so let's let's talk about
how this is has to happen so first
what's the what's the basic idea for
this what's the basic idea behind this
algorithm so the idea of this algorithm
is that you have a canvas and you fill
this canvas with points and these points
are known as leaves so maybe you fill
this canvas with a bunch of points and
then maybe you start at the bottom and
you create a branch segment and you keep
growing branch segments all the way up
until you get close enough to a
particular to some of these leaves then
what the algorithm does is it says okay
any leaf that's close to this particular
branch a segment pull a force have it
become an attraction force so maybe this
one and this one are close so a new
segment is made and then this one and
this one and this one are close to this
one so a new segment is made here but
this one is also close to this one so
another new segment is made so all of
these leaf points become these points of
attraction that starts just pulling out
these branches and you can see that
happen I'm going to come back to the
code and I'm going to show I'm going to
I'm going to change here I'm going to
I'm going to in setup I'm going to say
framerate I'm going to just say five so
frame
five frames per second and we can watch
this happen a bit more closely so you
can see here these branches are getting
pulled and pulled towards all of these
points and as they get pulled towards
these points those leaves disappear now
there's a couple things I want to
mention about this I'm kind of recapping
my previous video but I think it's worth
it before we move to 3d to make sure we
understand all the pieces here so number
one I just want to kind of recap this
particular program has a set of objects
it has a leaf object that are these seed
points here it has a branch object the
branch object being these particular
segments all of these segments and then
it also has a tree object and the tree
object keeps track of an array of branch
objects and an array of leaf objects so
the algorithm goes something like for
every leaf see what branches are within
a minimum and maximum distance and add a
force to those branches and then all and
then have all those branches grow a new
branch off of them with the direction of
that force so the tree itself is
iterating through all the leaves then
applying forces to all the branches then
making new branch segments and as leaves
are close enough to a given branch that
get deleted so this leads me to a - an
issue though that I feel like it's worth
resolving in this example before we move
on look at this there are some leaves
that just won't go away they're there
they're stuck there I can find another
one over here is another one the reason
why it's stuck there is that they're
magically somehow exactly equidistant
from a particular branch segment so the
force can never go towards one to get a
little bit closer and then be removed
from the system so I don't know I'm
looking at you internet watching this
video to come up with a solutions for
this problem I had a wonderful solution
suggested by Oliver in the chat recently
which is just to give each branch a
little bit of extra random force to it
so that every once in a while as it's
going that it'll randomly turn and
in that case it'll eventually find these
branches these leaves and get removed so
let's add that here and I'm going to go
to the part of the algorithm where we
add those particular forces and actually
what I want to do I want to do that I'm
going to do that in a different place I
did it before I was practicing this so
this is where those new branches get
added and this is where the branches
Direction gets averaged based on how
many forces were applied to it so what I
want to do right here I'm just going to
try making another random vector and I'm
going to say I'm going to add that so
right before the vector is about to be
right before the new branch is about to
be born I'm just going to give it a
little bit of random motion to it to see
if it can like if it when it's getting
stuck if it can skew towards one of
those leaves so let's run this again
oh and I have the framerate at five so
let me cancel that out let's run this
again come on I don't know why my
command door isn't work oh I'm in debug
mode no wonder ACK
so oh that's way too much look at that
that kind of ruined it it did something
but it's kind of like crazy now so I
probably shouldn't have added it here
okay
so let me let me go back here let's so
let's try to make that not so strong
let's make it really really weak so I'm
going to set its magnitude to something
much much weaker and you can see maybe
that wasn't strong enough so it's still
like I've got these equidistant spots
there so let's make it point one that
seemed to do the trick
ah there's a couple spots that are still
stuck there let's try 0.5 it's a little
less kind of like Kirby and fractally
but it did work so I'm going to just
like try point three that looks pretty
good so I
I've settled on point three is kind of
my number that I want to do so you can
see at least have now resolved that
problem the reason why I wanted to
resolve that problem is I'm going to add
something I don't want to be adding
branches infinitely and the other thing
I want to do quickly to this before I
move into 3d is show you let's do
something that's changed the thickness
of these branches so every branch right
now has a stroke weight of one but what
if branches that are made earlier at the
center are thicker than ones that are at
the edge so a way that I can do that is
right here this is where I'm actually
drawing a line for every single branch
so every single branch here is just a
line between the the branches position
and its parents position connecting the
one that's connected to it to itself so
one thing I'm going to do here is just
change this loop to a regular loop using
index I to branches dot size the reason
what I the reason why I want to do that
is what I want to do now is I want to
say each branch is going to have a
stroke weight so for example if I say
stroke weight n you can see all the
branches are really thick they have a
thickness now of ten pixels but what if
I were to create a variable and map its
index so the older branches are added at
the beginning of the array so it's index
goes between zero and branches dot size
and have that go so the earlier ones
have a thickness of ten and the later
ones at the end have a thickness of one
and what if that is its branch thickness
you can now see we've got something here
where the earlier they are at the
beginning the thicker they are the more
at the outside the less thick they are
and I could like mess around with this
mapping I could just start with five or
six I could actually go down to zero to
get them like much skinnier even at the
end which is kind of so I think this
looks kind of nice and you can imagine
what how this might have what kind of
effect this might have depending on how
you're seeding the points and where
you're starting the root of the tree
okay so I somehow said I this was a
video
all about 3d and I probably spent 10
minutes here just getting ready for that
but we've recapped the algorithm and
we've also made it a little bit better
by adding thickness here and solved a
particular problem and now we can
actually do something that I believe
will be quite simple
in turning this into 3d so let's think
about this so this is what's happening
in a two dimensional plane I created in
the canvas I just created random leaf
points anywhere so what I want to do
instead in 3d is I want to think of the
canvas not as not as a flat plane but as
a sphere so I'm going to create random
points all inside a sphere and then I'm
going to have my first branch the root
of the tree in the center of the sphere
again if you really want to create a
tree what you might do is create some
kind of like ellipsoid in 3d see it all
the points start the root at the bottom
but I'm just going to do something
simple just to get this algorithm
working and then it's up to you to be
creative to try to create a different
set of seed points with a different
starting branch okay so let's come back
over here and see if we could do this
okay so the first thing I need to do if
I'm going to move into 3d is just add P
3d oh I'm not here is just add in size P
3d so what did I just do
I just added P 3d so I want to so now
it's rendering in 3d I can actually just
run this and see like hey same thing but
it's actually in 3d now just so we can
like get a sense of the camera a little
bit better I'm going to add a library
called PZ cam so I've already installed
this library if you haven't installed
this library go to add library under
sketch import library but I've already
installed PZ cam so I'm just going to
click import and all I need is this
import statement at the top then I need
to create a PZ cam object I'm going to
say can equals new PZ cam and I have to
say this so PZ Camp is this library that
just automatically like makes this mouse
interactive camera so you can spin
around and zoom in and out of
scene in a very default way and what I
need to do it I need to say this
referring to this sketch is where I want
this camera to take over and then I also
need to give it a Z value like how far
away do I want to be looking at it so
I'm just going to say 104 right now and
then I'm going to run this and sort of
see what happens
so I can't seem to find like oh there it
is so I'm off one of the things that PZ
cam does for you is it makes 0 0 the
center of the window as opposed to the
top left so here in my tree where I'm
creating the leaves I actually want to
create them I want to create well first
of all I want to create the route at 0 0
and then where I'm creating the leaves
sorry I want to make the leaves not
offset by the center of the window
anymore
so let me just do that and we should see
now there we go now one thing is I'm
kind of zoomed in so I can zoom out and
I could spend but you can see now this
is totally flat this is kind of a nice
effect just in of itself so I still have
my two dimensional space colonizer but
it's in 3d and I want to look at it from
further away so let's make that 500 so
you can see here so this looks exactly
like what we had before but secretly
it's in 3d now so this is actually I
believe going to be incredibly simple
all I need to do is instead of making a
two dimensional plane of leaf points
right I'm not actually let's not call
grow so what do I have here this system
is just a whole lot of a whole lot of
points in a two dimensional plane why
are they that because all I did was make
random 2d vectors so watch how simple
this is going to be random 3d I want to
make whoops sorry random 3d vectors and
I'm going to run it and now you can see
whoa ok so what's going on I made 3d
vectors but I only see two dimensional
points well there's a bit of a problem
here which is that my points are
ellipses so what I want to draw I need
to draw those at their 3-dimensional
location so I'm going to
change this to translate pause that X
pause Y posi and now the ellipse can be
at zero zero and I'm going to say push
matrix pop matrix to make each ellipse
its own thing so I'm going to run this
now whoops let me zoom back out and you
can see now I have this amazing back in
I have this 3d sphere of points now
they're ellipses so as I turn to the
side they're not long they're no longer
facing forward and I could make them
spheres
you know there's any number of things I
could do let's just make them spheres
for a second just for fun what's more
fun than making them spheres I'm just
curious to see how slow this runs now
notices look how slow this runs so I
don't want to make them spheres because
I don't even need to see them for this
algorithm to happen but spheres require
a ton of rendering because each sphere
has like a zillion polygons and I could
reduce the detail in the spheres and
there's all sorts of things I could do
but I'm just going to leave them as
ellipses so I'm going to run this again
and you can see here now I have this so
now all I should build I should just be
able to grow the tree I mean all the
math it's going to be the same whether
it's 3d vectors of 2d vectors so let's
grow the tree again I'm going to turn
grow on and we're going to run it let's
see what happens
if something is working I can see all
those branches happening in something it
didn't fit it but look it's still flat
it's so sad it's still flat so why is it
flat well am i drawing the branches in
3d I probably have a line function
that's just doing 2d so let me go back
to the tree all the way at the bottom
this is where I'm drawing each branch as
a line between the branches position and
its parents position so I just need to
add the z coordinate for these this line
and I got to go all scroll all the way
to the right here to get also be parent
posi so now I should have a three
dimensional line and let's see what
happens it's growing it's growing it
seems to be getting everywhere and now
look at this there we go look at this
crazy
wacky strange shape that I have and I
can zoom on into it and look inside and
scroll around and we could see there's
different thicknesses it's thinner on
the outside now some branches just
didn't some leaves just didn't get
reached and it's hard for me to I'm
going to I can't tell if I have this
equidistant problem anymore I don't
think so I think some branches are just
some leaves are just kind of too far
away so you know there's some ways
around that I could fix Utz with the
these this sort of minimum and maximum
distance like let me make the maximum
distance 200 and I think that's going to
help things so that I think that's
probably going to yeah you can see now I
got to everything so that just by
increasing that maximum distance leaves
that are kind of too far away
we'll get found now here's the thing
there's a bunch of things that I've done
here yeah it doesn't look someone in the
chat rightz it doesn't look like a tree
it doesn't look at all like a tree so
maybe before I go I'll make this look a
little bit more like a tree but here's
really your job so your job is to be a
designer go over here please um so what
have I done all that I have done is
create sort of a default view of the
algorithm working so and think about it
in two dimensions
I made a sphere I filled the sphere with
points and I started with in the middle
and stuff is growing out so really I
almost made this like veiny blood vessel
II like system so if you want to make a
tree you've got to be more thoughtful so
on the one hand I made a suggestion of
what if you kind of create and actually
something like this might work well what
if you this is all your seed points look
like this and then you actually start
the root from the bottom so you need to
come up what's your vault and if you
read the space colonization paper will
give you suggestions what's the volume
where you create all of your seed points
and then where do you start the root so
that's on the one hand going to make it
look more like a tree the other thing
you need to think about is just you know
I just used three dimensional lines
which aren't really there's that a lot
to them so you might think about low
well actually what you want to put our
cylinders for each branch segment
maybe you want to texture those
cylinders with some kind of like wood
looking texture and then you want to add
some lighting to the scene and then
maybe you actually want to put at the
points that are at the end you want to
actually put actual leaves on like
various parts of the brain so I think
there's a lot of kind of visual dressing
that you can add so there is - there's
your seed points how those seed points
are organized there's where you start
the route those things will get you from
the closer to the tree as well as your
sort of visual dressing what's your
lighting what's your texturing how you
drawing the branches are you adding like
leaves attached to the branches that
sort of thing so I would like all of you
to explore those types of things okay
yep the other people are saying it looks
like connections in a brain or a plasma
ball thingy this are all excellent
points so let me at least get you
started to show you where you can make
these kinds of changes so I'm going to
save this as space colonizer 3d all the
code will be uploaded on github with a
link and I also uh and let's just add a
few more things to this before we go so
what I'm going to do is say let me make
the scene that we're looking at a bit
taller so I'm going to make it 900 by
600 we can see I'm sorry I want to make
it 600 by 900 so I want to make it kind
of looks oh my goodness I hit something
my ex in here I want it so you can see I
just want to have my window be a little
bit taller and then what I want to do is
have the leaves start uh I want the
leaves to just go out by like still be a
sphere but I want to offset them so I
want to say Y minus equal like height
divided by two so that should offset
everything up yeah there we go so so
this is what I wanted to do but then I
also want so that's way too much and
then I also want the trees root so in
the tree object the root gets a point I
want it to actually start at the bottom
of the window which is 0 comma height
divided by 2 so I want to start the root
at the
autum so this is a bit more tree-like so
you know how successful this is I'll let
you be the judge of that but you can see
just by having kind of a tree at the
start just by having like a sphere of
points up top and the root of the and
starting the root at the bottom you get
this kind of stalk root like thing and
then it starts to branch out at the top
but again maybe then there's a uniform
distribution of random points now all in
that sphere maybe there should be even
more along the top and less on the
bottom or some type of like cone shape I
encourage you to experiment with it
but this I think will get you a little
bit further into seeing it's kind of
tree like and I just sorry I'm addicted
to spinning around this okay so I think
this concludes this video I'm just going
to let some people are the chat or
asking like what did I do to change so
let me just mention against and I did
that kind of quickly in the leaf object
the leaf object this beginning function
right here this is where the initial
leaf positions are set every position is
a random 3d vector scaled according to
the width of the window which is about
300 pixels and then I'm offsetting it by
height divided by two four so moving all
the Y positions up that's where all the
leaves are sent now where does the tree
begin growing the tree begins growing in
the tree object and the variable is this
root branch so the root branch
incidentally has two arguments the root
branch gets where it's positioned so
zero height divided by two so down at
the bottom and also that vector is the
direction where it starts growing so
incidentally if I were to change this to
this we'd have a problem because nothing
would happen the branches grow the tree
is growing off to the right to infinity
so it needs to grow up so to speak there
we go okay so I look the proximate
growing is really quite lovely and nice
and I'd also be interesting like you
know all those branches are objects what
if you start moving the points after the
fact add some physics to it have it blow
in the wind so many possibilities okay
so this is what
longer than I had intended but this is
hopefully a nice follow-up to the
previous space colonization in 2d video
and what I did here was fix a few things
about it add thickness move it into 3d I
hope that you make something with this
and that you share it with me in
particular add your own kind of visual
design spin to it and look forward to
seeing what you make thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>