<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Coding Challenge #59: Steering Behaviors | Coder Coacher - Coaching Coders</title><meta content="Coding Challenge #59: Steering Behaviors - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Coding Challenge #59: Steering Behaviors</b></h2><h5 class="post__date">2017-02-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4hA7G3gup-4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome aboard the train of coding stuff
here's another coding challenge what I'm
going to do in this coding challenge is
show you how to place points your own
geometry your own designs along the path
of letters in JavaScript using the p5.js
library with the p5 dot font object and
then I'm also going to apply something
called a steering behavior from Craig
Reynolds there'll be lots more
information in this video's description
and I'm going to use steering behaviors
for these objects to find their way to a
target as well as flee the mouth so you
can see the sort of inkling of a
creative possibility here of what you
could make with it and I'm sure you
could come up with more creative designs
reasons for using text other ways of
interacting with other types of sensors
and physicality and so enjoy and enjoy
this coding challenge and I look forward
to hearing from you in the comments okay
I'm gonna get started with this coding
challenge the first step that I want to
do is draw dots where there is text does
that make sense so little bit let me let
me let me explain a bit more about what
I mean here so first thing I want to do
is I want to make a variable called font
and I'm going to just use preload
because I need to I want to I need to
specify a specific font charm it's a
font equals load font and I have already
put in the directory for for this
project I have already put a hold on a
font file mm short binder so there's the
font file so I need this font files name
so I'm going to copy it and then I'm
going to go back here and I'm going to
put that in here so now I've loaded that
font I'm going to say create canvas 800
by 300 something arbitrary I'm going to
say text font font then everything to
say text Rainbows the tool I want to use
a short word because I don't have too
many dots
I like rainbow I think I might use train
to pull the short rainbow so to speak TM
trademarked rainbow so text train and
I'm just gonna say 10 200 and I'm going
to make text size so these are some
functions that are
the p5.js library allow me to draw a
text to the screen I'm gonna say 128 and
then I think if I say fill 255 and no
stroke that will color the text white
and if I say background my favorite
background color 51 that'll make the
background 51 okay here we go yeah look
now I have the word train right there so
I'm gonna move it over a little bit
I don't need probably don't need six
that big of a space 600 by 300 is good
and let's move it over you know I could
align it with the center and all that
but I'm not so worried I just want to
get the basic idea here whoops so let me
refresh that and there's my sketch and
I'm just going to like move it over a
little bit more ah okay so real this
does this part doesn't really matter so
I now have a p5 sketch where I've drawn
letters to the canvas and I want to make
it a little bit bigger and I know I'm
being like crazy here but I'm going to
just say 192 I don't know refresh there
we go ah now that looks right so I've
now got these big letters here now what
I want to do is instead of drawing them
as actual text I want to get all of the
points of the letters so from here
there's lots of created pops creative
possibilities and spots in p5 are loaded
into an object called p5 font and here
you'll see what are some functions
available there's on the reference page
there's text bound so there are actually
some other functions that are available
for p5 font that are not it did you
won't see them in the reference but if
you dig through the source code and look
at some of the examples you'll find it
and I guess it's an open question maybe
should file an issue and discuss whether
some of these functions should actually
be in the reference and maybe it's just
a matter of putting in the work and
volunteering some time to write
reference pages and expand this but a
really useful function and a lot of this
work was done by Daniel how I should
credit him for a lot of its work is to
say I'm going to say bar points equals
font text two points believe the
function is called text two points and
now I can take exactly this so I'm gonna
put that in there and what that should
give me I believe
let's just
along it we can see if this works
let's just see what does this function
give us I'm going to go back here we can
say look it's a big array with all these
objects and what's in each of these
objects and alpha and an x and a y well
I didn't even know it had an alpha in
there an alpha and an x and a y so I'm
just going to make use of the X into the
Y so what I'm going to do now I'm really
soon I'm going to use a for each loop in
one of my videos everybody wants me to
but I just like I'd like old fashioned
and not very good at programming so I'm
just using my for loops just for today
please let me do it just for today get
to that for H new soon okay so I'm going
to say on a point equals points index I
and I'm just going to just make
something that's green so I see it as a
different color stroke wait for and I'm
going to draw a point at point dot whoo
this is bad
look what I just did so this is really
dangerous in JavaScript so I gotta just
make a variable called point because I'm
gonna store something called a point but
I have a function in p5 that's called
point to draw the point so I can't make
up a variable of the same name is
something that I'm using from the
libraries of global namespace which is
why things are typically in JavaScript
libraries quote unquote namespace
meeting I would have to say p5 point it
also just makes things so inconvenient
especially for beginners so here I'm
just going to say PT for point and I'm
going to say PT x PT Y so let's see what
I get now and we can see look at that
look at all these nice green points
these green circles that are tracing the
contours now this is amazing because I
don't need to draw the text anymore
right this whole thing was just to see
that that worked and oh by the way no
interesting oh it just it kind of used
192 but I'm going to put 192 into this
function the fourth argument I think
it's the font size because what I'm
going to do right now is I'm going to
completely take this out the whole point
of this was I don't need to draw the
text and then I'm going to make these
white and make them a little bit bigger
and we can see there is now the word
train with lots of little dots so what's
exciting about this is I have now grown
with my own algorithm the locations of
all of these vertices in a piece of text
and so from here your imagination can go
wild
I can make them rainbow colors I can
make them you know move and follow the
paths I could have them explode and come
back and shimmer and change the stars in
hearts or whatever you want to do like I
could make the word love and just fill
it with hearts right you could do that
and that would be nice so there's a lot
of possibilities here but what I'm going
to do next is turn these dots into
particles that can move around the
screen and what I'm going to do is maybe
start them in a random location and then
have them find their spot and to do this
I'm going to employ an algorithm known
as steering now I have a whole set of
tutorials that I'll link to this chapter
six from nature of codebook about
autonomous agents and Brayton burg
vehicles and there's always like
inspiration and backgrounds but what I'm
going to do is model off of Craig
Reynolds steering behaviors as a
well-known paper from 1999 steering
behaviors for autonomous characters
something like that and I'll link to
that paper that you can read in this
video's description but what I'm going
to do is just move over to the
whiteboard and just talk you through
what the basic idea of steering is if I
have a particle and it has a current
velocity it's a particle I found the
called vehicle because vehicle is a term
from a famous book called vehicle in
this book it's a famous book it's a book
that I like by Valentino Brayton burg an
Italian neuroscientist valve your brake
burg actually this would be a great to
have a whole set of coding challenges
that are to implement great bird
vehicles I got to get to that sometime
but imagine these science fiction like
robots that had sensors and desires and
experience fear or love and steered
around an environment based on those
emotions and simple rules so that's
where that's sort of a background where
a lot of these ideas come from but to
turn it into some kind of
math and code we we have this idea of a
vehicle may be represented as a triangle
and it has a current velocity that's its
current velocity what is this vehicle
had a desire it had a desire to do
something like get some food or run away
from a predator or just like wander
around whatever its desire might be
could we translate that desire into a
vector so let's say it's desire was to
find you know a spot a target we could
translate we could we know its current
velocity and then we calculate a desired
velocity move as fast as possible to the
target the steering force as defined by
Reynolds equals desired minus velocity
so this is an autonomous agent it has
this agent has a perception awareness of
its environment it knows its current
velocity so the steering the force
applied to it the sphere is it directly
to the desired it's the error between
what it desires to do and its current
velocity and this is technique allows
for a much more lifelike and
improvisational quality again to quote
from Reynolds paper so you could imagine
how powerful it is for example what if
it does not what if its current velocity
was equal to its desired velocity then
its steering would be zero it doesn't
need to turn speed up slow down any of
those things what if its current
velocity was faster than its desired
velocity then the steering force would
actually be a force pointing in the
opposite direction trying to get to slow
down so the fact of using a force that's
the error between what it currently
wants to do and its actual current
velocity this is a very powerful concept
that's useful in animating motion of
autonomous agents okay so now we
understand this concept let's have these
agents desire to seek their particular
target so here I am back over here with
my train we should edit that part out
probably but I don't know if they will
just get lifted we don't okay back to my
train okay now back to my train what am
i doing here okay so all
a lot to do all the sudden so one thing
I need to do and it would be nice to
maybe do some of these challenges not
from scratch and just use like a base
object that kind of moves around the
screen but I'm just going to create a
new file I'm going to call it vehicle jf
and I'm going to write a constructor
function to make vehicle objects and the
vehicles they're going to need a
position and that's going to be a vector
again if you're interested you know a
lot of this now I'm going to based off
of you know sort of knowledge of basic
physics engines and vectors which you
can also find in kind of some of my
other nature of code tutorials a
position velocity and acceleration it's
also going to need a target and when I
make the vehicle let's give it an X and
a y and position is target let's also
just start it at that X&amp;amp;Y so it's got to
have a starting position and a target
position okay so now that we have that
and so what I'm going to do I'm going to
attach the functions to the vehicle
prototype as opposed to saying this not
because I'm intending to make a video
tutorial about what prototype is and why
this is a slightly well some say not not
so slight majorly more better correct
efficient nicer way of attaching
functions to objects so I'm going to say
a vehicle prototype update equals
function and I'm doing this because it
commits me to making that tutorial and
I'm going to say this dot pause add this
dot velocity this dot velocity add this
dot acceleration so this is the basic
physics idea of acceleration changing
velocity velocity changing position then
I also need to add a function which is
like show or display to render it and
let's give it a size this dot R equals
eight for example and I am going to use
whatever I just did right here to we've
got a lot of this stuffs I'm sure I'm
going to be forgetting stuff this dot
paws dot X and this paws Y so now I have
some vehicles with some basic physics at
position velocity acceleration a target
and
some updating of their whatever and then
being able to draw it so now what I'm
going to do is in sketch I'm going to
say VAR vehicles equals empty array and
instead of drawing a point in setup what
I'm going to do is I'm going to say var
vehicle equals a new vehicle at point x
point dot y ok so now and then I've got
to put that into the array so vehicles
dot push vehicle so I'm making a vehicle
and for every spot in that in the
pointer path of the font singing okay so
now this should be trains really I mean
come on right choo-choo
okay so now in draw I will set the
background the draws an animation loop
that's part of the p5 library and I
again I could use a for each loop but
I'm just going to loop through all of
the vehicles and I'm going to say bar
I'm just going to say B just to make
things for a shorter for right now I'm
gonna say V update and V dot show so
we're going run this this should look
exactly the same if the first version I
just drew a dot and all the spots now
I'm actually making it object that has
some physics built into it and then
showing it but it shouldn't move yet
because there's there's no velocity
there's no forces so the hit refresh
okay so I've got some errors here sketch
says oh I forgot to reference my new
vehicles ojs file in index.html so I
need to do that if always forget that I
need a song for like it's not as catchy
as this dot reference the new JavaScript
file in index of HTML no does that we
turn into a song probably not okay so
once I do that let's see what I've got
here good and I'm going to get rid of
that console.log that's kind of like
filling up my console I don't really
need to see that move this over here a
little bit clear okay great so now this
is working we've got those dots they're
vehicles now just to prove that this is
doing something let's go into the
vehicles and
say I don't know give them p5 dot vector
dot random to D so I'm going to just
give each one a random velocity so you
can see instantly they're all moving now
how could I have them get back to where
they're meant to be so what I want to do
is implement this algorithm now each
particle each vehicle should calculate a
vector pointing from itself to the
target it should scale it according to a
maximum speed at desires to go at
maximum speed and then it's your
calculate a steering force desired minus
velocity which it will apply to its
acceleration okay so let's do that
so now I'm going to come back over here
and I'm going to write a function
prototype dot behaviors equals function
the reason why I'm kind of anticipating
that I might have multiple multiple
behaviors at play so I could just only
write a seek behavior and then I only
need one function I need a function to
sort of accumulate a bunch of different
behaviors so what I want to do is I want
to save our seat equals this dot seek
this dot target and then I want to say
this apply force seek right so what I
want to do is actually so apply force is
not a function that just magically
exists I need to actually write that
function so each vehicle should also
have a function apply force which
received an argument and then it takes
this dot acceleration dot add that force
so the idea if they're going to be
multiple forces at play we can add them
all into the acceleration and if I'm
doing that the acceleration which
accumulates all the forces every single
frame of animation needs to start from
zero so one thing I can do is after at
the end of update I could say this dot
acceleration multiplied by zero so
that's going to clear the acceleration
so now I have and of course if I run
this now I'm missing the seat function
the seat function I need to actually
finally write something
particular algorithm Kennedy this is be
getting my steps in on my Fitbit oh I
know buzz marketing of products on this
channel Lister sponsoring me I get
redacted product that I using okay so I
did it it up so now I need to write that
seek function vehicle dot prototype dot
seek and interestingly enough I gave it
an argument called yeah it's good to
have it have a generic argument could
seek any target so how do I get a vector
that points from the objects location to
the things seeking okay so the way that
I do that is I say I'm gonna call this
the desired vector the desired velocity
desired equals P five dot vector
subtract target
- disk position so and I kind of some of
these lines of code are getting kind of
long so this is the way you get a vector
that points from position to target you
subtract the two vectors now what should
the magnitude of that beat well what I'm
going to do is I'm going to actually
create a new variables follow this
vehicle and I call it max speed and I'm
going to set it to spot so the idea here
is its desired velocity is always its
maximum speed it is is to maximum speed
so what I'm going to do there so I'm
gonna say then desired dot set mag this
maximum speed okay so now and then I
need a steering forces sphere and what
did we say steering equals desired minus
velocity
this should be easy fear equals P five
vector dot subtract desired minus this
stop velocity return steer the idea here
is that I'm going to calculate that
force and return it because when I get
it up here I can then apply it so let's
see how this goes we should be good well
what did I forget
I forgot to actually call apply
behaviour so I'm going to say V dot
apply or did I just call the behaviors
behaviors I could call it steering I
don't know what would make sense at all
okay so now look what's happening it's
seeking that spot it's doing it it's
very good at speaking it so it's like
finding it move back so I got this like
sort of crazy like frenetic shaking
thing so one thing I should do by the
way is introduce another variable which
would be very useful to control the
behavior of these vehicles and this all
again all comes from Reynolds paper
maximum force so how strong how good is
it it's gear like because right now it's
kind of like an idealized vehicle they
can sphere as well as it ever might need
to be so I'm going to say like point
zero point three is kind of a magnitude
maximum and then when I calculate that
steering force I'm going to say steer
limit this maximum force so what you'll
see here is that steering force won't be
as strong and you can see it's still
doing the same thing where it seeks the
target and then it leaves but you know
and but it's not as good so um you know
one thing that we could see to kind of
like try to have more of a sense of this
well here's the thing this is doing us
basically no good right now because what
I really want to do to implement this
particular idea is I don't want to
implement a pure seek algorithm I want
to implement an algorithm that's known
from paper as arrive and again
everything boils down to desired
velocity and what the arrive behavior
says is please go to the target but not
as fast as possible you want to go your
speed your magnitude of your velocity is
relative to how far away from the target
you are meaning if I'm really far away I
want to go really fast but if I'm really
close I want to go really slow and what
this will cause is if I'm here and I am
going really fast my steering force will
cause me to slow down and if I'm at the
target I want to be going like my
desired velocity is zero
the magnitude so this is going to
instead of having the the object
overshoot it actually slow down and stop
okay so here I come back over here and
I'm going to I'm actually going to leave
seek in there because it could be useful
later but I have an idea of what to use
it for and I'm going to just add a
function call arrive which is exactly
the same argument
factor the same algorithm the difference
is what is the desired magnitude so I'm
going to say if desire so the distance
so the distance is the magnitude of this
right the magnitude that vector is
actually how far away it is because
that's the vector the point all the way
from the position to the target if the
distance is less than I'm going to pick
an arbitrary threshold less than 100
pixels if the distance is less than 100
then I want a magnitude magnitude on the
stage speed to be mapped the distance
which goes from 0 to 100 to what when
the distance is 0 I want the magnitude
to be 0 when the distance is 100 I want
the magnitude to be maximum speed
so I'll speed so I'm gonna so I'm gonna
say var speed this I'm sure there's a
more efficient way to write this equals
this maximum speed and then but if
distance is less than 100 then actually
set speed to be a different value based
on how close it is and then set the
magnitude to this new speed value I've
calculated rather so here's the creative
power you have now you can see I'm doing
with a standard seek and a standard
arrived but you might have a behavior
that you imagine in your head what you
need to do is think through some logic
by which you can convert that behavior
into a desired velocity and it could be
much more complex than this you see just
this little increment incremental change
from seek to arrive now let's see if
this actually works I'm going to change
up here to say arrive equals this
arrived at target and then apply the
arrived behavior so you can see that
this is now kind of working you know
there's some little like goofiness of
maybe there's a little bit noise if it's
sort of like jiggling but looks like
they've all settled into a spot so let's
see if this is really working the way to
know if this is really working is I'm
not going to start them at their target
anymore I'm going to say random with
random height
and now we're going to see them all move
into their spot that's pretty good tada
so on the one hand I could consider this
finished there's so many possibilities
here here's something obviously it would
be cool to try what if you have this
then rearrange itself into new text I'm
going to leave that as an exercise for
somebody watching the tricky thing is
you might have a different number of
particles you may need to split some or
combine some to get more or few more
more or less particles but let me just
do one other thing to it what if I just
to make this I mean there's a bunch of
other things I kind of want to do this
but just to give it something else what
if I were to add a force a steering
force where the particles themselves the
vehicles are afraid of the mouse so what
I want to do is in I'm actually going to
change this seek function to fleet
I'm going to call it FLE and what I'm
going to do is I'm going to multiply I'm
going to limit it to I'm going to
multiply the steering force by negative
1 so the FLE algorithm is my desire is
to move in the opposite direction as
fast as possible from the target rather
than in the direction so I could just
multiply the force in the opposite
direction or you know I guess
technically to do this in the
quote-unquote correct way I would I
would multiply it by negative the
desired vector by negative 1 so I'm not
changing the force this is what I think
it's more accurately depicting the
algorithm for flee by changing the
desired vector point in the object
direction now in apply behaviors I could
say where is this I could say a mouse
equals create vector and I don't need to
create a vector for every object but you
know I could have a global vector that's
the mouse's global variable if the mouse
is location bar mouse equals create
vector of Mouse X mouth Y and now I'm
going to save our fleet equals this dots
Li Mouse and I am going to save this
apply force sleep so now if I run this
you can see like if I just get the mouse
way out
they're kind of like in the stuff but
like they're really just very you
they're never going to find another way
to afraid of a mouse so one thing that I
probably should do is have this flee
behavior only trigger if they're within
a certain distance and maybe even the
magnitude is you know they're based on
that distance but I'm going to do
something pretty simple here which is
just it's probably you know I might want
to leave this intact and not mess with
this and do this part outside of it but
right here I'm just going to say you
know I can get that distance right here
VAR d equals desired mag and I'm just
going to say if Z is less than 50 and I
should make that a variable to all these
things that should make variables then
return that's during force otherwise
otherwise just return create vector zero
zero now again there's lots of
inefficient seems like I don't need I
can have a global variable a zero vector
no need to make cream vector all in
place but this will work and demonstrate
the idea so I only want to have that
effect trigger if what what did I miss
vehicles uncaught sketch vehicle GS line
63 so I have an extra close bracket so
here we go so you can see everything is
coming into its spot and then now as I
move here now and I really you can sort
of see here as I move the mouse I'm kind
of messing with these but very little so
I kind of want this to behave in a bit
more of a kind of radical way and so
something I might more responsive way it
gets radical I don't know I think I
might want to give the maxim speed a bit
more and actually I'm just going to like
crank up the maximum force the other
thing I might want to do is write this
in a slightly different way where I can
now also weight these particular forces
so what if I want arrive to just have a
weight of one but flee to have a weight
of five so I want that fleeing force to
be much stronger than the arrival force
so now everything is in their spot and I
move the mouse around you almost have
this like spring-like behavior I feel
like zooming in on this just so you can
see it a bit and actually maybe it's
better for me
- look do this just to make it bigger so
you can see this will be good for a
screen shot probably if over here
something so anyway so you can't wait
this in the middle of videos like let's
make the thumbnail but so you can see
here now I've got something where the
the particles kind of arrive to their
spot and I can push them around with the
mouse now ultimately I might be able to
make this even more kind of dynamic or
compelling on what the word is but if I
have these also respond to each other so
what if I added a group behavior like
separation I would encourage you to
check out it again some videos on group
behaviors and flocking systems and
there's lots more that you could add to
this but thing to watch out for there of
course is once you have every particle
checking every vehicle checking every
other vehicles location things can
really slow down in terms of the amount
of computation so there's strategy is
there to make that more efficient that I
should probably get it through at some
point but I think this gives you the
basic building blocks so if I'm going to
give you a challenge to do after
watching this I would say number one is
what is your content are you designing
this with circle what's your text why
are you making this could you think
about multiple pieces of text
transforming from you know train into
rainbow into unicorn good uh could you
apply other behaviors path following
would be ones really could you actually
have the vehicles follow the paths of
the letters could you add group
behaviors what other types of you know
reasons you know well you know what what
is this system you're building there's
so many possibilities in terms of design
and color so I hope you make something
from this use the code that's linked in
the description I'll try to make a
processing version of this there's a
library approximate called G immersive I
don't know if I'm pronouncing that
correctly that allows you to get the
path points of text so that's something
that maybe I'll revisit in the future
video as well so thanks for watching
this coding challenge I hope you enjoyed
it and I don't know right train joke
insert here with whistle sing
goodbye so
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>