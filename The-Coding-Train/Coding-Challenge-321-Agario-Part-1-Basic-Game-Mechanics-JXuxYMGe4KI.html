<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Coding Challenge #32.1: Agar.io - Part 1 (Basic Game Mechanics) | Coder Coacher - Coaching Coders</title><meta content="Coding Challenge #32.1: Agar.io - Part 1 (Basic Game Mechanics) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Coding Challenge #32.1: Agar.io - Part 1 (Basic Game Mechanics)</b></h2><h5 class="post__date">2016-08-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JXuxYMGe4KI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to another coding
challenge today's coding challenge is a
gari o agario agario a game that i was
not familiar with until recently when
little ott on github suggested this
particular game I looked it up I played
it for a few minutes it's a massively
multiplayer game created by matias
valadares i don't know if i'm
pronouncing that correctly you could go
to agario and play it yourself but
basically you're this blob moving around
the screen and you eat other blobs now
here's the thing this is actually quite
complex the simple mechanic I think it's
going to be hopefully something easy
that I can implement in this short video
but I'm going to do this in several
stages and so part one is going I'm
going to implement the basic mcCane
mechanic and in part two I will start to
look at how you might oh I might use how
you might use WebSockets
to create a multiplayer version in this
game so this video is just going to be
the basic game mechanic so I'm using the
p5.js framework I'm using the sublime
text editor I have a canvas and a black
background that's all I'm starting with
and I also have a javascript file called
blob KS where I'm going to write a
constructor function to create this idea
of a blob object the blob object will
serve to be both you the blob moving
around the screen as well as other
little blobs that you are trying to eat
so what does this blob need now I'm
going to use vector objects which are
something that exists in p5 a vector
being an object that stores an x and a y
component for a position on the screen
and lots of other things that we could
do with that so I'm going to say this
dot Paz equals create victor vector
victor what's your victor vector with /
- height / - and then I'm going to write
a function called show which actually
instance it's in these object I'm going
to write this dot show equals function
and I'm going to say fill 255 and I'm
going to draw an ellipse at this X this
dot Y and I also I definitely need a
variable to keep track of the radius the
size of this blob let's just make it 32
or 64 to start with so then the size of
the ellipse is the radius times 2 and
the height is the radius times 2 so now
if I go to sketch I can just say var
blob blob equals new blob
blob dot show so let's just see where's
the blob Oh something's going terribly
wrong I'm kind of being silly here where
I forgot the whole point of this was I
made a vector called paws for position
and then I tried to draw it at this X
which doesn't exist so this dot paws X
this pause Y there we go so there we are
in the window now this is something a
little bit crazy as I just realized as
part of this game so I want to move
around the space so but the thing is I
don't in the game this blob that you're
seeing on the screen right here it moves
but visually it stays the same and
rather the world shifts relative to it
so we've got to kind of figure that out
so I'm going to do something else here I
think to help us where I'm going to make
an array called blobs but I need some
better variable names blobs can be just
an empty array and by the way I think
that I should give the blob a variable
in the constructor so I can actually say
how big to make it so I want this blob
to be 64 and now I want to say VAR I
equals 0 I is less than I'm going to add
10 smaller blobs Bob index I equals a
new blob which will be smaller all these
blobs are going to be 16 and then now I
can have a loop in the draw loop where I
call show and all those now look at that
they're all in the centre that's a bit
of a problem so how about we also
something we could do is in this blob
object I could also give it an X and a y
and then I could say here I want this
blob to be this blob to be in the middle
and I want these blobs to be at a random
location
and then the blob is made with that X&amp;amp;Y
there we go so this is where we're
starting we have this idea of one blob
that is me I am the blob and then lots
of other little blobs that are food that
I want to eat so now the way that the
agario works is the blob moves in the
direction of the mouse so let's see if
we can figure out how to make that
happen
okay so what I want to do is add a
function called update and let's think
about this camera one off let's think
about I have some old flappy bird
diagram here that I'm in a race let's
think about how this actually works so
here's the blob and here is the mouse
what I want is I need to create a vector
an arrow that points from the blob
towards the mouse and I want that to be
the direction that it moves so this is
actually quite easy to do because coming
back over here if I know this position
and I know this position if I take this
position minus this position I get a
vector the points from here to there so
I can actually use coming back over here
I can say mouse equals create vector
Mouse X Mouse Y and then they could say
Mouse dot subtract this dot position and
then I can just say I could say Mouse
dot know set magnitude to like three set
magnitude just takes that vector however
long it might be and sets it to a
specific magnitude and then I could say
this dot paws add to what am I doing
this die pod add Mouse so really this is
how I'm calculating the velocity and
whoops we got some errors here blob dot
j s line five
this update equals function oh and you
know what would help if I call this dot
update if I called blob update Mouse is
not defined
I'm calling it velocity now so you can
see how that blob is now following the
mouse here's the thing though it's
moving and not the other stuff so I want
the my view of the world to be relative
to this particular object so how do we
do that
hmm I have an idea what if instead of
what if okay okay okay I'm going to use
the translate function let me come back
over here this is where the object is
and this is where the origin is zero
zero but let's say the object moves over
here what if I move the origin over to
here then we should see it still oh I
know I need to move the origin the other
way if I move the origin over here right
it would be kind of here which would
appear back in the center of our screen
I kind of got lost in my own thoughts
there basically what I want to do is
it's moving over here but I want to
shift the view to be over there and the
view of where we're seeing everything is
kind of like where is the origin point
in our canvas and translate is a
function that shifts the origin so what
if I just said right here translate by
blob position X blob position dot y- now
I think this is going to be a little bit
off and you'll see why in a second it's
working but the blob is at the top left
so really what I want to do is translate
by the center because that's really
where I want to have the view - that and
now we can see as I move the mouse
around the blob is that always stays in
the center but these other things move
am I doing this right guys tell me in
the chat if this is kind of the right
idea it's not right look is it yeah move
this way move this way move up move down
move this way move this way move this
way move this way it is it's just sort
of sort of strange to see
let's add a lot more of these it feels
like I'm steering it incorrectly okay
people are saying it's right feel a
little off to me but okay the other
thing about okay the other thing that's
a little bit crazy here is that what's
happening now and we're back so I forgot
something as soon as I started moving it
around I forgot that the this actual
velocity is being tracked relative to
the object's position which now is off
somewhere and that it's actually the
mouse and the position in the same place
and all sorts of I actually what I want
now is I need to subtract just the
center of the window so I can actually
just create a vector like this I don't
want to actually in this anymore
subtract the actual position of the
object cuz the position object is
relative the world but the users
interaction is always relative to the
center of the window and so that's what
that's what was messing things up so now
you can see this work work slow now
there's another sort of issue here which
is that the world should really be much
bigger than what I'm seeing actually the
width of the the canvas itself and in
that sense we can kind of do that really
rather easily by saying let's pick a
random X between like negative width and
width divided times two and let's pick
an a y between negative height and
height times two just so we have kind of
like a larger space for the blobs to
live in and so now you can see that as I
move around there's a much kind of
larger world of things for me to eat
potentially okay so I think we're moving
along here we've got the basic gist of
the game okay now I need to add one more
thing here which is that if I eat one of
these if I find one of these other
pieces of blob things that eat it then I
get a little bit bigger I think that's
always it happens in the cave so one
thing that I need to do is when we're
looping through Bob's index I then blob
grows and actually what I want to do is
uh remove that blob so blob index dot
splice zero comma one I find myself
saying this a lot these days I also want
to loop through the array backwards
because I just said this in another
video I made but if I am removing things
from the array as I'm going forward
through the array that the elements
slide backwards and I could skip one by
accident so it's good to loop through
the array backwards so let's see I want
to check if the blob eats one of those
other blobs then I want to remove one of
those other blobs from the array and how
do I determine if it eats it the way
that I do that is by writing a function
eats which receives another blob I'll
call other and I need to check something
I need to know what is the distance
between this blobs X you know it and
actually there is a p5 vector distance
function so I say what is the distance
between this blobs position and the
other blobs position and if that
distance is less than this blobs radius
plus the other blobs radius then we've
eaten it why is that true Guddu
oops I hit the wrong button right if I
have two objects and I check their
distance relative to the sum of the two
radiuses radii if they're overlapping
that sum that distance going to is going
to be less than it if they're not
overlapping that distance is going to be
greater than that son so coming back
over here we can now say if it eats it
then I can also let's say this dot R
gets bigger gets bigger by the others
radius and also return true otherwise
otherwise return false and come over
here to the blob come over here back to
the main program and I think that's
basically it so let's see how that works
oops invalid left-hand side and
assignment on sketch 21 what's Oh blah
blank minus one okay so we should see
here up blobs index i dot splice is not
a function okay of course
what am I doing here this is absolutely
incorrect
I don't know what I haven't eaten
breakfast this morning
clearly I'm kind of struggling here for
my energy I want to splice out of the
array at index I one element which means
remove index one element starting at
index I I don't know what I was writing
before was completely wrong uh blobs
splice it refresh here come on eat there
we go eat eat eat okay so it's getting
quite a bit too big just for meeting a
blob so let's let's divide that let's
multiply that by like 0.2 and we can see
there we go and I think that what might
be okay I'm back the chat gave me some
nice helpful suggestions a couple things
about how the game actually works one is
increasing the blobs radius is not
actually how the game works and this is
actually a great thing that you should
learn about if you're not familiar with
because we often think of the blob a
circle size as its radius but that's not
really its size the size that we're
seeing is its surface area the area
which is calculated PI R squared so
let's look at that
so let's actually let's fix that for a
second so I'm going to make a variable
called sum which is equal to pi times
this dot R times this dot R plus pi
times other dot R times other R so that
is the sum of the two areas of both of
the blob that's eating the smaller blob
now the new radius should be the radius
that's associated with that particular
sum and how do I get that well let's
think about this really quick if the
area equals PI R squared then R squared
equals area divided by PI and R equals
the square root of area divided by PI so
I could just solve for R with that
particular equation and I can come back
to here no I'm getting a bad at my
switching soon I can come back to here
and I can say this dot R equals the
square root of that area what'd I say oh
no no that area divided by pi so let's
take a look at that
there we go that's such a more beautiful
and elegant interaction now the other
thing that I was told that actually
happens with Dario is that instead of
the instead of you seeing your circle
grow the actual view of the world kind
of zooms out so while you're growing
what you see is you stay the same size
and the other circles kind of shrink and
we can do that in p5 using the scale
function so in the same way that I use
this translate function I could scale
the world by the blobs current radius
divided by what it started with which is
64 so right if it's radius is 64 then
I'm scaling the word world by one so
let's see how this works now the problem
is this is causing everything to shift
to the right which is not great so and
and by the way the radius is getting
bigger so I want to do it the other way
64 divided by the blobs radius I want it
to shrink and so this is working but
everything is kind of shifting up that's
because I unfortunately am drawing
everything relative to the top left so
really what I want to do is I need to
change the whole view of everything for
the blob to start at zero zero which is
better anyway so I want the blob to
start at zero zero let's go back to the
main sketch I want me the blob to start
at 0 0 and the other blobs can just go
from negative width to positive with
negative height to positive height that
should work on it I kind of had that
weird before anyway and then the world
is actually just drawn relative to
negative the blobs position so I'm
always doing everything relative to that
particular blob which starts at 0 0
that's going to make things much better
oops wait wait wait
with / - plus weight I did this wrong
whoa - yeah there we go
wait something is still off keep that
okay there's a there's a kind of an
issue going on here
so um let me think about this let me get
this right here for a second I've I've
done this twice now but hopefully you're
seeing an edited version of this now so
the problem is actually that the first
thing that I need to do is translate to
the center so let's not do anything just
right now but translate to the center so
now you can see this is where the blob
moves freely around and it should be
growing as it eats other blobs now what
I want to do is I want it to I want to
scale it
I wanted to scale it by its relative
size relative its size relative to its
original size so you can see the world
is kind of shrinking rather than the
blob growing but now that I have that I
need to do the scale before I Tran I
offset the whole world then by negative
the blobs x position negative the blobs
Y position so now if I do it in that
order you're good oh whoa I need a comma
there now we can see we have the world
doing what we originally hoped and
intended it to do so so okay so now you
can see that things are very kind of
herky-jerky here and that's because
everything happens instantly the scale
changes instantly the view changes
instantly and it could be nice to have
things massaged a little bit smooth a
little bit and a way to do that is with
a function called mp5 called lerp which
stands for linear interpolation
instead of taking a value in setting it
directly to the new value just want to
kind of move slowly towards that new
value and so let's let's do that with
scale so the new scale is 64 / blob dot
R but I need a variable I'm going to
call I don't want to call it scale
because there's a p5
function called scale so I'm actually to
call it zoom so zoom on is start zoom
equal to one and zoom should always be
the lerp between the value in between
itself and what the new zoom is and now
the last argument of this loop function
I have a whole video about lerp you can
find that video uh if I make it like
point one let's see what happens
oh wait hold on hold on hold hold on
point nine oh wait wait wait I got to
actually put it in there sorry everybody
I got actually used the variable I
created so what I want is I want it to
be just a little bit 10% of the new
value so that I interpolate towards it
and can you see that happening kind of
smoothly let me um so one thing I want
to do just to make this more obvious is
I'm going to just make it a ten times
that amount whoops oh okay wait hold on
hold on I think I had it opposite I
think this should be 0.9 no hold on
let's adjust the way the radius is
growing to try to get a better look at
this so I'm going to change the radius a
bit take away that they're using this
surface area and just actually add the
two radii together and then now we
should be able to see and by the way
there's so many it's actually I
shouldn't allow any of it also like it
eats a lot of blobs immediately so let
me start with quite a few fewer just ten
and so now you can see what happens as I
eat a blob it gets really big
immediately but then the view kind of
slowly interpolates and shrinks so you
can obviously tune these numbers a
little bit better but I'm going to go
back now to the surface area and sort of
see and I think I want to add one more
interpolation here which is just to
interpolate its velocity so that it
doesn't immediately get the new velocity
but rather kind of smoothly turns a
little bit as you move the mouse around
I don't know that agario is actually
doing that but I think that might be an
interesting thing to add so I'm going to
add that here in the blah
object I'm going to say I'm going to
give it a velocity I'm going to give it
a variable velocity create vector and
it's going to be empty zero zero to
start and then this is going to be its
new velocity and it's new velocity has a
magnitude of three and it's velocity I'm
going to lurk to the new velocity by 0.1
so let's just see how that works is not
defined and of course I forgot always
these abyss guys is a blob dot ten and
this needs this stop velocity so you can
see it's kind of the turning is a little
bit more interpolated now is a little
bit smoother is it still going in the
right direction right so you could play
with that number quite a bit like if I
made this number you know 0.01 it's
turning is going to be quite slow if I
made that number 0.9 it's going to be as
if it turns instantly so I'm going to
just like to use point two and you can
see now there's a lips a little bit
smoother now let's add let's go back to
the original sketch and let's add a
whole bunch of these and you can see
here I am eating them all moving around
and you know as I eat them I should
probably add new ones I've got a little
bit of a performance issue because
there's way too many of them you can see
the scale and really kind of like
zooming out on the world but this is the
basic game mechanic so I'm going to stop
here on this particular video I
encourage you to take this tweak it
improve it a change the design of the
blobs change the size of the world maybe
as an exercise add the feature of when
you eat a smaller blob a new one gets
added somewhere else and see what you
can add to improve this and make this a
little bit better I'm going to do two
more videos this one video I'm just
going to show you how to make this
something that's a little bit blobby so
the vertices kind of undulate a little
bit so it's not a perfect circle I'm
going to do that in a separate video and
then in a third part of this challenge
eventually at some point I'm going to
look at multiplayer networking with this
or multiple people could you play
against each other and consume each
other in this
kind of blob way somebody also mentioned
to me than the actual game the blob
doesn't eat it immediately maybe it has
to envelop the whole thing or they
squish against each other a little bit
so there's some possible also like
additional interesting features I could
think about adding at some point did
this suggest those and let me know in
the chat what I got wrong with this game
and also I'm gonna have to do some work
in the chat bells someone mention about
optimizing this all these square root
calculations are really slowing things
down and there's some ways around that
that I think I could ultimately do to
kind of optimize and make it perform a
bit faster which I'll look at at some
point as well okay so that is part one
of agario game in p5.js coding challenge
I'll see you at a future video good bye
thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>