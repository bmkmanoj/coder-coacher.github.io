<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>8.7: &quot;Build Your Own API&quot; Conclusion with HTTP POST - Programming with Text | Coder Coacher - Coaching Coders</title><meta content="8.7: &quot;Build Your Own API&quot; Conclusion with HTTP POST - Programming with Text - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>8.7: &quot;Build Your Own API&quot; Conclusion with HTTP POST - Programming with Text</b></h2><h5 class="post__date">2016-12-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GZ2nwxhQUTU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to another and what might
possibly actually be the last video in
this playlist about how to build your
own API in node so if you remember it's
you might have just watched the last
video but in awhile since I made it so
I'm gonna just kind of set the stage
here very very briefly we have so far an
API made a node that saves words and
asked or a kind of positive or negative
valence the idea that we're gonna do a
sentiment analysis application that
stores those words over time so I have a
particular route or if I go to the
server slash all I can see all the words
that are in a particularly in that
database I also made a little front-end
that if I add a word like kitten and I
give it a score like 4 and I hit submit
and I don't then I can hit refresh here
and we can see now kitten has now been
added to that database now it's not
actually a database it is simply just a
a list of JSON file but the node program
is receiving the word and score from the
client saving it to the JSON file and
loading again for later use so there are
two things in this video that I want to
add to this particular application
number one I want to use that I want to
add a pre-existing list of words and
valence scores and this list is known as
the AIF in 111 so this will just make
the sentiment analysis work a little
better by giving us seating it with a
pre-existing list of words I made a
separate video I went over this in more
detail but which I'll link to in this
but this list comes from this particular
website and was developed by fin Eric
Nielsen and if you use it you should
credit it and there's links and
information about how to do that here
okay so that exists that's number one I
want to bring that list over let's
actually do that first say what the
number two is in a second number two is
I want to look at a post to the API
what's it in between getting posts
that's gonna be part of this video too
so I'm actually just going to absurdly
just do save as and I'm gonna go to my
node folder and I'm going to save it as
a fin 111 JSON and then I'm gonna go to
the server
and we're gonna look at where the server
loads where does the server load that
file right here
var data equals read file sync words
JSON so I also want to load a 'then what
is it for a 'then 111 dot JSON into a
variable called a 'then actually and
i'll call this a fin data and then i
want to say VAR data equals json dot
parse a Fionn data owner so far sorry
VAR a 'then so now my node server has
both the word list that's being saved
and the a fin list now here's the thing
so I think what I want to do is just
change this I'm gonna change this to
additional I think I'm gonna keep these
in separate files because this 8th and
111 is never going to change
and what I want to do is but I'm gonna
call that file additional just to just
for clarification additional and what I
want to do now is in the server so so I
have them as two and I must have a save
place somewhere else so I need to change
this to additional as well where I save
that file because what I want to do is
when it comes time to do this sentiment
analysis I need to look both in both of
those I need to look in the Athan word
list is it there if not look in the
additional word list and and I should
decide if one overrides the other in
this case probably the additional should
override the Athan so I'll look in
additional first okay great so actually
done we did it yay but I guess I could
in all let's look at that all route
again let's here let's actually do
something kind of a little goofy I'm
gonna do I'm gonna say the data is
additional is words and a fen is the
is the effing list so then so I'm
changing the server when you ask for all
to not just give you the the words that
are in the database but look at both of
them so this is just changing the
response of the server and what I'm
gonna do here if you go here now I oh I
have to restart the server web sorry
everybody
I'm gonna restart the server and I'm
gonna do this and we can see now I have
both the additional list and the AIF in
list wonderful okay so now and but this
probably broke this part because it the
way I was parsing I was using that all
route but you know what I'm gonna get
rid of this drawing thing it's sort of
unnecessary right now I just want to
have this word score interface so let's
go back to the client which is here and
let's get rid of the draw data thing
which we don't need to do anymore
because we're gonna do some different
stuff here so I just want to see that
this I know when you draw data anymore I
want to see that this works so I want to
see what's another word that I could add
mmm puppy and three hit submit and we
can see that that worked success
although I probably again should add
something to this page that says thank
you I added that word to the list that's
a great exercise for you but we can just
confirm now that if I go back to here
under additional puppy is there okay so
everything is working but my API behind
the scenes has access to both the full
athan list and any additional words that
have been added notice how things are a
little bit different here I probably
should have been more thoughtful about
fixing this up so that these are
actually numbers and not strings but I
can deal with that later
so okay now the thing we need to change
now is how do we send a large body of
text from the client to the server and
so I'm going to come over here for a
second - - oh boy this camera is all
I'm gonna come to the void and I want to
talk about the difference between a get
and a post so HTTP which stands for
hypertext Transfer Protocol
oh no if that's right it's probably
right there are is a request and
response protocol hi I'm a web browser
could I please I'm making a request have
have some information about where I
could get some nice apples this time of
year and maybe I would ask that to
Google and Google being the server would
say hey here's a response here's some
information and the way that I can talk
to that server in this request and
response protocol you know if we have
server and we have client is I can make
a get request which is like could you
please give me some information back or
I could make a post request which is
would you please take this information
and save it onto your server or do
something with it so if I'm logging in
with my username and password that would
be something I would want to send with a
post request if I want the results of a
search I might ask to use a get request
to get the results back here's the thing
even if even though this is how this
protocol is designed and how it works
you'll notice something in our program a
little bit strange if I go back to the
code for a second you might ask where
are these happening well right here when
I set up a route
I'm actually saying this is handling a
get request if the browser asks with a
get request for slash all send this
information back as the response
information that comes with the request
is in this variable stuff that I want to
do to respond is in this variable this
is a get request and it makes sense I
would like all of the data in the
database please could I please have that
thank you
I really wish it was this get please but
it's just getting no I guess there's no
need for politeness between computers
kindness there's all you said
we said for kindness between computers
though and people anyway I'm off track
here
but you'll notice something miss is also
a get request get ad word score now it
makes sense that you would have
parameters for a get request like search
so this is a get request search do you
have the word kitten in your database if
so could you please tell me it's score
that's what's happening here but in this
particular route this is a get request
and my get request is saying here are
this word and this score we please add
those to your database and according to
my discussion over here that should
really be a post right if you're sending
data to the server for the server to
save that's really a post and not a get
the thing is though it's just so darn
convenient because they get why is it so
convenient because that's what the
browser does natively on its own I can
actually now sing I can actually just
make a get request by saying localhost
3000 add you know yellow which is maybe
a neutral color or slightly positive so
this is me now making a get request that
get request is done it saved it to the
database I can use the fact that I can
add parameters to a get request through
the route or a query string there are
lots of ways to do it to actually have
the server saves to send stuff to the
server for it to do stuff with as well
and because it's just like a little bit
of data it's just so easy to do it in
the route with a get request why not but
there are times where this get request
isn't sufficient and you really need to
use a post well one is like username and
password like it so if security matters
you don't want to have the username and
password just in the URL path as part of
the get request that anybody could
potentially hack and get access to so
this is really work for hidden data it
really needs to be a post the other
thing is like media if you want to
upload an image to a server or upload a
sound file you can't do that through a
get request you can't easily although
there's some tricky ways you could like
base64 encode your image into like a
number string that goes into the URL but
basically for media but
what I mean in a lot of ways is like
large data so if I want to send a full
paragraph to be our full many paragraphs
a thousand words to be analyzed and have
the server send your results back I want
to send that data through a post rather
than a get because it's going to be much
too awkward to try to like encode a full
paragraph of text into some sort of
route or URL query string so this is
really the difference between get and
post post is for sending data it happens
behind the scenes in an invisible way
get is for making a request and it
happens right in a visible way because
it's really basically the same as what
you would be doing to type in a URL into
the address bar okay so now that we've
covered that how do I there's two things
I need to figure out one is how do I
handle a post in the server the nice
thing is you could imagine that it might
be something like this app dot post
analyze analyze and analyze this right
so this is now I've been a write and I
have a function to handle that post
request so this is now how instead of a
get request in a node program I can
handle a post by saying app dot post
analyze this and then what's the other
part how do I make a post request well
there are countless ways you could do it
because you could look at jQuery and you
could look at native JavaScript and you
could look at any JavaScript framework
one in p5 there's a very nice lovely
little function called HTTP POST
and so let's I'm going to add something
what I'm going to do is in the here I'm
going to add a text area so I'm gonna
say I'm gonna make another paragraph and
I'm going to say text area ID equals
text input text area let's just do
columns equals 40 and rows equals five
so we can
so if I go now to here we should see
there's a text area there so what I want
to do is win and I'll add another submit
button I'll call it analyzed so now I
have an analyze button what I want is
when I analyze this button to make a
post request to the server so what I
need to do is I need to also in
JavaScript get access to the analyze
button button a for analyze and analyze
and analyze this I'll say function
analyze this and here what I want to do
is get the text which is the I can
select the text input area and say dot
value and then I want to make a post and
the way I make a post is with the p5
function HTTP POST so when I wanted to
make a get request load JSON was all I
needed to do because low JSON by default
is a get request just like load image or
a load any of the load functions there
is by the way an HTTP GET method which
allows you to have more control over
that get request but here I just want to
make a post so okay so I'm gonna do
p5.js reference and I'm going to look at
HTTP POST and let's look at this page
the differences and boy does this look
confusing the difference is when I make
a post I need to send it a hole object
which is all the data that I want
included as part of the post so this
allows for a lot of possibilities
because I can have multiple fields and
I'm multiple kinds of data so really
there's there's a bunch of stuff I need
here but what I care about most right
now is the is I need to give it the path
which is the route the data that I want
to send I guess what kind of data it is
which I'm going to make it JSON based
data and then a callback for when it's
finished so let's do all of that and I'm
to say where was that HTT p-- oast so
first I need to say data is the text is
the text and that's actually all I need
to post is just what's in there
so but I could add a lot more things
into this object and I want to go to
slash analyze is that how I did it in
like the low JSON at I don't need the
slash in front sorry analyze and then I
need to say it's going to be JSON and
then I need to say data posted and then
I could also say data error but let's
let's skip the error right now I should
actually probably date a post error
so let's write those functions function
data posted result I'm gonna say console
dot log result and in the server now so
now I've posted this data to the server
and again this could be a lot more stuff
than just that text and in this function
and and post I should have a callback
for error and so now I just want to look
at what comes back after it's posted
okay so now in the server I'm just gonna
say response dot send thank you and
actually let's make this a reply message
thank you and send that reply and let's
just look at console dot log request so
we're going to figure out how do we get
the stuff that was posted right here in
the request okay here we go so let's see
how far did we get here first I need to
restart the server and I want to go to
this page here the here which I should
see this I want to look at the console
and now if I this
is a test and I hit analyze I got the
message back so the round trip happened
the question now is let's look at what's
in the request oh my goodness how am I
ever gonna look through all this and
find the data that was posted so here's
the thing how do I find that text this
is a mess of data that comes in with the
request now we know if you go back to
the server
when I had a get request I can simply
just look at the requests parameters
because these are the parameters that
come in with the request with a get with
a post request it's not so simple
there isn't just the parameters there's
this part of it called the body which
has all this information in it and I
actually and I have to parse it luckily
for us there's a no package which will
do this parsing for us and this parsing
this package is called body parser so
what I need to do is I need to install
that package body parser and I want to
save that as part of this project so I'm
saving it now I have the body parser
package and then what I want to do and
I'm on I'm on the I'll include a link in
this video's description bye mom the
github repository I just want to look at
I just want to I need to require it so I
need to add it to my code at the top or
doesn't really I'm going to add it here
or I require Express and then after I
create the app this is serving static
files I now want to use this body parser
package so I'm gonna just scroll all the
way down here on this documentation page
where I know there's a quick example and
I can grab this code and I can add it in
so I now am telling this app this web
application which was is an Express
application that's listening on this
port which uses static hosting for the
stuff in the website folder now also has
the body parser and I want to use JSON
because I want to get the stuff I want
to parse everything as JSON okay so now
that I have that I should be able to say
oh boy do I hope that that's true in the
where we're in the post where I'm
handling the post of
lost it right here let's say console dot
log request dot body and so I'm going to
restart the server whoops and I'm going
to refresh this page I'm gonna say this
is a test I'm going to hit analyze I got
the message back and oops
the bug is fixed this is blank because I
forgot to actually pass in the data I
had a mistake which some of you might
have been screaming at your television
system so you're watching it's on in my
client code right in my client code
right what do I need to do I need to
send it the route I need to send it the
data what the format of the data is and
I had callbacks for when it's finished
or if there's an arrow what's missing I
just listed five things I forgot to
actually send the data data goes here so
I forgot to post the data so there's no
way for me to read or receive the data
if I didn't post it so that's done now
and I I think it's gonna work so let me
Oh actually don't have to restart the
server because I just changed the client
code and you know this is driving me
crazy
I just want to in the client I just want
to say just add something here like I am
happy today because I saw a rainbow and
some kittens okay so now I have some
text prefilled in I can hit analyze I
got a message saying thank you and I can
go look at the server and I can see that
that data came into the server via the
post we have a post we have a post
working that is awesome okay so now all
you do is do sentiment analysis I really
should just give this to you as an
exercise in this video now but I'm going
to finish it up myself so the nice thing
is I all I can this isn't too hard for
me to do now in the server I'm going to
go to the server code and right here
instead of console logging I want to
look at and say var text equals request
body text then I want to split it up
text split and I'm going to use just a
regular expression here
to split it up into words by anything
that's not a word letter or number
with so many videos but this this is
pattern matching and backslash capital W
is anything that's not a to Z or 0
through 9 and so now I can loop through
those words and I can I can say now what
I want to do is I want to first look I
need us total score so I'm gonna have a
total score started at 0 I need to say
if words oh boy I should call this I
need to call this additional so because
that's gonna be a problem
let's look everywhere I use words
because additional additional additional
oh boy additional okay I just don't want
to confuse my variable names mmm
so here I should just call it that
tokens that I wouldn't have that problem
but if additional has own property and I
want to see if word equals words index I
has owned property word then total score
plus equal additional that word the
value and a number I'm doing this kind
of fast I should reference you I did
this exact sentiment analysis entirely
in a separate coding a challenge which I
went through in a little more detail so
I can check if it's there if it's not
there then I should also check if it is
in the Athan list and if it's in either
one of those I also let's get make a
word list we'll just make it yeah a word
list so we'll actually make it a word
shirt an array I could say in either of
these cases word list dot push an object
that has word word score and then and
the score is far the score is oh I can
save our score if it's in additional oh
yeah score equals number additional and
then add that hmm this is not
interesting to watch anymore and
otherwise if it's in a Fionn that's the
score and and then sorry if I and so
number okay so I'm just cleaning this up
because now I can say total score plus
equal plus equal to score so the score
can start for every word can be assumed
to be zero and if it's in additional add
the score and you know actually so I
don't need this here anymore get the
score from additional if it's in a fanat
the score from Ethan and now what I
could do let's just get this working I
could say reply is score total score and
comparative comparative comparative
comparative in in the eighth and one
eleven sentiment analysis the
comparative value is the total score
divided by how many words are in the
text words dot length so now we should
see that I'm getting the text so my
server is now receiving the text of the
post request chopping up into words
looking at every single word seeing if
it's in one of the lists and then
spitting back a total score so let's run
this oh I need to restart the server oh
I have an error words as
not to find where in line number six
which is here I don't actually need this
console.log was just for debugging
earlier so let's run the server again
refresh and hit analyze and we got an
error false I got some error so what
happened let's look at the console oh
yeah I got an error comp is not defined
so I made a mistake because I'm trying
to do this so quickly and I'm not being
careful and where is where I'd have lost
word the code this is Oh comp oh wait um
comp and then this can be comparative
I'm just not naming things carefully so
this is the reply that I want to send
back whoops I have to restart the server
there we go and look at this every time
I analyze I get both the comparative
score and the score now I really want to
also send back a list of words and I
want this to be an exercise I'm gonna do
it anyway because I want to see it here
so what I'm gonna do is I am going to
also say I'm gonna make a variable
called found and say found is true found
is true and then I'm gonna have a word
list and then if found so if it's found
that I want to add it push I'm gonna
make an object that has I'm gonna just
add into an optimum to make an array of
objects with word word score score which
is a little awkward but now what I can
do is I can also send back the list of
words so I'm just saving every word and
its score if it was found in one of
those lists because now if I run this
again and it hits analyze array 0 so I
did something wrong let's look at this
again whoops I initialized the array in
the loop which we
kept clearing it out so of course
there's nothing in the array let me take
that out there run this again refresh
analyze and now we can see this is what
it got this is the comparative this is
very small for you to read oops you can
see here that this is the comparative
that's the score and this is the list
happy and rainbow so what I could say is
mmm why didn't it get kittens so what I
would like to do is add kittens and
kittens should have a score of 4 so I'm
now gonna hit submit and now when I
analyze it again whoops we can see that
I got a I got a score of 14 and let's
say today is really positive with a
number 100 I can add that to the
database and analyze again and now I
have a score of 114 so now I have both
on one page I have both assistant what
we've really finished this example where
I can submit to the database using a get
request I can post to have text analyzed
I could submit to the to the to the API
with a post and I can get back the
results now here's the thing as a
challenge as an exercise take this exact
code and really work on the interaction
here and how this works how could you
actually effectively crowdsource a full
word list how could you use an animation
or use design to show the results in the
word list you could click on them and
what if it showed you all the words here
and the ones that are missing and it let
you type them in and hit submit so you
could kind of like how could you train
this to have a larger database of words
for more sophisticated sentiment
analysis this would be I think a
challenger you to take this and take it
further but this is a fully functioning
API there's one piece of this that I
think I should mention this API can be
accessed by my so the server the note
server the thing running right here can
be accessed by this webpage because
there this webpage is hosted on this
server but what if you wanted to make a
sentiment Alice's API that is running
somewhere but anybody could access it
from their own web pages and their own
program without being the programmer of
the search
well to do that you what you want to do
is open up on your server something
called cross-origin resource sharing you
want to say I want other people to be
allowed to send get requests or post
requests to this server not just me the
programmer of the server who also is
hosting like HTML files packaged with it
and to do that you need to enable cores
which stands for cross-origin resource
sharing you've probably encountered the
flipside of this error anytime you've
tried to request something from the
server and you got this like XML request
HP are not allowed cross or the
resources not enabled so if I want to
enable cores I can search for cores node
package Express this is something I can
enable with Express and I can actually
just install this cores package and I
can say npm install cores - - save now
I've installed that node package and I
can go here and I can just grab app dot
use I can say cores require cores right
up here the same place that I used body
parser var cores equals require cores
and app use body parser app use etcetera
and app use cores so now I now have
enabled cores so if I put this if I
deployed this to Heroku or digitalocean
or whatever web server hosting
environment my whatever my server is now
if I hand it out the IP address or the
URL other people could call load JSON or
HTTP POST from their own p5.js code
running on their computer to your
particular server so this concludes my
series about how to build an API from
scratch using node and a front-end to
that API using p5 yes hopefully you
found this useful if you make an API if
you build something share it with me
asking them ask in the comments like
share this video I guess those are the
things I'm supposed to say and I look
forward to seeing you I'll do some
follow-up videos as part of this
playlist if there are some good
questions or other features that I think
of adding ok see you soon good bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>