<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>5.14: Toxiclibs Verlet Physics Basics: Particles and Springs - The Nature of Code | Coder Coacher - Coaching Coders</title><meta content="5.14: Toxiclibs Verlet Physics Basics: Particles and Springs - The Nature of Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>5.14: Toxiclibs Verlet Physics Basics: Particles and Springs - The Nature of Code</b></h2><h5 class="post__date">2015-08-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3v7SsOdxxww" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi okay we are ready to make our very
first toxic libs particle and spring
example this is actually the example
it's the one that we are going to make
or Tarts made so we're just gonna look
at it and talk through it but you can
see this looks very much like many
examples we've had before in the past we
have this swinging object connected to
another object how is that working I can
also click the mouse here and I can pull
this object around I want to let go it
it's a little bit elastic and bounces
back and forth this is a very simple
system it's got two particles in it and
one spring connecting that and the world
has gravity so if we can understand how
to make this everything else we make in
toxic libs is just an extension of this
as more particles it's more spring
configurations and whatever imaginative
creative exciting way that you can kind
of put all this stuff together okay so
how do we make something like this okay
so there's a few things that we need to
know about number one is let's just
think for a moment it's a little weird
to me actually that we did box 2d before
tux Eclipse but that's what happened
although I suppose these videos should
be independent of themselves and not
require you to have watched box 2d so
I'm talking about I realize but all of
this is just me talking to myself really
so let's think about this for a second
what are the elements of a toxic libs
berlet physics world so if you didn't
watch the box2d videos it's okay but I'm
gonna make this make sense a little bit
in box 2d there's something called a
world then there's a body and then there
are bodies have shapes and fixtures and
then there's this thing called a joint
so toxic lives a joint so a body is the
thing moving around the world the world
is the world that the bodies move around
and a joint is the thing that connects
two bodies toxic lives the way that we
think about toxic lives is going to
operate in exactly the same way the
world is going to be called verlet
physics so we're gonna make a verlet
physics object it's Averell at physics
world and in our case in our examples
we're actually going to make a verlet
physics 2d object so you can do it in 3d
or 2d but for my examples for simplicity
we're sticking with in 2d although it
would be nice to have a 3d one and
3d video and I add that to the list of
everything we will always and forever
wish we had and make eventually okay a
body is a particle so a particle is the
thing that's going to move around the
verlet physics world we're gonna make a
world we're gonna put particles in it
and watch those particles move about
particles by the way can have those
behaviors they can be attractive or
repulsive which is something very
exciting that we're gonna see a few
examples from now a joint in toxic libs
we're gonna think of as a spring so a
spring is the thing that connects to
particles one of the great things about
toxic lives is it has a different kinds
of Springs it has a plain old verlet
spring it has a verlet minimum
constrained spring which I'm obviously
giving it they're not exactly the
correct game right now but you'll see
there's various constraints we can put
on the spring to make sure that it can't
like stretch beyond a certain distance
or shrink beyond certain tendons which
can allow us to really control the
stability of a system if we need to so
these are the things we need to be feel
comfortable with we're going to make a
verlet physics object we're going to
make a particle object we're gonna make
two particle objects and if we look back
at this example we're gonna make a world
Verla physics we're gonna make two
particle objects and one spring object
there's one missing piece though to this
list that I haven't mentioned right
remember we had P vector the good old
days back when we had P vector and we'd
say P vector location equals a new P
vector and we were so happy and then we
had box 2d we had vet to vet to write we
were a little bit uncomfortable but we
kind of got used to it and we we felt
glad now we have Veck 2d and Veck 3d so
yet again another set of vector objects
vector classes to work with in in toxic
lives but we should be rejoicing again
because one of the nice things about the
vector classes in toxic labs is that
they are more advanced than the vector
classes in processing there are many
more functions are a bit more
sophisticated to use and thus perhaps
not as not as easy to use but there's a
lot of power there especially when the
vectors are separated out you know
whether using a 2d map vector or a 3d
vector perhaps it's not as simple to
like kind of what I think I'd like
trying to justify why p-vector in my
mind is the way the made the way that it
is but I think these are wonderful
vector classes that we're going to use
with toxic lives I mean I love vector
classes we can't have enough of them
somebody make one called
G vector s vector I don't know whatever
okay so this is the picture this is what
we've got now we have another thing to
discuss this is visit the really
exciting part we haven't even gotten to
five minutes yet so I feel like we're
totally on pace here now that we know
the elements of the world how do we
actually make these elements in the
world okay so back okay if you remember
back to the the olden days we wrote
something called class mover and in the
mover itself we had three P vectors
location velocity acceleration we wrote
that update method ourselves which had
Euler integration blah blah blah sort of
half writing here right this is what we
did all on our own
this was our mover class we were very
proud of it we're still going to use it
you're gonna use it we're gonna love it
and take care of it this is what we made
then we got to this place where we said
ha oh hello again we got to this place I
hope it recorded through that we got to
this place where we arrived at box2d and
we said you know what box2d is going to
handle the physics for us we don't have
to keep track of location velocity
acceleration have an update method what
we're just going to do is we're gonna
make a let's just still call it a mover
I guess I guess why I like calling these
particles so let's call it a particle I
should have called the first one a
particle we kind of we made this
particle that we put a body in it so app
our object was essentially a wrapper for
a box 2d object and we could say like we
could always just add forces to it or we
could initialize it and then ask where
it is so we could draw it we had this
reference to a box to the body that was
in the box to the world that we could
just sort of deal with all the time now
as if these weren't two great options on
their own the greatest option of them
all is what we're gonna do with toxic
lives if you go back and review those
particle system videos one of the things
we spent some time learning about was
inheritance oh we have this base
particle class that has all the sort of
physics of particles and we can just
extend it to make star and rainbow and
sparkly particles now we're gonna do the
same thing with toxic lives only we're
not gonna write that particle class not
at all we are going to just inherit
toxic lips particle class we're gonna
say class particle extends verlet
particles so the name of the actual
object in toxic webs and in our case
it's gonna be verlan particle 2 D is
verlet particle so we're gonna say we in
we don't need to write the physics all
we need to do is write our display
method and our display method might draw
a circle at the X Y where that particle
is this is a really fantastic way of
working we're getting all of the methods
our particle is of early particle it has
it has the ability to have attraction
and repulsion forces its ability to be
part of a spring and its ability it
knows how to update itself further in
the physics world when the physics world
gets updated everything is controlled by
toxic lives but we can just write our
own we can interject your own design
here or we could add variables we could
add a color variable to it if we want to
keep track of its color or other
variables to it if we wanted to and we
can we can apply force it so we can do
all sorts of things to it so these are
really the three methods we've now
covered in this course or set of videos
or book or whatever you want to call it
it's writing everything from scratch on
our own it's using a physics engine
where we just bring in a variable to
reference an entity in that physics
engine or what I like best here is this
idea of extending an object that lives
in a physics world so the object what we
inherit all the physics and we put our
own design on it now there's something
kind of funny going on here that I would
like to point out which i think is even
more exciting
than just this what we've done here just
to love so one of the things that's
super interesting about this is okay so
where's the objects here we have this P
vector location so it shouldn't may be
particle Berlet particle have a vector D
right if vacuity is the object in toxic
lives it should have a vector D position
not a right and we should be saying
ellipse at position dot x position dot y
but instead we have x and y so verlan
particle we must have inherited just an
x and a y how do we do that it turns out
that Verla particle itself extends
vector d right a vector is a can be a
location on the screen a particle can be
a location on the screen with all this
added functionality and then our
particle is our own design on top of
that so not only does our particle
extend Verla particle to d it has all of
the vector functions built into it right
there so this is a really tremendous way
of working and I think a very smart way
of designing a physics engine and in
many sense we might have wanted to do
that with our mover class mover extends
P vector but you know I think that would
have been a very difficult way to just
start right from the beginning like it
was much simpler to kind of start to
learn by putting P vectors in our code
rather than have our mover be a P vector
also suddenly additionally with velocity
acceleration but that is something that
is very important to realize when
working with toxic Libs your particle
not only inherits from Verla particle
duty it also inherits from vex vex to
defect 2d okay so now that we've kind of
gotten that out of the way
let's take a look at where this appears
in the actual code example and I have a
feeling I might have to fix this camera
yes okay sing like I don't know you say
it's your birthday I don't know what oh
my god okay so let's take a look at this
example first let's point out the beauty
of this look at the beauty of this
experience it right this is our particle
class it extends Verla particle duty it
has no coding that has no location
velocity acceleration no update no
physics no this know that all it has is
our display function so if you are the
kind of person who wants your physics
taken care of for you
but you want to really control the
intricacies of how you're drawing stuff
on the screen this is a fantastic way to
work you can really just work on adding
a display method to the particle which
extends further let particle 2d so now
if we look into the main program we can
see a few things here one is here's our
world early physics 2d physics that's
the world we need to set up we have two
particle objects those are our particle
objects but they extend Verla particle
2d and a couple things I should point
out this is a little bit of an odd line
of code which will make sense a bit more
to us later we look at behaviors but the
world has a gravity behavior in it
meaning you know gravity doesn't just
exist out of nowhere but one of the
things we can add to our verlan physics
world is a kind of global force that
points in a given direction in this case
we have that force point down so that it
looks like you know kind of 2d gravity
on the screen we can also set the
boundaries of a world which makes
objects not able to go beyond those
boundaries you can pick or choose
whether you want that and then here we
are making two particles one at one
location and one of the other and if if
I take out the gravity by the way and
run it you will see look I made two
particles one here and one there one at
width divided by two comma 21 at Witts
v2 plus 160 comma 20 so there we go
now a spring oh I thought we were like
we kind of covered everything here but
let's let's take a moment to talk about
what a spring is so a spring in toxic
lives is a very simple thing to make and
the way that we make a spring is by
saying new verlet spring and in this
case it's going to be 2d and we have to
put four things here we have to put four
things here so what is a spring one
thing we need is particle number one
another thing we need is particle number
two so a spring has to connect two
particle objects so we pass in those
references as the first two rep as the
first two arguments to creating a spring
so we make a spring we say spring
between particle one and a spring
between particle
the third argument is the rest length so
what is the net rest length was the
length of that spring that it would come
to rest at so if we pull it apart it
springs back if we push it in it springs
back so that of course is a float just a
number in pixels in pixels we don't have
to do any crazy conversion here and
that's the third argument and the fourth
argument is the strength of the spring
and you can think of that as a number
between 0 and 1 I really should have
thought of this before I began this
video but I'm pretty sure if you make
that number one it's going to be
completely rigid so you basically can't
it doesn't have any elasticity to it and
if you make it 0 it's gonna be kind of
like almost like gum that you could
imagine but you're like pulling and it
just kind of keeps pulling forever and
ever and doesn't really have the
strength to power to to kind of spring
back so you know you can kind of only do
so much to describe these variables the
best way as we've seen is just try a lot
of different values and see how your
system behaves but generally this
strength is a number between 0 and 1 and
someday that's not correct oh I will fix
this video ok so these are the arguments
that we need to create this spring and
now if we go back and look at this we
can see that's exactly what's happening
here we make a new verlan spring 2d we
have two particles 160 and 0.01 so we
have kind of not such a strong spring so
let's let's actually just try messing
with that value a little bit we can see
here I can kind of pull it and it's kind
of springy but if I make this value 1
and I grab it like I can't right now
it's not even letting me pull it so 1
makes it a completely perfect rigid body
and if I make it point 9
I have to catch it it's very I can't
really pull it either so you can see if
I made it if I made it 0 yeah it just
completely falls in as no springiness to
pull it back so you can see there's a
range there I was right I was right so
um so that's how that's how the strength
of the spring works in toxic libs one
thing that I should there's two other
things I should point out about this
particular example number one is
whenever you make these things
you need to make sure you add them to
the physics world so you can make
particle object so you make spring
objects if you don't tell toxic libs
they're part of the physics world they
won't respond to the physics so you can
see here we're adding each particle to
the physics world we're adding each
spring to the physics world as we create
them another thing that's important to
realize is that there's a lock function
so you can lock a particle in place so
that it can never ever move and that's
what's happening here with particle
number one particle number one is locked
if I were to comment out this line of
code and run it again they just fall
because they it's not locked in place
and they're both responding to gravity I
can still pick this one up and move it
around and you can see but but you can
see here that they're not in either or
lock you can lock and unlock things on
the fly that is a very important thing
to realize it's not in this example
we're just setting it up as either
locked or not locked and the last thing
I think that's important to mention
about this particular example is that
you know you've got to make sure you
have this update method in draw so this
is the equivalent of box2d step function
we're only going to update the physics
of all the particles in all the springs
if we call update and traditionally
we're gonna call update once through
draw there might be some strange
scenarios where you do it in a different
way but this is kind of the typical way
of doing it okay so this is kind of all
the bits and pieces of Toxic lives what
I would say to you actually if you're
looking for an exercise is try to just
come up with a scenario where you put I
don't know put all the particles around
in a circle and connect them with
Springs or put them in a line and
connect them with springs or put them on
a grid and connect them with strings or
make a hundred random particles with a
hundred random spring connections come
up with some arbitrary set of rules that
you've designed for yourself to
initialize a physics world and then see
what happens with that physics world in
the next two videos we're gonna look at
a few examples of that we're gonna look
at a string a string of particles
connect with Springs a grid this idea of
a force directed graph kind of talked
through some of these examples as well
as look at how we can add attraction
repulsion behaviors to these examples as
well okay thank you for listening and
I'm going to say goodbye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>