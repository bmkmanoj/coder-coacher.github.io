<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Coding Challenge #72.4: Frogger Refactoring | Coder Coacher - Coaching Coders</title><meta content="Coding Challenge #72.4: Frogger Refactoring - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Coding Challenge #72.4: Frogger Refactoring</b></h2><h5 class="post__date">2017-06-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c6WdJltqEtM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello welcome to what is now somehow
part 4 of my Frogger coding challenge
series of making the game progress Oh in
that at the end of part 3 I have this
kind of version of the game that I can
actually play here and I'm in a second
I'm going to get to the top so what I
want to do though show you that I think
that for the part the first three parts
where in some way is an illustration an
example of what happens when you rush
through code you're trying to figure out
stuff on the fly and things start to get
very messy and like I'll fix this later
and you know I tried sorry I'm don't get
me wrong of all for messy code and just
having fun and trying what works but I
do think this is an opportunity for me
in my videos to take a look at what it
means to refactor code so what I would
like to do in this video is change very
little really at the end of this video I
would be happy if what you see is
exactly this result but the code has
been rewritten in such a way that's a
bit more scalable right now if I wanted
to make the window taller and add more
log lanes or more car lanes I'm going to
have a very difficult time doing that a
lot of stuff is hard-coded in here so
the main work that I'm going to do and
again I haven't really done this before
playing this out I'm just going to be
doing this on the fly as well so for
sure all create new problems by solving
older problems is create a Lane object
so let me think about this for a second
so let's think about what is a part of
the lane so if this is the Frogger game
an individual Lane has a bunch of
elements to it it it actually could be
an instance of a rectangle object it
could also extend rectangle because it
can have you know an X Y and a width and
height but ultimately the things I want
to keep track of are number of cars or
logs speed of those cause speed of those
cars and logs a spacing of those cars or
logs so Elaine is going to keep track of
all of those
is on its own I could have like a color
the color for the cars the color for the
background so you can start to see like
what are all the things that are part of
an individual link and another thing
thank you to me I NSTEMI who suggested
this you might've noticed in my previous
example that the cars and logs are
actually basically identical I'm just
drawing them in a different way and
ultimately you know I haven't I'm
actually not even drawing them in a
different way that's something that's
still sort of like left as a next step
for this program but I'm interacting
with them in a different way and that
I'm checking whether that you know with
the logs the progress land on it with
the cars the frog has to avoid it but I
think I could just use one object and
just call it an obstacle rather than
have these two different objects it's
kind of unnecessary at this point okay
so coming back over here let's start
trying to do this
so let's write let's try to write the
code for the lane class so class lane
oh yeah and Simon is asking the chat
what about the safety lane so I got an
interesting question I could just have a
lane that has a number of obstacles as
zero
that could be how I indicate if it's a
safety lane and I could also there's
something else I was thinking of here I
could also have some sort of like a type
variable whether the lane is like a cars
lane or a long way and the logs could be
Turtles right in the cars to the cars or
trucks there's a lot of possibilities
here and again I've just tried to do a
small simple furnace so coming back
let's create this Lane class and let's
get rid of I'm something to do this I'm
going to do I'm going to save this as a
wait a second oh yeah say this has frog
or two and I'm going to delete the log
class get rid of that completely it's
going to break I'm going to call it and
I'm going to change this to rename by
the way this is something that's been
processing now see if this works
if I go and use rename I can rename it
to obstacle it's going to change it
everywhere in the code so see how well
that did attach up so one place where I
missed it here because obstacle should
still be and this should be obstacle so
many places okay so now I have at least
the same program again and just obstacle
instead of cars or locks now back to the
link so what I want to have is I want to
have some array of obstacles
what else did I say I want to have a
speed and maybe I said maybe I want this
to extend rectangle so I can have a
location a speed what else did I say a
spacing sorry and a spacing let's just
do that for right now let's start off
simple so in the constructor x2 say
extends the constructor should have a
number of obstacles a SPD for speed and
SPC for spacing so obstacles now is a
new array of obstacles with n elements
in it and speed is some speed and
spacing is some and spacing is some
spacing okay so this is the idea of a
lane and if it extends rectangle I also
need to call super and I probably should
give it an X a Y and a width and a
height X Y width height this is a lot of
stuff for the constructor I don't love
that might want to rethink that a little
bit later but I'm going to just leave
that for right now
okay so now what I'm going to do is I
just I want to get rid of all this
nonsense so I'm going to
comment all I'm just going to delete it
I'm just going to leave Row 1 just going
to leave Row 1 and we get rid of this
the idea here is that instead of having
two different arrays of obstacles I want
to have an array of lanes now how do I
know how many lanes I need well actually
the way that I'm going to do this is I'm
going to have a lane object for every
single horizontal bar even the beginning
bar that middle safety Lane and the end
for example so if I know the height in
pixels
I can just say the height divided by
that grid size is the number of lanes
that I need so I'm going to say lanes
equals a new array of Lane objects with
total Lane is height divided by grid and
I want that to be an integer so I'm
going to convert that to an integer
total lanes okay we're getting somewhere
refactoring rings factoring very
exciting so I want to have a total
number of lanes and here's the thing
actually signed intimate shadows make a
good suggestion I can really simplify
this I actually don't need to pass it an
X I don't need to pass in a width or a
height because those the X is always
going to be 0 the width is always going
to be the width of the window and the
height is always going to be that grid
size so I can create its rectangle with
some hard-coded values and I feel
perfectly happy with doing that and
there might be some reason I have to
change that another time that makes this
much easier to read ok so this is the
total number of lanes now what I want to
do is I want to loop through and create
all of the lanes so every single lane
what do I need I need
the Y position the number of obstacles
speed and spacing so let's just pretend
for a second that what I'm going to do
is just put cars on all the links I'm
going to say a new lane at I times grid
right so I times grid is 0 times grid is
0 1 times grid is grid 2 times grid is 2
times grade 0 50 100 150 so that's going
to give me all the spots and I'm going
to just put what is the next thing I
need in the lane the number I'm going to
put three objects in each one then I'm
going to then the next thing is the
speed I'm going to have all the speeds
be 1 and the spacing is going to be 100
so I'm just kind of going to do this in
the arbitrary way I'm going to delete
this and what I'm going to do now is I'm
going to comment everything out because
we're going to have to figure this out
now everything is going to get much
better now so this stuff so what I want
to do now is I want to loop through for
every lane in lanes let's say Lane dot
show so I want all the lanes to show so
that is I need to write a show function
and what does that show function does
say for all the obstacles have them show
and by the way here when I made this
array kind of need to create all those
obstacles so now we say obstacles dot
index I equals
a new obstacle poison isn't watching
somebody refactor the code wildly
entertaining not carry oh my goodness
I'm sure this was such a good idea so
what is it when I make an obstacle I did
that I deleted all that stuff I needed
to keep that because I needed to
reference it but it's okay I can
remember I give it an X or Y a width and
a height and a speed so the obstacles
get created at where do I do that in the
lane the get and X the X is I plus sorry
if the X is then what else speed is the
lane speed and width and height is oh
that's okay okay I'm just going to make
them squares right now grid comma grid
forgot about something okay so we're
going to fix all this what do I have so
far
all right okay here we go let's let's
keep doing this wouldn't see anything I
probably forgot something rather
important I made a bunch of links oh
let's debug this so what's wrong here
let's just see a mic so it should be
drawing a bunch of things ah look at
this the width is one I messed up the
width somewhere echo speed is the last
argument right the obstacle requires X Y
width height speed X Y width height
speed okay so a bunch I made a bunch of
lanes that works
now let's you know I've gone a few steps
backwards here unfortunately but we're
going to get back we're going to get
back to what we had it's this is going
to be good trust you stay with me here
please stay with me let's say Lane
update Rosic this is not update no no oh
yeah
oh I should just make a run function
let's just make it run I might regret
this later and we'll do a show update so
lane dot run okay so all the lanes are
working now they're all doing exactly
the same thing that's fine is it going
to come back yes they're coming back
okay so this is good
my lanes are working one thing I
realized I forgot is that the lanes
could use a variable for how wide the
the so when I create a lane what do I
have right now I have I have its Y
position total obstacles of speed and
spacing you know one thing I sort of
feel like doing is maybe just making the
speed random I mean why not right
so I whew where are you to make the
speed random somewhere between like
negative three and three you know let's
just so I don't need a speed so that's
sort of nice to see right so even just
with the speed random I'm going to get a
lot of kind of variation there and it
could be hard there could be a specific
configuration supposed to be if I'm
going to make that random then I'm also
going to what I want then as another
argument is the total number of vehicles
and the size of those vehicles the width
so I'm going to give it a variable
called W does that mess things up though
because it extends rectangle so I don't
want that so what is it I've been call
it the length so this is the length of
the cars or logs and that can be
actually be an integer because I'm going
to think of it as they all have to be a
certain number of cells on the grid but
multiple of 50 so now when I create the
lanes I'm going to and I'm actually just
could just make that random also but no
you're not might end up I'm going to
let's just put let's just put one in
there I'm gonna do this you'll you'll
see hold on I got an idea here so I'm
going to put one in there and then the
obstacles there with is grid times that
length
and guess what I don't think I need to
actually keep track of these variables
well speed I do because it's random like
I don't really need to keep track of
this spacing it's Rhyno anyway I'm
really just using it to initialize but
that's fine so now look at this that's
with one now what if I say make say that
- great so now you can see they're all
double wide and this spacing I could
make 200 and you can see now they're all
spaced out by 200 they're all over what
so now I have this ability to just put
you know as many or as few things
there's only one thing in each lane
there's three things in each lane always
with a random speed so I'm hard coding
the number of things there with and
their spacing but I'm making their speed
random and I'm also going to add one
more random thing which is just a little
offset so they don't all start together
I'm going to create a variable called
offset again this doesn't really have to
be I can really just use this as a local
variable here and I don't really need
this same thing with the spacing this
can just be spacing I'm going to give it
a random offset between 0 and 200 just
as giving it an offset so what I mean by
that offset is if I don't actually move
them they will all start slightly offset
from each other ok now we're cooking so
I'm able to now have all of these
differently and I want to give them a
color and some other things at some
point X that could be an exercise for
you here's the thing though
what I love about this is I can run all
the lanes but I still think on some
level I want to manually configure them
so it's nice that I can initialize them
in the loop and I could make them random
but just for demonstration purposes
right now I'm going to configure them
I'm going to configure them one at a
time so laying 0 has 0 things in it so
the speed and spacing can be 0 that is
where the Frog starts Lane 1
which will be at grid spot is going to
have three cars in it with what what's
the second thing
a a width of one and an offset of one
fifty so uh okay so lean I'm so I'm
going to just going to do this now
really quickly then two three four two
three four will also be a safety lane
then what do I have left let's do this
again five six seven and eight
I kind of wanted I kind of want four I
think what I would like so let's make
this the height 600 I would like for car
lanes safety lane four four log lanes
and then a fatal last safety zone so
what did I miss here oh I need oh no
that's ten that was right I don't need
to make it ten for four no no no that's
three ah
I do need eleven if I'm gonna do fork
look at this you know we've got a little
less hard cuts of new hard-coding
everybody so let's make this now back to
600 and here we go what did I get wrong
here people
I should have eleven lanes
well that's twelve 550 oh boy ah right
and now they all need to oh this is
awkward this is awkward and here I'm
going to give them just a lane index and
then what I'm going to do in the lane
object itself is set the Y location and
this is really not wise like index index
times grid
index times grid and index times grid
okay so you can see now there we go
there are all of the lanes and I want to
make sure they update and so there we go
all of my links now I can start to
individually configure them so I can say
things like the second one should have
two that are triple wide and spaced out
by 350 pixels the third one should have
four spaced out by 200 that are one then
this should have three that are two
spaced out by oh and i don't want the
speed to be random actually because they
really should be like every other one
own these are the top actually so what's
first - so i don't that the random speed
is a bad idea
so i'm going to go back to setting the
speed manually because i want to
configure this manually and i'm going to
give it the last argument will be speed
and I'm going to say three negative two
point five one I have too many lanes
2.84 I could have made it I could have
just had its direction and still have it
be random and then zero so now we can
see and this one they need to the last
Lane they need to be spaced out by quite
a bit more
so let's space them out by 250 so there
we go so now I have and then uh some I
want these to change like this should be
4 this should be 2 this should be 1 and
this should be 4 and this should be 1
double wide triple wide single wide so
there we go
here is now my game of Frogger and I can
go through it now I'm not doing I'm not
doing any of the tests
now I also I want to give these lanes of
color I think it would be useful to give
these lickings of color the other thing
I could do is I can yeah let's give
these lanes a color and let's make that
the last let's make that the last
argument color and actually you know
what I'm going to do I'm gonna do
something totally different I'm going to
write a second constructor second time
today this was in a different video that
I recorded earlier today I'm going to
use something called constructor
overloading so I'm going to make a
constructor that optionally takes the
color as its second argument and I'm
going to use that just for all of the
all of the the three lanes that have no
obstacles in it and I'm going to say
write a new function that has its index
that can really be an integer and then a
color and it needs to call super and
then it needs to say obstacles equals a
new array of obstacles with zero things
in it don't want to have any obstacles
in this lane and it's and I'm going to
give it a each Lane is going to have a
color and its color is going to equal C
so in this constructor the color will
equal black and here I can now and then
when I in the run function I'm going to
draw a rectangle dozen rectangle have a
show know I have I'm going to create a
I'm going to just draw a rectum I'm
going to say fill that color and draw a
rectangle at X Y width height so we can
see there we go oh I love this now I
have a lane object I can configure the
game
laying by late so I can create safety
lanes with a different color and I can
create lanes with up with obstacles in
them so now this is exactly the game the
only thing is you know none of the
actual gameplay is there so I need to go
back and put that game play back in now
I have all that commented out here I
don't need to draw the DS separately
this what I can do here is I can say I
can now look at every Lane so I can say
Lane dot check frog so I want every Lane
to check the Frog this is really what I
want to do here I'm going to take this
and in the lane I'm going to say I'm
going to write a function called check
which gets a frog and then what I want
to do is loop through all of the
obstacles on the call then oh I'm going
I don't need to show an update that
happens somewhere else and I just want
to check if frog intersects that
obstacle reset the game so I'm just now
going to do that as if all of the lanes
are obstacles okay see this stuff should
happen really fast now that we've
refactored I should be able to do this
stuff really easily so see every time I
intersect an obstacle I should get sent
back to the bottom right okay so I'm
able to play this game now I need to I
need to only check so I need to figure
out whether the lane is a log lane or a
car lane so maybe I'll do it tight I
could - let's do it type let's say I
could make it a string that's probably a
bad idea let's do a I'm going to do this
in a kind of a goofy way I'm going to
say type and the lane is also going to
get as its second argument and we'll do
that here - it's
going to get a type when I create the
lane so I'm going to say type equals s
type equals s I'm going to create some
kind of constant string safety equals
safety string what what other types
could be car equals car string what's
the other one log equals log so what I'm
going to do is I'm going to create the
lanes this way this one is a safety this
one is a car car for car lanes then I'm
going to have law then I'm going to have
another safety lane a log lane and
another safety Lane okay so now we can
see here I've added this now I could
have just put the strings directly in
here but I made these like separate
variables at the top to store the actual
strings because and honestly I don't
want to use strings I want to use
numbers because I don't want to have to
remember is 0 or 1 so I want to have a
variable and these I could say in Java
awful java monster language speak I
would say like final constant int so I
want to make these ends but I'm just
going to be sort of lazy and I'ma be all
capitals and integers so now what I'm
going to do here is this is an integer
for a type I'm gonna call it t just for
type and actually I don't need to have
this argument here by definition if it's
getting if it's using this constructor
it is a safety Lane and this should be
an integer and I can take it out of here
so these don't need explicitly to say
safety because that's by definition
right just refactoring refactoring
refactoring
okay so now what I'm going to do in the
lane the check function is I'm going to
say if type equals car I'm going to do
this right now
otherwise if type is a log what is the
thing that I did I had this like very
weird thing where I had to check where
it was but now I don't have to do that I
can just say take this all this code
here not going to just grab this for
right now and I'm going to put this in
here this was the code for seeing if
it's intersecting with any of these
frogs and if it is attach that
particular log so I rename some of these
variables and I'm just just just all the
same code that I worked out the last
time I'm just and if it's not reset the
game although this is a bit of a problem
so I'm gonna have to work this out there
so there's this is going to have to
change because I'm doing it by lane now
so let me take this out for a second
we're gonna work that out later so let's
just see right now this should work
whoops where I should be able to look at
that oh whoa so I need to get my attach
and detach going again let me run this
again whoa it's already attached why is
it automatically attaching in this Lane
oh these are the logs ah I forgot oh my
god that I did this the top I'm creating
the lanes from the top to the bottom so
these are all the logs and these are all
the cars I forgot okay so now right if I
intersect
I've got to get through all these and
now here's the thing though it's never
going to detach so I need to get the
detaching back in thank you to Alka in
the chat who's I what I was thinking is
one option would be to actually have the
Frog register which lane it's in because
I know it which lainson based on his Y
position only check fit there's not
really any good reason for me right now
to have all the lanes check the Frog I
kind of want to do that but I'll get a
different suggestion we should just
detach every time the Frog moves right
because if you're going abroad is going
to jump it shouldn't be attached to
anything so I could let's try that that
might actually be a really quick fix but
I'm now realizing this loop for the
lanes is kind of unnecessary I could
just pick the one lane to the Frog needs
to check against but let's do the detach
thing real quick on move I'm just going
to say frog attach no so it's always
going to detach I need to start myself
in the center right so you can see now
all of those behaviors are back and you
can see it's so now I don't have the
thing that's telling me to reset the
game so the issue is and this is why I
wants the for all to register its lean
the reason why I want the fraud to
register its Lane is because if it's in
that log lane and not touching a log it
needs the game needs to reset so what
I'm going to do is I'm going to say and
I still can do the move detach thing int
late which Lane index equals frogs Y /
grid right and an integer version that
that should give me the index that it's
in all right let's just see this print
Lane index it's actually going to have
to be inverted I just realized oh no
that's right ten nine eight seven six so
this works so now that's the only Lane I
need to check so
I can just say lanes index lane index
check frog so this way I got to start
myself in the middle so when I'm testing
it hard okay I'm starting myself in the
middle high / - - grid / - is what
should be yeah there we go sorry so now
I should be able to oh okay so now I
should be able to jump around but and
get pushed off but I now need can go
back and in the lane check if it's not
okay
you lost reset the game okay whew
so now I should be able to jump around
but if I fall off the log I reset the
game okay whew I think we refactored
this pretty nicely somebody made a good
point like well why should I have this
type variable maybe what I should do is
use inheritance and have three different
Lane classes car lane obstacle Lane safe
doing and actually that's a very good
idea and I think it could be reasonable
to refactor this yet again so I think
this is going to be enough refactoring
for this particular video all I did was
really factor into this Lane and I don't
know if you can really see this makes
you really want to see the beauty of
what I've done
not that everything I've done is really
that beautiful what I love about this
now is this is the draw loop this draw
loop is so simple and the one thing that
I would actually say is maybe the lane
index the Frog should actually has a
function that just returns explained
index because look what's happening here
I just run all the lanes I just checked
the one lane the frogs in an update and
show the frogs even though this is a bit
unwieldy because I initialize all the
lanes manually and maybe there's a
better way of doing the argument that
something should be random or I should
have some type of algorithmic way of
generating it that's yet another
opportunity
so with refactoring only comes more
refactoring
refactoring the guests refactoring life
is all just one big refactoring session
so I hope you enjoyed my rather long
refactoring session I think there easily
could be a part five to this in a part 6
what I want to say and is that check
this videos just if you want to
contribute to this there are a few
things you can do so in this video just
in this video's description there will
be a link to a github repository that
has this processing version that has a
JavaScript version of the same code and
then also a link to another github
repository that is kind of a community
created version of the game where people
can add their own graphics and different
things and if you make your own version
and want to link to an arena there's all
these ways you could share and
contribute to the stuff I need to say it
more succinctly but check the
description and I'll describe it in
there so thanks for watching this part 4
is it the last will there be more will
there be another actually I'm one thing
that I was thinking of doing was redoing
this whole coding challenge as one video
but in JavaScript now that I've done it
in four parts maybe I could do it all as
one video faster I don't know we'll see
I'm thinking about that if you're
interested in that say in the comments
but I don't know that anybody's actually
watched to the end of this video ok
thanks for watching and I'll see you in
the future video
oh oh no don't leave yet sorry one thing
I left no no I think I think I might
have left no no I got it right oh no I
left the wrong
I left the wrong position so there's
let's play this game one more time I'm
gonna make it come on edit there you
speed this up this is the means it's
kind of hard because the last one is so
fast
okay I waited Frogger I win the prize of
the internet prize thanks for watching
I'll see you next time the train calls
into station
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>