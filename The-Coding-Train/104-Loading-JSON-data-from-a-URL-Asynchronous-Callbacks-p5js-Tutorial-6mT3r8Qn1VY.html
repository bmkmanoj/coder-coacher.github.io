<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>10.4: Loading JSON data from a URL (Asynchronous Callbacks!) - p5.js Tutorial | Coder Coacher - Coaching Coders</title><meta content="10.4: Loading JSON data from a URL (Asynchronous Callbacks!) - p5.js Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>10.4: Loading JSON data from a URL (Asynchronous Callbacks!) - p5.js Tutorial</b></h2><h5 class="post__date">2015-10-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6mT3r8Qn1VY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this video I want to look at loading
JSON data not from a local file like a
file like Birds JSON that's right there
in your project but from a URL and this
is one step along the way to query an
API to say like hey weather map thing
give me some weather data or hey new
york times give you some new york times
data so but I want to start simpler than
that but so so first of all this is
actually really really easy in the sense
that all I need to do is replace Byrd's
JSON with a URL that gives me JSON data
but it brings up a question about how
you work with loading data beyond just
this preload thing so the preload idea
was super convenient it guarantees that
all the data is loaded before the
program starts so you've got all the
data you can do anything you want with
it as the program is running but this
breaks down very quickly and very easily
so for example here's a scenario where
you want to have a some sort of weather
visualization like you're going to show
the Sun if it's sunny out or some rain
if it's raining and you have a button
that just says like load data so every
time the user presses that button it
should get the most recent data the
current weather so you can't use preload
for that because you can't preload the
future boy wouldn't that be great so
when you invent the whole like
time-travel thing you can use preload
like preload time maybe that's how we
get time that I don't know um but um you
can see how this doesn't work right you
can't preload the data you've got to
load the data while the program is
running you know certainly could also
make the same case of as a program is
running you just want to continuously
like if you're trying to visualize
financial data and it's just like
changing every three seconds you know in
your draw loop you might want to query
the data and query the data and query
the data you also don't want the program
to stop animating while it's waiting to
load the data so you need to load the
data in what's known as an asynchronous
manner meaning the when the data can
arrive and another in another sort of
like parallel universe of your code
that's running so your code is trucking
along it's starting it's animating it's
looping it's doing its stuff at any
point there it's a hate loads
and let me know when the data is loaded
so how do you do that right we said but
previously in preload var birds equals
load JSON this is the synchronous way
right preload loads the data the program
waits and waits and waits and waits to
start the asynchronous way is to just
simply only call the load JSON function
pass it the path of the data that you
want to load birds JSON or some URL and
then what's known as a callback function
so I'm going to call my callback
function got data so this by the way is
exactly a topic that I discussed in a
previous set of videos all about looking
at on HTML elements like buttons and
sliders and what happens to have a
callback when you click the button so
I'll try have a link back to the video
about callback and events this is
exactly the same idea here I now need to
write a function to handle the
asynchronous nature of the data arriving
later at some other time separate from
my program that's running in its
animation loop so if I say function got
data this function is the callback for
loading the data I'm starting a process
hey go and load some data and when
you're done let me know the let me know
is trigger the code in here
now this isn't magic this isn't some
like default thing that just happened
you know this is sort of the nature
about just about everything in
JavaScript works but load JSON and this
methodology this is specific to the
p5.js library of course with native
JavaScript or jQuery or all these other
frameworks they all have something
similar to this so conceptually this is
a kind of concept that sort of across
the board and working with data but this
syntax and this function name is
specific to p5.js so I give it the URL I
give it the callback and then this
function is triggered and when the data
is ready like the data is ready so I got
something again that's good um the
questions like where is the data like
I've completely lot like here the data
is in this variable called birds that's
very obvious them saying birds equals
low JSON but there's no variable
anywhere there's just the URL the low
JSON function and the callback so the
special way that p5
I've works and that a lot of things in
JavaScript works is if you add a
parameter to your function definition
your callback definition I'm calling it
data p5 behind the scenes will fill that
variable in the function with the data
so it's like you said this data variable
equals the result of load JSON but it
happens asynchronously lo JSON from this
URL when you're done trigger this
function when when that function is
triggered the data will be in that
variable got it I don't know what to do
that's all I can say about it but send
me your your in your your messages in
the in write them and give a carrier
pigeon or Twitter or whatever email
contact me say hi I'm Eve
human interaction is a useful important
thing so let's make that happen over
here right so in other words instead of
just instead of saying data equals lo
JSON I want to say and I don't want to
have preload actually at all like I
could actually just here I could say
actually let's I could say I'll just put
it in setup I'll make this more
interesting later I could just say lo
JSON Birds JSON but they're coming for
me help everybody my heart is racing a
little bit so maybe if somebody knows
that I might need some medical attention
um Birds JSON is the name of the file
got data is going to be the name that's
a name that I'm making up for the
callback I'm going to create that
function called got data I'm going to
give it a parameter right there
so now this is the process start the
process of loading the data when it's
loaded execute this function fill this
variable with data and now I can say
console dot log data or just I sorry
print line I like to use the doesn't
matter but I just want to see that this
works and I'm going to run this you can
see that's happening it's happening
super fast because the data is loaded
and then this is triggered great it
works
so now let's let's let's let's move on
from this birds data set and let's think
about what it means now to pass a URL
into that function and how we might know
query the data
at a particular moment in time while the
program is running so what I want to do
is I'll use a simple an API that I like
to use which is a URL for JSON data that
I like to use this is really which is
which is tells us how many people are in
space right now so I'm going to go grab
this URL right here I'm going to paste
it into the browser just to see that
this works and you can see look at this
I am this this URL is giving me JSON
data
what is it giving me it's giving me
information about the number of people
in space and you can see it has it's an
object with a number six and it's got
that an array of people with their craft
the International Space Station and
their name so the number of people
currently in space is six and these are
other people and this and that's the
spaceship that they're on now ideally it
would be great if this was a data set
that like changed very often Soviet
refresh say seven and then eight and
four but I guess people aren't like
going to in space very often so this
isn't like necessarily the best
demonstration of why you would need this
but when some future videos I'll get to
data that sort of changing that needs to
be refreshed in your program so all I
need to do now if this works is take
this particular URL and paste it right
in here so you can see that load JSON
works not just with a local file but
with a particular URL and now if I run
this OH
I don't see anything I wonder hmm
interesting and I didn't even get an
error I'm going to just add something
close your eyes and don't pay attention
to what I'm doing yeah work okay so this
is a good moment to have this discussion
security is a isn't is a thing right
authenticated with a name and a password
and you know allowing a browser uh your
browser on your machine to talk to your
camera or to talk to another server
working with data opens up this kind of
big can of worms of what you're allowed
to do and what you're not allowed to do
and there comes a time in your life
where you'll find a URL and that URL you
know it gives you JSON data because I
pasted it into the browser right there
and I see that JSON data right there but
I put it in my load JSON function and
like nothing happened now honestly I
didn't even get an error here there's a
bit of a secret that I think I'll show
you which is right up here in the
browser window there's a there's this
like settings up and I can click on that
and I can get some more error messages
and you can actually see the error
message that came xmlhttprequest cannot
load this no access control Wow origins
has present origin is therefore not
allowed access this error message is
like the bane existence I always forget
that it might happen and sometimes it
doesn't happen and sometimes it does
happen this has nothing to do with you
or me this has to do with how the server
the place that the URL address is
configured and this URL does not
necessarily just allow you by default to
grab the data however there is something
called JSON P the P stands for padding I
like to think of it's like a safety net
it's like I'm in the room with padded
walls and I won't hurt myself asking for
the JSON data and I feel like that would
be an interesting topic for another
video to delve into that more deeply so
sometimes if you're not allowed access
in this sort of traditional way you can
use this thing called JSON P to get the
data and you know the one of the ways
that I could do is I like put the URL in
low JSON and when it doesn't work I just
add JSON P and I hope it works
and usually it's gonna you know I try
first without it if it doesn't work I
try it with it you know you can write
your maybe include a link to more
information about JSON P
in the descriptions video so what do I
mean by adding it so it's an optional
third argument to the low JSON function
so the low JSON function requires a URL
and the callback and optionally you can
add a third argument which is the string
JSON P which allows you to get past this
access origin control crazy error thing
that sometimes comes up where the
server's not allowing you to get clean
JSON you need JSON little padding I'm
still padding over here hurt a little
bit okay I'm very sensitive
I'm fragile
person huh so anyway so fortunately if I
type JSON P as that third argument it's
good that that happened because it's
going to happen to you and I run it you
can see that the data is now arriving
there I'm seeing so let's do something
with this data and to finish off this
particular video that's already 11
minutes long so if I look at this data
one thing I might like to do is just
just like draw a circle for every single
person that is draw a circle for every
single person that's in space right now
so interestingly enough if I know that
the data is available in the got data
function that's a place where I could do
some drawing so for example I could say
for VAR i equals 0
I is less than data dot number right
that's the number six I plus plus and I
could say ellipse at random with random
height 16 16 I could say fill 255 this
is going to be the least interesting
data visualization anyone has ever made
in their entire life but we can now see
and I could say create canvas 200 200 I
can now see that when I run this I now
get this lovely canvas with six circles
on it so this is look I did damage it I
loaded a URL
I gave it a callback I even use JSON PE
for some padding and that way I have my
padding song but that's different that's
like CSS anyway I would like I need a
separate video it's just just the
padding song but um and then I pulled
out the number I made a loop and I draw
six and I drew circles based on how many
people in space and if I could just like
keep refreshing this you know I'll get
in a different location but if somebody
would just leave space right now then
you would see five circles instead of
six so this is the basic idea I do think
however there are a couple other pieces
of this that I want to demonstrate
although you could you could stop
watching now if you want you just stop
watching it anytime if you want so one
thing is I did it was kind of nice like
this is just static I don't need any
thing to animate here so I just put the
drawing stuff in got data but let's say
what you actually wanted to do was have
a particular animation that's going on
so you want your like for example I want
the background I want to have this isn't
going to be interesting but let's say I
want to have this like line that goes
across the screen from X 0 X 2 height x
equals x plus 1 and if X is greater than
width you know X equals 0 and it's a
stroke 255 so in other words I want like
the circles to appear with like this
animation so if I were to put the
drawing right back in got data I know
I'm doing this kind of quickly and
scrolling around like a madman here on
the screen but right this is not going
to work because remember draw is looping
to always draw that animation got data
is invent that happens just once when
the data is ready so this is that
happened and it drew those circles but
it immediately got overridden by draw so
there's an easy solution to this problem
you might think which is like okay just
take the circles and put them here in
draw so now what's so this is there's a
lot of problems with this let me run
this okay first of all it's not working
why is it not working now hopefully I
probably have some error message which
we could see uncaught reference error
data is not defined well of course it's
not defined I can't use this variable
data down here and draw got data is a
callback that variable data is only
available in that function so one thing
I could do is I could say var you know
I'm gonna say space data I could make up
a global variable and I could say space
data equals data so this is now 1 I need
a way of like sort of simplistic way of
doing if it'll work I need a way of
connecting the data that came in to
something that's happening in draw and a
quick way of doing that is just have a
global variable so I want to ask for the
data and the data comes in I immediately
store it in some other variable a
variable that I can access and draw so
now if I run this and you can see me
accessing it there and draw
if I run this again ah now what's
happened OSI hiatus I have to change
this to space data uh cannot read
property number of undefined what
happened ah what's that what's not
working I know it's not working I'm
pausing to let you think about it for a
second a synchronicity if that's even a
word I'm not sure but this is the issue
remember how are all of these what's the
sequence here let me try to get
everything here on the screen and let me
uh let's just move this animation for a
second below here so we can see like the
pieces that matter right
there's setup where I'm asking to load
the data there's got data where I'm
retrieving the data and there is draw
where I am using the data what's the
order of the program setup starts first
make the canvas the canvas is there load
the data that's a process that's now
happening in the background let's go to
draw start drawing draw with space data
the data is not loaded yet this is going
to take a while it got a query the URL
make some connection across the internet
get the data back so space data is not
anything until this happens but draws
already started so there is a nice way
of dealing with this and it has to do
with a kind of a nice trick that you can
do in JavaScript which is using a
boolean test and if statement which is a
concept you're probably quite familiar
with we usually think of a boolean
expression is something that evaluates
to true or false
like if 7 is greater than 5 this is
absolutely true but what does it mean
for me to say if space data now what are
the nice things about JavaScript is it
just like all it ever wants to do is to
have things be true or false like a
number it can be evaluated to true or
false
like if it's 0 it's false if it's any
other number I think it's true a string
probably could be evaluated if it's like
the string false
that's probably an evaluate to false so
what's what is actually the value of
space data before the data comes in it's
undefined if you have a variable that's
not initialized like up here space data
is not initialized its initial value is
undefined and undefined
evaluates to false so spaced it and
defined like an object just
automatically evaluates to true so you
can basically say if space data is a way
of saying if space data exists so space
data it doesn't exist until the data has
actually come in so if I just add that
oops oh I mean hosting the wrong view
you're going to have to live with that I
can right here I can say if space data
then do this so now even though draw
starts looping this part of draw will
actually happen until space data gets
filled here and now we can see this
works now of course I'm drawing them at
random locations here's actually a
really quick trick for me to get that to
stop
I could just say random seed that's kind
of a topic for another video but random
seed is a function that seeds the random
number generator so I always get the
same exact sequence of random numbers
and that's going to work for me here at
least just in a sort of quick and dirty
way so you can see I now have an
animation and a visualization at the
same time I'm not drawing the part with
the data until the data has come in so I
got a lousy was like very long-winded
this particular video I like I could
have done this in half the time
but what I would suggest you right now
if you're looking for an exercise to do
is go to this particular data source
I'll link to it below and see if you can
at least add now add the people like
what could you add the craft in the name
as like text next to the circles or
something or can you use the rest of the
data here also and quickly get it to
work in this asynchronous callback way
and I think now we've actually covered
enough that the next step can really be
is like well what do you what if you've
got an API like the New York Times or
Instagram that's serving up data how do
you query that API with low JSON and do
stuff that way okay why this is a twenty
minute video I don't know about this</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>