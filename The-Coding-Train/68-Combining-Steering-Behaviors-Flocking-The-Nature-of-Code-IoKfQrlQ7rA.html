<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>6.8: Combining Steering Behaviors: Flocking - The Nature of Code | Coder Coacher - Coaching Coders</title><meta content="6.8: Combining Steering Behaviors: Flocking - The Nature of Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>6.8: Combining Steering Behaviors: Flocking - The Nature of Code</b></h2><h5 class="post__date">2015-08-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IoKfQrlQ7rA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so it's a little bit tragic that we've
saved what is arguably possibly the most
important aspect of all of this steering
behavior stuff till this video which is
essentially at the end I don't know what
number we're on here but if you're still
with us you're still with me here we go
we've got something we've got something
that's really gonna allow you to use
this stuff in a much more flexible way
in all sorts of kinds of projects and
what what I'm talking about here is
combining multiple steering majors this
this may seem like an obvious thing to
do and I hope that it does but I want to
look just briefly in this video at what
it means technically to do that so you
know we could list all the behaviors
we've done so far
like seek rive flow field we did path
you did separate alignment I think these
are all the ones we've kind of looked at
in the particular videos one at a time
so in our first demonstration what I'm
going to do is demonstrate for you
combining seek and separate so this may
see this so first of all the idea of
combining forces is absolutely something
we've been do we have done before and
I've been doing continuously throughout
all these examples it's the whole reason
why we wrote this apply force method
right we wrote this apply force method
so that we could call on an object apply
force gravity apply force wind apply
force nervous energy right we could just
keep applying forces of the object it
would accumulate them into the
acceleration and move according to their
net result of all those forces so
essentially this is all we want to do we
want to say things like I'm gonna write
this down here apply force seek and
apply force separate so this is where
hopefully this notion of combining
forces is obvious to you right yeah we
did this we did seek we did separate all
I gotta do is bring on both of those in
the same example and call apply force
twice and that will in fact work but one
thing
we should add on to this remember we are
thinking about autonomous agents and
autonomous agents have this ability to
make their own decisions according to
some set of rules that govern their
behavior and a rule a way of thinking of
a rule that governs how you combine
these forces is a weight right how
important to a vehicle how important is
it to think about yourself what's more
important to you that you get to some
target or that you don't run into anyone
on the way there you know for me I don't
want to like bump into people and knock
them over I'm very happy to move around
them and I'll take longer to get to the
target somebody else might want to just
barrel through and knock everyone over
they just want that you know cupcake or
whatever's at the end of the line so
this is something that we need to factor
into how we program what are the weights
of these forces and how can those weight
to be flexible so that different
flexible either from vehicle to vehicle
are flexible over time right think again
about this simulation if the target is
food and the separation is like avoiding
other predators when you're really
hungry maybe Sikh is much more important
than when you're not so hungry so we
need some mechanism for doing this for
how we can combine these forces this is
a kind of a simple thing to do with the
hard part is figuring out the algorithms
for each one of these forces it's not
too hard to look at combining them so
let's look at a couple different
scenarios in code and I think this video
will hopefully be one of the shorter
ones I hope you say I should never say
that
that means Italy it's gonna be the
longest one ever okay so first we're
gonna look at separation and seek so
first I just want to run it and we can
see here that these vehicles are both
seeking the target which is the mouse
the mouse and they're also trying to
separate from each other right we could
imagine what would happen without
separation they're all just going to
glom right onto the mouse they're not
going to care about occupying the same
space so here we have an example of two
steering forces combined great so let's
take a look at this in the code so one
thing that I'll point out here just like
when we look at this for a second is we
are calling apply force twice this is
the point apply force separation apply
force seek that's what we're doing where
are those forces coming from they're
coming from two functions separate and
seek now what
thing I should note about this is look
here is the seek function here is our
seek function if you look at the seek
function in a previous example what it
will do is it will at the very end it
will say apply force some force so we
calculate go through all this desired
velocity calculated all this stuff get
the steering force and then booth apply
the force of the object put it in this
acceleration but in this example we're
not doing that instead of saying apply
force we are returning steer to wherever
it was we called it so we have a new
function this new function is called
apply behaviors apply behaviour is a
function that I have added to this
example to be the sort of centralized
location where we manage all of the
forces and the weights for those forces
so first we ask for this from the
separate function the separate force
then we ask from the seek function a
force seeking Mouse X Mouse Y then what
do we do with those here this is the
crucial crucial to lines of code we
weight them separation force is weighted
by a factor of two seek force is
weighted by a factor of one now
admittedly this is probably the worst
possible way ever to do this because
what do I what are my weights they're
hard coded numbers that means they can
never change over time and they are the
same for every single vehicle ever in
the system so this is my challenge to
you my exercise to you is do something
different you know you could think of
having sliders or keyboard control to
like control various weights you can
control them by purling noise you can
make them all random you could have some
logic you know the vehicle vehicle has
like a health value that like goes down
over time and according to how fast it
goes down it scales the weight of the
different forces later we're gonna see
we're gonna look at genetic algorithms
could you evolve things like optimal
weights for this vehicle to behave a
certain way there's so much potential
just in these two lines of code of
course all I've done is put the number
two in one there but at least we can
kind of begin to see a little bit of
what's going on right what if I set the
weight of separate to zero we can see
here this is seek with no separation
it's as if that force doesn't exist if I
go and put that to two and put seek to
zero now we have we just have that
separation example they don't
care about the mouse anymore we could
say hey let me have separate these super
important and seek be just a little bit
important you can see like maybe they're
kind of seeking the mouse a little bit
you can see they're like kind of coming
into cluster but separation is so much
more important so the varying weights of
these objects is crucial to how this
system bays okay so let's take a look at
a couple more examples
the next example I want to look at is a
crowd path following so this is just
actually adding there's not a lot to
this one this is just adding separate
two paths following so you can see I can
add a bunch more vehicles here and what
do we have here but just doing it just
those two forces creates a very very
dynamic simulation because not only go
back and compare this two paths fall in
without separation what we have is
something you can start to imagine
modeling how people flow through a space
how cars travel on the road again this
is not a scientific model we're just
trying to create the almost the illusion
or feeling of that but you could imagine
how how powerful this could be by just
adding multiple forces in here and so
this is another scenario where you can
play with those weights and try to
figure out ways of controlling them what
if all of a sudden their paths fall and
goes off and they all go to seek
something else but then they are they
you know at every once in a while they
leave the path and go do something else
and then come back there's so much I
can't I just I could just stay up all
like the rest of my life programmed
different combinations of steering
forces and I'm not going to do that
because it's nice outside today but you
should you know you should think about
that for when it's nice outside
okay um now let's look at the the
ultimatum say this is the penultimate
the ultimate example of this which I was
gonna make a separate video about but I
think we'll actually just look at it a
little bit briefly because we already
covered separation and alignment in
quite a bit of detail so let's just look
at what happens when you combine and I'm
going to go to there's a sort of example
here called flocking sliders which is
just a version of the flocking example
that allows me to control the weights so
here we have our flocking simulation
we can see that we have that this is a
full-screen version with lots of little
tiny Boyd's oh so first of all Craig
Reynolds went in developing the flocking
system called the vehicles now Boyd's is
a kind of variation of the word Birds I
guess I think that's right anyway so I'm
going to use the word term boy to talk
about these creatures in this flocking
simulation so what's going on here is we
have the three rules so in case you
didn't look at some of the earlier
videos although I guess I should instead
of saying that I should say or just to
recap the three rules we have in
flocking our separation alignment three
cohesion and each one of these rules is
incredibly simple on its own and
produces a very simple obvious result
what's amazing about this complex system
is these rules for each object are very
simple we put them together we put them
together in a group we get a highly
complex result not an unpredictable
result not a simple obvious one so
separation means try to stay separate
from your neighbors alignment means try
to align your velocity with your
neighbors and cohesion is the only one
that we didn't implement in a previous
video we steer towards the center of
your neighbors so we have something like
we have a tension here in a way between
cooperation you think of cohesion as
cooperation stay together and
competition separation compete for space
so I think one of the things about
complex systems that really makes them
tick is this idea of competition and
cooperation together in the same system
so all of these three rules together
produce this schooling like behavior
which we're seeing over here so a couple
things that I will just demonstrate
really quickly I can't really see this
but let's add a whole bunch more
vehicles up here I have a few sliders to
be able to control the various forces
here and okay I'm going to talk through
what I'm doing here and control some of
the forces so I'm going to make the
maximum force higher a little bit lower
maximum speed
I'm just gonna show you first of all
what happens when we only have
separation it's gonna make separation
very high and we can see with separation
the only thing going on here is don't
run into your neighbors this is just
exactly the same of the example we had
before just all the little things are
really tiny and there's lots more of
them so that's separation that may be
and now if I take separation off and I
turn alignment all the way up you can
see we get these clusters of objects
trying to align with themselves again
simple predictable result and eventually
over time they're actually all going to
move in the same direction now if I turn
alignment off and I turn cohesion up we
can see look these clusters come
together they're trying to move towards
the center and as they get within a
certain range they suddenly come
together this is kind of an interesting
result just on its own you can see we
have these kind of funny behaviors the
point is once we combine them all
together if I add a little lineman and I
put separation back on and look at this
like even now there's a bunch of
different weights than what we started
with and you almost have this more kind
of frenetic with insect-like behavior
whereas the weights were more tuned
towards a more of a schooling or
flocking like behavior so this is
something you can really really play
with forever and use to for a variety of
different effects and just to show you
briefly so that's the actual example
that's in the repository connected to
the book is six point nine that you can
find the one with the sliders as well
which looks just a little bit more like
this so you can see this kind of this is
with a certain set of weights with a
schooling like behavior you can see is
alignment seems to be pretty strong in
this one right there really aligning
with the neighbors but there's also a
little bit of jockeying for space as
well as I'm staying together as a group
okay so one thing I want to point out so
first I should say to you there's a
couple exercise you could think about
doing I had that list and I race of all
the forces here's something you should
think about doing make a project that
has every possible steering force you
can implement have examples of or could
implement on your own and create an
array of weights for all of those and
see how you can control those weights
through some set of logic so first just
try to control weights according to some
set of rules don't have them hard
with user interaction algorithmically
through pro-choice a randomness or by
sub logic according to how each vehicle
behaves or what its it sees in its
environment another thing you might
think about doing which I actually have
an example of is implementing well I
don't have a full example of it but
implementing Reynolds not Reynolds so if
you read the book the computational
beauty of nature by Gary William flake I
believe is the author there's a long
discussion of flocking systems in that
book and flake points out that what you
don't see in Reynolds flocking system is
all of the vehicle all of the birds are
Boyd's in a formation that looks kind of
like this which you might actually see
in the sky if you look at birds flying
together and he proposes what's what is
unique about this there is nothing
blocking the view of any of these
vehicles and what he proposes is adding
an additional force an additional
steering major which is that if of Boyd
is in front of you within your view
steer a way to get that vehicle out of
your view keep your view clear and if
you implement that you will get this
formation which is really quite
interesting so just to show you this
actually involves the dot product and
looking at the angle between two vectors
and just to show you the beginnings of
that exercise 617 in the repository
there's an example which implements just
the beginning of that so the force is
not implemented here the view force but
what you can see is that any other
vehicles that are within this blue
vehicles view are colored red and one
thing that I will also say that's really
important about these is you might be
used to debugging your code by putting
lots of print line statements everywhere
we forgot the locations print this if
it's in its view print it's in my view
another way of debugging that's really
crucial for these steering behavior like
these scenarios that you're working on
physics models it's actually just draw
stuff to the screen so I know this is
working because I'm able to change the
color of only the vehicles that are
within this arc that I've drawn on the
screen so anyway I've gone on a bit too
long about this exercise but there's a
bunch of stuff that you could try to do
and hopefully discuss somewhere when I
when somebody these videos have more of
a way of sharing work and asking
questions and discussing with them right
now they're just videos but there are
comments anyway um so I will see you
later in whoa this is the last video so
I think that's actually marks the end of
the steering behavior stuff I have so
another example about optimizing
flocking systems if there's too many
elements in there but someday I will get
to but you can take a look for those
examples as well okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>