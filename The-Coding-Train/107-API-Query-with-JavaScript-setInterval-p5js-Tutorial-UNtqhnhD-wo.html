<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>10.7: API Query with JavaScript setInterval() - p5.js Tutorial | Coder Coacher - Coaching Coders</title><meta content="10.7: API Query with JavaScript setInterval() - p5.js Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Coding-Train/">The Coding Train</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>10.7: API Query with JavaScript setInterval() - p5.js Tutorial</b></h2><h5 class="post__date">2015-11-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UNtqhnhD-wo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello in this video I'm going to look at
how you query an API continuously while
a program is running a program that's
perhaps animating something and that
animation doesn't stop it continues
smoothly but updates whenever new data
comes in boy it's been exciting topic
you woke up this morning and thought I
want to watch a video about how you
query an API continuously while an
animation is happening right okay so um
that's what I woke up thinking I was
gonna do is make a video about that
actually I just thought of this a few
minutes ago so I didn't really wake up
thinking about it but let's just get
started so this by the way is a program
that I've set up in advance just to have
like a simple animation on the screen
nothing too exciting this line is moving
across there's a single variable for the
line the line is incrementing by five
pixels when it gets to the end it starts
back at zero so we can see there's any
animation now what I need to demonstrate
this idea is I needed API that's going
to give me data and it's going to give
me different data every time I query it
so a lot of it guys don't really do this
for example if you ask for the weather
you're going to get the temperature
outside temperature outside obviously is
changing but the weather API probably is
only going to update every few minutes
you know if you ask for the New York
Times do an article search you know
there's not going to be a lot of new
articles every with a certain word every
like few seconds however there is this
API called
that's under open notified org and it
gives you the International Space
Station current location and by the way
in case you were wondering that's
changing it's moving are the earth is
spinning I don't know somehow it all
works physics asked Stephen Hawking I
don't know about this stuff although I
find it fascinating so what we can look
for here is like look here is how here's
the URL for getting JSON data with the
latitude and longitude of the
International Space Station so I all I
need is this particular URL I'm going to
copy it I'm going to put it in the web
browser to look at that data and we can
see there it is the International Space
Station position is currently at this
particular latitude and this particular
longitude hit refresh whoo come on
change it changed right you can see it's
changing each time I hit refresh a
little bit by changing whoa it's moving
by a fast latitude this is like a this
is called the refresh
by the way it's good a physical exercise
is important why I'm standing making
these videos I feel like I need to move
around more okay so so when you practice
api's you know move around where was I
um so this is some stuff that I want to
get I want to get into my into the
program so first let's just let's just
get started with that so the first thing
I want to do is grab this URL now and
inside the program I may be just in
setup right now I'm going to say lo JSON
and I'm going to say the URL is let's
for this particular API and let's just
make this a global variable I'm trying
to make things that fit in my code
nicely VAR URL equals ah bad copy paste
job paste that in there so that's the
URL for the API query let's make this a
little bit wider so now I want to load
JSON I'm using the p5 lo JSON function
which says give me a URL which doesn't
say anything actually but the thing you
could give to it to the URL where you'd
get some JSON and then a callback so I'm
going to call the callback got data so
this function will be executed when the
data has come back so I'm going to say
function I'm going to write that
function got data the argument the
parameter of that function which I
happen to be calling data you can call
it anything you want like a manatee the
the parameter data is what's going to
get filled with the JSON that's coming
from that URL so you know just quickly
if I just said print line data we'd be
able to see very easily that whoops okay
ah so remember this thing I talked about
this in a previous video boy I hope this
works
sometimes it doesn't work sometimes it
doesn't work because of security issues
with how information is passed between
different servers and open notify Det
org is a different server and if you
just add some padding so this thing
called JSON P this if you add a third
argument JSON pipe maybe I someday I'll
make a video just what is this JSON P
thing it's telling p5 behind the scenes
to use this other way of getting the
data that kind of passes security so
hopefully now
when I run this sketch we can see and
there it is now you can see that data
showed up down here in the console I've
got that data so looking at this
remember the next thing that we need to
do is figure out how do I get the
latitude how do I get the longitude well
JavaScript object notation is the way
that I do this this whole thing is an
object and I want to get the first
property is s position and then I want
to get the first property of is s
position latitude I want to get the
second property of highest position
longitude and by the way I said first
and second in objects the order doesn't
actually matter it's not like an array
where you would be a referencing from
the index you may rut you're you you be
I be I am
no no it's I've it anymore present past
future perfect something like that but
I'm going to in a moment on the computer
type in data dot is s position dot
latitude that's how I Traverse into this
JSON data okay so back here I'm now
going to say print line just to make
sure this is working print line data is
s position dot latitude what rhymes with
latitude fortitude I don't know okay and
you can see there it is beautiful
so let's think about what I might do now
hmm with that data what what might I do
okay well let that want to draw the
space station on the screen in my space
station again from the person with no
visual talents will be a circle so let's
let's do a let's make a variable called
ISS X is s y because I want to make
variables that are impossible to
pronounce and in got data I'm just going
to say ISS x equals the latitude and ISS
y equals the say it with me now
I feel like I'm mister Mister Rogers
longitude can you say longitude it would
be an that's a good thing to aspire to
to be mr. Rogers um so I can put those
in those variables and let's give those
variables some default values just to
start and then let's in our program
it's our I feel like this belongs to you
and me this programs so I could say our
program
I'm going to draw the International
Space Station and now I'm going to say
fill 255 here we go and where is it hmm
I don't see that International Space
Station why don't I see that
International Space Station what data am
i getting 50 negative 95 well if I draw
something at the pixel x equals 50 and
the pixel x equals y equals negative 95
that's where 50 over that's way off the
screen so this brings up an interesting
question I have a latitude and longitude
I have that's real world measurement
data of where the ISS actually is above
the earth in the units latitude or
longitude but this thing that I'm
drawing in the window is pixels it's
2-dimensional it's got an x-axis got a
y-axis zero zero at the top left corner
so I somehow need to translate latitude
and longitude to X&amp;amp;Y
now a topic for another video might be
how to do that using you know quote
unquote correct I won't use air quotes
here but quote unquote correct math
right if you take a sphere and you
flatten it out you need to do some sort
of like spherical transformation of
those spherical coordinates to where
they are in a 2d plane but you know
sometimes in life that's too complicated
I don't want to worry about that right
now it hurts I have like a pain that's
like it's in my lower back right now and
I just want to like live and easy and
friendly like and you know other way
that we could do that is just with the
map function because latitude has a
range between negative 90 and 90 and
longitude has a range between negative
180 and 180 which one is it well it's
got it one of these was negative 95 I
was right about that
so I could just take those ranges and
map them from zero to pixel width from
zero to pixel height so let's do that so
what I really want to do is I'm going to
say var lat
equals the latitude var long equals the
longitude and then ISS x equals a map
the latitude which goes from negative
ninety to ninety two between zero and
width so if you recall I definitely have
a video somewhere all just about this
math function
what the map function does is it takes a
value that has a given range and maps
that value to another range by the way
you could do that math yourself if you
wanted to I know you guys I believe in
you it's not that complicated but it's
nice to have the map function to handle
that for you and I think perhaps in my
other video I talked about what the math
behind the map function is okay so now
if we run this dunk denta look there it
is the International Space Station and
if I hit refresh
come on move you can see it's like
moving a little bit
very ever so slowly and slightly so you
know I probably could do a better job of
making this here more intimately
interesting but we've got something
working here but I I spent all this time
I've been talking for nine and a half
minutes and I haven't even gotten to
just this is just all set up all set up
for the real tofu I don't say meat
expense times weird the real like
essence of this video which is now I all
I did was query that URL at the
beginning and set up and I got the data
once I want to just keep getting that
data over and over again how do I do
that okay so there's a couple
possibilities here of how you could do
that one thing is I have this draw loop
draw remember is looping over and over
again for the purpose of the animation
so I could figure out a way to just put
the load JSON function and draw like
that would be querying the API 60 times
per second now that's probably way too
often so another way I could do is use
some kind of counter and say like every
10 times through draw or every 30 times
over your hundred times query the API
all of those are possible and I
encourage you to try doing that on your
own as an exercise or put something in
the comments and say hey can you link to
some code that does that I'll be glad to
do that but what I want to demonstrate
to you in this video is another way of
doing it and I will shuffle off shuffle
off the Buffalo over here Buffalo and
I'm going to do this with a function
called set time out and even better yet
I think maybe I'll actually do it with a
function called set interval
these are functions that are part of
JavaScript itself in the browser these
are not p5 functions and what these
functions do set timeout says trigger an
event once you know at blank time so set
timeout says I want you to do this event
and I want you to do it 3 seconds from
now set interval is very similar trigger
an event over and over every blank time
every blank milliseconds time should
really save milliseconds at blank
milliseconds at blank milliseconds so
right the difference is the event is
clap right I'm going to say the event is
clap so if I say set timeout 3000 what's
going to happen is one one thousand two
one thousand three one thousand if I say
set interval three thousand what's going
to happen is one one thousand two one
thousand three one thousand one one
thousand two thousand three so it
doesn't one one thousand two one
thousand three one thousand right right
it's going to do that at the same
interval over and over again so you can
ask yourself which one is the one you
want for this program I want to ask for
the data every so often so I can use
that interval now there's some nuance to
this there's some reasons why other
scenarios you I'd want to use set
timeout and then once I get the data
back just ask her it again that actually
could be a good way of doing this but
set interval is going to be kind of
easiest for us right now so the way that
these functions work is you know if I'm
using set interval for example set
interval and then I'm going to pass in a
callback this is the function name of
the thing that I want to happen every
blank milliseconds so all I need to do
is say set interval do this thing every
so often let's look at that over here
now
so in setup I want this to start in
setup I want to say set interval ask is
s every what should we do let's just do
every second so 1000 so this now looks
this line of code says execute some
function called ask is s +
1,000 milliseconds and the magic of
JavaScript and asynchronous events is I
can set that thing up going and it's
going to happen on its own but draw down
here will also continue so this
animation will continue the API calls
will be happening when the data is
writing that got data function happen
everything that whole how the order of
everything will happen will be managed
by the magic of JavaScript event based
handling so all I need to do is set up
the events I need to say set up this
interval and then also do draw at the
same time which is what I'm doing in
this program so now what goes in this
function called ask ISS this load JSON
call so I just want to do exactly this
load JSON call every 1000 seconds for
the rest of time at least while the
program is running and we can run this
now and you can see there it is come on
move dot move I assess to get some feed
going so one thing that I might do
actually here is change my mapping write
this mapping is kind of I was kind of
mapping the full latitude longitude of
the entire world but we can see here
that it's currently at latitude 47 and
currently at longitude negative 54 so
let's go between 45 and 50 and like
negative 55 and 50 so if I change this
to be between a 45 and 50 and what I say
negative 55 and negative 50 I think if I
do that we're going to get to look there
it is
it's moving can you see the space
station it's that the space station is
flying every second now I'm you can see
it as a rhythm to it because I'm wearing
it every second what I would love to do
with this but I've been kind of this
video's approaching 15 minutes is I
would love to like add a little easing
motion into it so it doesn't just jump
to next spot when it get to new spot
this or smoothly moves you can make it
sort of feel like it's moving you know I
would also love to put an actual map
there to love to do the correct
spherical math I just have max again
without him thinking about it usually I
do that just because I like saying maths
but oh it's leaving goodbye
International Space Station so anyway so
but I'll leave that for view exercise
for you guys so what I would say is like
a try but build exactly the same thing
what happens if you do it every 10
milliseconds versus every three three
3,000 milliseconds you know could you
make it move move interpolate between
those two locations
I can't I'm trying to think of other
exercises that you could do but play
around I'm sure you could be creative
and come up with some ideas and
hopefully this video helped you learn
something today I don't have I don't
have anything like say like Schiffman to
- although I think I just so to say ship
with - - at the end of every video okay
goodbye ah broken mouth now sleeping
mouth hashtag sleeping Mouse you can
that you can if you watch this video
tweet me hashtag sleeping mail Schiffman
sleeping I don't know how am I going to
keep trying I'm gonna be all search for
these things never mind okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>