<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hitchhiker's guide to the Erlang VM | Coder Coacher - Coaching Coders</title><meta content="Hitchhiker's guide to the Erlang VM - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Hitchhiker's guide to the Erlang VM</b></h2><h5 class="post__date">2012-11-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fctrWbgbJg0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah
I'm Robert nettings I work out a
solution I am sometimes more principal
language expert on the other policy
actions
so this talks all these factors to of
sleep and just a quick tour but Bob the
beam VM the a like VM looking some of
the features of it which and how it
effects your programs sometimes you make
more system about that there's the
microphone working yes so yeah so the
first question of course is what is the
D it's a number of things I mean it's a
little machine to an hour so when you
compile on you compile down for virtual
while down here assembler for America
machine at the end of the mr. system
which runs those instructions
it also contains interfaces to the
outside world we run you out like
program but do something empty
communicate to the outside so it
contained face book contains the courts
water talking the outside world and the
midst of course see bunkers as well
if you implements those and it also has
a bunch of built-in useful functions not
just things these aren't things with an
Allen but just things below all this
that are necessary or useful to be able
to run your code some of these functions
are partly Allen language like spawn and
some of their just use the library stuff
you could you couldn't do efficiently in
a line cause you access the operating
system
today many of these if they've been
written today that would have been
replaced using your system back in the
old days
I'm not gonna run through our honest you
never give this devil knows it there are
a few property of the Allen system which
are very important when you're even met
so this is the end this is what the
language is over the system so the beam
or any malaysia valley needs forth
lightweight massive instrument so it is
assumed you can create that basic is
many processes as you think for
literally millions of you you need vast
lightweight they synchronous
communication language has that
consistent us unique process like
isolation primitive to doing your app
and you need support forum doing code
doing code upgrades and the whole thing
has to be soft real-time well that
Wallace means in this case is that you
shouldn't notice things going on so the
system makes clauses which it does to do
things you shouldn't notice them and
that's the soft part of the softness so
that one has concept of timeless loss
hybrids so these are probably the system
itself then you have a bunch of language
properties things like a beautiful bait
that we're missing is a functional
language very important that they're not
rocket science and these things language
you will find water by the way actually
the system has to handle left there's
nothing really special brew that will
imagine there's a pattern matching the
pilot in the compiler that's basically
standard there how to do that that's
there if I'm not gonna really talk about
that for so to run out like we mixed
water illness the difficult thing not
the sequential file slots functional
language specific parts is the other
things thirsty so we're going to look at
concept the schedulers process processes
memory management
who's that Mitch passing multi-core as
well and time does not allow us to get
ready so the first thing we'll start
looking at is the concept of so
when you're running an out of the system
running of the you're running a number
of edges more or less semi-autonomous
our each scheduler run as much as
possible
it runs quite so hard not to interact
with the outside world more than s2 they
have to and each scheduler runs in its
own pn 3 so each one is a separate
thread and running in speed running in a
normal PN 3 it does all its own stuff so
it contains its own run queue so each of
the each of the schedulers knows exactly
what it's supposed to be doing is its
own run queue
and the run you thinking is not just
talent processes these other things that
the fear has to take care of so there's
some reason the via the jetty was sorry
has to do something
the thing you have to do you put on the
runt you and you can process it with me
when it gets there so there were a few
things like doing it drums or something
like this initiative this makes many
things much easier seem to be with when
the VM Fox lifting off for unusual to do
something it would be an understatement
set up in the right way several doodles
so many things will be put on there and
each year as I said tries to run her
separately as possible so what you want
to try and do in a any politic war SMP
system to try and reduce synchronization
and lots synchronization box are nasty
stuff that cost a lot unfortunately the
war concurrency will paralyze me get in
your system listen I'm trying to reduce
the dissipation loss is waiting between
and the ITP blue with a lot of effort
into trying to reduce box this system
they're still walks in there but
beginning with them as possible yeah
example so now that sending a message
actor doesn't do a lot assistant even it
process you'll Sydney who happens to be
running on another thread knowledge it
to writes and it's a big window but
example a shot the very end just how
much walking is synchronization actually
lost
so have the schedulers they wrote their
own little viens they're running on
beyond the threat why default you'll get
one threat before you can specify when
you start the other we announce rates
one generally you don't want to run more
more of the Alice's should exist and
there are four dozen sometimes however
you do want to run fewer schedulers and
there are calls your machine is doing
something else you might you might want
to tell that don't try and primal
everything don't try to hold this motion
of machines
what if all telling will grab everything
you can use that you might want to say
yeah I'm running something else over
databases I just don't want to run it
now it might also on our Father through
three quarters you can do that for some
reason not so we start up there like run
ball there now schedulers they're all
running more or less separately much
more separately as they can be of course
what they'll get differently something's
running on my schedule like a lot of
other churches like Baltimore suspending
things so there's a built-in mechanism
in distributors for balancing the load
balancer so what happens here every
period is somewhere around plenty of
20,000 reductions the reduction in the
Allan in the other corner that makes
sense is a function basically an hour
so they still recall cool reductions way
back in the old days when it was
implemented in color and Paulo doesn t
function holes they do reductions so
that's where the word comes but today
basically means how it functions so
everybody before you have function calls
one one of the schedules we've chosen to
be mastered that's generally the first
schedule that reaches this channel it
says on here that tells will yell
schedulers on now the master and what it
does then does is outlooks of all the
schedules will try to quickly work out
how balanced is a system is this so that
the run you want one shedding very long
other schedules are very short or
something like this introduced tries to
balance the system so this in the sensor
system is soft balanced and I've just
1000 workloads to optimize the system it
does this what putting things on one
news so I can tell us you love move this
process new to someone else the other
way can culture to grab a process in
this shadow world nor on you it puts
this type of information of the ones you
version of the duration and so they can
keep on working and they'll process
these this information when it gets
there till one of things
so that needs a system estoppel is more
or less self balancing then after the
mass has done this everything just keeps
on working until the next time on this
menu 40k productions are capital
attacking somewhere up there a new
masters chosen then does we should yeah
so here's the time when the generals are
actually directly interacting future but
none of them are suspended is adjustable
someone is doing balance and doesn't
mean the other should reverse estate
suspended sit weightless there's no
suspension table all the all the master
doing is putting this other commands on
the run using or the other churches
while they would there's no sort of
simple synchronization of any form of
second synchronization and the basic
balancing so now we're running inside
edges and they have the processes they
have their own run using the hood and on
the run to your course will be gallant
processes that means and processes
action I've scheduled the different work
process or suspend it's different
reasons so when I process it waiting for
a message
it becomes suspended because not on the
run you it not running is suspended than
citizen waits until someone sends a
message so having a process waiting for
message is not what a busy wait just is
there which also means that it doesn't
cost anything CPU to have lots of
processes which I'm doing
for example having having supervises
hopefully as supervisor never does any
should start the process and just sit
and wait than just die than kill roses
and that doesn't cost it doesn't cost in
your seat mute any CPU time Buddhism the
person just sitting there this is not a
busy way to just wait and so and it
doesn't become runnable it's not cool
other human till a message action
arrives it then is put all that work
with you when his turn comes in the
process the processes are running so
there will be unchecked remove from
running after two reasons either they do
receive and there's no message matches
in which case they'll be suspended or
after 2000 reductions their processes we
research so no process adding processes
without the water system so even if a
process is to repeat continually running
after 2000 function calls
it'll just be removed what will be
suspended and his research in the run so
happy before I know they're thinking of
increasing this level 2000 productions
seeing even much faster these days short
so this is just a simple use of the run
Houston
mean that nope resistors person waiting
for messages it doesn't cost anything
and no processes are lost
they'll be we should a bit about memory
basically or different type of memory
areas then we twice so there are
processes huija post SN Adobe its tables
they're in a separate area as well
they're outside of the process the
active table is also where we put big
liners start the a turntable is easy
so when you create natural its interned
in a global energy which means
comparison battlefield fast
so all that committing in danger is just
it's just index into the active table so
you can use it very fast which means you
never really have
yeah there's no need do not use an actor
I want to tag some sort is no you've no
need to not use it Adam say replacing it
won't go faster I can actually use okay
devs over to anyone or zeros but Papa
Adams are never delete so once you
create an actor it's always there its
global it's always there and
they're not garbage collector and so you
should be careful the programs that
create ladders this is genuine on a
problem with code and we need to come up
even have a lot of atoms in code
they really aren't that many they've not
been easy one thing I got a table by the
policy meeting million atoms or
something like this and you will not
feel it right now but you should avoid
doing the programs that create atoms on
the fly because then you will build and
when that happens the system crashed
there's just no way yeah if you've got
immediate slots at the atom table and
you try to direct them you didn't want
that system pressure host so avoid
applications will you create it
there is some help because you have the
basic functions great atoms list to
adamant why turns out there's also a
functional list or list an existing atom
environment existing it will only create
then you can already exist it's a way of
allowing you not make sure we don't
create new under those typical case you
should be warned if you give you some
messages in the outside world and you're
asking that building now that
representation files and creating active
reply they're really checking station
pressure also leaves you very difficult
package to send things in fill the Attic
table crashing system yes yeah they
create default life and when you load a
module in they'll be number of atoms in
the module
great you cannot fill the appetite not
know you have to disclose anything that
was although unhappy it's all dead this
is what creating after death so that's
the action play another area is a lot
like all the large binary space so
generally all data's locals will process
on the process heat but wine means that
have bigger than 64 bytes hops there
they're pointing us in a separate area
and so you can send them a very
efficiently but you're still very nicely
process of live wires so you have a
system to send large wineries through
the system to that echo because no need
appointees neck it's a bottom in your
passes requirement of 10 processor one
interesting thing that of that all these
decisions is that there is usually no
best choice so whatever choice you make
someone's going to win from it and some
once again say this to capacitor so
whatever you're doing like light of the
atoms we could have at nominal operating
table and just have atoms as objects we
should be very fine garbage collected
but then a comparison you can loosely
call yes but I won't garbage collect
data and the trouble with a lot of
wineries basis that its reference count
so every time a process access at one of
these libraries the reference count the
whiteness of this crystal for every
process in that reference line
which means winery can't be removed
which means until all the processes they
have seen this binary and mean
garbage-collected and this reference
count decorators they are criminals and
that can take a long time so a real
problem is that you just get too many
large wineries in the system too quickly
and the garbage collector in the system
can't keep up and I saw a very simple
example just last week II by just doing
a school benchmark program so yeah sure
- outlet notes talking to each other
and on one node he created one megabyte
like and then he start off with two
thousand processes on that sending that
firing across to the other nodes in 2000
process the other low sending the same
vigor across and the after a short time
node to the one receiving all the
messages crashed because every time that
body was sent okay there's only one papi
on the sending node on the receiving
node a new copy was made where we taught
the library right and all the processes
was doing receiving which are sitting in
a loop receiving the message so they
basically didn't know garbage collection
at all and that just results in the
wider space overflowing and also it's
running exactly running on a Mac so the
boss era doing the crash dollars getting
bashed up leader the worst of all places
is doing crack you couldn't find out why
and that was just a binary space filling
up so quickly because there's no garbage
collection done ago and calling the
guard that effect actually helped that
solve the problem that slowed down the
program most people do not have a
botanist
there are you ever get
this is just something to be aware of
which is against outside having large
binary space meet you at Agra large wire
expense inning basis was much more
efficient did you paint water this is
hoping they say they tune in tables and
lot more processing says this somewhere
and it's not explicitly garbageman so it
will not like normal data would just
help with the government payment no one
access it when you delete an object will
you delete the table or element to the
table of course there that data let me
be plain from the table itself won't be
garbage collected just as no events it
also means that time to access knowledge
less time you're copying data backwards
for me the process when you write
something against table will op you get
into this though you're accessing data
you're reading it back that's one reason
for having functions like match and
select because if you do war war
conflicts selecting a data without a
packet and coffee first Savior
but there's one very big bet for two big
benefits for using it stage one is you
miss more large amounts of it you can
watch this is differently awesome
you can have your names tables one to
ten how many lies there which would be
totally unreasonable to slaughter
process zoo my wife so that that's one
very good reason you can do another is
it makes it easy to share data multiple
processes access to the same next thing
which means you have the Portland Pro
system is the downside is the edge table
database is just just a war datastore
very limited transactions there's no
reason for doing it also look up
climbing rates tables fast you need more
passion more passionate stable since
time it's very fast faster than you
could write itself you can take the
process we get them independent one of
the hairy access
I've only got ten ten elements just
doing locally to a process what we much
more efficient just to keep better keep
that list processors
for them something's that definitely why
solution war there is processes so each
process has a separately and all process
data is local psychosis there's no
shared data to resist any sharing is
done by things like putting Datanet
staples or the large - there's no
at all or shared data also for the
process so that means also that sending
messages means copying data you send a
message from one process about your
copies the message that is actually not
required by our Allen doesn't say
anything about how I send them is
exclusive walled cities that process
gives the process have to be isolated so
that one process can happily crash
they're not rule the memory reversal
having separate each copy is one
implementation you can do other ways to
sneak date using beautiful than actually
share data processes the implementation
can sure you don't notice there are ways
to setting the processes on see some
more about that as well which it happens
better then the question arises of
course always copying the data isn't
that very inefficient isn't this
extremely inefficient way of doing
mischievous why have to obviate one
industry share danger and Shanna
Revolution breakfast we one sensitive
but again with everything else that sort
of like maybe tuition but having pro
separate process heaps gives you a lot
of benefits as well yes I have to copy
later but it gives me a lot of other
benefits so it allows you was the beam
garbage collected every processor and
most generally processing pretty small
maybe if you process the growth
generally pretty small it also means
that when it added garbage collecting
process the system fine process the
process it means I can just I can run at
the simple government that can on just
the process and I don't have to worry
about blocking the system so it makes
the garbage collector much more
efficient I can do basically was
stopping and garbage collector process
and that makes the garbage collector
much more efficient to do that it also
becomes simpler which is not something
to do to be school probably working
memory management systems like garbage
thicknesses is that when you know error
you see the result of the error much
like a couple of garbage thank you later
one system finds at some pointers will
wrong and the whole thing crashes
absolutely no idea and if you had a
Chevy I mean it's not the technology is
there to used is to do say share in
garbage collectors and do them
incrementally in such a way that you
don't notice the forces they become more
complex and they become less efficient
less efficient in the sense that they're
doing more work than they do
and I've done some over was before on
single cause it's just more work now it
just takes more time because they're
doing more work that needs to be if it's
not about race if he's taking a snapshot
of the system as it was before and
working on that while the system is
being modified which means the person
you are making things that they were at
war and dog leash licking things as they
are now and if you do it on all relief
sympathy your multi-core systems then
you need synchronization you cannot go
out and fiddle with the heat one other
one other threads you definitely think
you need synchronization secret election
costs where the workout systems get
around the secret message so for example
the standard JVM it has a parallel
garnishment
that basically says you for running on
multiple threads you'll say one thread
will leave out the reflection the other
principle work which is nice we require
synchronization so very possible
deployments run you need to
synchronization plans so all threads is
based at the run super-nice and then
keep on going and synchronize again the
sickness synchronization Park picnic
quite Wow so yes you're running a
collective parallel which paying for I
have an uzi position
the carpet garbage later was copying
collected that's pretty standard is just
generally one copying instead of marks
and generally more efficient still marks
with if most you ladies love small
population Thank You mr. generational
collector which is very good for the
Silent Generation correctness based on
heuristics that most a great library so
if I just tried to build optimize
against the case of the new data most
that's generally true of languages type
valving we have immutable data and
always created breaking units so the
shoe space is a new area of a new data
eventually data will be copied over the
old streets with all nations and after a
number of collections in new data we say
ok now this takes me around so on
so we'll say to him last a long time
move across the old notices hopefully
eventually you'll fill up the old people
then you have to caption it then you
just have systems and company
generational seals generations get much
faster you have to do what's called a
full sweep in there this is this is just
standard so it's very nice being able to
do that and seeing we're doing it we're
stopping off the stopping and are
effective processes much easy
you can do some well it's all simple
tuning of processes so you can set a
minimum process be precise why default
the heap starts out very small now in
process everything's on both approaches
that can approach this tape review and
it's somewhere around two to three
hundred words I think that truly means
you have long process you can set the
minimum size I think that has some users
it means that if I know my process is
going broke be quite big I can start off
being big and will grow more efficiently
predictions all the way with your stuff
but never get smaller as far as I said
so I think this lucky kid yeah I know
I'm gonna put all of it yeah so you
never will never grow shrink from low
that size so though I might be tempted
to make every process be just got one
for my sister but you can selectively a
do if you know who think example this
process is going to grow I said the
process starts quite beautiful beginning
even more efficient another thing you
can do you know what's going on in your
system okay
this process is going to be short news
if I make the heat big enough so it
never has to go through fiction garbage
Clinton's time great this process of the
subject making it faster more efficient
so I can make the president be so young
anyone half make white stage of this
versus I know that it's all pregnant
beginning the process dies never has to
develop tradition of course if I'm wrong
I played with my school setting it being
ascetic globally and repressors another
thing you can do is just control the arm
lift the generational slightly up as
long as they have after how many
generation calls if that actually helps
your system not there's black
nationalists you said it tested to see
what happens if you get a rightful
system after the system of this one
sorry I cannot do there's no way desert
state the long legal system is therapies
because if you go change your system
along the way they're like Victor use it
now January right will system under your
happen then then if you need to be stuck
doing and like this same thing the
minimum but if you since we barbers it
account to a very small zero or one you
will force the past the garbage
collection you will force the garbage
collector to do more work so you will
generally use less than wheels so you
pay the price of the seduction do more
garbage quick cost you more CPU but we
can use this mirror and that if you do
this inaudible processor to reclaim the
large binary space quicker because
you're forcing agency to process to do
full garbage collection and it can
detect it
forget the balance mean something I just
want one more feature a secret riddle
and if you listen if you look in the
documentation it's it's very well how
you can set this there's a plus a option
when you start out it doesn't really say
what it is and what happens is that when
you do it file item file IO course next
time do everything else takes times
milliseconds to migrate into
microseconds and why are you doing
follow while I block that that
will go out to a file accesses it wait
that's all genuine this offering to you
that's not good if you're doing a lot of
flying notice that mr. so what you can
do is that you can use you can set pace
the three basic threads and say I want
the system you create this many threads
it's going to use the file item and then
the i/o operations will be sent out to
the asynchronous threats instead and
they won't block the schedule yes it'll
still block the process during i/o that
the shed you won't be blocked you can do
other things whilst waiting the eye
operation so I won't notice my process
is long enough of your other things in
the system offices my own system and
typically you just do not doing much
father I won't give you much if you do a
lot of
and if your this trip I have to do this
when I start the system if I do that the
father may he also anyone writing
LinkedIn or drivers some using Wi-Fi
only few drivers they are there to use
my own LinkedIn driver's my driver can
detect it there I can actually use those
as well through my work I can't create
them when the system is running
something have to do last time I just
quote use the ionic driver never used -
very nice bitch if you did modify though
I think someone told me that reaction he
starts 2024 these hasty threads because
it does a lot someone may be pressured
you to confirm or something yeah end up
two things how to practically there's
always my sister so yeah okay that's a
surefire fill the other paper assist
impressions about that I can overflow
the one whose face is like a process he
grows too fast the system will run a
November crashing a couple nice way to
do that simply recursion that that's a
good way of rational basis do very long
message case
so quite a flutter process with more
messages than you can handle
eventually the system will run out of
memory well typically lost process
well just have a lot of danger ahead
versus I think it just grows very big so
the next time you see to a garlic
there's just not enough memory for
together that's and this way actually is
if you're writing your own use or
lincoln drivers you can never get a
segment violations like this if that
code is not protected at all why the
alex's so you can there any only forces
and you know you come from a like
nothing happening divided by zero on
this crash my closest the other sister
plant audio / 0 and 1 if Paulo
incineration process just show you this
the problem of synchronization so this
is a simple little program called
parallel and livers this time taken to
run this run this and every process and
you see here more schedulers I had it's
taking longer time to run my application
it's using this power though it's a very
simple thing but it just taking all the
time until somewhere around 8 is a
little bit off wireless so if I look at
myself look at the table from the speed
up one of you he's getting sloppy air
travel I make like my assistant and the
slower my application is young and the
reason was a very simple application
system demo system this for the
processes and each process creating does
cause Alan Cobham now to create time
steps there just checked all these time
steps in order and just returns back to
its um
just respected master processing yet
so if you start a few thousand days
they'll have to spit out of course the
problem is the a line now that
synchronizes we can guarantee that isn't
all you make telling now it now will be
bigger than the last one
even at the time it's the same see a
complete market Campbell so call Salman
now synchronize and what's causing this
problem this is super relation so
synchronization is is a real proper so
being any of that you can make sure to
system you can come down synchronization
in the case that we need to come down
synchronization is a pigment that's why
they put a lot a lot of it into cutting
down Bacchus in synchronization it
really does possible this is not what
you'd expect on replication walk cause
it should go faster just Socratic it's
not a bad implementation now it's just
because the way now is defined you get
all the civilization back when we
defined it twenty years ago we didn't
have that problem because we did have
multi-core senescent these systems
anyways see what are you replacing this
one called OS called times down makes it
behaviors ensure you'll get to be done
right right right times when you get
more for schedulers because yeah
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>