<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Paul Wilson - How to Build a Slack-Controlled, Saxophone-Playing Robot (...)  (ElixirConfEU 2016) | Coder Coacher - Coaching Coders</title><meta content="Paul Wilson - How to Build a Slack-Controlled, Saxophone-Playing Robot (...)  (ElixirConfEU 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Paul Wilson - How to Build a Slack-Controlled, Saxophone-Playing Robot (...)  (ElixirConfEU 2016)</b></h2><h5 class="post__date">2016-05-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-MzJ-HxRcVI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I can try this
done
hi so back in the day well salaam the
fun of Kathy Sierra but I used to be a
fan of Kathy Sierra's head first blog
and it was a horrible moment when she
was harassed off the internet in 2007 a
lot of things I remember from Kathy the
head first blog is bits of advice about
doing conference talks and the first
thing is don't do all the self
depreciating stuff you should say oh I'm
rubbish at talking I don't know this
don't know that you pretty much telling
people you might as well walk out
there's no point in listening to you
talk anyway I I'm not really i'm not a
hard work person and a web developer
kind of rama manager let's face it well
i'm a web developer kind of and i don't
know i don't know all the stuff about
linux drivers and I uneven know if it's
called I to see or i squirted see that
that's that's how little I know about
things but I kind of the point is I
don't need to know and and I needed to
you to get involved in these kind of
things I who could from all the awesome
work that's been put in by Justin and
Frank and Garth and other people it's
come up like a hell of a long way since
i first got inspired with this stuff in
in Austin with Garth and Justins talks
that the documentation the tooling as
just spin it's actually been a challenge
to keep up with the with all the changes
but it just got so much easier and
easier and easier and thanks thanks to
the nose core team and other people for
so thank you Justine and also Frank
thanks Franklin thanks those girls like
to take a moment to thank them they
massive amount hard work they put into
making this stuff easy for people who
don't know what the hell they're doing
to do things so thank you
and another tip I remember about the
conference talking was like just
launched strange the subject don't like
ramble nobody wants to hear about
yourself your family nobody wants to
hear about who you work for anything
like that so I'm from cultivate we are
hiring we're based in Edinburgh you've
got mostly rails well shop at the moment
we're moving into Phoenix we've got a
bunch of people here down K Alan me and
that is literally the view from our
office window Alan took that photograph
but at edinburgh castle in case you're
interested but it's not really all
shortbread and scotch pancakes around
though there is a downside to working on
our office and the downside is as this
tunnel a bottom of the road and it's
just plagued with saxophonist seriously
in the summer okay sites office coming
in the tunnel and other goodness it
I said that's enough for that oh good
it's kind of cool if you want to pass as
a tourist but imagine that came with the
office window for for our four or five
hours on a during the summer especially
during the festival it's drives you to
do some crazy crazy crazy crazy things
and it's not just one sex offices those
like there's loads of them they just
turn up play the tunes keep going hey so
on to building the the robot so I guess
you will want to know where learn that
one to hear about the process of
building this thing well yeah why bother
really what's the point well is there's
some people points first of all it's
kind of fun to a lot of us a pixel
pushers we're moving bikes one place for
another maybe putting some pixels on the
screen somewhere and that's us that's
pretty cool but it's um actually making
things move do cool stuff actually in
the fuel real world it's makes a lovely
change and it sir and it is honestly
great fun a bit frustrating at times but
great firm the other thing is there is a
straight road from prototyping things
doing something like this doing
something differently to to production
as Justin was talking about earlier with
the with gothic chains and there's got
Marie navigation stuff there and that's
not trivial kind of oh stop working who
cares for a bit of the video shin
there's serious resilience stuff put on
there and obviously you were you want
your brewery to be running properly from
your Apple watch what straight process
so the nose project has been designed to
make it easy to go from prototyping on
board a cruise with pie beaglebone black
that kind of thing straight through the
production it's it's it's a way to get
into the whole Internet of Things
bandwagon and all that kind of
jazz the only reason is I'm finding it
really useful training for applying
understanding OTP and particularly
supervision trees so if you maybe get
started to get into Phoenix and you're
doing a few internal applications and
you're not you know merely got 10 users
you're not you're not really exercising
that it's a bit it's a it's a bit of a
week exercise it's like those treadmill
desks where you going not which point i
mean i do extract OTP things out in the
end on those but i'm not really i'm not
really pushing the boundaries but doing
things in hard work is such an excellent
fit for you have a process / output
device you've got a process for a sensor
and you want these things to stay obese
so you've got to really think about your
supervision trees I'm finding that a
nice stretchered heavier OTP GM take to
practicing this is the talking of which
is the rough supervision tree of the
other robot I'll go into this in some
detail later but we've got the stuff
about moving it around the top there or
living under the locomotion supervisor
you got processed further for the
stepper for each stepper and another
bottom we've got specific things like
process to control the guitar acoustic
process control the sack softness
there's an LED and they don't worry
about at least I didn't I didn't attach
it I will go into detail but let's get
started let's let's get started and
let's pretend or wiring get the sex all
finished and what we're doing is there's
a button in these things and it's been
soldered to to bypass the buttons so
these here or if you don't know these
are called the GPIO pins just in mention
them earlier on the on the Raspberry Pi
some of them similar gpio some of them
are provided voltage as someone provide
ground and to fire off the rise reply
it's the same as just lighting up an LED
for a second so we've got one we've got
something attached to one of the pins
and then something in touch the ground
and red that's that's all have to do is
put a pin high and then make it low so
they all saw the chip inside the sax
player will recognize you when it goes
high again so in order to do that we
want to include the libraries that that
Justin mentioned earlier we've got Lee
got knows obviously we've got a mix
branch because do we're doing things
Alex rail just remind you is the library
that Francona throat for dealing with
the GPIO pins for not just as you buy
other things as well i believe and also
some of the other interfaces the i2c
your ice squirt whatever it is all the
other stuff i don't know i'm doing and
and obviously we want to be able to talk
to it so the moment is are using those
networking which busy open Ethernet as
of this morning i could get it on Wi-Fi
but i didn't really have time the thing
I'd like to do because i'm a kind of a
long term extreme programmer person I've
been doing do what I like to do things
test-driven so we've got that plugged in
I won't show you the rest of the mix
file because just in Chile earlier we've
got the whole block plugged in with the
dependencies problems were remix test
and as just in did mention because al
has
compare as C libraries in though it
won't compile on this thing here and in
any case I want to I want to be running
these things low-key and I in in in my
local environment and I haven't really
seen what Justin's been doing with the
umbrella wraps and boot and pulling
things out so I need a strategy to be
able to compile a thing locally on here
why don't need one but I do need one
because I'm not going to do this not
just test drove in that money am I going
too fast i like this okay thanks good
cool i'm going to slow so the first
thing i did was to make the library's
only only included in production mode so
i can run tests and IX to try things out
without compiling the libraries in and i
pulled out some of the stuff that's in
the mix file that just in put together
modify that slightly so that in the
various places i'm passing in the mixed
environment so in order that because
it's matching on CSS system rpi too and
that gives you the the raspberry pi
system if it's not production it just
matches on it just matches and returns
nothing and the same thing with the
aliases own that we don't really at this
point we're not we're not we're not
compiling into the ross prior to
environment so we don't need the
specific most things and just for
completeness to mention that the there's
because we're not including libraries
but they're not going to be there in the
applications for our CEO he'll complain
but this code in though which is using
this stuff and i think it sounds similar
to what Justin was talking about with
stubbs so I've conditionally compiled in
things like the nose networking
and the gpio using this highly advanced
if Clause may not be the right way to do
it but it's a way I do it and hey I
don't know what I'm doing so the novena
is working pretty much just comes up
there's nothing like it says it actually
has not completed sure I can make it
crush all the time just two tests and
stuff had a panic crushing all the time
gpio same kind of thing just pretending
to be Frank's GPO library and firing
cope with Jen server to represent each
pin but I've added some extra things to
make it easier to test so i'm saving
state so if you're right to a pin say
the state if you read from a pin saves
the state and you'll keep your pin stay
app in a log of the pin the log of the
state changes ok so what that enables me
to do at this point is to write tests
like this where if we play the
saxophonist we want to check that the
pins gone high that little bit then ping
goes low so it will play again I've set
the total time there's a total time
configurable for how long it stays I've
set 40 so it happens pretty much
immediately so the test will always pass
so that's not funny that's kind of good
I'm not testing at all the time that's
just too much like hard work
for completeness this is the sites often
its implementation a billion mentation
code it's not particularly clever ixia
line 29 though we're making the pin high
in a voltage sense and then we're going
to turn it off after a particular a lot
of time we're sending a message over the
send after which is handled at 34 to
wealth 135 turns it off and that's the
that's a test passing rate so we gotta
test passing but just remember that
we're only doing the most of in
production now so I'm were passing in we
only to their sectors set the production
environments when we're doing any other
knows things some reason the phone word
isn't I should mention should I mention
this the phone word doesn't do the
compilation at this point I look like
she'll wire so I'm always doing the prod
compile all clear exciting stuff a code
saxophonist we've got the steps off and
it's working next let's let's take a
moment to consider look emotion moving
the movie the thing around because if
you've got a sec softness step to the
top of your lunch box you're going to
want to move the thing around are you
and i've been using i'm using these
stepper motors which are incredibly
cheap the light I don't know less than
two euros even less than that could buy
five of them at a time from China and
they're not very powerful they're not
very fast but they are incredibly cheap
I think some of us have made too many of
them at one point and they come with a
driver board which essentially you
attached for the pins to a driver board
and you pass these through in each order
so a stepper motor just says go to the
position go to this position go to this
position go to this position so if you
keep telling you to get go into these
positions in a particular order it'll
turn around and you can control the
speed by deciding how quickly you're
going to tell it to go into these
positions you don't really need to know
this but it's actually it's actually
geared so for one rotation just moves
the motor a little bit but that really
doesn't matter in the same way that the
saxophonist is written in a test driven
way there's a whole bunch of tests
around the ether stepper motor process
which gives some confidence that it's
going the right way one of the things
was to make sure that the modulus of
rhythm takes working right working right
when it's going round and round easy
mistake too easy thing to get wrong see
that yeah so I'm going to step you
through each position sending it the
command and checking the position
changes pretty boring and also preach
the pin so which have set up earlier if
you go back here you can see that if you
read down the way you can you can turn
you can see the order that you're
expecting the pins to go in although its
reverse is right you're reversing
responses of the wake boat emotional
during the lean on reverse for I don't
know I can't remember I have no idea one
doing
and the stepper motor is obviously under
a supervision tree because we're doing a
lecture stuff and we put everything on
the supervision trees because we want
things to be robust one of the things
what I think about here is what happens
for some reason some edge case and the
gen server crashes I can't see that
happening boat you know it's kind of
thing you want to think about what
happens if the if the right step of
crashes and we're going forward what do
we honor happen to the locomotion okay
audio what do we normally want to have
and when something goes wrong what's the
what's the thing we do ink appears when
it starts working but we don't want to
be doing that we don't want to be
turning the thing off and on again
because it's gotten us because it's
gotten a bad state what we want to be
doing is having the application
resilient enough to deal with errors so
the bit of the system which has gone
wrong knows to restore itself in a known
good state and in this case I think we
taught you're starting itself in a known
good state means as if it had just come
up so let's pretend this is something
less trivial than a sub mm stuff on a
lunch box and going along the right more
the right motor cuts out and no good
safety stop what will happen then the
left motul keep going and we were that
when a unknown bad state at that point
so we want to think of that about that
in the supervision tree
so amusing gay one for all strategy for
all the things all the things on the
stepper motors so if one thing go with
one thing goes wrong it always I know
this is all trivial stuff but it's kind
of it's stuff that I don't have to think
about quite often when they're messing
around with with Phoenix things and it's
just nice to have to think about these
things so it all starts again let's
let's try that out so if I I haven't
tried this from the from here so
Oh No or you can kind of see it going
forward now and I kill process kill
click photo booth because it stopped
damn it well it stopped anyway I never
really try this with two monitors before
didn't go round in circles is what I'm
saying now I need to recover my mouse
excellent
and there's just a there's just a web
interface here it's a i'm just using
plug not Phoenix because I I think the
next step might be to put a phenotype in
each server in there but I need to get
the umbrella wrap stuff working first
because I don't want I don't want the
whole directory to like a like a fetus
application I wanted to keep things
things separate but it's really really
trivial to put there to just get the
plug stuff in so it just takes much of
things and under stuff this is
yeah I'll see that's the interface jeez
I'm going through this first so we want
to take a break I'm pretty sure this
took about 40 minutes when I over then
threw it down last night who fancies an
early night I know it's who fancies
seeing the a coaster fairly next step is
watching over smartness that's actually
countdown time I'm seeing a caution go
through this slowly I did say that I
would it would be a slack controlled
robot so I can't demonstrate the slight
thing live because of the internet so
this is I have some videos of what
happened what happened earlier you don't
need to write much in slack because
there's a a slacker library which tells
us a lot about the nose needs sorry
about the elixir ecosystem maybe about
18 months ago it was all like people
saying oh I'd like to get into a lecture
for web things but it's not like rails I
can't there's not a gem for everything
well actually there's now a hex package
for for most things and it's like a
thing is really handy a trivial it so
you just just match regular expressions
and you can take action on those things
so incorporated that let's see what
happens when when let's just try it
let's remote shell in this running oh
damn it spoiler
why is my video not rank that that start
the video
right it's not working because the
certificate expired the slight
certificate expired hang on a second
what's the time the time is in 1970
excellent 1970s so the ra's requires
booting up at the beginning of the UNIX
epoch so on the first of January 1970 I
was about six months old yeah I'm the
old and the slack I API certificate was
minus 45 years old it was issued in 2015
I checked and that's causing some
confusion in the in the ssl libraries
what can we do let's see if we've got
ntpd available spoiler it is so just
check the time
type type type type let's see what the
ntb ed is available because this is a
bit of the busy box in TBD is probably
different 2 in CBD you've got on your
your system so any just let's just check
the all you have ok let's try this out
nice mod might as well make it for both
don't need to demonize it obviously quit
up the clock is set and let's give you a
server to do to check with and yep
that's that's all worked and it's now no
longer 1970 it's in fact last week
because that's when I took the video
ntpd ntp demon but as just imagined
earlier with the system d all that stuff
is included we're using along
supervisors for supervision of things so
we'll create our own gents over-pouring
TPD and we'll put it under a supervision
tree okay we're ready to go now with the
slight bot well not quite because we're
being stalked by a trifid no that's the
this is about the network coming up and
down so i can't remote remote in to take
the video so I improvised it's like ugh
to be a poison if it if you try using HP
poison on this it does actually happen
on my machine before you bring the
network up for some reason I should
really look into it it never actually no
domains ever resolve again so want to
sure that we don't start trying to
connect to slack before or any external
thing before the network's come up
I'm gonna skip this actually does it
your way around and it does work so
let's just skin that other thing we need
to think about where slack is a you know
connect connectivity goes down what we
want to do what we want to happen when
connectivity goes down well let's take
you back to french guiana in 1996 to
have a think about what happens when
things go wrong in a software a final
decision the girl was talkn the final
decision to go was taken no wheat set
cease son pata flat the Giudice
howdy Masha Allah Masha
piccollage
looking good
Matt seven seconds and orange what the
hell after that well a funny story we
used to go from airing for 16-bit and
there's a area 5 64 bit buffalo burger
Boober flow overflow occurred but the
funny part is that it was in the
calibration code for the inertial
reference system which is the navigation
system and the calibration code only
needs to is only running before takeoff
so once it taken off does it need to run
but if the take-off supported takes a
long time to reboot boot up again so
they ran it they run it for 40 seconds
after takeoff so about 20 seconds into
the flight this is prefer flow uncaught
8 section takes down the entire
navigation computer at this point we're
going at the speed of sound and then the
thing it shows oh we're going the wrong
way speed of sound doesn't doesn't work
out well and so well i think is what
happens when slight goes down weapons on
site goes down is the slack bot will
prob will crash supervisor will restart
it slatwall will crush again supervisor
we start it eventually unless you've got
some crazy supervision strategy in
though which is like maliah me starts in
ten seconds the supervisor will go well
enough of this and throw the problem of
the supervision tree government
supervision tree eventually your
application crashes because this non
important party assistant course as a
web interface can't get connectivity so
overall supervision supervision tree
considerations for the site bot and the
networking Ethernet similar have a thing
worthy when it was
using DHCP and it couldn't get a network
address it would just crash quick ago
just either kousha forgot to plug even
it in or because it was on our office
network which takes 35 seconds to come
up for some reason slab what can't be
allowed to connect until the time has
been set by ntp though so we're coming
out to connect before the network
connection and there's no point in
connection until the NTP times has been
set and if slap what keeps failing we
don't want to be throwing things at
loose supervision tree this is what I've
come up with I came up with servants
tree so we're signing off from the
application level were being up this
thing called the network manager will go
well called the gents overly starter it
is possibly the wrong approach but he
which then sets up the networking
supervisor passing in a internet reach
right I'm sort of the ethernet can come
up how often should I what's a delay on
the retry other name so it'll look good
in the observer yeah and this is the
restore to its just a gin server which
is I kept on saying this and I kind of
feel like I'm doing the wrong thing but
it's behaving like a supervisor that
just continuously restorative series so
you can see at line 15 it's dropping
exits and a line 25 if well okay if the
one of the children when the child dies
it will send a restart after the retry
time
networking supervisor is Stanley
supervisor and brings up the ethernet
and they're really the supervisor for
the ntp and the sex they have to stop
saying sex pot I could just get that
wrong the the slight pot pasi right at
the bottom line 21 there's a start delay
I kept this not really any good ways of
knowing the network's up currently we
knows networking so and kind of just
waiting a bit and hoping it's come up
and if it's not come up the other things
will have crashed i'll stop it coming up
so that's why I've got a rest one
strategy at this point also the site
change the ADP so that previously on if
it fails to sync it'll go yeah whatever
i'll just try again in 10 seconds
otherwise we'll try again in 30 minutes
but on when it first loads that true
equals do sink or fail and are crashing
TP thing so so it will take down from
the ntb supervisor it to be supervisor
brings up ntp and slap bot and it will
take down the slack bot but not the knob
itself to its rest rest one strategy
kind of feel that have gone through that
quickly but we're running out of time so
just to prove the slight bot actually
works here's a video I prepared earlier
of the Select bot working
jever take a video to show in front of a
conference with 330 people and then
later on a real thing oh god I wish I'd
swept the floor finish your popcorn down
there
that were a little maybe time
all right I did promise that I'd
knowledge that most of the soldiering
done in this project was done by my
daughter who's much better at it than me
just Florence she's 10 here's the more
information the first place i go for for
information is just in Shh keynote which
he just gave hopefully you were here for
that nose project there's actually much
better information on the get up at the
moment those mice excellent project is
up on get up there when he smokes cut
feeder project which is just cool it's
like thing and if the cat gets closer
and it'll feed it if he hasn't been fed
but not like all the time it's just kind
of got now you've all been fed you wait
30 minutes and everybody's really
helpful just in and crank especially in
goth on the elixir channel on
nerves sorry the nose channel alexia
slack and i probably going to do some
blog posts i will do some blog posts for
this but there again and that's me
fine be like that you face</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>