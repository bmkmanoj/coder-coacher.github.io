<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MongooseIM - Messaging for Mobile by Ludwik Bukowski | Coder Coacher - Coaching Coders</title><meta content="MongooseIM - Messaging for Mobile by Ludwik Bukowski - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MongooseIM - Messaging for Mobile by Ludwik Bukowski</b></h2><h5 class="post__date">2016-10-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4fZ3iQ752Tk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Judy bukovski I'm junior long
developer at along solutions and I think
we'd spend next 20 minutes together that
topic of my speak is a magazine
messaging for mobile and I'd like to
speak about three things about the
magazine release and their features that
we have with this version about problems
that we face during our development and
the solutions and how we deal with it
and also I will speak about my our
workflow how we build things how we test
stuff so basically what this Mongoose I
am I'd like to explain also what is the
exam paper XMPP protocol it stands for
extensible message and presence protocol
early speaking it's the chat so it has
been designed in RFC 6120 it's a
synchronous and it's based on XML there
are few advantages that it's used
because yes we use it still it's proven
so it has been developed since than 98
and there are a lot of libraries a lot
of implementations and a lot of clients
that still use it as a protocol it is
secure comes with strong authentication
methods and built in TLS support it's
also decent realized that means anyone
can run his own xmpp server and you can
connect it to the Federation of the
servers and it works as a peer to peer
connection mongoose name is the
implementation is the server and it's
scalable its robust and it's written in
a long so as I said before it has a lot
of extensions but there is the one the
most popular and I think the oldest one
which is the group chat we ever burden
of the group chat we use it in work for
example in HipChat what's up or slack
application so I'd like to come with a
little bit of practice
how do we connect to the group chat in
the XMPP protocol so let's assume that
we have already connected to the server
we have talked for a while with our
friends and we joined rejoin their own
we need to send the element it's called
presence it's taken from the name
message and presence protocol and we
need to send it directly to the room we
inform the other members that we are
that we are in and back we will get the
result which is their presences from all
members of the room and it's done every
every every day every day we want to
join the room when we are in we can talk
back back back when we are logged off we
can't receive messages we have to join
room once again so it looks quite simple
but is it really good solution and not
exactly because it was designed to
replicate the old IRC multicharts so it
means that we have to enter the room and
we have to leave the room when we came
with our devices and the network that we
have in our phones we faced a bit of
problems sometimes you go to the
elevator go through the tunnel channel
and enable the flight mode for example
when going for a journey so you
constantly lose your connection and it
means from the XMPP point of view that
you are leaving the room and when you
leave the room don't receive the
notification etc so if you have to
rejoin the room once again I like
examples and this is one of this imagine
that we have room with 1000 people
inside I measured with wireshark that
the present size is about more than 300
bites and ever users because we have the
mobile app have been disconnecting every
10 minutes I did a quick math and looks
like we receive more than five and a
half mega
bytes per hour just to maintain our room
so it means that it's completely useless
because it's only presence we don't have
any messages and additional you
sometimes we need to fetch the history
when we come back so it's it's not good
yes that's true in our presentation
template I had the code slide so there
is it and it basically means that we
have to move on and we have to sometimes
get rid of the absolute protocols in our
 of office we designed the new
version of multi-user chat which is
called multi-user chat light and it was
designed by our colleague piatra nossek
and actually the idea wasn't the best
decision for one day it was evolving in
time and we just needed to feed the
customer needs and we came with this new
protocol what has been changed we
completely got rid of the presence so
you just can be invited to the room and
you are in the room every time ever so
you want if you want to leave the room
you just need to change the evolution
list additionally we change a bit a
message routing in our protocol in our
server so a little bit of a rank here in
mangoo same architecture we represent
every connection by a process and when
one producer talk to the another just
send the rank message in multiuser chat
implementation we had additional process
for a room and it was taking the
messages from every occupants and sent
to the other members and it was some
kind of bottleneck here so we just get
rid of this additional process here and
we send message in context of user it
gives us possibility to have a better
support for distribution in our magazine
cluster for example and finally we have
mmm
have better handling the big rooms
because in old implementations we have
spikes of latency and time months when
we try to measure the time to delivery
and I will show the graphs in a moment
and as I said before you case you have
to be invited to the room you can just
join it and and leave what it's because
we just don't have the presences anymore
so we did some of load tests this is the
new implementation so we can see that
it's about 50,000 users and the the
average latency in on this graph because
we just made a scenario when we have
about 50 rooms because yes it was 350
rooms every rooms have 1000 users and we
were measuring the time to deliver it
means that when users sent a message we
just added the timestamp to the message
and the receiver just compared those
values and we put it to the graphite and
visualized eyesight's it where the
luxury in Havana it looks nice because
when we compare it to the legacy
multi-user chat we have a much more
Latin sis here because it's about in
some point more than 70 seconds waiting
for a message and here we didn't we just
have about more than 300 milliseconds
the beginning is just only more than
three seconds because this test have to
be started so how have we tested it we
have our internal architecture I would
call it infrastructure better we run
mangoes am notes in dokur docker
containers and we have a separate note
that generates the client side we use
tool called a mock this is our internal
on our internal repository it's open
source also how does it work it
simulates the clients it's just
a simple I rank implementation you have
the module that kept call back which is
the start function and takes as an
argument the ID which is unique unity
integer and you can do anything with
this integer for example can the right
username like user 1 user 7 etcetera so
we spawn 50,000 processes and every
process implements the start function
and having this integer we can just do
some module module operations in order
to do some tricks like every 10 user
generates room and every 12 for example
write a message we have also black box
and white box tests white box are quite
boring but black we like very much it's
separate note when we generate the
client side and we don't have almost we
don't have any connection between the
XMPP server and the users we use our
internal library which is called
Aeschylus and XML to generate the tests
we paralyze them and it's super cool i
like it because you don't have to worry
about registering users or the stuff
like connection step you just have built
in compression TLS support but going
back to the mobiles so we have the our
implementation of the multi-user light
chat it's just simple because we are
subscribed to a room and we got
notifications every time the user and
user sends the message so it seems that
it's quite familiar to another pattern
if you could know I think you are
familiar with the splatter it's called
publish-subscribe and this it's
additional feature i would call feature
we've came with for our mongoose IM 200
release it's simple we have a quite of
bunch of publishers the topic channel
and the subscribers it's been a reported
in
except which is XMPP announcement
protocol is 60 publish-subscribe and we
came with some plugins and for example
you can have flat namespace of trees or
we have the whole hierarchy when you can
subscribe to the top root node and go to
notifications from every every child
child what's important about the pops up
there is no just mobile applications not
just their desk good clients but you can
also have your own web real-time
application based on the
publish-subscribe pattern for example
wordpress youtube they use this
mechanism so it's opens door to some
additional possibilities so why don't we
use pops up instead of group cut it's
quite important and it's always because
of the details basically the tree
structure we don't have in the group
chat implementation we have just flat
namespace pops off have support for
sachar making this tree we have also a
participant lists in our group chat we
don't have it into publish-subscribe it
means that we can't know another
subscribers and don't know how many
publishers they are administrations yes
we can kick ban users if you don't like
them we don't have it in pops up and we
can also switch to the mode in our I
don't want to say pops up once again but
I have to in our pops of implementation
that we don't receive whole payload
sometimes it's too big we can just not
have a notification that there is
something new and we can check it if you
sent additional requests and in case of
multi-user legacy only chat room you
don't have presence in presences in pops
up
looks like that's that's all if you have
any questions okay do we have any
questions to go time for Q Custance this
is still compatible with the normal XMPP
yes okay I mean you're changing how
things are being sent or the way things
are routed through things it's new
extension so you need to have the client
implementations and that's good
questions because we have we have the
contribution to the smart library for
Android and to the iOS framework so
actually right now we support both
server and client side
and in multi user conference you show
that each user sends messages to all
other user processes but how do they
know which users join in this conference
and which are not each user have full
list of participants oh yes there is
such a list you just have to request
list when you join the room but you do
you do it once actually you don't have
it every time you are logging in okay
excellent one else if not thank you very
much Hrithik thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>