<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Applied Rebar | Coder Coacher - Coaching Coders</title><meta content="Applied Rebar - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Applied Rebar</b></h2><h5 class="post__date">2013-03-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yiVMRcfSDOE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">um I just have a few slides that I can
talk about but I much prefer to have a
conversation in questions and answers so
if there are questions you have or
topics you'd like this more in depth
please feel free to interrupt me and
we'll dig into them because frankly you
probably don't want to just listen to
more slides you probably want to find
out stuff and I don't know that my
slides will necessarily talk about
anything you will find out so today
we're gonna talk about rebar the goals I
guess for this talk are to talk a little
bit about the common patterns for
organizing applications and releases
with rebar I talked a little bit about
the trade-offs so this is the as a topic
I mean I can show you how to use rebar
and rebar d-unit and compile and all
that stuff there's a tutorial on
Wednesday where I will do that but right
now what i wanted to talk about was just
how do we structure our sort of the
source code and the directory structure
in a way that works for the different
sort of types of projects that we have
would get some code i I don't know I saw
an aversion to saying to own your
PowerPoint so I try to get back to
terminal where I feel comfortable so
we'll talk about these different
structures and just sort of see what the
conversation takes us is that sound okay
interesting all right now I'm starting
tomater so we're in good shape so first
a little terminology and the funny thing
is is that this this is in the OTP
documentation but I don't know that
everybody knows these things certainly
it was I guess a full year or more
before I was working with OTP to the
point where I actually learned these
terms so I want to start with these
because they give us sort of a place to
start crying so first of all application
so that is one or many early modules and
in a resource file
at file typically that goes in the e bin
directory that describes stuff about
that application so that's most people
have worked with application that
somewhat everything a lot of the
functionality that comes with an early
release there's observer module there's
applications a lot of the applications
that come with a lot of the
functionality that comes with the
airline release is actually individual
applications they're just sort of
prepackaged so you write code typically
you construct an application where you
leave all of the modules go okay so
that's easy enough but then what's a
release in other sort of systems a
release would sort of encompass more
than than just working code also
typically an officer at one time that's
not the case with our life release is
actually a series of applications and
then a release file which describes how
to start those applications or during
environmental variables stuff like that
and this is actually the release is I
would guess one of the most powerful
concepts that come with our lane but
it's also one of the least understood
because it's still pretty hard to work
with now there's we've got a lot better
than you've got rel tool that makes
things a lot easier I know here has been
also working on some other ways to
generate police files as well but one of
the things that rebar does is it wraps
rl2 law makes it easier to generate
rivers and finally we have a system
which is in the documentation called a
target system but that's typically a
release plus your embedded Earth's
version now some people don't ship
Earth's as part of or the runtime system
as part of their as try the release it's
all very over living but most you can
build the product do because that
you have a self-contained director you
can just copy over to your target
machine and just you have Erlang ready
to go any questions so far this is sort
of just laying the foundation so a side
trip and there's about three red Falls
which means that about half my slides
are radicals but that's okay it's going
to be fun articles I think how Reimer
works you need to understand how all the
pieces fit together to to sort of come
along down the directory structure pole
or radical there are basically remark
has three when I call module change or
just lip chains list of modules that get
run so you say rebar compile rebar looks
at the current directory and sets an app
directory is this a release directory
for isn't just some other forever I
don't know about so to test for an app
directory all right taking the starting
area or something ah an address just
looks in even directory for anything
that ends of dot app which is a very
sort of the old school the traditional
way of defining an application or a sort
of more recent thing based off of user
feedback because it wasn't a rebar
Bridge links that's like yeah I'm a
bunny DS write an app file it's not that
hard and many people were like you know
actually it is that hard please don't
make us do that so I'm a recent
innovation thanks to rebar users is even
already defined a nap source file which
gets turned in at runtime or a
compilation time to app for you and that
basically just builds a list of all the
modules so they sit a little bit easier
so if you run rebar compile and it looks
at the current directory and it says oh
there's an app file and even or there's
a app source file and source then it
runs all of the modules associated with
the neck and so in the same way if it
looks in the grid directory it sees that
there's a file for el Toro config it
treats that directory as a brute beasts
and that means that
functionality actually the front so it
runs first the module square the current
directory type so app or Ralph and then
it goes on and runs the any module so
let's jump out to terminal wallpaper and
I can I for this bag so if you look at
rebar and look at rebars a file we can
see that for instance with apt earlier
we can see that when you type for
instance compile on your in application
directory it's going to run all of these
modules it's going to run the compile
function on all of these modules in a
row in that border and then it's going
to go to the any juror models and run
those it's really pretty simple and
actually quite stupid and I mean that
sort of that way it's a great for
writing a build tool but it's horrible
for sort of predictability and this is
one of the areas where are these good
luck any questions so far about what's
going on here all right either everybody
knows all of this stuff or I'm yeah all
right so that's how rebar works oh I'm
sorry I should show you the so I did the
router we can see that there's a couple
there's far fewer modules but one of it
is is up generating F F upgrades one
that invokes are all too old and one
that actually doesn't upgrades so any
moving on so now we know how we are
works is going to look at the sort of
context of the directory that you're in
and they comply or whatever's in there
accordingly it's one of those choices
where at the time seems like a great
idea and it still seems like a good idea
later but you sort of wonder what you
were thinking when you did it as well so
I don't know I have a lot of mixed
emotions about this design choice other
helper bits that rebar does for you and
this is all sort of going back to you
have to know what regard for do for you
and then we can talk about directory
structure and why that makes sense so
rebar has this idea
dependencies now let me say first off
dependencies and the rebar doesn't it is
a contentious subject and that's yes the
dependencies are just so contentious
some people would like precompile
dependencies other people want their
dependencies from source like rebar does
I delays good but rebar does it this way
because this is what we needed at the
time so I please don't misunderstand me
this is not a religious feeling for me
this is just sort of your way that it is
because this is what I needed but if you
have ideas about how you dependencies
better I would love to see some forward
press for that so I competing ideas are
not a bad day if I can make the product
much better so rebar can generating
super weird field here rebar can
actually download source a pilot for you
so you can declare so one application
can say in the rebar config I want to
depend on this other application and
rebar will go out and download that
application for you from a we give
people over material etc and compile
both of those so that you have a very
crude form of dependencies but it's a
it's done in a way that I wasn't have
isolation over your environment so an
example in the rebar config file
something is really wrong at this point
here in the rebar switching file you can
just prefer apps and in the app name
that you want or depths happening that
you want what type of dependency it is
so there's a get with begin URL is and
has had four to get dependency and you
can define a bunch of these look done oh
I should have just are going to know so
if we go to to react kb and look at its
config file you can actually see that
debs here it's got a hole in sm and
what's interesting about this is that
this is not the biz the top-level
dependencies those apps in turn can
and on another apps and it actually
pulls down all the other apps as well
which is great and awful at same time
hey I don't know if your opinion of the
theme here if there's a lot of things
about build tools that you will always
love and hate those tools are necessary
evil and but they are also wonderful
when they work well and and being the
author reveal tool those emotions are
even stronger because you love it than
you hit it at the same time so in this
case rebar will go out get react core it
says that I want any version of it so
it's a regex which is a simple way of
doing version tucking pull it from get
and pull it from master which is the bee
branch and get and then so what rebar
will lose that will go through all of
these get that repo and then the examine
its rebar config and resolve it
recursively it doesn't do a dag or
anything a directed graph or anything
like that like you probably ought to but
it's one of those things where the
simple approach worked for ninety
percent of the cases so we said good we
will keep it simple so that's
dependencies and that's rebar provides
that facility also rebar provides some
helper stuff to invoke rail too old for
you um real toll is a great tool um
either started running does that mean so
I started rewriting rebar about two or
three times now and every time I've been
in Tennessee slightly differently and
actually the version of rebar most
people use is burdened five that I
generated through I'm fart like starting
from scratch because it just didn't work
before um so long answer or short answer
is that for the time being found a
better way yet I'm open to other ideas
that I'm open to having other dependency
mechanisms but this is the one that
works reliably and was for most people
like I've seen a number of other people
be able to use it
the best answer I don't know but it's a
working the answer and that sort of the
important thing at this point does that
answer your question any other questions
yep you switched over to rebar main
application we have problems that we
have to order everything in a very
specific order otherwise we'll put one
dependency of whether she needed yes and
that was very complicated yes it is very
complicated huh and we need to do better
on that but yeah yeah I want to turn out
oh yes so one of the things that most
people sort of find out the hard way is
that reacts dependent or react it's only
five in the morning rebars rebars
dependency resolver basically just it
just recursively walks through all the
dependencies and twice it doesn't sort
of try and figure out whether not too
much to dependencies might get in on a
third dependency on a different version
doesn't allow you to do that it assumes
that if you are desiring dependency and
somebody else is declaring it that
you're both okay using that version now
you can control that we get really using
the reg exes but most people just use
star for right for for the version
checks so it doesn't really work as you
might expect it to yeah it is regex
because the versioning is sort of highly
variable in terms of third-party apps so
the Erlang apps are inconsistent
generally or the stuff that ships is
part of early but but everybody else is
asked right now aren't just very
variable like some people virgin if a or
whatever so you can't really write a
parser because you don't know if
everyone's going to follow the same
standard
because what does the mind Jake do today
so that controls how big the compilation
who is that just because it's still
sequential it well so so there's a poor
workers for compilation where it worlds
but but it's but it's not compiling apps
right it does one at a time so it will
speed up one app you have more
processors although three I've done some
testing and three seems to be the best
number for dis guy over all other stuff
balancing yeah okay any other questions
all right we'll keep moving ah so remark
also automatically generated release an
assistant for the pig pile and rebar
just ratchet all to land and provides a
convention for using it when Rose whole
first came out it was it still is pretty
opaque in terms of how to invoke it I
think it was really I don't know it's
the person who wrote girl tool in here
that I could maybe just ask this now
that really won't stand up yeah so one
of the things with girls who is that it
it used to be my first incarnation of
rebar which actually started as reading
scripts which is bad actually I did all
the stuff there girl told us and it's
it's a lot of stuff to package up the
app so generally through these file and
I'm target and retard and so forth so
relative was great but invoked I think
it was meant to be invoked from a
graphical interface so there are man my
stuff and functions you can go really
clear to people when real tools first
release and I don't think it still is
how we go about using it so rebar
provides around forward to make it a
little more
user friendly there this is still to be
honest Ross School is one of the areas
where I get the most questions still
today and that's like well you gotta go
talk to the relative people because I
don't really answer that one so anyway
rebar makes it easier so a bit of
philosophy about gaps is that apps
should be compiled from source so this
is my philosophy again this is not a
religious thing for me this is just sort
of my philosophy and and things i can
change but my philosophy effects regard
so this is sort of rye or the top
product so general we've got I work for
clinical basket when he made react which
is a which is in a database in early so
we ship that we ship binaries and the
source is loss open source but we want
to when you ship a product you want to
know exactly what versions of things are
are completed and all the way down the
Earth's the hem de and the release stuff
it early makes them very very feasible
but when you're compiling it you want
isolation of your currency so the stan
freberg to it was that we want to make
sure that everything is correct for a
given platform and hurts version in
other words if you don't want to see it
as someone else compile in a different
platform you don't know what compilation
flies they use etc and so that that
really requires you to download stuff
and compatible sources a little bit more
work but airline compiles really fast
start so it's a little more work done
and yet and then secondly part of the
philosophy of rebar in the defense and
stuff is that there should be no
Centauri programs now a lot of people to
play about this too they can't find apps
which is a good complaint so so that's
best sort of this sort of the downsides
a curation isn't polite but the upside
is that curation is not required nobody
has to do all I work the packaging stuff
everybody you get a much more sort of
decentralized development of a bunch of
libraries which is great and bad at the
same time there's just there is no
perfect build tool you know some people
still prefer make that's that's fine and
rebar has to make some trade-offs um so
these are the things that guided how
weber words so all of this is just
setting us up to talk about now a simple
app so generally as simple or lamp is
just one app and it has a directory
structure where the Erlang source is a
source the compile bean clouds going to
eat in if you have any public include
files eat going food other stuff goes in
prove and midi see stuff goes to see
source pretty straightforward it may
have defs the rebar config anderson
examples cowboy AG prog folsom so if you
go and look everyone so what I got in
here cowboy right we can see that cowboy
has a source Gregory it's got an
included directory and it's got you been
and I think it's using the app source so
normally an apt file rephrase you list
all the modules in your app because
they're using the app got source
extension rebar will automatically take
this file parsley insert all the modules
and compiles and put that out there down
out for 540 but it's pretty is pretty
straightforward this is become really
this is an app convention is what
everybody uses this is that who's not
familiar with sort of this convention
turning out I don't want to bring you
all the advantages all right so let's
move on this is how most things are
structured most libraries a universe
sort of form that's the verge and I'm
starting to see it more and more I think
I'd notice this rebar itself is this way
bachelor benches is ready and I from the
east crypt which unfortunately won't
work you have to have because of the way
dynamic linking works on most operating
systems you have to have an actual file
on the file system which sir typically
got SOS are in fridge but you can't just
load it from a zip archive so I've been
thinking about adding a way to
automatically copied on SEO files to a
temporary imploded that way to make it a
little bit easier but I'm not quite sure
how to automate that from a general case
so that that's the only game normally
goes improve now technically so it
doesn't work right now with we rebar
your script eyes and stuff but it's
possible in the East script and actually
rebar does this so we can look that will
break if you unzip rebar that's why is
doing yeah that's better so you can
actually see the rebar as packing stuff
does use approve so if you're careful
then then you can put stuff in fridge
and and you need it with the rebar
yes you know I kind of very helpful like
a rebar so sir so it's a double-edged
sword and this is where we sort of go
off into the dependency how to do your
tendencies me you can actually do that
right now with rebar there is unclean
okay so you use like a dobry Bardock
config file okay and then I look alike
yeah yeah that's one way of doing that I
for for our use case of a show that
wouldn't work but like I said
dependencies is one of those things
where you know different people are in
different ways and technically yes it is
easier the thing you lose isolation of
versions so that's yeah if we get it
right you're right if we if we did it
differently all right so I didn't have
anything yes yes yeah yeah the
abstraction all right so yeah I'm sorry
I don't need it sort of glossed over but
dependencies yeah anyway so this is an e
scripted out and it's a pretty useful
sort of way to go about structuring
things i everybody looking so far useful
topic good so hard drums between the
people asleep alright once you keep
going so composite out this is the one
that's rewind where so many people start
out this way and its really it can work
if you're really careful but it's sort
of like walking around with a gun
pointed at your toe and hoping you don't
accidentally poked through its you can
do it is just on a good idea so
typically a composite app your
have an app's directory with all of your
apps inside of it you may still have
dependencies and then you also have a
relative dating a subject so for 40 days
a demo I had confronted one of those I
can find it so test out if I just do
apply alright so I'm video fine on this
directory so you can see here I've got
an appt subdirectory with app one app to
this is my code and then I've got a
release subdirectory with the important
or being relegated all these openings
are template files this is actually way
that reactor structured for a while so
all of the reactor core react TV all of
those things were in as a subdirectory
and there is the release subdirectory
first the first mistake that a lot of
people make is take the relative and fig
at the top level don't do that do it
under a specific directory that the
Darrell and relative of fig file and if
you don't have that in its own directory
and you really want that hang separately
as well things get really hungry so you
can do this and if you're going to do
this composite app this is how
everything you do you don't have make
sure relatives a relative of phase in
his own subdirectory but you have to do
some your stop for instance look at your
l2 or prepaid we have to do this
literature stuff that right there
Linder's scary directive because it
includes what that is essentially saying
these for everything under the apps
directory find all of the early apps you
can possibly find and include them on
time which is finally use it right but
when you point it at a directory too
high up so for instance if I pointed
that at my source directory by
accidental words i miscounted references
that would say and all of these apps
right here on my hotel and those aren't
might not even you
versions that you want you have to be
really careful about sort of structure
things this way because you have to use
that lifters directive to move on is
that makes sense i know sorted with this
running 10 minutes already okay all
right we're commitment so composite apps
you can do it that way but i don't
really recommend you that it's pretty
simple I hi suckers and end the race but
order is important as always because
it's like this so don't put the release
first because it'll do all sorts of
weird it'll give you completely
unrelated errors because can't find out
all right so package system is sort of
my recommended way if you are
constructing a a full system the OTP
terminology in other words embedded
herbs and a series of applications that
are released this is really how you
might do it there's not actually meaning
abson repo all apps are just declared as
dependency so rebar will grab get those
apps compiled them all with the same
version of Arts and the version averts
you're going to package and ensure that
everything is consistent a relative
configure a subdirectory never ever
cared also conveyed not any sort of
dedicated subdirectory and four down one
example and so does he like no other app
people sort of using this style of
packaging beside ria or are we like the
events okay well i'm just starting to
know anyones I so so that's great so if
we look at a reactor pic we can see that
there he is just a def structure with
all the depths that we're going to need
there's a rail directory and then the
rebar config is a little bit scary
because only all the best stuff yours is
just about so anything you run
serve as defenses any questions on the
set up I know yeah I offensive if you
submit a PR for head of the merger but I
saw the pr i-- okay somebody I believe
someone well maybe he filed an issue I
think I get me too I know someone was
talking about that later ok moving on
the future hi yeah so the great thing
about great thing about me bar being
over this first project is that you've
actually got a lot of contributors I
think at the first Erlang factory then I
presented on rebar we had over 70
contributors after the first shape so 70
people took time to write code to go in
this build system I suspect that I
suspect that we will mind of rewriting
rebar some way to to sort of solve some
of these problems with dependencies to
support more exotic dependency setups
better than Z checking and that sort of
thing but I'm sort of pragmatic guy so
it's very hard to me to say yes let's
rewrite it and make it better I mean it
means that you know the stuff that's
already working like that stuff has to
keep working too so how do you sort of
satisfy both requirements so i don't
quite know only to beat your holes we're
going to continue accepting for
wordpress if we write a new version of
rebar you'll be back was compatible and
it will just be drop in but hopefully it
would just be more of a structural
overhaul to improve dependency
management in particular because that's
i get a lot of Fred well dependency
management and multiple those are sort
of the big things that I get a lot of
questions on any questions because
that's almost like I got sure
and then the manifest for subject so the
apt is basically doesn't that still you
might have to acknowledge it you have
signed me pushing yes and you got one we
got this sort of acceptance because we
had to package manager yeah so it's it's
quite what i would like rieber to could
you and I know you're going to be
yelling at me more than I right word
it's almost time right I'm sorry so it
from a vision perspective I prefer
almost not to make that choice what I
would rather do is use sort of the
adoption rebar I want to figure out a
better way to structure rebar as a
framework rebars always been afraid
Reimer is just a big list of modules
like I said the beginning they get
invoked in order I think with a slightly
better structure internal structure
rebar could provide tools where one of
the tools is compilation the other tool
is pensee management and and making me
out a couple of variations of the
Tennessee management
when you get unpacked they should you're
breaking attraction just leave it blows
its yeah I guess go to waffle okay I
just don't
let me think i'm not i could see regard
doing something like that but i don't
know at the end of the day I think the
first step towards doing that will be
improving the structure of rebar and
then from that we can sort of look at
these other sort of next steps so just
out of curiosity since I've got you here
and you can't really run out now it's
the end of the talk what how many people
in here are using gaps sort of as they
all just by a show of hands Wow okay so
a fair number thing is that something
that's generally caused pain is that is
that something I mean 3x all right so
it's it's worked for some people but not
at this others interesting problems
already had
you've got two sets of two's
okay so corner wearing is a similar
problem where we are protecting us for
applications and so there's this
question of want a flat dependency viral
or religious experience often thing when
you may contain dependency trees we're
thinking paddle paddle because
exclusively revelatory
there's a lot of certain
all right yeah so what's when you're
grabbing a bunch of separation grabbing
mostly center it's not so bad when I
said okay and the right people this last
long with that all right well I guess I
know where I need you smack but if you
have a poem for us you want to submit i
wavered all right so that's all I got
any other questions all right thank you
all for coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>