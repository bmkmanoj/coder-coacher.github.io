<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Erlang Factory SF 2015 - Thomas Arts - Testing for Concurrency Errors in Elixir Code with QuickCheck | Coder Coacher - Coaching Coders</title><meta content="Erlang Factory SF 2015 - Thomas Arts - Testing for Concurrency Errors in Elixir Code with QuickCheck - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Erlang Factory SF 2015 - Thomas Arts - Testing for Concurrency Errors in Elixir Code with QuickCheck</b></h2><h5 class="post__date">2015-03-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zkL9VGIN5HA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah so I would like to say a little bit
about how this came about so we have
quick check around for 10 years now at
least in in era and before that it was
already in Haskell and you see all kind
of spawn offs and people like to use it
so there's actually oh sorry
quite some first about it and then
gossip about it and people do use it and
things like that but then if you start
writing elixir code and you have this
this fantastic airline tool how do you
use it and of course you can just use it
by typing this semicolon and then the
module name and then add Orton and you
can use the functions like that but it
doesn't really look like elixir code it
looks slightly different so people asked
us can you not make a kind of elixir
version of it which is well not not the
one day job but of course we can make a
link to it where we because elixir such
a nice language for domain-specific for
writing your own languages so you could
make a like glue layer on top of it and
that's the glue layer I'm going to
present so it should look like a lick
sir but Illinois who made this we are
not elixir programmers why we picked
this up we looked at the documentation
on the web which is perfect but the only
spent little time learning elixir so if
you think this is not elixir this you
shouldn't do it like this in your
lecture then come to me at the end and
tell me how to do it in elixir I also
take the course on Saturday so that I
know a little bit of elixir afterwards
so that that's what will will work but
okay so these are some some quotes that
we had recently that that the OTP teams
using quick check for testing their
airline coat and and when a new release
comes out there's this program generator
which generates random airline programs
and you just run the compiled on it and
surprise surprise you normally find a
few books so there's always nice to do
they use it for some things as well so I
thought let's give you some some links
there so because what's the problem as
John serotinous talks it this morning
some of you probably were there that you
all agree that testing is a good thing
you should test but it's so boring right
so
we'll do right tests but they also very
quickly gettin off of it and that's in
itself quite understandable in
particular in the airline community and
in the liquor I guess it's the same
people are really kind of ambitious and
they like abstractions and programming
and then you have to do something like
writing a test case right I mean isn't
it much nicer to do a few fulfills and
mops and things like that then writing a
test case so that's not really happening
so and I show you a little example here
I want to do this half demo style so
it's like you see how it works it's much
nicer to see how it works then to
actually see slides that presents
something so first example is we're
going to test the lists sequence
function in Ellen that that does the
same as the enum to list and dope em so
wolf you has never seen airline before
okay that's good
who of you has never seen elixir before
okay guys this is how you write in
elixir this end dope of M is a list from
n to M and then there's actually a
collection so you do it to list so you
get a list out of that and then enum to
list its the module anymore for Ellen
notions the module making a list out of
that so you get the list from M - and
that's the whole ID and the whole thing
is you want now to test that this is the
same behavior so what do you do well
this is fantastic mix framework which is
really really nice so you type mix test
and then you have to test something sure
you write your test case this is how you
write your test case you define a module
in elixir in this way and you run your
unit tests and this is a test says that
this is a test this is countless
domain-specific language this is the
name of the test and then you in this
case have three things that you that you
check you check that if you do the
airline list sequence this is how you
write list sequencing the airline list
occurs in elixir then that's the same as
doing the enum to list 1.5 in elixir and
the same 4 - 10 - 10 and let's take a
big number as well because you never
know and let's do another border case
where the number is actually the same
number okay so I I come up
three examples and if I give a course I
always ask people come up with another
example and since you're about 50 people
here I would get 50 more examples and
some of them would be almost the same as
some of them would be slightly different
right because what is actually so
special about those values 1 and 5 I
just did like that it's ok values but
it's not 1 5 that that is important is
that 105 are the same on that side of
course a death test upon so any unit
test suite has a bit of randomization in
it where you randomly choose a few
numbers okay and then there's always the
question do I have enough cases here how
many test cases do I have to write if I
want to to run this and that's not so
clear either because many of you will
now raise the hand to say all Thomas you
forgot this one right and probably
that's true that I forgot one so it is
always the case that you might forget a
certain test case okay so now I want to
write a property instead instead of
writing all those test cases I want to
run a property that says well take away
this randomization in the actual test
case but do it for all the possible
numbers that you can think of so in
order to make that noise of course you
use mix right because mix it's already
there so I embedded the whole thing in
mix we have this module simple where I
indeed use the action of case but also
this EQC standing for elixir quick check
X unit alright that's what you need to
connect the two unit tests and
properties instead of test to write
property you give it the name and you
say do and this is this is logic right
so second high school logic for all M&amp;amp;N
which are from the domain integer comma
integer so you take tuples of integers
to arbitrary two numbers and you say it
should better be the case that list
sequence is the same as enum to list and
double end for the values mmm that's how
you write elixir properties so looks
looks pretty simple
looks probably not very a licorice but
we tried our best to make it elixir
apart from this part because that's the
airline one we compare it against so I
can hopefully push now this this live
demo button and we jump to the live demo
yeah we oh that worked so you never
really know okay so probably if I tell
to quit PowerPoint it would work that
was bit hope that there yeah
lesson learned don't use PowerPoint okay
there we good
so we have a test case somewhere here
simple this was a simple test right that
I showed you so we can do mix test and
then this is called simple underscore
test dot X s and then it will only run
the test in that one and says what
there's one test and I had several
failures and this one test was was this
test case here now we jump to this one
instead where I say okay let's make a
property instead of three tests three
separate lines of test cases and those
should be equal all the way down the
reason why I write equals here instead
of equals equals is that I if it fails I
want to get some nice output that's all
it is just simply conceptually equals
equals okay let's run that one so now
we've got a lot of things on the screen
it was of course compiling it again
that's the normal mix thing then it
starts quick check and then it says exit
function clause so something went wrong
after four tests we got an error and the
error actually then was that we choose
two values one and minus one and after
some shrinking in other words trying for
smaller values it said well the smallest
value I can find for which this goes
wrong is 0 comma minus 1 and if I do 0
comma minus 1 then the left hand side is
actually undefined because it did crash
and the right hand side or sorry it
didn't question it gives the empty list
where the right hand side of the
equation gives 0 comma minus 1 and then
it prints like an in testing it prints
the counter example it actually shows
you the property and it says oh we found
a counter example and this is the
counter example but the actual
difference is here so what happens here
is that if you do m double n in the
lecture you will get 0 gamma minus 1 in
a list whereas if you do
0-1 in airline you will get the empty
list yeah so they are not the same and
this property shows it and you would
have all of you would have written this
particular test case of course as well
but there might be people that forget
certain test cases so this is how how
that works but but it's compatible in
the sense that this is what you would
normally get out of a mix test case and
a failing test case and you also see
here I haven't fixed everything so it
says there's one property that's failed
instead of one test but that's it okay
so that was nice and I'm a bit hesitant
to jump back to my slide but I will try
anyway or probably now let's do that
let's be brave
so they're male so this this was the
property for comparing things so the
these things that you have here on the
right and inside the for all you say for
all and then you give some variables
which you bind with some domains so the
domain of which you pick those variables
those things are called generators in
quick check language so they generate an
arbitrary integer value and that's what
I used and then we saw that the thing
was actually crashing and had the
counter example so there was one example
of how quick check can be used a second
example would be the newly added
function enum you sort who has seen it
already
ah no only one
when did you add it there you go okay
so I picked this just to have a nice
Excel because everyone probably has a
feeling of what you sort would do you
sort takes a list of values or
collection right and it will of course
sort that but if there's duplicates you
have to throw a way to duplicate yeah so
it's a sorting function but there should
not be any duplicates after sorting so
handy handy utility function to have so
now the question is okay what kind of
property would you come up with and
there's a scholar of properties that you
can think of the list should be sorted
after this it's a good property all
right their numbers or the things in
there should only occur there once
there's also property so you can you can
think of all these kind of properties
and there's always a bit tricky what
property should we actually take because
there's so many that you can take and
there are some guidance and you can do
some thirds and things but you want to
pick a certain property and say okay
let's test this and normally that's the
intellectual kind of difficulty to come
up with those properties that's that's
really hard you sort of lis simple to
come up with properties but what should
my database do here that that's hard to
vary properties so I advise always take
something extremely simple of which you
are absolutely sure that it holds and
use that as a starting point so what
would absolutely certainly hoped if I
use new sort
but I think that if you have a list and
you sort it even if you do you sort the
elements that you have an original list
should also be in the sorted list it
would be strange if you throw away
elements right okay duplicate you to a
way but each element should more or less
be in that function so I make my own
generator in quickly can make your own
generator very easily you do that with a
private definition of the numbers and a
number is either an integer or real
that's what we do see they are an
integer or real and real is
floating-point numbers for historical
reasons we call that real and then we
have this property here and it says you
sort does not remove elements in the
sense that gallons have completely gone
so we take an L which is a list of
numbers which is no manty because it
will go to sort the empty list is
certainly possible but then we can't say
and now take an element and make sure
that it's it's really in there so we
take a non-empty list of numbers and
these are all standard quick check
generator so you don't have to write any
code for that and then you say for all
the X in this list that you generate it
should better be the case that oh sorry
I have to use what is of course that if
I use sort a list then this X should
still be in the list so I don't know
where list comes from I will show you
the real code later on but I use the
enum member function to test that it's
actually there so this should better be
true so we switch back slide so if our
questions while the screen is black you
can always interrupt and ask those
questions so let's look at the real code
because there was a clearly something
had gone wrong there but this is the
real code and oh this is not this is the
real code so
i define my number generator and then I
say for all long empty list of numbers
are you sort the list with the enum
library and then I do remember X and
this member function is defined down
here it is really member question mark
from enum less than X but if in a very
unlikely case that this is not true then
you want to print the list that is not
kind of the element you you lose from
the list right so that's why I have this
one fail here that's also a pretty
primitive saying okay if things go wrong
please do this and this that is printing
some stuff and I really learned my some
elixir here right I can actually do this
without till the P and slash and things
like that so this that's elixir code for
printing things are you format okay so
this should better be true let's run the
test and you will see it is at least
feel lucky so we run a hundred tests and
we get zero failures that's good let's
do that once more and a few more times
oh so after 70 tests here after 70 tests
have failed and I did a hundred before
so it actually needed 170 tests and
didn't take much time though right two
times returned but then it found
something which says this is not good
what happened
you took this list - 1.8 - 17 - 17 4.0
and then the number - 17 and that is
some new sorting and such it didn't
appear then you see some shrinking and
says well even if I start with it - 17 -
17 point zero if I pick the minus 70
points
and look is that still in the list it's
not in the list anymore because you
drove it away when you were used to
watching okay so even simple properties
can reveal errors or strange things in
your API and what I would say here what
is what what's actually wrong here your
Jose what's wrong my property right yes
in your API you would probably like to
say which operator you use because then
you can compare with the same operator
as where you where you do you use
sorting and then the thing should should
actually go through but here you you do
not have a choice you fixed in the
member function you actually fixed it to
be one of the cont two operators rest in
the you search function which you didn't
find because that's a list you so you've
choose the other one yeah so and that's
where things mixed up and in this this
example so a simple property and not
very efficient property because we use
it hundred and seventy tests to find it
but it shows you that something is
slightly wrong in your design of your
API and that's the message that I want
to give you that things can actually go
wrong slightly irritating but then we
did now and then run her node tests and
then actually you get okay it's
successful and we did have a hundred
dots here but anyone okay what did I
actually test you right I run a hundred
tests but what did I test and in
particular I mean not the developer so
much but managers can get a bit upset if
they only see dots instead of test cases
what they want to have reports and
things like that so you probably want to
spit out something like that as well so
that's what we did
cater for as well so you can collect
your test cases so you can write
something like collect and then you can
give it a name like the lists or
something like that the lists that I use
and then you can give it out this
disorder sorted list and you want to do
that
in the following member function so I
thought this this is relatively a
licorice goat it looks licorice to me as
they sell probably too many columns but
works so let's run that and then you see
the actually the result of all the lists
that you are testing so that that's nice
that gives you some confidence that you
actually tested something more than just
the list of one element so you can do
that kind of tricks you can also if you
want to collect a little bit more now I
only collected the owl but they can also
say well what X did you actually look
for right and then you could write it
like that and again that would then oh
yes and of course you could still have
the failing case in this case the
failing case is minus two point zero
minus two or nine you get that a bit
sometimes it just works out sometimes it
really works and you get your output
yeah and these are the XS right here
that I choose and these are the lists
that I I generate so I get both a
statistical output for my test cases and
if you want them combined you just put
them in a tuple and you you see them
come and so that's quick check in a
nutshell that's properties and generator
for the data but this is nice what you
sort function so we can test you sort
function we will ever make a mistake in
the you sort function so that's
relatively useless but real software has
state and as John already told us this
morning then you do have to test
stateful systems how does that work now
let's have a look at that done I have to
jump back to my slides
and show you a little example of how we
test stateful systems with elixir and
then how you find concurrency books and
O's so so far has certain properties
that's what we now say right and that
there are things that should always hold
a little bit likely requirements
you could say and a test case is one
verification that the certain property
holds so you get only one proof if you
write a complete requirement you get it
for all possible input data but the real
software properties are more complex
than just saying well the elements
should be in the list real software
state and therefore properties have to
be stateful and instead of writing just
generating data you now have to generate
a sequence of course she basically have
to generate your whole test case that's
what you're going to do and then you
have to shrink to the minimum failing
test case because otherwise you get too
much rubbish and it takes you time to
analyze your your test case and you
really want to see the minimum test case
that where something goes wrong it's a
that's if you work for yourself if you
work for a company and you test for them
you give them this really big test case
and you say this is going to take me a
week before I find out what and then you
go to the beach and then you come back
and so this is the actual minimum test
case right so that's in perspective do
you know what this is
swing is full of it every shop has one
so you take a ticket and you star in
line but you don't have to read a queue
you can just be in the shop and do is if
you're not there but you have your
ticket as soon as to this place it's
your turn you you run forward you put
your ticket there and your help fund so
it's called a ticket dispenser so
tickler Spencer has two operations take
you take a ticket and oh this was nice
and reset reset means you put in a new
roll of those tickets so assume you do a
fancy electronic version of this ticket
dispenser there will be nice a fancy
electronic version where people can
actually push a button and then they get
this number
back so then you have to run some
software and you have this API where you
can take and do a reset so how would the
test case look like an elixir well the
test case in elixir would look like
something like this right you you start
your ticket this you have to do test
stick a dispenser you start you stick a
dispenser and I hit right suit here
because and this is nice in elixir of
aliasing so you could say well I have
this old airline version which is called
the ticket dispenser and that's my shirt
oh is it no no let's do my new take a
dispenser which is the super good elixir
one and right so there so you can test
both and you can see that both are
actually doing the right thing for this
test case so when you do start you
should get back okay come on this that's
the dispenser you take a ticket and it
should return the one you take another
one it should return it to you take
another one it should return a tree you
haven't tested reset yet this this works
fine let's test the reset you reset it
and you take another ticket you get the
one perfect it works
stop don't test case ready I tested this
and actually it just went through with
that one but let's let's do that here
for real now it's always not as if you
can run tests in a live session so we go
to the dispenser test here oh now I have
airline as the first one here so we test
airline first
dispenser test it was cold so the
airline version works super so let's
make test the elixir version and even
the electric version work so they are
perfectly okay software codes we can
ship it but well then use myself how
would the property looks like all right
how would the property for such a system
look like well you have to generate
basically this test case but not only
won't take but probably ten takes and
probably take a--take and two resets
after each other or three resets and
then see that still works that you
didn't leak memory or something like
that
so even if it is very simple software
and only a few lines of code you might
want to have a few more tests and then
just this but you don't you really don't
want to write more tests all right
because you will always get the question
why did you write this test and not
something else and and did you have
enough tests and all that stuff do you
route rather specify what the ticket
dispenser should do so that's what we do
we specify that and we make a state
machine model that says this is what
your ticket dispenser does and your
property will be a generator for
commands like take and reset so let's
have a look at that code and jump to the
property straightaway so the property
would say I generate commands which are
defined by the behavior in this module I
start my subject on the test
I run the reason so I run my command
sequence because I am made the command
see because I run the command sequence
technicality you get a bit here your
sequence doesn't have doesn't know what
process you're actually running so you
provide that to this test sequence by
substitution basically they substitute
the pit I got from my start into the
sequence may you stop it
and then this practicum ants gifts again
is nice printing for for the whole
system so this is this is how that works
and again it starts looking more air
longish but it's still electrical try
so what we do then is we have for each
argument each command in my API I define
a number of callback functions that tell
me what is the logic of the system one
of the things I need to have is an
initial state and my initial state here
is 0 because I think that that's a good
initial state to have I'm gonna take my
first ticket I increase that and I give
myself of one so in in the take function
I have randomly generated arguments but
I actually substitute just a bit that I
get I take it by calling the should take
my next state function increases the
state by one and my post condition says
well if I start in this state and I
don't do it take then the result that I
get from the system should be state plus
one so if I do it take I get plus one
back this is the logic for take this is
pretty simple the logic for reset is
well similar you get your command
generator which is random random
arguments for your command but it's not
you have to give two-bit you reset the
system you can whenever you do next
state function you're back at zero again
right that's the zero over there it's a
zero saying well if you reset you're at
zero again and then you have this post
condition say well if you do reset the
result should better be zero and then we
have seen all the code apart from the
weights and the weights can give you
kind of balancing I want to do more
takes than reset but I commented out
that at the moment this is also
interesting this morning I had this
fantastic talk from Jose telling me that
I should have used agents so I did write
an agent version while he was talking
but let's test the airline version first
right so there we go
dispensary cracy ok the airline version
actually is it's fine
so that that's my model that's my legacy
software I want to make something which
does the same thing as my airline
function okay so I start hacking and I'm
not a really good program in elixir but
I made an Jen server solution here a bit
tricky probably but let's run that so
now I'm running the elixir code my
elixir genic generic server and kaboom
things go wrong not completely
surprising so I get a long sequence and
then I get ok if I do with take yes I
should stay here if I do it take I get a
1 that's good if I then do a reset I get
a - that's not good I expect it to zero
ok so I made a mistake somewhere why did
we not find this mistake in our unit
test do you remember the unit test so
let's show you the unit test no no it's
much it's more simple than that actually
I never ever check the result and that
is not only me that does that kind of
things ok
okay so okay fine that that didn't
really work you've got a two back but if
you don't shrink you actually say well
no no if you do reset you get the one
back but they expect the zero right and
one is not zero really it's not so
something went wrong here but the nice
thing is because of the shrinking we
have two examples where it goes wrong
this one and that one so at this very
little sense to say Oh reset in my
implementation always returns - no no it
can also return one yeah so we have to
go into your code and see what you
actually did wrong or and this is a very
good trick that they do that many times
you just remove the post condition of
this command right and then you don't
test it an email and therefore it is
correct so you just do it like this this
is excellent trick who cares what
receptors returning no one cares what
receptors returning okay so we test this
and no wonder
it works okay so now we know actually
how to test this and that it actually
works and now the agent implementation
so if you look at the code for this
dispenser I will show you my elixir code
don't tell anyone how I want elixir but
this is my gen sir for implementation I
will make it slightly larger so in the
gender for implementation it's really
like okay you start
you dude answer of a call and then you
do a stop a take and then you do reset
and then in the end you have all those
and handle calls and handle things
that's that's not really nice
instead you should have done it like
this the agent this is all the code
there is right beautiful so the only
thing I don't really like and that's why
I introduced an error here is in the
take but look at this I returned a zero
here just to be sure that reset well
well
return zero it's probably not the most
beautiful code but okay this is this
actually is compatible with the LM
version so let's just test that one as
well so we go here and then we just
comment out this one and there must be a
better way of doing this but fine so we
test this one okay fine so all the tree
implementation is now pause right we
have three nice implementations the old
boss but you know and now I have to jump
back to my slides we didn't really test
our implementation that we we just get
some unit testing and we never ever
tested this for concurrency errors and
if you read a book about software
engineering from soma field or whatever
then they say learner but compared to
ours you do not test concurrency as a
unit testing no no you do that in a
different phase and testing what unit
testing is for something else so let's
jump through this rather quickly so what
if there are two customers and your
system is not as robust as this paper
roll so two customers coming
you have just reset your system it's a
blank tape in there two customers coming
one takes two tickets and your one takes
one ticket some people take two tickets
it's a bit stupid to do it directly
after total but if you want to go
shopping in between you you might come
back and take another ticket but anyway
you take two tickets and the other one
is taking one ticket in between how do
you run to unit test for this we're
talking a simple program right it's the
only three lines of code basically and
then some deaths around it so it's a
really simple program its concurrent
because different people can tell you
take your ticket at the same time how do
you run to unit test for this it is
slightly difficult right it's because
you have this concurrency you can have
different options you can have one
taking two tickets and then the other
one coming afterwards or they merge
nicely or one is going here in front of
the other and takes to take it and then
the other one
- so there are several possibilities
like this one this the first one takes
two tickets the last one takes the other
one or this one one three - that's a
possibility it might be that you indeed
get this outcome from running this
software it might even be that that one
is really fast and takes the first one
and then you have two three there so you
have a number of possible correct
outcomes all right how do you write your
unit tests well there's one thing you
can say you can say well if I see that
one one one two then something is really
fishy isn't it - people have number one
it's enough for fight so that's really
really bad so this is wrong the red one
is wrong but all the old ones are good
examples so you could actually start
this is fantastic if airlin you spawn
two processes you let one process do the
things you let the other process do the
things you collect all the results you
start computing is this actually
possible yeah that might be possible you
just list all the possibilities and then
you compare so that would work for that
example but if it is slightly larger it
doesn't work anymore because it's too
much the number of possibilities you
have here of what is good behavior and
what's bad behavior is too much to
actually just list and not make a
mistake in that listing right so you
have a problem the problem is that there
are 30 possibilities of correct outcomes
you might be able to list them and then
your balance you come yeah yeah but
what if you do the reset here and take
there and you can start all over again
right and that's not very nice so
writing unit tests for concurrency
events
that's just headache right it's not
possible just but people don't do that
because people are kind of naturally a
versed against headaches so you don't
want to do this you want software to do
it for you because the computer can
count and computers don't get headaches
so let them do the work okay there we go
this might be very complex right now I
have to write a model
that actually gave us for this
parallelism how much work would that be
well this was my dispenser which one do
we want to test first probably this
ticket agent here because that's how you
really should write your software so
what do I have to do to make this a
parallel model well I have to say
instead of generating commands I have to
generate parallel commands right because
you want to do things in parallel and if
I do that I better run them in parallel
as well I add the word parallel there I
safe it and I run my tests and now I
have my parallel testing and it actually
finds an error in software which we have
tested before and what error free right
so what it says here after some
shrinking forget about the long thing
above it says look if I take if I do
nothing in my sequential part because
the test of sequential secrets to come
to a kind of interesting state and then
there's the parallelization if I come to
my parallelization and I do two takes at
the same time there is a possibility
that they get a one back from both of
them and that is not good and by the way
this is a minimum test case you can
actually understand that this is not
good you don't have to do lots of
debugging here and this is all
completely automatic and it says no
possible interleaving why does it know
that well it knows what the model should
be the model should be did you get 1 2 3
4 etcetera it cannot in any way relate
those events to what should happen in
the model so can you say well this is
not possible you you did something very
weird in your implementation ok so
that's what it does so you find your
concurrency hours very cheaply we didn't
have to do much but now we have to fix
it because I only have 10 minutes left
and you have to have questions so let's
look at the dispenser agent Davis Dakota
actually was running and you you see on
this this is this back to university
people should not write code like this
right
hey that's no no there must be a
function get and update at the same time
it must be atomic right and of course
there is
Oh Sees you just make those things out
of things right so you do get an update
here all right and then you have to
slightly change your type because now it
has to return two things right the thing
you returned and now your updated state
you can just throw away this ugly code
here it's even shorter it's beautiful so
tada hundred tests and and I got rid of
my concurrency error that's it
I left some time for questions yeah yeah
yeah I should have switched that off but
then that's relatively easy to switch
that off it's completely uninteresting
output you are referring to this kind of
output you don't want to see this right
that's the thing yeah you can switch
that off that you don't see that but I I
was lazy and then do that but in the end
you what you really want to see is this
pretty printed output where you see what
you're actually doing in your test case
what and that's yeah
ah right okay so I have to thank you I
have to change my pretty printer to
actually print a dot and is that
probably yes probably would work yeah
thank you for the four tips that would
in the output make it make a difference
yes if you want to check so the question
is how much more complicated would it be
to check two implementations running
against each other in inviting code so
what we do now is we make a model of the
system compared to one and then use the
same model to compare it to the other
you could try to run the code on this
one and then run the code on that one
now if the code doesn't interfere it
might be relatively easy if it interface
you have to still generate your test
case you have to do with take take reset
take you run it there you look what
answers you get and then you run it in
the other one now the tricky is that
that works nice for this example with in
real code it doesn't sometimes make
sense to call a certain API fraction in
a certain state you say well for example
if the role is not longer than 24
tickets it doesn't make sense to take a
25th to get so you have to put that in
your test case generator that it doesn't
make sense to take 25 tickets so you're
going to write those lines of code so
you're building your model in order to
steer your test case generation the only
thing you take away is the post
condition and I already took away the
post condition for reset if you also
take away the post condition for take
then and of course you you would have
did the test motor that would steal the
two and then you could compare but then
I think it's equal easy to just add the
post condition and you're done so it's
not not most more easy to do that
although you would intuitively say oh
but I have my model already so why not
use that
you still would have all the code in
there apart from the postal missions in
order to hit the stage you really want
to hit this project is not open source
this is a commercial tool there is a
license for open source projects so if
everyone can go to quick check CI and at
the moment we have not election
installed so you have to install a lexer
as part of your test but we will put a
lecture or not of course and then and
then you will be able to run your next
test damn yes but that's only for open
source projects on github
right I have no time but the question is
does anyone do sensible stuff like talk
to Jaffa I have a Java implementation of
this ticker dispenser and I can equally
well test it so there and that's that's
very little work I use the same model
and and the same things only have this
connector to make it Marshall to error
Java and back again so it's relatively
simple to do that yes
okay so the question is how would you do
if you have an automatic reset after say
an hour and there's no API friendship
for it but it's built-in in the software
and you can't control it's it's software
which which is uncontrollable and
there's two answers to that
first answer is stupid don't write that
code right but you don't always are in
control for example when we did tcp/ip
testing if in the tcp module you can
have lots of things that go wrong which
you can't control and then it is fault
recovery so it will show so what you
have to do is either probe so you really
kind of take control over time you you
do fast-forwarding time or something
like that if you can't even do that and
you have to sit down wait for now
sorry then you do a sleep wait one hour
and you go for a long coffee break and
and you have one test and then 24 in a
day right and it's in that situation I
would say you do something wrong you
should not write that kind of software
you should at least be able to to have
that as a configurable timer say well
okay normally an hour but now a second
and then we we just wait a second and
then the trick is always in that kind of
things did our wait sufficiently long
right because what you really would like
to test is around that second but you
don't really have a good specification
of what should happen around that second
so you can either go over the deadline
and you know it's reset or you could be
just inside in the imager before the
deadline and then you do something like
that so and that depends a bit on the
application area what you really would
like to test out of that specific
situation if you call if this this
timing thing is calling some other
function that you can control so not
necessarily that you have to call it but
the timer function is calling your C
library to see what the time is then you
could actually mock that C library and
say okay I just say this is my time and
then you could steer it again
vacations to make a do the parallel
custom it did find it yes yeah yeah yes
yes yes sorry so the question is this
districts like magic how does it work so
you're right and I didn't show the
slides because I was a bit out of time
but since this is the last question
anyway we have this model where you have
resets and takes and takes and your
update the state of that model so the
model says basically what the system
should do and there's a link between the
action you do and the state the output
you expect so now if you do it in
parallel you just do things in a
slightly different way so the trick now
is to find a path through the actions
that you can explain by unfolding the
path switch that it is corresponding to
a model action yeah so there's a
computation going on there saying well
okay I have this strange range of events
let's order them in all possible ways
and see if one of those possible ways is
actually a valid way of running through
the model so that's used to quenchless
your your parallel actions and say it's
the sense grant realization then it must
be okay if not something's wrong
one last question no okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>