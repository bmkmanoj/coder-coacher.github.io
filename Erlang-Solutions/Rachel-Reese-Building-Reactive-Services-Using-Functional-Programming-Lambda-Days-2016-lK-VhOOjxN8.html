<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rachel Reese - Building Reactive Services Using Functional Programming (Lambda Days 2016) | Coder Coacher - Coaching Coders</title><meta content="Rachel Reese - Building Reactive Services Using Functional Programming (Lambda Days 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rachel Reese - Building Reactive Services Using Functional Programming (Lambda Days 2016)</b></h2><h5 class="post__date">2016-03-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lK-VhOOjxN8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I hope I can actually keep you guys
awake I know the after-lunch slot is
always a tough one um a couple things
before i actually get started um i have
f sharp torg stickers here thanks to
Evelina so if you guys would like one I
you should definitely first check out F
sharp org the foundation is a really
wonderful resource on all things f sharp
and you know things you need to get
started more information on you know all
all things f sharp it's really it's a
wonderful wonderful research resource f
sharp torg we also finally got the jet
sunglasses in addition to the jet
headphones and i know they're out
circulating somewhere so if you guys
want more swag from jet that would be
really you know you can have some more I
was handed one pair I know they're out
somewhere else so I don't have more for
you guys but they're here at the
conference f sharp also has a mentorship
program run by F sharp org if you go to
F sharp org slash mentorship i believe
and check that out as well i don't
recall the exact details but it's a few
hours of a mentors time in a few hours
of your time and you can just basically
asked questions and help solve problems
and figure out you know if you're just
getting started in F sharp or if you're
having a particularly difficult problem
you can work with someone and sort of
sort that out it's a really wonderful
thing a few people started to sign up
and I'd love to see it go further so my
talk now and building reactive services
using functional programming it's the
the talk in general is basically how to
make fgr perform reactively so I ok I
work for jet calm in the States and very
quickly we're an e-commerce company
we're taking on at amazon we are
basically exclusively an f-sharp shop
which is a very weird and very awesome I
think thing mostly we are hiring we have
an office in Dublin
if that's you know it's a little more
convenient than moving to New York City
for you folks but definitely see me if
you are interested in full-time F sharp
work this is in addition to F sharp this
is some of the other technologies we use
where heavy users of azure as we are
taking on Amazon we are not heavy users
of AWS so you know we use for matter you
know we have the VMS we have sequel
azure we use the service bus and active
directory from F sharp since some of the
the libraries we use packet and fake FS
blog unquote we have note an angular on
our front end r and python and SAS on
the from pro our data science and then
down here in green is sort of everything
else that we use a well not everything a
random assortment of other things sequel
event or microservices Kafka Redis storm
um you know we're sort of we use a lot
of different things xamarin used to be
in here should be in the bottom section
as well am so it's a pretty fun place to
work but on to reactive services the
reactive manifesto which was yes updated
somewhat recently in September of 2014
the the new one has four main tenets
elastic responsive message driven and
resilient and you know these are what
today's modern applications should be
and I'll go into you know I'll take each
section and sort of talk about how to
make f harp you know be each one of
these things so responsive first look at
events events can in almost every
program actually has to handle events
whether it's clicks in the user
interface listening to sockets and a
server it's basically just a reaction to
a change in state so events an F sharp
implement I observable they are
composable they are first class and they
are immutable so you know by immutable
obviously I mean they don't change out
from underneath us um
and obviously concurrency in any form is
very difficult without immutability they
implement I observable so events are of
type I event and you know they inherit
from this something the reactive
extensions also do and my first class
just like you know functions in the
functional programming language we can
pass them around they can be an input
into a function you know we can return
them from a function we can filter and
transform them em we can actually I by
composable you know we can in addition
to filtering and transforming we can
compose all the operations so this is
perfect we can do stuff like this oh you
know so in f-sharp the pipe is very very
common it's you know I would say almost
a mainstay of F sharp programming it's
important enough that when the f sharp
community redesigned our logo we based
it around the pipe symbol but here this
is a short little know very real world
demo program but if you click quickly
it'll add one to a counter and if you
click very slowly it will add four so
basically you know we take an event yeah
we map it grabbing the date the current
date time we scan through to see you
know what the last time stamp lies and
then add four or 1am and map and grab
you know grab the the first one add that
print out what the actual number of
clicks are you know accumulating that
total and then set a label you know set
the text for a label to that but it's
very composable and very easy and quick
and and linear to see what's happening
there so these these functions you know
map and skin and everything are actually
called Combinator's you know we have ADD
and choose and filter and map and all
these other things we can also create
our own so you know down here event
using is the one that we're creating and
the code on the top is how we would
actually Cree
81 but because we can create our own you
know in this case um just setting a new
color you know creating a new paint
brush color from that color but because
we can create our own you know we can
add you know we can turn a series of
events into an event stream which
handles very much like an I innumerable
and our code looks like we're
programming against sequences very
convenient very easy very lovely I would
say my phone with me perfect so message
driven to move right on before we move
on to message driven properly I wanted
to talk about a sink workflows which are
basically an application of F sharp SAT
computation expression syntax and if you
want more information on a sink in
general there is a really great blog
post by Tomas petrol check which I saw
somewhere back around on the differences
in C sharp and F sharp on in a sink and
it's you guys should definitely google
that and find that blog post but before
before we go on to even you know digging
into a sink first of all I wanted to
make sure that we were clear on the
difference between a sink and concurrent
and parallel so a sink to asynchronous
is basically just specifically
non-blocking so usually in reference to
i/o operations not necessarily even
parallel just means non-blocking
concurrent multiple operations actually
happening at the same time but not
necessarily in parallel and in parallel
means you know multiple operations
happening at exactly the same time same
time so concurrent means a little bit of
one thing will happen a little bit
little bit of one other thing will
happen and it basically goes back and
forth very quickly so it seems like
they're happening at the same time but
to move back to so I know a lot of
audiences and and me especially you know
a few years ago we're very confused
about those things so I like to always
throw that one in there so computation
expressions so I had said that a sink
workflow sorry you know implementation
of the computation expression syntax
computation expressions are to a lot of
people think of them as monads is the
first thing I wanted to talk about it's
a you know single syntactic mechanism
which gives a nice syntax for multiple
abstract computation types so yes we can
think of them as burritos and and that
is really lovely and they can be monads
and burritos they can also be a lot of
other things it doesn't have to be just
a monad so you can be mono additive
monads basically an entire feast of
delicious food it's not just freitas bad
jokes I'm sorry so supposed to keep you
guys awake after lunch um but you know
the main point here is that it is not
just monads there are lots of different
things that that can go into computation
expressions so we sink workflows are a
computation expression there it's very
very very easy to convert classic code
into an async workflow and it reads you
know very similar to the the classic a
synchronous code which makes it
obviously very under easy to understand
and reason about so here is some classic
code and we have a web client we're
downloading some data and you know
outputting the length of the data that
we just grabbed here it is in a sink we
have you know the new web client here
we're grabbing me the same data here and
we're printing out the same thing at the
bottom the main difference is our that
we've wrapped it in this statement that
has a sink and curly brackets we have a
let bang instead of a you know let
without the ! and we have an async
download string instead of the web
client download data those are really
the differences that's how you would
convert this over to using an async
computation expression em let let bang
we'll start the computation immediately
whereas let here within the async
expression creates an async object for
use later so you know you can evaluate
that later once you need to and then the
print out here is that's what that would
look like so a here's another example
just within a recursive loop you have a
rack is how you determined declare
something to be recursive and again you
have an async and you're waiting an
event printing the clicks doing you also
have the the do and the return syntax
you also have a back pipe which is the
same as a forward pipe but the things
are reversed so it's you know just one
more example of of another way to use
this as a you know way to get into the
actor model I know a lot of you folks
you are actually work with Erlang and
most of you here are probably familiar
with it so you will know fairly well
what the the basic tenets of the actor
model but you know it's a model of
concurrent computation using actors the
the four main pieces I would say you
know dynamic creation of actors
inclusion of actor addresses in the
message interaction only through direct
asynchronous message passing so that
obviously the message passing is the
huge part of this and no restriction on
message arrival order so putting
together all of these pieces you know
the message driven part of reactive is
actually done using the actor model and
what is an actor you know independent
computational entity which contains a
queue and receives and processes
messages Carl q it one of the folks who
had declared that discovered the the
actor model at one of the things he said
was that you know one actor is no actor
and they come in systems so I know uh
one of the the examples all often use is
you know it Erlang was you know
originally developed for use in phone
systems and if you have only one
telephone there's not really anything
you can do with it I mean you can sit
there
like hang it up again I guess and you
know listen to it you can speak into it
you just can't really do anything else
with had like who are you going to call
you can't have just one implementation
of one actor so this is one of my
favorite ideas is looking at a subway
this one particular is the toka Tokyo
subway map but you can think of each
station sort of as an actor there are
trains as messages that come in and you
know each each station sort of processes
the trains some folks will get off and
switch to another train and continue on
some folks will get off and leave maybe
error out some folks will just continue
on that train to a new station but some
processing happens at each station for
each message train that comes in em but
specifically here you know there is a
path from any station to any other
station it could be complicated it might
involve eight transfers and be really
inconvenient but there is actually a
path and each one of these is actually
named and I think in any decent subway
system they are all named different
things so basic syntax for agents here I
have yeah a huge loop i'm creating
actually a hundred thousand different
agents and posting to them quite quickly
a point i often need to make to c-sharp
crowds is that they're not threads these
are so very different than threads but i
imagine that most of you folks will know
that you know i can obviously create
thousands on my laptop but you see the
the async workflow in the center of that
basically then the mailbox processor is
an async workflow and with a loop inside
of it you can use a well true loop you
can also use a let rec loop I have
examples of both I promise but you
contact the agent by just say you know
an agent top post will post a message to
that specific agent m and this will
print out you know for every 10,000
agent
it will print out a pin here so I just
to show you guys with the very basic
syntax is for working with agents so
they are also called mailbox processors
in f-sharp folks will still refer to
them as agents and occasionally because
of our laying folks will also refer to
them as actors they all mean basically
the same thing in the f-sharp instance
mailbox processors ought to be able to
get replies from an agent um basically
em you have the same mailbox processor
here we have a recursive loop with an
async workflow in inside where so here
you know we have the let Bank message
inbox receive that's where we actually
take the message and then we process it
here instead we have at the mailbox
processor has a tuple type with a string
and an async reply channel so the async
reply channel is how we actually are
able to process replies back out of that
agent and so when we're receiving our
messages we can decompose them right
away into a message in a reply channel
and then use the reply channel to just
reply back and then if we're we
specifically are intending to receive a
reply from that agent we need to use
post and async reply instead of just a
post so the main pieces here are
including the async reply channel excuse
me in the mailbox processor type
receiving it as part of the message
using the actual reply channel to reply
and then calling post an async reply to
actually you know ensure that we get
that message back um so this again this
is from a short demo app that basically
just repeat you know it's a little
command line thing will repeat back
what's printed into it sends out to an
actor and that actor will you know just
print like it says received a message
and what the message was there's also a
way to scan a specific you so this is
another small demo app it can spin up a
few you know different jobs and then
cancel them if needed so the in-progress
agent basically just keeps a list of
everything that is currently in progress
and the completed agent prints out that
a job has finished am be but yeah so
these are two of the agents that it it
uses this is how we actually do the
scanning there's a canceled job so
basically if you say you know I've I
have jobs you know 12 15 running i'd
like to cancel number seven ah you scan
the in-progress agent dots can and you
know using the job the job idea result
in the source and do a cancel if if
needed and if you find if that job
hasn't already finished and you do
actually find it then you return an
action to further cancel that so one
major difference from Erlang and i
always feel a little weird giving this
presentation in front of anyone who
actually knows much about our leg but F
sharp agents don't work across process
boundaries so that I feel like is sort
of a major failing um in many cases that
that ends up being perfectly fine you
know there isn't much need for that if
if it is all within 11 project 11 set of
code then you are fine but I know this
is a fairly big deal to a lot of folks
so there is a library called cricket
which can handle remoting now used to be
called F sharp actor I know that was
changed maybe a year ago but I've you
can still google for both so the way
cricket actually works slightly
different syntax basically the way you
declare the actor is with using actor
inside of curly curly brackets declare
the name so you know every actor needs
have a name you know where you're going
you know what the the actual address of
the actor is and then within the body
you again still have a recursive loop
and the message handler that basically
defines how you should be handle
message so you receive the message in
this case you know depending on what the
the message type is and you know I hear
it's just a discriminated union of hello
hello world or a name it's again very
real world this code that you know I
used in production every day um so
either print you know hello or hello
world or you know hello name yeah but
and then the way to instead of a I
mailbox processor dot start you can pipe
this into actor dots bond so the syntax
is fairly similar it has all of the main
basic pieces of a mailbox processor and
then again this is how you would do an
agent top post you know send to the
greeter actor you know something and
here it would print hello from F sharp
actor um remoting this is how you would
actually handle remoting you need to set
up and configure it properly to to
handle this but it is possible to
actually handle remoting um when you do
have promoting setup there's a great
little I example that he has which
basically has two actors I putting a
game of ping pong and I'll just go back
and forth and back and forth but be once
you have remoting setup and once you've
declared that that you need to be using
remoting the internal cementing you know
the the actors that you use are exactly
the same the swim still had you know
actor curly braces named ping and a body
with a recursive loop and a message
handler and slide which tells you how to
handle that actual message so the
internals here are exactly the same so
resilient moving on to the the third
piece recently you know basically we
need to be able to handle handle errors
there are three different ways that are
good to handle errors using async don't
run synchronously to you know report
back to the the controlling thread using
a sink start with continuations so
there's three different options one of
which is an exception continuation and
then using the supervisor pattern then
you'd have to you have to sort of set
that up yourself but using that you can
also handle exceptions that way so using
a sink catch you know here we have
moving back to mailbox processors we've
been a sink start and yeah you know
results comes back you can do an async
catch and then an async run
synchronously we just throw that async
catch right in the middle there and you
know it will catch if there's an error
and in print that out this is if I'm you
know reading and a you know trying to
read from a file very quickly yeah if it
it's too big then you know that it might
still be in process and so you throw the
async catch in there but it really is
just adding you know that extra pipe you
know between an async run synchronously
and an async catch and then and the
actual you know code that you're running
so it's it's very very good very easy to
use for basic async workflows here if we
r you know we have an agent that it's
trying to reply we have our agent posted
a sink reply then from there we have an
async start with continuations and you
know the first one is the successful
continuation if everything works out
fine the middle one is exception the
final one is cancellation so here again
you know it just add in the correct path
the correct way to handle the error and
you have a more resilient system because
it's able to handle these errors and for
a another example of starting with
continuations here this is the be agent
that will are the
demo that will actually cancel the jobs
so here you know we're posting to the
in-progress agent and then we have a
nice thing start with continuations that
you know posts to the complete agent
when it's finished and in this case it
doesn't do anything with exceptions
because it's you know this very real
world small bit of code and then here we
have the cancel exception which will
cancel this job but in you know it's it
is a very common pattern to use this
start with continuations to be able to
handle these errors and supervisors um
so this this was actually a fun app i
wrote a a very quick sort of proof of
concept I when I first learned about the
actor model I and you know I had been
learning I've sharp a little bit I
thought it was just the neatest thing
you know ever and I I just had to do a
proof of concept to be able to them
handle the the email that we were that
was coming in at our current company we
had that company was a sort of like job
we had to send a lot of you know thank
you for signing up here are some more
information here's you know your weekly
email and stuff you might want to
purchase to all of those sorts of emails
and I had you know a flow of agents to
be able to handle something like this a
a certain template certain data that
needed to be inputted input and then
certain different you know I needed a
way to model errors and i used a
supervisor error agent that basically
you know i could post up to the error
agent and say hey you know this is the
ER that i received if it's something you
know about try to fix it otherwise error
out and right into the log and so since
again you know this was a
proof-of-concept the yam you know i had
a massive set of data and you know
several different templates and it would
you know I'd start by posting to the
first agent which would sort out what
type of email needed to be sent go off
to a couple different templating agents
when those were finished they would go
individually to the mailing agents and
the errors that I needed to make sure
that there were actual error so i could
make
that my error erroring agent was working
so i chose in cases when an email had i
think the letters A and n together it
would fail and the cases when it had enn
together it would fail it would fail
unrecoverable so um if it if it had a
and then together than it would remove
either the a or the end and retry but in
some cases again you will know how to
solve an error maybe it was just a
network timeout and you just try again
maybe you wait 10 minutes and try again
there are obviously cases where you have
an idea of how to solve those so the
earring agent can do those sorts of
things for you um but here you know I
have I have my agent at the top which
takes in a system exception and
basically just print that out in this
case here I agents at the bottom am in
this Oh in this case so I lied it's the
the next example that actually is the
app i did with emails this one just
takes a prince you know message to agent
with a number and in the case when it
has 99 in it whether it's 99 or nine
ninety or 9900 it will fail and post up
to the error agent and print something
out ah so this was my this was my email
example so yeah it'll replace a end
together with just a and then retry but
you know with down here you know you
cannot send retrying failure and yosef
you know it if the message contains
templating there was some error in the
the templating then just failed
completely because we have no idea
what's going on but again obviously
there are ways to keep your and solution
excuse me your code resilient because of
the ways of handling these perfect so
elastic the last one
you should be able to scale agents on
demand and I know I mean obviously Azure
can do lots of these sorts of things for
you but in this case there's also you
know you're jumping back to the the
async code from the very first example
you know for trying to grab a certain
amount of information from a website you
know you might have a list of three you
use a processing agent to actually
process that information and coming down
here you take that URL list and you
iterate and create a new instance of the
processing agent for every item in that
list automatically going out and you
know getting that information so if
there were 30 of them it would spin up
30 agents in that case and it was very
elastic very easy to keep that ought to
keep that information going and you know
scaled and and coming out and and very
quickly so I went a little fast are
there any questions I imagine there will
be bola you know there's additional
resources ah but obviously you know like
i mentioned definitely check out extra
org the twitter hashtag f-sharp is
usually really well maintained and paid
attention to a lot of folks will answer
questions if you guys have questions
there is a channel on the functional
programming slack for F sharp I think
there's a an intro one and a general F
sharp one might be a couple others too I
would highly recommend both F sharp for
fun and profit and F sharp weekly the F
sharp for fun and profit is Scott
flashings website he has a tremendous
amount of very accessible information
just you know very in-depth very useful
good information on f harp f sharp
weekly sir guy sends out a weekly email
on what that what has happened lately in
in f-sharp would there have been pull
requests if there are no videos there's
new blog posts just a a complete rundown
of everything that has happened happened
the f-sharp community in that week for
mailbox processors and a sink in
addition to cricket that i haven't
mentioned up here there's the orleans
project and Akkad met both of which I
don't know quite as much about but are
very good and very well-respected so and
i would say i assume basically
comparable but so are there questions
sure and do you squeak it inside you
know your company and so why what was
the reason for taking it over a cadet
already asked for example so we don't
actually i was interested in cricket
before I actually joined and thought it
was just a really cool project it was
before either a cadet or Orleans were
very big and so this was just the first
act of library I had heard of was my
main reason for including it here really
I've worked in a couple of different
teams and and that jet that the teams
are sort of autonomous and you can
choose your dear technology as far as I
know none of the teams are using cricket
but don't quote me on that because in
three days that'll change um but yeah my
main reason for including in the talk
was that I knew about it much better
before the other two were larger
products one more thing before we go
into this talk f sharp conference is
happening march forth it's a completely
online conference and I will be speaking
I know several of the folks who are
speaking here will also be speaking
it'll be a great great conference and I
would highly recommend everybody watch i
believe all the talks will be recorded
as well and so you can jump on and watch
those later yes this is a first comment
to the other of question that that why
wouldn't
why would you use cricket I think that
it's very simple in a sense that can you
have for example in Akkad net strongly
typed messages or are they just objects
or all okay and and then yeah but like
earlier versus you couldn't but but but
then also this kind of that you can use
cricket so that you for example sent
messages to ask your service queue or
something and it's quite well enough
usually so it's very simple and can be
enough that's a good point to the other
to do remoting um yes that was okay
nevermind that was my main another one
of the original I was like ah you can do
remoting was this will will solve my
friend who does Erlang who always
harasses me about that so thank you for
this great talk I would ask you about
back pressure problem so what about that
what the story akka akka dotnet that
doesn't have doesn't provide you
anything so another question so when you
send a message right to the actor can
you wait on the response because when I
because when i use for example sick urs
right so i sent comment for example and
i want to really got the answer I really
need a kind of fact that message was
delivered to some actor so with our
content it's also not possible I mean
it's at least not easy yeah it's
possible but it's bad bad bad bad
approach anoka I kept I have also a
third question for you so huh would
imagine so but I don't actually know
that's not something I have needed yeah
so um and I'm wondering how you
distribute how you specify where your
actor will be exist will exist on which
not because in our kai is also Putin
issue because you need to specify
exactly you can use cluster but it's
also not easy so with linds it's much
easier so and yeah I don't want to okay
thank thank you thank you well quick
comment for the earlier compliment also
that that that's actually one difference
between between agent model and actor
model that that we who controls the
workflow and who is the control of the
work and also this is like a strong
currents of course so basically you you
don't get the message back immediately
but you can use this for example cricket
or actually f-sharp mailbox protesters
there there is this a junk reply and
there is also the reply yeah with
mailbox processors it's a little easier
to wait on that enough share in cricket
i am not certain anything else thank you
guys very much this was really fun</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>