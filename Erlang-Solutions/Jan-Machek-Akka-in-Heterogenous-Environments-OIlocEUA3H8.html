<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Jan Macháček - Akka in Heterogenous Environments | Coder Coacher - Coaching Coders</title><meta content="Jan Macháček - Akka in Heterogenous Environments - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Jan Macháček - Akka in Heterogenous Environments</b></h2><h5 class="post__date">2014-01-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OIlocEUA3H8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Nestor I'm going to introduce me talk
about some a cuckold so what we're going
to be doing is turn it way down scaling
down to very practical code we've seen
some wonderful wonderful coach this
morning unfortunately it's going to go
right down the hill today in this talk
but at least we'll be fun because it's
going to be life code so I'm you spot
the horrible type books I work at cake
do all sorts of interesting stuff email
Twitter handle and get out with us so
let's just see what we're building so
what we would like to do is to have an
app that you can take our phone &amp;amp; scan
coins just like that and so what we
would like to see is that there are two
coins and there will be three coins in
this scenario in fact i made a video
earlier and this is this is a sort of
video that will be sending and what we
expect is to see the coordinates of the
coins as we send them from the phone
over HTTP process your application over
at their cubes and computer vision code
in C++ we have 40 minutes to do it so it
won't be quite so high I know it sounds
really scary but it will be actually
relatively easy all the coding on github
I'm sure you can get it just all right
as long as you have not windows all
right so here's there's weight right I
have an iOS iOS code that actually deals
with a camera encodes some each use
exposed dream I turn it into these bulbs
so I don't matter to leave the bytes as
they arrive these are still just binary
blobs of data it's only the stuff that
goes back is going to be Jason we're
going to use RabbitMQ as the brokers
with native components at the end of it
in case my c++ code set falls just every
now at it now again it does that's how
can use rapidly to deal with a routine
restart the components i greased other
components and then still rely on own
gravities routine the rest of the code
is quite simply spring which is an HTTP
layer around our town and we're going to
work into retinal it's car so all right
can that be these are all the classes
really that we will need so we have two
interfaces that will be building will
have a command-line interface and we can
get started with and then really really
really simply we're going to wrap it
around restful api so actually i will
proper HTTP server that can receive
streaming responses or rather chunky
HTTP POST will be sending several
messages just so we'll be sending this
begin message to start a session because
presumably you all have this app it will
be only a stereo with the next best
thing so suppose you all have it will
need to maintain multiple sessions so
that's the begin command and that during
the session will receive many different
smaller messages so for each session I
can either accept a single image or
someone posts an image to me say all to
provide an API alright then they receive
a chunk of a frame so that's a bit of a
of a stream or I can get a little info
by the session and finally say for
management purposes I want to be able to
list all the recognition sessions
management API deters right who's doing
who's using my system they all go into a
coordinator that's going to coordinate
creating many of these recognition
session actors and that will be talking
array OPP to our C++ components
underneath I'm going to show them and
they will be replying though you're
receiving images and frames and they
will pack the data that we send through
so that's pretty much it for slides
let's write some code
so here we had we have a little shell so
we'll start with something that runs on
a command line just we can get started
and you can see something moving so here
it is if i right it's not going to do
anything quite a pleasant at any command
that you type in so even if i say thank
you say you know it's not really
cooperating so the only thing i can do
radius too quick that's kind of all
right but maybe we would like to have
something slightly more exciting so
before we do that let's sort of break
our app into this we could call it
layers but don't worry this is not gay
what we're going to have is a little
coral the app and an API so if I just
define Trenton core that's going to
contain some clever machinery that
actually does the recognition and then I
can have the API so that will expose
they were wrapping some restful
wonderfulness so I can just write this
straight api and i'm going to say that
the API depends on the core somehow it
has to be mixed in when I make an
instance of a PR and so I get access
here to everything inside corner I
writing Picasso suppose I say that
somehow corner there is is Sister to
Sister so
so now inside API I can have system
because what I expressed with this self
type annotation any scar just before we
go on how many of you have done scholar
wait those who those of you who haven't
doering I will not show anything too
terrible so in this way i say when i
make an instance of API I promise to mix
in core that's all I'm saying so this is
a self type annotation now all right so
I have the two layers which is all right
so let's let's see what we can do with
the course I have the active system
because we are going to be dealing with
rabbitmq and amqp what I'm going to need
is a connection factory so if anyone's
done rabbitmq MTP you know we need some
sort of amqp connection factory which is
a natural fact training like so and
unfortunately we also need to set the
host say it's locals that's why the ltp
brokers right I happen to have one
running I would show that but the
Legionaries one I didn't he would
complain and what I'm going to do
remember we had the two actors that we
talked about we had the coordinator that
coordinate all the sessions where we had
the recognition second active actually
deals with each of these individual
sessions well we can create those cranky
or Italy term I actually before I do
that less to deal with any connection
actor
great okay so this whole thing makes an
A in Cuba connection which is an active
so I consider sending messages and it's
going to deal with connecting to the MTP
broken and once I have this connection
and cream I can create smaller actors
that deal would say our PC or
communication on a specific channel
through a specific stranger or we'll see
that in just a moment and finally i can
create this coordinator acting as a
system of props or new coordinator actor
and its constructor requires the MTP
connection knows how to make all those
in connection so this is probably it
quite happy with this being the core of
my system now what you might be looking
at is you might be thinking well this
this configuration I wouldn't want to
have this hard-coded string straight
inside the core of my system so I'll
show you one thing that I usually do for
configuration will define another trait
so let's have a trait or cold called
core configuration and that defines the
amqp connection factory manufactured
like that okay excellent and then what
I'm going to say is that core depends on
core configuration so I can get rid of
these two dice and so I've just have
done some gymnastics but unfortunately I
am missing now an implementation of this
so I can create one here because I'm a
nice person I will provide a
configuration
here for convenience unfit configuration
and that's going to use the type tape
conflict don't worry about that strip
the name / library so it's a essentially
Jason like file that is available to me
when I start an act assistant so I'm
going to do something like this in fact
it's a lot of typing so more so just to
say he typing i defined that core
configuration extensible conflict for
configuration accessible integration and
it builds the MPP connection factory by
looking up CM dove am TV host strain in
a config file that's available when I
study after system so so far so good now
that what you've seen lead this cheat
I've done the code is on kid helps you
can all these cheats yourself so you can
build it up yourself and type or you can
just snack snack smexy step through the
code alright so what I need to do is now
actually use it right in the shell so
nothing could be simpler I can just mix
em chord with a coffee corker fear let's
see if I don't do it this is a compiler
right because I say that core requires
to be it's instances needs to have the
core configuration mixed in and so if I
don't do that here it's complaining if I
mixing just core configuration well
that's still not good enough because
I've mixed in court configuration which
defines the method MTP connection
factory but no implementation nobody so
it's now saying well you can't do that
because you have implemented the method
luckily i'll be good enough and provided
one in here and so this is now perfectly
fine everyone's happy what i should do
as well is to shut down the actor system
yeah
oh so far so good so I can now run this
application and it will look just like
it did previously except it now actually
start with the actor system and made a
connection to the MTV broken could you
hundred should have to take my word for
it frankly we don't be senior open all
right can be OTC type still not just
quickly but now that's all you see still
unfortunately all right so let's add
more things to it let's try to begin a
session still by typing right nothing
could be simple so what we're going to
do is look at our quarterly interactive
so here it is now the implementation is
missing so it's a three question marks
that's my convenience scarlet red with
you write some code you write a method
and you just can't quite be bothered
with the body of the code just yet you
can start typing through question marks
which is a valid value for any return
value but unfortunately it throws an
error when you actually try to execute
it nevertheless of two parts so it's
actually really what convene now that's
really that won't do for us now so what
we're going to have to do is react to
the big in message so someone sends us
to begin message so this syntax that
beginning message there is the minimum
number of coins that we are willing to
accept it I don't actually want to see I
don't care about that number here what I
would like is to receive the entire
instance of beginning because what am I
going to do with it well I need to
create this recognition actor so let's
just do that recognition session acted
so what could be called well never mind
what it's called just yet context after
off so this is where we receive the
coordinate receives a mess
to begin a session and then it's going
to create individual instance of the
recognition session after for every
session so it's completely isolated each
session so if you have multiple clients
they would be completely isolated from
each other so it's going to be a new
record session actor and that was my mtv
connection and an actor that's going to
return the responses somewhere i'll call
each other unfortunately it has nothing
to do with java kebun it just prints
stuff out on print on standard
nevertheless we can call each other if
we like after off so we create one Jabba
director we can create one generator
when this actor starts so according to
create one gather as going to receive
all the responsibility to print the
mountain standard output and it's going
to give it to every session that gets
created alright what we're going to do
as well I guess where our convenience is
to give the session after a random name
one that we like suppose we want to use
new IDs for it so now we have a
recognition session active call it our
safety and that's still not enough right
what we would love to be able to do now
is to take this message that we received
and sent it to the record session actor
forwarded to it so we can do just that
for would be so we will take that
message that be that we've received
going to take it as it is and just
forward it to be so now the newly
created ref accession actor is going to
see this message beginning alright so
that's that's that let's see how a
replica session after looks like now
that's going to be slightly more
complicated because we will take the
recognition session through quite a
number of
and so this will actually modify its
stake as it goes along you see we start
here this is this is completely empty so
we need to give it a bit of a hint so
when do we swear do we start how does
how do we begin when someone makes an
instance of record session actor what
does it actually look like well we're
going to say that we start with a state
called I don't I don't and we're going
to stay here for the stay state time up
daily sorry it's this empty so this is
the state name and this is the data
associated with that state so when we
start this instance this after we start
in the idle state with empty data
nothing's happening all right well
remember when we are in the state item
and we will be willing to stay here for
up to 60 seconds all right so I prate an
instance of this factor and I don't
receive a message in this state than 60
seconds later I get a time up I will see
well how we can handle that nevertheless
when we're empty when we're I own then
when we receive an event which is begin
it's a minimum number of coins
regardless of you know what the data is
for now we're going to reply to the
sender with the with already with a
session ID with a huge ID that we will
give it settled how do we do that in
Scala well it sort of looks like the
airline communication between person is
so almost a sender and self off thank
you so we replied with a string to
whoever sent us the begin my search now
this is red right because the result the
return type of of values is unit except
what we need to return is a new state
because we're in ssms so the question is
where do we go next so we were idle
the beginning message and I happen to
have a state called active so we can do
that and now a time so we've started we
were in idle state we had empty data we
receive the begin message and we go to
the active state and I'm sure we do
something really exciting in the active
state but let's leave that for now and
what we need to do here is to initialize
the RFS happen okay so that's all good
what we can do is now why are in the
begin to map in the shell so if i type
data begin specify the minimum number of
coins then i am going to scored count
i'm going to send the coordinator the
message again okay well that seems
actually fairly reasonable that's let's
he can write right so what happens when
we run let's follow the flow fun that
will do groups that's not very good is
it exception here in creation no
configuration we found 40 cm is he ready
configuration siento MTP ojos that
should work to do the usual dance or
rebuilding the whole thing
but not really right we'll get some sort
of error coordinator next state active
does not exist that's the first problem
and second problem if you look here in
our records session actor we replied to
whoever sent us a message with the name
that we were given but I don't we don't
see it right this is this is slightly
awkward so we began a session and when I
communicate with that session I would
like to know its ID but it's not there
so what can we possibly do now let's see
I guess it's here right because we tell
the coordinator to begin and so in this
scenario does anyone know who the sender
is this when I say coordinated by
beginning who sent the message one
answer but we know you know does anyone
else know ok I'll trifle it's really
quite interesting so the bang as it
takes a message that's begin and then
the second parameter is a sender is an
actor f now what we say is that that
should be implicitly available but if it
isn't its value is no sender so in this
particular case well there is no one in
so to speak who said to the message so
why don't we actually provide a value
for center why do we create small apt to
hear who's job is only to display the
return messages so let's let's do that
so it needs to be implicitly available
so thus it foul we don't even have to
give it a name and just because we can
let's use the app to dsl actor you act
receive a message some eggs we provide
right that's better so this is I now
have an instance with a name underscore
if I like that we have called it home
but it doesn't really matter it's
implicitly available and so it's going
to become the valuable supply to the
second parameter of the bank method and
so and i run this now hi tech begin the
uuid that are generated that i'm
replying with don't want a second copy
this first one will do just fine when I
said begin one here is a message that's
the response that's the thing that I
sent back here and also be back to
sender in this particularly sender is
this underscore actor that are having
show all right excellent now I have one
little exercise before we speed up how
about we now list the available sessions
I just actually too hard what would you
like to do we would like to have get
sessions command and what we are going
to say ornamental iron gate sessions so
far so I go and what we're expecting
that is a list of strength list of those
you I represented s tricks so why don't
you help me type die out let's start
let's not recently so when i receive get
sessions what do i reply back suppose i
just sent back to the sender the names
of all child actors so let's see
children so these are the child actors
of this versatile actor but i don't want
to send back the actors themselves or
references to them i want to send
names so I map every child to its name
and I don't want to send back litora
book on survival is this that's nearly
here right I want to send back all the
children of the coordinator ecktor
except there's one extra child okay
what's spotted so this supposed to list
all the sessions gavel that's the one
how do i get rid of it yeah photo
exactly so so what do we do well we
filter everything that's no joke that
easy now what we've course we could have
written no x.x but we might as well save
our source of typing all right let's go
and another baking and if I don't bless
that's those are the two sessions I've
created those are the two children
cordon interrupted but not java hi XO
right that's very quickly wiring all the
remaining commands that's a lot of
typing so let's just move here straight
up area so these are all commands we
have available to us we can receive
beginning message we have before but can
now also see the single image and frame
child those are the interesting ones
this is where the neat really begins so
we go back to our recognition session
and this is this
the typing stuff so we've now go to go
to the active set so when we're in the
active state forces pacific time out and
when we receive a message that contains
message and data for now then we will go
to completed this is really really
simple we'll pretend that we don't do
anything just yet and we'll fill in the
details in just minute what we would
also like to be able to do now is to
define this state completed what do we
do when we are completed state and we're
not going to do anything and I also
another state or ported this is when we
timeout or something and let's also do
energy behavior and when we are in them
in any state when we receive a message
that we don't really understand then we
need we can define that as global hand
playing when unhandled so when we
receive a message that in any state that
we don't really understand any of these
functions then we're going to do what we
type here and what I would like to
actually apply is global area so what we
have stated time out with any data we go
to report it so if any any state we time
out we just go to the aborted state
that's what we're going to do lastingly
is expected behavior which is a state
function that actually does nothing
interesting it just stays in this state
forever so whatever message it receives
it's something to move any other state
the empty behavior once you so
essentially what we're saying is once
you hit
88 or aborted that's it you're there
forever so that's pretty much it that's
all you know that's the main crux of a
catalyst and so the messages go is how
we move from one place to another but
that wouldn't be enough right that's
nowhere near enough for four we are
trying to build because what we now need
to deal with is a MTB so we have a kind
of a running image ATM or Joey hood I
now need to connect the MPP program so i
can send these messages actually be
processed so let's do just to that we
need to get ourselves on to get our
hands on the mtv connection my rapping
one from the connection owner so we're
going to create chapter for a given a
particular entity connection and what we
are going to have is if it's quite a
horror from the past but our pc client
we will actually send a message and
waiting for reply but in a non booking
double asynchronous way i can see it
just meant or an excellent but we
wouldn't want to leap all these a MTB
connections so after stopping those stop
unit what we would also like to do is to
stop become the mtv actor okay well this
is this is nearly there right except
post stop somehow implies that we have
decided to stop someone decided to stop
us so the question is when does that
happen well it actually happens on
transitioning from anything to complete
it or abort it so on transition
when we go from any state to complete it
we stopped ourselves and when we go from
anything to abort it underscore we also
still vessels okay that's nearly there
so we go between all these states see
the messages all fantastic now we better
start sending the images this is the
meat so I still have the active this bit
basically what will be receiving the
images from the phone let's don't know
what they are good enough so let's let's
do something about that so when we
receive let's deal with say images but
you know images or frames they they all
fall down the same line let me just go
next I think be excellent and now we
have the images so very early so we're
in the active state when we receive a
frame message containing the frame is
that's the actual fight array of the bit
of the h.264 stream and we're in a state
start we're with data is starting so
this is the first frame we oversee we
don't have a decoder for it yet what
we're going to do is to create a new
h.264 the total given this pound coins
function as long to those what do we do
well the decoder is going to call this
function every time you decode the frame
so every time it has an image from the
further straight call state it doesn't
do anything to clear just yet but we'll
get there in a second and the minimum
number of coins is simply the lowest
number of cones that we accept to be
displayed so the decoder context the
decoder context false function
it's an array of bytes and returns a
unit and that's exactly what this
function will apply to coins that's
exactly what remains so we apply this so
we eat this first parameter list imagine
that and what remains is an array of
bytes unity and that's exactly the
parameter of the constructor of the
decoded context excellent and then we
move we state in this current space that
we stay in the active state but we
modified the data so whereas before we
has starting with a minimal number of
coins we are now active but running with
this decoder so when we receive another
frame we're already running and if the
frame length is greater than 0 then we
decode that one frame and stay stay in
this current state as well and so forth
until we get here this is where framed
up length is equal to 0 as the last one
we've received so we close the context
and go to completed so there is to it so
this is the main machinery of our state
recognition or is it called record
session actor so the only thing the only
tiny little thing that remains is all
the integration work so what we need to
do is to actually send these images so
how do we do that well we actually take
advantage of the mmqb stuff so I typed
in MTP operations that's going to define
method called entropy ask this is the am
keep you active reference that's one we
created earlier and we send a message to
give an exchange
t here's the feel of the array of bytes
that we're sending and what we're doing
what we're going to do is ask the MPP
actor to reply to the request request is
publish the payload to the skill in
exchange on the routing key and when the
response arrives we're going to take it
and map it if the response contains a
delivery taking the body we take the
string representation of the body all
run blocking or jolly good bye etc all
of you strongly typed people you should
be crying despairing this this is
terrific a future of straining I said we
have jesse's right Street and I even
have a slide for that I think this is
the slide illness now does anyone know
XKCD right so you've seen this one and
sometimes we have these magical bullets
and one magical boolean type slave
programming well suppose now that we
know regular expressions we could do a
little replacement and do just that in
Scala so how about it what we're going
to do is back to them so instead of
returning a future of string what we
would like is a future of some type a so
not a future of strength of future
awaits so the question here is how do we
go from string to a so what we would
like to be given is Jason readin Elaine
so Jason reader away in schuyler speak
would be a type class and there are many
different instances that we will create
actual one instance comparo give it to
us and facility and so what we need to
do
do I suppose this freedom dot read days
chasing arson fires live to s tell you
excellent so this is jason reading
that's been given to us loaded from the
implicit scope for the type a and now
give us an instance or a and because we
are not in the future we will get a
future away and so it's now really easy
to add Jason parcels now of course I
don't want to type up too much anyway so
i have used sprays default Jason
protocol it's naturally really
convenient so this point format point
format and coin response format
represent instances or Jason region for
coin Jason readable point and Jason
reader for cone response and so when I
actually call it compiler will be clever
enough to look through the implicit
scope and say AHA it's this reader
because you say you want a coin response
it's this Jason reader that argue so
well why don't we why don't we wire
altogether it this bit here that we've
now done so instead we still return unit
but what we're going to do is send a
message over n QV to BCM exchange and
the CM coin ski by taking the payload of
this frame f and all success of that so
this is a normal teen operation as we
start this ayah operation and when it
successfully returns we are going to I
guess straight to compare that the
number of codes in the result is greater
than the number that will request it
when that's true we're going to send a
message to the
after suppose this is nearly hit this
should really work so so let's just see
that's wrong so happen to have a
command-line interface so that's our
session and I'm going to send 264 stream
to from this file so this is going to
read the file and send bits of the file
to the decoder as if I were doing HTTP
POST so let's see all right well that's
stuff is being sent sure enough this
look really good does it you could
probably tell that i know this should
have gone wrong still so what's
happening so coordinator yes and it says
100 event frame see here's the byte
array you may have noticed a trip quite
interesting right we don't even box this
is the actual battery and instant active
how is now is that even possible well
well well so what do we have a frame
arrives hi but it's the data that's
different when we go to active we don't
modify the data so we are in US we are
here in state active but with data empty
well that's no decimal use right we have
to do start in a number of course i
vacillated so let's see
yes dear remember come say one and now
excuses for before all right we have the
decoder static that shows the jolly good
shut up a window but still nothing what
could possibly be happening well we're
going to have to take a look at the
RabbitMQ console to figure it out
alright well Wow so we have 237 messages
that we received those are the frames
from the video so we've successfully
decoded Oh brilliant we have 2 37
messages published so many a second 25
or a second that's no good right when I
5 does that mean that's roughly the
video what could be happy it seems that
no one's consuming the messages it seems
that we have forgotten to write our C++
program I happen to have it or a running
and will be torture you through that so
let's just run this and this is a little
C++ program that consumes the messages
there alcohol except by now it's too
late for our program it's given up
waiting it said well no response i'm not
going to you in talk to you so I suppose
we better start a new session and let's
send it the same man coins before so
messages are now should be going through
ah here we are those are the points
exactly as I pointed them out so drop
them with my hand perfect so this works
exactly as we expected except
unfortunately command-line interface i
mean if i could give my users man line
interface look I don't know a
probability by suppose we have to do
I devices so we better build our REST
API as well luckily that's not going to
be active too hard to do we already have
a TI tried and we say that instances of
the API trade needs to mix it cor coral
fluid further down the line needs to mix
in court integration now in bapi what we
would like to construct is a recognition
service which will be our HTTP service
i'll show you how that looks like in a
minute as a system dr. off of you
service if i type properly taking the
coordinator actor okay what we're going
to do as well is bind this recognition
service to a specific port and specific
ideas so in our case will bind it to
over HTTP we will send it httpd top five
message so this is the HTTP extension
motor that gives you back an actor that
manages all the HTTP server connections
so all that we're binding is binding
this recognition service to let's find
it all local addresses on port 8080
that's all right we are so that's
essentially HTTP server we now have a
non-blocking HTTP server that can
receive many different connections from
the clients and yet it has access to all
the components in the quarry I tell the
coordinator is the coordinator value
from the court rate equal its system is
the system value from the court right
now right so I suppose the last bit is
how does this record search
well depressingly no implement it so all
that we have to do is handle the HDD
messages that are sent us so one of the
first message is that we get as an
example it is HTTP connected so what a
client connect HTTP dot vector so
someone connected to us so what are we
going to do well now that we have an
incoming connection we need to register
someone who's going to be responsible
for handling all other communication
with that client now in this case what
we're going to use is singleton handler
in other words we were registered
ourselves to have the messages from
every point okay well how about that
when we reply to the sender with HTTP
register soft now any crime that
connects will first go here we are
registered ourselves as the himself and
so we say we promise now to handle all
other messages that are coming from that
client now what are these messages well
I suppose one of these could be HTTP
requests that's what the clients do to
us and send requests quite unreasonable
and there's no prototyping we need to
match the methods URLs so let me just
fast forward a little bit to him I've
taken all that where we match the paths
so when someone does a post to the root
URI then we send the beguine message
blue coordinator and we ask for it so we
get a future offspring remember the name
or this issue the identifier
we've generated and it will reply to the
client so we sent to the client when
it's successful we sent to the client an
HTTP response which carries the session
ID so i can make a poster / record as
the URL and i get back to session ID
what's more interesting is this if i get
a chunk to request start so when the
client wants to do a chunk to post
because what you don't want to do is to
receive 1020 a stream you don't even
know how long this mjpeg stream or at
this h.264 screw would be so you can't
just accumulate all the post data and
then set it all at once what you want to
receive from the client is one trunk of
the data at a time this is my file
upload right everyone knows that hour
depending on which you are I the client
posts data to so say we support NJ Megan
H h.264 encoding we create a streaming
record service so this is another actor
and we have an actor / client connection
so quiet opens a stream in connection to
us and we then say depending on which
one it is we then say right register
this actor that we've created a few
lines above as a handler for that client
one thing could be simpler than a filter
northcote right so when it then receives
a message chunk is the bit of the HTTP
request then all that we are going to do
is to send it to the coordinator now
what is that eat that we're sending well
it's whatever message applied to strain
an array of pipe returns in some cases
it might
image in some cases it might be a chunk
of the h.264 straining so I think this
is nearly ready ah no one more we
actually have to write the CERN really
terrible isn't it so how would one right
an actual HTTP server now that we have
all the components ready so this is the
depressing and really powerful marketing
that's call it a rest object rest now
what is it well it's it's an app so that
we get a public static void main what do
we need we need to color because we
stake or we promise to implement called
configuration we already have court in
that configuration that but that's just
like the show before right I would miss
the RESTful API so how about that so all
the imports that's the one well actually
it ready so i can now run this and that
will give me a restful api yes that's
actually what i need to do is start the
baby's one
and we all around so what I can do now
is do a rest console and do an HTTP POST
to local host 8 18 / red I'd
riposte
let's do my thing you see in eclipse
vworkspace good idea we have rebuild
project
that's just
anyhow
now what I'm going to do next of course
is to use the phone whatever I've done
it's fixed it so we get a response back
as the UID of the session and so if I
could now use the chrome extension to
open string HDD connection or we work
except I can't really do that so why
don't we why don't you try with a phone
now this will put a little bit of
experimentation because both need to be
able to say that word I need to from the
app that I have on the phone post to the
server that's right here and the next
work that we have here as a as a
firewall that doesn't really allow that
so personal hotspot to the rescue
we'll get Wi-Fi connection go
right so I should have a reasonable IP
address now 17 to 20 10 2 so I run the
Africa so you believe me that i'm
actually doing it it's the way it's
going to fail 17 to 20 10 to press the
pre type button' includes the video that
I've just shown you and what we're going
to see is hopefully we're going to be
printed out i do first a post which
obtains the session ID and then a string
HTTP request so let's go yes that's
looking good and we actually receiving
the responses let's see let's see what I
rather than QQ is doing
to sellers running of course so no need
to start with one of them must've failed
by not binding to the port 8080 which is
obvious but there we go one more attempt
and we'll see hopefully the messages
coming through so run the app my IP
address is again
too okay fair where they are excellent
so the phone is actually sending the
messages it took a long time over
personal Wi-Fi but there we go I was
going to show you how how are actually
doing on a piece of paper but I never
trust the lights it networks so let's
try try again just before sure what we
can do now is to see how the messages
are coming in so you can see that we are
sending messages in they are being
consumed and the red box session actor
is between the messages back from the
queue I can even see the connections
that we are making to the rapid clip
console so you can see that we have a
connection from our application and then
we have connections that the c++
application makes so that's that's
pretty much all I have to show you
luckily it worked even through adverse
situation I will suppose now's the time
for questions i'll start you with one
here's the code know where the code is
there it is with description of how to
build it you will need it opencv you
need GCC compiler to it Travis and q2
leader line and God other than that
they're good to go okay
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>