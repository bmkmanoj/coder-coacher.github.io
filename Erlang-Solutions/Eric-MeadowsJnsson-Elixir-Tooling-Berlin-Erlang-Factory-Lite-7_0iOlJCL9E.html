<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Eric Meadows-Jönsson - Elixir Tooling - Berlin Erlang Factory Lite | Coder Coacher - Coaching Coders</title><meta content="Eric Meadows-Jönsson - Elixir Tooling - Berlin Erlang Factory Lite - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Eric Meadows-Jönsson - Elixir Tooling - Berlin Erlang Factory Lite</b></h2><h5 class="post__date">2015-01-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7_0iOlJCL9E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I run my name is Eric it looks developer
that I can make it better calm and
suicide also an 8-14 so this talk is
about he ate about a tool specifically
about the Pegasus and packages and how
does the policies work in mix our bill
tool and eggs our package matter so
let's start out with mix mix is the
build and project management tool you
use for a lot of things in your day to
day life you can use it generate new
project you can pass your car would run
tests it handles your dependencies and
you can do almost anything else you can
think of because it's extendable through
in these tasks which I will show in more
detail later on at the corner of your
mixed project is the mixed pine or mixed
at exs pan it looks like this when
generated it contains your project
configuration and it's lower
automatically when you run many mixed
tasks
this is how our dependencies are to
fight you can see that we are defining
pub or a dependency on 2000 also
defining the ecto dependency which we
are not specified on how to fetch which
means that mix will treat it as a its
package and will be delegated to the
external pics tool and wherever budget
talks for Helen appendices we have tips
get that sub data so on for prefetching
updating or listing of tourists and so
on and with the dependencies we have
reputable bills what that means is that
we have a week's log file which stores
then it stores the information about
each dependencies so for some point you
look at the bottom have a WebSocket
client where we store the URL how to
fetch it and the deep hash and for a
fright packages we can just store the
package name and this version because
they are all unique and this file should
be committed so that all users of the
project will get the will get this pile
and they will get the same versions of
each dependency as is the one you're
using and the value of in testing and we
also support rebar and make fall
appendages and as long as they follow AP
conventions so any project that I reward
a config or a make file we can compile a
freeware project we can also fix the Sun
dependencies of the project and this is
really useful because there are a lot of
great project
in the in the egg in the ecosystem
overriding that we can that we can use
so let's talk about hex is the package
manager that we recently printed or
about it I think it's been explained
production since April and like just I
said earlier it's it's a packet manner
for the whole hour long ecosystem not
just for the helix world and yeah let's
go to next time yep so here are the
downlow statistics for packages so as
you can see we start out in April with a
very modest month and it goes up to a
November so last month we have we had
over 7,000 packet downloads so it's
growing which is nice so next I'm going
to talk a bit about some of the
internals and eggs because I think
they're interesting and it shows how
it's designed so Hicks so we have mixed
which is the bill tool which hallows the
palaces and we have eggs which is the
package winner and it's an external
application so you need so you need to
fetch it separately by well but whenever
Queen the tasks for prefetching least
hauling ass these great through mix with
meat sauce so the Hicks exposes about
from it starts which you can use to to
publish packages you can register as a
user you can search for packages and so
on
and to show quickly how mixed artworks
this an example mix talks this just an
elixir file and a mix task is just a
module which exports the run function
with one argument which is really to say
it's the one monogamous and it's
prefixed with the mix tasks name so when
mixed arts it looks through the whole
carload path and it loads and loads and
modules that matches this interface so
this means that you can define talks in
your own project or any dependency that
you're using you can also define tasks
that will be available to you as a
developer and act 0 and x RM are two
great examples of this so ecto is a is a
database library it supports database
migrations so we have a task anyway ecto
gen-mai immigration that generates all
the boilerplate for migration plan and
then we have the egg to migrate task
that will run the migrations against the
database and the xrm we say is a release
management tool it it uses the relics
and for compiling the release it can
fetch a configuration from the from your
mixed file and can fetch a load
the configuration for your application
from the mix convicts and there are
other parts of mix there are extendable
for example you can extend the
completion stack so by default we
compile electrified compile Erlang files
licks and yet which one of the election
/ sometimes but you can extend Asia for
example in library a leper example
intimate protocol buffers can can add a
task that comprise the protocol buffers
two to beam current and this is exactly
how it integrates as well so they're
such as whether they're toast for
publishing updating or so but he saw the
dependency like actor and exo-m is
actually install as a as a code archive
an accord archive is basically just a
zip file containing beam and app funds
and this not it's not an elixir specific
feature is actually supported by the our
light color and a quarter cab looks
something like this so this how it works
we have a so this would be a zip file
containing in the hex but add file and
the beam files for all the modules and
the ncar archives are loaded from your
home directory so thanks for this one
too into that mix 4 / archives so gloves
everything from there so the tasks are
available from from X there is one small
issue with card karakas low and it is
that dark compile code
elixir we don't tell by her
compatibility between between minor
versions so we need to make sure that
when you change your elixir version we
need to make sure that it's easy to
update its application or your ex tool
right yep and we can do that by so they
say a mixed ask for a foreign soil Hicks
and so it's a URL on the X API server
and that your and that URL contains the
the elixir version and the hex API
server can examine the URL or the the
gate parameter and it can redirect to
the great text version so that we can
install it something is all the correct
version for your elixir version I also
include a list of all x versions and
Elektra versions with the register plan
which is fetched when you which is what
might be fetched whenever you do
anything with the hex and we do that so
that we can immediately tell you if
there has been a new version released so
we got a message so you will get a
message immediately and elixir version
managers are also encouraged to to swap
out the the mix the mix archives a
directory when you when you change
between Alexi versions so that you don't
have to fetch x so you don't have fresh
eggs every time that you change versions
lastly I want to talk about the remote
converter and to talk about the remote
converter we first I want to start at
the beginning from the from the mixtapes
get home
let's start out with that we run the
mixed core converter which is part of
mix and the mix from Archer is what if
you remember from the mix pile we have
the definition of pool boy alecto and
poor boy may have some dependencies and
they time I have dependencies that we
need to fetch as well so any to you so
we need to a so many do we need to
traverse the tree in a red first fashion
and we need to do sanity checks on this
tree and we need to make sure that you
have a unique set of dependencies are
not conflicting and we start out by by
getting the appendices from the mix fine
and as we're traversing this free we are
fetching the palaces and along the way
so we fetch ecto and we get the
economics file and see if there are any
anymore dependencies and we keep on
traversing and at this step we are
skipping pinks packages because we need
to do them in a later stage talk about
shortly so so 2 dependencies so you can
have two different dependencies that
turn dependent on the same dependency so
for example are a lot of libraries that
are using JSON for example so they can
depend on the same JSON library so we
need to make sure that we can convert
those two different dependencies to a
single dependency and we do that by
checking that for top of our 4G
dependency which I that de that the URLs
are matching and the a sick son where
the time are also matching and if they
are not matching kind of commerce them
so we mark them as divert and we will
error and picked a message to the user
you can fix this by overriding in the
top level and it's fine so if you know
that you can a specific version or girl
ever you can you can override that
in the mix lab so after we traverse the
decree with planning to sing a list and
we need to sort dependencies because for
elixir it's important to compile
dependencies in the correct order
because when I because we may have
compiled time dependencies yeah we might
have compile time dependencies between
the furnaces so we need to make sure
that they are compiling the correct
order so then we run the remote
converter which is how mix hoops how his
hooks into mix so we rather remote
commercial immediately after the normal
converter I would run and we run them
through the remote converter on the
Hicks packages that we skipped during
the first reversion and we need to do
this because for the remote converter we
were on up where the dependence resolver
which I will talk about more in a later
on but it basically finds a matching set
of dependencies for all our requirements
but before we can do that we need to
update we need to make sure that we have
an update the registry and the registry
is is where we keep all the packages in
the extra posit or a wall to keep their
versions and we keep their requirements
commercial requirements and the
dependencies between different active
versions and today this is just a single
in test pilot that that you Donald and
this fire is catching okely so if your
intent is down or something like that
you can still use hex so we need to
fetch an update this file every time you
run dependent resolution to ensure that
you have an up-to-date copy and today we
have slightly over 300 packages and over
3,000 package versions this file weighs
in at about 70 kilobytes when compressed
so you need to fetch the semi kilobytes
every time to run your dependents
resolution and this is going to be a
problem in the future because that file
is going to grow is so we're working on
a different format for storing the
dependencies m4 and to be able to fetch
just the latest updates of the
registries you don't which everything
every time that you run next one there's
different room for improvement where
sometimes for fixing that so after we
fetch the registry we need to run the
dependent resolution and as i said
earlier in the day dependent resolution
is what finds a set of dependencies that
are insured to to be matching and
working with each other so if you
remember from the mix thundershower that
showed that i showed there was a
personal requirement on ecto so we said
that it should be at least version 1.2
and oh and all the palaces have this
version requirements on each other so we
need to find a matching set and that we
know are assured that we know are
working with each other we do that by
first taking the dependencies from the
mix plan and we store them in a list of
the
tactical pending requests and instead to
take the next 10 days we pop a package
from the list we compare it against an
activated packages and activate the
packages notice that we have found a
matching version form if there are no
matching packages we need to backtrack
to later is it one no not only to return
to a state that we have stored earlier
but if we don't have to back like we can
activate the package so elective eight
the package is the package that we have
found a version for a few activated we
add the children of the dependency so
that the penalties has any more sub
dependencies when you tell them to the
pending list packages and I'm going to
editor that we need to resolve at this
point we save state of backtracking so
if we fail at an earlier stage we can
revert back to this stage and come and
continue instead of getting the if you
look at step two we find the latest
metro release instead we'll try another
version of the package we will keep on
going so this dependence resolution will
always find a matching set the
dependencies if it's possible so that's
good the problem with it is that is very
high time complexity I haven't seen or
heard and wanna have problem with that
the defense resolution is taken
long time today so it might work for the
future as well but another problem is
that with this with this way of trying
every possible solution is very hard to
give a good error message to the user so
for example if the if the resolution
fails its failed for some reason because
some real private can be satisfied but
it's hard to find is it a specific place
where the requirement was wrong since we
are just trying every possible solution
so we're trying to find a way to improve
this way of doing the other solutions we
can get better our messages so the last
step when running steps get and after we
have done resolution went to fetch
packages and packages are just packaging
the tar balls which I'll show shortly
and just like with the register file the
tar balls are cached locally and we will
only download them if they actually
change so we're doing conditional a
spear request so that we don't fetch
things to your cash flow clip and
packages are only allowed to change so
when you push or when you publish a
package you should test the package and
see if it works if it doesn't work a
one-hour window to update the package
after that it's that that version is
locked down and if there is any bugs you
need to push a new version
and yeah they're just lovely like I said
they are also fetch in parallel so even
without parallel fetching packages the
in my test is about 10 times faster than
fetching GG dependencies and with
parallel fetching is basically limited
by bandwidth since we're just fetching
from the from a Content we're just
fetching from a content it can be
written at work and this is what a
package tarball looks like roughly so we
have an uncompressed torbel containing a
version 5 which is just a version of the
turbo so if we need to do any backwards
incompatible changes to packages we can
eat increment this version will set the
checksum which is used to check the
integrity of the of the Tarble today so
it's a checksum of Olga other files
interval we have a meter data file which
is just an elixir source file which only
contains a map with the metadata for for
the package we are changing this file to
an hour lecture file so they will be
user for civil you sir so it will be
easier to use from from our line and
finally we have the the contents of the
package horrible which is compressed and
it was contained your project so it
contains your your source files it
contains your mix file and the
configuration that is needed to run and
to run the compiler dependency and the
reason why I source source code and not
compile code is
because source because source code is
basically easy to work with because for
compound code you need to make sure that
you're matching the bean version or the
early runtime version you also need to
make sure that you're bashing the
correct helix version and four E and for
elixir packages over yet the compile
output simply metaprogramming the
kampala it could be it could be
different depending on how you configure
the tea project and how you configure
the dependency yes this basically why we
have a source code but we are we're
planning to also support a pre-compiled
versions so if you use homebrew they
have this concept of bottles so so at
the at the bottom of it all it's just
source code but they have bottles which
are which are upon us a free coupon code
they have compiled for the different
architectures and versions that they
need to put that they need to run
against so for example for for our land
packages this could be very useful
because they guess most picker suppose
unlike packages wouldn't it wouldn't
change depending on how you configure
the dependency and you can use hex with
early today so first are we have a
standalone mix binary which is just a
nice crib which contains mix and elixir
so you can use that to to fetch to fetch
short dependencies and
you're expected ease and you can also
use mix for your other projects because
mix my class it compels eco pass our
life source code as well and there are
open source open source libraries on
github that have tasks for for example
common test for a unit and so on so you
can actually use mix for your airline
projects another problem is the mixed
file which is elixir but we are planning
on supporting the mix file as a Erlang
in a plan as well and we're also or we
want and we're trying to integrate x
with with existing to link for example
river 3 which is being developed
currently we're trying to work with them
to make them able to use a hit packages
which could be very nice and finally I
want to talk about his p.m. there which
is the API and server side effects so
onyx p.m. you can you can browse the
documentation for it so if you want to
learn how to polish packages its own you
can you can go there you can also browse
for packages and their versions and
there and check for the dependencies
they have we also show also show
download stuff and the steps for
packages and this is what it looks like
so this on a web server but registry
editor mode on amazon s3 which means
that if the web server was to go down
for some reason we can still have you
can still do
polishes they'll fetch packages and risk
X don't think that would go down this is
the website and the ability to push new
packages but you would still put your
deploys would still work and so on on
the website we will we also host
augmentation for packages because in a
lick sir we have first-class
augmentation through and what would call
here docks so in line in your code you
can you can have documentation and we
use a tool called xunit to to generate
HTML documentation from the docks and
then you can just run some from your
project you can just run mix pigs Botox
and it will use X unit to generate the
compiler augmentation it will push the
recommendation to 2x it will be
available and hosted on in pink stocks
or p.m. and this is what the other
plantation won't look like
finally I'm going to talk about what we
want to do in the future so I said I
talked briefly about that we want to
support our line projects and that could
happen to rebar 3s are working with them
to make sure that they can use our API
they can use our registry and they can
fetch it downloaded turbos and so on
another thing we want to do is support
eastridge so today when you use a
package is it sandbox to your local
project and so it so there's no way to
install a package globally I want to
support this is is installing a East be
public so firstly support that through
mix so just installing the East ripped
through through TGT jor-el which would
just like how he would compile the
Tennessee we work with a compile that
project and we will build an escape from
it but we could also support it 4x
packages I use the existing
infrastructure remix and x22 to fetch
download and install the package
and if there is if you want to know
anything more about what we're doing in
the future you can go to me too
derivative repositories for have an
initial list or discussion anything
there's also a proposal out east groups
on the core mailing list that's it I
think we have a few minutes for three
minutes or three questions that were
time for one question how much mix and
text is interested by letting game over
or banglar did you borrow some logic
from them yes 0 mixes heavily influenced
by letting it I think the guy who
started by and yet you say yeah okay
some repeat the question so how much mix
is influenced by letting on and how much
Tom Hanks will be influenced man by
butter and salt so yeah and mixes ntfs
wailea the guy we started work on it I
think was part of the developers for
lenient and for Hicks there's a lot of
inspiration from all the major and
packaged measures like NPM and Ruby gems
and mother of course actually the new
format that we're going to use with the
rip on the registry was I was taken from
from the boob jobs because they have
been issues by the registry was way to
be for them so they have some nice
solution for that so yeah yeah were
watching us thank you yep more questions
in the back
so the question is if there's if there
are any tools for release managers for
release management in in mix and there's
no support for that ecor mix but we
shape the earnest light exr m which is a
library so library which perhaps relax
it's used for generating releases so you
can just add x RM as a dependency of
your project and the task for generating
releases would be available to yep and
more questions ok</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>