<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lambda Days 2018 - Einar Høst - Picture combinators and recursive fish | Coder Coacher - Coaching Coders</title><meta content="Lambda Days 2018 - Einar Høst - Picture combinators and recursive fish - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Lambda Days 2018 - Einar Høst - Picture combinators and recursive fish</b></h2><h5 class="post__date">2018-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZDBIrJHtkHg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone I'm I&amp;amp;I I come from Norway
and I work for the national public
broadcaster the agenda for today is the
thing that you're seeing on the screen
which is a wood cutting by Asher called
square limit of course that's not the
wood cutting that's a PNG a image of it
good what do you do so what I'm going to
try to do is following in some sense in
the footsteps of Peter Henderson who
wrote a wonderful paper back in 1982
when I was 7 years old and then he wrote
a revised version of it in 2002 which is
the paper that I've read and in that
paper he shows functional decomposition
and reconstruction of Asher's artwork
and so basically all the brilliant stuff
you see here today is not mine and the
mistakes and misinterpretation those
would be mine and the inspiration for
this talk comes from the lamb today's
keynote last year wonderful keynote by
John Hughes and Mary Sharon where they
talked about some influential papers on
functional programming and one of the
papers they mentioned was Peter
Henderson's paper and I was sitting
there in the audience and I thought that
ok this sounds really cool and I think
maybe I could try to implement this
stuff in the language that I know best
of the functional kind which is f sharp
and I also seem to recall somewhere deep
down in my brain that I've heard about
this paper before in one of the video
lectures on the structure and
interpretation of computer programs from
MIT where they also discuss Henderson's
paper they don't really reconstruct a
square limit instead they do
transformations on this weird stick man
called George
and so III implemented from the best to
my understanding in F sharp
these Combinator is that Peter
Henderson's defined in the paper and
that was kind of cool and then I found
out I wanted it would be even better if
he could run in a web browser and then I
found some some good people from the F
sharp open-source community had created
this wonderful stack called safe which
allows me I'm not a safe expert in any
way but it allows me to to run my F
sharp code in the web browser so so
that's pretty cool and so huge thanks to
them and basically this is the F sharp
safe application running right now so
yeah that's what we're looking at so
it's this talk is is not an F sharp talk
and it's not a safe talk really I just
used that because that's the things I
know best it's more a talk about
abstraction and input in particular
functional abstraction in a way that
compose as well so that's sort of the
main lesson from from this talk so so if
these abstractions are important what's
the most important abstraction in this
talk that's going to be the picture and
the picture is not a collection of
pixels or anything like that in an
Henderson's paper it's it's a function
and it's a function from some sort of
box to a rendering of some kind and the
box you can see hopefully outline here
with a red vector pointing up to the
left bottom corner and then you have a
purple thing and a pink thing that sort
of outlines the box and yeah let's let's
take a look at the code so here we have
my picture type signature which is going
to be this function and yeah let's look
at what a boxes so box consists of three
vectors
the red and pink and the purple one
outlines the box and a vector is very
simple a vector is just two floating
numbers sort of outlines how far you
have to go in the x-direction and how
far you have to go in the y-direction
from wherever you're at
and I've also overloaded some some
operators that allow us to add vectors
and the gate vectors and subtract
vectors and so forth and also scale
vectors by by some scalar number so if I
scale it by a factor of two I get a
vector that's twice as long okay so much
for theory now the interesting thing
here is that um when I have a picture
like this F here maybe you should take a
look at the definition of F the F shape
is really just it's defined in terms of
the unit square and then there is some
magic going on that sort of stretches
this into fit to fit whatever box I give
it so if I start stretching this box
like changing these vectors basically
it's going to look different hopefully
see if things work yeah so it certainly
sort of magically adapts to whatever box
you give it which is kind of cool we're
not going to look at the details for
that you can see the code later it's
it's not complex in any way but I'm
gonna have to choose what we look at
right now and I also have this let's see
yeah that's the stick man George so I
copied that from from the ZigBee
lectures so so that's the picture but I
want to define transformations on that
picture and basically since I had this
magical picture that adapts to whatever
box I give it when I want to do
something like turn this thing counter
clockwise 90 degrees
all I really need to do is turn the box
right so let's try it so I want a
function called turn that takes a
picture and returns a picture but I can
create that very easily if I have a
function called turn box it takes a box
and produces another box I can just
compose that with whatever picture I'm
given and that's going to be it so let's
try it turn box yeah so how do I turn a
box and maybe we should take a look at
that so turning the box now really
amounts to moving the red arrow to the
bottom right corner and then sort of
adjusting the other vectors accordingly
and I have the arithmetic for that here
it's quite simple so that's what I need
to implement let's see something like
this and I have my turn function and
then I have only one code file per a
page or slide in my deck so turn latter
and just to show how the how the Bur box
also turns I'm going to to render that
as well so see if these updates
sometimes I have to kick it a bit see
yeah
so now I sort of turned the picture and
all I really did was turn the box
I'd like to generalize that a little bit
I'm going to write a helper function
which is going to be allow me to apply
some sort of transformation many times
if I like to so I'm doing going to
compose the function that I give it 0 to
n times so yeah I'm going to do
something like this and if I composed it
zero times it's going to be the identity
function with just nothing right so I
can do the turns which does turn n times
now I have I can do something like this
of turns up turn and I didn't oh I can
just do this to turn the box two times
right let's see if that works
hopefully it turns twice yeah okay so
that's the the first picture Combinator
or transformation really very simple
now flip I'm just going to take the
picture and do this basically and again
I can do that just by manipulating the
boxes so I'm going to create similar to
before something called flip box which
is just manipulating the vectors here
even simpler than before really and I'm
going to have a flip function which is
just composing the flip box function
with the picture I gave it okay let's
the flip
and clip box just to see what's going on
let's see yeah
and of course flipping twice is just
going to give me a original picture back
so there's no point in doing that
instead let's do toss and it's not
called toss in Peter Henderson paper
it's called rot 45 but it's sort of it
it looks a little bit like tossing
something up in into the air and if you
if you look at the arithmetic here you
see that the new a vector the red vector
should go to okay a plus B plus C or
maybe you don't see that B plus C cut in
half so da the red arrow should point up
here right so okay yet another a
transformation of boxes and okay and
just to avoid making mistakes I'm going
to copy this and this is now my
specification yeah a plus
and B plus C divided by two and finally
this and yeah I need to do this again
okay and throw this up into the air and
actually I'm going to leave the original
box just to see clearly what's going on
so I'm gonna draw two boxes now see if
this works yeah so you can see what's
going on
that's the original box and the box when
you throw it up into the air so that was
toss which is the final sort of simple
transformation we're going to do now
we're going to try to combine simple
pictures so I'm going to define a
Combinator called above which just puts
one picture on top of the other one so
let's see actually I'm going to start by
a more general function called above
ratio and the thing with above ratio
it's going to take weights that you sort
of assigned to each picture so the above
thing would just split it equally in
half right but you can can imagine you
want to have greater share for one of
the pictures
and above ratio what is going to produce
is a picture and a picture is just a
function from a box to a rendering so
it's going to be a box and then I'm just
going to compute the fraction and I'm
going to assign to the first picture so
that's going to be a float M something
like this and then I'm going to split
the box I'm given according to that
fraction and when I'm done with that I'm
going to pass the first box to the first
picture and just append it with whatever
I get from passing the second box to the
second function but I don't have this
split vertically function yet so that's
that's something I do with the boxes so
split it vertically
yeah and that's going to produce two
boxes while the top box is for the first
picture because that's going to be on
top of of the second picture so I'm
going to have to move that upwards and
how much all I'm going to have to move
it with as much space as I use for the
second picture and then I'm going to
have to scale it also according to the
fraction assigned to the first picture
and then the bottom picture is going to
be I don't have to move that because
that's going to be in the same place but
I'm going to have to scale it and yeah
basically just return these now I don't
have these implemented yet see it's very
simple to move something here I just
have to add the appropriate amount of
basically going up
and yes scaling vertically so that's
just going to be scaling the vertical
vector and leaving everything else
intact so that's what I need for above
ratio and then it's very easy to define
above because above is just above ratio
with equal weight given to each of each
of the pictures so let's see here okay
above so I'm going to try to put the the
F letter on top of a turned version of
the F letter and just to see what's
going on I'm going to call split
vertically once more and just split the
box in half so we can see what happens
see if it works
seems to work and of course I can keep
doing this so so what happens if I do
okay above and then something I I turned
this letter two times right well if I
want to see what's going on I'm going to
have to split the lower box also to see
what's given to each picture here
yeah something like this but it's
important to remember that these boxes
that I'm drawing those are those are
just sort of helper lines to understand
what's going on what we have here is
really a picture a single picture
composed of these three days three parts
so I can treat it just like any picture
so I can say okay I'm going to take this
and I'm going to turn it and what I
really pass to that picture is this box
the original box let's see what's going
on now yes I can
I can treat it just like a picture and
yeah so that's that's above let's see
beside is very much like above so it's
above puts things on on top of each
other
beside puts a picture to the left of
another picture so we can sort of it
should be very easy to implement so I
can just do the exactly the same thing
I'm just gonna steal this say okay it's
going to be beside ratio I'm gonna split
the other way and yeah beside side yeah
I do need to implement this though so
the left box this time I don't have to
move this one because that's sort of
where the original box was but I have to
scale it oh it's not vertically it's
like this and right and I have to move
this one
okay left and right a little bit tedious
this now move oh just like before but by
adding it to a scaled version of the of
the horizontal vector same thing here
yeah F times B and we should be done and
let's see the side ratio and might be by
side page so say flip and hopefully we
see something flipped and we don't so I
have to kick it sorry I think it's
something about the timing of when I
press ENTER and save and stuff like that
it sort of comes back to bite me at
times well there we go so that's beside
and yeah we spent 20 minutes it's sort
of like half the talk and this is where
we've gotten to it's a sad thing but the
nice thing with these abstractions is
that they compose very well so at this
point we're ready to sort of leave the
low-level
world of vectors and mostly boxes behind
and we can define higher-order
Combinator's using the stuff we've
defined so far so nest next Combinator
is courted which is to create a corded
out of for pictures and a quarter is a
2x2 grid it is let's take a look here
it's basically this right you combine
four pictures into one so I'm going to
need well let's see
I need a quartered function this was the
wrong file this is the correct file and
it's almost embarrassingly easy to to
create caught it because now I have
beside and above and I'm done right
I just squished what I call the
northwestern picture together with the
noir Easton one into one and the
southwest and the southeast and place
them on top of each other and that's it
let's see
North West thing is going to be the
stick figure Southwest southeast now
let's see if I can if I can recall the
transformations to create the piece of
art that was created in the six P
lectures let's see the works I think
that's the same thing double check tank
is the same thing it's same weird thing
so that's that's pretty cool we were
able to take four pictures and combine
them into one mmm but the really really
cool thing about this is that these
function abstractions have this property
that they're closed under the means of
composition and what that means is that
when I've created a picture like this
one it's still just a picture right so I
can sort of keep composing arbitrarily
more complex pictures with very little
effort so I'm going to try to do
something like that
I have a picture called blank which is
basically renders nothing within the box
that you give it oh well it's going to
be accorded obviously so accorded of a
blank and then two pictures in the blank
again and I'm going to have something
that takes a function that takes a
picture and just creates a accorded of
that picture so let's see what we can do
with that I'm gonna pass my original
quarter to the pattern and then I'm
gonna two times apply this QQ thing yeah
I think it's lying to me with this koi
glaze
sorry
it should be you're absolutely right
thank you it's not lying to me it's yes
so it's very easy to create well not
necessarily the world's most interesting
image but at least more complex than
what we had before
next one is very similar to a quarter
it's a no net which is a 3x3 grid so it
takes nine pictures and create one
picture out of it and that's basically
the skeleton that we're going to use for
the square limit so the square limit is
going to be a no net of some kind ah
let's see no net right so the known that
takes nine pictures and creates one so
obviously I can do this and in a similar
way as the quartet but I'm going to
generalize a little bit so I'm going to
create a recursive function called row
and that's going to be a function that
takes a list of pictures and sort of
squishes all of them together into one
so if I get I give it no pictures then
it's going to be the blank picture if I
get it at least one then it's going to
be well the side ratio and then I'm
going to allocate one space to the one
picture and sort of as much space as I
have elements left in in my list of
pictures so something like this and just
call myself recursively and I'm going to
exactly the same for column that's going
to be above ratio and called column now
if I sort of structure my data a little
bit
let's see
yeah like this so now I have a list of
rows so I can sort of map the row
function over that and then I have a
column of pictures basically so I can
just pass that to column and then I have
mine own that let's see if that works
it doesn't I'm going to kick it again oh
let's see yeah so nine pictures turned
into one and again this is my nicely
composable thing so I can create I don't
know how to call this but something like
this I'm gonna just replace the middle
picture with the picture that I give it
so I can do yeah zoom so I'm gonna zoom
in three times on the middle picture in
a sense and we have something like this
right and yeah we're still haven't seen
a single fish but it's time to introduce
the fish this is my attempt to reproduce
the fish as it looks in in Henderson's
paper and I'm going to create a
combination called over which just
renders all two pictures it says here
inside the same box I'm trying to just
generalize it and take a list of
pictures and draw them all inside the
same box it's quite similar to above
innocence so over and given a list of
let's see twice a P and it twice turn P
/ take a list of pictures and it's going
to produce a picture so that's going to
be a function from a box to something
and basically I'm just going to do
collect over the list of pictures and
pass the box to each picture and then
this collect thing is like flat map so
it this is going to produce a list of
stuff which is my rendering and then I
have to squish all of that together into
one rendering ah yes so let's see
so fits nicely with itself so it's I was
some some thought was given into
designing this fish now I'm going to
create something that Peter Henderson
calls the tea tile which is one of the
sort of basic building blocks in the
square limit and tea tile takes well a
picture but it's going to be a fish like
I might as well call it a fish it's
going to use over but it's going to add
two more fish so it's going to add first
it's going to add a north fish which is
sort of placed on top of of the first
fish we can see we can try to see how
that works out t tile
and
see
there we go so that's the north fish but
we're going to add one more fish which
is going to be the Eastern fish
let's see victories and I get the
eastern fish by turning the northern
fish three times
yeah okay so that's the tea tile that's
one of the fundamental building blocks
for the for the square limit and then
the second one and and the second and
final one is the U tile there's just two
of them the you tile looks a little bit
different so yeah it's going to call
over and it's actually going to take the
northern fish it has that in common with
the with the T tile but it doesn't use
the original fish instead it needs a
western fish which is turning the
northern fish and it's going to have a
southern fish and eastern fish as well
basically just adding one more turn to
each and I didn't let's see I'm gonna
have to call the guitar as well see what
it looks like yeah it's for a nice fish
and you can see that two of the fish are
actually the same as in the teeth ow we
will replace the big fish with two
smaller fish now I said that the square
limit is a no net and it consists of
nine pictures before those are sites so
those those are going to be similar
before those are corners also similar
and then something in the middle so
we're going to do the side first and the
side is going to be a recursive function
let's see it has a different dijeron
that the generate case it's going to
return return a blank picture
otherwise it's going to call itself
recursively and it's going to use T tile
also
and then it's going to be accorded but
what are we going to put in here are two
instances of the or the recursive call
to side that might be blank for the sort
of the northwest and northeast picture
and then it's a turned T tile for the
Southwest picture and just a tea towel
for the South peace victory yeah see do
the boring case first we're going to
have blanks on top just to see what's
going on so we have sort of day you can
see the turn T tile there and you have
the the regular T tile but it's more
interesting and once we start to use to
do add layers of recursion because
you're going to have exactly the same
figure apply it on top of each one of
those right and then you can keep going
for as long as you like seems reasonable
and then yes the corner is quite similar
to the side so corner I'm going to do
the boring case again it's just
basically no recursion
yeah that's another recursive function
and there are actually two cases of
recursion for corner so it's gonna
recursively create a corner and a side
and again for the base case it's just
going to return blank pictures otherwise
it's going to call itself recursively
mmm
it's another quarter so to the northwest
we're going to place another corner and
on top to the north-east we're going to
place a side and then we have a turned
side and finally the Ute I'll see ya
it's missing equals and it's not called
fish it's called P let's see if we get a
corner it's going to be a fish a boring
corner in the beginning that's just the
utile we can add so it's going to be a
side on the top and a side on on the
side and another corner in the corner
and we can keep doing that as well for
as long as we like and with that we
basically have all we need to let's see
yeah create the square limit let's see
so the square limit is consisted of
corners sites and something in the
middle
so northwest corner is just the corner
to the northeast I'm going to have to
turn the corner three times something in
the middle is just another ute I'll see
if I can type this correctly but you can
see it's just turning the sides and the
corners of varying amount of time and
it's a no net so like this and let's see
this should give us the square limit
this is my replica of Henderson's
replica of the square limit as an SVT
but it's oh there we have it just takes
a little bit time because it's the SVG
is turned large that's sort of the the
thing so this is this is very cool and
you can see that structure wise it's it
really captures the essence of our
various work of art the only thing is
that you okay you can see it's the
fishes they're not quite the same they
have the same shape they don't look
exactly the same so I was wondering if I
could do something about that
so I tried to do something so I created
created another fish with essentially
the same shape this one is a white fish
and then I added something called a hue
or color so it's yeah and instead of
boxes or I created something called a
lens it's not a functional programming
lens it's just a box and a shade of
color and the U is black-ish or grayish
or whitish to really sort of represent
three different kind of states of color
for a fish so this is essentially the
same code I've just written but just
with this additional thing where you
have a Combinator that lets you change
the color of a you right so I'm not just
transforming the box I'm also changing
the color
right so I have I have a new definition
of picture that takes now a lens which
is just a box and au and and produces a
rendering out of that yes so with that
it should be if I give it a little bit
larger box
I had this riu function but I can call
on my fish and it's it needs to be a row
right we have this row function and this
should give us three versions of the
same fish and using this we should be
able to well create it's a little bit
sluggish now another version of a square
limit with these three fish which is
really just the same fish with different
coloring see
so another version of square limit let's
see if it works
come on
yes
and that's basically what I have thanks
when I think that was the best example
of life coding I've I've attended at
least oh thank you I think we have time
for one question if you're interested
I'm not sure if I'm online but so the
code is here so a safe - fish I'm going
to post the github a link on Twitter I
think so
if you're interested you can download it
I have a bunch of branches you can sort
of check out at different states and
sort of live coding through it so that
was in case I was going to screw up
something majorly okay I see there's one
question and since you have time for it
I'll just pop over
no kittens there are no kittens um it
would have been a catastrophe to have
kittens here I think do you know of any
similar work using constructive solid
geometry I'm sorry
using what constructive solid geometry
CSG ah I don't know what that is so I'm
going to say no unfortunately okay but
if someone could tell me I would
absolutely be enters interested but so
know presumably it's the same sort of
thing but in three dimensions yeah
yeah a three three dimensional version
of the same thing yeah I think there are
people working on some seriously cool
stuff but I'm not familiar with it no
okay so let's give all right did you
think about fish design so to say
because there are certain constraints
that have to do with the way you rotate
etc so obviously a sure thought a lot
about it
there are various tessellations that you
can use to sort of fill a surface like
that I was looking for alternative
shapes that were equally interesting I'm
not sure if I found them or at least I
didn't quite know how to adapt the
approach to well the fish is in some
sense a confined to a triangle right and
then you have some variations that it
makes it fit nicely into itself but yeah
I was looking for it and I have done
some simple things with simpler
tessellations so you have like a lizard
shape that's also actually created that
you can use with some of these
transformations
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>