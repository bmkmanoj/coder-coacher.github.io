<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Kris Jenkins - Types As Design Tools | Coder Coacher - Coaching Coders</title><meta content="Kris Jenkins - Types As Design Tools - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Kris Jenkins - Types As Design Tools</b></h2><h5 class="post__date">2016-11-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6mUAvd6i4OU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">if you were in either of those
dependently types talks this morning and
you felt that it was going over your
head a kind of space level altitude then
we're going to be cruising at a lower
altitude today I hope that's good for
you all I'm a big believer in small
stuff adding up in programming right I
sweat the details because the devil is
in the details and certainly the bugs
are in the details right so I like to
look in the small and see how that can
build up to the large and that's what I
want to talk about dope makes a bit
larger click please read those two
messages as quickly as you can
it's tricky isn't it let's add syntax
highlighting can you now read those two
messages you probably can but by adding
in color it makes it easy to pull up our
two different messages right let's go
from that into Java and have a look at
our friend because you can't always use
the abstract proxy Factory beam which is
everyone's second favorite thank you I
won't be able to meet that being in a
pub anymore without being embarrassed
here is another type signature from Java
land of course again it's kind of hard
to read because you've got a couple of
messages going on at once right we add
in syntax highlighting that's what we
all do and it becomes a bit better to
read but in some languages they take a
different approach in some of the IDE we
separate out the type signature into the
concrete and the abstract that's what
happens in the ml family of languages so
you've already seen that an interest
today Haskell pure script Elm I want to
try and convince you that this is not
just a matter of taste or style or
syntax pulling apart the abstract from
the concrete is technology in itself
these are the real for me this is a step
forward in programming
because you have the ability to consider
a function just from its type signature
and start to think about what that means
the design of your system I want to give
you some examples about considering that
thinking about it standalone as a
pointer to where towards where your
software can be better
so crash course in reading these for
anyone in the audience that can't quick
show of hands who is happy with Haskell
Elm pure script okay so for the two
people left in the room this is saying
unless my ladies are working yeah so
this is saying I've got a function
called repeat it will take an integer
and something and return me a list of
some things right just from that on its
own without looking at the
implementation you can start to get a
sense of what it's going to do it's
taking a number giving taking a thing
and producing a list of things a
sequence of things you can start to get
the sense that yes this is probably the
right shape of function on an abstract
level so I do most of my work in front
end own programming so let's start with
a problem I see all the time in the real
world I would like to
what this is saying is if I omit this
magic series of HTML then I will get
this on the screen right and the code
looks like this this is if you've ever
written a few of these in a real project
eventually someone comes up with a
helper function that looks like that
it's very simple you just get the magic
class names right and it renders the way
you'd hope the problem with this is
we're being too vague it's a really
really general function because it takes
a string and returns another string it's
about as broad a function as you can
imagine and this will go wrong this will
go wrong in two ways that I see all the
time oh that's very yellow is that bit
better
sorry okay hang on if this was
statically typed none of this would
happen hang on here we go I am going to
do because I commented it out that's why
it's okay so this is a problem I see all
the time when you call this function
someone gives it a typo so the class
name is wrong so it doesn't render the
way you hoped right
straightforward error this is another
one so someone says oh well let's
abstract user to be a variable and then
we can't get the typo we can't make the
typo and you end up with this lovely
thing because people forget if you've
called icon already or not I've seen
this in the real world and so you end up
with a class name which is glyph icon
glyph I can glyph icon glyph icon user
which is just and it breaks the front
end and that's where you get really
embarrassed because your users see you
not being as competent as you wish you
were but to go back to this slide I
didn't even need to see the errors I
didn't even need to see the
implementation I think you can tell
something's going to go wrong from this
function just by looking at a type
signature
this is incredibly vague this is this
saying any possible string in the
universe will return any other possible
string in the universe there's no
specificity to this at all you know it
could take the documentation for angular
and return a Kafka novel so how can we
tighten this up string to string that's
not what we really want to do what we
really want to say is give me something
that means an icon and return some HTML
that we can render this is a much more
specific function here's the
implementation detail but it's really
about tightening up this to this now
it's actually very hard to get this
function wrong now it's very hard to
call it with something that makes no
sense and it's very hard for it to
return something that won't actually
produce what semantically we meant we've
gone from this universe of almost any
function with satisfy this type
signature to something that's very
specific if we get the implementation
right we'll use it correctly from now on
that's a very nice property to have so
the point here is the type signature was
telling you there's going to be a
problem of generality and is its
correcting the type signature that
outlines what the solution should be as
in the other direction try to can tell
you when you're being sorry go back so
I'll give you another quick example of
that this is one that's real-world codes
I've seen in other people's code as well
you've got a URI coming in from a single
page web app and you have to convert
that into which page we show the user
this is probably how you'd end up doing
in angular something like that and again
it's a string to string function the
difference here is the strip the string
that's coming in is coming from the user
so legitimately it can be anything and
it's the return type we need to tighten
up now this becomes something is very
hard to get wrong at any point in your
program
so we can tighten that up by looking at
the type signature first and asking is
this specific enough on the other hand
oh you all know this you're all Haskell
programmers I'm going to tell you anyway
so as a bonus to doing it that way the
compiler can now actually help you it
can look at rendering code and say
you've actually missed a case I can I've
narrowed down from the universe of
possible strings to only four
possibilities and the compiler can say
well you forgot to deal with one of the
possibilities which is really nice
whenever you've used a website that
forgets to have a proper error page you
know that's very common on the other
hand instead of being more specific the
compiler can help us be more vague more
general for instance I wrote this code a
while back it's a helper to display HTTP
errors if making a checks request and it
goes wrong this is a helper function
that just spit it out in a nice way with
a title and an error right but it
occurred to me maybe I should comment
out the type signature which is
beautifully unreadable and ask the
compiler well what does the compiler
think about my type signature because
it'sit's nice to work in a world where
the language itself has an opinion on
what your type signature should be so
instead of deciding ourselves we can ask
the compiler and this in this case the
compiler says if you give me a string
this this code really has the type if
you give me a string and anything I can
produce HTML so it's saying don't be so
specific there this can be actually
anything and the code still works so
there's a design choice to make do I
want to make the type do I want to make
the code more specific to match this
type or don't want to make the type more
general and come up with reusable tool
which is what I decided to do and then
that makes me think
well actually the names wrong I can make
another design change and this is
actually by asking the compiler what the
type of my code is I realized I've made
a general debugging view
in my front-end code so your types can
point you towards reusable tools by
showing you where there's more
generality than you thought as well as
making you more specific about what
you're talking about here's one more
real-world example I've seen in code so
this is some code that encodes product
IDs all right we've got a bunch of
product IDs that we need to send over to
the the far end of the world in this
particular case it was querying out for
a list of the users favorite clothes and
this code says okay I'm going to get a
set of integers turn that into a list
sort that list encode each item as an
integer and encode that whole thing as a
JSON list and then I can spit it over
the network but looking at the type
signature again there's something
there's something it's whispering to me
this type types often whispered to me
and this one this one off this one says
whenever you've got code that says
here's something about collection and
the specifics of the content to that
collection you're almost always doing
two jobs at once you're almost always
saying something about sets and
something about integers which could be
teased apart so in this code we did
tease it apart we said if you if you
pull out the integer part of this you
end up with something and then if you
pull out the integer part of this you've
just got something that transforms sets
into JSON values and doesn't really care
what's in them and then we can make our
Product ID encoder as a simple function
of that the type signature gets more
complicated but we've got a reusable
tool just by looking at this set type
here and seeing what can be pulled apart
and then we go and grep through our code
base for places we've used the far too
specific type and reuse the tool because
grep still an engineering tool so
there's a couple of simple examples
where you can look at the type and think
think can I be more specific can I be
more general and can I be less coupled
so those are just looking at the type
signatures for functions let's have a
look at some types they type signatures
in models which is particularly
interesting if you live in a mostly
JavaScript world like I do where there
isn't really a way of talking about the
shape of data not in the same way there
isn't something like a more pure script
this is something you see a lot in
JavaScript land so I want to load a list
of people from the server so I'm gonna
hold a list of people and potentially an
error and I start off with my list being
empty and my error being the empty
string and this Inever this this there's
something weird about this and you can
see the symptoms of it all over the
Internet as the bug where you're shown
you have 0 users until the load complete
right or you'll see this on the Twitter
client most the web Twitter client will
when you load a tweet it says you have 0
tweets and then half a second later it
pings in to the correct number because
it started with the empty case as being
a default but you can see there's maybe
a mistake here just by looking at the
types firstly error is a string that's
desperately vague let's make that more
specific that's something we did at the
start string is generally a terrible
type unless it really can be any
possible string in the universe but
another problem we have here is we're
saying that it's valid to have a list of
people loaded and have an error at the
same time what does that even mean if
I've loaded five users and I say
work error that doesn't make any sense
it's meaningless and that's going to
translate into someone writing a view
that displays both at once or just
doesn't add up doesn't make sense to the
user and you ask well how can I fix that
the expensive way is to let your users
tell you that it's broken the slightly
less Express expensive way is to get QR
QA to tell you the slightly less
expensive way than that is to be
disciplined about unit tests but the
cheapest possible way to fix this is to
say this data model doesn't make any
sense
you can just say we can introduce a type
that says it can be one or the other but
not both and I'm lucky because everyone
the room knows enough Haskell I don't
have to all I have to say is that this
is Elms either type right everyone's
gonna be happy that this isn't either
and we've constrained the model down to
only some states that make sense um I
would actually go even further than this
because when you first this is saying
that either we will have an error or we
will have a list of people well that
doesn't make sense either we can keep
looking at the type and say can this can
this represent a sensible world well it
doesn't because when we start we're
either gonna have to say we've started
with an error which is nonsense or we're
starting with an empty list of people
that's not true either when the app
first starts we don't have an error we
don't have an empty list of people we
have nothingness we have to find a way
to represent that so okay introduce a
maybe type and maybe a reserved a result
of blah but I think there's a better way
to model this and I think this works
really nicely for single page web apps
that kind of world I spend a lot of my
time in we can say okay let's use the
type system to model what's actually
happening with a web request when we
first start we have we have we haven't
asked for any data then there's a period
where the data is coming in we're
loading it up and then there's either
the notion of failure or success
but only one of those can exist at any
one time and it's slightly more
complicated complicated in the front end
and the back end because in the back end
you probably wouldn't worry about
loading state you just wait for the data
to come in but in the front end the user
actually cares about a loading message
so we can model this whole thing as as a
kind of a process not the dependently
typed process named Edwin mentioned
early earlier that would be nice but
even this is a massive improvement on
the chaos of JavaScript land we can
actually say that there are defined
States and only one of them can exist
and then again we can go to the compiler
and say I'm a very disciplined front-end
programmer I'd handle both the success
case and an error that counters our
programming I'm afraid
you
so you end up with a system where the
compiler will drive you towards a better
more useable user interface which is
nice which isn't happening in the front
end so those are some front-end elvish
things quick pause and let's talk about
some more fruitier stuff you can do in
Haskell
perhaps I should pause and see how see
how you react to this Jessica
so everyone someone's gonna ask it so
I'll just say Elm Haskell some people
say the Elm is a dumbed down version of
Haskell I think it's a more accessible
version of some of the really big ideas
taken into a world that really really
needs those ideas but if we're gonna do
some fruity of stuff it's time to go to
Haskell or there any other fruitier type
systems like that filled you know any
address thank you you didn't get your
script wild unconstrained effects let's
talk about those for a bit so here's a
java database core right you can say
execute query it will take a string and
return a result set let's convert that
into the notation we've been talking
about so we can think about it if this
were Haskell I will be missing a
semicolon if this were if there an extra
code on there what this function is
basically saying is execute query is
something that takes any string and
returns a result set right but really
it's not it's it it introduces a concept
you can't have in Java which is this
function is really saying if you give me
a string I will give you a result set by
doing absolutely anything I like I it's
reasonable to expect it will connect to
the database but it might do anything
else it will probably do some logging
might connect to Kefka system for audit
auditing all the queries that run it
probably sooner or later connected to
that micro-service the only Jeff knew
about Jeff left the company six months
ago and the systems just gone down and
we found out why you know this is this
is the psuedo of monads this has
permission to do anything it likes in in
a language that introduces this concept
of how the result will be calculated we
can narrow this down very nicely to have
a look at that let's look at how you'd
actually use this you probably end up
with a function that said fetch a user
I'll give you a username and you can
give me a user by doing anything to
achieve that in Haskell we can constrain
that more usefully and say give me a
user name and I will give you a user by
doing things that only concern the
database I can constrain down the scope
the footprint of that function to you
can do anything you like as long as it's
database related rather than you can do
absolutely anything you like we've
narrowed down not the number not the
inputs and outputs but the space in
which it can operate
that's a nice constraint to add and if
you were feeling if you're feeling
really thorough and had the time and no
deadlines precious you might then say
well I'll give you a user name you give
me a user back but you can only do
read-only type queries
that'd be a lovely constraint to have
that would really narrow down what this
function means and
so this is something I did last week and
I think it's a good example of it so I
thought so question to take that to the
the logical extreme where you narrow
down this space of what the function can
do by looking at the Titan saying hang
on this is way too general I don't want
to give these permissions to this
function so the other day I was writing
something to try and download tweet it
wasn't the most important project in the
world but I was doing it and I needed an
OAuth library and the OAuth library took
some OAuth stuff and credentials and a
request and gave you back a signed
request that would let you access the
signed Twitter API and I was very
uncomfortable with this because I looked
at the type signature as I always like
to do and so this is just signing a
request for security purposes and it has
permission to delete a chunk of the
filesystem that's weird
that's really weird that we would give
IO capabilities to this simple request
signing code that needs something like
it because it needs access to the
current time fair enough
and it needs access to a random number
generator fair enough but I'm not
comfortable giving it such a wide
sandbox of permissions which is
something that monads can give you they
kind of give you a concept of sandboxing
your code so I sort of wish the function
signature were ended up and just request
a request but it can't be because I need
timestamp and IO it sorry I need
timestamp and random number generation
so what am I going to do about this
there party library that has to my mind
the wrong type I could do a pull request
I don't want to I could happen for a
different library that does it the way I
think is right mmm there weren't that
many Haskell Twitter library options I
could suck it up which is a fair choice
you know it's no worse a guarantee that
I'd have in Java but there's quite a
nice way of allowing it to keep the same
code in the same type of signature but
constrain it back down which is
I'll sure take you through the step of
series of transformations first instead
of saying I owe and sub saying this
function needs I owe to achieve its
goals say it can achieve its goals but
with anything that has the same
capabilities as IO I'm not going to do a
MTL tutorial but you can just take it
take it from me that what this is saying
is go from the pseudo monad to something
with su do like commissions and then we
do another transformation well actually
I think this is way too general I'm
going to narrow that down to I just want
this to have permission to do sino orth
requests that's what it needs doesn't
need anything more than that let's
narrow it right down how do I make that
actually work well I'll define what I'm
defining what the permissions of signing
and OAuth request are and if it can if
it can sign a request then that's good
enough for me I'm saying and I'm saying
that the way we implement that is there
are different ways to implement it lots
of different ways I'd have a different
one for testing but in the real world
I'm just gonna say issues where access
to i/o delegate it to this same library
because the knock-on effect of this code
and that's what I really want to say in
this section we can go from the library
that calls this sorry the part of my
code that calls that our oath signer say
instead of saying my fetch user request
takes a github config and returns a
request in the world of permission to do
absolutely anything without changing the
underlying library I can say if you give
me a github config I can return a
request constraint only requiring the
kind of permissions that OAuth replies
so without changing the underlying call
i've massively narrowed down what myfunc
what my low-level function needs and
that has the knock-on effect of all the
parrot calling functions not nearing
acne
getting access to this wide permission
sandbox which is nice because the
permissions you need at the low level
cascade up and the ability to constrain
it back down means that the the size of
the problem space my code gets much much
smaller I have to say given the room if
you were writing this in fewer scripts
you would have other options for how to
do that you get this bonus coin if you
know what those are
I've got to ask who doesn't how to do
this in pure skip Oh crikey I would have
guessed too and I only got one right in
conclusion and so there's a bundle of
different examples there but they all
boil down to these three points listen
to your type signatures they're trying
to tell you things that can improve your
code you know they can tell you we are
being too vague they can tell you we're
you're being too specific but they can
always tell you something if you look at
them they can tell you something about
your code stand alone without having to
consider the implementation listen to
your types because they're telling you
something about your model and that's
telling you something about the reality
you're working it in in the end so much
of programming comes down to I have to
represent the real world as a program
how am I gonna represent it and your
types can point you towards and
nonsensical states which will save you
enormous amounts of work if you fix them
today rather than down the line and in
some languages you have the ability to
constrain what the function can do to
achieve its task and that again NASA
massively narrows down the problem space
that you're dealing with which is great
choose a language that helps you do that
that's my final advice thank you
any question oh hang on do we need to
microphone oh yeah so yeah so the
question is if we take something like
this this is going from a request to a
request should it be something else I
think I think there's a definite case
that we could take this even further and
say that we should make a distinction
between a request and a signed request I
don't know what the what happens in our
oath if you double sign something does
it just does it just replace it but I
shouldn't have to worry I'd be much
better off with enriching this type even
further being even more specific to a
point where I can't double sign a
request because it no longer fits in
this function check that would be a good
thing yes and the larger point there is
there's always a trade-off between how
much do you enrich these types versus
getting on and shipping something and
the answer is in the state of industry
today is an average more
any others
yeah and well yeah I use emacs myself as
been yes the Reverend mother will like
the credentials that web supplier so
it's what signifies the city fact that
means we go
that's what I said no thanks to me so I
even say
and we also have
type arguments and thus weary finally
after saying exactly how do you narrow
down my oh that's the question
yeah so we want to end up with something
like this I guess where we'd say how to
do that as left as an exercise to the
reader right cool I'll see you all in
the pub later but figuring</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>