<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build and run successful SaaS products with Erlang - London Erlang User Group | Coder Coacher - Coaching Coders</title><meta content="Build and run successful SaaS products with Erlang - London Erlang User Group - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build and run successful SaaS products with Erlang - London Erlang User Group</b></h2><h5 class="post__date">2016-04-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SuX9L6IgOeQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah I'm stealin as you can see on
fortunately so if you've got any really
complicated girl any questions Thomas is
right there he's one of her own
developers the other one so keep on spec
um so yeah I'm going to hopefully tell a
story about what drove us float on in
the first place and they'll be room for
questions at the end also jump in
standupshots legal I respond to go
sometimes so most of you pretty well
another day to live this was killed by a
young company it's on the edge of this
in total i wasn't being over two years
the first year that were through the
lesson just really work one company so
what day to does it say its monitoring
tool we specifically cater for
operations people developers so there's
lots of motion turns out that work with
product managers and not more social
media we don't do that we help
developers and operations people write
code that then gets from normally online
business has product so what we do is is
it up or down so we pulled a lot of
stuff we also give you the ability to
pray flashy dashboards so you can sell
how fast it's get running make trends
and do capacity will i love you will put
the message into snack or tip chapel or
any values i'm always send written well
there's some unique stuff that we've got
inside things room that allows us to
rapidly create new tech scripts so in
the water development you guys are often
writing unit tests or you're writing
custom code and then you're going rights
and test to test it in a world of DevOps
and infrastructure more generally
writing little custom scripts to test
that your software deployment has worked
no is the low balance of working it's
your data is working is your paper
working as the traffic cameras will work
for the staff so we let you and create
that stuff quickly and then there's a
little bit more targeted towards yet
things so you can all the boring stuff
that you expect in an enterprise product
lots of ballgames and separating other
users can do and that sort of stuff but
the idea is it's a self-service
monitoring tool for DevOps and
operations teams running their
businesses scale ideally so as I said we
spent the first year of building and
data roof pretty much behind closed
doors and we decided it was going to be
scalable so if we can build it in a
microservices fashion no we have
basically one person using this so we
needed to build all this it's the most
important piece so we split it all out
thinking that would be infinitely
scalable and we can put as many users on
as possibly wanted and we'd never have
to change any of the architecture that
was overkill ideally so we've got a
pretty fancy editor that down there is a
rabbit bus that's like our enterprise
service bus everything talks but we did
it everything initially all nodejs back
when we started two years ago that was
like the best thing ever momonon Mongo
and the mean staff but not the best
thing and yeah so you can see we've got
a bit of mongo in there the application
database we used own react there's our
time series data base mostly because we
didn't have time to build their own and
the source of feature requests we were
getting from our customers we're not
that complex we just needed to tend
agent displayed on the graph on the
screen and didn't need anything complex
weather that we just recipes operations
first it was this can we get cpu disk
memory around things as times go on if
the features have been sort of changed
we've got a couple of mechanisms to
getting data in and one of them is we've
grown agent in fighting so we distribute
that as that devs and off Hills all
those packages that runs on the service
and that's what runs is fritz so your
scripts that will hold every 30 seconds
give us a text and send it back to us
we're all so silly enough to let people
just streaming data directly anyways
one second because they do that massive
consequence so that the use case for
that small you graphite staff to be you
guys may notice due southeast in Bali
now you mention it why does it need to
have some people and that use what was
available at the time 0 for 1 with
online through bang your soul so we did
a lot of validation I mean not not many
people like like building stuff that
night if you wanted to use so while we
were at our fresco we were building this
basically we were building this system
using open source technology so we
actually talked to about a hundred
companies while we were there and just
tell you thursday at the same thing and
it's eighty percent of time we actually
released all about graphs on a blog 80s
at the time people were setting up now
she owes for doing the poem piece people
are setting up graphite and statically
for doing the instrumentation of code
and it was the same old crap ocean over
and they would not only build that stuff
they would then go on to build like the
sequel reporting database with custom
ruby scripts a cron job to do an you end
up with what we pulled the franklin
monitor and even when you've spent six
months building this thing actually some
time they spend five to ten years
building their own thing ticketmaster
for instance of spend at least five
years while building a monitoring system
quite alert yet because it just tilted
Adrian you can query it online is it
survived its open testing there that's
got to menchies and it's really good for
learning stuff but it's not it's not the
full bit so you can spend a lot of time
on this stuff so we decided a while ago
you're probably going to have one
monitoring tool for everything you know
we go into companies wouldn't it be nice
if you go you could buy your Ella crap
dynamics deteriorate came on through if
you could buy a kingdom or a status cake
for doing your external checking and
then something for doing the laws like a
slum for help you do all that and then
you stalk this matter that's the mess of
open source and it's good up until you
get to about fifty developers and a few
hundred machines and then even though
you spend all that time on this stuff it
doesn't go by all of the databases are
available for
time series they've all got some very
nasty nasty trade-offs so not only we
had to do this we've also had to pretty
much start to contribute to a new time
since database I'll talk about at the
end pretty another angle distinct yeah
I'm trying to get more people to use it
but and that one's got less bad robots
that all the ones that exist in two
years ago Asif I'm you so knowing this
this was designed to be one of the three
you know you got a new body relative i
slunk you by dentally what makes the
motoring public no still bleeding a
little bit but then we do that custom
ultram stuff than you would normally
piece together so if we go back me this
was the first year I thought it the
first week really the first year was
made Colin and David sitting on side a
British Gas building with a use case in
mind not opened up to the public so if
you actually get the call functionality
working at the beginning of last year we
actually started to open up and get more
customers on and what happened was
obviously these are the adding
additional agents that's how we can
measure the success of data make the
more agents get added obviously the more
ready even made using the system and
you'll see what happened was we started
to get convincing people to try it and
then we accidentally sold it to two very
large companies in exactly at some time
I don't know without any much money they
just immediately I added all of their
agents at once which is great remember
if you at Beth and that was infinitely
scalable right and it's been a year
building that sits like the Ark Noah's
Ark and then the rain came and yeah
that's what happened basically nicely
bro can you manage to keep keep it from
completely sinking but that's pretty
much a fair indication all all the
comings on board at at once everything
broke you know and we've managed to keep
it running keep the data coming in but
we were in pretty much fire fighting
mode
see what happens and this has a big
effect on on your business when when
stuff doesn't work people don't like
using him especially with a SAS happen
if we were doing open source would get
one with us like people the runes of
invest chunks of time just trying to get
stopped working when you when you're
selling its a spoiler you get literally
like one go with somebody we will just
leave done so yes you get ourselves out
of that mess well we started to monitor
stuff I think probably what completely
and monitoring pitch but we wanted to
understand what the problem was so
instead of another primer to start to
monitor things we can see the issue was
mostly around getting the right into our
time series database that is pretty much
always the problem so to solve that
youth from reedus in the middle this
tends to be a common story at most
companies you get into massive skating
problems and say stick and massive cash
in lieu so that's pretty much what we
did we bought the biggest box we could
find and we start reading it and then
instead of in the old diagram having the
metrics workers pic msgs up from
RabbitMQ and put them directly into the
database we start read this in the
middle and we split their job in half
and then we could split the rights so
what you'll see in the graph is like a
sort of you know the realist will build
up for an hour and then the metrics work
will become wrong and process in the
material again that you can spread those
and cash flows rights instead of having
it go directly into react and completely
ruin the database you can spread them
out of it which the photographer's
required so you might have a worker in
ojs unfortunately wasn't the only
problem even though we were adding these
workers and available and you know we
had a mechanism for solving the fire
problem without in a single point of
failure you know rii this is is not
particularly a great solution you need
to put a lot of effort into having
multiple realities and build basically
rodent resiliency and
into it and adding just a single memory
box and remove losing readers we lost
like an hour data if the box lies and
that's not cool that staging probably
get back again so in addition to that
that was fine that was buying this in
time but I'll nodejs workers let's just
start to crash like for no reason it was
really hard to work at what was going on
with him there's this magic limiting no
Jess of 1.5 gigs of memory where if you
go into a box and look at the supervisor
it'll get up to that one gig and you'll
just have to chrono restart so we have
lots of conscripts the pulses that would
look for the memory and just kill them
yeah memory management was it was an
issue we couldn't really work out what
was going on inside the process we can
inspect it in an easy way there was
other craziness going on with flame
drafts at one point and we found this
new tool online that would let us dump a
lot of the node stuff and that would
play but narrow it down to some lively
that we pulled in but you know most
likely about 500 it will filter out so
so those always something wrong one of
them we we were using Mongo and other
one starts off a more game and we were
for every metric that was coming in we
got a few hundred thousand 57 coming in
we were me to do lookups wish you need
to work out especially for alerting you
need to work out what the state of the
alert is you know it's all very well
looking at a stream of data but you need
to work out what the other of us the
alerts workers are doing and what the
current state of the alert is triggered
or mob tribute and that was putting a
lot of more than sort of pressure on a
longboat database doing like 15 60,000
queries a second on the database for the
different metrics coming in so our our
and the solution to that again was a
massive cash put this time on the box
itself and again when you're caching
stuffing in nodes memory that's that's
the worst place you could ever be really
if you lose
this type of stuff it's good for AP is
getting dating that really quickly
solution or store state in marietta pre
rubbish we also noticed that it will
start garbage collecting like a lot and
you have long pauses which I'm pretty
proud and on a single box so we were on
physical hardware and eight cores with
run eighth of these processes that each
manage the right sort of on bigger
memory that seems to be maximally going
to do it's all that efficiently then
we've got eight individual one big
chunks of member maybach SOCOM
effectively or efficiently use the form
16 or 32 degrees in the box buddy but
one process so at that point we had
enough of no Jess for the workers and we
started to look at different angles
luckily you can't see somebody but it's
the song with swear words so if you ever
did a copy of the coffee of the thing
but we evaluated quite a few and I
remember exactly the reasons but we look
to go obviously as a language to replace
the back end workers well that managed
with it tonight we're mostly interested
in the Hector library and it didn't look
like I was going to bring much for the
table you have to rewrite it and also
wasn't actual hecka it's a stream
processing library so the ice baths like
these other things I store it gives you
by inputs like filters and it does a
very cool stuff gives you like a
framework for the processing metrics
that come in and tebow actually keep oh
nothing you looked okay what's wrong
with it 11
why do you not like though 22 ok I think
the feeling was that we just like that I
know I mean we were a bit blown away by
the whole hot patch you actually going
to out the hot patch we also have the
ability it sort of go in there after
having no visibility into like no GS and
going on to bunt in the running
arbitrary commands or cup in festival
stackoverflow having something that you
could run and of exclusively scientific
go into riding the rebels called them
all going in there and actually you know
inspecting what the code is brings was
quite powerful I think there was that
feature mainly the homicidal versus go
go again felt a little bit like the
black box you've write the code you can
pie it up and then you drank in
production we'd be like oh it's broken
again what to do and then putting the
more than Prince tentative so the other
things we look at the sea I wanted to do
see actually into my parts of the world
learning to make that they're fast when
you see but probably really like 50
developers who come with you see whereas
with our language new glass honey we
looked at elixir but by that point
before this is nisha enough maybe it's
good it's going to be hard enough to
hire anybody that knows that I'm and you
know it was always an intention for
their own solutions at some points gets
to build up and we remit why if we talk
to these guys we'd need like the one
unit called elixir develop them to come
in
just say we decided this to go for
vanilla and vanilla and then and then
there was java and if your schedule you
can read some of the world's energy pick
this there's a lot of bad we all started
live from western as a tower fresco
rookies it's all based on Java to open
source there's a lot of XML thanks minus
X month alfresco so we weren't happy
about going back to Java again it got me
banned it at this company we went full
node and we said we might have a new job
at all but it looks like that's going to
cave because elasticsearch seem to be
the only good till the moment maybe
react with them the other thing with
yeah we we decided on it it's got good
memory management let me prove that it's
quite fault tolerant as well so you know
we're using supervisor to start it but
things can crash in generally product
we're also using rather to react so
obviously first course like this for
those things and the other life coach
racing was like what I think really want
however and and the fact that we've got
some guys that don't mind the yellow
syntax to me it just outside the stack
trace okay so so yeah we reread the
workers we we decided that we were going
to take the nodejs one the most annoying
on one it kept crashing and the one that
was most visible on in that suite
doesn't prioritize things by what
customers noses first I mean you can
have crashes on the other workers like
the alerts workers or whatever else and
things will just get a bit delayed the
customers won't have a very visible gap
in the graph I mean if this breaks you
know instantly so we monitor things like
metric that the time it takes to get
metrics into our endpoint to show on the
screen and then we wanted to the API to
make sure people all around the ruins
and if that headed dips generally get
complaints because like missing bits at
the end so yeah once we decided Thomas
went off on his own and and read a book
I think did you great half a book
paperwork hopefully to write for them
hopefully the right half rings program
together oh don't convince at this stage
we get anything out of this mess I've
seen her own but came back in six weeks
later we had a new worker and if did
what the other one did and they did it
better as well so we die here more
crashes or if we did is hiding a well
and we managed to reduce our physical
nose so it's always a worry spending so
much money on Hardware it'd be nice to
get there is efficient on boxes so
magical album so we have as you saw in
the initial diagram picture pretty much
all of those boxes are clusters of
physical servers we've got clusters for
the API clusters for the entry points
where things come in clusters for rabbit
clusters for react and we have clusters
for each individual work in clusters
maneuvers workers hospital metrics so we
were able to basically take our 60 miss
it handbook quite big I mean even for
the volume of metrics we were running it
seemed to be crazy to running than me
and with that with this we managed to
get it down to eight boxes so we heart
it just what good getting raised
fortunately this is loaded to ask that's
the problem of starting a company in the
class so there were 16 of those metrics
workers to start with I think at this
point we're up to 50 40 or 50 physical
servers running with it I'm still around
there because we've so we've added on
the more services so the github costs
increase just as you have already nice
and you know what scoffs increasingly
two of everything and yeah this this
half it so let's go in fact normally you
say we put this software and we rarely
wrote it in sign language and it was
twice as good and you probably say well
we took this software we just rewriting
the same twice as good because you know
you knew what he was doing it so where's
the first time possibly then I think
this time we had spent a lot of time
optimizing I think if you had a real it
in any mode it's still with me crap so
this was better so we've kind of fixed
it and then yeah so we were like running
steady now things weren't on in flames
people were upsetting and then everyone
certain actually that's for work it's
not good enough we need more features
it's nice that you can you guys the tech
metrics in from scripts and it's cool
that you guys can accept a Phi Theta but
now we've quite like a tool that the
developers can also use and that means
they want our oolitic features you know
they want to be able to do so like this
metric in this mention because these
boxes where this is this amazed that x
365 employed with boy whatever and we
didn't we hadn't what we didn't have a
database that supports the three angles
of options so we were literally using
react at this point we picked it because
something had to be stable thinking
typing so and as as men as i mentioned
before we didn't need all the features
to start with I'm so me pic three acting
it worked really well we can just add
more boxes but yeah we won't we weren't
that keen on completely writing the time
to this database
react it's quite quite big and getting
involved in the code it's got a lot of
stuff in that probably we didn't need so
we started looking around different
options open TS can be get it to Java so
van that but you have issues of peering
the data which you can fire metrics in
really quickly but actually giving them
out it does be ranging out scans across
lots of things in flux DB at the time
they've been that clustering one when
they did out clustering it supported the
sizes of one through boxes I'm not too
awful those fortunes now they've now
they've removed entirely to that put a
little in the end of our business it
would love that so we continue to look
around me if we found something there's
a guy in Germany on his own took react
cool and and used a lot of properties of
ZFS and on smartos created a new time to
database and so he had running in
production for a year you benchmark did
look like it would work and so we
started to play around with it and we
started to chat in again is turning
around that's your lot the guys have
already had this kind of feeling that we
want to do this already we like to react
but the only bit we were really using
was really cool and we quite like the
idea of it being quite a small code base
to work on its rate so we took the
decision to kind of to go with this it
is optimized for write throughput so
that kind of fixed our problem we could
get rid of readers in the middle you
just file an extra tralian it started
off really crazy it started off just
typing UDP very far and forget and
writing them as quickly as possible you
don't send metrics into it by like a
normal
debase thing like the Nebraskan face is
designed wire protocol which yeah it's a
bit crazy we took this two weeks to
reverse engineer the Erlang phone into
pythons ingredient I still didn't
understand we was doing it uses a
certain number of bits and improve vixen
it's not a craziness but yeah it's
really fast so you know it's really
efficient to send venture in it sends
things around the ring it stores the
data in a memory buffer first but when
you set the n val 23 it stores it in
three different memory buffers across
different waters so if you lose a box
doesn't matter that much because it's
going to get written to the green every
flush like we're going to set to texts
yeah so r attendance is further than an
hour and all days it's busted it's a lot
better it's very fast but our benchmarks
work is the problem with time series is
a benchmark isn't the same as another
benchmark the shape of our data is
different to the shape of somebody
else's when Hines was benchmarking yet
he had low cardinality I think he had
few metrics sources but lots of metrics
with different namespaces as I'm except
we have we have quite high cardinality
procedure for the individual agents is a
metric source it's kind of like the back
a motorway you know you've got lots of
cars bending fast very fast like far is
on there and but sometimes you thought
like mini coopers where you've got 20
late we've got mini coopers on 20 mins
like four hours and three so we had to
do lots of kind of optimizing for that
also hines i think is only using with
himself so by clearing the data out just
for one user in one battle a time it
wasn't really over optimized for the
rights so we went in there gets
optimized for the reeds we let people do
crazy stuff like credit dashboard with
40 widgets across 500 boxes and display
all the different series formed so you
can end up a thousands of euros entire
often both ways to score single quick I
mean what lots of users doing so he had
to do sensitive stuff for that again it
gives everything we needed we need some
other stuff as well but it did give us
that query language so you've got the
SQL equivalent and it gave us visit
local source it gave us some of the cool
stuff on top so there's a plugin for if
Anna if you guys have used your family
it's like an open source and dashboard
so yeah we started to play with this
we've been contributing to it Heinz is
our like our littlest poor volt
advertiser as well if the benefit
Neverland dictator and we just we keep
contributing we also do a crazy thing we
run this on linux he was a small to us
so we're we've produced pattern and
packages for Debian or booty and we use
lfs ornaments with it so there's a
doctor contain you can play with are you
ready that song yes where I on ubuntu
1204 which is the one for operating
system we found a lot of versions we go
to the city and I CSS so there you have
these views nicer native so is lfs on
linux and a zaly doesn't that break the
nagas you just in silence I think they
weren't enough bungler although yeah
although i think in 1606 is going to
comment like this and I think I vented
myself smile that I have trouble I swear
the variance
veronica rayne can see effects dkms will
fix that so when you rebuild the box for
the new kernel version it work see we
build deserve those modules when it
starts up we had a lot of thumb as an
investor in there such a blog owner and
you're right i think there are you
compatible license differences although
i think money gets your out that when
you were Bunter you just do it anymore
so they're just going to bungle it and
then move the borders later anything
problems around oh so so blog we there
with it's running so we then I put a dog
in movie there's damage even just by
Hardy say we let talking to take half of
the round of the box so 6040 brown boxes
it takes 32 and then these NFS zillow
takes the other and 32 gigs and then we
monitor it so obviously we can see how
much of that round is being being used
it seems pretty good actually when we
benchmarked it a lot with fio utility of
minutes and we were getting each of the
new boxes that we've got this club for
800 think about SSDs and we let say that
that's manageable and we benchmark it
over and over and over again change all
the different settings and did a blog
explaining which ones are the magical
ones that worked and we've got about
140,000 ioves out of the box for rights
know if it reads and about 50,000 for
rights it's by fast we want to move it
to to google cloud or someone as they
brought some boxes of 88 SSDs with a
bathroom of the sim five weeks and then
you get loads more Phoenix it's much
nicer I was dead I've stopped the
soulful open series of us we can eat
confirms that it was illegal what wasn't
yeah hopefully no you calm down I'm not
tell me sure about that though right
because that's the latest kernel headers
of LG peel and that's all you need to
link again soon so it's great who's
going to do Oracle is bubbling
scientific linux a fuzzy at best now
yeah okay it's quite doing that she's
quite mature I mean you've got that or
btrfs why you need it it's because it
uses the compression or tell if s so you
can run this in the docker container
without it but what it does is for
Thomas McCready i'm wrong but for every
single battery path that it generates it
press a file up front for the week and
the files full up of numbers it's
as the race to start with so when you
write that to the disk it starts off
compressed and then as the week goes on
wherever it gets a new point it will
update the file and over time it will
get larger but it will still be
minuscule that one okay so that's why we
use it otherwise it will allocate the
entire chunk for the week from actually
even if you look at one point and that's
quite an efficient a normal file systems
I also be the database doesn't include a
lot of the check something and other
things that you can only have a database
so is NFS gives you that it knows that
it's atomic so you can't have like
something instead of s so it doesn't
have all that complex crazy logic it
just goes you are the written wow
there's a lot of assumptions on
databases left it made it clean and so
video you can use the btrfs if there's a
problem when we end up a place for
another way this and probably notice my
less yes yes the other author be even
worse so except like that sure enough
decision dresses I don't know we never
really tested them it says in the
document try it but there were enough
unknowns removing it to limbo yeah we
need to try probably but it's working
well for us so there's legal issues
probably not
I'm a face-to-face didn't see it this
about 300 years behind in man-hours I
don't know yeah it works we care of
woman oh yes you see there you consider
Manta and join manta matter is that a
database no it's it's a distribution all
right and then avarom lane mantas a
little bit more for kind of map produced
big data a kind of jobs as opposed to
time series stuff able to look to them
we are looking at the moment for a stop
so maybe that's in the same category
because we did we get things simple let
me write it in node just to do the basic
them in probably we should really call
that node stuff the prototype because
they're quick we were able to service
the customers but now we're on to the
point where we'd like to do it properly
at scale a dark spots on prima commander
that's a that's a bit after this we the
fam is always to to do one database at a
time a theory so we've done half of this
database now so a high intelligence case
obviously didn't quite fit without us we
have to modify it so tomorrow CC Erlang
interfacing with to see to do ladyboy
support so obviously we with mitos stuff
he could always add or always determine
what the what the value is whether it's
like a bite or a killer x or whatever
else and we go so that you can use into
this butyl to say this is a hundred of
something and you know it's a buyer that
we know how to feel about on everybody
unfortunately of our data formats you
don't really get that this it's
especially the graphite you know
metric unit measure so you don't know
what it is you have to solve right
because that's what people except us so
we changed it and then obviously we
fixed it we put up with it and like it
but most things a big boy so we had to
fix it up for grabbing metrics and now
it really won't works really well so
obviously we needed a new metrics worker
again so this is like metrics working on
the three the first one being nodejs the
second one being rewrite from no dressed
up to 22 Erlang and that will work
really well so we have to rewrite it
again this time for the new the new
database so it would take hope you meant
messages drunk off rabbit it would
process and I put them directly to doggy
down there so we decided actually at
this point I'm fair because we've also
high def time to come up work with Tomas
and we thought wouldn't it be cool if
these guys could work on this project
with some senior guys have done before
so that's where we brought the lang
solutions in so they have a guys sit
with us for two months on site rabbit
very very skilled and guy Seth Thomas
Dave and kind of trained up the team and
that was we had it on our own it worked
we've got got some confidence and then
we wanted to do this one properly so
they've got some experts in and
obviously increase the team size by
third but in addition to that they
picked up some good habits from some
senior island base and so I think that
worked out really well we removed read
this as a as a thing so we know more
single point of failure so if we lose a
point about marriage and our vector and
we reduce the service again I knew those
optimizations down there so we've gone
from 16 to two now which is good it's
doing the same job but this with this
and firing forget nature as it can go
much faster we need less box a time so i
asked you guys not something a talka
salmonella
2-1 the new cool things were that they
found by working with our land solutions
versus doing online and these are a few
of the bits so lager I ask you any
different bugging you guys all use love
it yeah it's 30 standard pull up I was
very disappointed by this cuz I saw very
cool pool boy which I thought was an
amazing man panting this one's better I
dialyzer sounds medical doesn't it it's
ok that does that does type checking
quick check that sort of enormity is
actually close to top source things man
it's like a proprietary ask your eyes
open it's so yeah okay the line is gonna
pay for it i think it's it's a cubic
cubic on the clutch effective monday so
Sierra here asked Marco no check was
checking your coding Maryland okay so
yeah that's something we find started
tesco for his dedication just go along
so that's billion those commercial few
items for a source project so that's
what generates your test symptomatically
from code so right sounds intense useful
rebar three it's a packaging stuff I
guess for putting stuff in packages of
Casey reponn I never stopped that works
I give up Dave say I'm feeling Starla
patty he uses that to go into the ripple
to trace what code to do so that's what
gives them the invisibility that's how
he's able to fit stuff and also we had a
date he can't be here tonight them I was
a big improved the other weird thing
that we did was obviously we need to get
the data from the old database into the
new off so obviously is like my having a
big cluster it is not a danger in it so
we were able to save at a time by
reusing some some JavaScript code that
we've already written so obviously have
the ability to to get danger in and out
the old database we wanted to reuse that
same code for putting out interface with
the other end code so npm install node
or elastic and that was then able to
load up your leg code and bury it uses a
safe interface the ports one rather than
the myth and os that saved a lot of time
and we might go into one organization
get the data late of it we actually do
it we already do a cool thing so one
thing I've got I didn't mention that
your architecture was if you imagine
you're sending metrics in in the stream
at one second at a time and we're taking
it and putting took you and your
processing it putting to cash and
processing it again putting into the
database you've got a fair amount of
time between that happening and being
saved so what we do is part of the
metrics worker is we will also detect if
you have a dashboard open and we will
fire that same metric as a split into
your browser or a web socket so and then
the browser will merge the points so
what you're seeing is when you have a
browser it will load up pull all of the
historic data from
storage in the old days that we pull it
from long-term storage and short-term
storage so some of it the last hour
would come from read this beyond an hour
from from react and then whatever it was
comes in now since the time the days of
the dash was open and the metrics coming
end of the point directly over lips of
here so emerging three things together
and do people eat let's call this is
time citizen probably have a different
points for different numbers this one's
going to be valuable so we just move
this stuff we hadn't in a fourth so when
we added in in the database it would if
it was a case of adequate service we
could run it in parallel and it would
pull from four sources instead of three
did you pre cut all the points so by the
time we were done with the vibration we
just turned off the old source and
noticed anything which is quite a nice
thing to do made my life easier so what
is it look like today we've got better
at diagrams that house a little bit
blurry you can't see much on this but
it's very similar Thomas we've got da
gdb and which obviously talks to the API
and we've got a console which is the web
browser bit that's that also got
rewritten or someone happy useful right
in the back in there
in the act like mice on doing nowadays
we're still using rabbit as us and for
the matrix come again we've obviously
got a better job work that sort of
spilling things out but the main thing
is we've rewritten that matching to work
with you saw the call of the day to move
sometimes and we monitor it a lot and
keep an eye on performance and these are
Nashville's obviously we've got to the
stage now where it's pretty it's working
pretty well got there is it's fast it's
good it runs on linux participa so what
are we doing next well we haven't done
anything else on our line yeah we've got
all these other the metrics workers
there are about 13 different many types
of workers and I guess I'm going to be
worth one so we need to it would be good
if we could convert them they're not
causing us a massive headache but it
would be forwarded the Batmen team just
have you know the common set of library
shared between moved over we're getting
asked more and more four dimensions in
my world people doing crazy things I'm
moving two contenders doctor and what
you're another is instead of it being a
single sort of thing that you monitor
you monitor the thing but it's got South
things and you need to know our
dimensions key value pairs to the stream
know you'll get a metric coming in your
mind attack the met in the metric move
like regional us best one dynamically so
it doesn't do that yet we've got
functions we've got a query language
it's better than before it just doesn't
have this other thing so what we were
twins Heinz about was actually having
another service so doggie DB is actually
two delphinus duties is to services
already it's the back end which is react
poor and you know the ring and a bunch
of stuff the way of getting a daydream
by the wire protocol and then there's a
front end as well which is which again
is also a rank but that's y se that
serves up and access the query input so
you can scale them independently you can
have lots of query nodes lots of back
end nodes the plan for this is probably
to create another cluster and use react
apt profit and use that for so many key
value
metrics and then have the front end
connect up to react a B and use that for
the queries and I have optional so that
when you're doing a look up at metrics
or storing metrics it goes off looks up
what it is that needs to pull back and
then twisted about me to do the pulling
of the data makes that we always removed
one single points of failure people
rather like rebooting rather basis if
that we draw straws for it we need to
turn off and turn back on the right
order for it to work there's a mr.
peculiarity and they're not where most
of the other service is now sort of
clown scale we've got away with a lot of
this by running on physical Tim and then
I get rebooted sorta but if we were to
run rather than amazon and they come
along to decide one day just to turn off
that pauses a bit of disruption rabbit
so it will be working with urban
solutions or something to try and make
grab it a little bit more simply you
know so i can go on there and run happy
hour road accident mean distort
destroyed with not trying get rid of it
i think so we're really using the queue
so i guess the more of this story is
we've tried to stick to the minimum
number of technologies for a start-up
and often that's bitterness and we've
hung on too late we went from ojs across
the board for everything and put it off
too long moving to a better technology
it was more suitable it's the same way
through rabbit stuff as well we're doing
two things with it we're doing it's a
it's a service bus and it's a pub style
for messages metrics a better solution
for the pups oncoprotein Kafka is that
that's designed for it except java the
battle probably probably will before you
will install it but also we didn't fancy
running another service something that
we don't they'd have to become an expert
in and that's the problem with this
stuff whatever you install you have to
an expert of it so you know we want to
keep it small it's doing everything
right now you'll probably end up
expanding that because we're using quite
a lot of the features in rabbit for the
routing but we've got exchanges and
we've lined up to it it basically
usually like RPC over the rabid stuff so
it's a better often wide attend
conferences you see the madness of
zookeeper and HTTP api's and service
discovery and all of the complexity that
comes with managing something that way
instead of a rabbit books and they just
bind and they just get sent a message
and they miss a lot of topic and just
get the message you have and craziness
so we like that about it as I say we
just it would be nice if that Enterprise
Service bus was foolproof like to the
box and not worry and possibly for
scaling split out the tops of just for
the record messages that I've got your
prints were like you got a should get
them along and keep your learning
possibly yeah they're so we've got kind
of another rule that pathology I can
really want to drop one thing at a time
and I do end up like for the we also
need another database in addition to
this one because we need to be able to
store like events so for that it's not
time soon as day to really start
cleaning value parametric partners
mention and we were again thinking about
you know could be build something
ourselves and you kind of come to a
point where you want to you want to pick
up some services off the shelf just do
the way you don't have to modify and
there will be some other things that you
can't get like the features of the time
series data base out there there are
many of them they're all crammed so
we've got a good one and that's kind of
our life blunt or we will continue to
iterate those features in the database
and added moment
histograms add all these things that
people asking for we don't really want
to be in the business of modifying
everything we could draw like an amazing
Hugh service but we probably well when
you get to the size of link then you'll
probably built in the old everything but
for now the United if we can have a few
things your school something that looked
after yeah oh and we're time all round
about this so if you guys looking for
jobs but if you are talk to Thomas and
yeah pretty some will help with this
stuff on this thing most of our staff my
eyes only so the back in workers soon
will be all along the obvious of the
database we continue to contribute to
downloading the levels Republican and
just keep helping out with that there
are the additional services were
building in beauty reactive and there's
a different team with those were mostly
outside
very recently we did actually we got
onto the trial think it was literally
that week we were looking to investigate
and Andhra God and that'll give us a
copy Polly another flavor there and it
was reasonably generic like it was
another one of these things where an
annoying it was quite big and solved a
lot of use cases and probably pretty
good a bit events and stuff like that
get a load of things and the problem we
had was we a lot of these things need to
be split after setting and it wasn't as
fast as this this one thing so the two
votes that really wanted were robustness
the fact that we didn't have to keep
firefighting customers telling this
their entire services now and
performance you know right performance
and this did what wood floor helped set
it right focus on absolutely this would
be like a million listed like a million
metrics per second single box you can't
get even near that perfect on anything
else so this is much better but it
didn't have as many features so now we
can obviously have to go and build other
bits but yeah we can suffer we could
suffer laughing our main concern was to
get rid of that previous box have a
decent database with metrics that's
pretty much that's the entire thing that
anybody have any questions so assuming
you looked at influx take me in the last
few days seem to be right
sweet yeah yeah how would you compare
and contrast that seems you anything out
there that looks it does and they kind
nuked it as well for us because they
just removed the clustering support us
this week pacemaker be costly might they
might change their mind so I hope I know
politics because my drama whether the
first launched and he was actually doing
a monitoring company very similar to
ours for the pivoted to do in place and
those guys are kind of doing the mongo
privileges make it really attractive to
a developer to stick on their laptop
give it all the features and make it
very very easy I've made it so it's a go
by Brett has no dependencies your stick
it on your laptop and you get loads of
cool stuff and they're optimized for
that and it was always bustling what we
hear next video plus you will be here
next week and every time they find a new
database engine they change it like
they've had 44 engines which means a
completely wipe of data and now the last
car narrative the coffin for us was now
clustering is going to be taken out
it'll only bring plenty to their SATs
product and then at some point in future
will be a paid position that we closed
the source and plus things hard no I
prefer to have less features and have
something that was clustered that we
could build on that I knew my data is
safe then having something that was
hella long ago with the at the time
series world where it's brilliant it's
amazing on a laptop but as soon as you
put it into production you put
production load that's as hell so
playing a bit of in fasting version
how's it how's this not the other school
hoping for the typical forms of dogs do
just one server so he offers it fall
over and corrupt all the data yeah so it
doesn't corrupt any data from what we've
seen so far there this extreme based
upon very very old technology uses
chemical works for started it uses a
benefit but you're new to live expert I
intertwining owns anything these
basically built a wrapper on top of some
very old world testing software and it
hasn't got as many features and to be
honest it's a it's a marketing disaster
I mean to pull it down the team
something that you can't spell I mean I
took me six months to learn how to sell
you and even have to start to form a
doggy BB nobody would ever find it i can
get it to be the top of hacker news
yesterday this pigment quick links
samantha type it in but yeah i think it
means you need to rebrand for anybody to
get to it and i also think only having a
client library my leg might have stifled
it's in it and especially I ok then i
apply for a wire protocol it was
documented it is completely underside of
you too many person so we've done what
we can to get it into a different
language and now that people can see the
Python they provide in Ruby or whatever
else and we've also made packages for
linux because it never been brought
before
there were tipet's a few weeks just to
get the packages and changing the past
and other weird stuff so until it's in a
format now where is everybody important
for us yeah I mean Thomas what are they
eating numbers thousands per second
yeah I wish you have a flex where is the
same yes exactly seven there are some
people come back another Wi-Fi so
they're asking for much benchmarks on
the web for it he just didn't do you say
that Polly sexually bit better laws ok
so the official benchmarks with your
hand pulls on his especially he managed
to get back nine million metric space
segment on my boxes 35 boxes of your bar
shows white roses and they get out with
the new Chancellor's their best personal
i was saying hello guess no one really
beautiful be slow during a call and then
how this remaining pieces all mostly to
the media like once you get to that
limit of 50 citizens where we all that
pest problem i indicate importance
together then you start seeing something
some names but before that is almost
here
go to your position
something so that's that's how beauty in
do we have to go where you just said how
much how many times it has to be
placated each right to throw a big news
people ministry on the story and it's 3d
three people no but I recipes to use
extensions under their car okay so forth
or Arthur keys pigeon sauce and then as
we progress that's something which is
actually customers design that's where
that's where like cement each other who
they go sort of use encode it into your
heart it's it's based on how you collect
your paper boxes because the social
really a cool he's actually going to
make sure that by the device I if he saw
one point three different boxes and to
keith 1 code that one of them goes down
it's going to actually kind of that day
that although i don't know how it goes
in so from my perspective view we get
metrics in from different sources it's
very flattering and basically metric
path and a value in time stamp so that's
the data coming in they get split up
into messages they get written to Danity
into buckets so we have a bucket agent
and so he changing spins up registers
and creates a fingerprint there's always
word states it's effectively viewed for
the box that stands up and we pumpable
metrics into that into that bucket which
is named after you and then that store
to give other pairs of the metric path
and the value I don't know how that gets
put into the V node which end is
replicated around
buddy knows when Lisa invaluable three
your data is sorted from places the key
is actually your angel yes yes we call
it the fingerprint so in dates that the
idea is used to start an angel if
creates a new ID and stores it in the
file from the engine or finger registers
at an unnatural box if you wanted to
ever move your metrics between boxes you
move the fog so yeah that's how to keep
but they'll plant there were sometimes
become a few issues with that first of
all we started to have a single bucket
for organization and then we had the key
value metric pass underneath that bucket
and we were hoping to do queries using
and down the team to get the metrics
back out again but which alamo to do
that way and also if you ever want to
move an agent between accounts with the
fingerprint you could just stop there
index so for instance if you had a
boxer's an account for staging and you
wanted to move into production normally
you'd have to work very matter sort of
somehow move the metric passed within
buckets which is very costly or as if
you have an agent the fingerprint thing
its own bar here you can just update
index which accounts it and then it just
keep all the data or just move the top
level so we want to keep that although
it's caused a few issues because I can
say we've got a high width of lanes and
if you imagine off 7000 of these agents
connecting it now I want to play almost
of the five figures and each one of
those now is is opening up
for each of the metrics part within its
open up a file there so on some of these
boxes we haven't talked the open files
that it's over 3,300 thousand so we need
to do something probably too much he's
talking about having multiple metric
multiple agent the same bucket again it
will reduce the files but with although
it's working it's not really the limits
of limits here but it's going to be a
constant thing like I wrote a blog about
and down latina which basically I know
if it's ever going to get to the point
of Linux like we've Linux you can
install up a very tiny device like an
Android and you can also run on HP see
you know plus or something like a super
producer and it starts the point where
they've all optimized it basically
everything from what I've seen and this
is where the benchmarks are a bit weird
if we just benchmarked it and fired in a
million metrics per second on a single
metric park on a single bucket we'd get
phenomenal results but when you've got
ten thousand buckets and you've got a
mixture of metric pass the method the
the context of the performance of
different buyers you could measure the
context against different databases and
certainly for hours we've we've had to
spend a lot of time choosing it for our
particular width and porosity and
probably on vegas it's going to be a lot
faster than a generic database that's
quite what we chose it so we'll continue
to entertain the rolling as the
specifically optimized for the shades of
data coming in for us and that is one of
the benefits for using something that
was quite smooth pro bass that provide
upon external things so that we can tune
it on top is it if you don't mind me
chipping in so Stephen first of all I'd
like to thank you I thoroughly enjoyed
this which is pretty strange as we had
an intimate insight into you know the
work that we've done together but I
think this has been a whole new
perspective for me so thank you for that
very compelling thanks for all the
questions and i would suggest for all of
you to sort of stick around us some
pizzas leading good homes in the in the
hall here and generally what we tend to
do also is after a couple of minutes in
here we'll just go to the pub across the
across the door to nuloom house and then
continue the conversation
there but for now please join me in
giving a big hand to Steven</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>