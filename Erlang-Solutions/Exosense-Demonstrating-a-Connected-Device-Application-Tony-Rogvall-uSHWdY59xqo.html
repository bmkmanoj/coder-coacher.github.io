<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Exosense - Demonstrating a Connected Device Application - Tony Rogvall | Coder Coacher - Coaching Coders</title><meta content="Exosense - Demonstrating a Connected Device Application - Tony Rogvall - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Exosense - Demonstrating a Connected Device Application - Tony Rogvall</b></h2><h5 class="post__date">2014-06-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uSHWdY59xqo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I need to take lost jerrick describe
it
technology needed to connect devices and
so this year was a plan to show a bit
more of how you do it what kind of
component you need to do it but so I do
some go through these small points and
describe a bit more about different it
guys we have and can start to tell you
who we are and so we formed the foil
apps more than a year ago one and a half
year ago and the idea was to to build a
device management system that is
flexible enough to to be used for
various kind of applications on the
embedded side so the company's ideas of
course to to make money on the server
side but at the same time we wanted to
push Erlang on embedded in Erlang in
general because we think it's a great
way of writing and valid code so both
when it comes to for upgrades various
for tolerance aspects of things it's a
very simple way of writing robust code
on the note
the device side so so and we also have a
background several laws in that field of
computing in different various ways and
so both on the mobile side to connect
stuff with the internet and also to to
run on the bed in hardware and so and
that's also a bit the reason why we do
it why are we doing this why are we
promoting our line on the embedded side
so that's of course because we we have
been in those projects we have been
writing code on on embedded systems and
we we would like to see more are like
running on those devices because it
makes life a lot simpler and also it
makes it easier for the developer to
write code that instead of taking weeks
or months to develop take days or hours
so so that's that's our goal to make it
easy for people to develop applications
or services using our lang but of course
we are slightly pragmatic now in the
beginning so we will accept any kind of
protocol to connect to our device
management system so you're welcome to
connect fully crazy stuff you have so so
we call it XO device with it so the
whole thing is called X ourselves and X
server is the device management server
and XO device is basically for us just a
collection of of applications OTP
applications and we use rebar to to
compile them and collect them with
github so it's very easy to just do a
rapper application or rapper rebar
config and you will get all the modules
you need and compile them together in
something that could call XO device for
example and one of those components
could be X support that in self contains
more applications like
bird our pcs and extra salt gets and
stuff like that so saquib rappers we've
written for for the software to be easy
to use so the XO device is just a
collection of various api's you need to
write your application and you can run
it on on the target or it won't the host
it's now not a big really big difference
between the target and the holes that we
saw in the last page now we have earlier
running on the tiny whiny little machine
and you know all of a sudden doesn't
really matter if you run a TCP socket on
the host or on the actual target so we
have some projects going on with Jacques
dough that's a kind of linux
distribution for automotive and founded
by lewis foundation so we are involved
in that debates and in that project we
used for example travel pings teacher
packs to build the packages and so the
hardware we we use we can use basically
anything that can run or like and Linux
would do and now we know even one more
from the last speech so I think that's
really really cool stuff that we will
integrate x 0 device wheel and so so for
example you can use a raspberry pi
that's an example we use to a species
there's another card we use for that we
selected for some of the customer
projects but raspberry PI's one simple
shape we can you know they throw it at
you so it's easy to find and then you
can buy an i/o card for example that
that is a bit more costly action than
raspberry pi so that's a bit strange but
anyway needs I guess if we know where
volume so but with that with those two
cards you can be older
interesting applications different i/o
applications we did Pie Face you have
some I oh and then you have also some
relays that you can wire 220 volts
applications for example so it's very
convenient way of putting together a
proof-of-concept hardware with are alike
for example but until now it's linux i
assume linux as a as a operating system
beneath our life but it looks like we
have something interesting going on here
so anyway fort so for the hardware we we
have the I've been developing a lots of
stuff recently to support the hardware
and these drivers are that I've
developed are specifically targeted
toward Linux right now but I guess it's
pretty easy to to use those api's on any
kind of library or whatever you call it
for accessing the real hardware it goes
straight to the register so so one
example is a GPIO driver that we
developed its Linux using you know sis
class gpio Linux you basically use files
for it but we have written I you and I
version of it as well let go register
version so you memory-mapped I registers
and go straight to it but then you can't
use interrupts so i will come back to
that so you were this well three you
said so he said that you using FL but
that's deprecated so you need to switch
to you work now and you are got support
for well both Syria lines but also all
modem signaling and you can do like
flash programming and stuff like that
that needs most most of the time needs
this kind of signaling to put device
into flash mode so we also wrote and
very nice or militaria
very nice flash web server that you
should check out if you're interested in
flashing hardware and we also have the
spi drivers slightly different i guessed
from the one you got from Los speech and
I asked red square C and then I also
wrote recently an ethernet driver and
that can be used for filtering packets
or access and can pack using BPF with a
special compiler and it makes it
possible for example switch packets to
on the airline process level so it's a
several layer of Berkeley packet filter
combining it even down to the network
card if the colonel support it and then
last year presenter the can driver it's
still there and I also tossed in here
the pie face interface and its
combination of the DPI you and the spi
interface so and there are you know
there's some work but i stopped there
and all of them you see the address is
there if you write github in front of
them you will find the actual open
source implementations and currently as
linux except to you aren't actually it
runs even windows nowadays and so so
here's an example how you can use gpio
and with interrupt so i've i've seen a
lot of implementations that can do clear
and set bits but we focused a bit on to
do what I think is very essential so I
would say that interrupt handling it's
as important for low-level programming
as message passing is for early and here
i combine the two so i can set an
interrupt for for a certain condition
and it maps seen to do linux and then i
can get a message we're not interrupts
the car
this this example ties very well in to
how you interface the spi interface
towards the pie face chord because this
is what you get when someone push a
button for example on the on the pie
face interface card or when you get the
digital input so then you need to go
read the value from the SP spi interface
so it's a working very tiny whiny little
example so it's not more complicated
than that and so under what I would say
system API love life also have added
song a convenient nice to have
interfaces to our deal if you nix the
local socket interface so it's kind of
named pipes very and it connects also to
the anticipate feel like so it's it's
registered and you can use the same
api's as that it's used for the d-bus
application really or diba service so
we'll come back to that f notify is a
wave gift getting file system vents for
changes on on these files and it's works
on mac linux and windows right now so
you can get a synchronous messages from
from file activity so it's quite nice
actually
s'okay pdb is also one of those
systematize that we have a we can map
key key value storage towards leveldb
your ass or SQLite or whatever its
needing all the device so in this case
really I mean we have built KVD be to be
able to do any kind of key value
database so on large-scale leveldb or on
the device side we use at slogging ass
or we use SQLite where it's very
convenient with the single file for a
whole thing and I also push for a non
existing stuff and that's I think beyond
will have question for me later on about
when it comes so it's epx it's a pixel
library it's been around for quite some
quite many years now but it's never been
released so it's a it was designed as an
ER like a pixel library so it connects
very tight to her like it was designed
to be used but we used is actually in C
and C++ code fine but now it's back
again under like so I will open it up
very soon as long as soon as I got some
more documentation and then I have
something because services on that on
the service level so lost Gary showed
can open and then I've added netlink the
bus key is a mess that's SMS services
for you SMS gsm modems and working all
the GS marks it's quite complicated for
various reasons but it kind of works so
it's a multiplexer for the GSM modem
standard so you can use several virtual
terminals so you can send SMS and run
GPRS at the same time as you read the
best position for example some of those
modules you have gps as well and gps is
next topics is the enemy here 80 183 and
it's the standard for reading gps over
syria line and i also have Bert listed
here so those services are attended
structure in a very similar way to make
it very simple to use and so here's the
structure for the g SMS 1 SMS router and
see if you read it from top to bottom we
can see that on the top we have their
applications and they want to receive an
SMS so they put in a subscription a
filter that they can filter out some as
a mass comm young and the filter
condition could be anything from a
regular expression match on the body to
what kind of alphabet are you saying or
what on port if it's an 8-bit
application and so all and they hook up
to the gsm router and from the other
side you have the super provider
interfaces and they consist of different
kind of gsm 07 10 implementations of for
various modems and going further down
you have the you urge application and
below that if you have different kind of
Colonel colonel modules that will
support that so it's sir it make this
destructor make it very simple to to to
router out SMS itself to applications
based on conditions that they need so
you can share the same modem gsm modem
for various purposes well they can
collide but then it will pass copy to do
if to
subscribe on same condition they will
get on cottage so here's an example how
it could look with the gsm source you do
start a small service with a
subscription on a regular expression
filter and it looks like it looking for
looks for numbers if you look the filter
definition it's like a regular
expression
yeah and you can have a question mark
afterwards so ? plus minus yeah ? plus
minus you can have it with ? a
plus/minus so you create the
subscription and they loop with
reference from the subscription and when
you get an SMS you process the command
and then you loop and how what can we do
well we can since we know the structure
we parse the message and see if it's a
pin number plus minus or ? and then we
do you know the different cases we set
the pin clear pin or we ask for the
value of pin and return it to the center
so this is a very simple as a mess
service on in a few number of lines
complete so this you can you know run
and get a nice SMS service interfacing
the pie face for example
so and this is an example you know you
see that this basic structure is the
same as joined to see them so you get
the idea this was a something I showed
last year also the camera or so you see
how did u sm router is modeled makes
lives very simple to be able to do all
these providers from from below and also
have a dispatching interface on the top
and of course we did something similar
but not really on the packet filter on
the ethan drivers so the set filter is
set the berkeley packet filter it's a
compiled berkeley packet filter and the
syntax i support is you can see over
there slightly different than you can
you can hand in BPF programs if you like
but this this syntax you can see oh
there is slightly easier to use i would
say because it's just a simple
expression capture most of this stuff
you want to do and as I said you can you
push the filters down to the driver to
the erlang driver and the Erlanger i
will combine the filters down to the
colonel so it will put them together so
it you get at the colonel the colonel
filter with join you join them before
you could do the subscription or the set
filter operation down to the colonel and
the process to the right the up to the
right the eth process it's actually the
process that do this work it collects
the filters and combine them and push
them down to the colonel and the colonel
can also push down to network interfaces
that do support them
so that's what bits and pieces of
different various libraries and yet some
words from the last year on the exercise
so from from server side we we use a
very simple story forward or pc engine
it's using birth or Erlang messages to
to send to the device and the device
basically unpack that bird message
execute return a bird message back
simple as that so from the client to the
XDM server or XSL server whatever you
call it you use JSON RPC so hiding the
binary part from from from the customers
but making it very easy to parse and
handle on the device ID and we also use
young and data models to to specify what
kind of messages are allowed and get
some structure on those messages and
control so now we have SMS this we have
some like cool libraries we need to a
way of connecting the device so
typically a device is maybe it doesn't
get any kind of network connection may
be the only got our GPRS modem so we
need that device to well it could be
connected all the time but that's not
very probable so you need a way to
signal to it to say connect connect to
the network and well hopefully it
connects to the XO DM servers because
that's US making money so what we do we
have just sketched a very simple
protocol and so it's a text using the
default alphabets it's a regular SMS
it's preferably in one segment so it
doesn't require multiple segments to
so the ex Adam sorry will you send this
text message and saying XD and more PC
and then required reply mechanism if you
want to reply through SMS or nothing at
all or GPRS or in some preferred order
and then you have a base64 encode erlang
binary message that's a Bert artsy cool
and looks something like this
so this SMS tree gear is also since we
have this SMS structure where you can
subscribe to various regular expression
it's very simple to make this kind of
expression that's subscribe on on
exactly this message to have one small
application that subscribe to this
trigger message and that application can
then run started pvp demon check the net
link status to see if we've got an
address see when we get you know the
correct flags and interfaces up and then
we kick it got kicked the applications
to connect them and start processing the
queue and receive messages from the
server or you know sending sending
messages towards the server or receiving
commands from the server so and you can
also see you have the same problem
regardless if you have a network or not
I mean it could be a device behind
firewall that is just not waking up or
not understanding that it should connect
or something or you know its purpose by
purpose you don't stay connected so you
could still you know have a good reason
for selling a trigger SMS to that device
so it connects to the firewall and as
you know and stay connected or maybe you
want to do something else maybe you'd
want to query some device that do not
show up you can see if you can reach it
through an SMS but since you can get a
reply threats mess if it's not too long
and the providers do supply do support
receiving SMS as well so the tricky part
here I mean we have we have integrated
with one push SMS service for example
and they were a shape and they only
support exactly that one message that's
and that's only text
so if we can if we can handle that very
simple sheet metal services then also
have a good way of telling our customers
that you know you can use this service
and it will cost you nothing to pin your
devices or very little early so last
year built an application for showing of
communication between mobile app and
controlling canvas and also RF net is
that the correct pitch and no it's not
all right ok I see it was animated since
last year so so this is that proof of
concept demonstrating the different API
sui got so we have the pie face and
raspberry pi down there and we have some
of the old stuff with RF that we can
send signals receive receive signals
since we switched from tell stick to the
tastic you or we can receive RF signals
so we can have remote control receiving
remote control signals and we can send
RF to control that plugs the Warlocks
for the for the different light bulbs
and we also have this interface that's
since we have these relays over here we
can have 220 connected also and switch
that off it could be anything that you
haven't 220 a fan or a pump or whatever
and you have both on the pie face you
have both input and outputs you can can
really do interesting stuff here and
also some control from the exod app so
you can you can send from web page go in
and send them and activate those
that's as well as locally selling it and
the new and another thing new thing is
that you can send SMS to to control it
as well there is also ways of getting
smss on events so for example if you
don't push a button you can get that
mask I'm saying okay someone pushed
about but that costs money so I disabled
it for the demo that South worse if you
want to see it live it's outdoors behind
by the world towards the big big
conference room so and I think it works
most of the time so and the idea i just
heard Joe speaking about plexus I
realized i reinvented plex so so because
I you know I think it's kind of
interesting that you have these kind of
inputs different events it could be a
GPIO or interrupt that you saw earlier
or it could be an SMS or can message or
an RF message since we used to do now
that you can receive and it does pretty
nice the dude is utilize decoding as
well so you you have a range of
different things to match on so and then
you go to the orbs own rule mature and
you will produce an output it could be
any one of those and including emailing
in the output or XO XO sense or PC
outputs so I mean it's it's not it's not
the application this is just a proof of
constant application you can play around
with it it's so i think i forgot to put
banda the reference to it but it useful
do the speech last year you will find it
anyway they're so it's also something
you can have a look at it's open source
so the input processing looks pretty
much like if you if you do a table you
have a left side the events that you
want to match on on the right you have
there the can messages to produce
so what ends up in the center of this
little switch if you think about this
way it's the can messages and on the
output side it will match can messages
and produce well email says messes or
new you know gpio or whatever so you get
you reduce all events to signals and
then you get signals that could reduce
to other signals or to output so
different concerts pretty pretty simple
stuff and get some word some final words
on GSM and then GPRS modems so I had
hoped to be able to demonstrate a new de
Paris modem but for various reasons we
couldn't finalize it so I didn't bring
it but it's a so since we since ages I
mean everyone has been playing around
with PPP or or dsl modems or mold and
for that matter they know how hard it is
to get all the PPP settings corrects and
working and it's not very portable and
you go from one operated another it's
completely different and it's totally
whacked so we wanted some way to at
least get rid of some of those problems
so we thought maybe we could just build
a modem for the Raspberry Pi that we
could for example put in between the
Raspberry Pi and the i/o card that way
we would have a nice little packet of
cards working together and it would be
you know where is easy to have software
ready to roll for it so know your modem
and don't switch when you hear you go to
settings right so that that's the that's
the idea but also we would like to add
some features we would like to add cool
features we would like to add that we
listen to the ring signals from the
modem so we can use it for power on
Raspberry Pi from the modem because
Raspberry Pi did they don't support
sleep mode so but by holding it and have
a small circuit on the on the modem we
can use the ring signals or any kind of
timer logic to actually activate the
Raspberry Pi by power cycling at the end
and saving some you know precious power
that warmly keeps the engineer happy to
if they can save some what's in there
they will build it for if you can if you
can argue for for that so and also that
we need all the pins that has anything
to do with resets power cycling or or
the power key for those modems yes so so
i hope i can demonstrate that the late
time i can bring that modem it will be
something ultra cool and ultra power
saving and so okay so one when you have
this modem and you have control over
everything and you know exactly how the
modem signals work and how PPP connects
to the to the to the modems and if you
use flow control of what kind of flow
control use well then you would like to
maybe set up a GPRS connection but if
you want to receive an SMS at the same
time as you have a GPRS connection
running could happen I mean then you
then there is a solution several of the
vendors of Modi PRS modem modules they
the support is called Jesus OC max mode
and it's the GSM 07 10 standard
and it makes possible to implement the
virtual virtual ports and my solution
I've tried a lot of different software
for it and it pulls is crap everything
doesn't work you can't they don't
support your modem or dais crash and
burn so of course you write it in ur
like so so here's an attempt fraud so I
my temples to write an erlang program
that implements c-max and you sing ewart
pky mode so the you what modules also
support PTY making it possible to you to
set by here symbolic links to something
we could identify a distance and also be
consistent every time you start so it
will be number one two three on the on
the level seats it's nothing it's the
same thing so over USB can come up with
various names and you have to find a way
to make it stay so like here for example
so if you have your calendar fti based
cable to external modem you normally
have this name us be 0 they are various
way of renaming it or setting symbolic
links to define it or to go into the
various strange directories where you
can find mappings but so the gsl MUX
program is an earlier program that we
create channels to handle that the
proxying between the PT wise and this
you are so the flow will go back and
forth here I still have something to do
some stuff remaining with flow control
specific order flow control but then it
will work so and then you can have one
modem and you can you know send us a
mask on GPRS and then you use you can
run this as a separate note so it
doesn't so it can run
separately as a service and then you
have your applicationnow separate so
because if you have this structure you
can run the P you want to have rounded
pppd on one of these the line XP Peabody
I think clucky never got to got there
ppbe implemented in our line but I think
you've made in the town didn't you so
anyone that have a decent people the
implementation airline I yes thank you
so so I think I I stopped there
okay so we have plenty of time for
questions if you have one raise your
hand I'll bring you a microphone three
you said you have kind of what's called
content-based publish-subscribe so you
can subscribe to messages according to
regular expression yeah is the filtering
happens on device or on the server side
and if it happens on service side how do
you make sure that it will scale is if
you have only going on of messaging okay
not on there's a messy so this is a
local also on the look on the receiving
house so just making it possible to have
several application listening into
several modems for example and dispatch
exactly the message you want or at least
as close as you want with some regular
expression matching or some other
criteria when you use when you when you
use regular device management you have
you have another alphabet then you have
a port concept in SMS that you don't
normally see and then you can for
example do subscription on the port
number so that's a more natural mapping
for for like binary services but in this
case we don't we wanted to build
something that didn't support binary
messages so we just use the default out
for that so but it's not on the server
side it's not on the smsc or anything
like that so this is on although on the
target
were there he knew the questions nobody
one of you was supposed to ask him
something graphics all the graphics yeah
so I have one user in the room 44 e PX
and it's over there he made the previous
presentation I don't think it done much
with it yet so but I hope he will we're
so so but i think it's not far away so
we're using it in customer projects and
we are documented it slowly and it will
be something that we release soon and i
hope it will be that simple to use no
basically very little documentation
needed to be able to run it
are there any other questions okay I we
have a break and we will be resuming
again at 425 with a discussion about
tail flow thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>