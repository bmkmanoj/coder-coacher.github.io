<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Motiejus Jakštys - Large Partially-connected Erlang Clusters | Coder Coacher - Coaching Coders</title><meta content="Motiejus Jakštys - Large Partially-connected Erlang Clusters - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Motiejus Jakštys - Large Partially-connected Erlang Clusters</b></h2><h5 class="post__date">2014-06-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dEot3Fb1iB4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">i'm mateus exts the senior back-end
developer at spil games today i'll speak
about large partially connected airline
clusters so first we have a quite
sufficiently big service oriented
architecture back-end infrastructure
infrastructure provides api for to
render our portals numbers a couple of
dozen beefy servers running roughly 50
services each you can do the math to
imagine how many nodes we have in total
agenda I'll give a historical
introduction and then technical stuff
please help please interrupt any time
feel free sorry and there will be a QA
session at the end but let's talk so my
point today I'm going to make a point
that management of big battles is very
similar to management of big distributed
systems and I will actually present you
a battle which happened in history I
have a good example which is Battle of
Stalingrad it's a turning point of the
Second World War when Hitler was
fighting Stalin that was really the
fight between those two after this
battle German started losing so it was a
first major Hitler loss in the east this
is this flag is a Soviet soldier holding
the Red Army soldier holding the Soviet
flag at the end of the battle when they
want you might want to ask why did I
pick this example from I below 70 years
ago we didn't really have computers then
we do now but there are quite a few
examples we can learn from the battle
and the management of the battle so why
is this battle interesting to begin with
this is a rebel battle this is a one of
the major modern rubble battles in the
history what does this mean that means
that German fleet the Luftwaffe
destroyed the city completely in the
very beginning of the battle so the rest
of the battle was carried out by
soldiers in the rubble
this brings a few interesting
consequences for example when there's
rubble all over the place and the error
is quite small the maps are useless so
it is impossible to determine the
location gps wasn't there yet so the
location was really ad hoc so that led
to peer-to-peer communication between
the soldier groups so whenever a soldier
needs supplies or reinforcements they
asked for another group on the left on
the right on their back and then the
message is sent verbally because radio
is not reliable slow the setup and
useless because of the small distances
and impossible determine area that's
peer-to-peer communication then another
property of the battle in general and
army that it's very heterogeneous so we
have infantry we have tanks we have Air
Force medical staff commanding staff
they all work differently they have
their different ways of communication
they have with different ways of doing
but they all work towards the same goal
is to win the battle so communication
channels meaning that there is in the
army there is a very clear hierarchy who
reports to what and who communicates to
what you don't want a general taking
care of 200,000 soldiers or 200,000
soldiers reporting to in general please
refer to a CEO and people of large
companies that's also true I'll get back
to that so an army and in battle we know
clearly who communicates to what it's
not like everybody speaking to everybody
dynamic environment of the battle so
tactics and the situation of the
battlefield change the dynamics all the
time so situate areas are lost areas are
captured equipment dies and new
equipment is is got into place so it's
very very dynamic and changing all the
time and you have to take care of this
change you meaning that the generals the
the people who manage the battle
another thing it is did it is not enough
to take care of your business of your
small area in order to win the battle
all units must work together combined to
achieve the same goal that tanks have to
help infantry infantry has to well also
fly airplanes the the bombers have to
help everyone and there has to be a way
to communicate the tactics to
communicate the goal to everyone and
this deserves an example so this is this
situation in November 15th you see the
Stalingrad city is at the middle Germans
at that time had ninety percent of the
city both sides were pushing a lot of
people a lot of resources but the
Russians Soviets excuse me there were no
Russians at that time Soviets were taken
out so both sides had a lot of
causalities a newly arrived soldiers
life expectancy Red Army soldier was
less than a day so if you come to the
battle you pretty much died the same day
that does the average officer three days
and as I told you Germans had ninety
percent of the city so situation of
Soviets was really bad why another
interesting fact about this battle so
why did it happen it is tactically not
that important the city but both sides
were playing plunging huge resources to
it and the real reason was because it
had the city had Stalin in its name so
it was a war of it was a battle of pride
for both Hitler wanted to take it
because it's Stalin and Stalin wanted to
defend it so badly otherwise they
could've just given it up and go on
that's what is also interesting so after
a week within a week sauget saw that
their situation is really bad and they
made up a plan operation Uranus which
surrounded the whole army the whole city
so this around it there there was in the
middle over here there was over 200,000
soldiers you
imagine you have to feed them you have
to provide weapons everything so they
cut off the supplies and then work then
that was the time when slaughterhouse
start so they were destroyed and this
was the first major loss of Hitler and
and turning point of the battle so this
is a big plan you see that's it's it
really involves a lot of units so the
whole these these units had to be
communicated somehow it has to happen in
the battle and I'll get back to the I'll
get to the cluster why did why it is
important so the city was Germans for a
while but Germans were Soviets and they
were done after a while the battle
finished quite soon after this this
moment 6th army was a major German army
was destroyed so you see the
introduction the historical introduction
and you might wonder how what is it has
to do with clusters it has a lot so we
have a lot of in our environment and
spill environment and probably many
yards we have a lot of different nodes
which are trying to achieve the same
goal usually is to serve the customer is
the internal external it doesn't really
matter you have to serve the customer in
our in our a reminder for the background
what kind of a cluster we have its bill
is 50 notes per cluster and a couple of
dozen of servers that's weighed more
than 100 are long notes example services
what we run there is high score
authentication chat user profiles and so
on so we have different applications
doing different things but they're all
serving our portals they're all serving
our customer the question i'm answering
today is how do we connect them so it
all works first peer-to-peer
communication this title probably looks
familiar from a few slides back so we
the reason for peer-to-peer in the
cluster is we don't want bottlenecks we
don't want a metal party because it's
slower and we don't want single points
of failure so if you have well you just
don't you just want services to talk
directly there is no reason
for them to hop to do hobbs cluster the
environment is also dynamic I think you
can agree here services a note start and
stop all the time hey there started or
stopped because of the requirements that
you just don't need that many resources
at 3m or they also die machines Die
Network networks died and because of the
dying and because of the changing all
the time system has continued to serve
system as heal itself just like in the
battle partially connected network so I
told you why you don't want to connect
everything to everything and now will
prove you by the numbers so we say we
have n as a number of nodes so total
number of its overhead it consumes
memory and it's very I so it's very
tricky to isolate any problems if you
have everything connected to everything
so also isolation so conclusion in
general both in clusters in the army and
management software defined networking
it pays off to optimize your network
topology so it doesn't speak to
everything doesn't speak to everything
we had an open shift the woman at the
keynote this is this is software-defined
networking this is something she's
working on so this this is all over the
place army management and how do we do
this with the piece of software that
I'll show you now again the requirement
that we want from both battle Army and
Air Line cluster so peer-to-peer
multi-application groups dynamic notes
and connected Network and because the
requirements are kind of the same and
you are I believe most of you are
distributed system developers or
maintain errs we can be generals it's
the same thing right so there are two
main stream applications that help you
services without affecting the cluster
but partially connected network is
something they don't do and this is
something spot the router does it's very
simple
and i'll show you how so features
shortly like i told you it creates a
mesh network create in our case it
connects hidden nodes like configured
the way the topology is configured
abstracts the destination so instead of
calling a different note you don't want
to call a different note you want to
call a different service so it's like
RPC call but the first argument is not
the note but the service which what
you're interested and spider out or
takes care of looking which actual
destination you want to call we believe
it's pretty good we've been using this
for two and a half years in our back
ends we optimized it we fixed bugs and
issues and we we trust it instrumented
i'll speak about instrumentation after a
little bit why you want it and how you
achieve it here let's say you have oh by
the way any questions up till now either
about the battle or the natural features
i have too great a big was the soil
forces of the Red Army in this battle
when they surrounded starting with that
way more than than the ones then the
ones inside the city you could see that
outside sorry outside there was quite
some Germans bull gear Germans
Hungarians and Romanians but in inside
the city was the major force there was
also another battle after this but this
is kind of really historical so let's
speak together after donkey thanks it's
interesting but let's let's give it
another question I have a question about
because there are also global groups
right that a petition your search of
nerds I was wondering why there weren't
so the global you're right here's the
table so global could also be put here
also for the same three oh wait you
global can partition the i'm not talking
about global but global groups global
groups is something releases working on
no no it's an OTP
the partition so instead of having a
fully connected network you can have a
partition in that case in that case you
need to hop well if I understand
correctly in that case you need to hope
you cannot connect the direct well you
partition by service and we don't want
to do that so with global you have to do
hops if you want to reach the same
destination is that correct so the
problem is you have to do hops otherwise
you won't be able to reach your
different applications if I understand
correctly how the global works no I
didn't think so anyway we'll talk about
that later ok might be missing something
another question I would like to know a
ye to put 15 notes 50 year long notes by
by note and not one note by the machine
that's that's a design decision so we
can also chat about this later I think I
made the I should have done questions at
the end because they require the
elaborate explanation so I'll tell you
about that we have a reason for no more
questions yes for clarification please
raise your hand and let's talk but the
questions at the end because I see that
it's not that's easy to to answer in a
second so let's get back so a library
creates mesh network of strikes the
destination mature instrumented let's
take an example we have a we have
formation three machines here you see
their different color coded the first
machine is a page builder so let's
assume that we're building a web page
the web page consists of two parts this
is a header and the main section so
obviously the main section requires more
computing resources and the way we build
them is the page builder requests for
two different parts so for header here
page builder header main section so
request two parts and then concatenate
them together and then here you have a
page but the thing is that the subpages
these ones they don't have to know about
each other they're completely
independent so this is one example and
this is exactly what we do at spill one
of our back ends when we're building the
pages we have a three a hierarchy
how the pages are built there are also
sub so these we also are obviously
subpages so they delegate work more and
we want to connect it this way and you
see there's this thing it's not
connected the reason is that the node
name is test two so you don't want
testing to intervene so there is a
particular way you name your notes which
you connect that's also part of the
answer of the question this is an
example configuration how you configure
this component so you see where you want
to connect from sorry others where you
want to connect from you you configure
you put spy a router there and connect
to the other nodes so in this case we
have two hosts a host one and house too
so these are the two bottom ones where
it connects and looks for the
destinations and then we have yeah so it
connects and looks is there a node where
I want to connect on this host so it
connects to it looks for workers which
match this reg ex so this is the reg ex
of the node name so you can see a header
and the optionally a number so have
header we don't we head there we don't
have a number so this matches this reg
ex this header another the atom in the
list is the application that has to be
running on that note if there is no
application running on that note then
it's not a service you're not interested
so there might be a problem there there
might be a different thing you don't
want to use that same four main sections
so main section the node name and main
section the application name if these
hosts match these node names here as
well and with which node names have the
running applications well I you're
connected pretty simple there's more
configuration stuff here which is useful
you can change the frequency how often
do you want the host and applications
monitored I won't speak about these
these are in the paper which is next to
the application you'll see at the end
I'll speak about call that module module
a little bit later so in detail how this
works let's reiterate first oops spy /
router spa / root anode running spy /
router which is a library a reminder it
works aside to your application it
connects to these two nodes then it
connects to EPMD of this sorry it
connects to EPMD of these two machines
it asks for the running notes on that
machines if the notes match the regular
expression then it connects to these
notes matching the regular expression
then it checks running applications on
that notes and then connects the stays
connected to the relevant notes and
disconnects from the non-relevant notes
I think like 10 people here or maybe
half of the audience have a question is
it the rice condition yes but we don't
care so this this is how it works and
this is the instrumentation a bit so he
a I will give you the reason for
instrumentation be i'll show you how
easy it is to instrument your
application if you're running spy /
router so in any instrumentation talk
the very first thing they say you want
to instrument the borders of the system
first so anything that's coming in and
coming out you want instrument first
then instrument meaning that you want to
know what's going on so the time it
takes to do something the number of
okies and errors and other kinds of
internal things the amount of traffic
transferred is the first thing that you
put on your production machines when you
can seek time series so you instrument
the border of your host and this is
exactly what spy / router does by
default so for every out coming call you
see the time it takes to execute that
call and how many okay and error nurse
calls are happened this graph is a
random graph from our random service it
shows the number of requests per second
the green as greens are okay and the
Reds are errors the graph is not
particularly interesting now because
everything is healthy you see it's 24
hours so
it's okay to 4am there's lower traffic
but in case there are errors you see
something immediately going wrong in one
of the graphs that the calls are failing
the services are down something is going
bad and the my point is that would spark
the router you get this for free as long
as you have somewhere to instrument to
but that's another thing you probably
have everybody has graphite or something
like that log servers so this is how you
implement those instrumentation and user
callbacks so one thing you can attach
user callbacks to your when you get a
new resource and when you lose the
resource you can react to it so when
there's a new service you can change the
state of your program when there is a
lost service you also can change the
state of your program this is a proper
Erlang behavior and all instrumentation
is done with three functions so function
measure which measures the time it takes
to execute the call and the success and
failure are simple counts we put these
counts to graphite cluster and then with
these success and failure you you get
the graph that you saw just before so
here's how you do callbacks API so you
have your library you have your
dependency setup you have it configured
you have your cluster connected how do
you use it it's very simple oh sorry I
didn't change this thing so instead of
PRP c there should have been header or
main section I was I am a fan of picker
if you see that's what was here so SPR
rotor call then header or main section
so this is the service that you are
calling and then module function
arguments so this is exactly the same as
RPC call but the first argument is not
the note but the service that you're
interested in then there is call all
which is a broadcast so it calls all the
services with this name in your cluster
synchronously there are more function so
call and call all with our 85 which get
extra options for example a synchronous
call timeouts and every pretty much
everything that is in the RPC
module we modeled after it there is one
optimization for this call is that if
there is a node an interesting service
on localhost it calls localhost
otherwise it caused a random service
this is very useful to reduce network
traffic so future optimizations things
we can improve but we didn't need to or
didn't have time for for the client
since this is a one-way application
meaning that only that so let's get back
to a very long no quite long ago you
want oh sorry you want you need spy /
router on only where you want to connect
from you see there is no spy / router in
these or these because they're not
connecting to anyway so you want it's
only a one way thing so it only connects
one way but it doesn't know anything
from the other side it's just a simple
connection yes so it takes the thing is
that when the depending service in this
case header is stopped the calling
service needs time to figure out that
it's a stop basically to catch the note
down message and this takes time and on
the if you have calls running all over
the time if you have requests then they
will fail because there is a window
which is not served because of the stop
node or stopped application there is
another optimization that is quite a
low-hanging fruit but we just never
needed it so now we monitor the node for
the service but we should we could
monitor application controller instead
so that would reduce the same window the
same downtime window because when you do
the reason why let's say you're running
everything cheerfully and then you need
to stop a node you do n its top or
something equivalent then all the
application stops one by one after a
while the whole note stops and only when
the note stops the note down message is
sent to spark a router
that's a problem because your
application that you're interested in
was stopped before the note was stopped
and that actually takes time to stop all
the applications so when the application
you want you want to remove the service
when the application is stopped there is
one assumption that we make in our
environment one node is one service this
assumption drives the way we configure
spy p router and the way we designed the
configuration of spy / router if you
have another set up this might work or
not might work for you but this is only
the way that you configure it not the
way you connect or the way you react to
events so see that this might be or
might not be applicable because of this
assumption we found this easiest to work
with I mentioned also that the
environment is dynamic so we support
dynamic environment and this is what we
have alleged spell especially with cloud
computing and on-demand machines how do
we change the host that we connect and
we use puppet for propagating the
configuration files propagating the
configuration files is not enough you
also have to ping your note that a
there's something changed do something
about it the canonical way to do is to
do this is a relic we don't do relevant
need to be running all the time with
it's easier to stop and start the note
and accept a few misses but in spite the
router case you don't really need that
it's enough to update the configuration
the application environment and call
conflict change then it will figure out
the change hosts and nodes and
applications for you this is this this
anything really it's it's an application
written by a colleague of mine in two
days it's a it call it the name is
conflict changer we didn't release it
the open source yet but if there is
interest please ping me it might be
doable it's very simple
so battle stories so these are I'll tell
you some stories about the
implementation of spy / router and the
way we're running on production this is
not another Stalingrad I heard battle
all the time in this conference I
thought what battles are you talking
about really so now I'm the same so
first first approach was which we were
trying to disconnect from irrelevant
notes first it's very it's very naive
but for our cases it may be would have
worked so you connected everything see
what's interesting and then disconnect
from what's not interesting the problem
with this is what if there is one note
interest interested but the other one is
not so you connect the other one sees
either some crap connected to me yeah go
go away disconnect disconnect then the
first see so I was disconnected retry
and then you see there's a it's a really
fight and we had fun story with this a
single misbehaving component note
component so meaning a service not a
single node but a component brought the
system down for a for a little while
that's that's one approach we also had
fully connected network experience due
to a subtle bug in the library we made a
small change non-obvious one and it
wasn't disconnecting properly after it
figured out that then that there is no
application running so after a few hours
we noticed though we have a fully
connected Network Wow over a thousand
notes so i would recommend to do that
for everyone it's you don't really
understand what's going on until you see
the network graphs of the machines and
thanks to off peak it was it was during
the change was in the morning and we
noticed this in the noon we had not that
much traffic and thanking a bit network
cards so we didn't have real down time
we had sporadic issues people who are
running around but our users were still
able to play games thankfully but this
is a very you just say that you
installed the fix at free a.m. in the
morning no no no in the morning in the
morning so in the more you can't become
install it this is how we do it our peak
is 6pm so 6-8 p.m. so and it starts
growing like crazy after 12 so this is
this is when we fixed it yeah so a
little bit of Statistics how this
development and deployment game so the
initial version it tests actually it we
start the first file where tests was by
ticed allow my colleague and the first
production release was after a month so
that was 2012 january-february then a
few features were added by enrique path
so broadcast the call all and user
callbacks and after two years within the
two years we added instrumentation we
fixed bugs we change the configuration
we change the approach and we used it
heavily and now its ninth oops I got the
date wrong so public pre-release we
decided to announce it publicly for
everyone to use yeah this is not true
this is the day so spotty router source
documentation and the paper it's
scientifically looking paper how it
works and why is available online yes
this is a so the next section is
questions and answers questions and
answers I'll try to answer your question
later yeah I'm very new to our line so I
just wanted to ask a few questions to
see if I can clarify a little bit yeah
what was going on there that and so
basically you can have you have these
routers on in multiple places in your
network is that right this is the this
spy / router is an OT it's it's a
library so like another application
running beside your note so if you run
an application on your note then then
you have also spot route or application
you know you know what will you have
like if you have a cluster will you have
one rotor in this in the middle of or
will you have multiple you have routers
everywhere so anyway anywhere where you
want to connect to somewhere to another
node to a dependency you have that
router right so every kind of collar
will have a router yes that's correct
that's exactly how it works and how do
the routers know where to connect and so
on so this was the yeah I'm sure you
showed it but musk did no too far not
here not here not here almost got it
here so this is this is how we show how
to connect it you very sorry for wasn't
clear enough so let's let's do it again
quickly so you say that two hosts let's
let's better for you I guess so two
hosts it tries to connect the two hosts
okay but you have you have the
configuration yeah you spread it with
part how how to connect answer yes or a
pik i think it's a i think i can get it
here so this is this is my mistake this
this this is supposed to be a main
section or header so this is your
service that you're interested in so a
you configure then you get the network
be you call it by specifying the service
that you're callin so imagine this is
this is and this is data that is stored
in puppet haha yes yeah exactly I get it
thank you yeah alright guess this is
great for service oriented architecture
and so on Easter I a cost without to
return as well instead of just call
excuse me is there a cost of this is a
call I guess it's your translator yes
it's a cost just to send data sure you
don't care about yeah is there as well
that's in the options in the five eric t
item is it this one so excellent you
pass options is a sink or I don't
remember precisely but there is Miss in
there yes excellent yes of course over
there
so does it use distributed erlangen yes
and hidden notes yes okay yeah i see i
see you have more questions so go for it
I should have start stated this in the
middle of yours you said that you don't
care about raised conditions I was
wondering why about this particular race
condition I know you said you were
describing some graph i think at some
point you say which and of course this
will cause race conditions but you don't
care about it so let me remember where
was it it was in the connect and
disconnect of the notes yeah yes yes so
when you connect the final destination
to your final note you check what
applications are running and then you
disconnect so that's a race condition
let me quickly recap yes and then but
this is yeah exactly thank you very much
and after there are these configuration
items the host monitor interval world
monitor interval that every node will be
rescanned anyway so if there's something
that you didn't connect even though you
had to connect it will be connected
eventually and this is what we care
about so it's it's it's explicitly by
its very good that you asked this by
these this is patched fixed on runtime
so if you connect it to something that
you didn't have to there was another
question by this gentleman who asked
about why do we run a note / mr. yeah
yeah because this is a better load
distribution Linux does quite good job
in doing the scheduling so we're fine
with this it's just there's no reason to
do with also this gives very hundred
horizontal scalability uniform
if you see that your whole cluster is
not keeping up you just add more notes
instead of trying to figure out which
one uses most more questions so if I
understand correctly the configurations
the nodes are dynamic but the hosts are
static so if you need to add a new
machine or something yes so this thing
does not do house discovery you have to
explicitly give hosts so and there are
many ways to do it you can have another
component which generates the conflicts
but can you add a host and real time or
you need to just the node no no you add
the host on real time without stopping
our application and then you run spy /
router application config change and
then the change propagates so if you did
something like net ADM world on a new
module because you think I just want to
put this in the cluster somehow does
your spa Peru to need to be updated to
have that Houston as well so if you
connect with little so you've got your
network with loads of nodes in it and
you add a new network to it manually
with no ADM yeah whatever you add a new
host yeah okay do you then need to
update yours bappy water everywhere to
make it use it yeah it will disconnect
immediately well the way it works now
it's well spot we made the decision that
spike the route or takes care of
everything so if you add extra stuff
it's probably going to be disconnected
if you add extra stuff without telling
spider return yeah and you connect to
something that uses it then you're going
to be disconnected it's a conscious
decision to keep on control in one place
so we never do manual connections for
that reason that we just don't know you
know there has to be someone taking care
of it so it's we made a decision to make
it automatic so how do you handle the
partition where something starts up
spuffy ruta isn't aware of it so it
disconnects it yeah then the configs
updated in spirit now you can exit the
convicts are not the conflicts we make
the convicts meaning the the people who
are building the cluster yeah make the
convicts not the convicts are not
inferred by the way the
current network looks like right so we
make the decision how the network looks
like make it that way and make the
configuration that we understand okay
well I have to jump over the chair again
okay so you mentioned that the what you
called the battles are or the armies are
heterogeneous and there's like you know
fleets and whatever in the air forces
the flat I know you're our line shop but
is there any any plans in the SPE
popular to support heterogeneous
services because in so ax or service
oriented architecture there can be many
services in different languages and
different sort of platforms stuff light
is there any support force puppy Rueter
to support that scrolling into like I
don't know god forbid Java service or
something very good question so you have
rabbitmq for that which exactly does
this and you have cloud cloud to cloud
dulu I never figured this is an
uppercase I or is it an L so you have
cloudy let's assume it's I which exactly
does what you're describing and the
reason why we made this component we
didn't want to get out our calls from
the Erlang environment so we have in our
backends we have only network Ireland
network communicating a message passing
using protocol buffers for compatibility
and we just don't have to get out of
that environment and we don't support
anything so if you we have also a fair
question we have a few things that are
still running from the old days in PHP
or Python these are also in our
architecture but these services have
wrappers in Erlang so there's an erlang
node and just behind it there is the PHP
or Python or whatever which communicates
in the in that way so spider routers
there is no reason to support other
things because that's not the way it
sits for
just a question your design decision
when you made this as you say that the
problem that you have is that you have
in excess of 100 nodes basically and if
all the connected network there means
that you're running to blow up in
connections why didn't you try to do a
tier architecture where you would have
one router per node and then having that
consolidate all the services on the
single note on that note on that host I
didn't fully understand so you have so
would have a router on the host yet and
then actually consolidating all the
services on the node into that single
router on that note so then the local
the local services communicate to each
other with that router or exactly and
then you will add the services all the
definitions in that router which would
be a distinct feature of that host yes
the question because then you then you
actually get away from all these
connectivity problems I don't I need I
need a minute I need some more time to
understand what you're proposing it
doesn't really fit to my head that
quickly so so we have routing service on
the host yeah that Stella would be this
paper out right and then you would have
the services on the airline nodes on
that host mm-hmm but we have more than
one host yeah but you only have like a
dozen that's 12 fully connected 12 notes
it's not to prevail oh you're making
you're proposing to make ISIL I islands
yes okay I'm just asking why you didn't
opt for that solution because it seems
quite straightforward so yeah we we had
this we were considering this to have a
full vertical stack on a single machine
and this is actually what we have but I
cannot tell you now why we didn't do it
there was a reason for this but I don't
remember why I didn't do this it was it
was one of the ideas how to make this
happen but let's have a chat later i'll
try to i'll try to remember it was a
long time ago
could you possibly say something about
your disabuse of your application
because the if I understand correctly
the router doesn't need to be on every
holster for what reason do you deploy
everything matter explicitly where it
has to live or how do you handle that
okay so we have a bunch of machines and
the way with the blue I'll give you a
broad answer that will look likely
answer the question so we have a bunch
of machines we deploy services gradually
so most of the services we deploy half
on half machines so shut them down
deploy a new version should bring them
up again everything's fine then after
half a minute or something we deploy the
the other half the back end like I told
you we have around 50 services so every
machine has all the services inside
ideally that that's the full vertical
their vertical slice that's not actually
that's that's another answer to your
question that's not actually true not
all services are living on the same host
some of them for instance we have
database services we have distributed
database services which are dedicated /
for instance five machines a cluster of
five machines dedicated to a particular
distributed database that's also then
then we take care of that auto also
explicitly yeah I understand your
question now and this was one of the one
of the reasons why we didn't do it that
way because we had more of these not
only databases but also stuff in PHP and
Python and everything final question
unless it's a Java question and then we
won't have it only problem I see this is
the maybe your particular case is not
that big but again not putting like any
any offensive or anything but we at
spotify we have roughly seven data
centers so we built a similar thing
cross data centers and the only problem
I see in your implementation is that
Erlang messaging no to note it's not
that good over unreliable networks or
between datacenters do you have an
experience with that or how do you use
is that we do have experience with that
we don't do that if we need to send
something to a different data center
there are much better ways to do it then
airline distributed message passing like
you just pointed out good that's all
thank my Jewish thank you and remember
to vote remember to vote as you leave
the door</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>