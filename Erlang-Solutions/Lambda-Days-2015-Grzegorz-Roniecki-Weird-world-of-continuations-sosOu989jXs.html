<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lambda Days 2015 - Grzegorz Rożniecki - Weird world of continuations | Coder Coacher - Coaching Coders</title><meta content="Lambda Days 2015 - Grzegorz Rożniecki - Weird world of continuations - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Lambda Days 2015 - Grzegorz Rożniecki - Weird world of continuations</b></h2><h5 class="post__date">2015-05-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/sosOu989jXs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome on my talk today you will hear
about continuations and this year world
of Conservation's what I mean by by this
world world a long time ago actually not
long time ago few years back I was
working in this company this was my
first job and I was a Perl program so
you may think right now pearl what I'm
doing here stay wait wait a second
Pearl's not that bad and it will be not
the only language I will be talking
about today
so in this company was this Perl program
I was recruited as a software tester by
but later I was turned into a programmer
because on the first day of I actually
during the interview I told my boss that
I know Perl and by knowing Parliament
yes I used Linux and some scripts copied
and pasted it in the comment line so
when he asked if I knew parallel what
would you say you are a student fourth
year and do you know that yeah so I
became a programmer and also JavaScript
programmer because as you may know Perl
is not in front and development language
and it was a web application so problem
JavaScript were two languages I we were
using so I became a JavaScript developer
but there was this but this project has
had a main developer who was very very
avid user of Lisp and these three
languages
kind of forms for my programming
background from the beginning of my
professional career so as you may know
this is language with many parentheses
and there will be some parentheses today
so don't be scared down run away it's
just just JavaScript just list ok stay
stay for a while at least please so long
not long time ago in a galaxy not far
away I was in this situation and
situation because my colleague said you
have this book this is a Bible please
read it you will be floating around
through the parenthesis and other
constructs you will you will do by
yourself you will create whole whole
galaxies whole universes and I was
thinking here that it should be the
language the gods wrote the universe in
and last last last light is my favorite
because it's xkcd during our comics yes
it perfectly describes what I was
feeling back there because yeah it was
just the pearl but written in Lisp way
so now you might think oh it's it's
weird and it was beautiful so let's see
yeah sorry structure and interpretation
of computer yeah so okay I didn't
mention it yeah sure so our web
applications because the senior singer
developer had this power of creating
assumptions about it and I mean
directions in which we have to develop
this applications there were a few for
example the functional is the right way
remember this was parallel in JavaScript
so no pure purely functional language
languages but anyway functional style is
the right way to do stuff every step
basically
so because functional is okay side
effects are bad you know that yeah and
what's more yeah
naming is card name is card so my
colleague was very very strict on this
if you don't have to name something just
don't name it so if you use some
function and you use it one time just
align it so okay so you are building
image
yeah so besides naming there is thing
about variables and return there but
this for our this was our assumption I'm
if you had to return something it was
kind of slow yeah
now you may wonder how how can you deal
with things without return because
without variables you may you may now
scallop for example barbell the
difference but without return yeah
actually it was concept I would say
taken from Lisp scheme which I will
describe later so and because returns
are bad and returns are passe
so we had to use some kind of hack to
pass return for yes so we used complete
continuation passing style CPS for short
for controlling program flow I mean
program in all programs web applications
so to do that we had some YouTube
utility we used some utilities how many
of you know what does car Kuder and cons
mean yeah oh yeah this audience is nice
but for those who don't for those who
don't anyone can explain in two words
what what are the synonyms for heron
cooter maybe well no first rest head the
tail yes exactly so these are basically
words invented in nineteen pieces
actually for the Lisp programming
language in the beginning come to
computer programming this on the first
IBM 701 I think computer there was this
36 bit word which had first 15 bits
which were contents of address register
and the next 15 bits which are contents
of decrement register so hence the name
yep and the cons what's the cons
construct yeah so how does construct
work we will see in a while
and another utilities we used map will
to reduce how many of you know that yeah
if you don't and you're here you should
just you know
okay and as I mentioned continue passing
style for a program for and some kind of
fancy stuff which will be described if
we had time if we will have time for
this Y Combinator anyone okay not so bad
not so bad nice so little one for those
who don't know this please basically
least 101 and five minutes maybe minute
you have to know one thing
this is the syntax yeah actually this is
very very important a construct because
this is actually nil an idiom manual is
differently dialects have new okay this
is new that's all and this is actually a
singly linked list and some kind of
little act like they like let's talk
about program to scheme which is one two
three because we construct list which
consists of atom one and then list
constructed from atom list oh no no no
no no from this side this is a list
which is constructed from the mill node
and three which is constructed to the
previous node of two and previous node
of one so basically this is something
like that because you know Lisp has this
kind of macros you know what macros are
they basically the universe you saw
created by the guy in the first second
slide was using macros and something
like it's some stuff like this so this
can be notated in the list notation like
this this is the same as this so one two
three nil its list of one two three and
you can see this and is some kind of
vary for example unbalanced binary tree
which has nodes 1 &amp;amp; 2 2 &amp;amp; 3 and and nail
on the right side so basically we we
just came to the to the easiest
impatient
which is one two three and the
parentheses and if you do the cons on
this list it will be something like this
yeah easy easy
so this one on one you're good you can
do more Lisp stop read about it if you
if you didn't if you haven't already so
back to our web application we used
pearl so pearl is not easy
yeah so how did we do this we programmed
it by ourselves so we had this comms
subroutine car subroutine and cooter
subroutine which basically this is how
many of you doesn't know April syntax Oh
few people know maybe so for those who
don't this this is a pearl way of
passing of arguments signature because
pearl doesn't have seen arguments in a
signature of subroutine here you can
just access the argument array which is
denoted by at underscore and extract it
unzip extract it assign it to some kind
of variables in the parenthesis which
for the list context okay so one one
would win wouldn't be five minutes so I
won't be you know deepened in the
details but basically you may imagine if
this is a cons parentheses first rest
and these are arguments and just return
and array reference created by the first
element and their appearances to a list
the reference to array which is ready
easy easy peasy yeah this is peril easy
so car was is actually kind of similar
because videos the reference to the list
scholar reference the list
LST variable which is a an array and
because this is evaluated in the list
context we can have this first element
of this list list and the rest like tail
you know and just return the first
tournament and the same decoder but we
return the reference to the
to the areas so easy yet but you came
here for the continuations what are
continuations who can tell me the
difference between these three and three
words closures callbacks continuations
what are closures yep yeah
yes sir I won't say this again to the
back of a closure Eastern function which
captures some kind of local state yep
okay callbacks anyone yes sorry yes so
compacts are basically functions which
are pastors and arguments you have to
have language with which allows that but
yeah and confirmations simple simple
explanation please because we will be
sorry okay so we'll be deep into that
yes yeah so basically you you guys just
provided should correct definitions for
Commission's but in different
different definitions in the sense of
confessions can be as you said callbacks
which are passed and executed as a last
last step of the current sub routines
current function and hence can be can
emulate return or continuations can be
some kind of control flow structures
yeah so listen listen yeah so first
first things first quick implementation
of pop nothing fancy here but language
you know JavaScript this is a example
implementation of map what's important
is the function here which is executed
here this is a callback this is not a
continuation yep I agree yeah so
basically this is the usage of this and
this could be a kind of native use of
the same in the JavaScript I mean newer
newer browsers supported Internet
Explorer 8 does not ok so this is the
same in the Perl definition usage and in
the plain pearl you have actually the
map which is much more terrorism concise
it's here it's the same but it's purl
style you know code but it's actually
it's quite readable map the underscore
you know Scala and this understood
concept is the same kind of current kind
variable just takes birth program this
list it's fine looks nice yeah it's
actually this is the correct answer
because we did not use this construct
it's it tends to be nice but if you have
this a lot longer body of the block of
the function here it tends to be not
written up very readable so yeah sorry
not enough because it is very we don't
have a parenthesis so and just example
for each and usage not very important
what would you have to what what do we
have to do if you want to have a
continuation here because this is not
confirmation remember this is some kind
of function is which is a callback if we
have some kind of continuation we have
to for example add it because this is a
current some kind of function which will
be executed as we said as a last step of
this of this function and this now is a
confirmation in the sense of SS you
mentioned so yeah so basically you know
in Perl there is no concept of unit unit
type but yeah oh yeah so what's the
difference as I said before callback is
just a function which can be passed as
an argument generally which will be
involved later and continuation is a
function which will be passed and
invoked as a last statement it may be
even more readable and example in a few
slides okay because okay so we'll go to
this no because yes yeah but actually
condition does not have to be a function
we will go through that okay so remember
this is easy about continuations we will
go there okay they will be there so
addressing your question about
continuations this
this is not the code which uses
consummation this is just a code which
is a kind of read line by line yeah
standard imperative code code which does
capitalize capitalized guy is exactly
blah blah blah yep easy peasy but the
flow of the program
oh it's actually does this returns to
the main program does this does this
because it treats right like this and we
use continuation passing style with the
continuation which are right now this
will be something like this we have the
same the same logic but you use with
continuation we pass additional argument
a function here this is a callback but
this is executed with the result we
don't return the result we just invoke
the continuation with the result as its
argument so now can you see the basic
difference continuation can be called
back cover can be contingent but it's
not it's not hard street you know so
basically as you can see and the program
flow looks like this now we have main
program which has become cut which
invokes some conquered
some kind of confirmation which is our
function capitalism print which does
capitalize and some other function print
and does the console.log so the program
flow is in the sense of for example
debugging can be easier to the back
because you have here you have this
whole flow available right from the
beginning actually so but the downside
is what you have to do this yeah yeah
you can get stuck overflow
yeah this could be true
so listen listen because as I said
continuation does not return just invoke
another function you can we have this
possible Stack Overflow yeah we have
this nice-looking flow but we don't
return yet
what's the hint we can have this call
back let's say call back and invoke
invoke it instead returning yep it's
clear so it's continuation passing style
to be very very very very very clear
here this is not a continuation passing
status is an identity function without
the continuation passing style this is
identity function with a continuation
are exact yep
clearly so in the real world we use
continue wheels confirmation passing
style actually for example using Ajax
calls this is jQuery in JavaScript if in
our JavaScript people probably know the
jQuery library and we just invoke do the
post request to this to this address and
when we have the data back we have this
callback and to do some stuff yeah so
basically when you do JavaScript you
have this whole bunch of callbacks you
can be because of a synchronous model
yeah at the same is known GS so for
example this is the function read file
which obviously read after each file and
does something when this is when there
is error or data so if there is an error
throw an error else console.log read but
now we have this problem because when we
if we want to use continuation passing
style we don't have to return or we
don't have we don't we must not must
must not return and we must not for
example throw because it does not fit in
the flow we which we see which we saw on
the earlier slide so what we do we just
pass and
another another callback which can be
invoked for example assume that we have
this dysfunction with Mal cps and
instead we using one called black which
has two arguments error and beta we get
two callbacks error public and just an
ordinary callback yeah cool
so to continuations since the one yeah
let's that's okay because if we have
this error we will go there and we if we
don't we go there and the program
continues and actually this is kind of
neat because error callback can be
anything I mean you have this you have
this function which reads file and it
does not it's not coupled to the error
handling I mean if you throw it is not
coupled to but it is burned it very very
the flow is nice and you can pass an
error come back for example to die
the program dies or exit or just I don't
know write some alert on the in the
browser yes so it's your choice
yeah so basically here the
implementation of grid points EPS
provides some context in this argument
this is the only way basically so you
have to write things differently I mean
this implementation if you want to
access some state of the error and state
of the program during the error you
actually would have to pass some kind of
state here error state actually yeah so
continuations and as it grows we can
just write like this
this is pythagoras pythagoras the
tacorian be like okay so you have this
rankled pitagoras
yeah theorem yeah thanks
and using continuation passing style
it's it's weird
yep because we can do this just
sequentially squaring and adding the
results and we will add this the same so
this is even worse example and we may
imagine remember our web application
what I said in the first slide don't
name things if you don't have to so the
consequence is we could just have this
function name and put here and it will
be much more easy to read but in our
application actually didn't do this
because if something is used just once
for example like multiplied or art just
inline it so now imagine how this is
looking
yeah this pyramid and also Stack
Overflow possibility and this is a
problem this is a problem obviously this
is a problem in the language like
JavaScript which actually does have
stuck and Kevin can have Stack Overflow
and does not actually have tail
recursion tail call optimization I mean
because why this for Tara Carson tail
call optimization tail towards musician
history what is the difference between
tail recursion tail call tail call
optimization can you can come in
basically anyone not really tail
recursion is just the fact that you can
yeah this special case of tail call
without an optimization part yeah the
special case of technical because this
is not a tail recursive
mutation of a factorial function because
why anyone yeah maybe you don't see this
in if you don't do much functional stuff
but for example if we were using Lisp it
will be much more readable here yeah
because this will be the last I mean so
this is a tolerant version Taylor
Culbertson version yeah so Tyler Carson
is the thing here you have Tyler Park
function which is the last thing called
itself so tail call is basically the
most simpler guys when you just have
this let's say continuation or a call
back which is called in the tail
position yeah
easy peasy and the optimization is just
a trick of a compiler or interpreter or
whatever which does does prevent you
actually from having stack overflow
yeah so instead of doing this pyramid of
do message is called or you know this
kind of stack growing here you can
compiler can automatically translate
this code to iterative version because
this does not grow here yeah you can see
this it's quite easy but as I said hello
optimization is the trick of a compiler
so you don't have to worry about this if
you write the right thing in the list
for example the compiler will do this
for you and you will not have a stack
overflow but in power for example how do
you do this you can manually call the
table you may you can manually do the
table
yeah but you have to just use this
module and what it does and actually
takes the salute cutting subroutine and
passes go back go back
for example here if we use the tail in
Perl here manually this will be
the current stock of this function will
be recalled replaced with these
arguments so this is kind of hack you
know because the stock does not grow
because we replace the arguments which
were the current function in equation
you know if we see the stock of the last
last execution of this dysfunction well
this would be just 0 6 and no sign of
these arguments so it's kind of hack
yeah more it's it's not a kind of fact
because this is a module the module
which does beautify the way of you of
implementing tail call optimization
using tail coat musician intro because
basically what what it does it does this
as I said just assigned to the arguments
list something and invoke it by going to
the definition of the current function
of this function if it's a tail call
position just go to the current function
definition without with another
arguments but actually it does not cheat
it does do what it does
yeah because tail call optimization is
the manipulating of of the stock and
state and you may you may just end up
with not readable stacktrace
yeah it can be a problem but you don't
have Stack Overflow yeah actually you
can you can invoke use the tail in power
for example here you can use invoke a
function with this tail call which is
not in a tail position
yeah basically in this example this will
be useful yeah
can you repeat I think that answer is
because you are passing just a function
there's it's not just another argument
to pass to the tail called function it's
not a difference so as you can see go to
it's not lying or is not lying you it
just goes to the function with this with
these arguments so co2 is bad is it
actually yeah no it's not that bad
because it's not like you are using and
writing unreadable code but compiler
interpreter does it for you so it does
not eat you if you if you trust your
compiler interpreter it does not meet
you so continuations actually I lie to
you these are not there is there is not
the only meaning of the continuations in
the sense of continuation passing style
it's not exact continuation yeah as you
said because what are continuations in
fact they are not even even functions
because continuations are abstract
representations of the program state as
reads from Wikipedia from the page of
continuations you may wonder what so go
back to the least part will is 101 and
this universe creating thing because
list can be just this parentheses thing
and no constructs like for example I
don't know if or elope or throwing an
exceptions are catching continuations
are there are this abstract
representation of the concept of can we
extract representation of concept for
example if our draw or even return
remember we didn't use return why
because in the list in the
you know our protagonist language we it
just basically didn't have to exist so
continuations there will come two
nations I mean by real there is this
confusion
yeah because continuation appears here
as in continuation passing style yeah we
talked about this and for example
continuation as an abstract say
representational program state can be
for example first-class citizen in
language like the system scheme for
example what's interesting for example
ruby has this first-class confirmations
but there are not actually functions
there are objects so continuation does
not have to be a function
it's an representation of state and by
representation of state we mean that for
example we can have the whole stack
trace of the current function which is
involved and we can just grab it and
save it for later yeah so basically
first-class continuations a lola's
allows us to recreate program state yeah
because we are now here in the function
with with these arguments and is stuck
in the function world if we just save it
and invoke later it does it should not
be the different result yeah so why not
so let me tell you in an example you are
in your home it's evening and you're
hungry yeah so you come to the
refrigerator refrigerator and you just
have the confirmation save it and to the
pocket yet so we have a continuation
yeah we are hungry remember we open the
door we have this for example butter we
take bread do ourselves sandwich have
something for example cheese and yep so
we just made ourselves a sandwich and
now we take our confirmation pick we are
standing in front of the refrigerator
with a sandwich in the hand
and we were hungry so we just eat it yes
so we had this continuation we saved our
state of stock we are hungry standing in
front of a refrigerator but some
variables changed I mean some state
changed not variable sorry sorry some
state changed we have this sandwich yeah
so continuations first class is first
class citizens for example in place have
this this function is construct called
as current continuations abbreviated
with call CC which is a control operator
and actually it could be the only
control operator of the language you
don't have to have returns if the
Charles because you can implement it by
yourself just using the Khan CC yeah
so let's let's do some ways it's maybe
not not 101 but we'll try okay so this
is I think this is from Wikipedia and
what we are doing here we are using the
call CC here by let's take the first
line we just define the function we just
defined the continuation just inside
instantly to the false - false it's
nothing like you and then we define the
test function which defines a local
variable I and the magic happens here
yeah so we have our continuation we put
it in a pocket
remember what it does it sets the
continuation defined here to some kind
of current continuation the argument is
the current continuation yes okay and
what it does it's just increments I and
returns okay let's see the usage of this
so we have test test this year remember
this function with the call CC inside
because we is the
assigned by using tests we assigned the
Connie confirmation to some K and this
term has some state if we invoke test
its it returns 1 if we invoke this once
it returns to twice means 3 but the
magic is now happening here we just have
this context continuation which we use
here assign it to the another one
variable here and just reset the
continuation we're just going but we're
just going back to the entire yeah so
because we are going back back in time
what's the first what's the first value
of y its 0 and returns it by it returns
its value by incremented by 1 so because
we arrest set this constellation it it
Springs 1 and then 2 but if we have this
another continuation reference to the
previous confirmation it will print next
value of 3 which is 4 because it's test
saves that save this state of this first
continuation yeah you may see the
picture now don't you yep
so basically you may just think yeah I I
know this I mean is this some kind of
generator like in Python uses Fightin's
and anyone yeah so is this some kind of
generator yes actually continuation is
an abstract representation of the
programs of the control program state so
generators can be implemented as
implementation of some kind of
continuation yeah and it's true for
example this is this is another may be
more practicals like slightly more
practical example we want to define some
kind of new function which will just
display the inverse of a positive number
so if we have to it will display what
1/2 1/2 so it is
it is its inversion yeah so we define
this function and of course we have the
problem what if we have zero because you
cannot divide by zero by anything by
zero yeah
so if we have zero we just don't divide
just within false but you see this is a
problem if you have the list of 1 0 2
the result of this would be 1 false and
1 and then 1 and 1/2 because you don't
terminate you just go with the whole 3
element list and do the math on this so
we have to do some kind of check and
after the using map function map Mac
slash function you have to check if any
of elements is actually false to be sure
that the result is only consisted of
valid valid values and you can do this
by using continuation so instead of here
just returning 0 we use use our
continuation here yeah we put it in our
pocket just use it so instead of the
result of this being one false one and a
half it is just false why because if
this goes here to this branch of this if
it just involves the continuation which
just returns and actually what we did
here we just implemented some kind of
exception throwing for example here yeah
because the continuation here uses
serves us a purpose of a of an exception
so yeah basically continuations are not
only meant as a in continuation passing
style as in for example jQuery objects
call but actually confirmations are much
more abstract concept which can be used
for example in lace to implement control
structures any control structure and
it's the beauty of of Lisp as as I told
you a few times
that
you can create whole universe by
yourself which is nice but also very
very very easy yeah so that is beautiful
isn't it
call CC so if you don't if you have not
ever a used list or any kind of this
I mean scheme rocket whatever maybe
after this talk you will just sit and
read something about this because it's
it's kind of nice yeah without having
any kind of language construct we can
actually implement return a throw
whatever using current continuation so I
don't have any time to talk about Y
Combinator maybe maybe you all read
something about this basically it's
their way of defining and recursive
function without naming it because as I
said we didn't name things if you have
the recursion you have to have for
example name of a function above or the
function definition person invoke it
with within itself but with Y Combinator
you can do this anonymous recursive call
for example sorry I don't have time for
this so maybe maybe next time any
questions yeah yeah I can answer you
after this okay because it's not that
quick response so basically let me say
just one thing about Y Combinator here
is the link to the very very nice
explanation of Y Combinator using Python
so it's it's very it's not least not
scary yeah so if you want to just check
it yeah so thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>