<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Google APIs and Erlang | Coder Coacher - Coaching Coders</title><meta content="Google APIs and Erlang - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Google APIs and Erlang</b></h2><h5 class="post__date">2012-11-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cPfdOCrKxek" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is here I work at Google I'm a
developer advocate on the bus by here's
me I just like to look into the big
picture of my face so what I wanted to
talk about today was web services and
particularly how whether it's possible
to consume them from further and by web
services are online services I hope
there's a little bit of principle here
for people that are building web
services some of the things we've
learned over about 10 years of doing
this and a little bit of practice as
well so if you do want to go and
consumer the data off of google web
service you've kind of got a hint in the
right direction how to do that so the
first thing to point out is that for us
web service is pretty important to some
of our products it's like that's how
they grow some of them that is the
product it's how you actually go ahead
make money is by calling web services
you know something like maps for example
the integration of that there's charges
against there that's how you go ahead
and leave the front of me money which is
really awesome that is a product the
doggies developed so what services mean
something to us and there's something a
lot of teams want to build internal if
they're building new product they want
to support they wanna make a service
available so developers could integrate
but it's also a challenge because it
takes time to actually go ahead and
build these services now there's you
know things that can make that easier
but it it it takes some effort it takes
some implementation so to try and make
it simpler we invented majeed it gdata
was a standard still is a standard is
pretty much dead now but a standard for
representing data for web services model
they were thing as a collection is based
on atompub it's extremely restful has
loads of really nice properties it was
it was very successful think you have a
towel here these are the
these the MFE is that you can call from
from GD commands like 25 different api's
there was a couple of billion queries
per day going through the exactly eyes I
mean there's a lot of people using them
to do a lot of things they really worked
the problem with them was that the
developer experience was not ideal and
there was a challenge for the
development teams within do so you'll
see here we've got reference guides
client libraries the sum of the API is
but not alone he's actually going out of
building an API men as an engineering
team you have to take on that work to do
now because internally Google we're not
making web service calls we're using
protocol buffers it certainly there's no
HTTP me gusta so if we expend extending
a web service out with something extra
the team has to do and when it's a bit
hard they have to go away now to model
their project into this due date format
have to make it fit out a lot so that
was format it was a disincentive and
then you have got a client library if
you wanted people to use it you have to
make sure there's a good library so of
course we have a standard migration of
managing gdata for managing this XML but
if we wanted to make it really easy to
use we need to the library that's extra
engineering that's extra things from the
team's do so your team you're on a harsh
deadline you've got to get your product
out this is the kind of thing that
unless its core you want to do our point
of view as wide a company that's not
ideal because we can't make things
available to developers
Angie data also had problems for users
so there was a wonderful graph of
someone's preference on jus data I don't
know if anyone here has used you dicked
over when use it impossible but the
actual API is the actual format itself
because it was so true to atompub was
hard to use it didn't model the domain
that well it didn't model the users
expectations in particular that well and
there were loads of odd edge chase type
things which turned out to be really
common like it's restful so you get a
resource you with modified and send it
back well if the resource is really big
that's really painful we can have any
we're doing partials it's very much a
thing that is easy to do if you use mine
with no job which has nice legs ml
support to be more painful if you're
doing in JavaScript and of course in the
intervening years JavaScript has become
one of the most important places you're
going to consume a name you know from so
we realize that this kind of bad
experience this problem and if you're
developing web services would you want a
wide variety of developers to choose
that is the kind of thing that will come
up you might be developing using that I
fantastic but people consuming it could
well be using it from android or
objective-c and iOS or javascript it
seems easy to consume that is it is easy
to work with and that's one things we've
realized he was so we thought well the
problem here was lack of standards it
was too hard to reuse code the Lord even
a written elsewhere so that's why these
things were difficult you didn't map the
domain because we don't using the
standards that emerged for those things
some of the other provides particularly
for a google buzz madman am so I there
was a push to make sure we use standards
we went away we use georss and media RSS
and portable contacts API team
OpenSocial all this good
it was great we obeyed all of the
standards in the API to make them super
easy to get into but there was a problem
because just because something had been
documented as a spec didn't mean it was
actually widely used and if those things
weren't widely used they weren't easy to
actually get involved with they went to
write client you had to go and learn how
this spec work had to go alone how this
spec worked as well you have your own
life how this network and if there was a
problem with one of the springs then it
didn't actually connect it wasn't a case
of us guide what we've implemented
perspect right and the spec is broken it
was your client libraries there's a
problem with your API because you can't
realistically you should be able to do
so we kind of came back and looked at it
again we realize that all of the api's
we were building had substandard
inclines we have resources and we wanted
to operate on those resources we wanted
to do some methods on top of those
pieces we wanted to make that easy for
you both externally and internally so
what we decided to do was build a API
service the API service would
standardize all of the best just like I
know the biggest all we have web machine
which is to write me with a fundamental
basis for doing restful system you just
put the application code into this talk
and work machine coming up that's great
it's a really good way of extracting out
the bits don't you don't need to be
considering to your application and
within Google we wanted to do that for
long orbitz for logging for
authentication for quota management from
rate limiting for managing of keys to
managing of which services you have
access to all of these things are
standard all of these things do not need
to be repeated from every chain we just
needed to work within that structure we
had to find these methods these
resources
so we came up with our API service of
actually really step offing your and a
half couple years ago which let us have
something like this list of the good way
of the iphone so now if you go to a
given project if you want to access the
service you'll also naval access for a
service you just turn it off just go in
and check the service and it goes and
asks you to accept any terms and
conditions this is all standard behaving
if any API had tons of conditions to
accept we could do them through here so
we can make it very easy for people who
want to integrate with us yet Emma you
see we have 53 API is that worker that's
great that means our internal teams are
taking advantage of this and they use
you because interest rate forward it's
making their life easier to expose their
services so one of the problems though
is the to make a good developer
experiment we still need good client
libraries we still need good ways for
people to interact with us and we don't
want to push all that resource backbones
of the team and I want to say are you
making new programs are at exchange
cellar team don't write a client like
before that's too much work we got 53
api's how many languages do we support
for each one of those aprs what we want
to do is have one client library /
language look at all to all our ideas
and take advantage of that so again this
is that the idea of the as much as you
sit and work out how a user should use
your product or should use your website
it's the same idea applied to developers
is the idea of the if someone is
developing and interacting with you then
you should think about what their
experience will be like you should think
about what their perspective is more
expectations they will have so we want
them to be able to use Google services
in a consistent way across the services
and we will want them ideally to use a
pre-existing plans so if we're going to
support a lot of egg guys we need to do
it some more automatically so what we
did was using this framework using this
infrastructure create an API for our
api's and what that resulted in is this
I called in the discovery service and
the discovery so this is the discovery
this is a JSON schema which contains a
list of all our AP art it print one here
we have you know what it is the
description some information that is in
metadata and most importantly a link to
the discovery document for that specific
API and this is actually following of
the Jason schema standard each
individual service is that documented in
the same way so we got a big document
like this the guys doing says what the
API is where you can actually hit it
what's the endpoint because we go into
one layer to address all of our term
services we know what the endpoints are
chemically you know how they're going to
be communicated so we can say is the end
point if half you have to hear here's
the types you might see so we have a
large description of all the different
types this is really important for
generating plant migrants in a language
the kind of languages i prefer languages
like you have some dynamic typing so you
don't have to worry so much about
getting everything back but if you're
working in a strongly typed language you
really need to make sure you've created
objects or you've created types that fit
all of the structures that you're going
to receive although it's going to spend
a lot of time converting or build
interfaces but I understand so by
defining all this in the document we can
write generators you can go through that
and we can open source them and that's
exactly what's happened with our byways
so each of these documents to find the
type and they also define a bow they
also to find the resources and the
activities so this is the google plus
public data via this doesn't retrieves
data than something on bus and so we
have resources like the activities we
call post people we have comments in
front and on each of those you might be
able to do it so the method for
activities has yet on get it tells you
which the HTTP verb is tells you how do
you actually don't worry this you
posting it to put some data in there
you're getting to retrieve some data
what kind of parameters can be passed
all those parameters passed or the query
string or are they part of the cars how
are the different variables included
them what does the response look like we
refer with the response back to those
schemers who know what type of object is
there so we have all the information you
need to build up and people and what
that allows you to build is stuff like
if you hate the API Explorer is cut it
exactly what it sounds it's something
that you can click on you can click
through you can see the different
results and then you can actually try
the coil right in the API today so you
can go all the way through and make the
call and see what happens without having
to write any code so if you're just
trying to work out whether an API does
something that you wanted to you can do
that without spending any time writing
code we could just try it if it works
you can bring it into your application
so that's pretty useful and we open
source them to make sure that they're
people will do an example of working
with this thing it's that there's a
really deep old exam
so the kind of things of value one thing
that you'll notice though people have
done with this is someone actually built
a little discovery checker the pings the
API and sees when stuff last change so
if we ever accidentally leaked an API
you are those that each occasionally
happens and this is just quite nice tool
all it's doing is just so here's what
the difference is at each version so
someone's keeping track of Oh what new
features have you released across a
bunch of France they're interested in
they can do that automatically and it's
really nice so I said we had five
libraries in this helps us generate
client language but each client library
needs support it needs a community
that's going to work on it or it needs
an owner inside Google my dear be both
so we have these ten libraries that are
a kind of main on main climate some of
them are very much developed by google
oh that it's pretty obvious one go where
we have big teams to work on the
language itself python in this case
because one of the core developers in
the API team is Python developer and he
works at the 500 so the others are much
much more maintained by community or
there's people the scent pouches and
contribute that's like you but this is
still 10 languages out of hundreds and
probably a good 40 or so common
languages this is not everything and we
don't want to be in a situation where if
you are no lengths and you want to query
that you can't so I was looking at this
lets you started looking at this on
Monday see what would it takes query one
of our API is is it difficult and it
what the odds no well obviously it's
pretty straightforward you can see from
there sure most people can already see
you it's going to be just
HTTP call and some Jason thinks it
assists during forward and I so I
thought working how much further could I
go in you know in a day or so is it
possible to start looking at the
discovery API and I started playing
around with that and found it actually
was really pretty straightforward so
what what we sort of got to was a half
just some little things of example of
querying through this and thought of the
code imperious is sort of up on get up
and I am far from the world fest length
a minimum so if anyone looks at the
color github and has suggestions on
improvements or structuring please feel
free to suppress or let me know just
leave a comment or raise an issue on it
because I'd be really happy to solve
explore and understand the best way of
talking to some of these api sinner and
what the whole thing is is structured
around in this case is really just these
using the HTTP HTTP see what and lock
you Jason too so because we're dealing
with JSON we need to adjacent Dakota
maki json to seems like a good one this
means we spend a lot of time pulling
stuff out prob lists but it works pretty
well and it means we can go away and do
all the things that you would need to
build an API Explorer about to go query
nous avions so if I hear what I've done
is just already set up a plus service
when the keys for a plus service so what
we have what we have with something like
this is I'm just creating the gem server
and I'm storing some stating it about
your education that will need to go talk
to the services so most Google services
most of the really hard you can get
without needing any particular
authentication
so if you have a case where you need if
you have a case where you just need to
go and get some data you can generally
just call the google service however
there are great limits and if you're not
authenticated you will get hit by those
against you I be so if a lot of people
have been making calls in the same IP
you will hit the racing then it should
be a certain number of queries per day
if you try and do it from a Google
office or a Google building like this
one you will definitely hit that limit
so there are two ways of dealing with
authentication with our API and one of
them is just too simple eight the IP law
that says it's like making this call on
behalf of some of them that's when I
passed the number of the layer then
that's really easy the author you do to
do that is actually just depending key
evil something parameter to the way
through the other one is off and we'll
look at how often a little bit our
office of course slightly more
complicated and if I'm getting any user
data then you it's really important to
have more in there so once we've got the
once we've got the service great if we
could actually just go in and start
doing things like pull out the AP ID so
all this is doing is retrieving that
document and listing out which api's are
available very very simple code very
simple interaction just retrieving the
list from json and then we're just
looping over the api's around someone
get it back is a list of the API entries
and we just in this case need to take
the URL in a tight lab we can store the
rest of it too late to you so that we
can go back and get it but the core
discovery dog is really just there and
directory it doesn't contain a great
deal of information so unless we wanted
the I corner wanted some of that
information we would just throw most of
that way just get the URL we'd actually
need for the API and then the API itself
we can just call to retrieve the methods
and resources available
so if it bounced into a bit of code here
so the API methods is just a case of
retrieving the document the main
document that describes our particular
API which in this case before plus
service this was our last dog to be
teased or such that's so fun and we are
they going to get away yet our document
and pull out all of the methods and
based on the base URL is just a place we
can actually quit so that's just the
route 12 via the root of the service
which mountain I come to the top here
you can see is just google api for
ComStat possums much we want all of the
API diversions and we decided to version
them in the actual URL rather than using
a header parameter or any of the other
ways of doing it simply because it's
more of it they look at it and as a
developer it's immediately obvious to
see which version unity in the same way
it's immediately obvious that this is
JSON and how its structured because when
we actually return the JSON we pretty
print in by default you can turn it off
so if you don't want the extra new lines
and tabs you can turn on pretty drinking
but by default we leave it off because
it's easier for a developer to see Oh is
a response I got back and look at their
immediately without having to run it
through a format that's the kind of
things we've been doing to try and make
the developer experience a little more
pleasant if you're working with with the
api's so we put out the base URL and
down the bottom we pull out if I can
scroll we pull out all of the methods
use display so creature the resources
just going to go into that and then
iterate over and grab all the methods
out and store those as a set of tuples
basically just keyed on the method name
so we're returning is yeah or attorney
is the method name nor the idea in this
case which would be something like lust
or people or get plus the activities not
search your soul mapping the park and
the actual crop of JSON or Dakota chase
on the representative methyl because
we're going to use that when we make the
call to actually construct how are
polish of them so if i factor here once
I've got that of course the you can do
things like listing all the methods that
are available which is just drill and I
can actually go away and start making a
call to the service so what we're going
to do is call the bus stop activities
until such service now it's just clear
the screen 20 plus directing people
search with a query string which is just
for this we'll see if anyone's talking
about their langhorne and I just let
that out
yeah so um supposed to go this one and
there's someone Salmonella Factory and
then sort of our face recognition and
opencv so all this is doing is just
querying inter the standard API and
getting back for the JSON sports so the
call method function here is not in any
way specific to Google+ or to any one of
the services it's using the data
contained in the method object instruct
what it needs to we're getting passed in
service which is just the name of the
service want to talk to the parameters
which is just are basically the
Protestant parameters the body which in
this case it's going to be blank if we
were doing anything that involve writing
will be including that in the actual
body of the request that's going to be
some JSON and then the actual method and
mistake so the sort of three areas we
have to pull together are the parameters
themselves which could be in the path
could be in the query string any edge we
need in this case we're not going to
need anything as we use into simple API
access and and then just very touching
water back to the URL itself so the
first stage is just get the parameters
together if you have a look at something
like get path function here all I'm
going to do because i'm lazy is look at
what in the parameter list that we've
been passed in and see if there's any
matches for that in the path from the
API document so if there is a parameter
you need to be in the path it will be
something like curlies user ID so you
can just use the regular expression
library that simple replace would have
imply to go in and replace any instances
of something like that user ID with the
actual user ID value if they're not in
there we'll tag the model as query strip
now we could be a lot smarter than this
because each parameter in the discovery
document is actually tagged with using
the path poison aquarium bubble butt
ease of use I just look through a lot of
time in the same way we can go through
and attach a query parameter for our API
key this is a simple API access and then
we just take any other parameters we've
got and fold them into a standard URL
string so that's just going to give us a
question while key equals W come through
if we're making a get request and we
actually determining what the type of
request is by looking at the document
you're not guessing we're just going to
look at what the document says the
service once we will either give it a
get call which just sends the URL of the
headers it's just linking request URL
with some headers or will expose will
send your own headers will also set the
content type and pass whatever body has
passed in so for the real vanced client
libraries we generally have some sort of
marshalling to automatically convert a
object or a top all in an appropriate
structure into the JSON luqman even so
that's something you can generate ahead
of time because we know what the types
are we going to parse it so if this case
we're not doing that just because of
time but it's relatively straightforward
to go through finally we're just going
to go away we're going to make the
request on pull our response back so
that's although we did here pull
together a single URL it goes away hits
the endpoint it comes out to be a past
seven point and comes back useful JSON
which we just nuke through done but just
little for integers little more action
so that's the basic way of communicating
with an API but we run into a problem if
we want to call something like this in
this case sir this is to get a user's
profile so this is going to use the
profile use the blast but this could
equally be game you know connecting to
your account in gmail this could be
getting some information about ads
you're running it's there's a whole
range of services this is he talking to
where the type of dates we're trying to
access is possible it's attached to a
certain user can the sooner state is
attached to a user account we run into a
bit of a problem we can't use the simple
API access we need to know that a user
has actually authenticated you so we
need to implement hole and the new
google services all use OAuth 2 so
that's similar p off the same spec as is
used Kleiss a facebook and various on
linkedin what a lot of services are
offering login be safe and it's very
very simple there isn't a level of two
client library but they're kind of
doesn't need to be it is a incredibly
trivial system to implement so again the
discovery document could help us because
both to is based around an apple of
scopes you have kind of paths which you
can do things too and if you don't each
action will be associated with one or
more scopes that a you that our service
requires in audit is so it's quiet if I
want to go away and call lots of people
get I need to have approved access to
that scope and user can approve or not
approve any range of scopes the
different so this is what I need to get
I don't have it yet
getting it in 02 is the slight
difficulty is you need to send the user
off to vo or to providing usually that's
going to be my web browser so if you're
doing this as a web service anything
when the users interacting lead directly
it's not too bad if you're doing it from
a device it's a little bit more trick
you don't mean I can get the user to
somewhere but if you get a code give it
back but it is tool it is tall so in
this case I'm just going to generate
Europe and that URL is going to redirect
me to in this case it ec-council google
com I can't fire that it happened to be
quickly because I've already all set to
go to this application but passed up
google chrome is actually redirected me
back to localhost 8080 so this is
redirected me back to my application so
once i have approved the application
google or whoever the authentication
provider is redirects the user back to
your and in this case my app is just
they're coming out a bit of thy needs
chuck in to do a token extreme so what I
get back from this is a home and a bit
of state the state is just internal for
me to verify I am the person that sent
that request so no one can spoof the
there has been a bow or flow and the
other make is a code the code I need to
send back to the Google authentication
service and then they'll come back to me
with a token which I can attach to my
requests that will confirm my arms oh I
say so that's what they get there and
then if I make the muscle people get
call again I get a bunch of data I just
Chuck that through
Josie another format you get my name and
a link to my profile thing so I can
access the personal dating so actually
writing those functions is not at all
complicated we have the first time which
is just get off URL all I was doing is
just sticking some things together so
this is taking the client ID the I
specified before in one action
creatively on Jeff putting together the
redirect URL so that's telling it where
I would like your user to come back to
when I'm done the scope which is
whatever scopes I would like to get
access to understate it is this kind of
personal parameters i use just to make
sure no one spoofing when i actually get
that response back I take the code I
take all of the state which I have
internally and all I do is construct a
call to google so i can also google
pablo social poker i'm going to pass
back code that i got from the user my
own client cid my client secret which
only I should know so this is just going
back and forth to me google and again
the redirect your and if that all
matches i will get sent back the token
so the way you actually would get those
kind of code is straight from the API
console so straight from the same place
that you enable services is where we
also that you manage love tokens and
everything else so in this case there's
this is the one I was using for this I
have a client ID which as this it has my
secret and it has the redirect URL so
unless this matches or recreate it
unless this matches though garlic yeah
then it won't allow usage of this
application one slight thing to know in
case you are doing something like this
it is really important to do distinct
parameter so I don't actually check it
in this function it actually gets
checked where that function is cool
somewhere around yeah so there's just a
guard on the function on the handler the
handles this the checks that the state
that has been passed in matches state
that's stored yeah if you don't validate
that that state is the kind of
statements given to you by the user is
the same as the private state the one
you generated then you do open yourself
up to being smooth and it is an easy way
for someone to break into application if
they're trying to if you're trying to
use off to secure so just a quick note
worth making on that so that's pretty
much it like this there's nothing in
this file which is specific to Google+
or specific to any Google service all of
this work for all of it so hopefully you
can kind of see how easy it is to
consume a service like this and maybe
some ideas but you're creating services
things that might might make a
difference as I cept for that is up on
github along with the flow that just
went to them so please do take a look
and finite your comments or issues or
things that you would like to do better
on it I would love to there to be an
actual you know top quality beuerlein
client library that's certainly not it
but it is maybe the first few example to
convey something on
that's about it thank you does anyone
have any questions protocol buffers from
example yeah loads of people are
implemented another project for
serialization walk oh they obviously
feel that um yeah I don't think there is
identity the obviously no no I um I
don't I don't know i don't know if it's
it i don't know if it's it's possible
that it's just not that interesting and
this is the reason that we haven't well
a lot of survey questions about protocol
buffers which is the serialization
format we use internally and the RPC
service though is used to kind of parse
those back and forth and it was you know
why don't we just release the RPC
service anymore just into those but one
of the big problems with that is
JavaScript rights you cannot just go and
create a socket if you're in a web
browser yeah you can pretty much only
communicate over HTTP and that is such a
huge proportion of I mean it really was
one of the big things bar api's is how
much them get used Johnson because
JavaScript isn't just even desktop it's
its mobile web and a lot of mobile
applications are using tools like phone
app or called over which actually are
running JavaScript in a web browser in a
native application so it's really really
common to have that use case and it's
really important because it's more like
none of things even if you know everyone
was was Ravenel or services by them
whatever format tomorrow I think HTTP
will still remain hugely Michael purely
because the JavaScript nothing else and
in general I think HTTP is the easiest
way for most people to get started so i
think it's it's an important it's an old
stuff whatever that we have anyone else
okay thank</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>