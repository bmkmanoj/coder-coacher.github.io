<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Jan Henry Nyström - Zaark, An Erlang Themed Voyage into VOIP and Messaging | Coder Coacher - Coaching Coders</title><meta content="Jan Henry Nyström - Zaark, An Erlang Themed Voyage into VOIP and Messaging - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Jan Henry Nyström - Zaark, An Erlang Themed Voyage into VOIP and Messaging</b></h2><h5 class="post__date">2014-07-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ottHn6U9kwE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you well let me start Oh Fred will
grunt bugly thy misc for gracious are to
me yes pernel gobbledygook on allergic
b-but bit of Vogon poetry to get you
started it's been a long day hasn't it
well I can reassure you it's not not
going to be anything exciting nothing
deep but they might give you a few ideas
so I'm actually going to give a
presentation about sock where I can't
work as the software architect and we
are focused on voice over IP and
messaging it's the messaging in
combination with that and it's going to
be an erlang theme voyage through what
we have done is doing and will do with
the theme with the focus being where can
a start-up in this case you so long to
the best to the best effect because you
have to of course use a tool work out
the best tool for job right so I like
what won't always be what you want to
use occasionally will be but that's the
thing picking the right tool so the
company it's based here in Stockholm you
also have an absurd office which is
lovely since I live in it up soul but I
spend actually most of my time is calm
when the trains are running that is we
are an independent software vendor it
was found in 2009 we still no startup in
fact we haven't really got the proper
lift off it's privately held we have my
extensive domain knowledge when it comes
to voice over IP and instant messaging
and we provide modular scalable and
reliable solutions that's what we try to
do and it's based mostly on open source
but we also have private area stuff in
there when sort of the the open source
isn't enough
so some highlights about company we
provide carrier-grade platform-agnostic
systems it's globally so we're pressing
it all over the world with a scalable
infrastructure at least that is the
intent we provide voice over IP but also
call out to landlines we have rich
messaging encrypted communication and
Bri we provide an SDK and white label
clients that's it that is a current
focus so we're not targeting the end
user of these services but some anyone
that wants to provide them and want to
leverage that by using our
infrastructure to do that either hosted
by us or host by yourself that we
provided we also have in-app purchase
and web payment solutions and we have a
number of agreements across the world
for what the PSTN of course connection
out to the landlines and on average we
about ten to fifteen percent under skype
so going up against big boys but it all
out in fact started with pling it which
is end-user consumer product it is a a
both on Android and iPhone application
that you can use for instant messaging
and voice over IP and pstn calls that's
where it all started and we have used
roughly 2 million customers and most
Jews we have of that today is in the
Middle East so that's what not legacy
it's it's Nora Jean right and we're not
going to bandon them in fact we're we're
going to very soon release a new version
of this new and much improved version
and we're probably going to extend that
as well but it is not the primary focus
anymore so I mentioned SDK right this is
not based okay but it will always be
important because
we will also be our own customer and use
our stuff so eating our own dog food
that's important you know all the
weaknesses if you actually use it in
anger oh and yet we actually write a
grade higher on quite on these online
things for similar applications fail or
high but we have estoque cut customers
as well one on the more well-known ones
here is Scandinavia airline systems more
commonly known as SAS which wanted to
provide more custom engagement with
their euro bonus project the scheme so
they wanted the customers to be able to
use they your bonus points to call call
landlines basically but also providing
VoIP and is the messaging well it
doesn't actually have instance messing
today but it will very soon you're
constantly improving so the solution was
to provide a Sark base system or which
where we actually run the system for
them but it's white label so it's brat
holy branded SAS and we all this also
web payment portal so you can actually
pay also there and sa could launch this
in a very short time and if you ask our
application developers yes it's the boss
a very short time they work very hard
with this and we also have a sorry
customer in South Africa called trumpet
who wanted to have voice over IP and
messaging and they have a voice or a
pipe IP solution today in there also
just in the process of launching list
and messaging part where we provide an
SDK solution and we were also there
hosting that solution and they had no
experience with voice over IP o IM for
that matter as far as i know but in a
very short time we managed integrate
that into the application they already
had an implicit application but it
wasn't doing this so that was added so
that a little bit map the company what
we do so technology wise if we look at
the estoque the features we provide is
we have one development platform it's
uniform across iOS for the iphone and
android for the android devices it
supports multiple devices so if you send
it's the message from one of your
devices you will see that on your other
devices and the same thing if you're
getting a message or an incoming call
all your devices will be aware of it and
in fact all of them a ring but you
answer one right we also have address
book integration so you will see in your
dress book what other uses in that
network that also use this service you
can actually see and that's actively
pushed to the device so you can see whom
your friends have this so that's sport
we have voice over IP of course it's
voice over IP solution which we today
take we're going but we're in the
process of taking sip online as we call
it you're always online your application
is along this is background it will
actually be connected which previously
was very hard to see but
improvements being made in these two
platforms and made it very possible to
do it was issues with nothing being able
to keep alive through Nats and and also
drainage on battery but those issues
have been dealt with not so much by us
but by by the by the Android platform
and the iOS platform we have a PS there
now as we said as I said you can phone
to landlines we have rich I am so we
have is the machine we look more into
that we have seamless I apns as GCM
support and for those who don't speak
weird acronyms that is when you get
pushed your phone right the application
is in the background but you get near
this banner saying oh there's something
happening as you can swipe it that
that's called referred to a push normal
we call an external push because it's
going through their systems but you you
don't have to worry using our SDK if
work platform is target is the set same
and we have cross application
connectivity so if one of our customers
resellers then this whatever you want to
call them have several applications you
can cross those applications call
originally we were going to it probably
will in the in the long run make it
possible for those of our customers who
want to be able to call cross
applications for different vendors but
not now we try this and and it makes
your head go funny when you think about
it not on server side it's fairly
obvious to have to do it the problem is
to make it in such a way that it is
understandable to the end user because
you don't want to you have one app and
you get call from someone and you how
he's got this app as well and then phone
him back you're talking to realize no it
hasn't he's got completely different app
you use phoning between them right so so
it
we might end up providing support for
that but we're not doing it today so the
voice over IP as I said multiple devices
sip online and we have the push with the
APNs and the GCM I am we have
feature-rich there in that we get again
all the devices right and and we have
the support we have the choice you can
have use an sdk for I am voice over IP
or both so that's the choice the custom
our customer make so we have support
multiple device as I said you have peer
to peer or private messaging as a
normally refer to in in XMPP circles and
multi use the chat rooms you also have
that ability we have delivery report so
you will see that I've sent this it said
sending that means it's actually arrived
on server you will see that when it's
received so you will know if the other
party has received it we have archiving
for messaging but that is of course time
limited we're probably going to offer
premium services eventually where they
can look but infinitely long archiving
but also we have but have will have in
some cases in these feature lists
lifetime and revoke mechanisms for
messages sometimes it doesn't make sense
sending a message and after certain time
it doesn't matter so you can say okay
this will be the end of it but that
support is actually do we will also
support attachments position files such
as audio video photos contact
information or in fact instant messages
I mean imagine that you for example cut
out a big lump of text you want to send
out someone it normally doesn't make
sense to get it presented saying your
iPhone because too big so you will
actually get it as an attached file
instead you can download it at all
convenience and remote Kinser swallow
this contact management so you can add
in the lead context of course and also
as I said you will automatically be
informed if one of your the people in
your dress book have the application so
it's available you you will see there's
free phone available for example to them
if it's a voice over IP application and
presence so we are globally present ah
but globally oh well in since we are we
are have data centers today in stock on
your highness burg and we are setting up
more we also on Amazon's web so that's
almost global but that's the almost bit
right and that's why we are pressing
Johannesburg connections within South
Africa is fairly decent to that side the
world isn't as good so hosting a service
for them who wouldn't really make sense
if you have it in Amazon because you
wouldn't get a performance that was
useful and also of course we want to
have data sensible reason that not all
of our clients will want to have things
in amazon's net simple as that I mean
the customer decides right and scaling
we'd sorry in scaling we do both holding
horizontally we're just ramping up more
instances we also provide as I said
different service centers and so on so
we have better performance locally and
we are that's one of those who will
expand in we try to provide high
availability in our systems I mean it's
no point having a voice over IP if you
can't use it right so of course billing
way single points of failure and we
normally have a cluster based approach
treat except for things where it doesn't
really make sense like for the load
balancers that's a active passive
solution normally a DNS based oh no
a virtual IP beso use you fail over
quickly and also having this multi sewn
in Amazon but also having depending of
course on the needs of the client in our
data centers and in Amazon for example
so if we lose connection with Ireland
where we have most stuff or it could
still keep on running perhaps that
reduced capacity but there you go you
can't get it all so what about the stack
no technology real stuff right right so
we have open sores and provide your
mixes I mentioned we have the SIP part
it's based on open zip opensips where we
have a number of peach p scripts provide
more than the basic service there so we
do see a sip signaling call detail
record generation call control because
we have some added call control since we
have the ability to the phone well use
landline and voice RRP and so on and
that's partially controlling that i
should say we use asterisk for our voice
validation when you register the service
of course you have to we have to make
sure it's the right phone the right
device and you have the option either to
get an SMS or voice validation we use
asterisk for that today we have a number
of proprietary java and PHP parts and
those are the user management you know
accounts and all that we both have a
course you sign up like foreplay amuse
sign up for our services free service
you download you sign up but we also
have a connection for when you have the
client has their own use base with their
own counts so valet through that instead
and also reporting reporting well what's
that well it's not just statistics its
billing of course we're talking this is
voice over IP and M is basically
telephony isn't it so you end up with
billing the systems and that is a
proprietary system today
which is better from enterprise job with
fair amount of PHP sprinkled around
there for for various bits and bobs and
then we have a number of PHP parts
actually for very supporting services
and in connection with other services so
we have for the push part where we send
messages through apples and Google's
push systems we have the address book in
connectivity we have for SMS is sending
out these validation SMSes voice
validation well it actually connects to
this risk that way and social
integration which we currently have you
can use the I if a friend of yours have
a Facebook ID and using this service you
can call him using the facebook id
rather than his phone number or
something like that and we use for most
of our back-end storage data storage
it's my sequel and currently it's it's a
mix this is partially what has been so
it's a hot standby solution and we use
couchbase for Speed layer to have quick
access to data so having it at an arm's
length so I this is about Erlin right I
haven't mentioned any early and there
wasn't any early until the IM arrived
because originally there weren't any IM
imp Lingam was just voice over IP but a
quite natural choice when setting up and
i am is to use each jeopardy and in fact
we used a Erlang solutions supported EG
buddy fork call Mongoose and originally
in fact all development for this was
performed by Erling solutions for sock
before i joined so it's basically a
mongoose but we have added that we also
use some extensions like the delivery
receipt which we need
we need to know that delivery has been
made but we also have a number of
proprietary extensions such as call
control orig we needed to add because we
couldn't be I mentioned sip online all
time we couldn't be zip on line it
simply did not work so the the part that
was the easiest to add something like
that was in fact xmpp server so the
extent PPS herb became responsible if
the other part is not online to make
sure we get an external push when
someone is calling you so that was
implemented than that we also have the
social network integration all that it's
beautiful course in the person extension
in fact in the eg jeopardy server and we
made some changes since we're talking
mobile devices and data traffic can be
something those are real expensive in
many places so we want to reduce
minimize especially since you get much
more reconnects than you normally do
when you buddy where were next and
people client typically you're online
right but with a mobile phone you go
from 3g to 2g you lose your connection
you have to reconnect again or you go on
to your Wi-Fi or you're going to raid
your shadow for a while or something
like that happens so it's very frequent
day after we connect we want to limit
the amount of traffic this that is sent
so for example with the chat rooms if
you join a mile to use the chat room we
consider you always online that's that's
the way it's Delft win so you don't have
to the client don't have to join all on
the me again when you come online and
since we do archival if you send to
someone they will get it because it's
archived for them so next time they come
online that those will be those messages
will be retrieved by a client we also
use plain authentification because we
only only allow TLS
connections anyway so it's HTTPS that we
running so md5 checksums don't really
add that much and we have a customized
message I'll kind and of course because
you have to customize things a bit here
to make it working and this a few are
the bits and bulbs just just to reduce
the amount of traffic we send back and
forth doing this so that was original
now we're moving to what we partially
have done and what we are in the process
and do where we want to go we're going
to keep opensips what all the PHP is
going we're replacing by Lua because all
the people responsible these parts that
is me and and our system guide them up
call him what you want prefer Lua it's
it's an elegant language it's something
I can't really say about PHP good
intentions but so 6 zip searingly still
stays in though Pacific's but see the
are generation called control are
actually transferred to a free switch
layer which we have added so we are in
process of transferring there we have
Lewis scripts but for more complicated
call control we're probably going to use
the modeling part of free switch where
you can you ask you li implement that in
Ireland asterisk is going to carry
because we're going very probably
because priests which can do that as
well it's nothing against the asterisk
is used that we're using free switch we
might as well you use the voice
validation support there instead and the
propriety java and PHP well it's
probably going to stay for four
foreseeable future but we actually want
to use open source stuff for those parts
for the crm and four for the reporting
the reason is we don't see any leverage
in
supporting that ourselves and there are
good open source alternatives that's
that's the reason for that and all these
small bits and bobs services around
there well I said that I you may realize
that I don't love PHP I do love her like
that so and and they are really doing
things they have normally are doing
fairly simple things but they have to do
many of them at the same time it has to
be reliable yeah Berlin Berlin will do
so we're probably going to start
migrating them on a need to change basis
when there's any real need for change we
will actually transfer this dialogue one
of the things is that PHP is actually
quite expensive to maintain the the
tendency to always want to please you is
very basic very hard figure out the root
causes of of errors because yeah you
calling a method that doesn't exist but
you still get a response that looks
actually perfectly valid because you
wanted a value I give your value but you
know i would rather had crash we're also
going to add the attachments support
isn't there all together yet and that
will actually be implemented on the
server side my sequel is staying but
we're going to already started so for
some of the new parts we already
switched over from having a hot standby
solution to the poco next to DB
clustering which has very nice features
and is has a proven track record and the
most important part is that the hot
standby solution we've seen we haven't
actually experienced we've seen other
experience that when you actually end up
with a split brain for those because you
do a it ends badly when they try to get
back online get things synchronized and
couchbase well that
works very well so we don't see any
reason to change that at them this this
time and the stack well we're going to
add a lot of extensions so for example
this screen management which is an
extension what's that well actually that
is so that when you lose connectivity
with the egb server you don't you don't
close the session immediately this is a
notional you have a time to reconnect
you don't have go through all the normal
negotiations you do with the serve about
availability of services whatnot so that
is going to be added there's also an
extension for quick star which we like
we like getting a clients in there
quickly in the service oh and yeah yeah
lots of other things and perhaps Wow
having worked a long time with erling
and getting your hands on an old I have
to say I like product you get this
desire to improve bits bits and things
but we'll see how far we get with that
hopefully managed to push some of it
upstream as well although it's going to
be interesting since we have so many
prepare were so many of our own editions
that no one else would really be
interested in so questions
yes questions thank you for the
presentation I have a question about the
address book management yeah so does
your client usually upload their address
book to servers to do the work or
initially when you install the
application the address book will be
uploaded to the to our system so we will
keep it in our system as long as the
account is active of course we don't
keep your information otherwise it but
then so if if someone comes online we
try to look up it's this one in any
address books we know well then if
someone registers with us we look if
you're already there then we'll actually
push that information out to the clients
of those of your friends basically
they're already have the application but
after that we don't keep sending the
entire address book back and forth no
but I mean is this a lot of data to go
through to its currently it's one of the
bigger data sources yes the data pieces
data we have all kinds going to be quite
big eventually and also Testaments will
also grow but that is one of the biggest
parts we have today still not to use got
two million users right another question
is where do you store offline messages
well we have archival so we're all kind
everything so we don't have the Madonna
offline so what the what the client does
when it comes online this is a slight
extent variation from the original
extension for for archival is that we're
sending the query to an IQ to the server
which responds with all private message
conversations all might use sir
conversations which you have new
messages in and then those are retrieved
paginated of course to the client last
question just about the scale how many
nodes do you have is your ad on the
pencil how you count I mean we have we
have a cause we have three XMPP service
at the moment we have three database
pakona databases we still have two other
my sequel databases used by parts of the
system and so but this will grow and
also then we have the the cluster in
South Africa so all's I have we tend to
do at least three of everything so we
have a bit of fault tolerance I don't
want to be woken up in the middle of
night because one so ago star right when
two goes down they'd better walk wake up
so that's the team do you do any kind of
fraud detection for you stay on course
perv we have various black lists for
example so people trying to phone
premium numbers so those are blacklisted
and there are also we try to see if you
try you if you try to reduce too many
applications too many times and so on
they have been for example in schemes
earlier where you got a amount of money
to phone what points the phone phone for
which is money really when you sign up
and then people will try to sign up
again again again so we do have some of
it but I wouldn't say it's not a major
part yet but it will probably grow I
would say we have been occasionally
fooled in the past but we wouldn't be
pulled that way again
thank you ok more questions
speaking as someone who's knows
absolutely nothing about instant
messaging what are the interoperability
issues across vendors today across
vendors yeah me could you for instance
connect to skype or some random other
one that implements this hirai do you
mean other services one could
potentially do that of course but a
moment we have enough problems getting
our heads around if we were to have
different vent different resellers oh
how a resale is sending in between and
making that understandable to use in a
good way and I thought you can't even do
that what we can but do we don't want to
because we can't we we haven't figured
out how to make it a good experience for
the user so that you will understand
what is going on because otherwise say
that you have downloaded to our our
we're figuring this room we tried it
sort of trying out and you download to
our applications I have one and what we
then had was that I preferred to call
the one that you had if he was the same
otherwise it connected to the other one
so you have the one I have so I phone
you fine everything's fine then you d
install that one right so you don't have
it anymore we can't there's no way we
get informed of that there's no sport in
Android or the iOS their support there's
nothing for that so you just install it
and I phone you but our preferences are
saying that I should use the same app
for you but it doesn't exist anymore but
you have a nap but all the times you
phone your phone using that one to me
and then we you know you phone up move
me with the regular phone cursing me
because I didn't call you and I say I
tried to call but you weren't online
ever and it's very confusing so then you
have to some
% what kind of applications you using a
that is usability thing mostly that is
complicated I sport other vendors the
question you actually asked like skype
well if I would they allow us that's the
first question and the second I'll is we
want to want them to do so our
applications right the comment was that
are we want telephony generally yes and
no but then again this isn't general
telephony at the end of the day it's
more about applications of providing
quite often used an added user
experience to somewhere application that
isn't primarily about voice over IP and
then it becomes much more a moot point
okay then I think we are done so one
more thanks to Henry for his
presentation and don't forget to vote</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>