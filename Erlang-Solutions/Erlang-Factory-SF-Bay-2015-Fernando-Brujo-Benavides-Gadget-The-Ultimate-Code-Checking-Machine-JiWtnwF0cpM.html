<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Erlang Factory SF Bay 2015 - Fernando Brujo Benavides - Gadget: The Ultimate Code Checking Machine | Coder Coacher - Coaching Coders</title><meta content="Erlang Factory SF Bay 2015 - Fernando Brujo Benavides - Gadget: The Ultimate Code Checking Machine - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Erlang Factory SF Bay 2015 - Fernando Brujo Benavides - Gadget: The Ultimate Code Checking Machine</b></h2><h5 class="post__date">2015-03-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JiWtnwF0cpM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay thank you everybody for coming it's
a lot of people I like that I'm brujas
he said I'm an Argentinian I mean a
parameter for most of my life but I
started working out like being paid to
code 15 years ago and seven years ago I
met Erlang and as well I met the open
source community my previous employment
was in med c sharp and it was not really
open source but once i once i get well
and I started to know the community and
a way to contribute and stuff like that
and for the last year that's all the
code I wrote because being a CTO like
put me away from it but the compromise
is that now that I don't need to code
for production products I can do stuff
open source stuff all the time anytime I
want in particular gadget which is a
tool i will show you today it's very
very focused on that as well so it's one
of the things i do in that time i work
at anaka which we are a company that
started in 2010 and the last year we
started we joined the family of along
solutions we are most most of us are in
Argentina we have an office there we
usually build applications for Android
and iOS devices without long back ends
and most likely ruby-on-rails
administrative tool and they are the
characteristic for those applications is
that they have their highly concurrent
and they have multi like millions of
users and those of them then two of them
are whisper and Tiger decks there are
the better examples for that and along
the lines like while while working on
that we focus on releasing every small
piece that we think we can share with
the community as an open source project
we have a long list of those i will give
you a link to a page where we have all
of them at the end of this presentation
and today I'm going to talk about the
tool that will help you work especially
in open source projects and help you
keep them in good shape and well-written
we quality and checked and stuff like
that but i want to show you first the
motivation that led me to create this
tool and it all boils down to one simple
question how good is your code that was
the question when we started working on
this but it's a I take everything
everybody here is a programmer and we
work like writing code we get it to to
work we usually do tests so we get we
know we create code that solves the
problems that were presented before him
but the question here goes a little bit
deeper than that something that we found
particularly important for open source
projects is that your call it not only
works but it's also good in terms of
quality of maintainability of
performance etc so I will separate this
question in for more specific ones each
one of them associated with a tool that
will that helps you achieve that goal so
the first question is the more funny one
like I bet everybody has reading goal
here do your code compile is yeah like
the question is a little bit more
relevant if you say it like does your
code compile without warning like when
you do when you run a make or LLC or
rework compile do you get a list of
warnings when you're compiling you even
if you call work do you get the list of
things that say warning you have a
dysfunction that's not you said or
whatever if you do so I would say there
is something that you need to check
there because the compilers that the
Allen compiler
users are very few and very specific and
those things so there are things that
you need to check to make your code
better even if it like it's serving its
purpose and there is a you know there is
an option in the compiler that will
treat warming sorcerers it was a video
of a discussion with along MK people a
while ago if that should be turned on by
default as in Arabic MK is I will I own
the yeah turn it on by default team
because i like my program to compile and
to not emit any message that I need to
fix anything and also the question is if
you if your code compiles and you don't
see any warnings on the console are you
checking every possible warning because
the airline compiler has many of them
and for instance my experience with
rebar or combining things manually is
that not all of them are turned on by
default you have to add them on the
river config file or on your console or
your email file whatever so I would say
that good code is called that when
compile produces no warnings but it will
move forward a little bit another thing
that you can check because airline is a
dynamic type of language you can write
code that actually comprised with no
warnings but you can be calling
functions that are not even there and
our land provides a tool to detect such
things like calling and the final
functions or duplicated functions or
exporting functions that are not use it
anywhere and the tool is xref and the
question here is oh it's not moving hey
yeah how you check your code with xref
do you do that regularly if you don't
have a tool special tool to do it and
you want to do it manually you will face
with stuff like this to start to run
xref as OTP provides it if
you have to come on you first have to
start the process with a name then you
have to add the library path which is
usually called get path the path the
file the libraries in your current
militant machine but sometimes you have
dependencies and other stuff that you
have 12 and you have to add it by doing
that then you have to tell xref what
things it should check or where are the
beam files that it should check usually
on the alien folder but if you have an
old structure with apps with different
apps each one with its even aiming
folder you have to do that one by one
then you get to go to the point where
you can run an analysis but you have to
run each kind of analysis but by itself
like one at a time in this case we're
running in and the final function calls
check to find functions that we are
calling but they don't really exist xref
provides six different checks they are
not so many but six lines of code
instead of one it's a number and then
you stop the process and you get to deal
with the results and the results look
like this tuples with one or two tuples
if the problem lies within just one
function you will get one one module
functionality double if your problem is
like the on the final function calls
we're in a function your Colleen another
one that doesn't exist you get the two
element apple with to a module function
rit descriptions it basically says that
may function bad with zero arguments in
my module two is calling function for my
function for in the same module and my
function for doesn't exist very tedious
right single people in River created
River xref which is a both a command for
the command line and also module where
you can run xref and just check
everything and get results
in this way we're not only the warning
is explained but also you get a module
name file name I mean and a line number
where you can see the problem very very
helpful but I use a long MK i don't use
river or not always and I won't make
xref but not it's not there yet we
submit a pull request to week a while
ago I encourage you all to +1 it so it
boils up you know and it's merged and we
can do make xref we darling MK to add
that functionality what we do was to
create xref Runner Express runner is
basically some sort of reward xref very
very similar it runs almost the same
thing but instead of printing out the
results on the console it returns the
results of the check-in map format well
it tells you what was which one was the
check where the problem is in fine
landline number and the tuples from xref
the same ones as a result from extra
during xref directly so after that you
get to you get a point where your code
compiles no warnings no cause to an
existing functions stuff like that but
what about calls to existing functions
with wrong types and I think let me know
if it's if it's not true but I think
everybody here knows dialyzer right and
the laser is one of those things that in
my experience everybody likes yeah the
laser is cool it's excellent do you run
it no so and I train a lot of people at
the Naga or some people at the Naga and
everybody every time I get to them like
yeah you have to run the elation on your
call regularly it's great to give you
excellent results I hear two complaints
the first one is I can prepare myself a
whole jar of coffee be before the laser
gives me the first warming so that's
kind of bad for development purposes but
it's not true anymore since like I think
the last two releases or three releases
of our land they later got WAY faster
and if you don't know it Dallas it has
to be basically two steps the first one
is to create a PLT that you have to do
just once it's a file where all the data
for everything that's not exactly the
obligation is storing and that's that
takes a while but in a project that took
like 20 minutes now it takes like five
minutes four minutes especially open
source projects are usually smaller than
the other ones that big production was
so it's kind of fast and after that
point every time you run de la said its
uses that file and it takes like five
seconds it's even faster than running
your tests with so running light laser
not right in regulation because it's
slow its kind of naughty complain
anymore right but this is an actual
complain and these I have to face with
myself checking the the US produces a
lot of warming and understanding what
what those warnings are ya it's not not
usually not that easy right because who
who among you has faced those kind of
warnings yeah I see ya say same happen
to me I can totally relate to that
because let's take the first one right
this function has no local returns sets
dialyzer and that's also when the
function throws an exception right you
have a function that the only thing that
it does throws an exception clearly has
no longer return excellent i see i see
what you mean dialyzer but what if your
i still that error for functions that
don't even have a throw world in it and
the problem was a different thing it was
somewhere else it was related to the way
the function is called it cigarettes
same goes for the second one but what I
want to say here is that about that
second item the second complaint is that
once you r analyzer constantly it only
will be affected by the changes between
the last time you run that I lesser than
the new one so if you have to find a bag
or the problem that the relation is
reporting even if the warning is not
clear it can be anywhere it will be in
the things that you changed it recently
that should not be that many and that
makes it easier and about the first
complain imagine for a second if those
five minutes it takes to build a PLT and
everything that happened there happens
somewhere where you don't have to take
care of it it it's done for you keep
that in mind I will go back to it in a
couple of minutes and now think of your
code has a very very good code you have
a you have it compiles no warnings no
and the final function calls no
duplicated calls no running with the
wrong types dilation is happy xref is
happy compile is happy are your
colleagues happy that's the next
question right once you have your code
completely accepted by the tools that
the prawns with OTP the question now is
can you share it will you will you show
your code to somebody else and will that
other people understand that will you
understand that five years from now five
months from now days maybe and to that
the thing that usually comes along in in
other languages is a linter or in for
instance ruly you have rubik oberon see
I stuff that checks your call to see if
it matches the rules not the rules on
how to make it work but the rules on how
to write the code and when I was
preparing this presentation I was doing
my research on the available tools
because I will show you a tool that we
created that I want to show we will to
tell you that we are not the only ones
working on that I found these two but
I'll tidy I
really don't know how to use it and died
the air is down it was a website and
it's down for like two years now so they
don't really exist so we created the
last year we created Elvis Elvis is
basically the same thing that other
languages have where you write the rules
that you want to check on your source
code and it basically tells you where
you are not complying to them and to run
all this you can do all this rock after
you have compile a bit of course or if
you're if you use a long MK it's already
a plug-in you have just you just have to
do make Elvis it will go over your
source code and it will give you it will
produce an output like this one it will
check every file and if there is a there
is a line or part of your code that is
failing to comply to one rule it will
print warning like that one specific
specifying the file the line the rule
that was not followed and showing some
contextual information you can run it
even as a pre-commit hook forget so it
will prevent you from creating commits
with a code that doesn't follow all the
rules and now you have a very very good
code you created your library you put it
up on whatever you share it with ellen
questions mailing list and people will
like to contribute to it and it's like
your child right you're going to keep it
clean and good and with good quality and
it now it's not entirely up to you
anymore because if there are other
people contributing you have to make
sure that they follow the same rules
that you follow the first thing of
course is to put your coats somewhere
where you have version control so the
other people cannot actually alter your
coding in unpredictable ways but that's
something that everybody knows here I
won't go into detail
most of the open source projects in our
land use github for that which is the
same thing that we use a dinner gossip
same thing and get half comes with pull
requests and pull request lets you do
something that will help a lot in
keeping your cold clean code reviews
code reviews allows you to check what
other people want to add or update in
your code before actually merging it in
your code base which is awesome because
you will be able to detect weird stuff
about this float but it's not a hundred
percent awesome because in pull requests
or with your naked eyes you cannot run
the alacer you cannot compile it or run
xref on it and what you can do is of
course go to your computer clone it from
the repo or if you have already have
blown it okay fetch the changes check
out the branch where the modifications
are Randall eyes her run compiler ran
xref Elvis all that stuff and okay
github comes with inline comments on
pull request so you have the warnings
with the lines you open up the pull
request page go to you go to the line
because you want to help the other
developer not just mine hay bale I say
let's file you want okay this is the
problem so you go to the line press the
button right the comment which is almost
the same thing that's in your console
and wait for the developer to fix it
okay now that we will ever fix it you
have to do that again because he could
introduce a different bag and that I
don't think I don't know anybody who
goes to that process and I don't think
it's a very healthy thing to do and
that's why I created gotcha that's it
yeah
yeah something like that I will go I
will go in that in fact I will answer
that at the end of my presentation okay
so gadget is basically a service it's in
gadget in a gala calm and it's a tired
with github so you sign up with your
github account you authorize the
application as you can see it's only for
public repos and only relax it it won't
change your code at all and then you're
you meet this screen where you have a
green the columns are the tools that you
can run the rows are your repositories
you can turn individual tools on and off
for each one of them once to lease turn
on for every pull request that you get
gadget will run the tool and start
adding comments like this one this is a
particularly fine example because it's
something that everybody complains about
like compiler xref dialyzer only Elvis
is happy with that line because it it's
a local function that's not used so
nobody wants that here and they like
gasps it will go since the tools are
running a run individually in an in
parallel it will produce all the
warnings right it will run one warning /
2 but that will not require you to run
it manually like if you it will go like
it will automatically run the tools and
you can wait until whoever is creating
the pull request has fixed it all of
those things and what tools do we have
the first one of course the compiler the
compiler works with either a make file
or a river config file if you have a
make file on your project it will just
run make if not and you have a river
that comfy file it will run a river get
depth compile and it will collect the
warnings from the console
those are the ones that are written in
the comments then you have xref xref
runs with xref runner and it will look
up for an extract config file in your
repository if you have that it will take
it will use it if not it will run at a
false set of objects collect the
warnings and create them as comments
then you have the acer for this for the
version that's currently on the website
the ice are only ones with a long MK
because running the laser it's tricky
and there are many parameters that you
have to configure for your repository
for instance the dependency where the
dependencies are what libraries are you
using what applications do you want to
dialyze etcetera and so since all of
that is already solved in analogue MK we
just used it but we are working on doing
the same thing for River compiled
projects and for any projects eventually
and the last thing is Elvis Elvis is
just a pass-through because Elvis is
already a service that writes comments
so it just goes through gadget to Elvis
and back again and it uses the Elvis
config file the same thing that Elvis
already does after that gadget has a lot
of comments it has to write on github
and to do that it uses another open
source project that we created a long it
hub which started as a very simple SDK
where you can just run commands that are
translated to HTTP request to a github
API but we found several things that are
more complicated than that it looks for
instance God said wanted to write a lot
of comments at the same time and github
is not willing to accept such I don't
know blast of comments so it read
limiters and we created a we implemented
an exponential back-off inside along
each curve so if you want to write
come on the comment will be written
eventually it also provides you with a
behavior called a github web hook which
is basically the core of gadget so if
you want to integrate anything you want
with get help and listen to pull
requests and write comments and all the
stuff you have to just implement the a
github webhook behavior which will
create a a cowboy handler you add it to
your cowboy server and boom working
again I encourage you to check that on
give her its I wouldn't I'm not that
proud of its documentation but it's
growing steadily yeah it's open for
contributing for contributions because
we didn't implement the whole gift of a
bi yet so if you need something feel
free to send the pull request and in the
future okay these are future tools that
we can add for instance we can L tiny if
I get to understand exactly how if Tyler
tidier goes up back again at some point
and I get in touch with Kostas maybe we
cannot tell you as well to to catch it
and if you can think of other tools that
we we should add to the list please send
me feedback and I will check them out
and that my last comment is that gadget
works only for open source projects in
fact only for public github repos and
that's not because I'm very religious
about it or whatever it's just that I
don't want to deal with remember gadget
has to download the code right and
compile maybe you have other libraries
that are also private and so you have to
give access to give granted access to
everything to be able to compile I don't
want to deal with that I don't want to
have your private code of my server and
and be like what happens if something
goes wrong and it stays there I don't
want any of that so it's just for open
source projects for public github repos
you can find gadget on its website
gardena calif com you can find all of
our open source projects at in aggregate
hawai oh that's the our webpage in a
Gannett and we write many things in our
blog some of them are long bound some
other languages as well I am a local gun
everywhere keep have Skype Twitter
Facebook and every other application
that goes around I picked the I grabbed
the name just so nobody has to get and
that's it thank you very much so Travis
yeah I have no such no much experience
with that and when turning Elvis into
gadget was extremely simple so I just
took the opportunity and I use it
and and you get the dialyzer warnings
and you add that as inline comments in
the pull request oh ok yeah I don't know
maybe it's complementary I don't know oh
I we have a huge discussion about that
yeah yeah but at least for our projects
I don't know that's a whole other
discussion but part of the thing is that
the way we use the unit tests because
it's they are not exactly unit tests
that's the point but when you do make
this in many of our libraries that thing
will try to for instance we have a
library for the twitter api that will
try to connect to twitter and in the
test so that's a problem if you were if
you have that on a server if you are if
you're tests are doing stuff that that
will not be very properly contained to
be running in a server it kind of gets
messy so yeah it can be added but it
will have if it's if it's other you will
have a huge warning like these will be
running it in a server contained right
yeah yeah shut yeah over there
okay the story goes like this gadget we
tested the gadget with a specific repo
where we introduced it tons of problems
at the same time and so the gadget
server has one user gadget in github and
he wants to write the comments for all
those warnings at once or very very
close one to another and that hit a rate
limit imposed by github but that rate
limit is unknown github won't tell you
what's the number of requests you can do
it just stops you from doing it starts
responding with a 403 and you deal with
it so what we are doing is well dealing
with it we have a queue of requests if
we hear the 403 we wait we don't know
how much we have to wait so we wait a
hundred seconds then we have we wait 200
sorry 100 milliseconds then we wait 200
milliseconds for 100 milliseconds
etcetera etcetera and the way to
implement that it's a unhook it's
written there it's a list of numbers and
it uses gen server timeout so it just
waits for the next until it until it
gets to give heaven and it resets the
list again basically that yeah
ha no because the God said code is
private but but if you want your own
guts it like thing you can do it l on
github you write you start the gobo a
server you are the a github webhook you
know you run the icer you run xref
runner it's open source Elvis is open
source x-ray dilation of course comes
with OTP they compile it as well it's a
I tell you it's one module with a couple
of lines of code but nothing else like
that it's just very very simple it's
everything open source except for the
project itself</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>