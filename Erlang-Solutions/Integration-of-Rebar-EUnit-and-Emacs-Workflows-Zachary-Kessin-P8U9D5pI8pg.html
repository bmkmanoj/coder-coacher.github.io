<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Integration of Rebar, EUnit and Emacs Workflows - Zachary Kessin | Coder Coacher - Coaching Coders</title><meta content="Integration of Rebar, EUnit and Emacs Workflows - Zachary Kessin - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Integration of Rebar, EUnit and Emacs Workflows - Zachary Kessin</b></h2><h5 class="post__date">2014-05-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/P8U9D5pI8pg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so I'm Zack Heston I am the author
of building web applications with Erlang
also a book on html5 which I don't have
copies of I'm also the host of the
mostly relying podcast which is a weekly
or almost weekly podcast mostly about
Erlang but occasionally into other
things and a couple weeks ago on the
podcast we were having a discussion
about various things and if I should
stay over here Brian hunter who is not
here today commented that for a lot of
people part of the thing is you know how
do you set up a build environment how do
you set up your various environments to
work with Erlang and if you're somebody
who's from zoar the IDE world and you
didn't catch the IntelliJ talk yesterday
it's go watch it on video when you get
home you know diving into Emacs and this
stuff is just you know it may be a
little intimidating so I just wanted to
cover some of that that's Who am I I'm
director of API at product structure we
are a small start-up in tel-aviv we
build dropping components so if you
don't want to write your own login
registration form for your web app we
will happily provide you one one line of
JavaScript a be testing the whole works
I'm the host of the most of the airline
podcast subscribe there and you can find
me on Twitter there please follow me if
you want to follow me I things and I
work for product structure we buildings
that pre-built components that will drop
into your webpage so I want my workflow
you know I spend however many hours a
week
cut writing code and I don't want to
just workflow they're just gonna get out
of my way and let me work um which means
code she wants to create code with
templates sometimes generated test
exploratory testing um automatically
when I hit save I want things to compile
and so on so this is my goal don't quite
have it all perfectly yet we're still
working on the tools for this and this
is I think one place where Erlang kind
of falls short people who are used to
the IDE were
of Java where you know you push one
button it does everything of course it's
not repeatable on your colleagues
computer necessarily so you know so the
first thing tool is Erlang mode for
Emacs it comes with her line so I'm
disabled URL it provides a lot of sort
of utility for Erlang does code syntax
highlighting you can compile from the
you can um has templates for everything
from you know if you forget how to do uh
how to do a receive block or uh you
don't want you need a gen server you
just pull off a menu and it says gen
server and buh you have a whole file and
also by the way if you type your module
name you know you're returning a module
and the module name doesn't match the
file name when you hit save it'll say
hey your module doesn't it's the file
name you want me to change it for you
your click yes it it fixes it which is
really great certainly I just type
module a save and then it fixes it to
the file name so it's a really nice
start but it's not really up to
necessarily doesn't do everything I
would want so how can we expand it so
the first thing is rebar which doesn't
really catch up to Emacs it was created
by bash so although I'm reliably
informed that they don't maintain it
anymore one of the guys there told me
that yesterday I didn't actually know
that and it is a build tool that
understands OTP it understands the basic
structure of your OTP slot of your
project and how OTP works so if you're
following the OTP design principles you
know a source directory your approved
directory and so on rebar is your friend
and you can follow that that github repo
alright every read the text ok by the
way
okay so first thing you can do with it
is you can create a project skeleton so
here you can see I went to a command
line and I created an app app ID EUC
2013 and it created files for me an app
dot source file and you see app and a
supervisor doesn't create an actual any
actual workers those were just created
for you it's just one command line boom
you're done it's just to get you out so
I'll show you what it creates so you can
see here
you have a basic supervisor get you
everybody read it okay he I hate being
the one sitting in the back who can't
read the slide so I and then it creates
an app file and then when you build it
it fills in the modules and stuff so it
lets you sort of just again you create
an app file it's a really basic app file
but you know much of the time this is
all you need so you don't really need to
you know you want to just create those
basic files to start up just doing the
command-line and if you forget the
syntax of this command line you just
type rebar dash C and it gives you all
the options because I don't remember it
either I never remembered command-line
switches alright so this thing once you
actually tile it in the root directory
of you file you need a rebar config file
now the rebar config file is just a
Direction a list of Erlang terms you
know this is the simplest possible or
airline config file it's simply a
comment that tells Emacs to put it into
Erlang mode and by the way the comment
is optional you basically could put a
blank file there it would still do some
useful default but you might want do
something useful so for example here is
something I have a project I'm working
on now and my project is for OTP apps
you see they're called utils WM e Darwin
and off I do something it's actually
clipped out of a larger file but and you
can see they're basically just add no
when I do remark when I compile it just
going to go into all those directories
and compile them automatically and I
don't have to worry about it very
similar to make but only easier to setup
the other nice thing is it can do is if
you're if your project is dependent on
external files or external utilities you
know you've downloaded web machine and
JSX which is a JavaScript JSON library
just you don't know it and you know 47
other things off of github
that you can just put depth in your
Reber config file you give it the the
application name as an atom but you can
put a version number and then well it's
cut off and I'm sorry about that let's
see if I can adjust think okay well can
you still read that I'll put it back up
basically you get the github URL and
then you basically put a reference to
what you want to pull out of github it
also does mercurial and subversion by
the way and doesn't just use github you
can use your own local git server you
can use your own bitbucket what-have-you
and you basically can just tell rebar
just fetch all the dependencies the
other thing you can do is you'll notice
this third column which the second one
is just wrapped because it's long the
bottom one it says head and that's just
going to grab the head of the master
branch of your project now the thing is
you might not want to do that because if
you've got lots of dependencies and some
of them change then you can get into
version you know version chaos where you
know they update web machine and they
introduce some new incompatibility with
your code and suddenly you're spending
six you know twelve out you're up until
2:00 in the morning figuring out why
something doesn't work so what you can
do which into the top line I have a
three seven seven six five zero which is
the was the most recent commit on web
machine as of whenever I wrote this this
morning sometime maybe a more recent one
and that'll tell it basically do the
same thing some instead of going the
head to head repo the head of the repo
it'll take a specific commit so you can
be sure that like all of your servers
and all of your development environments
are using a consistent version of web
machine or whatever your element is so
that you know five of us working on a
project you see if he said head or yeah
head that depending on when we pulled it
we may have five different versions of
that dependency
that you know suddenly could get really
weird heisenbugs where things are
confused and stuff the other thing is
the middle one you can see you can also
see a specific branch you pull the devel
branch from that project there so if you
have a specific one they may any
questions by the way okay if you have
questions please you know raise your
hand
whatever okay the other thing you can do
is if you're running tests through rebar
you think you can basically put code
coverage you put covering they won't
cover print enabled will print in your
compliation a percentage of coverage for
each file cover enabled prints out as an
HTML file and then cover export enabled
exports it into a raw data format that
you can important to Erlang and do cool
things within our line okay and then you
actually do a build you type rebar get
depths which gets will go out and get
all the dependencies you can you know
grab it off of github and download it
and compile the rebar compile which goes
and just compiles everything and the
rebar unit and if you put skip depths
equals true it'll skip it'll skip
running the dependent unit tests for all
your dependencies so you don't have to
run the unit tests for you know rebar
and enough rebar for web machine in MO q
ab and the 47 other things that pulled
in just for your own project you can of
course leave that off and there's also
options you can tell it you know only
run this files tests hint by the way if
you have a lot of subdirectories it'll
compile them in it'll run the unit test
you can file that in the order you'll
list the sub directories so if you have
like 50 sub directories well your while
your work you move whatever you're
working on to near the top of the list
that way you don't have to wait for it
to run 87 other things for it to fail
and fail on the unit test you just wrote
you know fell on that first save you a
couple seconds per compile or more
experiment is okay
so that's rebar we'll come back to it a
minute next piece of the puzzle is
distal this still was a great idea it's
kind of suffering from bit rot
it basically is a project that allows
you to have a match talk directly to the
ER line DM you can do with useful things
like you can um you can have Emacs you
know in theory you could do our PCB he
makes and our line practice it's kind of
suffering from bit rot if you look on
their web page the PDF of documentation
they present is dated 2002 so you can
imagine this state it's flaky but it's
still useful
my favorite digital thing is if you've
ever send people use like etags and
various compilers okay so like you know
how an e-text you can get Emacs to go
from a function to wherever it's defined
well so with rebar instead of using any
tags you can actually it's very nice you
can actually query the compiler or the
the running running Erlang node and say
I have a function here you know utils go
convert to convert to binary / - where
is it defined and it says I mean it's in
this file over here with this path
direct directory path on line 87 and
then just takes you right to it so you
don't need to have the separate file it
just knows what everything is so that's
um a really helpful thing and escape
comma will take you back that's nice
all right so the next phase is you know
as you're writing code you want your
typing and you'll need hit save and what
I really want is I really want the file
to compile without you know I used to do
PHP and for whatever else one can say
about PHP you know you don't have a
whole compile cycle the compile cycle is
simply you save it you reload it in the
browser and then it you know it wrong it
compiles and runs as you load obviously
in Erlang we have a separate compile
compile language you have a separate
compile step but again I don't want to
Sara Lee have to take care of that
manually I want I want I want computer
to handle it what may have my tools
should you know my tools should do this
for me so the first thing is you can
just from within the Erlang mode if you
hit control C control K it'll just pop
up in an underlying VM and try to do you
know see file name which is great unless
you include files in weird places or
places it doesn't know about in which
case it certainly goes hell you know I
don't know where to find this hrl file
and it will give you errors so again I
just want to hit save and have it work
so you're looking for more product more
things so compile and save and test my
code with that intervention yes we can
do that okay so the first thing you
looked at what was fly max mode which is
a mode for Emacs as you type it compiles
literally just saves literally saves
temp file into somewhere slash temp I
think on a UNIX like machine and
compiles it it's reasonably fast but it
doesn't know about include directories
so frequently it doesn't work because
your your file needs the project include
file which is over there finally can't
find it
and you need to have 10 to build config
so you can configure fly make and then
you have to configure rebar second one
when you hit save it doesn't actually
build a new beam file for you it creates
a bogus temp file somewhere which
doesn't load into Erlang so it's kind of
also it's also I've occasionally seen a
crash Emacs and other people have said
like what they've seen it likewise so
we're working on it
so it's something else so to move on
proud to make mode Erich Merritt who's
here at the conference today wrote this
can see in the room all right no he's
not in the room he's around somewhere it
will take either make or rebar or other
build or presumably another build tool
but these two usually and build it with
the build tool so now you're using one
build process to build everything if
there's an error message that gets
thrown up you know you have a syntax
error you have a warning whatever it
will it'll compile it'll tell you and
let me show you what that looks like
so here
and see I replace the period with a
comma
and of course you know live demos never
work first rule of thumb but it normally
would color that line pink or blue
depending and then sort of tell you what
it was going on and you can then go and
see it so it's a really nice addition
the problem there couple problems with
it that Erica you know I've talked to
Eric and I talked about it over lunch
and he is working on some improvements
the main problem with it is if your
rebar takes a while it basically your
editor has to wait until rebar finishes
completely before it does anything so if
you know your plan second takes 20 or 30
seconds it gets really annoying so if
you want to run unit tests and there are
a couple options you can just do ask
Apex compile and then hit a command line
just type you know rebar unit whatever
and that works and you know it gives you
a nice buffer where you see all the
listings and you can look at what's past
and what's failed the other option we
don't have proud to make run it and to
do that you need a project file which
put in your file directory to me they're
proud to make our dot prajak use the dot
version if you don't want it in your git
repo and prior to make will work without
it you just sort of get something by
default but this is sort of what it
looks like and you see it's just an
Emacs list file name and then shell here
this long command is the command that
actually what do you call it runs when
you hit save so the problem with it is
it doesn't yet know how to part e unit
certian errors don't look like make
errors so it doesn't know how to parse
them yet Eric and I are work we're
talking about it at lunch it'll probably
happen sooner or later you may have
gotten get getting that a lot of these
tools seems to be working
so this is I feel like this is the
prologue to the story more than the
story itself and I think it's an airline
community we need to improve this story
so more than more this is not a place we
need to rest I think we need to improve
our toolset because you know if our
colleagues who are used to IDE look at
this third oh you want me to use that
and go back to Java or C sharp okay so
when you compile or have code coverage
information from our line you can
actually export this directly for line
you export it as HTML it looks like this
this is code don't worry about what it's
done you know it's its web machine stuff
and you can see that those four or five
three or four lines up there that are
colored red are are not covered by my
unit there's no unit test for that
function for whatever reason probably I
just didn't write it by the way if you
like if you won't have other kinds of
tests that you're running on your code
you can cover compile your code you just
put a flag into into rebar and Erlang
will gather coverage information you'll
run your tests and you can export this
file this is not a rebar thing this is
an airline thing look in the cover
module and you just I think it's like a
cover report okay look in the main page
you'll find a file but I can report this
file so we'll another kind of test like
maybe you're running quick check against
your file or you're running you know if
you've got a Web API maybe you've got
some script tests that you know see URL
or with from our browser or whatever
they come and exercise your API and you
want to know okay well I've got a bunch
of tests here I've got a bunch of code
is there any place in my code that my
tests don't cover
maybe my tests don't cover those four
lines this is from a unit test but so
you have a way that you can say okay
just turn on coverage run your tests and
see what's uncovered and you can
discover that hey those six lines there
are uncovered I should probably figure
out why either either delete the code or
somehow test them so that's a useful
thing it's in the cover module if you're
interested in code coverage and Erlang
the Erlang cover module what you can
again find it
I don't never remember all the parameter
all the options their parameters to this
thing but basically you see analyze the
file cover analyze the file and you
basically you get model dot cover module
will not cover that out and just give it
the option HTTP there and you see the
parameters and you get that file so if
you have other kinds of tests you want
to see how it covers this is really
useful it's also do it asynchronously so
need but that's a useful thing because
basically it means you've been you can
run lots and tests to figure out you
know do I have holes in my testing you
know there may be some piece of some
weird corner case where you know this
line of code never gets called by by my
one--some group of tests you know if
you're testing the API you're testing an
API you know from the API News on
coverage and maybe everything you're
testing every request you're making is
requesting gzipped that are non zip to
date you know data and you never test
that this one should give you a proper
to zipping of data then you know yeah
you'd see it in there well I'm not sure
she's sure cuz that's um a weird case
that's not actually this is just a fun
but that's sort of that alright so there
was one thing I wanted to forgot to
mention earlier about rebar and I
apologize so here dependencies by the
way if you have a big project lots of
sub directories one thing you can do is
things stabilized is you can move your
dependencies you know your parts of your
project into separate repositories and
move them into the dependencies this way
you can separate them out into different
have different people responsible have
different you know separate them in your
CI system if you have one if you're
using Jenkins or Travis or something
like that
sort of simplify things and sort of
further isolated to smaller components
your project because I'm firm believer
that you're much better to have ten
small pieces than one huge piece you
know one huge project you know I like I
like each each source directory to have
you know at most a couple hundred lines
of code and if it's more than that I
kind of feel like I'm doing something
wrong
and I need to start breaking stuff up
all right so thank you very much are
there any questions
sorry yeah I can't see a real wall yeah
I asked wonder did you see the IntelliJ
presentation I know I didn't actually I
okay we just wonder what you thought
about it you know I'm not an IDE user I
did see the Edie Edie the other Emacs
presentation yesterday morning thank you
I forgot the name of and it was eat
something something yes and I recommend
for only if you weren't there and you
use Emacs when they post the videos go
watch it because that's also sort of a
nice complement to this helps you turn
the microphone I was going to say that
if you're still using distil you should
probably switch up to EDT s the Erlang
development tool switch which is unless
you meant if you didn't see the
presentation yesterday by Thomas your
strands it's a more modern very new
library for Emacs I would have included
it in there except I only found out
about it earlier this week so for more
than a few months okay well you know one
of the other things that mother
complaints about the Erlang tools tool
community is we're not real good about
getting the word out you know this cool
new tool comes out for Emacs and no you
don't people don't hear about it you
know you can't use a tool it could be
the best tool in the world but if you
don't know about it it's completely
useless so first of all if you're
working on a tool you know somebody's
working on the tool
please tweet about it put a letter line
central no and please let me know so I
can put it on my podcast podcast is
mostly Erlang calm I think as if you're
working on a tool and you'd like to come
on the podcast and talk about it or on a
cool project or a book or anything else
please contact me you can find my email
easily enough via the podcast you can
just find me via the podcast or I'll
give you a business card any other
questions
what yeah would anybody like a free book
you had a question so you get a freebie
it's all about yours and stuff maybe
else like one I get asked a question
doesn't f you I'm Zack okay I'm Zachary
yes thank you I don't know let me didn't
have to carry it back to Israel with me
please read them and enjoy them and
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>