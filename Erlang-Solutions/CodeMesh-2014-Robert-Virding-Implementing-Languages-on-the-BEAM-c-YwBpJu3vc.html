<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CodeMesh 2014 - Robert Virding - Implementing Languages on the BEAM | Coder Coacher - Coaching Coders</title><meta content="CodeMesh 2014 - Robert Virding - Implementing Languages on the BEAM - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CodeMesh 2014 - Robert Virding - Implementing Languages on the BEAM</b></h2><h5 class="post__date">2014-12-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c-YwBpJu3vc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so this is about implementing languages
on the big this is my but the pleasure
of talking about my home so again look a
little bit about the properties of e
what what language is something a little
bit again about the compiler interface
into the compiler and something called
quarrelling some basic tools that exist
for doing this and some examples of
languages on top of the a part of it
both what I call native languages and
what I mean non native languages and
I'll explain it when we get there
so the first question is of course what
is the big this is very much a face what
we do and the big of course is it's a
virtual machine to run out and really
that's what it is
it's not designed to do anything else if
not designed to be a general-purpose
virtual machine then again most virtual
machine - I mean the JVM is designed to
run job if you're doing other things on
top of it again you have to be
restricted by what JTA can do and it's
the same thing using a bit and a couple
of the properties that beam provides
things like massive concurrency
lightweight concurrency the takers
communication process isolation the
fault tolerance and all these type of
things that did provided by the big
they're part there they will in a sense
be kind of part of the language
being just wasn't always there and in
one sense they don't affect us more
designing language we can use them if
you want to we call it the only thing
that might affect this is the fact that
how the messages are received using
pattern matching but there are a lot of
other properties as well of course it's
a mutable data
this is baked into the system this is
not something you can get around david
is immutable there is only a predefined
set of a function your number of atomic
data types you become famous and
basically from our version 17 had max
and that's it you cannot define a new
data type of a machine it just does not
allow it's got that magic build the
improved in to do pattern matching built
into machine beginning which you can use
you it's functional
will design through functional languages
you can adjust of course ignore the
return value to proceed the way the what
was the code handy works and models is
also baked into machine so have imagined
you to disguise it you had out in
Washington system and there is no global
data that's it someone might say okay
what about ads papers aren't they blow
yes they're globally accessible but it's
not global datums
and it says it uses of what you usually
wait
there's no shared stay for any mothers
so if you want global dating language
you have to equal medical service so
what language is really thinking about
well anything will anything with a
different syntax maybe even different
semantics to solve it completely sl's
other languages like this so first step
is okay so you know sign language that
means we have to go through the other
part
now the algorithm pilot is what actually
quite open much more open I think most
people realize so they can both work
little files but you can also generate
the abstract elements in text or you can
find that straight into the pot you can
tell the compiler to generate a beat
while the object code file we can talk
to internal binary structure represented
that would you then can do fun things
with you can't load them in yourself you
can send them across loads and instead
install more code or someone else's
machine there are also a number of
internal file passes you can also get
yeah what we talk more about which I
pass I like something called or Alec
actually internal internal language
inside but you can you can get acted to
yourself in many ways it's a much nicer
language file down to and do instead not
so yeah so the Eternals the compiler
look something like look down the bottom
here will be getting your edge right now
in anthrax in
coming from the left there's the first
part of course this is just the module
names its courses pre expand that does
some simple expansion of the a line
source code it looks at records removes
record information it puts a few action
add some information before finals and
things like this but basically it does
generate a like pure la pass the next
one the first big one that's converting
to corral which is done in a module
police report that's actually one of the
more complex wanted to do that
especially the Allen variable tendons
copula LACMA spoken about that I'm very
close actually adds two extra passes
into these recorded into work that's one
of the more interesting then after so
after beat recording but for airline
then there are large number of
optimization passed been built in the
part of optimizing a call and mostly
optimization goes into call this is it's
much easier language to work with the
dahle in this weather the most
optimization tips when you pass them to
something called which generates Colonel
alan and kirlyam is basically core but
all the pattern matching to be compiled
out there's a pattern matching part in
there everything's Lander lifted says
will flatten everything like this for
two simple language then just like just
those lifetime analysis or variables
then it just goes into
the cocaine which generates being sent
you can basically get in anywhere never
bother you you can also generate the
right things in assembly if you want you
that's not recommended because the
assemblers it's not well documented what
the assembler does if you get it wrong
the chances are you'll crash the whole
shoe department is most of the time yak
you don't have to do that very thing you
want to do it should be allowed to do
which you can't do from impossible so
yeah so I'm getting basically in with so
what about Korra so it's a simple
functional manager okay
it has normal ways it will scope
univariate to define variables inside
the left hand of it and then scoping the
variables in the later
it's just has the basics so a lot of
things that exist in our language we
compile the way I mentioned earlier
before that records things like this
comprehension that be compiled out to
generate it to build it you can pull out
the building present functions which you
can explicitly that's a very simple
language it supports Pat mentioned oh so
I don't have to I don't have to worry
about handling there anything special
with that metric of you that making
exactly the same way
that magical pilot of after call which
is very nice insulated if you have to do
the pattern matching by hand that is a
lot of effort it right anyway you can
make it very naive and stupid but if you
want vision is quite lovely mum ever
said before most the optimization to
dial call so if you go into the port
call it well you'll get most
optimization funnily enough here this is
something that annoys me occasionally
dynamize it speaks core at the low low
so when you pass in an airline file is
the source file we will compile that
down to quarrelling and we use the core
lmpossible touching when you get you the
abstract syntax out of the beef are you
getting the alley abstract syntax that
also conversa to the core and your
usable the whole works on local if you
look in qualified all typing
informations to lift it however you
can't tell react also
dialyzer VN doesn't work yeah you can't
tell dollars work very economical and
I've not been able to convince them to
do that they I say catalyst wouldn't
interface they say yeah come with come
with a passion will do it alone because
thank me a week drive the patch will
take there now
so that's it so yeah what does qualify
you look something like this so we're
gonna this is very simple some function
here which your sons will be only to
listen
writing like this and just assuming
everything's numbers here just some
sorry 0 ii 0 some deities but ok if you
run this if you run this isn't required
and ask the compiler to generate a full
file it will write out a file look like
this plus a few extra things like the
model information module info functions
and stuff like this as well but this is
the basic thickness of the same thing
here and we can see it's pretty
straightforward the work that's being
done here so we don't know anything
interesting the variables fortunately
they're not getting an exercise or easy
not to see but you can see the scope in
here we look for example all the pattern
matching felony case there's an
optimization in case I can match on
multiple at multiple variables at the
same time that's what these funny arrows
are around here we're actually saying
this collection equals 5 magic and here
are creating a local variable gear core
which is available wire some and then
I'm using that inside the body so we can
see the oscilloscope this thing down
here this optimize a will this syntax
with the parentheses in this funny thing
here the end parentheses that's a way of
explicitly adding annotations into the
core abstract syntax in this case is
putting out what's in there but
sanitation so this just said well we've
seen here it sadly it's added what the
compiler adds a negative cause here to
handle the case where that were none of
the others match so we have to do very
handy explicitly and in this case if
this if not the other two match will end
up in this one this will jump this just
variable will match anything and we'll
call prim up here which is a match fail
this generates the method is the failure
you see the magic and here was the here
is the top when you get out which that
music but we want to annotate well
there's an annotation here saying we
actually inside the function star which
is again used when generating these
messages
we're also sandwich it which line up as
well too
that's great but there's a later parson
a compiler which goes into checks if
there happens to be closed the switch
will never never be rich it generates or
what it and invite you've grabbing this
type of wallet play stuff you off and
then render the case it will add things
but that will never be reached
you don't wanna get any extra warning
for coding that code that user hasn't
written and that's what this does this
annotation says this is a compiler
generated and what that means is that
even you won't get the warning label so
just it's about what you do this but
it's a much more straightforward
language to to work with and
everything's been done very explicitly
for example the plus here I mean no
operators all the operators have gone in
explicit function calls of enacting
calling the model end with the variables
that back that this quote here is going
the wrong direction that's key know
which does that automatically trying to
be hopeful does it automatically
so yeah this is the example corner so
this I think is the best level it's much
simpler than the a-line lot of stuff is
being you can get a little bit still
left in there for example you don't have
to worry about about renaming variables
all the way to get unique variable names
and all this type of thing for you just
make a scope it also has a few things in
common doesn't have I'm going to define
local functions there's electric
structure something to find local
function which is actually what's being
used when you're doing this operation
you can generate all this yourself
strange enough you can generate
recursive function function so yeah this
is this so the next thing here is okay
so we now we can work on our language we
can generate one thing you'll find okay
so the basic built-in types are pretty
restricted you'll sometimes see it other
languages trying to define new types a
lenders so now you've got a new type
echo department wonder if they type or a
few thousand you will see rebels but
then you also know that they're actually
not a new data type
we're just faking everything using
Thomas so now my record is literally
their tactical and then there is some
some specialist in taxes of mafia ii
witnesses so we're taking the day and as
soon as you start using the recorder
you'll find that that's exactly what
happened and unfortunate there is there
is no way around there are many reasons
why we didn't have so okay so this is
the basics of using the pilot there are
a number of support tools to help you
define your language there's a leaks
lexical scanner generator based on flex
flex you know there's yet which you stay
at past generator basically yeah they're
a bunch of syntax tools with lizards
like your syntax tools for working with
hourly abstract syntax building that
works the arming FX in textile there is
actually also need a library for working
with and there's no parser yeah the best
mention one problem with the core is not
what lovely well actually it's not
surprising it's an internal part of
possible one says it wasn't designed to
be you to be explicit you can actually
write for fast and it's very verbose and
there's the Cuomo generated able to
malfunction
there's not that well generated there
was a nice paper from Richard Carlson
about ten years old which is almost true
but yeah so the first tool we'll look at
a bit about is leaks electrical scanner
generator it's based on next week's but
it's simpler does it doesn't have any
options that make for business it uses
regular expressions to define tokens and
it generates a number of scanning
functions so while it generates in
stream which is passing a string will
return back the list of tokens you it
also generates two extra functions or
token tokens which fit into the a like
IO system so this you see you can
generate a tokenizer
with leaks and you can plug that into
the an entire system and work actually
just those rules happy
and the example file small example
father you or something like this it's
got the definition section so up here on
defining three variants or three three
macro section so but you here which is
tentatively which matches capital
letters lowercase letters and D which
magic dis ones I have a several rules
here so here for example is a simple
rule which is almost a letter is
something to start with the lowercase
letter then it consists of 0 of war
uppercase lowercase digits for
understood so the only active student X
is quite more complex with their petrol
technology s then I which I can then on
the right hand side after : is what I
want to do here - just a little code it
could be anything but it must return
much internal structures saying what
this is and this basic structure here is
this a topical to others in this case
the first one is a token which tells the
scanner this now we're returning Otoniel
and then up the second argument can be
anything written scan doesn't care what
this is the fact that we return it as a
topic or an atom a line number so the
token line is just predefined variable
with current line number and the atom
will be using token cows which is repeat
no one with water characters that that
were using this structure that's because
what the other possible with this
actually passed rating for and we do the
same thing with a variable here there's
an uppercase start with uppercase or an
underscore and then follow zero
a slow-paced digital basically very good
sir and again we're returning the token
this case it's a bar with the token line
and natural characters in it in the
variable des matter we do other things
as well into a comment here which says
okay starting with a percent not
including zero and one not having these
new lines we'll just skip that
so the scanner will parse it or scan
over and clicked everything but we just
necessarily going to skip this time we
don't care what it so the token of just
give tokens I can do last token so I can
say when I'm collecting I can click
everything up to including the last
token I could add an extra argument you
know I can push characters back in leave
so I could take something which matches
for example the characters ABC and push
back in into the stream it's why they
said they don't have something which
take this was it and push it back ABC so
it's quite quite simple it's quite
powerful there are a few things you
can't do maybe this may be lazy you
can't put some say something isn't the
beginning of the line work in your life
it won't handle states in the same way
that
I think you know the top anyway so when
you run this through you'll get scanner
and say you can just use the functions
like this you can do use a stream
function with the characters who want to
put in in the start line and it will
return back on this to the tokens as
you've defined them and the end of the
line at the end and again it doesn't
care what the tokens look like they can
be anything but the other system
functions here and for example if you go
into the i/o module and see how you do
now a scanning spoke again how many
expressions is basically doing exactly
this call but we using your scan
function are all scalar modules there
this tells what this tells the i/o
system keeping putting characters until
this function is happy when that
functions have been returned what what
it what it returns so this case will
scan your token so scan scan everything
I forget some in token the other point
is bit off this is this functionality
baked into the ohio service essentially
I found out lately my favorite something
call me directly
they use that
so the basic idea is you you pass in a
function to do the ayah so clicking
character feels happy then you return
what if you turn us back into the system
and leagues generates these interface
function to do that scanning Cecily this
behavior we've used lalr 1 parser
generator basically act for Ella and a
generating function will generate a one
function generates the paths and you
know get back so here for example to yet
grandma just bought party say two
expressions and I define a set of non
terminals in this case ETF factor I set
number of terminals which is what I'm
getting any in from my arm my tokens I
put into it and I give generate root
symbol where I'm going to start now I
have a set of rules here so this is just
saying Annie is need the plus term and
you fix one of these I read I returned
the Tuffle team but plus dollar one
dollar three same thing goes to - it was
not one of those my just return
no one here same thing for the same
thing for what this taller one lower
three years that's the way of telling
yet what I want to build
so what dollar ones these are just
special special variables and what
dollar one means take the value of the
first thing on the right hand side view
the dollar one will be the value I get
back from the partner to dollar three
will be the value will get back from
positive glory so that Bismarck and
build one possible build my time is here
in the same thing with slashes this is
just a happy way of getting getting
pretty variables into the right hand
side we normally come to it's exactly
the same thing if you're working with
match specs and so here for example if
this ponte preta see factors parentheses
around it we just take the second one
which is you and this just built a
structure returns the structure the
limitation here is that so what's path
you to the path function past one year
is a list of tokens and yet assumes that
all tokens of tuples were the first
element of the top ones the title and
the second over is a lot more sanitation
line number and you've got more elements
they can be values so what you imagine
here is a type so this says which 15 is
flash token so to topple two others were
the first ones of / ii see this is what
yet excuse that's why for example in the
Scanjet the scan number the loots
example
if you're getting a number here could be
attacking on the type number there will
be line number and so it's very
restricted in what the equal sign it
also have one other restriction which is
Marvel slogan we that it expects to get
exactly the right number of tokens not
too few not too many if you get too few
little one out and so python passes
baguettes too many or formats I've
already passed exactly the right that
works well without I thought you've got
the dot end but if you're doing other
languages you can make this morning
people to do you might have to excuse me
depending on your language you might
have to end up that is very annoying
it's fixable another problem with were a
problem with there they are our 1
grammars is will you get conflicts in
there sometimes a grammar can't decide
do I pick more stuff what do I build
with what I've got
generally all the pretty useful by
convention like foreign keys I go but
it'll just keep on going to build
something that go with what you want to
do it like that I probably the worst
problem is but something is called
reduce reduce conflicts so it's an a
layer one grandma know that one token
look at and if you can't decide where to
go off that says I give up generate an
error so for example we would like to
write getting to a line since actually
would like to write an expression is a
patent equals expression but that
doesn't work because I cannot define it
I can define a pattern but the way a
pattern looks
means posit can't tell the difference
between a pac-man expression at least
not the first time
so complain that which is perfectly
correct so I could perhaps do something
with more more look ahead but you're
running for public you don't have enough
so what we have to do an airline have to
write an expression is an expression
equals expression that will explain and
then we had to test afterwards and
tested this first expression would
actually happen
so that's factor why you tease so yeah
yeah these are something to working with
it and getting either
now just to move more examples so we'll
start to stop looking at that what I
call the native languages so good review
respect to minute color if you haven't
heard this one you should understood its
new skin see also so what we're saying
here is these are languages which you
keep the basic outline executional their
solution model the data types really
everything but you're putting a layer on
top people defining a new syntax and you
might have different packaging around
but basically you've got a line at the
bottom more less explicitly two examples
here at Lycia and kind of things played
out both do this they put a new skin on
top of it that underneath the tail so
you get a structure that looks something
like this you've got this basic
structure but the beam at the bottom of
our line but all the OTP libraries on
the side here
you think you language and new settlers
sort of aside and you're not disguised
what the properties are the same and
they make food they can make full use of
the element if you like and this is
actually quite a smart way because if
you unless you do something really
stupid
you can even access everything in the
other side you can like programs which
my darling and your other language would
if they might be they need to change
each other so it's quite a decent way of
doing it and you will get a language in
which is as optimal as it can be
yep so these two languages here they
need to face the other part that they do
it in different places so Alexia goes in
they generates expectation things which
is impossible to front the product
generate code the other thing you can
pilot however that generates cool babies
so it's listed and the ideas have lists
in taxable the list of goodies you used
to have anything coming from the list of
one you've got real macros but is to
direct without the rest system which
means it passed me you can't make any
major changes it's got a small core
language
so yeah after that monopod so that what
that entailed was changing the language
changing the list to fit into the
alleyway so this is not common list it's
not skiing there is no musical data for
example was the Bing device walking away
they only send a group extend Allen data
types say next and our modules and
functions was that's what the system
provides if you want to put anything
more on you have to pay for you can't
for example like a lisp environment have
functions things which are either
functions will macros it's a list of
tools there's a new division and it's as
fast as running in Denali which is much
surprisingly to generating out of travel
and then into thinking here one reason
why we went on into core was that if you
look at the core part of l8v these these
expressions here are the whole
automatically most of these by injecting
the same as in Quail so the basics it's
almost one-to-one mapping into it which
makes it harder very easy the few things
they can't do is to interest if which
then maps in your cases but very simple
and if you other things apart but it's
almost exactly straight - straight
mapping it cost which made polymer easy
which was a very nice using port if I've
gone into the ARA Pacis did
location work to get this working and
then the translation of removable wafer
for those haven't seen it and it's ear
well the first three things has come
from the LXE homepage and well first one
does it took two or three approaches a
buddy use the main designer so it's a
dynamic functional language time for the
list a normal table at applications you
have to play so tell me exactly secondly
it's not really it's not really anybody
end it's a syntax which is brutal it's
got me the programming capabilities like
macros but they can't change the syntax
it has a syntax has a define syntax they
can't go and change the syntax using
macros like you
and it's what many libraries need faces
standardized agree with but it goes in
to the alamin
so this compiled down into a link but it
also has attacked new data panel
I didn't do that little fear just had
records in its ear they were destructive
they had records but they're very seldom
used I had a shock beta which is again a
key value data type but we've got
compile time checks that you know that
you that you're gonna be using to find
kids but it uses a Mac so it uses
specialized that are immaculate with
evaluate key underscore underscore
structure with the name of the stroke
usually that become ollie and then the
system can then check this this is not a
madness a destruct and a compile time we
can use this duty so again that they've
added a new data type but putting it
implementing it using existing data so
rare qualities tuples and it's easy to
talk to use maps even exactly sample
so these two languages I will make like
they want to be one native language but
they're not trying to anything strength
really it's a new skill so a couple
examples of new languages so they're not
they're based in Manali but they're not
and so the different semantics not
definitely not having data types and on
alicante to think about to do the
examples here one up a little which is
equal miss pole another one on the world
would you miss louisville now now
they're definitely not out solo it's a
standard prologue itself set of it but
the semantics a completely different
from out so it had backtracking you'd
have multiple variables and unification
and none of these exist in the are
machine the syntax I can use loops for
tokenizing proloquo however I can't use
any path generator generator syntax
because the syntax based on backtrack
that's hella syntax are defined you can
look deeper into backtracking syntax
literally worst case you could you could
go all the way at the end of what you're
pausing before find finds out that who
first told me what what expect was that
all the way back to apply it which I
can't do with a partner
it's a handwritten poverty it gets not
difficult they have almost maps and in
fact most numbers lists and so on
structured we go to couples so for
representing a proto structure through
bar 22 is just the top of the toolbar
pointer actually we had this very early
however that is illegal in Prolog
provided that it's illegal which means
that that structure here at top of one
others not used which we so yeah logical
variables and we need unification and
there's nothing in our language matches
this which we have to explicitly permit
unification we exclusively have
emotional variables we can use this
structure here we can be cunning and use
this top of one album with this element
with it one over here is need eggs into
a global appetite because happens a
global to carry something with keep
copies of these systems Adam doesn't
know backtracking
you can't go back and make a new choice
it's very nice to do it one way of doing
this isn't well compile that island is
something like this I can you do a
continuation passing style notice like a
posse and pass around the next thing to
happen what I want done went on dark and
at the very end I can return at the top
will succeed with the value
say this word where I guess I failed
this didn't work when I'm doing
something
the initial it next is just a wonderful
turn succeed because I forget for the
very end of that if a function here was
just called something like a call this
and check if it works I'll just call
next here data was not different in fact
if I doing more stuff down here I can do
things like make a new next which
contains the old one post the last thing
I'm doing here
call the number two here and pass that
next year and now I'm building on
building up a chain of things I want to
do I'm using the call stack to keep
track of where I've got so what about
choice which is the interesting video
again this is simple we've haven't we
have something we're doing new stuff and
there but I'll turn this here and all
stuff one more stuff to more stuff tree
I can set up I can set up a specific
choice point here by calling the CP
function with a list of alternatives as
fast and the CP function is is almost
trivially simple it takes a list this is
a list of function so it evaluates the
first function if that function returns
to see we've got all the way the end of
what we want we don't return to see the
passivating back if it gets that failed
we failed so let me call CP on the rest
of it so we're stepping down the list
until we find one that succeeds there
best moment you if one fails we just
keep going going out with multiple
choice it's nice
and it works it's reasonably efficient
I'm using the other stuff work
we can do all solutions I changed my CPA
just to keep keeping this all the ladies
would actually receive solutions okay
but it's modern profitable in the sense
that I cannot say it gives you one
solution I don't have a context like
they passed back with someone they can
decide whether they want it or not
so if I want to do that to get better
control the system I have to write
whatever yeah so that's so so old it's a
different semantics which have to
implement we can mainly use the world is
different you didn't extend blue and
there was quite a national language one
of the more simple language like that
one of the labor fuel and back is
supalen our base dynamic is left in the
scope but it's got beautiful variables
environments that have global labor
so only lower I have to do this by
myself by hand exactly a common
scripting language in game so the syntax
is simple I can easily do get you yet
for parsing but one case around the
Tecla same forms out I could make up its
mind but by putting the more difficult
cases
they've typed I've got new volumes
numbers they just floating points
streams and for a new book event a
reference to table someone changes
which means I cannot use drip down and
attitudes so we have to explicitly
manage the global data so we have a
global table store which are people or
tables in there when you work on these
tables you're changing the actual taken
value of the global store and when
you're referencing table you getting
that table out of the local store okay
that's not getting your table out so
Qian you get you they form takers
environment from there as well and they
do a bit of fancy hacking in the use of
tables here so a table is not just a key
value dish for me to make efficient that
especially handling cases with each with
a key
so David so so the new world record
which defines the new world structure
who are context to everything he's acted
that one so but take both tables the
first line is the tables is an array
next just as an x-ray index or next
available index and freed us it's just a
list of indexes which should be used but
returned by the garbage vectors that'll
be something fun we're keeping frames
the same way Judy is the global take
that's the top-level table with
everything off in it hangs on to track
of that we keep the stack the garbage
relation until we can keep
can do things for their the concept
called meta tables and then they type
their metal to metal tables as well
their fix that would keep them there and
we using any unique tags and just throw
values back and make sure the cap what
we're catching has to do so references
in data a reference for tables with
t-rex structure like this which just
contains the index so if you want to
think of it mobile data terms where it
will actually attack using tag pointers
so this just says this is just a peg
pointer into the table table itself well
each element of the table is got the a
here is the array from the indexes
needed integer indexes this is for
everything else and this is how am i
doing time two minutes right code how do
we implement this way again this is this
is little code from the current system
so if I'm gonna take if I want to access
a key to a table over the call to get to
get cable get table key function I check
it the first item of these action table
rails and if it is and if the key is a
number and it's an integer key that I
call the function get taken in Turkey
especially angle integers because that's
more does special things with those ways
much more efficient if it's not I call
the get payment key key function if it's
if it's not the keys not a number I call
getting kind of kinky and it is not
something else I check it was quite a
meta method in this method
if I do that like step down the exactly
same thing on the mat packs that will
handle the case for example okay I'll
get the metal tray from strip this is
the street we just call ourselves
recursively invention will step down
you get table kiki that attracts the
table from the table store line number
two very well I'm using the totally
trick and gets the value this.value they
return otherwise it just checks do you
did Yuki does pretty much the same thing
you just get the array card outlet and
chicken it's not they're using they use
net they use metal tables implement only
object on you classes and class to neat
language this is just getting them if
you want to store something we'll the
same handy vintage occasion and
squawking well with the table kiki
functioning in asking such thing is
widely complex so again we get the table
out again this is exactly that's defined
in the law quite point to documentation
if if the value is there with the key
exists and we're putting in the value
nil and we actually delete the key if
we're not putting in the value in the
open e replacement which is what these
lines doing and we push the value back
into the table store and return the new
structure with the update things just
make
it's pretty straight he didn't seem
almost like he'd be like city with it
with it at no reference to one side what
happens is not give us money in there so
if the key is not there then again we
check if there's a meta method you index
we use that with what's going down here
we using the meta myth the meta table
otherwise we just put Australian it back
in the table
so this is this is sort of C code really
now if we're using pointers either
either they type of fiddling with things
internally about that fancy but this is
what I have to do because the tables are
global and tables immutable so the
language itself is pretty straight
forward but the day that hanging simply
do this
because the roots you decide when
necessary support linking the maybe we
yeah yes just classic garbage just run
through the whole day
- I have and my mock things which of
which he usin I guess goes for free
everything that's a good question
well well well well one in the way you
can actually explicitly call the garbage
collector or after you made a good call
with anyway something when you come back
then you then you can call it that red
and this type of box with executions are
silver very long that's the problem that
hasn't arisen yet they're actually some
people using more right thank you much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>