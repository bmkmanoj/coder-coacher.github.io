<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angela Johansson - Hobby Electronics on the Raspberry Pi | Coder Coacher - Coaching Coders</title><meta content="Angela Johansson - Hobby Electronics on the Raspberry Pi - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angela Johansson - Hobby Electronics on the Raspberry Pi</b></h2><h5 class="post__date">2014-07-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kbqv_PQLcYM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yeah so today I'm going to talk about
not the business business value but I'm
going to talk about pure fun that you
want to do at home and it's really cool
to do stuff that he can show and then
that you have it in your hand and it's
you can feel it it's not just an app on
the phone so I'd like to start with the
video
so there is no sound but these are
actually LED matrices
yeah you can watch the whole video
yourself so this is fun this looks fun
yeah and actually it's not written in
Ellen yet so that's only just led matrix
and and then microcontroller is hardware
but my point is it might as well have
been written in Allen you saw it its
network topology they choose leaders and
you communicate you do message passing
do that rotate the error in that
direction and you can scale it you can
just add more matrices and it's doing
the same thing and that's what my
feeling is about controlling hardware
with a lying its feels very natural you
have hardware it's almost always in
different states and you can model that
very naturally in a line and you have
recursion you're just doing something
and then maybe the state changes and you
going to another state and you
communicate you send messages you
receive messages so do that an airline
it's fun and you can do anything you
want so if you want to check this out
so what did i do then so if that wasn't
written Donnellan what did i do so i
built Adafruit projects because I I saw
that there is something I want to do I
didn't know so much about hardware and
if you ask my boyfriend he'll say I
don't know anything about how way but
this is very easy to do because you you
get to do it yourself kit and you just
assemble it and and you just run the
software that comes along with it and
you get source code written in python
python mostly and ends very similar to
Alan so so that was like my starting
point I just built something that
somebody out set designed so that I need
not worry about anything but of course I
didn't want to program in python so I
made in an ally instead and here i did a
let matrix myself that's a sinus curve
and that's the lab matrix is extra fun
because it's a visual you you do
something that that shows we can do
pretty patterns and it's easy and also
did something here is a radio-controlled
car and you think that must be very
difficult to to do that but actually
this was very simple because you don't
actually do the radio the radio
interface you don't you don't meddle
with that you just hack yourself into
the remote control and when you open the
remote control I didn't think it
it was true it's the joystick it was
plastic thing it just pushes down two
buttons so so you just have a digital
zeros and once that oh now you right
left right so this would it looks like
and then you have this test points that
they used to contra to test the hardware
if it's functioning all right and you
can just hack yourself in there and just
send the zeros and ones from the
Raspberry Pi and it's so easy it's I
didn't think it was possible but it that
was very it's very easy to do it's very
fast you can do that one afternoon if
you have nothing better to do and there
is so much to choose from Adafruit and
other sites there are so many sites out
there that show you projects with the
Raspberry Pi you can just choose
whatever you want like this one was an
ad converter and when you have a sensors
that give analog values you need an ad
converter to get the digital varies and
this is actually a distance sensor that
was not on Adafruit but it's easy to
just add it because you have the code
for the ad converter so you know how to
read values and the distance sensor is
just feeding the values so there's so
much to choose from like a dog collar
with the GPS so you can track your dog's
movement and an FM radio and arcade
thing so my recommendation is just to
choose something and just to start
building it because it's very fun and
once you have something it's it's easy
to do the next step that you change
something and you add your own little
twist you maybe you don't want to have
an FM radio there you want to have
something else then you just change it
so why use Alan and I know this is the
worst thing to say at conferences but
this was my main reason simply because
it's possible I love along ah I learned
it in 2006 i think and i didn't really
feel comfortable with Python and I
thought wow I want to see if it's
possible to do it in allen and this was
my main reason as i said it's okay when
you have some leads you're controlling
this is not very difficult but as soon
as you have a bigger application like
this it's very easy to do it in a long
because then you have the design that
helps you you have the modules and you
you know how to model it in a line so
for me the code writes itself so it's
it's when you build bigger systems that
you want to have a line where you get
the benefit of Ellen and like i said i
think it's ideal for talking to hardware
because the hardware is stateful and you
need to fault tolerance you need the
communication sending values back and
forth and you want to extend your code
later on so if you decide that I want to
make it connect
it I want to connect it to big network
then you can do it it's simple with our
lung once you have laid the ground and
then why not use alun-wyn it's a
raspberry pi I know there have been some
discussions about embedded that yeah not
all platforms are suitable for the for
running Alan like microcontrollers you
don't have enough memory you can't run
and a long vm simply but a Raspberry Pi
that this is actually sort of a little
computer it has everything and the osu
get its it's a full linux distribution
you have all packages you want available
so why not and the thing with the
Raspberry Pi is that it has these GPIO
pin so it's very easy to connect out
with
so where does a long fit into this when
you program such an LCD display what you
get from Adafruit is in the Adafruit
they have a github repository you
download the software and it's like a
very thin Python application and then
it's a driver code for the LCD display
that just sets different registers and
so on and that's easy to change you can
the Python application here I don't know
if you can see it it sets it prints out
the IP address on the LCD display and
it's a very simple thing to just change
what you want to print and then oh I did
this then then you can make it your own
it's very important to make it your own
you must decide what do you want to do
and then there are Python lips that that
you need to install before hand and says
in the installation its instructions you
have to download this and this and this
and this give you access to the GPIO
pins and so on but also Python needs
something beneath and this is simply
calling the OS so it's the linux kernel
that's doing all the communication to
the GPIO pins and yet you have a few
different technologies you have memory
mapping the linux kernel they expose
files that you can just write to file a
value and then it goes out to the GPIO
pin and then you have command line tools
so even if you don't have an application
on top you can test your hardware
yeah so what do you do you just change
it you just use ln instead yes that's a
piece of cake so what I did was I
googled I to see because like I said I
don't know anything about hardware so
ITC is basically a bus that defines how
to talk to a hardware so you have two
pins you have one clock pin and one day
to pin and there are there are simple
ITC devices and there are more advanced
ITC devices the more advanced I to see
devices are called sm bus and they they
have sort of like in addressing system
yet that you just you have a hardware
address and then you have a register
address and then you just read and write
to and from registers on the hardware so
whether did was I took some seek out
that I googled Google is your friend
there is so much code out there and then
I wrote in if because that was easiest
and fastest four me and I thought it was
ok because the add the C code that
that's underneath there it's from ioctl
and it's I thought it was well tested
and you get unix error codes back if it
doesn't work so so i thought that's okay
I can live with that it may be crash but
but it actually doesn't crash that much
it's pretty stable so then the C code
called linux kernel module
and I call the Allen code there i have
like opened this address on the i2c bus
I can read registers right registers
then I can just take the data sheet that
tells me which registered Regis's I
should read and write and then I can
test the hardware manually so it's not
that hard to do yeah and for this I was
lazy eye I used the C API in the linux
kernel because I didn't want to do the
implementation of the ESN bus read and
write myself there is already an
implementation and I just took it and
this is so simple it's it's almost
ridiculous so the code there is it's
very little code it's very thin and then
bang em and Allen I don't need to you
see I don't need to use Python yeah and
of course you can reuse my code if you
want to do something yourself spi
support I didn't do it yet yes that's my
next thing of course there are other
libraries this WPI it is the wiring pi
library so it goes one step further it
has the limit a little higher so it uses
a C library that does all the hardware
stuff and just called this and there is
the a-line actor library for embedded I
didn't look at it that much because I
was interested up doing the code myself
and you can do that too it's your choice
so this is actually very easy it's so
easy it's yeah so of course everybody
now see that you should work test driven
so this driver for the ad converter that
I wrote it's actually very well tested
it has unit tests with McIver and proper
proper is the free version of quick
check roughly and what I was planning on
doing was system testing with chem test
I didn't actually get that far but this
also helps you if you don't have the
hardware available yet so you have your
application here and and you want to
test it love common test and how do you
do that well my thought was that I
should write simulators and those
simulators that those are really easy to
write an airline because they are just
yeah I'm faking that I'm setting this
register and I'm faking that this is
happening and then what you do is you
send messages to the test case that the
test case can subscribe and and then you
say oh now i have set this register very
and this is very good because you can
test all the way down you can just
everything that happens and you don't
actually need a hardware at all so this
was my plan i I didn't actually do this
but it's easier and then it sounds
so testing is good for you I just like
to show you one McIver and one proper
example so the NIF that I wrote it
that's not actually testable but above
that the driver for the ad converter but
if you test for that so he just test
that you that you use the ITC bus that
you open it when you in it the driver
and when you terminate the driver it
closes and proper how many of you know
quick check oh that's quite bunch so
proper or quick check-in the point is
that you don't always know what test
cases you want to write you want to test
properties of the code and this tests
some properties of the the driver lib
that's yeah I wrote that for encoding
and decoding data so I abstracted the
bit filling because that's very advanced
ad converter it turned out that it was
too advanced for the purpose but there
are a lot of registers and configuration
registers so the datasheet has enormous
amounts of tables when you set this bit
then this will happen when you set this
bit then this will happen and of course
you want to abstract that in software so
you say that you have status bit and
then you can test that every time you
set the status bit on any bit better in
the same status bit should be set
afterwards of course
so then I thought I want to build
something on my own not now I followed
someone else's instruction in design but
I really want to do something myself and
I thought wouldn't it be cool to have
the time circuit from back to the future
yeah and I built it and it actually
works so I changed the design a little
bit I thought I don't want it just to
have as a decoration but I wanted to do
something so what I did was to have this
destination time and then hire the
current time and then this year is the
countdown clock so it counts down to any
event so this year Allen conference
yesterday so the second of May it was 38
days 21 hours 51 minutes and 47 seconds
left to the red date so how hard can it
be well it turned out it was as easy as
I imagined it of course it took a lot of
work and it took a lot of time and I
needed to learn a lot on hardware design
I didn't do any kidding before but it
was possible the routing was very
time-consuming in eagle and for those of
you who don't know Eagle is a CAD
software so that's used to do the
hardware design so that you can actually
make these circuit boards letter behind
here
so I designed them and then I let them
print it I ordered them in Germany so
they print it from my design yeah and
that that was the most difficult thing
to do to learn how to draw that but but
nowadays you have so advanced tools so
yeah it was okay and then these these
components here there's a pretty small
so this had to be surface mounted and I
couldn't do that myself that I I think I
could do it if I just have a lot of time
so what I needed was some some displays
for the numbers and alphanumeric
displays for the for the month and
microUSB for for the power and then i
have this display driver chip and my
point was that if you're using a lang
maybe you you cannot do the hardware
like with microcontrollers and run along
on that but you don't need to I chose
this display driver because it does all
the work for me so the hard way is
actually very simple so those who
designed this hardware they did all the
drop for me so I have a dedicated i see
that does all the display driver stuff
and I just
registers and greed registers and that's
very easy to do from a line you just
tell it now now you can write an eight
on that display then it does it so the
hardware design is simple keep it simple
stupid so maybe this doesn't look that
simple to you but but it's actually very
simple it's this display driver does all
the work and then then you have some
leads because of course you want to have
blinking LEDs between the hour and the
minute and you have some some resistors
some some capacitors and that's all and
actually that was written in the
datasheet to the IC it was written now
here you need a capacitor trying to pick
up a-rod's and then you just take it you
I didn't need to think about the
hardware design it just created itself I
just wanted to add those displays yeah
and simple is a relative term this IC is
very small and and there are very there
are many output lines here to all the
different displays so it was very narrow
here but that just took time
it was not difficult for me even if I
haven't done it any hard way designed
before so when you put it together of
course you must test the hardware that
you have mounted it correctly and that
there there is connection everywhere so
this display driver it had an display
test mode so you just write write a 12
to register 7 and then it just turns on
all the this place so then you can see
that it's working and I actually didn't
access this hardware with anything other
than a lung so it's very easy i just
needed Maya to see primitives and I just
say open this address and then write the
one to register 7 and then turn on all
the displays and then oh yeah it's
working and this is so fun when you do
something you can actually touch and see
and yeah it's working so of course that
that was not very advanced so then I
needed to do or the implementation that
showed the date and time and that was a
little bit harder than I expected so I
just threw it together to make it work
but there was some thoughts so I have a
main program that sets the date and time
and then it changes the destination time
just to see that this counts down to
zero and I have one yen server for every
every row here so so these are separate
modules
they are functioning independently from
each other then they they use some
things in this time circuit live of
course this lib library should be a
driver and I will refactor it but but
this is main structure and what it does
is the gent service are periodically
sending themselves messages like toggle
ads checking time and this is in a
higher frequency than then the actual
update so the this is done more than
that's 100 milliseconds between each
message here because our lang is a soft
real-time system and I have no guarantee
that if I say send this in one second
that it will be one second so actually
this is running on a higher frequency
and then it just checks has is it the
next second yet and when it is it
updates the display when you change the
destination time then actually the
destination time sends it to the
countdown clock so the countdown clock
can calculate a new difference and this
works yeah so
payments yeah so what about
communication alang is good at
communication and I work at a company
called Cybercom and their mantra is
connectivity so boosting your
performance in a connected world so I
had to make this connected somehow so
what did I do I made the system
distribute it just for fun just to show
that it's possible and it was very
simple I just took this countdown clock
this last row and I connect sorry I
connected it to another pie and I just
ran the software on another pie on
another node on another along node and I
just use our PC call just to communicate
between the two nodes and that was all
it's so simple and in the connected
world Alan rules so as soon as you build
bigger systems and you do connected
systems then it's really very easy to
get value for the money when you use
Alan okay I don't think I have time to
talk that yeah so then I thought yeah if
i want to have hardware then I want to
have bluetooth so so I googled is their
bluetooth support for Ellen and I didn't
find anything I found an empty github
repo I don't know if if you know more
than me but but I didn't find anything
so I would like to send binary stay a
long way I don't want to care that i'm
using bluetooth instead of tcp but i
would like to
use bluetooth to save energy so if it
doesn't exist write it yourself so then
I wrote an interface to two blues and
blues provides the Bluetooth stack in
Linux and that's actually very easy so I
created air of calm sockets it's and I
work just like TCP sockets and and it's
really the same thing the difficult
thing was that courts must be put in
scan mode and it was very difficult to
set it up and get it working but when it
worked it it was so easy yeah and also
like with TCP you you have no guarantee
that when you send packet packets and
then you read them on the other side to
you you can't know whether there's one
packet that has arrived or three packets
and when you read it you will read every
three all three packets at the same time
so what I discovered was that when you
when you have binaries that are
concatenated in a line then along will
just read the first binary from that so
I had to do sort of like a manual thing
to check how many bytes did I receive so
then I know it's not the last binary
then I just take the first boundary and
then take the second and third and so on
so this was my code so when I wrote the
socket code this one is actually the
same as for TCP you create a server you
you buying a socket you listen to the
socket and and you have an acceptor and
in the client side you you connect so
this was actually just a proof of
concept that it works
so I'd like to develop this further but
I would like all of you to help and I'd
like to have the same support that that
in that has so yeah a simple protocol
like just the header with the length and
and the binary contents and yeah maybe
make use of Bluetooth services because
they have their own concept you can scan
for services and then can connect it and
that card set up you need to do in the
beginning and of course it should be
rewritten as I long for it it shouldn't
be in it and maybe support for Windows
but I heard that's pretty awkward yeah
so let me know if you're interested in
helping this
so do we have some questions so you said
it was very easy to write the NIF how
much hours did you spend how long did it
really take you DM I didn't count the
hours but give like a rough estimate
yeah I don't know five hours may be
hopeful that it wasn't that much I mean
we're all time optimists we think it
will take like 10 minutes but I think
five hours is not that much anyway it
could take weeks and months to do do it
and see for me do it like the whole
application in C for me said it was not
that difficult more questions ok I just
want to thank you i mean it's it's very
fun to say that you can portray and such
I at least for me very uncommon aspect
of programming hair long and and
emphasis that the simplicity that's
that's fun to say so again a warm round
of applause and remember to vote</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>