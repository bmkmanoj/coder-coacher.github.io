<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Francesco Cesarini, Viktória Fördős  - 'Scale, Manage and Prevent!' ElixirConf EU 2015 | Coder Coacher - Coaching Coders</title><meta content="Francesco Cesarini, Viktória Fördős  - 'Scale, Manage and Prevent!' ElixirConf EU 2015 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Francesco Cesarini, Viktória Fördős  - 'Scale, Manage and Prevent!' ElixirConf EU 2015</b></h2><h5 class="post__date">2015-05-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wGAc_QwD_6Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm Francesca chiweenie started
working with Aragon in 1994 full time
management metric diet you're lucky
enough to be able to work with job
market over and learn and finger was to
learn about building systems which never
failed hi I'm Victoria furnish actually
technical lead of the vomit project and
I'm coming from the academic area
previously I was working on the static
analysis of Berlin programs I
contributed to refactor and paraphrase
project that helps you introducing
parallelism into a long coat story today
I was because he did a great job and
introducing the DM and what helps you
make a full color system from a vm
perspective and danya setting on the toe
cap to Thorburn and once again your
turban you went in and made a very good
power bank initiate the way
so that point you know I think this is
really where no we should take over here
from these two very important messages
and what we're going to talk about is
the lessons learned from developing
systems which never fail you know how do
you get to do scale how do we get and
how do you manage them and how do you
prevent failure so how do you know
keeping on the theme on high
availability systems which never been
yeah actually imagine that you need to
develop the system in elixir that is
highly scalable Conqueror and never
fails you build it on the top of the
Orlan ecosystem so your boss truly
believes you that you should be we
should be able to achieve 99 up time
lines of that is 3 millisecond of down
time per year and it is indeed a it is a
bit about it is a myth endermen that
behind every legend there is a bit of
truth behind it and this truth about the
nine-nine's actually comes from a press
release from British Telecom and which
experienced during here between an
initial phase of the project so it would
be an initial phase of the project and
the end of the digital phase of a
project in one of the boards
second out that we couldn't set up any
new polls then they took the amount of
the project and calculated how much that
was in years look at the number of wards
and clean down to this weird three
milliseconds of downtime and I think
it's you know if you actually started
having from the end of that pre second
I'll take you to the end of the initial
phase of the program sure you've got one
hundred percent availability there as
well so you need to always your take
statistics with a bit of skepticism and
indeed you know soon after there was a
great quote from the person managing
this project which as a matter of fact
the network performance has been so
reliable there is almost a risk of their
field engineer do not learn maintain and
skills you have a system which never
fails and then when it does fail
operations or DevOps have no idea what
to do with it and indeed yet i think
this 99 after the initial phase of the
project was reduced greatly and that you
had to fly him engineers weekly figure
out what was going on and health and i
think you're from our end you know from
an airline world yeah we were doing
devops even before the term was it
it was considered cool but they're from
nine nines have to say from experience
you have 59 it is much more like it and
that's it that's a few minutes of
downtime per year including software
upgrades and how you achieve those five
nines actually assume that the same task
is given to to develop teams working
with Alex here as you can see this team
is still working hard why's the other
seems to be ready and enjoying
themselves well actually that it's a
what is the difference so actually these
guys were coming from the Erlang world
and young developers do not like
reinventing the wheels actually
reinventing the views means less time
for beer drinking and so instead they
reuse tools and component and the beard
on knowledge and experience from the
telecom world how I don't you actually
you know come from a room in background
that's actually a taste
we were at the clear Compton instead it
was more like ninety percent at the
first attitude conference who actually
came from the ruby background and I
think you will hear airline people
saying this time after time that you
need to start thinking differently and
need to start tackling problems from a
different angle in a different
perspective and I think my favorite
example from the next year conference
was in one of the presentations where
some of the Ruby background had gone in
and edit see a wrapper around asterisk
asterisk is no software which here terms
you know commodity hardware your laptop
into pdx into small sweet gentle help
you handle voicemails it will have to
make outbound calls and they were
actually shipping it as a product and
yeah as to what was the preferred what's
the performance a very curious because
ten years ago we were to be masters and
the fruit different performance was tent
poles per second and that was Poseidon
for that product was curve it didn't
need to handle there was nothing wrong
with that but that surprised me that it
was so long ago 10 years ago movie
broken arrow
asterisk we actually reached third load
one thousand calls per second on
commodity hardware remember this was pre
multicolor and actually we made that
project by mistake we were load testing
our system to see how much we depend on
and report we had the simulators turned
on in fact we're still connected towards
our VoIP provider and we managed to see
their whole network we were kicked out
had to get a new VoIP provider they
weren't too happy but you know you
prepare for differences between the room
in their attics your world it's almost
like you're giving ask olga and you're
bribing it feels like a soda but the
actual chassis is that of a Hummer and
the motor set of a Ferrari and when you
get something which is really full
taller but can go really fast you need
to have full visibility what's going on
inside of young you need to have full
control and be able to act and priam it
and if something has gone wrong we need
to have the data afterwards to go in and
figure out what what has gone wrong the
complexity becomes overwhelming and I
think this is an example which you came
from a company called the barracks a few
years
they were merging previously and airline
BM and trying to get a vm which was
optimized to run on the bare metal and
wood scale and multi-core architectures
and this example here was done what you
have a boss but Fenix the Fenix
framework would require just as much and
what they did is they took a ruby on
rails application and we wrote it in
Chicago boss and the superior
application at the time that could
handle about about 40 users per second
the enrolled in Chicago boss and sober
movie well it wouldn't scale and
multi-core so no matter how many pours
you through at the problem the
throughput was still the same 40 users
you could have a 40 users per second
they rewrote it in Chicago boss and then
ran it with two cores they got 60 users
per second they ran it with four course
they ran it with 32 cores 48 ports all
the way up to 64 pores no matter how
many cores if you had a problem the
fruit would remain the same and so what
they did is they started investigating
here so here on the vertical axis we got
a number of course which they tested
everything with or around on the
vertical axis here we've got the number
of users they were able to achieve and
they started investigating why the fruit
was what it was and quickly found a
bottleneck in the system and it's
basically manufactured
which tells you that your fastest your
program with run as fast as its Lois
component and in this case what the
Dennis did put a process which acted as
a bottleneck so you had a lot of peril
equities going on these were all be
having parallel 1 / 4 but when then you
need to push everything out everything
was serialize with one particular
process so it went in and they removed
you know this bottleneck right here and
when going in and retrying 4 on 1 cor
they went they jumped up from near 60 to
about 400 they ran it on two cords they
were able to run about 500 single
taneous users we went up to 8 cores
about 800 and at 16 cores right at 16
court sir and eight cores to hit way
beyond the thousand users so just by
running the code no machine with eight
course if they were getting a 20-fold
increase in proof book on a single note
on the same hardware as your compared to
remediate system and when you know we
heard from Joe today in 2018 when you
start off your attics here at the end
million course in there truthfully we
will be seeing machines with a million
court within our lifetime it's it's not
going to be it's not rocket science
we're getting there and in order to
tackle these machines you need a new
mindset and you need a new way to
approach your problems and I think one
of the course what a pun intended one of
the big things you need to think about
here is the visibility you have into
your systems and you know what we've
been doing in the airline space is you
know everything we've learned in the
telco space which we have had to learn a
new ecosystem you know pack we've taken
those lessons and we started applying
them in a much wider set of verticals we
started to find them in your gaming in
gambling in finance banking within the
web and these are all systems which have
to scale they're all systems which have
to handle massive Peaks and be very
predictable under extreme heavy loads
the same features you know the telco
space has your back in the late eighties
early nineties now what visibility do we
need one we're handling systems you know
first of all you need to have visibility
to you need to have metrics and these
are both business metrics and Chris the
metrics so give me an example I'll give
you an example of a business metric
assume you know how many login attempts
were actually made in the last minute in
your system you can have full disability
all these login attempts how many were
successful that's your second man how
are you failed you know that could be
your third metric why did a login
attempt fail was in a bad password that
the user not exist you need to fill in
and have all of this visibility uniden
need your system metrics and that could
be you know how much memory is just
system using what is it you can
individual course how many you know how
many processes were created or
terminated within the last minute is
what we're doing is you're over imposing
your business metrics and your system
metrics to get an F year over what is
using resources of what is causing
problems you need the unique
notifications and logs plenty and plenty
of logs and you know for example you
know what happens if a process crashes
you've got a hundred nodes and a pro
subscribers are such a great job at
explaining it you've got a supervisor I
process crashes you're supervising
detective gradually most probably we
start that process now that's great you
know you've not post an outage some
requests might have gone wrong got means
request one for systemic sense except
then you put hundreds of mouse running
are you actually capturing that crash
and do fixing analyzing it fixing it
ensuring it doesn't happen anymore it's
still a practice shouldn't be happening
and what about you know logs pertaining
to your business logic what happens if
you get a distributed Eric Porter being
busy we were actually analyzing logs of
the day and a system which was
malfunctioning and we discovered that
within about within 24 hours we'd
received five million distributed around
port busy notifications it was about
five million times within 24 hours
you've got a problem right there and we
need to address that problem it might
not be
shoot with your sisters it wasn't yeah
we're not just within those 24 hours but
you get an unusually high spike or
something unusual happens that would
become your welcome and that will cause
issues later on so it's you know and
there are not of these new teenagers you
need to keep an eye on here what if a
process Oh spends too long garbage
collected these are all things which
will disrupt the balance you have in
your virtual machine and there's a third
one at third thing alongside so metrics
and location which is alarms as rarely
seen alarms actually be used outside of
the telco space unless you're aware
there was being designing the system and
alarm is nothing other than an early
warning that something's about to happen
so it could be that you've got an
80-percent this pool alarm or a
ninety-percent this cool alarm or
represent this for alarm each alarm will
have different severa tees and will
require different actions and all the
deductions we really need to take
call pre-emptive support so you're
trying to stop the issue before it goes
in and escalates and there are two types
of alarms there are those which actually
originated the legal system and then
there are those you will actually
believe in generate from outside the
system so assume you have your Amazon
and your monitoring the number of
purchases if if for example the milk the
counter every time so we'll buy
something bump up the counter and you'll
earn any money to that content within a
minute no one's bought anything on
Amazon there's something wrong you can
be sure that the stock involved you want
to meet with you raise an alarm what it
is you raise the alarm and the people
monitoring the counter hopefully some
human here will come in and look and so
the problem and as soon as you notice
that that counters be okay so what is
buying things be willing and you clear
that alarm so they automatically get
raised and cleared as you go along and
these are so these are alarms which have
you handle from outside of your system
you might have a system for nagios you
might have written a role in your OEM
infrastructure you know typical alarms
which you always need to monitor for
example improve your system limits what
happens if you hit eighty percent of
your number approach you couldn't live
in another processes in the air they're
in the millions but you might have
missed configured it or what happens if
you start running Romero bgs table you
start getting he's eighty percent alarms
you monitor them and you go and you
change the configuration you start
profiting Bulow's you're actually seeing
on your on your system so these are
things you need to think about another
very common one is
process message queue if your process
message she becomes too long and we're
talking of thousands or tens of
thousands of messages waiting in the
mailbox to be processed you have a
problem happening you've got producers
which are producing much faster than
what the customer coming consuming once
again that most probably needs human
intervention where you either start
scrolling down that process we stop
monitoring very very carefully ensuring
that you don't start getting knock-on
effects so this is all done in
pre-emptive support you're trying to
address and solve the problem before it
escalates before it actually causes an
allogenic you need to be this with your
head stuck looking at the system 24
hours a day you go into any of the telco
providers you've got people staring at
the screen and it's either green or red
and if it's red that means that the
larger suffocated to look at and these
these are just simple ideas which you're
applying them to any other vertical
would really really help and the second
is the whole idea of post-mortem
debugging no crashes in the middle of
the night and it's automatically
restarted so you don't even have to get
out of bed
was it feed me started that an arm is
cleared that's wonderful that's great
but when you come in in the morning you
need all of the data I'm going to find
what's actually happened and you need to
basically you'll be able to propose it a
bug was it an anomaly or it wasn't just
a feature maybe maybe your sister was
supposed to balance that way and really
reinforce you need to be able to either
admit your guilt prove your innocence
but do that as quick as possible Rock
waste any time and my favorite story in
that space is the supporting a system
which was having millions of SMS is per
day and I got an email from first times
reports saying this uses very very angry
on some day we receive he was surprised
to an SMS notification service where
every time his favorite football team
score in receive an SMS and he received
his football scores for hours after his
team scored he was furious you know
what's happening here and we got the
number we were able to see that
semesters coming in that identifier we
checked was it we went in and check is
was the system where was this is a
prepaid customer who might have been out
of credit no he was a postpaid so that's
fine he was allowed to receive premium
rate as a message yes he was all of this
was locked okay he was so let's send it
to it when we sent
smsc so we passed it on to the network
and received a unique identifier back
and then identify women didn't check the
heck out look for the next half an hour
for next four hours everything up an
hour we will get in the handset detach
message back so this user it has phone
switched off for was out of coverage and
within three minutes were able to get
these logs paste them in an evil you
know and go back to the first times of
course I know it's not us your pelvis
user to either change network or yeah or
your penis bones or not had we not had
that level of visibility in our logs we
would have spent days trying to figure
out what was going wrong reading the
code and what not and this is on a
business level you imagine just on a
system level when you're trying to
figure out about if if your VMS crash no
that is right because you don't have a
memory you have historical data on how
you read yes the table memory usage was
on how are your closest use it was yeah
memory use it to us do you know what
part of that we have actually a couple
of the memory of course cause it to run
out of memory often you don't I'd say
ninety two percent of the deployments
out there have no idea how much memory
do using that in all different types so
so yeah so what historical they help to
do is once again and oh yeah you post
mortem debugging and your quickly prove
your innocence or admit your guilt and
if it make your guilt what you do is you
put safeguards in place you fix the bugs
and you make sure it doesn't happen
again okay well actually it was very
general but now let's see an example
from real life actually half a year ago
we were on site at the customer
polishing the new product just before
going on live well there we were
performing load testing to load testing
for large dating side actually died
messaging was based on mumbles I am it
was an hour-long cluster
this thing of form on booze I am notes
by the way have you heard about that
Mongoose I am is being integrated to
Phoenix in san francisco at along
factory me hands and sony gave a great
talk about it check it out on youtube so
why we were performing load testing we
noticed that an alarm raised we found
that the system limit is almost hit only
on one node actually it was exceeding
the number of alone tables and and the
question was why well we increase the
limit and continue testing next another
alarm is raised we noticed that the
mailbox of a process on the same node is
too large but it is definitely a sign of
an overload so we analyzed the case in
more details and noticed that the missus
tables worm is configured actually one
node had no local tables does the
overloaded node took over the load so as
the solution we face the configuration
and voila the alarms were cleared next
another alarm was raised it was about
that nodes belonging to the same cluster
he was different version of the MongoDB
application because they are how big
would had been the surprised if this
problem had turned out online and
actually detecting the root cause is not
straightforward because the errors can
only be found on the in the logs on the
nodes running the wrong version of the
application so as the solution we
reviewed the release process and we
found then mogu zaigham were built from
source on each node this is not good so
we advise to use a continuous
integration server to be a really
certified and download it from here
next another we were faced with another
alarm it was actually a module module
crash and would you clash occurs when a
beam with a certain name can be reached
from multiple code passes we were very
curious about the reason how it could
happen and so we reviewed the Shah
history by searching in the log files
and we found that actually one of our
colleagues added some code passes to
some nodes manually so as a solution we
resolve the OTP dependencies finally
using system matrix we analyze the
MongoDB driver there so the MongoDB
driver was actually a bridge between the
persistence and the application but we
found that the Lord wasn't a currently
distributed look at this blackboard as a
solution we improve the configuration of
the load balancer and then all the plots
were close to each other now i'm pretty
sure
probably about half a day we had this
level of visibility this would have
probably gone on for days trying to
figure out what is each and every single
one of these issues was it it was really
really quick turnaround time which made
it really worthwhile yeah and now i'm
pretty sure that all of us agree that
issues not handled leading to outages
and then you can fire fight all the day
but actually this is not good and this
really can be avoided by pre-emptive
support so preemptive supports stop and
address issues before they escalate
actually the choice is yours so actually
have you heard about the release project
it was about it is an you founded
research with about three million euros
it is a collaboration between european
universities and companies it was aimed
at getting the Erlanger co system to
scale with tens of thousands of nodes
actually they're multi-core and
distribution goes hand in hand we call
it scalability there we experimented
with the generic operation and
maintenance hall that would handle the
orchestration in the heterogeneous cloud
and die these nodes gave us the full
visibility of what was going on in the
Erlang Williams as a result of this
project we develop the product called
wombat actually wombat is a commercial
product but this does not stop you from
taking ideas from it and applying the
similar principles in your project after
all all we did was built on ideas from
the telecom space and abstract them to
another verticals such as gaming banking
finance ecommerce messaging and that
so actually vomit is able to manage ten
thousands of nodes how was he able to
achieve this result well actually we
develop the distributed application even
in terms of persistence we built
actually build actually vomit ree that
uses as many wombats as nearly to
fulfill the request the approach makes
the actors independent from each other
that they do not affect the scalability
of the other words and this also brings
the photons into the into the system to
provide the visibility in your system
boombot inject agents to the managed
nodes actually these agents need to have
very very small effect on your own
denotes consider that your application
is ruined by home but no it's if it is
not acceptable so as a proof we measure
the execution time of an algorithm with
and without von Botswana Turing the
difference between measured values is
the overhead of the monitoring we found
that the maximum overhead was less than
1.5 percent so we consider one but no
intrusive so it can be safely used in
even in production environment besides
this one that has many attractive
features actually one but can became
your hub boom but can help you to deploy
and manage ten thousands of nodes even
in heterogeneous superclusters even in
cloud it helps you to prevent outages
using alarms alarms karma directly
pushed pagerduty robot has more than
25 built-in alarms and there are special
alarms for react or Maine or Malaysia
besides these we have more than 100
built-in matrix these are system matrix
and boom but can automatically collect
any eggs ometer of force on matrix as
well wilmot also collects lager and
sasser logs and please note that bomba
doesn't compete with existing tools it
is a compliment to us all we wished want
is to provide the own specific view of
the system so we support integration to
splunk nagios graphite gray fauna and
cracked it I think the moral of the
story is if someone comes and says hey I
wrote my system editor in four weeks
beware beware you cut the whole hero
program or approach if you ask this
person now where's the documentation and
you tell them and you get a
responsibility to code that's
documentation small alarm bells start
ringing it's just a person who gets
woken up in the middle of the night when
the system fails and going as
with it and you know finally you know
how do you discover that the system has
gone out is actually your customers
calling me up saying hey I can't go home
to the website for you know or yo
there's a dev ops team actually get a
notification even before the system's
about to go down hey something really
wrong here it's fighting and you know
when you're thinking of it when you're
developing you know in the extra space
you know your business metrics you've
got an X here so you've got extra eater
you've got Folsom for your login in that
blogger we have you network with that
Sierra motor which you should be using
and you know for alarming you've got the
satchel alarms where you can raise and
clear arms it's a very very simple
interface which you can then you're
right your own hands and hook into into
other systems such as not yours and
others or you can use eel are if you're
writing your own oh yeah solution itself
so people doing a little dis creating
this visibility and doing things
properly takes time it's not official
but you always have to start small and
then filled on your build on the other
necessary
Radha your system five in operation you
can woken up into in the middle of the
night you fix the problem make sure that
you start getting early warnings next
time to scrub your peers I think you
know more but every single alarms will
have a story or either how you know
whatever develops have to spend weeks
looking for a needle in a haystack and
you know looking for the other night
it's like in the middle of the night
without most fun things believe me or or
your stories which are putting out the
show it's all there as a pre-warning and
you need to build it your own your based
on your experiences so you know it's you
know take everything which is generic
packaged into my breeze and then start
reusing it ya think of Murphy's Law and
think of the lessons learned when
telephone systems could not fill down it
could not go down because the no stated
that they could not go down and even in
case of an earthquake or a catastrophe
still have to be able to pick up the
phone dialed emergency services and
second you wonder shipping custom
systems the fines which came associated
to outages were massive and so what
happened you made sure the systems did
not go down so when you hear about five
times availabilities it does come at a
project uh schematic loss but it is
possible and you can do it yourself by
monitoring your system through creative
support the most important having full
full visibility over actually what's
going on so any questions
any thoughts if you're coming from a
different space where maybe you know the
fruit foot and in performance
requirements were very very different
and it is it can be a bit daunting at
times interesting enough when you who
are the first elected office it was not
one mention about the internals of
Darren yeah this is all we are talking
about in their neck space and luckily
both these girls the lowly you you have
to wait to be exposed to the better it
is
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>