<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Zotonic: Erlang for the Web - David de Boer - EUC17 | Coder Coacher - Coaching Coders</title><meta content="Zotonic: Erlang for the Web - David de Boer - EUC17 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Zotonic: Erlang for the Web - David de Boer - EUC17</b></h2><h5 class="post__date">2017-07-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jkQNPSTX_a0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good morning everyone welcome to the
party beach tent it was quite cold here
fortunately the windows are open now so
I'll be be telling you a little bit
about the tonic bitterling web framework
imagine that you're an Earthling
programmer and you need to build a
website right now you know this guy and
he's a nice chap and he's well dressed
so you decide to use that and you start
with some simple content it can be a
block or some some simple content types
then you need some images and you want
to have them resize on the server to
keep the response assessable that you
serve to declines of course we want the
website to be found as well so we start
doing SEO to optimize for the search
engines which does mean that you have to
be on HTTPS as well because we don't
want to spend too much money we will do
that with let's encrypt then imagine you
start getting this distal over the world
you would need multiple language support
and you get you're getting more and more
content you need a way to manage it so
just write a CMS then write that's still
not all with all that content you need
your search on the site itself to be
good as well so you start doing soda or
less sixer to get some tf-idf and
analysis and install boards and all the
advanced stuff to give people the search
results they're looking for and well
let's assume you want them closed off
section as well where users can come and
log in and do some more advanced stuff
you need access control for that maybe
you want to email those users of course
the website should be interactive and
work well and be fast so you need
WebSockets for two-way communication
between the clients in the server and if
that site is still working well you're
still standing strong and you're getting
more and more traffic then you may need
to offload some files to as 3 for
instance or some other file store
and Indian maybe do even in to use a
reverse caching proxy like like varnish
or nginx that's a lot to take in just to
build a simple website right and while
it may have been initially hilarya ting
it's going downhill from there you just
bill out many people do and what do you
do even if you're in their link
programming you pick one of the existing
solutions I'm not naming names they're
not necessarily bad except Django
perhaps I mean it's it's in the name of
obviously the logo and you'll find the
defender Ling central for instance is
not running erling itself will be doing
something about that in the near future
so what I want to tell you about today
is a third option and that will be so
tonic where you can combine using Erlang
that you know and love hopefully with a
good and fully packed CMS first though a
little disclaimer I'm I'm kind of an
outsider to the Erlang community a
relative newcomer to the Erlang game so
it's quite an honor to speak at this
owning user conference and as you know
outside this it doesn't always go well
some some of them after the tendency to
misunderstand to misrepresent and
basically screw up things so let me try
to be the other kind of alien the
friendly one that comes from a different
community that will be PHP and
object-oriented programming in general
in my case and you know the alien that
brings some hopefully valuable insights
from the outside world that's the reason
that I'll be going into the early ego
system as I as I experienced it a bit
later on as well that does mean this
talk will be a bit less technical
probably so you can count the number of
code samples on one hands and remember
this only four fingers there
so Who am I I'm David I'm from Holland I
like wearing the t-shirt obviously I
booked it a bit and Amsterdam where a
web agency and we're working with
clients that want to make a difference
whether that be in sustainability or
helping museums digiti publish their
collections that have been closed off
before helping children to learn other
people older people to remember their
past and we're all doing that most of
that with atonic which we adopted in
July 2014 as the stack for us to build
on and with the tonic came Berlin of
course we now have about 50 sites in
production running on so tonic and in
the meantime I I joined the Sultana core
team as well as a maintainer and let me
just ask you how many of you you already
know so tonic or have seen it before I
see some people shaking their heads and
some people raising their hands and how
many of you are using is not so many
that that will be interesting to talk to
talk about afterwards perhaps let me
hopefully try to change that a bit so so
tonic is both a I already mentioned this
it's a content management system like
Django like like the other ones and a
web framework it's all written in
Internet obviously it's free and
open-source sorry comes with a web
server built in an email server it tries
to do a lot of stuff for you so remember
the list form before starting with the
simple blog and ending at scaling up and
doing reverse caching proxies and all of
that this atonic actually does all those
things out of the box
and like I said it's Erlang so you get
the the asynchronous processing that
comes naturally if you want to offload
some tasks that are not needed to
directly serve the HTTP response back to
the client
such as sending emails or doing some
logging that works really well with
Erlang you have the lightweight
processes that are very stable and
long-lived and they play really well
with modern web tech actually in
particularly WebSockets where you where
you need the long-lived connections
photo Lorenz is really useful so people
can start using so tonic developing
stuff with it start changing small bits
adding small bits but not making the
system as a whole and stable it's just a
small small bits they touch that that
will not work if they are making some
mistake which can happen of course and
what we do is try to offer pure erlang
solutions were possible I already
mentioned the email server we do that so
we can track bouncing bounces and do all
the deal logging as well for email
we don't use any external cache for the
whole data like Redis we do that in
earning itself as well the in-memory
cache which is quite easily done with
with apps obviously and in the end that
all leads to less waste which make sense
for for clients that care about
sustainability and people care about
that to use the resources to computing
resources also that you have as
efficiently as as you possibly can
and there are some more things that
that's a tonic office here you get
control of this pages so you may be used
to frameworks like cowboy which are more
low level we actually rely on cowboy for
the HTTP layer where you have to write
controllers to serve pages and define
routes or dispatch rules to get some web
application working to make that easy we
just have the what we call the
controllers as pages so there's a naming
convention in the templates that you use
you'll see some examples of that later
on
that will then be automatically be
rendered depending on the kind of data
the kind of pages that you're showing to
the client same for routing you can
define routing rules or dispatch rules
manually which you can also rely on also
tonic and do that in the in the admin
interface to to define at what URLs the
content should be available there's also
some nice things we use MQTT I've heard
the name before it at the conference for
a messaging between decline to
JavaScript client and the Erling backend
it's it's the actually it is it's an IOT
protocol it's very efficient and
lightweight but it works really well for
this use case too well and the email I
already mentioned then there's there's
more of course the let let me and all
this revolves around some some
principles three basic principles
let's allow you to develop website and
web apps rapidly the first is that we
have powerful templates so I already
mentioned that you don't have to write
controllers to do stuff to do basic
stuff at least you you can get there
just by doing templates you can do a
whole lot from templates templates as we
say they drive the data in your
templates you decide what data you pull
from the backend instead of pushing the
data from the controllers to the
templates and what you want to do with
it how you will render it what what what
you how you will display it all of that
because the templates are so powerful
that means that you can do a whole lot
without having to write any of your line
code you can do whole lot just by
writing templates index which is quite
similar to the Django template language
so that's a very common standard that
many people are used to and which makes
it easier for non Erlang developers to
go and try so to link and adopt it
secondly we do quite aggressive caching
I mean erling is is quite performance
compared to PHP that I was used to by
itself but still it's not the most
efficient way probably to do to run your
programs but by aggressively cashing in
the deb cache pdfs tables which is built
on yet stables I can mentioned that's
not really problem for us
as it turns out a website usually is
only a small portion of hold data that
is really needed to serve most of the
requests and that only takes like 100
megabyte or maybe maybe a couple times
that up to to half a gigabyte to to make
at least 80% 90% of the website
extremely fast
and finally we try to include batteries
so there's a whole lot it's quite a big
application I'll be going into that a
bit more later on so you can get started
quickly let me just show you a quick
example of the templates index and what
makes that so powerful is it's a very
simple example but still so of course
you can just display some properties
that belong to a resource or page as we
called and default one in any template
is the page you're currently looking at
that will be ID so you can just display
its title but that's quite simple
obviously but then you can also do more
advanced stuff like directly search
through your data from your template we
do so through view models that's that's
the EM search you see here that actually
calls some Erlang code but you don't
really have to care about the
implementation details if you're in the
template you can just search for some
some items articles in this case that
have some relation it has object 1 I'll
be going a bit more later on into the
data model that so tonics built on some
items that have an outgoing edge that
have a knob jecht
which is defined as the author relation
to the ID to the current page that we're
looking at so assume that ID title is
the author's name will be displaying in
the list the article the articles that
miss this particular person rose and
same thing goes for more advanced stuff
like like access checks and ACLs and
also what we call live templates so you
can have dynamically changing bits in me
and your web application without writing
any JavaScript as well so what this does
then is render a template is that
readable by the way in the back
oops oh yeah good is render some
template we I call that user status dot
TPL and that that templates here here
below where we check if someone is
logged in
is there a user through the ACL model in
this case not the search one that we
greet that user else
the current visitor is not logged in
we'll just have an anonymous greeting
now the cool thing about this is that we
can have that template subscribe to one
of the mqtt topics in this case that
will be with some conventions there but
that will be the page session so the
session of the user currently looking at
the website and then we can decide to re
render the template if anything changes
about the session if the user logs in
logs out or or other session related
changes events so instead of writing a
lot of JavaScript to to make parts of
the page dynamic without having to
reload everything on the server
obviously you can take small pieces
small templates and re-render only those
when something specific changes so that
the session in this case but there's a
whole array of topics that you can have
your front-end template subscribe to
that can be resources as well so the
author example that videos so if
somebody is changing the title we can
live reload that rerender that just that
small piece in the front end and there's
more topics you can also of course
define your own custom topics and
publish messages to that from early
right I already mentioned this so all of
that makes makes it so that you can have
small teams teams that concerns that the
consists of just a couple of developers
that don't all need to know how to do
Erlang and built quite some some large
systems with that have a great impact so
I'll give just a couple of examples
quickly some things we've been doing at
ribbit and some things that happened
outside of that one is an award-winning
digital monument where Dutch Jewish
Second World War victims are being
remembered
so there's a whole visualization here
that actually burns on the plains atomic
data model
there's also products being built on the
tonic channel knees is is an example
it's a cow browsing software they are
useful for for help desks for instance
that they can look at see what the user
that's experiencing some trouble is
seeing at that moment it's very secure
just it's purely browser-based so now
now there's no need to take over your
remotely in the computer
complete system another example is an
e-learning platform called learning
stone it's quite extensive it's it has
all the large number of users and
closed-off sections which would make
resource caching quite quite hard there
but still very performant and well we're
actually making some games also tonic as
well this is a platform for gamified
eLearning to teach children about the
Natural Sciences well as you can see
from these four examples it's it's
they're quite different obviously but
they all rely on the same the single
data model and that's actually very
simple one which make
it's very generic and flexible as well
it is a graph or a graph graph like
structure so you have resources or pages
and relations or edges in between them
the edges always have a direction that
go from a subject to an object and their
labels as well by some predicate so in
this very simple example you can see
that there isn't some article the
article has an author and ends in this
case there's another person who has no
relation to the article Bob and that
same article has another labels relation
outgoing edge two to two keywords that
you see on the top we actually don't use
a native graphs or for this we just use
Postgres because it's a very performant
and and rather reliable as well but we
offer this abstraction on top of that to
make it really like I said really
flexible and that's actually one of the
core strengths of subhanak that you can
can build whatever you want and use the
generic data model and get quite far
without having to change the schema or
the schema upgrades all the time
make database changes stuff like that
and if you take that one step further
this this particular data model actually
allows you to do interconnected data as
well not within single website as maybe
isolated silos but also between websites
you can create a network of them because
the interchange the interoperability of
the data is rather easy so that's that's
it actually enables a certain data
vision that we well it's about freeing
your users data not containing it in a
single application a single publishing
for actually enabling them to share the
data with other sources as well which
makes atonic very very suitable for link
data and this is stealing data cloud
it's gotten quite big over the last
couple of years so that's all kind of
different data sources that are that are
referring to two terms and things in
other data sources as well so you get a
network of knowledge it's a bit similar
to what Google is doing with their
knowledge graph obviously I'm not sure
if it's a coincidence but it looks a bit
like a brain to me so okay all that is
fine and dandy but what about the
developers right for a web framework to
be successful in Erlang it's not the
user it not just user experience that
you should care about but also the
developer one what I've been discussing
so far is some ingredients some some
features and showing some news that you
can use those ingredients for - - to
cook up but now I'd like to take a look
in their kitchen as well with you how is
atomic being made um how does the
Sultana community work what what
decisions have we made and especially
what have we been changing to improve
that developer experience while we're
only a very small team we're trying to
do some important things right and when
it turns out it actually helps to look
at some frameworks in other languages
what makes them successful and how we
can use some ideas there in the Erlang
ecosystem as well to make earning web
development more popular
I think there's three basic ideas it's
to be reliable as a CMS and web
framework friendly to get into as well
and it should be definitely easy to run
and just to take for a spin so what
we've been doing is working a lot on
documentation we've revamped it
completely restructured it and we've
adding we've been adding an upgrading
guy to make it easy to upgrade to the
one loader which I will be telling you a
bit more about in a second if you want
to use this to take it for a spin and it
should be easy to start up and boot
right and if they should take it for a
test drive and see where it takes them
so we have no no dependency you can just
run a single docker command and get
atonic started doing your local
developing machine start building some
website with it and see see what happens
and then if developers have the system
running it should be easy for them to
both extend and overwrites Atomics
behavior you don't want to be locked in
to some some system we want to be to be
able to do it to make it work the way
you like so to give you just one example
of that there's the what we call the
notification system and what happens
here is that we saw the search query
like we had before now I added a custom
search there could recommend instead of
the query that we had before that's just
something I made up again I can put
anything there that I like now to
actually do something to go and fetch
some results and get them back to the to
the template for rendering later on I
just have to write a little bit of
Erlang I'm by by adding to my side
module that's that's the main entry
point for your website just just a
single function actually
which by has a convention to be called
observe and score and then then some
some conventional names as well so if
you add that function and you listen to
the recommend search obviously and then
you can do something with that call some
some model of you of yours to give back
some results if you compile this atonic
X of the change add this observer to its
notification system and then when from
the templates the search is called all
the observers will be called by the
notifier and it's it can be a map or a
full Dell or fold our so it's very very
easy to understand for owning developers
what's happening and it just folds from
maps over all the observers in order of
priority so you can have some your site
will usually have the highest priority
of course because it should be able to
override anything and there can be some
modules in between both photonic ones
built-in ones and custom ones they
change the behavior as well of course
you can have your observe and not do
anything at all that that's perfectly
fine and by just returning and defined
the next one in order of priority will
be asked to provide in this case some
search results
second example is 4x checks know whether
the current user is allowed to view or
update or or do anything again you you
can just add the observer of course this
one is called differently you listen to
some view actions then get passed in the
ID the current page the user is looking
at and you can make some decisions for
instance is this particular page a
recommendation is it of the type
recommendation if it's not we just
return undefined that next observer
handle it and eventually fall back to
the tonics built-in access check system
but if it is a recommendation then you
can call some custom SEL code make some
custom decisions and then return true if
the user is allowed to do the false if
not or again undefined if your if you
can't make up your mind and of course
you need to fall back at the bottom as
well for the other kind of disallowed
events that that get passed to the
observer so I mentioned that the web
framework should be reliable as well one
of the things that we worked on this by
doing time-based releases we have quite
a messy release schedule before we
started doing this okay sorry
and there were some releases when
something was ready and there wasn't a
release for for half-year maybe and gann
some release and some someone felt like
like tagging something and publishing it
so what we started doing is every first
Monday of the month publish a minor
release and we've been doing that for 16
releases now and last Monday we had the
odo 29 release
still if we want to make the developer
experience a great one then there's more
to be done obviously we're now working
very hard on the one dot all to make it
really stable and reliable for you to
build your website with there's a slight
problem there in that certainly gets
quite old maybe like good old Dutch
cheese it goes back to 2009 so we had
wait to make some decisions there and
one of them was to look at what the one
data would be about strictly and we
decided it's not about adding features
or not even about adding performance
tweaks or documentation tests it's all
about the backwards compatibility so the
one hotel would be the one moment to
break that compatibility to make some
large changes and and then keep it
stable at least until version 2
obviously that reduce the scope of what
we were looking for quite a bit so
backwards compatibility that nuts a fun
time you can start breaking stuff which
we did we migrated from from watching
web to cowboy for the HTTP server
component we we've been fixing quite
some performance bottlenecks as well
such as memorizing the current language
of the user there was the great buy
notification so as you can imagine we
had a lot of lists a lot of strings but
for performance reasons we wanted to
have them as binaries as well
particularly for the HTTP messages which
would stop them from being copied
between the processes with just being
being shared by reference in Lion
darling and we added some components
that were optimized again for
performance but introduced some BC
breaks as well this particular for
compiling the
the routes to a very optimized form and
template compiled the same thing for
therefore the templates we've gotten
quite far so now we can say that this
summer will we'll be publishing an alpha
these now PD a better and release
candidate as well now what do you do if
you turn the OneNote oh it's it's time
to wrap up some gifts right and that's
that's actually a kind of hard part
still if you if you look back at some
curling history quickly things seem like
I mentioned so Tonica started in 2009
long before hex existed and that only
came out of the elixir community
obviously and that's that kind of a
problem because so tonic has its own
system for doing modules and we even
have our own module repository that
doesn't really make sense anymore to
have now of course where this EXO p.m.
and there's OTP apps being published to
that so that's what we want to do like I
said quite some work I hope to have it
finished before the conference that
didn't didn't happen so I'm still
working on that it's quite a bit code
change but nothing too hard
technically either and then you
encounter all kinds of things for
instance that the hex packages are not
being published are not being update
updated regularly so even if the Erlang
world has X now the world isn't always
sunshine and rainbows and that let me
need just publish a very little projects
call it hex book to automate and
releasing to hex using using traffice
actually you just add some some ax
username and password to your Travis
configuration and we tag something in
your get repository push that over to
get
drivers will take care of the rest and
publish that to two hacks even better of
course would be for github and Travis
particularly these two have native
support for for earning an axe but that
doesn't exist at least not of now so in
the meantime you may may find this
useful then what you get in the end is
this what used to be a very large
application so tonic with its own module
system that you then plug in some some
some of your sites some modules into
that's kind of the traditional way to do
software development I guess have the
this core system as an application
server and then load your own things on
top of that nowadays you would do do
that differently you would start with
your site the thing that you're actually
trying to build for your site or web
application or whatever and that will
align better with having small services
in independent stacks as well that site
then has zonocorp as a dependency maybe
some others atomic modules we are
splitting up the big one we live in two
separate packages so for instance our
SEO resource data model that we talked
about a bit maybe you want to use the
ICL and then you have some nonso to make
dependencies as well that's perfectly
fine
now the tonic core itself will require
the D components I mentioned like the
template compiler and the digit dispatch
one and the in-memory Deb cache but that
will all be managed through hacks
dependencies as well so what this gives
you is is a lot of control over your own
site you just have the tonic as an
external dependency but it measures it
gives your site the center stage right
time
kappa so Earling is great for web
development and if you're building
web-based content heavy applications
just just gives atomic spin it does a
lot and does it well and just out of the
box as well for you so you can be lazy
if you like also we keeping track or at
least we trying to keep track as best as
we can of what's happening in web land
so we're adding schema.org metadata for
instance and also things like JSON feed
not sure if you've heard of that but
that may be some kind of way to revive
boodles RSS to do that in JSON instead
of XML
and then when you need to start doing
things so it only gives you jumpstart so
you can do the rapid development
building some cool things of course
being an open source project we can use
some help to meet to make certain it
even better and also to draw some people
into the Erlang web ecosystem from
outside if if we can people that may
think now that earning is only about
highly technical concurrency stuff so we
want to make Satomi usable in elixir
apps as well if you have some experience
with mixing Erlang and elixir and you
want to help please please come and find
me
of course the documentation can need
further improvement so that's very
useful as well and there's also things
like translations for instance well we
have no Swedish ones still alright thank
okay we have a moment for a couple of
questions if anyone has otherwise either
one good so for for smaller customers
like I don't know little organizations
or even free nonprofits for them it is
important to build something and leave
it there for years and how is upgrades
are done there is the most important for
them how do you upgrade the code and
don't lose those megabytes or hundreds
thousands of pages right well actually
because we have the the data model that
I mentioned that will be very stable so
we won't be doing any migrations to to
the users data and that you're talking
about so that shouldn't be a problem
are you also thinking about upgrading so
tonic itself and then yeah I'm imagining
that like some five-year-old the sonic
is running and I eat but if the time has
come is tall they won't talk great and
I'm worried that I will lose everything
and there's a disaster and it scares
away yeah well I can just say that
shouldn't happen of course I did I
always help to have some database
backups I guess before you start
upgrading to be fair until we have to
bundle tell there can be some backwards
compatibility breaks they won't involve
like deleting your data but some
behavior is is changing for sure but
when we have the the bundle tell we want
to follow semantic version versioning
correctly so there shouldn't be any of
those breaks anymore in your data it
should be completely safe as well so we
no problem and of course if you're
really scared you can just leave it at
the old version right but
I wouldn't advise that all right any
anymore comments the questions I guess
it's lunchtime is a landslide time
please thank our speaker thank you if
you want some t-shirts I have some of
those as well and enjoy your lunch
and
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>