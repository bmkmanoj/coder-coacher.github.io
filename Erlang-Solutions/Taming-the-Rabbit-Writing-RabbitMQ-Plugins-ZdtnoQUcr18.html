<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Taming the Rabbit: Writing RabbitMQ Plugins | Coder Coacher - Coaching Coders</title><meta content="Taming the Rabbit: Writing RabbitMQ Plugins - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Taming the Rabbit: Writing RabbitMQ Plugins</b></h2><h5 class="post__date">2012-11-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZdtnoQUcr18" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome everybody to this afternoon
centerfolds my name is Alvin I hope you
hear what their advance this talks about
chiming the rabbits so it's about
writing right Thank You blinds so just
about me I'm for me as a developer
advocate for our country just might blow
my Twitter I guess I am plagued if so
big Iyaz people is not putting min sorry
with that disco and I toward the move
around and connection this one and this
get started so everything we have like
half an hour for hour and a half dogs
don't just see how this goes so what is
everything you rather than use run it as
an enterprise messaging system it's open
source or the Mozilla public license is
written in allen on TV you do message in
with a mqp you can also use stone MQTT
and many others and is part of his work
so it started as a no company another
game where the future rather than you is
reliable high scalable ECC be so easy to
bluster runs on whenever platform LMK
runs and for n QP has the CWA unseated
of 91 version i want any question
regarding n QV person's own please so
yeah if you think for example you go to
BW safe already thank you you move fine
six or something
open source project created to it so i
think is very popular and what we want
to talk today is about the driving thing
is extensible so right now supplying
system that planning system come with
official plans which are distributed
with the broker and read understand you
release and the community plan so if you
want to have long-term support go for
the efficient planets galaxies would be
like it's come project that you know
when the developer want to work on it
will be up today i need supplies must be
written in a box awake when we say in a
rabbit named you can be easily extended
yeah you need to write them in elma so
if you don't name i don't know i'm sorry
i hope you two or that you want to learn
breath because wealthy enough ugh so
what can you do with black you can add
you variables so for example stomp it is
a protocol but that was added afterwards
too rabbitmq and it's very simple like
you can become and behaviors you press
ENTER twice on your technet basically
and if you send the body and the tips
it's very very basic and for example
does it connect part of the storm and so
on and that's what you get so then
somebody else say ok why ok we have
strong is a very simple text control we
could put WebSockets there and then we
can web stomp and that's another black
so you can do web messaging using the
line you could add our dedication
mechanisms so for people using rubbing
maybe you are not happy with what each
other already so you put on your own
here that is flagging necessarily supply
you could have your own message store so
go for some reason you're fed up Robbie
thank you message store and then you
decide to wrap your own maybe using
react or MySQL Australia's or whatever
you fake in so that will go up as well
but before you go there please rate that
there you will see why it would want to
implement my sister for rabbit and what
you would not one but what if you think
that for example on this machine rather
can do 10k to 20k messages per second
you can imagine how long that message
leaves on the heart run actually it just
touches it how do i go away and so on
then you need to read a message daughter
is the main for that kind of brighten
angry but nerves is no like a normal
database will you just drop a line and
you will query ventilator in messaging
the speed requirement are different is
not faster or slower just different what
you are going to do with this so you can
also do plans the rappelling apps into
rabbit for example there is a cowboy
rapper so if you want to use whatever
library in am I in trouble you just wrap
it in this plan sees this time an elder
brother and so on way machine and by
using those properties you can add a
similarity to the broker so the
management planning where you can see
all the info a rabbit does it actually
shows the blinds and this planning
supports blinds so you
let me have the stoplight overview
connection channel and so on you could
have your own tab there with bartering
for you stinky deeds about rabbit or
atoms maybe your face or the draw phase
I don't know when you put that up to
that life so then there is for example
the shoreline where you can use it to
send data to other brokers and do some
kind of replication you can create your
own exchanges and that's what I'm going
to try to be more than one file you can
have fun yeah so why you may want to
create your own exchange so first who
here uses probably because maybe I'm
talking about stuff that only fee and
the guy that wrote the book knows yeah
so this is how you have a tough
supporting rabbit them let me try to
then what will be enough so this is
something I'm working on is Tottenham
benta alpha maybe even worse so it's
bootstrap whatever but simulator right
so improbably have exchanged right you
have a producer's you want your producer
to get your message to your consumer how
you do that you need to get an exchange
you will send messages into this change
nice but nothing harder they are why
because we need a queue you need to
queue mr. somewhere right you put there
you will be binding a cisco the message
will go there fairly well but again you
need and then to subscribe to the queue
and you started in the mess
then you can have more fuse and you will
get like fan out or whatever right is
that clear that's how more or less
rather than yours so maybe you don't
like that kind of change you want to
have something that do something else
one routing messages so let's go back
here so that's done so you have the
exchanges choose bindings and the rules
for those findings you have three at
least three base exchange type and out
there you can top it each of those will
implement them in our routing algorithm
so that links will be the Scimitar sorry
similar to point the phone message
somehow is basically what does a more
was beautiful and then token is change
you have some running easy son you to
route a utilizar for logging for example
so you could in your rubbing key specify
the server were logging the application
that is long is the most is that
explosion and the severity of it off and
then do the findings based on that for
example you could have like dot info so
you will get all the hospital info you
get all the info messages or if you want
from server one dot dash you get all the
load from that message from that server
sorry am so so with the topping the
change you can do Veloz but maybe you
want to do more so sometimes rocks in
the random exchange this change will log
messages random lift you so we'll pick a
few simpler than some silly but maybe
you can do a load balancing bigger then
there is a consistent hash exchange
that will distribute messages to cues in
the rain using classical algorithm and
you could use that exchange for example
two sharp messages to use and like you
can have a place where you send out your
data you can set up a rabbit bluster if
you have your topic better and help cues
on each of your brokers and then the
consistent hash will try to send your
message to these 1q so if your server
goes down one of those rabbits then the
message we will be allowed to one of the
available cues for that topic is tough
enough there's a real app is changed so
if you want the dairy message that
passes through yours changes all at the
same time blogging to react you could
use direction this is something that
nature doesn't want but a Russian friend
Tom Beyonce can we have an exchange when
you send a message to every cube in the
broker no matter what so this is change
even break security inside ramekin kicks
off if you are not allowed to publish to
that q is a change molecular and then
the one I want to show today is called
the recent history change that's what
this stuff so let's say you have a chat
application imagine that the doctor part
is not there if you have had two strikes
but today's so you have the users
connected to a chaplain sending messages
and then you have all the people in the
chapel ranch but what happened if you
join the chat room like after the
conversation stuff
blue what these peoples don't know so
you want to see the last end messages so
you could have an exchange that every
time there is a new message we'll put
that message in the message cash and
whenever this a new user it will send
those last and messages to the user like
some sort of last value cash whatever so
that exchange displaying the last
chapter of the book how within them so
how do you start standing rabbitmq there
are many cooking points into right one
of those is the behavior so you could
use normal my behavior suspend some
partner private so whenever you see a
behavior that rabbit is probably
something that you could extend people
change that for the message store as its
own behavior exchanges authentication
message index and so on so as you can
see for traveling this change whenever
this amuses to block you will get the
exchange the delivery I need to return
match result what is that result is like
which ques match for whatever reason we
are using dot the livin in that exchange
you can validate this change country in
addition you can believe it right well
what the recent history is changed us is
to just have been extend out advising
and delete so whenever we wrote a
message we cash he will move up to the
list
keeping on in 30 messages when we had a
binding when we have a body photos mean
if you have a chat room every guy in the
chat in the chat room has art its own
cute own private q so when he connects
to the chaplain to the chapel much
change it's actually shows binding is on
cue to that exchange that means we know
we have a new user from the exchange
point of view some when we do a mining
we should send all those last 20
messages the user I am going with the
lead this change will delete the data
rates for that particular chain so
that's something you below and these
change will be in this case behaves just
like this an audition so here's the part
that you minister to say why I wanted to
extend right so you have the right to
public arena here you have every other
project from the ride and you seen you
have this all for the private server for
many exchanges or imagine flying and so
so you can blow that in to use my career
because it's heaps I mean everybody's
business then they are you going to make
check out and he will get all the code
for all the ripples
grantham so that the basic stuff you
need you define of course a lot of gold
so inside that rabbit dragon to public
umbrella you will get your bloody folder
and there are two find that you need to
create the one is a package to MK and
the other one is the make fun and
basically what you will do is to inherit
behaviors from the global make funds so
if you're a friend of rebar forget older
we do maintenance okay then another
cooking pot this is like the most
amazing part 6 of our I mean I really
like that the Kooks stepped in from
wrath so when you have a great assistant
different system need to do like
dependency graph see what do I put first
and hood under am so also you don't try
to write to the harddrive the harvester
reading it's not loaded off the head so
relevant you have that with a very nice
hug then you can pull you 74 so maybe
you don't care about rub it in
compliance maybe you don't even care
I've already thank you but there are you
would strip see something you probably
want having your code probably i will
show you why maybe there's a better self
so those are driving human steps and
make sure you don't see anything so let
me hear so first what is the good step
in the most people just use our module a
property can you see their bad maybe not
where you say again select a distinction
like a this was thanks for recovery what
you will do when let's check Umi key
recovery the motor function the argument
is rabid recover it requires that the
MTD be chipped step was wrong before and
it will enable running ready so many
modules in cyber with imp you had that
declaration rabbit would still something
so I'm not something that comes by
before gala and then what intuition to
check all the modules in the source code
that have a rabbit good stead attribute
and from there they fill this draft that
you can hear and then you can see that
reboot technical 500 cash the worker
polar song until you get this term is a
structure rating once that they are it
will start for example the registry will
resist their life authentication
mechanisms exchanged eyes like that way
find a patron it means they care and
it's ready and then you will go on and
on and on so what that is there in the
radical and I think it should be pulling
into its own library as it could be very
useful and because of that when you read
an exchange you just specify I'm sorry
applying you just specify your book step
what do you want to into the process
here and that's it so that's basically
how you could extend the broker in many
places even without changing the
configuration you could hook up instead
that modifies the application the
environment variable so you can change
image
on background I know necessarily when in
the configuration file so back here so
these are your is it shown yeah so here
what is what i was saying like the
message store because index is an index
for this diminishes let's get on with
class photos and when I first is just
all applications and environment those
variables and their shut with that book
we switch from the default etl stable
message index tour today custom
opportunity resolution for willful
blindness so am on vacation of
computation and startin so dimmable let
me see this is the part where a total
you will kiss me I know everybody loves
you so here I an exchange I hope you can
see that that's the very Thank You Polly
complainer so all that you can see in
blue 4dr can see it out the ripples I
think it fit so let's go here then and
that's my plan so any I'm talking about
the rabbit frag tank your recent history
change so we have a package so in the
package to just say from which blinds or
which lab do the plans plus a redneck
you sever your blogging depends on so my
implement depends on their server and
the other clients
that's basically it you could not more
lush there you will say I want to copy
files for example if you have a web app
under the 3 folder under project people
as I stood there to do that I can show
you it and then the makefile will
include the umbrella make fun there is
where all the magic happens if you want
to know more about that umbrella there
is a readme may fight then explains
every single step that of course I'm not
going to go here but this main running
broker is very cool bike you can be
developing of line then you do make
running broker Andy Andy with the
starter observer with your client
enabled basically so if i go here
this way i was saying before that the
direction for the American planning and
you can see that when is building the
package it's also ensure to copy
whatever is under the dream folder
because it's a way back again so that's
that then i have my module here where I
create my us change so what do I do I
shall say okay I have a behavior which
is the mission style explore the module
that I need to is for now I think really
a good step which has the name of my
module that I'm fine with a new exchange
which is called next recent history in a
QP whatever the grade you extend the
protocol you should make your system
with X something so in this case ends
recent history it will just registered
the exchange to the running global resin
registering for requires elevation
change is already running I mean if
we're in a row Cameron Cameron ready
beside that I also want to stay set up
initial data base for my there for my
exchange so I have a model here or set
up a schema that will enable the the
database what is flying again it
requires that the database is already
running I mean within a load external
infrastructure in that boost end process
of gravity so for example men and in the
initiator I need to specify the
description of a pipeline see the name
and some binary there will be used so
every time somebody want to create an
exchange of that particular type it
to send this recent history person so
here we have robbed whenever we get a
message when we get in this function
record with obvious change information
on a delivery with all the the message
content drowning gyan but not the only
difference here from normal fun of this
change each other wishes cash the
message so this code here is somewhere
down there we'll just put a message on
the other then all the needs we execute
initial transaction where we just leave
the table for this particular change I
mean this is change from that table I'm
here on a binding we get a queue right
so we first check that the queue
actually exists if for some reason
people may have disappear the user is
connected oh no so divine being again is
like from adding the queue to the
exchange i doing that union there so if
i get a proper queue then I get all the
messages from the cash i create a QP
messages from that content of course a
private NQ trying to optimize what we
store on the hard drive so you don't get
the message with all with everything
just that context will then build a full
message and then sent to the to the user
here and that basically so then you have
allocated help set up this scheme I mean
I pretty sure you already know that of
euthanasia and so on so with that we got
an exchange so now the most scary part
is to whom a run
rockland and there is our exchange run I
am sorry for whoever if I fail then some
now let's go to PHP so HP I have a
consumer home recent consumer so this
consumer is getting messages from that
pew I can do the publishers and 100
messages nice then if I create a new
consumer this guy should get ultimately
the last 20 minutes and there you go so
that's the idea exchange you have that
kinda was already on the chat room then
brochures and messages and this one that
showing the chapel got the last 20
minutes so
so like this guy's any questions any
questions a lot
yeah yeah so whenever you can apply let
me go back here contro hey by the way do
you have a book if you have it there is
y so if I'm here one day people will
realize that I give the book to the
first guy asking a question so far
nobody has real data there there it is
so inside a distribution folder in your
planet after it is make you will get
ready recent history change some virtual
number right that file is what you need
to put into the blind folder of the
broker so I forgot that interesting
progress let me go here
so you have a server and there you have
the plugins which now is empty what you
when you get the default distribution
you get for the official plan is there
and they are important you're planning
code then eat same package and there is
rabbit will of poodles no replies there
and then you can enable planks and so on
and going to shop but basically the
package the package will give me use
that will give you that thing is that
works I'm pretty sure yeah you need
every time you install an implied in
interest up bro yeah so management
clients there is a rabbinic you blind
script that lets you list Lions let you
enable plugins I learn to disable plans
by me and that's how you do it you have
the exploit aside a plugin folder list
with this cover all those planets enable
will enable glass decline dependencies
and the same for disabled for example
people management blind depends on mochi
with and also when machine so those
plans will be enabled by default equal
pills you cannot run right I may be
there so ask to plunge running the same
error process a private mu so ask them
robot said today in the same way like a
nice could crack your bill dear Ellen
built a machine you can do the same
with a life in regards to relatives so
whatever wrong we do we will be to the
broker gift my totally on optimize
recent history change could create
doesn't blow up the server if I you are
not start pulling more messages their
initial for ism so you need to know what
you're actually doing so they make
better your local have fun experiment
and any questions they're not normal
thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>