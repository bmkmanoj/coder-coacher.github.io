<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Registers: Systems of Record with Guaranteed Integrity - Philip Potter | Coder Coacher - Coaching Coders</title><meta content="Registers: Systems of Record with Guaranteed Integrity - Philip Potter - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Registers: Systems of Record with Guaranteed Integrity - Philip Potter</b></h2><h5 class="post__date">2015-11-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ys2vUcVJOy8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Phillip Potter I'm from the
government dish service and just a
little straw poll who's heard of
government digital service or GES as
it's a good number okay so we were set
up in 2011 to support the digital
transformation of government just at the
start I'm going to say this is a
technology conference and this is a
technology talk but I'm going to start
with quite a bit of background to talk
about why we're doing what we're doing
so here's a history of of GS we were set
up in 2011 I will talk to you about what
we as GDS have done in those last four
years what we learned and what it means
for what I'm now working on so you might
recognize some of what we've done maybe
not all of it so Gulf dot UK is probably
our most recognizable thing it's the
single place to find information about
the government but we've also soak up
that UK is focused on publishing so it's
about users finding information out and
from a technical perspective that's a
relatively easy problem because you know
you put some information on a website
and you put a CDN in front of it and
you're done in terms of good content
there's a huge amount of work that's
gone into it but from a technical side
it's relatively simple compared to some
other services that we are also working
on so when we talk about a service we're
talking about a user interacting with
government so applying for a driving
licence or registering to vote or
starting up a business these are all
things that involve government
recognizing something or government
changing something we've also worked on
some other things WK verify is an
identity platform you'll hear a bit more
about that and I won't go through all of
these so the point is it's not just a
flat UK it's not just publishing
information that we do we sit at the
center of the civil service we work as
open agile multiple disciplinary teams
we work with we were
from the center of central government
but we work with teams throughout the
whole of the British government so we've
collaborated with people in the
department for work and pensions and
with her Majesty's Revenue and Customs
to help build better services and what
we've learned in those last four years
of doing those things is especially or
when we were working on after EK is when
we're building services we want to build
them for users and we want them to build
you to meet user needs in particular a
user doesn't care how government is set
up they don't care about the names of
departments they don't care who's
responsible for what they just want to
get something done so they want to know
when the clocks go back or when the bank
holidays are and they don't have want to
know who's responsible for that
information and by creating Gulf lot UK
we created a single place that people
can go to for information there's still
problems though because we could we can
create a single place for publishing how
do we create a single place for services
there are hundreds of these services and
they're all specific to these individual
bits of government we couldn't go around
each one of these and fix it there
there's too many would take ages and
their own as I've said there are now
teams across government who are good at
building individual services but there
are still barriers to boot making them
great and one of them i'm going to talk
you through an example is suppose i want
to start a business selling food then i
need to first create a company and in
the UK you do that by going to Companies
House and you go to this page and you've
got to create a company can't with
companies house and set that up then
once you've got a company you still
haven't got a full business because you
need to register for taxes so there's
different kinds of taxes you can
register for about its HMRC that you
have to go to so it's a completely
different system that you have to
go to and a different account and then
having done that maybe you're restoring
information maybe you've got some
employees and you're storing information
about them so you need to register with
the Information Commissioner's Office
and so this is another system I've got
to go to so and then because I'm selling
food I've got to have a license for
selling food so I've got a register here
a fourth system I've had to interact
with and it's been on me to understand
that structure whereas what we want is
to start with needs we've got a we've
published our design principles on how
we build services number one is this
start with needs and to make sure make
it very clear this is needs of the user
not needs of the government and so that
service it's definitely something that's
being worked on I'm not picking on HMRC
in particular or any of those people in
particular but this is a common pattern
where someone wants to build a service
for a user they end up having to
interact with these other parts of the
government so what can GDS do now to
help to help the rest of government
build these good services that meet
users needs and the best way we can help
is providing the tools services
standards infrastructure that make
improving every service easier and we
call this idea government as a platform
we have not emacs we've put together a
two minute demo of what here's a demo
that shows the digital state in action
let's look at a fictional new service
from central government buying a fishing
license first you start at gov dot uk'
just as you would for any other
government service then you have to
confirm your identity this demo shows a
fictional identity platform but we
expect govorit I to do this task you
enter your details and you're signed in
next the service asks for your
permission to access data about you held
in registers
your name age and any existing licenses
you hold just those things and nothing
else you grant permission with one tap
straight away the service knows you're
old enough for an adult fishing license
because you granted permission there are
a few more details to fill in depending
on what license you need and now you
have to pay for your fishing license
this is a cross-government payments
platform it looks and works the same
across many different services a few
more taps and it's done here's your
digital fishing license you can save a
copy on your phone and show it whenever
you need to another example this is a
parking permit service from a fictional
local authority again you have to
confirm your identity it works just the
same way as before now the service asks
permission to see some data in this case
it's your home address and details of
cars you own just those things and
nothing else straight away the service
knows which car needs the permit and
where it will be parked the fee is
calculated instantly and all this
happens because you granted permission
for the service to see data about you
now you just have to pay for your permit
this is the same payments platform that
we saw last time a few more taps and
it's done here's your copy of the
parking permit the local authority
automatically knows your car is covered
there's no need to display a paper
permit in the car window
so that kind of gives a sense of the
vision of government as a platform and
was its tools and building blocks that
we can provide from the center to help
individual government services build
good services that meet user needs and
within that a critical part of it is
getting the relationship with data right
this is becoming quite a pressing issue
the this conference has been running
concurrently with the open data
Institute summit which was yesterday
this is the transitive closure of my
boss Matt Hancock who is the Minister
for the Cabinet Office so he's and he
was he gave this speech yesterday and in
it he said our core data sets must talk
to each other built on high quality
registers instead of lists of data
replicated in each government department
so I'm going to try and expand the rest
of the talking about what that one
sentence means basically so this is what
i'm working on it's called registers and
it's based on this premise that bad data
hinders building good services and these
are the kinds of problems that you can
experience when you're building a
service on top of some data access and
liveness so can i can i access it or do
i have a copy of it and if i've got a
copy of it is it is it up to date or is
it been you know some months before i
updated it quality and the cleanliness
duplication and authority and provenance
and these are overlapping but related
problems so we are working on defining
good authoritative lists you can trust
this is what we mean by registers we
call them and this is the this is the
sort of high-level view so the box in
black is a
an imaginary service and let's say it is
this service to start your own business
and then at the bottom we've got these
blue boxes each one of them is a
register of data and they're managed by
different custodians so the three blocks
is on the left or managed by one
custodian managed by organization one
and then each of the other boxes managed
by another organization and then the
service is able to take all of that
produce a single thing to the user so
the user doesn't have to see this
structure of government the service can
own that so what does a good register
look like we've started writing about
this there's a blog post the product
manager Paul Danny wrote a couple of
weeks ago now where we try to list what
what good looks like I'm not going to
talk about everything he wrote about
there i'm going to pick three things
which are that they are accessible there
authoritative and they're trustworthy so
accessible the problem is I know I'm
preaching to the choir here but not
being able to access data working with a
working with an old copy of a data dump
that you downloaded some time and
haven't updated is not really good
enough for good services we should
really be working against a live copy of
the data which really means programming
against an API it might be surprised
that that I'm even making this point but
it's this is not a standard across
government there are a huge number of
barriers to even getting access to data
if particularly if it's one branch of
government trying to get access to data
that is notionally controlled by another
branch of government so we've built a
prototype to explore these ideas of what
good data looks like what good sharing
of data looks like
so here's a an example entry in a
register for up for example maybe a
postcode so we've got postcode wc1a one
AAA it's got some location data and it's
got the identifier so you can browse it
in HTML because we want to build
services on top of it you can also get
access in Jason but Jason is not the and
window Jason format you can see some
extra details about the serial number
and a hash and i'll talk more about
those later jason is not the only format
people use different programming
languages people consume data in
different ways so we also make the same
data available in other representations
so yeah mole or CSV which has the
benefit that you can open it in a
spreadsheet program so it's good for ad
hoc tasks we also support tsv if you
prefer SED and awk for processing data
we also support various types of linked
data so here is a total representation
and the fact that it's linked data also
is important I'll get into that so as
well as being accessible there behind an
API good registers are authoritative
this is a more interesting concept so
problems that you often get with access
to data is the the quality of data isn't
very good there's missing columns or
there's typos inconsistent spellings as
just general cleanup their needs to
happen there's one data set I looked at
recently where they had 12 different
spellings of Scotland
so you know yet Scotland and Scotland
comma UK and Scotland comma United
Kingdom and then skoland or Scotland ads
or and it's and this is not an unusual
occurrence another problem that you see
is the same kinds of data available from
different sources and what's the problem
here is well how do you know who to
trust what if they're different or if
they disagree with each other how do we
maintain consistency so when we say they
should be authoritative what we mean is
a register should be a single source of
truth and a register should have a
custodian there should be someone who's
responsible for looking after this data
and they are the only people responsible
for looking after that data so I'm going
to go through an example from our
prototype this is all data we've we've
put into our register product although
it's not it's not available for public
consumption yet because we're still
working out what the details of things
and so this is a potential service for
exploring premises that process animal
products and this one this premises is
called Robins pie and mash it's got an
approval number EF 0 17 it's got an
address there's we can put it on a map
you can see at the bottom here there's
some food sector sections approved that
means what kinds of animal products is
it allied process because this there's
meat the shellfish there's dairy there's
honey and so the section refers to the
piece of legislation that corresponds to
the the products that it can process if
we scroll down the page we see this page
uses data from all these different
registers there's a register of premises
there's a register of animal products
premises and and so on and what this
looks like in there register
self well here's our animal product
premises register it's just a set of key
value pairs so we've got the identity of
this specific premises which is EF 0 17
as we saw we've got the food
establishment category so the things
that it's allied to process and then
we've got this premises field which is
this long number and that's everything
in this register so where did all the
other information come from the address
and the location and all that sort of
stuff well that premise that long number
and the premises is a link to another
register a premises register so our
premises is essentially an address used
by a business for for performing thing
and there are many types of premises and
it's an important thing to understand
for the government because businesses
have to pay business rates based on
premises and so it's quite conceivable
that whoever is managing this animal
origin products data set is not the same
group that's responsible for managing
this which business premises exist and
then they might not be the same group as
which addresses exist so once again the
premises register links has an address
field which links through to an address
register and this is where we get into
street address and all that sort of
stuff so we've got three different
registers managed by three different
custodians all got all behind a common
API and it can all be put together to
create a single service for the user you
can also start to see the the data
linking so if we go back to this
original diagram there are arrows from
the service to each register but there
are also arrows between registers so so
that each custodian is only storing the
data that they are responsible for the
problem you've often find is where
estodien is storing data like addresses
addresses are very commonly full of
spelling mistakes typos inconsistencies
and the reason is that that's not their
core business it's not understanding
addresses it's understanding animal
products processing or understanding
business rates and so by separating
these out into single sources of truth
whose responsibility is understanding
that single piece of data and where and
delegating to responsibility to other
people for this peripheral thing we can
increase the quality of the data
available there's a great talk by
Michael my guard called architecture
without an end state has anyone seen
this talk it's a good talk and what he
talks about here is this idea of
dependency of entities in an
architectural sense and on the left
you've got things that are very common
that lots of things link to and on the
right you've got things that are very
specific and so on the right you is
where you start to add context so this
is an address which is used by a
business the process is animal products
so each register is adding more data
more detail into what it does so
registers are accessible they're
authoritative they're also trustworthy
so here's another problem I downloaded
some data where did I get it from again
as anyone tempered with it since is this
truly information from the register or
has someone come along and messed with
it so a register should be trustworthy
and we should be able to issue
trustworthy information from it a
register should have guaranteed
integrity and just a couple of weeks ago
I wrote in detail about this about how
we can use cryptography
to guarantee the integrity of register
there's a link at the bottom rung and
take you through the principles so
here's an example we've got a register
of food inspections so we've got a
number of food establishments and people
go around and inspect them and give them
a rating out of 5 stars so we've got a
number of entries in this register
bridge street cafe got four stars on the
twentieth of february2014 primadonna got
two stars on the fifteenth of april 2014
and so on and the whole each one of
these entries together combined gives
you the whole register we want to be
able to give guarantee the integrity of
the whole register so what we do is we
compute a hash of each of the entries
which are these letters here and then we
combine them into a miracle tree so a
miracle tree is a tree where each letter
each node is labeled with the hash of
the labels of the nodes below so you can
see here we've got a and B we take we
just concatenate a and B together and
compute the hash and we get G and we've
got G and H and we concatenate them
together and we compute the hash and we
get k + and so on until we get to the
top we get a root hash which we've
called em and we take that and we sign
it and it's called signature 5 here
because there are five entries in the
register and and so now I can download a
whole copy of the data set and I can use
this signature to verify that I've got
the right data in the right order but I
can go further than that I mean let's
say Roy rolls here want to display on
their premises that they have got a
three-star rating and they want to have
a guarantee that this really is what's
in the register what they can do is they
can offer a proof so a record in a
register should have a digital proof of
authenticity
and this is from the video that this was
a fishing rod licence but we're talking
about what might be in this barcode or
this or this text string it could be an
identity number or it could be a
signature of that record right there and
so this proof can be done with this
Merkel tree so what I need to know in
order to guarantee that Roy's rules is
in this tree is well I've got the entry
because you gave it to me and I can
compute its hash but I can't compute em
unless you also tell me what K is but if
you tell me k and I combine it with E
and hash it to get em I can have
confidence that this Rose rolls really
came from that sub tree because you
couldn't have come up with another value
to give a different value m because
that's the property of hash functions
and then I can verify that the signature
validly signs em and having checked all
that out I now know okay this really is
an entry from the register and in
particular I haven't had to download the
entire register to check the proof that
a single entry is in there so I have a
nice way of taking extracts from a
register and demonstrating the
authenticity of them and I can download
that proof and keep it and check it
again later there's all sorts of good
properties that gives this gives which I
will get into another thing is a
register should keep its word so once
we've issued a rating we shouldn't be
able to rewrite history we shouldn't be
able to have some malicious actor go in
and remove a bad rating for a restaurant
or remove a good rating say and so how
can we prove how can we add data to a
register and prove that we haven't
removed or changed any history so here
we've got our original register
and then prima donna is rien spected so
we add a new element to the end and now
we compute a numerical tree using the
same rule as before so we've combined
enf to get and hash it to get I we
combine k and I and hash it to get in
and only the green parts have changed
everything else has stayed the same so
we've been able to reuse this whole
subtree below k and we compute a new
signature but at first sight this looks
like it has nothing to do with the
previous one because it's a different
route it's a different signature how do
I know that history has been preserved
well I can prove it to you with what's
called a consistency proof if I can show
that the the whole five entries in the
the tree of length 5 is the same as the
first five entries in the tree of length
6 then I can show that i haven't
rewritten history and the way I do that
is well all I need to show you is well k
I give you K and E and F and tell you
where they are in the tree and then you
can compute for yourself that osk any
combined to give um which matches the
original signature and K E and F
combined in this way give combine to
give n which gives you the new signature
and I can see that K and E form a prefix
of the the tree of length 6 which means
yes history has been preserved so we
have the that we have the two kinds of
proof here we have the proof of an entry
being an extract from a register and we
have the proof of history being
preserved and that a register is truly
an append only data store given it an
append on the datastore there is then
the question of how do we track changes
because the real world does change and
so if we go back to this product of
animal origin example let's say that we
get any Robbins pie and mash expands to
also process eels which means it wants
to add another section 2 this food
establishment categories can everyone
read this by the way yep good so we can
take we can take this entry change one
of the elements and add a new entry and
you can see how we've added an extra
section here the other two haven't but
also that this hash has changed and
because that represents the hash of the
whole of the contents and we can also
look at the history and we can say well
entry 3 for 16 from the register was the
first version of EF 0 17 an entry 5817
was the second version of EF 0 17 and we
can join these together because they
have the same identifier here so we this
is sort of like a primary key except
rather than being a unique constraint
this primary key is a thing that
identifies a history throughout the
whole register and I don't know if any
of you came to my colleague issues talk
yesterday which was about schedulers he
said one of his refrains was I see
shedule is everywhere well I see
registers everywhere because I don't
know how many of you been been playing
the giant operation in the in the lobby
out there you can see we've got a wall
of fame of people and the time they took
to complete the operation so we got
Michael took 53 seconds and javi 856 and
so on I did quite well I got 52 and then
Xavier came along later and got 41 so
this is our append on the list and we
don't remove Javier's previous thing we
append to the end and so we can see his
improvement over time of course it
didn't quite work out like this because
I looked at it again today and we've
gone back to bad old mutable state
but but we can see how we sorry we are
we are also lacking hashes it's a very
good point so if we put it all together
what does this look like to build so
data comes into the system somehow we're
imagining proposed API so I propose to
set up a new company I proposed to book
a driving licence and then this is
wonderful bubble to put on any slide
which is a cloud that says domain
specific program processing the this is
because we're trying to solve the
general problem of data for each one of
these custodians will have a different
way of maintaining updates to that and
and they could be as simple as somebody
applies for something and you just issue
you do some checks and you issued a
license or it could be as complex as
let's say we have a register of what
food establishment categories exist well
the way you change that register is you
change the law so inside this bubble is
the House of Commons thankfully that
that bit is out of scope for this talk
but then after that we decide on certain
things we want to append into the
register through a mint API so we call
the process of adding data to the
register minting it and as we do that we
also have in computer numerical
tree and we've got this append only data
store and this is aggressively
normalized and also aggressively not at
all indexed you can read through it in
serial order and that's it so then you
want to be able to actually run queries
on the data so you want to see okay tell
me the detail about premises EF 0 17 so
we have a key lookup index and this is
index is created by scanning through the
append only data store and then
streaming updates from it and it can
store okay what's the latest version for
each of the end of the entries in my
register and then in front of this we
can put a read API and services can then
consume off of that API to consume the
data there's actually so this is a
complete system this is a thing that
could be built could work but there's
actually one extra thing you could do
here which i think is quite exciting
which is because we've got those proofs
of the validity of extracts from the
register you can have a third-party
index the register so they can download
the whole register index it and maybe
stream updates and keep their index up
to date and then a service could consume
that index the reason this is exciting
is because in a lot of cases indexing is
hard and domain-specific you know full
text search depends on the kind of text
that you're indexing over geo search can
be depend on the kind of boundaries
you're dealing with and so you can build
a third-party index that when you run
your search queries out of it it gives
you results which are entries which have
proofs that they came from the original
register so you can have so you can
despite the fact that this third party
might not be that trusted relatively
speaking it can give you entries that
are trusted and one of the things and
this is because we've baked proofs of
integrity into the data itself we've not
just tacked it onto the transport layer
through the use of HTTPS you know HTTPS
is just guards a single link whereas
these merkel trees guard the data itself
no matter how many hands it passes
through so that's as far as we've got
really talk about where we're going from
here we don't have all the answers yet
some of these things so we don't know
what those third-party indexes will look
like we don't know
a huge amount about this domain specific
processing we're still not sure the
details of all these AP is that's okay
we're only just beginning to ask the
right questions on this stuff and there
are definitely still unresolved issues
but we think there's definitely an idea
here about registers which are
authoritative lists you can trust so
here are the references for links in the
talk thank you very much we have any
questions I'm just curious real quick
about implementation details there
datastore the index yes so we're
building this at the moment on postgres
partly because postgres sports Jason and
so we can do Jason queries and the data
that we are storing is in Jason we're
going to change some of that we're
exploring so this append only datastore
here right now it it's as they say this
is postgres and this key lock look up
index is also postgres we're exploring
using google's certificate transparency
product because i mean in fact the whole
thing about medical trees is straight
out of google certificate transparency
project in their situation what they're
dealing with is an append only log of
x.509 certificates here what we're
interested in is an append only log of
as it happens JSON data but either way
it's the if we don't have to rebuild a
cryptographic primitive we don't want to
so we're exploring using that product
instead
so I see how the mercure tree will help
you prove that a certain record exists
in a register is there also some way you
can prove that a version of the record
is the latest ie proved the absence of
subsequent versions of that same like a
primary key thing so yes that that's a
really interesting question and it's a
much harder problem because if you prove
that a if you prove that an entry it
exists in a register well that's that's
a thing that never stops being true but
if you want to prove that an entry is
the latest for a signal register well
that's a thing that might stop being
true at some point in the future and so
whatever proofs that you have there
needs to be some sense of expiry there
needs to be or there needs to be some
way of going back to the source of truth
where you have to go and ask the
original register is this still up to
date there's some work again from the
certificate transparency team around
verifiable maps there's also a team at
cat remember where they are I think it
might be University of Illinois building
at working on a thing called the update
framework which is actually in the
domain of software updates because in
software updates is very important that
you have not just a valid signed up to a
software update but the most up-to-date
one that's got all the security patches
in it so there's there's definitely
research in this area we're focusing for
the moment on validating the entries but
we want to get somewhere where we're
exploring getting even stronger
guarantees in the future
so yeah for this talk I limited it to
open data just because that's easiest to
talk about but we're definitely
exploring the idea of of registers that
are not openly accessible to the world
but Tate contains a personal information
or contain information that there's
administrative fees to access or similar
things like that I think an interesting
idea there is where access is different
maybe it's a different register and the
register as a whole is either open or
closed or private or how every would but
well you would you would link so the the
private data might link to the open data
to enrich it with more private
information but as I say that this is
all very speculative at the moment as I
say we've been focusing on the open
stuff for the moment
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>