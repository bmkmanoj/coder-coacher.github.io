<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Meeting the challenges of modern mobile messaging with XMPP - Michal Slaski | Coder Coacher - Coaching Coders</title><meta content="Meeting the challenges of modern mobile messaging with XMPP - Michal Slaski - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Meeting the challenges of modern mobile messaging with XMPP - Michal Slaski</b></h2><h5 class="post__date">2015-02-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zVyA-Dgl3jM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is me hushed as you can see
despite follow me on Twitter is my meet
how Slutsky time and today I will talk
about a chat feature a chat feature
this is text-based communication this is
from the first use cases for the
internet send the message text message
to the other person so we had some first
messengers and the early days of
internet Oh actually systems like talk I
see I see - this is how we look like
some some years ago but then all of the
technologies evolved we have now some
modern messengers which nothing like the
ones from the old days they still
believe the text communication but we
also helped voice video file sharing and
also other features that you can think
of so this is how the modern messenger
could possibly look like it has lots of
other things in text still the principle
the use case for it is to communicate
now but also has changed over the years
is that those messengers have now run on
mobile phones they use mobile networks
LTE and very supporting mobile workers
so you can own a phone with someone when
you actually switch to your laptop when
you are again on the move for lunch
break
but will you continue your conversation
again on your phone so you switch
devices switch computers but this is
still the same conversation which is
continuous so this is what I call a
mobile worker someone who's walking
around maybe speaking cities or
countries it is can anyone spot some
pattern here
yes so is it any different from those
messengers that we had on our desktops
some years ago yes this and this being
for today is to first explain what are
the challenges mobile messengers also
how a man whose aim is trying to address
them
so you have mobile phones it means that
it has less power
typically when a web browser running
under desktop if you opened a mobile
network it means that this network is
noisy it means that sometimes you will
drop packets
everything will be delivered also the
latencies will be much higher than if
you are connected through a broadband
connection
if you are a mobile worker it means that
you want to switch devices when you are
going for lunch
with you 30 each laptop you will take
your iphone with you some other mobile
device and that way if you entered an
office and you were having some
conversation on your phone you want to
actually switch over to big screen and
start using your app and yet we want to
deliver a seamless experience on all of
those devices throughout the day those
are the challenges how does it have to
make it all happen
that works small devices mobile before
we go into it like how to solve it I
need to introduce also a few concepts
around XMPP XMPP is protocol which is
useful messaging it has been invented
many years ago when XML was it is not
days but at the time XML was the wave
and coding things and also it was
solving some issues of desktop computers
of connected to broadband connection so
XMPP 10 years ago was nothing for this
today it was trying to solve messaging
some problems of ensure that tip is open
standard so you can go to the XMPP porn
website and read about there are some
olives RFC's published which describe
what is what is the core it's secure
meaning you always have to authenticate
users and so this is nothing like email
where anyone can send anybody any
message any time here actually you first
log in users to this XMPP network
Authenticator when you authorize them to
send a message so there is
all spam or it was not as much fun as in
email networks it's flexible being based
on XML you can actually build new
features custom extensions has to be
leaders on top of the core which is
defined by RFC it's decentralized
meaning it was designed to power menu so
it's not like there's one central
operator who's providing the executor
service worldwide instead you can run
your own XMPP server at your home and
then connect to others since if we
centralize protocol and network which is
actually good because it can scale much
better and also and it's proven because
it has been around for more than 10
years it was used in many commercial
commercial successful projects from this
now the issue is that the same duty
probable was defined some years ago as I
explained when there was no mobile
phones networks workers but I said it's
flexible and indeed this the XMPP
standard foundation which is the dead
body which is trying to establish some
squirrel discussing standards which are
proven and that are trying to explain
how to solve certain patterns becoming
xep accepts so through enhancements for
those accepts the XMPP community was
trying to work around the new challenges
arising from mobile and a number of such
extensions
developed over the years some few years
ago the XMPP community was quite
comfortable with it and it was quite
realistic to say yes XMPP can now
support mobile users the only issue is
that now once the standards are online
and published others have to adopt
standards server implementations and
client libraries out there and as you
can imagine with anything which is open
source and open standard the level of
support for different accepts in
different servers or private libraries
will be different over time so this is
not like all XMPP opens of service
support all of the steps which power
mower
fortunately Mongoose are in does the
2014 will be working on bringing support
for the necessary except to Mongoose
a.m. and those are the street management
which is accept one nine eight this one
ensures that even if some portion of the
traffic got lost because you just
entered an elevator or you disappeared
in a tunnel or actually in the forest
there's no reception anymore those
packets even though not the neighbor
will never be acknowledged so later you
can try to read transmit those packages
that were not we call it stream of
management so we we manage the stream of
those messages flying from server
deployment from find a server in a way
which gives us full control over
acknowledging that certain portion of
the traffic
or not it said that the device now
because I'm waiting waiting because I'm
gonna make a choice maybe I don't
okay so what we do is to be on the safe
side we will store a copy of all the
messages that someone was trying to send
you when you were offline so that when
you get online we can stream them but
this is a different extension I will
talk about that shortly but just to sum
up the stream management one is about
making sure that even if some messages
are lost and they will be lost for sure
we can manage this situation and in this
institution web and traffic words so
this is one set that we introduced
another one
it's called message carpals and this is
the case where you have several devices
so I happen to have a disciple movie
there is my macbook here and then I have
Angela in my pocket what if I would be
running some messenger on all three of
them
we need message cards which means that
we will actually deliver a copy of each
message that I'm sending out to the
devices so the experience the view of
the conversation is consistent across
all the devices so message carbons is
about supporting multiple devices of the
same user which is then message archive
management is more about storing the
copy of the message so this actually
gives us two things here one whether you
want to explore like five days later
it's possible thanks to the archive
because you can actually browse all your
archive so this is about storing a copy
of all messages that you receive and you
sent in some huge database but it's also
about syncing devices that were
disconnected for some time so for
example I had my phone so when I charged
it and turn it on again it's not that I
missed any message because I actually
had it just to read them all on my
laptop but now to make sense of a
conversation you actually could see all
of those messages then in the meantime
were delivered to my laptop actually
respond and this is the archive
management again we will sync my mobile
so this is up-to-date as is right now
exploring the archives and today I just
I'm trying to give you some background
here for messengers in 2015 the
challenges and the next slides will try
to explain so what is Mongoose and how
does this fit the pictures as primary
source in short yes
so total team you were things that we
introduced working on was to make sure
that whatever we introduced monitoring
us
because it's not only a matter of adding
new features this is also about being
able to support them better
what does it mean to support a feature
in the modern messenger it means
- millions of concurrent TCP connections
where each TCP connection represents one
user session and just one human being
but it's quite likely I would generate
three TCP sessions worth December from
my laptop my tablet and my phone so
imagine we have 100,000 users we
actually need to be able to support
300,000 TCP connections and for every
feature that we support we need to be
able to sustain so for every test we
perform functional test we also perform
some notice this is extremely important
they are you going to have a horizontal
scalability
today we can see which for those of you
who cannot really is that we counting
number of concurrent sessions on a
cluster so this is already a cluster of
several mongooses in nose and this is
why we can support almost one and a half
million connected users actually thank
you speaking you could fit all them all
of them on the single box if you would
only have enough round if you enough
where is not found more than a hundred
gigabytes to support millions of users
but then you start to hip issues on the
Linux I get really nervous you can do
what's up what's that playing they've
got two million yes so we can skate
vertically this is thanks to the very
line of diploma Sheen which can take
leverage yes so for the vertical scale
and then we leverage headline for the
horizontal scale because actually like
the end supports both them SMP so this
is just I'm not going to discuss no
testing indeed Thursday because it's
it's a broad topic and it deserves but
I'm just saying it last year we've been
not only adding features are also
testing the law to make sure that this
does scale so when we text we not only
see how many users we can connect
because this will be dependent on the
RAM but also how many messages we can
push to the system because now it's not
only about the message traffic so the
network traffic it's also about the
database IO if we're talking about the
message archive management feature which
was a copy of each message in an archive
in the database we need to sustain of
let's say a hundred thousand messages
per minute to be written to a database
it's okay I mean quite a lot of
databases nowadays can support our
systems of challenge but we need to
ensure that actually this does support
this many rights per second per minute
so we also have and then we actually
start to hit some limits of the
infrastructure software of other things
and then we also observe two metrics so
where did we underperform so here you
can see messages dropped per minute
doing mock tests it's okay and we also
did conversion there are many other
things things like how many of those
messages had to be dropped
what were the latencies I mean what is
the joy of sending somebody a text and
been waiting 15 seconds today users
expect that the system will deliver a
message within seconds if not
milliseconds 15 seconds I'm gonna change
the message so it's also about latencies
I thought that was fine here we have
contributed some patches and extensions
to consume load testing tool which also
helps you measure the time to deliver a
message which is quite important because
this also shows whether the system is
actually performing according to some
SLA was already overloaded so it feels
like you can have a million users but in
practical terms the experience is way
below their expectation so this is
what's important
we believe that with those feature sets
that we are little Mongoose and the fact
that we can scale millions of online
users we are actually ready to offer
once again yes good solution for mobile
we are planning on adding some more
features like support for JavaScript of
course you can do it already today but
you know enhancements experience add
more database patterns to the message
archive feature and prepare my design
for WebP of things in other words today
is easy to use my goose with XMPP
protocol we would like to make it easier
to use it with some web frameworks but
here is a summary of what mongoose
aeneas it's an instant messaging
solution
it's an open-source XMPP server
implementation which has been adopted
and installed in different solutions
throughout the years social media
gaining telecommunication so think about
in-game chats and users have to
coordinate some actions they take in the
game player you have an in-game chapter
icd-10 communication social I need to
explain what messengers are as far as
social
what's up many others telecommunications
like where you actually need some
signalling later to an any detail
calling on the morning
this can be powered by XMPP and as this
solution has been designed for high
volume this is what makes what that
design looks like even the sideshow
interested in making what have you
achieved
we can discuss this to address this
question so we can spend the second half
of this meeting discussing rather than
me telling twister to finish the story
your solution application is successful
it is a matter of weeks that you will be
getting so we need to scale and this is
why it is a distributed system so it can
spend also horizontal we've been running
on hosted solutions like Rackspace for
example cloud environments like Amazon
so it can scale different platforms
and because of the support for those
features I described we believe that
this is suitable for modern mobile
messengers if you want to grab a news
item you need to either visit our
website find the products session and in
products one of them is Mount Zion this
is where you'll also get some high-level
overview of the architecture
features there's also a number of
webinars that we gave in the past that
have been recorded and published
solutions for example where they have
cluster of clusters that's distributed
across several data centers with many
nodes running in smaller clusters all
combined together of support their huge
database so webinars might be also
answering some of the questions at the
top or you can go
do you have a counter because the good
news is that this is for free this is an
open-source project it's of course not
like really free because they need to
spend some time for exactly downloading
and installing so this will consume your
time but in order to get started to test
it to start to prototype we are trying
to lower the lithium and Twitter cost as
much as we can meaning we publish a lot
of those extensions as open source to
give you a chance to try to experiment
and this is also how I would like to
invite you to communicate with the team
if you will find this solution
interesting we will have some issues
questions maybe contributions try to
collaborate with the team through github
there are issues roadmaps Commons wiki
pages this is truly enormous of so we
try to maintain an open-source culture
around it and this is how I would like
to see further discussions now
and we have this okay genes resources
like looks like and then after slash you
also have this extra beef which can
differentiate between central user
sessions follow him three sessions means
only three resources which means I would
have three entries in this global hash
table and now when I want to send a
message to particular device I can use
Fuji which includes the resource which
will pinpoint this exact TCP session if
you have message carbons also of
techniques
which is huge if you need more there's
cluster of clusters that you can build
running
we're working on a new generation of
which will spend beyond the numbers
currently an offer within a single
cluster but this is in the project
questions about how we tried this
scalable distributed bank and so
unfamiliar with the concept we did not
try to apply this concept we see some
other opportunities
others
yes yes which messages maybe there are
some other Network related issues that
may your query towards time we hang out
and at this point we will drop a message
drop means not not deliver to the user
drop this metric meant didn't manage to
store it in the message archive so we
did the legal we didn't manage to store
a copy still not good and if the guy
would have been displaced well he
disconnected so the several things
online that he was
you send it out but he couldn't so then
it would have been lost
no because most three management stream
management will give us feedback don't
lose the messages don't consider this
deliberate because the guy didn't
acknowledge receiving the messages so we
will store it in this session process
for some time and then once this will
come out and we will try to store it in
the message park in a huge mystical
system we need to be ready to accept
some failures this is why we always have
lots of metrics within the applications
which how many messages were not very
good so we have from metrics
chuckling and chapter infrastructure I
was warning you consider a new
architecture similar to the one of
what's up if you are aware how the
architecture is and if you are in the
correction so I find a where of what is
it that they are doing they are skating
to the numbers to on the numbers I
presented today so we adopted some other
techniques by charting factor we
conference in San Francisco which
evolves all the time exactly what we
have seen because their ever growing
service and they need to solve new a new
bottom X's I cannot say for sure what is
exactly the architecture of what's up as
of 2015 I recommend watching some of the
videos captured
which is still engineering the system
every day and this means that
yes we are aiming big numbers so we are
working with our customers on a volume
of traffic which is tens of millions
what's up with hundreds of millions so
it's an order of magnitude less like I
said another many subscribers correct so
we are working with customers which
still is a challenge and but this is
more or less well among scientists today
those are the numbers that we are aiming
at today any other questions
so what involves these movies
overachiever they focus on the very
feature-rich best support quite some
extensions that we don't so if you have
some you have a need to do lots of
different features I would say jeopardy
might be a better option for you
however we focus on high-volume scalable
and for most cases moment lots of mobile
clients I believe we can offer a better
experience and agility in terms of
scalability and features support which
is specifically supporting mobile users
on the website is list of suppliers
which one currently don't support
efficiently we have experience adopting
some incision open source libraries
especially support they are always
thinking of somebody tell
Motors is meant to work with oh you're
talking about standard exit to be fine
as long as it complies we've started we
will work group support penny
I thought you were referring to some
light runs that you would use this has
been tested with I do see many different
we're not getting any issues on our
conference Apple appear to be putting a
lot of restrictions
push that analogy</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>