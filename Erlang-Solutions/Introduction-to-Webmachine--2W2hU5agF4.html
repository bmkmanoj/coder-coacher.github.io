<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Introduction to Webmachine | Coder Coacher - Coaching Coders</title><meta content="Introduction to Webmachine - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Introduction to Webmachine</b></h2><h5 class="post__date">2012-11-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-2W2hU5agF4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right it's nice to be here guys body
made it's pretty cool to be in front of
all of you and talking about what
machine actually if it wasn't for this
project I probably wouldn't be standing
here in front of you because oh what
machine is about four years old now and
it's eight product of fashion's it's
fairly mature how many people have heard
of wet machine but haven't used it okay
and how many of you have never heard of
web machine okay cool so there's this
this won't be a good talker you guys for
those of you have heard that you've
probably seen a lot of this before but
hopefully it inspires you to go home and
write something with it what machine was
definitely my intro to her leg it's
really what helped me get started and
made the adjustment from other languages
too early so much easier for me it's
just a good place to put your toes along
so my name is matt white sweater i work
for a company called macho probably most
of you know fasho is the creator of
react react is an open source database
but we also make a lot of other
applications as well that are open
source so we probably may be heard of
rebar on a blogger react for a bit of
course web machine which leaves started
at all one of the things that I need to
do here is is just give a shout out to
Justin Cheney who is the CTO of fashion
this is basically a slide deck or just
your rehashing it
and the reason is that one of our one of
my colleagues couldn't be here today he
was going to be talking about nif so I
just jumped at last little bit and
decided to talk about something that was
near and dear to me which is lucky she
so web machine just to give you an idea
is a practical executable model for HTTP
so it helps you build HTTP applications
and frankly when you take a look at this
slide it's a fairly vague application so
let me just add a little bit of color
it's a toolkit easily creating
well-behaved hcp applications so i just
made some claims and what exactly do i
mean when i say easily create this is
our like a lot of people have a
perception that Erlang is difficult i
couldn't disagree with it more but it is
different it's definitely a transition
from what they're used to like I said
earlier for me coming to her leg
initially from the PHP Python Ruby world
as a web developer it was definitely
intimidating when I got started with web
machine it made learning early really
easy it actually all of the functions
that I had to write my defining
resources basically I write things in a
very simple and sequential order and it
was very familiar to me I didn't
necessarily have to get my head wrapped
around the after all right away or even
you know understand and learn OTP which
are both completely awesome things but I
didn't need to learn it first which was
which is what I really needed I just
needed the early white people so the web
machine gave me a really low barrier to
create an app created an app very
quickly and that was
warning thats what i needed to get
excited about our way so it's like I
said it's really easy to create things
but what do I mean like well behaved and
so most frameworks that we deal with
when we write applications give us
absolutely no choice around HTTP it's if
you look at django or rails or something
like that we don't really have a chance
to change the semantics or how things
work all the decisions around HTTP are
made for us and really doesn't give us
the flexibility to to use it in maybe a
restful semantics i'll so you're usually
left with another decision which is just
going to bear about who can just go
right down to the low level open up a
socket on port 80 and voila you can
start handling all this HTTP yourself
and you can do things but that's not a
good choice either because you're either
faced with this choice of having a
really inflexible framework or you have
too much rope to hang yourself and if
you have too much rope to hang yourself
you will realize very quickly that HTTP
is very complicated there's nothing on
this slide that you need to grok right
now it's just an example of the exact
decision tree of the HTTP specification
and exactly what it's makeup is and in
what web machine is trying to accomplish
with it so what machine itself is
actually trying to expose the decision
tree that the HTTP spec or a
specification has been set forth but
then it's done that in an extra table 1
and what's really nice about my machine
is it allows us to use predefined
functional clawbacks that we can
implement that incrementally as we begin
to develop our application if we don't
use the functions it's not a problem we
make same choices and we get exactly the
results that we would expect most
what we're looking for is a 200 ok and
that's good and so if you're a new
developer to our line like me or at
least four years ago you just want to be
able to write the hello world app and
see some success very quickly and it
could not be easier with web machine so
here's an example of exactly what it
takes to write your first web machine
resources about four lines of
boilerplate code you see the first four
it's just declaring the module you know
exporting which functions that are
allowed to be called including the
library for my machine starting it up
and giving the output of it that's all
it takes really the first four lines are
just one look like the last two lines
here is just what it takes to give you a
200 ok but the body that says hello
world so I mean pretty incredible to
write four lines of code and not have to
re-implement the entire HTTP spec so
this is a good thing but of course it's
not very interesting as is any homework
so we probably want to do something a
little bit more interesting and be able
to utilize a lot more of the HTTP
specification and so if you're going to
do that you either have the choice of
going and coding it yourself we're using
web machine and if you do use what
machine is pretty easy i might want to
do something like a conditional request
that in that case all i need to do is
generate an entity pack make sure that's
some kind of unique identifier for my
resource when i return a response and
also give a last modified date so what
machine makes it very simple to just
nick these resource callbacks generate
e-tag again last modified it will
automatically add the headers to the
response body and you can just see that
you know right there it's probably the
cleanest way to do in covert getting
back the state or some x value of the
state so that we can hash it you know in
one way and then wrong that exact date
the last last modified of the file so
really easy to just do these two
callbacks and add two new headers to
your to your bank and actually have
conditional requests and get back three
or four that's the case so you know you
can now see that there's just a few
different callbacks that you want to
make in fact there's probably a few
dozen and I didn't include all of them
because I don't want to overwhelm you
but you know here's just a few you can
see that I can handle 40 ones with is
authorized or I can check whether or not
a resource exists I don't want to return
404 I can always return true I can just
decide whether or not a resource exists
or not maybe it if I'm checking to see
if a resource or a value it is there and
I don't want it and it's decide by some
call dynamic to my storage the resource
exists could actually arbitrarily return
a true or false boolean value to be able
to tell us whether or not i should send
back 40 for along the decision tree
really nice for writing restful
applications so the more of these that
you write more these callbacks these
function call backs in a particular web
machinery source module you can take
greater advantage of the HTV spec as it
is but again you can do it as mentally
as possible and just build on it
incrementally as a developer so you can
continually add new features so you have
a pretty good idea now of what it
actually takes in terms of callbacks but
when you're actually looking at the
callback itself it's really just very
straightforward they have a very
consistent
function signature so you can see that
in any function we pass in two
parameters or two arguments the request
data and the state and that always
returns us a three part 2 pool and that
three part 2 pool is going to be the
return value the request data in the
state so what happens here is that when
we pass this function through or what we
call this function we hit our requested
and we get a value back it's the first
part of this tuple that would be the
request data and we could have lost we
could have modified that we couldn't
necessarily you take the state we can
return a new data structure and what
this does by having this functional this
month function signature is consistent
function signature passing these values
through the request data in the state
you're actually able to then pass these
through and threat them through your
request cycle it's really nice because
it's basically transparent at all steps
and all stages through the decision tree
as your as you're progressing through it
one last point that I want to make is
that the the state is completely
arbitrary data structure and that web
machine doesn't inspect it doesn't
access it doesn't do anything with it
but it allows you to basically maintain
an erlang structure or some kind of data
structure like a record or something if
you want and so for the site code for
the life of the requests I hope you can
actually then maintain state between
function calls and we can be able to
access that mutated if you will force
them in a new way so it's really nice to
be able to do this it makes it easy to
read and it makes it easy to write
so once you actually get into writing a
function of one of these callbacks one
of the things you want to do often is
probably just be able to access the
request data that's coming through and
so we provide as part of web machine
where the wet machine provides the
module called wrq and this is the part
where it allows you to actually access
the data structure but you can't
necessarily need to it will return a new
value so it's not indestructible so it
will never give you those kind of side
effects very much in the best practice
staying above of early so it's just good
functional hygiene and I think this is
yet another good example of what
introduced me too early and some of the
test practices see cure you know at the
tables of I'm sorry job the w RQ Lana
logo we can access the request header
but we can also set a response header
and I even though I said that you can't
necessarily mutating the data structure
it will actually return about it that
you can then pass through as part of the
next chain of calls so it doesn't
doesn't necessarily mutate it but it
does give you back a new mutated data
structure that you can then pass through
so one of the other things as always
pointing out earlier about the state
just passing about through the state has
only lived through a request cycle and
this is actually pretty important
because fundamentally HTTP is a
stateless protocol so it should not be
along the global state process our line
or web machine rather gets you the
ability to do that but it doesn't
necessarily and you can't do that if you
want to have some kind of global state
long-running process if you want but web
machine would never give you the access
directly to be able to do that you have
to spin off another process or whatever
and then just be able to access it that
way the last thing or one of the things
that you need really to build an
application is to be able to do your url
dispatching you'll obviously need to be
able to access the resources that you
write and to be able to make sure that
requests are going to the right places
at the right time and it's another good
intro to early in my mind it's pattern
matching you so what we have is this URL
dispatching this which is a list of top
holes and it's a three-part topple where
the first is a list term and then the
atom of the resource that we want to
access the aquillon room and then some
arbitrary arguments that we may want to
pass through at the initiation of the
request so we look to finish you know
you look back at the boilerplate code
for the hello world you saw the
initialize function when we do that
initial s emotion we can actually pass
in values based on or dispatching to to
the to the request state at the
beginning so see here we've defined rule
here where we created resource a and so
if I just go to my browser inside ok
lako /a to that resource it will take me
to solely source than that some resource
module any other URL right now I'll get
a 404 which is pretty sane people with
URL dispatching we might want to look a
little bit more than just a /a but we
definitely want to be able to access it
and in order to do that with the w RQ
module comes in pretty handy here as
well we can actually access the request
data get the path information you can
see an example here or the request of
just /a coming in you just do a w RQ
path that returns a list of slashing
they're looking over there but if you
want to do something a little bit more
interesting we can build a two-term a
two-term list in this in this beginning
part of the temple and by using the atom
of an asterisk we can actually treat
that as a wild card so anything after /a
will match and you can see here that ABC
we can then access this through the
requested I using the WRP module and you
can see the different buttons or the
different parts about it so if this was
a BCD we'd get a BCD as well and it
becomes really convenient if you use
path tokens because it tokenize is the
different parts of people or l3c here
another nice feature about the URL
dispatching is that you can actually
bind a berry and ironically you can use
them out as much so in this case we do
another two part list and foo in this
case becomes more or less a variable and
so if I do a request to my resource here
and through ABC that won't work because
it terminates at you know a B it would
look a little bit more like this so in
this case I do a request a B and foo as
you can see here if I use path info will
actually allow me to access the value of
that that that happened so I basically
defined this variable as foo and I can
just access it through path info this is
really useful if you're doing something
like a username so if you're trying to
build a restful api or usually be able
to determine what path are they hitting
you can just use the w RQ path info
you've defined and adding the first part
of the top list
or the first list of the top and just
ability there and you're not necessarily
about um by this you can continue to
grow this list as much as you want to be
able to define the path in this first
part of the couple so you have your
resource you have your variable and then
you can have another wild card and you
can continue to see how this behaves as
you go through it here w RQ looking so
um the last thing is you couldn't get
anywhere without query strings of the w
RQ module allows you to access the query
strings as well it's pretty
straightforward but it's not necessarily
part of dispatching if you look at the
HTTPS back when you read through it it
was evident pretty quickly that query
string is mint for dispatching so you
can't necessarily access that I mean
there's enough flexibility in web
machine to be able to do that but if you
want but the simple simplest
implementation of the URL dispatching
list is pretty straightforward it is
just pure early you can change it but
you can generally want to not use your
query strings in a dispatch and so by
default it's actually not very easy to
do that in web machine so again getting
back to just making well behaved HTTP
applications this gives the nth row user
the ability to make an application that
maybe if this were a rookie mistake from
say I don't know a PHP dub like myself
back again not anymore
recovery oh and then you can just simply
build this URL dispatching take
advantage of it and not making mistakes
like dispatching by so query query
string so that pretty much covers
everything that you need to build an
application yeah the city cool you
possible as a resource yeah you care so
that's exactly in fact what you're doing
right here if you take a look at
pappadeaux then it's a little bit great
out at the rumen there you go if you
look at w RQ path info who basically um
you can see if I make this request at a
b c d e I I can access Dean by doing the
path info for foo because I know that
true this do the actual I'm gonna wear
on with it gives me to be the B value no
just the w RQ happened oh and passing in
the request data okay answer
so more or less with the URL pattern
matching you have everything that you
need to build an application except for
tooling and you know obviously it's
really nice to be able to do a little
bit more than just build an application
it's also nice to be able to duck debug
it very easily and a lot of these images
that I've been showing you as we've been
going through art just images that are
ones that I picked out for demonstration
actually if you use web machine what are
their really interesting features about
it is that it has a visual debugger and
as part of that visual debugger what you
can do is actually see and trace all of
your requests as on each request and see
the path the decision tree that is
actually took to get say two and two
hundred where everything is nice and
happy but if of course something grapes
we want to be able to see what's going
on so we can see a trace of how we got
to this decision and that's good but if
we say something bad happens and we
return to 500 if you actually look at
this map of the HTTP specification
you'll never find a 500 and the reason
being is that a 500 is not a desirable
result there's no end point or no way to
get to that end point it's not term it's
not a terminal in pointless map it's we
didn't know what to do so in order for
us to display that will we get a 500 an
exception happens in the groin basically
we can go and begin to inspect and see
exactly how we got there and when we
don't win build when we go and see at
the very end we've worked a little red
circle right this is where you got the
500 this is your this is where it all
breaks and what's really nice
in this visual debugger for those of you
who haven't seen it you can actually
take your mouse and hover over the image
as it's displayed in your browser and on
the right hand side it will actually for
each decision point in each place it
will show you what the state was of the
request data is what the state was and
if it there was any exceptions or errors
that were coming back so i won't
actually have for example this you know
I get to resource exists and I can hover
up that I can inspect the two different
state before and after and see what
happened but in this case I have the I'm
making this request to test you know d /
test with a Q equals low point side and
then if I just go ahead back and read
some logs I can see or read through the
state and the debugger I can see okay
well I call her lang list to integer and
I'm trying to cast more or less you know
a list I don't wanna stay from you know
a from list to it to an integer but I
feel nervous so in terms of exception
that's why we chose 500 so now I know
exactly what I need to do to be able to
fix this which is good and the question
is how do you actually fix this so
actually this just going back to
implementing the HTTP spec we don't want
to return a 500 we want to return a 400
because that's a mouthful of your quest
so I can just define the callback the
folks the resource function callback for
I'm not formed request I you know this
is probably not the cleanest way of
actually doing this but it fit on the
slide so I'm happy with it right so I
can go there and check and if this is
the case where I'm getting something
that I can't flip to it and to an end or
I want to be able to return the state
that you know it's a one will return a
true because basically is a it's a
mouthful of your quest if I return the
true
then we can actually take a look at it
and we can see that we're actually
following to the note to the right place
all around and so now again I have a
really well behaved HTTP server that's
following rules of HTTP now one other
point that I'm going out or point out is
that we can also return a body here to
be really really nice to the end user
and let them know exactly what happened
but we don't have to so you have that
flexibility with web machine and that's
you know ultimately the point of what
I'm trying to get across is that what
machine is just a really nice friendly
way to be able to write a friendly and
easily easy way to write well behaved
HTTP applications but it's also
important for you guys to know what need
H what web machine is not and as I
pointed out earlier it's not a
full-fledged framework it doesn't do or
animal r storage or templating or
anything like that it is definitely not
Django or rails and at the same time
it's a not necessarily a low-level
network server either so it doesn't just
let you go off and do whatever you want
to do by opening up huh you know hey I
sock it on port 80 and start doing 80 or
something like that it is absolutely
built for the web is made to in shaped
for hdb to follow the specification so
it's somewhere between a framework and
just a raw you know network
general-purpose network server so that's
exactly the point now let me get out and
it's also for those of you who are new
to Erlang web web developers maybe
you're coming from some other languages
it actually had this ported by the
community into various other ones
there's Python closure Ruby I think
there's some nodejs app out there as
well so if you're coming from any one of
those it's also a chance for you to go
and explore there before you just go and
jump right into early as well and you
know the last thing that I'll actually
mention about what machine is it's been
in a lot of production systems and for
those of you who use reactor anybody
here okay guessing is used to generate
this console it's definitely it's still
used my machine in web machine is the
HTTP front end of it and actually so if
you're accessing will react through hd8
you're using my machine right now so the
other thing that I thought was worth
pointing out is sooo good night
this is a shameless plug
so four years ago I started writing
early and I did it with my machine and I
wanted so much that I was like man I'm
going to join fasho but I didn't give up
on my little side projects so actually
you know this is actually up and running
service now it's completely on web
machine and react and I be used a lot
more of The Bachelor stuff as well so
that my friends I don't have built an
application using wet machinery on and
rioc poor and so definitely a lot of
really good open-source things coming
out fasho if you're not following us on
github you should and you know it was a
pleasure to talk to you guys if you have
any questions I'm happy to take web
sockets not supported yet although i
think we hear from cowboy right there so
i know that you started working on
porting web machine from moshi web to or
at least to be able to use web machine
resources right and do you guys have
support for web sockets as well
yeah okay actually that's a good
question because even in this app that's
actually something I would like to
implement and looking at cowboy cowboy
stuff as well but we just do a bunch of
oh boy yep I'm sorry the fishing of the
negotiation no it leaves a completely to
you I mean it generally make some
choices by default but you can see if we
took a look at my presentation Munem I
can pull this back though um the
question was does what this web machine
offer any help around content type
negotiation I get there faster though
no gets here this fall back Tortuga to
HTML it would actually give you back I
believe it would give you the give you
back the clock the correct cons inside
all right there's also a hater callback
for to JSON or you might have to define
it yourself I can't remember exactly off
the top of my head I know that in my
code I have a to json lesson it's I
believe sets the content sites
application Jason so you can do that as
well so but I think it does leave it to
you more or less but there might be some
buildings just for like making my thesis
Azure so I think it would be I kind of
feel good there so alright guys thank
you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>