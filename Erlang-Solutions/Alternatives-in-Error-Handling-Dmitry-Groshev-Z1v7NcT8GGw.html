<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Alternatives in Error Handling: Dmitry Groshev | Coder Coacher - Coaching Coders</title><meta content="Alternatives in Error Handling: Dmitry Groshev - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Alternatives in Error Handling: Dmitry Groshev</b></h2><h5 class="post__date">2012-06-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Z1v7NcT8GGw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm going to talk about air Helen and
this is at fault lines which estate
forward theme sauce that followed it it
as far as I know isn't cold enough in
text books and online minerals and so on
ok we all know how good buzz words like
you know happy path accordingly the
crash and so on and in this sense error
hanging in there lung is them in simple
but in some sense arahan dinner lung is
painfully and how you I think you'll saw
things like this and it's it's messy I
think okay pretty common solution for
this for such problems is separating of
such cases in different functions but in
fact it's not a real solution because
you just hide in these cases in
different functions and you need to make
function names and so on and it's like
you know thinking that scary monster
will disappear if you don't see them
yeah okay some people think okay we have
a problem we will use validators some
some sort of laces it smells him Jason's
him all the libraries sheriff that I
will talk about right this is an URL and
this is a library from the awesome team
that made the cowboy all links that will
be shown in this presentation will be
shown again in the last slide so you can
just write them later it does something
like these it use type specifications to
check if some objector
correct in with respect to their
specifications liked it like here but
it's definitely nice I think and
definitely useful useful but what about
these sometimes we just can't use my
trailer like like here like you because
we need to show our user some some sort
of error that is more meaningful that
you have by document so validators don't
don't solve our problem in this sense
and there are another problem in fact
what's an IP most of the time it's just
phone numbers from 0 to 24 / 10 255 and
some dots but what if we have IP version
6 with all that shortcuts and mixed
notations okay we theoretically we can
came up with some sort of parser or
express complicated but anyway that will
validate our IP but some times we need
to we need constraint that just not that
just can be expressed as some some sort
of you know rigas for example like here
and in general all specification
languages then tends to be tends to move
to programming languages because in
general the expressiveness of
specification language to handle all
cases should be the same as expressions
of full-fledged programming language and
so it's not a real solution again we
just just make this problem hidden
okay so what is the real problem here
first of all we we can say it shortly
and say that okay we just don't have
something like pythons return and so on
so we can do increase the branch into it
sorry we can do impulsive ranging in
some point of our function we just need
to make it wit cases so all brain is
explicit well it's not exactly true
because we have exceptions but
exceptions we use them a lot of times
when we all love such constructions when
we called for a paper hipath so call
when we just write things like here and
we get our exception and all everything
is ok we don't write cases xsplit sleep
but II and and we have nice exceptions
we can all when we need to show them to
user in a moment away we can use try and
change and so on and theoretically we
can solve a problem like i like this but
what if we have more than one statement
and we need to show our user where is
the problem exactly that a is wrong or
be wrong we just can't decide using
giant cage plane to engage where the
problem is okay there is another attempt
to solve this problem in small nuts and
who for for those who just don't know
what it's all about I will make a brief
very brief intro what we think when we
see this comma here okay we can think
that it's just a syntactic construction
but in some
this coma is more than just syntax is
instruction to some entity that execute
our code that okay we we've done here
let's proceed to the next statement and
this is unconditional John obviously we
just proceed but in fact we can make
this jump conditional so writing stuff
like this it's messy but just for just
for a moment let's think about this
style because here if we have some
convention on what we expect from
functions make full or make bar that
they will return for example something
like okay something or error something
then we can write added such function
comma in the way that will check this
value from Mike foo and decide if we
need to continue evaluation of our
expressions or just return some error
and in this that sense such approach
solves our problems because now we can
we have a degree of control that we need
because we can stop the execution in any
point and we can handle quite difficult
logic when we are chicken that values
and in fact monit is nothing more than
such common function explain a dull type
that commerce coma function expects that
okay something or something and the
function return that is not shown here
but it's just something like take the
value and the term okay value for in
this now
guys from RabbitMQ made this work in
rank made some persons from magic and it
looks like this s in fact this code is
expanded to a code like this but of
course it looks it was quite normal and
the same do the test the same thing okay
let's pretend that we need to write
something to file its example from a
Londos tutorial and I think it's pretty
mmm pretty good well these code makes
sense i think because we really need to
check on every step something and do
some things based on our results
previous results and it's messy of
course okay of course as I said earlier
you can theoretically take some cases
from here and pass them to another
functions but it's not going to work in
general and with a lot of it looks like
this I think it's way more pretty and if
you think for a moment it's quite
idiomatic not damaging please clear yeah
here error m here it's just a amount
itself it's about conventions so that
this functions might be an array of file
open will the term okay something or
some mcdoubles just the way to tell
along that such writers will be used and
as far as I know guys from RabbitMQ use
stuff like this in writing
okay of course there are some problems
with this approach first of all we have
definitely have some performance
overhead because here we have uh names
phone shins on each step and what is
worse that depending on a number of
closes in such such expression like here
it will be slow and slow and slow
because you will need to make more it's
definitely not good it's a bit magical
and the not so obvious problem is that
for example list is another monett and
you can just models don't play nice with
each other you need to write parse
transforms and so on and if you write
this such stuff in haskell where it's
pretty dramatic you have a lot of
libraries like doing like control mount
and so on and nothing of this in our
okay you can write all libraries but you
even in this case you don't have such
sophisticated compiler so I don't think
that it's its way to go okay and the
final solution or not the final but good
enough i think for some cases he's a
library that was started at previous
long teacher conference at hackathon and
it is intended it it was intended to
solve exactly at this problem and i've
tried to avoid excessive extra
obstructions there also some things that
I think many of us wrote some something
like beaner to find integer because you
just need you know least sorry been at
least three stone integer kids it's
myself and at least we found that is
beef vif and way faster than prop lists
yet but it's it has some convenient
interface because it just don't stop us
and you need to match their top line is
drawn on the value that you need and not
the key okay now first idea that I had
it is that we in some cases you just
need to tag some value with some air
label let's say you have a request and
you have some Q variables and when you
pass some pure variable and transformant
validate related in some sense if in any
step of processing this particular value
the wall as there will be an error this
error will be associated not with the
operation it was that was failed but
there between the value itself so you
just rub such values with some items
that labels an error in this particular
value then you use some function that
aware of this convention with doubles
and so on with the dist XA should say
and then you just use them then you
unravel it functions and use the easy
return that is needed to let in fact
throw this value but this needed I did
there too sorry this needed to make this
construction return values in some
uniform way so you can write blog like
this 0kn0 and not like z
HZ error and just return value from this
try block if vicinity I don't think that
it's better but it turns out mmm it's a
this objection is quite impossible
because you can just stack these
functions and use such short cuts if you
need some common sequences of checks and
connotations but it turns out that this
construction is not so useful as as this
very simple markers in fact here this is
just a tag too so we can use it in cage
to catch only our errors from z library
and not error that was generated body
our errors I will show an example infa
moon here's an example it's a part of
handler in our API server so we have
some specifications on place variables
that is variables in uri and the body
variables that is variables in q
distinct or cubic values we use these
specifications to H values from this
prop lists because you're pisco boy &amp;amp; Co
boiler chances protists all this all
that stuff so we can just for example
use we can just try to find our method
in their list of methods and if we
didn't find this method at least we find
will return another no not at Apple but
falls and
we'll get an exception but education
will catch this exception and I throw it
with a label sorry but methods and then
we can catch this bed matted label and
dispatch an error value based on this
label like here you can see that this
function form error that will take this
error think it was just an atom or
something I all set you will provide the
music as a second argument education so
it can be quite a simple and nice
function table like one function where
you have just in heads on my chicken
some simple value returned inside it's
fast and it's nice a lot nicer I think
that a bunch of cases marwa this
abstraction plays quite good with the
lists and lists pretensions because if
any are variable R will be missed and
that list of variables it will generate
an exception and we will again catch
exception and I throw it with label bed
road and again we can say our use of it
right you have some problems with your
URI morrow we can push these micros
inside of this comprehension to make
more verbose errors or like him we
validate the presence and the type of
some variable in kure variables where
it's quite quite useful to have a name
of variable that is missing or wrong
type so we just push this micros inside
of list comprehension and we in this
case we can throw this level with some
particular
variable name like here and use it to
show an error like here so then we just
need to need a function that takes such
label and the chance particular HTTP
error code and error message so we can
show it to user and then we they only
think that is missed here is some sort
of function let's use your yoga
framework of choice like oh boy and you
just take it's this message and this
code and like a turn for an HTTP
response and return it to user okay of
course there are a pair of problems in
this approach but i think it's not so
critical that as in L&amp;amp;O just full of
course it looks quite non idiomatic
after all we have all this while
Microsoft and it turns out that the
Elijah is also a little bit of problem
here because the Eliza is really bad at
inferring types where exceptions are
involved here in functions in function
good the letter will find an an error
without any problem and will say us that
okay guy you can't just just make a plus
on integer instinct but in the second
function in function that you just take
this view value throat and catch and
when you catch up in the when you do
this you loss you have lost the type of
B and the others are assigns type any to
see and so
because we have optimistic type in this
expression APC will not my deal as a
complain okay then i made some some sort
of four I said okay that along can have
problems with performance so I need to
test it and we will test in three test
sets it's a model of requests when we
have some prop list with some fields and
this is an example of for good request
that is correct then we have two
examples of by the crests the one when
we have some error in the beginning of
requests so our handle handler will
likely fail in the early stages of
purchasing this request and the second
one when we have an error on the later
parts of requests this allows us to see
if there is a big overhead depending on
the count of such such expressions here
this a baseline handler that just false
if there is any air it doesn't control
Sierra it just just false and I think
it's pretty obvious what's going on here
and then other two versions of the same
handler using you will date and rondo
it's pretty obvious then you have like
ten or hundred thousands of tests in
little in a loop and then you can
compare
performance and here you can see that in
fact the lander is quite slow when you
have yet your test case failing earlier
it it's it has almost no overhead but
when you have more expressions involved
because you just creates all that onions
functions and so on you have a little
not little in fact because there are no
numbers here but it's it's zero so it's
this plot starts from zero it's not not
something of cheating so it's more than
two times slower than just I almost
three times slower than plain version
and more than two times slower than
these they will they think well that's
all this is the links and in this
rapport there are performance tests that
I mentioned so we can rent yourself and
check if I light somewhere
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>