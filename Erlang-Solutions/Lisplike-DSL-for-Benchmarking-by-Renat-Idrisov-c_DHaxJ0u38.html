<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lisp-like DSL for Benchmarking by Renat Idrisov | Coder Coacher - Coaching Coders</title><meta content="Lisp-like DSL for Benchmarking by Renat Idrisov - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lisp-like DSL for Benchmarking by Renat Idrisov</b></h2><h5 class="post__date">2016-10-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c_DHaxJ0u38" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you I'm not I work for mg and I
will be talking about our open source
product which is in the bench and the
language is like language we have inside
of it so the presentation plant would be
like this I would explain our workflow
basically what our system does then why
do we need d cell and then how did we do
that so some milestones and basically
it's about our product is about some
different erwin complications and the
front end and usually there's a
designated api server which is deployed
somewhere in your network and you
interact with this server with CLI or
using web browsers has dashboard as well
and also we assume that a target system
which I go into which mark is deployed
somewhere separately so it exists you
deploy it using some other tools to
start a benchmark you send the request
or push button inside a dartboard and
then API server start its work usually
it requests some notes from cloud
provider is easy to usually and then
start to provision these nodes it's by
copying its code which we call em gee
bench node and also a protocol specific
code which is used to generate some load
on target system under test for example
if it's HTTP server then it's going to
be some HTTP worker which requests get
put and so on other HTTP packets after
the provision is done there's an
interaction between benchmark cluster
and the target system
which produces some results results
emerged through director node the
designated note which performs all the
coordination and Sentinel results to be
displayed at the API server and client
usually sees some charts some log
information and so on during this
interaction and after everything is done
several decades yellow kid saw the note
requested from a cloud provider and
freedom for any further usage and if it
was requested some email is sent with
reports and the part which is described
by dsl its interaction with which was on
previous slide like this and after all
information is available like in
database you could request it which some
logs compare some results when your
target system even offline when your
cloud controller and basically not
supposed to work that way this time I
mean so everything is browsable it was
quickly about how it works so here's the
main question why do we needed a cell
because a lot of system work without we
think that it is interesting to have
four levels of expertise I mean if you
have some tests for HTTP server usually
these tests about creating some sort of
load with a certain amount of requests
with some certain packet sizes and so on
and so on and if you have such a test
are usually a non-qualified developer
could change some rates
message sizes and for example increase
testing cluster size without knowing
anything they are usually like
parameters to the command which you are
running and it is simple to increase
time you type something like minus minus
time equals 120 and then you increase
time but if you need to do something
more if you need to send some kind of
different packets if you know for
example that some problem could a cure
if your length is divided by a hundred
for example it's it it could be harder
to get adjusting only these parameters
and you may need some certain of some
kind of warm up procedure for your
servers and so on so change in scenario
in the case when you describe the Austin
area in the same language as your system
requires know which of this language in
our case for example it requires to know
Erlang but it's not really hard to
master if if you compare with different
languages but if we came to game
developer and asked him could you please
run a benchmark on your code but here's
our language and you know you need to
know analog and he said like oh you know
I am a lower programmer and I don't
understand all this stuff so could you
please do it by yourself so we just want
to not not be in charge for running
binge scripts all the time because we
wrote the system we want to make this
work of someone else and also we added
ability to write new protocol not only
in Erlang to implement some particular
database
you could specify it in Python and so on
but in order to change some core
functionality unfortunately you need to
know airline because system is written
in Ireland so we think that our language
is limited but limited in a good way so
if you have only 10 different operations
that you could do it's easier to master
probably of course you could mention
brain fog it's not easy to master
because of some all set of operation but
it's not this case and you don't need to
specify all this information gathering
which we do during the benchmark you
don't need to specify that you need to
gather or CPU load information and so on
and that you need to summarize all
counters and so on all this is done
implicitly and also which is important a
person who works on the test scenario
could not affect some system parameters
could not affect system scalability
because if you give people ability to
write test scenarios in airlock they
quickly create a gain server and make a
call and once you start benchmarking
with a hundred nodes it just stuck and
you spend a lot of money but your
benchmarking is not doing anything so if
you limit this benchmark into small
language you could avoid these
situations and we actually perform all
static analysis like synchronization
primitive analysis in our language which
is of course possible in pure airline
but it's much harder so in our case we
have a small set of operations and we
just basically
create a graph and check for the loops
inside of it and it's pretty
straightforward to analyze language when
it's really small so it was our reasons
and how did we do that for the first
version we used file consult because
when a project takes a long time for the
first version it's bad I think it's bad
and it took about a month to create some
first prototype to use inside a company
and it's been two years that we're
running this project and the first
version was really simple as you see
it's a lisp like language it's not
really at least it's a long terms and
this this thing is called embedded dsl
and it means that the language is
described it in inside the syntax of
your host language of course it is
possible in other languages in
JavaScript and whatever but what's good
about along that we have atoms here and
some operations look like nicer here's
what it does the first statement is
assert it tells that HTTP ok requests
per second should be greater than half
always the end the second is about
installation of some particular soft
required for benchmarking and then goes
the script which described how much
workers should it be and then work your
type and then something like a loop
which lasts for 120 seconds and increase
of loop rate linearly from one in PS 2
230 pace
so from our point of view this kind of
language is easy to read if you a little
bit familiar with Lisp and you don't
afraid that you have different to
different types of brackets here if you
could master them the hard part is the
engine when you have a lot of but once
you use some sort of editor is it became
easy so it was our first version then we
realized that we need more detailed
error messages once you have a problem
in your script you need to tell a user
where is the problem and you could tell
like oh look inside your loop but it's
better than it's better to mention where
is the loop so in order to get line
numbers we used some other functions
which are shipped with airline and it is
good you could parse into intermediate
language which is here and as far as I
know it it is not described anywhere but
if you look at this language
intermediate language airline has four
terms for parcels it's kind of easy to
master and since the first where version
it was a long 15 nothing has changed
there luckily for us because they as
they don't describe this language they
could break compatibility any time I i
realize that but it doesn't get broken
and then you transform these terms to
get line numbers in explicit way so you
could use them is in a roll messages for
example you could watch our code is open
source or you could ask me I could point
you where it is and then we realize that
heaven an erlang on all nodes is too
much I mean that we use see light to
start some tests and it should be run
from any system not not not only our
laptops but from a computer of random
test person and we decided to write
whiteWave CLI in Python and it turns out
that it wasn't hard to implement all
grammar that ere long terms have in
Python we did this about in about a day
and we also have insert this project it
uses parsimonious Python parsing library
and it basically parses all air
launchers so they are available from
Python and we do some small part of
analysis from there and the last step
the last step front was adding
additional front end so people were
saying like Oh year scenarios are in
Erlang we said no no no it's not a long
it's more like least no no it's airlink
we see that it's weird something and we
decided to implement additional front
end which looks like more looks like
Python and it is translated to to the
language as as you see before is our
kind of Lisp and then got executed and
it turns out that it wasn't really hard
as well and what I like in this process
we don't destroy and rewrite everything
from the beginning we on the on each
step we use what we had before and in
this case we got this kind of language
we use parcel library parts to the rank
library I'm not sure about the
I'm sorry I forgot but right now is it i
dint based language and it's much easier
for game engineer to understand what's
going on we have the same construct same
same things as I showed previously his
asserts we have measurement units here
like 30 seconds like it was before and
some things like loops and pools so it's
still description language we still have
features that we had before but it is
easier to read and the reason why it's
not Python as i mentioned to prevent
user from making random things and
analyze them after so to be conclude to
compute that our dsl is limited in a
good way easy to analyze because it is
limited in expressive and also
infrastructure independent so you could
start the same script on your localhost
or on a big cluster because there is no
problem in scaling it out sometimes of
course and sometimes it could be a
problem of course he if you want to
create something which doesn't scale and
you think hard you could but usually you
are limited and you could not and our
tool is cloud where I mean it's itself
requests the cloud for nodes allocate
them extendable I mean it's easy to add
some cloud or protocol scalable we even
remove a lung message interaction
between nodes to make it scalable
between different data center because
hypercube the apology doesn't scale well
so we implemented our own protocol and
each nodes each of
the nose is on a separate environment
and environment so we have metric system
and Python and leave like dsl's for
scenarios and leaves like come first and
erin gloria for extension law for lower
we use a robot building below and for
python we use a separate separate Python
interpreter so if you have any questions
I mean it ok hang on yeah there we are
and I'm afraid we'll be running a little
bit late but might have time for one
question and one well in that case thank
you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>