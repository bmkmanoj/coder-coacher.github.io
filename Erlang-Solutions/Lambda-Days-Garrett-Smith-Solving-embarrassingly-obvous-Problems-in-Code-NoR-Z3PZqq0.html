<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lambda Days - Garrett Smith - Solving embarrassingly obvous Problems in Code | Coder Coacher - Coaching Coders</title><meta content="Lambda Days - Garrett Smith - Solving embarrassingly obvous Problems in Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lambda Days - Garrett Smith - Solving embarrassingly obvous Problems in Code</b></h2><h5 class="post__date">2014-04-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NoR-Z3PZqq0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so this is this filler anyway so how
many people have a written summerlin
code I mean written no early and you're
here just to find out what this thing is
okay so half okay so I'm changing the
topic of the point was to cover Erlang
sort of as an impromptu filler for for
the slot here so all right so the
pressures off I don't have to like hip
hit any balls out of the park or
anything like that right you guys are
going to be easy on me with my 15
minutes so what I want to do is is this
is actually two parts here this will
introduce some Erlang syntax but it will
also get into a functional refactoring
pattern that I've started to adopt in
the last couple years which I think
everybody here should religiously follow
it's like really important so please pay
pay pay close attention because your
lives will be transformed by this talk
in these 15 minutes ok so this started
out with this is a talk I gave a NOS con
last year and there's a parable we don't
care about parable so it's going to jump
into some um some code the basic gist
here is when you when you are writing
code there's there's sort of two phases
there's just get the thing to work right
solving problems is hard enough like
identifying problems as harden solving
problems was hard enough don't worry
about beauty don't worry about
correctness don't worry about like sort
of you know making sure everything is
pristine just get it to work once you
get it to work you can understand it and
then you can ask this question what how
is it working how did I get this thing
to work and then you can focus on
clarity in this case if something isn't
obvious make it up make it obvious so
this is a very simple methodology you
get something to work you say ok it's
working then why is it working and you
sit there going what is what is going on
here and then you rewrite that code to
make it completely obvious all right
done no we'll do an example so here's an
example everyone can see that yeah so
how do I do this ok there's highlights
here all right here this is earl m and
this is this is a good example of why
people don't like early
I mean you can kind of turn you can kind
of look at this and then it's like those
stereograms or you just let your eyes go
real relax then you starting to see
three-dimensional images and then that
then the code starts to okay so this
works and this was this is actual code
written a cloudy that was running in
production for a while and so it's like
whatever it works but no no we don't do
that today it works and now we look at
it and say what's going on here what is
this crazy block of code doing as it
turns out it's actually fairly simple
I'm gonna break it down here there's
really there's really three things so
that's the gist of this is right here
right so what we're doing is we're
creating an array sorry this is this is
the skipped ahead one so we're so let me
describe what this does those
documentation for this I would say this
is handling a list sorry let me back up
a bit it's important to understand what
your code does it's also important
understand the context of especially
when you're looking at it for the first
time so this is an actual amqp message
handler good old amqp surfaces here and
what's going on is a request is being
made from outside a server so bunch of
servers are running we want to know what
applications are running on that server
that's simple it's just what's going on
so we send a message to the server
saying what mess what apps are running
the list the apps for me that's the
handler for that for this message so
it's supposed to just do grab some apps
and return a response and that's what
this code is doing so let's break this
down and show you the driver here on
pointing that there we go the driver is
this this is really the most interesting
part of this implementation and it's
buried in the stereogram right you
really would have no idea unless you
just look there for a long time so we do
that we look okay what's actually what's
the drug that's what the function does
it returns information related to some
apps so stacks java app server some
module don't worry about is Earl and
colon this is the delimiter their list
is the function so it lists and then
it's going to do something with that
what's it doing what's taking the result
and it's putting it into some matters
you can see you got already see this
I like adders what is it etters doesn't
mean anything it's kind of strange and
then its form its come on now very good
and then it's returning the response
those are really the three components to
all that code so once it's once it's
working and I SAT there looking in this
place is covered so complex what's going
on here those are the three things so
step three of the processes once you
understand what's going on make it
obvious so this is what I wanted to say
handle apps list so let's read it as a
story it's dramatic first line what does
it do well it's it's listing the apps
it's simple so one from like really
really terrible like complex ridiculous
urlencode to that first line I mean that
first line reads really nicely doesn't
it apps equals some module related apps
list yeah and it's not hard it's simple
erling isn't bad if you just take a
moment to say what it is that you mean
okay so that's sort of the big part of
the story then we're going to return
some sort of response right here I love
to worry about the details and so this
isn't this is represented by this
function so taking the two primary story
items here and put them on separate law
now I might want to rename this to a
different something that reads a little
bit better whatever it's still readable
it's a lot more obvious as to what's
going on here than the pre than this in
this monstrosity all right so let's dive
into this okay the the nature of the
response here is is taking some so this
is a list comprehension and arrow thing
you wouldn't know it because buried in
here but this is a list comprehensions
being driven by the list and we're
taking some attributes and we're
creating an array and this is this is
this is what's feeding the response now
this is confused and weird and after
after looking at it she's like this is
incoherent this is really what I'm
talking about here I want to create I
want to wrap up the message response
this is some implementation detail you
don't don't worry about I'm taking some
result and I'm conveying it as a
response
but what's what's important is I have a
translation layer from the apps list
response to this message response and
this is this is what was completely lost
over here he doesn't show up anywhere
here by creating a function called apps
list response that's the response the
message I'm defining it as a message
response here but with some further
level of translation so I'm starting to
spell out in greater detail what it is
that's actually going on here now look
at this and it's two lines of code and
there's some brackets and there's some
commas and there's some letters it's not
that hard and this is early this is the
worst language and this is the most
hideous in tax that you ever seen in the
world it's terrible much worse than
JavaScript or Java Ruby or pearl or
assemblers the worst but this is
actually not that bad I don't think I'm
right it's not bad you guys agree that
it's pretty ice okay just made a
function okay so now what's this app's
addressing well that's so that's what
the work that's going on here right
we're sort of taking some app list of
apps and we're translating it into some
apps at or array all right you might
debate and say I don't like that name
apps adder array it's kind of weird and
it's got the underscores and whatever
but I mean at some point it's hard to
name things I think that's fairly clear
it's apps at or array it is it's an
accent right but what does this mean
even if this is very confusing we can
still take this its weak antique we're
taking this sort of crazy logic here and
I'm going to turn this into a function
so here's apps adder Iraq right and we
can answer even though even that you may
not agree with this name but let's just
say the name isn't clear I don't know
what that does and sometimes I run into
that this is a single line
implementation so it's very easy to
answer the question what does this thing
do you don't read the documentation you
can just read the single line I'm going
to read this for the first time in a
while stack service make array all right
that's that's consistent there with some
list of apps adder that's a function of
X well I haven't seen this in months
that makes sense to me I'm praying some
sort of
array here I don't know what that is but
it's been as a function of apps well
let's take a look at the next thing we
have apps here oh there's been this
comprehension but it doesn't look scary
monstrous like it did before it's so
it's super easy right I'm enumerated and
we're running through apps for every app
create an entry called a padders
starting to get really clear here isn't
to me anyway so apps adders this it's a
nice three line function it's breaking
apart some don't ask me why it's called
service please select the season it
should be called out but okay that name
ID reserved and now it's creating and oh
wow that's what i mean by appt adder
okay so even though it might be a little
confusing this code is easy to parse and
read alright so i think alright so this
is the non-obvious version this is the
stereo gunam and it's fun to imagine
what it does this is the refactored code
and what i like about this method is
that at every point in this whole list
you can look at any slice and reason
about it within about 10 seconds so i
think at ten five to ten second rule is
a good rule for understanding code now
it took me a lot longer than 10 minutes
to understand this but then suteki I
probably took about 10 minutes thats a
really seriously probably about 10
minutes 5 to 10 minutes maybe let's say
four minutes that's a long time so this
stuff after I've gotten to work to
refactor that just to bang it into shape
like what is going on here let's make it
really obvious at any level here I can
say what is this thing to okay it
creates an apps list then okay that's
the response okay fine I know what it
does it's creating a list spreading
response returning it I don't have to
know what all the details are there but
if I am interested in that I can just go
to this level oh what's the response
it's a function of message response okay
what am I doing here I'm translating
this apps into something called a nap
scattered right not really sure what
that is but I kind of get that oh what
is this then I'll just read this thing
oh ok it's creating an array apps a tour
Otis of this comprehension Oh boom and
you can literally wait you can write
your entire program using this method
now what's really cool about this other
than the fact its understanding
understandable and things like why is
this called service when the function is
called perhaps adder that should that
stuff's if you look at this with that
question have ever come up you feel like
I'm just glad this thing works we're
just glad that the test pass but you
wouldn't be reasoning about anything you
just be happy that you can move on to
something else but here you're like wow
this is really convoluted this also
incidentally the payload that was being
generated up here has nothing to do with
the story line of this function it's and
some stupid attributes thing I don't
even know what this means but I really
want is an apps this is a function of
listing my apps why do I have adders in
here but if you go over here it's very
very clear that this response is a
function of the message the apps in the
state this is a state is a an idiom with
in Erlang programs because there's no
global access to state you gets past
your state and callbacks so this is
long-running state that a process
manages but the facility above the
process manages that in this loopy thing
you get if you study darling over to
figure out that just consider this to be
long learning state associated with the
process and you get it conveniently in
these callback functions so don't worry
about state that just gets passed along
for context but you know this is very
very straightforward now what's so
here's what I found to be
true benefit of this apart from actually
being able to read your code where is a
bug gonna hide here where's a bug in a
height here hugs are going to hide in
that thing bugs are gonna hide and grow
and fester and read because there's so
much space it's like having food all
over your house this is where this is
going to be bugs here but we're is there
going to be a bug in here if there's a
bug and there very well may be a bug
it's going to be hiding in a line and
code someplace it's going to be in and
you're going to have a nice logical
wrapper for this with a single one two
three lines implementation and you say
oh this is why this is a bug you can
reason about is this a poorly conceived
function is it simply input error but it
doesn't have a place to hide and
maintenance of this code becomes really
really beautiful you can approach code
that you wrote months and years ago and
having no idea what it does not really
the documentation go to this and say oh
it's obvious and indeed that's been the
case i have found this that is the real
benefit because working code is working
code until it stops working and then you
go back and then you're just like I hate
my job so and this is early the worst
language in the world for syntax right I
don't know I think that's pretty nice I
think it's nice looking good
one should be very very careful trying
to make second from the top one just
really second variant is obviously looks
much breathing and much easy threes and
much easier to reason about but for any
along developers it's over that such
parents they are not equal and they can
be from different result of different
inputs no that's not true you can
mechanically refactor that and you can
prove it yeah you confirm you can prove
that the first coach exactly the one
about insects these these fold yeah the
second one will works different there
from the set from the dust of the barium
if you show there the ball yes yeah it's
known how to live this but peregrine the
white notice when you use a list
comprehension and you try too much self
service record this list comprehension
will work as filter and it will just
keep any output from thanks char
observer so the first variant will keep
such parents and present little bit more
mail that's a good point yeah that's a
good point you will fail so there's some
subtle there's a subtle behavior in the
waitlist comprehend his work which is
one of the reasons I live list
comprehensions can be a give me
something you might want to avoid in
this case that wouldn't I don't care
about that in this kit in this
particular case but that is that ok so
that the point is that in theory by
refactoring you might change the
behavior true by changing anything you
might change so you do have to be aware
of doing this but I'm much happier
reasoning about what you just talked
about here so i could easily take in
this code and put it up here right or i
could put a like i could make this more
explicit i can use a different idiom
here I could use a neck you'll
rather than list comprehension to make
that translation I could use what would
it be a map lists map this map function
would be another were doing yes you have
to know the language that you're working
with you have to know what's coming out
of it but the result of this is far more
discernible and reasonable facilitates
reasoning and and and that type of
discussion then this thing I mean here
well how do you even have like here you
can you just mention the function name I
mean just sitting here we can talk about
this far more reasonably then this thing
is like oh yeah you saw that little bit
of code in the middle here incidentally
if you take a ran if you if you throw a
dart at the wall of Earl encode and
github you'll see this code all over the
place you rarely see this code and
that's too bad we should work to try to
change that in early in community and
other functional languages really lend
themselves well to this it's difficult
to do this and see where you have a lot
of facility around managing memory and
pointers and it you can you can get
close to this but it really shines in
functional languages it's a it's a
mechanical refactoring that is driven by
your understanding of what the code does
and then you make the code obvious
according to your understanding of it
and this has been using this technique
for a couple of years and it's it is
really fun to do it's a nice mental
process and the war down the road is the
maintainability of the code is is an
order of magnitude more more is an order
of magnitude improved in terms of time
efficiency and quality you can just use
regular to do this maybe yeah good may
love you you know well the problem with
that is i changed naming your spelling
this in a very sort of human oriented
way i would further refactor this i
would have changed this today so i did
this awhile ago what would i do
different in here this one here this
function up here how to wrap that in
something else this to me is like two
jargony i would have said list i would
have said enlist apps and i'm going to
put that list apps right here well let
me show you this
just well okay just okay let's let's
let's oh this is good let me just do
this well how do you tell it what your
what your emotional preferences are how
do you like communicate how do you talk
to it how do you say you know here's
what you have a bike yes this okay so so
let's let's go through let's go through
this exercise and this is an example of
where like an automated tool isn't going
to help you here I don't think so here
are three variants of the same thing so
this is something right I could have
spelled it this way i'm going to this
isn't that bad so i'm gonna reply apps
list response okay I'm with you
functional message list apps function of
state and state I'm kind of with them
there I kind of follow that that's not
that bad I don't like these trailing
things and starts to look funny to me
but that's okay you know this is a lot
worse code in the world and this so if
people don't like this sort of nested
the probably the nesting in my mind is
your brain has to kind of keep track of
okay okay okay and at a certain point
your brain is going to give up and the
really smart people are gonna like be
able to go like 15 levels or 12 levels I
give up around four I don't have a mind
I literally I cannot remember a phone
number of like seven digits I can't
something's gone wrong with my brain
it's not like you use Google and like a
stateless machine I just like inputs and
outputs so this is ok because it's less
than four but let's say it isn't there
you just like one thing fine how about
just pull apps out so I don't have to
have this this is one step yeah you know
whatever this could be a long function
name so this this becomes a little bit
better but this is what I ended up with
and this is probably what I would have
written today list apps apps list
response and it just sort of spells it
out a little bit slower pace just kind
of keep it straightforward you get the
advantage of naming these further with a
variable so that helps sort of document
in a way list apps apps okay good i get
that i'm listing the apps and I makes
total sense this response reply
dichotomy is a little weird maybe I call
that a reply but whatever that's really
getting neurotic
this is what if you do that then you're
debugging is non-intrusive functions it
functions and Anastasia more money after
we worked in it I am rewriting it it's
opened a branch what we then that's a
point so have a little function calls
and the other reason you should do this
is because it indicates only human
factors in OT if you're producing clean
I said to keep is encouraged you have
onboarding you have training you have
mentoring whole numbers or processes
require quality people shop and it's
below yeah I know that it also
starts on wrong with the team and it's
really so just a quick point on that the
probably have with aesthetic is that
there are people in the world for whom
this is aesthetically better I mean
obviously is indicated by the majority
of airline Cohen in the world then
there's something aesthetically pleasing
about writing code that's an
unintelligible there's like a like a
panache like yeah yeah oh yeah that's my
code you're proud of that so so but
here's my so here's my standing this is
my point I like the term obvious nastena
sort of hybrid of it's subjective like
oh yeah it's totally obvious for most
people that's not going to be obvious
aesthetics has little to do with that
our cleanliness I just like is it
obvious and that is I think a more it's
not completely objective so there's room
for debate and that might be the debate
that we have with these variable names
but is my personal preference so the
difference in the first one is optimized
for writing boys optimized Americans and
what developments only 57 cost to make
this a box of the cost and the reason
for the toilet tank aesthetic is you
should be able to judge the quality of a
team fine-looking happy this one here
opens its free ice cream is you want to
make a statement about the tape at 10
feet without see any of the code I
receive the variables actually shape the
airline yeah that's exactly right
you can you can tell literally by the
shape of the airline what's going on
here flat nice nest on non nested code
it's like I don't care if this works or
not I'm just I'm happy but this crazy
stuff and look at the code base you can
see you can't see how that's a very very
interesting website you feel like a
stereogram website to judge to judge
developers like yeah that's fine code is
as a pictorial representation of the
code itself it's taken that yeah
okay well thanks for indulging me in
this quick question are you telling me
that there is a very sort of becomes a
problem you do not have to solve or 11
so bright
there's a lot of the problem is there's
so many ways to respond to that I have
to figure the right not stumped me at
all so here's the here's here's my
argument I write a lot less tests but
use this method and i would say that
until your code looks like this you
aren't done you're not done at all
because the only way that you can prove
that this code works is by testing the
living daylights out of it you can't sit
it and say this is correct I want my
code to be sort of obviously correct at
any point at any level until it is I'm
not done if I can't and this this sort
of weave over the last I don't know 10
15 years have fallen over two tests as
being like the way to write code is
test-driven development you know let's
write tests first what do you even begin
to know what to test like like I have
such a hard time solving problems like
getting to work is like it's just
getting it to work at all the
celebration but then I'm not done it's
like what am I really really doing here
and in that process of sort of thinking
systematically about it and breaking it
down being able to take something like
this and say what's the story here what
am I really doing I think to a large
extent eliminates the need for a lot of
testing I just I find it goes away so I
wouldn't say that you're done I wouldn't
say that it is is sort of a pointless
exercise it is to to give you a chance
of writing correct code and it certainly
it certainly is a payoff in terms of
maintenance so if you have any concern
about maintenance and I think a lot of
people don't care about that but maybe i
would say forget that let's forget
maintenance let's assume that works
forever right you still don't really
know that it works until it's it's just
screaming in your face this is this is
clear and correct the upside is that you
you do have you you can enjoy like very
pleasant enjoyable maintenance after
that but I don't know how to persuade
you but you don't seem persuaded at all
this first might not be the best way to
go I mean maybe oh I Super Saiyan I
misunderstood your point so yes fair
enough so why don't just write the
correct perfect code to begin with
that's fair i would i would say that
I've in my experience I would never ever
write this now just because I've gotten
better at thinking like this I'll start
with I'll start with this I just
developed that as a skill as I started
to use this method so I tend to write
that way first right away but if you if
somebody is inclined sometimes I'll just
like I don't like to use case
expressions I like the refactor those
islands it but a lot of times it just
makes sense like I just need power
through this thing and get this behavior
working with my you know just just power
through so it's not to say that you have
to write terrible code it's to say don't
put pressure on yourself to get
everything correct you should see the
behavior working first then you have a
chance at understanding what's going on
and then you can make that obvious by
the wii factory exercise if you can get
to look for the good code just in one
step that's awesome that's highly
recommended any other questions right
yeah it's similar to Gordon's comment
about debugging and break points others
would argue it's also easier to test I
mean you can you can you can test eat
fat you can test each of these sort of
an isolation but I don't like to hear
that I just like to say oh yeah it's
completely crutch piglets like a look at
it but that's I'm just going to be
control of that I have line I always
turn line line the information off of it
because you know I can do this who needs
a line the flex
don't make you wish you were dead yes it
would there not in that previous
function okay thanks I think what is it
time to drink
thank you was what</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>