<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Where are We on the Map? - Kenneth Lundin | Coder Coacher - Coaching Coders</title><meta content="Where are We on the Map? - Kenneth Lundin - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Where are We on the Map? - Kenneth Lundin</b></h2><h5 class="post__date">2013-06-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/sV3_BtBthrY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yes Kenneth yes thank you let
this has the same problem as Patrick it
worked when i SAT there it works here
okay i will talk about a new data type
in our line called map or map and why
should we introduce that done it's
because other languages have it seems
called the indian tin those languages
and it can be in a line as well and it
could even be better perhaps because you
can use the pattern matching mechanism
as well it could be an easy to use
alternative to record dicks gb trees ets
tables and prop lists it can complement
complement records and make records
unnecessary in the future i think at
least in in many places this two ways to
approach this with maps you can have the
left side here with you can have it as a
replacement or alternative to dick jib
trees prop lists and in that case you
have probably a map with many keys but
you don't have many instances with
exactly the same set of keys the other
approach is that you have maps instead
of records and you might have seen a
proposal from Richard Keith called
frames and maps can indeed be seen as a
subset frames can be seen as a subset of
what maps can do in that case
you might if you use them as the use
records you will have probably many
instances with the same set of keys and
maybe the key so just atoms in the other
case you can have any thermos key we try
to combine combine this in the same
syntax and semantics so we have certain
goal which for this which is provided if
settles mappings down from keys key
values it should be easy to construct
access and update it should be a
first-class data type like tuples lists
atoms you can have God testing them the
a long vm knows about them you can do
pattern matching on them and it should
be a defined order of the key value
mappings so it should not matter in in
how you create the map if you create a
map with one key first and you're not a
place you create the same set of keys
put in another order they should come
out to be the same order of the keys and
if you print them that should look the
same
and you should have no compiled time
dependency should not need to use
include files declaring month and was as
I said the parsing and the printing
should go hand in hand so that you can
print it tosh what you have printed and
if it's creating a different order
should print the same so here's the
syntax first thing there is how to
create the map a new key with a value V
there and of course you can also create
the with several keys at once several
key value mappings at one time and you
can create an empty map you have some
examples down there and for example this
lost their you have a compound term as
as a key it's the this the topple a
comma B it's an expression that's
evaluated and that will be the key you
can update as you see that the syntax is
similar to what you have in record but
you don't need to dimension a record
name you can update the map em in the
first example here with a new or
existing key value mapping the second
example here with another operator konam
equals
we distinguish between adding possibly a
new key or updating the value of a
already existing key and I think this
updating an existing key goes together
with when you want to use it as a
replacement for record for example in
that case you would detect if you have
misspelled the name of the key and I
suppose also dialyzer might be able to
take advantage of such differences in
the operation when we come to we haven't
discussed how to express this type
specifications yep and we have some
examples here with updates last one is
done updating existing key with a new
value pattern matching should work of
course Matt this example shows done at
you first you assume in the first handed
colder that the third parameter is is
the map any map then you bind that to
the to the variable s and later on your
return this s and you update this this
state key with a value start so this
shows how you can use maps for handing
the state of a process where in many
cases today you use records
yeah maybe that's the corner case that
we haven't I have no good I mean this is
looks like an empty map but it means
here it's a map with any case it's bein
a girl here now can help me I have to
answer that later yes you have you have
God with a map size for example but
maybe that's inconvenient I come to the
gods later and in a second example here
we match for a actually a map which is
supposed to have a key stay with the
value start and then we update the state
field to the key to changed continued
about pattern matching here the planning
is here that it should be possible to
bind variable in the matching and them
in the same matching as you use it so in
this case the I is first bound here to
the first element in the list and then
that value is used as the key in the map
and you get the value in bound here to
variable C and then you can update it
and here we use this update existing key
could have used the other one as well
and maybe it doesn't matter in this case
but potentially it could be more
efficient like this when we know that
the key exists yes so this is an
interesting kind of pattern matching of
that can be used okay here's another
example of pattern matching where where
you might average replace a record use
with with the map is there this file
read filing for for example it returns a
record today and it requires the user to
include the record definition if you use
the map in it in a case like this you
would not require any include files
we also have single value access so you
can with this curly brackets and the key
name you can access just that key and it
will be returned as the value and by
this you can achieve some access to net
nested fields down in a hierarchy of
maps but the update / I show this also
in our Factory in San Francisco and then
I showed some sampler of convenient
update nested update which actually was
wrong so I have corrected it here and
it's not so convenient anymore so this
this is an area where we have to think
more how-to if possible find a really
convenient way of updating deep down
just a value deep down in structure
map comprehensions is also available in
this case it is you can have a map as a
generator in the comprehensions we
already have and we can have a new type
of comprehension which is building a new
map from whatever generator you had from
the beginning and type specifications
this is an area where where we haven't
discussed with the dialyzer guys yet
that remains to be done but it could
look like this that you can declare the
thing as as a map you can say what keys
you must have there and we'll type this
down
you can actually have the literals for
the keys for example if the keys are
atoms or you can have the types
suggested here the type of the key and
the type of the value an important thing
here is that maps are seen as ordered so
they are sort I mean the keys in and
values inside the map they are sorted
first of the size of the if you have
several maps and it should sort them
which maps comes before the other one
and first the size that matters and then
it's the keys they contain as if there
was tuples of key key value pairs in a
list to sort the same as that
and of course the actual data type map
had a order among all data types as well
it sorted I mean off of the top billing
in the order of data types because this
is a built-in data time not known by the
along the am done you can also have God
beefs that test if you have a map and
you can test for the size of the map and
you can use them in gods and they belong
them by tradition as all God beef stew
the airline module in addition to that
we also have will have a map mod you
could always be discussed if you should
have the name map or max now we are
making lists right now you are and you
can convert from a list to two lists and
from a list of course and the result
here was looked like a prop property
list you have more functions you can
create a map but you can do that with
syntax as well you can test if aqui is
present in a map you can get the certain
key but you can do that with sin text as
well you can put
a value in into a map you can search for
key you can delete keys you can't do
that with syntax one key or many keys at
the same time and you can get just the
keys for example and you can get just
the values from a map or you can fold
left the right over map and you can map
over map as you can release then you can
merge two maps as well the internal
representation here is the plan is that
we should have two different
representations which is changed
automatically the user is not deciding
this it's into the vm to decide this and
if the map is for example below a
certain number of keys and it might also
be that the keys are immediate values
then it can be represented like this
where the key the green box here is the
list of keys and the idea with that is
that it should be compact in memory so
you can reuse this key description when
you have many instances of exactly the
same type and then you have the values
in another
separate area by this you can get
efficient storage and you can get
efficient look up because there are
maybe I mean immediate the maximum
number of keys here might be around 32
64 in that case you have option to do a
quick actually search there to define
something and that's the typical for
records today to have not not having
more fields than that when it grows in
number of keys there will be a tree
representation instead to have the order
there from the beginning and we cannot
create the order by sorting whenever the
order is needed so you keep the order
this is maybe not exactly this type of
tree could be a more advanced tree
structure but you get the idea that is a
tree structure and in this case you
cannot share the keys between two
instances of a map of maps even if they
should happen to have exactly the same
keys
and of course we have to find a new
external representation a new tag and
some internal structure of that one
which is not completely decided yet and
the use case is again for maps them for
example you can use them when you build
an XML corset have the representation of
what you parse instead of records
yesterday you can have it convenient for
a JSON mapping you can have also for a
standard one mappings it's similar to to
XML I think you can replace many uses of
property lists you can use it in AP ice
instead of records to avoid include
files and you can use them for holding
state of a process for example and in by
that you can achieve a better ways of
doing an upgrade records are a bit
limited in that area
here here are some examples of Jason
mapping first you see how it's mapped to
a line terms in machi Jason today and
there are other similar mappings you
could map it to the map data type as as
below here it's very you see that the
JSON and the map structure goes hand in
hand here's a bigger example of how you
could view the JSON data us as a map and
it looks almost identical here is more
gave some examples
where you can find the value ID in the
first one and in the second round you
can also find it with single value
access this is not what you want to see
you can as I said before use it in API
of course we don't plan to change this
file read filing for in an incompatible
way but you could maybe introduce
another function using a map as a return
value instead process info is another
example it returns kind of a property
list today of course there are open
questions I mentioned this about the
details about type specification and
what dialyze you can do about maps we
have nested updates we have to be more
exact about external representation and
how to be compatible with Oh older nodes
when we introduce this one what should
happen when we create them up in an hour
17 airline vm and try to sell something
to an hour 16 node should trash should
it be something that the or 16 node this
can understand in some way
summary maps are ordered you can have
any term as a key in a pattern matching
map comprehensions we still have open
questions and your feedback is welcome
you can you can see a more detailed
description in this link as an IEP I
like enhancement proposal this is just a
summaries more details in that one and I
think what we have described there and
what I've said here it's not written in
stone you can still convince us to
improve or change something we are
working with this now and the plan is to
to have maps in the arse 17 release
which time to come first quarter next
year and we will probably able to
release some prototypes about this that
you can test in the late later this year
yes that's all for me now questions yes
it's good very well be so but we haven't
come that far in the implementation yet
but maybe two also could be that it
should not shrink because if it has been
above the border it's probably not the
type of map that is have a stable set of
keys which is maybe the case we want to
catch with the first representation
okay we take you first okay I can repeat
the question is how could this compared
to two records in performance wise and I
can say that all both these
representation of maps will be less
efficient than records but the smaller
representation with sharkys can probably
come close to record performance in most
cases okay we have you down there I have
to have the market if there is only one
map in the whole inversion machine that
has lots of keys that will change to
internal representation for older maps
on is that the case no the
representation is individual / map if we
issues that the one or the other blood
just like it is for today we have for
example binaries they are represented
one way if they are below 64 bytes and
another way if they are above 64 bytes
you have a question there so why do you
feel that the maps need to be ordered
why do you put such a restriction on the
data type because it goes in line with
all the other data types in our line and
it would be quite kind of we have
discussed this a lot and the original
idea was that it was not to be ordered
but
then we came to the conclusion that it
is better to have them ordered and for
example is that if you print them send
them to external media or something that
they look the same and if you compare
them they look the same and it is not
required to to sort them before sending
them to extra on the media before
comparing that would be very
inconvenient so then we have the ordered
representation all the time
no in this you don't have any it will be
the sort water depending on the key
values
I mean it's not a very big cost to have
the maps sorted all the time if you use
the tree representation or or the other
representation but of course it this
rules out the hash representation that
we could have used so that means if you
parse JSON document and then print
afterwards you will have changed the
order of the document all of the keys
and values it will not be the original
as that would be a point yes if you take
the yeas and data and convert it to an
online map structure and then print that
one it could look that you get the keys
in a different order from the JSON
perhaps I can actually but that's the
point but it depends on how you choose
the mapping of course it's at least I
can never remember whether or not in
JSON document you have to preserve the
key order or if the key or is actually
can be written as you like and I always
get it wrong but there's something there
with JSON documents whether or not you
have to preserve order a lot and I can
ever remember what is the right thing so
it might not be a problem there for xml
documents you definitely need to
preserve the order but then it's not not
a a hashmap it's a list in that case
let's say but I mean if there's a
different representing I recommend if
you have objections of what I told you
today read this eep and come with good
reasons why we have shifts endure
wrong direction still time to adjust it
if you have really good reasons okay no
more questions I think one more we do be
able to use this in at stables or
amnesia see you either enter a map
instead of a record or at Apple and can
return it happy and implementation for
that we have no current plans to change
that but it could of course be a way of
extending for example needs you have
using maps as the record type but from
the beginning now we have thought that
map is just another data type you can
have it has no special meaning for ets
amnesia ok
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>