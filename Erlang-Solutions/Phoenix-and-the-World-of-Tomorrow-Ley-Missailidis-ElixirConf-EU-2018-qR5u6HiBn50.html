<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Phoenix and the World of Tomorrow - Ley Missailidis - ElixirConf EU 2018 | Coder Coacher - Coaching Coders</title><meta content="Phoenix and the World of Tomorrow - Ley Missailidis - ElixirConf EU 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Phoenix and the World of Tomorrow - Ley Missailidis - ElixirConf EU 2018</b></h2><h5 class="post__date">2018-04-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qR5u6HiBn50" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so my talk was called Phoenix and the
world of tomorrow because I watched too
much Futurama and I managed to get SVG
the Phoenix logo but I want to just
describe kind of at a top level just so
you know what you're investing in while
I was sitting here which is what this
talk is actually going to be about
because my first draft of this talk was
150 slides and apparently a workshop is
a 10,000 foot view of what it's like to
implement Phoenix and a web interface
for emerging markets or places where we
have low bandwidth situations and I'm
not I'm going to be showing some real
code some real time some real metrics
but it's going to be more a guide of
solutions you can look at and advise on
an architectural level with some
practical solutions that we've
discovered while working at I want my
name for this market I want my name is a
domain registrar based out of New
Zealand I have two colleagues with me
there's a Dave shaped object which is a
New Zealand guy with a red hat and there
is a NIC shaped object which is a tall
Australian map it was very pleasant so
meet us we are friendly all right
so I want to talk a little bit about why
I want my name started me down this path
as I was doing the research so in I
believe July we were congregated at our
summit and we were discussing the perils
of the independent web in places like
India or the Philippines where Facebook
and Google have just completely taken
over the Internet is the Facebook in
large sorry internet is Facebook in
large portions of the developing world
and there are reasons for that Facebook
invests a huge amount of time and money
into optimizing for those markets and we
were doing the normal round-robin
discussion of well many people only have
mobile devices and responsive design
and generally like just normal bandwidth
concerns and stuff like that and then
one of our founders Paul in particular
post Spence mentioned this can't be the
only problem because every company would
already be in there and I thought about
this for a while and then I came back
you know what I don't actually know the
solution to this let me go off and I'll
do some research and this is the results
of that research so first I'm going to
describe what the actual problem is
because I had abstracted it completely
incorrectly when I first approached it
which was this is a front-end problem it
is and it isn't so front end as we
traditionally think of it is HTML CSS
JavaScript and this is not entirely the
problem although many people research it
this way so first I'm going to just
describe what the next billion users
which is Google's catchphrase actually
looks like so right now and it's really
hard to track these numbers because they
change monthly which is they're about
more than three billion smartphones
active right now in fact I saw a number
recently from and by recently I mean
this morning which said there were three
billion smartphones active in Asia alone
but that was from slightly questionable
source but so but many of these users
are also coming online for first time
they've never seen a web page in their
life this is the first time they're
experiencing the web and there is
experiencing it on their phone
approximately across a 2g connection it
might be technically 3G but they have
two bars or whatever but ultimately
they're on a low bandwidth situation
infrastructure is present so they can
rely on the internet being part of their
daily lives but it is slow so imagine
you had a dial-up modem in your cell
phone and that's kind of the experience
that most people are experiencing the
internet and most people these are now
more users than people are connected by
fiber or LTE the rate of growth is
actually staggering
looking at new users online in India and
the last number I saw was 10,000 a day
and again they get introduced to the
online world by a Facebook similar to
America online in the 90s and Google and
this is all the internet is to them
right now
and this is another difficult number to
pin down because so telcos don't
advertise their pricing scheme in an
honest way usually but the price of
bandwidth is high even by North American
European standards per gigabyte and it's
also very high comparatively to
cost-of-living adjustments so every bit
we send over the wire has an expense to
it and we have to be wary of how much
data were sending to these customers
because they work very hard to get this
experience and you know if you're
sending a dumb cat chip it better be
really good so that that is the user
that we're thinking of now how does this
relate to Phoenix at all well in Berlin
I think two years ago Lance I'm going to
butcher his name and I apologize because
I've known him for years
Halverson gave a influential talk at
least of me not so much it said new
things to me because it was kind of
architecting this way anyway but it said
it in such a precise and concise way
that it was more like I can finally
explain it the hat goes on the head so I
would recommend very highly that you
watch his 30-minute talk that's on
YouTube from alex ikonn phoenix is not
your application and also get his book
which is a vast expansion of that idea
but to just give the brief summary for
those that haven't read it or seen the
talk is Phoenix is elixirs and any sort
of Erlang product really web interface
solution meaning
there should be no business logic in it
if you have some sort of business logic
that you need solved make a smaller
application that you've talked to
through some sort of interface or
protocol that can allow your Phoenix
application to be focused and very
tightly focused on one problem which is
getting users on through web interfaces
to use your back-end applications in the
same way this is helpful for a variety
of reasons one simple one is it's easier
to upgrade Phoenix when you need to and
two it just it's good application and
architecture and this has been present
in Erlang for eons elixir does it as
well we should just do that if you ever
catch yourself writing too much in a
controller or something like that think
about spreading it out to a new
application by erlangs definition of
application so that's that and this is
my starting point so from that point and
I started redefining how we how I
addressed what is our application or at
least our web application so it starts
with Phoenix Phoenix has a lot of things
in it and needs to be tuned to on a
server somewhere but it's the outer edge
of it is not localhost it's not
somewhere in your data center it's AB
real browser with a real user somewhere
in the world and you have to redefine
those borders because I remember a long
time ago there was lots and lots of blog
posts about Phoenix that just showed the
response time of channels or something
like that and it was in dev mode and we
all laughed because it was in dev mode
there's all sorts of stuff on and it's
much past there in production but is it
faster I mean in the case of in a real
application
you know the browser parses things that
takes time and we don't account for that
time Phoenix is fast the browser is slow
but that doesn't matter to our users
users care what the final end time is
and it's important to have your end goal
to the first point when your customer
can start
interacting with you that's when the
application happened before that it's
just a bunch of numbers of different
stages in the pipeline and when I start
redefining that and as another note
Phoenix presents already kind of
acknowledges this app architecture it is
essentially eventually consistent
browsers and in that case we already are
kind of designing this way you just have
to think about it so I use a tool called
speed curve now speed curve is a company
which allows you to replicate
connections and shows you a filmstrip of
how the browser has parsed it and you
can replicate certain conditions ie if
you want to say an Android phone on a 2g
connection with 30% data packet loss in
Nepal
how does my browser get parsed and they
replicate that for you and they can't
you can set up multiple ways this is
kind of a long polling way where checks
every day and you can see what's going
on in your budgets and everything else
so that you know what decisions you've
made in your application to that affects
users in a less than ideal situation so
I recommend using speed curve this is
not paid at all though I'm not opposed
to that if anyone from sweet curve is
watching but that's a different thing
the other thing that I had to consider
is mobile first design and I don't mean
that by a skinny browser which is how we
normally start in like CSS land I mean
go out and buy low-end Android phone
google recommends a moto G for they are
super cheap I have an older Sony Xperia
and I always keep the bandwidth on that
phone when I'm doing my testing - 2g max
in fact every once awhile I put it down
to 56k modem for funsies but this is
important so that you understand when
you hold a real device not just numbers
what it feels like like it's something
which is hard to describe but it's
essentially app feel so you're walking
down the street on the 2g connection how
long does it take me to get something
can I walk and talk
this is something I sit down with and it
helps you make informed design decisions
on multiple fronts so and there's
another thing of how we started
establishing budgets so there are two
major budgets which are easy to
understand time which as I said is when
the browser gets it and footprint and
just for fun we do this in units of Doom
so there was lots of articles way back
in the day where people were worried
that websites were getting larger than
the 1990s game Doom which was two point
three nine megabytes a wired article
today is about six so to read one wired
article you need two doom units in a bit
and so this is fun around the office I
picked an arbitrary number but now we
talk about units of doom every time we
add a react library like this this
accordion it's half a doom unit
this sort of thing so it makes it a
little more fun because honestly it's
boring it's bits over the wire but use
at your own risk
the other one is time so not all bits
are created equal
everything on your page must do a job
and a job can be selling your product
like if you have a big hero image that
might be worth spending some bits on and
also JavaScript and images are not equal
images parse really fast javascript
takes a while so pay attention to when
the browser has finished parsing not to
what the bits are and there's another
thing which is the when the page loads
you can deliver an experience to your
customer but you can also have a fully
appreciated experience as more and more
JavaScript loads if you design your app
accordingly instead of blocking the page
so if you work with an appreciated
experience that's slightly transparent
to the user they will get a better app
as their data catches up with them and I
recommend this
an app architecture alright so I was
being funny but we're running low on
time and we're all hungry so this is a
Bible quote about us buying a server so
let's move on
so one thing we did notice when we're
doing our budgets and for time is that
when you move Erlang to a bare-metal
system you get this dramatic speed boost
and this dramatic speed boost is
surprising how much more stable your
system gets and literally it's
noticeable on the browser side that you
move the server to an equivalent size
but it's no longer VM I'm that's a bit
above how I understand things but just I
recommend Erlang as a VM ship it on the
server a real one and there is many
companies right now that are making that
really easy to do and the other thing is
we used to have something we called we
used to call them Network quakes and we
couldn't tell where they're coming from
but essentially we would have a noisy
neighbor on the same physical hardware
that we couldn't tell and we would have
these weird disconnects on our sub
WebSocket as soon as we went to bare
metal if they went away that opt cost
vanished and they're not that expensive
and I bring up this one server which is
new to me which is by packet net so this
is 96 physical course at two gigahertz
on arm it has 128 gigs of ECC Ram and
some other stuff which matters less and
it's like 350 bucks a month
this thing is nearly designed for Erlang
you can have all the ports you want and
and nearly infinite number of course or
96 to be precise but we haven't tested
as much with it as we would like to but
I would recommend looking at it so
packet net it's called the C one large
arm and it has a fun pun in it which
says time to start an arms race so Intel
alternative so our OS and file system of
choice
previously in ZFS
just do it networking stack in FreeBSD
is better ZFS caches a lot of your
application into RAM don't have to worry
about disk i/o reasons I really did want
to be the guy use whatever operating
system you want bubble up I've seen
Ubuntu in production and I've seen
previously in production
I value my sleep FreeBSD is more stable
at the end of the day and did part
tracing the networking is much easier
and does NFS I was very surprised at
again a noticeable speed boost in
browser from what was a compressed arc
which is basically your application
getting loaded in ram on demand and it
stays there while your applications
alright
so as i want my name we use h a proxy
for our web server and by web server I
mean proxy because cowboy's a very good
web server I am I am a fan of H a proxy
because it's very light and does the one
job I wanted to do that cowboy doesn't
serve SSL Certificates proxy and give me
a little bit of a cluster but you could
use nginx I found that nginx needs a
little more tuning but again the point
is that it's very light it does very
little and moves the data along this was
another bigger one which is compression
so I pulled this that because I was
surprised by it so Netflix a company
that core product doesn't need to be
compressed because it already is turned
on gzip one day and 43% of their
bandwidth costs window this is only from
them sending subtitles HTML documents
for whatever they're doing that's our
stuff and that was kind of unnerving but
again turn it on and then this is me
making the face then I moved on to
implementing on our own and gzip is
ubiquitous but so is brought Lee which I
was surprised by because it was new in
my head but it's 87 percent of the
browser market has it it's HDFS only it
can be slower but there are a lot of
guides online they're misleading about
that and it isn't really so the
fundamental difference between gzip and
broadly in default mode gzip compresses
at gzip one by default broadly dials it
to eleven and that's literal brought
Lee's highest compression is eleven and
thank you to whatever developer did that
that made this like much easier but what
you can do with brought Lee and this is
what I would recommend gzip six and
brought Lee for but leave the other way
around but Lee six and gzip for brought
Lee and gzip have the same amount is
this around the same speed brought Lee's
a little faster but it's about three
percent higher compression for I was
compressing a CSS file and you can do
this live and at almost no cost
comparatively to geez I think now what I
would also recommend is for your static
files like CSS JavaScript blah blah blah
packages compress it with web pack or
whatever you're using to compile your
assets when you do that you can compile
it all the way to 11 at no cost it's
going to be a little bit of a cost on
the browser but they it's a fast
preference over doing it over to wire
because broadly at 11 can get the
compression to about 93 percent and this
just saves on bandwidth which is the
expensive factor in this situation HTTP
in matters of compression has a mild
problem which is there are a few
exploits so we wrote a very small plug
and buy wrote we wrote a very small plug
in our application and we decided to
open source it because we were hemming
and hawing because it's literally this
it's three functions it's essentially a
lick sir flavored Erlang because Dave
and I've been hanging out in Erlang land
too long but it's three functions pipe
together I'm not a huge fan of making
that a library because it is just three
functions it's a blog post but we made
in a library
the good reason that this shows the
power of the VM I didn't have to write
anything all this does is put a wobble
and our HTTP header so that it's harder
to exploit by a compression or web
server and this took three or four
minutes to write and I didn't have to
pull in any libraries or anything to
that effect just a little bit of wisdom
barely touching the plug stack and it
was done so this is on hex like today
it's called hair flew a Harfleur and
poked it I would be interested to see if
anyone can make a to Erlang version of
it because I've considered this to be
like Earle ankles next WebSockets and
compression okay so this one there be
dragons I spent too much time on this so
this is a compression of the Raven in
gzip it's just a visualization of how
gzip like will take native language and
start compressing it now the reason I
bring this up with WebSockets is
WebSockets in cowboy too so when you
import that into plug has a WebSocket
per frame compression algorithm and the
way it works is you have a hash which
per frame persists and it slowly gets
more efficient that the more frames you
send across it I went down this rabbit
hole for probably a week and there's
some interesting bits it costs a lot of
RAM for a very light WebSocket
connections it's about 300k per
connection and when there are
disconnects
it you lose basically the RAM is freed
and then you have to do it again so you
have to evaluate how long your WebSocket
is sitting around and do that this is a
very much it depends and it's newer tech
so I would
say you can compress a WebSocket if
you're somebody like slack where you're
sending messages all day for 8 hours
it's probably a very good idea but if
you're just connecting to a WebSocket
for like a minute maybe think about how
much ops costs it's going to cost you so
anyways that's that and now this is my
own joke wait isn't this a Phoenix talk
cuz I haven't talked about it yet and
here we are so this is just some advice
so Phoenix templating evx is both very
fast and very good you can kick out web
pages at a alarming speed you should use
it I get really sad when I go online and
I go to a new Phoenix app and I turn off
JavaScript and I get a white page police
ship an HTML template it costs you very
little particularly with the compression
care about your HTML semantic so this is
something of a personal thing with me
but screen readers rely on clean HTML
and in the developing markets people
because of translations and possibly
poor idiom will be using HTML semantics
to make sense of our apps if we are not
making sense so care about it spend some
time with your content media strategists
spend time thinking about what does this
mean I know it seems silly and it's by
definition a semantic argument but it
helps people so just think about it get
text same advice it's very fast it's
very good use it and we have a plug
which reacts to and please do this don't
do it by IP the browsers set language
which will start adjusted which will set
our flags this drives me nuts with the
IP thing because when I'm in Greece and
I'm looking up technical articles I do
speak some Greek but at the same time I
do not speak it to the point of being
able to analyze technical articles and
Google will just feed me Greek articles
and it takes me a while to find the
English ones so do it by the browser's
settings
be able to call it with some sort of
flag or in our case subduing the reason
I'm saying soon is we wrote the plug
there's another plug if you look up
online
we disagree to some of the decisions in
there so we wrote a different one but
it's kind of hinky code at the moment so
I'm cleaning it up documenting it and
putting in you know actual testing so
soon on a hex now the next one
CSS and this is my favorite CSS thing
right here
CSS what is it even I've never seen so
much trouble with a programming paradigm
then CSS so much but there's two things
about this notes so CSS is awesome it's
outside the box
I've spent a few hours debugging that
but if you had a design system that
couldn't put things out of the box you
would have table based websites so it's
a part of the deal you have to deal with
that now the CSS Peter Griffin thing
which I go to play again because it's
fun yes this is how ID bug but this is
also how I debug in a Ruppel this is
every form of debugging it's just CSS
gets a bit of a bad rap because we all
have to do it and not all of us have the
same competencies in it
but I could replace CSS with legacy
rails app or I could replace it with
legacy any app and you have the same
image so perhaps if your CSS is really
hard for people that aren't heavily
skilled in it perhaps it's time for a
refactor just soapboxing a bit but CSS
how it actually works this was an
attempt to kind of explain how the
parser works in a lick sir
so there are two things of note here
destruct for browser dot CSS has a five
tuple in it even though it's a struct
but that's basically how CSS understands
specific T I almost got it but
but you have there in order of
importance so important outclasses
everything in line out classes
everything behind it IDs
Oh class lack classes and that elements
and these numbers add up so it's a
little bit of CSS math oh I have three
classes and two elements what what
decision is it going to make about these
particular key values is that's how it
functions and then the next one is this
is how the browser parses CSS so we all
know about the Dom I find less people
know about the CSS object model which is
the Dom with the CSS inheritance
calculated from specificity I didn't
yell at that time then it goes to layout
so layout is the box model from the CSS
is awesome then it does paint which is
fonts text color that's why you can do
the CSS awesome thing so if you are
refactoring your CSS to be faster you
need to understand this there are lots
of articles just look up CSS object
model that's what those articles are
about optimizing your pipelines for
assigning values to dom elements CSS
class only design now this is actually a
really good idea it's by Harry Roberts
and he writes a lot on so he has this
inverted pyramid which is essentially
the CSS cascade so imagine Erlang
functions inverted you get the same idea
it's a pattern matching system that's
declarative so he organizes everything
that way then you have block element
modifier naming structure the reason he
does that is because he's not using
specificity anymore he's only using
classes and this produces high quality
semantic CSS through process it also
boils down CSS to just one programming
virtus you don't have to think about
specificity as much you just think about
how to organize your pipelines so this
is Harry Roberts he's CSS wizardry on
Twitter and etc his website if you want
to dig into this as a like process for
your company this is a very good idea
CSS why ignored good advice so I did
something else that I want winning so
normalize but for a brand so normalized
that CSS normalizes CSS oddities between
the browsers to a convenient stack we
did the same thing but we did an only
element only style with one exception
being buttons because buttons are
conceptual sometimes you have a get
request that's just a link which is a
button but these element only style is
basically our default page if you were
to delete all our classes with the
exception of button we would still have
a branded page it's there are very few
media queries it's only line Heights and
a couple of restrictions so that it's
still legible there are zero external
dependencies no fonts being loaded other
than what's on systems no background
images nothing it is only what the Dom
can render freely and then why the back
end is not an unmovable block if we're
in a low bandwidth situation either that
we can detect with JavaScript or we can
explicitly call we can ship that on the
top of the page not even in a CSS file
with one HTTP request and our customers
get something immediately which is
legible and branded we have a low
bandwidth of the site as a consequence
again 0ik external dependencies because
that support we did write a plug to
explicitly call this also soon TM
because I'm not that organized but the
other thing is nope
I'll leave the JavaScript slide up but
the other thing is when I when the
Hurricanes were happening in two states
last summer
CNN released a text-only version of CNN
and this was vital to a great many
people because cellphone powers going
down low bandwidth they needed to be
able to read the news to know where to
go to be safe and I admired that because
often we think of our apps as something
extra they exist on our laptops but few
sometimes our apps are
infrastructure and we should think about
people trying to use it when situation
is not clear on how much time they have
so we shipped a low bandwidth version of
our guides because it's useful if you
know you don't have a lot of bandwidth
you're on the subway train you could
read our guides a we are domain
registrar we are not vital
infrastructure no one in the hurricane
situation is trying to change their DNS
injuries but the principle is the same
if you use slack to communicate with
your family and you're in a war zone or
something it's very important that they
have the ability in a low bandwidth
situation to be able to use your app so
advice I'm sorry for my JavaScript this
one I always make a groaning noise so
the only advice I can give because
JavaScript apps change so fast without
knowing what's inside your JavaScript
app is try breaking up your app from
slow moving to fast moving you can
usually tell them to get history just
don't bundle it all up in one a couple
extra bundles and you take advantage of
caching so if you have a part of your
app that doesn't move very much probably
put it off in a corner and then consider
JavaScript and WebSockets is an
appreciated experience try to load them
after your initial crud app has loaded
and if you can do it transparently ie
use the same CSS but suddenly new data
is flowing in when the JavaScript
arrives that is a good programming
paradigm that people won't notice it it
stays out of their way and they get a
better experience no matter what
situation they're in and as all things
when it comes to front-end it depends
shrug e you need to you need to analyze
what's going on here but ultimately
these are how this is how we used to
design web pages when I started in 2008
all advice about web pages was exactly
this before javascript engines were fast
and all that and this is a lot of kids
get off my lawn I've been saying this
for years but now it's important because
we're
in a low bandwidth situation it's no
longer JavaScript is expensive to parse
but it's now javascript might not arrive
so and from as an Erlanger as well this
is just good fault tolerant architecture
like we know networks are bad we we have
multiple fall backs four networks are
bad do it on the front-end
networks are bad not everything shows up
can they can we still deliver something
of value and this is me every day now
I'm going to assume the children are so
anyway that's it we can go to lunch
thank you for listening to me right
before lunch if you have additional
questions please email me I will happily
answer some of them if it's a react
question and I will answer crankily I
want my name is also hiring a new dev
you want to join us on this new journey
into developing markets please meet the
various I want my name objects Kiwi
accent Australian accent I have a beard
alright that's it thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>