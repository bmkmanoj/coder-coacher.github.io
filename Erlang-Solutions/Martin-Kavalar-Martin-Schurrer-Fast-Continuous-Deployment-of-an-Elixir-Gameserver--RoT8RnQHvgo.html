<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Martin Kavalar, Martin Schurrer - 'Fast Continuous Deployment of an Elixir Gameserver ' | Coder Coacher - Coaching Coders</title><meta content="Martin Kavalar, Martin Schurrer - 'Fast Continuous Deployment of an Elixir Gameserver ' - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Martin Kavalar, Martin Schurrer - 'Fast Continuous Deployment of an Elixir Gameserver '</b></h2><h5 class="post__date">2015-05-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RoT8RnQHvgo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm marking cabin are and I'm not
ensure Mike Francesa said we are talking
about blind innings here I bucket
so you should all meet you laughing on
the third slide yeah I like a PSP f kid
i used a next year to build a server for
upcoming year time revelation product
for year sync GUI dogs for PDF and
before that I used to work is Martin on
board poker and such big mountain yeah
so thanks Martin now watch out just I
think this is lighter crashed note this
is South field this was the earliest
version I could find to the horrible
scream hub and so it started in 2007
it's a very hard game the game shop and
yeah so thank back in two thousand seven
we had a Java server to go along with
this horrible flash mine and that was
just as bad as this looks 40 million
things have improved a bit since then so
I went to railsconf in 2008 and came
back with the plan to rewrite the Java
server in our line and so this is what
it looks like today and this is not
flash anymore this is html5 now and
another thing we're working on these
faces both poker it's your personal
poker dealer for your home game so it's
an app you have an iPad in the middle
and every player has a mobile phone
which displays your cards and you still
use chips through the vetting but yeah
all the hospital shuffling
dealing cards goes away and so this is
an example of an a-bomb like we just
currently there's not definite players
using it but that if there's only one
group playing and they come together you
don't want to interrupt their game and
people have used their hands when you do
great so yeah an hour tart we're going
to start out with talking giving you a
brief overview of ltp applications then
do auto ki releases and are coded
upgrades and then we'll show your we
currently deployed elixir and running
apps it's a few and all poker so
applications to know turkey application
um it's just another collection of
processes of combat medic Syria or
airline and processes in a supervision
hierarchy if you refused mix you
probably already familiar with that so
any mixed file you define any dependent
applications so lager is just an OTP
application as well and as well as the
entry point for your application with
any arguments and so looking at the
entry point this is the start function
that sets up your supervision hierarchy
and at the bottom there um you start
your route supervisor and you attach
children to it using observer start in
the Alex you shell you can visualize
this supervision hierarchy that comes in
pretty handy don't worry if you can see
everything here this is just so the
supervisors you saw on the previous
slide the sea route supervisors
attached to it this is just a server i
often started so yeah there's not much
going on there just will look bigger
when there's more more players and yeah
on the left side there is he all other
dependencies which are also OTP
applications so for example the lager
application has its own supervision
hierarchy here and now and after Martin
to talk about OT uses thanks Martin so
you've got OTP applications floating
around how you deploy this stuff what
you do is your billable TP release
that's bundle for these applications
they already compiled this OTP release
bundle also includes the bar nvm and
some confirmation defining the
interdependencies between these
applications this month usually is at
are born and you can just ship it to
your production servers expected and
comment and various tools for this in
the other man alexia ecosystem there's a
bog LX and ex I'm Exynos what you want
to use if you use Eddie's here and
that's what we are going to show so you
add X I'm is a hex dependency to your
mix file now you've got the mix released
task available you call mix the reason
it does everything for you it compiles
all your dependencies and business start
over this is how to talk how it looks
you got this a script pinboard poker
because your application is called for
poker apps is the locking system in the
lib folder you've got the individual
Pentagon or gotten the releases for the
has submitted data describing it
dependencies between them of upgrade and
so on so the star script is like em
giving script you can call start and
stop which made it start and stopped
involved in the background using
attached to get an IP share this is a
hard video awesome but no got people
playing and you want to update this to
interest or stop kick and without deploy
a new version called start and people
are really connect obviously not that's
hard so luckily lacs support for up for
updates that means you can ship a new
version of your coat and my entire
system to this version has any one of
you use the simple action already yay
awesome the basic principle is that you
look which processes use which modules
suspect them so that they can't come
into inconsistencies white always
operator then you change the code then
you call it code change callback that it
can migrate to state that they have in
the state dictionary suppose captions
java as new version as an additional
field you want to edit default value for
that after that you is you new
processors this is done by the outer
system for you this is the country decor
back using turns over as you see you get
the previous previous state you modified
you will turn the new state if all goes
well your posters will be resumed the
longest amount which is being late and
it's got a chapter on hot coal updates
to and this chapter has twenty five easy
steps and housing
and after 35 is that it says you might
want to buy a few scripts to automate
this totally to this is my libra LX and
ex I'm exist so let's look at what these
kids actually do for you so the simplest
case is a module like this which isn't a
colleague module for behavior or
transferable I missing it just takes the
state of the over game and determines to
be me again and in so it's purely
functional and supposed as a bartender
and you want to ship an upgrade for this
bar you just change the file pump the
run yo mix file and corn makes release
again you need to have the previous
release still in the off the folder of
mixed release that may it can I
contracted produce m-files and it sees
which ones have changed for it must've
change it looks at what kind of fighters
or behavior is it is in depending on
that generates its actions on how to
upgrade for each of the application then
is actually is called a nap up it looks
like this so give me your version 104
you cannot pay to mountainside using the
load module instruction which just
replaces the module as or the dumpling
is circuitry and then the system
consolidates these type of files into
marbella there are low levels practice
first you know take hold for a new
module then you reach the one does
manager this means if anything goes
wrong after that node really start with
the previous version that you just
replaced about you you see Joe so
suppose you got something more complex
charitable module in that case X I'm a
detective it has a chitarra behavior and
exports echo change function so if you
generate different instructions they're
updating suction the applicants action
means that coaching record and a lot of
instruction book like this first you
suspect opposes then you load a new
module at this moment if the modulus
change code which does if you continue
with the previous state obviously stuff
will go bad so you now poor code change
on state of the portable material
processes after that is done you assume
and this is how such a built-up
currently leased looks what's different
is that you got the OTP applications for
the new newly world all trophies and the
previous versions and in you Jesus
directory also got post and looking back
at these 25 steps because Carl Calipari
can be truly we have available to us as
AC users but thus stun left so what you
have to do is you have to have the
previous release available in order to
automatically build these apps and
develops you can always start in
yourself
but who wants to do that then you just
call big cities to get a new tab or you
need to create a subfolder on your
server where you put it and then you can
use the start skip to just update that's
not easy but some of these things that
August is code for exam so I can't just
submit an example interest for example
ballast water previous releases are
filled so that everyone in my team is
exit to them and I can go on vacation
without having to an elective available
whether it exists also inflicted alum BM
and my OTP application made of native
code so i need to cos combine them on
some kind of a toast and lastly
obviously you are not deployed on server
but you're deploying would keep
ourselves that's annoying to ssh along
so I think Martinez's solutions with us
so we actually came up with something
two years ago it's called a deliver so
but so far it hasn't I think it's
received our four stars and get up fifty
percent of which come from the stage so
we made a fancy logo and hope that will
change which notice the elixir flames
coming out of tobacco and so what a
delivers it's based on deliver which is
a small and awesome component tool
written in that which sounds pretty
crazy and it's pretty crazy but it works
really well it's really fast it doesn't
like if you know Capistrano competitive
Capistrano doesn't execute each command
individually over as its age but it
uploads a bash script and then execute
the whole script on the server so I'll
just walk you through it how to use a
delivery so this is
overview of how it works Iran deliver on
your development mission you configure a
build post whether it will be built this
should be the same architecture as
suppose you want to deploy to as the
release will also contained like the on
runtime system and that's platform
dependent or any dependencies might be
cut from dependent as well the release
is built on your toast is then stored in
a restore we use s3 for that and it
supports roll out to multiple stages and
I just walk you through the steps
required to set it up and yeah how to
use it so you currently a add it to your
project as a mixture pendency using this
line I think we are going to make it
available as a hex package as well and
so configuration is pretty
straightforward as well it's a pretty
minimal config file so what you specify
did your app name then the host you want
to build on this can also be one of your
deployment missions to mission you
deployed you can you specify the user
and the path where you want to go the
restore is as pre credentials we also
support on SCP storage and you specified
in production hosts as well as stating
hosts and where you want you to deploy
do so to get started with he deliver
first you Hillary's it's just a deliver
build release we recommend having but
you have P deliver and you mix
dependencies we remember
sibling on the root of your project and
yeah this is what it looks like so it
will defer all the hard work to whatever
bill tool you use so it can be either
riva relics or xrm as we'd recommend so
what happens with another release said
you connect to your built host then
uploads the git repository from your
local machine so it doesn't it still
works when get happiness down and then
it upload series to the restore you
specified next up you want to deploy to
Ruiz so what you use either look at
deployments to production specify your
version and yeah that's pretty much all
there is to it should work out of the
box field and yeah this is what that set
looks like the Rings is not started yet
that's a separate command so yeah that's
a deliverer start production in order to
start all right and now on drop rates so
when you do up great what you need to do
do is in order for your bill tool to
know what working to upgrade from you
need to specify a from working here in
this case this is a gift tag and then
yeah II deliver we'll figure out how to
like will either check if the grease is
available in the greedy store or else
our build the previous release first and
then create an upgrade to your new
version
and deployment of your upgrade is done
like this and so yeah because of the
weight of code upgrades work this will
deploy you a great driveway and do all
the necessary work for you so extract at
our door and make Tory's permanent um
which will mean if everything goes right
yeah you should have the new code on the
server without anyone noticing and oh it
looks like we gave the really fast
version of our talk is the good time so
you can use it today for any tile on my
ACL OTP education as Martin asserting
using production at southfield all poker
and his BF get it also works greatest
feelings one who actually uses it to
deploy its phoenix feather and we are
really looking forward to love is chris
and improving integration there and we
hope that he'll deliver can become the
cuts down for the egg 0 and f ed reverse
a shell script and it's got hooks for
lots of stuff so you can extend and some
two things that have been that heavenly
open source are for example some real
users console to store the last word
version so that the bar flow is easier
and monument would be cool would be to
integrate a library into your deployed
system that allows you deliver
she too fresh the version that's funny
so you don't have to specify what you're
upgrading phone similarly but now your
worries need to pump the version when
you throw it up it but that's annoying
if you continues to live of it because
who wants to bomb vs so maybe you can
figure out something that you can just
get shot to create versions Martin got
some water yeah some more stuff we want
to do so we want to open source our
select integration yeah ours like pot
called sep he's bavarian as well don't
we gonna do a phoenix web interface i
don't know if you remember where is
drama film rails and also one thing we
talked about the upgrade testing so if
things go wrong with you are great
you're really like after the point of no
return you're left with to the worst
case which case that application just
three starts with which is really
something you don't want so yeah testing
these upgrades requires some effort
especially if you've been running for
some time in production to some school i
think the most we ever had was like six
months of up timing of the one VM and I
don't know we deployed around 30
upgrades for that so in order to
properly test an upgrade you need to
have the staging box that has all those
30 upgrades reply to it and so what we
do there yet we check what what versions
have been deployed so far then apply the
same upgrades to our staging servers
then we or before that we start up some
thought stubs play on the staging server
and we perform the update and
some sanity checks as to learning
processes die check for IRS and stuff
like this obviously this is yeah pretty
specific to the application you're
running but yeah it gladly looking
looking like we're we are really way too
fast again so we tested this talk
yesterday it was 20 minutes that was at
eleven at night then we improved it to
be 40 minutes I don't know where that 20
minutes we put in there yesterday seems
like we got some time for Q&amp;amp;A and I
think there might be lots of stuff we
can talk about there
any questions yet if you could repeat
the question for them thanks for I'm
worried about complexity of portfolio
rain because if you might think that has
frozen complexity the effort for loading
splash park grows upon laxity great so
for people who don't need this always
off will you recommend restarting like
in not going really well I think this is
something we definitely want to work on
with Phoenix so for example if you have
if you have a web app like Phoenix work
or cowboy application i think the
culture loading when it comes pretty
straightforward because sometimes for
you have a quick the controlling is
going to work better than then just
doing a manual restart and also with us
are still read martin talked about this
last year yeah not yet i gave a talk and
explain what's up dude us there are
multiple servers in front of a load
balancer and animals since doubt of the
second animal and the new code they talk
to each other
Lucien you can basically my great people
from the ordinal to the new node and
that way you don't have to add to Eva's
envelops you just need to define a small
carton of state that has to survive
between those gnomes oh my god so yeah
pretty much it yeah depends on the kind
of change you do so sometimes it's yet
forty small-market exits is three
awesome nothing like if the whole
ecosystem would improve like if more
about two key applications ship with a
box it would be really great to do to be
able to do security updates of cowboy or
whatever without ya stopping your
application so i think this is something
that yeah i don't know we're just were
yeah we'll we'll need but i think you're
just tremendous potential for ya using
this more you know that today i have
just finished chapter or software
updates from a book and it's all it's a
cost-benefit analysis and sorry for
using business term and a technical
conference but everything has a cost
associated to you and you need to figure
out if you actually save money or not by
doing it it's but it's a really really
cool feature i'm surprised not more
languages of actually taking it in and
we're providing it any other questions
oh yeah Salonika the question was if
there's an invitation to the changes for
example if it module is removed which is
more cautious still work yep I only
showed a few of the F up instruction
constructions and 550 modulus remove
standability and its action d module and
you always can edit these apps and let
us manually either live actually has
support for fetching the release fully
restored expecting it opening an editor
a step up for you once you see if it it
package is it again uploads it back and
you can just call whatever actions you
want in it ever in whichever step you
want so you can if you can think about
way where you get to a successful update
then this works for example you could
shut down the stuff gradually and then
do PDT monument but actually like there
are some limitations for example Darrell
nvm only can run two versions of your
coat swords it's the current code and
then the code from the previous trees so
if you deploy rings if you deploy 1.23
and you still have code from one point
to one running so there is before the
last upgrade then there are some options
you can specify internal processes type
or the after it failed and yet so I
think this could be one of the things
we're stuff could be improved that you
have more than one version of court or
for example if you think of doing a
thought upgrades with Phoenix it might
be nice to keep all your like requests
that are currently running let them
finish
they're all cold and just have the new
coat yet activate basically when you
switch out the acceptor pool or
something like that so there are some
limitations but I think there might be
ways around this weird thing enough like
using the elixir to maybe namespace all
the code with the good job so you could
have different versions like more than
two versions of the cold running and
yeah we don't know where this is going
yet but we'll see I got a technical
question like choosing technology you
said you built all these little pockets
and like the first question is having
considered other technologies which have
like possible but it's not the cheap
carpet to do this and like if you can
look impossible I my honey because you
started early because it doesn't burn
much pain it's the same with possible
you don't need anything installing the
server successful pilot and his good god
why I love you only for us the Beamer
race developers as well like Ruby would
have been natural choice I don't know we
just stumbled across this so yeah this
would deliver us recommend it
by collecting devops and yes this really
small thing and we just the garage but
we just yeah nice pretty basic
functionality yeah so like my colleague
that I needed most of the work and he's
I don't know he's pretty when he starts
something he usually finishes it I don't
know if I would have would have taken
would have been able to do this in
Bastion like this would have been too
annoying when he currently but yeah he
got it to all to work yeah I think it's
now pretty cool choiceless I don't know
you always have people that are put off
by when you use Ruby there when you're
doing elixir deployments or Python or
whatever so yeah I think we'll see where
it goes and yeah if it will have to but
if I add some code to go to some other
language compassionate I think it should
elixir how is how is your gold base with
dystrophic how much go to uni and write
create project Omega did they deliver
project or should be should we take a
look so I don't think it's that big it's
all on its own so they'll take a look it
was one more question in the back yeah
yeah
so personal to thickness yeah yeah the
pleasure was that are we make changes to
our persistence layer basically so
database migrations and stuff yeah so we
obviously try to like this stuff that's
more difficult them yeah i'm just doing
server upgrade so 4 volt poker can run
without doesn't require any database
connection currently and if we do
introduce a database i think we'll try
to do it in a way that it doesn't rely
on the database to come so what we saw
skill where we're storing all game data
to postgres so we're yeah we're doing
these changes like sometimes we're doing
them nobody money yeah big changes we do
when we perform maintenance anyway and
take stuff down but for smaller changes
we actually do write code that
performance with that it works with both
versions of the database but that's
obviously more work than yeah but it can
be done
anyone else any other questions hey
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>