<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Certifying your car with Erlang: John Hughes | Coder Coacher - Coaching Coders</title><meta content="Certifying your car with Erlang: John Hughes - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Certifying your car with Erlang: John Hughes</b></h2><h5 class="post__date">2012-05-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bT1_YLrTE64" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay give it back look what really good
excellent so I'm gonna tell you about
that farm project we've been doing the
cubic recent link here's your car as you
probably realized applying it in the ass
nowadays carbon footprint eaters they
all know that there's fifty to a hundred
processes in a modern car little
electronic control units just fool you
but that's what they are and all these
processes there's a lot of software in
value next generation of cars is
expected to have a hundred million lines
of code that's a long software and we're
here in software there are bugs and
people get very worried so couple years
ago their toyota had a problem here in
the US one of their cars was
accelerating unexpectedly and it turned
out to be programmed correctly but the
gas pedal is getting stuck in carpet but
for a long time even thought that it
might be the software comes to play and
it customers stopped trusting
supplements offering their cars then be
a big problem the industry hence all the
worry about the staff so that's really
your garment one detail here is again a
comedy action is actually another system
integrator and fills the car and
components from lots of other suppliers
laughs gearbox for example or the
doormat made by our company and each of
these components there will be a
processor and software running under
course so if you buy a gearbox and run
through then you have to run your
software on that processor and we can
imagine Delilah's operator to art there
is in the system software which is about
provided by the manufacturer of the
gearbox and then there are the
applications that make your car behave
like a tomboy whatever and of course
we've got this whole system together
then differently
the systems often these games are talk
to each other and when you run
applications that they run on a system
provided by somebody else the
application East named a top ten system
so you can imagine that if there were
just them a whole floor of different
systems then it will be very very
difficult to put these things together
and have actually work so in order to
and make this kind of architecture work
reliably there's something called
address our automotive software
architecture and this is a standard for
how automotive software should be built
which is supposed to ensure if
everything works together the office our
consortium standardizes and stuff and
it's supported by most of the big car
manufacturers in the world it's a really
very big activity a part of the Arkansas
standard specifies the basic software
that should roll every see you so
wherever applications run you should
have access to all this stuff and what
you can see here are another protocol
stacks the can busts a common device
look you might have an ethernet in the
car now it is as well that they want to
talk that's communication services which
uses all those protocols this thing on
the left is a diagnostic cluster can be
used for recording when problems occur
in the engine of the 100 sort of gosh
and get information better so what we be
working with is this basic software that
in theory the whole point of the
standard is that car manufacturers
should be able to bind software from
where they live so it's all standardized
right so you know if you buy this
software from one supplier in this
office
everything should just work together in
practice what either it doesn't always
work that way and there have been some
unfortunate experience of a lot of
difficulty in costs as arisen from
trying to run the software from
different suppliers together so if
you're a car from Volvo in our case then
as I have explained a lot come to the
car all day our suppliers those are
called tier 1 suppliers but the software
for those components will come from
still other suppliers tier two suppliers
so there are quite a lot companies
involved when the software car is
constructed so what he doesn't work who
do you blame you have know who to point
the finger at and this this have some
can be like boggle can run into serious
difficulties take this supplier's as
last novel inspired it's there this has
all know it's there it's very important
to have somebody to blame so one
solution to this problem is to buy order
software in the entire car from the same
supplier and that is a practical
solution and it might actually be what
they end up doing Botox that's not very
desirable business point of view because
it means that you may work at the best
prices though actually won't be able to
not only run software all different
processors from different suppliers but
they won't be in to do things like take
the basic clockwork emulsifier and me go
this is the suppliers excellent Ling
fletchling these are insects but their
camp that is not extraction well all the
interfaces have standardized so evolving
to be able to take out the
implementation of Joseph can stack
substitute I can't slapping somebody
else so that really will give more a lot
of flexibility how they put the software
together but it means that they are
really really reliant on the
implementations following standard so
what's the plan the plan is that Ron
just trusting that the implementations
there the members reduce do comply with
standard for illegal to buy a coat when
s-phase certified but it really does
Foles download who r SP they are Swedish
sterilization body like TV in Germany is
the British Standards Institute I'm
talking what the American version is
called but they're the Swedish standard
mutters basically so SP able to take off
implementations and say yes is really
for the acts are standard how often they
do that well based on testing and then
contestant code using quick check and
models but we're tunica being built
easel okay no talking mines complete
without demo foot check so I'm feel any
of you I've seen you talked about before
but for those who hadn't let me just
give a quick introduction quick check is
a testing tool where instead of writing
a suite of test cases you right general
properties that your code should
satisfied so I'm just going to show you
some tests of the reverse functionalists
very simple this is an equation property
so it's a prompt in reverse or it's
actually just that my function
definition he uses the quickly avi to
say row l to the list of integers if i
reverse now reversed again what i get is
equal to the list of my snot rocket so
now from this property i can generate a
whole lot of tests by choosing different
lists and that walk will check
if i compile that fire and rowley check
that we just did protect the property as
an argument there are with generation
run 100 random tests okay so that's nice
and i also want to show you what
happened to the test fails so here's
property that's not true you can imagine
that I look like recruiting the breeze
poverty just forgotten to call reverse
twice okay so this one says if you
reverse in this box then equal to the
original list okay of course it's not
but let's see what happens when I test
prop wrong there are tests fail and in
the output you can see first of all the
randomly generated is degenerative miles
long 0 that was not so reversal and then
after a while then energy person
shrinking involved so quick check is now
trying to simplify test into this case
it doesn't look it simple what I'm do is
just turn up I'll make generous larger
this to begin with and then see
shrinking loads on more interesting okay
so I'm just saying generally larger
tests okay so now we see that the first
test fails the list mine's 8-13 2712 but
a quick check has simplified that down
to the list 0 1 which is the shortest
list which this is this property valence
if you think about it if the list i only
learned it would be done reversal so we
need these dwellings and they neatly
different so 0 wats simplest case it
fails and no I having kind of a test it
see we always have up okay and
I thought I would also show you some
seeker and test that so here I'm
implemented the reverse function on a
rings see and I'm just taking an
importer as a larger in size and I put a
little performance that looked over your
a and sex the eye palette to the analyze
won't mind sighs so in order to test
this I need to be able to call the sea
from their leg and I do that with a
little component we build into a good
check called ECC so this is compiling
that code in the background and
generating blue coat and both see you
there permit me to call oh you want to
put me to call them to see directly
rather so now i can for example call
reverse make 10 is allocates a pointer
to 10 words data and i can also
corporate worst option so I need a
property of the sea con tu and here it
is for all list of integers in my
allocate let the networks and then I
write lists into the array of a pointer
and then I call the reverse function to
see there when i read the array read
that left around after again i should
get the same thing as a pod resting
Sierra you're first watch so let's test
that
well and it saved why will the
inter-service example for the list 01
what I wrote into the sea area called
the reverse function other than 11 not
10 and if you look at the first example
well that's on top of this list I got
this one you can see that the it's kind
of reverse the front part of the list
okay but the real part it's entirely
wrong and that of course is because why
are those function is not correct since
I'm all right with you they have a
reverse it then of course I don't get
the right answer okay then we put down
so what's creature doing it we write a
specification that's those properties
from the spectra generated to hold on
test cases until one fails we take that
and we minimize it by searching for a
similar small interest case until the
error with a minimal pain test and that
usually makes diagnosis easy so we think
of this shrieking progress as extracting
the signal from the noise of wrangling
test when we generate random tests in
real situations then they tend to
contain a whole lot of junk together
with whatever features caused a test fit
and the shrinking process extracts just
those relevant parts of the random
tested cause of failure so it's very
warm for me we get useful okay so our
job is to develop quick chek
specifications for all the parts of this
basic software and we tested like can
stack in isolation we have to surround
by stops for the lady passed basic soft
foods my call we generate API calls from
the couch extinguishing specification
and then we check that they return the
results and also that the right calls
are
to the anchor bolts so we had to mock
the open bones the standard specifies
exactly what course should be out going
to other components for every call you
make let me show just one bug that we
found in some don't encode this is from
a cannon protocol stack and on canvas
every component communicates have had an
ID and that ID also serves as the
priority of the component so the lower
the number the higher priority if you've
got ID 100 and he want to talk and
somebody else me I need 200 horse wants
to talk the bus is yours your messages
go first however when the canvas was
first designed then these Kennedy's work
only learn things and nowadays 2,000
components talking the last just love
and so there's a revised version of
protocol that allows extended can I DS
of 29 notes but the me is the same so if
you've got ID 100 your priority is the
same doesn't matter whether it's a
standard 100 or an extendable number so
here is a sequence of avi called quick
check found that relieve a problem here
our first wall we transmit a message
when I be hundred twelve and the bus
says that ok so the perks of that is to
block the boss now the buttons in use
now make two more transitions with ivy
130 140 okay both of them gave a reply
it says the boss pity sure it the file
API call is a translated confirmation
for unit country 12 so this is really a
call comes from the land below that
informs the broadcast fact that the
first message has been sent so now which
message should be sent the world would I
do the 30th of course because that's a
smaller number than 140 which one was
sent 140 and the reason for that is that
in a code both kinds of Heidi were being
stored in an unsigned integer but you
actually have to remember whether your
ID is extended or not and they used to
top it for that so top involvement
standard extend your ID top and zero men
standard lucky of course when you
compare the IDS now to decipher already
you have to mask off the top bit and
they've forgotten to do that so that's
the kinda bug we can find and this kind
of sequence is the way that the bug is
reported to us this medium good you
could imagine that for example you might
have a stereo thunders bit old-fashioned
and is using a standard kennedy and a
super bottom braking system that has an
extended penalty and now maybe Justin
the volume control on stereo your breads
will work ok so and we have been
building bombs for testimonies propose
we generate lead the articles and we set
up box to respond to call strong we're
testing and we do this using a kind of
coaching state machine trap the stage
inside Capone battle tested just as an
example here a bit of the code that we
write this is testing part of flattery
defense the whole communication function
so we have to write my code to call the
scene and that's just only using the
ultimate I showed you earlier and we're
at preconditions for each operation so
this one you can hold communication if
the state is synchronized and
initialized and we're at a state
transition function specifies how
operation
is the modern state and we also specify
which call outs we expect to be married
and this Court had business this is
something which we had adequate check in
order to be able to do this testing so
this product is drill bits of quick
checks day box and then the property we
test is basically that for every
sequence of the API calls satisfy the
preconditions all the post conditions
hold and all the call out to me as
specified okay I do okay so we ran
across a number of challenges of you
doing that's telling that another one
was it's actually not true that there is
the basic software oh no this software
can be configured in many many ways and
so the fact the soft is generated from
an external configuration file alisal
specify which devices are in the system
and what we got in your car which
challenge d need how often or very
cycles to be executed which means that
when you want to test anything it's not
enough just to have a usual you know
piece of code is a test case you need to
have configuration to run a test in as
well and then API code to get that
configuration accept them it's not
really this simple actually start off
with what's called the system template
that's between your partial
configuration and then what the vendors
give you is some kind of configuration
editor in which you put in your system
template and that generates the XML
configuration but then goes through
their code generator and producers
generated c and using this configuration
editor is a huge amount of work one of
the problems is what happens when
there's an error
configuration there are other conditions
that these system templates have
satisfied and it's not really all there
always clear what they are nobody really
knows what is it correct configuration
what does something wrong well the
configuration enter may reject your
configuration or it might say nothing
but the coachella to my barf oil in
cogeneration might generate code but the
wrong thing that these three ways all
tense that there's something wrong
configuration or field map and sometimes
it's because of genuine air in the
configuration so that's because one of
the vendors is decided not support
something and you may find out in any of
those ways so the standard way of
writing a test we would demand that you
have a long tests long test patients the
logins of configurations usually a
little configuration with just enough to
write test case and you have to put all
of those little configurations through
the configuration editor and generate
code for and it's just basically just
unworkable test suites have been look
for the stuff but it's so much work to
get all those integrations through the
figuration it that it's not really
practical to use them what we're doing
instead is we have long giant
configuration to rule and yes it can be
quite a lot of work to get back through
the configuration editor but having done
so then we just have one less set code
which we can run all our tests against
and then rather than having long
different test cases we have one
parameterised specification which
specifies what anything figuration
should do so in that payoff well here's
an example for one component flash for
interface so there is a test week
interface and in total its
configurations are over forty thousand
lines of XML the Confederation that we
use is dozen of twenty passing life so
what is smaller half a size but look at
the size of the test code if you add up
all those little test cases then there's
one twelve thirteen thousand lines of
ttc and three but there's about forty
hundred lines without the quickcheck
specification so the code ference is so
what ted has more 16 times former so
that bouncing a big win and also we test
more course because we can generate our
training tests from HX fake okay another
challenge was that there are our
components specified in the standard but
when they invented the implementer awful
plus listen together so you can imagine
that you've got a protocol specified on
the number of layers but when you
implement protocol you don't have to
implement each layer separately in fact
it might not be efficient to do so so
instead suppliers are expected to custom
components and indeed to get literature
the presentation we have to do that but
what that means is that the interface
between these two layers may not even
exist but the functions of the standard
specifies may not even be there so here
we've got quick check state machines
that generate these api calls and mock
the appropriate articles but these calls
that they're talking about then hungry
for functions that don't even exist dog
has got off it was a way of composing
quickstep sheet and we can now do that
so we take a specification for this
for that we could plug the together and
then generate tests for the entire
cluster I probably gave a whole talk
just about that that 10 this is a very
important step to be able to carry out
this project and if you've got to
realize of course that the standard
tells you what each of these things
should do it doesn't tell you what the
cluster should do so if we were trying
to buy a quick specification for the
entire cluster will be very hard to
relate standard so it was very important
there to do this okay another challenge
here and it's going to look at the con
services which is one small part of
their apps are code so that comm service
is specified by a standards document
that looks like that it's a hundred
seventy nine pages long and the
frustration you think it's it's not even
complete if you don't have to understand
it have to be this other document the
otech version of the column standard
that's another set of three pages and
intercom is about 500 pages of document
that you have to read to understand what
the common services are supposed to do
so that's a big job and essentially our
projects their machines model airing the
standard set so it's almost as though
we've built an implementation a bizarre
ourselves in airline to use as a test
article for these the vendor
implementations so you might think that
what may be having has been just as much
work as the vendors well no here in Cold
sizes for four hours so the blue is C
code that's the implementation and the
red this ever that's our specification
and you can see that our specifications
are 46 times smaller than the
implementations so air man is more
concise fancy now you know
so another bottle is how do we know that
the power code is right after all and
we're really romantic the stamp it says
we can also make mistakes well what
happens when the test fails is that that
tells us that there's a bug and it might
be the lender ground or it might be in
our specification we only know that
there's a had any consistency between
the two but the good thing is the while
our future model is testing the vendor
code we can use the vendor health to
test our models and indeed if we don't
have been good code for component that
it's very hard to develop correct long
because because you can't test it so we
were able to test both major and final
test our moms by running against the
number of different then recommendations
from that also catches problems so where
does a discrepancy we have to decide
who's right I'll be right or is the
medical drive and having to tell that
well we can read the standard of course
and it doesn't work we ask for reading
the standard yes here's one requires
from canvas where the NN message TX time
out time inspires the command module
shall ultimately call the function n TX
time exception wats ok once once every
Power Lock both having realization of
the module 110 times time expires I that
seems most national since the
requirement engines the time expiring
but it's not that's not the
interpretation that every implemented
Jones and what matt is optionally how
can you fail is required if you don't
call it at all that's ok if you do call
that's ok about the only even test is
that it doesn't get cold twice so you
know these can be a bit problematic is
no one this is one
it's about a calm tipping transmitted
function so here's the root guru turn
back to transmit it basically called
some dentists and it returns either he
okay or not okay it returns II okay if
the sdu has been copied and it returns
II not okay if no sdu has been copied
okay we don't know one man to use but it
doesn't matter it seems pretty big if
you get a okay being copied if you gave
me not okay it has not been copied so
the document contains requires the book
like that emergent explanation of the
leaks and in the explanation that
follows this says this function returns
call e not okay if a stopped IV deal as
a channel has docked channels requested
but even for Scott I believes the modern
copies in the data so quickly so this
says the if the channel is Scott that it
was copy the data and return he not okay
but yield okay means that the day does
not be copied what we do asshole so he's
no chance to be lacked discipline and in
fact that we call the most important bug
we use whichever testing so if we
running tests on a component the test
things then we get the minimal counter
example of a mid-length in the test case
report it to us and other than that
movie makes diagnosing the bug very easy
so once we've done that if we run quick
check again what do you know we're going
to get the same middle favorite test
quick check is going to say it's still
wrong still wrong now what can we do at
this point so the right thing to do of
course is to fix the bug and then that
test Blue Fairy and quick trip
the next bug but fixing bugs and other
people see code it's not what model
appears to do so we could of course
report the bug to the ends of the code
and then several weeks later hopefully
he will get fixed version and we could
then find the second book but we just
care whether we have to be able to find
many bugs in one piece of code so what's
the alternative to fixing the bug of the
code it's unfit see specification and
this is what we've had to do here here's
a couple examples these are above
specifications first was in assent timer
operation so it come bug 14 is present
then it's taking a number of tix
integration and send time to taste those
was the correct thing to do because it's
going to get worse before it's used but
only inclinations set it to take some
tix plus one so if copper 40 was present
than we modeled it even a combo 10-7
model sir incorrect initialization of
data so our cone ends up with lots of
these things in them and we've got a
ahead of our way back 40 comb bucks
macarons to find and all there have to
be morning in specification which means
that we end up with in the specification
when this cluttered by models of all the
bugs that we fact and of course that's
what what ballroom want so we need to
take those out the way and get just the
simple specification of the correct
thing and deliver that to vote enter a
very good so silent talked about this in
the last talked very nice scriptable
refactoring tools red line and we have
used it for this delousing procedure
taking out the box by hand is a lot of
work
very easy to get it wrong and you can't
even test you done right because if you
Roman if you're on the code against the
buggy implementations of course the test
will fail so it's been very very useful
to begin to automate this process and
assignments right just takes all the
bulk modules sets into false and then
simplifies the code it's surprising how
many certifications a leader to produce
nice clean code lists common issues need
to be simplified and then things like
empty lists appear and can be simplified
way so this quite long work goes off
here's somebody so the bubbles appear
this code refers to 27 bucks from the TP
proponent bucks five and six and regular
dress or masculine turns it into this
nice yellow stuff now I know this is
hard to be back but just look at the
size this much data package that's gonna
be good okay so this work is still in
progress but already we're testing code
from six different suppliers we found
more than hundred isms already even
though workers not complete we expect a
couple hundred more to appear the next
couple months and at least 30 rooms have
been problems in standard that God to
the ad hoc consortium and hopefully
we'll need to fix it to this damage and
we're on target to start served by coop
later this year it's very exciting we
notice there is a little bit of a
culture shock I was recently at the
event where Volvo inform their suppliers
how they're going to handle software
bursting processes for the next
generation of models and they explained
the process that they've only use and
they're talking exhale be charging
suppliers 5,000 euros
morning to test it as a test player as
well the other buyer has to give us was
that Bobby six so of course people were
asking us can we get hold of the test
meet in advance and we say no there is
no Testament that's not the answer they
are expecting so we didn't see if it
works certainly well and buying one left
generation of Volvo's it has software
group by quick check is the available
yes it will easily better document at
first but yes I Bannister's far
and so the tests run fast the slowest
parties that when we're testing on them
or the paintings and in order to avoid
having the sea kelp killed quick check
that we won't see coding second load so
we need to ship a call over onto the
know the next into their ownership to
resolve a kick that imposes certain only
that's the biggest cost one of the tests
and it's see so we're not running the
tests on the actual particle beams in
the car and indeed there may be more
warm ups that appear at that point but
thought wouldn't care though I'm quite
happy to find the bugs that are caused
by run on a funny architecture they had
to do that in turn what they don't have
to do is strong with bug shouldn't be
faced the earlier stage so there's no
hardware to turn into and Rick are my
laptop is still fine it's run an
unrelated or crushed but having managed
to crash the software oh yes
and well we could do that but then
they'd have to have the expertise to be
aimed wrong of course but we would like
to do then we buy our licenses but then
we we actually have tried providing the
virtual machines that vents can log into
to test their code but for Madison done
whatever hate then it's not very easy
thing to do so at the moment running the
test is still something that requires
quite a skill instead of changing the
model to put in all the bug statements
couldn't you just make it skip inputs
that simplify to the same value
so I think it's not a reliable way
knowing that we provoke the same bug so
what we could do is we can say well
we'll just exclude this particular test
case we found this one don't show us
that again but what happens if you do
that is a shrinking process will stop
just before getting there so we'll
probably get a test case that is
slightly unnecessarily complicated but
by doing so avoid being the one we've
were in fact but nevertheless represents
it same bug sophie is if we could
identify the particular but we've hit
and then then we could run tests and say
give me a failing test it doesn't
promote that bug that will work fine but
doing something that all these e okay oh
yeah so what we do is we have C part we
actually put the sequel through the
standard CP stuff first of all not like
to dry and parse see before that stuff
then we partially result and we just
extract the names and types of functions
so if you have a stone declaration from
south and header files we can pick those
up and you don't have to happen if you
just have the definition of the function
and pick that up and then we generate a
marshal namaha sri code in both ceiling
and everything and we just compile it
all in the background lately stuff
together start another process which
secret or run and start talking to so
quite a lot hand behind scenes and we
can use anything apart by default means
GCC
it's it's nice because it means that we
can call singing we can call any
function without needing to write and
Marshall comfort all so it's very nice
if what you want to do is to use error
to test see because the math work would
you have to delete it together this
nature yes we've considered that we
haven't started to do it yet maybe we
will one day okay I guess we're all
thirsty</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>