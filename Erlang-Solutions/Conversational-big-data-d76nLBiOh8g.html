<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Conversational big data | Coder Coacher - Coaching Coders</title><meta content="Conversational big data - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Conversational big data</b></h2><h5 class="post__date">2013-03-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/d76nLBiOh8g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I have three talks in 30 minutes it'll
be awesome recently i ported our client
protocol to airline so no no doctor
yesterday have you can go yay oh okay
who here has heard of the four V's from
big data except me no answers hands up
who has okay so two people have lost
their voice everyone else hasn't heard
of it excellent okay so volume velocity
variety and variability our class does
the four basic aspects of big data that
most people care about they're wrong
it's a bad value right there's no point
me sending you data that's already too
late it's already still have already
gone an extra price I already got a
better price for IBM one to happen right
now so any data on the internet in those
buffers causing buffer bloat is stale
it's useless to you it's not tradable
you'll end up losing money on the basis
of it so we excel in solving that one
problem so partial and reactive you
eventual consistency and it's extremely
available right I give you immediately
consistent or at least that's what I try
to do so that's what my company does and
that's when I got to talk about today so
what's a minute on the internet and
Intel did a really good infographic
about it was it was it last year baba
where's Pablo Pablo
last year the year before so you see the
student public an email sent a second
it's probably slightly more maybe
slightly less right now 20 million photo
views on flickr for example these are
fairly big numbers but this is minutes
why people are thinking minutes hours
weeks months I come from a world where I
think in second so the closest analogue
I have to this if you have who remembers
OMG pop came here with draw something
that got required by zynga right they
scale from six to ninety servers in a
matter of about six weeks nine weeks
fairly good scale okay but I deal in
this world here speed so you might have
a 10k document delivered in a
millisecond i believe over i deal with
1k documents delivered in 100
microseconds or less okay so eight
milliseconds to me is an eternity okay
i'm dealing with a different level of
speed if you will okay so the last mile
is hard it's probably the hardest model
piece of data traveled it's the model
for you're on a train you can wonder a
bridge you lose your connection what
happens with the data that's actually
traveling through to you what if you're
trading on a horse race well the food
within the last for a long of that race
so we will you're not going to trade on
that race right not in the dying seconds
so these are the kind of problems that I
tried to solve so if you've got stale
information that's not going to work so
data needs to be recoverable this is all
about delivering data to humans okay we
don't react very fast how when you blink
your eye how long does it take for you
to open your eyes and start seeing
things again any one of the guests sure
it's half a second
you need coffee okay who says 100
milliseconds you're really fast you've
had too much coffee it's about 200
milliseconds okay just to think you are
you are your own your visual system
where your visual system shuts down for
about 200 milliseconds what focus do you
actually have in these slides anyone
everyone sticks their hand out straight
up monster Khmer those of you that have
them fall in the front of hands look at
the end of your thumb and look at the
nail talked about as much that you
haven't focused right now everything
else is a blur it's gradual scale yet
traders with all their six Bloomberg
terminals and their massive monitors
think they have finer superhuman acuity
than anyone else right what do you think
you'll notice in this backdrop of text
is actually changing in front of you
what will you home in up changing
textual values no are you Lotus color
changes you notice changes in shape you
know the structural change is much more
quickly so optimizing trader real estate
is actually quite important you've got
40 milliseconds it takes you to notice
these things so Konami will tell me is
there any point delivering more than one
second / 40 milliseconds worth of data
to anyone ever on aster superhuman and
the traitors of course you might send
them no there's not so why are we
sending them real-time data using
messaging systems and clogging up the
internet we think that's silly we think
that's something that was invented years
ago when there was no internet all right
this develops behind the firewall we're
just using it in front on these global
networks that doesn't make any sense and
even remember Digital Equipment
Corporation message kids
horrible stuff not worth remembering
okay policies are simple in those days
and network was reliable was small it
was monolithic okay latency while zero
it was going from your desk to your desk
didn't have anywhere to go speed of
light was awesome back then between a
and B the topology never change because
you couldn't afford another machine they
were the size of this room true then in
1992 the Internet happened the first SMS
was sent in London everyone go are then
with the days most of us here are old
enough to remember how does God soul
crooner grew then in 2007 the carphone
happened slurping died i'm sorry Jean
Polly so i think is gone now we're
touching the internet we want to get our
hands on the internet the internet was
awesome in 2007
so we talked everything and beast Gawker
the inside the internet the cloud
happened okay so we could touch all of
the things I know everything within the
cloud brilliant I'm approve the crew
like all the good things do so we scaled
all the things think like we I came
about it about 2008 you started about
get fairly early on them right so react
was fairly fairly quick on to a good
thing here okay oh but bad things
happening for human this is God for
systems who here does not use Twitter
put your hands up liar liar liar ok
Twitter we've never been on Twitter
right under your tweeting away well you
should be working you're avoiding work
as usual okay you there she'll be
compiling something or testing something
who cares right twitter is more
important retweet something you think
it's really cool and then twitter says
oh you've already sent that you know
what happened i just pretty sure just
sent at once so what do you do you try
to send it again right to folks without
every single time yeah
so you click on tweets and the same
message is there you try to send it
again what happens whoa you've already
sent that may be true the second time
but the first time with annoying one I
know you got it but the second time that
you reminded me that immediate
inconsistency is a big problem Twitter
the bird immediately inconsistent but
eventually consistent maybe we're not
sure all right but we annoying if you're
a human it's okay if your system you can
be eventually consistent you can mark
that up later I'm not built like that
okay I want immediate consistency I
wanted to always be current because the
real well for us is well the network is
not reliable right you go wonder a
bridge goodbye network start simple and
this is not infinite notice it's fair if
you're on the o2 network versus telecom
here it'll give you a different grade of
service well not here it'll give you no
service whatsoever okay
so what do we do about this well we look
at the business values and trust around
this to solve the problem in other words
you major everything ok so we look for
the nuances and trade-offs oh fun of you
have been to a lot of bass show talks
they talk very well about nuance and
trade off and database systems so I'm
going to do the same for messaging or
should I say for not messaging over the
Internet ok and I think these things to
either relevant right gambling price of
trading prices on you relevant right now
as soon as another price comes in at the
relevant it's old it's dead it's dead
it's gone okay responsiveness using HTTP
arrest all right now Paul sequence and
dad's gone already late ok we waiting
for a response there's other data
backing up I could be requesting okay so
that the duxelles work so have to be
streaming sv asynchronous timeless well
that depends if you're assessing you
have all the time in the world but the
system that I build even for humans are
mission critical in terms of you don't
want to wait you want to gamble on that
price right now and it's the same in a
lot of the real-time kind of
machine-to-machine systems the algo
trading engines are built right it's all
about currents delivery of data right
now and has to be consistent ok and then
context if I have hundred thousand
messages and you're on the 3g network
why should I send you one hundred
thousand messages per second right if
you're on a 3g network you can't receive
a hundred thousand messages per second
that's impossible our solution doesn't
send you a hundred thousand message
messages per second it doesn't even try
that's intelligent
okay how do we do this if you take
messaging you've got producers and
you've got consumers so you got Q's on
each side in the regular messaging
system but why don't we take the q on
the client side and we move it over to
the server all right so we host the
client side q on the server side what
does that mean well what's the bad thing
what's the downside first well don't
know damn q on the client side right so
it makes guaranteed delivery more
difficult right right but I've now got
telemetry on the server side if I can't
send a particular client data fast
enough you backs up and I can do
something about it I can start from
fighting because I can see it's backing
up I'm not for some reason I'm not
getting the data add to that client or
that set of lights I have a chance to
actually do something useful about but
ok so prob if we are data caching inside
a messaging technology so you've gotten
say a topic based hierarchy yeah what if
I start cashing data is I thought well
then you one hop closer to the date and
surely in a distributed network those
systems are the good thing today ok you
one hop closer closer to what we hope is
consistent data next exploit the data
structures so don't send opaque data
types around the place instead take a
snapshot of the data structure and send
up so if I have a list and you connect
and you subscribe to my topic or send
you the list but if I other thing your
remover thing for the list I won't send
you a new list it's not immutable right
everything goes oh immutable as
brilliant it makes life easy not if
you're a wire it makes it bloating okay
so you send what observe it and what was
removed from the list and you can merge
that they're on the other side so you
can reflect these data changes over time
through the system okay make sense
nothing shocking here
shocking comes later so that's good oh
ok behaviors so although our server is
implemented in Java this is kind of rare
lang style so you can deploy a behavior
piece of code inside our messaging
system to change the way the messaging
system works so I was receiving a bunch
of log files say from from lager from
Burma react system I was pushing them in
in some way using our client protocol I
could push them in and this this kind of
what we call a publisher can take that
data maybe filter it using a complex
event processing algorithm and then send
the results that further downstream in
other words we can reduce that to a flow
of information you might actually be
interested in in most high frequency
systems you don't care that things are
within trend right there within certain
threshold or norms you only care about
the things that go out of trend okay and
that seriously reduces the amount of
data you're sending around the system I
go trick ever just about to build their
first real time system the things that
are going within perfect tolerances
ignore us you don't care when it doesn't
and then you care okay structural
conflation structural conflation is
where between the Q star hitting the
topics and each individual client cube
because we have client affinity we can
do something structural with the data so
in most messaging system difficult
plates it replaces an old value at a
newer value let's say the operation
semantically you were doing in a system
was adding things who counter or doing
profit and loss I can take a piece of
data that's about the hit the Q and a
piece of data indicate and I can add
them or subtract them I can structurally
can fade the information if it's an app
or a list I can merge them in some way
all right I mother but a data item comes
in before I get a chance to send at the
end a wire I'll merge that too in fact
I'll do that so aggressively I can save
a lot of bandwidth the slower you are
the more I work for you in sending you
current information it's never sale okay
so that's what I do for a living but i'm
interested in cep and this algorithm is
a very cph like algorithm okay so you
can see where i have an operation of
five value say in the queue and emerging
order of summation then if these two are
destined for the same topic i can
complete that into warren update but i
just add the numbers on the server side
and send you the result course could
have been 10 or 15 or 100 updates I said
only send you one result we're still
consistent with the intent for that
particular topic now have to be a topic
that can take that for example if I have
a topic that needs to be distributed
forensically where you need auditability
I can't do that right the data is wrong
right the business value isn't in the
data does that make sense if I need all
the controller or storage i need to find
forensic record of everything i can't
convey the information I have to send
you everything they are surprisingly few
of those use cases most use cases you
can actually complained heavily the
information that's going over the water
and now works in airline so this is a
client ton pretty much currently looks
like this it's an alpha ping me if
you're interested and it were to larger
as well so I can as I mentioned earlier
just have a little larger back end here
that will take my message and send it
off to my in memory system survive a big
react cluster I can send in say faith
and information or errors and pop it is
my messaging system do some further
analytics and then pop the results that
onto a real-time dashboard all right so
how did is logging I can both pull stop
in okay first talked on second talk
oh that was the easy talk they get
harder okay so okay so let's measure
this okay that's great but let's measure
the value of this warning okay
performance is not a number a lot of
people command the same performance is a
number like that a thousand bytes
wheeler our performance would be like
this or like that I'll give you a range
of numbers so you can see a
characteristic profile of performance
rather than a single monolithic number i
picked because it works ideally with
what i'm showing you i'm going to show
you a range and it's just through
brother Nathan see benchmarks between
two boxes okay it's a very simple
through pop case so we're sending we're
adding 750 clients on a I think it's
three or five second interval until the
hit saturation on the network such as 10
key cards between these machines and
then we look up what happens after
saturation because something's gotta
break right most people test up to our
near saturation we take the arm
saturation we're more interested in it's
going to fail where you will it fail and
why it's much more interesting okay so
let's have a look I we do have a very
simple latency test single client send
the message get a response / do there's
your single haha okay so it's kind of
looks a little bit like this so we've
got from 125 bites on the small side to
two thousand bytes you can see for two
thousand by messages it saturates pretty
quickly into the test so in about 40
seconds into the test for 125 point in
255 messages after five minutes it's
fine hasn't saturated yet okay makes
sense this is the server side view
here's a client side view so this is
what the client sourcing for this as
we're ramping in so from the hit
saturation here you can see for this
large methods I because two thousand
bytes this very strange waveform so
what's happening okay I've been ramping
clients continuously another 750 stream
data another 750 stream data until I hit
saturation I'm still choking clients up
a problem so what do you think happens I
stopped serving the newer clients that
are coming in they tie met and they drop
away what happens when they drop away
I've now got more space on the server
from what clients so they start joining
again now it goes back up and it tends
to take a while before settles binary to
steady state but it's still obviously
not very happy right you can see you're
getting quite a lot of volatility in the
message is receiving on the client site
this is the client side view okay so
here's our whisk inflation okay so you
can see a slightly takes time you longer
to saturate in this case but the
interesting view is on right the client
side you see them you see it stabilizes
very quickly into a stable state in
other words the server notices and it
starts complaining the data massively
because the queues are backing up
conflation kicks in right so when you're
not saturated to send you data as far as
the camp here's here's more up-to-date
data here's more up-to-date data as soon
as the saturated goes all hang on a
minute this isn't caught so it starts to
throttle down terms of how many pieces
of data it's delivering to individual
clients so that everyone gets a fair
service so you go from 100 to 80
messages per second but you're serving
45,000 clients it's not bad okay all
right so that's how to look at maybe see
okay where'd the latency policies nice
tight into the left the log-log graph
tighten to the left is God outlier not
good just two thousand bytes sorry for
the different color well interesting
started to skip these is this range so
for a single hot latency is a micro
seconds bed as good as we can do to 50
microseconds at the hub for the higher
message sizes quite a high degree of
variance a lot of that is garbage
collector inside the kind of the server
side the faster you can get in Java
today what a simple producer-consumer
kind of ping pong test is a bed with
five microseconds right fast that you
can do the bio / commodity hardware is
2.4 microseconds if you can do it faster
than that let me know
eh I won't believe you bill want to see
it but that's the fastest i've seen with
commodity harbor okay this commodity
tenge cards it is capable in see your
assembly to get between two boxes in 2.4
microseconds yeah without breaking much
of a sweat okay into the third chalk
you'll notice that I talked a lot about
processing events what's the important
thing in delivering consistent
information currently to the other side
deciding what what the sand or deciding
what not to send it society about the
draw it society what is not important so
that you can put all of your resources
and energy into what matters and that's
very use case specific now something you
can build on a framework an prepackaged
and go it's here the solution wrong I do
need to pick for every single individual
business case and pick something that
makes sense for that case if I have beta
that requires forensic storage I can't
drop that data I can't conflate it I
need individual transactions to record
okay well if it's recoverable data like
prices if I drop the connection and I
connect on the other side of the bridge
I'll just get more prices its
recoverable so that's a sacrificial data
I don't care about that there's more of
that out of it the order and trades that
the bets on the way back I don't want to
lose any of them because those bets and
orders won't happen again and I won't
have a platform that's very successful
and I'll go out of business that's
probably bad the business value of
technologies how we all get paid and
some of the techniques without come with
event processing but that's kind of what
I've been doing for the past 10 years so
CP basically preferred it kind of
loosely with storm Andrea pipes its
input streams and output streams in in
my world view there's math operations
not to be confused with math in a
functional language like erlang but Matt
takes in some record you apply some
transformation to now drew friends a
result 141 through a map you've got
windowed operations these are the most
interesting so I've just implemented
these in our line so I'll show you that
now you can punch things combine things
and you can store stuff in memory where
like the language so we've got Jen
server
solve this problem we can branch and
combine by writing code so that's not a
big problem either and well Mac another
kind of transformation operation we got
an entire language data but there's no
real good support for win doing in most
languages so I decides to add that this
is the hard bit by the way brace
yourselves ok this is an aggregate
function so Francesco and historic
earlier mentioned behaviors this uses a
custom behavior so you're not limited to
the one that set inside ODP you can
generate your own for whatever you want
to do so I have one for something called
an aggregate function and it takes as an
initialization function with no
arguments and accumulate method the two
arguments a compensate method which
we'll get into in a minute it was two
arguments and animation method so when a
window closes amid the value right the
window is just a subset of streaming
data that's in Mary at a given point in
time oh I'd implement it like this that
this is a max all right so getting the
max of two values I've got the value in
the window and the value coming in I
just compare and if it's a bigger value
then I saw it if it's not I drop it ok
so I store over time over the period of
this window but the maximum size value i
saw screaming through the winter can be
any arbitrary type this one works with
or assumes numbers ok so that's how you
implemented and i apply this function
that i can write once and reuse and that
function could be standard deviation
came with a standard deviation or
something the variance I write that
function once when I never write it
again I just pointed at a window and the
window pops that value so the different
window type to have plus the different
functions i can plug in gave me a
compositional value that's greater than
the individual parts so in a tumbling
window of size 4 i will receive four
events calculate an average or a
standard deviation of pop at a single
result make sense pretty simple it's not
overlapping you got a discrete set of
four events the discrete set of four
events separated over time
simple so it might look like this if you
were to do it up inside the wrapper
sliding windows slightly more
complicated in a sliding window say for
four events I received the first four
events and on the fourth event i will
send you a result average standard
deviation whatever on the fifth event
this is where it gets hard by the way on
the fifth event through and the past the
n minus 13 events because we have a size
of four I will give you the standard
deviation or average for the last four
events from the current event was just
going out but there's an event coming in
which will be in the next result set
goddess make sense so once the fourth
event comes in on an event by event
basis thereafter I'm sending you a
results at the space on the last four
events the story from that event in time
goddess picked yourself on the road
inside the car makes perfect sense yes
later life so over time we have four or
five events but a mold is camping back
through time right so in other words I'm
propagating the current value into the
last stored partial results so that I
can give you some derivative results at
the end of the window but every time we
receive an event once you get to the
size you're always producing a set of
results in other words over time you
have a set of event and across the size
of windows you have open you've got a
set of events so it's n times n minus 1
is exponentially degrading how do we fix
that problem well you'll notice i had a
compensate method ok so welcome back
propagating those result sets i can
compensate by going autumn and I'm about
to throw out the window and what would I
do i added a thing why don't we just
remove its effect rather than back
propagating a new set of results make
sense now it's linear in performance i
was shocked when i discovered that i was
literally in bed asleep I woke up I said
the can't be that simple I ran
downstairs it
was that simple i was shocked right
mostly this is the compensate function
right so if you go back to the aggregate
right its exponential degrading utilize
the effects of a time but appetite
frequency you're getting this set of
events continuously so you have the
continuous head of events which is one
by mention and then you have the back
propagation across the set of events
which for the number of open windows its
exponential degrading well imagine
you're running an exponentially
degrading function inside the window
what my calculation is a Fourier
transform uh oh I've now gotten now I'm
an exponential degrading by algorithm
and running an exponential degrading
algorithm it's totally exponential
degrading I think the technical word for
that computer scientist your poker as n
increases ok it's true it's the
technical term look it up I'm not lying
ok so we can back propagate set of
results or are the function to
compensate so as a value our result gets
evicted for a window that's no longer
relevant we kind of subtract we rub away
its effect on the windows that are open
make sense so I have a simple
computation as a cost rather than back
propagating a suicidal results back
gives you then your performance ok kind
of looks like this periodic windows so
every second emit a result set quite
simple and monotonic windows in a
monotonic window you have
Oh like periodic window accepts ntp
doesn't bug either your notion of time
so if you had a vector calc you could
plug it inside here so when a certain
number of vector talks quantum's have
passed you can do a thing whatever that
thing happens to be you can plug in your
own clock implementations that are
there's a behavior for that okay kinda
looks like this it's really really
simple okay so I told us eat right I've
got another project this is a no dot yes
I got another project I call being 8
themes there are angry terms the node
crew didn't notice but EEP is now
available in ER line and also ian barber
who hangs around the PHP airline
communities wrote one in PHP so now it's
available in JavaScript PHP and inner
line I stuck that on github last night
so it's available there enjoy it that's
why talk or my three talks are there any
questions
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>