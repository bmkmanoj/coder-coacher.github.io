<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Instrumenting the World with the BEAM  - Christopher Cote | Coder Coacher - Coaching Coders</title><meta content="Instrumenting the World with the BEAM  - Christopher Cote - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Instrumenting the World with the BEAM  - Christopher Cote</b></h2><h5 class="post__date">2017-03-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oTAgcR-rMMc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah entering the world with the beam
so we're on rosetta home to plano so
that is the name of the project
detection organization and github as
well yeah and you may have noticed that
a little short ish URL for google up
there kind of makes you can use a couple
times before sometimes i get feedbacks
and something don't but rather than you
know holding your questions at the end
of may be forgetting you can just ask
them as we go I get a little display up
here of the questions that are popping
up at the end I can actually show them
up on the screen so they're in the video
it works really well if you guys want to
participate so good way to do it will do
you know if you want to ask a question
allows will do that as well at the end
so if we have time so yeah again pretty
good background on GRT labs here's the
github our blogs gog labs org nar we've
got our own top-level domain now that
realtor I don't want to get into that
but that's you know the realtor site our
twitter handle CRT labs and my twitter
handle entropy lab so if you'll feel to
check that stuff out the github is
pretty updated i haven't done much
documentation in the code unfortunately
but there's all sort of stuff on getting
this stuff up and running I've actually
got a firmware image in just download so
feel free to check that stuff out as
well so what is what is instrumenting
the 10 no clothes oh maybe I should turn
it on at night
refresh no that's fine um I would like
that to work usually you know what let
me refresh this oh I don't have internet
fantastic let's try connecting to a
hidden network linux in Wi-Fi right
every time happen oh come on of course
oh man
what did I connect to is it just eater
net live do we know
oh my gosh I lost control of my slides
as well yeah okay let me do URL in a way
okay so maybe it's coming through okay
where's my mouth over here let me start
presenting again
had it all set up ready to give up full
screen continue recent
okay can we try that URL it's probably
different URL now no no that's close Oh
hold on hold on ok Google ok URLs up
there should be good I guess you want to
slide for me to talk about him Rin ok
hey thanks man No ok so what does
instrumenting the beam meat or inserting
the world with beamed mean right so
we're really interested in me personally
as well in the built environment right
so buildings like this your home
commercial buildings hotels whatever
they are and looking at what makes a
healthful building now that means the
health of the air but also how efficient
is that building how you know is it
healthy in the sense that its systems
work well right so to do that we're
looking at hyperlocal whether we
actually install weather stations on the
building energy usage so we've talked to
smart meters you can put stuff directly
into the electrical panels to get
real-time information on the energy
usage hvac utilization there's a few
thermostats that we can talk to some our
cloud-based I'm actually have a local
API over the local land so we could talk
two thermostats to get the hvac
utilization indoor environmental quality
actually built our own sensors which can
see here this has about 16 different
sensors on it this whole breakdown over
here but we're building these two are
monitoring indoor environmental quality
part of its kind of started as an
automation a home automation system so
we actually have to support for media
devices like chromecast and some Wi-Fi
enabled light bulbs specifically lifx
basically all of these I've written
drivers for and they're all open source
as well so even if you don't we use this
overall project feel free to check out
the core libraries for life x or zigbee
smart energy in your environment
equality you'll have to get a toaster
oven and pick and place your own boards
to do that that's what we do in the lab
right now it's actually a toaster oven
mation stuff oh yeah so people were to
check that stuff out but that's that's
what we're looking at we're looking at
the health of the building instrumenting
the world the built worlds specifically
but we also we can also do outdoor I'll
do environmental quality as well the end
goal of this is homeostatic buildings
right buildings that achieve a balance a
healthful balance there's a couple
standards out there in Germany there's
one called passive house which is really
really impressive and they're looking at
using as little technology as possible
actually in built a building with the
built environment using passive solar
and different things like that really
cool and and lead here in the states
which is ok but it's you know it is kind
of a standard around here these are
great when you're building new right but
99% of the buildings and 99 then
interests in the buildings that realtors
are transacting with our existing homes
or existing buildings right so we got to
do something about that really great guy
melkam well as he passed away about two
years ago unfortunately had this big
movement on earth homes and Earth's
cities right and building infrastructure
to work with the built environment this
this kind of building here in the
background is actually one of his
drawings I think that I think personally
think that absolutely gorgeous would
love to build one one day one of the one
of the newer ones in the Netherlands is
called the edge and this is a deloitte
consulting their building i forget the
architecture firm but this is kind of
the cutting edge of smart buildings
right monitoring everything in real time
and adapting very very tech-heavy right
kind of the absolute optimum of
something like passive house but
achieving achieving similar results I'm
not gonna mention so these are all great
when you're building new but 99 cent of
homes and buildings are existing so what
do we you know what we're going to do
and you know question I get all the time
seriously Realtors or what are you doing
in IOT and elixir and embedded devices
and it's kind of an interesting story
right we're we're for nonprofits or
trade organization one
point two million members so actually
the largest trade association in the
u.s. nonprofit we see anywhere from 80
to 90 percent of all tritton so there's
real estate agents and there's Realtors
right I want to say it's 70 maybe even
higher seventy percent of real estate
agents are wheelchairs so they pay dues
apply to their local Association and up
to the National Association we see you
know we do commercial and residential
you know the way I fell to the realtors
as well is a healthy building is back on
the market and sell faster right so if
you imagine the housing stock as as our
inventory the faster they can move a
home the more money they make and
they're generally concerned about that
Commission right so if we can ensure and
have data on the health of that building
we can get it to move faster if we know
the energy usage that stuff it helps
them one of my goals is to make the
built environment better right so if we
can if we can create a massive data set
of real data on how these homes perform
right drywall verse calm in the
southwest or the northwest and look at
all these different building materials
you know what a home is built with we
can start doing some pretty interesting
machine learning on that but maybe even
license that data right so we got to get
that nandu to non-jews revenue sometimes
so there's there's some different assets
they're meaningful change in in home
health long-term right so it you know
this is it's not going to be quick to do
this but we want to improve quality of
life for for these people and rosetta
home itself is a research platform so
it's not just a project it's actually
more of a platform we're working we got
some projects is it just want energy got
some projects may want the whole the
whole shebang and so we built this to be
easy to configure and quickly deploy new
projects for different different
initiatives and like I said got to get
that non-jews revenue sometimes so but
that's that's how we are funded is
through the dues of our members and then
see our key and see Archie labs get a
budget out of that this is our cool
little lab here
very small 612 square feet five of us in
there sometimes six or seven or eight
and we'll telepresence robot over there
you know we're not just working on this
we're actually looking at the future of
real estate right so we've got
blockchain projects we've got this we do
a lot of education for our membership on
what smart home mean how do you how do
you transfer the ownership of you know a
nest thermostat so that the previous
owner doesn't have control of that we've
got some fun little quotes signs he
quotes on the side there on our door you
can't really see is a pretty great quote
and this is the national association of
realtors uh oh geez / going to work I
forget but it's the beginning of their
of what what they live by right machine
statement essentially right so I've tena
I want to read this under all of the
land upon its wide utilization and
widely allocated or ownership dependent
survival and growth a free institution
and of our civilization realtor should
recognize that the interests of the
nation and its citizens require the
highest and best use of the land and the
widest distribution of land ownership
they require the creation of adequate
housing the building and functioning
cities the development of productive
industries and farms and the
preservation of a healthful environment
honestly you know when Realtors can
reached out to me of this position it's
really up in the air until I read this
and then once I read this and so this is
kind of what you know the really good
Realtors this is what drives them right
and they and they really understand it
there's other ones that are out there
just as you know make a buck and make a
commission but this this really drove
home for me especially that last part
and it really drives what this research
platform is all about a little bit of
backstory on we're going home to point
oh right so we head Rosetta from one
point oh and actually if any of you were
here last year my boss actually
presented on that this was a
python-based system all in the cloud
we'd actually like ping into api's and
clouds and some local devices through
router back doors and stuff like that to
kind of collect all this information
cool system this is a fun little
visualization of our am to pee buckets
and
up and on the far left of the home the
different types of the devices all the
values they create and then the
different different ways to connect that
stuff what we started doing we started
looking at the market around indoor
environmental quality right now there's
quite a few devices out there consumer
consumer grade devices that you can get
for about two two hundred fifty dollars
right and you get one we want to be able
to instrument a whole home for about
that same price 200 250 dollars which is
where this guy came in so we've been
developing our little bored here the
issue with that is you know we're not
we're not putting Wi-Fi on out that's
not going to correct to connect directly
to the internet so we need we need a
gateway of some sort right and so this
is that's kind of how the idea of taking
was out of home1 plano and making
embedded gateways to kind of push this
data up to the cloud got started my own
personal thing i wanted i actually
didn't want to connect to the internet i
won't be able have this information but
i want to have automation that did not
rely on the internet no cloud no
security you know make that attack
vector as small as possible you have to
have physical access to the network to
control my lights or my heater or
anything like that so a land-based
automation system not cloud nothing like
that and it's still right now we do push
that up just for research and analytics
but it does totally work without
internet and I'll show you a little demo
of that zero configuration I want to
plot this device in set up the internet
and then have it discover everything and
we do that the weather stations all that
stuff zero configuration you can you can
control your thermostat and configure
that but that's just a little slider
rights really simple and wine elixir
nurbs so he mentioned you know I came to
the conference last year I knew about
her laying I was pretty excited about it
but never really had Tove into it came
to the conference last year fell in love
with you guys really the community was
amazing so many great talks and I was
talking to somebody in the lunch line
and like and we started talking about
making this embedded gateway this is a
country check out nerves and I was like
no okay and then I don't know who that
was it was just some random person went
home checked out nerves and that's why
holy shit okay do this but it's
extremely efficient as well right i'm
using about five spent cpu 10% of memory
and raspberry pi raspberry pi is pretty
powerful little guy so it's a great
platform lecture nerves perfect for this
so we you know we've got all these
different subsystems you know we talk
about weather stations all this
different stuff so these are all the
protocols we currently support within
within the rosetta platform so through
some different dangles like USB sticks
we've got three 915 megahertz frequency
shift keying so that's actually what
this guy communicates so over the
weather stations also use that same
frequency zigbee FP so ziggy have a
couple different profiles smart home is
one and our energy is another so we're
using the smart energy to talk to smart
meters I know California it's pretty
much completely deployed
illinois-chicago is totally deployed but
not just electric meters we talk to gas
meters and water meters as well if
they're if they support the zigbee Smart
Energy protocol mdns for local device
discovery on your local network ssdp for
similar but less fun experience uart so
you know just kind of cereal over the
USB interface there and then currently
one custom much which is life x which is
a binary UDP protocol for Wi-Fi light
bulbs actually extremely efficient
little buggy but we've got the the core
library for that that's open source as
well if you want to have some fun with
lights that's a cool one so rosetta home
what is it well it's built on the
shoulders of giants right I mean there's
no way any of this would be possible
without the work of probably millions of
man hours before me if we look very down
at the bottom we got a linux kernel
right on top of that well busybox kind
of creates that with the help of build
route we got nerves which is you know
kind of handling all this elixir sits
there and we've got these elixir library
so busy after busy box everything up is
elixir
were in we're in the beam at this point
so we've got nerves network interface
wpa supplicant which is actually to call
out to the WPA is it a port as a few
things for that yeah to talk to wpa on
the linux linux world interim Wi-Fi
which is wrapping that up and nerves
uart there's probably a few other
libraries that I'm using that I totally
missed here so this is pretty high level
so that's nerves right s'okay cicada is
what's making all this very easy so
risotto homes essentially just a
configuration but Rosetta estacada sits
on top of nerve and kind of abstracts us
even a little bit more so we get a
network manager and I'll go through the
details of kind of each of these areas
as well device manager distribution
manager system monitor an event manager
layer which is how our API is and we
actually have voice control as well
totally local boys control no clouds
required is on hold right now I have it
working but it's not part of my initial
or my current implementation so I've
taken it out to web sockets rest and
then like I said Rosetta home is is kind
of that the customized version of that
so poor deployment you know we can tell
what plugins to use right do we want
light bulbs or you just want energy we
want weather stations or you know
whatever that is we get a cloud
interface and again how the interface
could be different for deployment right
we might have a different cloud we might
be talking to somebody else's servers
and the UI might be totally different
depending on what kind of view they want
from that local the local land so very
high level and Justin thank you so much
for all your concerns making up as well
as possible and all the Linux people in
the world so in dorm i'm scrolling co2
so this this little bored you will not
believe it has all of these sensors co2
temperature humidity vot actually okay I
like PM 2.5 is a separate module that
uses the same radio frequency so it's
actually a separate separate thing
requires quite a bit more power it's big
not everybody needs to p.m. 20 put PM
2.5 that's particular matter that's bear
smalls it could actually get into your
bloodstream but also very very bad for
asthmatics and different people UV UV /
Lux to like level sound levels NO NO to
which isn't listed here a few in a few
other ones so it's pretty impressive
little bored we got a architectural
engineering student who is his PhD is
about Emma doing suing his
instrumentation so he's been driving the
work on this this little guy like that
it's FSK 915 megahertz or 433 the
interface so that talks to the radio
gateway right so we gotta get a little
gateway here that is the receiver of
this kind of does it says 128-bit
encryption pki so somewhat secure not
that great but it's you can't control
anything it's just sending temperature
data right so we're not too worried
about it but we protected as much as the
radio system allows ask you ever you are
and this is pinging the gateway every
six seconds so we'll see this little
green light light uh it go so that means
it's sending data right and then I show
there's a little LED on the radio boys
it means it receive the data that's
that's our indoor environmental quality
country a hyperlocal whether I was going
to bring a whole kit and I decided
that's just a lot of work and a extra
cost and baggage and all this different
stuff and my stomach slice was good
enough you know so so reason ambient
weather sensor array it's ambient
weather here in the state it's actually
made by chemical fine offset so you can
buy these are hundred dollars ninety
nine dollars on Amazon actually we get
rainfall wind speed wind gust wind
direction solar radiation UV temperature
humidity and pressure and then actually
the me do stick which again this is 950
megahertz this is an expensive little
guy since he's reversed engineered the
protocol it's not an open protocol he's
reverse engineered it this has pressure
and indoor temperature on it as well and
that's again just gonna plug in to our
thing here oh I guess I didn't know I
haven't haven't posted it okay everybody
and so this pings up every 16 seconds
with what
so we've got pretty good resolution on
weather data again that's ft / you are
it's doing similar things such eclipsing
the key he somehow figured out what the
encryption key is through I don't know
what method but i'm not a radio engineer
or very good at reverse engineering that
stuff but he did and it's awesome but
kind of expensive so we're we're
actually tied to reverse the engineer
his so that we can because the radio
board is like seven dollars right so
like if we could we could just figure on
this protocol we could have these boards
extremely cheap and maybe even use the
same gateway and headed just hop between
the two but as we as we you know deploy
like 50 of these sensors which we have
put a few in the lab you start looking
to drop packets and stuff like that so I
applied you two boards energy usage so
this is a zigbee smart energy we're
using a system call from rainforest
automation this is the Raven USB stick
this is only available to commercial
customers but it's the exact same
chipset as a consumer market one which
is called the Eagle gateway and it
operates more as a home automation
system but then has a zigbee chipset to
talk to also the guys they implement
both profiles to implement smart energy
and smart home so they can talk to light
bulbs and stuff like that too this is
xml / you are not fun but and this pings
us with data from our smart meter every
8 seconds fuel alternatives this right
if you don't have a smart meter we can
actually install something like murio
here directly into your electrical panel
this is got a little local API this
update every millisecond so to be up to
us house we want to pull that end point
so I'm going to spit out the data but we
can go pull that end point on that
little little computer there and its
really really accurate data hvac
utilization so currently the one that
the only one I found it offers a local
or cassette one of the cloud free
internet no internet required system the
only one service that right now that
offers a local API is radio thermostat
now the API is offered on a new snap
device which is a kind of industrial
standard for networking connectivity it
might even be more than just networking
connectivity so they've got a nice
little API
this is a variant of ssdp from a company
called Marvel very very similar just
kind of slightly different header names
and no idea why they did that but and
this we have to pull every 10 seconds to
get well we we pull every 10 seconds we
provide you it less this gives us the
status right what it thinks the
temperature is when it's set points are
is the fan on you know what it currents
what's current status is and then
obviously you know you've got your nest
you you could be Honeywell Emerson none
of these offer local control you all
have to go to the cloud and do again
that zero configuration you'd have 20
off to their servers and it would have
to be the account owner and you know
it's just kind of a pain me at so we're
keeping it simple that's that's the goal
lighting so again it started as kind
maybe a home automation system that
quickly kind of fold it into those just
make it's a research platform because
home automation is hard handling all
these different devices is tricky so we
still like the idea of lights but more
just indicators right especially these
Wi-Fi lights like if you if you plug in
a light to up there people have been so
trained to scoop up a light switch right
well that kills the Wi-Fi that you don't
have control of your of your light bulb
anymore it's like well that's fucking
stupid why so I'm not a huge fan of
connected light bulbs and that's for
that reason but I think like in a lamp
or an especially in the right spot it x
is a really good indicator of but if you
want to know about air quality right you
can indicate that through brightness
color or different things energy usage
you can do a lot of different things
with that so it's it's valuable but not
I don't the way they sell them i think
it's probably i don't really like it
obviously alternative few something like
that that's big be again you can do
local control but configurations tricky
you gotta go like trick the board and do
all these different things media players
we can support media players again it's
kind of started as a as the home
automation platform but i wrote a really
great chromecast library so if you would
want to control your chromecast from
elixir you can do it so chromecast this
is mdns this is proto buffers over an
ssl connection and the pings vary
depending on you know can I backed off
when it has
active for very long but you do get the
the background images so you can you
know pull it off with you what's playing
or how long you've been playing
different stuff obviously there's
alternatives Apple TV Roku just a upnp
player something like that that would be
you could actually control over the
local network as well so what what makes
it's a platform and not just like a fun
little toy project right well it's gone
I've gone through and really tried to
you know abstract everything out into
what you know what a home might have or
even a commercial building right so we
created these device classes they're
implemented as behaviors that's probably
pretty small upload the code we have
time to go through we have a different
types of device classes right and they
all implement a behavior and different
call back so if you're going to
implement something like a media player
we need two little play needle pause
letta know the current time right so
there's there's just a certain number of
functions that you must implement so
we've got IAQ in our my mental quality
media player hvac light camera smart
meter and a weather station so that yeah
that's just some of the code those are
the bank those are the actual behaviors
there they all derive from a d'accord
device and then on top of that which has
some symptoms limitation things there if
you if you ever implemented bite you'd
never have to deal with the actual
low-level device stuff so I wasn't
really where this you know I'm pretty
new to elixir but I didn't know you
couldn't pattern matching function heads
on map until recently I use that
everywhere it is amazing so what we're
doing here is the device manner so a
device state right is represented with
this little structure or math I guess
it's the way the way elixir does the the
module with the depth struct is coming
interesting but um it's efficient you
can see we derive from the poison
encoder we noticed a few issues with
JSON encodings when we were sending over
the WebSocket once we got enough people
connected to the local interface and
send in a lot of messages it was
lo so using this derive I'm guessing
it's some kind of compiler efficiency
that here that helps it helps it compile
or serialize the JSON is its kind of
coming out of the stream so you get the
module actually module is it really used
anymore so that's kind of a stand over
for say over from older stuff but you
know the type right that's the device
class the device kid so usually what
we're going to have is you know get your
core library your life sex library or
whatever it is that's running it's fine
to get get the device there's all that
stuff you get into Bend into cicada and
you're going to generate your interface
pit which is the one that implement the
actual callbacks for the device class so
in there is the device kid which is the
original you know whatever library using
is the pit of that original device and
we've got the pit of the interface which
is the one that our cicada system knows
how to work with write the name right so
whatever name you've given that device
or the system has given that device and
the device class States or the specific
state of that device which is coming
from lifx your chromecast or the weather
station library so here's here's a
couple of it ones for your different
implementations of the device class
state again really small and sorry about
that I've got a smart meter which is
going to have your connection status the
channel that it's connected on for the
ZigBee protocol the math idea of the
meter signal strength the type of its
gas electric water the current price of
whatever you're moving and here it's
called kilowatt and kilowatt deliver to
receive that should just be delivered
received and current because if it's not
an electric meter obviously kilowatts
don't make sense so that's going to
change weather station similar thing
we've got you know the state that you
that you want and so the idea that these
is as you're implementing a device
you're going to these are the states
that cicada recognizes right so if
you're going to implement a weather
station doesn't matter what weather
station is it doesn't matter what the
core library represents the state as as
long as you're able you there's a
message it's called update state that
passes whatever state was given to you
by that device you just need to
manipulate that state to return this as
long as you do that everything works
your front-end will work
control it we we can log it we can send
it to the cloud and everything's
fantastic there's an HVAC one there so
yeah so device implementation so first
you know figure out what kind of device
clap you want actually implementing new
device classes as simple as just saying
this is the behavior right and defining
what kind of state you want it to look
like and then giving it some callback
functions for whatever it is so adding
new device classes is really easy do you
want it to store its data it creates
histogram to give you a nice little
short history within put on the local
device so you just have to decide that
that's just using a use command and
elixir 22 not inherit but you know to
get on that that functionality and then
the callbacks right so whatever the
device type is we you're going to choose
the behavior type if you're going to use
that as your behavior and then you just
have to go through an implement your
your call backs but also you know how do
you where do you find this device where
you know once we get on the network what
you do is you there's a discovery
mechanism mechanism right now right now
these are the supported one semi NFS
ssdp you are custom me you know litex is
a custom one you know maybe a loss could
be one right where you're going out
you're going 200 off to a server that
could be a discovery method as well
that's not implemented because I want to
keep it local and simple but that's the
idea if you're going to implement the
discovery method for that device as well
this is why facts so it's a lot of code
again this is PI small pulled up on the
editor actually we just do that now yeah
so this is like sex here hope you don't
see that so yeah so we've given some
havior of a light with alias our device
manager or voice control that's a gin
server we're going to start link so
here's our right here's our API these
are basically our callback we have to
implement for it to work so we can sit
for a light we can accept the call it we
turn on/off color hue saturation
brightness to Kelvin which is the color
color temperature device is one so this
is basically calling devices we charge
the device state
update States there get ID so this is
essentially the pit ID of of the
interface ID so here's math date right
so it gets the state it knows what that
is from life x and then we map it to our
device manager at device light state
which is what cicada knows about and
just return that in it voice control
that's kind of fun stuff I'll go down to
the discovery so here we've got
discovery we are going to alias a few
things we've got so like a lot of the
earlier libraries you Jen event I'm just
good that was kind of what was available
when I wrote all these libraries could
use registry or gin state or something
like that now but it works it works well
and we're not going on between you know
it's not huge volume you know you get
this device every two or three seconds
so it would speed isn't really an issue
Jenna that works fine so we're going to
have an event handler here register
callbacks you have to implement so we're
going to we're going to network manager
which is part of cicada we're going to
register to its event stream which is
actually using registry cicadas all
registry-based a lot of the older
libraries are event Jen events based and
this is also also an old pattern
matching here don't now you can just do
the handle info network interface is it
bound right bound true cool we're going
to start the life x plus we're bound to
the internet if any of you saw Justin's
talk you have to bring all your you
can't just expect Wi-Fi or internet to
be up you have to bring it all up there
you're going to wait for your events to
start happening and then so once we're
up we're going to start our life science
we add our handler to the life x plant
here event handler that is going to call
this handle info in return and basically
all you have to do once you do discovery
easy today handle the bike and you just
send it any tabhi to tell it what type
of device to handle the handle of ice is
is part of so you'll see here we use
discovery right and so discovery is just
this just the level gen server
essentially that will handle all this
stuff for you to say handle handle
events and
says okay have I ever seen this event
and raising this device before if not
called yet ID spawn the thing if so just
push the events through updated
manipulated state and broadcast and so
doesn't like your API and website can
listen to it you can see it data manager
can get the data collect it into the
histogram so that when cloud logger
every 10-15 minutes for every minute
whatever you want to do can go to the
histogram get the data and push it up
okay five minutes oh my god okay all
right that sets the network manager we
also go into AP mode network manager to
manage AP mode ethernet Wi-Fi it also
give us with a board ID which is the mac
address of the ethernet port or the
actual board ID which is a nerve thing
and on TV IP address the current IP
address histogram we're storing data
again you can do that you can use this
if you want or not all the current
plugins currently do this is obviously
the observer stack here the rave
histogram the first one is a supervisor
these are a little gem servers keeping
state and will return like a histogram
of the current values you've seen since
you last called snapshot so calling
snapshot on histogram will give you all
the history I'm data and then and then
clear it could probably implement like
rolling windows or something like that
as well but again it's very simple right
now api is because this rest interface
is example of our little local local
websites with strength rest web socket
and metric history again calling back
into that histogram data you I that's
current UI which comes in the default
firmware will show you all this stuff is
Elm Ellen based its web sockets its
mobile first and it's only available on
the land right so only you know some
attach the internet anywhere here's an
example of the thermostat interface
controlling the light bulb we can set
color turn it on and off the metrics
history again cloud interface so we're
dead at home right now is pushing over a
encrypted NQ chichi to influx DB I'm
going to skip this input CD is a time
series data base its rate although I
know Brian talked about it last year
he's got some other thoughts on it I
really like it I think you did the scale
that Brian was working at it that hard
better it has gotten better they've got
a one-point over lease now and it is
good but I was never I've never worked
at the scale the Bryan's working at so
I'm sure he's got other stuff it's cool
retention policies so you get your real
time which is just all the data moving
in we can then roll that up to stormy
for 15 minutes so real time we throw up
for 30 days so this is nice when you're
dealing with all this data is you don't
want like exponential growth you can
trade your attention following every 15
minutes we roll up the real-time data
would keep that for a year and then we
roll up the 15 minute data into one hour
increment it would keep that forever so
it's all for long as you know long as a
good race you've got one hour resolution
for all the senator forever these are
the continuous queries that push data
into those into those retention groups
these are some this is some example
queries of influx TV so this is right so
we this is how we map that state into a
measurement point in influx DB and so
again knowing what that state is going
to look like makes us very easy and we
can just keep it very very simple it's
kind of awesome this is an example of
what it looks like this is the back end
it's called brewed right if anybody was
hanging out in the last 90 into this its
template eyes dashboard and grow fauna
so you get your different nodes up on
top here we've got kilowatt usage heat
map of Utila usage that minute
granularity what's the status of the the
smart meter has been when you're
connected or disconnected IQ was shown
co to co vo see temperature humidity
rain fall I don't have the thermostat up
so this is all data for my house I don't
have the server setup yet and then like
the signal of the lights X bulb and what
the current status to chromecast has
been near term I really want to get into
releases of cicada Modbus support for
commercial would be fantastic barrel VV
maybe for some of the local storage here
multi-node so distributed her length for
large commercial buildings would be
great adding more devices
seems so you can kind of start doing a
little bit of that automation stuff and
alerting obviously end goal i mentioned
creating this message research data sets
multiple building styles in each climate
zone multiple families types create a
research data set and I'd really like to
see a strong community around people
utilizing this platform so thank you and
I did get some questions often drive on
fixing that that's fantastic thank you
present this okay how are you detecting
recognizing boys hands without a cloud
API and what kind of recognition edges
you get recognition is pretty good it's
called Moby mov I from company called
oughta me it's actually our drenal
shield but you can hook it directly up
to a raspberry pi as well pretty easily
over the serial ports very cool go ahead
a little arm cortex kind of clint's like
80 bucks but it's very treatable and
really really fun how many boards
because it how many boards per house 12
room so yeah we want to do one of these
but this board one per house at minimum
we'd like north south east west of the
house we can look at solar radiation and
how the home reacts and then ideally
kind of automate that stuff too so and
looking at historical data I would say
well it's three degrees colder than you
usually like it but in 20 minutes just
you know this side of the house really
heats up let's wait you know let's wait
20 minutes and then we can you know so
you're saving energy doing all that
stuff can your son circuit we're not
bettering if so how long can it run yes
and my cousin i engineer is building
this it's like she wants to do that so
bad I'm like let's let's not worry about
it get it working it does the issue is
those gas sensors will get up to like
400 degrees Celsius which just kills
your battery so you're getting like a
week or maybe two weeks of life on that
battery you can dress the reduce the you
know you can actually have it sleep but
then some of the some of you can totally
power down because some of the gas
sensors we'd like some of them 24 hours
to actually get to full full heat and
calibration and running correctly
see if the temperature from the
thermoset differs from other sensors in
the home you reconcile the data to
random are you can read and if so can
you also the set point yeah so yes we
can definitely also the set point and
that's what I'm saying so like yeah we
want to use these to augment what the
thermostats you may be the service it's
on the north side of the house or in a
dark right in a dark hallway somewhere
so using all these other sensors we can
augment that we basically don't let the
thermostat control itself right all the
control comes from the Raspberry Pi in
that sense so check that shit three what
of this works without internet
connectivity everything so I did want to
show you that actually got this running
we connect to so it's in AP mode right
now standard configure if it doesn't
have Wi-Fi configuration for as Ethernet
you'll go into AP mode you can forget it
some questions thank you you know I
don't think I have time to do it but
yeah it does it actually goes into AP
mode and you actually can use it while
it's in AP mode now an AP mode it's not
going to discover anything on your local
network obviously but it will it'll read
everything over the USB of the UART
cereal you art stuff what research tell
you yeah so not much that was part of
that kind of the home automation stuff
and I just thought hey I'll I'll display
it on my grass because I've got the data
but yeah that was more looking at like
the like when I started it the home
automation aspect of it and since I
wrote all this code I'm like well fuck
it ship it you know let's let's use it
but yeah you don't you know you don't
have to install that plug-in oh that's
what that is one play on the show is the
configuration so you know besides the
nerfs configuration was just kind of
went over this is it you just say device
may interject client register device
lifx radio service check chromecast
media static Raven and your i eq sensor
that's it build your firmware deploy
you're good to go cicada handles all the
other the other stuff
yeah I'd love to it's very basic right
now but it's basically just listening to
the event so can you talk about the
device it rammed a collection more
detail it's very basic right now and
that it it's basicly just listening to
the event stream and all the different
devices and if you've enabled a
histogram collection on that device type
it puts it into that that supervision
tree and then you can call snapshot you
can call we've set like i don't have
rolling like a rolling windows histogram
which would be kind of cool but it does
50th percentile 75th percentile 90th
percentile 99 percentile then a 99
percentile current value mean min max
and then shoots out a big map of that
and then that's shoot it up pushed up to
the cloud and then in the cloud i can
log whichever one of those values i want
right info Stevie gives me the
opportunity to pursue right now doing
every minute right and some devices are
pushing me down every six seconds some I
only have one data point for a minute
history having too much value but I'm up
in the cloud I can do whatever I want
with that data in a later time or the
local you I can visualize it follow up
to it report those listening to for
music yes that's a possibility how many
light so we can do however many lights
your router can support right it's a
really efficient binary UDP based binary
protocol so it's really up to your
router right the processes on the
Raspberry Pi are super light so we can
do we can do quite a few I think that's
the final question it's time sorry guys
thank you for all the rushing lil bit</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>