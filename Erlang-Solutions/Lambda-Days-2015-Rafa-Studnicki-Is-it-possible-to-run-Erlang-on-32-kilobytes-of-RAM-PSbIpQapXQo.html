<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lambda Days 2015 - Rafał Studnicki - Is it possible to run Erlang on 32 kilobytes of RAM? | Coder Coacher - Coaching Coders</title><meta content="Lambda Days 2015 - Rafał Studnicki - Is it possible to run Erlang on 32 kilobytes of RAM? - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Lambda Days 2015 - Rafał Studnicki - Is it possible to run Erlang on 32 kilobytes of RAM?</b></h2><h5 class="post__date">2015-04-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PSbIpQapXQo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so before we start I have a very
important warning for you this
presentation contains the Internet of
Things password so if you think that
you're allergic to it you're attending
at your own risk formalities continues
well in this is a very short
presentation I'm going to ask the
question that you have already seen on
the first light so is it actually
possible to run I like virtual machine
using just 32 kilobytes of RAM I'm going
to explain why I asked this question
about 18 months ago and I obviously try
to answer it somehow so besides being a
speaker right now here who actually am I
I have recently graduated from this
University although not this particular
faculty for some time now i also have
been working as an ailment developer at
laing solutions spending most of most of
my time developing stuff related to the
fungus i am xmpp server and also as you
could have read on the lambda days
website and I call myself I wanna be
embedded hacker and by this I mean that
well I have no actually no theoretical
knowledge I just like to play with
cables and stuff so that's the famous
IOT slice so the current research shows
that right now there are almost 7
billion connected devices around the
world and this number will be even
bigger by 2020 and it will reach about
50 billion so if you think that I made
up these numbers well as attached to
some source you think that I made up the
source as well well there's one thing
that we cannot deny and that's something
that I call a something like embedded
bubble which started like but you and a
half years ago when first
Raspberry Pi was released and every high
level language program were started to
build its own embedded stuff on top of
Raspberry Pi and similar boards so I was
not an exception and since because of
this I call myself a wannabe
 well at the same time
actually I was thinking of my master of
science project topic so well I thought
what if I actually can write some
embedded side using airline well
obviously it would have some pros and
cons well pros like I can very easily
prototype stuff and I don't need to
worry about my money management
concurrency and so on obviously it would
be very slow because of the overhead
garbage collection and so obviously
since this is a research track I had to
do some research what has been done
before in this field well obviously the
Dean virtual machine that will Iran when
you type arrow in the convoy was it
somehow developed for embedded stuff for
18 switches originally but well it uses
almost 15 megabytes of RAM if you
started just we started with OTP loaded
and a little bit less almost eight
megabytes when you just load the
necessary modules that was too much for
me I wanted to run it on bare metal so
the raspberry pi like boards also were
not a choice since they were using the
full fledged OS like Linux or UNIX yes
at the same time there was a work and
effort to build any iOS ciertas part for
the bean virtual machine and well I
thought that it was really nice
fortunately the OS itself is a
proprietary one although the bean
version of 40 SE nao se is is an open
source so I thought that it's not using
the full title s just microkernel so I
thought that this is a good way so I
just another one that it's not
proprietary it's an open-source
microkernel so i actually have chosen
three artists microkernel and I
basically decided to write the Erlang vm
from scratch well I thought that it's
pretty nice it's using just 250 bytes
around when you started and five to 10
kilobytes of flash depending on which
modules do you chase and also provide
some useful abstractions at least in
terms of implementing a narrowing vm
from scratch like scheduler or memory
management and I at that time I also
owned this little thing an LPC 70-69
microcontroller with 32 bits irm
cortex-m free CPU on board and that was
the only a RM that I own so I chose this
one so it has got 512 kilobytes of flash
and 32 kilobytes of RAM ok let me take
you on a journey through how my MA she
was actually developed but this is a
every textbook every LM textbook example
of a simple module that I bet most of
you can implement it test it and compile
it and tested in like two or three
minutes or even less simple factorial
calculator function that cal plays
factorial value however what I wanted to
do was to simply compile an airline
module on my laptop like this one and
execute it on an embedded machine so
well the code that you have seen on the
previous slide it's not something that
the LMU understands well
it what it's more similar to this it's a
human readable version of white coat
well so the machine must have execute
something like that so as you can see
even though the code was pretty simple
to execute it already needed to
implement some basic stuff so my basic
building blocks like colo dirt loads
what you have seen on the previous slide
and some kind of vitac of interpreter
that actually interpretive those up
codes and at the time I had up cons
implemented after this stage one out of
total of around 150 and also because I
didn't want to well calculate choose a
factorial of 11 which is the maximum
number that fits on 32 bits I needed to
implement the pig number arithmetic that
goes it goes out of the box we've been
and also I had two garbage collected
somehow so simple garbage collector was
also implemented so as you can see after
this stage 1 I could have execute a very
basic sequential code so if you think
that in the further steps i was able to
implement a rocket launcher or mars
pathfinder and I unfortunately need to
disappoint you because this is the most
complex complex finked that I was able
to run on it and it's a well a little
bit more complex that it might might
look in the first slide because this is
actually what happens here well if you
think of it in terms of the OTP
supervision tree then forget is because
it has nothing to do with OTP as it
doesn't fit inside so what happens here
basically there are four processes
running supervisor process and free
worker processes a work each worker
processes has got its own green LED
connected to it now a supervisor every
500 milliseconds chooses a random worker
process sends a message to it and if
worker process receives a message it
simply toggles the state
green left now ever work in a process
does it receive a message for 1.5
seconds so 3 full so it's free cycles
then it simply exists and since the
supervisor is strapping exits and it's
linked to worker processes it receives a
message that worker processes down eight
put on the red light that is sitting
next to it print let's wait a second
restarts the worker process and turns
off the red wet simple yeah well it's
not the rocket scientist as I have said
but this after this stage the machine
gained well 43 up coats as you as you
can see it was able to execute some
parallel code on top of the free air
ptosis scheduler and tasks and also as
you could have seen links and a message
passing somehow was implemented and also
the timers based on top of the real time
not the real time that the hardware
clocks in the microcontroller and some
building functions that were controlling
gpio for toggling lights tight so at the
third and final example a radio
frequency somehow connected well it's
more practical thing I had a very cheap
2.4 gigahertz transceiver it's called
everything 70 it costs about a euro and
is controlled by this by bus and
actually hadn't driver written an
airline that was running on top of the
Raspberry Pi so I simply ported it well
I had to switch all binary operations to
list because my vm doesn't support
binaries I also had to well get rid of
the OTP and use bank and
receive instead well but he was working
he was talking to another
microcontroller isn't the same the same
micra the same radio frequency frequency
model goes at amiga right so actually
the majendie haven't gained much justice
by bus driver and interrupt controller
because this arrogant cilenti works if a
message counts it generates an interrupt
so somehow i could have needed to
translate and interrupt your airline
message well so since this is a research
track with another of the guitars point
I do it in reverse order so in the long
term I would really love to that if my
vm was able to talk to a full-fledged in
somehow to a cluster of big games and
even make a cluster out of couple of
microcontroller VMs that's a long term
goal a mid term goal well actually move
to something a little bit more powerful
because you know 32 kilobyte is fun to
play with to get out of your comfort
zone when you can where you can allocate
as many member as much memory as you
want but if because this led example was
actually using twenty three twenty four
kilobytes of RAM and the most of it was
loaded code and that's actually the
upper limit for for that for this
microcontroller because of how garbage
collector works at least the
fragmentation memory so that's kind of
the upper limit well I will let you ask
some questions just in a second but
there's probably one that you have on
the tip of your tongues well actually
what's in it for me what he's talking
about this stuff and apparently it
somehow works but how
uses and how can I contribute and so on
actually right now you cannot today you
cannot pass in just 19 days you will be
able to delet GT stone well tactical
reasons I would say so the very short
and goes to open sorted and March
seventeenth as I said to do some
technical reasons and there is an empty
repository there you'll find the code as
i said on mar 17 but you can store it
today okay do you have any questions
okay that is the warning any questions
and i was a bit puzzled it seems like
you implemented first your machine
you're an early on top of that so your
main goal was making a virtual machine
is that correct yes so why not run java
for example I don't know Java I just
know airline and there were also
hardware platforms that already support
virtual machine so why why this work
this is some research folks well
naturally research focused okay just
look main goal was for fun okay and
actually let learn as many as possible
by the airline BVM itself okay but
somehow rain implementing it thank you
haha i fell over fun I've done something
a bit similar with him in the past so
I've got one question for you white 32 k
why so big serious I'm serious that's
the only microcontroller that I owned it
was using 32 beats on a question yes
it's a 32 bits instruction actually
airline is well I didn't want to write
redesign the airline vm from scratch as
you wanted to arraign behind it and the
design is like you need to have at least
32 bits I think okay okay but the
question is do you need all 32 pay for
your LPN but it can't be M that requires
you to use the 32 k could you maybe
compress it into even that space yes I
think yes but I think this would need
this would require to reimplement a
little bit of how the compiler works and
how the instructions that looks like
because as I said mmm the most of the
memory was taken consumed by the Lotus
code bloated modules like every opcode
consumes 32 Bates every operant instance
pdtv so it was fifty percent of memory
was consumed by four loaded modules
right yeah yes i know that when I've
done this myself on problems with Ron
shine system how much space the runtime
checks yet so for example I might have
to do without luxuries like being able
to print floating-point numbers
a luxury yes I say the surprising i'm
going to say something like 32 k or 16 k
from ron tonight by not printing
floating point numbers that involved
rewriting the printf library and see
there's a bit of pain they do you have
any more questions all right i think
it's great time to thank our speaker is
already started</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>