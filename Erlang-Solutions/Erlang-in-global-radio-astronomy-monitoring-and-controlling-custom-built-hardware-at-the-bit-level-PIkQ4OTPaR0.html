<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Erlang in global radio astronomy - monitoring and controlling custom built hardware at the bit level | Coder Coacher - Coaching Coders</title><meta content="Erlang in global radio astronomy - monitoring and controlling custom built hardware at the bit level - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Erlang in global radio astronomy - monitoring and controlling custom built hardware at the bit level</b></h2><h5 class="post__date">2012-11-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PIkQ4OTPaR0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello miss better yes excellency
yeah last speaker between human beer so
okay let's get cracking my name is
Harvey Catholic and I'm going to talk to
you about the work that Mike Pollock
death school who is also in the room and
I are doing with our line in radio
astronomy let's see if this works
yes it does we both work at the joint
Institute for field behind Europe which
is located in Greenland in a northern
part of the Netherlands some 400 miles
away from where we are now
the June joint Institute for VLBI
has an acronym in its name vol VI which
is short for very long baseline
interferometry VLBI is a radio
astronomical observation technique and
because our Institute is not made of
computer science or mathematics I'd like
to introduce a bit for it so you know
where we're coming from
astronomers have been building larger
telescopes
ever since the Isaac Newton built this
small X these and currently telescopes
go up to 5 meters 10 meters or sometimes
even up to 100 meters so why is that if
you take a small telescope you look
through it you might see this build a
larger one and you'll see this that's
basically making reasons it's the size
of the telescope the only interesting
variable unfortunately not astronomers
who observe the universe by detecting
electromagnetic radiation from gamma
rays through visible light and radio
waves they're all basically the same
phenomenon differing only in one key
property namely the wavelength and as
you can see there's
difference in wavelength between gamma
rays visible light and radio waves so I
got a pop quiz for you who do you think
will see the most details an amateur
astronomer using a 20-centimeter optical
telescope or a professional radio
astronomer with a whopping 100 meter
radio duster can I see a show of hands
who thinks amateur astronomer will see
more details okay anyone things that the
professional radio astronomer will see
more details okay so there's more people
who think that that is unfortunately it
is the amateur radio astronomer who wins
this by a factor of thousands even and
the big differences the observed
wavelength there's about ten to the six
difference in observed wavelength and
there is there is a measure called
wavelength over diameter which is a
measure of how big your pixels are that
you can see with the Telstra and the
smaller pixels the more details you can
see and despite the fact that the
amateur astronomer has a telescope which
is five thousand times smaller than the
radio telescope the fact that the
wavelength is even much smaller than
that next you'll win
is this the end for radio astronomy then
fortunately not there is a neat trick
that we can play suppose we have a
telescope of hundred leaders who go to
build one earth but rather than building
100 meter we take two small telescopes
say 20 meters in diameter but we place
them and with the support
if we then take the individual signals
and combine them through the process in
which we call correlation let me have
put data set as a resolution which is
equal to that of Thomas code with a size
equal to the distance between the two
telescopes so 100 meter in this case in
the OPI we take this trick to another
level we use radio telescopes on
different continents we take the signals
and bring them together in the
correlator and in that way we create a
telescope which is nearly or a maximum
size nearly as large as the Europe
itself so it's a completely different
ballgame now if we now compare the
largest optical telescope which operates
in the infrared can fortunately and we
take say the lowest resolution global
field VI configuration then despite the
wavelength difference still being image
our diameter because we have no
telescope the size of the earth we win
by a factor of hundreds in the radio so
what can you do with the telescope that
can see that many details for example we
can see individual stars exploding in
neighboring galaxies and if you observe
a faraway stable source then you can
actually watch the continents drift
using field VI it is possible to measure
the distance between mm to sub
millimeter precision even though there
in this case some six thousand
kilometers apart in this plot we show
the distance between thumbs code and the
United States and one in Germany and you
can see over time the distance is
increasing by roughly seventeen
millimeters per year so United States
and the European continent there
drifting apart another thing is that if
an earthquake happens you can
immediately measure how far the
continent has been displaced in this
case some 10 millimeters and finally if
you thought that the earth was rotating
as a steady 24-hour with an esthetic
24-hour period but think again if you
start measuring the rotation speed of
the earth with submillimeter second
position then you won't notice that the
periodicities occur at different
intervals and there's even a sort of
trending effectively see and in fact the
fact that the earth is rotating rather
slower than exactly 24-hour this is the
root cause of the leap seconds that we
see because in this case somewhere in
1973 the earth was rotating by maps 3
milliseconds per day slower then no and
if you accumulate that 3 milliseconds
per day over 365 days you've accumulated
about the seconds worth of difference so
that's when you have as I said in order
to bring the data from the telescopes
together we have to read the recording
on hard disks and these artists will be
shipped to our central facility in the
Netherlands we have to use special
equipment in order to keep up with the
data rate of gigabits per second or up
to 4 gigabits per second that the single
telescope in general since 2007 we have
been starting to doing these things in
the real-time data sent from the
telescope over hive back with global
network links straight into our facility
in the Netherlands this is a network
throughput but of one of our real-time
observations and you can see over here
that after an initial setup that at very
low bandwidth we are receiving more than
eight gigabit per second for several
hours from telescopes distributed across
Europe South Africa in China and all
this data is being processed in real
time so as the computational
requirements to go up this N squared if
you want to compute all correlations
between all participating telescopes we
need special hardware to do that and
it's called the correlator this is our
mark for
correlator it is built with 1990s
technology and it's operating a thousand
and 24 of these crystal built chips
which are working in parallel by
comparison a current day our current day
256 node 3 and 3 gigahertz sealed
cluster and barely do half of what this
machine can do but we want to correlate
more stations more than 16 and we want
to correlate more bits per second so we
need more data correlator so that's why
a international consortium of radio
Salonika observatories the unique world
the universe is an FPGA based signal
processing platform it is equipped with
a state-of-the-art FPGAs conceptually
divided into front nose and back nose
the ideas that data will come in into
front notes it can be reprocessed
business and off your back nose process
or more before it leaves
the board again between them the
forefront notes have 160 gigabits per
second of improvement with the out push
the back nodes have the same at the
output and every front node is connected
to all other back nodes with better than
20 gigabit per second links and finally
each FPGA is connected to the outside
world via one gigabit per second link
and an on-board Ethernet switch and
actually this is the piece of equipment
that we really want to command in
control using that line this was our
main drive so Ellen our Institute is a
primarily a C++ Institute because of
performance reasons we do use other
languages and courses but in order to do
something with happening we have to do
some serious management convincing
because we have not the luxury to build
instruments just out of academic
interest now we weren't allowed to do a
pilot random project it is a fact that
in vol VI data is stored in several
different but framed data formats and
the so each frame is typically consists
of a header with a binary data payment
within the header you typically find a
specific bit pattern that software or
hardware can synchronize them and the
will be a binds them in there
describing the time of the data so I
decided to write a simple C if I can
write a simple decoding utility that you
could give the file and it would attempt
to identify and display some information
about what data it was looking
so for one of the format's the
synchronizing bit better and looks like
this and for another the synchronizing
bit pattern could look like this and
sure enough in about a week
words of coding and well I wrote to 12
it actually it is a bit more 240 lines
of code I managed to create a simple
system that would actually do recognize
and decode the three available formats
decoded the binary coded decimal time
stamps that are in the headers and even
did some just to experiment with it some
distributed features where the top of
file reading could be done with one note
and the actual interpretation and
decoding of the table and the fact that
we can do this in just two hundred two
lines of code so really impressed
management so at that time my colleague
des and I we were granted to do another
more serious by the project as I said we
do these things in real time and we want
to have a website disturbance blame some
soft real-time information about the
running experiment one of the things is
the webcams because typically these
webcams are at remote locations with
large Layton sees and lot low bandwidth
so if we start if our users of our
webpage start looking at it we can very
easily hammer those devices so we want
to catch the images locally and at the
same time we don't want to
because of wonder the link quality not
being so good we don't want to show how
images at the same time during the
observation a dance code control system
emits all kinds of useful information
that we want to make lots of in time so
we come up with a webcam monitoring
utility which takes the some metadata
for my Sifu my sequel database and polls
the webcams have a low rate say once per
minute uses a port into image magic to
create a scaled-down version of the
webcam image and stores the binary data
straight into these them the log file
parsing the application ran in a
different note it is a bit it's a low
data rate application it gets its out
its data from the downstroke using
hyphens and SSH the data gets parsed and
updated to my secret database and in
parallel we have asynchronous water
utility which every so often grabs the
data and uses of 42 new plot creates the
plots and writes the binary PNG data
also straight in Tunisia finally we've
patched it all together using web tool
and we surf the HTML also straight from
vision we cache its user requests the
web page and we think that the version
in the cache is too old you create a new
version this application was sort of
about three thousand lines of code
having colors well in the way with hook
to be reused
supervisors Jenny servers
and we experimented a bit more with a
real distributed system and the I must
say that the transactions in Malaysia
and the men I don't care what you store
in there let that be an absolutely
brilliant
but big upshot of this was that we got a
green light to actually do the real
thing
so back to the report this is a
schematic overview of the Unicode and
you see the FPGAs and each FPGA will
have the tiny CPU running on it if we
zoom in a bit on the FPGA
we see our theory of engineers will
implement the actual application modules
then do the work that we want to be done
with the signal processor typically
these modules will have commanding
control registers but now what we'll do
is we'll take these and we memory map
into the CPUs memory map so that we can
make them available via ethernet so the
I a basic idea for communication is that
a client program on control computer
communicate with a server program
running on the tiny CPU on the FPGA
matter of fact we developed a simple
binary protocol which allows us to read
values from or store values in to or
obtain values in the CPUs memory map and
as for the programming model we decided
to we looked closely at the hardware
documentation that our PhD our engineers
and reviewing so what what do you
typically find in this documentation
you'll find addresses you'll find
bit fields the description of what they
actually mean
so we come up with a fpga client library
where one controller controls one
specific FPGA and each robot keeps a
register map and the register map does
nothing but mapping the symbolic name to
typed quantity somewhere in the memory
map or the FPGA so what kind of types
data types can help you can for example
address a single bit inside a 32-bit
word or you can address the consecutive
range of bits in the world a single
32-bit word for a consecutive work of
32-bit words then we define simple
primitive operations in a library that
is operates all these symbolic names
only and the library will actually
translate these commands into the binary
protocol taking care and using
appropriate bit masks such that bits
outside of the range of interest are not
affected because so how does this look
in practice we've developed a behavior
called personality forcing a module to
export a function registers which is
actually which returns the list of
registers defined for that specific
Ephesian so in this example we have a
single we have a big range of five days
called on tap we have a single bit comm
PBS enable and we have control status
world
somewhere in there you should you note
that the bit range and the bit of
different fields inside the same
physical levels and then if we look for
example into the documentation there
the engineers have documented how he
would actually start the filter and they
put maybe they said that well we first
have to disable the yes by writing a
zero to that built then you need to read
the control stars register do something
with it
finally you can update the note that bit
range and re-enable the bps so we think
that this maps pretty closely of what
you would find in hot rod occupations
one property is that hardware typically
responds erroneously if you start over
writing bits that you shouldn't so if if
you would try to write if you do not
take appropriate countermeasures and you
start right relative to to the bps bit
then you might have the desired results
so the FPGA client library precious hard
really hard if you try to write the
value two to the PPS enable because we
defined it as a single bit and the value
of two is absolutely not going to fit it
and this is a sign that you're doing
something really wrong and your medical
look and find out why this is happening
because it shouldn't besides doing a
single FPGA we're actually building a
full-fledged correlated control system
so we built a module on top of the
single FPGA control that controls or a
FP Jason fellow we've used Jack to
generate parses and validator
for
configuration files were reading several
binary data for my total ascending that
complex over unity we're capturing the
output data from the from the board and
writing in these files and in our
experience that if the VHDL engineers
have come up with some new functionality
which usually takes at least two weeks
we can typically support it within a day
we also make quite heavy use of the
distributed nature of nature of the
language and we run amuk on the notes
that sent data into the correlator
captures the output and write it to disk
and we have a central mana control node
which drive who figures and controls the
hardware and orchestrates all components
in a system there's a lot of good things
to be said about Elam I think that the
conciseness the high productivity of the
language
combined with even more ability of
evidence is really a big plus and as a
same machine the binary pattern matching
is something that every language should
be jealous of
unfortunately when there is good things
there's also bad things and I think what
in our case is really is that our
engineers typically struggle with
letters and even though the language
itself is very simple they seem to
struggle more with the concepts how do
you actually achieve anything in a
functional language how do you do stuff
that is what's making making it
different and the compilers or the
brevity of the code also works against
you if you have people in your team that
are less proficient in the language and
it's really difficult for them to read
somebody else's code and we we found
that we are building a distributed
system and it's it's in development and
this never found a good way to make it
easily deployable at least that it's
easy to use for non-experts
electro and actually that's all I have
to say I would like to thank you for
your attention
questions yes the question was why do we
use my seat for as your as our DBMS
primarily that's because we have as you
see we use a lot of different
programming languages and my sequel is
very easy to collected from all of those
languages yeah we've already had my
sequel running so for a pack of years so
this was just possible because there can
be up to 32 universe into a single
system and then you run out of you need
no deities but yeah it's possible to
have several racks next to each other as
a bet you have to each system of up to
32 universe you have to yeah treat them
as one yes so it's a 256 FPGAs and
otherwise they don't think of them so if
the owner was like on the universe no no
the the CPU is running in 40 kilobytes
of memory is not good no chance of it
going
it's a need anything about like
embedding like an origin something on
the leaderboard and then running the
limit in class so the question to
question is should we run have an extra
processor on the Uni board and run a
full-fledged Linux system on there
actually that is very high on my
wishlist and we've started thinking
about the next version of this hardware
and it is one of the things that is
currently being discussed and folks are
not up yet because there's a few people
who want it and also about the same
amount of people who don't think it's a
good idea mostly because of the power
budget we want to be as low as possible
recently and their name is Lois power
okay so we know it will be okay yeah
okay so there are other competing
architectures it's being mentioned and
one of the things that reason behind
this design is we really wanted to
concentrate as much processing power as
is possible without actually melting the
board so that was the basic design
criteria okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>