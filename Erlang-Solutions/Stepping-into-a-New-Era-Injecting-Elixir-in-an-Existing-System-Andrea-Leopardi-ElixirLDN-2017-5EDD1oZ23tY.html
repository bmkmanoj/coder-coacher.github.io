<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Stepping into a New Era: Injecting Elixir in an Existing System - Andrea Leopardi - Elixir.LDN 2017 | Coder Coacher - Coaching Coders</title><meta content="Stepping into a New Era: Injecting Elixir in an Existing System - Andrea Leopardi - Elixir.LDN 2017 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Stepping into a New Era: Injecting Elixir in an Existing System - Andrea Leopardi - Elixir.LDN 2017</b></h2><h5 class="post__date">2017-09-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5EDD1oZ23tY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">[Laughter]
so what I want to talk about is the
story of how we went from having no
exterior at my company to having
something like half of our system in
elixir and I know many companies want to
start using the mixture they want to try
out elixir but they don't get the chance
easily because either their system is
too complex to rewrite or it's too big
to rewrite in a literature or they don't
have any new stuff to write in elixir
but I still wanna give elixir try and
benefit from the form somebody elixir
brings and this is exactly what our case
so we wanted to try it out we wanted to
see if it would improve stuff for us but
we couldn't provide we have a pretty big
system we couldn't write rewrite the
whole system so we decided to start
using it small and then like start in
injecting in many many places to get
where we are now so my name is Andrea I
come from Italy but I work for a company
in this country who can guess with these
countries I drew them up it's Sweden
good someone said it's Sweden of course
so we work for accompanying in the
Ottenberg it's called first football we
make a football app for like football
data browser football data get push
notifications for goals and stuff and I
don't really care about football it's
fine this is fine because really what we
do is actually just higher core team
members or elixir so this is the whole
core team we're only missing two know so
you gotta catch them all but so by the
way we're hiring so I know it's just
icier so like then we miss just one of
course we only hire core team members so
it's so what our system looks like so
the system I'm talking about we do like
a bunch of stuff but the main stuff that
we have is this main thing that we have
is this application foot block
and the system I'm gonna talk about is
the backup for these up so the system
that powers the app and I would just
want to show what like the things that
this system does to to kind of tell
where we started using elixir and why we
start using it in the places in those
places so what it does is just it has a
Web API that clients Android and iOS
clients connect to it does data
ingestion so we buy data football data
from companies that sell football data
and the system takes care of importing
this data and storing it and processing
it and everything then a huge part of
the app is push notifications as I said
so we send push notifications when
events happen so some something triggers
like a goal then we have to fetch the
subscribers for that match and the team
and everything and send notifications
and then there's an admin interface for
all the data of course then we have some
smaller parts which one is videos so we
do fetching for like highlight videos
from different providers we work with to
publish them in the app and then we have
also like betting odds to publish in the
app as well we crawl them from a bunch
of different providers and all of these
functionalities bundled up in one huge
monolith that we call the monorail
because it's a rails monolith so what we
wanted to do is so this is the cour
system looks looked like at least a
couple years ago and at the time we like
we got interested in elixir I didn't
work there yet so I'm just telling the
story but we got interested in elixir we
want to try it out but why so the thing
we want we were after was all the stuff
that elixir promised to have that like
looked like it would work really well
with our system so can concurrency we do
a lot of stuff like sign-in push
notifications has to be done like if you
do it in parallel it's faster data
ingestion if you ingest data from
different providers for example in
parallel it's better and a bunch of
other problems isolation as well plays
really well with for example again
ingesting data you don't
a single failure failure in is lacking
in a single provider when interesting
from a single provider to affect
anything else in the app so you want the
errors to be isolated same goes for like
push notifications you don't want an
error in sending a push notification to
affect all users resiliency well the app
has to be usable all the time so we want
it to be up all the time
and scallopini as well we don't want to
of course rewrite everything every time
we double our users so we want it to be
scalable so the first step that we need
to to start like exploring the elixir
was starts blog we decided to start
small so we didn't know there's a
technology super well only one of our
team members worked with Erlang not
elixir so we kind of wanted to give it a
try on a small scale to see to evaluate
if it was good for us if we enjoyed
working with it and what we decided to
start with is the video service I
mentioned so this is a sir this is a
part of the system that fetches videos
from highlight videos for matches so
that goes from different providers and
it publishes them to the app into the
app and this was all part of the same
system so the monolith and so we want to
we said we decided to try out elixir on
this problem because we fit kind of well
during criteria and because they could
benefit a lot from elixir and it was
small enough that he would and it wasn't
too like too big of an investment so the
first thing decision that we took to
start using elixir was to extract this
as a separate service I think this is
like very good it was a very good
decision and it made it really easier to
use a newzik technology because we have
this big monolith and you know basically
the only way like the only sensible way
to use the liquor in it was not to use
it in it but to use it like alongside it
and let the to talk so as long as we had
a common interface which in this case
was HTTP calls I think but as long as we
had a common interface this service
approach went like it was really good so
we were able to write a news rewrite
this the video
into this new small service in elixir
and we already as I said we're really
benefited from some of the features that
I mentioned earlier of elixir so we were
able to fetch leaders in parallel much
in a much easier way now and isolation
was really good to keep the service
always running because if there was a
failure in one provider and this happens
can happen easily for example when they
change API or like there's lots of cases
where you can get wrong stuff going and
it was nice to have them isolated if the
failure is isolated so that they
wouldn't affect the fetching wouldn't
affect the rest of the service so the
learnings from this experience from
introducing elixir through the service
was the services are a good way to
introduce a new technology new system
because they allow you to write the
service in the technology that works
best for that service and they allow you
to just plug basically the service into
the rest of the system and they also
this this small step also incidentally
kind of made the whole system better
because now we had this most service
that was very focused isolated
responsible for just one thing and it
just communicated with the main system
through a common interface so we could
have changed the main system completely
or changed this service completely and
the other one wouldn't have noticed so
this was this was actually set ourself
on a path of doing lots more services so
and then the other learning was that
it's really good to have someone that
looks you really well in the company
because the elixir is a kind of the beam
in general is a complex piece there's a
lot of god shows with like deployment
sorry and I mean there's a lot of stuff
that you like need to be careful about
and elixir is a quite young language so
while there's like an impressive amount
of resources already it's still like
there's still work that can be done on
making things like deploy mean easier
and this is still a lot of like gotcha
so it was and there's not a lot of
elixir
like common knowledge right so it was
good someone so we had alexei which is
in the elixir core team so any worked
with her long already so he knew the
beam and we were able to use using kind
of as a guide for the rest of the team
as well and to the point of reference so
if you want to introduce the leaks
rescrew to have someone then no elixir a
bit better than the other then the rest
of the team or the nose elixir enough to
kind of lead others in order to speed up
and make the process less off-putting
so once we have this service running we
were really happy we were really happy
with the mixer we decided to invest you
know leagues you're much more and so we
wanted to like go fool try to go fool
ixr as much as possible and the next big
big project we took on was basically
take the push notification system that
we have which is a core functionality of
the app and it's really like a pretty
complex system because of how it handles
subscription integration subscriptions
and it's performance critical as well
because when a goal happens in a match
you want a notification like 5 seconds
after the goal 2 seconds after the goal
so you want it as soon as possible but
we were we had trouble doing this
because of all the because how hard it
was to fetch the right subscribers for
the notifications so we wanted to we
knew we wanted to rework this system
redesign this system already and we took
advantage of this to rewrite it in
elixir since we had to rewrite it so
what we did was actually not just
rewrite we're redesign redesign the
whole part of the system into a separate
system and rewrite and Brad it's an
elixir and this is what we been working
we worked on for like a year or more and
what the approach we took is we like
services we just added more services so
we had this was a this is a more like
push the push notification system is a
more complex system so we didn't go with
just one service but we went with like a
small umbrella of services and they're
not micro services I would say they're
like medium sized services but and we
have a few that form
this push system and push system and the
old system communicate to it
to each other and interface we chose for
this was rubble in queue but point is
that they just share a common interface
there they can talk through so we had
more serve had more services this was so
now the we wrote the code now the this
is been in production for a few months
now so it's and it's a huge success
story for us we were able to improve the
performance of the system a lot of the
push notification system we went from
something like 30 seconds after the goal
is where the first notification goes out
to in 15 seconds we're done or 10
seconds we're done with all the
notifications we're talking about like 2
million notifications at a time so it
was a huge success sort of course a big
part was redesigning the system to make
it better at what it did because it was
kind of hot together in the first place
but elixir played a huge role definitely
again in concurrency so we were able to
do a lot of stuff in parallel really
really easily it played a huge role in
resiliency as well so these services
basically for a few months now never
pinned down which was a huge success for
us and there were there were bugs
definitely i justit didn't bring the
whole system down as I said we saw
performance go up this was that
concurrency was played a big part
because we were able to do a lot of
stuff in parallel that we didn't do
before
io played a big role because Erlang and
Alex are really good at IO and a lot of
stuff that we do in the in this bush
system is IO related right so reading
from the database doing that HTTP calls
to Senate actually assigned unifications
and talking between services it's a lot
of Io related tasks and elixir in Erlang
of really good at i/o so they like
performance definitely was affected from
this and it was so so good result was
resources going down so we started using
less memory than we used before just for
the push part and we all started using
less servers so before we have like
for the main system who had a bunch of
big servers so like 24 cores so powerful
machines but now for the oops but now
for the yeah
so now for the push services we have
something like we average 4 course on
inch server that we use for the push
services and we have I would say two
servers first service and we only have
two for redundancy we don't have two for
performance so one would do the job so
one for core machine would do the job
and we have like three or four services
so it would it would be like a small
amount of servers
it's just double that for redundancy
because we don't want one so we are
going down to effect the service so it
was really really we really really
enjoyed the process it was a really
great success
we enjoyed providing the lecture a lot
so we we found that it didn't just make
better results in the end but it will
also make it easier to write a good
system it made it easier to write it
like robust system easy to read code
easy to introduce to other people so it
was it was really a success and so we
decided to like in this long term as in
okay we're doing everything new in
elixir that makes sense we use elixir
for so we're definitely sold now we have
more leaks through developers in Ruby so
when we started this project we didn't
have any elixir developers now we have
six or seven like full-time elixir
developers compared to maybe three Ruby
developers and we have 50 something like
15 production machines running elixir so
we definitely invested by now and what
so at the beginning of the talk I showed
the stuff that we do in in the system
and this was the least and the ones with
the check has the stuff that we're doing
in elixir right now so as I push
notifications is the stuff that we
worked on videos his first project odd
that other team rewrote everything in a
leak sure they had pretty good
experience as well he was really
important before they Dane
and in deadlocks if failures are
isolated so they're really happy as well
and data ingestion with the like opaque
mark is what we're working on right now
so we're rewriting the data ingestion
part in a league here as well because
you needed every right anyways as well
because it was act together in the first
place as well if you if you catch the
theme and so basically these we need we
need to be a lot strong we have problems
with latency we have problems with
reliability so we need to react to that
the system we already started the
process and we're writing everything new
that we write in elixir and this will be
like the last huge portion of the app
that we will rewrite for sure and and it
will be in a lecture as well because and
like this was just to show that we we
manage to use the litter for the stuff
that it's good at so doing work in
parallel stuff that needs to be always
up and we didn't we're not planning on
doing Web API interface right now and
random interface especially we're not
planning to do because elixir doesn't
really I mean excel at doing CMS kind of
thing things so we we don't think it's
worth doing in elixir maybe from scratch
we would do but now web api would be it
would benefit a lot from elixir because
elixir is pretty good at web stuff but
it's a pretty big project it would be a
pretty big project and the gain would be
not huge like it was with push
notifications or like we will be with
data ingestion so as I mentioned before
using leaks here introducing elixir made
the system better in general this was
like a side effect of deciding to
introduce elixir so we said we want to
introduce elixir how do we do it and we
started with services and then we went
on with services and then we're
architected parts of the system and the
end result was now that even if we
didn't use elixir now but kept the
design we would have a much better
system so like services brought the the
end was the services brought a lot of
good things in the system it's more
robust it's more isolated it's easier to
work on is easier to grasp what's going
on
and so this is how we we introduced it
in the system and I didn't mention
interoperability at all so the only way
I mentioned how to like how we
introduced elixir was to use services
elixir for services and let the surface
talk with the main system but there's
like you can you can introduce Lisa
Rinna's system with interoperability I
didn't mention it because if you do
interpretability meaning that you call
elixir code from other codes so for
example for us if we started calling
group electric code from the Ruby system
we would haven't been a good idea
because we wouldn't have benefitted from
stuff that beam that the beam offers
like isolation or resiliency because if
the group e up would go down still
everything would go down so I wouldn't
have been such a huge change if we ran
elixir in parallel with Ruby on the same
machine for example and use like ports
in elixir to talk with Ruby then it will
be a service so it's what we did
basically just like a bit more
structured and if you want to do
interrupt I would say that the good way
to do it is to actually use the lecture
as the wrapper of your application so if
you use the liqueur and from elixir call
out to your application you can still
get benefits from elixir because of the
you still have the kind of fault
tolerance part so your application still
kind of stays up you get the isolation
as well but you're able to keep all the
business logic in the in there in this
case would be Ruby up so you don't have
to rewrite all that but I don't have
experience with that I mean as I said
services were really good for us even if
Flickr wasn't in there
in them so we went with that so the
learnings from this whole experience
starts move so if you want introduce
something we started small it was it was
good to do that because we didn't want
to invest a lot in something that maybe
turned out to be not good for us even if
it wasn't the case services are good for
us again so they worked really well
they made the system better now it's my
way easier to introduce
you know technologies if they're better
for the job than elixir we can replace
them so it's I mean it makes this whole
system better designed more robust and
then that the right tool for the job is
important this we learned there rupee
wasn't the right tool for all the stuff
that we were doing so we gained a lot by
switching to elixir for parts of the
system but as I mentioned we're not
gonna redo for example the admin
interface in elixir because elixir is
not it's not that it's not the right
tool for the job
but it's not more right and Ruby so it's
not worth redoing for now
thank you questions I don't know if I
heard correctly but at one point in the
talk you used you were saying you're
gonna use a lexer for a number of the
services and then you mentioned the
admin interface the CMS and I might miss
hurt the did you say that it wasn't an
ideal match it was an ideal match elixir
for CMS you mean yet I mean it's not
that it's not an ideal match but it's
not like it doesn't excel at CMS you can
do it of course but it's not like like I
mean it's not built for doing had many
interfaces I would say because I always
thinking like the scaffolding and
everything I mean what Django then or no
I mean I mean it's not that there's like
a much better tool it's just that elixir
is not a better tool than other tools
that's what I meant
so we use rails in our we use rails for
these all monolith is rails right so we
use rails for that and I wouldn't say
the elixir is better than rails at add
an admin interface so we just I just
meant meant that we were gonna we're not
gonna invest in elixir for that because
we're not gonna see gains probably in
rewriting the admin interface in Ruby in
Braille in elixir sorry if that
clarifies yeah thanks anywhere else yeah
so you started with bunch of Ruby
developers and then maybe found your
elixir master do you have any tips for
like sort of skilling up everyone in
elixir so they could feel like
comfortable and confident
coby's yeah yeah so we I think we could
do better for this at the beginning
because the way we solve this so when we
wrote so the video service the first
thing that we wrote it was a laksa which
is in the core team so it definitely
knows elixir and it was an intern that
did I did it with him and the learning
from that was that it was pretty easy to
teach elixir if you have a mentor I
would say then we kind of maybe we could
have done better what we went when we
had to do the push notification system
we went to look for an elixir developer
to iron like a radiology developer we
heard an awesome one this guy and but
yeah but maybe we could have like just
hired someone and trained them but we
didn't have time that was the there was
the thing but like the experience has
been that it's been pretty easy to teach
unknown that leaks to developers elixir
if you have someone in nose elixir so on
a side note we have another small app
and we did the backend for that from
scratch in like a year ago and that's
that's all elixir and it was done for
from people that were Ruby developers
only they didn't know I nearly - and
they were still able to to do it to
learn elixir pretty fast and then what
we do now it's mostly pair program so we
could take someone that knows elixir and
put it with someone that is mainly a
ruby developer and try to do in elixir
stuffing elixir especially for this
stuff for the data ingestion part for
example that we're working everyone is
working on that so we have both likes
two people Ruby people working on that
but that this system is an elixir so
we're doing mostly pair programming I
would say yeah thanks this question over
here
hi so you said you had a few hiccups and
with your push notification service i
remember either last year or the year
before i got spammed like a hundred or a
few hundred times I think it was during
the euros okay
can we move on to do with you moving to
and what was the story behind it
alright thanks everyone I'm just kidding
I probably didn't work there because I
don't remember this but one year and out
one year two years ago it wasn't elixir
definitely because we kind of put it in
production I would say around the start
of this year although the old elixir
system so it could have been could have
been Ruby no I'm just kidding it wasn't
Ruby was like how we programmed Ruby but
likely but I don't remember this so I'm
not sure it wasn't a move to elixir toys
I think
anyone else that's long trek hi thanks
for the talk
so you your company wants to kind of
scale up an elixir which i think is kind
of quite maybe quite a common thing for
people in this room but you seem to have
sort of taken it ten steps forever by
getting three alexa core members yeah we
all need company so I was wondering how
that came about I think it was so thanks
for the question it's an interesting
question but yeah we we didn't plan on
hiring three core team members so when
so Alexi which is a core team member now
wasn't a core team member when he was
hard so he just started working on
elixir after he was hired and then God
like got to the to get in the team
already at the company so we didn't plan
that for me was the same thing I wasn't
when I was art I wasn't in the core team
I just happened to get into the core
team later and the only one that we
really hired that was running the team
was Eric the hex author and he already
lived in Gothenburg which is where we
have the company so he visited meetups
so we kind of get to know it got to know
him and we just like liked each other
and we hired him for not for being in
the core team but just for like being a
nice guy I think it just happens to be
in the core team thank you
so the stats say that it's more double
the likeliness of getting in the core
team if you're hired
than getting hired if you're in the core
team
okay so
[Laughter]</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>