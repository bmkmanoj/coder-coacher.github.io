<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Extending OTP with custom behaviours - Michał Muskała (Berlin Erlang Factory Lite 2016) | Coder Coacher - Coaching Coders</title><meta content="Extending OTP with custom behaviours - Michał Muskała (Berlin Erlang Factory Lite 2016) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Erlang-Solutions/">Erlang Solutions</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Extending OTP with custom behaviours - Michał Muskała (Berlin Erlang Factory Lite 2016)</b></h2><h5 class="post__date">2016-12-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gM7tBm1wGm8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so well how we observe after lunch I
hope you ate well I know you know they
just sit right now you're around you we
filled with those digestion apprentices
and there won't be much place or for
listening but I hope I wanted for you
and you won't be sleeping so I look like
this on the internet and I need an
update or the photo so if you have a
good good camera and you would like to
take a picture of anyone i'm speaking it
will be great so I work for company
cultural media and I thank them very
much for about me to be here today I'm
also a student at cyogen university of
technology and I got into a lecture and
they're like through google Summer of
Code last year students to work on open
source projects and I worked on the next
database library so what's the plan for
for today I'm going to talk a bit about
very special processes and later
followed by the behaviors and finish my
customers
out of the talk I'll tell you why they
are interesting and why we should be
using more of them okay but we're going
to start with an experiment and i don't
i don't have in mind
the experiment it won't be that violent
so the first question is are they able
to raise your hands yeah Norah great so
who you spoiled and receive and send to
implement okemah yeah I think that's
like a hell of a racket another language
printer works in then like you do a car
a lap so protogen serve and a pain okay
less handsome yeah so what behaviors
will get an OD d application just over
deliver Sam just stay tomorrow you Jen
abandon supervisor so we have got seven
of them big change they're interested
you're talking only new things have
nobody knew those I promise you that was
probably the last things that you known
to everybody and so obvious so what are
the use cases of behaviors in icing two
main use cases what does those message
behaviors that we find in her to be a
chat server when each colbeck is called
upon receiving of a message but there
are also the data are called the
Nintendo different behaviors where there
aren't actually related to processes as
much as a regular processing of
something and the and it's not like they
are like it's one or the other it's
rather especially where we have his
behavior for someone and for a long time
I thought that this data driven
behaviors that are used similarly to
interfaces in many other languages or
something that were used mostly in Alex
here provoked by first by Georgia from
you need two years ago when it was
talking about marketing and contracts
and proposed establishing contracts
between modules by introducing behaviors
but i think but i will be buried with
this song i found that they are also
present in many other libraries so we
all know that jen serviced emergence is
this thing even us by God and inspired
it's not implemented it's discovered and
we all know that and we all learned a
bath to do to the Enlightenment when it
implements like a single message passing
an abstract the generic part and here
you go you have discovered a gen server
I'm not going to talk about that I'm
going to talk a bit more about deleting
details of how Jen server is actually
promoted in OTP how its kind of look and
how we can do something similar again
the same power so the answer to how this
is implemented is openly special
processes and their specialty special
process is a contract of sort or the
closest should do how it should be and
create
it should respond to various things in
order to play well with other OTP parts
so when we further the special process
contract began a lot of things for
example our addresses fit nicely
division trees they support the cyst
module phony mugging and processes
messages for example those used by the
system to do sistema cosas sobre started
during the collaborators and this is
important because when when our process
and can use all the tools that it gives
us to introspect our system and gain
knowledge about what is happening there
and as we learned previously it's very
important to know what our processes are
doing so how do you prevent a special
process there's a lot we first we need
to use the properly like module to start
the process instead of spawn we need to
initialize our options we need to when
we when we've done our initialization of
the process we respond to starting with
again with rocket attack which may make
the star twinkle returned in the color
and whenever we receive this message
with a tuple of three elements with
first level mixes Adam we need to call
the system system message function and
this function does not
turn instead and calls back either the
system continued called back from our
new job or the system terminate back
there's a lot of this this a lot of work
isn't that something simpler and there
is we can reuse things we already have
most of our each answer so we haven't
talked about in the face of the server
so briefly about that so we have those
six callbacks actually have seven and
the seventh one is important when
defining our own behaviors so those are
any temple caste and more info tabulated
code change and the last one is forward
status this callback allows us when
reports are printed by the by the system
for example analysis diced or something
comes up when we're respecting the
process in observe observer this allows
us to show only the user state of the
process and not our own state that we
we're handling is hydrogen server to
handle the user process so it gives us
this nice way of hiding the details of
implementation of our behavior I say
that our user to see what he is doing so
we have server so use your server for
everything and we pulling the dress up
and databases collection which our
website
chat rooms we just serve as they
distribute their service but that's
awfully reminds me of a sentence that if
all you have is a hammer everything
looks like a nail so here we start to
talk about other things about custom
behaviors to first one first I would
like to talk about is the connection it
comes from the illicit connection
library and it's an abstraction on top
of connections where we have the OBEX
regular ol Betsy finding jen selter plus
two additional comic this correct that
are called to connect your server to
something and this connector
disconnected from something additionally
you can return when you return chuckles
from cortex life reply reply you have
additional two options for the first
item it can be connected or disconnected
there is also a back off if you try to
connecting but failed and i think this
there's one more or disconnect case but
it's not not that important it's a
wonderful library that allows to hide
the parts that are the same in every
connection because after we disconnected
from a service we're going to try to
recollect and and when we initialize our
our library we are going to be
connecting to this and initial advantage
is that the initial connection is down a
sexual industry from the perspective of
the column of the starting process
example is provided but the process on
the accept messages after with we've
established the initial connection so on
top of the connection library there is
another Erickson library that i would
like to mention and it's called typical
action this library has can guess
abstracts connections to databases so he
here we see with game tab a lot of
callbacks but if also lost so we've lost
to generate random callbacks that
allowed us to handle any message we
wanted instead we get a set of the
messages for handling as Pacific use
cases where database connection can be
used so we have comic disconnect connect
it replaces the traditional in it
disconnect work we disconnected and pin
that is there's a bottom at opinion of
the other database the connection wasn't
abusive or or sometimes database with
closer so we want to prevent it there's
complex or checking out the state of the
connection I will talk about this more
week later and there are struggles
actions I have a beginning commit and
rollback and there are callbacks for
handling queries but we want usually to
prepare where the first and then call
execute the prepared statement in order
to gain efficiency and if you want to
close the paper statement we have
hanging clothes and recently the London
support for native cursors in the
databases with have to declare made the
cursor with first next in the other kind
we have life cycle of the cursor this is
a very interesting thing because for
many database interaction libraries that
i found when you have some by some
streaming access to the database it's
usually implemented either as limitless
offset and going through the table or if
you have but then this there's a chance
that you're going to miss some events if
there were a certain while you worry
where is executed we're going to execute
twice too personal some items but many
databases title- curses i know of
posterous my square wonder probably
others too and why not use them and a
company to do
the connection is another behavior with
the connection pool that obstructs oh I
forgot to talk about this out of state
route out of steady process area things
so the idea behind it is that when we
receive data from the database it's a
lot of data and seven then between
processes is costing so instead of
receiving the data from the US in the
collection process we're going to check
out a socket to the process that
actually wasn't data stream the native
language there and check check the
socket back into the connection process
and the library takes care of properly
monetary of this and handling cases
where the process that check out the
soccer dies suddenly and other cases
like this so the pool is very
interesting approach for abstracting
over pools and how many implementations
of fools are there there's a lot of them
each each one has its use cases of
course but can we find something common
across all of them and have an
obstruction that we use the food and
later we configure summer which
implementation we actually want to use
so for example you could switch from
poor boy to do something else I think if
you want and the typical action comes
with two new team whose phone is
available boy single option the other
one is implemented over as a broker
which uses solder types or and accuse of
requests and connections and here we
have some callbacks are common across
pues tu e check out the resource
checking back disconnect is called on
our resource type is disconnected and
stop to stop the richness and on top of
all those connection off on the
connection liner and demi connection
connection pool builds actor the
database library for Alexia and here we
have the high-level behavior of a
database adapter that does various
things we are unsure or starter to start
all the applications that need to be
started
or the the adapters work have child's
back to start the adaptations a
visionary have loader star person to
generate for proper dumping learning the
daytime when it's coming from the
database into the database prepare
executive circle is updating it for
querying the database transaction
support there are additional extensions
force storage management so creating
database dropping them migrations in
Duncan database state so then we can see
that from the beginning from the initial
J server going through the connection
connection pooling adapters and only
hired higher obstructions that allow us
to have generic things but specific for
a particular use case and this is out
for end for example tree collection
library is used by those databases i
mentioned earlier so prosperous my
squirrel smuggle to manage the common
things for all databases in one place
and we gain customizable pooling and
things like that as a box so that was
all about data so maybe we will switch
to to some other place and another guru
there are a lot of acres is cowboy
so main Canadian ranch is the ranch
transport behavior that defines
callbacks for accepting sockets
connecting them communicating with the
subjects of a particular kind so it can
be brought to such a connection can be
an HTTP connection and the WebSocket
connection whatever want but what is
interesting is that we also apart from
from the callbacks that related to many
practices you also have callbacks are
related to many configuration of of the
light of the library like name secure
messages and those are the compacts that
I mentioned in the beginning calling
them data banks the data-driven
callbacks we are not only managing the
traxxas but also some data way there's
also a branch protocol which is very
simple as a startling now I would like
to talk about how women work and plug
and plug is an amputation in the laser
that obstructs the connecting HD
collection and it's built on a very
basic principle of basically having
that's called sequentially having a set
of suppression flats for one by one and
exactly something something very similar
is kind of a middleware defined by
cowboy but I don't think it's used that
likely to define a reusable components
so they are same but different but
actually the same cowboy and black but
what I find interesting is that even
though they are so similar and they are
used very differently so how are you
find a single execute callback which
receives from the request and there's an
environment and plug as very similar
Paul callback that receives the
connection that encloses all the state
of the request in response in everything
and options whether those options are
prepared by the image callback which is
usually called it compiled to dispute it
to speed things up and not trousers all
the options each time we call them metra
cowboy also so the interesting thing is
that is here that for black drum a lot
of plugs defined as reusable components
that components for authorizing users
but also normal levels things like
processing particular Heather's getting
cowboy I don't think they're there are
that many reusable ones and there are
tools to build them just do what is
doing this and another interesting
protocol in cowboy the behavior
countless the cowboy rest in there this
behavior where that allows to define a
very declarative way arrest and i think
is ideal this comments because i think
there's a bajillion of them and this is
a scientific term but this is there are
flow diagrams only the documentation of
explain how everything is wired together
and this is a very interesting way to
look at having connections by declaring
what we can do with them and i think
it's a great way to abstract / rest
videos and finally i would like to talk
about finish which which is a behavior
divide the feelings that obstructs a
pops up collection so instead of in it
we have joined when some
however one network handling messages
coming in we handle messages come out of
the of the connection our standard later
a new info for out of bad messages
family code change as usual Heather out
has a star because it's handled it
differently since we usually don't
process messages coming out in any way
it was decided that by bypassing that we
can make things much faster if we're
sending each if we're sending message to
each recipient we sending the same
message and process which recipient we
don't have to capture each channel and
we can send it directly so the hell out
of all that has to be defined it from
all time and if it's not it's it's not
not cold as
and in hockley the HTTP library there's
technical handler that abstracts again
with a booze but in a very different way
and I did not release him do I have
limitations of notice but it's also good
same idea which we need something else
struct account of booze and last things
I'm last thing I would like to mention
is jenn sterger to learn more about
later it's heavier that obstructs proper
processing data streams so there's a
good way to do behaviors there's a bad
way to the behaviors that slide is your
address to DD and links your users
because the bed waived the behaviors is
with macros and the first room of the
macro clap isn't don't use macros so I
send a lot of right libraries that try
to do something like behaviors but
injecting a lot of cavity to your
modules and that's definitely not the
way to do them to do that and I think
more elixir programmers should learn
about property to define them
and so that was 750 the customers
questions
one of them is uptown customers
let Cyprus all levels to the most seeds
look at the bite
and so it's something our communities
come construction or
a little bit by accident
so when it comes to Jason this is
usually dominates with protocols that
allow you to switch basically today till
you have so it's much much easier but
yeah there are also many different
tradesmen processors processors and this
is the problem that I don't think it was
one way and but i think this we can look
at plug here that was cloud was defined
first as a protocol for doing general
HTTP processing and later most of the
things in the next year that dude HD
processing use them behavior so it was
an abstraction that was the first before
the implementations so to speak and here
we have there wasn't no there was no
common obstructions abstraction for
serializers for example no matter Jason
XML or anything but it shouldn't be that
difficult to work now is difficult
because there are implementations are
not compatible but impressively it's not
difficult to say like a serializer
here's an interface for a serializer and
when everybody is combined to them to do
interface which must easier to switch it
out to change to something else
other questions
that
straight mark
the next stop would be about ginger
stage which is exactly the processing
stream data it's worked on 14 things
extremely extremely interesting other
one dollar to steal the subject may be
learning to that question and what why
was not there's not a 35 way to decode
neck or data we can use like just have a
abstraction layer in between that talks
to library on one hand and he is 23 fire
behavior by whoever's consuming it
whether in your app or wherever else
using pasta rest for example does that
at most reps for example is that where
if you want to have a data type that is
not officially supported it can just
define a custom data type behavior and
translate between phosphorus and
whatever likely you want using 2d an
encode the data so that's why there's no
this is not as neat as to have something
that's like universally fine two candies
for your app namespace fine hey you want
and I just like translators for whatever
terms you might be applied and that's
actually what I am NOT doing when I do
json DNA encoding
i wouldnõt quickly found something
that's neato without having to change
lights everywhere so I have like three
point behavior they're just access and
have a little translation layer there
goes to the actual light without music
you mentioned that hot girls are our way
to remember
right but did you need to use markers
the bad things I was talking about is
that many libraries elixir inject
basically define gen server for you in
your module and then have private
functions to customize the behavior
instead of accepting hold that module
probably here we call back module as an
argument when you start the process
similar to one you call just start as
the callback module and then those Kovac
salafi there and are called as needed
one downside of injecting that code is a
complexion as slow because the countries
combined over and over and over again
each motion tablet users and also it
becomes much harder to debug things
because finals lines are messed up often
and things are not where you're looking
for them it gets even more hairy where
you override functions it kind of a very
messy to find out what is actually
happening there and behaviors are nice
way to abstract it and to have it
other questions
okay thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>