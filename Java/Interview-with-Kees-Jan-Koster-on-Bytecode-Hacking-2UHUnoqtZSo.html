<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Interview with Kees Jan Koster on Bytecode Hacking | Coder Coacher - Coaching Coders</title><meta content="Interview with Kees Jan Koster on Bytecode Hacking - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java/">Java</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Interview with Kees Jan Koster on Bytecode Hacking</b></h2><h5 class="post__date">2013-11-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2UHUnoqtZSo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright so welcome for our second night
hacking event at the j fall conference
we are going to do some bytecode hacking
with case how you doing case I'm fine
thanks how you good good this is a
pretty lively conference since I already
gave my talks I'm all relaxed and done
well I'm not still do and I have to
decide to form it off my dog still so I
like improvising but you have plenty of
time you're fun alright so before we get
started with our bytecode hacking I
wanted to play a quick video clip from
the conference here the NL Jack puts on
the conference and they've got some some
pretty cool intro videos that used of
keynote so Burke gave me a copy of it so
without further ado
alright cool so um that's about the
conference but we're gonna we're going
to show some school bytecode hacking so
for it start why don't you tell us a
little bit about your background and why
why would anyone want to hack java
bytecodes well the most important thing
to know about java bytecode is you don't
need to hack it I mean you just it's a
something that I like to do is to open
the hood on the things that i use the
gadgets my car everything i like to
tinker with it and i think that's really
good exercise to do so at some point I
started doing some compiler building I
was working on some small languages and
as an exercise i added concurrency to
the popular brainfuck language and for
that i needed bytecode engineering
because i couldn't express what i wanted
to express i couldn't express it in Java
which is a good thing right java
protects us from crazy stuff and but i
needed more than what java could give me
at the time i could I can show you the
code that I need it yeah yeah yeah not
switch to your desktop and show a little
bit of what you have going on all right
I'll make it slightly bigger if that
works yep so here's a very short piece
of C++ this is actually a legal c++ if
you look carefully what you can see is
that we have a switch case and we've got
an if statement and contrary to what
Java allows us to do these two are
actually interleaved are intertwined
they're not neatly nested as Java would
force us to do so here we have some code
that I can express in C++ will compile
and will run and in Java in the compiler
despond letters so here's a use case for
you if you are building concurrency and
you don't want to use threads want to
use continuations do it by hand well I'm
afraid this is aj watch out for the
camera above your head
alright so good so this got me started
with the bcl library sorry what was that
Jim was wondering if he got a glamour
shot or not we'll find out back so from
there you know I haven't used it much to
be honest that is the main reason I got
to start it and then at some point I
thought hey let's do a presentation on
this because one of the things I noticed
in Java and you notice here on the floor
when you talk to the even though
recruiters they talk about frameworks
you know and if they recruit two starts
talking about frameworks there's
something really odd so what I see is
that there's a large movement towards a
lot of frameworks and while it has a lot
of plus-sides and a lot of good things
that brings us it also takes us away
from the actual Java the actual
underlying language and what happens
there so I thought wouldn't it be cool
to have a presentation on the subject of
the lowest level in Java that you can
have and hence I made my presentation on
java bytecode hacker cool now I've done
a little bit of bytecode packing my past
as well but that was a long way back
before we had good um frameworks for
data binding and doing like object
database type mappings but I think it's
quite useful skill for any Java
programmer to understand what's actually
happening into the covers and then have
some tools they can use to hack it but
that's my point the understanding part
you don't have to use it in your daily
life but you have to understand how it
works what it really is that you're
working with all right so going to show
us something right yeah I can do it I
can do a short piece of the talk maybe
I'll show you what what I've done in the
talk
I'll just pick out a few slides I mean
it's done I'm not going to do the talk
here right you can watch it later yeah
here's essentially dad just of the talk
what I want to do if you look at the
screen you can see there I've drawn a
picture of the jvm and what I've done is
I've drawn in a transformer highlighted
it to show that this is something that
will be making during the talk so during
the talk we will put something in the
jvm that allows us to transform java
bytecode as it comes from disk and
before it goes into the actual class
loader and objects are made of it we can
transform it add stuff to it remove
stuff I think you may be starting a new
trend here you know let funky um you
know newfangled XML and different
programming styles i think hex cody
might start becoming fashionable i think
it would be useful because it would
force people to understand a lot more
about what they're doing there should be
a time like that yes so I'm going to
also present different frameworks I see
for doing well you know it's a cross
between aspect-oriented programming and
bytecode hacking because you really
don't want to write your whole
application or what what you have to do
in java bytecode you just want to
install a few hooks that actually hook
into your main application and for this
this is a slide I stole from the
internet the link is actually invisible
on on your screen for you guys oh you
got it there so this is a slide from
someone else who gave a presentation on
bytecode engineering all right so I
think of those frameworks I played with
all of them except I don't think i play
with java cysts much i think that's the
newest one in the bunch right well java
cyst I think it's very interesting one
because it it allows you to do java
inside java and while that it gets a bit
mind-boggling at times it is actually
you know the the easiest way into
bytecode engineering so I collect it
very much for the idea
what which ones do you like the most and
why I mean that these are all different
yeah so I i mostly hate getting down
with a sm and bcl because it's a pain in
the ass yeah cg lib you can do kind of
cool stuff in and i find the
aspect-oriented programming doesn't let
me do enough usually if i'm doing
bytecode hacking i'm doing an odd use
case i'm not just adding like log
methods around method handles or
something so right well that's pretty
much covered by spring you nowadays
anyway I mean you don't need anything
for that that's the only addition I made
to this particular slide so for the
really odd things yeah well I'm afraid
you're going to have to use at least
Java sis that's probably the lowest
level and you can go down from there
yeah and yes the painting else is there
it's one of the slides I don't know
where where it sits don't wait so this
is the closing slide I'll use and this
refers back to your point about vcl nasm
cool so do you have any examples of
stuff which you've you've hacked on or
modified or or kind of personal examples
of things you've done recently with
bytecode hacking well the most important
one was I was working at a customer site
and we had the problem that database
connection transaction for being closed
by one of the myriad number of
frameworks they were using and they used
essentially anything on the planet they
use for persistency so what we couldn't
figure out from the code anywhere where
these database connections were being
closed so that's actually the use guys
also used for this presentation is that
I made a very very hawkish tool
that data in tripwire that essentially
allows you to instrument an individual
method with a stack dump so if that
method has ever called it results in a
stack down and you can see who closed
your database connection okay so as a
debugging aid for a fairly complex
project with lots of frameworks yes yes
and trying to figure out which one of
those was closing two connection and
it's actually I mean if you look at the
code it's fairly simple and it's not
something you would run in production
for a long time but you know it did a
job that was the important part cool
have you ever tried on bytecode hacking
on code generated by a JVM language like
groovier scholar your choice of no I've
actually not know I tend to stick with
the languages as they are so or build my
own I reverse decompiled some Scala and
that was enlightening what was that what
did you get out of that oh I mean what
was the biggest surprise there for you
so that in the project that was creating
a dsl for well for java affects the
skoloff xdsl and the reason i was in the
bike decompiling stuff and figuring out
work because i was trying to figure out
if the the unboxing optimizations i put
in to avoid boxing and unboxing we're
actually working so the bike co told me
you know and i checked and initially it
wasn't working and then i added in the
the proper annotations and type support
so it could do primitive collections and
things and i saw that the unboxing and
boxing wasn't happening anymore which is
good but to get to the code i had to go
through so many like generated classes
and levels of indirection and different
stuff which which scala had put out
there probably partially due to the way
i designed my dsl but at the same time
to get the syntactic look I was wanting
I couldn't really change it
but that code was really gnarly you're
really happy that was generated rather
than written by oh yeah well yeah
perhaps I was less happy it was
generated when I saw what was generated
yeah I can see that yeah that that's
also I mean bringing it back to
framework that's also what I many times
feel with frameworks people just
generate stuff and take oh it must be
good because the framework is good and
then you know they call me for
performance problems and well they have
a skill problem rather or an interest
problem not so much a performance
problem alright cool so let's see if
there any questions if you're watching
on the live stream the chat windows open
2nite hacking calm so type in a question
to chat in a last case and I'm going to
pick on Jim here hey Jim any questions
for for case we've entered the
interactive part here here's the
microphone so women so what in you
understanding is the origin of cafe babe
the first the first for hex bytecodes
CAF EBA be e on your slide you remember
that so what's the what's the origin of
that no I don't know honestly I see it
and I can take its wild guess but all
right what's the origin of that you know
I used to know here Jim what she does
well folklore has it folklore has it
that that the original developers of
Java like james gosling andrew von hoff
some others were there was a there was a
coffee shop nearby so they used to like
to go to that coffee shop which is one
reason they called a Java but there was
a lady at that coffee shop and so they
just I guess they kind of liked her and
so they they called her cafe babe and
and so that so the first what four bytes
of the bytecode you know like many any a
oxys right our start with MZ right for
for some for somebody you know the
initials that that that came up with
that particular standard the exe
standard same thing with java bytecode
cafe babe so now a serious question so
how do you explain your man maybe you
covered this already but to what do you
attribute your passion for you know
twiddling byte codes and things like
that I mean you really like to get your
hands dirty but what's the what's the
origin of that passion why do you why
are you so passionate about that well
that's actually easy question to answer
because the basis of this is all
curiosity you know I see something and
it works why does it work I I can open
it up I can open it that up I can open
that up like you did with your DSL I
just want to know what's under the hood
and just keep digging until I really
understand what makes me passionate
about that is that i found it severely
lacking in many people I worked with a
lot of people what I what I see when I
hire people when I interview people I
look for that same curiosity for that
passion and there are so many people out
there who are essentially doing Java for
a day job with all respect but you know
the really good ones they are the ones
that have that drive to dig and to
understand things that everybody else
takes for granted so I tried to be that
one alright thanks very much the
questions gym and appreciate the
interview case alright thank you for
your time so you can watch more of the
videos at night hacking calm and to
close out I'm gonna pop up the NL jug
logo since we're broadcasting live from
the J fall conference so enjoy the short
video clip
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>