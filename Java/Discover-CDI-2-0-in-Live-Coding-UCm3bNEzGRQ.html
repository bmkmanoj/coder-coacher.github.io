<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Discover CDI 2 0 in Live Coding | Coder Coacher - Coaching Coders</title><meta content="Discover CDI 2 0 in Live Coding - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java/">Java</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Discover CDI 2 0 in Live Coding</b></h2><h5 class="post__date">2017-10-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UCm3bNEzGRQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hello everybody nice to see you here
it's nice to have you here instead of
having an ice jam events on which are on
Dean Univera
so today we are going to talk about CGI
- and we are gonna try to make some live
coding and CGI - so let's start by
presenting myself so I'm not when
suppose you are working for reddit I'm
the CGI to speculate and you can follow
me on Twitter and get up and etc I'm
also working on micro profile project so
will will have a big use of CGI and
macro macro profiles so there will be
some feedback from the macro profile
project in CGI for the next version so
it's I'm very exciting about about this
so what are we going to talk about I
will present you CGI - in two slides so
if you are not totally aware of all the
new stuff in CGI - I also put a link to
another presentation regarding all the
new feature of CDI - and I don't have
the time in 45 minutes to list all those
and make life cutting as well during
this presentation
I will check existing code I presented
era I think one year ago regarding
matrix integration with CDI this
integration was done in life coding but
with CDI one - now I'm going to take
this integration and show you how we
migrate it to CDI - so most of the stuff
we will see in this talk will deal with
advanced feature on CDI and extension
but there will be some how to set daily
user stuff as well but if you are not
very aware about CDI extension you have
to - to keep focus - to get it so what
are we going to do we are going to
switch the existing test
are in this project and use the new CIA
C feature to launch our test so the test
currently are using our kuleana we will
use CGI SC to launch them and after that
we will migrate the existing matrix
extension to CDI 2 if we have time I
hope so
if the live demo gods will be with us I
add a NASA Kanu's event to the to the
project as well and we will finished ok
so let's get started so what's new in CG
I took two slides so we added the
support for traversing as we are running
in Java C we had to add feature to to a
low activation of request context
because request context doesn't have al
to say the same meaning in Java C that
it could have in Java EE so we added a
feature to activate this context in the
context art of Java C but it can also be
used on Java we had a lot of
announcements on event so the most
important announcement being the a
synchronous event support and the event
ordering support so you can check as you
see you can check the the the talk in
the link below to have all the details
we also added an spawned to interceptor
so now you can use Interceptor on
produce bin before it wasn't possible so
now you can add int asymptotic protein
we also add some helpers like the
built-in annotation literals so it's not
a big deal but now you won't have to
create on your own your own annotation
literal to to create an annotation
instance and we introduced the
configurator API which we'll go and see
a lot in this talk so the feature that
we will use in this talk is the support
for Java C the event announcement
perhaps in the end with the synchronous
observer the built-in annotation literal
in the config configurator API okay so
that's the two slide for CDI - if you
want to know more about CDI to learning
kiss is below okay so let's start with
the existing project matrix CDI so a big
a big a fast review of the matrix
project so matrix is a very simple
project from drop Rosati
it provides you a different matrix type
so we have control ganj matter time a
written use it to a matrix on your hand
a project so you can use different
reporter method to to get the
information
J mix console the log etc you have in
the center of the of the project a
metric registry well all the all your
metrics are stored and drop wizard
provide you with annotation that you can
use on your own framework to implement
AOP so to be able to annotate a method
or class we have time to count etc but
there is no code behind this you have to
develop it and that's it so that's for a
quick review of the prasada and now last
year we created the integration of the
adopter of metrics with CDI so what did
we do we achieved the following goal we
added the capacity to produce inject
multiple metrics so metrics are the
timer cones metal etc of the same type
so we can produce them we have Cydia we
added all the code needed to have the
matrix annotation usable as interceptor
and we also added the fact that if you
access matrix
through cd-i with the @inject annotation
or through the metric registry a
classical way of getting access to do
those metrics to get the same matrix if
you use the same name which is not the
obligatory the case because monitor our
guests because you when you ask for a
metric to the metric registry registry
and this metric sorry doesn't exist it
is created automatically so we started
from here so this is very basic code
using metric so no CDI here so here you
see there is I have an class helper with
the registry which is a static field and
I have a method for which I want to have
a timer so what what I do is to ask to
the registry and timer call my timer if
this eat this timer exist
I get the existing timer if it doesn't
matrix crates for me I use this timeout
to start to measure time with the time
of context I do all the stuff I have to
do in a try-catch block and in the final
block I stop the timer so that's very
basic code without CDI and in the end
after the integration we ended there so
we added the capacity to produce
different metrics so here we are
producing two timer one called my timer
and second one called my second timer
and the real original and the capacity
to use the annotation provided with
metrics so here we use the attend
annotation and we say ok this method
should be
time to say Monsieur biometrics with the
time of my time also we all will have
the my timer timer sorry
retrieved from matrix registry and the
time of the execution of the method will
be recorded so that's what the current
code is doing
so now let's visit this code a bit
because if we want to migrate it to do
CDI to it perhaps it's better to to get
it yeah it's there so let's start with
the the test of the project to be sure
that we are testing things in
interesting things so this test right
now is using arquillian everybody knows
that Killian okay so for those who don't
artyom is the way to build a micro
package of your application with all the
components you need and I have several
like environment but you have a lot of
different plug-in frottage and so you
can decide what you want but IRRI it it
needs to to other java ee lights with
CDI deployment and use the feature of
CDI so you can with italian you can use
the art injection your test to inject
different beam so in Anarkali and test
you have a method annotated at
deployment the static method in this
method you describe what you are
creating in what you are putting in your
archive so here I'm creating sorry I am
creating an archive called test at work
and I'm putting all the elements in the
package or oxidizer matrix I also you
and also add information from outside so
I'm putting in my war both jar the
metrics core and the metrics annotation
so I can package it
in the in the world to opponent all this
information and of course I add the
beans xml2 activates idiot and yeah
and lastly nightly I'm activating the
extension so I have an extension we will
see it after that I am adding this
extension here in the package and I
return
yak I so I can take this and make the
deployment my tests are simple so the
first test is we are testing should
interceptor be code so I'm calling a
method on the MGB bin which is injected
here if we look at this method you can
see that oops sorry
you can see that this method is
annotated with at timed with the my
timer timer timer and we want to check
that the timer was in the school during
between the call so we are testing here
so we are getting the timer called my
timer and we are getting the information
how many times were called and we are
doing an assertion here the second test
is the test about having injected
metrics through CGI and retrieved
metrics through the metric resist which
is the street being the same I repeat
again when you are doing this with the
street timer and you put a name here if
this name wasn't already used if you
didn't already try to reach with metrics
with nan my timer it will be created
automatically so the idea here is to
make sure that the timer I object
each year with the name my timer is the
same than the knob sorry then the timer
are rich with it with the same name from
the registry we are doing this test ok
and
yeah and lastly I'm interested in the
fact that all the matrix I have declared
in my program my application are
registered in the registry that that's
the last test okay so if we if we go to
the to the extension that that does the
magic hero so my CDI extension who is
not familiar with CGI extension here
okay Oh only one guy great sorry for you
I'm going little back and CJ assumption
so extensions are a way to modify all
the metadata we have in CDI so mainly to
register new bean to modify existing
bean and to modify add annotation
roughly add annotation an existing
element to add feature to the to
determine so here in this extension we
have a different kind of method so for
instance the first method is very simple
we are observing the before being
discovery lifecycle even so when you're
when your container CGI called my
starting it fires all kind of seventh in
certain order so here we are listening
to the first event before bin discovery
and in the beef up in discovery I can
add one annotation as the qualifier as a
CDI qualifier so here I'm taking the
metric annotation that I don't all that
come from the metric and I'm adding it
as a qualifier the second
method here is about interceptor so I
want to check the at timed annotation
coming from matrix and say ok now it
should be an interceptor binding because
when I get it it's nothing it's only an
annotation so I want to declare it as an
interceptor binding so I'm doing the
same I'm observing the same event you
see here and I'm using the before in
discovery method which is called ad
interceptor binding in this method I
have to add a new data type of the
Interceptor binding I want to add I
could I could have add the class
directly but it's not possible here
because the if we go to the time
annotation you see here the time
annotation as to member name and
absolute the problem is if you if we
don't add information to this member
they will be used to distinguish two
different version of the annotation so
if you write for instance at kind of my
timer of our at time of my time or two
there will be two different interceptor
bindings so I have to create two
different interceptor one for the at
time my
my timer and at time my timer - so I
have to add specific meta annotations on
those number
it's the non-binding annotation that's
the reason why I cannot add directly I
cannot add directly the time class here
I have to create an annotated child
which will add those non binding on all
the members so I have created an
implementation and that's what we are
doing in CDI extension most of the time
implementing the spi to add our feet
earlier so we will have a look at that
later but I created my own and I tried
to add those non-binding as definite the
third is a very interesting part of the
extension it's the part of the extension
that catch all the produced metrics so
here I observed all the producer that
define metric so I'm doing this because
I'm observing the even process producer
the wild card here say this this
producer can be in any class but they
should produce see see being anything
that extends metric so all the producer
that produce metric will be will trigger
this this lifecycle events
I'm also injecting the be manager I can
do that in any observer the lifecycle
event what i'm doing here is i'm testing
do I have the metric annotation on this
on this metric producer if it's the case
I retrieved the name and with this name
I create my own producer that will do
some magic stuff we will see that later
but it roughly it will check if it will
check if the matrix is already in
registry if it's the case it instead of
creating the metric it gives me give me
the metric in the registry and if it
doesn't exist in the registry it welted
address to the registry amount and
returns it okay sorry
and the last method in the in this
extension in fact is the method that
makes sure that all the metrics that are
declared as a producer will be created
before the application runs that that
unsure the fact that I will have the
same metric in a registry and metric
that in that I will inject okay so we
can run this test right now I will go
even deeper in the code after that and
we know if I can run it right now yeah
so I'm launching the test so my eye I
didn't mention it but I just use testing
G but you can use g-unit without in
program I'm using test testing G because
it will be easier later with the CDI C
to bootstrap the container so I have my
three tests passing and I want to show
you that this code here is not dummy
code or funny stuff so if I command one
of those method I think some of the my
tests one pass yeah so here I commented
you see a comment at the the part that
at the time the as interceptor binding
and
the test that is called should the time
intercept or cold
don't pass so it's not it's a real code
here okay whoa okay so let's start
perhaps I have some slide on the topic
okay let's start with the switch to se
so before switching to AC we're going to
switch to CDI to so to switch to CDI - I
have to go in my plan XML and I have to
change do you see is it readable okay so
I'm gonna change the version of CDI
which is here and I have also to change
the version of the implementation so
right now I'm using wild two four five
I'm going to switch to the last version
of well three which is the reference
implementation for see yeah I will the
wild free that oh that one final and I
have a change I guess
let me check no it should should be okay
so now let me show you that we are
running CDI - so if we if we look at the
big engine if we look at the console
here you see that the version of well is
two four five okay if I run my test
again should be free oh one crossing
finger okay okay you see free one so I
I've switched to CI - oh right now let's
do a bit more so we are going to use the
CDI SC bootstrap API so it's looking
like this so we introduced
two new interface one interface and one
class by the way so the SC container
container interface and the SE cotner
initializer interface
so we've initialized oh you have a
pattern you can create a new instance of
the initializer you have a lot of
feature we can disable beam discovery
and add all you been one by one you can
add the property here we are in class
and in the end when everything is ok for
you when wa you have the right
configuration for your Europe Nara you
call the initialize and it returns you
living now with the of the of s equals
no type so here in the example I'm using
the container to retrieve a bin of type
myself okay very simple because the
container is implementing the instance
interface if you are using the
programmatic look up in Cydia you
probably know a lemon okay so we are
going to use this in our test so if I go
back to the test which is here I'm going
to remove all the arquillians stuff so
here I will not externally on and I will
remove this method okay
so let's create a method to launch after
something like
okay start me up I don't have the music
I won't sing okay so I will use what we
just saw so I'm creating a sip of
nursery and a sea container viable with
the right spelling and using the a sea
container initializer creating a new
instance and adding the the package for
my test so I have to add so I can add
the package through the class so I can
say okay add the package with the the
class so I can take this class so I'm
adding all the stuff in the test and I
can also add I have also to add all the
the package and in the project so I'm
going to type metrics extension class so
I'm adding here all the packages in the
test and in the project from forth of
this class I also have to add the
extension so cutting the add extension
and putting ear the the class of my
extension matrix extension
whoa
I have a new spelling metric extension
okay and should be okay so I can call
the initialize here with the dots will
be better okay and so now I have my
container so if my test here weren't
using injection I could stop there I
love the company it's ok but you see
here I'm injecting stuff in my test so I
have to do an extra trick to perform
injection on my test so that I have to
retrieve the bin manager so what I'm
doing here could be done in g-unit
extension or a testing G listener to
have something cleaner so it's only to
show you so I can retrieve the be
manager from the container
ok with the bin manager I will be able
to create what is called an injection an
injunction target so let's go for the
injection target and the type will be
the my the type of the test class and
this injection target will be created by
the bin manager I have to provide sorry
for that I have to provide an annotated
type so created era ok should be ok
I'm gonna be more readable if I do
something like this okay and after that
I will use this injection target to
perform injection on my test object so
I'm injecting this and I'm creating a
creational context as it's not been with
the with the scope I creating a
creational context if null so I have a
default default wanna and last but not
least if I want this code to be started
before all my tests I will use them at
before class so in test ng you can use
the this before class on non-static
method which is not the case in g-unit
reason why I switch to test engine like
this but there is a some trick even jig
need five I guess I saw that so here
what I'm what I've done I removed all
the occasional reference and created my
own boot section so it's okay to be
honest it's a bit messy the part here
but you can imagine having your own is
now doing that automatically so now I
can launch my test based only and CISC
and it's not working
okay so yeah well yeah that's normal
why do I have this because I only add to
my project name limitation for Travis I
don't have all the class for Travis so
you have to change in my poem all the
the dependency for well taking a bigger
package forward so let's get sued okay
that's so I don't need
I don't exactly on anymore so yeah I can
add dependency not sure I will find it
so well yeah it's this one well as she
shaded and I'm going to take the last
one which is which is not here yeah so
free one final so I'm adding this I'm
removing the the dependency of well only
for Java and putting the one for Java C
otherwise I won't be able to bootstrap
documentation it was to make sure that
everyone was following okay so now I'm
running the test with my own container
so yeah you see that I have new
information here regarding the
transactional service that I don't have
but I don't need transaction in my test
oh okay so the interest of that is a
Korean maybe bit avis in some music some
use case so there you can use the
minimum CDI stuff to play your test and
to show you that to show you that the
this bootstrapping is working everywhere
I will switch my implementation and use
the over implementation which is open
web beans and I have an open web beans
se which is so the last version of open
web beans se is the 201 so era
I removed well switch to open web beans
running the test the same way so I don't
change my code or need the dependency
Cresson finger
so it's working by the way you see that
open web in ZZZ more verbose at the
lunchtime but can be interesting because
it lists all the all the bins discovered
at boot time ok so now we we are using
CD is so let's let's go to our extension
and start me right check no time wow I'm
speaking to ok
let's start with the first part here we
don't have to do anything
metric as qualifier we can keep it
because we are only using a class it
becomes interesting here you see we are
adding an interceptor binding we've
annotated type I have to create it so
what is doing this class an attitude
type with all method non binding
so in this annotated type I'm only
decorating an annotated type so here
delegate and I'm returning all the
value of a delegate made the litigated
under data type except when I asked for
the methods when I asked from the
methods I will take those methods and
Easter instead of threatening the
methods I will replace them by a
non-binding and attitude method which
decorates the method bit complicated
the idea is to say ok I want to to be
able to say I have non binding on this
method where it's not on the original
source
so this non-binding annotation method is
doing quite the same and it's only doing
stuff regarding the addition of non
binding to the method so when I ask for
the annotation on the method I take the
original annotations and add non binding
and when I am asked about the presence
of non binding if it's if it's that I
returned true so I have for this little
feature of ideal non binding on all my
element I have two class here plus an
upper class here non binding literal to
have some thinking so free class free
classes I will replace replace it with
simple CDI to code so yeah I can use the
new feature from Cydia the configure
interceptor binding so instead of adding
my interceptor binding like that I can
configure it I can get the methods of
the Interceptor beneath will close that
and for reached of this method I will
take the method and I don't need the
curly bracket but anyway and I will add
non-binding I'm not using the I'm not
using the non-binding literal I created
anymore because I have now literal in
the spec and that's it
oops I mean what's the problem here
yeah I have to I have to go sorry I have
to give them of course I have to give
the the class okay so yeah
I removed three big class and two big
class and one once more and put
something very small instead let's try
if it's working
yeah you have ten minutes to show you
the D and H it will be quite easy next
is one of the most tricky part of the
code so the ID here I'm going to show
you the idea error is when I detect this
in my code so I'm producing here a timer
which is a metric it extends them the
metric it implements the metrics
interface I want to be able to not
execute this code each time I want to be
able to check the registry if I'm timer
if a metric if the name my time are
exist if it exists I returned the
existing one if it doesn't I create the
metric add to the registry and return
the stuff okay so in fact this this code
is the way that my user will be declare
my the metrics and I'm adding the next
and the next function the tricky part
that will avoid creating extra metrics
if it's not needed so to do that here in
my 1/2 code I have to descend to listen
the process producer as I show a
beginning I'm retrieving the metric
annotation on the producer because I
need the name to achieve the name of the
of Dmytryk I'm requesting okay and I'm
changing the producer that was
intercepted by the observer by a project
I created myself so that's the new
metric producer it's the same that we
see before era metric producer decorate
the existing producer okay and call
unlimited of the decorated producer
except when it comes to produce the
element so when I want to produce the
element I'm retrieving the registry here
it's a bit complicated we will see that
we to be simplified after that I'm
testing does the registry contain a
metric with the name I received if it's
the case if it's not the case I'll
register this new matrix by calling the
produce method of the decorated producer
and in the end I return the matrix from
the registry so I will use this code but
I will use it in simple simpler way so I
will get rid of this class go back to my
extension yes
okay so era this line will be used
anymore and I will use so PP is my
process producer and I have a configure
producer in it the configure producer
allow me to define a function to produce
the element the beam so I will produce
its Weaver
so I receive a creational context the CD
I will provide it for me and and I will
put the code sorry I will put the code
here that I copied from my previous
producer and I will check a few things
so here I don't need that anymore
because I have a very convenient way to
reach with instance in CDI - and this
convenient way
use the bin manager so I can create an
instance so that's the instance you know
as the programmatic lookup mechanism so
I can do this here this instance I can
select metric registry type okay and I
can get instance so here I have a simple
way to reach with the registry here I'm
not using metric name but name which is
here okay the same here
okay and the same here it's no more see
but it's expert II I'm not even sure
that I need that and I need to reach
with this decorate so let's do this
error so it's a producer of G
okay decorate and it's I retrieve it
from the process producer okay so I
won't need this line anymore and I don't
think the class I created anymore so in
a very Java 8 way I can have a cleaner
code launching the test crossing finger
okay I didn't test with open web beans
before so it's it's alive yeah and we
have few minutes left to do the last
observer in our extension so era I have
an observer that observed the event
after the problem validation so where
everything is ready to to run my
application I have this event after the
plant validation and I what I want is to
trigger the creation of of all the
producer in my application to make sure
that they are registered in the metric
registry to avoid the fact that I can
reach with different metric if I use the
metric 303 or if I inject the the metric
so era I'm going to remove this and use
something smaller so I gonna do what
I've done before create instance so from
distance I can select the element I want
to retrieve so here it will be
metric okay but not this one it's the
yeah this one take care because they are
the metric annotation on the metric an
interface okay
and I want to retrieve all the metrics
because I have the annotation on them so
I will check the any Poli fire used
deterrent and instance okay
so yeah I have a correction I have a way
to iterate on the collection of all the
metrics defined through producer in my
application so now I can use the forage
from my collection and for each matrix
in fact I do nothing I want only to
trigger the creation so it will trigger
the code in the producer era and make
sure that all the metrics will be
registered like this and it's Mac it
makes the code far far easier to read
easier to read sorry and should be ok we
finish it on that and it's nice working
ok that's it I think I don't have any
time left so if you have any questions
I'd be outside ready to answer and I
encourage you to to check the slides
regarding a CDI to a noose new feature
to have all the tournament that we are
presented in this talk thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>