<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Is It a Car? Is It a Computer? No, It's a Raspberry Pi Java Carputer | Coder Coacher - Coaching Coders</title><meta content="Is It a Car? Is It a Computer? No, It's a Raspberry Pi Java Carputer - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java/">Java</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Is It a Car? Is It a Computer? No, It's a Raspberry Pi Java Carputer</b></h2><h5 class="post__date">2014-03-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/F7Y4ZyqxtgY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the title of this is is it a car is it a
computer no it's the Raspberry Pi Java
computer and this has been a session
which I've I created last year as part
of the work I was doing for Java 1 and
it's certainly been a lot of fun I've
continued to work on this project over
time and I've had an awful lot of fun
actually doing this because I have to
admit I am a geek so I like things
technical I like things electronic and
computers and things like that
hence the job that I'm in but I'm also a
petrol head so I like watching Top Gear
and I like watching you know things
about cars and stuff like that so what
I've done is I've combined these two
passions into one thing which is the
computer now as an Oracle employee the
first slide that I always have to put up
is the legal slide and basically this
says that we're not committing anything
in terms of our future product direction
in what I'm telling you I think I'm
pretty safe that that is actually the
case so I think we can move on from that
fairly quickly in terms of the agenda
for this presentation what I'm going to
do is I'm going to start off talking a
bit about cars and computers in general
a little bit about how things have
changed over time and what we're
actually looking at today because it's
very interesting in terms of how
computers are used in cars talk a little
bit about Raspberry Pi and why I
selected the Raspberry Pi as the device
that I used to create my in-car system
and then we'll dig into how we can use
java embedded java JavaFX to actually
build the system that I got here and
then at the end I'm going to give you
some demos now you may notice that I
have no car actually in the room so I'm
bit limited in terms of doing an in-car
system demo but what I do have is the
system that I built I've got it here
I'll be able to show you that in action
and basically I replay some data that I
recorded when I was actually using my
car let's start that there are actually
seats at the front if you want to if you
want to sit in the front row
so let's start by talking about cars and
computers because this is as I say
interesting to see how things have
changed over time and what I did was
actually went back and I did a bit of
research so here is my first car the
MINI Clubman so who has ever owned a
mini anybody a couple of people right
mini is a lovely car the original mini
I'm not saying that the new mini is bad
but the new the old mini was a lovely
car because it was so simple in terms of
how it was constructed and the
technologies that were used in there and
literally there are no electronics at
all in this car unless you count the
radio and once that was stolen as it was
then there were no electronics in my car
at all it is purely electromechanical so
it has these things called points and a
distributor who remembers points and a
distributor few people feel a gauge yep
remember those things not many hands
going up here that's interesting it had
a thing called a carburetor and a manual
choke again who remembers the choke yeah
I get more people remember the choke
good it had drum brakes it had a dynamo
didn't even have an alternator it had a
dynamo and then for the luxury items it
had lights it had a horn
it had wipers that sometimes worked it
had a fan that would work if you stuck
your finger around the back and actually
spun it when you switched it on and then
it would actually start and then an
ignition switch now if you look at the
wiring diagram because what I did was I
still have the Haynes manual this is the
sad person that I am I still have the
Haynes manual for my mini and so I took
a copy of the wiring diagram for that
and as you can see it's reasonably
complicated even with that small number
of electronic electric devices on there
it's a reasonably complicated diagram
lots of connections between lots of
different things so let's move forward
to well 2011 and this is my current car
I have an Audi and this one actually has
lots of electronics on it I purposely
built bought it because it had lots of
interesting features and electronics on
it so for start it has an engine control
you
it and that means that the engine the
amount of fuel the amount of air the way
the engine works is actually controlled
by a computer and the nice thing about
that is you can actually reprogram the
computer and change the amount of power
that you can get from the computer so
not on this particular car but on a
previous car I've had I actually had it
remapped and I was able to get more
power out of the car just by changing
the way the computer worked it has fuel
injection it has electronic timing so
there's none of this points and feeler
gauges or anything like that
the throttle is fly-by-wire so there's
no physical connection between the
throttle pedal and the actual engine
it's an electronic thing where you
measure the resistance and then you feed
that information to the electronic
management system and it actually
changes the speed of the engine as
anti-lock brakes it has a thing called
the electronic stability program or ESP
I'm going to say that friend of mine has
BMW and he pointed out that the manual
says that you know ESP an electronic
stability program is all about making
sure that you're safer when you drive so
if you go around a corner too quickly it
can adjust the braking on different
wheels to try and correct understeer or
oversteer and in the BMW manual it
actually says be aware that the
electronic stability program cannot defy
the laws of physics which is actually
quite true so you can't do that it has a
thing called meet magnetorheological
suspension so the suspension system
actually has fluid in it which has
magnetic particles in it and then you
can apply an electric field to that vary
the electric field and they're very the
viscosity of the suspension system so
you can change whether it's comfortable
or uncomfortable that seems to be the
two modes if it has it has satellite
navigation that has all sorts of things
like Auto sensing wipers and lights and
things like that so what does the wiring
diagram look like for that it's actually
a lot simpler because there's too many
things to wire everything directly you
can't say okay well here's a light or
why that to a switch why the switch to
you know something else so what we now
have is a bus architecture something
we're all familiar with in terms of
electronics and computers
and in terms of like the Audi system
there's three different buses in the car
you've got one for the what's called the
convenience bus which is like the wipers
and the lights things like that
you've got the infotainment bus which
connects the satellite navigation the
speakers and things like that
and then your power train bus which is
the engine management system the
throttle and all the sort of important
things and the idea of having multiple
buses is that you don't want the the
information to get congested on one
particular bus and so we have different
buses for different signals in terms of
actually making use of this what you'll
find is if you look underneath the
dashboard of your car you will find a
socket looks a bit like an old scart
connector and what that does is allows
the garage to connect a device to it and
then be able to read information about
whether there are any faults that have
been detected in your car and one of the
nice things is that you can go onto eBay
and you can buy a box like this which
costs about about 10 pounds and it will
also plug into the same connector and
that allows you to access the
information that the garage can access
we'll talk more about that as we go
through this is called the obd2
interface onboard diagnostics interface
literally every car since about 2000
certainly in Europe has had this fitted
and there are different protocols that
are used through that interface in terms
of the the way the messages are sent
so the basic set of messages are things
like the throttle position engine speed
those types of things which are
primarily designed to give you
information about how the engine is
performing from the point of view of
emissions because that's one of the big
things obviously the Europeans concerned
about is how much you know carbon
dioxide nitrous oxide all those types of
things are being emitted by the car
there are other protocols that run there
as well so different manufacturers use
different protocols depending on the
systems are they use internally one of
the most common ones is this iso 15 765
the controller area network which you
may have heard of which is called the
canvas
and that's the way that all the messages
are sent between the different parts of
the system so you can identify that this
is a switch that's just been pressed and
this is the signal that's being sent or
you've turned the heating up and so the
knobs been turned a particular level
that kind of thing so it's all about
messages being passed back and forth on
the bus so that's the sort of basics of
computers and cars let's talk a little
bit about the Raspberry Pi so who here
has a Raspberry Pi ah lots people good
now the Raspberry Pi is very interesting
thing because if you look at the history
of it it actually started the project
started originally way back in 2006 it's
very relevant because here in the UK one
of the big problems that we have is
teaching children about computer science
so I have a seven-year-old son he goes
to school and he does ICT information
and communications technology as part of
his lessons what he does in that is
learn about really advanced concepts
like word processors and spreadsheets
and webpages and if he's really lucky as
he gets older and it gets into secondary
school they will teach him how to
program in HTML now I'm not sure about
you but HTML to me is not a programming
language JavaScript maybe as a
programming language but HTML most
definitely is not so the problem is that
children are not learning about real
computer science until they get to
university and that's a big problem that
universities are seeing so a number of
professionals a number of academics
primarily at Cambridge University got
together and they said that they wanted
to create something that would enable
children to learn about computing and
they base this really on a project that
was done by the BBC many many years ago
and this was called micro life who's old
enough to remember micro life a few
people who's old enough to remember the
BBC micro few more people okay good so
that was based around the BBC micro
lovely machine had a 6502 processor
eight bits a whole 30
two kilobytes of memory that's not
megabytes that's kilobytes of memory and
it was great you could program it you
could do all sorts of interesting things
with it you could play galaxians and all
sorts of great things like that and
that's really where the Raspberry Pi
came about Raspberry Pi is actually now
two years old and they literally you
know shipped millions of these things
now in fact that lots of people here
have them there's lots and lots of them
in circulation and people are doing some
very interesting things with them
from the point of view the specification
it is a nice cheap but reasonably low
powered by today's standards piece of
hardware so what you get is the board so
this is a Raspberry Pi if you haven't
seen one it's a little board and you've
got an ARM processor so it's a fairly
old architectures the arm 11 version 6
runs 700 megahertz
it's Broadcom single on chip package and
one of the nice things that they've done
is allow people to overclock it up to 1
gigahertz without breaking the warranty
I know I run mine at about 900 megahertz
not had any problems with actually doing
anything with that the current model
comes with 512 megabytes memory
initially it was 256 now it's 512 and
that seems to be plenty of memory to do
most of the things that people are doing
with these types of devices from an
input and output perspective and there's
an hdmi connector so you can connect TV
rather than using a separate monitor
you've got an audio out plug you've got
2 USB ports you've got Ethernet and then
you've got a row of pins which allow you
to connect all sorts of sensors and
motors and things like that using
various standards like GPIO SPI I
squared C and there's also a serial
connector there for you art in terms of
the storage there's no hard disk drive
you plug in an SD card and everything
runs off the SD card so when it comes to
looking at using this for a car system
it actually makes a lot of sense because
there's plenty of computing power there
700 megahertz 900 megahertz and half a
gigabyte of memory is plenty for the
kind of things that I've been doing with
my system the other nice thing about it
is it's very low-power in terms of
electrical power so it requires less
than 1 amp 5 volts which means you can
plug it into the cigarette lighter in
your car through obviously a 12 volt
five volt converter don't plug it into
the 12 volt supply directly use a
converter and then it will run quite
happily from the in-car power system
like I say the persistent storage is
provided by the SD card again that makes
it nice for an in-car system because if
you've got a hard disk drive in a car
whereas lots of vibration lots of
movement that can be a problem SD card
much more resilient in terms of
vibration and being knocked around also
for things like hot places and that kind
of thing
it's also one of the things that we are
supporting directly in terms of embedded
Java so we've selected the Raspberry Pi
as a platform where we're going to
support embedded Java Java SE Java ME
and make it so that people can use this
as a cheap platform to get started with
learning about embedded Java so that
gives us all sorts of things you know
we've done work in terms of improving
the performance around using the
hardware floating point processor as
part of the Raspberry Pi we've done some
work around Java effects and making sure
the graphics engine takes advantage of
the GPU in the Raspberry Pi and that
always seems to work very well so we
look at a little bit about embedded Java
and Java effects so why we've used these
types of things to develop this kind of
application one of the nice things about
Java is that historically it comes from
the idea of embedded systems originally
there was this way way back in time
there was this thing called the Star 7
which was really like the kind of
precursor to the iPad in some some ways
so it was designed to run in a device
which had very small amount of memory
you know literally eight megabytes of
memory was going to be a lot in those
days and what Java has done over time is
we kind of added
different versions to it we've tried to
targeted different types of environments
and so if you look at the diagram here
right at the very very small end there's
this thing called Java card and if
you've got a like a mobile phone then
you're running Java card because all the
GSM SIM cards have Java card on them
that runs in literally a few kilobytes
of memory then for bigger devices where
you've got maybe a megabyte of memory
then you can use Java ME now obviously a
lot of people think of Java ME as being
mobile phones and clearly we've not been
quite so successful in terms of getting
Java into smart phones so we've decided
that we're not going to focus on mobile
phones we will focus on embedded devices
things like sensors things like gateways
but they still count in terms of the
architecture from the point of view of
Java Mobile Edition
and so in terms of size in the region of
one to ten megabytes of available RAM
would be the kind of device where you
would target that sort of platform and
then if you've got more than that then
you can start using the full Java SE
environment the one that we're all
familiar with and you can use Java SE
embedded so that's being ported directly
to an ARM processor and that worked
quite happy in that environment in terms
of Java ME embedded the current release
is three point three and what this
provides us with is a small version of
Java to run in resource constrained
environments so you have this thing
called the connected limited device
configuration which is a basic virtual
machine and then a set of class
libraries that you need in order to run
your basic application on top of that
there's a set of different profiles that
you can add which add different sets of
AP is to address certain needs for
different types of applications and one
of the things that we've done fairly
recently is to include the device access
API or device IO API what that does is
gives you a standard set of libraries so
that you can control things like GPIO
pins you can talk directly to an I
squared C bus an SPI bus you can
communicate with a UART deucer
communication all from a standard
library there are other profiles you can
add but you know this this kind give us
a basic idea of what we could use in
terms of an in-car system the other
alternative is to use Java SE 8 embedded
and as I say this is an early access
will be releasing Java SE 8 as part of
the Java 8 launch later this month you
can download this from our website at
the moment you can run it on the
Raspberry Pi is no problem as I said
it's tuned for the the Raspberry Pi
environment so the hardware floating
point the you know different compiler
options being used and so on also
includes JavaFX so if you want to write
graphical applications using the
Raspberry Pi then you can do that with
Java SE embedded it's got compact
profiles which are part of Java SE 8 to
reduce the size of the footprint same
idea as in Java ME but slightly
different in terms of the way that we've
structured it and we also added this to
our standard build platforms so now
every time we do an update in terms of
like the Intel architecture or the Mac
or you know Windows or whatever then you
also get an update in terms of the
Raspberry Pi
JavaFX who's heard of jar FX ok most
people few people now john r FX is
really a replacement for swing so it's a
way of writing graphical applications
which is a lot more flexible than swing
so you can do much more interesting
things in terms of using a scene graph
you can do all sorts of effects you can
apply translucency you can you know move
things around do translations in a much
simpler way than you can with swing and
what we've done is to include that as
part of Java embedded and so I thought
well that makes a lot of sense because
what I need is some kind of graphical
representation of what I'm going to do
with my system a couple of things that
not supported on the Raspberry Pi as
opposed to the full system so there's
there's no video playback well ok I
probably don't need that in terms of
what I'm building here there's no
support for the web component so you
can't have a web page rendered directly
as part of your application
again I don't think for what I'm doing
that's too much of a problem one of the
things do need to think about is that in
some environments you constrain in terms
of resources so thinking carefully about
how you design your application how many
nodes you use in your scene graph and if
you start making very very complicated
scene graphs with thousands of nodes
then you're going to find performance is
an issue but if you keep it down to a
small number of nodes as we'll see you
can actually do some quite interesting
things so let's talk about then building
a Java powered carputer what are the
actual details of that well the first
thing I wanted to do is to think about
what were the design objectives of this
kind of system and really what I wanted
to do was to add to the kind of
information you get in your car already
so if you look at the dashboard you can
see how fast you're going so you have a
speedometer you can see how fast the
engine is going because you have a
tachometer you can see how hot the
engine is there's a temperature gauge
you can see how much petrol you've got
but that's about it really
some cars will give you you know a few
extra bits of information but really
what we're interested in is let's get
some more interesting kind of
information so things like how much
power is the engine generating what's
the talk that we're getting from the
engine at a particular time what's the
load on the engine and then tie that
into some of the driver data so throttle
position maybe get the steering angle
because there are steering sensors that
connected to the ABS system and the SP
braking force again that's the kind of
thing that you can get information from
the system if you know how to do that
and also I thought well let's measure
the g-forces on the car so we need an
extra sensor for that you'll see how we
do that but we could combine that add
the g-forces and see what's actually
going on and then the other thing I
thought was well rather than just having
the information played on the screen as
we're driving around we could also
record the information and then play it
back later so I can analyze my driving
style very formula1 kind of thing I can
decide you know okay I need to improve
my driving style use less fuel that kind
of thing
now as I said the the obd2 interface
allows you to plug something in which
will give you access to the information
that's coming from the car and so there
is this thing called elm327 little box
that you can buy from ebay and there are
the two main versions of this one is
Wi-Fi one is bluetooth so the idea is
that you plug it in and then in the case
the one I've been using it creates like
a little Wi-Fi not hot spot but it
enables you to connect to a Wi-Fi IP
address using peer-to-peer connection
and then you can read data from that
Bluetooth similar idea except using
bluetooth rather than Wi-Fi prices are a
little bit different so the Bluetooth
one is actually really really cheap it's
literally less than 10 pounds the Wi-Fi
one is a little bit more expensive it's
about 20 pounds for that one users fixed
IP address in terms of how you connect
to it so use ad hoc networking in terms
of configuring the Raspberry Pi to
communicate with that you have to edit
the etc network interfaces file and then
you can just say okay this is the
address I'm going to connect to and you
just do peer-to-peer networking there's
no route or involved or anything like
that what you then do is you communicate
with it as a sequence or bytes or
sequence of characters and it uses in
terms of communicating directly with the
device 80 style commands who remembers
80 style commands a few people modems so
back from the good old days 80 commands
are basically just a way of telling the
Box what you actually want to do so you
say 80 and then something after it if
you send it a command which is not 80
something then it assumes that this is
some kind of obd2 command assumes that
it is maybe a canvas command and things
like that so there's all sorts of ways
you can actually communicate with the
systems of the car using this next thing
I thought was okay we need a screen and
I need a screen that I can actually put
in the car so I found on eBay
and I really do like eBay because
there's all sorts of wonderful things
you can buy on eBay and so I found this
screen which was available on eBay
it actually marketed as a Raspberry Pi
screen
because it had an hdmi connector for it
but the nice thing was it was also a 2
din fitting and what that means is that
for the sort of older style in car
entertainment systems that sort of
narrow once that's a one dihn's fitting
so this was equivalent of two of those
and most cars will actually have enough
room for this in them ideal for the
center console originally I'll have plan
to remove mine satellite navigation
system and put this in the the center
console so I actually bought like a
fitting kit for that but in the end I
haven't quite got around to that because
I do find the satellite navigation
systems quite useful and this is it's a
bit limited in its functionality at the
moment has HDMI input as I said so you
can connect it directly to the Raspberry
Pi and it's also got a USB connector so
that you can have touchscreen events so
you can touch the screen get where the
touch happened and use that as part of
the application now this was one of the
first things I had to deal with was a
bit of a problem with the touchscreen
because when I plugged it in I found
that the Linux distribution I was using
from the Raspberry Pi foundation
recognized it so that was good
it had a driver for it and it recognized
it as a yee Galax ink device what it
ended was it created two devices in the
slash dev slash input directory event 0
and event 1 and when I tried it with the
the desktop environment it all worked
fine so I could touch the screen I could
move the mouse around and that worked
quite happily but when I try it with
Java effects it wouldn't actually see
any events so I couldn't use the touch
screen which are FX and I went back and
I talked to the engineers in Oracle who
were working on this and they said Oh
seems to be the problem is that jar FX
uses event 0 and all the information
that's coming from the touch screen is
going to event 1 so it was like well we
can do you a special build where we
switch from event 0 to event 1 but then
I was thinking myself or maybe there's a
way around this
so necessity is the mother of invention
I thought ok well rather than doing that
we'll just delete event 0 and then
recreate event 0 as the same device as
event 1 so major and minor device
numbers you use this command look Nod
create event 0 as a character
I sui major reminder device numbers as
appropriate and then I just wrote a
little script that ran every time you
booted the system that would delete
event zero and recreate it and that
solved the problem so that was all good
got around that that issue from the
point of view the architecture this is
what we've got so we've got the
Raspberry Pi in the middle there's the
touch screen which is connected to the
HDMI it's also got the USB for the touch
screen going into the USB connector
there's a Wi-Fi dongle to talk to the
elm327 device on the service port the
12-volt car power supply going through a
converter to give me five volts into the
Raspberry Pi and then an accelerometer
which are connected through the I
squared C bus using the pins that we've
got on the Raspberry Pi
now what this looks like in terms of the
the box that I've got here if we look
inside this is basically the sort of
design so I had the screen and then I
found there was a couple of sort of
screw thread holes that I could use to
mount the Raspberry Pi on there with a
bit of perspex and you can see here that
this is in my belief any good software
project should involve would work so I'm
used would work here to put some you
know mounting brackets in there and the
other thing you can see here is that I
had trouble sourcing a short HDMI cable
so I needed an HDMI cable the literally
was going to be about three inches long
short is what I could get was about a
meter long so it's kind of looped around
a few times and then sort of tucked in
around the the board I did actually find
a shorter one eventually but in the end
I thought what I've already done this so
I'll just leave it as it is
accelerometer so I found there's a nice
little board that you can get from
company would spark fun and it's
reasonably sort of not too expensive
it's about forty pounds I think No maybe
a bit less than actually forty dollars I
think it is so this is really nice
because it's got nine degrees of freedom
or nine degrees of measurement where
it'll give you an accelerometer in all
three axes it'll give you a gyroscope in
all three axes and it will give you a
magnetometer to measure the bearing that
you get
in terms of your compass reading in all
three directions so you can actually
move the device around any direction and
still get all of the information about
where it's actually moving to it's also
got some built-in processing power that
will take all this information and give
you some sort of processed version of
the data but I haven't really used that
so far what I've done is just use the
accelerometer and the gyroscope to get
information about the speed of
acceleration and things like that from a
point of view of using I squared C on
the Raspberry Pi you have to first edit
the cetera modules file to make sure the
I squared C support is enabled and then
if you use this I squared C detect minus
y-one that will give you the address on
the I squared C bus of a device it's
connected and that way you can then talk
directly to it in terms of the code it's
not too complicated you just have to
look at the manual and then figure out
the various bits and bytes that you've
got to send so this is if you remember
basic programming this is a bit like
peek and poke so you get the I squared C
bus you say I want to talk to a
particular address on that bus and then
you write some bytes to the bus and two
different registers on that bus saying
this is what I want to do so I want to
start sensing and you can also set the
configuration of things like the
gyroscope and accelerometer because it's
the raw material measure I think it's 2
G 4G and 6g as a scale I figured 6g was
probably a little bit of overkill for my
car unless I was going to drive it right
into a brick wall so I went for 2g which
seemed to be you know a good choice and
then you basically just read data from
that and it gives you the information
about what what's happening in terms of
acceleration well the other things
you've got to remember is to
compensating for gravity when you're
dealing with acceleration because the
earth does indeed suck and what that
means is that when you measure
acceleration there will be a constant
acceleration in the vertical because of
gravity so you just have to compensate
for that and so the idea was that
obviously just zero out zero out the
gravitational effect and the the
simplest way of doing that was to
actually
the box in the car so it was completely
vertical that way I could just say okay
the acceleration in one axis is going to
be constant and I have to worry about
what angle it is compared to gravity and
so on certainly for the purposes of the
demonstration that I think is is good
enough you do have to think that in a
more complex system you have to take
into account fact the car rolls game
around corners it dips and you know it
will actually move as you accelerate and
brake if you really wanted to you could
use the gyroscope information and then
use I thing called a Kalman filter to
compensate for fact that it is moving
and is off the vertical calculating
power and torque if you've got
acceleration and you've got data about
your car and you can find out how fast
the engine is going then you can
calculate what the talk and what the
power is that's being generated at any
given time
so talking newton meters is the matter
the car times the radius of the wheel
times the acceleration in g if you want
to convert that to good old imperial
units of pound-feet of torque
then you've got a magic number that you
just multiply Newton meters of torque by
and power in terms of bhp is just the
talk in pound-feet times the engine rpm
divided by another magic number so the
things I marked in red are obviously
things that we can measure reasonably
accurately but not super accurately so
we're not going to get a perfect result
in terms of the the torque and the power
from this system obviously the mass of
the car is going to change a little bit
because I can find out how much the
what's called the kerb weight is but
then I have to compensate for the fact
that there's a certain amount of fuel in
there there's me there's you know other
bits and pieces like car seats and stuff
like that but I need to figure out so
you've got a reasonable estimate of what
the mass is we all radius yes you can
measure that but you know the wheel is
not going to be completely circular
because the bottom of the wheel is a bit
flat because the tire and the
acceleration because we've got the
problems of going around corners and
things like that so we'll have a
reasonable estimate at what we're
actually getting in terms of power and
torque from the point of view of the
software having that look to the
hardware what I wanted to do is
obviously come up with a design that
would give me aware
representing the information I got from
the car so I thought okay well let's
have a screen based design so we'll move
between different screens to display
different sets of information start off
with a splash screen we'll have some
basic data from the car some advance
data then because we've got the
accelerometer we can also have g-forces
and measure that see what's going on and
to give us an idea of how things are
changing over time we'll use a graph to
represent a sequence of values and see
how things have changed obviously we
want a simple user interface if I just
put up seven numbers it's going to be
very difficult to read that whilst
you're actually driving and stay safe so
you need some other way of representing
the data and also how you interact with
it you need to make sure it's simple
because obviously if you've got a
complicated user interface from how you
actually talk to it then you want to
make sure that you're not doing anything
where you're trying to do something as
you're driving so I started looking at
what other people had done and get some
ideas from that and so this is a renault
McGann sport this is the older one on
the Left which gives you things like the
boost pressure on the turbo the throttle
position torque and power also tells you
what gear it's in and then they've got a
newer version which is more colorful and
gives you some nice sort of graphs of
like g-forces that are involved if we
move up the scale a bit this is the
Tesla and I was lucky enough to actually
go for a ride in a Tesla last year and
it's lovely because it's got like this
18 inch flat panel display in the middle
which gives you all this information
about what's happening with the car and
how it's being charged and things like
that so you can really sort of go to
town in terms of the interface that you
design and then if you go to the real
extreme this is the display from the
Lamborghini Reventon and this is where
you're into like you know battlestar
galactica kind of like starship land and
I look at this and I go I don't actually
know what most of these things actually
mean so they've got a really kind of
funky idea of how to do the the
tachometer so you know you've got two
graphs on either side with the number of
revolutions per minute and then the
middle changes to show you which gear
you're in there's some kind of circle
here which I don't quite
what it does and then there's a little
sort of diagram at the top again it's
not quite clear what that does so having
looked at all these this is this is what
I came up with a little bit simpler but
important to be simple so I thought okay
well let's do a sort of a simple bar
chart where we can see a value and make
it simple from point of view of the UI
design this only needs three nodes by
default so you have one rectangle for
the outer box you have one rectangle for
the value and then a red line which you
can use to indicate what maximum value
is you've hit so far and then if you
want to you can also add some numbers
which would clearly add some optional
nodes as well so this is easy to see
because if you look at it quickly you
can see immediately you know what
percentage of the total value that
represents so there's no numbers that
you have to look at constantly it's
quite a simple way of registering
information then I looked at okay so in
terms of the UI keeping it simple again
sequence of screens let's just go with
the idea one touch to change between
screens there's no like trying to find a
particular button on the screen or
sliders or anything like that it's just
you touch the screen it moves to the
next screen and we just loop through a
sequence of screens to get the
information don't want a menu again it's
too complicated so we'll just go for a
very simple kind of approach and one
thing I found is obviously in terms of
the way that we process that we need to
make sure that the mouse events get sent
to the relevant part of the display so
it can detect when you want to change
screen the other thing I thought about
using was steering wheel buttons so
repurposing some of the existing buttons
and saying okay when I press that button
then I'll change the the value on the
screen haven't quite got that far yet
because and we'll come back and talk
about canvas a little bit later on so
this is the the tip of the splash screen
that I came up with so I basically took
a photograph of my satellite navigation
system and then photoshopped it to add
Duke and the Java logo to it so that it
would have a nice-looking splash screen
then I created a basic data set of
results so this is
in the engine load the intake
temperature for air coming into the
engine the catalyst temperature for
exhaust going out current throttle
position and also the pressure of the
fuel going into the engine so just a
this is the sort of basic data that you
can get from the the engine then turn
that into some advanced data so again
got throttle position as before got the
engine speed now and also the calculated
torque and power output from the values
that we created of maths that we used
earlier then I thought okay for g-force
let's use it's a little bit difficult to
see on this diagram but the idea here is
that you've got a series of circles
which show you how you're accelerating
in a particular direction so the up and
down is basically acceleration forward
and backwards so depending on whether
you're accelerating or braking the left
and right is clearly whether you're
accelerating going around the corner so
left the right and then the the bar on
the right is the acceleration in the
vertical so you can see as you go over
like a speed bump or something you don't
see the acceleration as you go up and
down that way and I don't think you can
actually see it but there are some green
dots on here which represent the sort of
the maximum that you've achieved in a
particular direction and what I hope you
will see that we'd show the demo later
on and then I could say we graph some
results and show okay this is the
throttle position as I'm driving along
just some random data to see how I'm
driving over time I mentioned the idea
about using the the steering wheel
buttons one of the things you find is
that you can monitor the can bus so you
can see all the messages that are coming
on the can bus so in theory you can see
all the messages they're coming from the
buttons from the satellite navigation
system you can talk to the center
console and say I want to display this
piece of information you can get the
steering wheel position all that kind of
thing problem is that the car
manufacturers are not keen on sharing
this information so you can't just go to
the car manufacturer and say give me all
the details about the can bus that you
use and get all the data for that so you
we have to reverse engineer everything
and that means piling a load of data
looking through it and trying to figure
out where you press the button and what
that actually results in in terms of the
message that's being sent on the canvas
I haven't quite got around to doing that
in detail yet that's the next part of
the project really a few ideas I've got
for the future and also some conclusions
resources before I show you the demo so
one of the things I've thought about is
integrating a heart rate monitor I
thought it'd be fun to actually monitor
my heart rate as I'm driving around so
you can see you know match your heart
rate against g-force and you know as
you're accelerating things like that
also I'm kind of intrigued by the idea
of a heads-up display using like a
half-silvered mirror on the screen and
using like a micro projector to to
project information onto the screen can
bus signals like I say be really
interesting to do more work around that
and try and figure out things like the
brake pressure steering position all
those good things and ultimately you can
send commands as well as read them
that's a bit scary though because if you
start saying I want to brake right now
or I want to change the way something
works that could be potentially very
dangerous there's a lovely demonstration
I saw of somebody who had a it was like
a Toyota Prius it was one of the ones
that had the self parking system
built-in so there was a motor that would
actually drive the steering wheel and
what they've done is they had like a
Nintendo Gameboy that was talking to one
of these boxes connected to the system
and they could actually drive the car
using the Gameboy security is something
that is obviously not a major concern at
the moment because you can just plug
this in and there's no issues around
just being able to send messages read
messages and that sort of thing so it is
something that I know car manufacturers
are looking at in more detail for future
systems because the more these things
get connected the more you have the
ability to talk remotely to these
systems we do have to figure out how to
make them secure one other thing that
I've been working on recently is the
GPS sensor so you can also combine the a
information about the position so this
is just a DPS sensor I got from Adafruit
and that connects very easily to the
Raspberry Pi using the serial connection
and then I also got another little board
which talks directly to the canvas so
rather than having to go through the the
service port you can actually tie
directly into the the canvas on the car
so that means taking the satellite
navigation system out and just splicing
into some of the wiring on the car which
I haven't done yet because it's a leased
car so I don't know they might frown
upon that place to go for more
information obviously your phone howdy
fanon howdy comm raspberry pi dot org
has lots of information about the
raspberry pi has lots of forums and
there's all sorts of discussions around
lots of different things
JavaFX to Oracle comm and I've got a
blog which I do need to try and update
at some point which I've started writing
about what I've done with this project
so you can find more details there like
I said I do need to update that a bit so
let's just spin the last couple of
minutes and just show you some couple of
demos so what I'm going to do is switch
to this so the first thing I can show
you is that so this is a video that I
took with the help of Steve who I think
is in the back so the idea here was to
actually video the system in action in a
car so if I just run this and it's about
to it's not where I want
okay so this is basically it's a little
bit the project is not great but so this
is just driving around the car park in
the Oracle office and you can just about
make out the bar charts moving there are
probably a young I'm not going to show
you too much of that because the
brightness is not very good on the
projector but you can see this is
basically the idea so it's mounted on
the screw mounted on the dashboard and
then you just touch the screen and it
changes its view so if I just come out
of that because that's the you can't see
that till turn and let's stop that okay
so what I will do is I'll show you on
this system here hopefully you'll be
able to see this is if I go here right
so what I've done is I've set my my
laptop up so that it will actually work
as the the source of the data and then
on the display here I go so it'll take a
couple of seconds to start up hopefully
you'll be able to see this yeah does
take a few seconds start opening them go
through a bunch of messages and things
eventually will start up I'm almost
there we go okay so that's the splash
screen and then we should get yeah so
now what you're seeing is playback of
the data from my laptop of pretty much
the same run that we were looking at and
then if I if I touch the screen what
that allow me to do is hopefully the
screen yeah yeah change the display so
that's the advanced data and we've got
the g-force that bounces around each of
the the circles represents half a G so I
managed to get I think just over half a
G in some directions but not much beyond
that which is not really surprising and
then obviously the graph this is the
throttle position so you can see how
much the
the throttle is being used I found this
quite interesting because you find that
you actually use the throttle
surprisingly little most of the time and
then suddenly you do accelerate quite
hard and then suddenly it goes up quite
quite a lot and then just like the last
bit so that's just the power output I
think we've got the scale on this graph
wrong so it probably needed to be a
different scale but again you kind of
get the idea and then I had to have a
thing so you could actually get out of
it so there's this big exit button on
one screen but that basically shows you
the idea of how it works so we just
should just exit out of that right
because the other thing I can do is so
I'll just run this on here and then see
what that actually works so that should
then run the same thing but on my laptop
rather than up there go that's much
better you can actually see that now so
that's that's essentially the same thing
that's running on the box and then you
can switch between screens and see the
the values and that's the g-forces you
see that and then the graph of the data
so were there questions because I've got
about two minutes I think okay okay you
mentioned a problem with ICT teaching
the UK have you seen new national
curriculum if so what do you make of it
I must admit I haven't had a great deal
of a look at that I know they are
working on changing the national
curriculum and hopefully the changes
that they're making will make it easier
with using things like the Raspberry Pi
have you tried to read from bus directly
not yet because that's the the little
card that I've got the can bus card so I
will be trying to do that especially in
reference is a DMM is that same as in is
there you know so the MMI is just the
satellite navigation box on the on the
car the obd2 port is the one that you
actually plug in underneath the
dashboard so it is a different thing and
how much did the whole thing cost it
wasn't too expensive
yeah you can see I can sell really quite
hard there it wasn't too expensive the
Raspberry Pi obviously standard
Raspberry Pi price
a few bits and pieces in terms of the
box and the cabling and stuff the screen
was probably the most expensive that was
just over 100 pounds you can get cheaper
ones now I've seen a lot that are coming
out now which are cheaper so if you want
to get one you don't have to get this
particular one you can find cheaper
screens that are actually touchscreens
as well Adafruit did quite a small one
so if you wanted to make a smaller one
which was literally only about 35 40
dollars now so you could in theory build
this for under 100 pounds without too
much problem so with that I think I've
run out of time so unless there's any
other questions people wanna question
what we struggle in Android screen yeah
okay I'll explain that one let me just
come back to my slides and I'll point
that one out here it'd be this bit here
Oracle so so yes I mean I could have
gone down the Android route but that
doesn't quite fit with my business model
because I'm Oracle we do Java and we
don't do Android
yeah oh yeah I mean in that case you
could certainly use I mean the the sense
that I've used is fairly broad in terms
of its application but you can get much
more sensitive sensors for different
applications and because the the
Raspberry Pi in Java supports things
like the I squared C bus and SPI these
are very common ways of connecting to
those types of sensors so you just
change the sensor that's involved so
there's all sorts of different
approaches you can take but yeah you
could tailor it to a different kind of
environment very easily yes okay one
more question making salat on basically
all the can bus messages consist of like
a device ID and then a sequence of bytes
which are the the message that's being
sent from that device ID or there's like
a device ID from and advise ID to so if
you're sending message from A to B I'm
in a data packet so the actual format of
the messages is easy to to decode what
the tricky bit is as you say you get
like a stream of these messages and the
way I've seen other people do it when
I've looked on forums is that you
basically record a bunch of data and you
say okay I'm going to press this button
five times in a row or I'm going to
press the accelerator and make it change
a lot over this period of time and then
you've got to try and figure out from
that which is the message which ties in
to that event and then once you've got
an idea you go okay I only look for that
particular message and then you test
your the other things see whether it
actually works so yeah it's not simple
it would be much easier if you already
would just give us all the details of
the message no and I tried a number of
different avenues of research and
nothing came up from that okay so thank
you very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>