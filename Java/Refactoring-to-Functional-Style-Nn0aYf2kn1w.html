<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Refactoring to Functional Style | Coder Coacher - Coaching Coders</title><meta content="Refactoring to Functional Style - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java/">Java</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Refactoring to Functional Style</b></h2><h5 class="post__date">2017-10-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Nn0aYf2kn1w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright let's get started welcome to the
session on refactoring to functional
style my name is Venkat Subramanyam
we're going to talk about taking some
examples and infra-red a style and then
working our way through to functional
style I'll talk a little bit about the
motivations for doing this some of the
things we need to be concerned about and
then we'll jump into some examples and
start looking at a few examples of how
we can do this and along the way we'll
talk about some approaches we could take
so one of the things to consider is a
lot of mainstream languages in fact most
of the mainstream languages that we've
been using for the past 20 to 30 years
have been promoting imperative style of
programming in imperative style of
programming we talked about how to do
but we also proceeded to write code to
express how to do it so imperative style
focuses on both what and how and it's
the house that really gets into trouble
because it gets us into trouble because
it relates to accidental complexity what
declarative programming we focus on
saying what to do but not as much and on
how to do it well functional style
inherently is declarative in style
not all declarative code is functional
but all functional code is actually
declarative that is one of the most
charming features of programming and
functional style is that we can focus on
the wart and let underlying libraries
take care of how to actually do it but
one of the challenges with java 8 is
unlike the previous versions of Java
Java 8 was not about syntactical change
it's actually a paradigm shift it
requires us to think very differently
and program very differently and I'll be
honest about this I spent several
decades programming an imperative style
I can tell you that I spent my youth
programming in a period of style that
tells you that I had a terrible
childhood and now I'm trying to recover
from that and start programming in
functional style and it's not natural
for me I have to think really extra hard
to think in functional style and I have
to say that I'm probably about a 50%
level into it now if you throw a problem
at me maybe 50% of the time I can think
functionally the other 50% I have to
struggle one of the most interesting
experience was on a flight not too long
ago it was across Atlantic flight it
took about nine hours of flight I
started with the problem in the
beginning of the flight and struggled
with it for seven hours trying to write
in functional
style I'll tell you it beats any
in-flight entertainment you can have and
then when I was done with that it was
like well why did I have so much
difficulty doing this because hindsight
is 20/20 once I had the solution at the
end of the seven hours it was like why
did I have so much trouble and what was
really making it hard for me is my
background my comfort level who really
makes it hard for me to think
differently so that's what I want to
focus on the paradigm shift how we can
approach this maybe in a way that can
make things a little bit easier for us
as we consider shifting to functional
style I'm not recommending taking
existing code and changing them all to
functional style I want to make that
very clear
I believe in producing value so there's
good code working just leave it at like
the way it is for now but when you come
down to fix the bug make an enhancement
or you're trying to revamp major parts
of it that's a really good time for us
to revisit and maybe change the code but
also as we sit down to write code we can
clearly write it very quickly
imperatively the new code but then maybe
transform it functional style that's a
really good way to learn as well as we
get very comfortable with the style of
programming so let's get into some
exercises and play with some examples
here I want to start from the very first
example I'm going to focus on five
different examples in this presentation
given the time so let's see what we can
do first I'm gonna start with an
imperative style of programming code to
begin with well I mentioned that
imperative style is where we say what to
do but also we say how to do it let's
take a look at an example real quick
here
I have a little function here on the
main that's looping through and telling
whether the numbers 1 through 7 are
prime numbers or not well they say never
refactor code that doesn't work well
this sum seems to be working ideally I
would have automated tests for it but in
this case this is good enough for what
we do here so in this case of course
it's working and giving us the result
but here is the East prime method of not
try to be very smart about this method
I'm not trying to make it very efficient
just take a very simple looping I say 4
and then of course I loop through this
for loop ask if a number is divisible by
that range of numbers if so I set the
variable to possible and then I exit out
of it now if you look at this this is a
very reminiscent of a lot of stuff we do
folks there are some chairs in the
right if you want to just walk through
the front please feel free to do that so
there's a lot of seats in the front over
here and and if there's a seat next to
you just raise your hand so it's easier
for people to okay - well thank you very
much appreciate it okay so let's look at
this code for a second and see what it
really says well I have a challenge for
you when you go back to work on Monday
do this for me do what we grab on for in
your source code and be scary how many
four loops we use this is like somebody
knocks on their door II opened the door
there's a guy with the hammer you ask
him what he's there for he says I'm here
to fix your kitchen you say re don't you
are you not gonna use any tools he says
I got a hammer I don't need any other
stinking tools you probably will let
this guy in and go out and call the cops
it's not safe to be in the house anymore
right well that's what we've been doing
been using this for hammer for
everything we do and and it's insane
that everything is for and occasionally
a while loop that we use but in this
case what did we do we loop through and
then check for a condition and then set
the boolean to be visible to be true and
then we have to control the looping but
let's put this in English what are we
really doing well why should we put in
in English the reason I put it in
English is it really makes us to think
about what we are doing and that can
help us to capture the essence of the
wort and then we can look for methods
that actually translates English to code
so let's see what we are doing given a
number we want to find the range of
numbers so that no value in the range
divides the given number so that's a
little formulation that can actually
help us to think about it a little bit
better so let's give it a try and see
how we can rewrite this code in more of
a functional style so I'm gonna start
importing in this case Java dot util
let's say darts dreamed out star and I
said range of numbers well the word
range immediately prompts us to think
about an int stream so I'm gonna go
ahead and call this as in stream so
we'll say return number is greater than
one and and into stream dot range from
two to the given number well notice the
for loop went from two to one list and
the number that's exactly what range
does as well it goes from the number two
of the number minus one the range closed
will include
number but range doesn't so we have the
range of numbers let's again go back to
English I say that given a number the
known number in the given range divides
the given number well in other words
nothing matches our divisibility
criteria and the method we are looking
for here is called none match and then
given a number in the range number Mart
I that we are interested is equal to
zero so that code in the table that you
saw here translates to a very small
piece of code in the bottom I mentioned
that we have been using the for hammer a
lot in the past but this one is using
very specialized methods little little
methods little tools it's like you hit a
knock on the door again you open the
door there's a guy with a little bag and
you ask him what he's there for to fix
the kitchen he lays up the tools and you
say wow look at that there's a real
wrench there's a little screwdriver
there's a little chisel well those are
the tools of his trade right you ask him
are you gonna use all of those tools he
says the one who uses all the tools is
called a consultant no I'm gonna use
only what makes sense for the project
and the point really is we're gonna use
these little specialized tools to get
our work done and that's exactly what
the range function and the non match
function are going to do for us as you
can see that result of that code is
exactly the same as before but what we
did was we translated that fluffy code
in front of us into something very
highly expressive I'm not looking for
code that is short that is not the
objective what I want is code that is
concise but also very expressive that is
what I'm really after you take much less
effort to read this code and understand
once we know what range and non-match
means of course that becomes a lot
easier to work with so that is an
example of how we can use some of these
ideas to create a little function that
can tell us whether a number is prime
but more so to really iterate over the
range of values and get the result we
are looking for so that's less noise no
garbetts variables that divisible was a
garbage variable we're not introducing
unnecessary variables here and of course
we used higher-order functions we are
passing the function to the function
which is an unmatched function so that
really helped us quite a bit here let's
go on to the next
example here again from imperative but
in this case we're going to go to a
functional style of code and I want to
know how many lines in my text contains
a certain word now in order to do this
how would we write the code for it in
the traditional Java let's take a look
at an example here so I have a little
main function as you can see here and
this main function starts up and first
of all opens up a bufferedreader and
connects to a file reader as you can see
and it's opening up my ADC host file I'm
interested in searching for the word
localhost and I want to know how many
lines contain the word localhost so what
am I doing here I first of all create a
line and set it to null and we all know
that null is a smell and then we go
ahead and say while line is equal to
bufferedreader dot read line is not
equal to null
it's code like this we should never show
the children because the minute they
look at it they say heck I've never will
be in this profession again and they do
something else would rather be
accountants than doing this right so the
point really is and not that it's bad to
be accountants by any means though but I
would rather be writing clear and
concise code so the point really in this
case is I really don't want to be really
writing code this is clumsy and so
imperative and noisy then what do we do
we check if lines contains that
particular word and then we increment
the count again and then we keep looping
through it that's a lot of ceremony in
our code and when we are done finally we
declare the win and report the word
contain the occurs that many times in
the file well so how do we really work
through this very differently this is
one of the things that really excites me
about Java eight is they just didn't
deliver lambdas and walk away they then
took a very decisive approach to
enhancing the JDK to improve all the
different methods that can be really
functional in nature so let's see what
I'm gonna do here now I'm gonna take
this code right here and let's go ahead
and comment this code out for just a
minute so we can actually refactor it
and I've called this variable as count
so I'm gonna say a long that count is
equal to but how am I gonna find the
count of this well the very for
thing I'm gonna do here is I'm gonna go
ahead and import a Java dot n io dart
file and then in this case I'm gonna use
the class which is the files class in
fact let's take a little bit of baby
steps to come to it so pardon me let's
go ahead and run this first before we
try to modify this I'll come back to
this in just a second and then of course
when I go back and run this we do want
to make sure the result is actually the
same it said occurred three times I want
the same result when I'm done with this
great now let's go back here and just
comment out this piece of code for a
second and let's take a bit of a baby
step in getting towards this let's go
ahead and bring in Java dot IO dot file
dot star and in this case let's go ahead
and say over here files and then dart
lines and then this is going to be the
lines method and this takes a path yet
and I'm interested in the path to what
is the file I'm interested in well
that's the path I'm interested in so
I'll use the path variable right here
and so I'm gonna ask you to give me the
path of that particular code that's what
I'm asking for so a pad start get so
what does that really give us let's
quickly take a look at what this
function returns to us and thankfully
what this is doing is it's returning to
us a stream which is really nice so now
that we have a stream on our hand we can
use the stream API to do further
processing so what I'm gonna do now is
now that I have all the lines in the
file I'll say filter over here and then
I will say given a line that is given to
me
let's say line dot contains exactly the
code that we did right here but we cut
through all that other fluff by now and
then we asked for the search word we are
interested in and that really gives us
the number all the lines that meet the
criteria and then we set that to a count
and then now of course we can simply say
long account is equal to and then we can
set that into that variable right off
the bat right there and then so when we
run this code now we can see that it
gives us the same result as before but
we didn't have to put in so much effort
to do this so the Lions method of files
gives us really nicely the ability to
get a stream out of this and process it
so we can again
of all that ceremony in the code and we
can use a functional style of coding for
this so lines gives us a stream and
given the stream we get all the lines
that meet this criteria whatever that
criteria is and in the end we do a count
of it and get the result out of it and
that's exactly what we did in this
example so that's another way to look at
it so we saw the nun match in the in
stream now we are looking at files in
the in lines in the files
class itself and these are all helping
us to get our work done a little bit
more effectively
once again no explicit variables we're
using the stream and the filter method
to accomplish our job in this case let's
go a little further now things can get
really ugly when we try to do a little
bit more complex things we're gonna look
at a firmly verbose code to do something
really simple this is when you realize
the problem is simple but the solution
becomes overly complex and that's when
you know we are heading in the wrong
direction you don't want the solution to
be more complex than the problem really
we have that would be the accidental
complexity let's look at one example of
this to see what this really means so I
have a little main here with these
scores as you can see right here what
this course is doing is it's putting a
bunch of names and score values into
this map so in card people's name
potentially and score values but what I
want to really do is print out who has
all who all have a common score so let's
go ahead and run this code to take a
look at it Tom and Nancy have a score of
11 Jack is the sole person with 12
Darla's Nick and Jill have a score of 15
but the question is how do we really do
this in the imperative style you can
just imagine how much effort we're going
to put to do this you first create a map
of course with the score values and a
list of names that's where the trouble
that starts is ended then you get one
score value does this exist in the map
already no it doesn't create an empty
list insert the empty list insert the
name into that anybody wants to do that
absolutely ridiculous isn't it but
that's the kind of code we've been
writing for years where this simply
sucks the life out of us as we start
writing this code in
very smart developers never write this
code we hire interns to do this stuff
and and that's why this becomes really
tedious to work on and it's not fun at
all
doing something like this over time so
what can we do to improve this it is
insane because remember what functional
style does you tell what to do and you
let underlying libraries figure out how
to do it so you can look at all these
lines in front of us about ten lines of
code is gonna just disappear in front of
our eyes
within seconds right now so let's go
back over here to this little code right
here and then grab the entire function
comment that out and then what we're
gonna do is return well we're gonna
start with the scores that's coming in
as an input right here so we're gonna
start with this scores right here but
we're gonna say in this case key set and
I'm gonna simply get the key set from
this particular scores and then again
ask for a stream out of it then we're
gonna ask a collect now before I go
further into the collect I want to spend
a little a few seconds talking about one
thing that is very very important which
is called a collectors if you have not
had a chance to I highly recommend you
spend a Friday evening with collectors
your night would be wonderful I promise
you because collectors is such a wealth
in the JDK I keep discovering the power
of collectors time and again and there
are so many wonderful methods within
collectors and and it's it's one of
those API is that's as powerful as
anything else could be and so it gives
you a lot of these api's are convenience
methods to do certain operations on
collecting things so collectors is one
of my most favorite classes utility
classes in the JDK so I'm gonna come
down to the collector method and I'm
gonna say grouping by in this case given
a particular person's name I want to
group the values based on scores don't
get the name or to get the scores of the
name itself and you can see how the
research is exactly like what you just
saw earlier but of course some of you
are not too happy because I wrote too
much code here will reduce it even
further now so I can now say take this
one and say well okay we can act
we make use of method references in Java
8 so we can take this one and say scores
double : get and we can write it much
more concisely as well so why write more
code than necessary and you can see this
so if you ever want to get into a
competition ask one of your colleagues
to write that code and while they're
still starting up you can write this
code and eat their lunch so that is one
of the beautiful things about how
concise this is and it's pretty insane
how powerful this is you're saying given
all the scores get me their key set and
then go through a iteration on the
streams using the streams on the key set
and then just start grouping them based
on the score values for those names and
that's we turned those set you know 10
lines of code into some will argue 3
lines of code but I always argue because
there was only one semicolon that's just
one line of code so so that's basically
how concise it is that you can actually
make it very powerful as we can see
that's yet again a wonderful things we
can do with the library of functions
available to us which is pretty pretty
darn nice so the code is very highly
expressive it's very declarative in
nature but of course in this case we use
some very specialized functions and that
is something that's going to take a
little bit of time and getting used to
because when it comes to some of these
functions we do have to take the time to
figure out what functions are available
so there are two approaches I think we
should kind of take to understand this
one is when you formulate the problem in
English you can go back and ask the
question is there functions I know of
that kind of matches these kinds of
actions and you can do this the other
thing I normally do is you know
everybody has only limited relative
ability to remember things we can't
remember everything unfortunately but as
I kind of walk through the JDK as a walk
through libraries as it just brought
browse to the documentation I would come
across methods I probably have never
seen and immediately I would take a note
of it I would just pass for a minute and
take a look at it and say hey what in
the world it is doing and it's just in
the back of my mind and another day when
I'm working on something else I might
say oh yeah I remember seeing that
little method back then and then I would
go look at it at that time or I would
put it away for maybe experimentation
over maybe a free time that week
and I will play with some of those
methods to see what they do and that
just becomes part of your you know a
capillary as you program and just like
the groups by method one of my other
favorite methods is a method that can
help us to split a collection into a
couple of different things for example
well you know I was giving a talk
recently and when somebody said hey I
understand filter very clearly if I have
a collection I can filter out maybe only
objects of a certain value let's say for
a minute just as a crude example if I
want to separate this room into two
parts I want people who are older than
me and people who are younger than me
well that would be a filter if I say
only people have anger than me would be
a filter and what that collection would
have is people younger than me but what
if I really want to collections those
are anger than me and those older than
me well further would not help you with
that but the beauty of that is you can
actually use in that case a partition by
method and a partition by will give you
this collection a map which is going to
have one part which is in this example
people younger than me and the other
part of what older than me for example
so you can use some things like that
very nicely to achieve this let's look
at one other thing this example actually
I would be I have to say was actually
inspired by somebody who attended my
previous talk they they attended the
talk and they emailed me and said I came
to your talk really you know excited to
see this but my problem is here is what
I'm trying to do and I can't figure out
from the examples you gave me how in the
world to achieve this so I really thank
the person for the question gave an
answer and I kind of said that's a great
example so I'm going to replace one of
my examples to use this particular
example so let's take a look at what
this person wanted me to work with so
here is a little example of Euclid's
algorithm and all this is doing is given
a collector numbers it wants to give you
a collection of numbers where the
property that a square and a plus B
square is equal to C square so for
example give me all the numbers for
which this property of a square plus B
Square equal to C square is met and if
for example when I run this code you
will see three four and five meter
criteria three square plus four square
is equal to 25 which is five square so a
b and c are three four and five and so
on but that's an infinite number of
numbers you could actually look for but
the person wanted me to show how to
solve this problem
the gentleman actually sent me the code
when the imperative style and said hey i
could do it this way I've got a function
called get triple you can make things a
little easier which is returning a
string here so get triple is simply
returning the a B and C values for which
this criteria is being met and that's
this you could algorithm to do this but
I want all the numbers up to a certain
number let's say so in this case you
notice what I have is a very traditional
code we start with a for loop on M going
from 2 to M plus 1 and then of course
I'm sorry m equal to 2 2 all the way up
incrementing by M plus incrementing m
and n of course starts with 1 but falls
one-shot of M in that sequence and then
we go a call to get triple for M and n
and then we add it to the triple we
increase the count and if the count is
greater than the number of values we
expected
then we break out of the loop and then
of course this is really sad isn't it
you have to do this check one more time
this is how imperative code punishes you
twice and so you have to really check
again as well and then you break our
definitive there triples so the question
is how do you really do this notice that
we have two for loops in this code and
that's a bit confusing how do I deal
with two for loops I know how to deal
with one for loop I can use a range
method I can use a filter I can use a
stream I could use a map but here I have
two for loops how in the world do I deal
with it well to understand this I'm
gonna take a slightly different example
to illustrate how we would work with
this so imagine just for a minute
I have a collection of person take
example of people in this room we got
wonderful people in this room so I have
people in the room so I have a
collection of people with me and what I
want is every person has a function
called get a primary email so everyone
this room has a email a primary email
I'm I'm sorry I don't want you but I
want your email address so I can spam
you what a great idea so how do we do
this well the function here is a
one-to-one mapping
meaning given a person you get an email
of the person so what are you use for
that you say people dot map and then you
say person and you can say person dot
get primary email and that's basically
how you would do this in your code so
you can get the primary email very
nicely so that works really well as you
can see how well we're on the other hand
if I have another function which is get
all email addresses let's just say all
emails this is going to return a
collection of all your email addresses
some of you may have one email I - some
of you may have - some of you may have
seven I mean it's so much fun to spam
all the addresses not just one of them
isn't it so I want to map people to all
their email addresses sadly this is a
one-to-many because I go from a person
to get email all emails and so this is
emails not email anymore if I said
peopled a person or people rather dot
map given a person person d'art get all
emails well what do you get as a result
you go from a collection of person so
this is a collection of person on the on
one hand so collection of person to
collection of list of email here that's
not probably what I want is that's what
I want we got a winner but that's not
what I want what I really want is a
collection of person do collection of
emails so I want really the collection
of all the emails one single list how
would I go about doing that let's draw
some inspiration from groovy for this
because Java doesn't quite have it
so in groovy I'm gonna say list of let's
say one two but I'm gonna say three four
and then let's say five and let's go
ahead and say six seven and let's say
eight over here I want to know how many
elements I have
so I'm gonna say list art size to get
the number of elements and it tells me
I've got six elements we know we have
six elements but we actually have eight
elements but we have a list of lists on
our hand so the one and two are one
element 3 4 is 1 5 is the you know
fourth one and five six combine our six
seven combined is one but I really don't
want those collection of collection I
want to flat out one single collection
how do I really get it so if you notice
over here that's the list of lists I
have on my hand but instead I'm gonna
say let's start flatten and then I'm
gonna say darts II's and now notice in
this case when I flatten it out the
value that I get is eight on my hand
well likewise if I just print out the
flat and the collection it is a flat in
the collection one single collection not
a collection of collection so flattening
is a function available in a quite a
number of different languages Java quite
doesn't have it but the good news is
while Java doesn't have a function to
flatten list it does have a way to
flatten streams well almost
so what we really want to do is we want
to perform a map operation let's go back
to the example we saw a minute ago so we
want to perform a map operation but
while we perform the map operation we
also want to flatten it technically you
could have called it a map flatten but
that doesn't sound too well so it sounds
like a tongue twister so they called it
flat map so now you know what a flat map
yes
use a flat map when you have a
collection of collection in other words
when you have one-to-many relationship
your candidate most likely is a flat map
that's all my mind is wired to think
about it anytime I have one-to-one
transformation I use a map if I want too
many transformation I ask the question
maybe it's an application to use a flat
map in this particular case let's take a
look at how we can benefit from flat map
in this particular case in this
particular example so let's go over here
to the code we are dealing with notice
we have this collection of collections
but if you really think about it what is
this collection yielding this inner loop
is yielding a collection which is the
triples and we
put those collections into one flat
collection that's what we are trying to
do let's go ahead and run the code real
quick 3 4 5 8 6 10 we want the same
output when we are done but how do we go
about doing just that once again let's
highlight all that code let's rewrite
this in functional style so we can say
return in this case string dot iterate
and we start with the value 2 why are we
starting with 2 because this loop
started with the value of 2 as you can
see here but notice there was no ending
for this particular list in this case it
came through the break elsewhere that's
exactly what we're going to do given
element e give me an element E + 1 this
is called an infinite stream so infinite
streams have no bounds at all we can
keep on going and so as a result we've
started 2 and then 2 plus 1 is 3 3 plus
1 is 4 4 plus 1 is 5 and so on we keep
going
of course it's lazy it's not gonna do it
until we ask for data so it's on demand
so the next thing I'm gonna do with this
one is I'm gonna call flatmap on this
one in this case I'm gonna say given a
value of M I'm going to now say int the
stream dart range and I'm gonna start
with the range remember what this went
from it went from n is 1 but one shy of
M hey that's easy I can start with M one
and go one shy of M readily so that
gives me the for loop for the range of
values but what am I gonna do I'm gonna
say map over here to object and that is
because in stream expects to return an
integer but I'm going to return an
object in this case and so in this case
what am I going to map over to this is a
value of n but I'm gonna return get
triple of the value which is going to be
whatever the m and n where so M comma n
that gives us the value from here so
this is going to return to us a stream
from this particular object we're not
done with this of course but the last
step here is limit and we're going to
limit this to the number of values we
expected and then followed by again our
wonderful collector comes in and we're
gonna use the collectors and then
collectors to
list method in this case so we are going
to say here is the to list method to put
this back all into a list eventually so
where is the in stream coming from let's
go ahead and say this in stream is
coming from the stream so in this case
that's the code we are ending up with is
to simply loop through and print all the
values so you can see again the code is
very functional and easy but the trick
here was to use a flat map in this case
knowing that we are dealing with the
one-to-many relationship a flat map will
flatten the list and give us the result
eventually and that's exactly what we
did in this particular example so that
uses an idea about how we can do this
pretty effectively using a flat map I do
have to say that flat map is one of the
charming features in functional
programming and I kind of keep
discovering problems where flat map
becomes useful I traditionally get
emails at least once a week from
somebody who says how do I solve this
problem and my brain is like is this yet
another flat map question and and
invariably it turns to be at least one
every week where people are still
struggling to really get a grasp of this
a flat map the last thing I want to show
you here is one thing is a very common
problem but can become really annoying
to solve over time let's actually solve
this by hand and see how painful this
can become so I want I'll take this
problem here and then we will try to
implement it and see how really weird
our life becomes when we are trying to
do this in functional imperative style
so let's get rid of all of this let's
get to the main function real quick and
in the main function what I'm going to
do is try to implement the code for this
find this come find the sum of square
root of K prime numbers starting with n
let's say n is equal to let's throw a
number 43 and then let's say in K equals
to 2 41 let's say some random numbers
but how do we implement this code to
compute the sum of square root of all
the K numbers well let's give it a try
we can say int index is equal to n into
count is equal to 0 and then we could
say double results so double result is
equal to 0 when we are done with that we
want to print the result after all
but what did we do so far absolutely
nothing useful we just create a bunch of
these garbage variables that's what we
did and and then of course what's over
next step we're gonna then say while and
then what do we do after this we say
while count is less than K and your
brain comes to a screeching halt with
the question is it less than or less
than or equal to do you ever ask that
question every single time there's only
one purpose of code like this to make us
feel stupid because every time you write
this you heart and say huh and they are
trying to find out is it limit or limit
plus one and this is the most vexing
thing we've been doing this over and
over and every day this is like going to
work and feeding us our self in our head
right because we can never get this
straight it's always confusing and we
always kind of write a nun wonder did I
get it right so it's very vexing as you
can see then what do I do and then I'm
gonna ask him prime numbers well okay I
can write the function for each prime
very easily so public static let's say
boolean in this case is prime implicate
that should be fairly easy to do after
all so we can simply say return number
is greater than 1 and in the stream that
range from o2 to the number and I will
simply say none match and then given a
number I number mod I is equal to zero
hey that's really as simple as that
that's what we did in the beginning
example so we can just bring that in
well now that we did that what's the
next step I'm gonna say if the given
number is a prime so it is index if it's
trying then what am I gonna do result
this plus equal to math dot square root
of the value index and and do the work
is this correct no I hear people saying
nodding their head saying no it's not
correct what am I missing I have to
increment the index isn't it now is it
correct I see we have to increment the
count so increment account now is it
correct it has to be outside isn't it so
the count how do you feel about that
where the index count should be here the
count
being commented here but the index
should be here this is accidental
complexity isn't it that's a lot of work
to write this code and of course the
question is does it work well we can
only be in good faith to run this and
see what it does it gave us some result
but that's a lot of work to write that
simple piece of code shall we try this
again let's go ahead and try this one
more time well we can leverage our
infinite stream here as well so we can
go back to this code and say doubled
result is equal to stream dart iterate
and we are interested from the number n
given a element give me element +1 so we
can start iterating from the stream this
is called an infinite stream like I
mentioned lambdas make it possible to
create infinite streams this infinite
stream has absolutely no bounds I know
what you're thinking if it's infinite
how long does it go it really goes to
infinity oh my goodness if it's infinity
where would you store it on the cloud of
course but the point really is it is
absolutely infinite in size isn't it so
in this case of course it's gonna yield
results as and when you request for the
result but then we can go to this and
say dart filter sample is prime and we
are asking for the prime numbers only
but then we can say map well in this
case we can say map to double and give
it a value give me the square root of
the value then we can say dart limit in
this case we'll say okay the question is
is it less than K less than or equal to
chain it's K time it keep moving you
don't have to waste your time on such
trivial things and then you perform the
sum operation on it now look at the code
below compared to the code in the top
the code in the top is filled with
accidental complexity the code in the
bottom removes all those accidental
complexity very nicely as we can see we
don't have to put in so much effort at
all so all we are doing here is we are
iterating through all the values
starting from n lazily of course we get
all the prime numbers from n we could
the square root of all the prime numbers
from N and then finally of course what
we are doing here is the extracting only
kVAL use out of it well every single one
of these highlighted code are lazy
operations they don't do eagerly
including limit it doesn't do things
eagerly at all and then there's some
being the terminal operation is the one
that triggers the execution in the case
of streams it's always the tail that
wags the dog until you have the terminal
method the engine of streams would not
start kicking in so that waits until
that point to start really ticking so in
this case of course the beauty of this
approach is look at the code in the top
this is what I call as accidental
complexity I have a little challenge for
you put this code in front of somebody
and ask them to read it and sit in front
of them and watch their eyeball their
eyeball does this and then it does this
and then it is shaking here that's
called the point of confusion you're
still trying to figure out what this
code is doing right and if a business
analyst comes to you and says hey I see
you're looking at our code what is this
girl doing and your response normally is
that's what I'm trying to figure out you
shut up and that's how we feel about it
very frustrated but you can have a
healthy conversation with them
yeah dude let's talk about it given all
the values from n I'm getting all the
prime numbers from n I'm getting the
square of the values but only K of them
and totaling them up is that what you
really wanted and it becomes really easy
to execute the code as well so it
becomes very convenient to discus about
the code and interact with it as well so
to summarize what we talked about here
we went from a very cryptic code in this
example to something very concise but we
are really able to use infinite streams
and lazy evaluation if you ask me what
is the big deal about functional style
of programming and and I've been trying
to struggle and learn about functional
programming for a lot of time and and me
include that a lot of speakers would
tell you oh my gosh if you're doing
functional programming you should honor
immutability you should really not you
know you should use higher-order
functions you should really focus on
writing code like this but I think those
are your important stuff but that's not
the real main real benefit or the
excitement when functional programming
to me the real excitement is all that in
functional purity and the programming
with immutability all that where it is
leading us as to this one exciting real
feature which is laziness because if you
are lazy both in life and in programming
the best people ever most efficient
people ever are the lazy ones so you
just say hey I'm gonna postpone
execution until I can no longer postpone
it and by waiting until that point you
can be really efficient and that's what
this code is showing us how lazy
evaluation can open up doors for not
only runtime efficiency but it can also
open the door for things like infinite
streams which give us a programming tool
that we very rarely exploit when we
write code in Java but this opens up
doors for some really nice way of
implementing things along the way
so essentially where this leads us to is
we are able to express code in Java this
is kind of like you know coming back to
Java and and being excited all about it
one more time and this is one of the
things honestly that excites me you know
of all these decades later every single
morning I get up to write code and to me
coding is not a profession coding is an
addiction and to me the reason coding is
exciting is being a programmer is like
being a kid in a candy store every
single day and that's what really
excites me is to be able to write this
kind of code and to be able to express
them in ways that we just haven't had a
chance to express in language like Java
before but we are able to do this which
is very very powerful so as you as you
continue your journey on going from
imperative functional style of
programming to summarize things that can
help you are you know think about
formulating the words in English ask the
question what am i doing and that's a
struggle we have to try a little bit
harder and when you formulate the
problem in English and say this is what
I'm doing then you start looking for
methods that might closely match with
your English description and maybe take
on those functions and and use it the
second a part of that journey is as you
walk through the JDK libraries and
functions make note of functions you may
not have seen before and and take a look
at hey this is interesting I haven't
seen this what problem this probably is
solving that could be a really nice way
to learn that as well and a third thing
I would
strongly encouraged as I learn a lot by
being critiqued going and sitting next
to somebody and saying hey I'm writing
this in functional style why don't you
take a look at what I'm doing maybe have
an idea and even if they may not have an
answer just talking to somebody really
helps us do you aren't angled some of
our you know a brain which is stuck in a
particular comfort zone and might open
up ways to really think about solutions
the way you may not have had a chance to
think about and that can be a really
good learning experience of shared
learning experience as well so that's
basically what I have hope that was
useful thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>