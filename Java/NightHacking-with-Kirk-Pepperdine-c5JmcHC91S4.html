<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>NightHacking with Kirk Pepperdine | Coder Coacher - Coaching Coders</title><meta content="NightHacking with Kirk Pepperdine - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java/">Java</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>NightHacking with Kirk Pepperdine</b></h2><h5 class="post__date">2012-11-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c5JmcHC91S4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright and we are broadcasting live
from dev ox so I'm here at Kirk
Pepperdine this is um take two and tell
me tell me Kirk what were you doing here
dev oxen Belgium well I'm having fun
like all of the other Java developers
that are running around here like
meeting up with interesting people
talking about interesting problems and
yesterday we actually did a performance
session with Lexi should love he's one
of the hotspot engineers and I did one
really well we have a nice audience and
nice for those of you don't know cut
Pepperdine is the leading performance
guru on the JVM yeah that's I just I
know that very good people that do a lot
of good performance AJ is fixed to focus
a little bit yeah and you're gonna
you're going to show some some
what are you in shows today Kurt garbage
ok I'm going to talk about garbage cuz
everybody just loves garbage right I I
think they knew hmm so I got you I got
your desktop up is that your company
Jake party well um this is the so I've
been doing all of my training work and
consulting through my company called
code work and just recently a couple of
us got together and what we did was he
started a new company to focus on
performance tool in college a clarity
and sense him is a tool that have been
working on for a while so since it was
tooling its you decided okay I'm just
going to fold this particular piece of
tooling into J clarity and we're going
to move forward with this and you'll see
a lot of other tools and you're like a
you're a starter personnel a start-up
person yeah yeah yes but without any of
the fringe benefits that other
strategies we got like that are on
chairs no another nice cooler with free
drinks oh no I got a new desk my wife
got me a new desk wow accounts right she
nicely said I don't like your old desk
and she just designed a new when I
dropped it in that's that's a good perk
that was I'm quite happy with that nice
just doesn't of it SJ clarity where go
on it
Vogel's on the desk yeah unfortunately
okay Walter come on yeah we got to work
on that so anyways so this is one of the
tools that we scope cake party yeah the
clarity Santa set so it's really nice
but it's all about garbage yes let's
show some garbage show some garbage I
mean that's a nice recycle bin but we
want a real garbage you're a real
garbage yeah okay well not only real
garbage looks like let's see if we have
something over here to show you real
guard okay so I pre-loaded one of these
things here this is some real garbage i
got from Heinz Heinz likes giving me
garbage all the time and in this case
you know normally if you're looking at
the stuff it's lots of little code
things and should I turn off my twitter
feed it's fun it's fine we get tweets so
if you're you haven't done night hacking
before it's an online streams broad oh
yeah you can interact with us by going
on the social stream on NYE packing.com
or the ustream channel and it will show
up in that timeline as well as Twitter
and Facebook if you like and we're
watching the stream and also tweets as
they fly by so i had that say hi to Tony
Tony's watching this is Tony ok oh hey
hi Tony I doing that hi to music item
eunuch who love me in it we had a bunch
of people in our audience here yeah
we're having we're having lots of fun
here yeah we tried moving the camera but
we're afraid it'll blow up again so so
anyways so we have this garbage
collection log here just to get back to
the geeky stuff as you can see
quite a bit of stuff in there right yep
okay so how do you get how would you
like it in Liza you could you can just
read this right this is like assembly to
you uh yeah well I mean it's not that
girls everywhere right yeah you can
actually difficult to read I mean so I
mean if you just like focus on this guy
here for instance you can see you know
you know when it started it has
information about what sending up the
survivor spaces I can't see anna has two
small it's all too small is it I need to
make that bigger yeah massive okay let's
just see if we can zoom in how's that
yeah it's about much better yeah exactly
okay so okay so let me pick a record
again here that one that's kind of fun
okay yeah so this is a young
generational scavenge as we can see and
so it's telling us when it started this
five hundred sixty seconds into the run
and it's got information about survivor
spaces and tendering information and
cool here with that information about
what's in your whoops you love max in
what's happening in young generation
space what's happening in your heap
space pause time statistics you know all
kinds of wonderful information here that
you can actually use to help to your
garbage collector but unfortunately in
this form it's
fun to look at isn't it yeah why one or
two lines might be but not like the
10,000 you have this file right so in
this case one or two missing one or two
lines doesn't matter we don't really
care about stuff like that because it's
like as I described to people it's
called swimming pool chemistry yeah you
know anything about taking care of a
swimming pool it's like when you dump
the chlorine is basically by the scoop
and not lose your other milligrams yeah
so we have to analyze literally
thousands and thousands upon thousands
tens of thousands of records hundred
thousand sometimes to to look at things
and you might if you're doing this over
clusters of that
cluster sizes of 350 virtual machines
you can get fun so really what you want
us and tooling and this is really why I
want it Thanks are you going to use that
sub down one that he bloggers were just
looking up i'm going to use since and
analyze that he plundered justly i'm
reading your mind that were like yeah
we're like really thinking about like an
API for the sajama telepathy very cool
yeah be awesome but you don't need a
feral rewired okay so yeah so we're just
going to read that log file here i can
actually find it conferences I'll go to
my dev ops singing here and that hot
there's is that's the log we got from
Hines and load it up now the reason why
what motivated me to start writing this
cool is that well there's other tools
that read Jason log files but they're
very limited in number formats that can
you know and you can't they only answer
small number of questions and they
weren't extensible something I was
always asking questions that those tools
couldn't answer and say okay you know
enough of this just let's go down the
road analyzing garbage collection logs
if you've ever been down that road you
know it's lots of fun so the lab staff I
got a hold of it and they finally said
hey yeah we can actually do somewhat
better we can actually do some of these
metrics and stuff like that so we have a
bunch of analytics here and the an
ellipse give us these
nice to us we think you got a problem
you should look at right in this case
your memory application and memory
utilization problem could be a memory
leak or your heap isn't big enough or
sometimes about d 8 kilobits is that
kilobits kilobytes okay shouldn't be a
big beat um I tell SS this is not the
beta 1 yes Giglio enjoy the screen say
hi Julia hey see over there uh he's on
though it's online okay hello guys use
visa Prince Lyon oh right I got me an
egg France got Leon hi comedic tale yeah
well you should come on the tour next
time then you can visit all these places
do I get to ride on the back here bike
you can have your own place that's good
okay and yeah anyway so we have these
sort of making a stab at actually being
able to say you got problems right and
do what the problems are and you know
hopefully offer solutions to some of
these problems as the chilling mature so
yeah and then and then we went into
these like traditional grafting so this
is okay so here's our wonderful garage
right yep in What's it telling us
well there's some jumps in there
those are cute yeah but essentially if
you just follow my cursor mostly
thinking over here you can see that this
curve is sort of so this this doesn't
look good here all this red stuff at the
top yeah this Reds never did so my talk
yesterday was like you know big red bad
okay so this is big and red and bad but
but more and more important you know
more importantly if you look at this
very subtle thing down here this trend
line you can see that it's always
increasing and that's why we had the
problem with the memory utilization or
one of the indications that we have this
metric come up because you know that's
where memory look looks like yeah yeah
okay and another thing that what a
memory looks looks like if you look at
these blue things those are young
generational scavenges the red things
are full GCS okay the black bit set my
selves is total heat that's been
allocated okay so you see we've gone
through the logs you pull out the
numbers we're due for monograph and
everything like that okay so we don't
like cool gc's because
look at pause time see the blues oh yeah
all down here where the Reds okay
they're all over here is a very healthy
application um it actually isn't that it
is strangely well in this configuration
it isn't but in using the information
from here we're actually able to
configure it into a healthy
configuration now this does a Fibonacci
calculation and it does i'll show you
that it does a lot of cat creek caching
results so it doesn't have to
recalculate things in over and over
again and so the caching of results
makes it okay so it gets kind of
exponential memory usage is a comply
around Fibonacci and it never right for
some reason it's not releasing right
already because it's a cache cache is
don't release memory good cash is gone
not in this case because it meets the
results yeah well yes good one of the
caches do release memory but but in this
case we have to bring some applications
amount its semantics to the picture to
really understand what's going on but
the whole thing here is like okay you
can see that we get this transition
point where we go from like yeah so look
those two inflection points that I see
in this ground what is where you
actually get the full team yeah and
that's not good and it makes the garbage
collector more crazy yeah the second
point is which you can no longer do
young generation cleanups and just
continually Congress plug
and that's what it's pretty much dead i
don't think it's kicking out many
fibonacci numbers at that point well it
does slow down because actually when we
fixed the configuration i wish i could
find that graph but um it will run in
about nine hundred eighty eight to nine
hundred seconds you know say this one
takes in you know almost 2,000 to
complete excuse me but yeah exactly when
you get in this area here then of course
your dominant activity is going to be
garbage collection and actually if you
look at this particular graph you can
see that in this area here we're
spending somewhere between 45 and 55
percent of our time in garbage
collection which means yeah the sign of
half of our machine is being spent with
garbage question and the other half is
processing right but eventually you get
through it right here where we're going
to start spitting our results and
they're finished so by doing some nice
heat painting here you're gonna fix this
out for we're gonna fix we can fix this
out just by tuning the heap I don't have
the app here I shall have one that I
could actually tune live which I've got
have fun but there's another metric in
here that actually tells a bit distorted
right so you would think that okay we
just need more memory right but you see
this is these things are heat
utilization after the collection so some
of this is actually going to be in you
in generational space in the survivor
spaces but most of us
space okay which means we don't actually
get this stuff cleared out until we get
it LGC which is why the red tracing
along the bottom here okay if this is
too obvious i can just go faster
so we'll let the twit tweet tweet er
guys there tell me if I'm not too soft
but what Julia oh you've got it yeah
okay what are you psychic that's cause
you're not a conference network okay
ouch that really hurts yeah okay so
let's go ahead and take a look at this
particular view down here and as you can
see what this is a tendering summary so
this is basically how healthy is your
tendering like in terms of your survivor
space is usually vipre spaces that are
there to keep data in you and
generational space long enough to that
if it's going to die soon you're going
to collect it there it's really cheap as
opposed to when you get into tenure
space it gets really expensive right if
you look at the premature promotion
picture here what it's saying is that
our prematurely promoting objects at the
rate of nineteen four-point-seven
percent which means that I'm flooding my
survivor space 94.7 percent of the time
so I actually don't need more memory I
just need bigger survivor spaces
right and actually the solution to this
problem is is to actually make the
survivor space is big bigger to do make
sense if you have a cache which never
releases objects well no this this is
releasing objects so this hash is
releasing objects all of those cached
objects are ending up in tenured where
they shouldn't where they need to go but
the problem is is as their life as a
life cycle is so five collections they
bounce between eating and survivors yeah
and eventually they need to be tenured
okay what we're seeing is that it's a
bigger survivors based on a larger chunk
makes it to tenure quickly it was a
small survivor space then we're
prematurely promoting these objects
which puts pressure on tenure which
means we increase the frequency of full
GCS okay so if we make survivor space is
smaller sorry bigger then the garbage
gets caught in the survivor space and it
never gets tenured we don't put pressure
on a better space and we have less
frequent jeep full gc's okay so the
problem is in the overall heap size is
the fact that we're flooding one of the
internal memory pools very very
frequently then so we mitigate that
behavior this application now runs in
about nine hundred seconds give the logs
from a healthy out front I actually have
the health from the healthy version of
this I wish I did but actually I went
looking for it and I couldn't find some
number around here someplace but i
actually get hundreds and hundreds of
log files
people keep sending me so mainly Heinz
probably and then that guy bill and that
guy bill yeah because actually the next
one we're going to get from him is
probably going to be garbage collection
box from the Scala compiler yeah it's a
those of you watching that stuff is
actually bill veneers hey how you spell
your last name betters the vienen ers
how you say the last name bow yeah okay
so bill Benner's is going to be be up
next okay yeah Julian says death to perm
gen yeah forget to print ah no no guys
you don't understand what Permian was
doing so so socially that's a good
question because I I've heard of Java 8
they were gonna get rid of perm gen yeah
it's almost gone it is almost completely
done and what is that what does that
mean to the red versatile java
developers you know those class weeks
that you are getting i have a live all
the time yesterday I increase the perm
job when I got them guess what guess
what okay good job you IM that IDM
doesn't have a first place yeah azul
doesn't have a person's all these other
VMS don't have a premise pace RJ rocky
didn't it first face right so they never
got the ida memory or because of perm
space full
but and so we're going to get rid of
that problem right yeah by putting it
into heat into regular heat so now
basically you have your met eerie your
what would have been prone stays home
actually end up filling up your regular
job so the thing is you're going to need
a tool like said some to actually figure
out that what's going up your heat is
class memory rather than your own
application memory well we have another
tool that's actually going to do that
type the diagnostic work it's like JP DM
yeah and it'll do actually a lot more
than that but that's part of the branch
that will actually explore but that
aside there's another problem they've
decided to dump a lot of the metadata in
to see he oh we don't have any you know
I have journey of acidity you don't see
this meeting will see to see what's
going on there yeah that's kind of scary
yeah yeah and so and you know the other
thing is to that we you could just
collect 10 yrs face and not have to
worry about / space sometimes you
collect home depending on out full it
was but since the cost of the collection
is proportional to the number of live
objects adding all these objects and
dumping them down into tender space is
actually going to slow down it's
actually in potentially make deposit on
problem horse right so I am never sure
i'm sure the jvm jets consulted the
leading jvm performance expert about the
implications of a change like that yeah
I'm sure they do i'm just not sure which
expert they actually communicated with
you know but anyways so I'm I'm one
concerned about the change I understand
her face weeks are annoying and it's yet
another memory pool that's taking up
space you know eating at more memory and
there's you know so it's not a perfect
solution however the alternative well
they say there's no free lunch right in
this case so are we communicating with
that room yep
and Java hey i would i would like to see
it it's almost gone I don't think
there's hardly any bits left if it's not
already gone because I found out today
they've already x extricated so yeah so
I mean apparently Julia doesn't like
firm down but so if anybody you think
they'll be affirmed Jim lover or hater
sea scallop it's lots and lots and lots
of lots of classes current political
Scott Scott there's lots of classes so
that must be an issue for a scholar that
firm Jane even exist because you're
always probably running out of class
memory well apparently one line of code
can create like was it Rafa terabyte of
classes there's something oops do I say
this alright well lets you adjust that
when you see a ferry bill did you even
think about it you can go on that's a
little bit all right so i think i think
we infer that wasn't half sure but it
was only half and half a half a meg it
so i think i think you've done some some
excellent packing have you ever ready
give you one of these no ok so let's
hear this thank you you already have a
pretty cool laptop sticker but maybe you
can find someone else's laptop to to
jamming on
okay anyway so I do have a before and
after picture this one is actually kind
of an interesting one let's just bring
it up here and she brought up a couple
of but these are all like from real live
application shall we say what happened
yeah
so for the screens don't open do they
so all windows
there we go this one is kind of this one
is kind of a fun one and we actually
don't have a that interesting the
solution for quite yeah it's sort of a
work in progress so if there's any like
Linux ox out there that have any
interesting ideas here's a puzzler for
you mate and maybe we wrap up in a
puzzle yeah the outcast good okay so
watch this okay see you notice this
particular line here this is hiep
utilization after a garbage collection
okay that's what the line is so if we
look at the space around this
particular line here we look at the
space all around this particular line
here and we look over here on this
particular line and we correlate that
with GC pause time with a cluster here
cluster here and a cluster there
now if you come back over to hear the
heat after well we can look at heat
before juicy I guess another view to see
it you can see here's our ramp up here
and so we're do is we're sucking in
pages in the operating system here and
we've over here need more pages so we're
sucking in more pages right so now we
have pages but it seems to dampen down
somewhat and I'm guessing here that's
damping down to about this region here
you see you get a little bit of a
flattened here you can you leave this oh
that wasn't well that's the conference
right yeah I don't worry about it now
don't worry wet yeah so you see this
flattening here that I think this way
that this is when the paging activity
comes in we get this little thing here
right so so and if you look at it the
response times are now a proximal to the
new amount of pages that the thing that
the application is actually demanding to
actually use more heat right and it's
it's really I think and there we go
that's backdrop again so i think it's
these really type of interesting type of
views I
actually lead to some interesting
discoveries as to what you know what's
happening in your system so this really
goes beyond garbage collection yeah so
this is a good puzzle of frog legs yeah
we have a good swim consultant yet this
is like Sasha they say contact you when
they will then solve this one Kirk was
the best way to reach you at DAC heavy
yeah you can tweet me or you can get hit
me on email and how would people find
one about Jay clarity or since then
what's the and just visit our Jay
clarity website you can either batter
visit my code work website kotdwar k
cool and that's what we find out more
awesome at well thanks thanks for being
a guest on night hacking thanks for
having me Steve yeah that's really fun I
want to go to do this again sometime
maybe I'm when I'm driving through town
Western Europe using and actually saying
that you never want to do this again
alright when I'm driving in a relatively
most every activity yes but you have a
yeah that's because I live in a very
obscure town from off the beaten track
okay yep oh and any upcoming trainings
Tony soften you up here I'm Tony oh yes
like this idea Tony is
one of my training partner for Germany
and yeah we'll be offering first week in
december we have jj's oh oh yeah hey Gus
don't forget about jada it is and radar
following J days we will actually be
running a course fortunately for day
Jeff on the streaming similar go awesome
thanks thank you very much Steve thanks
Tony
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>