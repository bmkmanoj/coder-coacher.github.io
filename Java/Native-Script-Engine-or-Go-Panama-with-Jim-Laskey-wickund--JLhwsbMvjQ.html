<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Native Script Engine or Go Panama with Jim Laskey  @wickund | Coder Coacher - Coaching Coders</title><meta content="Native Script Engine or Go Panama with Jim Laskey  @wickund - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java/">Java</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Native Script Engine or Go Panama with Jim Laskey  @wickund</b></h2><h5 class="post__date">2017-08-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-JLhwsbMvjQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">about three o'clock in the morning I
decided I'm going to go off-script this
is the last talk for the day and you
guys are all been working hard
what's nice talk so I thought maybe I
just be a little bit more casual but the
delivery this is our legalization of
fake news so there's a Welsh comedian
Alan Davies who has a TV show in the UK
it's called
yet as yet untitled and that's what I
started with here the premise of the
show is that he has four guests arrived
they're all comedians and he talks to
them for about an hour and after the
hour when they're there he decides what
the title of the show is going to be
based on the conversation when I started
working on this talk I had a hard time
trying to figure out what the title was
going to be and I got really fixated on
that and I because I figured the title
it's critical of a talk and because it's
the thesis of what the presenter is
going to come across with and then he
has 45 minutes to prove the skeezix
right and it depends on you know the
crowd and whether they accept it or not
the title is also the walk away and
that's that's the tricky part for me
here is the walk away of what the talk
is about so I just couldn't figure out
what the best the best thing is for this
so I played around with a bunch of
different things
the first title I came up with was going
native I thought this was the ideal the
title to come up with is you know came
right off my head I even created a
graphic four figures above all set but
then I started feeling pains of
political incorrectness right because
you know going native was this colonial
term you know basically degrading people
who started behaving like the the
dn8 the cultures that there were these
countries that they were taking over and
then I found out that it was also used
by somebody else in the past talk so I
figured it might destroy here so I got
kind of desperate and I've sort of asked
other people come up with a title and
Alec saved me you came through with why
do you get why'd he just say you want to
do a talk on a native script engine I
said okay that's pretty good I'll just
do that and that's what you see in the
program so we'll supposed to go with
that it's you know it's precise and
basically says what were what I'm going
to talk about uh then I had panic attack
in the middle of night and I said oh
this is not going to work I got to have
something something a little bit more
powerful and that's where this whole
idea is is there is a day VM you know is
that is the Java purism and NIH killing
the JVM and I said all that will be a
real you know catcher but you know
really that's just clickbait right so
it's just something that you would click
on and then realize it well what if
that's a stupid story
to be reading so then I got into this
whole business of is the JVM being
hobbled hobbling your your development
you know it's a JVM really a square peg
in your development process and why is
method splitting even a thing so you
know anybody who does byte code
generation it's ridiculous you know
anyway I just thought okay I'm ranting I
better slow down here then we get then
the next title hit me so off the shelf
you know and of course these days off
the shelf means something is so good
that I'm going to take it home with me
on to buy it and take it off the shelf
but of course we most of us realize that
off the shelf means that you use
something that's already out there you
know there's a lot of software out there
that had hundreds if not thousands of
years of person development on it and
you should be using it in this case that
came up with the analogy of that you're
been slaving on the stove all afternoon
coming up with the most
fabulous pasta sauce that you know ever
invented even though you can look up in
the corner there and you can see the can
and you could reach down and grab the
can and save you a lot of time and then
throw all the process that you've been
going through your family got hungry in
order to pizza behind your back and then
you know you're stuck there with the
sauce that nobody's going to use and
maybe you should have grabbed a can and
used it finally I want to talk to John
about this talk he suggested that you
know should talk about Panama and push
for the idea that you know Panama is
going to help us move forward help the
jvm move forward and I think that was
fair and I you know I I tried that one
anyway I still don't have a title but
then again maybe the title doesn't
really matter so maybe other factors
take control of how the talk works maybe
I should have used Helvetica thought
bonds maybe she did more graphics maybe
should ask Brian to do the talk for me
it would have been a lot easier and
McLuhan I was probably right you know
I'm just overthinking this thing and it
shouldn't even worry about it so I
pointed up by the way that McLuhan was
Canadian because you know we're all
philosophers and we're not all but beer
and hockey sticks so at any rate I like
Davey show I have an idea where this
conversation is going to go and but I
don't have any control over how you're
going to think about it after it's all
done let's just see what happens as we
go on so I had a decision to make where
do we go next
nass Hornet has been in development for
seven years it's been out with JDK 8 the
last three years it's gained a lot of
traction I'm sure there's a lot of
people in this room that use JavaScript
if they don't use dance floor so if
people discover that javascript is
available in the
they start using it the three main areas
that people use naps worn are isomorphic
development but they basically have a
shared code base on the your client and
your server and the code base can be
moved back and forth it's an ideal
scenario where you only have to hire one
type of programmer you don't have to
hire both types of programmers in your
shop it's also used for soft coding
where the code may change in the fly so
for instance stored procedures and
databases configuration management of
your of your application anything
anything that requires you know change
what I would happen to rebuild your
environment and people are using a
partial scripting you know I know
several people there actually built the
whole business up based on shell
scripting using NASCAR unfortunately
we've never been able to have more than
two the four engineers working on this
project and that makes it tough because
it really does take a village to prepare
a programming language for delivery we
have this huge backlog of things that we
need to do we didn't I didn't when I
designed it it reduces an interpreter
because I didn't think it was going to
be that crucial stupid me so we go
straight to bytecode from the ast and so
it takes a while for Nashua to warm up
we're finding that we had customers that
were submitting bugs complaining that
Ness word was about five times slower
executing their applicate their
applications and the finding of their
applications were basically this feeding
one-line scripts and they were taking so
much longer where the Rhino interpreter
opted - one could you know basically do
it just like that because it didn't have
to go to byte code it was basically just
interpreting straight-up people were
saying that there are benchmarks were
significantly slower than other native
Java scripts while were not native we're
basically implemented on the VM in
general though people were kind of happy
with Nasir and just the way it is
because ultimately it was really all
about
connecting up with Java they wanted to
be able to work in JavaScript but they
wanted to be able to exploit their Java
environment and that's really what it
was about but then I always was getting
all these messages from from users that
we really want to use JavaScript on the
JVM but we wanted to be as fast as the
egg then we have this other problem
where they obviously they change the
spec so we have to see a six pack and
basically trying to get this all
implemented and some of it's being
delivered with JDK 9 and then there's TS
7 and yes 8 and the works we didn't have
any support for no js' that the project
was tried with avatar JSX tried to get
no going just wasn't wasn't flying and
it's been put on ice somewheres and of
course the other Java scripts were
getting better and better better this v8
is Nitro the spider monkey so let's face
it you know in the world of JavaScript
v8 rules they have a fast startup a fast
computation small footprint if you use
the 8 from your application you find
that you'll find that the API is really
easy to use you can plug it into almost
any C application C++ application it's
really to use in embeds well in a
hostile environments it's got to sit in
the browser and the browser couldn't be
any worse or worse environment for
anything to run in it tracks the active
script standards it's basically leads
the action script standards most of the
time and of course nodejs
is everywhere everybody's talking about
no GS so what if we were to make a
sibling to Nassau that use the v8 engine
we matched the Nassau and api's and you
can see the NSR api is everywhere even
in even in the truffle truffle code
truffle das code this would minimize the
porting from mass warren to this new
thing we keep the api is really high
level so people are using the same API
is that they were using an S word
and keep the full dynamic access to Java
there is another product out there
called j2 v8 it was done by Ian bull
they did a similar sort of thing but but
Ian was mostly focused on the embedded
market so he kept all his API is really
low level using this it's a static API
on a dynamic API and you have to do
things like thought your own GC you have
to manually just release objects as
you're using it so let's do a proof of
concept and let's try to integrate v8
into the JVM so we started this
proof-of-concept the end of last year
was just me I just started on my own
originally and the whole idea was to
implement v8 engine as a jar and a
native library we focus on the
JavaScript API initially and we're
worried about the Java callbacks later
well this just is a proof of concept so
you should be able to do you know create
a new engine of type v8 okay then next
step would be to measure the stability
running on the JVM does it there's an
interfere with memory and usage in the
JVM does it interfere with signals you
know how does it handle null null
pointers didn't seem to be an issue and
of course if you think about it the v8
has to run into running a browser and
there could be anything worse than a
browser to running next step was to
measure performance I didn't get hung up
on how it was going to do performance
because it was just you know this needs
to know if it's gonna be faster than s
work for the most part I did see
significant improvement in speed
I saw saw better memory usage and it was
seem to be better than Ryan s1 and girl
J s the ops one minus one is great
interpreter up 9 is the most optimal
version of Ryan J and I didn't seem to
be a no problem I was really concerned
about that and but as we get further in
the talk we'll talk about to Panama a
little bit because most of the scripts
the use cases that we were seeing from
users in ourselves where that JavaScript
was being used as in and out evaluate
the script and take results there wasn't
a lot of callbacks to Java and if there
were called back to Java they were
fairly sparse they weren't something
like I'm pounding on something on the
Java side to get it you know like every
cycle
it was infrequent so just this use case
seemed to be pretty good
there's bulk data issues but there's
workarounds that we basically have no
copy byte buffers to v8 array buffer it
seems to work fine as they say I'd want
to get into grande details about the
performance but these are sort of sort
of the things that I did I just
basically just a straight time thing so
the times were basically from launch to
exit memory was spacing against the null
main small scripts we had this they're
worth this worst case scenario a
application where there was 17 thousand
lines of script fed to the engine one
line at a time and against the internal
interpreter which was the fastest at the
time it was three times smaller and
three times faster well when you're
seeing an X instead of percentage
improvement you know you're on the right
track that's where you want to be micro
benchmarks was princess you know like
the octane display is an example
balancing a large tree it used half as
much memory and was six times faster and
that's from start to finish so that all
the warm-up issues and that's nasty or
and gardius or tied in their startup
time is twice as fast starting up as
Rhino and about 30 percent classes and
then Nasiruddin girl GIS so this is all
very encouraging so let's go beyond a
proof of concept and onto an
experimental
so that's right in sundar and honnest
from the Nashorn team to help me out
with the rest of this so working with JB
MBA just to get you a sense of what you
how things work in the JavaScript world
with with Java this is the standard
example of how to get an engine so you
get a v8 engine you can get contexts and
bindings from that engine you can set
the bindings you evaluate you get the
result after the execution it's all
pretty straightforward he here is v8 is
the engine we're using on the JavaScript
side this is where the the NASCAR and
API is kicked in the Java dot type is
how you get a specified type in this
case I'm going to get the Java util
ArrayList and then basically copy that
to a local variable and you notice the
Const is there that's the es6
you can use the old style Rhino form
that works works as well if that's the
way you want to work and I once you have
that type you can create new instances
of it you can call methods against it
you can access fields it just works
okay beyond a thorn if you've used a
thorn there's a the ability to create
shell scripts and you can actually use
back ticks to indicate that you want
something fed off to the system as a
system command in es6 they've used back
ticks to represent template strings
which are multi-line strings where you
can actually embed dollar sign bracket
or brace expressions in it so we needed
some kind of translation for that and in
es6 you have the ability to have these
template strings with a tag in front of
them
so often the tag would be JSON tag or
HTML tag or XML tag to indicate that you
want that string to be pre processed
before it's passed off to Java in this
case they just used underscore as an
example we want the string fed to the
Dec commander the exact primitive this
is an a storm premiere so I can actually
feed execution off to the system with
the backticks and then we got one step
further in es6 javascript has introduced
classes and if you wanted to override a
class in nassau in the old style you had
to use a special extend declaration you
had to use a special syntax to indicate
overridden methods in this form we can
use the es6 classes and we can indicate
that we're actually overriding a java
class and we can override the
constructor and we can call the super
Wow get bonus writing of a v8 engine is
pretty straightforward as to say the API
is easy you we have this correspondence
between a script engine and v8 isolate
you create a v8 isolate that's the
instance of the engine and it's
self-contained it has its own memories
all of its performance data all the
objects that are created in that
instance are all defined there you
create an instance of the isolate you
can create a global in that I slit and
if you use JavaScript you know you have
a global variable that I'll have all of
your global functions and properties
sitting in so we populate it with all
the natural and functionality and if we
want to be able to access Java Java type
or Java 2 or any of the Nats horan api's
we run a script written in JavaScript
that populates the global with all of
that information evaluation
straightforward again you just take the
text string the script that you want to
execute feed it to the context it will
compile it you can save the save the
compile in an unbound scrap
you can feed that compiled script to a
context for evaluation and once the
script is evaluated we take the results
and in java terms we have to figure out
whether we just pass it back as a
primitive value or wrap it as a Pocho so
the components for this scheme it would
be the jar and the native library marked
in red so the user to app talks to the
JVM the JVM looks for the for the engine
through the resource lookup it finds it
in the jar the jar initializes the
library and that library connects up
with connects up with v8 the v8 engine
the things that are contained in the jar
are Jeff X support so we have full Java
support although all the api's are there
we have a v8 native clasp which is used
to handle all the v8 down calls so all
the implementations and native stuff is
through that v8 object it also handles
all callbacks from v8 coming back up it
includes all the wrappers for all of the
v8 objects that are coming back to the
environment and these are all of a s
object types of anybody whose JavaScript
and Java together from Rhyno days up to
two Nashorn days the GS object is the
way you communicate with a JavaScript
object from Java we do a bridge GC to
manage all of the eight objects so we do
automatic garbage collection of all of
the eight objects don't have to worry
about it no manual operations vault we
have a constructor for generating pojo
wrappers so if we have a v8 object that
shows up and sorry a Java object that
shows up in in the Java Script
we gotta create a wrapper for it and
what we do is a callback to say okay we
need a wrapper for this and then we
generate JavaScript to create the
wrapper and then finally this boot
script that we run if we want to provide
jobs job
work the native library includes all the
implementations of the v8 native native
class all the data conversions for
instance the string Java length string -
v8 string and back again that's all
there the bridge C for managing Java
objects on the JavaScript side so if
javascript is finished with the jo-jo
object then it lets you have a no and it
gets released so it's all automatic you
don't have to worry about the objects
all the native ba primitives written in
C++ are all sitting there and then all
the key J&amp;amp;I methods that we need to call
from the v8 side of the other script
side they're also all in committed in
this library through a property that
you'll see here in a minute is the JVM
property so finer details so the v8
objects in Java we take a v8 reference
with the 64-bit address convert it to a
long and we wrap it into a Java
equivalent so this is jsr a v8 object on
the Java side and inside of it would be
this long that references the Java to
have objects we have specific ones for
the specific type on the JavaScript side
is a bead object there's a v8 arrayed V
a proxy and so on just whole slew of
them there each of these implements
objects as I mentioned before the Schism
ability to manipulate these objects on
the Java side this is all stuff that's
been around since the dawn of rhino and
it also implements maps so you can treat
a JavaScript object as though as a map
so if you want to access a property you
can just index it into the property and
get the value and work with it v8
objects are javascript object objects on
the v8 side we take the global reference
and pack it into
a v8 external these are really
lightweight values they only take up
sixty four-bit and then there's an
equivalent javascript class it contains
a store that external so that we've a
Java object would be a Java class in
Java list could be some kind of
functional interface in one of those
sorts of things and then the constructor
maps to to say Java class constructors
for the JavaScript objects are generated
by the Java code so the wrappers around
these objects make the POJO on the
JavaScript side look like Java objects
so I can call a method against the list
so really easy to use the wrappers also
look like JavaScript objects so we
looked at the class representation there
earlier on the JavaScript side so I can
actually say this instance of ArrayList
so I can actually do treat it as though
it you know very naturally whether it's
an ArrayList and that's basically all
handled in JavaScript the JavaScript
generator it's rather complex the sorts
of things that it generates but this is
the constructor for a list just looking
further down an example there you see
account arguments equals length this is
basically how many arguments am i
passing to the constructor for when I
say new ArrayList if the count is zero
basically not passing any arguments to
the constructor then I call off and
create a new instance of that object
from the Java class we have the Java
class imprecation that's the method ID
and hexadecimal values javascript
doesn't support long so you have to
break it up into two 32-bit values and
then you wrap it so this is the sort of
thing that the constructor generator
which video proves the j'ni primitives
and this is the sort of the crux to you
know how this all ties in with panama in
order to communicate with it with the
JVM we're using J&amp;amp;I calls and the J&amp;amp;I
calls our base
our optimization dance boundary we can't
optimize yeah
you know beyond the J and I like the
same ways hotspot would and this is this
is why you might not want to use this
tool it in some circumstances depending
on the types of thing because the fact
that you're going to be paying the j'ni
overhead it's the optimization barrier
but that doesn't mean that we can't
optimize up to that call and so we do
some play some tricks in JavaScript to
help us you know get the most optimal
code we possibly can so as an example
the safer recalling JVM get array
element which is a Jain I call and the
second argument is supposed to be an
integer if I if I slap a module at zero
that tells JavaScript that that's going
to be an integer value and then it
optimizes all the way back up to say oh
this is going to be an integer value and
produces optimal code for that so this
makes the marshaling of arguments to all
these J&amp;amp;I calls very efficient and easy
to do we're not currently using Dino
link be properly properties in v8 are
already handled so we already know what
method we're going to call because the
property lookup is already at the call
site that we're making from but we
wanted to make consistent choices for
argument overloaded methods want to be
consistent with NASA warned so we took
some of that code of the Dino link to be
able to find the right method wanna
match up the boot boot script which is
used to introduce Java support within
the environment it's all entirely
written in JavaScript it uses the the
j'ni primitive interface the JVM dot and
then the j'ni call to communicate
communicate back to the JVM
it's precompiled and as stories abound
script so if you create a new isolate we
can basically run the script fairly
quickly we don't have to recompile every
time so bringing up a new isolate is is
very quick
this boot script has all the code that
manages all the activity from the Java
service perspective so it handles all
the Java classes and objects arrays all
all on the JavaScript side it's all
managed there there was no point writing
any of this in C++ because the thing is
that ultimately the same same sort of
code generation is going to take place
because v8 is an optimizing compiler so
we wrote it all in JavaScript and paid a
little penalty for a startup but it
doesn't seem to be a big issue if you
want to get rid of that you can just say
you don't want Java and everything will
be just as fast as you expect with v8
the script is also used to implement all
the network and extensions so if any of
the extensions like it's like you know
Jeff without type java to java dot from
whatever those are all implemented in
this food script so it makes it really
easy to manage and update and add new
functionality is it go on so here's a
simple example this is the
implementation of java type the support
routine is Java under type and what it
does it takes the name that you're
passing in and do a look up and see if
it's in the local map if it's the local
map and it just returns that value if
it's not then it goes off and finds out
what the what the Java class is make a
J&amp;amp;I call if I don't the Java classes and
construct a wrapper for it and sort in
the map and then return the results and
then the second part of this in the in
the function here is to actually define
it as a global so that person a person
using it we can say Java dot type and it
will actually go off and do this go for
for you okay so some of the more
interesting bits of how this was all
thrown together let's talk about garbage
collection on the Java side Java objects
JavaScript objects in v8 we're pinning
them in v8 persistence these are
basically static field variables that we
can we can define define them in
actually large pools and then we stuff
the the value in that persistent and
then past the address of the persistent
back to Java so that's where the the
long reference v8 reference comes from
we're using we're using I'm supposed to
say Java laying ref cleaner but we're
actually using some miss cleaner to
manage the cleanup of these objects so
when when the wrapper that contains this
reference disappears on the Java side
the cleaners calls it does a call back
and says I'm done with this object lit
v8 no I'm done with it and then it gets
released collection on the other side
this is a very similar sort of thing we
store the global ref in the v8 external
we saw the external and persistent but
this is a different kind of assistant we
basically flag this one as weak so the
jet the POJO sits in this external you
know on the JavaScript side and when
it's not referenced anymore the callback
gets called and we say ok let's get rid
of this global ref we don't need anymore
so we have a balanced garbage collection
don't have to worry about the garbage
collection because we've set it up using
the Java that's where an AP is it was
possible to support a lot of stuff over
from NASA without making any changes so
for instance the primitive dollar sign
exec which is the one used to to make
system level calls just port it over
mostly as is we have to make that many
changes to it we the adapter byte code
generator that we use to create
subclasses of you know subclasses of
Java objects and the JavaScript side the
code is pretty much ported as it was
really little changed we had to make
forces we use portions of the beans
liquor from Dino link as I mentioned
earlier and that was to help resolve
method calls and then a lot of the
Nashorn samples disks poured it over
very nice thing just worked didn't have
to worry about it
all the exception handling all the IO
that's being done zalgo through Java it
just just all works one of the big
things that we push for an ass whore
with the fact that we can do
multi-threading in s4 and then we always
all eight can do multi-threading and you
know we can do multi-threading so lets
you know the bonus force but we needed
to come up with a different story
because the way thirds are handled in
the v8 world a very different than
they're handled in the java world so in
order to use an isolate you always have
to lock it so you take a nice flip you
lock it then you can use it to your
heart's content
and when you're done with it you unlock
it so that's not very Java like or you
know not any nobody should be using that
kind of mechanism but it makes their VM
very fast so you don't have to worry
about all of these things so so this
means that we'll only one thread to the
design can use an isolate you can have
Fred a use that I slit and then release
it and entered B can use it there's no
problem there but only one is time but
because of these isolates are fairly
lightweight you can have literally
thousands of them you know they
basically just had allocated what
minimal amount of memory that they need
to execute in if you think about you
know you're sitting in your browser and
you're opening multiple tabs you know
and there's a separate isolate there for
every one of those tabs then you know
you can have quite a few of them so in
our circus days what we did we set it up
so that you were free to pass an object
across a nice lip okay so if you created
an object in one isolate then you could
pass it to another isolate if it if it
goes back to the same I clip we just
unwrap it and it becomes a personal
JavaScript object but if it goes to
another isolate we treat it as a POJO
it's it's a j/s object so it just
behaves naturally in the other
environment except you have to go
through the wrapper
so it allows you pass objects across
these isolates so this is how we build
up our our multi-threaded story so in
NASCAR and our multi-threading we use
this the load with global function which
basically
allowed you to pass values through to
the other side and it would create a new
instance that you could run on a
separate thread
unfortunately v8i slits required to
manage thread so we had to come up with
a different scheme for doing this this
is one of the few things that we had to
change up working from last one to v8 so
we created these things called fork and
fork with an executor so fork basically
would create a new thread and then
create a new instance to run on the
thread Pat you can pass arguments
through that side and their way it would
go so you can basically have two you
know one one instance of JavaScript
starting another instance of JavaScript
and they would start executing this the
result of creating one of these are
running one of these functions is that
it produces a future and with the future
you can then get the value from the
future whenever you want to want to pick
up the value will likely port this back
to NASCAR and so that you know people
can use it on the other side so here's
an example of multi-threading calling
the fork function feeding at a lambda
function I want to print the threads
current thread I want to print all the
arguments you want to do a stack crawl
you want to return done then the
arguments we have pass to that fork and
then you get when you get the future
then you'll get the result come back so
then these are the values that you
return then there's that node thing it's
out there well we've done all this work
how much further is it to get to noon
well this thing works with node as well
so there whatever that is we created a
JVM v8 node module which is effectively
an alias through to the JVM library v8
library we have to put it somewhere as
where no can find it easily so we store
it in this directory then everything
else is the same API is we were using
just a normal JavaScript with some
exceptions
if you use node you're used to using
constable dialogues so I'll use
console.log instead of prints but
everything else is node right so this is
how the the node configuration looks you
have a node app it communicates with
nodes it goes through to the VM JVM the
eight node sort of alias to get to the
library and from there we communicate to
the JVM and then also to the jar
it's also possible in node to get a new
instance of an isolate or a new engine
so you could actually launch another
engine if you wanted to but that's not
the way node works people don't die
wouldn't recommend that because no
people would turn their noses up in
everything has any quick quick
turnaround so in order to prove that
this was all useful in the real world
I took the the the node.js chat demo
which is standard standard gem demo and
following the machine learning theme I
took the Apache open NLP which is the
natural language processing library
too-tall written in Java right and then
also to prologue which is the inference
engine that's written in Java to analyze
the input and I ended up with a chat dot
so I could actually communicate back and
forth with this chat bot you know how
you know I'm doing well we're glad to
hear about it so in order to use a JVM
v8 you need to create a new instance of
the JVM so first of all you require the
JVM then you do a create and pass in
whatever arguments you want for creating
the VM JVM in this case what we were
going to care about the class pass so we
were just want to supply the class path
to the JVM once you have that into the
JVM Java then you can just use it the
way you have any of other circumstances
I can say Java type class name and then
create a new instance of this case
prologue not going to add series create
new instance of theory
add that to the to the prologue engine
so there's some prologue code sitting
there sort of similar to what I used
actually used in this case and in solve
it get Prolog to actually solve that so
so what did I get from this
I got a sustainable JavaScript for JVM
and said mentioned earlier I only had
you know two to four engineers to work
with that's hard took about 20% years to
do it only took about a year person year
to do this work I ended up with about
twenty six thousand lines of code
compared to one hundred and eighty
thousand lines of Nass horn so what do I
have to do to maintain it well if v8
updates well maybe I might have to
change some the api's but it's gonna be
a lot less work to maintain and long
long time so in dollars and cents you
know like I save it the cost of a
company a typical programmers three
three hundred thousand dollars when NASA
was six hundred or six million dollars
you can see you know where this all
makes sense in your case experiments
they have in progress we're talking
they're talking about using Panama for
down calls so we don't go through J and
I went down call through through Panama
we can use web assembly for up calls web
assembly's ideal for marshalling
arguments and doing the correct data
types strong typing we have security in
place sandbox security the same as NASA
NASA if you have the Security Manager
activated it just works we also
implemented the class filter so you can
filter all the classes that you feed in
you can also do a no Java and that give
you any access to Jeff at all if you
just all you want to do is execute
scripts
we've got debugging working using the
the chrome dev tools we can understand
why JavaScript programmers are so in
love with JavaScript because the chrome
dev tools are great you can you can do
all your standard debugging you can do
performance analysis it they're they're
really great tools
and they just work we got them for free
basically well a little bit of work we
have server governance so some of the
projects that are used here want to be
able to control the execution so we can
control the execution of these threads
we can basically say oh the threads run
too long to kill it we can do that or
it's used up too much memory kill it we
can do that so for in the server
environment we can set it up of course
everything is cloud these days
so we did a little test and to find out
the weather minimal image would be it's
around 60 60 Meg we haven't done a lot
of tuning so we can might be able to do
something about that if you do a lean
create a lean J nodejs that's about 44
Meg so we're in the ballpark and the big
difference here is that while you've got
a lot more Java there than node.js has
minimally so where to next well
amazingly this is all pretty stable
I started up that node example and they
just sat there for weeks and I didn't
even look at it you know and any time I
did look at it it was still chugging
along and the memory wasn't but climbing
or anything it was just still working so
it seems to be very stable there's some
projects internal Oracle that are
currently using this package and our
next step is to try to figure out what
we need to do to put it out in the open
our current thoughts are actually to put
it into to Oracle github seems to be an
ideal place for it we're currently only
supporting Linux and Mac OS 10 the only
reason we haven't done Windows or
Android or any of those is because we
just haven't had enough bodies to create
to make files or whatever necessary to
make that happen
so we have to figure this all out in
balance so let's call this go Panama
because I think that's probably the next
step is to figure out how we how we fit
this in with the Panama environment to
get good for
- the J&amp;amp;I calls and I got to use my
graphics so thank you I guess that's
really the plan ultimately it's not
something he's going to happen right
away
I see I think NASA one's life is at
least another year and a half to two
years or so and it may never die because
the thing is that you know unless we
deal with the J&amp;amp;I issues then what's
with you know what's a difference as I
fight at that time you know we're all J
s made to step that spring so so you
know we're going to continue to put
effort into nests or we're going to
continue to introduce the six features
that aren't implemented in jt9 and as I
say we're not really sure where this is
going as far as public use is concerned
or general uses concern so that that's
sort of an undecided question long-term
whether it actually shifts with JD JD K
that's a whole other big story because
the fact is that obviously binaries are
involved and we don't ship binaries with
the G you know story binaries in the jdk
repository so it gets complicated from
that sense so there's a lot of other
factors that have to be figured out so I
know you said a few things about
performance how would you in the final
analysis compare all that so we're not
really there yet but the thing is that
we haven't introduced anything that
would take away from that performance
the only thing that you know really is
this this java support script that has
to run and you know it's just a few
milliseconds to run in order to populate
i can't remember how many lines of code
it is it so actually do i had a slide
there that told you how many JavaScript
lines on it so it's it's a it's it's 50
but it's not enough to really slow down
significantly so if you're just doing
straight JavaScript it's basically back
to where we were talking before it's
pretty fast
okay that's it oh yes oh you're going to
support all the platforms that Java runs
on likes bucks now probably not unless
LS you know there's unless there's a
demand for it right so it's a case of
we're trying to do some migration path
for Nance or Altima we're trying to do
and the need for performance is now
right people are people are demanding
performance now so this basically
provides that performance now the
long-term strategy is you have to be
worth it so I'm not really hearing it a
much Jeremy here maybe I shouldn't say
that I I was I was drawing I'm not gonna
yeah yeah yeah so be a resume runs out a
lot of platforms yeah we can do the work
and we and we may but it will be
probably on a need basis as opposed to
we're just going to do it for everything
right so our current need is primarily
Linux right now right so anybody else
going once going twice
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>