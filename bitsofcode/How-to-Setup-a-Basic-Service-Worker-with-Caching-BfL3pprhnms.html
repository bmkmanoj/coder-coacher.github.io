<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Setup a Basic Service Worker (with Caching) | Coder Coacher - Coaching Coders</title><meta content="How to Setup a Basic Service Worker (with Caching) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/bitsofcode/">bitsofcode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Setup a Basic Service Worker (with Caching)</b></h2><h5 class="post__date">2016-05-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BfL3pprhnms" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video I'm going to show you
how to set up a very basic service
worker so it should be able to service a
boiler paid for you so if you have any
projects you can hope he expanded to
what it is that you need it to be so if
you don't already know what a service
worker it is that's okay it's still a
relatively new technology but very
basically what a service worker is is a
scope that one's independent to the
webpage so if you think about your
typical in JavaScript you can use it to
interact with things in the Dom but with
the service working you can't actually
do that and what it actually does
instead is those things like background
sync and performance push notifications
or what we're gonna be working with here
which is handling fetch requests and
caching so it's still a relatively new
technology as I said as you can see most
browsers don't support it and even the
ones that do don't support it completely
fully yet but still a technology was
getting to know now as it's very
powerful and will likely be the backbone
of a lot of applications in the future
so in this tutorial we're going to be
setting up this web page as you can see
is just a very basic HTML page but what
it does is it pulls this image of arts
from NASA's API and what we're going to
do is set up the serviceworker to set up
caching so that all this information is
going to be available even when we are
offline
so that's pretty much it let's get
started
okay so to get started this is just the
basic page and you can see it here so
all we have is we're getting the front
from Google Fonts our style sheets and
the basic page and the images are being
loaded right now because we're going to
get it from the API later and also
loading our script file so because
service workers require us to actually
have HTTPS but while we're working
locally all we need is just a basic
server so here this is the directory
boilerplate serviceworker and we've got
a code file and we're using go connect
here to just set up a basic server and
I'm just running that here all we need
to do is type in gulp when we're in that
and then we can set up so I local who
support 88888
so the first thing we want to do is
actually register the service worker and
we do that in our app file so if we go
to Jay s FJ s so the first thing we have
to do is check if the browser actually
even has service workers so we go if
there's service worker in our navigator
then we can actually start so we go
navigator dot service worker and then
first start register I just like to do
on a new line to keep everything by
itself so now we just link to the actual
Service Worker file and as you can see
here it's in the same in the root
directory so service service worker das
and then we set the scope and although
this is the default I'm just gonna write
two anyway so the scope is the directory
in which that service work on file is
end so this whole source directory right
so then I just raishin so if it was
actually successful let's just do a
console log registered and we can pass
the registration just the first couple
of times so we can see if it works and
catch if there's an error just go
register and then pass in that error as
well so let's see if it worked
so we go back here open this up and
let's just do a heart reload so it's a
service worker register and then we get
this registration so we can see active
you can see the scope is in that
directory and all of this stuff as well
so I don't want that being passed all
the time so I'm just gonna remove the
registration and what we can also do is
if we go to here so chrome colon slash
slash serviceworker internals we can
actually see the serviceworker is here
and here we can stop it inspect it on
register and all in fact once we've done
that we can now go into the
serviceworker GS and actually start
doing stuff so there are three events
we're gonna be working with
so we're gonna have the install and vent
the activate event and the fetch event
so I'm just gonna set those up so that
they're working and that is in there so
first of all the event I'm just gonna
put this brackets around so I can tell
that these consoles are coming from
actual server solutions so installed
right so you are also noting URL as
being
so install activate and that we can
unregister this if you want and then you
do a hard reload and see okay cool so
installed and activates it's working now
so the next thing we want to do is work
with the - and what we want to do is set
some files that we just always want to
be in cash so they would generally be
local files but I'm also going to add
the Google Fonts so first of all we have
to say what the cache name is and the
reason we do this is so we can set
versions in our cache so we can say if
we now update this to version two then
we can update what's in the cache
basically so then we have the files that
we want to cache and it's just gonna be
an array of files so the route those are
what we need to cache always so on the
install event what we want to do is use
this eat don't wait until so what this
means is that the install event is going
to be is going to have to wait until the
promise within this is going to actually
until the promise within this is
actually going to be resolved so what we
want to do is open the cache right and
open the cache corresponding to this
cache name then
let's just do consult love caching cache
files so what we're doing so is actually
just cashing these files so I'm just
adding that to the console so we can
know what's happening so what we're
going to do is cached off add all cache
files so that is pretty much it so what
we can do is actually see if it works
right so that and then empty cache and
then we can see caching cache files so
that's working
so if we actually changed us to version
2 what happens right so what we want to
do is make sure that files from old
caches don't remain there even though
we're not going to use them so in the
activate events or if you do is another
wait until all and then this time we're
going to do is loop through everything
that's in the cache and then remove
anything that corresponds to a cache
name that is not this cache name so the
way we do this is caches these names so
this is all the cache names so return
this cash
so we're looping through everything in
the cash I'm getting this particular one
what we're going to do is check so if
this cash name does not correspond to
the current cash name then we wanted to
say console let's look to the consulate
for removing something service worker
let's say this cash name and then what
we want to do is return cashiers delete
- name so let's see so we're waiting on
to the activate so the activate events
robber is waiting until this is resolved
before continue so what's doing is going
through all the keys and the cache and
looping through everything so looping
through all of that and checking if they
find something that the cache name does
not correspond to this cache name and it
just deletes that so let's try
thank you cash so as you can see because
we're now in version 2 now says removing
cached files from the version 1 cache
so before we actually start with this
festevents what I want to do is go back
into our app yes and if you remember
there's supposed to be an image of our
from NASA here so we're gonna do an HTTP
request for that so first of all I'm
just gonna copy this function and I did
before so it just does performs HTTP
request so we don't have to use jQuery
or something about so then I'm gonna
copy so this is where we're getting the
image from just this and when you get it
if it's success what we do is this image
here we just set the source to the
response URL so I'm gonna refresh that
let's just do a hard reboot come on
and there you go so now the problem of
this obviously now is that it's going to
have to note this is first of all going
to have to perform the request to the
API every time and also load that image
every time but what we want is to
actually caches so back in our service
worker and the fetcher bruh what we're
gonna use is use a different methods so
here we're using wait until both here
we're gonna use you don't respond to the
width so here we're actually just
responding to this bench event with what
we want it to be so first thing we want
to do is actually check in our cache
whether the requests the requested URL
already exists so cache is the match Ito
request so then
then response so two things right if
it's in the cache right if response does
exist so let's just do console don't log
server so ground and just pass you don't
request are your own so it's been found
in the cache and then all the attitudes
just returned the cached version right
so then we're not actually having to
fetch it again but if it's not found in
the cache what we want to do is actually
just fetch it so you don't request and
return that so let's try the first time
okay so obviously here is that this
google font if you remember from here we
actually cached it the first time so the
next time that we try to reload the page
if was found in the cache and that is
what was being loaded instead whereas
for this the Google the Google API in
the map of Earth because it wasn't here
we still have to fetch it again so what
we want to do is actually change this so
that if if it's not actually found in
the cache when we fetch it we should
actually cache it as well so the next
time they don't have to fetch it again
they can actually fetch the cached
instead what we have to do first is
actually clone the request and clone the
response and the reason we have to do
this is because it's a stream and if we
want to use it more than once we need to
clone it and I'll mix the process and
when we go down so request clone it and
close to each other request right so
instead of returning this right so we're
gonna fetch the request right
so if there's let's just do it there's
no response right for whatever reason
but it's just that they turn it okay but
if we do get a response but so we'll be
able to color this response then what we
need to do is similar to up here where
we just cached all of these things we
need to open up the cache again so I'm
just gonna copy this open up the cache
again just clues that and then cache
stop foot so we're gonna put the
requests so what you can see here okay
and we actually return it and then we're
gonna return this response what you can
see here is writing that's twins so
we're using this request for no more
fetching it's right and we're using the
original one here when we're putting it
into the cache so we can't use the same
one which is why you need colons and
similarly in the response we get when we
fetch it we're using it first when we're
cashing it and then we're using it
second when we're returning it so there
was just wide we had to clone that as
well finally let's just do so if this
doesn't work let's just add a little
touch yeah
for whatever reason I just saw so there
was some error touching and washing the
detail and then at that dinner so let's
go back and see what happens here so I'm
gonna register this again and empty
cache and hardly load so you can see
installed register you can see it takes
a long time because first of all hitting
the API then we're having to get the
image URL which is being served from the
Google API engine so when we reload
again what you can see here is first of
all everything was a lot quicker because
it was all coming from cache so we can
see here is fetching all of the stuff so
the Google API the Google font rather
was found in the cache and also the the
image from NASA so first of all the API
request to NASA was found in the cache
and second of all the actual image
itself was found in cash so if I were to
turn off the Wi-Fi which is what I'm
about to do now just on that and i
refresh the page everything still loads
so that is pretty much that we're back
to where we started so we have this
image being loaded from NASA and there's
no Wi-Fi right now so everything is
being served from the cache and what
we've done this with this basic service
worker and you can modify it in any way
you want so you can say depending on
what the URL is we want to cache it or
if it's not the specific URL we just
want to fetch it we don't want to
actually cache everything so you can
modify in any way I'm gonna have the
links to everything down in the
description and thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>