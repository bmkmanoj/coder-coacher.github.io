<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Registration Solution - Web Development | Coder Coacher - Coaching Coders</title><meta content="Registration Solution - Web Development - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Registration Solution - Web Development</b></h2><h5 class="post__date">2012-05-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6oi3VImtNkY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay this is the unit for homework
solution to recap the first thing I
wanted you to do is make a registration
page this should look basically like the
homework to where we made the form and
so you know if you type in some junk we
get the same error messages and if you
type in a valid username and password
and you submit you get redirected to
this welcome page that says welcome and
then it has the username in it and the
username this time is not included as a
get parameter it's actually included in
a cookie and I'm using this little
cookie extension in chrome so I can see
the cookies and in this case you can see
it included this is supposed to be the
user ID five this is the hash of that as
we discuss that technique in the lesson
so let's look at the code for this first
problem once you've solved this first
registration part of the homework the
other two parts of the problem are very
easy because they just kind of build on
the same code so we're gonna be going
through a lot of code here for this
first part the first thing I have is I
have a secret which is just this random
string that we're gonna use as kind of a
hash secret for cookies normally I
wouldn't store this in the same file as
my code I probably stored in some other
module that's only on the production
machines or something like that but for
our purposes it's fine just to stick it
in here again a lot of this code you've
seen before a template directory stuff
here are two functions you know you
basically had quiz problems in the
lesson for generating these functions
for making a secure Val which takes a
Val and just returns that value a pipe
and then the H Mac of that Val we did
this in the lesson so you should be
familiar with this and then they a
function for taking one of those secure
valves and making sure it's valid
you know we split on the pipe if we call
make secure Val on the value we pulled
out of this string if it matches that
string itself it's valid so you've seen
this function so we did them in quizzes
and we're gonna be using them in here
here's this blog handler this is the
class have been using kind of parent
class for all of my handlers I added
some more functions right render stir
and render those are old I've added a
function called set secure cookie which
basically sets a cookie whose name is
named and whose value is Val all it does
is it basically it gets the secure calls
make secure Val on this Val and then it
stores that in a cookie and we store
cookie by just using the setcookie
header and say name equals Val path
equals slash we could also include an
expires time but I didn't here so by
default these cookies are going to
buyer when we close the browser which is
fine for our purposes and then we have
another function for reading a secure
key you give it a name and it finds that
cookie in the request if that cookie
exists and that cookie passes check
secure Val we return cookie val and
python you can use this kind of shortcut
notation for saying it's the equivalent
of writing if cookie val and check
secure Val return cookie Val if one of
these is false we just return false or
none or whatever we've got this function
log and this will be used for the second
part of the homework for actually doing
logins and this just sets the cookie and
we've got a function logout which I
believe is the third homework question
we'll come back to these I edit this
function initialize you don't strictly
need this Google App Engine is a
function that gets called before every
request and so what I have it do is
check for the user cookie which was
called user ID if it exists store and
self that user the actual user object
which we'll get to this in a second now
you don't have to do this but kind of
did the more complicated route where you
have to login to enter things into the
blog and it keeps track of on all the
blog pages who the user is and that sort
of thing so if you're gonna have that
kind of structure where once you're
logged in every page is a little bit
different it's handy to have some sort
of function like this that gets run on
every request and just checks to see if
the user is logged in or not and that's
what this initialize function does and
this function is called by the App
Engine framework so we still have some
of our you know some of the blog stuff
I've been doing all the homeworks in the
same file so you'll see some of the
other homeworks in here we have this
function makes alt this was a quiz
function just to make a string of five
letters so that's what this does this
makes result this function was also a
quiz function I believe for making a
password hash you know it takes a a
username and a password and an optional
parameter for salt and then returns the
salt comma the hashed version of the
name password and salt this is what we
store in the database and then we have
this other function also a quiz question
from the lecture of how to verify
password so it takes a name and a
password and the value in the database
and it makes sure that the hash from the
database matches the new hash created
based on what the user answered it again
quiz question you've seen that before
users key this creates the kind of the
ancestor element in the database to
store all of our users again you don't
have to do this you know I like to have
things a little
organized so again I gave it kind of a
parameter and thinking maybe I'll have
user groups in the future I don't right
now
that's just how I did it okay so now we
get to something with just in code this
is our user objects that will be storing
in the database so it inherits from DB
model that's what makes it a data store
object and it has three parameters has a
name which is a string property required
a password hash which is a string
property also required and an email
which is a string property but not
required now remember we don't actually
store passwords in our database we just
store hash to the password we can't
grade that we can't tell how you're
storing the stuff in your database well
we could but we'd have to you know have
you I don't know write some other
handlers or something so but this is how
I'm doing it and then I added a couple
functions on this class object I'm sorry
on this on this class that are kind of
convenience functions this syntax here
at class method this is called a
decorator I'm not going to get into
exactly what decorators are but what
class method does is it says you can
call this method on this object doesn't
have to be an instance of this object so
normally you would say the first
parameter on a method on a class is self
that's kind of referring to yourself
that instance in this case I call it CLS
for class which just means it's
referring to this class user not an
actual instance of the user you know not
spent it's not an actual user object so
we can just say user dot by ID give it
an ID and then we'll call this get by ID
function to load the user out of the
database get by ideas built in the data
store if you recall from the previous
homework I had this kind of make key
thing and and just called the get
function well that was before I learned
about this get by ID function which is a
more convenient way of doing what we
were doing that I have another function
called by name which looks up a user by
its name I'm using the data store
procedural code again for doing the
database lookup instead of the gql
because i prefer typing this i think
it's a little bit easier to read and all
you do is you say filter name equals and
then you can give it another parameter
so this basically says select star from
user where name equals name we call get
on that which returns the first instance
and we return that another function I've
added this method called register which
takes a name of a password and email and
it creates a new user object so the
first thing it does is that it creates a
password hash for that name and password
and then it creates a user object the
parent is that user key
not required for you guys name equals
name password hash equals password hash
email echos email so that creates the
user it doesn't actually store it in the
database yet it just creates the apt and
here's another another one called login
we'll come back to this one but it's
it's fairly self-explanatory for the
future homework so now let's go down to
the handlers you can see I've added
three handlers for each of these three
homework problems the first one we're
talking about a sign up so slash sign up
goes to the register handler let's take
a look at that now the register handler
here inherits from the class sign up
sign up is actually up here and it's
identical to what I had or nearly
identical to what I had for the homework
too since I'm working in the same file I
didn't want to rewrite this whole class
again
you know we're still rendering sign up
form like we were before we're still I'm
not gonna go through this in great
detail but you know we still get all the
values out of the request we still check
to see if they're all valid and if
there's an error we rerender the form
with the error messages and the values
you know just like we did before and if
there's not an error I call self dot
done which in this class signup doesn't
do anything it just raises an error and
then I have two other classes that
inherit from signup and overwrite this
function done the first one is the unit
to sign up page and all that one does is
it redirects to slash unit to welcome
with the get parameter so that's how we
did the unit two homework the register
one over writes done to have different
behavior first what it does there's an
extra error that can occur in this one
is that the user can already exist so
what I do is I look up to see does that
username already exist and if it does
set an error message and I rerun to that
form error username equals message so I
probably could have done this a little
bit cleaner but this is kind of just tax
on an extra message so this it doesn't
preserve the it doesn't appear that it
preserves the parameters if you enter in
a duplicate username there's a little
less than ideal I probably could have
put some more things in there but that's
how we have it set up here otherwise if
that error doesn't exist we register the
user which creates our user object and
then we actually store it in the
database here and then what I do is I
call my login function all the login
function is does is set the cookie so
for the first homework you may not have
a login function you may actually just
set the cookie here and then you we
redirect to the Welcome page but then I
generalized that when I did the login
version and just made this work have
this login function that you know
multiple handlers can use because we'll
have both the signup page for
registering and signing in and then
we'll have the just the law
in page four you know not creating a new
user but signing in to an old one and
they can both use this login function
and we'll go over that in a second we
redirect a unit through your welcome
which is down here this handler unit 3
welcome and all this does is it checks
to see if self dot user and remember
self that user gets set up in that
initialize function that's where it
reads the cookie and make sure the
cookie is valid and sets the user on the
handler and since this unit 3 welcome
inherits from blog Handler it has access
to that user we render our welcome HTML
you can probably guess what's in there
with username equals self that user that
name otherwise we redirect to the signup
they see that working one more time
again so now that you've seen the code
okay so if we enter in a username and a
password we should actually get an error
message that this username already
exists and we do and it cleared the form
because I was a little bit lazy on this
one and didn't preserve all those
parameters although I easily could have
so let's type in a new username and
submit the form everything worked and if
I were to on this page modify this
cookie
let's change it's a user ID 5 which is
what we had before and I were to reload
this page we get redirected to the
signup page because the value in that
cookie doesn't match the hash in that
cookie therefore it's invalid and we get
bounced to the signup page so that is
the first question in this homework</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>