<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Loop Unrolling Benefits CPI Part 1 - Georgia Tech - HPCA: Part 3 | Coder Coacher - Coaching Coders</title><meta content="Loop Unrolling Benefits CPI Part 1 - Georgia Tech - HPCA: Part 3 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Loop Unrolling Benefits CPI Part 1 - Georgia Tech - HPCA: Part 3</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2nx0ZCg5D9g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so we will see now that another benefit
of loop and rolling is that it allows us
to also reduce the CPI in addition to
reducing the number of instructions to
get some idea for how the CPI changes we
need to have a processor so let's assume
we have a four-issue inorder processor
meaning it's only able to look at the
next four instructions to see what can
be executed together meaning it can only
look at the next four instructions to
see what it can execute together and
let's assume that the processor has
perfect branch friction so first let's
look at what happens when we try to
execute the original loop so to see what
happens with this loop in this processor
let's look cycle by cycle at which
instructions can execute in the very
first cycle we will try to do this load
and then we will try to see whether we
can execute the next instruction in
order in the same cycle but we cannot
because it depends on the load so this
instruction has to be done here
now we will look at the next instruction
and try to execute it in order in the
same cycle but we cannot because it
depends on our two again so we move here
the next instruction however does not
depend on the previous one so we can do
this ad here but then for the branch it
does depend on our one so it can be only
done here because we have perfect branch
friction this load has also been fetched
from the next iteration and it doesn't
depend on the branch it was done here so
we will actually do the load for the
next iteration and then we will again
not be able to do the ad so the ad
happens in the next cycle and then in
this cycle these two happen and so on so
overall after this initial load that had
to be done by itself just because there
was no branch before it it takes us
three cycles to do all five of the
instructions in the loop so the CPI here
is three cycles for five instructions
but remember that we can do scheduling
of this loop to try to improve the CPI
so before we get into what's the CPI of
the unrolled loop let's see what the CPI
is if we schedule this loop body our
scheduling will start out with this
body and then try to maximize the CPI
that we can get by reordering the
instructions so clearly here this load
could not be done in parallel with the
next instruction because there is a
dependence there so we need to find
something and it cannot be the branch
because it needs to stay at the end of
the iteration that we can put here and
this add I can move there so our
scheduling algorithm will move the add I
here
so now that we are subtracting 4 from
our 1 here we need to adjust this store
so that it adds back the 4 that we
decrement it here because the store was
supposed to store to the same element as
the load now however we have moved our 1
so to access the same element as the
load we need to add 4 here note that
moving the a die is really the only
scheduling freedom we have here because
we need to do the load and the add and
the store in that order so they cannot
be reordered the branch needs to stay at
the end of the loop so pretty much the
only freedom we have is where is the add
I going to happen so now let's look at
what happens cycle by cycle we can do
the load in the first cycle the add I
can now be done together with the load
but the add to what we loaded still has
to be done in the next cycle the store
cannot be done until this add is
complete the branch can still proceed in
parallel with the store and now because
of perfect branch friction we are going
to move here and we can try to do the
load for the next iteration
note that r1 has been updated here in
the previous iteration so all the way
through here we really did not modify r1
so pretty much the store or the branch
didn't modify our one that's the only
register dependence that this load has
so the load can be done here and then we
can also do the r1 update here because
this add I only depends on our 1 and the
r1 has been updated here so we can do
this so as you can see now it takes two
cycles to do these five instructions so
the CPI we get is now two over five it
took us two cycles to do the five
instructions this is significantly
better
than without scheduling so scheduling
did help</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>