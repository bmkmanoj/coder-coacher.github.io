<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Project Operator - Data Wranging with MongoDB | Coder Coacher - Coaching Coders</title><meta content="Project Operator - Data Wranging with MongoDB - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Project Operator - Data Wranging with MongoDB</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_kupbxrZBds" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so now I want to pick this up and
talk about the project operator so a
couple of things to note about project
we can use project to include fields
from the original document remember that
project works with data in a single
document at a time and we're essentially
doing a shaping task with project so the
simplest form of shaping is simply
specifying which fields from each of the
documents were receiving in the stage
using project we would like to include
and pass along to the next stage one
really cool thing we can do with project
is insert computed fields so for example
a ratio which is what we're going to do
for this particular example we're
working through we might also rename
fields and finally we can do some pretty
substantial reshaping of the data by
doing something like creating fields
that hold sub documents that are
composed of what we're originally
top-level fields in the documents as
they came in to the stage using the
project operator so let's go back to our
code and look at how we're using project
here remember the problem we're trying
to solve here is addressing the question
who has the highest followers to friends
ratio so here it's pretty
straightforward
we're simply pulling out the screen name
field of the user sub document okay and
again we use this dollar sign here
because rather than this being
interpreted as just a string literal
we're telling MongoDB that we want the
value for each document that's found in
the user sub document and in the screen
name field okay so in documents that get
passed along from this particular stage
they will have a screen name field
composed of that value for each document
that we received as input here okay now
let's look at this portion of the
project stage here so we're going to
create a ratio field and documents that
come out of this particular stage and
that ratio field is going to have the
value of having divided the followers
count by the friends count so quite
literally calculating this ratio here
again remember friends in the documents
we're looking at here are the number of
people that I follow as opposed to
people who follow me
okay so again diving into the user sub
document we're going to pull out the
followers count and of the friends count
again making use of the dollar operator
here to indicate we actually want the
values of each of these and then we're
going to use the divide operator to
calculate the ratio of these two values
it's that value then that will make up
the value of the ratio filled in each
document that gets passed along from
this stage using the project operator
okay
so when we get to this stage all
documents will have exactly two fields
ratio and screen name and then we're
simply going to sort in descending order
based on ratio and then of course limit
to just the very first document that we
see so let's run this okay and again our
output from an aggregation query is
always a single document the results
were really interested in are always in
the result field which is an array
valued field okay so in this case the
user in our tweets collection that has
the highest followers to friends ratio
is a user called terrific okay turns out
this is actually a Twitter application
and even today if you look at Twitter if
expand on Twitter you'll see that they
have something on the order of nearly
half a million followers but they only
follow about 14 people so their
followers to friends count ratio is
still extremely high so again in this
example we focused on the dollar match
operator which is just a filter the
dollar project operator which is a
shaping operator we actually have lots
of things that we can do here and the
sort and limit operators so in this case
we've got four stages of our pipeline
now one thing before I wrap this up is I
just want to quickly point out that we
can build a variety of types of
expressions using the project operator
if we take a look at the MongoDB
documentation there are a number of
arithmetic operators that we can apply
as well as a number of string operators
date operators and so on so this is the
aggregation expression operators page in
the docs
I encourage you to look here for more
information on the different types of
operators that are available to you when
working with project as well as the
other aggregation framework operators
see the instructor notes for lis
to this page</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>