<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Incorporating HMAC - Web Development | Coder Coacher - Coaching Coders</title><meta content="Incorporating HMAC - Web Development - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Incorporating HMAC - Web Development</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iLqlJzqSmak" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is our old code I want to
demonstrate the vulnerability in our old
code so we can make sure we fix it so
this is the old code running here and if
we were to take a look at this we're
going to modify our cookie document that
cookie that's the value let's say we
want to set this to the visits 10,001
first we need to find what the hash of
10001 is we can use Python for that
let's go ahead and try that real quick
import hash lid I slipped
md5 dot 10,000 1 X digest okay we'll
take this value here let's take that
with us into our browser we're fortune
cookies here so I say document dot
cookie equals visits equals 10,000 one
pipe our new hash value now when we
reload this page whoa we are the best
ever but we're not the best ever we just
cheated okay so let's incorporate the
new functions we just wrote into our
code so here we are in our editor and
I've plopped in our new function we're
going to move secret out of the way here
we're going to pretend this is actually
a secret and it's actually in another
module that you don't publish or share
and now our function should be as as
good as new
let's try this let's try this out in our
browser okay so here we are on a browser
we've dropped in a new hashing function
so our old cookies are going to become
invalid and when we reload the page you
can see we've been here one time if we
were to inspect the cookie document
cookie we see that we have this cookie
now it's got the same format as a
previous cookie except this one is very
hard to forge without knowing that
secret we all we can do is guess at the
hash and that's you know the property of
the hashing algorithms is that that is
basically impossible to get correct so
if I were to modify this cookie document
that cookie equals visits equals 10,000
won I mean what value do we even put in
here I mean we can iterate over you know
every possible hash and just kind of
guess at it and maybe you get lucky but
we'd have to get extraordinarily lucky
you see I reloaded the page and reset
down the 1 and when I mean
extraordinarily lucky I mean we'd have
to take more time than there are you
know atoms in the universe to figure it
out
so that's not going to work in our favor
okay so that's pretty cool I just want
to summarize that algorithm so so it's
clear what we did instead of setting the
cookie visits equal one which can be
easily forged and instead of setting the
cookie visits equals 1 and then the md5
of one which can also bleah
also be easily forged if you know that
we're using md5 we instead set it to
visits equals 1 pipe h mac secret comma
1 and as long as we keep this secret
secret they can know our algorithm they
can know what we're doing they can even
see our code and they won't be able to
forge invalid cookies which is a pretty
neat property we use this all the time
because imagine if we're not counting
instead of counting visits we're
counting user IDs it would be a real big
problem
you know if I'm logged into you know my
mail my gmail and I've got a cookie that
identifies you know who I am if somebody
could just say well you know my user ID
is Steve's user ID and then be logged
into my email that would be a very big
problem so that's why you do things like
this this prevents people from forging
your cookie and also it saves you some
effort validating on the server side
because if this doesn't validate you
don't have to check to see if the string
is all digits and all that sort of stuff
because you know it came from you you
know what you set it to and it makes
your life a little simpler so this is a
really popular strategy we're going to
use for all sorts of things in this
class</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>