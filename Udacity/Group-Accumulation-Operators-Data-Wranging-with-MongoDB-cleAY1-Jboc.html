<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Group Accumulation Operators - Data Wranging with MongoDB | Coder Coacher - Coaching Coders</title><meta content="Group Accumulation Operators - Data Wranging with MongoDB - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Group Accumulation Operators - Data Wranging with MongoDB</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cleAY1-Jboc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay now I'd like to talk about group in
a little more detail by now you should
understand that groups role is really to
aggregate its input in some way based on
the operators specified here are a list
of operators that we can use in grouping
documents together in the aggregation
framework we've seen some several times
first simply selects the first document
in a group last the last document in a
group max min and average all do what
you might expect based on a numeric
value we're calculating as part of a
group as one example let's take a look
at average so here I have an aggregation
pipeline and the idea here is to
calculate the average number of retweets
for any tweets using a particular
hashtag so we do an unwind on the
hashtags array of the entities field
then we're going to group based on the
text of the hashtag so this will give us
one document for every hashtag used in a
given tweet so then in the group stage
here we're going to aggregate based on
the text so based on the hashtag itself
and then I'm going to calculate an
average based on the field retweet count
which is the top level field for tweets
finally we're going to sort based on the
retweet average okay so this gives us an
idea of where we might use average and
what it looks like the syntax is very
similar to what we've seen with some now
what I'd like to do is nudge this
discussion of operators along just a
little bit and I'd like to introduce a
couple of additional operators one is
push and the other is add to set these
are extremely useful operators in a
variety of different situations because
these are operators that actually deal
with arrays okay so let's take a look at
an example of where we might use
something like this we're gonna look at
an example involving add to set
essentially what add to set does is as
its accumulation function for a grouping
it adds values to an array but does so
by treating the array as a set that is
it won't add the same value more than
once to the array we're accumulating in
okay so here's an example now in this
example what I'm doing is aggregating
together all of the unique hash tags and
grouping by the users screen name so
this is essentially all of the hash tag
that an individual user has used in
their tweets but we're ignoring hashtags
that a user has used in multiple tweets
so here we're gonna use ad to set to do
that and the way this works is we're
gonna group again we're gonna specify as
our ID to define the grouping based on
the screen name of the user creating the
tweets okay
note that we're unwinding based on the
hashtags array so what we're going to do
then is use ad to set and for each
hashtag the actual text of the hashtag
we're going to add that to this array
unique hashtags that's part of the group
document for an individual user using AD
to set insures that no matter how many
times a given hashtag occurs that is no
matter how many times a user used it in
a given tweet so no matter how many
times the group stage sees that text it
will be added one only one time to this
unique hashtags array and then I'm
simply going to do a sort based on ID so
let's run this okay and so all we're
getting out is a list of pairings for
screen name and a list of all the unique
hashtags they've used okay so we can see
that for this particular user one two
three four five six different hashtags
used we don't know in how many different
tweets or how many times this is
essentially the vocabulary of hashtags
for this particular user and if we
scroll through here we'll see we'll see
the vocabulary of hashtags for all of
the users in this collection now what
might be more satisfying here is if we
were to do something like sort based on
the number of unique hashtags that
individual users have written as part of
their tweets but that's going to require
us to do something we haven't talked
about yet which is using the same
operator in more than one group stage in
an aggregation pipeline well look at
that next</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>