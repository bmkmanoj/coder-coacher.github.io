<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Marshaling and Data Copying (cont) - Georgia Tech - Advanced Operating Systems | Coder Coacher - Coaching Coders</title><meta content="Marshaling and Data Copying (cont) - Georgia Tech - Advanced Operating Systems - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Marshaling and Data Copying (cont) - Georgia Tech - Advanced Operating Systems</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QK227Ey8Cu4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">an alternative to dumping code into the
kernel is to leave this tub in the users
face itself but have a structured
mechanism for communication between the
client stub and the kernel and that
structured mechanism is a shared
descriptor and the shared descriptor is
a way by which the stub can describe to
the kernel that here is some stuff
sitting in the user space and I'm going
to tell you how exactly you can extract
this information from the user space and
construct it into this buffer for
transmission on the wire recall what I
told you earlier and that is the kernel
has no idea of the semantics of this
call and therefore it has no knowledge
of the actual arguments the data
structures that are being used in the
call so what we're going to do is use
the shared descriptor as a vehicle for
the stuff to communicate to the kernel
the data structures that need to be
passed so for instance let's say that
the argument for the call has four
parameters then this descriptor has four
entries and each entry is saying this is
a starting point of a particular data
item and this is the length of the data
item this is a starting point of the
second data item and there's a length of
the data item third data item fourth
data item kernel doesn't have to know
the semantics of these data items all it
needs to know is what is the starting
address for a particular data item and
what is the length of the data item
that's all it needs to know and this is
the descriptor that allows the stub to
inform the kernel aboard the arguments
how many arguments there are and what is
the size of each argument it doesn't
have to tell the kernel oh here is an
integer is a floating point here is an
array no none of that all that the stub
is doing is it's saying here is the
starting address for an argument and
here is the length of the argument
because usually data structures are
organized continuously so if you have a
an integer it is occupying four
contiguous bytes in memory if you have a
floating-point number it is occupying
some number of contiguous bytes in
memory and therefore what the stub is
doing is is creating the shared
descriptor that is providing the
information to the kernel
in the layout of the arguments on the
stack and once the layout of the
arguments on the stack are known to the
kernel then the kernel can use this
contiguous data items that are living on
the stack described with the share
descriptor and create a contiguous
packet in its internal buffer that's the
second way you can do in order to reduce
the number of copies from two to one so
in both cases what we have done is
either the first approach of pushing the
client stub into the kernel or the
second approach of having a shared
descriptor between the user stub which
is living in user space and the kernel
in order to describe the layout of the
data structures that need to be
assembled into a network packet by the
kernel using the shared descriptor both
of these allow us to reduce the number
of copies from 3 down to 2 either there
is one copy that is happening going from
the stack into the kernel buffer and the
second copy as I said is inevitable if
the network controller is requiring a
DMA to be done from the system memory
into its internal buffer before the bits
can be pushed out on the wire so that's
the first source of overhead and so
these are techniques that we have looked
at two different techniques for reducing
the copying overhead that is the
dominant part of marshaling the
arguments and this happens on both sites
it happens when the client has to push
the arguments to the server side and it
happens again on the server side when
the server has to push the results back
to the client so the marshaling is
happening on both ends and for both ends
we can use this technique of using a
shared descriptor or pushing the client
stub of the server stub into the kernel
in order to reduce the number of copies
from two down to one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>