<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rate Limiting Exercise | Coder Coacher - Coaching Coders</title><meta content="Rate Limiting Exercise - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rate Limiting Exercise</b></h2><h5 class="post__date">2016-06-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/j-yu4yJbIS4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I will create a new view spy file with a
route called bright slash limited later
I will create a limiting decorator to
restrict the number of requests I should
point out that for this example I'm
using the IP address of the identifier
of the client this way rate-limiting
works even for non logged in users but
you can change this for your
implementation of future projects Redis
is an open source in memory data
structure that can be used as a database
cache and message broker Redis provides
us with a fast way to keep track of
endpoint requests that is also scalable
your vagrant machine already has Redis
installed just run Redis server from
inside your vagrant machine to fire up
this Redis instance you can now pull to
your reticent sense with the code here
now I will make a class called rate
limit that takes in the new object model
introduced in python 2.2 I will make a
variable called expiration window that
will give my key an extra 10 seconds to
expire in Redis so that badly
synchronized clocks between workers and
the Redis server do not cause any
problems I will now create an init
method for the rate limit class taking
in itself the variables key prefix limit
per and send X headers key is going to
represent a string that I will use to
keep track of the rate limits from each
of the requests limit and per define the
number of requests we want to allow over
a certain time period and send X headers
is a boolean option that will allow us
to inject into each response header the
number of remaining requests a client
can make before they hit the limit I
will define reset here to make a
timestamp to indicate when a request
limit can reset itself then I will
append this to my key we use a pipeline
to make sure that we never increment a
key without also setting the key
expiration in case an exception happens
between those lines for instance if a
process is killed I will now increment
the value of my pipeline and set it to
expire based on my reset value an
expiration window I'll add two lambda
functions to calculate how many
remaining requests I have left and
another one that returns true if I've
hit my rate limit I will define the get
view rate limit function which will
retrieve the view rate limit from the G
object in flask I will use this function
later on inside of my decorator I'll
also make a function called an
over-limit that returns the message that
a client has reached their limit of
requests along with a four to nine error
which means too many requests now I will
create a rate limit method that will
wrap around my decorator taking in the
following values as arguments the key is
constructed by default from the remote
address and the current endpoint before
the function is executed it increments
the rate limit with the help of the rate
limit class and stores an instance on
the G object as G view rate limit if the
view function is indeed over the limit
we automatically call a different
function instead now I will append the
number of remaining requests the limit
for that endpoint and the time until the
limit resets itself inside the header of
each response that hits the rate limited
request this feature can be turned off
if cindex headers is set to false
whenever the rate limit decorator is
called and speaking of rate limit
decorator I can now add the rate limit
to my route here it's currently set to
allow 300 requests per 30 seconds so if
everything worked well I can fire up my
flask web app and run this hungry client
dot PI file I made in order to see how
well my rate limiter works
I will tell hungry client to send off
2,000 requests per minute or as fast as
it can
as you can see hungry client is
successfully reaching the end point
until it hits the limit then it waits
five seconds and tries again once the
time limit is reached and reset more
requests can be made until we reach
2,000 code for this activity is
available in the instructor notes</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>