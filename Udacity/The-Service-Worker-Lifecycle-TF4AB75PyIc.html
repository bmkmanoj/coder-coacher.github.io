<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The Service Worker Lifecycle | Coder Coacher - Coaching Coders</title><meta content="The Service Worker Lifecycle - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The Service Worker Lifecycle</b></h2><h5 class="post__date">2016-06-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TF4AB75PyIc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in the previous video we observed two
oddities when we first created our
serviceworker it took two refreshes to
see the result and secondly when we
changed the serviceworker we didn't seem
to pick up that change the life cycle of
serviceworker is one of the most complex
parts once you get your head around this
bit the rest is easy so we had our page
open already then we added code to
register a serviceworker
then we hit refresh hitting refresh
spawned a new window client then the
request went off to the network we got a
response back and the old window client
went away it might not seem like there's
an overlap between the old page and the
new page when you hit refresh but there
is for example if the response came back
indicating that the browser should save
the resource to disk Vyra download
dialog then the old window would have
stayed around but in this case the
response was a page so he got rid of the
old one from our page request went out
for our CSS images but also our shiny
new JavaScript which registered the
serviceworker we didn't see request log
from this page because the serviceworker
only takes control of pages when they're
loaded and this page was loaded before
the serviceworker existed that means any
additional requests this page makes will
bypass the serviceworker but then we
refresh the page creating a new window
client and because our serviceworker was
up and running it took control of it
therefore the request went to the
serviceworker as did all of the sub
resources so that explains why it took
two refreshes to see logged requests but
what about when we change the thing we
were logging yet still saw requests
being logs which was our old code if a
page loads fire a serviceworker it will
check for an update to the serviceworker
in the background and if it finds as
changed as in the resource isn't byte
identical it becomes the next version
but it doesn't take control it waits it
won't take over until all pages using
the current version have gone this
ensures there's only one version of your
site running at a given time like native
apps unfortunately a refresh doesn't let
the new version take over this is due to
the overlap between window clients we
saw earlier there isn't actually a
moment when the current active
serviceworker isn't in use for that to
happen this page needs to close or
navigate
a page that isn't controlled by the
service worker when it does that the new
service worker takes over and future
page loads will go through the new one
let's put this knowledge to practice so
as before if i refresh the page i'm
still getting these old console logs but
if i navigate away then click back the
logs are dif the new Service Worker is
running this update process may sound
complicated at first but it's actually
the same update process browsers such as
Chrome use Chrome will download the
update in the background but it won't
take over until the browser closes and
opens again it notifies the user that
there's an update ready by changing the
color of this icon later in the course
will also notify users of updates to
whitter when the browser refetch --is
the serviceworker looking for updates it
will go through the browser cache as
pretty much all requests do because of
this I strongly recommend keeping the
cache time on your serviceworker short
in fact i go if a cache times zero on
all my serviceworker projects and that's
what Witter uses as well as a safety
precaution if you set your service
workers script to cache for more than a
day the browser will ignore that and
just set the cache to 24 hours that
doesn't mean your serviceworker will
stop working after 24 hours it just
means that update checks will bypass the
browser cache if the serviceworker it
has is over a day old ok that's the life
cycle theory out of the way in the next
chapter
we're going to look at some dev tools
that show you what state the
serviceworker is in</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>