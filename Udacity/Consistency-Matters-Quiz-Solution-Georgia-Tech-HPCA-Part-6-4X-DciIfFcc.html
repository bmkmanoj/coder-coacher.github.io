<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Consistency Matters Quiz Solution - Georgia Tech - HPCA: Part 6 | Coder Coacher - Coaching Coders</title><meta content="Consistency Matters Quiz Solution - Georgia Tech - HPCA: Part 6 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Consistency Matters Quiz Solution - Georgia Tech - HPCA: Part 6</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4X-DciIfFcc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so let's look at the solution to our
consistency quiz where we have coherent
memory but an out-of-order pair of cords
where branches are predicted stores are
still done strictly in program order but
loads can be reordered and these two
variables start at 0 what the programmer
is kind of expected to happen is that I
put some values in some data then I set
a flag and the other core waits for that
flag to be set so that it can print the
data that I produced so in program order
the only thing that can really happen is
that we print 15 in the execution order
that can also happen if this score gets
to this part before we even start
checking we might compute 15 in the data
set flag 2 1 cor 1 loops here see that
the flag is 1 exits prints 15 so clearly
15 is possible but the question is can
we get anything else these are done
strictly in order so if anything else
does get printed it's not going to be
because this score did the data right
after the flag was set the flag actually
gets set after the rites are complete
but here's what can happen this loop
here amounts to reading the flag testing
if it's 0 and then branching based on
that this processor can easily predict
this branch in a way that says we exit
before it even gets to check what the
flag was so at that point we will be
here and we will fetch the data to be
printed the data at that point might be
0 so what we do is we predict it goes
out and we fetch the data at this point
so it's kind of step 1 predict and leave
the loop step 2
read the data and it's 0 at this point
then let's say core to finish is this
and at that point this out of order
processor does this load remember these
are load they can be reordered if we do
this we see that the flag at this point
is one sort prediction was correct and
at this point we can print the data that
we found
in this case we will print 0 a similar
outcome is possible for data equal stand
simply by moving this here so we can
also print an if access number 2 which
reads the data after the prediction of
the branch happens here and finally we
could get 15 in the data if we get it
here but we already knew we could get 15
note that it's not possible to get 5 or
anything else and the reason is that
these writes on the same core will
happen in program order it's incorrect
for a core to somehow read 0 here
because the only way we read data here
is if it was already written here on the
same core we have to obey the program
order that was never in question so the
data when it's read here has to be 10 we
can only increment it by 5 to 15 we
cannot read 0 here so that's why it's
possible only to get 0 10 or 15 so
basically the real problem is that
somehow although we thought we are
waiting for the flag to be set before we
access the data in reality we managed to
access the data at kind of any point
before the flag was set and coherence
again didn't prevent this what we need
is consistency</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>