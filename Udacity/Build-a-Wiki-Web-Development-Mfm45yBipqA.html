<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a Wiki - Web Development | Coder Coacher - Coaching Coders</title><meta content="Build a Wiki - Web Development - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build a Wiki - Web Development</b></h2><h5 class="post__date">2012-06-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Mfm45yBipqA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay this is the final exam homework
solution let's talk about the basic
version first without the bonus problem
so the basic version was to have a basic
quickie this is the front page and of
course there are other pages you can go
to and if they exist you see the content
and if they don't exist for example /
foo you would see Nana page but I wasn't
logged in so we won't see another page
let's try that again we try to visit an
edit page when you're not logged in it
should redirect you to the login page
okay so I go to a page that doesn't
exist foo now i'm logged in we can see I
put the username in the upper right here
and we get an edit page and if we save
this page you can see we can now go to /
foo and we can see this content go back
to our front page all as well and we've
got logging in and logging out all that
works so let's take a peek at the code
now this actually wasn't a whole lot of
code to get a pretty functional wiki a
lot of this code you've already seen
before oh there's my secret well i guess
i'll change that before upload this all
of this code is basically from previous
homeworks so I've actually given you
most of this code here's my normal
render stir function and my make secure
valve for the for the cookie stuff and
check secure bail I'm added this new
function called gray style and we'll
come back to this for the of the bonus
question but this is just a little
function i wrote to alternate the the
coloring of of rows in the UI and you
know i don't know if there's a better
way to do this or not but this is how i
did it using something that would work
in Jinja the templating language that i
couldn't figure out how to do otherwise
all these functions this is our remember
our superclass handler that we've been
using for all of our handlers none of
this stuff has changed I've added my
render store function I make its own
templates I always have access to a
variable called user which is this
reference self that user and I have
access to the function gray style which
is that function I just kind of pointed
out we'll come back to that and
everything else in here is actually the
same these are all basically how I left
it after the end of unit for really you
can see there's still some security
stuff in there I admit it's only spez
could submit to the blog and this
variable isn't used in this program
anymore it's just left over i made a new
404 page so i can call self not found
and it will actually say 404 that was
something that was
I found kinda useful and we've got all
the salt and valid password and hashing
functions this is all again from really
unit for homework and the user code
hasn't changed at all the same stuff I
demoed there the signup handler is just
about identical from units you know to
and then unit 4 where we did the
registration so the same forum say
invalidation you've seen all this code
before login is all basically the same
the only real change actually let's go
back up to sign up i'm using the refer
to keep track of what URL the form
should go to after you submit it so
before we render the form i create this
variable next URL which uses the referer
header which is son along with every
request that's the page you are on
before you went to this page so if I was
on / and I clicked on login to go to
slash log in the refer would be slash
and then of course I have a default to
slash and that gets sent into the form
as an input type hidden' hidden and the
URL to go to next after we're done
signing in or logging in gets passed in
the form you can see that dot here so
this is the signup handler in the post
for that I look for next URL in the
request and if it's there and if it's
not logging because I don't want to have
somebody sign up and then immediately
redirect on the slash log in that kind
of came up during testing if that
parameter wasn't there or it's / logon
we just go / otherwise next URL we wait
till after we validated everything and
we redirect the user to next URL and
then done registering so that allows
somebody to click sign up on any page
and then once they sign up we take them
back to that page so it's just the next
door you know kind of nice little
convenience and the login handler is
almost identical to the unit 4 as well
accept it has the same kind of next year
I'll functionality you know we get the
referer header I send that to my login
for my included as an input type hidden'
and then we redirect to it when the user
walks in successful and the rest of the
code is the same from the unit for
homework login is basically the same
except it also has a next URL and it
just again looks at the refer and
redirects the user to that now I should
probably clean this up a little bit
we've seen this exact line this next URL
equals self-doubt request headers next
URL in three different places so i'd
probably pull that up into the handler
but this code is kind of a work in
progress so so you're kind of seeing it
here in a little bit of a raw state this
is my page class
the page model is pretty simple just has
content a created time in the last
modified time and I also wanted to have
the notion of an author of what user
created a particular page but it
actually wasn't relevant to the demo so
I didn't bother you know finishing the
implementation but it would have looked
something like this so you can see again
this code is kind of in a in a working
state and actually what is online right
now might differ from what I'm
explaining here because I've had a few
more weeks to work on it to make it a
little prettier so you may see this
feature implemented when I release the
code oh you may see this line be going
all together now I've added a couple
class methods some of you actually asked
about this and some of the previous
homeworks what static method in class
method do static method basically means
you don't have to pass in self to a
function which means this method here is
just static it doesn't run on an
instance of the class it's just the
basically a way of organizing code a
little bit better this this function
parent key is only going to be called in
the context of a page so I just
basically say this parent key function
is belongs to the page and that's kind
of how we're going to reference in our
code but it doesn't actually take an
instance of the class itself or the
class itself like class it operates kind
of independent and what this function is
actually doing is to make the history
function work this is a little trickery
there and I'll kind of come back and
explain this a little bit more detail
when I explain the solution to the bonus
problem and then I added to class
methods one is by path for looking up a
page bye-bye URL which is kind of the
default way of looking something up and
all this does is this runs an app engine
query or data store query what this this
is a class method and what class method
does it says instead of running by path
on an instance of page run it on page
itself just the definition so you can
say page with a capital P dot by path
give it a path and it will return a
query object and basically with what
this is saying it's get me all the pages
for this URL sort of by creation time
and that's kind of how i did versioning
i'll come back that more detail again
want to talk about the bonus problem and
of course looking at page by ID this is
strictly for the bonus problem looking
up older versions of the page so if you
want to look it up by ID in addition to
the path that's what this functions for
no / was a special handler add forget
like forgetting rid of extra slashes in
the URL it's kind of a work in progress
it wasn't working in this demo so I'm
gonna have to come back and clean that
up just ignore that for now here's the
edit page handler edit page is the
the handler for actually editing one of
the wiki pages first thing we do is we
check to see if the users logged in if
the users not luck then we redirect the
/ logon that's important because you
don't want non logs and users to be
editing your pages they should be
registered so you know who's doing what
this code here is for the extra of the
bonus problem if you didn't do the bonus
problem all you need to really do is
look up a page and so this is that by
path function that I just explained on
the page object we give it we give it
the path and then we get the page object
now you can structure this however you
like and what this what that by path
function returns is a query and on a
query and data store you can either call
get to get the first element of the
query or you can call fetch to get
multiple ones and I'm calling get so I
only want the first one and then we
render edit the HTML with that page and
we include that path so I can render
some of the links that appear in the
navigation section here's the definition
of Post for the for the edit page again
we check to see if the user exists now
you may say well if the user didn't
exist how do they view the edit page
well they can have the browser you know
they could have couple tabs open or
multiple browser windows open and if
they log out in one and then submit a
form on the other and that could cause
some problems so what we do is if the
users not logged in we just returned an
error 400 just basically a bad request
and return now I didn't do anything
user-friendly here because that
shouldn't happen so it just kind of
silently fails then what we do is we
look for the actual content in the
request and then we look up an old
version of the page and then we have
this little thing here basically if
there wasn't an old version of the page
basically you're creating a new page and
there wasn't any content just returned I
probably expand this to have an error
message but we left that a little
undefined in the problem so I hadn't
implemented it right away and so right
now we're just kind of ignoring that and
otherwise if we either don't have a page
and have content which is what kind of
this clause implies or we do have a page
and the content is changed I make a new
instance of page now depending on
whether or not you did the bonus problem
you could have edited an old version of
the page and in mine I want to keep this
version history so I keep a new version
I create a new page for every change and
then we store that in the database and
then we redirect to the justjust the
path without the underscore edit so you
can actually view the content I'll
script i'll skip the history page
handler but it's actually pretty simple
we'll come back to that and the second
wiki page is the handler for actually
viewing any page on the wiki so it takes
a path argument just like the edit page
does notice it's only get there's no
post here this code here is identical to
the edit page and so again I'll probably
clean this up this basically decides you
know whether you are looking at a an old
version of page with a version number or
now the most recent version of the page
and if you didn't do the bonus problem
all you need is something like this this
says you know just look up the most
recent version of the page if it exists
we render page at HTML with that page
and I also include the past so I can
render those links if it doesn't exist I
redirect the slash underscore edit plus
the path so how do i do all the URL
handling um it's actually pretty simple
what I did is I created a regular
expression to match what I think is a
valid URL so basically it has to start
with slash and then it contains one or
more of the following characters little
a through little Z big a through Big Z 0
through 9 underscore and dash followed
by an optional / and then as many of
those clauses as you want so that
basically means valid / or / is valid
and then any number of these clauses is
valid after that and then our URL
handler to look something like this so /
sign up goes to sign up handler log in
log in log out log out these are all
handlers you've seen from unifor this
was my no / thing that is currently not
working so I commented it out now
remember these URLs get matched in order
so you want to make sure that like this
URL this handler here or this regular
expression for rendering a wiki page
would actually also capture the history
URL and the Edit URL so we need to put
those history URLs in the Edit the
history URL in the Edit URL first so
they get matched first so what this one
says here is it says if the URL is of
the form / underscore history plus this
regular expression basically / on a
score history / anything match the
history page if the URL is / underscore
edit basically anything go to the edit
page and if it's anything else go to the
wiki page
and that's how we go to one of those
three handlers so if we take a look at
the the app again in the browser now
that when you kind of have seen the code
some things will make a little bit more
sense so when you just go to / we go
through a URL a match and say okay it
doesn't match log in/sign up or log out
it doesn't start with on a score history
on a score edit so we match the other
thing and I path now become / and then
we look up using our database query the
page for / and we get this page now if I
were to go / new page we do the same
thing we use this as the key into our
database and we look up the most recent
version of new page and here it is now
let's talk about editing a page I'm not
logged in so i don't have my edit link
let's go ahead and login so we can see
the Edit lake okay so here I am a new
page now I'm logged in as Spence and I
have my edit link and i'll show you
those templates in a moment when i click
on edit you can actually see it takes it
basically links to underscore edit / new
page so it's basically inserts an
underscore edit here and remember that
goes through our edit handler instead of
the normal wiki handler so when I visit
this link the Edit handler draws the
different form which gives us this whole
forum and I can always click Save here
didn't change the content so we didn't
create a new version so that's all edit
works now of course we can go to any URL
and if it matches the wiki handler first
let's look at the wiki handler again
this wiki handler first remember if the
page if it doesn't exist we redirect the
/ edit plus the path the path is passed
in by this regular expression so if go
back to our browser what's going to
happen is we're going to redirect to
underscore edit this string and there we
go that works now what if I go something
like this actually let's take a page
that already exists well this work yes
we get the edit page on this URL now
remember our regulars freshman just
basically matches any number of things
so we can actually create a whole
complicated URL structure and that's
pretty cool so far to say here's the sub
page and submit this it works and if I
were to go back to new page that works
as well so pretty cool</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>