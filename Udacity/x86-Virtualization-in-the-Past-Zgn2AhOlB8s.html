<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>x86 Virtualization in the Past | Coder Coacher - Coaching Coders</title><meta content="x86 Virtualization in the Past - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>x86 Virtualization in the Past</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Zgn2AhOlB8s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">although the trap and emulate model
seems like it will solve all problems
and it worked beautifully on the
mainframes when in the 90s the need to
reapply virtualization solutions to the
prevalent x86 architecture came up it
turned out that there were certain
problems with this model at the time x86
platforms had just the four rings there
wasn't any support for root or non root
mode and so the way to virtualize them
would be to run the hypervisor in ring
zero and the guest OS in ring one
however it turned out that there were
exactly seventeen instructions that were
privileged in that hardware would not
allow them to be executed if they're not
issued from the most privileged during
zero however they did not cause a trap
issuing them from another protection
level from ring 1 or above wouldn't pass
control to the hypervisor and instead
would just fail silently for instance
enabling or disabling interrupts
requires manipulating of a bit in the
privileged Flags register and this can
be done via the pop F push F
instructions however when these
instructions are issued from ring 1 in
the pre 2005 architecture they just fail
and the instructions pipeline is allowed
to continue to the next instruction the
problem with the situation that there is
no trap is that since control isn't
passed to the hypervisor the hypervisor
has no idea that they always wanted to
change the interrupt status so the
hypervisor will not do anything to
change these settings will not emulate
the behavior that was required that was
intended with this instruction at the
same time because the failure of the
instruction was silent the operating
system the guest OS doesn't know that
anything wrong happened so the OS will
continue its execution
assuming that correctly the interrupts
were enabled or disabled as intended
so the OS will then go ahead and perform
operations that for instance if
interrupted can live in and corrupt or
in deadlock state which was intended to
be avoided by some manipulation of this
flags register to disable interrupts so
clearly this is a major problem and
makes this trap and mu
approach not applicable for these
architectures</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>