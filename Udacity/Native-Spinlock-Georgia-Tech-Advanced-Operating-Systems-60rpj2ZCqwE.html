<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Native Spinlock - Georgia Tech - Advanced Operating Systems | Coder Coacher - Coaching Coders</title><meta content="Native Spinlock - Georgia Tech - Advanced Operating Systems - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Native Spinlock - Georgia Tech - Advanced Operating Systems</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/60rpj2ZCqwE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's start our discussion with the
world's most simplest and naive
implementation of the lock and we're
calling it spin lock because as you're
going to see a processor that is waiting
for a lock has to spin in order to spin
meaning doing no useful work but it is
waiting for the lock to be released and
and the first one that we're going to
look at is what is called spin on
testing set
the idea is very simple and
straightforward there is a shared memory
location L and it can have one of two
possible values either unlocked or
locked and let's say that at the at the
beginning we have initialized - unlocked
so nobody has a lock and the way to
implement this naive spin lock algorithm
is the following what you do is you go
in and check using testing set primitive
the memory location L so when you call
this lock primitive and the lock
primitive execute this instruction test
and set of L and what that is going to
do is it's going to return the old value
from L and set it to the new value which
is locked that's going to be done
atomically we know that from the
architecture that it is going to provide
you that there is a primitive and so now
if we find that this test and set
instruction execution returns the value
locked it means that somebody else has
got the lock and therefore I cannot use
it and I'm going to basically spin here
that's why it's called spin on test
inside so you're basically spinning
waiting for this test and set
instruction to return to me a value that
says the old value is unlocked if I if
it gets me the old value is unlocked and
I know I want but if I don't then I
basically I'm going to wait here that's
where it's called spinning on testing
set so let's put up some threads here
that are trying to get this lock and so
let's say that T 1 is the first one to
make a testing set call on this lock and
it finds it unlocked and therefore it
locks it and once it locks it T 1 knows
that it's got the lock so it's got the
lock it can go off to
single the data structure that wants to
mess with and that is good so far as q1
is concerned in the meanwhile t2 and t3
may come along and say well we also want
the lock and they also execute the same
lock algorithm and when they execute the
lock algorithm they're going to do the
Stetsons test and set and you know that
this testing said when they try to do
that the old value that is going to be
returned for t2 or t3 is going to be
that the value L is locked and therefore
these two guys both t2 and t3 are stuck
here how long are they going to be stuck
until this guy releases the lock and the
way to do that is very simple so he
comes along and calls an unlock function
and what the unlock function does is it
basically goes in and clears this lock
meaning it resets this lock to the
unlocked state and and so once it does
that then this lock becomes available so
it becomes unlocked and at this point t2
and t3 was stuck here when they try to
do this test and said again they're
going to find at least one of them
hopefully exactly one of them is going
to find that that the lock is unlocked
and therefore they're going to get it
and one of them will get it and we'll
we'll go on to executing whatever code
they want to do under the protection of
the lock and so only exactly one or one
of t2 or t3 will when because that's a
semantics of testing set so that's the
world's simplest lock algorithm failing
on test and set</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>