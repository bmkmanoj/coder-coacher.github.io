<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tips - Increasing Framerate (FPS) | Coder Coacher - Coaching Coders</title><meta content="Tips - Increasing Framerate (FPS) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tips - Increasing Framerate (FPS)</b></h2><h5 class="post__date">2016-06-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iccaPsYn5qA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what we would be talking about is just
different techniques and ways to
optimize the 60 frames per second
section of the web optimization project
so what is this 60 frames per second
just want to remind everyone who are on
project for or who will be on going on
project for is that you need to achieve
60 frames per second when you are scroll
so basically when you have a when you're
browsing when you're scrolling through
the website on the pieces page all those
little pizzas that animating in the
background are should be rendered as 60
frames per second so let's first let's
first look at the google tools and see
what does that really means this is
google dev tools here this is what a
recording the timeline looks like and if
you can see here I bit what I basically
did I launched you have tools and I
picked on the run option I then look in
and record my timeline i press this
black fun here and then i scroll up and
down here and google death dose will
give me a nice time line that will tell
ok how much time it takes to calculate
my my events using my scripting how much
time it takes to lay out my elements and
how much time does it take to paint my
element as you can see here these
individual bars they all should be lower
than the story frames per second line we
don't even we do not even see the 60
frames per second because the
calculations are so high that it's
beyond 60 frames per second it's
actually lower than 30 frames per second
so basically what we moron do is be we
want to squish and lower the height of
these bars so low that the 64 frames per
second line will show up and we could
then be able to see ok whether we
achieve 60 frames per second so we're
going to walk through like different
stages of an optimization and work i'll
show you Hans will look like once you
optimize certain things of your of your
code so the first thing
I want to show you realize here is the
code whenever we scroll we're going to
launch this function here I line 577 so
window.addeventlistener scroll so it's
going to listen to the event whenever a
user Scrolls it's going to launch this
function here up their positions and
this is the actual function that we need
to optimize there you go and then we're
going to grow up and try to look at the
definition of a position so it's right
here so basically we know that we need
to somehow optimize this this function
because guess what phone from our
timeline as you can see like if I were
to click on one bar or one frame there's
flaw it takes a lot of time to actually
calculate all of our calculations to be
able to calculate all the pieces that's
growing so basically this is how you
should we this is that the scroll event
is that you have this event scroll this
takes up a lot of time and then the next
event will be a recalculate style it
goes into layout it goes into paints
it's painting the actual pixels on
screen and then it does some other
previous calculations that are not so
trivial but basically the main
bottleneck looks like this yellow thing
which is on event scroll if you go if
you click expand this you see this
function call here and this function
color is update positions so that's a
big position so I already know that I
have a bottleneck we go in step through
this function art I commented this uh
destruction fairly well and I just
competent with my question to my
observation so basically your first
episode look at each line and really
really understand what each one is
trying to do in this case I am getting
all the pizzas from here because all the
pieces that are animating it has a class
named mover I'm going through a for loop
and then I'm changing some I'm doing a
lot of calculations here on 531 and then
I then I do this calculation here on
line 5 41 to actually change the
position the left position on
pizza now the first thing that I want to
ask you is was i okay focusing on really
on this part right here is that like
okay in order for me to understand
whether just loop is sufficient or not
let's lock down all these numbers and
see let's lock out basically what i
would do I would like basically do a
console log I will lock up the face
number and it will log out the dump and
Vice troll and basically any other type
of variable that is being happily and I
want to see whether which variables are
really necessary crucial for me to leave
inside my for loop in which can be
outside to follow because basically I'm
thinking it's a for loop and this is the
majority instruction share yours I'm
doing a lot of like calculations that
for loop am i'm trying to think is there
any way for me to reduce the amount of
time to calculate these converse stuff
up a calculation and note that another
optimization that i'm looking at is when
the Dom has been loaded this basically
says if the patient's been loaded I'm
going to create 200 pieces that or that
will be animating and I signed on the
class mover right so because basically
all the anime pieces or outside the
class mover that's when you know those
are the pieces that are should be a sign
that should be animated and I want to
ask myself there's 200 pieces that
should be animated but then if I go back
to my pizzas page I'm only seeing I'm
only a handful of the pizzas that are
animating add at any time any point in
time so my first foot my second question
is do I necessarily need to animate 200
pieces if only a handful them are
showing up on my screen so food for
thought for everyone I'm giving everyone
hands I'm not I'm actually not going to
give in with the answers but this
hopefully this will give you guys a
angles good enough hints for you to
start thinking about surgical and
certain aspects to your your function
and to try to basically pick apart every
line of your code and try to ask
yourself and I make each line
efficient as much as possible okay
basically if I were to make the those
optimizations that I talked about I'm
gonna get a timeline like this as you
can see this timeline is drastically
different so now we can see the 60fps
timeline and this is the goal our goal
is to basically get all the color bars
underneath this 60 frames per second
line and if I were to actually go and
you know click on a bar here select the
bar basically reduce my timeline I can
see that my events drove my yellow here
which used to take up the whole time the
whole 16.6 six seven milliseconds it has
been drastically reduced to around with
6.2 milliseconds for scripting if you
looked at if you look at the numbers
here tomorrow in lower right-hand corner
it went from 25 milliseconds 2.64 two
milliseconds so that's pretty good um
optimization and naturally for just to
meet the minimum cult-like publications
this is good enough we still have a
couple of other things that we could
increase optimizations on especially the
paint here there's the green bars here
and a little bit of the purple bar here
because this is actually the layout
remember are the stages and rendering
from the web optimization class we have
the HTML the Dom we then you know
download the sea song we look at the
JavaScript then we go into the render
tree then after that we go into layout
to actually lay out the elements and
then we actually paint so this actually
shows you the relationship of like okay
I have events JavaScript i'm going to do
layout as I've rendered my render tree
already I go and paint and then I
basically rinse and repeat if you think
about it this yellow line could be can
actually reduce a little more we can
actually
have a little more optimizations than
our JavaScript and we can actually get
rid of one of these stages call mainly
the layout stage so let's go back into
the code if you go where what else can
we do so the first thing that we see
that any other things don't get squeezed
out any other performances using corey
selector all because basically there's a
more efficient way to access your dom
and that's using document get elements
by class this is actually a more
efficient way to get all the elements
all the pizza elements in luver so this
is actually a good way to make things
more efficient another one is this line
here this modulo operator here if you
notice let's let's go back and
understand what the much will operate it
is like yum the modulo operator I'm look
at my nose gives us the remainder when
we divide I like five so it's a
remainder it's not a division two
remainder so basically if I is 111
remainder of 5 is 12 remainder of 5 is 2
remainder of 5 3 and so forth and these
numbers repeat itself so basically we
will have in a nutshell if you do all
the math this will be just five numbers
yes no matter how many pizzas you have
whether it be a 200 pieces so our
thousand pieces every time you iterate
you will only have five unique glimmer
numbers because the modulo operator
basically gives us just a remainder and
we fix the ring them the base number of
five so we can actually if you think
about we can actually like why can't we
just store five numbers and then use
those numbers to change the position of
our element one last thing here is a lot
of people have lightroom wrote on the
forum is to use some sort of css3 our
hardware acceleration here
too because basically see us css3 css3
hardware acceleration and certain
transformations at reduce the need to
read trigger a relay out basically what
I'm talking about it's a lot of people
use to its translate X and if you look
it up there's a ton of articles that
talk about this sort of CSS hack to
increase your speed so again you could
do this too in in order instead of like
using style left you use transform
translate X to actually position your
elements now what this does is just this
gets rid of the need to trigger a real
layout and if you think about it it just
basically gets rid of one event in the
purple bar and a lot of people says you
need to do this you must do that if you
think about it if what's let's go back
and look at the numbers when once we do
that it doesn't really make that much of
a nervous it does but then in this case
you know you can get away with perfectly
using this level code for every scroll
I'm repainting the whole screen now the
question is is there a way for me to
only pain than moving pieces and not the
rest of the screen because everything
else doesn't need to get repainted
because the pixels are are still good so
like is there a way for me to reduce
this green bar to it so I could like
reduce this these total bars to my
basically like near zero how we gonna do
that in physics it's a very happy way so
I want to give you I want purchase that
that this is a there are trade-offs to
do in the tech way so just be aware as a
developer of the trade-offs so there's a
happy way to reduce the paint now
because basically what we do is that we
tell the browser to actually render our
pizzas are individual pieces and put
them into individual composite layers
because basically if even if there is
one pixel that change the whole there
gets repainted so what we do is we put
all of our individual pizzas
into their individual layers now how can
we do that we actually do some CSS has
the heck that I'm going to use is called
back face visibility hidden I'm actually
going to use this hack to action a force
the browser to render each pizza Alba in
its own layer so basically if i were to
animate it now and these pizzas or in
their own layer it means that I won't
need to like paint a small section of
the screen and not the whole screen so
how you do that you basically you put
this fat face Felix Billy hit it in the
mood board class and in your CSS so
let's go back to the timeline so
basically this is a what our current
performances if I you if I choose back
face visibility hidden this is the phone
line if you can see here all of the
green basically no paint painting
involved at all so I have a lot of extra
bandwidth and memory now to be able to
do additional things I would say just a
very smooth frame rate cuz you're barely
hitting no more than a half of like
you're available a bath to be able to
render each frame here's one caveat so
here's the cow here's a trade-off so
painting here if you look at this
painting here is reduced from to 62
milliseconds to about half a millisecond
but the time to fix the script and
surrender II actually increase could
flip from point five scripting here to
two milliseconds scripting and then we
went really point five milliseconds
rendering to almost three milliseconds
rendering and and that's the trailer you
have to take because I think this is my
hypothesis I haven't confirmed this the
more layers you put on there's probably
more overhead that you need to do and
you need to track if you look at the
overall net performance it's probably
good trade-off for mobile devices here
this hat can really do a number on
mobile devices with Lola video memory
because basically this hack is forcing
the GPU or the video card to actually
render those pizzas for us instead of
the sequence of the CPU if a mobile
device
lo video memory or it's not a very fast
device performance may actually be poor
the best way to really find out whether
the trial is to use these development
tools that Google has given us and also
to test the performance on other devices</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>