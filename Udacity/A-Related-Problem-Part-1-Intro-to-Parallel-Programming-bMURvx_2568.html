<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>A Related Problem Part 1 - Intro to Parallel Programming | Coder Coacher - Coaching Coders</title><meta content="A Related Problem Part 1 - Intro to Parallel Programming - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>A Related Problem Part 1 - Intro to Parallel Programming</b></h2><h5 class="post__date">2015-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bMURvx_2568" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay let's talk about a related problem
so what happens when you have lots of
threads both reading and writing same
memory locations so if lots of threads
are all trying to read and write the
same memory locations and you're gonna
start to get conflicts let's look at an
example suppose you had 10,000 threads
that were all trying to increment ten
array elements what's gonna happen let's
look at some code this codes a little
more complicated than we've seen in
these examples before so let me walk
through it what I'm gonna do is I'm
gonna try writing with mini threads to
the same to a small number of array
elements so in this case I'm gonna write
with 1 million threads into 10 array
elements and I'm gonna do so in blocks
of a thousand okay so that's the pound
defines that a little helper function
that just prints out an array we'll use
that for debugging and then here's the
kernel we're gonna use its kernel
because it's labeled global it is called
increment naive and it takes a pointer
to global memory and array of integers
each thread simply figures out what
thread it is okay by looking at block
index which block it is times how many
threads there are in a block plus which
thread it is inside that block now what
we're going to do is we're going to have
every thread increment one of the
elements in the array and so to do that
we're just going to mod the thread index
by the array size okay so every thread
is going every consecutive threads are
going to increment consecutive elements
in the array wrapping around at the
array size so the fact that we have a
million threads writing into only ten
elements means that after each thread
has added one to its corresponding
element in the array we're going to end
up with 10 ml 10 elements each
containing a hundred thousand the number
100,000 and then the code itself is
simple we have a timer class again I
haven't I've sort of hidden that away so
you don't have to deal with it right now
we're going to declare some host memory
we're going to declare some GPU memory
and we're going to zero out that memory
you haven't seen cudamemcpy
all of the bytes of this device array to
zero now we're going to launch the
kernel and I've put a timer around this
because one of the things I want to show
you is that atomic operations can slow
things down so here's the kernel that we
called increment naive we're going to
launch it with a number of blocks equal
to the total number of threads divided
by the block width and a number of
threads per block equal to the block
width and remember these numbers
initially are 1 million and one thousand
okay so we're going to end up launching
a thousand blocks and we're gonna pass
in the device array and then each thread
is going to do its incrementing and when
it's all done we're gonna stop the timer
and copy back the array using khuddam
m'kay so now we'll take that array that
we just incremented and copy it back to
the host and then I hid away a little
printer a helper function that just
prints out the contents of the array
then I'm going to print out the amount
of time taken milliseconds by this by
this kernel that I measured with the
timer okay so that's the whole CUDA
program let's compile and run it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>