<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>TLS Record Protocol - Applied Cryptography | Coder Coacher - Coaching Coders</title><meta content="TLS Record Protocol - Applied Cryptography - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udacity/">Udacity</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>TLS Record Protocol - Applied Cryptography</b></h2><h5 class="post__date">2012-06-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oGrKNobnG7E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so at the end of the TLS handshake
protocol the server and the client have
agreed on three keys which they've
extracted from the master secret a key
for a symmetric encryption function an
internalization vector for that
encryption and a key for a hash function
the goal now is to protect the traffic
between the server and the client and
this will be in the form of requests for
webpages and a typical HTTP request is
to get some webpage and then the server
will send a response and I should
reiterate that TLS protects many kinds
of traffic the protocol is not
specifically to http what I'm really
talking about here is HTTPS but the
record protocol is the same regardless
of how we're actually requesting the
traffic and so this response is the
contents of some web page which can be
quite long this could be many kilobytes
of data so we need a way to encrypt that
response and send it back to the client
so the responses we'll call em we want
both confidentiality and integrity
checking so we're also going to include
a Mac so we'll compute a Mac using the
hash function so that's going to be the
H Mac of M and this is users kh2 key the
hash function for H Mac this is similar
to what we talked about in unit 2 where
we're hashing the message but because
it's a keyed hash function it depends on
the key as well and finally we're going
to have some padding to fill up the
block size now we want to send this
whole response the result of
concatenating all of these over the
secure Channel and we'll call this our
the way this is done with the TLS record
protocol is to use CBC that's cipher
block chaining mode of operation and
some encryption function we talked about
CBC mode in unit 2 as a reminder this is
the way CBC works so there's an
initialization vector so we break the
message into blocks so I'll call those
blocks m0 and 1 up to N and minus 1 the
first message block is X Ord with
initialization vector the output of that
is encrypted using a key and the key
that's used is the key that resulted
from the handshake protocol this results
in the first ciphertext block and that
becomes the input to the next
sorry so that's the way the first
response is done but in a session there
might be multiple responses so when the
next response is done we don't want to
do the whole handshake protocol again so
what happens in the next response
whatever the next message block is so
that's going to be M prime 0 will be
encrypted using CBC mode again that will
produce the ciphertext block at the
beginning of the next message what we
need is an IV here we don't want to use
the same IV again that would make it
clearer if M 0 equals M 0 Prime so the
approach that is taken by TLS is to use
the last ciphertext block of the
previous message as the IV for the first
block of the next message
so this effectively makes it seem like
it's one long message seems like this is
a good idea and it's certainly better
than reusing the original IV and it's
better than having to do the handshake
protocol all over again the handshake is
quite expensive it involves asymmetric
cryptographic operations which are very
expensive compared to the symmetric ones
we're using here but this method does
raise an interesting vulnerability let's
see if you can figure out what it is
using a quiz so the question is suppose
an adversary intercepts the first
message so the adversary learns all the
encrypted blocks doesn't learn anything
else doesn't know the K value or the IV
value of the handshake worked fine and
the question is whether the adversary
can learn whether some block is equal to
some guess for that block to make this
more concrete suppose the blocks are all
8 bits the adversaries intercepted all
the ciphertext blocks but I'll only tell
you 3 of them C 3 was 1 0 1 0 1 0 and 0
C 4 was 0 0 dip C n minus 1 that's the
last type of test block was 4 ones
followed by 4 zeros and what the
adversary wants Lauren is if the value
of M 4 was equal to all zeros and to do
this the adversary can set the value of
M 0 prime figure out how to make the
server give a particular response and
examine the first ciphertext block</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>