<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Balancing self-driving training data - Python plays GTA p.10 | Coder Coacher - Coaching Coders</title><meta content="Balancing self-driving training data - Python plays GTA p.10 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Balancing self-driving training data - Python plays GTA p.10</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wIxUp-37jVY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
part 10 of our self driving car scooter
or whatever with Python in such tutorial
series in this video well in the last
video what we did was we built some
training data
I said get about a hundred thousand
samples I did no such thing
but whatever I think I got about eighty
k or something like that anyway we'll
look at it in a moment
so what we want to do now is check the
data bounce data and all that kind of
fun stuff so the first thing we want to
do is create let's just create a new
file and I'm going to call this balance
underscore data pie I'm going to open
that bad boy up and I'm going to go
ahead and clear it and then I'm going to
make sure I don't go off my screen great
okay so we're going to go ahead and do
first is we're going to import numpy as
NP get rid of this thing going on here
let's import pandas pandas as the PD
we're going to go from collections
import counter and then from random
we're going to import the shuffle so num
pipe obviously pandas should be obvious
but yeah we're gonna use pandas just to
quickly wrangle the data we're actually
going to be doing that much of pain is
it pianist might not even be necessary
for this step it's just that a couple of
steps I know I want to do I know how to
do with pandas already have pandas on my
machine this is really a serious for me
just running through this kind of a task
so get pandas if you don't have it from
collections import counter this is so we
can see what moves how many of them and
so on and then shuffle so we can shuffle
our data before it's actually training
it so let's say train data equals NP
dots were low and we've got training
data numpy now the trend data I recorded
in the previous video is right here I'm
actually gonna check that just to be
100% certain the code and everything was
correct so I'm going to load that first
but then eventually we'll get to the
actual training data but first I want to
do training data vid now I'm going to
say is for and in fact let's also import
CBT
so in 4c b2 and yeah that's fine
so for must afford data in train train
data we're saved image equals data throw
it and then choice is a data person TV
TM show we'll just call it pass any
image and then let's go ahead and just
print the choice just so we can kind of
see if cvq got weight key 25 and 0 X is
that right 0 except I'm totally copying
this x FF there we go
equals word Q I'm not quite sure why we
have to have this kind of like quit
thing but we do anyway see me to destroy
all windows I guess is just so it
destroys the window and after it's shown
in or something anyway whatever break
and then yeah cool so let's just do that
first and let me just see if wait key
did I that wait anyway there's part of
the data but yeah let's see here wait
wait where's way keep oh here we go
so it's probably camelcase let's try
that there we go so as you can see there
we go it's forward you just turn you can
see it updated Eastern I'm turning some
more ok so this looks about right and
the actual shape here this extra screen
that's because of the buttons here that
actually is not like we had all that
gray screen there it's not there I
promise but we could also just just
prove it
current image dot shape we should be
able to get away with that okay
so sixty by T okay so cool everything is
looking good
um 65 80 sorry
I think CB chief does flip it but anyway
it is 80 by 64 look 60 by 80 Oh
mannequin okay so did I just close out
of balance data so I did I guess good
there
the other thing I want us to go ahead
and do now is actually what I meant to
do in balance data so I'm content with
that I'm content with the - vid part I
just want to make on par percent certain
that the code I wrote was correct and
now what I want us to go ahead and do is
we don't need main anymore now I'm going
to actually balance the data that was
the data I built up to this point so I'm
going to get rid of this loop I shall
comment out this loop just so just in
case through that now we're safety F
equals P dot data frame train data and
then let's go ahead and print the F head
just to make sure we're working of
something good here 500 megabytes so it
might take a second okay cool so as we
can see column zero is the image data
column 1 is the output data now what
we're curious about is how balanced or
unbalanced is this data like I said it's
most likely oh like such a huge
percentage of just go forward right and
that's going to be a problem in my train
so let's go ahead and see how bad we are
so print counter DF whoops counter
parentheses DF one for the columns dot
apply string we have to apply screen
because you can't do a counter on a
column of arrays for whatever reason or
a list or whatever so let's run that
real quick and then we'll see what our
our our layout is
okay so as you can see we've got about
70,000 ghost rates 650 700 rights and
6400 left's okay so if we fence there's
a few things first of all we could feed
this through a neural network and
chances are it would at least register
in some cases like where you wanted to
turn it would it would say with some
degree of certainty you know turn it
just would the Arg max of the function
would still or the arguments of the
output would still be just go straight
so you could apply an algorithm to the
output of this exact you know training
data that's possible and a lot of people
kind of don't think like like a neural
network Talya isn't going to be exactly
what you want there's going to be an
algorithm that you oftentimes may apply
on top of the output of a neural network
but for some reason like I was saying
before people think you can just like
slap them do all that work on things
it's going to work not always but what
I'd like to do is actually balance this
data so they're all the same length so
what we're going to do is we're just
going to say we're going to set all of
these to be at max 6 plus a 64 27 long
so to do that what we're going to do is
we're just going to say less if this
strikes equals this and forwards equals
this then we're going to shuffle the
data shuffle train data now with data
that's temporal and linear a lot of
times people kind of bring up that why
do you shuffle your data send X that
doesn't make any sense because if you
shuffle it you're losing you know the
linearity of the data that's true but
our neural network the Pens like if we
were using an LST n or something like
that it would make sense to keep it
linear but that's not what's happening
here what happens here is every frame is
its unique snowflake it doesn't the
neural network is not going to look at
the previous frame as it's learning it's
not going to look at the previous frame
any more than it cares what the weights
of the nodes are but as far as what
action you were taking before let's say
returning left or right when you're
looking at the image data it doesn't
care
doesn't care what your previews action
was so and it might be the case in
practice you care what your previous
actions were but in the training of a
convolutional neural network it doesn't
matter it doesn't it doesn't take into
account temporal data so we are going to
shuffle the training data that way it
doesn't become biased for specific
movements if you fundamentally disagree
with me feel free to not shuffle the
training data that's fine so next what
we're going to do is we're going to
iterate through the data for data in
train data and in fact we're going to
just copy this because I already wrote
this and I'm coming it out all three for
a bulk comment fault for to uncomment if
you are an idle a lot of people don't
like idle well if choice equals one zero
zero if that's the case whereas a less
dot append image and choice and then I'm
just going to take this copy paste paste
and we're going to say lol F so L if it
is zero one zero and then we also have a
zero bits so left this would be
straights or forwards and then this
would be rights else we want we would
like to see the output of this one so
let's go ahead and say no matches so if
we get in no matches something went
wrong this will probably be one of the
examples that's never going to be a cue
okay so great so once we have all of
this what we'd like to do now is make
sure they're all the same length how do
we do that well what we could do is
about four words equals four words up to
the land of left's
but what if rights are shorter well
don't worry about that little Johnny
will also be up to the length of the
rights I think that works right you're
just slicing the list you're just saying
hey I want the first length of left's
the first length of rights for for
and then when we go to do left we can
just say left equals left up to the lens
of forwards and we can do the exact same
thing for the rights then what we can do
is we can say final data equals four
words plus left
Plus rights so just kind of add this
stuff so it just kind of throws them all
together in the same list you wouldn't
want to use a pen because it would
append the actual arrays that wouldn't
be private okay
the pluses will work don't fight me on
this
shuffle final data and then let's just
for posterity let's go ahead and print
Len final data just so we can see what
happened and actually let's also train
it up and then Len final data and then
finally NP got save training data V - B
- B - there we go time dot Phi numpy and
then we're saving final tickets that
variable whoo okay let's do it
we'll see how we did hopefully no errors
hopefully won't see no matches either I
want none of that all right we type ode
for words so our starting data is about
83 five so it's correct about 8,000 you
probably wanted more like a hundred
thousand but you'll see what I'm saying
here you should already kind of guess so
we're more like about 20,000 data or
something what I do typo'd for words
struck in
got very far in the script though so we
ended with about 20 mm training samples
it should be shuffled but now we should
have an even number of forwards left
rights so only train our neural network
it's not going to be unbelievably
unbalanced okay so actually I think
that's a good stopping point because the
next step is to create a neural network
train the neural network and then test
the neural network so in the next
tutorial we are going to be training the
neural network if you have any questions
comments concerns whatever feel free
then below
oh one thing one thing I didn't mention
I should have mentioned prior in the
previous one I don't think I don't think
I'm going to upload this training data
you really don't take that long to make
some training samples for this first
example this is not going to be the
final step of this process eventually
I'm going to probably wind up sitting
here in playing gta5 for hours for
science and and creating much larger
training set so um in tight then I'll
probably host that somewhere just so you
guys don't all have to do it but one
thing that I that I kind of want you
guys to take home as you this could be
anything you don't have to be on a
scooter you don't even have to be on
Grand Theft Auto 5 you don't have to be
doing traffic you can do a different
task of some kinds needs to be somewhat
basic so feel free to try something else
but anyway later on I'll probably host
my training data but I don't I don't
think I'm going to host this one so yeah
hopefully you're not too lazy to just
create these quick samples but yeah
later on I want to build and have like
like right now this is only like 20,000
samples so we're probably not going to
get the greatest mower Network but
eventually you want to have over a
hundred thousand after balanced samples
and probably even more than that so I'll
probably host that one just so you guys
don't all have to do it anyway um that's
it for now questions comments leaving
below otherwise I'll see you in the next
tutorial where we will be building and
training this neural network till
nothing</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>