<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating Machine Learning Classifier Feature Sets - Python for Finance 15 | Coder Coacher - Coaching Coders</title><meta content="Creating Machine Learning Classifier Feature Sets - Python for Finance 15 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating Machine Learning Classifier Feature Sets - Python for Finance 15</b></h2><h5 class="post__date">2015-07-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PP9qPL_zJJM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
another Python with finance tutorial
video in this video we're just gonna
pick up where we left off and that is
the creating of these feature sets the
idea here is for every day in this
history of a hundred days we're going to
take that day the previous 10 days and
then the way what we're gonna do is
we're gonna say ok from that final day
to today did the price go up or down if
it went up great let's make a buy if it
went down
no let's sell so in the training what
we'll do is if the price went up we say
great that's a 1 and if price went down
and that's a zero or a negative one or
whatever and it'll be easiest to label
that as a negative one because then we
could just go through and say the
prediction equals how much we're gonna
buy or something but it really doesn't
matter what you do there it's useful to
note with machine learning generally
your features they're best put between
negative 1 and positive 1 so it just
works out if we continue using these
numbers and we use pre-processing to
kind of make sure our data does that so
we'll be talking a little bit more about
pre-processing when we hit it because so
far we haven't really needed it but
you'll see why we're gonna use it here
in a moment so we define X Y and then
what we're gonna do is we're gonna say
bar equals the start bar so this is the
starting point because we can't say hey
what was the price 10 days ago if we
start from the first element of the list
and we try to get the last 10 days it's
gonna be like no so we can't do that so
we're gonna say bar equals start bar and
then what we're gonna say is we're gonna
say Wow bar is less than the length of
the price list minus 1 so wow that's the
case what do we want to do because keep
in mind length will start the first
element will say 1 whereas when we're
slicing lists the first element is a 0
so that's why we're doing minus 1 there
so what we're going to go ahead and do
is while that is the case what do we
want to do well first let's go ahead and
encase this in a tronic
otherwise we're gonna not get any
features at all so we definitely want to
get our features except exception as E
and then for now we'll just print the
string version of e here and actually
it's probably a good idea to give
yourself a little more information so
let's go ahead and say feature creation
okay
so this just lets us know the exception
we're throwing is specifically for the
future creation while while loops so
I'll just add that here feature creation
this is just for our notes basically so
down the line if we're throwing an error
we'll see exactly where that air is even
occurring so we'll know it's in this
loop chances are we'll throw some from
time to time I'm sure we'll get some you
know
nons or Nan's or whatever you want to
call it you know not in numbers so
that's how we're gonna handle those now
the next thing that we're gonna go ahead
and do is within this try what we're
gonna do is we're gonna say the end
price so end under swoops and underscore
price is going to equal price underscore
list and then bar plus 1 and then what
we're gonna do is we're gonna say we'll
dues I hate to call it like starting
price that's kind of what we want to
call it so we'll call it start price but
it's not the starting price of the bars
necessarily but because the question is
we're gonna say ok the price is let's
say it's a hundred ninety two right and
then we've got the previous nine prices
and then what we're trying to do is
we're trying to compare the pattern
changes of the this last ten prices to
predict what will the next price be
right and so the start price will be
basically a price list and then bar
right that last price okay that last
price in the list that's what we're
interested in so and then so that's the
last price in the list of prices and
then the end price is where did that
price where was the subsequent price at
was that a rise or fall so so if that's
still a little confusing
just stick with me feel free to ask
questions it's kind of confusing I
suppose and in fact I could bring up
paint or something like that but but
basically let's say the prices are five
six five seven six five six
I'm just trying to get to ten here one
two three four five six seven eight nine
and then ten okay so let's say the last
price this is like this is the current
price right now is eight okay so this is
the current price and the last nine
prices are these prices and our
objective is to figure out what that
next price is going to be right in this
list of prices that's what we want to
know so what we're doing is we're taking
the historical prices and saying okay
well the historical prices were XYZ some
you know all the way through that list
and then we're saying the subsequent
price after this lice list of prices was
this and what we do is we have a
machine-learning look at these changes
that what it's going to do is it's going
to look at the change from this price to
this price to this price to this price
and it's going to kind of envision it
almost like a like a like a pattern
basically and it will be like well when
these changes happen in this order
generally this is what happens or when
these changes happen in this order this
is generally what the next price is and
so on so this is our objective and it
turns out machine learning is typically
pretty good at this
but we'll see how well it performs in
this situation so we've got the end
price the start price and then what
we're going to say is we've got pricing
underscore list so this will be the
actual list of prices and what we'll do
is we'll just say X x equals zero we
just need something here to count us
through basically and then we're gonna
say for underscore in range in the range
of context dot feature window so
basically because we're asking always
you know we're gonna say okay we want a
reference last ten prices and select the
last ten prices constitute our pattern
so to speak or really the last ten
prices are our features but it's
probably best to envision this like a
pattern or something so our last ten
prices are this and so basically this is
our way
iterating through that when people use
an underscore in a for loop or pretty
much whatever but usually it's in a for
loop it basically means that variable
whatever it is is useless like you're
not gonna see that variable come up in
the for loop so if you wanted to use the
variable you wouldn't use an underscore
as the variable but when you see it like
here it just kind of notifies someone
reading through the script that hey
you're not gonna see this this variable
in the for loop it's literally just
being used like a counter so for
underscore in range of contexts that
feature window which is ten for us what
do we want to do well we're gonna say
the price that we're referencing here is
going to be equal to price underscore
list so that's price list is right here
right it's that massive list of prices
so try not to confuse it with pricing
list so price is equal to this large
list of prices and that is going to be
sliced by the current bar that we're on
so we're starting at the start bar but
as we go on we're gonna add one to it
so that will be our starting point bar
and then it will be bar - and then in
parentheses here we're gonna do context
dot feature underscore window - X X and
then we'll do pricing list dot append
price and then we do X X plus equals one
so the way it's going to do this is
we'll take the bar the current bar that
we're on references that bar and then we
start the list by saying okay we're on
this bar the previous ten prices were
the bar minus the feature window which
is ten that one's first minus X X which
is currently zero then when we iterate
through the next loop X X is one so then
it will be priceless over the bar minus
context window which is ten minus one
now it's nine so minus nine eight seven
six five four three two one zero and
then we'll
that will be our full list in
chronological order so a little
difficult to get there but we got there
so now outside this four loop what we're
gonna say now is features now the
problem here is we've got these we've
got these features but these are prices
and the prices are going to be different
for each ETF or stock or whatever that
we're using we need some way to to
what's called normalized the data so the
the pricing change between like a two
hundred dollar stock it might move by
two dollars at a time but if we have a
ten dollar stock moving at two dollars
at a time that's massive fluctuation so
we need to find some way to kind of
normalize all of our data so an easy way
to do that would be to do like a
percentage change so percent change is
new - the old divided by the old times
100 so features what we can do is we can
say we're gonna use no NP which I don't
think we've actually imported numpy so
let's go import numpy as NP and then
we're gonna say features equals NP dot a
round and what this is going to do is
allows us to round all the elements in
an umpire array and we're gonna round
the following so we're gonna say we want
to do NP diff so this is the pricing
difference of price seeing underscore
list and then we divide that whoops
what's happening there we go divide it
by the pricing underscore list to the
final elements times it by 100 point
zero and we round it to the first
decimal point this is just to keep
things not you know super long decimals
we don't want like mile-long decimals we
want it pretty short so that creates our
features so let's go ahead and at this
point let's do a bar plus equals one and
let's just for now print features and
see if we build if we build will
continue on in the next tutorial and if
we have an error hopefully what will fix
it here X is assigned Y is assigned
never used
fine it should be quanto peon if you're
watching your little debugger here while
it is useful it under cases like
everything it's a capital X and if
someone uses like a lowercase and a
capital X they're not going to know
which one that is responding there
corresponds to anyway into logs okay
cool so we didn't get errors awesome so
these are features right these are the
percentage changes rounded to the first
decimal point so point one point two
point two minus zero point two point
seven point one and so on okay
minus 0.1 so cool we're off to a pretty
good start we've got featureless they're
normalized across all of the ETF's
because it's in percent change now and
we're ready to we've got our features
now we need to do is compare that start
price and end price so what was the
difference between today and tomorrow
ish like in the history of things and
that creating them will say if that was
an increase great that's a buy if it was
a decrease oh that's so so we'll get
that information that'll create our
label and then pretty soon we'll get to
the point where we can actually start
using these labels to actually execute
trades and all of that so that was
actually not very much code but it was
thick code so if you have any questions
or comments up to that point please feel
free to leave them below
I almost said leave them alone don't ask
any questions leave them below and I'll
do my best to kind of explain everything
a little better if if that was confusing
so anyways if you lost whatever leave
questions below otherwise as always
thanks for watching things for all the
support and subscriptions and until next
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>