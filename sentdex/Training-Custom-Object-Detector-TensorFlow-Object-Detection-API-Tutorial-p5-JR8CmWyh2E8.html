<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Training Custom Object Detector - TensorFlow Object Detection API Tutorial p.5 | Coder Coacher - Coaching Coders</title><meta content="Training Custom Object Detector - TensorFlow Object Detection API Tutorial p.5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Training Custom Object Detector - TensorFlow Object Detection API Tutorial p.5</b></h2><h5 class="post__date">2017-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JR8CmWyh2E8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
part 5 of our tensor flow object
detection API tutorial series in this
video what we're gonna be doing is
setting up the configuration file that
we need and then beginning the training
process which will take about an hour
depending on your GPU so a decent GPO to
take a look an hour on a CPU I have
absolutely no idea and on like a
lower-end GPU that's still like a GPU
compute capability 3.0 maybe like I
don't know three hours not sure anyway
let's get started so first what we need
to do is we need both a model and a
configuration file now I'm gonna link to
a bunch of resources actually basically
I'm going to put the link to this
tutorial in the description and just
kind of point you in the direction of
certain things so you might want to
check if you want to like basically if
you want to code a model and write the
configuration file yourself like and
make your own models you can do that I'm
not going to do that but you can feel
free to do that by checking out this
configuring jobs information here so
what you can do to kind of create your
own model and then you can also if you
don't want to do that you can check out
their sample configurations so you don't
even have to write the configuration for
yourself and these are all the
configurations we're gonna be working
with mobile net but you can use
different ones if you'd like I'm trying
to think
click on here is this the one that had a
breakdown yeah this one has a breakdown
of them so it's kind of cool
so the this is where you can download
like each of the models and you can kind
of pick which one you want now we're
using mobile net again because it is
fast because I want to detect things in
real time so the more frames per second
that we can detect the better in my
opinion so I'm doing that now if you're
just trying to like classify images or
something like that and you don't need
to do it super fast then you might want
to use something that's a little more
accurate like the are CNN or something
like that so anyway just know that those
are options for you but I'm gonna be
doing mobile net but they do have
configuration files for basically all
these models here so feel free to choose
a different one you don't have to copy
me anyway but what we're going to do is
use mobile net so I'm gonna go ahead and
run these two things just to grab that
configuration file and then actually
grab the the model and I'm gonna go
ahead and have this I guess it doesn't
matter we'd throw it in here eventually
we're gonna have to move this stuff into
the the models the actual like
tensorflow object API stuff but I
suppose we'll wait so what I'm gonna go
ahead and do is keep that on the screen
zoom in though changed our three desktop
object
- detection the place that we've been
working and I'm gonna go ahead and grab
that configuration file first what oh
don't oh I must Adam why is because this
is such a long line maybe let's try
let's try again did it put let's try
this again
there we go I must have forgot that we
get anyway so we grab that and let's go
also go ahead and grab the model so copy
that paste doesn't download the model
for us to do it did you
I did it again oh my gosh all right
victory okay so once we've done that I'm
just gonna close out of that for now
let's go ahead and extract this so
extract here cool now I'm gonna go ahead
and bring up the configuration file open
with I guess ways Adam that's fine so in
here is the configuration file inert why
does it not have
just really the configuration file that
we're looking for this is not what we
are looking for I don't think
this is sort of what we're looking for
but not not with this no no that's a
negative hold on
okay so gonna have to fix that for sure
in the code let's let's head there
manually
oops without the W get raw okay so that
this needs to be changed in tutorial
anyway I'm just gonna I'm gonna copy
this I think it's still calling itself a
dot config so let's see this make sure
we're editing the right thing paste save
I hope that works so anyway yeah we
messed up I'm gonna forget to fix that
okay so this is what the configuration
file ought to look like and basically
you just need to fix all the paths to be
configured but there's a few other
things that we need to fix so for
example number of classes not true we
just have one class we're trying to see
if there's anything else that I'm gonna
forget here eventually I'm just gonna
copy and paste mine thing to be Harper
sent but we definitely want to fix that
so right now batch size is 24 I would
keep it at 24 but if you're getting a
memory error you could lower you could
decrease the batch size so you so you
would require less memory basically
because batch size is like how many
samples at a time are we trying to throw
into this model to learn against so you
could make it twelve four five or three
or one I suppose and if it's still
running out of memory at one you're just
screwed it's game over
so yeah fine tune the checkpoint this
should just be the the path to the
actual checkpoint file here so it just
should be SSD mobile net so I'm just
gonna copy that
paste that in and then it would be that
model checkpoint I'm gonna look and see
what it says yeah it's just model dot
seek apt so leave it that way
continuing to scroll down just look so
Pat's APB configured again it's not pet
trim it's not pet trained record it
would just be like train dot record and
then this will be will probably call it
like object detection or something like
that so like this should be changed to
object - detection dot PB text this is a
file that we're gonna create soon and
then path to be created I would say this
will be private data and this will be
data and then you'll do the same thing
here data data and then this basically
this label map here would be this label
map and then this will be actually test
dot record and that should be it and in
fact I'm gonna leave it there just
because like I could copy the one from
Python programming it now but I want to
make sure I told you all the right ones
but it might make if you're having an
issue you might want to copy and paste
that one from Python program in it but
anyway I'll go ahead and save there and
then pop it over to generate TF record
I'm just looking and this is it's been
modified and maybe not saved should just
be mac and cheese let me just okay was
for that Python three stuff so I'm just
gonna save it real quick I'm gonna close
that a generate TF rare so I want that
open right now anymore and I think we're
all set on the configuration file as
well so now we're gonna go ahead and do
is add that other file inside the
training directory so inside training
folder let's go ahead and do a new
document and this is going to be that
object
- detection dot pbt XD go ahead and open
that up and within there we're just
gonna add is this is like our label map
so we're gonna have item and it's
basically like a like a dictionary so
item
and then we're gonna say the ID is one
and then the name is Matt actually put
this in quotes mac and cheese okay save
that and if you had more than one we
just have happen to have one here but if
you have more than one you would keep
going just make sure you always start at
1 0 is like a placeholder so we're gonna
close this out and I think we're all set
so now we're ready to move this stuff
into the models I'm pretty sure we're
gonna have to do that we might be able
to get away with another way but I'm
just gonna move it into models I don't
waste any time trying to figure out that
but you should actually since we
installed it be able to do this without
doing it this way but anyway so let's
open up the model or object - detection
and we want to take data images we need
the model we need the training directory
and we need this configuration file I'm
just making sure that's everything now
let's go ahead and copy that over just
in case something goes wrong
merge data let's go ahead yes merge the
data that was a really fast copy okay
all right now we're ready to do is
attempt to train dot pi cross your
fingers everybody but we're probably
hitting there I'm just rice fruits
something up let's change directory into
desktop M models object detection and
what we're going to do now is basically
do Python 3 trained eye we're gonna log
to STD air and then we're going to do
you need to specify the train directory
so train under support dürer and that
should just be training slash so this is
where all your outputs gonna go your
model and like you're like you're tensor
board information it's all gonna go into
the training directory and then the now
we need to setup the pipeline so
pipeline
for config underscore path equals
training did we put a hold on I can't
remember if we did actually did that or
not let me go back here no that's
actually just sitting out there in the
open
so let's actually throw that in there so
we'll throw that into training yeah
so then training slash and that was SS
SSD underscore of mobile net underscore
v1 honours for pets dot config okay
let's hit enter and see where we screwed
up
that's a weird that's weird that we're
seeing that error this is the error that
you if you cease wondering why we got
that I never left someone tell me why we
got that error because you get that
error when you need to export again this
path someone please inform me like I
have not restarted this machine so it
should still be the case anyway if you
see that just run that export Python
path equals that you know from the well
if you're here you should have already
done this once so go to the the
installation instructions for the tense
flow object recognition API run that
again okay object detection okay trying
again I I really wonder whether it would
happen
I hope I don't see that again
I'm pretty sure that's the only reason
that would happen
come on you can do it basically you want
to start seeing some steps that's what
we're waiting on
and we're good we're golden run our way
so okay so yeah we're beginning
so basically what you want to look for
is you want loss you want the average
loss you know your goal should be you
would like to get under one but your
goal should be let's get about one
definitely make sure it's below two so
some things are going to be relatively
complex especially when you have maybe
if you've got multiple objects that are
pretty similar to each other
and that's or like a lot of your objects
are relatively similar with minut
differences stuff like that you might
have to sacrifice a little bit in your
expectations but at least for us we've
got one object it's macaroni and cheese
it's in my opinion that's a relatively
easy thing to detect so I'm expecting
that we can get no problem a loss
average of about one pretty quickly you
should be able to get to lower numbers
like two three four something like that
but then from two to below one is gonna
take a while so while it runs one option
you have is you can count you can load
up tensor board and kind of see how
you're doing so all of the training
information is being thrown into if you
go to desktop models and then object
detection that training directory so
here so in here you've got an event file
somewhere I'm blunt here just so this is
for tensor board so what we can do is we
can load up just let me make this bigger
change directory desktop models object
and then do tensor board - - log dirt
equals it should just be training
training and then that loads on local
host port 6006 we'll just open it here
and what you're gonna want to look out
for merely is just total loss I would
have expected this to be further updated
by now interesting
I don't know how many more I guess I
could wait anyway we just have the one
data point so it's not uploading like
super quickly to this this is just like
a it's just a log file really wonder how
many steps it takes to live updates see
if there's been one I don't know what
the default is to be honest and my bill
I think maybe two actually I think I
think it's in the training file we can
pull it up real quick I think it's like
200 I don't know hold on hold on
everybody will find out I'm pretty sure
I saw it in here at one point apparently
I didn't trained up PI I think it might
be 200 though or maybe 250 I can't
remember I'm pretty sure I have seen it
though
anyway expect to do like 10,000 steps if
you did 20 for a batch size of 24
probably about 10,000 ish steps will get
you close to a loss of an average loss
of about 1 but actually we're falling
pretty good I wish you would update man
I'd like to show the people maybe it's
250 anyway
I guess I'm gonna try to wait to get to
250 otherwise I'll just pause it or
something or maybe I'll just show it in
the next tutorial
just now you want to you want to level
out at a steady one don't just stop as
soon as you hit your first average of 1
like let it really level out here we go
and definitely record this summary what
is it to 238 why would it every 238
steps ok there we go ok so um I guess
every 200 issue steps it'll it'll record
so basically once this kind of averaged
out 1 gets you to about 1 you probably
good to stop once we've done this we've
got a trained model and then in the next
tutorial we can export the inference
graph from that model and then we can
use that to detect new objects and draw
boxes or not new objects to detect our
object in like new images in draw you
know a bounding box around it so anyway
that's it
now if you've got questions comments
concerns whatever feel free to leave
them below otherwise I'll see you in the
next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>