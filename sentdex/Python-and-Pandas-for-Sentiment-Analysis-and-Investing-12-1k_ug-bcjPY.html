<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python and Pandas for Sentiment Analysis and Investing 12 | Coder Coacher - Coaching Coders</title><meta content="Python and Pandas for Sentiment Analysis and Investing 12 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python and Pandas for Sentiment Analysis and Investing 12</b></h2><h5 class="post__date">2014-06-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1k_ug-bcjPY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
another Python panda's finance and
sentiment analysis tutorial video in the
last video we basically back tested this
strategy but we haven't visualized the
results or really seen the results at
all besides what the output was per
company my idea is I want to see kind of
like a conglomerate of all of the
results and see you know how do we do
with this strategy so that's what we're
gonna do in this video so the first
thing I want to do is go ahead and
comment out this whole bulk here because
we're not gonna run it again so we'll
just do three quotes there three quotes
there and it's interesting this this
sorcery right here this okay I don't
know if this happens for all of you
it's like says it's just such a long
list I guess I'm really fast at typing
anyway we'll come down here and what
we're gonna want to do is visualize the
result somehow and so the best way that
we can do that is we can reference the
data that we just output and I just want
to put them all together we could plot
up literally every single stock and see
the performance of all of the companies
and and I suppose I could we could do
that as well and maybe we will but
mostly what I want to do is actually
have just a single line of the
performance and so what I'm gonna do is
we're gonna say define results and here
we're gonna say date D F for date frame
is going to be PD got read underscore
CSV and the CSV that we just created was
performance underscore data underscore
SP 500 ish CSV comma the index column is
time and finally parse dates equals true
because we do want to parse the date
information next since we're parsing
dates the other thing we're going to
want to do is we're going to do D F dot
sorcs underscore index and in place true
and what this does is kind of what we've
already seen it do in one of the other
videos is it just orders by date and the
reason why we want to do this is the
data currently looks like this where we
have the date stamp time the stock and
then each Tommy go or whether the
company stock ticker anyway
each company we go through it
alphabetically basically and then of
each letter in the alphabet base or each
one alphabetically that we go through
then we go through the date so basically
goes start to end per stock so we got
AAA Apple and so on all the way to the
bottom so this entire document is
actually not ordered by day it's ordered
alphabetically first then you know the
primary ordering is alphabetical then
the secondary ordering is by date so
first we want to actually order by date
so we can do what we're hoping to do
here so now let's say DFS or by in debt
or sort of the next in place true now
we're gonna do is we want to mesh all of
this stuff together and we want to
basically make an average of all of this
stuff and so the way that we're gonna do
that is I wish there was a better way to
do it I'm not really sure the best way
to do it and what we're gonna do is use
pandas expanding mean so what this does
is at every step of the way it does an
entire average basically of the data and
so like with the moving average that
would give us like let's say a 20 moving
average it would only be an average of
the last 20 plots when really we want to
know the performance average of this
strategy period and so that's like an
ongoing thing so from start to finish
what is our performance and so that'll
give us a decent representation of what
our portfolio would look like if we
invested into this kind of strategy so
what we're gonna do is we're say DF and
we're gonna make a new column and it's
gonna be x mean for expanding mean and
what we're gonna do is say that equals
PT expanding underscore mean this is
something built into pandas what do we
want to do this operation we're gonna do
this operation on DF PC which is percent
change right because we've normalized
all this data into a percentage change
and then the next one is minimum
elements right so we're just gonna say
zero there's no minimum that we're gonna
you know start with and that's really it
now what we can do is we can do return
the x mean and now this is gonna do is
gonna return a data frame of x mean and
basically it's just gonna give us the
index of date and the x mean so are the
expanding me and so I'll have date and
that so now we can actually apply so we
come down here and what we can do is res
for results equals results and then res
dot plot and we'll say label equals I
don't know this stick performance and
then we're gonna do PL ta X actually I
suppose we could have this here I
explained 0 color equals K and aligned
with equals for and basically should
just make a horizontal line on the zero
mark and so if we plotted you know each
stock one by one this would make a lot
more sense so we could clearly see the
zero
you know profit line basically and so
maybe we'll use that for now we'll just
have it there anyways and then kill t
die legendary feel t touch so now that
should be good it might take us a second
so I guess we'll go ahead and save and
run it hopefully errors as well oh you
know what here we have to do one more
thing alright hit ctrl C to cancel that
one from running well we have the users
we have to come over to our data see we
said we wanted to index by time that's
not gonna work and we wanted index by PC
that's not gonna work because if we look
at our data set the first column
actually has none of that okay so what
we need to do is we're gonna have loops
we'll just add this first row ourselves
so hit enter they're due time
stocke I suppose and then we had time
stock price PC okay that should work for
us Tom stock let's see time stock
actually you know what I think that was
actually funds right
that wasn't the stock price right so
actually not price that's possible once
and then PC for percent change so now
we've got the column title so we'll save
that and it closes let's run that one
more time and now this time hopefully we
will have a result that would have
gotten very angry with us have we
continued on so so this should just be
like a single line and we can see what
kind of performance we're seeing already
and because obviously our hopes aren't
too high because our strategy is
literally this here is mine anyways it
plotted up so this is our performance
overall or on average basically so if we
had a portfolio that was comprised
solely of this strategy this is kind of
what we could expect to see so initially
we have a little bit of volatility here
I'm gonna go ahead and say that that's
wow I guess we're not we didn't start
until Jan 13 but I'm not sure that I
think that by can't remember what I said
in the initial when that when the rest
of the sp500 comes on board but I'm
guessing that's what happens here is we
have okay all of the other S&amp;amp;P 500
stocks because initially we only did
like three companies and then we kind of
branched out to 12 then we did like 115
maybe and then finally I just said okay
let's do the end Tyrel S&amp;amp;P 500 so anyway
actually not too bad we have a little
bit of drawdown here and then you know
here we have this massive spike here and
then from really this point onward
pretty flat linear line okay so not bad
the return here is pretty pretty poor
probably not even beating inflation with
a 5% increase so definitely not happy
about that you're definitely not beating
the market in this scenario either I
mean from Jan 13 all the way to now I'm
gonna pry like I don't know 50 60
percent if not more we could look but of
the sp500 returns but anyway at least
we're not in the negatives and we think
we might be on to something or at least
the strategy is somewhat accurate but
you can't really make that judgment you
would have to I suppose basically if
from this point onward you could start
to make some sort of judgment like that
just simply because we don't have any
drawdown and you know the sp500
definitely has drawdown points at
various points along this way so it's
nice to see that we don't have the same
drawdown points but the question is can
we modify this a little bit to see some
better results because really I mean
just because we have a little bit of
drawdown with the S&amp;amp;P 500 and say you
buy this spy you're gonna choose to do
that versus this 5% over a whole year so
a few things we have to consider as well
one we're not paying trade costs still
so this is not including any sort of
trade you know costs so if this is a
high-frequency trading as in we're doing
like you know multiple trades day now
we're kind of getting probably be in
trouble and would maybe make ourselves
in the negatives depending so we still
have to kind of factor it something like
that in how many trades are we making
but also the question is can we modify
this strategy at all to improve our
return so if we want to modify the
strategy
we'd have to rerun this this data well
have commented it out but we'd have to
rerun you know this and it exists it
just doesn't want to show it to us so we
have to rerun it and so the answer that
though is yeah so if you like we're for
example here there's a lot more there's
a lot more positions we could make so
here we're actually only entering into
about I don't know this this covers less
than half of the possible positions that
we could take into account so the first
thing you'd want to do is really add to
this to make it to where you're more
willing to enter into positions now
that's going to also increase your trade
frequencies
so we still want to know like what is
our actual trade frequency here but
we're missing a lot of positioning for
sure as far as you know when we'll buy
and sell we could also change how much
we buy and sell at but also most
importantly what we're missing here is
any sort of relation to where where the
market is at the moment so I mean and
also what's the actual overall sentiment
so in the market it might make more
sense just by the companies that are
just have positive sentiment and to stay
away from the ones that don't or if
you're gonna buy into a company's trend
maybe buy the one that has somewhat
positive sentiment because we're
perfectly confident gonna keep going up
because sentiments very positive you'd
also flip that and you know be more of a
value investor and only buy companies
where their sentiment is the weakest or
something so there's definitely a lot of
other strategies to look into and then
also my biggest thing though is that we
have to kind of we need to be able to
look at what the price is at the moment
and because like I said before sometimes
price goes up and sentiment goes up
because price went up and then we're
finding ourselves buying at the high and
selling at the low so that's not good at
least from what we see we're not doing
that the majority of the time but it
probably would be in our best interest
to eliminate that and and then maybe add
some more strategies too so if you add a
few more strategy to this I imagine that
we could probably improve this quite a
bit so maybe we'll add a few more
position entering parameters just to see
that's probably the easiest addition
that we can make to those scripts but
then after that we probably moving
forward since we're kind of happy with
what we saw there we need to incorporate
trade costs and actually probably I
should incorporate well then incorporate
trade costs before we add any more
parameters because the addition of
parameters is can only really increase
the trade counts so so we'll go ahead
and do that too so we'll add the trade
costs into this and then we'll probably
have to regenerate a new new output dump
but that's okay so anyways that's what
we have to look forward to if you guys
have any questions or comments regarding
everything up to this point go ahead and
leave those below as always thanks for
watching thanks for all the support
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>