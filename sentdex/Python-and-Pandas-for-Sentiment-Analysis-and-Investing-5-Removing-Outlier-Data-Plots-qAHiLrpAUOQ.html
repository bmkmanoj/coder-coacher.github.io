<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python and Pandas for Sentiment Analysis and Investing 5 - Removing Outlier Data Plots | Coder Coacher - Coaching Coders</title><meta content="Python and Pandas for Sentiment Analysis and Investing 5 - Removing Outlier Data Plots - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python and Pandas for Sentiment Analysis and Investing 5 - Removing Outlier Data Plots</b></h2><h5 class="post__date">2014-05-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qAHiLrpAUOQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
their Python and pandas tutorial video
in this video we're gonna be doing is
showing how to remove outliers with
pandas okay so the removal of outliers
is kind of a sticky situation okay so if
you just have outliers that you don't
like about your data set you can't
remove those okay so outliers are a part
of a data set and many circumstances so
you don't want to just remove anything
that is an outlier okay so that's bad
use of data but in some cases you have
literally bad data that has outliers
that are there because of some sort of
glitch or whatever and so if it's your
data you might want to fix that glitch
that's causing the outliers if it's not
your data then you must fix the glitch
yourself after the fact so the question
is what can we do to remove outliers in
a situation where the removal of an
outlier is actually warranted because
again just because you don't like the
fact that that outlier is there does not
mean you can just remove the outlier
okay so I'm not trying to condone any
any bad practice here my idea here is
just to show you guys if you have a you
know a legitimate need to remove
outliers how to do it so if you're not
watching this video I imagine this is
kind of a common question people ask so
if you're not watching this video as a
part of the entire series copy my import
statements up here and style if you're
using style if you're not using style
just just don't copy the from matplotlib
import style and don't copy this as far
as the function here you don't need to
copy that we aren't going to be using
that right now and so let's go ahead and
get started so we're gonna make our own
little function here entirely now also
this is the data set here I gave a
download of these stocks the sentiment
analysis from my website so if you want
to use the exact same data that we're
using you can download that I'll put the
link to that in the description
otherwise you can use your own data set
entirely so let's go ahead and get
started so we're gonna make a new
function here and I guess we'll just
call it for now
fine I'll liar underscore fixing and
we're gonna say a stock name and we
could let's say I guess what we can do
we could put the Emmys in here but maybe
for now we'll just leave that blank
we'll just have stock name in here so
now we're gonna define the data set in
the sense we've already typed it out
here I'm just gonna go ahead and copy
and paste that same data stuff so that's
good now we're gonna go ahead and do is
we're going to also copy this part as
well so if you're not coming from the
previous tutorial I guess pause it and
type all of this out this is just the
files name the index column and then yes
we want to parse dates this just makes
sure that because this file has a bunch
of different companies in it so this
line is here too
this line is here too only plot and or
only deal with the stock specific stock
that we're interested in now the next
line I guess the first thing we could do
is we could just go ahead and plot this
data so we could just do a x1 equals PLT
dot sub plot and we can make this a 1 by
1 by 1 and what do we want to plot well
let's just plot the clothes of whatever
we're plotting so we'll say DF closed
dot lie and we'll just give this a label
of price so what we're gonna see here is
that we have a problem because let's see
outlier fixing stock name we're gonna do
BTC USD so my Bitcoin price is I pull
from an API and sometimes this API gives
me very bad data and so there's really
no way for me to know that this data is
bad when I get it we don't know did the
price change this much or is it bad data
and anybody who knows anything about
Bitcoin
we know that Bitcoin is highly volatile
so this is really a challenging scenario
so anyway let's go ahead and we're going
to plot this the other thing we need to
do
let's go ahead and do PLT dot legend and
we need to do PLT touch show otherwise
that's not going to show up for us that
should be it so let's go ahead and run
that and eventually we'll see that we
have kind of poor price amount I'm just
making sure I commented that other thing
out yeah so we should see that we have a
lot of bad data in this data set
whenever this plot finally does show up
and so what we can do to get around this
is we can use standard deviation as a
method for detecting bad plots okay so
here is our chart right so as you could
see with this we have quite a bit of
what looks to be bad data okay so we've
got these massive fluctuations like you
know here and here and all of these are
quite poor we can clearly see with our
eyeball that you know this the upper
bound price is right and it looks like
we've got a lot of drops here that are
bad data we've also got some misses here
like this one there's just no data in a
couple of spots and that's going to be
you know pretty normal that data is not
bad data is just we're missing data
there but as far as these massive you
know plummets down and then right back
up again those are bad data but then we
have also good data where it plummets
down for example right here where it
plummets from 800 to almost about 700
within a really short timeframe that's a
fast jump or fall down and so we don't
want to pick up that as bad we just want
to pick up these these momentary lapses
here where if we zoom in we can see it's
just like a 1 bar down and it goes back
up so we're gonna use standard deviation
to solve this problem for us so how do
we do that well just so happens a
standard deviation luckily for us
there's actually a built-in if you
wanted to do standard deviation yourself
I believe actually have a tutorial on
doing that completely on your own but
for now we'll use built-in standard
deviation with pandas so what we're
gonna do is underneath where we define
DF we're also going to define standard
deviation now the general
shorthand way to define standard
deviations STD so we'll call it STD as
opposed no jokes PDD uh rolling
underscore STD even though you do it too
so here we're gonna take a rolling
standard deviation okay so what we're
gonna do is we're gonna reference kind
of like you would do with a moving
average right you're referencing a you
know out of the previous few plots
what's the deviation here so we're gonna
say what is the data set that we want to
use to perform this s/t operation well
we're going to use the DF and close
since that's what we're plotting and we
can see it clearly has problems then for
rolling standard deviation we can use
six and then we can also same in periods
and here we can just say like any form
of minimum periods that we want to
consider and in our case we can do I
would say just one really that probably
will solve it and also maybe for
standard deviation instead of six that
might be a poorer idea because six might
get us in trouble when we do actually
have real drop so let's do it
twenty five that's probably a better
idea so we use twenty five and then what
we can do is let's just plot another
example or applaud another chart
basically below it so instead of a one
by one let's make it a two by one so
it'll be a chart on top and a chart on
bottom so axis one will be a two by one
and then we'll plot that put up a legend
and then we're gonna say ax 2 equals PLT
dots up plot this will be a two by one
only this will be chart number two so on
the bottom and then also we want to
share X ax one so that just shares the
axes so when we zoom in and stuff we
retain that the same you know time frame
basically so now what we want to do is
we've defined STD so now we can just
plot up our STD so STD dot plot label
and we'll just call this
a deviation and again let's plot we have
to say PLT dot legend here and let us
show that should be good enough for us
yes so we'll plot this up and while
we're waiting I'll go ahead and talk
about what we're going to do next so
here we'll be able to actually visually
see the standard deviation and what
we're hoping for is when we have a
faulty price the standard deviation
should jump very significantly so with a
you know standard deviation of 25 it's
probably gonna put our deviation up you
know I don't know cuz we're drunk we're
dropping basically $200 almost worth of
stock price oh here's our chart right so
we can see here we can see here that we
have like here the standard deviation
went up - looks to be my mics in the way
of reading this value 33 okay about and
some of these are probably bad data we
could zoom and probably find out for
sure right this one's a legitimate one
but this one's actually probably a bad
one which is interesting because this
one here is legit actually and this is
the bad one and we can see our standard
deviation is not not a fan but it
doesn't pick it up necessarily but we
can come over a year and here's some
prices here and we can see clearly that
our standard deviation says you know
these legit legit legit right it's being
of everything that is wrong so we can
kind of foresee a little bit of a
problem here just because we might
actually pick up some legit plots
especially here where we've got that
major crash and then here there's
another crash so this looks like a bad
one but the rest of the prices appear to
be legit so in this scenario it would
pick up this plot and this plot and then
be right back on track to pick finding
the regular ones or the ones that were a
problem so what can we do about this
well we can zoom out and we can see
there we can kind of estimate that
anything
we can say anything that is higher than
a standard deviation of at least 40 but
some of these are legit down here this
is like 22 so we could start with
anything with a standard deviation
higher than say 20 is bad data okay and
then these ones are just kind of these
last few ones are kind of bad but that's
okay so anything with a standard
deviation let's say a higher of 20 we
want to ignore or get rid of okay so
what we can do is we come back over to
our outlier fixing scenario and if you
look see like right here where we've
defined DF equals you know the lower
stock name we can do the same thing with
standard deviation so how do we do that
so what we got is once we've defined
standard deviation we know well first of
all what do we have to do we have to
give standard deviation a column here
because right now standard deviation
does not have a column so what we could
say though instead of STD equals what we
can say here instead is DF STD like this
so now we've assigned a whole column to
STDs and what we can do I said new Jose
I'm sorry what we can do is we can say
now DF equals DF we're DF STD is less
than and let's try 24 now that might be
a little too large but I think we can
get away with 20 and so now I've got now
I've got that so let's go ahead and save
this and we can plot it up and let's see
what we have now most well at least we
know most of these will be fixed by just
doing this so we should fix most of them
but we might have a few stragglers but
we definitely there's a kind of fine
line you want a toe because some you
don't want to get rid of too much good
data but you definitely don't want these
outliers especially for something like
stock you know back testing or something
like this where you know the price
didn't actually drop that much
hold on let's see what did we do here ah
yes we took away it's a straight
definition darn so here so what we did
is what we just saved ourselves another
line and we so we said we defined a new
column so there's no longer anything
called STD so copy this and replace that
there Matt lips probably gonna get very
angry with me in a moment so you'll see
some errors uh where are they usually
they pop up if you start to plot
something and then you don't blot it
anyway there they are
one more there we go okay anyways so you
definitely don't want to have the bad
data there and you don't want to get rid
of too much of the good data at least in
my opinion you want to get rid of all
those bad days especially when we're
talking about a you know price drop of
about thirty percent and then a price
rise of about fifty hundred percent
actually all right actually it's 50
percent backup save drops down to about
four hundred goes back up to six hundred
let's say so here we can see that now we
don't include any standard deviation
that is greater than twenty right so all
the max out at twenty that's good and
now we can look at our price chart here
and our price chart looks much better
this is a legitimate price chart barring
possibly this drop here I forget think
we looked at that one already though
right so this price drop is definitely
almost suspect as we can see it is right
on the line of that so we could see is
there anybody else that's right on the
line so we got another one that's right
on the line here and that looks like it
could be a bad one as well hold on let's
zoom in or do this one more time
hmm this one's hard this one I mean
looks to me to be more legit like as
long as it doesn't it gradually goes
there that's one thing but when it drops
like immediately there you know it's bad
so this one's close so would you want to
get rid of that plot maybe and that will
see if that was this one here but this
one for example we kind of want to get
rid of this one okay so so it's kind of
challenging because let's see that one
was really close to a 20 and this one
which appears to me to be a legitimate
draw
in recovery they're both really close to
the line so I guess I probably I
probably won't touch those you can
decide what you want to do with your
specific data a lot of times you won't
find yourself in a scenario because like
bitcoin is just historically very
volatile so we have a lot of high
volatility moments and it depends how
bad your data is so we had a pretty
large example of you know massive drops
but Bitcoin also has legitimate massive
drops so that was kind of it's kind of a
hard scenario to use but anyway this is
just a example of how you can get rid of
outlying plots using standard deviation
so anyways that's going to conclude this
video also just as a quick note if you
wanted to actually just eradicate it
from your data set what you can do is
after you've done this you could save to
the CSV so you would use pandas you know
save or to underscore CSV and you could
resave the data and you could knock off
the standard deviation column before you
did that and you would fix the data set
so that way every time you went through
the data set you want to have to
calculate that standard deviation and
then calculate less than 20 and all that
so if you're gonna continually find
yourself doing this you should just
knock it off immediately so anyways
that's going to conclude this video on
how to fix outliers again don't remove
outliers just because you're not happy
that they're there just remove outliers
if it's literally bad data like it was
in this scenario so anyways that's it if
you guys have any questions or comments
feel free to leave those in the comment
section below as always thanks for
watching thanks for all the support and
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>