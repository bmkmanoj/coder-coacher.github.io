<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Color Filtering - OpenCV with Python for Image and Video Analysis 7 | Coder Coacher - Coaching Coders</title><meta content="Color Filtering - OpenCV with Python for Image and Video Analysis 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Color Filtering - OpenCV with Python for Image and Video Analysis 7</b></h2><h5 class="post__date">2015-12-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CCOXg75HkvM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
another open CV with Python tutorial in
this tutorial we're gonna be talking
about how we can filter an image or a
video for like a specific sort of range
of colors so we could use this to either
find a specific color or actually remove
a specific color from a video or only
show a specific color or show everything
but a very specific kind of color range
so this is very much like how the
operation that's performed with a green
screen you find that green and you
remove it and maybe even replace it with
you know another image or background so
let's go ahead and get started so we're
going to go ahead and start with open CV
and numpy imported and then we're going
to say cap equals C v2 dot video capture
and I'm going to put a 1 here but you
should put a zero most likely if you're
using a webcam but my first camera is
recording already so I'm using my second
camera over here
now if you don't have a webcam what
you'll want to do is either use an image
or something like that and what we refer
to as the frame you will just you'll M
read in and then you'll use your image
in place of our frame or your image data
so that's our capture and then you won't
need a while loop if you're just using
an image and this will be true
throughout the rest of this tutorial
where we're using video rather than an
image so Wow true we're gonna say
underscore frame equals cap dot read if
you're not familiar underscore just
means like it's a it's a value that's
returned from a function so we pretty
much need it there to be unpacked too
but we just don't care about it so we
give an underscore to just like let any
reader ourselves if we visit this later
no we don't use that return so
underscore frame equals cap read then
HSV and this is HSV stands for hue
saturation and value I believe yes and
this is another way to define colors and
we'll be talking about that a little bit
more here in a second so just for now
HSV equals CB to convert color and we're
going to convert the color of our frame
using the function of CV two dots all
uppercase here color underscore BG are
two HSV so we convert this to HSV colors
if you're not familiar here is a lovely
chart from Wikipedia and the idea here
with HSV the reason why we're going to
use this is for range purposes and the
reason why it makes more sense to use
HSV for range rather than RGB or BGR is
due to the nature of how it works so
with RGB and BGR each value of your
three values is a color value and so a
range of those color values to another
range just is not going to work whereas
with HSV the hue is the color value the
value is basically how much of that
color is in existence and the saturation
is how much intensity of that color for
a lack of probably a better explanation
of that but each of those is very
independent right
you've got color you've got intensity
and you've got like light I suppose
maybe with value so each one is very
independent of the other one whereas
with RGB BGR that's just simply not the
case
so making a range of colors in that
format just will not work very well
anyways it'll work it just won't work as
you might intend so so there we have
that now we're going to have two colors
we're going to need to be seeking an
image of something and I'm going to be
using this nice red hat because the Hat
is red it's a unique color there is no
more red like this in my room
use whatever image of or use whatever
item you want try to make it a unique
color though that doesn't exist anywhere
else in your area so um so that HSV and
then what we're going to do is we're
going to have a lower red or lower
whatever color for you upper red and
these are going to be we'll start with
an umpire array so NPRA and we'll start
with zero zero zero for the lower and
then NPRA 255 255 255 now in in CV there
is the following we're not going to use
it because
not it's just simply not going to work
but you can convert a single color to an
HSV color using this function convert
color you can do that but in this
specific setting it makes no sense to
use that because you're going to find
that when you convert that the values in
your HSV versus the values that you get
from this won't even make a legitimate
range in a lot of cases and even if it
did they're just there it's like apples
and oranges right there these are two
things that are you can convert one but
if you're trying to make a range with it
a range is a very type of operation I
suppose and that type of operation
performs totally different in HSB versus
RGB or BGR because the elements that
comprise it are just different right it
just doesn't make sense to use that but
it does exist just keep that in mind but
for here we're going to kind of do our
own natural filters so we'll get there
it'll be trial and error basically so we
define lower and upper red now we're
going to create our mask our mask will
be equal to CB 2 dot in range and it's
in range of art you well in range from
this HSV which was converted HSV lower
red upper red so the mask will be
everything that's within these ranges
which right now is everything so the
mask currently looks identical to the
frame using these parameters here
basically then the result is going to be
equal to CD 2 got bitwise underscore and
so this is going to be we're applied to
the frame where the frame is equal to
frame and wear the mask equals mask okay
so this is an operation is performed
basically where in the frame there is
the frame and the mask is equal to mass
scope so so it's where there is
something in the frame and where the
mask is basically true so the mass will
be basically 0 or 1 be either it's in
the range or it's not so if it's in the
rain
it will be a 1 so it'll be white and
then when we perform this bitwise
operation where there are ones in our
mask we will show the color from the
frame ok so so as I said right now
everything's going to be a 1 so we're
going to see really everything but well
we'll talk about how we're going to
filter here in a second so now we're
going to say k equals c v2 dot weight
ski and this will be for an exit so key
v and 0xffff k equals 27 brake you can
also just do the weight key 0 if you
want CB to destroy all windows and then
do a cap release this lets your your web
cam go so it's it if you leave the
program running and you haven't done a
cap release even if you're not
displaying output from the camera it's
like using the camera so if you do a cap
release that releases it otherwise you
can close the program and most likely to
let your camera go but things can happen
so let's go ahead and run that really
quick just to see it should be here I'm
not sure why it's not popping up yet
maybe my camera was in use or something
or did I you know do use the right
camera I'm not quite sure why we're not
getting our oh we're not actually
showing anything is what anybody
say anything ok cv 2m show we need to
show the frame so we'll show the frame I
cannot believe this CV - all right so
now frame and then we'll show the mask
and then we'll show the results all
right all right so as I said this is the
original everything is in that range
because everything's in that range we
get everything in the result so now
we're going to work on filtering so the
first thing so HSV is you know Q Sat
value so if we look back over here Hugh
is the main thing that dictates what
color things are so basically we can
sort of modify
you and see how that works for us so we
could set hue 250 okay and we can see
what happens well turns out we actually
with that one change we've removed quite
a bit in the background and we've
retained our hat at some points where
the hat is very bright like right here
it is removing that cuz it's probably
more of like an orange e color maybe so
you could like lower this maybe a little
bit too I don't know 30 maybe maybe
that'll be a little better yeah that's a
little better but then obviously we got
all these other colors here let's try to
make it let's see if we can make it 10
and keep it kind of in color no matter
what we do we just simply just does not
want the hat to be shown that's very
strange oh I can't believe that that
itty bitty bit okay let's lower this to
180 what happened I don't even know why
that would happen that way 0 to 180 and
it's still okay well I'm gonna set this
to let's try let's try 100 and it's
still there so let's try and that and
everyone
why didn't 180 work initially that's
very strange I cannot decide okay well
that's good enough
okay so let's close close these and then
we'll set this let's try to set this 100
150 huh that's basically everything
alrighty
so I don't know set this to pretty much
whatever let's try 150 nope lost it all
let's set it to 50 that's pretty good
let's lower this one a little bit let's
set it to let's set that one to 150
still got this background noise but
that's okay we'll talk about that in
next tutorial so basically we've got
here what happens is we take this frame
the mask is basically everywhere it's
either a 0 or 1 it's boolean operation
either
either the pixel is in that range or not
if it is in that range great and then
here is where there is yes mask and then
we've got color basically so it shows
the color and that's how we get the red
now obviously we have a little bit of
noise which we can see really well in
this one we've got all these like white
pixels you also have a little bit of my
ear whoops this year showing up and
maybe a little bit of my neck maybe
there anyway
we've got some noise so in the next
tutorial we're gonna start talking about
how you can begin to eliminate noise
with smoothing and blurring and stuff
like that so that's what we're going to
town on the next tutorial if you got
questions comments concerns whatever
leaving below otherwise as always thanks
for watching thank for all the
supporting subscriptions and till next
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>