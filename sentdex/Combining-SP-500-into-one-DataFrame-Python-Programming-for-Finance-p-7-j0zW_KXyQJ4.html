<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Combining S&amp;P 500 into one DataFrame - Python Programming for Finance p. 7 | Coder Coacher - Coaching Coders</title><meta content="Combining S&amp;P 500 into one DataFrame - Python Programming for Finance p. 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Combining S&amp;P 500 into one DataFrame - Python Programming for Finance p. 7</b></h2><h5 class="post__date">2017-01-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/j0zW_KXyQJ4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome part 7
of our Python for Finance tutorial
series in this video ordered in is just
kind of building on the last one so in
the last video we pulled all data from
yahoo saved it I've gone ahead and
commented this out so don't forget and
rerun that again but by now in the same
directory of the script we've been
working on you should have stock DF
director there and then within it a
little over 500 companies and all their
pricing information we can just click
online this for example there you have
it so now we have all the company
information that we need and what we
want to do from this point is combine
them all together now I wanted to say we
could do we could have done this all in
one go so as we pulled them rather than
saving them it could have added them
joined them to a main data frame but
what I'd like to do generally is save
everything in everything that I can when
I'm pulling from any sort of API or data
set or anything like that I like to save
it locally because it took like you know
5 10 15 20 minutes maybe even more to
pull all that data as opposed to just
when you do it locally you can pull it
within moments so anyways what we're
going to do now is actually bring those
together but in the future it's
conceivable that you know maybe you want
to also besides just have the close
price which is what we're going to look
at maybe you also want to have the high
- below or something like that and to
account for all those things you would
either if you did it live you'd have to
go back and repol all the data again
which is kind of lame so anyways that's
why we're doing it this way I just
figure eventually someone someone will
ask why didn't we just do this in the
beginning so now that we have all these
data frames together what we want to do
is compile them all into one one data
frame and obviously they have a lot of
overlapping columns you've got open high
low close volume and adjusted close but
what I'd like to do is take the adjusted
closed column for all stocks and combine
them into one large data frame of you
know a little over 500 columns so
so to start we're going to come up with
a new function here and we're going to
call this function compiled data so
compile data and then we're going to do
is with open sp500
ticker stop pickle with the intention to
read bytes as f we're going to say
tickers equals pickle dot load F and now
we're ready to be actually be dinner
data frames so we're going to say mean
underscore D F and right now just can be
a empty PDE data frame so it's just as a
data frame object but it has like no
columns no index nothing now what we're
going to do is begin iterating through
basically the tickers that we have we
could also iterate through all of the
files within this directory but if we do
that we might have old files from before
or something like that I think it's just
best to go this way go with the latest
updated tickers file best seems to make
the most sense so we're going to do
we're going to do that so we're going to
say now is for count ticker in enumerate
tickers what enumerate does is just lets
us kind of count things so it's kind of
the equivalent of counting through range
len of something so basically what it's
going to do is and when you enumerate
some sort of iterable it just it will
return you know 0 and then the 0th
element 1 and the first element and so
on so we can count where we are in this
list and it's just kind of helpful so we
know where we are in the whole
processing process so for each of those
we're going to say the data frame right
now is P dot read underscore CSV and
it's going to be a CSV in stock D F
slash whatever that ticker is dot CSV so
then Docs format ticket now we're going
to say D F dot set index we're going to
set the index to be date we're going to
say
yeah we I was I was trying to think I
was like do we actually even need to do
this but yes we do through Saturdays in
place will be equal to true again so we
don t just refine we could do it all in
one place now we're going to do DFS
rename and we're going to rename some
columns in this case just one columns
equals and we're going to rename the
adjusted closed column to be whatever
the ticker name is so now the column
will be you know exo-m AAPL or whatever
and that column is just going to be the
ticker price or the clothes for that
ticker so it's just one column at this
point that we're interested in and
eventually we will make it just one
column and then we'll say employees
equals true again now we're going to do
is gift drop and we're going to go ahead
and drop back home
open high/low close and volume so the
only thing remaining is what used to be
adjusted closed is now ticker we drop on
the add these one and someone kind
explains why axes is useful because to
me every time you drop you are always
dropping on the first axes and yet if
you don't have this the default is
actually zero and you will get an error
it's very annoying anyway in place
equals true it strips not remember face
it's not so those are the columns now we
want to do is basically start joining
all of these data frames together
because each of these data frames now is
just the adjusted close price called by
their ticker name so to start our data
frame is actually empty so we can't
easily join to it because it's not
they're not compatible so what we're
going to say now is gifts named DF empty
this will just be either true or false
it's a buoy so if it is empty then we're
going to say is maybe F equals DF boom
now it's not empty but is it in an empty
ie it already has a BF or multiple DF so
what do we want to do well we're going
to say main yes equals main PS jewel
Maureen yes how outer basically this
just lets us keep both like if there's
certain columns or certain rows that
some don't have or whatever it will kind
of it'll let us have information from
both which will wind up giving us not in
numbers sometimes when there's not some
overlap but this way we actually don't
lose data for anybody now once we've
done that we're going to do this count
modulo modulo count modulo ten equals
zero then we'll go ahead and print count
what's this doing for us basically when
you do something modulo a number
basically you're saying if we were to
divide count by 10 wherever we are is
the remainder zero so count let's say
divided by 10 if the remainder is zero
so we're in print account so we're going
to see you know 10 20 30 40 and so on so
we just that way we know where we are
sort of along the way but we're not
printing out every single you know one
two three four other than all that so
once we're done we're done with that for
loop and we're just going to listen
screen main d/f head and then let's also
go ahead and say this in order to say
main DF to underscore CSV we're called
the CSV sp500 joins closes dot CSV and
we're done so now if I should just call
this function to run copy-paste and
let's run it and see if we get any
errors and we do this is a weird-looking
error
it's unclear to me why we're getting so
in line so we won it's in the renames
eyes what we've done okay so it's like a
dictionary so you were renaming this
column and then we're going to say -
what so it should be a colon rather than
a comma there that's a really unhelpful
error by the way a panic from him I'm
just too stupid to read that error but
yeah that was unclear
okay so we're running through we're
about halfway down it is planck's I
think I'll just keep recording until
it's done we should be done pretty quick
I just want to see the actual data frame
head before I force sign off make sure
we got everything we intended sure
enough yep we got it and as you can see
some of these companies have not a
numbers that's just because like not all
of them had ticker or even trading back
in the year 2000 so if we said main dfdl
chances are these would be filled in but
I can't do that because this isn't a
function it's currently unreachable via
the interactive line here okay so we
have that we should actually have a new
yes this new file here with all the
joined closes it's about 20 megabytes so
now we have all of our data in just like
one big CSV that we can begin to work
with so in the next tutorial will
actually begin working with all that
data if you have any questions comments
concerns problems issues whatever favor
leaving below otherwise I will see you
in the next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>