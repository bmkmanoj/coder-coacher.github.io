<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Multiprocessing - Intermediate Python Programming p.10 | Coder Coacher - Coaching Coders</title><meta content="Multiprocessing - Intermediate Python Programming p.10 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Multiprocessing - Intermediate Python Programming p.10</b></h2><h5 class="post__date">2016-11-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oEYDqQ1pq9o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
another Python fundamentals that aren't
the basics tutorial series in this video
what we're gonna be talking about is
multi-processing so first let's talk
real briefly about why we have to use a
library to do such a thing so you may
have noticed that when you run a Python
program even if you say threading your
your CPU does not get fully utilized
depending on how many cores you have
you'll get different numbers personally
I have 6 cores of my processor and a
Python program that doesn't use
multi-processing will max out at about
16 percent of the CPU that's as much as
it can give to Python so that's kind of
annoying why is that the case the case
is it's that way because of the Gil so
maybe you've heard people complain about
the Gil the Gil is the global
interpreter lock it was initially put in
place as a memory management safeguard
and maybe it wasn't the best idea we do
have better ideas nowadays but the
problem is we can't just take out the
Gil because there's a lot of
infrastructure built with the assumption
that we have that memory management
safeguard that we have that Gil in place
so if we remove the Gil we have a lot of
other issues so it's here to stay but
what can we do about it well we can use
multi processing so what multi
processing is going to allow you to do
is to utilize multiple processes so with
if you if you can think of multi
processing just this way so for example
you can write a Python program that does
something and you can run it and it will
use a whole CPU and by the way when I
say CPU I mean a CPU core not your
entire processor so generally let's say
bet six cores in your processor you have
six CPUs generally it's just referred
that way because like when you V top and
stuff in in Linux it says it calls CPU
at least that's why I call it CPU anyway
so CPUs equals cores okay so you one-one
Python program you can max out to
sixteen percent but what happens when
you open another Python program it can
be this
in program you open it again maybe
you're maybe it's let's say we're
working with a spider or something like
that like a web website crawler and you
open one it masses out at sixteen
percent but you can open another one and
that will use a different core they're
not going to talk to each other but
they're going to use different cores and
then boom suddenly you're up to 32
percent CPU and then you open like 15
more of them and bam you have maxed out
your CPU each of those Python programs
is a Python process so what the multi
processing library allows you to do or
makes easy for you is launching separate
Python processes that don't necessarily
talk to each other they can't talk to
each other and they can pass information
they don't have to but if you can think
of the really basic example like I said
just just simply opening up multiple
versions of a script that might be doing
something like crawling random websites
you can run multiples of those at the
same time they don't need to communicate
with each other but if they did you
might write a quick pipe or something
that's going to allow them to
communicate with between each other you
could do a lot of work but at the end of
the day multi-processing this library
has done that work for you so let's go
ahead and talk about how to launch a
simple process and then we'll go from
there so first of all we're going to
import multi-processing it is a part of
your standard library so everybody has
it and then we're going to find a really
simple function this is just going to be
defined we're going to call it spawn and
then all spawn is going to do is print
spawn with a capital S then what we're
going to do is we're going to do if name
equals main and if this was ever
necessary it's necessary in
multi-processing
again this just makes it so the
whatever's under here will only run when
it's the script itself that's being run
and so if the script is being called by
something else it won't run so if name
equals main we're going to run something
and that's something we're going to say
is for I in range of however many want
let's just say own I 5 and what we're
going to say now is P for the process it
will be equal to multi
a mole time processing dot process so
this just allows us to spawn a process
and we're going to say the target is
going to be just the function and that's
going to be spawn so that's our process
then we're going to say p dot start that
starts the process P dot join basically
this is waiting for the process to be
complete so now what I want to do is
open up a command window or terminal if
you're in Linux open up a command window
and what we're going to do is call this
script so you you could you can run it
in idle or whatever but it's not gonna
we're not going to see the printout so
I'm going to run it in a shell so we can
actually see her in M command prompt so
I first of all need to specify the full
path to Python you probably don't I just
have multiple Python versions so I need
to be explicit and then I'm going to say
10 period and then it's multi-processing
tutorial dot I good so we'll run it and
then we see spawn spawn spawn some okay
cool now you probably won't see it in
this case but if I pull up the task
manager so let me pull that up and wait
for you it's taking awhile when it
finally comes up go to your background
processes so you should get this if you
see like this hit more details and then
you'll scroll down and then basically
it's alphabetical so LMNOP so around
here is where we should see the Python
processes we're not seeing any right now
but if I go and rerun this we should see
it yeah there's a couple of Python
processes momentarily what if we said
okay we really want to see these
processes let's change this to 55 we'll
save that pull back this
rerun it hit enter and we're still only
seeing just two python processes so
what's happening here is we are waiting
on the processes to be complete with P
join so if we uncomment that out say
that again and I'm come over here rerun
it I'm going to pull up the task manager
- we should see a lot more processes
right so they all kind of ran at the
same time they're not waiting on each
other anymore so that's how you can both
spawn and wait for processes but also if
you don't need to wait for them for any
reason you don't have to but for example
a lot of times process like for multi
processing maybe maybe the way that your
processes are going to communicate is
via like a shared database of just
information but a lot of times you're
going to use multi processing to kind of
pass variables between each other and
we'll talk a little bit more about that
soon enough but if that's the case if
you're waiting on a really important
variable you're going to use P join
because you can actually wait but
otherwise if you're just trying to run
these processes irrespective of each
other you can just peanut start now one
last thing before we go and that is
arguments so when you create a process
like in this case we just ran spawn and
spawn just did just printed spawn but
maybe you want to pass an argument to
that processes function so what we can
do instead is and when we say target
spawn we could say args we're gonna say
args equals and we'll just use I for now
so we'll say I if you only have one
argument you'll need to follow it with a
comma I actually don't know why you have
to follow with a comma in this case if
someone knows feel free to let us know
that's interesting
I'm not sure what so anyways if you know
the answer comment below otherwise we're
passing I and then let's go ahead and
we'll just we'll just format it into
here format
and we'll pass numb here and then we'll
take in numb save that and then we'll
run it again I'm not going to pull down
the task manager but we should see the
new printout right so we get the spawn
you know 0-2 and we can even see that
zero comes first and then 3 then 2 then
6 then finally one showed up and so on
so yeah
but if we did P join I closed it shoot
let me open that back up open command
window here C colon Python 30 Python 10
dot there we go so when we do PETA join
we're ensuring that they're gonna these
processes are going to happen in order
don't close that hairs okay and then we
can also do like we can pass another
argument like I plus 1 and then we don't
need the trailing comma and then we
could say we could expect that to be
num2
we'll fill in a parameter num2 here save
that and let's also put it out we won't
do PETA join since it's going to be
faster not to wait on that and then we
can run it again and while we're doing
this actually I'm going to do
trying to think if I want to just print
spawn I think we'll continue to print it
but I'm going to make this much larger
I'm going to do let's do a hundred
depend on your CPU like if 55 is too
much it just depends on the CPU and I'm
going to run this and we should get the
output from the two numbers and then
also maybe see the CPU go to 100 I
didn't catch it we definitely went to 45
let's do we'll do 500 hopefully it
doesn't screw up the recording since I'm
going to max out probably the CPU but
there we go okay 100% CPU so there you
have proof that we can actually utilize
the entire CPU I think that's all I want
to cover in this introduction to multi
processing in the next tutorial we're
going to be talking about how you can
share information between the processes
are really more importantly not
necessarily sharing information between
the processes but get information from
the processes okay so in this case we're
not actually getting any information
back P is equal to process but we're not
actually getting information here and
even if we were how would we pull it
from P it wouldn't make any sense so in
the next tutorial we'll talk about how
we can get the return information from a
function rather than just having it do a
task so stay tuned for that if you have
questions comments concerns whatever up
to this point let me know otherwise see
in the next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>