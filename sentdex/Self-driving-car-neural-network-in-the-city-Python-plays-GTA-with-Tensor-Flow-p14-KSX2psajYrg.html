<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Self driving car neural network in the city - Python plays GTA with Tensor Flow p.14 | Coder Coacher - Coaching Coders</title><meta content="Self driving car neural network in the city - Python plays GTA with Tensor Flow p.14 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Self driving car neural network in the city - Python plays GTA with Tensor Flow p.14</b></h2><h5 class="post__date">2017-04-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/KSX2psajYrg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
another self-driving vehicles in Grand
Theft Auto with Python it is like
Christmas morning for me right now I
have been brewing this AI for actually
not too long it started about midday
yesterday and then I woke up this
morning and it was still going I was
pretty surprised but it's finally done I
ran it although this says I ran it for
390x that's not really true the data is
actually separated into mini files so
the entire data set is 30 files so I
actually ran it for 13 true epochs
through the data yeah so these are the
results now so it was saying that the
huge fluctuations I recall is by is due
to the learning rate I'm not really
ready to buy that one yet I don't think
that's true if you're the person you
said that or if you've heard of such a
thing
feel free to let me know below but their
their suggestion was to decrease the
learning rate over time so I mean I can
see why it would fluctuate that way and
be violent with a learning rate that was
quick you know like it just quickly
hopped around that does make sense to me
but that that's a solution I only think
that's probably a solution once it
really trains itself and gets to a
higher accuracy I don't want to lock in
my results at this point right so not
really sure you definitely want to
decrease it over time but the other
thing you can do is once you're kind of
close to a sort of zone that you're
happy with sure then you can decrease
the learning rate I don't know anyway
these initial ones here are just kind of
tests just to see this is probably just
a fluke or because I probably just
stopped it I think but it took me a long
time actually just to get something that
would even train on the data that I've
passed I've got basically nine input
options and it's a much more unique data
set than what I had before also is
taking a much longer time to build it
anyway
let me start grand theft auto and let's
see how
did now while I'm waiting on this to
start up in before like some freaking
update ruins my Christmas morning while
we wait for that let me kind of I got a
set up I think the script to actually do
what I want to do now so let me pull
this up using model so first of all what
is this thing well you can't tell
impossible name basically it I have no
idea actually if the sound is coming
over me
basically sorry if it is going over me
we're not who knows anyways but this
model does is it actually rather than
going through a loop through the city
that was a that's a good model and it
works pretty well until it gets a little
off track and then when it gets off
track enough it has absolutely no idea
what to do with itself so as I'm
thinking about this I was like well I
mean you could have some sort of logic
that like just kind of goes through and
it just fixes itself when it detects
that it's off a street it could even
just reset the game or something like
that but I'm not sure that's the best
way to go about doing something because
it will never explore and every time it
tries to explore it just loses its you
know what so so instead what I did was I
wanted to make one that would actually
rather than just going on that same loop
all the time could instead go through
like the actual city of Grand Theft Auto
now it's it's probably still going to
get it still itself stuck also there's
so many more variables once you like
leave the freeway and come into the city
so variables like pedestrians walls
rather than barriers like so in the
freeway there's the barriers and if you
hit the barrier it's like big deal it
just it basically keeps you on the road
that what is in the city there's much
more like walls for you to run into and
stuff so it's just a little different
and we pop back over here I think it for
now I'll just run the first one right in
idle and in fact I forgot that I had
this on such a large screen I'll just
put it right over the actual hole in for
now
okay so I got to load in the model name
that I just trained I forget what I
saved it as where's step three oh that's
just 14 epoch I say 14 you box there
just simply because I trained it for one
full epoch and I think that's one of the
ones that you see on the tension board
graph I think I'm actually going to get
rid of this window for now just just for
testing purposes because I never know
when something's over it or not okay so
using the model tastes good and it's a
high-end 12 K training samples but at
the end of the day that doesn't boil
down to many of each it's like a little
over you know ten thousand for each the
press is that you can make
forward/reverse where's that left right
forward left forward right reverse left
reverse right no keys so I can do all of
these things
t-time current currently doesn't exist
or I'm not using that I'm just trying to
see if this will start to work and then
we can start to build logic on top of
that I think I'm about ready I just want
to run it first and then we can talk
about it if it works so um let's do it
see what happens
oh you know what US isn't where I want
to be sorry I actually don't want to
start it here I'm going to freeze this
let's see I just really need to be in
the city somewhere over here I'm just
going to actually also am not using a
motorcycle just because realistically I
would keep falling off of it we should
be able to get by using it but I'm gonna
use the same vehicle I used in training
first I'm just going to put it somewhere
decent shuttle expert driver all right
let's do it now we run now we run and
then hopefully we'll see a countdown at
some point um this model's like pretty
much a double defender car alright I
doubled the Daleks net and then changed
a few parameters
please don't crash here it's going to go
down I can already see it coming bummer
I still wish someone said that maybe
it's because I don't have qu t NN
installed but that's not the case
because it works sometimes and I do have
qu DN n itself I don't know it's kind of
an older I mean I Prai should just
update everything and go through there's
so many little parts I just don't feel
like doing it I'm left at tensorflow 1.0
and everything else that's required
closer than that I'm not you just do me
wrong meds like Christmas morning you're
like open in the box and then there's a
box inside of the box it's work mmm you
are killing me wonder if I should close
out of this window too or something
others do it you killin it doesn't want
to see a woman it's the worst part is I
don't think I have enough data for this
this challenge this is just like step
one like find out if it's even remotely
possible to do what I wanted to do the
way I wanted to do it I just want to see
it take more than like one action or two
actions you I might have to just pause
and keep trying until I can get this
thing to work so I apologize but not
really I'm happy I'm the one that's
suffering the most in this situation I
think if not pause that's it why maybe
them maybe I should run it in the
command Bronx just because maybe there
is a maybe it's a different message this
time I don't know let's do it come on
for something this has been acting
really finicky to open the command
prompts in the window that you're in it
just takes multiple tries okay
give me what I want thank you where did
you open here we are okay come on /
Python 35
Python a step for all right the moment o
truth let's do it
please work it's time okay
ain't got time for this o my dogs are
going to probably start barking a bunch
of people in front of my house
the show must go on please move forward
ah it's crashed on me again
Oh in Python his stop working my
goodness cut can I please can we pull
huh could not create kudiye and handle
cadena not an issue like me me me me
could not open driver past could not
destroy check so you are you know what I
got tonfas wow what are these people
doing
so somebody burst like a water line I
think someone's house like burned it a
day and then while whenever the fire
people were done with the with the water
I guess they shut it off too fast and
that burst some pipes on my street so
then we've been like without water
randomly as they're fixing it I don't
know why like the cities don't don't
engage with like their their citizens
via I don't know some sort of like
website or something that just has like
live updates like you're going to be
without power for these times because
we're doing X Y Z come on baby yes
there goes oh my god give me both
brother let's go blow through those
flames oh my god it's actually somewhat
working I'm impressed take that turn my
boy and he's reversing look at the guard
please don't keep reversing get out of
this situation attaboy oh oh oh this is
where you get arrested my man you got to
do something interesting I'm just going
to give him a little push because he
needs a push oh we're low on memory yeah
too bad are you kicked called
let me just pause it I guess and this
actually was trained to be a running
from the police so let's give him some
stars then if he doesn't want to move
himself
all right now we're live take a
different direction dude I don't want to
get arrested this fast I'm I'm taking
control all right is back it back in in
his own control stop running into those
people okay so it's clearly reversing
too much or is doing nothing too much
let me pause this very second so in the
first model that I ever trained on this
hopefully my recording is doing well
because I'm running out of VRAM as I was
like trying to record I'm running this
massive model at the same time so it's
kind of problematic anyway so one thing
I thought about because the other one of
the other models I trained the initial
one it wanted to reverse like 90% of the
time that was clearly like the first
move it learned was like oh this is
where we want to reverse and then
basically the only move it would ever do
was reversed so that was kind of a
problem um but what I kind of thought
about was there's probably no time in
the game where I want to reverse for
longer than like 5 seconds or so and
there's really no time in the game where
I'm going to want to press no keys for
more than 5 seconds so if there's ever a
time where I'm not doing anything where
I'm reversing for more than 5 seconds
choose the second most common key or
something like that it also might be the
case that just weighted wise we might
need to apply a last weight on our own
to the the data the output layer in
theory the neural network should have
figured that one out on its own but
maybe not so those are two things that
we have to look forward to but I'm just
going it's running a little bit longer
just because this is way better than I
was expecting I was just hoping to see a
few movements but this thing's actually
moving for this is me by the way this
thing is actually moving pretty well
I'll tell you when it's not me
it's not me now actually you know
because it's whenever oh oh oh no oh I
crashed oh let's see
I have no idea what's going on in game
hold on let's see here son I think I ran
out of memory let me close this quit I'm
the game quit no I didn't ask for that I
did not ask for that okay
take two so my graphics card just in
don't and yeah so I I take a really
account like I tried to I made the model
big enough and I was like oh yeah I've
got plenty of VRAM for that but I didn't
really account for Grand Theft Auto or
recording so whoops
anyway let's let's try again it clearly
worked for a little bit so I went ahead
and restarted just simply because the
the card hadn't been restarted since I
trained the whole thing so hopefully
that'll maybe free up some some cash
let's see what happens okay
first forget it run this there we go
Oh
okay truck he's probably gonna get in
the way immediately I'm probably gonna
go right into his rear what are you
doing Mego clearly no Keys too often
let's go I'm giving it a push at the
movie Oh like I said before if the
numbers here are updating I'm not doing
anything but if they're not updating and
it's moving its me eventually I'll have
to get a sort of keyboard of camera you
have no idea what to do with yourself I
think we'll pull in the police here in a
minute
he's clearly no key and way too often I
think if like a police car hitting him
would jolt him into action but we'll see
hmm
don't it looks like he's doing worse
than he was before I wonder if this is
the old
no I cannot bear a by another GPU and
what a bummer
clearly we need a threshold for no T get
out of the road it's a green light what
is she thinking oh it's in the name of
science he's fine look he's up and he's
running he's fine he's fine I'm pretty
surprised he's pressing no keys so often
kind of a bummer but we can fix that
with a threshold he seems to turn pretty
well I'm going to give him some pushes
that's probably one can't stop keep
going keep going keep going
okay okay it's something I'm going to
throw some stars on them just to see
although this is when everything crashed
so we'll see how we do but this is me
moving on just wait until they find a
police I think it's just one right in
front of us you can get arrested if you
just stand here
you should rehearse here just curious
yeah
and no key is the last one so it's about
thirty percent that it wants to do no
key actually what's interesting why is
it doing no key I think no key is the
last one and I probably should have
labeled these but no clearly it should
be doing zero one two three which might
just be turned let me pull up pull up
the model real quick and look at it
because maybe he is maybe he's just
doing no key and turn wheel
he's just like going between those two
things because like just turn the wheel
is also do nothing basically
definitely doesn't want to go forward
let's just look at train model I think
this has all the things on it nope it
doesn't of course can you pull up
yeah I think balanced data will have it
all out
right so so looking here 0 1 2 3 is a D
which is actually reversed right
no no that's turn yeah so he just wants
to turn right in this case which is not
good I'm not really sure why he wants to
turn just right but okay but he's not
moving and I feel like if we don't do
any movement for a period that's great
it may be like no movement or reverse
for greater than 5 seconds probably pick
the second most frequent option or just
feed it to our training data this is
already light years better than when I
set it twenty thousand data so
I might change no keys to well because
of network training but maybe what I'll
do it I can change no key to just to
just do forward for now because he still
has reversed so if he wants to reverse
he can reverse
we're not we're not cutting his brakes
or anything we're just saying you can't
you can't do nothing come on down to no
key and let's just press key w just to
just to see hopefully this will load
right away if not whatever and then I'll
make the other changes and kind of play
around with it maybe add some more data
and train for seven weeks I'm moving in
right now obviously I'm just waiting for
this to come on
this weird that it printed out something
now it's going to crash I get oh wait no
we pry pristine okay
I said no key is forward let's go boy
[Laughter]
you gotta choose a direction man
this police have mouths on
oh my god he's it oh he's shaking stuck
in this parking lot haha
you got a reverse out of this situation
my dude
Oh
oh please don't murder this woman
i'ma just crash that oh is that a cop in
that company yeah he stole that car all
right Tesla self-drive right into that
oh you're right
yeah let's bash that little piece of
crap car better move yourself in other
words well we're gonna get arrested
this doesn't end well boys
I wish you could just keep freaking
moving I don't want to take away
breaking from him right into the frickin
wall so I mean like on the freeway you
don't have like a little jagged edges
like that for you to get stuck on for
the most part that's what it makes it a
good spot to start but obviously you
want to add something that can go to the
city and not crashing to random walls
I'd be great
says don't hit the frickin tree please
sorry everybody
look at him reversing oh he's getting
out of the situation not very well but
he's reversing now he's no alright
alright let's see
oh man go go go okay that's not where
you want to go all right that's enough
okay well I've seen what I need to see
there's definitely something there
probably needs more training more data
it didn't actually I mean it had such
wild accuracy numbers so it still hadn't
really fully generalized her you know so
as a way to go but I'm happy with what
I've seen so far even though that was
pretty bad at least was making choices
which is an improvement so I think
probably what I'm going to do is I'm
going to try to just apply maybe some
maybe some basic maybe some basic logic
to this or just like give it some more
training data maybe both
anyway that's all for now that's where
I'm at at the moment
it's basically the exact same thing as
before just a slightly larger Alex meant
let me pull up Alex and I real quick
just show you so it's the original Alex
net and then I made this Alex net Alex
meant to as a few more convolutions in
it has doubled the fully connected
layers the 4096 layers and then before
drop out was 50% I kind of I went ahead
and made that 7 yeah I was really
surprised actually I've never had
success with this 50% tropi I didn't
even realize it was that 50% before but
that actually you know it actually did
work pretty well for other models so
whatever but this one just was not
generalizing that's all it was not
learning anything
it's I changed it anyway so this one's
working it's a very large model a lot of
people were asking what am i running
this on this is on a tight neck so
basically 12 gigs of VRAM is weight
pretty much need to run this well or 12
gigs of ram I guess but it would take
you know a month probably or more to
train this on a cpu with Ram
anyway that's all for now I'm gonna keep
working on it hopefully get something a
little more useful so that actually
works I think first of all board data
I'd like to have at least five hundred
thousand data points right now I just
have a hundred and twelve I think
eventually so some people were also
asking about reinforcement learning is
this reinforcement learning all that no
it's not reinforcement already right now
and I don't think I'm going to apply any
reinforcement learning in the sense of
cue learning or something like that
instead what I what I would do is
reinforcement learning in the sense of
the training data itself will be
successful training data so
reinforcement learning that's basically
the whole point of it is it chooses the
best path whereas for us I think it's
probably better just to choose a path
and there's really no good way to
determine best path that I know of
personally in this exact example so
where reinforcement learning works is
where you actually have a game a single
score and like it doesn't have to be a
game but like you've got a single score
and basically something that has like
low variables variable low variable
types so something like where you can
win the game right and there's like only
one way to win the game whereas
something like with Grand Theft Auto and
running away from police you know we
could say okay the game is won when
you've evaded the police okay but then
you get the question of okay so how does
that work is it how quickly did you
evade the police so the quicker you
evade the police the better your score
is something like that
so I mean like they're there ways that
you could do it as you said with with
this and actually like self-driving cars
for example because my main objectives
actually slept on a car not evade police
I'm just trying to see if they can evade
a police so I don't know anyway you
could think about doing q-learning or
something like that but I don't think
it's the way forward here maybe I'm
wrong and if you want to do it go for it
but yeah my plan is basically take this
data run it until it's relatively
successful on the road and then make
another algorithm that determines are we
in a road are we moving how are we doing
and it would just kind of analyze what's
going on in game to determine if these
are good training data sets and then use
those training data sets to further
train the model and then that way it
trains itself over time it's sort of
reinforcement learning just not key
learning anyway um that's all for now
I'll update y'all whenever I finish
maybe add some more data to this one
hopefully drive a little better than we
did just now but yeah stay tuned I'll
keep cracking at it hopefully hopefully
the network doesn't need to get any
bigger because look we are clearly at
the limits okay that's all for now
questions coming below otherwise see us</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>