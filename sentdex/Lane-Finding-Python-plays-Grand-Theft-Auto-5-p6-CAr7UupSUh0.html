<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lane Finding - Python plays Grand Theft Auto 5 p.6 | Coder Coacher - Coaching Coders</title><meta content="Lane Finding - Python plays Grand Theft Auto 5 p.6 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lane Finding - Python plays Grand Theft Auto 5 p.6</b></h2><h5 class="post__date">2017-04-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CAr7UupSUh0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
another Python plays grand theft auto or
probably better called Harrison verse
Python plays grand theft auto so in the
last video I just wanted to make a quick
update before we continue along I kept
messing with ya for the heel lines
requirement I kept poking around and
nothing was changing and that was
driving me nuts
so then after I played around for a
while I literally changed this value to
like depth like a 15 million or some
something you qu can see and found that
oh my gosh is still doing the same thing
so then I went back and kind of looked
at docks and there's like a third
parameter here or third parameter
I don't know third-to-last Brainerd
anyway you can just just pass NP array
nothing now those parameters will make
sense so now I can run this and now it's
actually going to work hopefully that
would be unfortunate if it didn't so at
the moment we can see okay we're picking
up a lot of things um but if I tab over
and we modified mmm let me do this and
we modify actually move this over you
can see it let me close out of this okay
so now this was again this is minimum
line length so let's do like 100 and
then max gasps let's say five pull up
that and then this over clothes back
leave okay so as you can see we're
detecting a whole lot less interestingly
enough we're detecting like The Horizon
but okay so that's how we can for sure
tweak those values though at least I
wanted to show that because that was a
really weird inconsistency that I wasn't
able to figure out but I'm sure probably
on the previous video something's going
to be like yeah I just fixed it with
this but anyway just wanted to update
that
because I'm just been kind of recording
these in a row now on to the topic of
this video it is please save me that
okay so I I'm not going to run through
I'm not going to actually have this code
all the code I just wrote here because
it's it's just a huge rat's nest of a
message I don't even know how many lines
this is like too many freaking lines to
do what I wanted to do but first let me
just kind of illustrate what is
happening and then we'll we'll look into
it so let's see how long the frames take
to I actually haven't measured this so
this will be news to me
so let me run that real quick maybe
there goes this down so this one pulls
up kind of - I'll just do like this ish
okay and then play so this obviously
this is the original and then it should
draw lines on the screen and what it
least thinks are the best lanes
obviously picking those two Center ones
stuttering what a horrible demo notice
is becoming there we go it was doing
very well for me earlier anyway it's
doing all right it's not the best Lane
finder but it's you know it's good
enough so you can maybe throw in some
logic of like where if like maybe
they're too similar or something it's
ignored I also thought well in a
situation where maybe it only finds one
lane will just default to the other Lane
or something like that so there's a lot
of ways that we could maybe improve this
my thoughts for driving logic would be
if we detect two lanes detect them dang
it if we detected two lanes we could
just try to require the center of the
screen basically be as close to between
those two lanes at maybe this you can't
see you again but I like the 200 let's
say or let's say this is 0 0 so maybe a
400 mark try to be at the middle of
between the two lanes or something like
that that would kind of keep us in the
middle of the actual lane itself so
that's a possibility but yeah this is
clearly a huge
a huge problem it's not quite perfect
but there are ways like basically kind
of my thought was to use these not so
much to actually drive the car but to
when we have a high degree of confidence
ie we've got a one-lane over here and
one lane over here okay let's take the
measurement now and see what the AI is
doing we could actually train an AI
based on this being the kind of
supervisor of whether or not the AI is
doing good or bad now let's talk about
the actual code that I wrote because oh
and I forgot to do the frames per second
whoops it should be about the same what
is it yeah so actually we're like hmm I
don't know point 17 on average frames
per second so not the best not the worst
either 1/7 so almost 6 frames per second
not enough to play with but at a slow
speed in game we could still
theoretically drive also we just want to
record first and then we could use that
as training data and I actually think a
neural network passing information
especially like an online neural network
could actually probably do it pretty
darn fast but anyway let me pull up the
code just to show you real quick kind of
what I did and then I think we'll leave
with that again the good code will
repost it I encourage anybody somebody
please come up with a better method for
detecting things this is embarrassing so
basically what I did let me just see
about let me just make this about
fullscreen and then we'll kind of run
through it might be and it'd be too big
but it's ok so what I did was okay we
take the lines like the hue lines and
then we want to figure out what the
minimum Y is the minimum Y is actually
the you know the furthest up to the
horizon so this will find the lane up to
the horizon base there any line
basically just finds like the what's the
truly the highest point for any line and
we say okay we want to draw a line to
that point every time and then the max Y
is 600 because
that's the maximum why point basically
that we could have so that's like the
base of the screen then we have some
lines and a line big time actually yeah
we do use that and then here we're just
enumerated through we're doing this
interesting code basically the whole
point of this is to calculate the
definition of the line so we can get the
M and the B and all that and when we
have that we're storing that too I think
new lines actually yeah just a list and
then we're also storing it to a
dictionary I actually believe that we
don't use new lines anymore that was
part of an older attempt at this code by
the way you're welcome honestly for me
not running through all this code this
was this took me a long time way too
long it's embarrassing anyway I don't
actually think we're using new lines
anymore but we're actually using the
line dict
which stores the slope bias and then the
actual x and y values then we're going
to come down here and basically the
whole point here is to check basically
okay we're going to iterate through the
line dict the line for the line dict
we're going to check for the basically
first the slope because we want to find
lines with similar slopes because if you
recall there was like many many lines
over the lanes because of the edge
detection it detected a lot of edges at
least both lanes probably had two edges
right per Lane but many times it had
even more edges well especially once we
found the we did the line transformation
because we allowed for some gap but not
too much gap but then other lines would
be formed anyway we have multiple lines
per Lane and it just so happens that the
lanes tend to have the most lines
because that's where the most edges and
the most lines were found so I took that
and so long as the slope and the bias of
the two lines where we calculated the
actual line itself as long as those were
within 10% a plus minus 10% we're going
to say hey that's the same line so we
took that line stored it stored the
actual X&amp;amp;Y coordinates for like the
Earth's store the actual two point
coordinates that were
draw a line between and then by the end
of that we take an average of those
which is down here and that becomes Lane
Lane 1 in lane 2 and the ones that we
take are the two most common slopes so
the two most common slopes are the two
final lanes that we say hey these get
these have to be the law delaine's and
as you saw the main issue that we have
isn't actually the K it's not that the
two the two lanes are or the two lines
aren't the same lanes it was that
actually the same Lane was both lines so
maybe if we modified these values so
like maybe rather than 1.1 we could try
like 1.2 and then 0.8 and then again
here 0.2 whoa
and then actually way off screen but
anyway goes over here but 0.8 bring it
back so maybe that would save us I don't
know I'm curious I'll run it anyway at
the end of the day that returns two
lines that it believes to be the lanes
but we could throw further logic at that
and for the further requirements but let
me just add a curiosity oh I just want
to see because that was our main issue
is that the two lines were running over
each other so I just wonder if we added
a little more if we'd see more yes so
like if you scoot over far enough at
least it's not same other Lane but let's
see maybe that's a little better and
then of course we're losing the lanes
here so it's turn around
oops I'm too busy looking at the other
screen trying to play anyway and still
finding the two and it's unfortunate
because this is like a double stripe so
that's kind of hard I think it's even
harder but uh anyway yeah maybe mess
with those tolerances some more because
the two slopes should be very different
from each other and already I think
we've made a pretty good improvement
and if anything we could use logic where
because if we're to every time that it's
like both lanes on like one of the sides
every time we see two lines that are
that close to each other it's almost
like it's always because we've drifted
too far over so then we could come back
over and that always fixes it and again
we could do the same thing we can almost
force it so we could almost use that to
our advantage like if both lines or to
the left or to the right of us we would
know hey turn back this way and then if
untether Lane shows up you can use that
pretty positive signal I think that you
made the right choice so so I have some
ideas for future improvement for sure
and again yeah we're still about 15 16
point 15 to point 17 seconds per frame
and someone just crash up there anyway
or did someone rear-end me I don't know
anyway so yeah the definitely some some
things that we could do and I think it
is processing fast enough and I do
actually kind of like my if it's two
over there just scoot it over a little
bit that does seem to fix it
unfortunately the other problem is with
keyboard presses it still turns maybe to
sharp at a time so I'll have to look and
see if we can do also like some sort of
joy joystick input to like find the
inputs for that and me wait so that's
what I've got so far
I also have another idea though for how
we could train it come on guys I'm
talking here how we could train an AI to
actually play I'm going to hold that to
myself and see if that works but if it
does we might actually be able to leave
all of this in the behind us but I am
still kind of curious if using those two
lines I hadn't really thought of it
until I started recording but I had I
really do think you can use those two
lines and they pretty much always
detected lanes and when they didn't
detect the lanes or when they were on a
side it was always the case that you
just needed to move over a little bit so
I think that with that logic could
actually probably drive the car and
again at
the SCOOTER in this case and then again
we basically want to always make it so
the scooter is between the two lines
where they intersect at about I don't
know the nut is it not 300 probably five
or six hundred unknown and 400 600 me
the face and I don't think we get the
lanes at the base but prior around maybe
four maybe even three hundred pixels try
to put those lanes at the edges of the
image or rather put the middle of the
image in between those two lines
something like that want to think about
if anybody has again the code would be
on github if anybody has improvements
for finding the lanes and all that
please do share that this was some crazy
code also there's some like double like
for example this video is getting kind
of long so I'll cut it in a minute but
like right here we create this line
decked what we probably should do rather
than that because we are storing the MV
and all the coordinates and then we're
iterating through it again here and
doing the tolerance thing probably what
we should do is do this or rather do all
of this while we do this part there's
really no reason to separate those two
out that I can think of so that's one
fix that probably could be made and
would likely improve times I'm sure
there's a whole lot more this is just
way too much code for for what I'm
actually trying to do I'm just trying to
figure out where the lines the lanes are
it's got to be a better way so anyways
if you have one let me know I'm going to
work on that logic for the two lines and
then how to if they are too close to
each other basically if they have even
the same the same sign if their slope is
the same sign you've got a problem okay
so so I think just using just that I
think I can actually make this drive on
a you know one way stir I guess a
two-way street but you know one lane
both sides anyway
well last stuff to think about sorry for
the rough edges but I did warn you at
the beginning that this was how it was
going to go
also stay tuned for my secondary idea
for training an AI without even using
open CV at all otherwise if you have
questions comments concerns suggestions
whatever we've written below and I will
see you in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>