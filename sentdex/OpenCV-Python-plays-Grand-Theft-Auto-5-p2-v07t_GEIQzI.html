<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>OpenCV - Python plays Grand Theft Auto 5 p.2 | Coder Coacher - Coaching Coders</title><meta content="OpenCV - Python plays Grand Theft Auto 5 p.2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>OpenCV - Python plays Grand Theft Auto 5 p.2</b></h2><h5 class="post__date">2017-04-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/v07t_GEIQzI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everybody and welcome to yet
another Python plays a gta5 tutorial in
this tutorial what we're going to do is
just kind of build not the last one the
last one we proved that yes we can
actually stream this game to open CV
slash Python at a rate of about ten
frames a second also just in case that's
not you like for example if you're on
like a prodigal I don't know if you're
on any computer they can play GTA 5 I
feel like you should unless your
computer's horribly imbalanced have a
processor that can stream that image
back so so I'm playing grand theft auto
5 and then it's 800 by 600 so so that as
long as you have a computer that can
normally play grand theft auto 5 at full
screen on like high settings you should
probably a processor that can stream
grand theft auto 5 at like 10 frames a
second which to be honest it's actually
pretty impressive now that I'm like
thinking about it I'm almost positive
that all of OpenCV is actually on the
CPU so that the CPU can play just about
5 at 10 frames a second it's actually
kind of cool anyway yeah let's the next
thing that I want to cover here is okay
so we used open CV to actually we need
all we've done is actually used open CV
to we did convert the color but we also
are really just using it to show the
window so so we haven't really seen that
sure we could do some manipulations on
this and not sacrifice like five frames
a second okay so the next thing we need
to really test is whether or not we can
actually do open CV stuff on this data
so just in case you're not familiar you
don't have to go through this series but
if you want to reference some stuff with
open CV you can go to Python program
internet data analysis image and video
analysis and put a boom and then this is
just a bunch of stuff that we can do
with open CV this is just a bunch of
examples but if you want to kind of get
comfortable with doing things and
especially like masks and regions of
interest you might want to check out
check out open CV the tutorials anyway
so the first thing we're going
is just kind of do some typical
processing of the the actual screen that
we're pulling here so I think what I'll
do is eventually we'll get rid of this
print just because actually the act of
printing especially an idol is
especially over a long period of time is
going to negatively impact our frames a
second so you won't want to always have
that there is especially if you're
running an idle if you're running
through like a command prompt or
terminal or something like that it won't
be as impactful and you could leave it
there for like debugging purposes anyway
let's go ahead and do some real OpenCV
tasks so I'm going to define process
underscore image and then we'll pass
image into it and then we're just going
to say to you Reginald image equals
image so don't reason we're doing this
is and in fact we probably could just
leave it as image but I like the name
original image so it's clear but we are
kind of duplicating things ah I get
called this original image I could
change change that we can do a virtual
image like that then we're not copying
that image actually okay we'll do that
so we'll call it a regional image now
what we're going to say is processed
image so why are we doing this so
eventually what happens when you hit a
typical kind of workflow with OpenCV is
you have an original image and then you
dumb that image down crazy to like do
something like find edges or even more
dumb like in our case what we're going
to do is we're going to attempt to use
OpenCV to find lanes in a road so as you
do that you're going to simplify that
image so much so that eventually you
just have two lanes right but then what
we kind of want to be able to do is take
those two lanes and put them back on the
real original image so you always kind
of want to save the original image so
anyway original our process image now
will be C v2 dot converts color we want
to convert the color of original image
I'm pretty confident that doesn't happen
in place we're going to find out but
anyway hopefully it doesn't anyway see B
2 dot color
and then this will be VG are to gray
we're converting the curtain to gray
we're converting to Kray we're
converting to gray because we want to
have much simpler data so BGR is you
know it's it's a array of values from 0
to 255 right so it's three values per
pixel
whereas with gray gray is simply a you
know each pixel is a single value it's
obviously much simpler and we can feed
that directly through you know a
convolutional neural network or
something if it comes that initially
though my plan is to try to use open CV
and more like rules first before we try
to you know throw it you can't just
throw neural networks at things that's
not how it works so so so we really I'd
like some sort of way to determine
whether or not we are in a lane and even
if we're not a hundred percent like even
if we don't have a hundred percent
perfection at that what we can do is
every time we have two lanes that work
very confident or two lanes we can take
that data and save that data to later
train a neural network so anyway that's
why we're doing that the other option to
is to just play Grand Theft Auto for
like a few hours especially like we just
drive the same road over and over and
then take the image data and then the
input that we made as we drove that road
and train a neural network off that
that's possible to do and in fact just
recently I saw an video released a thing
where you can actually do that like
Nvidia will log basically what you've
done and then you can train a model to
play the game like you play it so I'm
very curious about that I wonder how
much training data it really takes but
interesting concepts so anyway back to
what we're doing
process image so we converted it to gray
now what we're going to go ahead and do
is just do like some typical canny edge
detection so we can say we're going to
just keep the process and
process image equals CB to canny and
here we pass the process underscore
image and then you have two thresholds
so we'll say threshold 1 equals 200 and
then fresh old 2 equals 300 you can
tweak these numbers probably a lot it's
going to depend on the game a lot will
depend on just so many things so this
will be tweakable for sure now let's go
ahead and return the process underscore
image and now what we're going to do is
under screen will keep we'll keep that
happening in fact under screen will do
this so we're going to say now new
screen equals process image original
image and then now rather than showing
the original screen this one will just
comment this out eventually we are going
to show pretty much the original screen
with some new things drawn on it so I
want to keep that there but for now
we're actually just going to do CV to
damn show and we'll call this I don't
know well we can call this window and
let's just call this window to before we
forget window and then see v2 dot
actually we don't need to convert
anything let's just do a new screen cool
all right
let's save that and let's run that and
see how we're doing
up to this point move this out these
screen processed image original image
note we need to process screen there
again beautiful so here we have the edge
detection so this is a little
unfortunate I wish I could make this
just for why this is so big maybe we'll
have to resize this to 8 I guess
eight-six
what's happening is my monitor is a 4k
monitor so this this is real 800 by 600
this I'm sorry this is a scaled 800 by
600 to like the
the monitor does auto-scaling oh dear
what have I done come back oh we've been
trolled by windows shake let me pull up
the script again there we go
and again actually we're still seeing
ten frames a second which is actually
really exciting for me I'm very glad
that we're still hitting that anyway we
have edges beautiful beautiful
can you imagine playing GTA just with
edge detection ah that would be pretty
brutal but yeah we still are operating a
really good frames a second so very cool
very cool now the last thing that we
need to do is the things that I kind of
put off initially and again I've already
I know the solution right and that is
sending input to the game</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>