<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Scikit Learn Machine Learning Tutorial for investing with Python p. 20 | Coder Coacher - Coaching Coders</title><meta content="Scikit Learn Machine Learning Tutorial for investing with Python p. 20 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Scikit Learn Machine Learning Tutorial for investing with Python p. 20</b></h2><h5 class="post__date">2015-01-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2CxQsBzigKY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everybody what is going on welcome to
the 20th scikit-learn with python for
machine learning with our an investing
example tutorial video in this video
what we're gonna be doing is building a
back testing kind of functionality to
our machine learning testing so
generally with machine learning testing
you know you think of it as you train
then you test and in your answer from
your test is your accuracy or how good
that algorithm worked for you but with
investing that's not really the case you
need to know your performance so the
accuracy is one thing but as we brought
up in the previous video
accuracy is only one little bit of
investing or trading in the stock market
accuracy matters but so does performance
so just because you're 80% accurate it
does not mean you're a profitable trader
even though most people tend to kind of
value in general accuracy although most
most firms and stuff tend to value
performance maybe even too much without
calculating and risk so that's another
topic entirely you know this strategy is
I would say fairly low risk but we need
to calculate risk and actually do a true
risk assessment of the strategy to kind
of see how secure the strategy really is
because you always have to account for
risk and actually probably most people
pay more too much attention to accuracy
too little attention to the actual
performance of accuracy and even less
attention to risk like a lot of people
just don't care about risk high risk
high yield is like the most popular form
of trading for the amateur and yet the
amateur almost always loses so it's kind
of strange how people like to ignore
risk but anyway so in this strategy
however there's not too much risk or at
least not too much inherent risks that I
see but anyways let's make this back
tester nobody yapping so basically we
only need one thing here we're just
gonna import statistics and we're
importing statistics to get a quick
average and that's pretty much it so now
in the build dataset
currently we return an x and a y I'd
like us to also return
Z variable and the Z variable is going
to equal the number a conversion of data
oops
data underscore DF and then within here
to specify two columns what you do is
say like normally - it's best by a
column you can specify the status column
by doing this but in pandas you can
specify multiple columns by within this
kind of you know indicee question you
add another set of square brackets and
now you can add basically a list of
columns and the list that we want to
stock underscore P underscore change and
we also want sp500 underscore P
underscore change so we can take this
percentage change because really what
we're concerned we don't really care
what the prices were at all actually we
just care about percentage change
because we're basically gonna say we
invest ten thousand into the market or
we invest in thousand the stock what's
the percentage change how did we do so
those are the only two values that we
actually care for so we're gonna take
that and then at the end of this we
return also a Z variable so we're
returning an X a Y and a Z so we need
now to basically unpack all of this data
so we come down to our analysis where we
call X Y so now we're going to call Z
and that's that there and then now what
we want to do is for X and range here
first we asked if CLF predict is the
case where this is our correction so our
accuracy calculation cool now we need
another if statement and this statement
is going to be if if it's a 1 right if
the stock value is a 1 ie we are
predicting out performance then we want
to make an investment right period so
what we would do then is if CL f dot
predict mmm basically this right here so
we can pretty much just copy this whole
line paste not the whole line sorry
so if CL f dot predict that 0th element
basically if that prediction is that
it's
one I in our performance what do we want
to do well we would like to make an
investment so now in fact we need to add
a few starting parameters here so test
sizes a thousand that's fine we're also
going to add invest underscore amount
and this will be the amount that we
invest each time we'll just put ten
thousand you can put a hundred you give
it a thousand you do whatever you want
we're going to put ten thousand then
we're going to account for total invests
and that's going to just be the total
amount of times you know total amount of
trades that we make later on we can
multiply this by trade cost or something
like that and subtract that from our
earnings so anyway so I'm invest also
this we're gonna have an if market and
that's going to be equal zero and then
if strat and that will be equal to 0 and
this will be calculating whether or not
basically if market is going to
calculate if we took all like cuz we're
gonna have to calculate both what was
the return on investment if we did if we
just bought like the S&amp;amp;P 500 index so
you can buy like the spy right you can
buy that and that's an ETF for the S&amp;amp;P
500 so you'll see the same performance
so you can buy that if you invested in
the market or we're gonna calculate how
much money you have at the end if you
invested with the strategy so that's
that now we are gonna come down here
back to our prediction basically and
we're gonna say the following we're
gonna do invest underscore return return
the investment return is going to equal
the whatever the investment amount was
so that's the starting amount plus the
percentage change times the investment
amount so it would be you know ten
thousand let's say plus what was the
invest underscore amount times and this
will be the Z of the negative x right
because we're working with negative x
here cuz we're moving back those
elements so z man I'm kind of lost now
how long
okay yeah Z the negative X of 0 if
element and then divided by 100 okay so
that is basically the Z minus x0 that
means that if let's go up to the very
top here the zeroth element right of
that Z of the negative x into see I have
a really hard time explaining this so
this is obviously a list a list right
there so actually an array of arrays but
anyways or just in a right moving on so
this is so Z has stock price and then SP
500 so when we do minus X that's the
specific one and then that gives us
basically one example of this and this
so 0th element will be the percentage
change of the stock and the first
element will be the S&amp;amp;P 500's you know
the markets change so the investment
return will be this number and then
basically we can take the same line
pretty much and we'll call market return
market return it'll be the investment
amount plus the investment amount of the
Z the X minus X bar and then the first
if version of that for the market and
that's that next we're going to say
total underscore invests plus equals 1
and then we're going to say the if
market investment and then we're going
to say plus equals the market return and
then the if score strat it was if strat
right if strap plus C equals invest
return ok so that's that that all looks
fine and dandy so we'll come down here
and we've got accuracy that's totally
fine and now we're gonna go ahead and
print some of the statistics so I get
some coffee ok so some of our statistics
we're gonna have total traits so we'll
say total trades and the total amount of
trades will be total invests then we're
going to go ahead and say with the
ending
are so ending with strategy will do if
strat like that let's do a : here and
then we're going to just copy and paste
this market heard this line rather and
replace strategy with market and then if
the market okay so those are our ending
values and then now we want to go ahead
and do is do like a comparison so we'll
do is we'll say compared and that's
that's going to equal if underscore
strat - if underscore market so that's
the difference of the strategies
compared to the market so that's our
difference divided by if underscore
market I guess we could actually do if
strat there I guess we're comparing it
to the market so we'll do that if market
and then we basically in case all this
in parentheses and then x hard then what
we're going to do is we're just going to
print a compared to market we earn and
then we earn string compared plus
percent more actually that's not
necessary more then we're gonna come
down and we can actually take the
percentage of total like the total
percentage of all of our investments so
we can say average investment return and
mmm the original code I wrote for that
I'm not really actually happy with that
so for the average investment return I
what we would really need to do is we
need to say
you know we need like an if nothing
basically I'm not gonna touch that for
now actually because we do have that
compared to market so that's totally
fine
mostly that for that for now and we'll
come back to that because the Eric
originally my code was the mean of the
entire Z element that's not useful so
yeah so let's go ahead and save and run
this real quick let's see what we end up
with I can't matter if we're doing the
full one or not we're doing the full one
we should - no no no we'll check that
one next especially if we get in here
okay so had we invested in market were
being told that we would have actually
we would made basically 919 trades so
that would have given us nine point
seven million as opposed to ten point
six million that we would have made with
our 919 trades at ten thousand each
compared to the market we did nine
percent better that's quite nice now
let's go ahead I definitely I want to
add this now so we've got total invests
equals zero so what we'll end up doing
is we'll say yes do nothing do nothing
equals total invests times invest amount
so that would be like the total amount
of money we'd have had to be done
absolutely nothing at all and then what
we can do is do the following so we can
say average market return would be just
trying to make sure this makes sense
because otherwise
you should be fine right because we have
compared tomorrow yes average market
return would be a new mass scale divided
by the old times 100 so we would say new
if market - the old do nothing new
maciel divided by the old do nothing
times 100 let's add our parenthesis now
known as the old divided by the old
times 100
so that's average market return and then
we'll do a average and invest I'm not
sure what to call that average strat
that's what we should call it average
strat and then if stretched rat
so it's average market average strat and
then now we can say average investment
or term : a string avg strat plus
percent and then let's just copy and
paste this line average market return a
VJ market okay let me run this well
we'll change this to no not available
for now just in case we do throw an
error a little quicker to develop with
this one okay so the average market
return that's good twelve point nine we
know that to be the case so had we took
taken our money and invested into the
market over the course of you know ten
years each return would average out to
twelve point nine which again that's
right in line with what the markets
returns are so that's good good to see
and the average investment return is
nineteen point four and we can see that
our meat like our difference here is
five point seven so that's good and we
can see that although this well this
time around we had no no not available
data so let's throw it with the non
available data
actually let's run let's run a couple of
tests clean here with no not available
I'm just gonna run let's just run a few
so we're seeing that we're hovering
around six ish percent although that was
a seven point two with more traits
interesting six eleven and six seven so
I don't know like six point five ish I
don't know somewhere around there is our
average without using not available data
and then now let's thrown with yeah not
available data so bring this over just
might be a while okay so we've got a
seven point two with or not available
data or simple
sorry heading to the wrong value six
point seven there was a look last time
uh man we killed the market now
apparently what is it is this art this
is with are not available data claiming
the average market return is an eight or
seven point nine five which I don't
think is the case be interesting pretty
sure of the market and on average over
the last decade would be twelve twelve
percent have to look
let's do one more waiting on this last
one okay so our average investment
return however is generally about
eighteen ish percent we did get a 14 on
the first one but we're seeing you know
18 17 18 stuff like that so so whether
or not we're using with na or no na
we're seeing you know significant around
seven ish out performance of the market
so so what now there's a lot of other
things that we have to account for the
probably the most massive thing that
we're not accounting for here it's not
trade cost it's it's not anything but
the fact is that you see here we have
itchy eyes that's what you're forgetting
no I don't feel like coating it right
now but the the total amount of stocks
that we're trading on is about 340
companies we started with about 500 and
because of you know whatever happened
along the way there the original dataset
didn't have it and then we didn't have
stocks like Toyota for example we
couldn't get stock prices on Toyota for
some reason that kind of stuff we slowly
throughout this entire process have kind
of whittled out the companies so the
next thing we really want to be able to
do is do the entire say Russell 3000 of
companies using this exact same
structure and see what we can find so
this information might be available on
quantal so all these kind of data sets
and maybe a paid data set another thing
that we can do is we can look through
Edgar on the SEC website there is an API
so I'll probably play with that in one
of these videos eventually so we have
all kinds of options now for kind of
expanding this because are getting back
to my original point our biggest problem
is to acquire this data set it was this
data set is based on the companies in
the S&amp;amp;P 500 in the year 2013
and then what we did was we did a back
poll of historical data from Yahoo based
on those companies that were still alive
in 2013 the problem is that any company
that was alive and say 2002 or at least
was within the sp500 in 2002 is not
being included right and and there's
only two ways that you would exit the
S&amp;amp;P 500 or there's only there's really
only one reason you would exit the S&amp;amp;P
500 actually I guess there's two all
right
one is you go private okay so you just
buy out and you go private or to you you
tanked right you your price Falls enough
to you while your market cap kicks you
out of the S&amp;amp;P 500 and so that's not
very good so a lot of the companies that
exit the S&amp;amp;P 500 are underperforming
companies so we've probably knocked out
already before we even begin this test
we've knocked out a lot of the
underperforming S&amp;amp;P 500 companies and
the problem is we've knocked them out
but the S&amp;amp;P 500 index has not okay so as
that company leaves another lesser
company comes in to take its place but
bottom line that was a lesser company at
one point and now it's kind of
performing well or what not but but as
that as the company that gets kicked out
of the sp500 begins to fail it's
actually dragging down the S&amp;amp;P 500
we're not accounting for that we're only
testing see like we're testing against
and some people I'm hunter which is
impacted by these bad companies that
went out but we're not actually trading
against those companies so that's a
problem so really what you'd want to do
is maybe every year or every quarter
reassess what companies are actually in
the S&amp;amp;P 500 get the stats on those and
see like would we have invested in those
because ideally you know if they get
bought out who cares right that's that's
totally fine if we had invest in that
company that get bought out we don't
really mind about that but if if say
what we want to know is whether or not
we would have invested into a failure so
let's say a company goes bankrupt stock
goes to zero or let's just say the
company makes really you know some bad
choices whatever and the stock
significantly declines okay so
you know did we invest in blackberry
okay so so the question of the questions
that we have to ask ourselves and we
this has not really hit those those
serious questions so you have to account
for that so yes our performance here is
actually really good
and that's exciting it really is
especially considering the very basic
day set that we're accessing here but
you do have to understand that I
wouldn't necessarily suggest you go out
and use this strategy actually I would
definitely suggest you don't please do
not blame me for your losses but it's
exciting to see these kind of results
and there's no doubt in my mind that you
can use machine learning to help you
invest it's going to be less biased than
you are that's for sure and I'm always a
fan of buying hold anyway so I like this
strategy it's kind of a neat neat
strategy so anyways moving forward the
things that we kind of can can think
about is with this strategy we've
basically built this strategy around
what around Yahoo Finance so what could
we do now well we could parse Yahoo
Finance from here and using our trains
data we could parse the sp500 of stocks
on Yahoo Finance right now and we could
get returned a list of companies that
are currently marked for outperformance
so we could do that and we could find
out right now of course you'd want to
check for not only is it because
basically want to get that company right
when it's marked for outperformance not
every step of the way but of course for
us we are kind of doing that even in our
script every step of the way if it's
still an outperforming stock in the next
you know year or five months that we
reassess it we're gonna buy more so
anyway that's what's happening in the
backtest anyways but but yeah we can
convert this script to now scan Yahoo
you could do it say every day every
month whatever in scan Yahoo and find
your your new investments and really you
could scan Yahoo and save that data so
you can use it in your testing after a
year has gone by and stuff like that so
anyways that's it for now if you guys
have any questions or comments on this
video please feel free to let me know
otherwise as always thanks for watching
thanks for all the support of
subscriptions and their donations and
until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>