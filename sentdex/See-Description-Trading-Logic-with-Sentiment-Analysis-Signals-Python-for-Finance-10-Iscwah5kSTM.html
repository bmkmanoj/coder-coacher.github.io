<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[See Description] Trading Logic with Sentiment Analysis Signals - Python for Finance 10 | Coder Coacher - Coaching Coders</title><meta content="[See Description] Trading Logic with Sentiment Analysis Signals - Python for Finance 10 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[See Description] Trading Logic with Sentiment Analysis Signals - Python for Finance 10</b></h2><h5 class="post__date">2015-07-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Iscwah5kSTM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
part 10 of our Python for Finance using
quanto beam and zipline tutorial in this
tutorial we're going to continue
building on the last one and the last
one I cut it off before we actually spit
out the data frame output here of the D
F dot head just want to show that it
actually came through if yours isn't
coming through then you'll want to maybe
post a question or figure out why it's
not going through
anyway up to this point we are
successfully fetching the CSV we can see
it here great now what we want to do is
you know continue building the logic of
our actually will finish the initialize
method here and then start building the
logic to trade based on these sentiment
signals from send X so it's a carry on
what we need to do next is define our
universe of companies basically that
we're willing to invest in so context
dot stocks equals symbols and now we
need this the symbols that were willing
to trade well syntax tracks over 600
different symbols okay so for stocks
anyways so we can't do them all because
again quanto peon has a maximum limit of
255 so at least at the time of me making
this hopefully they'll explain that at
some point but anyways the max is 255 so
what I went ahead and did is within the
API you can reference API slash finance
slash sentiment signals - or slash top
200 I'll put a link again in the
description if I forget remind me I'll
slap it in there so anyways these are
the top 200 and again like Google's not
in here because they've changed to goog
L and there's a couple others that just
weren't found for some reason not quite
sure why but anyway that's that so let's
take this list and we'll just copy that
move this over and in symbols paste now
we have our context or our stock symbols
so once we've got that we're done with
the initialize and we're ready to
actually start building our handle data
so now what we'll do is instead of
passing let's go ahead and make some
space now we want to go ahead and do is
first
handle data basically for every bar we
want to reference the cache so we're
gonna say cash equals context portfolio
dot cash oops not capital used cash okay
then what we want to do is we want to
reference the stuff in our data so our
data frame basically want to say like
what is the what's the current sentiment
signal for that company right so what
we're gonna do is we're gonna use a just
a big for loop but first let's let's
some case everything and try and except
just to be safe to try except exception
as II and then we'll just print string e
print or log its if you print it'll
still come to the console just fine so
try and then what we're gonna do is
we're gonna say for s in data so again
you've got context and you have data
data is possibilities context is like
all the stuff that we have right now
so for s in data what we want to do is
we're gonna say if and then we're gonna
say if sentiment underscore signal in
data s so what's happening here
basically what's happening is if there
exists obviously this one is a little
off-center because it starts with
preview in info but if there is a signal
for the company at that point using the
CSV fetcher in the way that we did it it
will just it will add the sentiment
signal at the time to that company so if
in data s which is basic it comes out as
like a Python dictionary so if there is
a key of sentiment signal in that
dictionary of data s for an S as those
stocks what do we want to do well we're
gonna say this sentiment value is equal
to data s and then we want to grab that
sentiment signal okay that's that then
we also want to know what's the current
position are we do we have a position in
this company and all that kind of stuff
so we're gonna say current underscore
position is equal to con
TxDOT portfolio dots positions and the
positions for what s and then we just do
dot amount and that just tells us how
many positions we have in that company
just for the record someone can correct
me if I'm wrong but from my findings
positions accounts for both investments
and shorting so even if you're shorting
say you're shorting 10 shares of a
company it doesn't come through as
negative 10 positions it's 10 positions
so keep that in mind
it'd be kind of nice if it was like
negative 10 I don't know but anyway cuz
when you short a company you almost like
don't have a position you've got a
position in money right instead of the
company so anyway maybe I'm wrong but
I'm almost positive that it gives that
like the amount when you're shorting the
company it's like a still absolute value
anyway
current position there's that now what
we're gonna say is we're gonna create
some logic for investing now for me
let's just keep it really really simple
you could take the sentiment value so
there's a huge there's a large array
right like a company can be anything
from a six to a negative three so you
know anything above zero is in theory
maybe good to invest in or so maybe you
would only want to invest like one
percent of your portfolio in a company
and then you would like stagger it or
something but for now we're going to
keep it super friggin simple and we're
gonna say if if the and then we're going
to say if sentiment sentiment is greater
than five ie if sentiment is a six what
we want to do well if that's the case
and and current underscore position is
equal to zero so if the salmon is really
great and we don't have a position in
that company let's get it so then we're
gonna say let's get it but before we get
a company we need to assess our cash
because at least for now we're not gonna
take on any leverage now it can amplify
things and in reality a lot of people
are taking in leverage so feel free to
change that if you'd like but for now
we're not going to take in leverage so
we're gonna have here if
is greater than the context dot
investment sighs so that's right here
so if cash is more than context on
investment underscore size so if we have
the money to make the investment that we
want to make we're gonna say okay great
we're gonna order underscore value and
the value that we're gonna do we're
gonna order the S the company and then
we're gonna say the value is context
investment underscore size so if you
haven't noticed by now I've been trying
to like show you all of the variations
of how you can possibly order a company
so in here order value is where you can
specify the stock and then the amount of
money you'd like to invest in that stock
and what its gonna do is it's gonna
round down to the nearest whole share
right that you can afford so kind of a
cool little function there so order
value context out investment size and
then we're gonna also have a stop here
so we're gonna say style equals stop
order and then this will be context dot
stop underscore loss underscore percent
like that and it needs to be let me see
here stop so that times the price so to
be that times the current price of the
stock so we will need to add that to so
we'll say current current underscore
price equals data s dot price times and
then current underscore price okay so
we'll order that value and then we're
gonna go ahead and do a cash minus
equals context daunt investment
underscore size and again from my
findings quant opium won't automatic for
every stock so like throughout this for
loop the cash stays the same so I
suppose you could throw cash like down
here
and maybe that will fix it I don't think
it will if I recall right it doesn't fix
it
cash will stay the same so like the
value of portfolio cash is what we're
actually referencing here and that
doesn't get updated until handle data is
fully complete now I haven't seen the
quanto peon backend code maybe I'm wrong
but from what I've seen looking through
the logs you're not actually losing any
money out of this this what results from
this until handle data refreshes so
until that as long as that's the case
you're gonna want to just manually
subtract from cash because otherwise
you're gonna you're gonna have trouble
so what I ended up doing here is I take
this I put it here instead of redefining
cash every time we say at the start of
this bar before we start running through
the stocks our cash is this and then we
subtract from that every time we make an
order and that's my way of ensuring that
that money is being taken away because
again it's really easy on klonopin to
like put way more money in companies
then you're trying to so that's what
we'll go ahead and do so if if all that
is the case they're great and then what
we'll do here is so that's our sentiment
for investing and then what we want to
do is we wanna be able to get out of the
company too so that's how we get into
the company but what if we need to get
out so we can also have L if L ifs
sentiment is less than or equal to and
for now we'll just use negative 2 maybe
I don't know we will just do these
streams for now but you might want to
actually get out of a company easier
than you're willing to get into a
company so we'll go with negative 2 for
now let's go with negative 1 so if
that's the case and current position
current underscore position is greater
than 0 so if all that is the case we
have more than you know a position in it
basically what do we want to do well
we're gonna do order honor score target
I believe we've already covered order
target but s0 and close so order target
we want to order that
stocks our target is Deb's zero so we'll
be selling all of our shares okay
so barring any massive mistake here
starting at let's see quant so P incent
X so our data starts on the 20th of
October so 10 20 and then 2012 and then
we run all the way to I think the 15th
so we'll do that daily data that's fine
we can run a fullback test now so
hopefully we won't get an error we'll
see we could totally have like a syntax
error or something like that up to this
point so we don't really run this code I
don't think except for the fetcher I
guess but our logic hasn't been run so
while we're waiting on that obviously
you can because the sent acts like the
signals that we get from syntax they
vary so greatly that you could you could
really make that strategy a lot more
complex if you wanted but for now we're
just gonna do it pretty simply this way
and then after we're done here in the
next tutorial what we'll cover is
including shorting of a company so say
the sentiment is less than you know
negative 3 or some is negative 3
let's say then we're gonna be willing to
short that company and then if it goes
up to you know a certain value then
we're gonna be willing to get out of
that short okay so we're running now we
can see that we're following the market
pretty pretty substantially so no
surprise our beta is pretty close to 1
now it's perfect 1 but we are at least
up to this point outperforming the
market got good total returns our Sharpe
ratio is very very attractive their
drawdown so far is is very nice but
again you know we're only we're trading
from 2012 right so this isn't you know
the longest back test that we could do
is just unfortunately syntax doesn't
have data older than October 20th
I did try to like historically pull data
from articles and stuff but that was
just it was really messy and it wasn't
going to be very accurate so anyway here
we can see our daily returns and all
that we can see where we're buying and
selling companies and stuff so this is
really one of our most actively traded
strategies up to this point we've got a
lot of buys and sells pretty common
you know but there's definitely times
where we don't really do much at all or
we make very small moves and stuff
anyway we're almost done here I wanted
to go ahead and run it for sure on
camera just because every time we write
code it's really important then we make
sure it actually runs so everyone isn't
like stuck or something but anyway so
we've got total returns of 83.9 as
opposed to the market's 52.6 so we we
did quite well actually with this
strategy now again we're only testing
really three years worth of data so it's
important to kind of understand that and
actually less than three so it's
important to understand that we're we're
not including so this is basically from
from 2012 to to now you can look at the
S&amp;amp;P 500 it's been mostly trending
upwards not much down fall now this
strategy because we're not actually
shorting anything would probably do very
poorly in a decline hopefully we would
choose companies that declined less than
others because the sentiment was better
for them and clearly we're making those
choices pretty well because we are
performing quite quite well compared to
the market basically throughout the
entire backtest so that's nice nice to
see that anyway so so in the next
tutorial what we'll do is we'll
incorporate shorting into this strategy
but anyway so far pretty good Sharpe
ratio not bad to be nice to see it over
to but really as close to two as it is
that's pretty good
not too much volatility drawdown is okay
but beta is pretty high because it's
obviously so closely tied this is mostly
a buy and hold kind of strategy anyways
but regardless beat the market did good
so that's exciting so in the next
tutorial we're gonna be talking about is
adding a short here and then maybe after
that we'll be talking about you know
converting this like a minute strategy
or something like that so anyways if you
have questions your comments up to this
point feel free to leave them below
otherwise as always thanks for watching
thanks for all the support and
subscriptions until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>