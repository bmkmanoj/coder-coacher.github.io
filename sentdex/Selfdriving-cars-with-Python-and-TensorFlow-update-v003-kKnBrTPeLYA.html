<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Self-driving cars with Python and TensorFlow update v0.03 | Coder Coacher - Coaching Coders</title><meta content="Self-driving cars with Python and TensorFlow update v0.03 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Self-driving cars with Python and TensorFlow update v0.03</b></h2><h5 class="post__date">2017-06-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kKnBrTPeLYA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
an update to the self-driving cars in
Python tutorial series in this video I'm
going to be giving you an update what's
been happening what changed between
version 0.02 and 0.03 what's going on
for the future and all of that also in
the last video a few people were asking
like hey where was the demo there's a
24/7 live demo anytime you want to see
it go to twitch.tv slash syntax that's
been going on for like two months now so
if you're just somehow landing on this
and you don't know about that now you do
so anyway if you want to see a demo go
there now I will show a couple videos
from here but yeah the live demos is
much more realistic to what we're where
the project is so that's why I really
wanted to do the live demo because it
was 100% proof of where the project is
it's too easy as a creator to show your
your projects best rather than the
reality a 24/7 live demo shows you
exactly what's going on so anyway I'm
always skeptical when I see like short
videos of things so version 0.03 what
are the main changes so the main change
that people know about would be the 480
by 270 versus 160 by 90 resolution so
this is kind of for a few things one is
just to see how big of a resolution can
we get to and if does it help and then
also I really wanted to be able to to
get the neural network to at least have
the opportunity to see the mini-map so
so that's kind of what I wanted to do
here and sure enough at 480 by 270
everything's totally clear arguably you
you probably could have a model that
would read that mini-map as well but 480
by 270 has a higher higher chance so so
that's the first kind of major change
but actually in my to me the biggest
change is the ability to definitely read
the mini-map plus be able to follow and
learn from waypoints following data
which then gives me the ability to
introduce automated learning
reinforcement learning
stuff because you know the game world of
grand theft auto is very very
challenging so you know if this was just
like one of those simple flash games on
say open AI universe or something like
that those are very easy to learn you
can run many iterations right out of the
gate and you can train a model
relatively quickly on a decent GPU
whereas with Grand Theft Auto there's so
many more variables like we grant that
out of there's different color roads
on-road off-road is different colors
some of the on roads or the exact same
color as being off-road there's
day/night rain fog police other vehicles
all this kind of stuff and while you
could simplify the challenge to be
successful I don't see any reward in
that right like why would we simplify
the challenge just so we can solve it
that's the wrong way to approach a
problem instead let's let's actually try
to solve hard problems and and that's
why I'm here in Grand Theft Auto
specifically this is a really hard
problem I don't think anybody's ever
solved this problem doing a pure visual
convolutional neural net or just pure
neural network on driving data like this
no-one's done that right lots of people
have solved open a eyes like flash games
it's not exciting anymore so anyway
that's that I don't plan to dumb down
the problem so some of the kind of main
change and then with reinforcement
learning kind of opens the door to
continue on but one of the problems with
this is with grand theft auto makes a
hard challenge but also a realistic
challenge is we can't run a bunch of
iterations of grand theft auto I mean if
you were really really wealthy you could
have like a huge server that was just
doing like 100 or a thousand iterations
of grand theft auto or if you may be
eliminated actually rendering the
graphics to a screen that's always a
huge huge costly thing to do and my
guess is that's what open I was doing
initially with grand theft auto 5 but
they stopped that so that's one thing
you know you could maybe get it quick
but no matter what you're going to be
it's going to be
hard to run many iterations so with
reinforcement learning with something
like that where you can only want one at
a time at least with what I know you
really want to use you know generative
algorithm evolutionary algorithms
generative powder definitely I want to
use a generative algorithm I could think
of a few ways you could do it but it
would not be ideal anyway illusionary
algorithms you know you you wouldn't
want to use that to get to the point of
being a good driver you PI want to start
as a good driver and then use
reinforcement learning to make a great
driver rather than trying to start from
scratch I mean that would just take
years or decades probably with Grand
Theft Auto so it leaves with a single
let's say a 1080 Ti so anyway that's
still a little unclear but I think that
we start with a good driver we can use
reinforcement learning to much more to
quickly just kind of create a great
driver that's kind of my plan going
forward with reinforcement learning in
these waypoint data moving along to the
actual model I started using Google's
inception just kind of vanilla v3 model
that's what we use for version 0.02 it
worked out pretty well it took a long
time to train but it worked out with
this one with the increased resolution
literally being the only change and I
suppose Waypoint data I should make
clear about 10% of the training data was
Waypoint following data the other thing
that's important I think about Waypoint
following is it gives the driver a
reason to take a turn historically the
AI has really had no aim no objective no
reason to take a turn therefore
basically all he did was go as fast as
possible in a straight line to kind of
avoiding obstacles until he hit
something so hard that his course was
readjusted um I you know it's fun to
watch but I grew tired of that it was
not impressive so so yeah now anyway
back down to here I tried to use just
the vanilla v3 which worked in 0.02
didn't work in 0.03 it started off going
pretty well like within I don't think
the time on on this one but within
relatively shorter we were already at
like 22 percent accuracy which very good
well good for a short period of time but
then it started to plateau so this is
later on in the model at step you know
for TK 50 k 6k it just kind of flattened
out and loss was still slowly slowly
going down but then accuracy itself was
pretty much flatlined for many many
hours this is our one-two-three-four 79
so basically over not the course of nine
hours we just kind of flatlined
so that signal to me I mean we could
have continued for sure but it seemed
like something was probably wrong like
these are just not been metrics you'd be
seeing a successful model so I thought
let's go ahead and look further so the
first thing I did was decrease the
learning rate so if you do find yourself
plateauing one thing you can do is
decrease the learning rate or you could
just start off right out of the gate
with a decaying learning rate every you
know few iterations you can slowly
subtract from the learning rate and
after it comes decaying the learning
rate I was able to actually get accuracy
up to 45% which is a huge I mean that's
pretty big when you're leveling out at
about 28 you just lower the learning
rate BAM 45 I mean that was impressive
but still 45 not good enough so just to
be clear there's nine output options so
in theory eleven point eleven percent
would be random so 45 is much better
than random and to get that huge
improvement was nice but then as you can
see we actually start to come down so
okay so then I decided to start
modifying Inception v3 and this is the
model I ended up with I went through
quite a few iterations but basically in
my my theory going into it was
look I know Inception v3 works because
I've done it right on this exact same
data
maybe not the Waypoint data but the
other data maybe the Waypoint was enough
to throw the whole thing out but I
didn't think that was going to be the
case so I started you know basically
logically think about this well the only
change is the input layer it's just much
much bigger so
and inception v3 was trained on like the
32 by 32 images and I'm asking it to
read 10 times that right there well more
than 10 times but basically wha 480 by
270 verses 32 by 32 so huge difference
so in theory you probably could you know
logically say hey well just take the con
that initial convolution layer and
increase that window size just make that
window much much larger that one window
and then boom you'd be done I honestly
can't remember I think I went back and I
did try that and then I compared it to
this model here and I didn't find that
that was actually better I ended up
tweaking quite a few things but all my
tweaks are contained in this little
chunk here and I don't think I can't
remember I think yeah I think all
basically this entire chunk has changes
you can feel free to compare them I just
I called this one other section but so
very much Google's inception everything
after that is pretty much the same is
the same unless I'm mistaken I don't
think I changed anything else coming
down to training once I made that change
and my nose is so neat I made that
change and I was able to get the model
to 80% relatively short or 200k and this
was actually I think really actually
over the course of 48 or 72 hours and
after that point I was like I was so
tired of training models because while I
showed these pictures there was so much
more along the way I mean it was I think
this was like maybe two weeks total or
three weeks of just trying models
failing trying models failing so that
was very frustrating so at this point I
was like okay I'm done okay push the
model and see how it does so I pushed
the model saw how it did and again about
10% of the training day that was
Waypoint data arguably that is one of
the problems I will talk about that in a
moment
oh the other thing I want to bring up is
aside from adjusting the learning rate
to effect you know getting higher
accuracy
I found that increasing the batch size
was huge and it only makes sense I mean
because basically you're going to be
adjusting you know ideally it'd be great
if you could take all your data and
shove it through the neural network at
the exact same time but in today's
world we generally can't have a network
big enough or rather the GPU big enough
to take all that data so initially I was
working always with 250 megabytes of
data which in the past allowed me to
have about 10,000 samples but when you
increase the resolution that increases
data size significantly so I was
starting off with actually 500 samples
per batch that was a problem that did
get us to about 45 percent accuracy
though just to remind you but then I was
like let's try a bigger batch let's do
2k that improved things and I had tried
4k that improved things I said 10 K
let's go back to the 10 K batch size and
that really really helped now
unfortunately 10 K samples of 480 by 270
is about somewhere between 3 &amp;amp; 5
gigabytes just kind of depending so
those are pretty big you know try to
stuff through in a single batch but it
worked out and that that helped a ton so
the batch size is a really big deal
actually so then to the results so the
Waypoint following initially a version
0.03 there was version 0.03 and then
there was with the Waypoint data so so
basically this was after the first kind
of version of 0.2 says release candidate
to basically so this had a little bit
more focused on Waypoint data but the
whole kind of point of 0.03 was just to
see will it fall away points the answer
of course is yes otherwise it would be
making this video so anyways as you can
see he's got the Waypoint there I think
it's pretty clear on video so yeah he's
just clearly trying to follow the
waypoints I'm pretty sure at least in
this one I think he hits a lot of yeah
so you think she slams through that car
it's almost like he's like staring at
the waypoint data so he's not as good at
avoiding things but then again I as I've
seen this and I go back and compare him
to like the actual version zero point
zero zero point zero one but I also
think he's actually better than 0.02 and
for sure at night time he's like way
better in the day he's he's okay but
anyway you know he very clearly follows
the waypoint data and this is
just again it gives him like an
objective to go for it and a reason to
take a turn as opposed to in the past he
really never had reasons to turn the
only reason he would turn is because he
made a huge mistake and slammed into
something so with the waypoint data he
actually has objectives and we can
actually score things the other thing
that was kind of cool to see him do is
like when he miss his turn so like in
this case he just missed that turn slams
in that car sorry guy but then he takes
a u-turn to actually go back get on
course which I thought was just really
really cool he's not the best at you
turning and a lot of times he'll miss
his objective and then just try to turn
through a wall or something like that so
that's kind of problematic and then here
this is a good example of what I believe
to be conflicting training data so just
to kind of frame it before I show it
he's plopped down I think it was during
the reset so he's plucked down and he's
facing forward total open road
so most of his training data says go
straight just go straight but he's got
some training dudes as well we have
Waypoint data that says you actually
need to turn around so you can see
there's quite a bit of conflict in ways
trying to think about doing so you see a
it's like that most restraining data
says go straight definitely don't turn
right but eventually he ends up
succumbing and turning to the Waypoint
data and I think that's a problem with
having both nominal a point and Waypoint
there probably should just do pure
Waypoint data but yeah so anyways I
thought that was kind of interesting
because you could clearly see he's very
conflicted with clear ahead why would I
turn around so cool so as I said before
he asked some of the issues is he will
frequently miss his objectives or he's
just going too fast to take a turn and
then he tries to continue going through
so crashes a lot but I think he crashes
much less than the other models also he
performs way better at night than in the
daytime for whatever reason so moving
forward what I want to do is basically
continue on this because I can actually
do reinforcement learning with this data
I'm already logging all of the data tune
from waypoints I actually have a new
model it's going to come
hopefully in a few days that it's much
more Waypoint focused again with
automated waypoints and we'll just kind
of see where it can keep going now
another interesting thing that I just
kind of wanted to show is in the
training data of 0.03 well actually
first I'll play this one so we dropped
them into san andreas just to see how we
would do it so obviously done zero
training data in grand theft auto san
andreas this was kind of funny because I
forgot how bad san andreas looked also
san andreas controls like the cars could
handle crazy but anyway so we dropped
him into san andreas and if you're
familiar with the series at all you
probably know the first thing you decide
to go ahead and do so this was actually
the 0.02 but it was right before the
update 0.03 yeah
first thing he does just drive straight
into the water with some great music if
I might say so so yeah so yeah zero
point zero tune in GTA san andreas we
also put them into GTA 4 but we the
tutorial is pre closed and so we drove a
little bit and he actually did ok but
I'd really like to try them in more
situations in Grand Theft Auto 4 so
maybe in the future we'll do that anyway
yeah one of the other things I wanted to
point out was in my training data every
time I was personally on this stretch of
road I would take that stunt jump just
every time and interestingly enough most
of the time when he find himself here
he'll either take that snot jump or he
will attempt to take that stunt jump so
that's pretty cool too I was pretty
excited to see that he clearly
recognizes that little environment there
and it just always goes for that stunt
jump so that's pretty cool I don't know
if he's actually going to complete this
one
wow that's competitive why that would be
completed he was so sideways didn't slam
into anything anyway here's another one
- Auri almost actually I think he almost
didn't make this one but I tried very
hard he avoided that pedestrian but he
was like I'm taking that stunt jump
haha okay so um anyway if you want to
see more of Charles you can again go to
twitch.tv slash semtex there's always a
live demo there at least for now anyway
you can come here you can kind of check
out the model if you want to apply it
yourself cool eventually I might upload
just the model people were asking for
the training data but the training data
is like terabytes so I'm not going to
upload that I don't really see myself
doing that so anyway other than that
going forward if you're not familiar or
an Theft Auto or actually rather take
two interactive kind of attacked all the
des mod creators pretty much shut down
mods across the board so we use mods to
do things like automatic Waypoint
setting resetting the car invincibility
and then also just if we want to change
things like the car the weather and all
that so mods are a huge part of us
working in this game at the moment I'm
just running the older version of Grand
Theft Auto but they've been like forcing
these reactivations and you've got a
likely download and then we we revert
your updates and stuff it's a huge it's
very annoying it's kind of a bummer for
someone like me like I've Grand Theft
Auto like honestly the last probably 20
years of Grand Theft Auto have been
modified grand theft auto's and for sure
at least for me for like the last decade
every grant the deliveries not by the
game is to to play it and moderate
modify it so huge bummer that they're
there they're just basically banning
mods even in single-player like I
understand the multiplayer stuff but
single-player like geez anyway what a
bummer but I'm going to keep keep
fighting the power part of the
resistance as long as I can but that's
going to throw a wrench into things if I
get to a point where I can actually run
with mods that'll be hard but anyway
we'll figure it out if you have any
questions comments concerns whatever you
can feel free to leave them below I will
I don't think I have yet but I'll update
github eventually with the with the new
other ception model but you can also
just come to cyber Daioh
and grab it from here other than that I
really know code changes I've also been
messing around with granular throttle
already had it working that pretty sure
I had it working by the time I reported
for 0.02 I've continued trying things
but the bottom line is it doesn't
perform better than the model I have now
that's probably because the actual
training data itself is done with the
keyboard if the train data was built
with an Xbox 360 controller I do better
with that data so might end up making a
hard hard shift so that information but
at least for now I want to keep working
on the Waypoint data and see if we can
get reinforcement learning working
because if I can't get reinforcement
learning working and it doesn't seem to
make much sense there's really no point
in changing to an Xbox 360 controller or
anything like that this doesn't that
just be a huge waste of time so anyway I
think that took that covers pretty much
everything I wanted to cover if you have
questions whatever you can feel free to
even below otherwise I'll see you in
another video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>