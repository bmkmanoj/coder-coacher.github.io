<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating labels for Machine Learning - Python Programming for Finance p. 11 | Coder Coacher - Coaching Coders</title><meta content="Creating labels for Machine Learning - Python Programming for Finance p. 11 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating labels for Machine Learning - Python Programming for Finance p. 11</b></h2><h5 class="post__date">2017-01-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zPp80YM2v7k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome part
11 of our Python for finance tutorials
your needs
in the previous tutorial basically
you're in the tutorial we've kind of
created we started getting our data
ready to create our labels we created
our helper function that's going to let
us do that and now what we actually want
to do is is map this function to our
data frame to it basically a new column
so let's go ahead and get started with
that so creating a new function here I'm
going to define extract feature step
it's going to take one parameter it's
going to be the ticker then we say
tickers DF equals this function up here
basically because it returns ticker and
DF
tastes good so now we're going to define
this new column this new column is going
to have the value for this new column
will be the mapped answer of this
basically this takes are just the args
that it's going to take are going to be
the 7-day prices in the feature or the
7-day % changes for those prices in the
future so whereas a DF will be this
heart target format ticker so basically
it'll be the you know exo-m target
that's going to equal the list of the
map of the function buy sell hold and
then from here we pass praying with
parameters to this function that's just
how mapping works so now we're going to
pass hmm it would be really convenient
to have a way to it or iterate this I'll
sell my head I don't know have a good
way to iterate this one because we've
iterated the days here which is great if
someone knows how to iterate this list
I'm about to show you why I'm so bummed
out at the moment do post it below
because I am blinking so what we're
going to do is do this oh it's going to
be this is so gross thought we were past
as Harrison
okay so rather than this it will be like
one day and then comma enter and I'm
just going to copy this two three four
five someone's going to someone save us
someone save us in this madness I feel
horrible I feel horrible I'll take a
shower after this or something this is
just bad now we're going to say okay so
food so this creates a new column and
generates buy sell or hold so at this
point we actually could print out the
data frame and we'd see we have a new
column called you know whatever the
ticker is underscore target and that
will be either a a 1 a negative 1 or a
zero and that's the class so to speak
for for this dream scikit-learn in this
case well I'll bring that other thing up
later so now we're going to say valves
equals basically this will be weight 1
let me just write it up and I'll explain
why we're doing this
so valves will be basically this exact
thing that got values dot again to list
I'm not positive I'm going to need this
here but I'm going to do it just to get
over errors string underscore valves is
going to equal string I for I in valve
and then we're going to print print
let's just do data spread colon comma
counter string valve so counter just
requires us to deal with strings I'm not
quite sure why you should be able to use
integers but whatever so now what we
need to do is go to the very top here
and we need to do a from from
collections in for
counter I'm going to go ahead and cut
this in this we want to be alphabetical
order okay counter string valves okay
so that would give us the distribution
now why is the distribution important
remember in the previous tutorial I said
you know we've got basically three
classes here so just with random choice
we shouldn't do we get 33 percent
accuracy that's not necessarily true
first of all stocks don't on average go
sideways right on average stocks go up
in price so we might want we might over
time to need to tweak this number so
it's relatively even between buy sell
and hold like basically like for example
if we have three thousand rows of data
chances are 1500 of them are by 800 of
them are sell and the rest are 800 of
them are sell the rest are hold or
something like that
okay so chances are most of them are
going to be buys so it's not going to be
a perfect spread we want to see what the
spread is because then when we finally
do get how accurate is our classifier we
can ask it well is that any better than
if our classifier just predicted ba ba
ba ba ba ba because that's the question
so if you can't beat the a like a
constant by then clearly that signaling
to you you should be someone who just
buys and holds in the market so anyway
data spread Cannavale is cool so now
we've got that information now we're
going to go ahead and do DF dot fill in
a zero in place true just to handle any
side like to just sprinkle these fill
anaise and drop any of those I'm doing
things because it does help the mattad
EF is going to be gift aa trick plays
this is one that I do not think how's it
in place equals true so that's why I'm
redefining it NP is um what's the list
of option NP duck in and also negative
NP bands and we're going to replace
those with NPN so if we have any prior n
A's we're going to call them zero
because those would be like percent
changes or whatever and in this case
what we're doing is we are going to
replace the infinite
incident changes ie when price basically
goes you know basically if we went from
like zero to suddenly having a price
well the percent change from zero to a
number is problematic so we're going to
replace that with NPM in a track yeah
we'll do that and now we're going to do
is VF dot droppin a and then in this
case we'll do in placing the street okay
so so we've mapped that column we've
handled four crazy values great so so
now what I want us to do is create the X
because basically the end of the day we
need to have the feature sets and the
labels so now we're going to do is
create basically the feature sets and
the labels and we can pretty much do
that separately so we're going to say DF
valve these will be like just just the
values because we've just we've created
some of these new columns or so for
example if you accidentally past future
values especially if we passed all the
values in the next seven days to the
classifier as one of the features the
classifier is going to learn really
quick to just pay attention to those
columns so you generally want to be very
explicit when it comes to which columns
get to be the feature sets when it comes
to machine learning otherwise you're
going to get really high accuracy and
you're going to think oh I might be a
baller for life and it's not true okay
ticker for ticker in tickers so we got
this all the plausible tickets here and
tickers is just the prices that's it
it's not normalized yet but it will be
in momento dot PCT change boom normalize
not only is it normalized they actually
gives us a little bit more information
because now it's not just today's value
it's today's value as opposed to
yesterday so it's actually a percent
change just one day so it's not percent
change from the beginning its percent
change from like yesterday so if you
graphed it it would just be mostly a
zigzag kind of sideways graph now okay
so go that now DF valve's equals
again we're using percent change so
we're going to have these infinite so
we're going to say be f you should copy
this EF underscore valve dot yeah dot
replace and run it in NP man yes so
we're going to go with zero and then
we're going to say DF valve dot fill na
with zero in place equals true just in
case something else goes hinky here
we're just going to say it just fill it
with zeros at this point because it
should have some data there by now now
what we're going to say is finally our
exes and our wives in general you have
X&amp;amp;Y like this is how it's depicted your
capital X or your feature sets your
lowercase Y sometimes it'll be people
will use uppercase Y it doesn't matter
that's your labels generally X feature
sets Y labels the target the class is y
feature sets are the things that
describe it in our case price changes
percent changes daily so now we're going
to say capital x equals bf underscore
value not values and then why is DF
whatever that target was so basically
this dot values and effects let's see
now what product it is use valve here
but I think we must be an umpire ray and
then I can't remember if this is
necessity necessarily to to list don't
leave it the way it is that's kind of
redundant so you might want to take that
out anyway you can answer that question
on your own time if you'd like
XY DF okay so though so now we return
the feature sets the labels and the data
frame this case we want to reference the
data frame some reason we'll return that
as well now at this point we've got the
feature sets we got the labels
we're ready for machine learning that's
we're going to be doing in this tutorial
so stick you for that if you have
questions comments concerns whatever
feel free to leave them below also let
me just
let me just run this real quick let's
make sure I don't have an error and then
I'll let you guys go sorry
just like I said I like to do syntax
errors sometimes exactly
I know name error is not defined how you
gonna tell me this Oh see I told you
this is why I gotta run this stuff okay
so in this case we don't have AI right
this is after we just like copy and
pasted that lines all this is so gross
does it why we need to fix this
somebody somebody's a was oh my gosh
okay so requirement so let's go ahead
and spell it right requirement wow it's
a good good thing I ran this one sort of
gave give us hell later okay so we can
see the spread here even a point you
know for 2% it's actually pretty a
pretty good spread that's a good
starting number then so yeah so it was
seventeen thirteen fourteen fifty six
and then 1108 cool ideal easy should be
perfectly even but there's pretty much
no numbers it's going to give us that
because for different companies that'll
be different numbers so certain
companies rise a whole lot more like
eBay and Exxon kind of do a lot of
wiggling as opposed to like Apple just
kind of goes up over time anyway Italy
so far okay great so that's where we are
for now and next tutorial we'll do the
machine learning equation of college
below LT neck</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>