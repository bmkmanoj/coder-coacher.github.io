<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Haar Cascade for image &amp; video object classification - OpenCV w/ Python for Image  Video Analysis 21 | Coder Coacher - Coaching Coders</title><meta content="Haar Cascade for image &amp; video object classification - OpenCV w/ Python for Image  Video Analysis 21 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Haar Cascade for image &amp; video object classification - OpenCV w/ Python for Image  Video Analysis 21</b></h2><h5 class="post__date">2016-01-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-Mhy-5YNcG4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
the moment of truth another open CV with
Python tutorial video covering how to
make your very own our cascade for
object detection of really any object of
your desires so where we left off we
were training the Cascade which took a
pretty long time as you can see we
basically started this process here at
8:17 and it didn't complete until about
1029 so a bit over 2 hours to get this
far
now a couple of things to note is I did
output a cascade XML but let's say you
didn't and we'll just put I'll just type
- old for now what you could do is let's
just LS here what we could do is we
could actually write another one so the
hit up here I was hoping to get okay
so this what do I have stages num stages
10 so as you can see we've got all the
way to stage 11 here so I could say num
stages let's say 5 first of all and not
a no hub command everything else I
believe is the same just hit enter boom
stages 0 - 4 loaded let me refresh this
and there you have a cascade file from
stages 1 to 5 now we've gone to stage 11
already what if ok we didn't want to go
down we actually want to make more
stages how would we go about doing that
well we can state say num stages 15 hit
enter oh we're prior running outta yeah
we ran out of samples that's I guess
that's right that's probably why it
stopped where it did because I ran this
one I ended up running it overnight um
I'm sorry that's kind of funny uh I'm
trying to think of how I can basically
well at least you can see here it's it
loaded stages 0 to 11 and it was
starting to Train stage 12 we just ran
out of images to start with which is why
I said start this vector file low right
1800
we had 1916 or 1950 and we ran out okay
so that's why you start that a little
lower
and then what you have but you could
continue building so maybe if you wanted
to go past say stage 11 you would start
num pose at 1700 or something like that
okay well uh what we end up with is
we've got this cascade file here that's
let's try let's train it to 11 stages
let's get rid of this one and let's see
I don't know if we can get away with 12
like this I don't know if it starts it
because I think it starts at 0 so of 12
stages we should actually get that full
file right stages 0 to 11 are loaded it
just automatically trains that cascade
file boom so that's cascade so like what
I can call this is like we can call this
watch - cascade - twelve stages okay so
there's our cascade file now here's our
tutorials I'm going to take this cascade
click and drag it into here we'll
download that and just take note the
size of the Cascade 318 kilobytes now we
are going to and that will hopefully
detect my watch now we're going to open
up actually I have it no I thought I had
it up I guess I don't
okay back to open CV tutorials open this
up this is a copy of that last tutorial
we did where this was the face and I
Cascades if you don't have this code
feel free to go to the description and
get the code like I said before I don't
know why you're following along this
tutorial if you haven't been followed
like writing it but ok if that's you let
me know why you're doing that below but
anyways
so this is that code from the just
running the downloaded hard Cascades
from the land of Intel just keep in mind
you're not video capturing one only I am
you're probably video capturing zero
video capture one if you're working with
an invidious or something hopefully you
took a picture of something in that
video file I suppose or you could take a
picture use a picture and you could
detect things from that picture if
that's you
I actually in the linked tutorial I have
a sample picture that uses this exact
all the exact same data that I've been
using so if you have got a slow computer
or whatever you couldn't do all this
other stuff or you didn't have your own
samples stuff or you couldn't think of
one I did provide a blank image and then
one that like will have the marked
information on it that's in the link
tutorial otherwise let's go ahead get
started let's just go ahead and run this
one keep in mind this is again that'll
load up my camera one which is over here
now I'm wearing these glasses and this
they just piss off the the Cascade but
take them off it does a better job but
that's okay that's not really why we're
here anyways we want to load up now the
watch cascade so what we're going to do
is we're going to just make a new
cascade here so we're going to say watch
underscore cascade and we're going to
say watch caps watch cascade equals
basically this copy paste and we said it
was like watch here watch Cascade 12
stages I'm just going to copy that paste
so that's our watch Cascade now
basically we're going to copy what we
did for faces only we're going to do it
for the watch so actually first let's do
this let's take faces copy that paste
and instead of faith or instead of faces
this is watches instead of face cascade
it's watch cascade hopefully we're only
finding one watch that's all I have but
it may find more then what we're going
to do is we'll copy this line here copy
paste so for that X Y a bowl long faces
instead it'll be watches and we can draw
a rectangle but I'll let you guys see
but what's going to end up happening is
the rectangle will wind up being a 20 by
20 that's the biggest it could possibly
find for a watch so if you wanted to
improve that you would go back to that
whore cascade trainer and train to 100
by 100 but that will take a lot of time
and it will take a lot of memory you
will blow the RAM on that 2 Giga Byte
server for sure ok
so that should be it we're going to draw
the rectangle I don't think anything
else needs to be added so let's go ahead
and run this real quick see how we do
okay right right so I brought this up
before so whenever we were doing the
faces we remember we went with the let's
see on the faces we went with the
default for faces we're in the tutorial
like if you go to the documentation they
have some parameters there you can have
these parameters basically these are
like flags and trying to think of a good
word for them but you can maybe I forget
if I have a link to the multiscale what
you want to do let's see let's go to
detects multi-scale let's pull that up
this isn't the right let's see if we
have python here it's dude text so we're
visiting the documentation here these
are the Python bindings
you've got the image the scale factor
minimum neighbors flags minimum size max
size we won't really fill these in
because mid size is already too small
but actually what we're looking for is
right here so we've got image size the
reject levels and the level weights are
what we're going to wind up using this
one also does have Max and min size you
normally I wouldn't mess with that but
you could like if you're trying to
detect something that's normally very
very small you could you might think
about doing that or like with eyes you
know eyes should be a pretty small ratio
of the image and you can dynamically
generate that number so just keep that
in mind
anyway we're going to fill in this for
watches it'll be gray and then 50/50 so
we'll be a little more stringent there
on those detection z' hopefully and
we're detecting a face in the background
but no watches yet well I happen to have
a long you know take off my watch and
hopefully we will detect the watch
I forget what color we made it but it's
actually not pulling up any watch here
I'm pretty sure that well there it goes
at least picked up for a second there we
could bring it down a little bit maybe
this one is a little more stringent do
40 42 we can fine I got only like one
output for the watch there yeah it finds
it every now and then you know and it's
only going to find like a 20 by 20 of
the watch and you can keep kind of
messing with this depending on what your
image was the quality of your images and
stuff like that you might get different
different accuracies let's see here and
also the lighting I suppose might make a
big difference at least over here it
picks up the watch quite a bit over here
but again it's picking up a 20 by 20 at
most and the reason why it's picking up
a 20 by 20 at most is because that's
what we trained on so maybe if we threw
the watch like way back or something
would be a lot more accurate right so if
we put the watch way back it's generally
better just because it's representing
more of a 20 by 20 box anyway because we
don't have that big box so now you can
understand why Intel and a lot of people
probably keep their little cascades to
themselves or at least heavily licensed
because it takes a lot of memory to even
build up those cascades because like
think of how big this face is I mean
they probably I don't even know I don't
shut her to think how long it took them
or what kind of computer they had to run
but I suppose their Intel they make
processors so whatever so anyways that
you can do the rectangle and I guess if
the watch if you bring the watch back
and it takes up a 20 by 20 it works
pretty well but instead of doing a
rectangle you can also just simply do
and like let's try it let's try to lower
it again you basically just lower it
until you get a ton of detections you
probably even dynamically do that to
like now it not really wants to pick up
the watch but it's also my hair is
apparently a watch that's probably a
little too low but it works pretty well
so maybe a 20 by 20 even though it
picked up my hair a couple of times
there so that would be good anyways
let's
instead of a rectangle we could we could
write on there so like we could say you
can use text or something like that and
type out wristwatch so like instead of
doing a rectangle let's say again font B
equals CB 2 dot font underscore Hershey
underscore simplex and then see me to
put text where are we going to put that
text we're going to put on the image
what are we going to say it's a watch
so we'll say watch what are the
locations going to be X minus the width
so X minus the wit so it moves over a
little bit and then Y minus the height
and then we will use that font that we
just defined size will be 0.5 again I
don't really know how the font sizes are
dictating so it's not by pixel I'll tell
you that and then the color let's make
it 0 255 255 so like a yellow then will
you we use 2 here and then that's the
thickness of the text maybe like 1.8
over 1.5 and then see v2 dot line
underscore a a to hopefully add some
anti-aliasing there all right let's run
it again and we'll pull up the watch out
we lagged out what happened integer
argument no I guess we that's crazy I
swear I've used of mm whatever okay fine
we'll use it we'll use it too I thought
you could get away with that but I guess
not go again
you can get away with it on the size I
know that okay so we hold the watch here
and sure enough it detects watch watch
watch
and at least we're not detecting watch
all over the place let's move it over
here and see how we do of course but now
because it's further out it's detecting
up there but you were overly you recall
it was detecting the square right so
depends I suppose if you have it really
close like if you're if you train for a
small shape even though you knew you
would probably find a big shape again
because of the way the horror cascades
usually work they're going to find like
those flags that's basically like how
many are is it actually picking up so
the way that it works if it's if it's
really close it's still going to find a
lot of flags most likely and if it's
further away since that was the
same-sized I suppose it might work but
the closer it is the more flags that
will probably wind up finding but then
if you pulled it back it'll be a better
match probably to what we were training
against but if you if you look at what
hora cascades do the way that they're
they actually match features is it just
incredibly basic to the point where how
close or far away the object actually is
shouldn't matter too much as far as
detecting its existence but drawing that
cube matters so just depends on what you
want now drawing the cube is kind of
useful but you could always detect the
item do edge detection and then circle
around that item or square around that
item or something like that or you could
run the hard cascade to be gigantic
I mean you it wouldn't the hard cascade
file itself would be a lot bigger if you
used a bigger size I think but it
wouldn't necessarily it would just take
a lot longer to run it wouldn't
necessarily be that much more efficient
then anyway I you know the thing that
surprises me or impresses me the most
with these hard cascades is just their
size they're so small and to me you know
I think like the amount of things that
exist in your day-to-day life like like
think about like how many objects you
might coming into contact with on a
day-to-day basis feel free to comment
below what you think that number is but
I would guesstimate about 5,000 objects
and then let's say your heart cascade on
average is a half a megabyte so 0.5
we're talking about 2.5 gigabytes would
be required in RAM to recognize 5,000
objects that's really not that much I
think that's incredible that you can
detect so many objects with such a small
amount of RAM
because something like imagenet exists
we can actually pull quite a few images
and actually I think probably with
relatively too high degree of accuracy
detect most of the objects and in any
buttons like everyday life and figure
out what it is and because image net is
connected to word net you could actually
not only find out what the image is you
can get an image of the like you figure
out what the image is what the name is
you've got image nets in sets you can
connect to word net figure out what is
what's the definition figure out how to
use it there's always the Watson API
that's completely open open up that use
Watson uh I mean is crazy I mean the
things that you can do from here are
incredible so hopefully you guys have
enjoyed up to here hopefully you feel
like you've got something valuable this
is probably one of the more valuable
things I think I've learned in
programming just because of all of the
things you can do from here just by
being able to recognize any object with
a computer is super cool if you ask me
ok so if you have questions or comments
or whatever feel free to leave them
below as I setup to the whole tutorial
all the text-based versions of these
tutorials are on Python programming net
sample code is their sample images are
there if for whatever reason you're
having a problem at any point of the way
I've got everything hosted the negative
images all that cascade I don't think is
up I don't think I may put that up or me
not I'd rather you guys actually train
the Cascade but I could probably host
that as well but anyway I don't really
see the point of hosting the Cascade
actually because you can download anyone
elses cascade it's really not that
special so anyways that's that maybe
I'll cover an automated fashion of
connecting the image net and creating
positive and negatives maybe I'd also
like to do like character recognition or
something like that but I'll probably
put a pause on OpenCV for now I've done
quite a quite a bit of open CV so
anyways if you do have any suggestions
or something else you want to see with
open CV please do feel free to leave
them below I'll probably cover them
eventually
oh that's that as always thanks for
watching things for all the support
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>