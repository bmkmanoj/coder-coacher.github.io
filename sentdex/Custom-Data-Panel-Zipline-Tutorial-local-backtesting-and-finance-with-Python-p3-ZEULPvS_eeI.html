<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Custom Data Panel - Zipline Tutorial local backtesting and finance with Python p.3 | Coder Coacher - Coaching Coders</title><meta content="Custom Data Panel - Zipline Tutorial local backtesting and finance with Python p.3 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Custom Data Panel - Zipline Tutorial local backtesting and finance with Python p.3</b></h2><h5 class="post__date">2018-05-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZEULPvS_eeI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
part three of the zipline local Inns
announced tutorial series in this video
what we're gonna be doing is working
with our own custom data so just like
with how to run an algorithm there's a
bunch of different ways with using your
own custom data there's also a whole
bunch of ways and some of those ways I
don't really understand or can't figure
out and I think at least for most people
their goal is like hey I have this CSV
of data how can I just use this freaking
CSV and do back tests on the CSV of data
whether that data happens to be a
signals or maybe it's actual pricing
information how do I just like bring in
that CSV so that's what I'm gonna be
showing you guys how to do right now
basically the only caveat here is if you
are trying to bring in more data than
you could store in your RAM so if you
have 32 gigabytes of RAM but your data
set is 64 gigabytes well you're out of
luck you're going to need to use a
different method there's basically two
two main methods you can use data this
way the way I'm about to show you or you
can use data and via like bundles in
quanto pians so with data bundles you'll
have to ingest and create the bundle and
all this kind of stuff and to be honest
with you I have no idea how to do that
I just evades me so if someone has a
really great like write-up that they've
found for how to step by step do it
there is documentation on zip line do it
still doesn't make any sense to me
so anyway maybe you're smarter than me
just know it exists but this is one way
to do it so the way that we're going to
do is we're just going to load it in and
then basically what you're doing is
you're you're loading in a data frame so
that should be pretty simple for most of
you guys data frames just like an Excel
spreadsheet so you've got your data
frame that will consist of open high/low
close in volume data if you have more
data than that you can just get rid of
those we're just going to ignore the
other columns and then that data needs
to be indexed by date and so each of
those let's say let's say you're loading
in symbols data so you're gonna load in
some tickers each one is its own unique
file it's unique data frame and then
what you're gonna do is you're can
combine those data frames into a depth
and
the way that we're doing that is using
panels with pandas so a pandas panel
basically is like a 3d data frame almost
where basically you've got your your
single data frames which are columns and
rows and then the depth part of the
panel is the different symbols that
those rows represent so that might sound
really confusing I think it's just so
much easier if you just see how I'd do
it so let's go ahead and do that so the
first thing we're going to go ahead and
do is let's just show how we're gonna
create this data panel and then we'll
show how you can bring in that data
panel so let me do import pandas as PD
maybe make it a little bigger cool
import painters SPD from collections
we're gonna import ordered dict and then
we're gonna import PI TZ to ensure for
time zones so this is another thing you
start thinking about if you're going to
use your own data is time zones
obviously time zones are really
important or is your data in Eastern
Time or is it in UTC time so a lot of
like AP is or whatever they're gonna
have their own time zone so you need to
know what time zone your data is
time-stamped for that's whether it's in
unix time or date time or whatever you
need to know so anyway we're going to
import pi TZ to ensure that everything's
of the same you know basically time
stamp now we're going to start our order
dict so ordered
dictum what we're going to do is we're
going to use order dict to contain our
all of our data frames and then we just
convert the order dict to a pandas panel
boom done so in this case i'm only gonna
use one ticker and we're going to use
spy dot CSV and because I can't trust
any API I've actually just uploaded spy
dot CSV and you can use by the way feel
free to use your own data if you don't
want to use my data that's totally fine
if you've got your own open high low
close volume data set that's indexed by
date great by all means use your own but
I'm gonna use mine and then let me show
you how this dataset looks because it
has to look just like this it needs to
be date open high low close volume
obviously you don't even have the same
prices the date format could be slightly
different if you wanted but the
anything here is the names of these
columns they need to be date open high
low close volume
you'll also notice I have adjusted
clothes that's fine there was a split at
some point here I'm gonna do my best to
just work around that but pay attention
to that too if there is a split in your
data that's going to be problematic you
need to make sure you have adjusted data
but yeah so let me I guess what I'm just
gonna close that I don't need that
anymore so now I'm gonna pop over to
here where we've been working and now
what we're going to do is we're going to
load in that data set so what I'm gonna
say is data and then data we're gonna
organize this by the ticker in this case
it's the spy the S&amp;amp;P 500 ETF so we're
gonna say data spy equals PD dot read
underscore CSV and in this case that's
going to be spied out CSV now you can
imagine that you could iterate this as
well so at this point you could say you
know let's say you had some tickers and
that was a list and you go for ticker
and tickers boom and then you would read
you know ticker you know do dot format
ticker right and you do this so the next
little block of code you could totally
iterate the way I'm gonna iterate so and
in fact while I'm at it let's just do it
so so just in case a lot of you guys are
doing it this way I will just do it this
way so we'll say data ticker I went this
far right ticker so this is how you can
do you can iterate through a list of
tickers in my case I'm just gonna have
one ticker but you get the idea so we'll
say data ticker equals that and then
we're gonna go ahead and the we'll say
the index index underscore call equals
zero so zero with index these two with
element basically is the index and then
we'll parse underscore date so you could
either just say true that should be
totally fine but I'm gonna specifically
say it is the date column itself that I
want to parse as a date so that's data
taker it just reads in that CSV and then
what we want to do is we don't want that
adjusted closed column we just want open
high/low
volume again this is just a quick
example but normally you would want to
adjust all those columns because if you
saw that this data did have a split I'm
only showing you this for an example but
keep that in mind also I'm pretty sure
this data is probably not in UTC data
format but I would I'm probably just
gonna convert it to UTC it's probably
actually an Eastern but anyway I'm gonna
always use UTC because that's usually
what I do but like that's the timezone
of my data but anyway it's data taker
reading that CSV the next thing that
we're going to go ahead and do is we're
gonna say data ticker equals data ticker
and then we're gonna specify those
columns so it would be ticker and then
we want very very specifically open
high/low close and volume so we just
want those columns we don't want to
really pass anything else now what I'm
gonna go ahead and do is once we've
specified that we could just print data
ticker dot head just to make sure we are
where we want to be all of this by the
way is pandas code if you don't know
pandas guys tutorials on pandas so check
that out let's go ahead and run this
make sure it's what we're expecting the
seat
sure enough it's exactly what we expect
it to see so great now what we want to
do is let's go ahead and convert this
like how we would convert this to a
panel it's actually really simple we
would just say something like panel and
in fact I think I'm just going to do it
up here because eventually I'm going to
convert this to mmm hold on I'm trying
to decide how I really want to do this
if I want to just convert this to a
panel or if I want to do this kind of
out of line I guess I'll convert it up
here and then I'll show you what I meant
by normally this would all be in the
same script but I'm just trying to break
it down into the panel first and then in
the data that consists in that panel and
then show you how to how to bring it
into your algorithm itself so anyways
the next thing I think I'll just put it
right here well so we'll say panel
is equal to PD dot capital P panel data
so we just converted the data to a panel
now and then we're gonna say panel dot
minor underscore taxes and this is just
basically the the column so this is just
you'll just copy and paste this open
high low close volume and then panel dot
major axis you should probably be able
to guess what this one should be but
it's gonna be your date time but it's
gonna be panel dot whatever that major
underscore axis is but then we want a TZ
underscore localize and we want to do pi
TZ UTC I think I think probably est is
probably Eastern and actually this data
is probably Eastern data I'm gonna go
ahead and just say UTC for now but again
just make sure you keep the time zones
right it's gonna make a huge difference
in your algorithm and if you want to
avoid look-ahead mistakes make sure
you've got the time zones correct so now
I'm gonna go ahead and print the panel
make sure we did that right and I'm
gonna not print out the head anymore and
oops
I said panel panel nice print panel
great so this just tells you ok the item
access is spy to spy so that would be
ticker ticker basically we just have one
major accesses just should be axes
should be just date/time and then the
Minor should be the actual columns
themselves open volume cool so
everything looks like we would expect
and now what we can do instead is pass
this to our back tests and then also
this will be the new way the final way
I'm going to show you guys how to load
in data so I think what we'll do is try
to decide well if I want to send you to
the if I just want to type this all out
I just I don't think there's any benefit
in in typing this stuff out so I used to
always just type out everything in
tutorials but I just don't see the
benefit so first huh so what I'm gonna
just on all the tutorials I always have
links to the text-based version of this
tutorial so I think for this part I'm
just gonna explain it basically so
basically these first few lines here
are just you're just like I said before
if you want to use this stuff you've got
to import it so in this case we're gonna
use order we're gonna use record we're
gonna use symbol and then a new thing
which is setting a benchmark we're going
to import zip line so we can use zip
line later on to run things in the final
way I was going to show you guys we can
import pie plots because we're gonna
graph stuff and then date time so and in
fact we're really probably gonna graph
stuff later I probably don't even need
pie plot so I'm just gonna actually
delete the X that's not necessary here
so now the next thing that we need to do
is bring in our actual script and this
should look identical to what you've
seen before paste that in so this is
just your typical order ten shares every
chance you get script just like Apple
only this time we're gonna do spy
because that's our unique data and for
the record spy does not exist they don't
track the ETF's in the quanto peon
quando bundle so you know it's using the
unique data next at least when I record
this spy etf is not in there so once we
have that we need to bring in that data
we've actually already brought it in up
here so down here all we want to do is
run this and this is the final way to
run and this is the way I think makes
the most sense so I'm just gonna paste
it in not make everybody write it out no
benefit in my opinion maybe tab is over
it's not gonna be perfect but it's okay
so now we're gonna use zip line which we
imported here we reuse the zip line
specifically to run the algorithm
specify the start time the end time
again specifying date time or time zones
rather so just again make sure
everything matches up in timezone and in
fact in this case they don't because
we're still using a trading calendar
which I'll explain in the next tutorial
that's in Eastern time but also anyway
that's beyond this tutorial so here
we've loaded in all the data start time
end time you just specify the initialize
function how much money are you starting
with how much are the handle data
function and then finally you can either
specify a unique bundle or you can
specify
data so these are mutually exclusive if
you use data you can't use bundle and if
you use bundle you can't use data
obviously so so now what we can do is
run this and then the return of this
goes into perf which is a data frame and
then we can do all kinds of fun stuff
with the data frame that's said actually
first let me just run it this should run
pretty quick it's only a year so let's
just run that and then yes that's done
and then now we can say you know perf
and then game port matplotlib pipe la as
PLT perf dot portfolio underscore I
think it's value dot lot PT - oh cool
there you go
okay so same thing as before only this
time it's all in the same little script
now what I'm going to do is I'm going to
zoom out a little bit so I can make this
a little easier on myself and show you
probably the real that is close to how
you're gonna likely have your scripts as
possible which will actually look more
like I'm gonna cut here paste that into
there and I'm gonna cut this data and
paste it before performance so like
somewhere like here paste boom fix the
Pepe tissues beautiful and then down
here I don't know we got to make sure
from that and poor style style use
ggplot okay so the way that you'll more
likely do it let me get rid of this one
double D to remove and no jokes please
and let's go ahead and run that run that
and then there's your graph so yes so we
have loaded in our custom data in if you
had more symbols and obviously you would
need more of those CSV files locally
that's how you could load in many many
many tickers of data so long as it all
fits into memory that said if your data
doesn't fit into memory it's probably
going to take for a brew so like if you
were doing like I don't know
high-frequency tick data to have 64 gigs
of high freq
see tick data you would need a long
history of that and to back test that
alone is gonna take forever so if that's
you if you're doing that kind of back
testing just buy enough for the RAM
sticks I guess anyway enable swap so so
anyway yeah so that's how you can load
in custom data of course though many
people obviously some people want to use
data and trade the New York Stock
Exchange but now what we want to talk
about is how can we load in and
customize our data for specific specific
markets so that's what we're going to
talk about in the next tutorial we're
gonna use Bitcoin if you didn't already
guess just from the the other download
in the zip line data sets so we're gonna
use Bitcoin but again just like always
if you have some other you know dataset
that you want to use by all means you
don't have to follow ours if you have
questions comments concerns whatever
suggestions feel free to post them below
if you want to support the content
Python permanet slash supports otherwise
I will see you in the very next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>