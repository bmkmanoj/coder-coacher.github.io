<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Charting Stocks/Forex for Technical Analysis Part 5 - Finishing price puller | Coder Coacher - Coaching Coders</title><meta content="Python Charting Stocks/Forex for Technical Analysis Part 5 - Finishing price puller - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Charting Stocks/Forex for Technical Analysis Part 5 - Finishing price puller</b></h2><h5 class="post__date">2013-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OXaxZpgBMqc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all righty everybody welcome back to
another stock price acquisition tutorial
where we left off we started building
this program that will just kind of
automatically pull the higher
granularity data for us that we're
planning to just leave it running so we
built the logic for how to find out what
the last time stamp was of data that we
pulled and now what we're going to do is
actually pull that data and use that
last known or the last time stamp right
and to know what data we want to save
now so let's hop in so now we want to do
is we're going to note a save file where
we want to save the data we're going to
say that is going to be open and we want
to open save file online with the
intention to append and again as we
discussed a couple times now append if
the file doesn't exist now the file
exists so yes
next we want to say source code equals
URL Lib - dot URL open and what do we
want to open we want to open the URL to
visit and we want to read it so that's
going to read the code of that page now
we're going to do split source same
thing we did before what sources will
source code dot split and again we're
just going to split by new loads by a
new line
oh that horribly long anyways um now
we're going to have a for loop and it's
going to be very similar to the one that
we had before right so for each line is
split source we want to split line
equals each line dot split by comma then
we want to say if Len of that split line
like we did before split line equals six
then we'll carry on with the program
now we add one last bit of water so if
split line 0 and actually let's go ahead
and convert this to an int so it's the
integer split line 0 is greater than
last UNIX which we've already defined as
an integer up here if split line 0 and
again uh I should keep using it where
did it go I guess we minimized it here's
the chart API and the split line was by
common zeroth element is going to be
this UNIX stamp here so if this number
is greater than the last this number in
our file then we're going to save the
data so coming down here if that is true
and then finally our last little bit
that we had before if values not in each
line although this is really not
necessary I suppose over the first time
through but yellow just leave that there
then what we want to do is line to y
equals each one plus that new line logic
that we have and then save file dot
write which really means a pen but use
the same word line to write
OOP now come back over we'll finish so
we're going to say print hold what did
you pull that stock whatever it was and
I'm going to say print sleepy and again
since this is a long-standing program we
want to print date stamps a lot just so
we know where we are
so we're and print this out again and
the reason we want to print it out again
is so you know that it's working
sometimes it might get stuck I'm trying
to think in this one I probably isn't
the most necessary since we're not
printing out other stuff but just for
good measure we'll just copy paste this
so sleeping we printed out again maybe
not necessary and
at a time not sleep and in here I'm
going to put 124
you know two minutes basically again
if you you know stop watching my video
at this point please make this number
bigger it's five minute data so at the
very least what we'll do here here's a
little bit we'll make it well shoot
because I do want to show you guys
something but so I suppose make it 300
for now but I am going to decrease it in
a bit because I want to show you guys
how this works or that it works anyway
um so I think this program is completely
for each stock we're going to do this
okay well we'll try and run it and see
what happens so anyway we see there is
no data here yet so let's save it and
we'll go for a run run module will
confuse why it didn't sleep okay so we
threw an error
okay it's trying to convert that so what
we're going to want to do first of all
let's get rid of this ugly stuff come
back over here so it was trying to
convert let's see where do we well okay
well we'll stop trying to be perfect
people let's just get rid of the int i
believe we can get rid of it you know
theory it should make a string but I
think it might not so let's just try it
so so what we did was just in case I
went too quick through that um you know
yet we converted this right here split
line 0 yeah we did that before values as
well so we're just going to get rid of
the integer conversion of split line 0
and then up here most recent lime well
this could stay int probably but we'll
get rid of this too so I think we
actually might be able to get away with
this so save it we'll move this over
again let's go run module okay it looks
like a pull day at Apple let's see if
we've got a file size we don't really
have a file size
let's see well we do have data there so
I think you close out of this hold on
okay what did work I guess we haven't
really closed the file so since it's
open for a pending so just to be good
people let's try closed
so at the end of the for loop
let's try this save file let me close
out of this I'm hoping that this will
update the size so we can edit it but
the file is locked right now so I think
we can append to it but maybe not right
to it I don't know and we certainly
can't save it so I bet we can't even
delete it now we can shoot thought yeah
see so you get this this thing that
we've left it you know no open so I was
hoping would go away after we closed
everything drag this over one last time
let's try and run it again okay so that
time I did it because we added that
close function here so at the end of
your for loop you know come back over
here so after the for loop is completed
now we just want to do save file close
that way the file is immediately
accessible again so because if you ran
it on a loop it might tell you that
error this program is blocked or this
file is locked which one really matters
so won't stayed locked for more than
usually like 5-10 minutes but it is a
that's a bad way to code so you do want
to close it at the end of it so okay so
now if we open up our Apple and the data
was there before but you can always tell
like if this doesn't if this number here
doesn't go up then it hasn't properly
been closed and saved yet so just a
quick aside so anyways here is our data
and as we can see this is what we're
expecting it to look like it is the UNIX
timestamp so on and if we scroll down we
see that we actually got 367 lines now
say we want to run this file like or
this program again so we'll run it again
it'll visit for Apple again and now you
can see it's done that it's sleeping and
if we open up this file again and we
come down to the bottom here again up
let's see what happened here
is it just really long have to look into
why this happened as well it's
interesting it's very odd I think this
was probably due to our little failure
earlier let me clear out this file see
if that happens again so we'll just run
it in here see that happen again
okay I didn't have it again so that's
good
no I probably happened in our little
error or in our poor programming just
like I was saying okay if you don't do
all these things properly you can start
corrupting files so anyway if you did
run it with me that first time make sure
you go through and close that file make
sure you add this and then go ahead and
delete the file and run it one more time
so now let me show you guys truthfully
so we've left this file right and
content intact and now let's run this
module one more time so we ran it again
sleeping and let's see you know it was
like 316 something lines so as you can
see we didn't add anything to it because
it looked to make sure that it you know
see if there was any new data so now
what happens if we say like this goes to
367 let's just delete some lines let's
delete down to 267 make sure you have an
empty line here otherwise it's going to
append to it and the only reason we're
showing if you want to follow along go
ahead the only reason I'm showing you
guys this is to show you that the logic
does indeed work
so anyway save the file we'll exit it so
as you can see it's even a smaller file
size now it's 115 close out of this and
let's run the file again should see go
up to 20 gig or 20 kilobytes again or
now it's 23 anyway edit it and then we
scroll down and we see that how we got a
lot extra lines no bueno
I don't even know what happened here if
I'll ended up corrupted again the only
thing I can think of is possibly we are
throwing an error in our poorly made
let's see if we're throwing that an
error here
trying to figure out why this is
happening our file definitely did if you
look here we can see that went from 13
you know higher number to a lower number
here so that's not good
so what we want to do is not have that
happen
so first values might be messing with us
so each one first we'll throw this
immediately then what we'll do is tap
that part over split line and let's try
to convert these two to int see if this
throws us again save and let's just go
ahead let's delete this file real quick
and we'll run it
oh it's throwing us that air that we
built in real quick come back over here
put time stamp one run it so to say that
air okay it's created the file for us so
look at the file here and we see 367
lines the file looks good let's close it
close this now let's delete some lines
here just do that just keep it basic
close it up Oh shoots running our script
still hold up let's close with okay
delete Google for now okay we're on the
tutorial again and we'll close out of
that and now let's edit the phone let's
make sure this time okay this time it
looks like we're pulling correctly again
I could go through and edit that part
out of the video but it's probably a
good idea to show debugging in the
videos anyways just in case you guys
ever run a run across your own little
errors so it looks like that fixed it
let's let's do it one more time just to
be certain that we fixed it so down to
240 lines we close it or run the
tutorial again yes we want to see 20
kilobytes okay what we like to see and
we'll scroll down again okay so it does
okay it looks like that we did indeed
solve that that problem so we'll exit
out of here and let's open up tutorial I
think it's probably running still
nothing closely so what do we have to
change again just to run through it just
in case you guys didn't follow uh we
initially we did try to do it this way
but it didn't work out or is it here
we didn't first of all values if that
values wasn't in the line we were
calling that a while before this I think
what was probably happening was maybe it
read values first and then it got to
this part
and I don't know maybe had that old
eunuch stamp in mind because values was
saved and there was no eunuch stamp not
positive
anyway the better way was to first check
to see if that line contained values and
if it didn't then the split line equals
this and then we could finally convert
you know split line zero to integer
because it was always going to be in
numbers are always going to be numbers
and then same thing here last UNIX we
just converted it to just to be certain
that we were dealing with numbers so now
that we are certain that we're dealing
with numbers the program is indeed
working correctly
so anyway glad we got that figured out
that was kind of irritating I couldn't
figure out what was going on I suppose
the next thing just quickly to show you
guys like we could put the sleeper as
one second and so it will run through
our loop just like we did before
basically we've got Apple Google
Microsoft all these companies just go
ahead and get those saved so we'll just
run through it if you see this error
you've just been following the tutorial
completely because we wanted to just in
case that accept was thrown we wanted to
see that it was being thrown for sure
and so it's since it's the first time
that we've run these stocks here did it
through that edges telling us what error
it through and then it proceeded to you
know call last unit zero so it could
finish the program so we'll close out of
this move this aside and it does look
like we've got all of our other prices
again let's look Tesla even in the last
five days Tesla has gone through point
44 to 161 pretty epic okay so now let's
close out of this so if you if you
wanted to make this program what you
could do is you know maybe maybe what
you'd want to do is is first of all
let's let's space these parts so your
internet doesn't suck while it runs
through this loop so every you know each
stock will run I guess will make it ten
actually just in case you had like a
huge list here so each stock will run
wait to wait ten seconds go to the next
one but right now this program is only
going to run through one loop so now
what we want to do is look like let's
make this a constant loop so what we'll
say it's just well true oops we have to
capitalize true while true we want to do
this for loop but then what we want to
do is after the for loop runs you know
you want to wait some time so well let's
say if you had you know 500 stocks that
you were going to say you went through
the entire S&amp;amp;P 500 then already built
into the script you've got 5000 seconds
between you know pulling of another
stock because you've got this ten-second
timer in between so if that's the case
then you know 5000 seconds is like it's
not like a little over 80 minutes so
it'll be over a little bit over an hour
right between your polls you know
between each for each stock right but
still every 10 seconds you're pulling
some sort of data so you can do
something like that and just like let
this loop run or say you only want to
pull data like you know once a day ish
then what you could say is like you know
you can after the loop is done you know
you've already waited an hour you could
time sleep I don't know like 18 thousand
seconds right something like that which
is like 300 minutes or five hours so
that's kind of how you could act you
know a little bit of a sleeper and this
program will just always run and the
beauty of it is that it's going to print
out the timestamps so if anything goes
wrong in your program you can just it's
going to continue saying the timestamp
and you'll have the history that you can
scroll up on and see you know if
something is going wrong so anyways
that's going to include this this
tutorial now that we have the prices
like I said later on I will show you
guys how to get even better high-quality
data although you wouldn't be able to I
won't show you how to you know get alive
like this this will continuously pull
the data but I will show you guys how to
get better historically better better
historic high granularity data but it
won't be you know you won't I won't be
making a program to constantly pull that
data so anyway that's going to conclude
the price acquisition little miniseries
in this playlist and the next video is
what I'm going to be showing you guys is
how the next step right so how do we
actually plot this data and kind of
display it visually and then later on
I'll show you guys you know how we can
start performing analysis and then also
displaying the analysis visually so
hopefully that's helping some of you
guys out as always thanks for watching
thank you for your support your
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>