<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Flask Tutorial Web Development with Python 16 - User Registration cont'd | Coder Coacher - Coaching Coders</title><meta content="Flask Tutorial Web Development with Python 16 - User Registration cont'd - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Flask Tutorial Web Development with Python 16 - User Registration cont'd</b></h2><h5 class="post__date">2015-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PiphizBQJho" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
part 16 of our practical flash tutorial
series in this video what we're going to
be doing is actually adding our
registration form to our register page
function here and the last video I did
say that we were probably gonna have a
full registration process down in this
video unlikely
sorry I lied we've got to cover this
adding it to our HTML page and password
hashing all all before we can actually
do this so it's going to take a while
but anyways let's jump in and see how
far we can get so to our register page
let me go ahead and make the font a
bigger because I made it small so I
could read everything real quick before
but now we're ready to continue along so
we've got all this so far and then we'll
come down here we'll leave the trine
except we'll leave the connection
actually let's get rid of the connection
we'll come back to that in a little bit
so first we want to try and the first
thing we're going to say is form equals
registration form and then in
parentheses request dot form okay so
that's just giving us this form that
we're going to inject into our page here
in a minute so when we return the render
template we're going to pass through
this form variable into our HTML page
and then we can actually render the form
based on the information contained in
our form variable so we'll still be
passing passing it through but we won't
actually be building the form as we
normally would have to but you'll see
what I mean in a minute well in a few
minutes okay so for me equals that now
if requests dot method equals all caps
post and form dot validate so what this
is asking is first of all if the method
is a post ie they hit register you know
the register button so they're making
attempts to make a registration and the
form has been validated ie we have two
passwords filled in they match
uh they have a you know a user name
field all that kind of stuff okay it
right they have to have a minimum of
four a maximum of twenty s this also not
only does that mean that the minimum is
for the man's mom is twenty it also
means you have to have something in that
field same thing with the email password
it's required confirm is also required
to match passwords so but the transitive
property both these are required and
this is also required
so if request that method equals post
and form in the form is validated we're
ready to continue along so first we're
going to say their username so the
attempted username is going to be equal
to what well it's going to be equal to
form username username data so form is
in reference up here at role its
reference to this which is in reference
to this class so form dot username is
this right here and then text field
returned some information and dot data
is going to be the data that the user
put in so dot data will be whatever they
fill in to this username variable okay
so that's username and then email is
going to be form
dönitz email dot data and then we have
down here password now at no point
besides when you just write when you
collect that password they're going to
have to you know send a password over
but immediately before you start playing
with any password using them whatever
your immediate reaction needs to be to
encrypt that password so password is
going to be equal to UM Mobarak right we
don't have it just yet but we're off to
grab that real quick but sha-256
underscore crypt dot and crypt encrypt
uh and then we want to encrypt the
basically altogether the string version
of form dot password dot data so first
we need sha-256 crypt and then we're
also going to need um really probably
one more thing but we'll get there so
first let's go
heading get sha-256 script so let me go
here so back to our console here sir
let's do pip install sha-256 underscore
correct um actually you know what hold
on let me go yeah actually what we need
is pass lib pip install pass lib okay so
we have pass lib now what we want to do
is go to the top of our init script here
and we're going to go from pass Lib dot
hash import sha-256 underscore crypt so
this is a big um just the it's passed
lab which is a library for handling
passwords you hash passwords and we're
going to hash them with shop 286 also
while we're up in our imports are going
to import one more thing and that's
going to be from my sequel DB import
escape underscore string underscore
escape string as and we're going to call
it fort and the reason why we're
importing this and calling it fort is
escape string is going to escape any
sort of SQL injection type stuff so
generally an SQL exception is going to
start with say uh I can't speak uh like
an apostrophe basically uh and then
there they might do some stuff and then
they're going to start at you know
injecting SQL queries so the way SQL
injection works just for really quick is
when we actually run let's say an insert
query you can run the insert query and
then you could append more queries to
the end like if you the programmer could
do it that way so what people do when
they do SQL injection is they're going
to say you know my username equals
something seemingly legitimate and then
they're going to close off the SQL query
and then they're going to add an SQL
query literally within the username
field or the password field or the email
field so you don't want people being
able to do that so to get around that we
can use escape string and it's not a
hundred percent perfect
but it's pretty good so we do that and
we also obviously need to hash the
passwords so we've got those and now
ready hold on my mouse is super
sensitive anyway so we have that now
we're ready to go back to our register
page so coming on down the password
equals this now I'm going to show you
guys just what this does this is
actually really cool indeed even if you
don't really understand encryption that
much this should be very impressive so
probably in the next video I'll show
that I'm just hoping to get through this
register page but we'll see anyway see
and then con equals a connection which
is connection which is what we imported
above from DB connect and port
connection now we're going to actually
execute a query so we're gonna say X for
execute you actually don't have to
assign anything to variables especially
if you're just executing an insert the
only thing you would have to assign to a
variable as say a select query or
something that would actually return
something but I like to assign it to
variables anyway so C dot execute so
this is cursor execute now we're going
to execute a sequel query and what we
want to do is select all I guess I
actually misspoke there so we are
actually selecting and what we're
actually going to do here is we're
checking the database to see if the
username already exists otherwise you
might wind up with users with the same
username right you can't have that so
select all from users so select
everything from the table of users
asterisks asterisk means all where
username equals and then we have some
logic here or some variable basically
and what this is just doing is we're
equals some variable and then we do
comma and then you put the variables in
order of your percent s's so you'll see
that later on you might have where
username equals percent s and I don't
know email equals percent s so you would
put them in username email order in
these parentheses but and also if you
want to learn more about again SQL
queries I do have some my sequel
tutorials with Python but you should
learn quite a few here anyway and then
again we want to
remember we imported this escape string
as thort because we're thwarting jerks
ha
so the wort and then what are we trying
to thwart while we're warding the
username username let me make sure I did
that right yeah and then that so just
make sure that all clears out then we're
going to have an if statement if int X
is greater than um zero we're gonna say
we're gonna flash and if yes if it's
hold on that doesn't make any sense
we'll have to check that in a second
that's what that's what my code actually
says but that's not quite quite what we
want actually you would want it
I believe the length of X we'll have to
check that Oh get through uh that's
pretty silly error if that's the case uh
but if that's case we're gonna flash
that username is already taken please
choose another x equals select off I
just find it really hard to believe
if the int of Len of X I'm just not even
going to go with that must be just a
typo or something anyway that username
is already taken please try out another
and then we will return render
underscore template register HTML and
form equals form when we still need to
make that registrar to HTML template as
well so that's if this is greater than
zero especially if the length of rows
because x is going to execute the Select
query and then the Select query um
basically is going to return in order or
basically rows right each row of data so
if the length of that of those rows is
is greater than 0 that means there's
already that username in existence so
that user can't have that username else
will actually want to run an execution
so else we would say see
dot execute and we will insert insert
into users and then here we put the
columns so username password email and
tracking so you insert into users and
then these are the columns that we're
going to insert and in the order that we
will be inserting stuff so insert into
users that information and then we're
going to now have values and that's
going to be what are we inserting and
then we have one two three four things
so that's percent s a comma percent s
comma percent s comma and one more
percent s and then that's basically the
end of the query but now we throw in our
actual variables here and the variables
again is going to be a tuple for long in
the order of username password email and
tracking so what do we need to actually
wart again well that's anything to user
input so username password and email
those three need to be thwarted okay so
we're going to have the first one will
be the worked a username comma sorts
password comma Swartz email comma and
then the tracking will just be our
version of tracking but just in case
we're stupid
and for some reason and we have tracking
that actually corresponds to some sort
of injection by mistake will thwart that
as well you might as well and and for
now the first bit of tracking that we
throw in here is actually going to be
introduction to Python programming so
again tracking is what are the topics
the user has viewed so in our case as
soon as someone registers this is the
page that we're going to send them to so
we're going to go ahead and say that
they've done that tutorial so this page
is like a landing page that just kind of
explains how Python programming networks
and it's a you know basic introduction
to Python as well so that's this page
here so this would be the
landing page they're sent to on my site
so it's got you know some information
here some stuff on console how this page
is working we've even got a little
embedded console here
what is Python do what is a wrapper we
check this stuff anyway it's a nice
little introduction page so moving along
uh so that's what we want to insert with
our query and that's our whole query
there and then anytime you are doing
inserting into a database it's kind of
like modifying a file right when you
have a text file you might write in that
text file but if you write in that text
file you pull the power plug to your
computer is that text saved no if you
were using maybe Google Drive or
something it is but is that txt
generally say no it's the same thing
with database you you insert into that
database but until you do the following
con dot commit it will not save to that
database you'll actually have kind of
like a little temporary kind of thing
there and it won't actually save once
we've committed we're going to do we're
going to flash and the message that will
flash to the user is just gonna be you
know thanks for registering okay easy
enough now the other thing that you'll
want to do is see dot close and then um
so that closes your cursor then we're
going to run a con dot close and the
idea here is that you're going to close
your connection because sequel or just
database connections in general are
going to take memory now we're going to
have one more thing which we actually
have not imported and that is GC and GC
stands for garbage collector and then
dot collects now sadly you've probably
never needed this code in your life
you've probably never seen it thought
about it or anything
Python is pretty darn good at garbage
collection by garbage collection we mean
clearing out unused cached memory for
the most part but for whatever reason
when we make a webserver with Python and
flask it suddenly does not just collect
its garbage okay so I use GC collect and
that kind of helps us keep a rein in on
the memory usage or the memory waste
basically so now
we need to go to the very very top and
just import G scene okay and that's just
again garbage collector it's Python and
for whatever reason we it's useful I
find that it's the connections to the
database that caused the trouble so
every time I have a connection to a
database at right after closing I do GC
collect maybe it's not the best way the
most leat way ever but it works so
that's what I'll teach so anyway uh
we've done that now we have a couple
more things that we want to add I forgot
about a session so we come to the very
very top now let's go up from flask
import all this so we're gonna import
one more thing and that's going to be
session and what this is is it's a good
way to track your users session via
cookies the other thing you can have is
gee I don't really tend to use G but G
has a lot of fancy stuff definitely look
into it I tend to do everything via just
using session but G is pretty good it's
good for tracking what your user is
doing so anyway uh coming back down to
our function here G see that collect
after we've collected we want to do
session in sessions basically a
dictionary so we're going to do session
logged in equals true and you can
actually add your own stuff to this
dictionary so that's why I like session
you can basically save anything to this
session in the session again is like a
cookie so you can save all kinds of neat
information to this session and then
so-so session logged in equals true and
then we're also going to set this user
sessions username we want this username
to equal whatever the user name actually
was at a time and then um we are going
to return the redirect redirect and then
URL underscore for and normally we would
do the URL for that intro to
so we're just for now we're just we'll
return them to the dashboard until we
have that intro page I'm not really
probably this tutorial I won't add it
but maybe we will just for kicks or
something but probably not so we do that
otherwise outside of this elf's else
statement we have outside of this else
right here we have we solve this if way
way up there and if that runs great
we've done a lot of cool stuff otherwise
really nothing has happened
so we just want to make sure I get this
right so we've got try if scrolling down
okay
if nothing else runs we'll just return
render template and the template we want
to render is register HTML the parameter
one of the variables rather that we want
to pass through is going to be form and
again we're using the scripting or the
line by line nature of Python to
basically we're using that as a form of
logic here we run this if statement if
this if statement runs
we either render the template here or we
were under the template here period uh
otherwise we will pass along and we'll
render this template okay so that's how
we're kind of getting away with that and
we also return the string here if that
happens to fail which is very messy
returning straight up string keys and
bad idea you should return something
that looks a little better than that but
hopefully you're not hitting that string
E and eventually you would actually want
to hide that error again we put him
there for debugging purposes but once
you're done debugging take those errors
out because the only reason people
should be seeing those errors if there
is if they're up to no good so you don't
want to always leave those so uh that
should be it for a register page we
might have some typos here but we'll
we'll end up finding them soon enough
now I believe the only major thing left
is to actually create the register HTML
page so we'll probably do that in the
next video and then we really will have
a full a registration process and then
in the video after that I'm going to
show you guys this password hashing
because it's important that you
understand what's going on there that
way if you choose to do it your own way
or something stupid like that
you can understand how password hashing
ought to work
so anyways uh stay tuned for those two
things as always if you have any
questions or comments please feel free
to leave them below I don't really
expect too many other questions anyways
because you won't really know if this
works or not until the next video so
anyway but if you do have them questions
or comments leave them below otherwise
as always thanks for watching thanks for
all the support in the subscriptions
until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>