<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Getting all company pricing data in the S&amp;P 500 - Python Programming for Finance p.6 | Coder Coacher - Coaching Coders</title><meta content="Getting all company pricing data in the S&amp;P 500 - Python Programming for Finance p.6 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Getting all company pricing data in the S&amp;P 500 - Python Programming for Finance p.6</b></h2><h5 class="post__date">2017-01-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/baCAFPHb1o4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
part 6 of our Python for Finance
tutorial series in this video what we're
doing is working with the list of the
S&amp;amp;P 500 companies that we just grabbed
and now we want to do is actually get
all the data on those companies so
that's what we're going to be doing here
so we're going to need a couple new
imports actually so first of all we're
going to grab a import import state
daytime as the tea we're going to import
OS so daytime for the same reason we use
it for OS is to create new directories
for us then pandas will need pandas
there's also import pandas as PD and
also import pandas underscore data
reader dot data app as web and that
should be all of the new imports that we
need now
we've already saved the S&amp;amp;P 500 tickers
there's actually no need for us to have
that anymore
I'm going to create some space now and
we're going to begin a new function I'm
going to call this function get data
from Yahoo so let's go ahead and define
get data Brooke from Yahoo I'm also
going to have just a simple reload sp500
equals well what this will do is
basically because we're no longer going
to just be calling this raw we're going
to call it in this function as we
continue building functions here
basically what's going to happen is each
func one function is going to build on
the previous function so we'll run into
test them by just like writing them out
like this but in most like in reality
it's going to be one final function
that's going to just work from these
previous functions
so anyway reload sp500 basically this
will just let us basically if reload
sp500 if someone says yes that's true i
want to do that basically tickers
tickers will equal this what we just
wrote there now if they didn't say that
else we're going to say with open we're
going to open that tickers file right
here so I'm not
just going to copy all this haze we're
not going to write bytes we're going to
read bytes now we're going to say
tickers equals pickle dot load s so then
we'll have our takers list once we have
that the other thing we're going to do
is we're going to take all of the stock
data and we're going to we're going to
convert all of them to their own CSV
file and we're going to store them in
their own kind of like in a directory
basically the reason why we want to do
this is generally when I'm working with
an API or any sort of data collecting
tasks especially if I'm like parsing a
website or doing something it takes a
while I like to take the entire data set
if I like all the data that you're
willing to give me I'm going to take it
all I'm going to sort it that way I
don't have to repin you because as
you'll soon see in a second here um
getting all the data from Yahoo takes a
long time it's going to probably take
you 20-30 minutes or something to get to
regrab all the data and to do that every
single time we want to iterate through
everything and get pricing for all these
companies it just would get outrageous
but if we store all of the data locally
we won't have to go through that mess so
that's why I typically will do that but
in this case I know that I'm pretty much
I think for this tutorial at least for
the first many videos or the only column
I'm interested in is adjusted close so
in theory I could take all these and
combine them all in one function rather
than saving it all and then later
combining it and saving that but there
might come a time where hmm what if what
if I want a high minus low a low column
do I want to spend another 30 minutes
pulling from Yahoo I already spent all
that time why not just save it so as
long as the data is not huge which in
this case it's not it's easily saved I
think it's like less than 500 megabytes
I'm pretty sure so yeah then I'll want
to save everything I can so anyway we're
going to do that so to do that we're
going to say if not OS if not OS up past
dot exists we're going to check to see
if something exists
we're going to check for stuff yes so if
that directory doesn't exist oh if that
make stirs stock yes so if that
directory does not exist locally go
ahead and make it now we're going to
specify start and end times
same as before DT date time I am just
2000 January first I'm going to go ahead
and copy this paste 2016 12 31 and
that's actually end and now we're ready
we've got tickers ready to iterate
through the tickers and grab all of this
ticker data so for ticker in tickers
what we're going to do is basically hmm
I'm kind of sigh what I want to do here
you'd probably want to have another one
like this is reload sp500 you probably
have like another list that was like
reload data or something like that but
what I'm going to go ahead and save for
now like you probably want to encase
what I'm about to throw in here with a
real if reload data do this else just go
ahead and rewrite all these data frames
but I'll just keep it the way it is for
now if not though s that passes right
basically what we're trying to do right
now is just like simple research so I'm
not thinking that we're going to update
the prices every day but these are daily
prices so in theory every single day you
would read eight all this data but
anyway moving along if not OS dot path
exists exists and now we're going to
check for that full taxes in this case
with stock DF so lash something dot CSV
so we're trying to see does this CSV
file exists and then it's the formatting
here will be for the ticker so if that
file doesn't exist we're going to take
DF equals web dot data reader and we're
going to read whatever for the ticker is
from Yahoo and then start/end then DF to
underscore CSV
and it's this right here so I'm going to
copy this okay that's the path to the
CSV else print already have whatever it
is and then we'll do dot format ticker
now just in case some people are
watching that how have like really
really slow internet or whatever you
don't have to do the entire sp500 so to
continue following along at least for
like the first many videos in this
series there's no need for you to grab
all 500 companies so if you don't want
to grab all 500 companies don't there's
not you won't be missing out on anything
super special it's just you won't have
all the data but you're not going to
really miss anything so you could say I
just want the first 25 tickers or 100
kickers or 250 or whatever so if you do
have a slow internet connection you know
I would say just grab like at least 10
or something like that just so you can
sort of follow along but anyway because
500 even on my internet was pretty good
internet it it takes a while so anyway
so that's 2 the entire ticker list
whatever ticker list you might have then
we can run get data from Yahoo and I'm
just going to start running it just to
make sure it's actually working and then
otherwise I'm gonna cut X not going to
sit here for 20 minutes and watch this
run yeah we probably should have said
something about where we were that's
okay ah hmm
I can't want to print ticker just so I
know it's working I'm pretty sure it's
working I see it doing nothing so yeah
okay so now we're grabbing I can't move
it it's running oh my good is yeah so
I've got multiple screens that ran on to
a different screen anyway okay so it saw
that it already had like a lot of
companies already and then now it's just
going through pulling all these
companies so just to make sure
everything's working as we intended
let's open up Python for Finance there's
our new stock TS and sure enough here
are all of the CSV files in question
cool so it's just populating them again
it's going to take a while so far since
I've been yakking we've got a hundred
and ten already so that's not too bad
but yeah it can take a while now I also
have not found that Yahoo throttles this
is like a lot of requests in a short
period of time I haven't needed just
because saving the data frame takes a
long enough delay to the point where I
haven't needed to throw in a time dot
sleep anywhere but you might find that
if you're getting throttled by Yahoo ie
basically we just we just did 100 if in
10 minutes we still don't have another
new hundred we've probably been
throttled so you might want to add like
a time dot sleep or something like that
but so far I haven't had any problems
with it so okay great we've got all the
data from Yahoo basically in the next
coming tutorials we're going to be
combining that data and then searching
for relationships so if you have any
questions comments concerns up to this
point feel free to leave them below
otherwise I'll see you in the next
tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>