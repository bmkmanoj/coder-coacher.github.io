<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Pipeline - Algorithmic Trading with Python and Quantopian p. 5 | Coder Coacher - Coaching Coders</title><meta content="Pipeline - Algorithmic Trading with Python and Quantopian p. 5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Pipeline - Algorithmic Trading with Python and Quantopian p. 5</b></h2><h5 class="post__date">2017-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NS-512UcERM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up everybody welcome to part 5 of
our quanto peon tutorials and 17 of the
python for finance series in the last
tutorial we just kind of introduced the
research environment showed how you
could pull in some imported data from
quanto peon showed how we can kind of
manipulate that data either kind of play
around with the blaze expression or get
it back into a panda's data frame so
especially if you're like me I'm really
familiar with pandas and I know how to
do things in pandas and I'm not fully
familiar with like all the things I can
do in blaze so that's something I
personally have to look more into to
learn more about using but it's also
super quick and super simple to get it
out of a blaze expression so and it
might be useful too I'm not even sure
that the commits had to get it back into
a blaze expression to be honest because
I'm sure it's not compute again but I'm
sure there's a way to get back in so
that would be a good starting point but
anyways not on blaze right now so we're
going to be talking about in this
tutorial is the are the basics of the
pipeline
so when quantonium first came out they
didn't have a pipeline and basically you
had to use this like I forget with it
what it was called but it was basically
almost like a sq alchemy if it wasn't
actually an SQL can be query that would
filter your your stocks by really really
rudimentary things basically things that
had to have already been existing in
data and if I recall right you could not
filter by something like price-to-book /
PG or something like that you wouldn't
be able to do that and you certainly
wouldn't be able to like kind of create
your own signal and then filter based on
that signal it just wasn't possible so
at least if I recall right so you
basically had to whittle down your
companies by something really
rudimentary like market cap you to say
okay look I want to consider the top I
think you had either 500 companies or
255 companies that you could consider at
any one time either way it was very
limiting so they introduced pipeline
because you still have to kind of will
down your companies
but you don't anymore
have to only consider 255 or 500
whatever it was you can conserve much
larger amount of companies after they
made other changes to I think it was
mainly just in the whole data thing
anyway what pipeline does is it gives
you a really quick and succinct way to
whittle down data sets and it's going to
be a lot quicker than running functions
on the data frame itself because what
pipeline is going to do for you is it is
going to return a data frame and what
you know your data sets are going to do
like when you import data it's going to
it's a data frame or a blazed expression
if you're in research but it's a data
frame especially in the actual
algorithms what you're doing your back
tests as far as I recall right - any way
you can you can map functions to data
frames and use that on your own
but the pipeline is way faster I mean
it's just way faster it's very
unfortunate if you have to do your own
thing outside of pipeline luckily you
can do basically everything in pipeline
but that's the point of pipeline is to
basically do all your functions that
you're trying to do on your data frame
do it in pipeline otherwise you're going
to you're not going to be happy because
it's going to take a really long time to
do it outside of pipeline so with that
let's go ahead and jump into it because
I think the best way prize to learn is
just get into it so first we're going to
do from quanto p and pipeline import
pipeline easy enough now let's go ahead
and do like a really simple make
pipeline function so just okay define
make underscore pipeline and then we're
just going to simply return pipeline so
what this is going to do for us is
normally in here is where in this
function is where we would filter down
our companies but you should see there
has been no filter right so if for
example we run this pipeline so first
let's do from
toby and research research import run
pipeline now let's actually run it so
we're going to say result what is
happening why am i falling apart here
results equals run underscore pipeline
and then you're going to specify what
pipeline are we going to run what we're
going to do make underscore pipeline do
not forget your brackets here or your
you know to open and close parentheses
you actually want to run it you're not
trying to pass the object you're the
function or I don't even know if it's a
method or function see I guess it would
be I don't know anyway not important run
it but don't forget those otherwise
you're going to get a nasty error and
then we're going to pick a start date
and an end date so start date will just
let's just do the same dates here we're
just going to 2015 you do anything you
want I'm going to 2015 oh is this not
let's see what are we so how we
converted this this is what happened I
don't think I'll lose this phone a copy
this just in case
used to be code I don't know how that
got switched anyway 2015 Oh 5 - 0 5 and
then end date equals and again we'll
just we'll see the same day normally you
wouldn't do this but pipeline is going
to pull from like thousands of thousands
of companies and then when we go to pull
pricing information and stuff if we just
on one day it's just going to go a
little quicker and for now we're just
trying to show you examples so I'm going
to run that cool and just for the record
let me run this without the the brackets
just so you see the error that you're
going to get because a lot of times
there's not not to the fault of quantou
being errors in general are just hard
so here function has no attribute to
execute plan the only time I've ever
seen this error is when I forget to put
my my parentheses here so just just a
warning because this is a really common
thing to forget to put there
okay not only done that let's go ahead
and result what do you think result is
alright the pandas dataframe of course
actually what is he let's do der results
so I'm not sure because pipeline came
from research a run pipeline did so
let's do or not der type okay it is a
dataframe
just making sure result that head and so
what we have is a bunch of takers and if
we did a Len result we would see how
many we have in this case it's 8240
tickers so we have obviously we have not
filtered this at all so now let's talk
about how we might actually filter it
and just in case I'm going to add some
space here I just don't want to run over
my my face or have my face run over the
code rather so now we're going to do is
basically we don't need to import
pipeline again the only thing I'm going
to import again is sentiment because I'm
pretty sure did we pull it out here no
we didn't I guess I want how all but I'm
pretty sure this is going to give us a
problem if I don't
and then the Q 1500 I think yet we've
already imported so I'm going to I'm
going to just rebuild the make pipeline
function now so define make pipeline and
if we get an error it only helped me to
show you more errors whoops no doubt
okay paint line I want it to go away I
don't want to stare at that while I
build this function much better make
pipeline so I'm used to like when I'm
typing in a field for example like let's
say like a chatbox on something right
you press shift enter to not send the
message right and go to a new line and
you press enter to send the message so
that's why here I'll probably keep doing
that doing shift enter which runs it on
an iPod on notebook anyway I'm an
amateur sentiment factor is going to
equal now sentiments which
we imported dot sentiment underscore
signal which is a column so remember
sentiment comes in at the moment it's
it's through a blazed expression but we
can we can treat this very much like a
panda's data frame so sediment signals
just that column and then we're going to
apply a factor in our case that factor
is latest really simple factor now we
have factors and we have filters and I
think we even have something new with
classification maybe or something anyway
let's just go let's go to the docks and
let's scroll down to pipeline you've got
let's just let me see if I can do factor
filter yes so you've got base classes
here you got factors filters and
classifiers we're going to talk about
that for now but a factor basically is
going to give you a number it's going to
give you a number back now a filter is a
boolean right it's going to give you a
true or false so and then a classifier I
guess will give you a categorical output
and that's fairly new and I don't know
about bound column but anyways at least
to start we're just going to concern
ourselves with factors and filters and
just know again a factor will give you a
value filter will give you a boolean
expression or a boolean expression
anyway this is our factor that we're
going to use okay so now we're going to
say what's our universe so our universe
of companies that were willing or we're
interested in knowing information on
basically so that's going to be the Q
1500 us and that is also some things
we're going to require the parentheses
and where's my antennas and sentiment
underscore factor needs to have the
attribute of being not null right we
don't want to have an nothing there
because it is not there we don't care
about it so that's our universe and
we're going to use the universe as a
kind of screen for a pipeline which I'll
show you in a moment so pipe is now
going to be equal to a pipeline
and it's going to have columns and these
columns will be basically whatever you
can call whatever you want but it makes
sense to the sentiment census commands
there we go
sentiment is going to not equal
dictionary here sentiment sentiment
factor I think the ipython notebook also
makes me type worse normally not as bad
and then like for example we can say
Long's positions that we're going to go
long we could say something as simple as
where sentiment factor is greater than
or equal to four and then we could say
shorts shorts are where sentiment factor
factor is less than or equal to negative
two as I said before it's a range of
negative 3 to positive 6 where negative
3 is just as negatives as 6 is positive
so negative 2 is just as negative as 4
is positive ok now when we get to alpha
lens I'll I'll briefly explain and when
we do the back test why like we can't
really test this specifically in alpha
lens at the moment and in hopefully the
near ish future we can because alpha
lens is already kind of at least the
open source version of alpha lens not
the one that's on quanto peon already
supports what would make this better but
also it raises it another question as
far as whether or not you actually want
to use that but if I forget to to hit
that someone remind me but hopefully in
the next tutorial we cover alpha lens
I'll explain more on this so yeah just
just wait but in our algorithm what
pipeline returns is a data frame it's
going to be a data frame of cop you know
the index should be like your tickers
it's basically double index Oh it'll be
indexed by date and tickers and then
you've got sentiment and then they'll
have Long's and shorts long and short
will just be boolean values and then
every day of trading you can very
quickly get that information
and this is a perfect example of like
doing it here in this pipeline is really
quick this operation will happen very
fast whereas if every day you actually
did like a map of a function that map's
true or false based on these parameters
that that would take it not four to six
times longer it would take like ten plus
times longer it takes a very long time
to do things outside of pipeline so you
really want to do everything you can
inside pipeline okay once we've defined
our columns we are ready to add the
screen which is going to be the univer
Universal companies and screen universe
and we're done I'm just trying to make
sure I close everything off here looks
good to me so when we're done we're
going to just simply return pipe looks
good let's get a result let's say result
is equal to run run pipeline
what's the pipeline we want to run here
is make pipeline don't forget to
parentheses start underscore and in fact
let me just let's grab all just copy
this actually I'm going to change these
dates so whatever anyway true wait so
2015 let's go o 101 end date 2016
oh one oh one so the year of 2015 is I
think a good year to test against
because 2015 overall did like nothing
but between that mark the market goes up
down and then back up again to basically
neutral so it's a good year to kind of
test against now overall the stock
market doesn't is it neutral it rises
over time so your first place to test I
think is great for the Year 2015 and
then you want to look at you know the
whole the whole timeframe and also maybe
even since very specifically you know
maybe around 2007-2008 kind of time for
when the mark is very bearish and then
overall it's just mostly bullish
anyway I should have run this let's run
this because we might actually wind up
yes sure enough we ran up with an error
so few old objects has no attribute
latest so I'm unclear why I get this
error split like why in code I get this
error but the reason I'm getting it is
for some reason sentiment has been
converted which is weird because we did
blaze compute on Bank of America
sentiment not sentiment right I don't
know but anyways this probably clears up
if I just rerun all these things
almost there maybe I don't know where I
am continue make pipeline good good good
Oh am I still hitting it on result
fascinating I'm not sure why I'm still
getting it on result let's see because
all about the sentiment signal field
object has no attribute least let me
fine let's go Landru so let me just go
here and let me just do from quant opium
dot oh here's what the problem is
okay I would normally play edit this out
but I'm going to leave it here just
because this is probably a valid issue
so up here we're doing client opine
interactive data dot syntax import
sentiment that's a blaze expression down
here here we don't want to be using
blaze we want to use the actual pipeline
data I told you I would fix this before
I got to it and I didn't sorry okay from
quant opium pipe line data Centex import
sentiment
there we go so that was the issue so
don't forget to get out of the
interactive data and use the actual
pipeline data when you're going to try
to stuff it through a pipeline I wonder
if you converted it if you did please
compute if this would have been
acceptable it's a good question actually
anyway not important so we got our
result let's go ahead and just look at
it real quick result dot head sure not
there you can see even with the dual
index here date and then all the
equities we have yes whether we belong
as short this is going to be useless to
us until we get to the B well I guess it
went in this totally mises but anyways
we're not going to use it until we get
to because we can't do the whole bit
never mind I'll explain mouthful ends
what we can use that anyway we have the
sentiment data and what we're interested
in now is to know not I guess it's a
good time to talk about it not whether
or not not necessarily whether or not
you know 4 and negative 2 is a good
number right because that's our strategy
our strategy is to trade based on you
know we're a zoom a sentiment of 4 or
above is good and and negative 2 or
below is bad that's our strategy what we
really want to know is is there a signal
just is there a signal in this data in
this sentiment data that's our question
we want to know first is there a signal
and then if there is let's worry about
making a strategy that's going to
exploit that signal but you know making
what we're doing here is first making it
like before before we had research
environment we're first making our
strategy and then we're using the
strategy to tell us sort of if there's a
signal but that's not that's not the
best way to go about it so in the next
tutorial we are going to be taking what
we've got here and running it through
alpha lens to hopefully analyze alpha
factors so that's what going to be doing
in the next tutorial sorry for my
mistakes but hopefully my leaving them
in here will only help you because
seeing some of these errors are like you
know
these are like these are errors that
I've never seen any other place besides
on quanto bein so I figure it's probably
a good good place to good good thing to
leave in so I'm going to keep leaving
them in so anyways if you have questions
comments concerns if I if you've got
something you could improve do let us
know otherwise I will see you in the
next tutorial where we talk about a lens</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>