<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Training convolutional neural network for self-driving - Python plays GTA p.11 | Coder Coacher - Coaching Coders</title><meta content="Training convolutional neural network for self-driving - Python plays GTA p.11 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Training convolutional neural network for self-driving - Python plays GTA p.11</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/I1qT-VbA_MM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
part 11 of our self driving car scooter
thing so what we're going to do now is
like we built the train data we balanced
the training data so our neural network
more accurately predicts what we should
do correctly if we're at least if we're
going to draw an arc max on it and stuff
anyway we've we've we've built the
training data now ready to actually
train now there are tons of ways and
things that we could do here obviously
because it's going to be pixel data
we're going to use a convolutional
neural network we have a lot of things
all the choices that we could make I'm
going to use Alex net now I'm not going
to flight out Alex Matt I'm going to
I've already got it here first of all
you can you can find it if you just
Google let's ETF learns Alex here we go
this is probably it yes that's about
right so I'm just going to copy and
paste it in and that way we don't have
to actually spend a bunch of time
writing it although I've made it select
some slight changes but anyways so what
I'm going to do is so you probably go to
github not that one but I'm just saying
that's that's where I found it so I'm
going to create a new file I'm going to
call it Alex net so it's Alex net dot pi
we're going to edit that and I am going
to copy paste and then I'm going to go
ahead and take this don't think we need
the utf-8 thing this cool so of course
we're not going to be doing this either
let's just keep the references we don't
need the flower data set
and we don't need this either okay cool
hopefully Alex doesn't sue me now sure
is great guy so so this is what we're
using now for the people or person he's
like a copy and paste well like I was
saying before I don't want to have a
tutorial on something I've already
covered so if you if you don't know TF
Lauren hey by all means learn TF learn I
have a tutorial on I've also got
tutorials on tensorflow TF learning sits
on top of tensorflow so it's probably
wise to understand tensorflow and then
get in a TF learn first also you can't
see it on the screen but anyway part of
this other part of the series part of it
is a convolutional neural network where
you can learn about that as well with
beautiful pictures oh my gosh these are
perfect and then also how to apply a
convolutional neural network in tensor
flow and then here's TF learn and then
also trying to think if we use there's
even a 3d convolutional networks yeah so
if you want to learn more about it I've
got tons of tutorials on that I'm not
going to go over it and I'd also don't
want to type all this out so you're
welcome now yeah
so basically we're employing the two
dimensional convolutional layers with
max pooling input data to drop our
regression and all that fun stuff
so then here are layers input data with
I
okay we're going to pass that in so
that'll be like you know 80 60 yeah so
this is slightly changed from the other
Alex in it anyway quite a few layers
here saw them are fairly like these are
pretty small layers but these these
fully connected layers are pretty large
so if you're having a problem doing any
processing like if you get the whole
like I forget if the error looks like
but it's something like couldn't figure
out how to what to do with 0 0 a.m. okay
that ran out of memory so make these
layers smaller try to keep these these
are not very large layers try to keep
them if you can but yeah you can make
these weights male probably get away
with 256 or 512 or whatever I'm going to
keep it this size though all right so
that's Alex net dot PI for you now what
we're going to do is actually build the
train model pi and this one I'm not
going to copy and paste because this
one's a little more con like something I
haven't covered so I'm going to copy and
paid well a little copy/paste to make a
new file train model dot PI edit that
clear it out and then what we're going
to do is I'm just gonna call this and
then I'm gonna say import numpy as NP
from Alex
net we're going to import Alex net now
rest set some constants which will be
wit which was 80 height was six tlr4
learning rate is one negative three
eeep ox we ate someone got pretty
irritated with me for saying epic deal
with it I think I'm going to keep saying
epics actually ate ethics model name
equals hi GTA 5 - we'll call it we'll
call it car just because we might do
other things with PI GTA 5 you call
everyone and then I have some variables
in here we want to have some variables
just because over time we might have
epics over time we might have we might
change
various things but we might state the
actual model and I'm going to we're
going to be using tensor board so we can
have see the progress of the model over
time as it rains and so it's easier if
you have unique model names also so we
can save that model
just in case we want to revisit it in
the future anyway that format we'll just
do learning rate we'll call this
Alex net and then we'll stay in pucks
pucks actually it's a we'll say Alex
maybe too because slightly modified Alex
in it now what we're going to do is
model equals Alex map which we've
imported above Witt types learning rate
boom we've got our model we want to have
model and for sure in a separate
function at least because to train it's
not necessary and but but when you save
the model in order to reload a model you
need to have a previously defined model
and those two models must be identical
as far as their like shape and all a
model is when you save it it just saves
the weights of that model so anyway
that's kind of why I want to separate
that out anyway train data equals NP
load and you want to load training data
underscore v2 dot numpy and then we're
going to say train B equals train data
and we'll say up to will doing negative
500 and then test equals train data I do
I dead space they're up to
or now I'm sorry - 500 onward we Ellis
goofed now we're going to say is we're
going to define basically X&amp;amp;Y X is your
feature sets why are your labels your
targets whatever so x equals NP terrain
we need to reshape these this will be I
0 if for IBM train so it's just list
comprehensions in zeroth element this is
the image data
so high energy data the pixels I won is
the actual output so the one hotter a
that says the I go left straight or
right and then what we want to do is we
need to dot reshape to satisfy things
negative one by width by height by one
because it's grayscale now let's go
ahead and copy paste y1 um and we don't
need to reshape and that we don't even
really need the numpy array of thing I
think that'll work
so now what we're going to do is just
take this copy paste and we'll say test
X test Y and then train becomes test and
that's it now what we're going to do is
model stock fit and then the first
little dictionary here input is capital
X the targets are capital wide number of
epochs equals epochs outlet the
validation set will be equal to a new
line equal to let's do I think I'm just
going we should probably get away I
think we just copied this boom
parentheses paste and then it's test X
Tess why so this look is like out of
sample testing basically so we can kind
of see how how good or bad we're doing ,
snapshot steps will be 500 show metric
equals true run ID model name so we're
going to have the run idea basically
this is so we when we it'll show up in
touch board and all that fancy stuff
okay so we'll do that also I'm just
gonna throw in a comment here let's say
if we were going to run and test with
tensor board it would be tensor board -
- this is just for Windows by the way
log der equals normally you could just
say log but that's not how it works on
Windows you have to do this like flu
stuff just click you have to specify a
parameter there I don't know why but
it's in one users this is now for me age
just give the full path desktop PI GTA 5
- phase two - videos slash log and a lot
the check do we do we properly put I'm
pretty sure that was part of the out of
the Alex net file but let me confirm
that I've put that in Alex net so Alex
net model should specify the log dur I'm
just going to confirm though pull it up
for you
yeah so right here it's going to store
and logged or locally so it should just
create adder here so anyways that's
where we can visit tensor board when it
shows up I'll show you that in a moment
when we go to run this so now we're
going to do is model when it's all done
fittings we're going to model s-save
model it will also just automatically
save it along the way it should anyway
so cool let's run this see if things pop
up again
probably resize Alec's net if it doesn't
fit perfectly and all that but let me
just actually start this running before
I start yakking make sure we don't have
errors it's pretty unlikely we'd get a
first pass through of course epochs not
defined do we define model name 40 bucks
now we just set a puck because
everywhere else we call the epochs on
pretty sure again
dude you're killing fit got unexpected
and a puck alright here we go
nope this one's gonna work third time's
a charm I feel I can feel it
let's go show me some some blue text so
I want to see now there it is some blue
text that's good it's good
pull this up man it's training and we're
off okay um probably a bad idea to train
this an idol I'm not sure what I want to
do about that that's a lot of prints in
Idol look anyway okay so it's training
right now on epoch number uno
there's our loss we want to see that go
down over time accuracy we'd like to see
that go up over time yeah I kind of want
to cook I'm just gonna stop this I don't
want to do this in Idol we want to run
this in the command prompt so anyways
let me right click open command window
here wait 10 years it just opened under
for some reason C colon slash Python 35
Python I have multiple versions of
Python installed so I need to do that
what do we call this was it train model
train models hi hopefully I did close
that other one right yeah I would get it
would get pretty angry with you I
probably run out of memory if I tried to
run
- Alex Nets ok now we're off jump to 40
percent accuracy already jeez Souls ok
it's going back down okay now while we
wait for that to run let's go into log
and in fact let me cancel this sorry I
just want to make sure log is nice and
clean
okay one more try just cuz I moved out
of Idol now while that runs what we want
to do there
Oh's so it's going to save just a log of
information now we're going to go back
and I'm going to open up the train data
train model and this is my like command
basically well you can't see that this
is the command so I'm gonna copy that I
think you lose your copy whenever you
close out idle I probably lost it anyway
I'm going to go ahead now this is still
running I'm going to go ahead and
right-click open command window here
actually you don't have to open it in
here cuz we give the full path once
again to open under for some reason see
I paste no no you may not
so let's go ahead and reopen training
model whoops
copy and paste okay so now we'll run
that that should run intensive board
local directory port 6633 see accurate
we are accuracy over raw I honestly
forget what I can see otherwise
I really don't know I can I could guess
but I don't want to because I'm pretty
sure after serve of raw I think that's
more like the validation set it's like
accuracy compared to the validation set
but I can't remember any weight loss we
definitely want to see that go down and
then we've got momentum loss and bra so
generally kind of what you want to see
is you want to see accuracy continue
going up you definitely don't wanna see
a peak and then come back down
same thing with lost you don't wanna see
it go down and then peak and come back
up as long as this going down over time
that's a good thing when you have
multiple models in your actual log
you'll find them here eventually we will
wind up with multiple models of training
in there but right now we just have the
one you can manually refresh by clicking
on this or no
there's an update or I think it updates
itself every like two minutes yeah every
120 seconds of the update itself but
anyways you can just kind of refresh
this over time and then see as things
kind of change also this automatically
smooths all your lines for you you can
make it super smooth if you want but you
can also see the raw data kind of in the
background there so you could pull it
back and that's how messy it actually is
but it kind of smoothes it for you if
you want that um the other thing step is
well I'll show you these probably later
on I'll show you what what these are
just because I you might not already be
familiar with dense report but I'll show
you these later um so anyway I would let
this run it's going to run for eight
epics that might take a while let's see
where we are still an epic one anyway
hopefully you're training at least
hopefully accuracy is slowly going up on
this set it's a very small data set so
you should be going through epics pretty
quick I'm not quite sure wise is going
so slow to be I'm being honest but yeah
so go ahead and let this train and then
in the next tutorial I will kind of talk
about what where we are now and probably
test the model I might have other models
too and I can't decide I might I might
upload the model because if you're on a
CPU you should be able to run this model
train the model but it will take forever
but you can also use the model on your
CPU and using the model actually will be
slattern out I don't know what kind of
frame rate you could get using the model
but I may or may not upload these models
again this this example is a the very
beginning so I'm not really sure I want
to upload this data just because I think
it's just a waste of space like this is
just kind of like testing if it goes
well we're going to immediately be
moving on
so anyway training seems to be going
pretty well but yeah I'm going to stop
it here we're not going to sit through
all this so in the next tutorial we'll
actually test the output here see how it
does see if we should even continue on
this or if we should just probably stop
hopefully we can continue so anyway
that's it for now questions comments
concerns whatever feel free to even
below otherwise I will see you in the
next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>