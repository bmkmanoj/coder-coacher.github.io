<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Backtesting Alpha Factor - Algorithmic Trading with Python and Quantopian p. 7 | Coder Coacher - Coaching Coders</title><meta content="Backtesting Alpha Factor - Algorithmic Trading with Python and Quantopian p. 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Backtesting Alpha Factor - Algorithmic Trading with Python and Quantopian p. 7</b></h2><h5 class="post__date">2017-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RHmiBA50BN0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
part 7 of the quanto pian series in this
tutorial what we really doing is taking
the factor that we validated and trading
against it in Nashville algorithm so
just like that notebook that we ran
through this is the the same kind of
webinar from Janie also had the attached
algorithm and this is an even less
modified version of that algorithm
basically the pipeline is the only thing
that we changed if I recall right so
again I'm just going to be running
through basically the algorithm that was
pretty much his but I also I like the
algorithm in the sense that it works
really well with going from of the
research environment directly into an
algorithm with like almost no changes so
there's no way I could have written
anything any better anyways so anyway
again just credit where it's due so so
so what we're going to do is you know
we're going to keep this up so I can
copy and paste the pipeline but what
we're going to do first is you know you
go to my code algorithms we're going to
do a new algorithm and we're going to
call this I don't know an alpha a factor
strat awesome okay so we're starting
with a whole bunch of information here
and see my rebalance will keep handled
data my record valve is probably fine to
have in there I don't think we're going
to need handle data because we're going
to just bounce
we're all we're doing is balancing
everyday I don't think we're going to
assign any weights before trading start
we'll keep that pipeline will keep and
initialize will keep okay so first of
all the algorithm from Jamie also
incorporated some differences so let me
pull that oh shoot well here it is okay
so I do want to just talk about them
just because so use just source code so
some of the things I bring in here or
from the investor so is announced as an
acquisition
on target or also business days since
any events and then also you have this
data set here which gives you business
days until the next earnings
announcement and in business a sense the
previous earnings announcement and these
have been shown to obviously impact
price when they announce quarterly
earnings for example so it can be useful
to not trade around these times and
there are also strategies that can be
really good at specifically trading
around these times so at least from what
I've seen you can almost like basically
make a strat like one strategy that
purely avoids these times and then when
these times get close you you you start
up a different strategy and through
combining the two do really well anyway
I just wanted to bring it up with these
these things do exist so if you want to
avoid earnings you want to avoid hey was
this company recently announced as an
acquisition target you can but I'm going
to leave those out I'm gonna try to keep
this as simple as possible so coming
over to our alpha factor we need yes
attach pipeline we've imported pipeline
we got the queue this is the 500 us
we're going to bring the 1500 us and
then we're also going to bring in
sentiment so from climb toes quanto be
and pipeline dot data sent text import
sentiment and now rate it to the
initialize in fact once I pull this over
here and then zoom in a little bit let's
not too crazy now okay and in initialize
basically we're going to schedule a
function for the rebalance every day one
hour after that's totally fine same
thing at market closed for the actual
recording the values that's not a
problem
attaching the pipeline that basically
we're going to make pipeline we can call
that my pipeline so we're going to keep
that and then coming down here make
pipeline
we're going to rule so well
actually let's copy and paste just so we
can be as certain as possible we're
doing the same thing so I'm a copy come
over here and paste okay so it's
basically our same pipeline now I'm
going to do one more thing because I
want to show both because like I think
this is the proper strategy to go with
but because we tested on the whole
quantile thing it can be useful to also
track the quantiles so let's do let's
say sentiment underscore quantile that's
going to be equal to the sentiment
underscore factor rank so we're going to
rank we're going to spell factor right
and then we're going to rank them mask
will be universe and then the method of
ranking will uses average and then we're
going to say dot quantiles - so
basically what we're going to do is
we're going to separate all these stocks
into two quantiles which is what
happened here right - quantiles and that
supposedly on average had some alpha
maybe not a lot of alpha but it had some
alpha so coming back over here cool will
the rest of stuff will just retain so
then we come down to the before trading
start again context output stays the
same context security list that doesn't
need to change either so we're just
going to keep that and then we're going
to get to the actual rebalancing and the
recording of variables so the
rebalancing is where the trading is
going to happen and again this is pretty
much all the way up to this point we've
pretty much worked off of the default or
code we already wrote now as we get into
rebalance this is going to be the actual
kind of strategy logic that we're going
to work with so we're just going to say
the we're going to say the long
securities is equal to context
output context output and then we're
looking for context output for the query
context output is our Long's
and then dot index so it just gives us a
list of the long securities and then
we're going to say long underscore
weight is equal to 0.5 so basically 1/2
divided by the Len of our long
securities so again for the record
Jamie's code but what's happening here
is here we just get the index so the
index is like the ticker or so see if I
can find an output so basically every
day so this printed out because we're
questioning for like many many days but
when you're doing a rebalance every day
your index will just be like this like
your tickers and then the data you have
access to will be these columns here so
anyway long wait 0.5 I'll in the assets
so ok so then what we're going to say is
coming down here we're need the same
thing for the for going short so short
securities in fact let me just copy
paste we'll change this to short
securities short wait don't forget to
fix this I suppose short and then shorts
it's all right shorts yes ok so here we
have basically the weights and the
security so the weights will be
basically well because we're going to
order basically a target percentage so
the target percentage right away this
strategy is been perfectly balanced all
of the time half of your investment
money will be going towards longing half
of it short so that way it's pretty much
always going to have hopefully a near
zero beta because you're almost
perfectly evenly spread across Long's
and shorts of the market
so that's just a really good way to keep
beta as low as possible
without really putting too much thought
into it so now we're essay is we're
going to iterate through our lungs so
for security security and long
securities we're going to say if data
dot can trade that if we can trade that
security what do we want to do we're
going to order underscore target percent
that security and then short weights so
that'll be like the percentage and
that's all we need to do there now we're
going to go ahead and just take this
copy come down here paste and then we'll
do the same thing for short security so
short securities data contrary to your
short weights oh why do we fish that's
weird long wait long wait
there's going to be an error long way
short wait okay let's look through this
one more time for you to screw this up
long sex security security sure way okay
cool so and in fact this needs to be
minus 0.5 okay so there's that and then
now if for whatever reason the strategy
is not in our Securities anymore what we
need to do is get out of them so for
security in context is just not running
over my head here context dot portfolio
dot positions so for security in our
positions
if data dot can underscore trade that
security and that security security is
not in long securities and security not
in short securities then what we want to
do is order target percent security zero
okay one last look over for security in
context so the positions that we have if
data can trade and also let's go ahead
and come here we'll go into the api's
okay so yeah so we're just checking to
make sure that that that ticker actually
exists and if not obviously we don't
trade on it coming back over here if we
can't read it and the security not in
long securities and security not in
short securities okay we ordered target
zero okay now what we're going to do is
in the record VARs we're just going to
graph this stuff so again we're going to
say long counts is equal to zero and
then we're going to say short count
equals zero on a mix of space here for
the position in contact stop portfolio
dot positions it er values if the
position dot amount is basically this is
greater than zero we're logging this
company so I'm going to say long
underscore count plus equals one and
then L if the position dot amount is
less than zero that means we're shorting
it and wears a short count plus equals
one okay
and at this point we need to record this
so we're going to say record and here
we'll say long count equals oh let's not
do that
look let's say the l dude enum long
equals long count num shorts equals
short count and as always we want to
track leverage so leverage equals
context static count
leverage okay so I'm pretty sure that is
all we need let's see if we run into any
walls
so first we'll just zoom out so I can
see the cool so syntax data it does not
start in 2011 it starts sometime in 2013
we're going to go with June or actually
no we're what do we decide we were going
to do 2015 sorry so it starts in June
2012 is the best a date that you'd
probably want to start with but let's do
the 2015 market neutral time so then
we'll go to 2016 January first okay
let's run this now a couple things to
note one is if you want to be a part of
the queue fund rather than starting with
a million dollars start with ten million
dollars also this strategy currently
will be using the default Commission's
and it can be wise to test without any
kind of friction at all to see if
there's anything there and then add in
Commission and then that way you can
actually because the adding in
Commission especially if you're trading
a lot it's going to it'll kill you right
away so first you come I see if there's
anything there and then if there is
something there then go ahead and add in
Commission and then start thinking about
how do we deal with the fact of
commission okay so it looks like it is
indeed running I think I have hit some
errors like along the way while this
runs and that just for the record if
your if your strategy crashes while it
runs you're disqualified from any
contest you're and then also you know if
your strategy was live that would be a
problem and then also if I'm not sure
any cue fund what would happen if it if
it crashes honestly is and they probably
pull it back up
but anyway so I guess I'll just let this
kind of like run through but I'm going
to pull up the a bunch of back tests
that I ran it and kind of go over the
major differences between the back tests
so I'm going to pause this I guess well
this is well everyone's probably sitting
through this I don't know we can just
kind of keep running that I suppose it's
almost done anyway
so as you can see as the market goes up
we did very poorly because we're
shorting half of companies and we're
wrong so often because remember the mean
of the Alpha was in our favor but it was
not much in our favor right okay so in
this case we didn't do so hot so now
what we're going to do is real quickly
I'm going to go see oh not for this one
let's see the back test I ran here cool
see if I can go back to so I ran three
back tests strangely enough this is the
first one that should have been
identical to the one I just ran from the
Year 2015
I'm not really sure why we got a
different return there but anyway either
way we're not doing that great oh maybe
because of the Commission right so in
this one the Commission sent set to
0.001 whereas the one we just ran with
default Commission so that's like the
default Commission if you had a personal
Interactive Brokers account so probably
you would want to remove Commission just
to see if there's something there or you
know you can put it here in the webinar
at least the Commission was set to 0.001
where were we I guess I just left so
let's go back to the back test okay so
with that Commission this is what we got
our you know beta is basically zero or
Sharpe is not the greatest total returns
1.7 so a max drawdown of negative 1.3 is
not that great anyway go into the other
back tests this was with actually sorry
let me point out one more thing so view
the code of this back test this was
actually with the quantile so I
commented out this make pipe line here
in here the quantiles rather than being
based on sentiment we're based on
quantiles
so here okay so shorts were the zeroeth
quantile the smallest quartile and then
Long's were the largest quantile and the
way we made them was this line here we
made the quantiles but the other
strategy we didn't run quantiles we
actually ran the other way okay so this
is with these quantiles that's the
return
now the next algorithm would go back to
the back test I changed here
one look at the exam first see view code
same Commission only here we're going
off of those the Asheville's signals
themselves rather than quantiles and
here we do a lot better than we did that
previous one and then here I'm not
certain with it oh this is a very long
back test so this is from yes 6:12
so the Sensex start data all the way to
basically as far as I could go at the
time so syntax data will take you back
up to one month ago so rolling one month
ago so this is this is basically a test
against all of that time and again let's
look at view code here for the
Commission's we're using the 0.001 if we
use default Commission's we'll sunk the
ship almost sort will be probably like
down here like minus 25 or something so
so with lower Commission's
you we can see there is like we were
saying before there's alpha here but
we've got to do something about where
we're losing money especially on those
shorts because overall the market is
bullish you can't be so wrong on those
shorts so probably a stoploss something
like that now what we're going to do now
is I'm going to take this back test and
then we're going to go back to the
research environment and run the back
test through PI folio which will give us
a little bit more interesting
information on the back test itself so
that's we're going to be doing the next
tutorial if you have any questions
comments concerns whatever up to this
point feel free to leave them below
otherwise I'll see you in the next
tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>