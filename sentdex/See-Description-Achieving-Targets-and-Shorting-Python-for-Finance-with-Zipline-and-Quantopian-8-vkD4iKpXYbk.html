<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[See Description] Achieving Targets and Shorting - Python for Finance with Zipline and Quantopian 8 | Coder Coacher - Coaching Coders</title><meta content="[See Description] Achieving Targets and Shorting - Python for Finance with Zipline and Quantopian 8 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[See Description] Achieving Targets and Shorting - Python for Finance with Zipline and Quantopian 8</b></h2><h5 class="post__date">2015-07-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/vkD4iKpXYbk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
the eighth Python for Finance tutorial
with quanto peon and zipline in this
tutorial we're gonna be talking about
how we can achieve a target that we're
actually looking for as far as metrics
are concerned and it's a really good
practice even if the strategy just
outright stinks as far as what your
total returns are it's a really good
idea to get comfortable with aiming for
a target maybe just one at a time and
then try to aim for two or three or four
and so on it's a good idea to get used
to doing that so that down the road when
you've got a really complex strategy and
but maybe one number is a little too
high maybe the the drawdown is a bit too
high what do we do to affect a drawdown
or change drawdown now withdraw down you
can usually affect your drawdown by
having extreme stop-loss okay and that's
in both you're investing in specific
companies or also the running of your
algorithm at all if you've got a
drawdown that just keeps ticking down
you can always just pause all right and
take a breather and then re-enter the
market and that will help your drawdown
as well a lot of people want to always
be invested and always be trading it's
not necessarily the best idea but people
treat investing in trading a lot like
gambling they just it's like a game they
just want to play it so you know keep
your eye out for that mistake now so the
first thing that we want to do is we're
going to achieve or we're gonna try at
least to achieve a beta that is between
negative point three and positive point
three so this is a compare this is a
strategy that is mostly irrespective of
the market but not totally obviously a
zero would be great so the way that
we're going to do that is we're gonna
incorporate shorting of companies and
the idea there is that if we're going to
be to act irrespective of the market why
don't we oppose the market at certain
points and then BAM you should lower
your beta so let's go ahead and go back
and this script is called fundamentals
tutorial I think we're gonna change that
now so we'll just call this
quanto pian tutorial the particular Ness
and me made me change that so now what
we're going to go ahead and do and in
fact we're not even it let's just make a
new one so whoa
now we'll just for just rewrite this one
so let's let's delete this and we're not
going to have a before trading start
this will be a really simple algorithm
actually and so we can actually so we
can build on top of this one so
initialize context and we've got handle
data so initialize what we're gonna do
is we're gonna trade sectors and the way
that we're gonna do trade sectors is
using the spider fund sectors so or the
spider funds that are based on sectors
so there's quite a few so let's just go
through them you can just follow along I
suppose that's actually only like nine
so let's go so we're just a context dot
stocks so again this will be our
universe equals symbols and then we're
gonna just throw in the symbols and in
fact I think there might be one in the
docs and we can maybe save ourselves
some time possibly let's go to quanto
peein this help here
and do a ctrl F for Excel why there it's
beautiful so let's go ahead and take
this right here and just go to symbols
we'll copy that come over to the
fundamentals tutorial here and are still
calling itself fundamentals but it's
quanto pian tutorial now and then
symbols replace symbols here just paste
and bam so now we have our tickers so
you can just look you know so we've got
the consumer discretionary you've got
financial sector tech sector energy
healthcare industry consumers materials
and utilities so these are our sectors
and we have one two three four five six
seven eight yes nine total sectors so
now that we have our sectors how are we
going to invest based on these sectors
well there's a whole lot of ways that we
can you know buy and sell and all this
based on all kinds of parameters but
let's go back to our initial moving
average crossovers so the moving average
crossovers is helps us with trends so as
long as the market trends this is a good
strategy okay but as long but if the
market doesn't stretch
or the market goes what's called
sideways where it just kind of goes
sideways or it just goes up or just goes
down this strategy is gonna underperform
but if we have moments of training up in
moments of trending down the strategy
should do pretty well and let's say over
the course of the last few decades we've
actually had some pretty good squigglies
going on but if you only consider so let
me let's pull over
actually let me pull up the S&amp;amp;P let's do
s &amp;amp; p500 so we search for the S&amp;amp;P 500
just in Google and here you go so let's
say in the last five years
what is mostly happened in the last five
years well I mean there's a trend here
and it went up and then a short trend
down but mainly this is a trend up in
the last five years
how about max okay so what if we did
maybe from 1995 to 2015 right well in
this case we trend up we turned down we
turned up we turned down we trend up and
we might very well trend down eventually
and with quanto peein they have data
from 2002 onward so let's go Google
Finance here and let's pull up from 2002
I wonder if I can yes I can
so doodlee doodlee 2002 I thought that
was gonna look a lot more interesting
but anyway you can see that indeed it's
trending up and I'm advertising for
Victoria so let's just do this there we
go anyway
trending up you buy like one thing on
Victoria's Secret by the way and it will
just advertise to you for like the next
six months you know anyway shredding up
and then it trends down and then turns
up again so in theory this should be an
OK example we've got to up trends 1
downtrend so you know who knows but
anyway let's see if we can call if we
can make a script basically that will
will play these trends so moving this
over here what we're gonna do and since
we're playing like long term trends you
want to take into consideration long
term trends as you're making your moving
averages that will be used to cross over
so anyway in the handle data what we're
going to do is we're going to say
for stock in context dot stocks so for
the stocks that we're willing to trade
what we're gonna do is we're gonna
calculate a moving average one and an MA
- like we did before and this will be
the data and then stock and then we'll
use Mavs and we'll do a 50 moving
average for the first one and then for
the second one we're gonna do a 200
moving average then what we're gonna do
is we're gonna reference the price the
current price whatever that happens to
be and that will be data stock dot price
easy-peasy then we ask some simple
questions if the MA one is greater than
the MA - this means we're detecting an
upward trend if the MA one is greater
than the MA - we're gonna order
underscore target and actually let's do
order target percent so we're gonna
order target percent of that stock and
our target percent will be zero point
eleven just for the record it's kind of
confusing when you think of percent I
want to order eleven percent so it's
tempting to put an eleven in here
but no don't do that you can be ordering
a massive amount of the company it's not
really a percentage it's a zero point
eleven it's a decimal but anyway I wish
that was a little more clear the first
time I tried using order target percent
I was doing like 50 percent I think and
there's a massive buy came through and I
just didn't understand why anyway if
that's the case we order that percent
elif MA - all right let's do ma 1 is
less than MA - then we want to do an
order underscore target on our score
percent of that stock as zero point
eleven again but this time it's a
negative 11 so this means we're gonna
short that company and honestly that's
it for our logic super super easy
logical script here because we're using
order target percent so this will just
automatically handle all the problems
that we could possibly have and because
we're using the percentage
even though we're using a negative
percentage here we don't have to worry
about does it add up to hundred percent
at any given time we should only be
invested 99 percent so let's go ahead
and let's run this back test and let's
use everything quanto peon has to offer
I think they started on Jan 1st 2002 as
far as their data is concerned and we're
gonna stick with daily data because this
script is a daily data script so for
example we're using a moving average of
50
well that 50 is applying to the bars of
data so that's 50 days if we did minutes
it would only be a 50 minute
now we could do that because there are
fluctuations over the course and you can
try it on a minute data if you'd like
but let's do just the daily data here so
let's run the full back test we'll start
with a million dollars no problem it's
really easy to get your hands on a
million dollars nowadays practically
just stumble over it walking along the
street you know so right away we can see
we've got a negative beta here and you
can even see that we've kind of defied
the market and then here as the markets
trending upward we're like hey yeah
we're we're bullish on the market so we
trend up with the market and then here
we're kind of failing pretty much
because the market straining up but
pretty slow and now it's going sideways
so we do pretty bad it's trending up in
it's trending up and probably here oh we
detected that the market was crashing
and we were wrong and then we're right
about to crash from the housing crisis
BAM housing crisis hits we do very well
in the housing crisis and we can look
our beta is still not quite in the
target that we want but I think we're
going to get there because right now
we're in the negatives but I think in
this next uptrend we'll we'll do we'll
get our closer oh here we go actually
getting into the closer so we're going
sideways we're almost to where we need
to be in the beta so close our Sharpe
ratio stinks but that's okay
and betas now we're in range and we're
done
cool so our total returns 85.7 compared
to the benchmark of 130 point one but
that's so it's okay because our beta is
pretty good but then if we look at our
draw down 33.1% draw down but sure what
the actual draw down is for for the S&amp;amp;P
500 in that same time the draw down
should be pretty significant the excess
from the crash see if I can get there
yeah it's definitely more than I'm gonna
pull it up for you guys in a second
right so the max drawdown for the market
between you know 2007 and 2009 from this
highest high and then it falls all the
way down here that drawdown there is
minus forty six point two one so that's
a pretty significant drawdown so all the
people that were invested in that time
that's not why everyone was in serious
trouble because almost every one was
worth half of what they were worth
initially so there you go we've achieved
our beta target because we directly
defied the market in multiple places
initially we did it here we did it again
here and we failed but that's okay it
helped us lower our beta and then we did
it again here to great success and again
in a few other places but we were able
to now now we've got a negative zero
point two seven so that's pretty good
Sharpe ratio however stinks maybe we
should include a stop loss here to kind
of maybe decrease the risk a little bit
and basically you can generally the
sharpen max drawdown will kind of go
together chances are if we could get our
drawdown down to a lesser number we
would also see our Sharpe ratio improve
quite a bit and volatility would also
improve quite a bit so anyway that's it
for now we've achieved basically our
target that we were looking for and
that's kind of how you would do it and
again now you might want to add some
stop losses here maybe you want to
invest in other sectors or maybe you
want to invest in sectors differently or
value your portfolio differently in
different sectors and stuff but you do
have to be careful we've had a quite a
big technology boom and if you're taking
your bias back you know ten years saying
oh I just know there's gonna be a
technology boom when really after the
dot-com bubble everybody was very weary
of technology booms so chances are you
wouldn't have made that call but anyway
keep that in mind don't make the
kind of assumptions now up until this
point we've been using information that
is only available on quanto pian which
is great quanto pian has a ton of data
but they don't have everything right
uh-huh
there's just no way for them to get all
of the data they could possibly want or
like what if you for example want to
trade or want to back test Bitcoin
trades okay you can't do that on quanto
peon yet new with quanto peon data but
what you can do is use they have a
method for fetching CSV files so you can
have any CSV file you can get it fetched
and you can work with that data so
that's what we're gonna be talking about
in the next tutorial is fetching data
and I can't think of better data to
fetch then sentiment analysis data so
that's what we're gonna fetch is
sentiment data from my other company
syntax and we'll see how that fares but
also we'll learn about the CSV fetcher
and how we can use that with our
back-testing so anyways stay tuned for
that if you got questions or comments
leave them below otherwise as always
thanks for watching thanks for all the
support of subscriptions and until next
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>