<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rolling statistics - p.11 Data Analysis with Python and Pandas Tutorial | Coder Coacher - Coaching Coders</title><meta content="Rolling statistics - p.11 Data Analysis with Python and Pandas Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rolling statistics - p.11 Data Analysis with Python and Pandas Tutorial</b></h2><h5 class="post__date">2015-10-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FRzfD1FtrsQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
part 11 of our data analysis with Python
and pandas tutorial series in this part
we're going to be talking about rolling
statistics and other things that we can
do in a rolling fashion so first of all
what we should do is first bring up over
here here we go there will be a link
again you have to go to the text base
tutorial link to this in that tutorial
right at the top basically these are all
the things that we can do in a rolling
manner and really important is this one
here but we'll get to that so first of
all we can do things like zoom in you I
got zoom didn't got lost anyway rolling
count rolling some rolling mean all that
kind of stuff we'll check out the
rolling mean you can also do rolling
minimum what does this mean so with
rolling what you do is you take a window
of time and then basically in that
window of time we can do all of these
things so that's rolling sum so in that
window of time add all the values
together in that window of time
calculate the average of everything keep
moving that way
max standard deviation so on and then
with rolling apply you can write your
own function that deals with window data
and do anything so if all these don't
suit whatever purpose you might have
rolling apply is your guy that was good
anyway
um I'm here all night moving this over
here let's go ahead and calculate a
rolling mean so this is also known as a
moving average so we're going to go
ahead and we can leave this stuff here
text instead of Texas one year this is
what we kind of did before
we're going to redefine Texas one year
and actually instead of Texas one year
let's call it TX
t x12 in it or something like that
that'll do so tix 12 MA and then I'm
going to copy this and then I'm going to
a replace so ctrl H that's a find we're
going to find all T X 1 years and just
replace it with TX 12 MA replace all
good to go just to check to make sure
that went went correctly cool all right
so close this out now we're going to do
instead of resampling here and filling
in a we don't need to do that right now
what we're going to do is do this I
don't need to print that head here we'll
print that after that
okay so TX 12 MA what we're going to do
is not resample what it's going to be
instead is a moving average so we're
going to do PD rolling underscore mean
oh this is the data we're going to do
the rolling mean for it and then we can
choose for how much time so we'll do 12
so that would be 12 data points it just
so happens each data point is a month so
this would be a 12 moving average
otherwise known as a year so 12 months
or a year so um that creates the new
column while the law will graph it here
we go
and there you have it that's a 12 12
month moving average again we're
forfeiting the little squiggles which
actually are highly valuable to us
because it shows us every six months
basically we go through a cycle like
clockwork moving this aside oh one thing
you will notice actually that right here
you start with not a numbers why do we
have mountain numbers there the problem
is we have 12 moving average you can't
calculate a 12 moving average on data
point number five just not possible
so a lot of times what I'll do is
especially in the same data set the
other thing you'll notice let's run that
one last time
the it starts a little later right so if
we zoom in to this point you'll see that
this started after these points now if
there's a significant delay there it
becomes really obvious so said 12 we
could do 120 so 120 months that's a lot
of months but then you wind up with
something like this
right that's kind of a problem right
that looks silly so this would be a
scenario where maybe if you want
everything to line up nice and pretty
you could do HP I dated Rob in it drop
in a and then we'll all course need to
do an in-place it's true
save and run that and then now it's
chopped off all the little data and
stuff like that anyway so it's a moving
average we're not going to continue
dropping in a and we'll change this back
to twelve retain the data here whoops so
that would be a moving average another
good one is the standard deviation so
standard deviation is good for a lot of
reasons one it can help us actually
identify problem points and outliers but
it can also help us kind of detect
volatility in the markets so as things
have a greater standard deviation that
means things are moving around a lot
more so that's good good indication of
volatility so what we would do is we can
kind of sift all this up here and let's
create a new column and this column will
be let's just copy this copy paste
instead of MA it's STD instead of
rolling mean it's rolling STD and then
everything else can say this animals
will do a 12-month standard deviation
now the promis standard deviation is
it's not the same kind of four I'm
trying to think of the right word scale
there it is so at the same scale as the
housing price index okay so standard
deviation is how much deviation so it's
almost always going to be a small
fraction of the original values so what
we need to do is actually graph it on a
different graph we can go ahead and see
the show that this creates TX 12 STD and
let's go ahead and add that into the
printing up here as well so we'll save
and run that and as you can see this is
the original data and this is the
standard deviation down here obviously I
mean you can kind of tell the
fluctuations in the standard deviation
whoops wrong button but we would like to
see on a greater scale right the obvious
increase here decrease here increase
here and so on so what could we do well
you can close this we can graph it on a
new graph entirely again this isn't
totally a mat plot live tutorial series
but we're so we're going to kind of run
through this this is covered in the more
in depth data visualization series but
you can probably pick it up real quick
now so these are your axes this is a ok
so you got a figure and then you've got
subplots on a figure and subplot is also
your axes basically so we're going to
create a new axes copy/paste the the
grid now is going to be a two by one
that would be too tall one wide so we'll
have a graph on top and a graph on
bottom this one will start at 0 0
totally fine
this one will start at 1 0 and it's also
going to share the x-axis of axis 1 that
means we can zoom in to any either of
the graphs and both graphs will zoom in
for us nice and neat and this is now a X
2 for axes 2 then what we're going to do
is not plot that there we'll come down
here and what we're going to say is HPI
data we still do want to plot it just a
different on a different axes HPI data
TX 12 MA that's what we want to plot
woops dot plot and this one we're going
to plot KX equals ax dos so now we'll go
ahead and run that save and run
what did we do we did MA instead of STD
I guess we sure did why didn't anybody
tell me that's right a long time there
we go ok so there you have it and this
is me out now standard deviation again
this is why we share the axes because we
can zoom in to this point and both
graphs zoom in to that exact point so
that's pretty nifty because you know you
can see you know here as prices are gone
up sure enough the volatility is going
up we've seen that and then up here
we're really starting to rock it up and
we are picking that up on the standard
deviation graph so that's pretty cool so
close this out
another pretty nifty one is like rolling
correlation stuff like that so what we
could do is this one's a little more
tricky but we'll keep the figure here we
can plot on the two I suppose we'll do
let's delete all the way here so what
we're going to do is we'll run this will
just say TX to a k12 correlation so this
is measuring we're going to measure the
correlation between these guys that'll
be PD rolling underscore correlation and
we want to apply this to the HPI
underscore data of Texas so again it's
Texas to a a K so which I'm recalling
right it's actually Alaska so Texas and
then is the first one and then we'll go
HP i underscore data oh my gosh I cannot
type a K and then for 12 periods okay so
that's going to calculate the
correlation but again that these need to
be on a separate graph okay so Texas and
Arkansas can be on the same graph though
so we could do something like this we
can say HP I your store data TX Lopes
and TX needs to be caps dot plot ax
equals ax one label will be equal to TX
HPI and then we'll take this copy come
down here paste to Texas a k and then
over here okay
so that's good then we're going to say
ax one legend location 4 and then we'll
come down here and then we're going to
say TX underscore a K underscore 12 for
good dot plot and then we'll say a x
equals ax to label equals and we'll say
just take this here copy this is a
rolling correlation between these two so
what would you do with this well as we
noted before the the correlation between
all states is extremely high we can see
that the average correlation here is
quite high it keeps coming up to this
point so at every point we can see that
okay oh my goodness the correlation
drops to almost minus one here basically
pretty much hits it so we know based on
the in last 40 years of correlation data
that we pulled up we pulled up that
correlation table not long ago we know
that every state basically follows every
state they all follow the same housing
market no matter what so with
correlation if you have correlation in
the negatives that means they're
trending in different directions so what
you want is you want to find scenarios
where correlations in the negatives and
you're going to an a most ideal scenario
you would find a way to short like in
this scenario here
Alaska is is all the way down here in
the dumps and whereas Texas keeps going
up so what you would do to be a
completely market neutral strategy is
you would short Texas and you would buy
Arkansas now there's it's really kind of
difficult too short let's say the Alaska
housing market so at the very least what
you would do is you would buy Alaska I'm
not sure if I keep saying Arkansas or
not but if I say Arkansas aka is Alaska
anyway uh so really what you would do is
you know in reality you would just buy
Alaska every time it dips and sure
enough every time like if you bought
Alaska here you bought Alaska here good
for you
you buy Alaska here that means you
bought it here and you probably did okay
goes up slightly but then you would get
out of it once it returns back to the
typical one and again you would buy
Alaska here you'd probably continue held
holding it through here which is fine
and then basically by this point you've
sold again good for you you just like
doubled your money or more than double
your money and then basically no other
time did it drop down to you know that
one but that's kind of what you would be
looking for you would be looking for
when states either defer from another
state if you were if you could find a
way to pair traded the states or you
would just find all states that diverge
from the housing price index that have a
negative value that's where you would
buy your your next house or something
like that or invest in some property
that would be the idea anyway so that is
rolling correlation and as far as really
rolling statistics so a bunch of rolling
statistics here but holding correlation
at least in terms of the housing price
index and housing market and stuff
obviously makes the most sense again we
already tested the correlation between
every state and every state and then we
could also test the correlation between
every state and housing price index and
we found that I mean they're all bit
like the worst was actually still a
positive 74 percent so anytime you've
got divergence to this degree you buy
whatever's you know diverged that much I
mean it's pretty I mean at least in the
last 40 years that's true you honor that
and you will go for that
it just makes sense so anyway that's it
for this tutorial questions comments
whatever leave it below otherwise as
always since for watching thanks for all
the support subscriptions until next
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>