<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Percent Change and Correlation Tables - p.8 Data Analysis with Python and Pandas Tutorial | Coder Coacher - Coaching Coders</title><meta content="Percent Change and Correlation Tables - p.8 Data Analysis with Python and Pandas Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Percent Change and Correlation Tables - p.8 Data Analysis with Python and Pandas Tutorial</b></h2><h5 class="post__date">2015-10-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/P90mCSsGE1c" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
part 8 of our data analysis with Python
and pandas tutorial series in this part
what we're going to be talking about is
creating well we're going to do a
percent change but mainly our idea here
is to do to create a correlation table
or I actually going to try to cover
quite a few things all at once here so
let's get started first of all this is
starting to uh basically starting code
up to this point we don't really we can
keep the pickle in and I suppose if we
want but really what we want to do is
let's just delete all this delete this
and we'll go with that so HPI data
equals PD dot read pickle and so on so
now that we've got that information what
we're going to go ahead and do is first
maybe we wouldn't mind peeking at the
data but before we peek at the data with
maybe matplotlib we're going to talk
about modifying columns so up to this
point we haven't really modified columns
within pandas but modifying columns is
really really simple and fast so for
example we can start a new column
basically by doing something like this
HPI data and then we'll say TX to the
equals H P i underscore data then we can
say you know TX for Texas TX like this
times 2 then we could print and then and
then we can reference just those two
columns so we'll say we'll print HPI
data and then square brackets more
square brackets and we're going to
reference TX 2 well actually it'll just
takes 2 second and then TX save and run
that just to get to this point and we
find that in the we've got a TX TX 2 and
it is a multiple now of course we don't
have to multiply we earn we don't have
to make a new column we could say TX
like that and then this is run and now
we've well you can't see the original
but if you recall from before this is
double what the original numbers were so
we can do that
now that's how we can kind of just
modify the columns if we want to perform
calculations but I'll show you how we
can apply a calculation to entire data
frames and all that and it's fast so
first we're going to do is we're going
to get rid of those and that was at the
very top of our script I'm going to
import Matt Matt lot live dot type lot
as PLT from Matt far live we're going to
import style and then we're going to
style I use and use what you want I like
538 but Gigi ply is good too and so are
many others so we'll do that then we'll
come down to the very bottom this
defines the HPI data you can plot an
entire data frame doing HPI data plot
boom then we're going to remove the
legend because it'll just get in our way
so P LTI legend dot remove and then PLC
touch show now our data should in theory
be relatively normalized right on the
same ish scale so we can plot the entire
data frame no problem or so we're
expecting so there it is okay so this is
all of our data for housing price index
so we relatively they all kind of follow
the same ish path obviously there's
major difference right we've got some
that are you know 225 and then one is
all the way not the peak here to 25
coming down here we got one that's at
104 so very little difference one thing
to note though is it seems like
everything converges right here so we
can zoom in to that point and I mean
everything it perfectly converges right
there it is Oh happens to be on the
perfect 100 so what's happening is this
is basically the starting point for all
the calculations these are calculated in
Reverse basically and these are
calculated from the future starting at
this you know 2000 so we could either
stick with that and have all the data be
out of perfect 100.0 on that date or we
could use percent change starting from
here and measure everything in percent
change throughout time so close out of
this
now what we're going to do is we can
close basically let's we don't need well
well actually we kind of want to plot
everything so let's go up to our grab
initial state data and basically once we
get this data frame we're going to
convert it to percent change so at least
initially the way that you do that is
like this we could say DF equals D F dot
PCT underscore change and we can go
ahead and run that but what you're going
to see is that the data kind of looks a
little well let's just do this let's do
this copy paste and as it comes out
we're going to find it's not quite what
we want so percent change can mean a lot
of things it can mean from a starting
value it could also mean at every point
right so from this point to the next
point how much does the percent change
it turns out with pandas when you just
apply a dot percent change like we've
done actually I didn't want to save in
there data frame well I guess doesn't
really matter in the end we'll just let
this one run through didn't want to save
a new is this did it save I'm trying to
thing that is a percent change but this
is not what I wanted
I don't think and go back over here this
isn't what should have popped up let me
close this face States stop okay so
saved it to fitty States dot pickle
right so we need to read pickle city
state stop pickle hopefully now and then
let's not grab initial data try that
again right okay so this is this is that
percent change now of course you could
use this and this might turn out to
actually be the more useful version as
we go down the line
who knows so we could look into using
this specific information here and in
fact I'm going to go ahead and
save that we'll come over to the sample
code here 50 states pickle and then I'm
gonna copy paste and I'm just going to
rename this to fitty states a PCT change
DF hopefully that will make me remember
that was the percentage change against
the entire data frame but that again is
not quite what I was hoping for kind of
what I want is to see the percentage
change being applied from the starting
values so how might we do that to the
entire different okay going back
starting over here
we will really this to run but first we
need to make the change so this is DF
equals so we grab the data frame fine
next what we're going to do is we're
going to say DF and every data frame has
only one column and that is the column
for that state's abbreviation so we're
say DF a BB v and we're just say that is
equal to and this will be a long one but
it's percent change formula percent
change you - the old divided by the old
times 100
so that's percent change so then we're
going to say DF a b DV new - the old or
the in our case original a BD v new
minus the old zero so new mais the old
and then divided by the old DF AV v v0
by the old times 100 okay that is
percent change that's all you have to do
that will populate the data frame for us
no problem I'm gonna save this as 50
states 3 and this will be 50 states 3
and then we should be all set so let's
go ahead and
yet we'll save it we'll run that and we
are grabbing initial data so after all
of this runs we should get a graph
instead of the initial housing price
index in the initial you know point by
point percent change this time we'll get
the percentage change from that first
year which was I think 1975 so that'll
be kind of interesting
so then after we've got all the day sets
in so there we go so now this is percent
change starting from the zero point
right so that I kind of like doing that
moving that starting point to the very
beginning rather than having it all
converge at 100 at some random point
along the way we want to find that this
is the wrong way to do it who knows
anyways uh so there you go now what
we're going to do is we might end up
actually wanting to compare right you've
got all of these these are basically the
every state is being grabbed now it
looks like they pretty much follow each
other right they're probably very highly
correlated but then the other thing that
we want to go ahead and add is the
entire United States housing price index
so the conglomerate so we we could
actually average all these together and
do that but let's go ahead and grab the
official one and just make sure that you
know we got the right information so now
we're going to make a new function and
this is how we would add new information
in this case this is you know just US
wide HPI but maybe you want to
incorporate demographics like crime rate
literacy rates maybe you want to bring
in the GPS of every state or the GDP of
the entire country yes and P 500 and so
on this will be the method that you
would use to do it so we'll say okay we
want to bring in a new a new bit of data
will call this define HPI underscore and
we'll call this benchmark because this
is for the entire United States just say
DF equals and we'll do this let's just
copy this paste inside J's query we'll
say that what we're going to bring in is
F Mac that's for Freddie Mac HPI
underscore USA then we want that to also
be the percentage change formula so
we'll copy that paste that here and then
instead of ABB V this is United States
that's just the name of the column oh if
you didn't know the name of that column
what you would do is usually you pull by
this ticker and then you could just
print D F dot head out and look what are
they calling that column you can also
look on quando like let's go to quando
real quick and then us HP I made me look
work let's try that I bring out quando
for you guys you trying to find Freddie
Mac in this list see Freddie Mac United
States housing price index if this
doesn't give us one we'll just let's see
yeah so here we go this is only from
okay this is what we wanted right here
this is probably exactly what we're
using right so you can look down here
and you can see latest values date
obviously Tsar index and then you can
see well one of the columns is United
States okay so there you go
closing that so now we have
HPI benchmark and then what can we do to
like add to add that right because this
is now in the same format as that
original one but we're pulling this
after the fact right after it's already
been made into this pickle and by the
way before we get let's comment out grab
initial state data we don't even grab
that again now what we'll do is we could
add this or we could plot it all on its
own now to plot it all on its own um
trying to think if I really want to plot
it all on its own or if I want to just
add it but you know you would just you
could just do a join but let's say you
had a different data set that you did
want to maybe
i you know separately or something like
that what you could do is something like
this like we could say let's do big
equals PLT up figure and then we'll say
ax 1 is equal to P Ltd sub plot to grid
this just creates a grid we're going to
say the grid itself is a 1x1 this is a
grid of basically subplots this is how
you could organize subplots in
matplotlib you don't really have to
worry about this for this series to kind
of follow through if you if you want to
know more about matplotlib check out the
map plot there's a long matplotlib
tutorial series on Python programming
net and on my channel just recently
updated it actually so if you want to
check out learn more about plotting with
matplotlib check that out anyway this
makes a 1x1 grid and then the next
parameter here is where you want that
your specific grid for a x1 to start
we're going to start at 0 0 that's fine
now we have HPI data is grabbed here we
plot that and we'll just say plot you
can say ax for axes we want it to be
plotted on axis 1 then we're going to
actually what we need to do is come up
here to our HPI benchmark we forgot to
return DF coming back down to where
we're working now we're going to say
this is where we grabbed our data and
then we're going to sort and say
benchmark equals h HP i underscore
benchmark generally why do graphing and
stuff like that I usually carry all the
data kind of together so this is where
we're generating the data and then I
plot all the data kind of together and
then we do like the mean PLT to show and
legends and all that together so anyway
so then we'll say bench mark dot plot
again we're going to plot to ax equals
ax 1 we're going to say the colored
equals and K is used for black because B
is blue so they used CAD to black and
then line width equals 10 so we'll
definitely see this benchmark line
legend remove klt ah show good to go no
longer running through that really long
so should be all set should be anyway
there we go okay so now you can see this
this big thick black line here that is
our benchmark as it appears yeah it
looks like the entire you know the
average is very correlated with
everything else there it is smack in the
middle basically of everybody now
finally what we can do
ignoring that we haven't added the
benchmark just yet but what we can do is
we can actually correlate all of our
data with each other and find out just
how correlated every state is to each
other so we're gonna not be graphing
anymore so let's just let's do this
so we still have the HPI data and the
way that you can do you can do all kinds
of stats on data frames the first one
that we're just going to do here is
going to be just correlation so what we
can say is HP i underscore state
underscore correlation equals HP i
underscore killing me data core this
will generate a correlation table for
all of the columns and let's go ahead
and print this save and run that and
there you go so it's a very large table
obviously you've got every state down
here and then every state so it's a 50
by 50 basically and then you can see how
correlated is everybody with each other
so we've got you know Arizona here
it's 92% correlated here with Alabama I
can't remember now I can't remember
which one with a la K you got like
Alabama Alaska Arkansas with the K so
let's go ahead and go Colorado with
California 92 point almost 5% correlated
these are all really high okay you can
look through here and try to find like
the smallest number like here we've got
a 79% correlate
in between Texas and Nevada okay and so
on and another thing that you can do is
you can kind of you can actually find
more information on a data frame by
doing this you can say because HPI state
correlation that's a data frame so you
can say that plus r dot describe and
then we can print that out as well print
so what this does is describes the data
frame it'll give you a bunch of
information so for every column and
gives you some information it tells you
how many rows are there what's the
average of all the data there what's the
standard deviation what's the lowest
value what's value in the twenty-fifth
percent you know quartile first quarto
first quartile fiftieth percentage
number so the meet the median then
you've got seventy five percent and Max
is one and the reason why Max is always
one is because you know Utah is one
hundred percent perfectly correlated
with Utah okay so you always have that
but the interesting number is min so you
can see here the lowest correlation for
like Washington with anyone else is 86
percent that's incredibly correlated
with every state so every state is
clearly following each other very
closely here's one that's pretty low
let's say a Kay with is minimum it's 74
percent now
even then 74 percent it's pretty darn
correlated but that's the minimum and I
think that's one of the lowest actually
correlated in all of these pretty much
I'm not sure anybody's lower than 74 so
bottom line every state is very strongly
correlated with every other state so
that's that's pretty interesting data so
if you have two states that start to
diverge the one that's falling is
probably one that you can safely invest
in as long as you're confident in the
housing market long term you would go
with the one that's diverging down okay
so it's kind of hard to short the
housing market you can short the housing
market though there's you know you short
like builders stocks there's also a
housing market that actually literally
shorts I forget who they are shorting
but it's
like srs I think is the ticker for them
anyway maybe you will talk more on that
way later but so anyways you can do
correlation like that so as you can see
every state is highly correlated with
each other so they will entire housing
market follows itself very significantly
okay so anyway I think we'll cut that
this tutorial off here as far as doing
you know correlation and all that in the
next tutorial what we'll cover is
resampling data there's a few reasons
why we're going to be resampling data in
this series but the idea for sampling is
to take maybe you've got data that's
coming in every millisecond but really
you only need data to be monthly or
something that this you can use
resampling for that reason to kind of
change the granularity of data sets
anyway long tutorial here lots of stuff
kind of run through here so if you have
questions comments problems whatever
feel free to leave a comment below again
there are the written tutorial is also
posted that's linked in the description
so if I left you behind somewhere you
can always check that one out
anyway questions comments below
otherwise as always thanks for watching
thanks for all the support subscriptions
and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>