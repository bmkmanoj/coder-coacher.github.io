<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to use IBPy Python with Interactive Brokers TWS API For Automated Trading | Coder Coacher - Coaching Coders</title><meta content="How to use IBPy Python with Interactive Brokers TWS API For Automated Trading - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to use IBPy Python with Interactive Brokers TWS API For Automated Trading</b></h2><h5 class="post__date">2014-05-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Bu0kpU-ozaw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">is going on everybody welcome to one of
the most requested Python videos to date
and that is dedicated to the meshing of
Python with Interactive Brokers or I be
using IB PI so IB or Interactive Brokers
is a brokers a appears to take the
middle ground between institutional
training and individuals and maybe not
even the middle ground they pretty much
appeal to both parties and a wide
spectrum so to play with Interactive
Brokers we only need to have a demo
account and for a real trading account
the minimum is $10,000 which is actually
quite low for someone who offers these
similar services so the demo is only
going to support a small number of
trading like symbols like stock symbols
and all that but you'll definitely get
the idea and once you have a approved
and funded account you'll be able to use
Interactive Brokers paper trader which
is kind of like AI B's paper trading
tool that gives you a sense of you know
how you can fully mimic live trading
without the risk right so paper trading
but first we can just play with the demo
and decide if this is really a path that
we want to go down so first we want to
go ahead and set up the demo so the
first thing that we need to do is head
over to HTTP colon slash slash W
Interactive Brokers comm let me bring my
note once you're here
what you're going to want to do is head
over to open an account then go to
individuals so that's us
and then we don't want either of these
but we want platform demo so you'll
click on that and then you want to come
here to try individual demo for trader
workstation well that's going to do is
download a file right here just hit keep
and it should be a demo e demo jnlp if
you don't get it you should be able to
see if twf this fails download you can
click here that's going to open up this
one and I would still use the standalone
you can use a browser-based one job just
I would actually kind of recommend the
standalone and do that or Mac UNIX
whatever you need but this should work
out for you so you click on that and
that'll make this pop up now mine I
don't think it'll end up asking me but
if this is your first time it's going to
ask you whether or not you want
use the old look or the new look and the
new look is like mosaic and then the old
look I don't even know what they call it
but anyway I'm going to be using mosaic
so if you want to follow along exactly
and it look like mine looks use mosaic
so once that's done let's see I got it
is a little some of these warnings
sometimes we'll hit okay there and we
don't want to open an account suppose it
closed so what should pop up
is this so you've got this Interactive
Brokers kind of platform going on here
so most of these the only two things
we're really going to look at this has
prices over here this has your portfolio
and then any orders you have here but
you can always go like portfolio you can
change this stuff up right and both
these now showing orders anyway this is
the transportation you can play around
with it if you want this isn't really
our main focus the only thing I would
like to add is sometimes they just throw
random things
it seems into your portfolio so when you
load up sometimes you might have pure
cash sometimes you might have some sort
of Forex or you know foreign money you
got stocks or whatever but generally
you're gonna have about five hundred
thousand dollars in your account so
sometimes you'll see other stuff here
and it can get kind of confusing if it's
your first time but just know that some
for whatever reason they throw random
stuff in there or maybe I'm doing
something I don't realize but it does
seem like it's just kind of random when
you open it up so now the only other
thing that we need to do while we're
here is we want to go to file global
configuration that'll bring up this
window here when you're here click on
API and then go to settings now once
you're in settings you should see a
screen that looks something like this
make sure you have enable ActiveX and
socket clients checked and down here you
just want to note this number it should
be the same for everybody seven thousand
four nine six and then you want to come
down to master API client ID you want to
specify some sort of client
i D for us let's just say we're $9.99
that's all I'm going to say and when
you're done there just go ahead hit
apply okay and we're all set and the
other thing you might want to check
let's go file global configuration again
API precautions and make sure you have
this checked bypass order precautions
for api orders and again hit apply
okay that should be the only settings
that we need to set now that we've got
the trader workstation up and the api in
theory there even though you don't
really have to set much up it's there
the next thing that we need to do is we
want to get IB pi so we can interact
with this with Python because the actual
tws API is actually a Java API so you're
supposed to be using Java and what I
beep I is is basically it's just a
Python wrapper around the Java API so so
that's what we want to get next so once
you're ready for that you want to head
over to github comm / blame p / ib pi I
will put the links to all this stuff in
the description and once you're here if
you are on Windows anyways just download
the zip file and if you're on you know
Linux or whatever you can use the git
and all that but anyway once you've got
it installed let's go ahead and open
that up folder and here we have our e
demo and then here's our IV PI master
it's obviously zipped up so let's go
ahead and extract it and that gives us
this okay so now what we want to go
ahead and do is come back here hold
shift right click open command window
here
and now what we want to run is a setup
dot PI install so we want to install IB
PI so once you've done that ID PI is now
install and you're ready to use IB PI so
now we're done with this so we can close
this out swinging close out of here and
we don't need our browser anymore I
don't think unless I've screwed
something up go ahead and leave your IB
tws up and active at least
I guess I'll just leave II just minimize
it for now but we'll come back to it
don't worry so now we're ready to
actually start programming with ivy pi
now I think it would be useful at least
to explain real quick because I get a
lot of questions about this and there's
obviously a whole lot we can do with IB
pi because I beep I will pretty much has
everything you want to do with the API
so I mean this is options you've got
different order types just everything
that you might be able to do with the
API you can do without B PI so if you if
there's something you're looking for
chances are you can find it if you head
over go to your Python directory so
generally asking to see python 2 7 or
python 3 4 or whatever and once you're
there head over to live and I set Python
3 4 but I don't pretty sure I beep I
beep eyes like I don't think in active
development anymore so I don't think
it's going to work on 3 but anyway live
site packages and you'll find IB IB PI
is under IB and then in here is where
you're going to find all the stuff that
this does so this is where connection
how you make the connection to their
server and then I want to say it's going
to be an extension and then yeah
anything they like make orders you've
got market data contract we use and
basically all this stuff you know so you
could look through it and see what's all
available to you or if you have
something specific you could look
through the documentation but what I'm
going to do is have a walk through just
simple how do we make orders so how do
we either buy a stock at market or buy a
stock at a limit offer or sell or
whatever so that's what we're going to
cover here so to begin from IB dot opt
we want to import connection and also we
want message and connection so we can
connect message is actually a web Pride
I'm going to use message and this one I
just want to keep this pretty simple but
when you speak to and from the server
it's going to give you back a message
and so if you're having errors or
trouble it can be helpful to like print
out what the message was so the next
thing we want is from ivx
contract we want to import contract and
then finally from ibx dot order you want
to import order so we're going to
connect we set up a contract and then we
place the order for that contract so
first let's go ahead and make this
contract so we're going to define make
contract and in order to make a contract
we need the following things we have to
have a symbol so in this case what's the
stock symbol then you also when you're
making a contract you have to have a
security type so we're going to just do
SEC type then you have to specify on
what exchange under what primary
exchange and then the currency those are
all the parameters that we need it's not
all ready to specify what we want to do
with those parameters because actually
the making of a contract as I just
showed you is done completely by IV pi
we don't have to do any programming we
just have to feed it to IB pi so to do
that now we're going to say contract M
underscore symbol and this is in
reference again to IB pi so M underscore
symbol can be found in the contract
function of inside ib / o ib / x and
then contract is going to be in there
and that'll be the actually nut contract
function that'll be its contract up pi
in there and then M symbol in there so
anyway if you want to look more at the
documentation for that just keep that in
mind so anyway what I was just saying
here extension and then you have
extension contract and then if you were
to open this up you're going to find
this contract class and that's what it's
talking about so all these things are a
possibility right when making a contract
so you can see there's a whole lot of
possibilities here anyway closing out of
this moving this aside so contract item
symbol that's going to be equal to
symbol then
contract dot M underscore sec type
equals SEC tight contract dot M
underscore X change equals next stitch
contracts dot and M underscore primary x
equals prim a and then we finally have
currency so contract M underscore
currency equals curve then finally at
the end of this we just returned
contracts and that's it for mate
contracts so all we are really doing is
passing through some variables through
the already created class of contract
for us so now we've got a contract now
we need to make the order now when you
make an order at least to me you
generally at least with stocks you've
got you know you've got your market
order where you want it to basically be
an instant order and then you've got a
limit order so you can do one of two
things you can either we could have make
market order or make limit order
function specifically or we can kind of
set it up to the point where one
function covers it all and so the way
I'd like to do that is so define make
underscore order and then we're going to
have action so action will correspond to
are we buying or selling and then we're
going to have quantity and quantity is
going to be how many are we buying or
selling and then we're going to have
price and how much do we want to paper
and to start we're going to have price
be a default of none and maybe you can
see where I'm going with this but if
price is not none this means we
specified a price so the next things
that we want to do is order equals order
and order is corresponding to ibx order
order so it's going to be the order
class again
xed and then we come down here to order
just so we can see what we're working
with and this is the order again there's
a lot of different parameters that we
can talk about specify here even more
than the other one so anyway look
through that if you've got specific
order types and stuff that you want to
do but anyway
order equals order now we're going to
say order dot m underscore order type
and that is going to be equal to well if
if the price is not none that means
we've specified a price so if we
specified a price then this must be a
limit order so we specify limit order
with a capital L MT now next order dot m
underscore total quantity that's going
to equal quantity and then order M
underscore action equals action whatever
we say so let's buy or sell and then
finally order dot M underscore limit or
sorry LM t capital PR IC e ni equals
price and that's it for a limit offer
now what if we didn't specify well then
we have a market offer or a market order
so now I'm just going to copy this paste
it down here this remains the first line
remains the same this changes the MKT
for market total quantity stays quantity
action stays the same this time we just
don't specify a limit price that's that
now we're all done with make oh my
goodness I just noticed I call this make
under make order that's quite the type
of anyway now at the end of this we want
to return order and now we're done next
what we want to have here is some sort
of I guess we'll call this at main a
main loop for now
oops the fun name and under Maine we're
going to have con per connection equals
capital C connection dot create and here
you have to specify the port and the
client ID so port and that's equal to
that number I pointed out earlier so
it's seventy four ninety six most likely
for all of you and then also client ID
and we said that was nine ninety nine so
then we run con dot connect and now
we'll have established a connection and
when you run this in this tws here it's
going to come up with a pop-up and it
says you want to authorize this
connection so you'll have to hit OK
and at that point you'll fully connect
it now the next thing that we have here
is in order ID so normally you'll make
your connection and let's say you're
going to make a lot of trades you're
going to run this over a long period of
time you're going to need to add some
sort of counter function that each time
it loops through each time it makes a
trade
it gives plus one to this value so for
now we'll say order ID equals one but
eventually you have to change that and
just like increment it up so now what do
we want to do well we first we want to
specify the contract so we'll use cons
just so we don't interfere with the name
contract and count equals make
underscore contract and what contract we
want to make so let's go back up to make
contract here we've got symbol security
type exchange primary exchange currency
so first we add symbol let's trade let's
do Tesla so that's T SLA and what is
Tesla well Tesla is a stock in to denote
stock it's STK
then we have to specify the exchange in
the primary exchange well we're going to
use smart and then again smart now you
can actually specify what exchange smart
is Interactive Brokers smart routing and
what they do is they will automatically
choose where your order should be routed
to based on price and also where is this
order actually going to be able to be
executed so price and availability and
then the final thing that we specify
here is currency and we'll say US
dollars so we've made the contract now
we're ready to actually execute this
contract so our offer is whoops let's
get rid of caps your offer equals make
underscore order and for now easiest
thing would be let's make it let's make
a limit offer first so we want to buy
how many shares do we want to buy let's
just say one and at what price because
this is a limit so if we said buy one
and just left it like this then it would
market buy one share of Tesla but we can
specify a price and now let's now we'll
become a limit offer for us fancy Dancy
stuff here and now we're ready to place
this so let's do Khan dot place order
and the parameters here are going to be
order ID so oh I D which is one at the
moment and then we want to say the
contract and then our offer and that's
it now when you're all done you have to
run a con dot disconnect this connect
and that's it
now hopefully the only thing I see may
be the order I do conflict but I think
once you restart tws that won't conflict
now that should be it now just a couple
of things I've noted in my time playing
with this is first of all what is this
I'm going to know what this is
remove this over my time playing with
this for whatever reason
sometimes your offer just doesn't come
through so like try like four or five
times before you give up hope because
for whatever reason sometimes it just
straight-up doesn't come through for me
for whatever reason and I assume it's
just you know this is a demo and so it's
just not the perfect thing and also like
I said sometimes like weird things
happen like you just randomly buy stuff
I had a binding Microsoft and I don't
know why that's there anyway let's go
ahead and run this see what happens so
we'll save it let's run it oh we have to
call main course and here's our accept
the incoming connection a temple hit yes
and sec type not define let's go look at
what we've done okay so we said that
let's say this instead let's I don't
think I'll have to increment that so
we'll try and get away with not let me
call main at the bottom here run it
except the connection looks like we made
the connection and but there was no
offer that I see here cuz we did want a
limit offer let's raise order I need to
send it through all the time now just
out of curiosity artist had order ID
like five hundred maybe it's conflicting
with previous order right okay
so I guess for me it was just
conflicting with previous order IDs so I
guess it does save your order ID
whenever you close it not positive it
might have just randomly come back but
I'm pretty sure that's the case so let's
go we can say like 501 now and see like
now it doesn't come in I just don't get
it sometimes that's what I mean with the
demo I'm not really sure how you can
like improve this or why this is
actually occurring sometimes I'm curious
to know if they're actual like service
is better than this if you're not using
the demo account I just
I would hope so but it's anyway so that
should work for everybody you should be
able to make your connection now I
imagine there's like a lot of little
stuff that could interfere with this
because you're not actually like there's
no like API connection there's no login
happening here so I'm not really sure
like it's a very pseudo API connection
that they have here this is the easiest
demo I've ever played with with an API
so anyway there it goes again so I don't
know what to why this does it this way
but anyways that's it with the basics
for IV pie with Interactive Brokers and
all that if you have any questions or
comments feel free to leave those below
well I guess one more thing I'll show
you guys just just for kicks the market
order so let's call this 503 hopefully
don't run it whatever reason it in let's
try it again there it goes
if anybody happens to know why it
appears to be random feel free to let me
know anyway if you have any questions or
comments feel free to leave them in the
section below if you have any requests
for another specific trade or something
like that that to use IV pie with or the
API with feel free to make some requests
below if you have them as always thanks
for watching thanks for all the support
and subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>