<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python and Pandas for Sentiment Analysis and Investing 10 - testing | Coder Coacher - Coaching Coders</title><meta content="Python and Pandas for Sentiment Analysis and Investing 10 - testing - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python and Pandas for Sentiment Analysis and Investing 10 - testing</b></h2><h5 class="post__date">2014-06-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/mKvwcqKbqO0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
another Python Panda sentiment analysis
in finance video in the last video what
we were doing is we made this cow
position function we have it mapping
this function into a position column and
then we finally have a column of change
and this change column is actually where
we will execute any change so by
ourselves so if the change is minus one
we'll sell a stock the change was plus
one we would buy a stock and so on so
now what we can do is we need to just
comment that out we don't need that one
anymore and at the bottom of you know at
the end of single stock auto MA what we
want to do is actually have it return
the current data frame and that's it and
now what we're ready to do is define a
back-testing function that we use this
data frame and test the data so with
that let's go ahead and define back
tests and back test is gonna have three
parameters the first parameter is gonna
be data's so what data are we passing
through what we're gonna pass through
data frame rdf then we're gonna have
close i and change i and this will just
correspond to the you know index
valuation of close and change like what
column is it so we'll get to that in a
moment now we're ready to define some
starting off values here sometimes they
stop holdings and this is just gonna
obviously be how many stock are we
holding okay so we start at 0 so we'll
say 0 and then starting capital and
that's gonna equal data's close and the
0 with element there so the first close
value times 8 so we're basically saying
what's the stock price we want to be
able to buy 8 to start you know so
that's how many funds we're gonna say
we're starting with and so we're
starting with the first closing value
times 8 and that's how many funds are
starting how much starting capital we're
gonna start with let's leave us in the
funds which currently is going to equal
starting capital but funds will change
as we buy and sell stock and then also
stock holdings will change as we buy and
sell stock
now that we've done that we're gonna
have current valuation and current
valuation is gonna normally equal what
is you know how many stocks
how many stock are we holding times the
stock price plus how many funds do we
have and that will be a current
valuation so to start its funds because
we have no stock holdings so it doesn't
matter now let's make some space here
now we're gonna do is we're gonna say
we're gonna iterate through this data
set okay so we're gonna do is we're
gonna say four row in data's don't it er
rows now this is gonna do is literally
it's it arose is iterate through every
row in data's and each row we're
referencing and calling it row okay so
what we're gonna do here is try and
accept and phrenologist put a pass and
that accept and what we want to try is
we're gonna say index and data equals
row now what I'd like to do see is
basically what this is gonna do is
unpack the two variables that are found
in Rome data is gonna be everything else
besides the index and index is going to
be well indexed so the date so I guess
probably it would be useful to show what
this currently looks like so we know
what kind of data were working with and
let me see if I have time imported or
not
no let me go ahead and import time here
at the top and we'll come back down
there we go
let's go ahead and just print row okay
so print row and then we're just gonna
do a time sleep and we'll come out here
me bring this up and we're gonna say
data equals single stock auto women
instead of using Google because Google's
such a large large one let's go back to
Bank of America again or we'll toss
about will do Citigroup and so we
specify data now we specify back tests
and the parameters for back tests are
going to be data close I is gonna equal
three and then change Isaac an equal
eleven under some circumstances we
wouldn't really necessarily need to do
that but since I said early on that you
might delete some columns or I had some
columns it might make sense to go ahead
and specify what those columns are we
could also reference it with the column
that's titled close or whatever there's
a you know a bunch of different ways
that we could do something like this but
this is the way we're doing it for now
so anyways we'll run back tests and
basically that will take the data here
and run it through and we really just
want to see one row printed so let's
just see what kind of data we're working
with while we're waiting I'm gonna go
ahead and delete these two things though
we're gonna continue on until it spits
out what we've got so index data equals
row and then what we're gonna say is row
it's row data equals its and we got an
error
okay so I guess I'm just blind as a bat
and I'm a nice pot this much quicker but
we said in two rows instead it was it
arose so we will save that and we'll run
that one more time oh shoot you know
what it's gonna get really angry with us
because of this try we'll print row
let's run that one more time with print
row not row data and now let's get rid
of this now row data and we're just
running this in the background so we
just want to see what what row looks
like I just was hoping to show you guys
so anyway row data equals data dot to
list and this converts it to a list with
time sleep now it's going crazy on
fabulous oh okay well effort forgot to
hit sleep on so anyway this is what a
row looks like basically you've got your
name your data type is an object
we've got timestamp TZ as none that's
timezone and then we've got type seed
value open close on all the data so it's
a it's not quite what you would have
expected probably this is a little bit
different format than you probably were
expecting it to be in so that's why it's
kind of finicky whenever you go to pull
the data port like well we have to do
index and data this is still an object
so index data equals row row data equals
data dot to list and now we've converted
that row data to list and it still
matches index as far as the index value
and now we're ready to work with the row
data so what we can say is price equals
row data close eye so that's that number
right that index number of you know what
column basically is it and then change
so price is equal to the clothes we're
just gonna use closing price for the
price because these are bars right there
three-minute bars change is going to
equal
well the change and we really want this
to be will convert it will say it must
be an integer and so when we have not a
number it's gonna fail for to be an
integer and we're gonna throw an
exception basically and that's why we're
throwing a pass here so we'll say change
equals in int row data and change I okay
so we'll get the price and the change if
there is a change and then finally what
we can do is we can we can ask first of
all we need to ask two questions the one
question we want to know is if the
change is an integer so if it's a number
and change does not equal zero
well we then we want to do something
okay so well the way we're going to
write this out is going to be the
following so we're going to do if is
instance change int long so if it's a
long integer change and change does not
equal zero what do we want to do well if
let's say change is greater than zero
that means we're thinking of buying so
change is greater than zero that means
we need to executed by and we need to
ask ourselves can we executed by so then
we would want to say if change actually
if change times price is less than the
amount of funds we have so basically if
we can afford to make the full buy that
we want to buy then we're gonna say
funds minus equals change times price so
let's withdraw the amount of money
necessary to make this purchase when
we've done that stock holdings will be
plus equals change
and then we'll say current valuation
valuation equals funds plus stock
holdings times price okay it let's see
so if change is greater than zero else
we'll just pass we'll just say we don't
have the funds to support this purchase
basically now that completes this entire
if statement okay so if the change is
greater than zero means we want to make
a purchase if we can afford that
purchase we make that purchase otherwise
we just passed we don't make that
purchase now l-live change is less than
zero this means we want to make a sale
and so what we want to do first of all
is right now the number is a negative
number
but we actually want to settle a
positive number so what we're gonna say
is we're going to say if that's the case
then change is equal the absolute value
of change so that will just remove any
negative next what we're gonna do is
we're gonna ask the question if if stock
holdings - change becomes less than zero
so if our stock holdings or if this
change would make our stock holdings
into negatives if so let me turn off my
sound what do we want to do well then
actually let's say change equals stock
holdings so if we want to sell more
stocks than we have we can't do that but
we can sell all of the stocks that we
have so we'll do that in that scenario
if stock holdings currently equals zero
then we'll just pass and then else
and in fact actually here's what we'll
do we'll cut this paste this there if
stockholdings equals zero we just pass
Elif stockholdings - change equals or -
change is less than zero then we have to
say change it will stockholdings finally
else else means we actually have enough
stock to sell so else stock holdings -
equals the change whoops this is
lowercase change funds plus equals the
change times price and current valuation
equals I suppose funds flies stock
holdings times price and for now we're
not doing anything with current
valuation but eventually we can use this
to track actual performance later on now
we come down we have this exception no
problem and at the very end after this
for loop so basically one indent over
let's say pre Holdings : stock holdings
then we're going to do print funds and
funds frame current valuation current
evaluation and then finally let's print
a
strategy person growth and this is going
to be so percent change let's actually
write the column here let's say purse
change this is gonna equal okay this is
new - the old / the old times 100 so new
- the old so current valuation -
starting capital capital and this is a
lowercase s here current valuation -
starting capital so that's new - the old
/ the old so starting capital and then
all of this times 100 okay
so percent growth is going to just be
percent change like that now we're ready
to do a full back test on Citigroup
hopefully if we don't have any typos and
all of that and at the end of it it's
going to give us how many stock will be
holding at the moment how much money do
we have what's our current valuation so
current valuation is our current money
Plus how many stock do we have times the
most recent price and then we have
percent change which is you know how
much money did we start with and I
shouldn't wanted to end with and what is
the percent growth that we made based on
that so here we have our answer for
Citigroup we currently are you know this
strata or the backtest ends with us
holding three stock of Citigroup
we have two hundred forty two dollars
our current valuations 383 and the
strategies percent growth was eleven
point seven eight and in fact what we
could do is print
starting fines and this is scroll up
here what did we say was that starting
capital come down here
capital and then we could do a different
stock we could be like thank for America
or something and see what the difference
is between these anyways but that'll
also not only give us the percent growth
but also what was the actual starting
funds amount
okay here we go so we ended here there's
strategy with for Bank of America
stocks and $57 left over are starting
funds were ninety six dollars and
seventy two cents and our ending funds
were one hundred and twenty one point
nine dollars with a strategy percent
growth of twenty six percent it's not
bad we beat Citigroup pretty good on
that one so again this is just a really
basic strategy or buying and selling
completely blinds to price and also the
overall sentiment value and also we're
using extremely crude rules as you can
see we did pretty good there are a few
things that we might want to add to this
though and we probably will later on is
trade count how many trades do we
actually execute here as well as trade
costs so right now we're not including
any trade costs so if if either of these
are high-frequency as in we're making
like three thousand trades or something
to get these profits we're all probably
in a little bit of trouble as far as
trade fees are concerned if we're only
making you know fifteen trades or
something like that then it's not so bad
but we do need to include trading cost
but so far we're seeing some positive
growth here based on some pretty shoddy
rules and the next question would be
okay well these are two companies and
really in the same sector so what is the
actual overall growth right so we don't
want to just test this against two
companies we want to test this against
all of those let's test all of the
companies that we have so in the coming
videos what we're going to be doing is
testing this against a larger group of
stocks to get you know the actual what's
the holistic profit that we're seeing
here so in the nice videos that's
probably what we'll do we'll test this
against all stocks so basically the only
thing we need to do here is just add a
for loop get a whole list of all of the
stocks and run this data but then when
we do that we're not gonna have to we're
not gonna want to have to redo this over
and over so we're gonna want to save
that data and all that so that's what
you guys have to look forward to we're
gonna figure out how good this strategy
really is on all of the companies in the
S&amp;amp;P 500 ish that we have so really SP
600 or so
so we'll be doing the next video if you
guys have any questions or comments on
this video feel free to leave those
below as always thanks for watching
thanks for all the support and
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>