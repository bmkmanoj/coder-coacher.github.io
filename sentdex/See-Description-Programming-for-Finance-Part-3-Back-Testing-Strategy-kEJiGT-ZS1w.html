<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[See Description] Programming for Finance Part 3 - Back Testing Strategy | Coder Coacher - Coaching Coders</title><meta content="[See Description] Programming for Finance Part 3 - Back Testing Strategy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[See Description] Programming for Finance Part 3 - Back Testing Strategy</b></h2><h5 class="post__date">2015-06-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kEJiGT-ZS1w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
the third part of our programming for
Finance tutorial series in the last part
what we did was we started building our
own algorithm here and I'll just run
through it really quick first you have
the initialize method and basically this
method and how this works is all the
code that we put underneath this define
with one tab over basically or at least
one tab over will run as a part of this
define initialize okay so this
initialized method everything that's one
tab or more over is a part of this until
we define a new method so with the
initialize method this is a method that
runs only one time it's the
initialization right and the only thing
we're putting in there right now is
we're just defining our the security
that we're interested in trading from
there we come down to handle data and
handle data runs once per iteration of
time period so since we're doing daily
data right now this runs once a day and
at once a day it calculates what's the
data it calculates the moving average
and what's happening here is we're
defining a new column basically or
actually this would be a series and it's
a series based on the data data frame
which is a panda's object so again if
you don't want to know more about pandas
I do have tutorials on pandas but what's
happening here is we're redefining and
we're just defining MA one as equal to
the data for the context security which
is the spy and we apply with dot a
moving average of 50 to it and then we
do the exactly the same thing again only
with a 200 moving average and then
coming down here we define just some
basic variables that we're going to be
using each step of the way so with that
let's go ahead and create our actual
algorithm now so come on down add
another enter here and what we want now
is the actual logic for our algorithm so
the logic is again if the 50 crosses up
above the 200 that signals that price is
moving upward and if it crosses below
that signals that price is moving
downward so what we can do is use an if
statement if you're not familiar with if
statements
I have tutorials on those I also have
tutorials on
the Elif statement as well so check
those out if you're not familiar but
basically they work as you would as they
sound so you ask the question if and the
question is if the MA one is greater
than the ma 2 that means we want to
invest right well not quite because
basically we want to we only want to
trade at the point of crossover and we
would only do that if we're already not
invested so we need another bit of logic
here so if this is the case and we're
not already invested we want to do
something so we'll add literally an and
here so if ma 1 is greater than maybe 2
and our current underscore positions or
equal to 0 so if we don't have a
position we're prepared to invest so if
all of this is the case we'll hit enter
and then all the code here is contained
within the if statement first we want to
know how many shares are we going to buy
so how much can we afford well as I was
saying before with these three variables
defined we can take cash divided by
current price and that's how many shares
so we can use number underscore of
underscore shares and that's going to be
equal to the integer value of cash
divided by the current underscore price
so how much cash do we have divided by
price convert it to an int because we
can't buy fractions of shares here and
that's how many we're going to buy next
what we're going to do is we're going to
call order and what order does is allows
us to place an order okay and an order
can be either a purchase or a sale so
order takes at least here two parameters
the first parameter we're going to pass
is what do we want to order well we want
to order this context dot security that
we defined up here so I'm going to copy
that paste comma so that's the first
little parameter the next parameter is
going to be how many right so if you
were going to buy 50 shares you would
put a 50 here or a plus 50 and if you
want to sell you're going to put a minus
50 and that would be to sell 50 shares
but we want to go ahead and buy whatever
that number of shares is that we
calculate it so we're just going to
be and paste that in there next I'll
just show you how you can update this
log you can do something like this log
info and you can just add some info here
I'm just going to say buying shares okay
it's good enough and it'll pop up in
this log here or when we go to run the
back test we also had that like log user
interface it'll pop up there as well so
we've done that now that's it that's to
invest but what about to let me come
down here what about if we need to sell
so then we're going to use the Elif
statement again there's I have tutorials
on Elif but basically the Elif is the
combination of else and if so this
question will only run if this question
is false so L if ma 1 so M a 1 is less
than M a 2 this means it's training down
or at least appears to us if that's the
case and we want to make sure that we're
invested if we're not invested we can't
really do anything so and currants
underscore positions you could put not 0
but generally we're going to use an
exclamation mark in an equal sign that
denotes not equal to 0 so this just
means as long as we have more than you
know or more than 0 stocks then what we
we have something to sell so then what
we could do is we could do the following
we could say order and again we could
order this context security that we
defined up here as the spy we could
order context security and then we could
say we want to sell the negative amount
of the current underscore positions so
that would sell all of our positions but
there's a little bit more of a pythonic
way to do this and you can use another
command instead of order this would work
but instead of order we're going to do
order underscore targets and what this
does for us is it allows us to set a
goal basically and so in order target
again we can use this context security
that we defined up here as the spy and
then we can set our target we're going
to say we want the target to be that we
have 0 shares so we'll set that
argot and then we'll go ahead and update
the log we'll say log info and then
we'll say selling shares that's it for
our algorithm now we I want to add one
more thing before we run that and that's
going to be this record so a record so
record and what goes into record is up
to five just anything that you want to
track and it will show it in that little
GUI right underneath performance
basically so the things that we want to
record you'll just define them as what
you want them to say basically on the
graph so on the graph would be we want
it to stay MA one because that's what it
is and we'll say literally MA one is
whatever the MA one is okay so this is
the graph name this is the actual
variable that it's representing and then
add some spaces here ma one equals MA
one then we're going to say ma two is
equal to Ma two and then we're going to
say price is equal to whatever that
current price is right here that we
define so I'll copy that and paste and
that's it we've got the algorithm and
we're tracking three out of five things
we can track let's go ahead and just hit
save here you can hit build algorithm
here and it'll pop up here but I want to
run the full back test so leave this as
daily if you want you can change it to
minute but it's going to take a long
time so I'm just going to run the full
back test on the daily data so in a
moment it will begin and we'll get to
see our algorithm versus the benchmark
and here we go we're starting and you
can see where we've made like here you
can see here in the this custom data
that's the stuff we put in to record and
you can see here that was the first
cross over here where we sold and you
can see that our algorithm flatlines
here that's because we sold out right so
our portfolio value is the same there
and then as we go on we bought back in
and we follow the S&amp;amp;P 500 because it
keeps trending up so we've held for the
most part I think we only made like
three trades here um yeah so you can
scroll down here and you can see here's
a buy a cell and a buy so we didn't
really do a lot of trading but at the
end of the day our total returns were
sixty point six compared to the 80
of the the spy which again is the sp500
spider index fund so that's a basic
algorithm again that algorithm was you
know the SMA crossover of the 50 over
the 200 so a simple algorithm it didn't
beat the market but that was expected
SMA crossovers are not really anything
special so that's that if you have any
questions or comments about the
algorithm how we did anything any
confusion or anything like that feel
free to ask I'll do my best to help you
guys out as we move forward we'll be
doing a lot more complex strategies so
if you're already falling behind here
definitely want to solidify your
understanding before we move on so
anyways that's it for this tutorial if
you have questions or comments leave
them below otherwise as always thanks
for watching things for all the support
and subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>