<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Neural Network Training Data for self-driving - Python plays GTA p.9 | Coder Coacher - Coaching Coders</title><meta content="Neural Network Training Data for self-driving - Python plays GTA p.9 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Neural Network Training Data for self-driving - Python plays GTA p.9</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/F4y4YOpUcTQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody and welcome to
part 9 of our self-driving car with
Python and it just so happens to be
grand theft auto 5 tutorial series what
I left off I was kind of explaining the
next steps we're going to take so some
people might have skipped that video
because they don't like to listen to me
talk you can just make sure you clone
the directory that basic like most
likely if you're watching this right
away you might be able to clone this
majorette well you could clone the main
directory always but probably what you
need is actually going to be in tutorial
codes by then but make sure you just
have the main dot pi grab screen and
draw lanes for a keys and all that and
main dot pi should look like this it
should have the RO Y and the process
image and all that stuff once you have
that you're ready to rhumble I've got it
already put into into here so basically
I'm going to first start by pulling up
main dot pi and basically like what
we're going to be trying to do here is
training a neural network now in the
neural network we're going to be working
with image data so immediately that
should price signal to you we're going
to be using a convolutional neural
network if you're not familiar with deep
learning Python you can come to the deep
learning tutorial series there's part of
this huge machine learning series but
you can also if you are already familiar
with machine learning kind of just jump
into the the deep learning part which is
somewhere there okay and this is with
the first we start with tensorflow and
then we eventually get into TF learn
which is kind of towards the end which
is here so anyway if you need to learn
more about all of these things there's
plenty of information on my website so
sometimes people get angry when I'm like
copy and pasting code but I don't really
see the point of like reteaching
something when I've already taught
exactly that thing so I just don't like
to waste time so anyway yeah so what
will happen what you start with is just
this kind of main dot pie here and we
can actually probably clean this one up
quite a bit but the first thing that we
need to do or like the first step if
we're going to have a self-driving car
that's going to learn from a normal
network as we need training data so the
input data to the neural network whether
we're training or we're actually using
the neural network input data is going
to be the frames right it's going to be
the pixel data with if it's a
convolutional neural network we could
have other input data too but those
that's what we are going to do so want
to throw in the pixel data and then the
output should be the actions it should
be what we hope the vehicle to do so to
Train it initially there's a few things
we could do we could use the previous
code that sort of did okay but that
probably not work the best I mean we
could start with that I suppose but
instead I think probably the best thing
to do would be to manually drive the
scooter a bunch and teach the neural
network this is how it's done so that's
kind of what I want too the way I'm
going to do it now the problem is we
need some way to record the keys that we
press and I didn't know of any way to do
that in Python without actually having
the Python window that was tracking the
keys in focus so I took the Twitter
asked around and a box of hats answer to
me
and provided some code so the first
thing we're going to do is we're going
to make a new script and this one will
be in the github so actually probably
when you clone the github you probably
already have this
but I'm going to make it because I don't
have it up yet but actually when you do
climb it unless I make mistake this will
be there
so anyways that's this script let me
make it bigger ish
let's do sixteen and this is not the
code when I'm just going to copy and
paste in the code okay so this is get
keen spy we're going to be using again
PI win32 and in the last video I didn't
specify what to do to get that so might
not totally be clear what you should
download so what you want is PI win32
and where you get it is my blind here we
go
the unofficial windows binaries for
Python this is probably the best place
to go to get it hi win32 woops I clicked
on the wrong freaking thing that there
we go we're still here alright oh my
goodness back ok oh there we go sorry
now download the wheel it applies to you
so python 3.6 AMD 64 that's 64-bit
python so make sure you get the one that
applies to you anyway this is actually a
pretty simple script I'm embarrassed
that I couldn't figure it out but again
this is another thing I tried to figure
out I just couldn't do it but anyway
yeah so this just goes through all the
characters that one could plausibly
press implements them to the key list
and then the key check function just
simply checks your state and sees what
keys are being pressed I have no idea
why I must just over copied anyway um so
now what we can do is we can import you
know from get Keys import key check and
now we can get the key presses cool I'm
going to close out of that
there's get keys and so yeah so let's go
ahead and do that from get keys import
key underscore press alright now what
we're going to do is basically we need
to have a function that will convert the
pressed keys to a one hot array again
this is a pretty fundamental thing to
know one that works so if you're not
familiar you can check out the neurons
of the tutorial series there and in fact
we we just make the
big configure idle and 18 cool so now
what we're going to do or what I'm going
to do is define keys to output and then
we're just going to set a keys we're
going to pass in the keys that are
currently pressed and then basically
what we want to do is convert this to a
100 rate basically that will be the keys
of the following keys so it'll be either
an A I have capsule a W and D so we're
not really going to worry about slowing
down for now ok it's an unnecessary move
so so basically a WD so this is take a
left
just go straight take a right ok and
then later on we can kind of so first of
all we are obviously ignoring a and W go
straight and turn because like I said
we're just going to assume we're always
going to be going straight well of
course in reality you'd also have an S
you'd have s a you'd have probably not
SW but you could if you wanted to do a
Burnout you could have a WD you could
have D s and so on so there's a lot of
other combinations but for now we're
going to keep it super simple because
again right now I'm just trying to see
mostly like it's just even going to work
you know so so right now we're just kind
of testing things so we're going to
start with output it's not a constant is
going to change 0 0 0 so right now we
have nothing and if we have a 1 here
that means it's a boolean value right
it's a we're going we're going to take a
left if we had one here it would be
forward and so on so now what we're
going to say is based it's just a bunch
of if statement so if capital a is in
keys then we're going to take output 0 s
equals 1 so this will now be a 1 and
then we're just going to copy this and
then just do live else so L if L if B is
in keys that would be 0 1 2 so 2 equals
1 else
if else actually we don't need an if
statement at all we're just going to say
else output one equals one
now this is crucial make sure you've got
this set up correctly make sure you've
got zero 1 into accounted for in this
exact order if you mess this up you're
going to really be kicking yourself down
the lunch finally what we're going to
say is return output and I'm just going
to confirm because I don't want to mess
this up zero it which is AWD so 0 1 2
which is take a right 1 1 4 good I think
that looks good so we return the output
and we're good to go now what we're
going to do here is we don't need to ROI
we don't need process image we don't
even need these turns we can use the
count down so I just deleted everything
basically we just have keys to output
we've got this like sleep which is kind
of poorly placed let me just move it
over into here lack of so hopefully I'm
not screwing up something all right now
before we enter the main function let's
go ahead and say file name equals
training leaders for data dump I and
then we're going to say do B and I need
OS import OS also let me see here we
don't need we don't need direct keys or
draw lanes part of me wants to get rid
of PI o Tokui and someone pointed out
that might just my importing of peyote
GUI was slowing things down and in fact
if that's in the github bones I was
intentionally trying to leave out the
import PI o to do it because I think I
might be the only person actually needs
it but know it's there darn it
so I'm thinking about it I'm just going
to go ahead and edit that real
quick not necessary okay so yeah as I
was saying I'm gonna leave you there it
just stays actually no I don't need that
we're not even we're not going to put up
a new screen
we're actually totally done putting up
new oaken TV screens play for a long
time so yeah we definitely don't need it
so that will help framerate a lot in
fact let me get rid of this and we're
not going to be needing this and we
don't need any image show we don't need
to process image we just need to grab
the screen and then like we can look at
the times so just to kind of show you
how quickly we can process now let me
run this also to give me a kind of
confirmation that we don't have typos
can I import name keypress really do you
want to fight let's see
grab screen grab screen Oh have I called
it literally grab sleep wait what a keep
breath
oh no we're okay whoo dude anyway wrong
thing from get Keys import key
underscore press get keys key check
check and we haven't used that actually
yet anyways how's it big mistaken I'm
tripping out right now anyway okay so
the countdown has begun
yeah Wow check this out that's how fast
we're processing frames now like we've
got a really good frame rate so anyway
and a lot of that is because we're not
showing the opencv frames but a lot of
it's actually also just because of using
grab screens instead so that made a huge
huge huge difference with Pi win32 that
is anyway so we were importing OS now
back to what we were doing anyway having
some serious brain fords this is this
pride isn't end well everyone if OS dot
path dot is file let's check for the
file so let's just see if it exists
because here's the deal guys we're going
to need to make holes not different I
want and we're going to need to make a
lot of training data and chances are you
can get really bored of doing this it's
not fun it's not fun to drive a scooter
in between lanes it's just not enjoyable
so but we really needed we need to do
this first before we do anything serious
I think because we want to check we want
to see canvas actually be done so anyway
what's nice in the way that I've kind of
coded things is or that I'm going to
code things is we're going to see if
this file exists if it does we'll load
that data and we'll just keep it pending
to it and then every let's say so many
iterations we'll save that data that way
we can kind of come back come and go as
we please
so yeah so if that's if that file exists
great let's just say print file exists
loading previews data
else friends while does not pick this
starting fresh and then also I guess we
should probably find this so it's a
training data equal the list version of
NP bot load finally I want to do this so
I can append to it
I'm pretty bad at appending to numpy
right I just don't know the proper
protocol I don't think you can just you
can't just do dot append I don't think
anyway
training data equals that someone wants
to improve that because it'll be faster
just to just straight up and um PI pull
request okay
so just let me know and I'll throw it in
there I like half the people that have
improved the code haven't done it
officially they just don't send me a
gist or something anyway so okay so now
we've got the train data now we've got
the we got a countdown that's fine now
basically what we want to do is every
time we grab the screen first of all we
need to we grab the screen we've got the
region we want to convert the screen to
grayscale we could keep it in color but
you just if we can avoid the color thing
it would be nice because think of it
this way can you play grant that's out
of five in grayscale yeah so if you
could do it but neural network should
figure it out right that's the kind of
whole point so and if we can trim down
that data because like grayscale is
one-third the size of fully RGB data so
we want to scale it down from ten so we
are going to do this so we're gonna say
now brain equals C v2 dot convert color
we're going to convert the color of our
screen and we're going to do CBC you got
all caps color underscore BG our data to
grade it up now we also finally want to
resize this to start let's keep it nice
and small we're just going to say screen
so say v2 dot resize let's do the screen
and we'll do 80 by sixty eventually I
wouldn't mind getting that a little
bigger but I think for now
just seeing the lanes 85/60 should be
more than enough
feel free to visualize that yourself the
80 by 60 like when we save the data we
can pull it up and look at it I'll
probably forget to show you but you can
do that and you should be able to see
that okay I could see how you could play
with that size like you might want to
blow up an 80 by 60 it but it'd be you
know truly of that resolution but you
can still stay within lanes at 80 by 60
also for a non-network a convolutional
neural network 80 by 60 is actually kind
of large so anyway so yeah so we've
resized and then now let's go ahead and
check for the keys so I'm going to say
keys equals key check and they're going
to say the output for the actual
training output that we want we're going
to say keys to output and that'll be the
keys and then finally we're going to
just do training underscore data dot
append screen comma output and that's it
so now what we want to do is we will say
so this is just basically appending
constantly sorry if you can hear the
jets flying over my house by the way I
called the Navy and I told them that
would be nice if they would just like
you know give me a warning every time
they fly over but they don't they don't
seem to care anyway what I'm going to do
now is her supposed to Air Force the Air
Force and Navy our buddy but anyway
moving one gift from Glenn OH training
data modulo 500 equals zero so if you
were to divide by 500 with the remainder
be zero if that's the case let's go
ahead and print
and training data and then let's go
ahead and empty got save file names
training data so save to the file name
save what training data I mean all right
that should do it for creating training
data let's go let's try let's see how it
does so hopefully it'll get some files
up in there
every 500 a to let us know that we've
done something also let me make sure yet
we're in first-person view will have the
countdown and then basically if you want
to stop at anytime later on a ladder a
fancy way we could just like pause or
something got to keep that youtube
activity so what we'll do is like for
now you can just kind of tap out and
just control see so right after you get
a 500 frames update go ahead and control
C or tab out control C and that will
stop the script and you won't have any
screwed up frames but later I'll add
some way to pause or something bright
but anyway for now again we're just so
far from doing any official testing but
anyway four three two one go got frickin
frames up the wazoo
now for this so I'm just going to try to
stay kind of in the middle of the screen
as best as possible this scooter is fast
I think I might have a speed mod or
something on the scooter anyway so yeah
I just keep doing this we prize should
get rid of the whole frame took it's
really hard to see when we get an update
next time I see one I'm going to pause
it there we go okay ctrl tab out ctrl C
please stop okay control so you didn't
work but that's fine I pretty sure I
stopped it in time so I'll save that and
sure enough here's our training data
here so we actually have some stuff in
there and stuff so anyway um what I
suggest you do is do this till you have
um you know ideally a hundred thousand
but I mean actually ideally a million
but probably about a hundred thousand
frames because the other thing that
we're going to be talking about in the
next tutorial is balancing this data
because it's going to be mostly go
straight and if we send that through a
neural network the neural network is
going to really quickly find out go
straight except in all these outlier
circumstances and it's going to fit to
that it's going to over fit to that and
now when you go to actually use it your
neural network is going to be like
always straight touch that's going to do
to you so we have to balance the data so
anyways that's what we're going to do in
the next tutorial if you're having any
problems or whatever up to this point
we'll also also try in the next tutorial
to look at this data just to show you
that yes the state is working here it is
it's beautiful
but yeah questions comments concerns
issues whatever feel free to leave them
below otherwise I will see you in the
next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>