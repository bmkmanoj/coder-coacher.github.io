<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Acquiring a Vehicle for the Agent - Python Plays GTA V p.20 | Coder Coacher - Coaching Coders</title><meta content="Acquiring a Vehicle for the Agent - Python Plays GTA V p.20 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Acquiring a Vehicle for the Agent - Python Plays GTA V p.20</b></h2><h5 class="post__date">2017-09-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VRsmPvu0xj0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
another tutorial on teaching AI still
vehicles in this video we should be able
to wrap it up and actually have an AI
that steals a vehicle in an environment
of course so let's get into it so the
first thing that we're going to need is
we need some way to actually control the
mouse so the cold people have pointed
out like hey man you can you know send
keys and control the mouse easily with
Pi auto GUI well all these people have
been doing that inside of San Andreas
and I think GTA 4 as the environment but
this does not work in GTA 5 any I'm
pretty sure it's like any DirectX game
you have to use direct input direct keys
stuff like that to get in and with the
mouse I'm not really sure the official
name for that but pata GUI just simply
doesn't work in GTA 5 so it does sort of
depend on your environment if you're
doing this in some other game
you might not need the following script
I'm about to link you guys to so you can
feel free to try pie out of GUI first
it's a lot easier a lot simpler but if
that doesn't work I got you back
so anyway so what i'm going to be using
is keys pi and that's coming from again
the the pi GTA v github and this was all
created by daniel not still not gonna
say his last name so i can't pronounce
it but anyways and then there's some
examples of of using it down below what
we're mainly interested in is actually
moving the mouse and actually don't
think there's any new sample for moving
here but that's okay i'll show you guys
how to do it anyways oh this one moves
the mouse it looks like and this would
be this would be an example of moving
the mouse a little more smoothly than
the way I'm going to move the mouse and
that's gonna be one of the problems that
we're gonna have and I'll I'll talk a
little bit more about why we don't
necessarily want to do exactly that
but anyway so so go ahead and you know
download this file copy paste whatever
you go to raw you can go click save as
whatever you need to do get the file put
in your working directory and
let's go so what we're gonna do is we're
gonna go ahead and just come down here
and we're going to import keys as k so
that's at keys PI we're also going to
import time and that should be it
so now what we're going to do is we're
going to come down to where functions
are starting to be defined and we're
going to make that determine movement
function so to find determine underscore
underscore movements and this takes mid
X mid Y and then we also so the mouse
doesn't move in percentages of the
screen thank goodness because for me I'm
not letting Grand Theft Auto take up the
whole screen it's a 4k screen passing
the 4k image is expensive it's just
easier I'm doing 1280 by 720 so mid X
mid Y so and then we want to say the
width is what I'm gonna set a default to
be 1280 and then the height is what I'm
gonna set a default to be 705 that's
because of the title bar basically in
the window so when we go to grab the
screen we're kind of ignoring the title
bar so so basically when you when when
you're running window to mode in GTA 5
let's say and you say okay I want to run
windowed mode in 1280 by 720 uh-huh it's
going to the title bar is part of that
that resolution so so in this case it's
it actually creates a window that's
twelve eighty by seven oh five of the
actual game it might be a mistake in but
whenever I do a CV to and show this
works and if I did 720 it would have
the-- in the grab screen part it would
have part of the title bar anyway
continuing along we're gonna say why
move let's actually start with X mu X
move equals zero point five because
again we're so so so these we know these
are the pixel resolution basically of
the image we're going to attempt to
determine movement on and all this is
going to be relative the grab screen is
what determines you know where we're
looking for the screen
on our monitor this function is only
going to determine okay we know the Matt
we're just assuming we're in them in the
game relatively how much do we need to
move our mouse around so the center of
the game screen again relative to the
grab screen that we've already done for
X will be 0.5 and for why it would be
0.5 that's the center of the screen now
to figure out how much we need to move
mid X mid why this might be somewhat
confusing but midex mid why is the the
middle points of the actual object the
car that we're looking for so the center
of the screen is 0.5 0.5 the center of
the object is mid X mid Y whatever those
happen to be so then we just subtract
0.5 minus mid X and then minus mid Y and
that gives us the the the distance from
the center of the object both for the x
and y so at that point we have relative
how do we need to move the mouse to find
where we want to go okay now we need to
do what we want to do now is we want to
get how much to move so now we're gonna
say is how much x equals x move divided
by 0.5 how much why should we move
that's going to be y mu divided by 0.5
and then what we're gonna do is move the
mouse so the way that we can actually
move a mouse is going to be its its
since we all I forgot to I forgot to
bring in the keys part of this so at the
top you know you import keys is K we
need to start the keys object so we're
actually I'm just gonna say keys is
gonna be our key objects and we imported
keys as K so it's gonna be K dot
keys and then right now there's just
nothing in here it's just empty so
that's how we got it we have to begin
with that so now we've got our keys
object let's go back down mmm nope it's
a defining function here and what we
want to do now is move the mouse so the
way that we can move the mouse is with
I'll just write it out first so we're
gonna say it's gonna be basically keys
dot keys underscore worker dot scent
title cased input and then the input
we're gonna send is keys keys underscore
worker Mouse so it's gonna be a mouse
input it's going to be a mouse move so
it's 0 X 3 zeroes 1 and then you've got
your X movement
you've got your Y movement and that's
how we can move the mouse now our X
movement would be how much X again
relative times the width
now you also can't move since its
relative it's gonna be a decimal so this
might result in a decimal and we don't
want a decimal because we can't move
half pixels so it must be an integer ok
and then we need to do the exact same
thing to the Y so let's go ahead and do
that confident paste how much Y times
the height but we're not done yet
because part of the problem here is
really probably should've known as mid X
minus 1/2 that would have made a little
more sense but since we've reversed that
the movement actually needs to be a
negative 1 times that and then again
negative 1 times that so so flipping the
sign of both of these values and that
should be where remove the mouse so
at this point we've got the code
necessary to to actually take the mouse
and aim it towards some sort of object
and now what we need to do is go towards
that object and maybe steal that object
or whatever so so then so then what we
need to do is just just down here what
we can do oops where's our main here we
go so we're gonna add a stolen equals
false right before this loop here so
we're gonna say stolen equals false and
then while true we're gonna just run
through all of all of this code and here
we determine the movement I think what
I'm gonna say is you know all this can
still run but then we only want to steal
the vehicle if not stolen so what I
would say is you know yeah you can get
the closest vehicles and all that but
probably like I would just check
immediately like if not stolen get all
of these values tap over thank you
so if not stolen calculate all these
values determine the movement mid X mid
why I'm gonna keep the default sizes but
if you do a different grab screen just
notice note that and then what we're
gonna say is if the closest car is less
than 0.1 is probably good ones so the
other value like if the car was too
close while we were driving we said 0.5
but if we need to be close enough to
steal the car so we're going to say if
the closest is less than 0.1 then what
we want to do is basically we want to we
want to go ahead and actually let's
leave that for now and instead I'm just
going to say else oh you're gonna do me
like that
you're killing me
let's see it let's see if I can get away
pass no you I just want the tabs to be
perfect so let's just do this else so if
the closest is less than 0.1 we're gonna
pass for now otherwise what we need to
do is Keys dot direct key on that's
camel cased we press W if it is if it is
close enough though what we so basically
the pressing W we're just gonna go
towards the car so W just steps forward
and here we're aiming the mouse at the
car so that'll get us to go towards the
vehicle if it is close enough though
what do we want to do well what we're
going to do is keys direct key cam case
again W but this time actually we want
to keys key release and then so we
release W and then we press F because
that's the key to steal a vehicle and
then we're going to time that sleep for
0.05 and then we're gonna go ahead and
release the F key so we just want to
press it one time and we don't want to
press it for too long and and then after
that we're just gonna say stolen equals
root okay whoops hopefully we don't have
an indentation error because of this
this tab inconsistency we'll see how it
goes so so this should work there's
there's a couple sloppiness things about
this code that I'll talk about in a
moment but first let's just see if it
actually works
so I'm gonna go ahead and pause the
recording and bring up Grand Theft Auto
and start the script and make sure that
we don't have errors if we have errors
we'll talk about them but I will see you
in a moment alright this will be the
very first attempt we'll see how it goes
if we have an error somewhere in our
little or actual vehicle checker I'm not
even sure I'm at Vimy me in a vehicle to
be honest hmm that's gonna cause a
problem I think I'm in a vehicle right
now
anyway let's just see if we hit an error
let me out of the car Oh so we did we
did have an error for one and I also
can't seem to get out of the vehicle
what I can't even get my guy out of the
vehicle and python is ceased to work all
right great
so anyway I did have a typo oh you can't
see it let's pop into the Oreo so this
was the error on a Mara closet we needed
it to be closest so closest closest
thanks I didn't know hopefully that
doesn't disrupt exploit exploit likes to
crash Python and so I feel like xsplit
might even use Python okay let's take a
take two but I also need to get out of
this car why would why can't I get out
of the car okay
I'm gonna pause things and get out of
the car and and then I'll be back all
right take two hopefully we don't have
any errors let's see up still closet
what are you kidding are you kidding are
you kidding
where is closet you guys can start the
jokes now there's no JIT did I just not
save it I guess I just I guess I just
didn't save it that's super frustrating
okay take 92 in a moment it's going to
take like 15 years for Python 2 to
finish crashing on me and there we go
okay let's restart any pause well it's
restarting take on a second take 6000
there we go vehicle spotted and I guess
he got closer no maybe not okay
Wow he doesn't think that's a car or
does he I can't decide I can't decide if
he I mean cuz I only like showed like a
couple of times
and they pass it I really I tried to set
that up so we didn't have to wait too
long but yeah he's definitely still
trying to approach vehicles a run would
help but hopefully that light stays
right see in this case he's like I don't
know which car oh no they got away
oh poor the problem is mm we probably
picked a number too small we might have
to move into first person let's go first
person I should get a little closer that
might have been too close I think you
just try to steal that car
we might have to I'm gonna restart it
real quick all right and again we have a
car in front of us they might get away
but we'll see sorry brother it's for
science it's for science all right so we
stole the vehicle look good and then we
should be able to get out and oh well
actually I have the doors lock but
anyway so that's how we can train an AI
to steal vehicle so obviously we have a
couple of problems one of the major
issues with this is when we attempt to
steal a car we're just assuming it got
stolen Wow well anyway when we press the
F key to actually steal the vehicle we
just kind of assumed stole it it would
be better to have some sort of detection
that okay we're now in a vehicle so
maybe you see the hood of the car for
example or in my case we've got a
speedometer here so we could just look
to see if we have a speedometer or even
better yet a clock because it's at X
o'clock every like five seconds there
anyways so so you could know if you were
in a car or not with a few different
metrics you could also try to like maybe
listen for the sound of the car or
something like that or you can use like
game engine information that is not a
fire hydrant but my goal has always been
like let's try to use purely visual
information to play grand theft um so I
kind of want to continue using just
visuals anyways
that's just a simple example of us
spotting a car and moving towards the
car and stealing the car doesn't break
okay all right sure anyways yeah that's
all for now if you guys have questions
comments concerns whatever up to this
point feel free to leave them below all
throw wise I'll see you in another
tutorial
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>