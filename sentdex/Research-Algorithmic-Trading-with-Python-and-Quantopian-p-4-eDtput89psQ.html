<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Research  - Algorithmic Trading with Python and Quantopian p. 4 | Coder Coacher - Coaching Coders</title><meta content="Research  - Algorithmic Trading with Python and Quantopian p. 4 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Research  - Algorithmic Trading with Python and Quantopian p. 4</b></h2><h5 class="post__date">2017-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eDtput89psQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
part 4 of our quanto peon tutorials and
part 16 of the python for finance Torah
series in this tutorial what we're me
doing is kind of diving into the
research environment so to start what I
want to talk about real quickly is I'm
just going to reference this basically
the introductory post alpha lens which
is a tool that's going to allow you to
to analyze alpha factors or at least
factors that you hope to be alpha
factors but in this post and we'll come
back to explain alpha lens when we
actually get to alpha lens but I thought
this was a decent breakdown of the work
flow that you would you would actually
go through to create a trading strategy
so in the past on quanto peon the way
that you you kind of worked on a trading
strategy was they just had the bat
tester so what you would do is you would
you would think of a strategy in your
head and then you go to the back tester
you kind of arbitrarily limit your
universe of plausible companies you
could even invest in usually buy I would
do like buy market cap or something like
that
and then from there you would execute
your strategy and you would kind of
validate or invalidate that strategy
based on the returns that you got
compared to market you might use Sharpe
ratio you might use a Sortino or
something like that but at the end of
the day you were basically validating
and validating a strategy based on like
returns like s alpha beta volatility
stuff like that but it was it was so
like very specific to your exact
strategy and it wasn't very it wasn't
going to be necessarily telling to the
actual factors that are you were
treating as indicators whether or not
they actually had any value at all so
there were going to be times where you
didn't necessarily make money but your
actual theory on what is a good
descriptor of what may may make price go
up or down was correct or other times
you might have actually made money but
your theory of why was actually
incorrect so we use research to kind of
try to separate the two things out and
the steps that they suggest you kind of
take which I think kind of makes sense
number one universe selection in our
case we're just word
select the universes that they've
they've come up with a queue 1,500 and a
queue 500 which are like the top it's
almost like an index of the 1500 most
liquid stocks because if we're going to
be creating trading algorithms we're
kind of assuming that our trades are
going to execute within you know
hopefully like minutes it's not really
quickly like instantly seconds
hopefully minutes but we're not planning
for them to take days or something like
that and to have huge slippage and all
that so what quant opions done for us is
kind of compiled a list that gets
updated if I'm or if I recall correctly
nightly so every night this kind of
indexes is changed and obviously
historically you'd access that
historically and stuff so it makes for a
really great universe selection and it's
still a large number of stocks but it's
going to be stocks that makes sense to
like actively trade next you've got
single alpha factoring which is or
single alpha factor modeling which is
what we're going to be focusing on
mainly in the research environment so
this it's really important to
differentiate this from a strategy so
you want to consider alpha factors kind
of irrespective of your strategy and
I'll try to try to really clear that up
when we actually get down to it and I'll
kind of point out what's a strategy
versus what's kind of your alpha factor
or what you hope to be an alpha bacter
number three is alpha combination so
generally you're going to have a
combination of alpha factors so so for
example an alpha factor like leading up
to this what our alpha factor was that
the 20s ma crosses over the 50s ma price
goes up if it crosses below price goes
down right those are factors and we're
claiming that that has an alpha signal
and what we would do is we would just
compare 20 to 50 SMA is it above or
below its binary value and you could you
could actually check the alpha on that
so that's like an example a really crude
alpha factor or a factor anyways there
probably is a little bit of alpha but
there's probably a lot of spread who
knows anyway the idea though is that you
were going to combine alpha factors
together and again the Alpha that we're
going to use or the factor that we're
going to use
is going to require combination and
you'll see why you want to combine them
then risk model this is really something
more so that you're going to set for
yourself and also point Oh peon will if
you want to get into the Q fund they are
going to impose a risk model but this is
something more so that you just have to
come to a decision about but yeah and
then the portfolio construction
execution okay this is your strategy
kind of and so once you've once you've
selected your alphas and that makes
sense the actual strategy mate or the
actual signals make sense then build the
strategy because chances are your
strategy out of the gate might not
actually work very well but you know the
alphas are there so you kind of try to
work around that but these are meant to
be two totally separate things so with
that let's go ahead and hop into the
actual research environment so what I'm
going to use is a modified version of
the notebook that it's somewhere on this
page anyway the Jamie McPherson posted
yeah right here so a lot of this is just
kind of my modified version so just it's
mostly his notebook with some syntax
sprinkled into it so just wanted to give
credit where credit's due there so this
was this served as my like main
reintroduction to the research
environment because mostly like the
thing that i didn't like about the
research environment is that it forces
the the ipython notebook on you and if
you if you've followed my channel then
you know I don't like ipython notebook
but like I've always said it makes sense
to be ipython notebook especially in a
research environment it's just I'm not
familiar with it so I try to avoid it
but here we cannot so I'm going to make
a new notebook and I'm going to call it
here and I'm just going to call this Q
research tutorials it okay there and
let's go ahead and begin
so the first thing I'm going to go ahead
and do is from quant opions
dot interactive dot data dot syntax
we're going to import sentiment so this
assignment data from yours truly and in
the notebook environment you will import
the interactive data and the interactive
data is a is going to be a blaze
expression that doesn't have to mean too
much to you but it's using blaze which
is kind of like a it's a it abstracts
away the like the storage and the
storage kind of data and the computation
of data and when we do that we get much
faster processing times on data frames
for example so with a panda's data frame
using blaze you're going to see speed
ups when you're doing relatively simple
computations at least like four to six
times as fast which is a lot of a very
significant amount of time when you're
dealing with as much data as we're
dealing with here so it makes sense to
be a blaze expression and you can get it
out of plays expression which we will
soon enough so that's our data and when
pretty much the code that you write in
the research environment is code that
you can take from the research
environment in just basically like copy
and paste into the algorithms but some
things are different like for example
here you wouldn't be using the
interactive version you'd be using I
think it's just quant open data I can't
remember when we actually go in and do
it we'll all know then so so we've got
some sentiment data and the sentiment
data is just a sentiment score signal
for a company it ranges from negative 3
to positive 6
positive 6 is just as positive as
negative 3 is negative I just simply
wanted a little more granularity on the
positive side of things just because at
least from my testing it seemed worthy
to get a little bit more granularity on
the positive side and not so much on the
negative side so okay so we've imported
sentiment now we're going to bring in
that the Q 1500 data set so we're going
to say from quanto P quanta
you dot pipeline filters dot morning
star we're going to import Q 1500 us so
that's that that basically index of the
of highly liquid companies so normally
quanto peon gives you like over 8,000
companies that in theory and you're like
universe of companies you could invest
them and this just instantly whittled it
down to 1500 it will eat will take it
even further when we look for companies
that actually have sentiment L on them
and stuff like that but this is a good
place to start especially because all of
these are highly liquid it's not
necessarily going to be the case that
all the companies that we have sentiment
on are also highly liquid so once we
have that we can kind of poke around
like so because you say type sentiment
and this will kind of just tell us it's
not a panda's data frame
it's a blaze expression and we can kind
of see all the things that we have at
our disposal so we can see we can do the
traditional dot head if we wanted we can
do some mapping we can do various things
to this blaze expression but we can't do
everything for example there's no plot
right you'll have the option to plot
this data so so let's go ahead and
interact a little bit with this data so
first we're going to say Bank of America
is equal to symbols I think you can use
the SID thing here I'm not positive but
there's no kind of interactive look up
for Sid so I have no idea how to do it
so so instead we use symbols will say
Bank of America dot Sid and then I'll
give us the SID for Bank of America now
we're going to say back sentiment that's
going to equal sentiment where and we're
going to say basically where sentiment
dot Sid is equal to Bank of America then
we're going to say we'll actually leave
that and I'll show you what I meant
about speed so for example we can do
back sent an
got head which is going to be more of
like the pandas version although this is
the pandas version on top of a blaze
expression but even this you'll see is a
different speed so we wait a few seconds
here and it comes up but then when we do
the blaze version is peak so we could
say
sentiments dot peak run that and as you
can see hopefully just even visually
just kind of in your head timing that
that the second version is faster now if
you do want to learn more about blaze
let me just kind of pull over here you
can check out their documentation I'm
not going to I'm going to do my best not
to throw too much blaze specifically at
yeah I mostly just wanted to show you
peak because it's useful and then I'm
also going to show you how to convert
out of the blaze expression because
that's also going to be useful but and I
assume at least because we use pandas in
the beginning you should you should sort
of understand how to use pandas and this
is kind of why I wanted to start this
entire finance series with just let's
just do Python plus pandas first because
once you start layering on quant opium
quant opium comes with its own kind of
magic imports that are just there and
helper functions and then but it also
uses pandas and then it uses alpha lens
which is its own package and pi folio
its own package it's built on top of
zipline and so on so I hope that was
helpful for the people who who weren't
already yet familiar with you know
pandas at least or even just Python to
keep those separate but anyways so
that's our sentiment data and now let's
go ahead and we can take this out of a
blaze expression so to do that we're
going to need blaze so it's already a
blaze object but it was done the back
end so we're going to import blaze to
use blaze and now we're going to pull it
out so we're going to say back sentiment
again is equal to bull blaze compute
back sentiment and what blaze that
compute does is it just simply returns a
panda's data frame so we're going to
have our pandas dataframe back here
type backs in a minute right it's a data
frame now so now we can do things that
we expect we can do with data frames
such as we can plot now unfortunately
right now if we do back sentiment ahead
which we've we've already seen the head
but we can see the index is actually you
know down here and the real date that we
want is over here or here so there's a
few things we could do we could just
graph it anyways or we could fix the
index issue now that it's in a panda's
data frame so for example we could say
fact sentiment dot set underscore index
we're going to set that as the adds of
underscore date and then we'll do this
in place equals true so don't redefine
it and then now back sentiment head so
we've got the new index and all that
it's the date and then now we can like
plot it so we could say let's do back
underscore or sentiment and then we'll
do the sentiment underscore signal dot
plot and there's a plot of the signal
now we'll just say the initial data
coming in for any company the first
initial signal basically is going to be
much more noisy initially because the
signals are generated by simple moving
average crossovers of the raw sentiment
so initially like those moving averages
are 100 250 500 and 5000 so initially
it's going to take a while to get like
the 5000 and so on so the initial data
is much more noisy later on you could
you'll see that it smooths out so for
example let's say back let's say back
sentiment equals back sentiment of Bank
of America sentiment where the index is
greater than and we could actually just
pass a string here so we're going to say
2016 Oh 601
and then again we'll just plot this
exact thing again so I'm just going to
highlight copy come down here paste
let's run and as you can see that's much
smoother also I mean it's important to
note that this is a graph of like three
years more than three years of data so
it appears noisy but this is like
changes over the course of three years
so it's not necessarily the case on that
it's like super noisy and this is
obviously much much smoother okay so
that is kind of a nice quick
introduction to the research environment
you can basically pull in all kinds of
data in this case we've just pulled in
the same text data but you can pull in
any of the data you want you can pull in
pricing data you can pull in third-party
data like the semtex data set most of
the third-party data is not all of it
comes with sample data that you can play
with so you don't have to pay for
anything so you can pull in that data
the only kind of annoyances a lot of the
sample data like cuts you off at some
point
that's it doesn't give you a huge
timeframe to test against that's the
only kind of downside and some of them
are different right and if you're using
multiple data sets you're going to have
to go with a date range that is
basically the minimum of all your data
sets so that's kind of a bummer but you
have but you have a ton of data at your
disposal so this is just a simple
example but as you can see in the
research you can cut you can play around
with the data frame do some graphing see
what your data actually looks like and
once you're kind of content and you're
ready to move forward you're going to
first build a pipeline so the pipeline
is what we're going to talk about in the
next tutorial and you're going to use
this pipeline bolt when you go to
actually trade your algorithm as well as
when you are going to use say alpha lens
to analyze your alpha factors so anyways
pipelines what you have to look forward
to if you have any questions comments
concerns whatever up to this point
anything confusing do let me know if I'm
doing something Anaya Python notebook
you have a suggestion on how to improve
let me know I don't know like any of the
shortcuts or anything like that
so any help is appreciated
so anyways I will see you in the next
tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>