<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to modify data granularity in Python for Graphing data in Matplotlib or another application | Coder Coacher - Coaching Coders</title><meta content="How to modify data granularity in Python for Graphing data in Matplotlib or another application - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to modify data granularity in Python for Graphing data in Matplotlib or another application</b></h2><h5 class="post__date">2013-11-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/INf7VUHUpjk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on guys welcome to another
Python tutorial this one's coming from a
request I got on Facebook to show how
you can change the granularity of data
being shown on a chart so what is that
in case you don't know what granularity
is it's basically how much data is being
shown on a chart so in this example here
with this one day of gbp/usd Forex ratio
data we've got 62,000 data points well
your I can't see the difference between
62,000 data points and like 12,000 data
points the only difference is a minut
change in like the thickness of the line
sense that is so close together it makes
the line look thicker but as far as the
trajectory and everything like that
there's really no difference there the
main difference though that is you're
being penalized for is the amount of
processing time it takes not to load
that data but actually to draw it up on
a chart so whether or not you're using
matplotlib or you're using some other
maybe a JavaScript chart you're using
Python in your back-end to load the data
and display it on you know maybe some
sort of web app that you've got the real
problem and the real processing time in
the real loading time for your user is
actually in the loading of super high
granularity data that you don't need in
the only time you need that granularity
is when you zoom into the chart well
then when you zoom into the chart you
don't even have to be loading old or
that data that's not being shown so
there's a lot of ways that you can use
this to actually save on a ton of
performance so that's what we'll be
covering today so this code right here
is actually on my website I'll put a
link in the description for anybody that
needs that I did put up the raw code
here for you guys for modifying the
granularity of data here the sample code
is here the web address is just syntax
comm slash capital gbp/usd dot zi p 4
zip comes with a 1 day of data and
actually comes with a month of 4x tick
data so you can play with that if you
want but for the video we'll just be
using that one day and then here is the
actual sample code and then I also just
included some images here this would be
62,000 plots so the full 60 mm
then with the function that we'll be
writing this tutorial this is one fifth
of that so twelve thousand plots
basically you really can't tell the
difference between these two charts
again other than the thickness of the
line see like right here it just looks a
little thicker simply because there's
more points and so just you know gives
the impression that line is thicker but
it's not and then this was one fifteenth
granularity again you didn't really lose
too much you did lose the highs and the
lows right that this line Peaks a little
bit lower than the original line which
is slightly above this dotted line then
we come down here and it's almost
kissing that dotted line but for the
main focus of you know the point of
granularity is to save on loading time
and show the data that matters and so
it's it's definitely a huge huge help
and you don't have to go down to 115
right we've already shot you know a
fifth of the granularity saves a ton on
processing and you don't really lose too
much so that's what we're going to be
doing in this video I should write a
function where you can choose how much
you know granularity you actually want
so go to the link in description get the
sample data and get that starting code
that will look just like this basically
so now what we actually want to do is go
ahead and write a function to do this
now really as with anything I mean
there's just you know pretty much an
infinite number of ways that we could do
this but what we're going to do is just
depending on the granularity we're
basically going to average that data so
that's usually how most charting
applications are going to do it if they
offer granularity changes is they just
take a group of data and they average it
so that's what we're going to be doing
to change this since this was a you know
some old code that I just wanted to take
it's some code that displays some high
granularity data so that's why I'm using
it so what we want to do is we're going
to go ahead and take this part the the
part where we define all the data and
we're just going to move it out of here
so we can call it in a function so just
hit control X to cut it and paste it up
there and that's all we really need to
do there now let's define a function
we're going to call this function define
change brand new layer D so we're going
to call it change granularity then we're
going to pass three variables through it
one is
the x-variable one will be the
y-variable and third one is going to be
div by and that's going to be like how
much do you want to divide this data by
so five fifteen forty five hundred
whatever so now we've done that we're
going to define two variables we're
gonna have grand X and that's just going
to equal whatever was passed through
this X then we're going to have a grand
wine and that's going to equal whatever
is passed through the Y now we're also
going to have to empty arrays it'll be
changed Brand X empty array changed
brand Y empty array and if you can't
guess that's where we're going to
populate with the new data so next what
we're going to do is we're going to say
you know granularity of X basically like
where are we currently is going to be
the length of whatever was passed
through X you could also use the length
of whatever was passed through Y we
basically just want to know where are we
starting and now what we're going to do
is kind of actually work backwards
because depending on the size of the
data like let's say you're working with
data that is 1099 data points long and
you decide you want to do a 100
granularity on that or divide it by 100
if you went from 0 starting at the
zeroeth point and started averaging
stuff you might you would in theory miss
out on the last 100 points so we
actually want to start at the latest
point and work our way back when it
comes to averaging so any missing data
or any data that doesn't have an updated
to be averaged will be the end data not
the most recent data so what we're going
to go ahead and do now is say wow gee X
oops sorry lowercase G capital X is
greater than whatever we're dividing by
so let's say we're doing a 5 so while GX
because we're starting at the GX being
equal to the length of the data that
we're passing through and so as long as
it's greater than whatever we're
planning to divide by then we're going
to do this and that way as long at the
end of this we're going to you know do a
little minus equals of div by so we move
by chunks of data so we're going to say
X list and that's going to equal
whatever
Brand X is and then we're going to do G
X minus div by and so that's our
starting point and whatever this like
you know this list of X variables is and
then we're going to go all the way to
wherever we are right now with GX
because this is what we'll be modifying
so it'll just be GX minus div by 2g X so
let's say we're using a you know 15 div
by and we're at the 1000th variable
right now at 4 GX so it would be GX
minus device so GX minus 15 so 1000
minus 15 so for all you math majors out
there that would be nine eighty five to
GX which would be a thousand so ninety
five to a thousand is what list we'd be
considering now what do we want to do
with that list well with both x and y we
want to just average it so date in this
scenario is being passed through in
numpy load text operation and we're
converting it using m dates so we're
converting that date and it converts it
so you can either use a unix timestamp
to pass through x so x is your date
variable usually right if you are using
dates obviously if you're not using
dates and this is a number then you
don't even need to worry about what I
mean yeah pin about but if you are using
dates before you would pass it through
this operation you would either have to
convert that date stamp to a UNIX
timestamp or convert it to this little M
date stamp which is not Unix I don't
know what it is but it's something so
anyway keep that in mind it must be a
number right so you're going to average
it so yeah anyway so granex
that's what we're going to do with
granex now what we want to do as average
it so we're gonna say X AVG and we're
going to we're going to do an averaging
operation if you don't know what lambda
is I do have a tutorial on lambda it's
like a way to write a quick one-line
throwaway function and yeah so you can
watch that tutorial on lambda it's
called like what wTF is lambda or
something like that
so now reduce and we're going to use
lambda and again this is we're just
doing this so we can average everything
and our variables or parameters for this
lambda will be x and y then we're just
going to say X plus y
and then we're going to do this on the X
list so that adds up everything in the
list and then what do we want to do well
we want to divide it by the length of X
list now the problem here
even though luckily we're using float
data you you could in theory have some
data that is all whole numbers so when
you do this equation it would actually
return to you a forced whole number not
a you know something with decimal points
so just to save ourselves from ever
having to worry about that we're going
to convert this to div by law can't say
div by that I guess I might confuse some
people what we're dividing by turn that
to a float so it forces this to return a
float just so we're safe now the next
thing we're going to do I'll make some
space is now we're going to do our Y
list so we're going to go ahead and just
do the Y thing here so I realize GX
where most which is using the length of
X just so we know how long the data is
but we might as well do both conversions
within the same while loop and save our
processing so Y list will equal
basically this only we're going to use
well grande y instead the rest of the
variables we can continue using so I'm
just going to copy this paste this and
change that X to a Y we can still use GX
because again it's just referencing the
length of data so we'll leave that there
now we're going to say y avg equals
reduce and actually yeah let's go ahead
and copy and paste this averaging
function as well as we'll do that paste
and now we need to change this to Y list
and this to Y list and the rest of it
will stay the same so we're just going
to average both of these lists now and
that's what's for where we're at now so
now that we've averaged these we need to
append them to our array here and so
this is actually going to wind up doing
if you have it depends on your charting
application but if you have kind of a
crude charting application in what we're
about to do is going to in reverse order
populate this array
might be problematic for some of you
guys so if it is I highly suggest you
watch my tutorial on how to reverse the
order of a list that'll probably that'll
be like the video right before this one
but you can also search it or if I
remember to do it I'll put the link in
the description since that will cause
some trouble for some of you guys
depending on your charting application
so yeah so changed Brand X dot of pens
and we want to append the X average and
then we're going to changed grande y dot
append Y AVG finally the last operation
we must do is going to be GX minus
equals whatever we're dividing by that
way it continues running through this
and then finally there's no more space
it stops this while loop stops
populating is raised and they're ready
to bebop on our way the last thing we
want to do then now that we're out of
that while loop is we want to return
whatever the X variable was now and
that's the changed granularity of it and
then we also want to return the change
grand Y so now when we're all done we're
ready to chart I'm going to leave this
regular graph raw FX here and I'm just
literally going to just highlight this
and paste the second one down here I'm
going to hit bra right graph raw FX two
and let's go ahead and call the first
one real quick just so we can see that
it is working so graph raw FX so save
that run that and it will take a second
because it's got it load up all that
data and then draw that data but here it
is now so you can see that this is our
regular chart now let's actually do a
Gras gosh I can't say graph raw graph
raw FX to now we haven't made any
changes so we need to make our changes
and I'm going to go ahead and comment
out this other calling of that one and
now what we want to do is we're going to
come up here and we're going to call
that previous we're going to call this
changed granularity function so let me
just copy and paste this because we are
just remembering purposes
and I'll paste it out so so this the
data that we have is bid and ask right
so we've got basically two bits of data
that we want to convert so the first one
will just say bid grand X and then we'll
say bid gran y equals and then it's
going to be change a brand new layer
ready and our X variable is date and our
Y variable will be bid for now and then
let's just for the first round we'll cut
it into two five right so we'll divide
it by five then we're going to do the
exact same thing again with ask grand X
ask grand y equals change granularity
date ask five now we want to fix this
data right so we're going to just
literally copy and paste into here Y
variable then ask gran x over day ask
grand y over ask and we're set
oh shoot we we modified the original why
didn't anybody tell me I was doing that
so depending on which function you
edited let me just change this I'm gonna
leave this as go out graph raw FX - or
graph raw FX down here
this is graph raw FX - so if you were
doing as I said not as I did um you were
editing graph raw min I can't say that
graph raw FX - but if you were following
along just take note that you'll have to
like you want to change the name of this
function so on whatever function you
were just editing change that to two and
make sure the original function just
leave that as it is so now we're going
to actually plot graph raw FX - now just
for kicks let's go ahead and just print
Len date and then we'll print Len Oh big
grand X so now let's save that run that
wait for that chart to pop up for us
Coffee etiquette so here's our chart
obviously it looks very similar and now
you can see the original data was 60
2012 data points long for each variable
and now each variable is only 12,400
data points long so I mean we're talking
well fifth of the data yet I mean no
real visible change now what if we
change this to like 105 right let's
really affect this and run it again now
you can obviously see I mean there's
been a huge change right well obviously
because we went from 62,000 points to
now only 590 points but I mean as far as
trajectory is concerned in the actual
you know pattern of the line we're
seeing very little difference all right
your only change is from the absolute
high to the absolute low but if you look
at the actual data points here this is
1559 this is 1560 right or one point
five six zero one point five five nine
and this data only goes to four it goes
to four decimal points right and so you
lose you know a little bit of dicks the
original maybe had this peak here all
the way up to about here and it made it
a little shorter basically but as far as
you know the actual pattern of the line
I mean we've got no major change you
know and that was a huge change like
nobody's gonna be doing that but like
you know five or fifteen is going to
make a massive difference on the loading
time of your charts and also the drawing
time like 62,000 I mean it sounds like a
lot of data 62,000 data points really
isn't that much data format plot lib to
plot up honestly when you start getting
into like the millions I guess it sort
of depends on what kind of machine
you're running on but when you start
getting data into like the millions or
the ten millions then the division of
granularity helps you so much and as you
saw from like you know from on a chart
of that size 62,000 data points you can
see just fine twelve thousand data
points you can see just fine right so if
you're plotting let's say you had a
million data points
on your chart and you know that 12,000
data points looks just the same as you
know a million data points or however
many data points you've got on there you
can in theory divide your data by 83 or
something like that right that's close
to get some million divided by 12,000 so
obviously like the higher your data is
right that you're trying to stuff into a
little chart that's like 6 inches by 4
inches you know you can really make some
massive changes to it so anyways
hopefully that answers some of y'all's
questions I had gotten a few questions
on that and then finally decided to go
ahead and make a make a tutorial on on
how you can divide up your data like
that without killing yourself so
hopefully you guys have learned
something useful as always thanks for
watching thanks for the support the
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>