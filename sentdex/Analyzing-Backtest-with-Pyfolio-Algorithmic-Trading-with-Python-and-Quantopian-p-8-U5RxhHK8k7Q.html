<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Analyzing Backtest with Pyfolio - Algorithmic Trading with Python and Quantopian p. 8 | Coder Coacher - Coaching Coders</title><meta content="Analyzing Backtest with Pyfolio - Algorithmic Trading with Python and Quantopian p. 8 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Analyzing Backtest with Pyfolio - Algorithmic Trading with Python and Quantopian p. 8</b></h2><h5 class="post__date">2017-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/U5RxhHK8k7Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up everybody welcome to part 8 of
our quantity n tutorial series as well
as part 20 of the Python for Finance
series in the last tutorial what we did
was we took our alpha factor and just
tried it against the market this was the
final test basically I skipped us having
to run all these fullback tests but we
at least coded it out first once and
what we're going to do here is we're
going to take the back tests and we're
going to run it through PI Folio in the
way that we do that is through the
notebooks so if you were to go basically
to your notebooks and just the one I
think that we were yeah accuse research
tutorials so this is where we've been
programming so we can just keep adding
to this one if you want or you can make
a new one it doesn't really matter so
what we're going to say is bt for
backtest equals get underscore back test
client obeah magic and we get the back
test now there might be a better way to
do this but the way that I do this is I
just come here right and then what we
can do is we go to all back tests let's
grab this first one so the first one was
on using quantiles let's see if using
quantiles commission was set to 0.001
and over that one year kind of market
neutral ish period basically so market
changed a little bit but it's only 1.3
percent but in the meantime it went up
and wiggled around and went down wiggle
around and went back up and you know
basically almost no change so on this
one so this the first number here is
your user I think this is the back test
so we'll copy that come over the
research paste and then run that you
should grab it really quickly so I'm
going to start the next line so BT dot
create underscore full underscore tare
underscore sheet we'll run that and this
like the other one will kind of take a
minute to populate but you get a bunch
of information here and right away I
mean we've got a lot of why did you do
this do this okay so a lot of
information here a lot of this is
already available to you on the actual
algorithm Beck test but anyways you can
kind of immediately see okay where's our
straw down period its net drawdown of
those periods where did that happen did
we recover how long did it last all that
because drawdown is like something
you're going to really want to watch out
for because drawdown basically is just
going to add to your risk also drawdown
pretty much will inhibit you from
applying leverage so if you have like no
drawdown you could in theory just keep
throwing leverage at something and do
better but the more drawdown you have
the less leverage you're going to want
to apply because leverage does crazy
things that doesn't just multiply like
you can multiply you know leverage
multiplies your investment ability but
it does not just simply multiply your
returns it does very strange things in
reality so it can it can just ruin you
especially with in things like drawdown
so then we've got cumulative returns we
already kind of knew this these are like
some interesting ones so this one's like
key motive returns volatility matched to
the benchmark which is kind of cool
because it'll just match you based on
volatility to your benchmark which is an
important factor cumulative returns on a
logarithmic scale nothing really to look
at there you've got returns basically in
percentage over time so of course as we
can see here towards the Ganges where we
kind of get a lot better
rolling portfolio beta to the equity so
this is something you really kind of
want to see as flat as it is we're
pretty much zero beta so that's a good
thing the rolling Sharpe ratio over time
not bad we did improve over time so
that's kind of good by the end of it we
should only had zero point eight nine
which is not not very good let's see
this is a table draw dunker basically
our entire strategy is a drawdown period
okay this is your underwater plot
basically all the drawdown so just
always keep in mind the the y axes here
monthly return so we can kind of see how
we did
monthly basically we did pretty good
here and really good here otherwise we
kind of
not very great then we've got like some
nice comparison charts here new normal
in like basically fall 2015 how we did
basically we held out really nice and
solid and the S&amp;amp;P 500 just I don't know
went went down south these are our best
long positions a bunch of companies I
couldn't tell you the name of any of
these oh this is Urban Outfitters ha I
did it I'm pretty sure that's Urban
Outfitters anyway
the top ten short positions I should
know this one I recognize it I can't
tell you what it is though and then top
ten positions of all time that we did
okay so you get a lot of information
they're coming on down here are exposure
this should be totally perfectly even
because that's what our strategy
dictated we can see the portfolio
allocations over time
let's see long short medium position
concentration awesome continuing the
long gross leverage which should pretty
much be one unless you intended to apply
leverage coming on down trading volume
okay finally made it finally made it to
the end okay so that's one of the
backtest now we could keep doing it like
so this one was that first one that we
did right which just barely outperformed
the market but then we can go to the
object is we can do the same thing for
like for example let's do this was over
the entire time it'll be an interesting
one to look at actually well first let's
compare because I do because because
that first one was quantiles this one is
not quantile this one was based on the
actual signal itself so in fact let's
just let's just overwrite this one paste
and then once that's done we'll do this
down here
creating a new sheet so again even to
your return your volatility sharp is
much better on this one so yeah we ended
with 1.85 and again you know all the
same things and generally like once you
start seeing that like like for example
here your cumulative returns that's
pretty much what we already saw but I do
like the whole volatility match to
benchmark generally you'd like to be
able to beat the benchmark and ideally
as much as you can
this one has pretty much the same
drawdown periods the same strategy
pretty much any way same perhaps and
then we could do that we could do the
last one because the last one is over
like the full the full at least the full
range that we can do with Centex pace
that one in but we already pretty much
know what what the problem is or at
least what we expect the problem to be
an issue it all boils down to that
spread of alpha so a weak alpha overall
even though the mean is positive it was
still pretty weak and we have this huge
spread of alpha over the you know the
two buckets that we we worked with this
one's taking longer this because this
one's like the three years or where
there were three and a half years of
data wave
so this will be good to compare because
if you look at like for example our
return compared to the S&amp;amp;P 500 we did
not do very well right but we also
didn't really doesn't I think I don't
think we ever got into the negatives oh
we did at this point it's negative and
then over here did we get back into the
night no we did have drawdown now but
there's a better drawdown than what we
had before
compared to our returns anyway coming
back over here I want to look at that
volatility chart so we scroll down so
this is that cumulative returns makes us
look as bad as we did and then
volatility managed to benchmark so we're
actually like volatility wise we were
close we're still left so in theory like
let's say you applied some leverage we
would still be income and not the
greatest and would it have been worth
the added risk of that I'm not really
sure cumulative returns on a logarithmic
scale not what you wanted to see we'd
like to be above all so here we would
like to be above the SPI runner trying
to think if there's anything else we
well again we can still see here like
the majority of our strategy is like is
these drawdown periods you don't want
that you just don't want that ok so
anyway all the same charts you've
already seen so from this point
basically up which we kind of knew what
we were getting into I think when we
left alpha lens with a single alpha
factor that was already kind of a weak
ish alpha factor and decided to trade on
it we kind of saw this coming but I just
wanted to run through basically all of
the steps that you're going to kind of
go through as you're developing a
strategy so basically you know at least
for me
what I would do is we're going to have
to go back to the drawing board as far
as like we're going to need to find some
more alpha factors combine them with
this one see if we can't get that and
once we combine them make that that
factor that we test and see if we can't
fix this spreads here also the other
thing you could just do is put stop loss
on your trades so for example let me go
to the docs
let's do stop-loss or stop price with
loud slide again sorry stop price is it
okay yeah so when you place your order
you've got a security amount but you can
also throw in the style so you can say
okay I want to have a stop price
basically and so this one will stop the
order basically also no stop it so it
actually wouldn't do stop limit you
would do stop order so place that if
after you know maybe after the price has
changed more than I don't know five
percent or three percent or something in
the wrong direction just just stop just
just close it out and that would
probably help us but that's like
something you would want to do after
you've already got like you must start
with strong successful alpha and then
make a strategy and protect it with
stop-loss you don't really want
stop-loss to fix your alpha problem okay
so anyways hopefully that was helpful
for you guys thanks to Jamie McPherson
for coming up with basically the
notebook in the actual algorithm that we
pretty much ran through I'd changed a
few little things but most of that was
actually his code also the webinar was
was at least really helpful to me so if
there's something more you're kind of
confused about or you just want to run
through it again definitely check out
that webinar I'll try to remember to put
them basically in the description of all
the videos that we've done so far
otherwise if you have ideas on how to
improve this or whatever feel free to
leave those below otherwise I will see
you guys in another video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>