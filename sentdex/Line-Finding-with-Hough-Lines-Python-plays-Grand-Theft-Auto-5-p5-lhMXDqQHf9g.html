<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Line Finding with Hough Lines - Python plays Grand Theft Auto 5 p.5 | Coder Coacher - Coaching Coders</title><meta content="Line Finding with Hough Lines - Python plays Grand Theft Auto 5 p.5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Line Finding with Hough Lines - Python plays Grand Theft Auto 5 p.5</b></h2><h5 class="post__date">2017-04-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lhMXDqQHf9g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
part 5 of our Python plays Grand Theft
Auto tutorial video series thing in this
video what we're going to do is build on
the last video where we at least got the
region of interest took a little longer
than I was hoping but got it and now
what we're going to do is use the hue
lines algorithm to find the lines at
least the major lines in our image data
so we're going to keep the ROI because
we're going to find lines after ROI
because we just wasted processing to
find lines outside of the region that
we're actually interested in so so the
next thing we're going to do here is I
guess we'll do it in process image so
after we've done the region of interest
we're going to have we're basically
going to do the hue line so we're going
to say lines equals CB to cue lines and
I'm sorry if that's not hue lines by the
way if it's like half lines or something
a turn so I'm going to feel free to
correct me below I always mispronounce
all these names anyway P and don't
forget the P there now raus we've feed
through the processed image which needs
to be edges you would never I mean you
probably could I don't know what the
result would be it probably wouldn't be
good though you want to feed through to
do the hue lines again sorry if I'm
mispronouncing um if you want to do
those you want to make sure you're
feeding through the some sort of edge
detection which in our case is the canny
edge to the he lines or Huff lines or
whatever so processed image ooh I
install on screen I'm surprised this is
such a mess only at least pull up to
here so I don't make the mistake and not
show anything so we feed through an
image imagery that has edges just edges
basically and then we're going to pass
is a bunch of variables the Rho is one
we're going to pass numpy dot pi divided
about 180 this is your theta the
threshold will be 180 the I think is it
min length let me let me pull up the
documents I'll link to the documents in
the text based version of the tutorial
it'll also be in the github and all that
Oh perfect here we go okay I pull this
up so you can learn more about these
things if you if you want yeah
you've got minimum line length and then
maximum line gap so minimum line length
is like you know how many how long
should this line at minimum be right
like we do we want to detect to pixel
long lines I don't think so so what's
the minimum length and then sometimes
through aliasing or whatever there's a
line gap so for example let me just pull
up this image because it's really clear
so like obviously we probably wouldn't
but if you look at this like there's a
gap between these these detected lines
well from the actual image that's
actually really a line the the problem
is the edge detection algorithm detected
the that there was an edge and then
there's not an edge or something so but
in reality right that's and that's just
going to happen with the edge detection
algorithm I'm trying to see if there's
any others I don't really see one but
that's kind of an example of what might
what can happen so you you want to allow
some sort of gap the other thing that's
happening like the image again is you
can look at all the aliasing happening
here it's a very jagged II so like for
example these are touching I can't get
any closer but these aren't really
touching so that isn't likely to be a
problem very shortly for now okay
so 184 the threshold was it max min line
light let's go with the 20 I'm pretty
sure that's in pixels and then maximum
gap um 15 I don't know oh this will all
probably be tweaked later on but we just
I just want to get somewhere
so what this does is returns an array of
arrays that are the that contain the
lines which is kind of weird and I'll
show you what I mean but it's going to
mess with us just like this wanted this
of the brackets around it it's going to
return to us something similar I don't
know why it thinks that way but it does
so that's been returned lines based on
the edge image that you throat pass
through it so all we have are just
coordinates X Y X Y so x1 y1 x2 y2 and
that and if you drew a straight line
between those those are the lines it
found okay we've got to draw these lines
so rather than muddy up this one I'm
going to create a draw underscore lines
function doesn't exist we're going to
create it but for now we're just going
to say what we'd like to be able to do
is draw a lines where on the processed
image and then with what the the lines
that we just found okay so now let's do
the draw lines function so it just
somewhere around here let's define and
actually draw lines will profit will
wind up being a really important
function so I'm just going to put it two
tops that's easier for us to find for
now it's going to be super simple draw
lines it takes an image and it takes
some lines that we're going to draw then
for line in lines this is going to
return like you might think lines would
contain like this x1 y1 y2 something
like that ok you might think that's the
case that's not the case it's like this
and it's a bunch of those and I'm not
sure why but anyway so for line in lines
we're going to take now chords the
coordinates equals line 0 with because
it's stupid now we can reference the
lines themselves inside so then what we
can do is see v2 dot line this is a way
to just literally draw lines on a image
and then you pass the coordinates for
the lines so X 1 Y 1 comma X 2 y 2
what is the color of that line let's
just do to behave as a group to revive
and then the thickness of the line we'll
say 3 1 would be 1 pixel 3 will be 3
pixels so it'll be easier for us to see
the actual line now for coordinates
that's going to be chords 0 1 2 3 cool
so that's actually just going to draw it
right on the image and the way the
opencv works is it lets you modify the
thing um so we don't need to like return
it or anything we're just kind of
modifying it it's kind of strange but
this will actually draw the lines ha on
the thing we actually don't need to like
return an image so that's actually
totally cool we're done now I draw lines
cool okay so I think we're about ready
let's see what typos I've done today so
let's go ahead and run this I've already
kind of made a pretty big mistake but
I'll get to it okay so we can see
there's at least a line there this
already broke that's still going
interesting but it's probably going to
break any moment now please work did it
break this time let me see here yeah
broke okay so so one error with our
logic here is here for line in lines
well if it doesn't find any lines that's
not going to work out so what we need to
do is just just throw this into a try
except
like me uh pass okay oh I've committed a
horrible sin all right so felt good
though it felt so good all right so
hopefully you can hear you ship you can
see that in the video so wow that guy
totally just went around me what a prick
anyway so you can see there's like lots
of little lines here but it's but not
quite what did the people of grant us
Otto are pretty freaking weird but it's
not quite as it's not quite detecting
everything we expected and again I'm
that's most likely because of the
aliasing that's going on there it's very
jaggedy so now we want to do is let me
close this and let me bring this back up
so we can fix that with just blurring it
a little bit so blurring is just what it
sounds like you can take like a like a
square of pixels and just kind of like
bore it like that's basically what it's
doing it's just an algorithm that does
that for you so what we'll do is add a
Gaussian blur so you can't spend okay so
before okay anything about this yeah we
wanted we want to definitely blur it
after the edges not before the edges
because then the edges the edge
detection would just do a line again so
after the edges we'd like to blur it so
process you just equal CV to that
Gaussian blur we are going to blur the
process underscore image we blur it with
a mmm I don't remember if it's want
square brackets or braces
okay CB two dots Gauss I'm googling it
at the moment it's not clear why can I
just pull it over as I'm looking so you
guys aren't just bored I suppose let's
do this Scout okay yeah so I want okay
all right
we're we're clear Am I here we go so
we'll do the five by five that sounds
like a grand plan and then what was the
last parameter a zero what is the zero
mm I'm not quite sure what that zero is
may be nice if I don't care let's throw
in the zero we'll see what happens
I just want some blurring I don't need
to get too fancy about it done let's
move this over now
let's run this it's looking good already
it's fine in lines everywhere look fools
so many runs okay alright so now we'll
freeze-frame here beautiful so now um if
we work easy you can go yes you can't
see my mouse very difficulty the move
not very easy anyway now we have lines
and my thinking is using a little bit of
logic we could well first of all we
could change the blur a little bit or we
could change the parameters on the
actual lines function so we had the
minimum distance and then we had the max
gap so what we could do is change change
it's hard because it's like updating so
it keeps pushing me we could change this
like min distance like 50 and then let's
just rerun it Wow really that didn't
make a big of a change as I was kind of
expecting well some of these lines are
like a hundred pixels or something so
let's let's do 100 and and then we could
probably lower the gap Wow
are you kidding me are you what the hell
this is not even listening to me
those are no 100 pixels long you're full
of it you're just full of it maybe it's
accounting for the gap and not drawing
over now because it's returning the line
let's change the gap to 5 pixels I think
it's in pixels sort of this changing oh
my gosh I wonder if I'm doing something
wrong
somebody can somebody feel ready to
create my code this just feels wrong
maybe it's what if we did
so I'm just going to take here with a
few things before I just quit life it's
a little better I guess but not that
much better very frustrating um anyway
I'm gonna return back to team what was
the initial setting well Steve looks
you're like thirty fifteen that should
be probably good um
despite this being relatively in my idea
is to we can tweak this a little bit if
we need to but my idea is to like if we
just take some of the longest lines or
even better we could take um there's a
lot of little things we can do to
probably improve this like what's one of
the longest lines or the best dish like
looking lines what like where are most
of the lines taking place something like
that where you could take like slope and
Bob bias you can take slope and bias
what lines have some very similar slope
and biases it's like for example this
there's a bunch of lines right here that
are already close to each other and then
here these are quite a few lines here
unfortunately is a lot out here that I'm
not really too happy about there's
definitely some tweaking that's going to
need to go on I'm going to change again
anyway there's definitely some tweaking
that we'll need to go on but there's
definitely some also some logic that we
could throw into here to make this feel
a little more accurate anyway I'm going
to go ahead and cut this one off here
and I think maybe in the next video I'll
try to get us to come up with some way
of determining the lanes and then that
will pride I'll probably try to figure
out from there whether or not we should
move to coming up with more rules or if
we could try to make an AI at that point
I don't know
so anyways questions comments
suggestions whatever leave them below
again all the code will be on github if
you have ideas for improvement share
them with us so uh before we go let me
just put let me close stop this and then
just show you show you the ending but it
like I said everything will be up on
github but basically the ending hue
lines was you know for the threshold one
eighty 2015 there we can modify a few
other things but first let's just try to
come up with some sort of logic that
will pick a lane and then if we're
having a problem at that point we can
come back to this I also I couldn't I
can't remember how fast those loops
those loops were let's see what our
frames are so we're paying a decent
penalty on frame rate already now what
are we getting like five frames a second
now so I'll have to see on that one how
the how we can hopefully somehow improve
that trying to think it we'll have to
look through this and see if I can come
up with a better way to make this more
efficient first let's do the lanes and
then from there we'll see what we can do
about dumbing this down but that might
be another reason why we might want to
go the a eye route where strange as
strange as it might be we can run that
on the GPU it might be actually faster
that way but anyway a lot of stuff to
think about I'm going to cut it here in
the next tutorial we will do our best to
try to find some lanes probably what I
come up with won't be the best and
hopefully somebody can come up with
something that is a little more robust
and what I'm gonna I'm gonna push out
but we'll see what happens and until
next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>