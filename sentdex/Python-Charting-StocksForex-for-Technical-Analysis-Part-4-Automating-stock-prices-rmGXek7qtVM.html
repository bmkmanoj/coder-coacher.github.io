<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Charting Stocks/Forex for Technical Analysis Part 4 - Automating stock prices | Coder Coacher - Coaching Coders</title><meta content="Python Charting Stocks/Forex for Technical Analysis Part 4 - Automating stock prices - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Charting Stocks/Forex for Technical Analysis Part 4 - Automating stock prices</b></h2><h5 class="post__date">2013-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rmGXek7qtVM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
the fourth part of stock price
acquisition in the last tutorial I
showed you guys how to bulk pull the one
day open high low close data for the
past year of the you know both of stocks
however many you wanted in this case we
just did seven just for effect an
example um in this video I'm going to
show you guys how to start pulling
higher granularity data and then
actually make a program that just
automatically pulls this 5-minute open
high low close data from Yahoo so what
it'll do is just you'll just
continuously run this program and it
will continuously pull data you just
need to make sure this program runs at
least once every five days but if you
want to have you know more up-to-date
information you can make it run as hot
as frequently is every five minutes
though I wouldn't suggest that or at
least you know maybe close it during the
weekend so with that let's go ahead and
hop right on in first thing we're going
to do is some quick housekeeping
wherever you've saved all these files I
suggest we move them because now we have
a different data basically it's going to
be five minutes open high/low clothes
but as I showed you guys before it calls
the date a little bit different it's a
Munich's time not um you know sort of a
date stamp so anyway what I'm going to
do is just say one day o age low close
I'm gonna make a little folder and I'm
just going to move all of these files
into that folder so I'm going to use
those at least yet when we go to graph
when we do the first part of the
graphing we'll use those again and we'll
graph those and then later on we'll
graph the the higher granularity data
stuff uh so anyways let's go ahead and
get started so we have stocks to pull
here that we want to pull since we're
going to make a program that's going to
you know in theory run for an extended
period of time it's always good you
could just use time but it's easier on
the eyes to use something else but it's
always good Python at least for me on
all the computers I've run it
on sometimes for whatever reason be it
you know your internet kind of glitches
for a second or computer I don't know
but sometimes the programmer freeze and
the best way to realize it's frozen is
to every time it does something just
print out onto the screen
the last time and date it did something
so if you look at it and it's been 24
hours since it's done anything yet you
you know it's supposed to do something
every hour you know something's wrong
and you need to reset it so it's just
kind of it's just helpful and since
we're going to make a program that's
going to in theory run all the time um
it would be good to go ahead and oops
import and do what I'm going to show you
so work for what we're going to do it's
going to be we're going to import
date/time and this is so we can print a
timestamp that we can recognize because
time the only thing that will print for
us is a UNIX timestamp and we don't want
that so we'll leave stocks to pull uh
but I think what we'll do a lot of this
stuff will be the same but a lot of its
going to be like different and just so
we can fundamentally understand what
we're doing I think what we're going to
do is actually just clear out this
entire thing will leave the try and
accept loop at least but just highlight
everything and just delete it for now it
within the try and accept don't do the
whole file otherwise you'll have to type
all this stuff so so the first thing
that we're going to do is again
sometimes you want to have all this
stuff just so you can kind of see where
you are in this long lasting program so
the first thing that we're going to do
is we're just going to say print and
we're going to say currently polling and
then we're going to print or paste out
the stock right so whatever we're
pulling it'll say what we're pulling and
then we're going to do this is going to
be a very long line so stick with me but
and we will type it one more time at the
end but I should we'll just copy and
paste it at the end but what we're going
to do is we're going to print out the
string birds in the strong aversion
oh wait it'll print out for us is a date
stamp basically it'll say you know the
the day month year and also the time but
it's a very long line to do it so I'm
going
sorry but this is a little bit um so
it's going to be date time date time dot
from timestamp and a timestamp that
we're going to use is time dot time and
let me make sure I'm sorry I just got to
make sure we're doing this right time
that okay and then we want to do string
STR F time so string from time and then
in here is how you kind of specify how
you want that string to appear I'll
explain it as it goes but it's not
imperative that you understand this just
yet but this is kind of how you how the
program will read time stamps you'll see
more of this when we go to plot stuff
but percent uppercase Y is the full year
a lowercase Y would just be the last two
digits then percent lower em I'm sorry
won't it - then % lowercase M + % a - %
lowercase D starts her to talk and type
this stuff out so it'll be the full year
- the month - the date that will be
numerical and then % H 4 hours : %
minutes or % M 4 minutes % seconds whew
ok and then we want to close off this
entire thing and we're done so what
that's going to do is it's just going to
print out what we're doing so just just
just to show you guys we'll run this
really quick and so for each stock in
this list it's doing this so it says
currently pulling Apple then it prints
you know 2013 825 and the timestamp
right and it just ran through them all
so that's what's going to look like so
now what we want to do is let's actually
visit that URL and darn it I deleted it
so now we're going to type it out again
but that's okay so URL to visit if you
want you can maybe go back and maybe
what I'll do to save you guys from
typing it out is I'll put that in the
description again if I forget to put it
in the description some comment and be
like you forgot to put it in the
description and I'll add it URL to visit
equals HTTP colon slash slash chart API
to finance that Yahoo comm slash
instruments
one point zeros flash open fret or close
the parentheses plus the strung out
version of stock and then pull our quote
/ chart data semicolon tight equals
quote semicolon range equals 10 day even
though I think it only gives us 5 days /
CSV close quotes ah take a breath anyway
moving on next thing we want to do is
say a save file line or whatever we
called it last time stock plus a dot txt
whew okay now what we want to do is this
program the first time we run this
program it will there no file will exist
but as time goes on we when we visit you
know this link for chart API it's going
to give us the full bit of information
right like it'll give us the last 10
days or 5 days I think everything it's 5
days so I'm just going to say 5 days
from now on it's going to give us the
last 5 days but what if it's only been a
day since we visited it right we only
want the the last you know since the
last time we pulled data we only want
like the new data since then so how can
we like how can we work around that well
the way that we're going to do it is
we're going to have it like once we've
already created the file it's going to
read that file go to the last line and
since this is in unix time right it's a
large integer um and since it's 5-minute
data what we're going to do is we're
just going to say if if that if the
timestamp for this line is greater than
the last time stamp we've had then save
it that way we're not safe like recess
otherwise you would get a very very ugly
data set and graph when you try to graph
that data right so you only want to pull
the new data so that's how we're going
to do it we're going to say you know if
the timestamp for this data is greater
than the last time stamp then good will
save it so the way that we're going to
do that normally we could just type that
out but um but what if like right now
for example since we've deleted all of
our files we don't even have a file for
this data and we shouldn't use the old
file that we had because the date format
is different so since we don't have that
we should we should have some sort of
failsafe just in case there's no file
there that you know even though we're
only in theory create the file once we
should definitely do it so this is the
last thing that we'll do before I think
I'll cut off the video I don't like to
have the videos be super long so we'll
do that and then we'll carry on in the
next video and finish up this program so
what we're going to want to have is a
try and accept loop only this time we
don't really need it because it we're
almost for the first time we run it we
know it's going to fail and we're kind
of like building this into the program
if something goes wrong we can maybe
build a debugger but for now we're
actually going to kind of abuse the
trying to accept loop anyway so we're
going to say read existing data so like
what we're going to first attempt to do
because 99.9% of this program's life
it's going to do this successfully so
we're going to try to do this first but
if there is no file then it will do this
next part so really probably an if-else
statement would be superior here but try
and accept we'll do the same thing so
read existing data is going to be equal
to open save file line
um and what we're going to do is read
that file or with the intention to read
and then we're actually read that file
so immediately since there is no this
file doesn't exist yet right like when
we have a pen door right here it
actually creates the file for us but
when we have read read does not write
that's kind of a purpose of read is you
can't like manipulate the file right so
you wouldn't corrupt something so if you
do a lot of reading or if you do a lot
of writing and appending especially
writing is really dangerous appending
it's kind of dangerous you can still
corrupt but read is like a really safe
way to open up a file and not have any
worries so anyway immediately since this
file doesn't exist it'll it'll throw an
exception right and we'll move to this
exception part but let's go ahead and
finish this trial OOP so if the file
does indeed exist what we'd want to do
is split existing and that's going to be
equal to read existing data dot split
and we're going to split this by a new
line let me just make sure we don't
really have any read existing data just
want to make sure I didn't typo anything
if it does fail it's going to be kind of
awkward at first anyway continuing on a
most recent lime is going to be equal to
split existing and if you're familiar
with arrays you might think that we want
to put a minus one in here right so we
go to the last line right wrong there so
when I go to the last the second to last
line because of the way that we're going
to be writing to this file it's going up
the file is always going to end with a
blank line so minus one of the array
will actually be a blank line like it'll
be the last line but is going to be
blanket and useless to us so we actually
I want to do minus 2 then what we want
to do is we want to say last UNIX equals
most recent line dot split by the comma
and we want the 0 with element there so
see do I have the API open I think I
closed it on yeah here it is cool so as
you can see the 0 when we it's going to
save lines like this right and the 0 if
element once we split right the first
element will be this right so that's the
timestamp basically just just in case
you're following along and then also
what we can't what we ought to do I
don't think it's necessary I think it
would automatically recognize it
as I'm pretty sure it would recognize it
as a an integer all right like you don't
have to do it but I guess you know to do
things right we ought to call this an
int so we'll go ahead and do that and
actually let's make sure it really isn't
int if we're going to call it it in
right okay so it has no decimals so if
you're pulling from something that has a
UNIX timestamp and it has like the UNIX
stamp dot and then like the millisecond
kind of data if you have that then
obviously you want to not use integer
you use float but it will do it for us
so that's it with our try so if it can
it'll just that'll be the last UNIX
timestamp and then we'll get to the
logic to use that but if what will
happen is since the file doesn't exist
it'll say try to do this it's going to
try to open the save line which is this
the stock duck text and it's going to
fail if it doesn't already exist so then
we'll pop down to the accept and what do
we want to say for the exception we'll
just redefine the last unix and we're
just going to say zero right because we
want to go at like if there doesn't
exist a file then we want the whole
shebang so that's all we'll do for the
accept loop so that's our logic the
pretty simple logic or makeshift logic
but good enough it will work so that's
our logic for how we're going to find
what the last time was that we you know
updated this file and what we're going
to continue doing in the next video is
going to be actually you know visiting
the link pulling the data and then using
you know this last timestamp to figure
out what of that data we've just visited
we want to actually pull so so I'm going
to set the video here and continue on
the next one as always thanks for
watching thank you for your support your
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>