<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python and Pandas for Sentiment Analysis and Investing 7 - Dynamic Moving Averages | Coder Coacher - Coaching Coders</title><meta content="Python and Pandas for Sentiment Analysis and Investing 7 - Dynamic Moving Averages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python and Pandas for Sentiment Analysis and Investing 7 - Dynamic Moving Averages</b></h2><h5 class="post__date">2014-05-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SHBFDSch3WE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
another Python with pandas sentiment
analysis and Finance tutorial video
series what we well what we did in the
last video is we worked on how to make
dynamic moving averages and now in this
video what I want us to do is actually
take those dynamic moving averages that
we generate and we want to kind of a pen
this to our data frames so later we can
reference that reference what those
values are and make a judgment whether
or not we should make an investment or
not okay so we're gonna take our first
step towards doing that also after we
get done with that the other thing I'd
like us to do is do some housekeeping
here as we can see already for these
counts right we've just hard-coded these
counts in there that's kind of silly we
really shouldn't do that we should first
of all just have one variable that is
that determines what those count you
know divisions are and also we might as
well just put that as a parameter in our
function here and then we might as well
set those as default parameters with 275
one time 55 so we don't have to type
them at all but if we wanted to change
them it would only require one edit to
change cuz this gets messy really quick
and it's poor poor programming in
general to do something like this so
we'll fix that right away that way this
problem doesn't get any bigger
so anyway that's what we're gonna do
here so let's go ahead and get started
so the first thing we're gonna do is
once we've got ma 1 2 3 4 the first
thing that we need to consider is what
we're gonna add this to our data frame
but we also want to ignore any plots
that don't have data for ma 4 since
that's our largest moving average so for
example when it's 100 250 500 5,000
anything from plot you know 1 to 5,000
is gonna have a skewed value for what
the 5,000 moving average is right so
there's gonna be no value in this case
because there's not enough data so it's
gonna you know save in our data is not a
number or it would just be blank either
way we're not able to evaluate whether
or not something is higher than a 5,000
moving average if there is no answer 205
moving average so that's the first thing
we want to do if you followed me my
other tutorials usually what we do to
denote this is SP so capital s capital P
and that just stands for starting point
so it's how we derive the starting point
of our data that we want to consider and
so the starting point is going to be
integer valuation of count divided by
five point five okay now the problem
here is it might make a decimal and we
can't suppose what we're gonna end up
doing is we're going to take that numpy
array because it or at least the data
frame reference and it current
translates to an umpire array we're
gonna take that number IRA we want to
say : or we want to say basically five
thousand colons I'm from number five
thousand on but we can't say you know
number five thousand point two five
right you can't have that be a decimal
so we need to convert this decimal to a
whole number now you could use round and
zero but the problem with that is it
might run down and it would just you
know be slightly inaccurate so let's go
ahead and fix that and instead instead
of just the integer of count five count
divided by five point five well we can
use this math dot seal and basically
that is short for sealing and what it's
going to do is it's going to take any
decimal and round it up okay to the
nearest whole number so even a five
point one rounds up to six and in this
way maybe we lose one row of data but at
least one will be one row of data too
early so it's just the best way to do it
in my opinion so anyway we're gonna call
that ceiling now the next thing that we
want to do is actually we're gonna
define these new columns that we want to
generate so for example this is going to
be DF MA one and that's going to be
equal to M a1 okay that defines that new
column for us now let's just go ahead
and highlight this copy and then paste
paste paste and now we just need to
change this to two three four and again
two three and four now we have defined
these as columns in our data frame we
could save to CSV but we can also
continue doing other mathematical
operations by referencing this column so
that's why we actually want to end up
doing that
now once we've done that we've added
these columns now we want to chop off
all of the bad data right ie the data
before ma for whatever number that is so
with Apple that would be the first
50,000 lines of tomato that we want to
just chop off so for this what we're
gonna say is DF equals so de different
equals the current data frame and then
SP : so the current data frame from the
starting point on okay makes a whole lot
of sense so that's what we want to do
now we still want to plot the same stuff
and everything else should be good so
let's go ahead and save and run that
hopefully we don't get any errors from
typos and the like now well that is
running the next thing I suggest we are
going to do since this might take a
little bit to process is we want to edit
this right here and we want to add those
default parameters that we were
discussing so we want stock name and we
did we got a error math is not a fine we
did not import math import math
hopefully that would be enough because
we did just all the only other module we
used here was math dot seal right no
okay yeah so anyways hopefully that
doesn't hit us again with another error
anyway so in single stock auto am a
stock name that's fine then we want a
default parameter of div 1 what is div 1
getting equal and then and so on so diff
1 will equal to 75 and then we'll say
div 2 equals okay our chart is up so let
me finish writing this out but the truck
came up so div 2 equals 110 and now
let's pull this chart over what do we do
I guess we did Apple what stock is this
I can't remember what stock word oh no
ok this is Google okay so here's Google
this over a little bit okay so so we got
our our plotting everything looks good
and if we hit home it looks to me like
we still have that improper starting
point here so let me go back and look at
this the F egos SP : possibly we're
plotting Y right okay so the other thing
that we have to edit here is CM a 1 is
referencing back to this ma one up here
and that's a problem because actually we
want to reference that column now so
instead what we're gonna do we'll just
take this copy and we're gonna do and
actually actually stick the whole thing
DF copy and then click on this paste and
then paste paste paste then we'll say 2
3 &amp;amp; 4 and let me make sure I close that
plot I didn't know I so close that plot
let's go ahead and rerun it now while
that is processing we'll come back up
here and we're gonna continue making our
updates so we're gonna say div 2 equals
110 do 3 equals 55 and finally div 4
equals 5.5 so these are just the default
parameters that we want on this function
now once we've done that we want to come
down here and we want to change all of
these right so this would be instead of
275 or thee div 1 okay that's come back
over to our chart because it came up
good up here and so now you can see that
this chart whoops
this chart is what we were hoping for
right where the starting they all all
the moving averages start at the exact
same moment that way we're always
working with what I would say valid data
all right ok so we actually have that
here and we're happy with that so that's
good so let's close out of this and
let's continue working with what we need
to do for this housekeeping so we don't
have to continue hard coding stuff so
instead of diff one and then I'm just
gonna copy that page paste and paste so
to do 3 &amp;amp; 4 so those are just
corresponding the default parameters and
our function here and we've got those
all set
as we come down the starting point okay
don't forget this one we've got a 5.5
that needs to be converted to a div for
and then we come down here do we have
any others okay right so here we've got
what needs to be if I saw that paste yet
paste paste paste and paste that needs
to be a dip for you have one this too
and this is a dip three now just as an
aside if you wanted to ever have these
other ones be a decimal don't forget you
would need to fix this right otherwise
you're gonna have a really long decimal
there that would get in the way now this
is only for visualization purposes so if
you don't mind having a really long
decimal in the legend or you can just
not show the legend and that doesn't
really matter because all we're doing
here is just trying to visualize the
data so that we can formulate a strategy
on on the data but otherwise it doesn't
really matter what how big that that
number how long that decimal is rather
so at this point I believe we have taken
out all that or those hard coded numbers
yeah so let's go ahead and run this one
more time and make sure that that is you
know we're getting the information that
we want
that looks good so whenever this comes
up hopefully we'll have use our dynamic
numbers and then when you come down here
and you call you know what you want to
plot you could then fill these these
parameters with other numbers if you
want it but you know obviously we're not
gonna do that right now but then later
on to we could create a function that
calls these that fills in those
parameters for us so like I was saying
before if we wanted to maybe search for
a company the company's best div numbers
we could create a function that would do
that very easily with this function to
test but anyway more on that later if we
go to that but I'm I'm hoping that we
won't have to go into something like
that but anyways so that worked out good
so we're plotting on the dynamic moving
averages we're using our default
parameters now instead of hard-coding
and we've got a starting point now and
so not only is that as all of this
useful for data visualization but also
for data manipulations so generally
visualization is really there to help
you the programmer see that everything
is working the way that you intend it to
work otherwise I mean the computer
doesn't need to be you know you don't
have to have any visualization for the
computer it doesn't need it so anyway
that's mostly for us but the starting
point we need that and then we also want
these dynamic moving averages to not be
so hard coded like they were so that's
gonna conclude this tutorial video if
you guys have any questions or comments
feel free to leave those in the section
below as always thanks for watching
thanks for all the support and
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>