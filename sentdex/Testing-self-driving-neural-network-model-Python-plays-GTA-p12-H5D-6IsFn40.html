<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Testing self driving neural network model - Python plays GTA p.12 | Coder Coacher - Coaching Coders</title><meta content="Testing self driving neural network model - Python plays GTA p.12 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Testing self driving neural network model - Python plays GTA p.12</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/H5D-6IsFn40" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody in welcome to
part 12 of our Python plays Grand Theft
Auto and does a self-driving car in this
tutorial or video what we doing is just
testing the deep learning algorithm that
we just wrote so this is the results by
a tensor board and I just kind of want
to show real briefly tens award as I do
this development I kind of pay a lot of
attention to what goes on in the actual
training of an algorithm so in general
if accuracy gets up to let's say a
perfect you know 100 percent accuracy
you probably over fit you made a mistake
I've often found that you're better off
not overtraining then definitely
overtraining right and that just makes
sense because what happens is kind of
what I was saying before if you fed it
unbalanced data and neural networks are
capable to fit anything you ask them to
fit given enough nodes and enough time
it'll figure it out and this can be a
problem when especially when you have
for example unbalanced data but also
just a data set in general the neural
network can figure out how to fit all
your data almost perfectly and sometimes
even perfectly but then when you go to
feed it never before seen data suddenly
it's like alright or not to do this and
it doesn't work so you want to watch out
for that it's almost better to have a
very generalized network actually it
just is better to have a very
generalized network rather than network
that you know fits your training data
perfectly you don't really want that so
anyway this is just kind of three
examples one is just when we ran it
really quickly the orange is just that
real quick run it was like less than an
epic or epoch and then we have the blue
line which is a an entire wheat Punk and
then finally you've got this one which
is a bunch of Enochs so over time you
can see continued to improve itself it
is starting to kind of create a little
bit of an arc so eventually is going to
level out plus it has no choice but to
eventually because we're pretty much
reaching 100% here so so anyways that's
what we have so far it looks pretty good
loss continue to can you know drop the
last thing you want to see is a true arc
that light goes up and then our expect
or loss that art goes down start to our
key back up in the name of let's say
accuracy is not good
so anyways these are the results
everything looks good just a couple of
things one is you can run these kind of
relatively so you could click relative
here and this would be relative to when
they ran in time wall I forget what wall
does I think this is going to crash us
though yeah this gives crashing I wonder
if it's just because I've got too much
data in here what but anyway I don't
want to keep running those and then you
can smooth the line so you can see kind
of in the background how rough they were
in reality but then you've got some
smoothing going on here so you might be
asking yourself well why did you know
why the blue line goes so far up well if
we unsmooth everything we would see oh
the purple line did the exact same thing
it's just it didn't end here it went
back down so then once we applied the
smoothing it smoothed out that line but
it did go up there anyway that's the
data let's see how we did let's apply it
and see what it does in gain so I'm just
going to move this over and what we're
going to do first is create a test model
script so just copy and paste main we'll
call this test underscore model and the
first thing that we'll do is open it and
let me try do up that's not what I
wanted to do just did the windows shake
let's see that's not what I wanted
either I want that back why just notice
it's really dark in my room it's a storm
and outside and here in in the lovely
area of northern Texas when we get
storms we get brick in stores
it's so weird though because they roll
in and then they're here for like five
seconds and then they roll out so fast
but they just bring tornadoes and all
kinds of fun stuff anyway okay so we've
got the following I also think I'm going
to bring up where did this you this one
is a drawer okay cool I just want to
make sure I have all this stuff up
all right so keeps the output we don't
really need that we don't need any of
this training stuff here we do want this
we do want the resize we don't need the
key stuff though we don't need output we
don't need to append anything ah
I did that I'll just get the data screen
I'm not sure
no I didn't anyway delete that let me
make this window again so it's only on
screen sorry for my ineptitudes okay so
now we just have the main okay we
definitely want get keys because we're
going to actually use get keys to
implement a pause we're also going to
from Alex net we're going to import Alex
Nick grabbed screen we're going to do
the grab screen there I think that's
everything I want so now I'm going to go
this other script and just copy and
paste so from the training script copy
and just paste in these things the width
height or near a epochs in the model
name so we definitely want all that data
then what we're going to do is bring in
left right straight all that stuff
unfortunately I don't have those pull up
github real quick because I over wrote
the file that I had them on so I'm just
gonna go into the github real quick and
go to self-driving car scroll on down
and I'm just going to copy we really
just need this straight left right
we don't have slow your roll
functionality at the moment so not a
problem
you cut cut the brakes so okay straight
left right we're also hello
we're also um let's say for what we're
going to do is we're just going to
always be going first of all so left
will be press key a and W right will be
press key D and a wait no W trip
um but we want to release key a if we
had it so DW a so you want to press
forward we want to turn at the same time
right but we want to make sure we're not
also simultaneously turning left and
then when we go left we want to make
sure we release B which we are we don't
want to release a we do want to press W
forward and to go forward we want to
press W and release a and B hopefully
that's right we'll find out pretty soon
we try to run this and if doing weird
stuff okay so all right now we can bring
in the model so let's go ahead and say
model equals Alex net and then it was
width height and learning rate so just
with high L R for learning rate and then
don't forget this part model dot load
the load in the model model name okay
now let's get down here count down
fantastic what we're going to want to do
is basically check for the moves that
are passed to us so we could print out
the frames because this should be pretty
quick actually so I kind of want to show
because I want to show us how quickly
we're iterating through all this because
I don't have any sleeves so we'll go
ahead and keep the full show the frames
we definitely want to resize now let's
go ahead and let's get the moves so oh
we don't need this block either okay so
now let's say the moves is equal to the
list version of numpy dot around and we
want this to be the prediction to do
prediction or to say prediction equals
model dot predict and what you predict
is a list of features so the features we
want to use or the screen but
unfortunately it's not just screen it's
got to be a reshape with height so 80 60
and in fact
be good good little people and let's
actually use width width and height so
width height and then one since it's
just by one there if it was 3d data
you'd put it through them or not
communicate a rather RGB anyway so
that's our prediction now because you
pass a you have a list of features
you'll get a list of predictions back
we're just passing one so we just care
about the first prediction or the 0 is
element so then you've got your moves
the moves will be list NP a round
preaching so this just rounds everything
in the array because I did initially it
will not be pretty and rounded so we
could print multiple moves in prediction
just so you can see what I'm talking
about because later on that's kind of
what I was trying to illustrate too
before you can have different sort of
predictions so you could say especially
when we get like Pig control my
expectation is that we can actually turn
and sharply in percentage form as the
prediction for that turn is and I think
that will be very smooth but I don't
have Pig control right now so I don't
know how to do it but that's going to be
like the next step I take is trying to
do that but for now we're going to round
it and just go with whatever the largest
one is but anyways for now let's just
say kids you could also run an orc max
motion but like I said I kind of wanted
to do it this way anyway look Arg max
would do the exact same thing you can
say if Arg max prediction equals zero
that means left so anyway if moves
equals one zero zero
we wanted a left Elif moves B equals
zero one zero we want to go straight
straight if we can spell and then
finally Elif Elif moves equals zero zero
one
we want to go right great and then
finally just so we can pause this thing
I want to do T Z equals key check and
then we're going to say if now we're
going to use the the letter T you can
use whatever you want I wouldn't suggest
you use P because P X also pauses in the
game and the undying thing is it
sometimes can take a second to pause in
any way I just didn't want to use B but
if you want to go for it but just know
it kind of conflicts anyway if T in keys
and in fact let's go up before the while
true loop and let's say pause equals
false and then we're going to say if not
paused we're going to run all this all
the way to the key check so if not
paused run all this and then what we're
going to say if T is in keys let's say
if we're already paused we're going to
say now pause equals false and then
we're throwing a quick sleep in here
just because if you don't sleep you're
going to press key and it's going to go
back and forth really really fast on the
pause so you could sleep for a really
short shorter amount of time like point
five or something but one's probably
totally fine if you're paused okay we
unpause sleep for a second so we don't
just immediately repose ourselves and
then we say else ha equals true but then
we also want to make sure we release
release key a w D and then we're going
to go time sleep one and then we run me
okay so we'll save that and so there's
like a fly around here anyway save that
and I think we're ready to run let's do
it yeah we're doing in game we're all
set up good to go
maybe taken an hour to rip there we go
up syntaxerror of course why wouldn't we
have a syntax error okay double W equals
there silly me see if we can get by the
syntax there's let's see a countdown so
I want to see come on four oh there get
finally it took a while
okay so I was just loading up the model
basically so ah we didn't import the
keys interestingly enough it wanted to
take a left but anyway you can see here
in the predictions you pull it over all
the way it's not a purpose even number
like these are after we rounded it this
is the actual output from the neural
network so you can see clearly this is
almost one it's you know 92 percent
certain it wants to go right but it's
also you know somewhat thinking hey
let's go left and somewhat barely
thinking let's go straight as well
anyway that's actually pretty strongly
wanting to go right when not I'm not
confident we really need to go right
there but oh right
anyway we need to import all the key
presses so let's go up to the very top
here and let's go ahead and from direct
keys we're going to import press key
release key and then W a s and B that's
not what I'm know this is I don't know
anyway we're good let's run it again and
wait an hour for the model load
ready to rumble I'm just moving it right
now want to see what it's going to do I
guess I'll let it control itself let's
go okay all right
a lot of wiggle going on but it's
staining the lanes that's good oh oh man
it's good give you it's going to make it
motion sick oh yeah we're in the
guardrail anyway see now I can just
press T and we're good I'll fix myself
and I'll give it a run and start this
time and we're off staying in lanes stay
in lanes but we got a turn come up and
not the agency doesn't want to that turn
I put the other the other one took us
off-roading there the completely
different algorithm and that's let's
exit this turn here tight alright let it
take an over again so I mean this isn't
great obviously it's just so sporadic
which again take control would be really
convenient all again amis fixing himself
nice okay so anyway you know like this
is actually you know it's pretty bad but
at the same time what does do for us is
it validates the idea that we can
definitely use a neural network to at
least do something the other thing I was
kind of thinking about was and wondering
was all this information is being passed
to the neural network so interestingly
enough I was started thinking you know
what the neural network might not even
look at the road I'm pointing to my
screen again you guys can't see that
come on anyway the surface network might
not look at the road instead it could
look at the map on select a little mini
map you know and it could learn to like
point and stay on that map somehow you
know so anyway I started wondering if
the map was to blame there I wish there
was a way I would raise impress em no no
no this is some sort of mod go away this
why some way to remove the map others
don't know it but it'd be interesting to
probably remove that and see how it does
well no we're dying
okay so alright so anyway we didn't we
just didn't get enough training data so
this is actually probably better than
then we should have expected to be
honest with you
but yeah that's pretty yeah it's pretty
good for only like 20,000 samples of
just driving the stupid scooter around
now moving forward to be honest with you
I just can't make enough training data
to justify or I just can't make enough
training data on the scooter I found the
scooter to be unbelievably boring to
build training data for so I just don't
want to so I'm going up the ante a
little bit so first of all we're going
to get a better ride so we're going to
be on this
Dinka TT and has a little more speed to
it and then also we're going to bring
back traffic and what I'm going to do is
basically train this on the main loop of
the you know grant to thought a map here
so basically it's all the way around and
in order to do pick and turn in here it
comes in here comes around here and
repeats so that's the idea I'm going to
train on that I think that'll be a
little more pleasurable for me to
actually create some training data the
scooter was just too freakin boring and
also I'm just so confident that it'll
work it you know it's like it's not fun
anymore when you're very confident it's
going to be a success so so now I've
decided to just kind of raise the bar a
bit and have something that not only
hopefully stays on the roadway but also
avoids collisions with other cars so
that's what I'm going to be working on
whenever I have the training sample data
for this I think I probably will host
that somewhere just so not everybody has
to build it if they don't feel like it
but also I encourage you to kind of
build whatever data you want so if this
is the kind of AI that you want to have
have it do something else so the other
thing I was kind of thinking about was
having to do like taxi missions or
something like that I think you could
train a model to do to do
something like that too to like leave
the map and figure out where to go so I
was thinking about maybe trying
something like that too maybe down the
line but for now I'm just going to make
a speeding motorcycle I think so so I'm
going to do questions comments below
also if you have any ideas for pit
control if that hasn't been implemented
yet on the github feel free to make a
pull request and kind of supply that for
us I think that will help with scaring
quite a bit so it's not so full plus we
have these predictions and I'm pretty
sure we can use pit control to literally
use the output of the neural network and
have that input into the actual controls
the percentage that is the prediction so
anyways that's the plan that's moving
forward if you guys have questions
comments concerns whatever feel free to
leave them below otherwise I will see
you in another tutorial where we are
speeding through the streets of Grand
Theft Auto</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>