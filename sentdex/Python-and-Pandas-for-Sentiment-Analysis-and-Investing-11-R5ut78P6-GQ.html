<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python and Pandas for Sentiment Analysis and Investing 11 | Coder Coacher - Coaching Coders</title><meta content="Python and Pandas for Sentiment Analysis and Investing 11 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python and Pandas for Sentiment Analysis and Investing 11</b></h2><h5 class="post__date">2014-06-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/R5ut78P6-GQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
their Python pandas sentiment analysis
and finance tutorial video in this video
we're going to continue working on what
we've been working on and that is trying
to develop a strategy based on sentiment
analysis and see if we can you know get
anything out of it and the other idea is
just to help us get comfortable working
with pandas so where we left off we
develop this very basic strategy that
buys and sells based on just a few
situations basically and we've back
tested it against a single stock but now
what we'd like to do is back test it
against a wide range of stocks now
there's one more thing I want to add and
that's going to be we have to change
something in the single stock auto MA
and what we have to change is right at
the end here what we want to do is we
want to have it before we return data
frame we want to do dfsort underscore
index and then in place equals true what
this is going to do is going to sort by
the index of the data frame if the index
was numbers it would sort by you know
number size if the index was say words
it would sort alphabetically in this
case it is a date time and it's going to
organize it by day time and so the
reason why we have to do this is when
we're using just pandas and we and we
just we tell panas hey we want to plot
this and it's date stamps pan is is
smart man this is going to plot the way
that we expect it to plot but when we
start to do analysis on this feed it
through another function and then feed
it back to pandas pandas can get
confused and what's going to happen here
is we're actually back testing based on
really running it through this function
and then we're going to back test it in
the problem with this is I think it's in
like mid March or so we the actual data
dump has some may data in it so it
basically jumps from like march to may
the back to marching continues on again
and you're going to find this in a lot
of days that's actually where there
you've got some data that's mixed up and
it's not necessarily organized by date
so that's what we're doing here
this is obvious that will cause a lot of
problems down the road whenever price
suddenly changes significantly and then
goes right back and not only is that bad
for the backtest it's also just based on
bad data right so so that's why we want
to sort it by the index so before we
return the data frame we're going to
sort it so next we want to work on this
back test so this back test basically we
want to backtest all of the stock so the
sp500 ish for the SP 600 worth of
companies here so we need to add a few
more things as back tests and then what
we want to do is we want to save a bunch
of data from the back test that way if
we want to kind of play around or
visualize this in various ways we don't
have to continually do the back tests
just to visualize the data we can do the
fall back tests they have a bunch of
data from the back tests and then
visualize much quicker rather than
running the whole back tests over again
so as you can imagine that I mean the
bat test at least on my computer for one
company is like 20 30 seconds so
obviously for 600 companies we're
talking quite a while that would take
like an hour so anyway we're going to
modify this a little bit so the first
thing we want to do with this is we want
this function to understand what the
stocks mean is so we're gonna say name
equals data's and it's just we're just
going to reference the datas type and
then we'll just say the zeroth element
it could be any element really but that
will reference that then what we want to
do is we're gonna save a performance
array we're going to save a date array
and then we're going to save a
percentage change array and then we're
going to have this all written to a file
so for now we'll just do this perf
underscore rey y equals empty date
underscore ray equals empty and purse
change equals empty and actually I call
these all arrays they're going to be
just Python lists sorry if you're OCD
about that stuff and I think that's all
the empty stuff that we need now so now
we're going to do is really all of this
can stay the same we don't really have
to change anything
after let's see I guess before the
exception of caso let me think here
we're going to do because we want to do
for each row so underneath the try so
not there but there we're gonna say
current person change and current
percent change is going to equal we want
to go ahead and round this a little bit
and this is going to be round the
current valuation minus starting capital
and then we want to divide it by
starting capitals and you minus the old
about about the old Don's 100 so divide
it by starting capital x 100 and then
we'll just run this the nearest fourth
and this and I know it's getting angry
because we let see new my CEO / the old
and that should encompass our entire
round function and it does so that's our
current percent change basically for
each row it's going to save that percent
change because what we had to end up
wanting to do so we can kind of
normalize all of this data is we're
going to plot it based on percent change
not based on actual change so we can
plot all of these companies together and
then we're going to say purse underscore
change dot append current person
% change and then we're going to do perf
underscore array dot append the current
valuation and that is being defined here
and here and then finally we want to do
date array dot append index and this is
just so we can say this real nice to a
CSV file and then plot it later on and
this is also why we're why won't work
with pandas anymore because we're
ripping it away from pandas and then
we're going to bring it back later on so
that's why it's really important that we
order this correctly and then that
should be it for the try we come down to
the holdings percent change we can print
all this stuff out if we want um we
don't really need tues we're just going
to save all this stuff but i'll leave it
there and what we're going to do now is
we're going to come down here and let's
see like what we'll do here is right
okay so next what we're going to say I
guess we'll just loop through this we're
going to say x equals zero and then I
make some space here and then we're
gonna say for HP in / underscore array
and we're just going to use this to
iterate through this entire loop here
our entire data set we're gonna say save
data equals open and we're going to call
this performance data sp500 is csv we're
open this with the intention to append
and then what we're going to say is what
we have to we have to save you know
create a line that we want to save so
this line is going to kind of a funny
line but you'll just have to work with
meat on these so what we're going to do
is see will do line equals string date
uh Nurse Corps ray x
and then we'll do plus that Plus name
plus Thomas here plus string each p plus
another comma + string purse underscore
change X and then all of that plus a new
line okay and there is a CSV like module
for Python but I actually kind of like
doing this a lot of people ask me why
don't use CSV this history module just
because I'm used to doing it if you want
to do this with the CSV module have at
it so anyway that's the line that we
want to save and then basically we want
to do is save data right that entire
line and then we're going to X plus 1 or
yeah plus equals 1 and then once we've
gone to an entire loop we're going to do
save data closed and then we can
actually close out of you know all of
this data so once we've done that now
the next thing that we want to do is
basically we've defined this entire back
tests but what we want to do now is we
actually want to and we've saved or at
least sort of saving it to a file but we
need to also iterate through all of the
stock you know company names that we
have so what we're going to do next is
we're going to come down save data
underneath sick savedata close and we're
going to pin or put in this entire stock
list now again kind of like writing out
the whole strategy and all that I don't
really see any reason why we need to
type out literally like 500-600 names so
I'm just going to copy and paste it and
if long as i remember i will put it in
the description if I don't remember
someone say something and I will put it
in the description of the video so I'll
paste that in so that's our entire stock
list here that we're going to be using
and then what we want to do is we're
going to say for each stock in stock
list what do we want to do
well here we're just going to say data
equals single stock single stuff auto MA
and then we're going to say each stock
so each stock in this list will be fed
through this auto ma which basically
returns the data frame which we're
saving is data at the moment and then
we're going to come down and we're going
to do back tests back test data close I
was the third and then change i equals
11 so that's basically this stuff so we
can get rid of those now um we'll come
down here and really I think that's all
we have to do because this will
automatically save all the data that we
want to work with so that's pretty much
it the only other thing I'll do is we'll
add a try and accept in here just in
case because we've added a lot of stuff
and we definitely have some sort of
error so your exception a french stream
e tom sleep and we'll sleep 1 i'll stay
for like 15 seconds it's just so you can
see see it without zooming by and so now
what's going to happen is going to go
through all these companies and save
this data to this csv which will just
end up in the same directory as our
script so this might take a while so i'm
just going to go ahead and cut off the
video here but i'm going to run it and
it would be wise to for you to run it
and not continue with the next video
until you have run this and you have all
the data saved here so if you have any
questions or comments or something's
going wrong feel free to leave those
below as always thanks for watching
things for all the support and
subscriptions until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>