<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating TFRecords - TensorFlow Object Detection API Tutorial p.4 | Coder Coacher - Coaching Coders</title><meta content="Creating TFRecords - TensorFlow Object Detection API Tutorial p.4 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating TFRecords - TensorFlow Object Detection API Tutorial p.4</b></h2><h5 class="post__date">2017-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kq2Gjv_pPe8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
part 4 of the tensor flow object
detection API tutorial series in this
part what we're going to be doing is
building on the last part yeah at this
point you should have all your images at
least somewhere between 100 and 500 plus
images you can imported 500 if you
wanted but anyways you should have all
your images you should have labeled them
all by now and you're ready to proceed
so for me that's an images here and I've
got all these and then go ahead and make
a test in a train directory and then in
the test directory take about 10% of the
images along with their matching XML
annotation informations and copy them
into tests and then take the other 90%
and copy them into train now if you
download my like pre kind of uploaded
version it should already be done for
you so they should already be in there
just kind of save step but yeah it's
just copied the images in there so so go
ahead and do that and then once you've
done that we're ready to embark on the
journey of creating these TF records so
because at the end of the day basically
all you need to do to actually get this
done to train a model you need the TF
records that match your images then you
need to set up the configuration file
boom you can train and it sounds really
simple but there's so like a bunch of
little steps along the way so anyway
once you're ready to proceed the next
thing that we're gonna do is we're going
to use some helper code basically from
dat trans I hope I pronounced that right
that's probably the easiest way to do it
is just I would just look for raccoon
objects detection I suspect that will
come up right here it is so data set
racoon detector probably I'm gonna go
ahead and click on that see what happens
yeah okay so we really you could clone
this entire directory but actually we're
just inherent interested in two scripts
from here the first one we want is this
XML to CSV also just because I am taking
things from someone else's github this
has been at least this now is only two
days ago but since I've been making this
tutorial this
has this repository has changed like
multiple times and some of the changes
have actually broken the functionality
so I'll buy it briefly I think he fixed
he fixed because one of them I think was
the for the actual generate TF record it
broke for Python three when he added
support for Python 2 so anyway but I'm
pretty sure it works now so anyway but
if you if for whatever reason things
aren't working in the text-based version
again there should be a link in the
description if I forget to put the link
there someone does remind me to the
exact commit that I'm using for this
tutorial series so if something doesn't
work right you can go to that exact
commit and it will still at least work
but try to use the updated versions for
example the most recent update was to
fix the multi box problem so that's I'm
pretty sure for if you had multiple
boxes of labels I'm pretty certain that
initially he only handled four if if
there would just be one box so he didn't
actually allow for multiple boxes so
anyway obviously it's a useful
improvement so try to use the latest
versions if you can so anyways
yes so XML to CSV that's the one that
we're gonna use for now so I would just
go to raw and we'll just copy that and
for now I think we'll probably good idea
to make a new directory and we're gonna
call this object - detection and then
I'm just gonna drag images into object
detection cool I'm gonna go and create a
new document and we're just gonna call
this the same thing XML underscore two
CS feed up high and open with and we'll
use atom since it's here and go ahead
and uncheck that box no I don't want to
be helpful and paste okay big hopefully
it's pretty challenging to see on video
but it is soft on the eyes a lot of
people make fun of me for using Idol
because it's like white and black some
reason I like it cuz it's so it's so
clear but this does it is soft that's
for sure so within the XML to CSV
basically there's a couple of things we
want to change
actually there's really only one thing
for some reason I think before there was
something changing here but now it would
just be in this main loop here and I
make sure it's on screen yet that's some
space here so we can see it so what
we're gonna want to do is put a for loop
here so so I would say for directory in
train test it suppose I'm not sure why
this isn't here there's a couple of
changes that I made to this these this
code that I'm just I should probably do
a pull request or something or at least
just ask why why not when I just set it
up like this I just I don't know anyway
so it's gonna iterate through the Train
and test to create those separate CSVs
and then from these CSVs we create the
TF records so all would be really nice
is in this main loop that way we didn't
have to copy all the images just have
like a train test split that happens in
the main function that would be
wonderful
should make those changes somebody want
to make those changes pull request great
anyway in 10 it's not raccoon labels at
least for me it's going to be well
actually it would either be trained or
test labels so what we'll go ahead and
do is just do some string formatting
here and then format directory also we
want to store them into data slash and
again this is something that even he
does and he's like right up so just
since it was actually fairly helpful to
me it didn't fully give me everything I
needed cuz I guess I'm an idiot but he
does also have like a medium write up
for training object detectors with
tensor flows objects API but even in his
code I'm pretty sure he slows or throws
in this stuff into the data directory so
anyway that's the kind of things I've
just found confusing as I was like going
through this like trying to put
everything where it needs to be anyway I
think that's the only changes that we
to me let's see images no get current
working directory
we don't use annotations we're using
images and then it would be images slash
trainer test
so again format directory okay
we'll find out pretty quickly if this is
correct or not so anyway okay so we'll
save that and I'm just going to minimize
it for now except we no doubt probably
messed up somewhere or I did anyway
change directory into home see desktop
object to inspect detection and that
might be kind of hard to see plus plus
it doesn't work oh it's working
very nice okay so now I'm gonna run
Python 3 object or no sorry XML to CSV
dot pi oh we don't have a data directory
yet so let's go ahead and create the
data directory new folder data also
before forget I'm just gonna create the
directory for training because we're
also going to need a training directory
let's try it again
cool so now to just check we're gonna
cop into the data directory sure enough
test labels train labels at CSU both are
done oh I don't want to use the Libre
Office come on just open up in anything
so should look something like this now
my my test labels is pretty short it's
only like 12 by the way I think I've
like 150 total samples and then 12 of
them are the test and then the rest I
used to train because I I don't really
like you kind of want to fit test is
just there that's to tell you in the
training steps but it's almost like a
waste otherwise because the models
trying to fit to the training data
anyway so and I already came into this
project and knowing that this pipeline
works so why would I waste too many
images on the testing steps
so yeah anyway okay so we've converted
them to CSV and now we want to go ahead
and do is grab that TF record script so
back to the github back page back again
generate TF record grab that's good raw
and again just copy object detection
your document generate TF record PI and
paste now in this one the only change we
need to make will be up here so we're
just gonna change raccoon to be whatever
your label was so whatever label you
chose when you were labeling in label
image put that in for me that's mac and
cheese but for you that might be other
things now if you had multiple objects
you might have many if statements right
so your first one would be one your
second one would like let's say you did
mac and cheese and hot dogs hot dogs
would return two and so on you could go
very far now it looks like judging by
this to do statement here that he's
probably gonna replace it with the label
map my guess is that's like the label
map that you're gonna write well we're
gonna write later but I really don't
know but eventually this function might
totally change so just be on the lookout
for that if this has changed you can
either use your intuition to kind of
figure it out or you can like I said
before go to the exact commit that I'm
using here I just don't want to copy his
code and put it up on my github so I'm
not gonna do that or on Python program
in it so anyways I think that's the only
thing we want to do otherwise
the rest of his code is good enough also
just for the record I don't know about
the XML to CSV I think it I think it
have a conversion for that tube but for
sure generating TF records is code that
is on the official tensor flow object
detection API page it's just I figured
it out using this guy's code and using
his write-up so I just figured I'd I'd
use it for this tutorial - there's not
really no reason for me not to so other
than that I think that's all we need to
do the only difference is of course that
this is going to be using object
detection utils and all that so so now
I'm gonna I'm gonna go ahead and install
that so if you've been following along
this whole time chances are you've
already got that installed like the
object detection stuff and all that but
I wanted to make sure I was on a
completely fresh install so I didn't
have anything else already on here so I
didn't skip any steps cuz there's so
many steps to this process I wanted to
be a hundred percent certain that
anybody following along could really
follow along and not have missing stuff
alright so I've got it installed up to
the point of all the stuff that we did
basically in part one this series now
there's one more thing we need to add
that everybody is going to need to do
and that is in actually install object
detection - to our machine basically so
from World really the models entirely
anyway from desktop / models what we're
gonna want to do is actually just
install this so we're gonna do a a
pseudo Python 3 setup pie install and
again that's from from that models
directory that the cloned github and so
you should be all set now so so once
we've done that what we're gonna go
ahead and do is and once you've done
that - you won't have to take the object
that you shouldn't anyways I have to
take object detection slap it into that
directory it shouldn't just be here so
eventually we are going to slap it in
anyways but this makes life a little
easier you don't have to do the system
path change nonsense anyway now that
we've done that let's go ahead and try
to generate that TF record so I am going
to come back over to these are both in
desktop models
okay whatever anyway I'm gonna close out
of this one then and change directory
back and then into object object -
detection which might be kind of
confusing at this point but object -
detention detection is our directory the
one we've been working on anyway what
I'm going to go ahead and do is Python
three actually let's just go into that
generate TF record cuz I'm pretty sure
he's got a sample of what we want -
right right so we need to do this twice
once for the train labels and once for
the test labels so let me let me type
three here and then we're gonna make the
output let's see the input should be
data slash train labels I'm pretty sure
we already that's the the nomenclature
basically that we used and then the
output we're gonna throw it
automatically into data slash that again
I'm not sure why this isn't the case
already because unless I'm mistaken I'm
pretty sure even in his code that's
where it needs to wind up eventually so
so we're gonna copy that and come back
over here and do right-click paste so
just make sure train labels - train dot
record good we'll run that done and then
now we're just gonna take train and call
it test and then don't forget to do this
one over here as well Tess okay now we
should have our records let's go ahead
and confirm make sure that they're
actually there so data slash there's
your test record train record okay so we
have the TF record file so this step is
just kind of confusing but basically
what we had to do is convert from
anything that generates data and like I
think we just call it the Pascal vaak
data structure basically
once you take those Pascal VOC files
you've got to convert them to TF record
files that's my understanding correct me
if I'm wrong anyways basically this
whole process was the steps that are
required to convert from the stuff that
we made with label image to TF records
where we can actually use them with the
object detection API so that's it for
this tutorial in the next tutorial
basically what we need to do to train a
model is have the TF records we need in
a configuration file basically in a
model and all that to start with so in
the next tutorial what we're going to do
is set up that configuration file get a
pre trained model and we can actually
start training at that point and then
see let's see if we can detect the
macaroni or not so anyways that's it for
now if you have questions comments
concerns whatever feel free to leave
them below otherwise I will see you in
the next door</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>