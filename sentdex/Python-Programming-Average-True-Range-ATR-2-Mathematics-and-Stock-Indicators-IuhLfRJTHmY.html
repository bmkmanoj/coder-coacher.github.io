<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python: Programming Average True Range (ATR) 2 Mathematics and Stock Indicators | Coder Coacher - Coaching Coders</title><meta content="Python: Programming Average True Range (ATR) 2 Mathematics and Stock Indicators - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python: Programming Average True Range (ATR) 2 Mathematics and Stock Indicators</b></h2><h5 class="post__date">2013-11-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IuhLfRJTHmY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you
what's going on guys welcome to the
second part of the average true range a
tutorial video within our mathematics
and stock indicators in python tutorial
series that's a mouthful where we left
off I was telling you guys all about 80
are now we actually want to start
programming it for the purposes of this
video and probably the next quite a few
stock indicator videos I decided to go
ahead and just upload a sample data file
so everybody can follow along perfectly
for the first video that we did it was
nice because we only really needed to
consider two data points to to do the
basics but since we're going to be
incorporating it in a chart it just kind
of makes sense to go ahead and use like
a lot a little bit longer of a data set
so I did upload a sample data file so
it's going to be sent text comment /
sample data dot txt and pay attention
again to the camel casing sample capital
dat a txt hit enter and there's some
sample data just literally highlight
copy paste that into a notepad file dot
txt file and you can continue on and
just in case anybody's you know not too
familiar with how the patents work it
must be in the same directory as your
script that you're writing so right now
this sample data txt file is in the same
directory as this ATR tutorial dive
files so same folder right anyway
continuing on now what we want to do and
this one is we're going to use numpy and
so we're an import numpy as MP this will
make it easier for us as well we're
going to build it around the idea of
numpy non packing this data like we do
in the charting application so it makes
meshing it that much easier now we're
going to define our sample data which is
going to be open and then its sample
data txt we want to open up with the
intention to read and then we're going
to go ahead and just read it in a memory
now we're going to split that data and
that's going to be equal to sample data
split and we're going to split it buy a
new one subsequently we're neves that
num pilo text so and we're going to
unpack it so we're going to say date
closed P hi P lobe p open p I do this
because when you what kind of like keep
things as uniform as possible and close
is an operation within Python and then
open it also an operation within pythons
you can see that we did it right up here
so that's why I add the P to it but if
you only did open p and then the rest
you know it'd be hard to follow so
anyway then volume equals and then it's
NP load txt what text do we want to load
want to load a split yeah split data the
delimiter I'm just going to hit enter
whenever you may click long lists if you
have a comma there you can just hit
enter and you'll go down it's nice so I
don't run off the screen then we're
going to say delimiter equals comma
since thats its comma-separated
variables and then we want to unpack
equals true and the main purpose for
unpacking goes true is just so that we
can do what we've done here and say like
a loop of variables equals this so
that's the idea there now we're going to
go ahead and define a TR because right
average true range is just the
exponential moving average of a true
range so first of all when i define true
range and then we want to do an
exponential moving average of it true
range is going to require today's date
the open high low close and yesterday's
clothes for calculation right so we're
going to say in here we're going to put
the variables of d for date and then
close high-low open so CHL oh then why
see so obviously close high-low open
that's considering of today and then y
si will just be yesterday's close now
we're going to start saying kind of what
we did in that first video right we kind
of just defined three random variables
and then we gave the parameters for them
so the first one remember with true
range the question was the true range
was the highest of either or one of
these right so that's all we really need
to do to calculate true range so that
first one was so we'll say X today's
high
is today's low so it was the difference
there y equals the absolute value don't
forget that of today's high- yesterday's
clothes and then Z will just say the
third option was the absolute value of
the low of today- yesterday's clothes so
in theory if yesterday's clothes was
like really high and then today's low
was really low that would you know
trigger Z and then if you know
yesterday's clothes was really low but
today's high was really high and
yesterday's clothes was lower than
today's low then why would be the case
and so on so now what we want to do is
just for debugging purposes we're going
to go when I go ahead and print out x
y&amp;amp;z eventually we'll remove those but
just in case something goes wrong and
then we also want to make sure our logic
is all right we'll print them out first
now what we want to do is if Y is now
normally we would just do greater than X
and then less than Z so rather if x is
greater than Y and grander than Z sorry
i was thinking about what I was about to
say and so I misspoke there then TR
would equal X right but keep in mind
that fairly often what's going to wind
up happening is for example today's low
will be I'm trying to try think of a
good example here like there could in
theory open could be the same price as
yesterday's close and that open could be
the low therefore x and y could be
identical right and then also if x and y
are identical it's totally possible all
three of these could be um well I guess
not this one like these two could be
identical and the see the way I guess
really the only ones that would be
identical are these it's early morning
against my mind is not working very fast
but anyway it's totally possible now I
think there's another combination but
just not enough coffee yet anyway so
really what we need to do is for all of
these let's just go ahead and say if if
Y is greater than or equal to the head
six and then and then if X is or if y is
less than or equal to X and then of X is
greater than or equal to z TR equal lips
so we're just going to throw a greater
than or equal to signs all around this
otherwise we're going to trip up
probably I mean it's it's definitely
going to happen where x is the same as Y
fairly often so anyway now the next
thing we're going to use is Elif
statement again just like before you
want to use L if so you're not running
through all of these so if this one is
triggered it's not going to waste its
time and run through these so if X is
less than or equal to y yet y is greater
than or equal to Z and T are equals y el
if X is less than or equal to Z yet z is
greater than or equal to y TR equals Z
now we're going to go ahead and print
out t are so we can know that we
hopefully did it right and in fact let's
go ahead and make it print d TR and then
also this function is going to return
that same data so we're just printing it
out so we know exactly what it's
returning so we know if it's returning
exactly what we really wanted now to
apply TR to this data here we're going
to use a while loop just very easy way
to do it so we're going to say x equals
1 and we do that so we start at the
first or the one element in the array I
always say first death or one because
it's not the first element in the array
right that's not how I raised are
measured the first element in the array
is the zeroth element so that if you
think I'm just like I don't know an
idiot for saying first if or one just
trying my best to make it clear actually
but anyway so we start at one because
that's where we need to start because we
need to consider yesterday's you could
also write into this formula that if
there is no yesterday can just consider
this option right here I see no point
that's a lot of extra
processing so we're just going to say TR
dates I do it this way TR dates equals
sorry empty array and then true ranges
equals m2 you're right and while x is
less than you scroll down a little bit
while x is less than the length of date
we're going to do TR TR date True Range
equals TR and we're going to call that
function so we're going to call this TR
function usually whenever I have like a
lot of lines like this what I'll do to
remind myself the parameters I'm just
going to copy this come down here a
little comment here and actually I do it
up but right above this it just serves
as a good reminder what the calculation
of TR actually is so we want to do date
and then the X spot in that date array
or date list rather actually it's an
umpire right so it isn't right usually I
call lists arrays anyway close p x a
type ii x lo p x open and we'll just do
this stays on the screen open p x and
Chloe wait wait wait yeah close close p
and then here for yesterday's pose it's
x minus 1 right so that's why we must
start at x equals 1 so x minus one can
equal zero and we can start at the zero
with element or the first element of
that array so that is that so now we are
calculating the true range and the the
actual date so we can just return them
both easily so then we're going to say
TR dates dot append TR date and then
we're going to do true ranges a pen
true range that's hard to be both clear
in the code and also clear as far as so
you don't make typos on yourself but do
make sure that you're doing TR dates
with an S for the actual array that
you're appending to and ranges with an S
that your appending to and then you're
depending the singular here because in
theory this is actually the true range
like this is the true range not true
ranges but since we're programming and I
think it makes it easier to say this is
the true range each one is a true range
and you're adding it to true ranges
anyway moving on don't create your ex
plus equals one otherwise you will get a
nice infinite loop so now that we've
done that we should have everything we
want and just just for kicks we could go
ahead and print a true range and just
hopefully we get a number that looks
like a legitimate true range right I
wish I could remember sample data it's
either using starbucks i think it's
starbucks prices anyway it should just
be somewhat let me pull up the sample
data so like you get okay i think it is
starbucks so it's 56 so if we're getting
if we're returning true range values of
say 100 um we have a problem right
because that stock did not move by a
hundred you know basis points so anyway
just keep that in mind so I think we're
ready to run this and we'll just see our
outputs let's go ahead and run we're
still printing out all this values up
here so we are we do well I guess we
didn't totally determine um so where we
print date and TR so here we can see
that we first up we print X Y Z then
we're printing date and TR so this would
be X Y Z and then date and TR as you can
see what oops sorry that was way off the
screen X Y Z we see 1.37 is the highest
number and then we
turn it out the date and then the true
range was indeed the right number so at
least that we've seen that it's working
I'm going to go ahead and remove this
subsequently I'm going to go ahead and
stop it from printing out since we are
printing true range here that's right
one last time so it's nice and clear for
us so again that's about right for fifty
dollar stock it's you know about one
dollar at the max or maybe even two
dollars yeah I've got a couple that were
over two dollars here so anyway that
looks about right for us so it would
appear that we are indeed calculating
True Range correctly and now we just
need to convert it to average true range
now since the conversion to average to
Ranger is very simple we already have
exponential moving average to find in a
previous video if you don't have it on
hand the quickest way to get it would
just be to go to sent Dexcom / starting
point pi drag this over we don't even
need the full thing we just need the
exponential moving average part I like
that copy that move that over just paste
it wherever you want because it's going
to be in our starting point script so it
doesn't really matter we're not going to
be copying and pasting this part of it
anyway now what we want to do is say so
we've already got true ranges being
appended right here right so all we have
to do is just friends exponential moving
average on it so 80 r equals x moving
average of what true ranges with you
know what window so this is the data
window right or values window so what's
the window well well father would always
suggest 14 so that's what we'll do I
would argue probably for a five but 14
is what you suggest so 14 and then we'll
go ahead at the end of this and print
out eight are so now we don't need to
print that anymore now let's run this
and here is our number array of the
exponential moving average or the ATR
cool so now that we've done that what we
want to do now is incorporate that into
our chart so you can see the exact same
chart I was showing you earlier and so
that's what we'll be doing the next
video as always thanks for watching
thanks for the support the subscriptions
and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>