<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[See Description] Back-testing our strategy - Programming for Finance with Python - part 5 | Coder Coacher - Coaching Coders</title><meta content="[See Description] Back-testing our strategy - Programming for Finance with Python - part 5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[See Description] Back-testing our strategy - Programming for Finance with Python - part 5</b></h2><h5 class="post__date">2015-06-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/swTmU86wYIc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to the
fifth tutorial of Python for Finance
using quanto peeing and zipline we're
just going to pick up where we left off
in the last one and that is the
inclusion of fundamental data and
actually this this program we're going
to write here is going to trade based
purely on fundamentals so let's go ahead
and go so we started writing our query
we're pulling information for the price
to book ratio and the price to earnings
ratio basically so far for like every
company in existence
we need to filter that way down because
we have 255 maximum companies so filter
what we can do here is we can filter by
you know various things so first we
could start by filtering by fundamentals
and in fact let's just copy and paste
this because it's going to give us a
hard time so copy that paste so we're
going to say like I was saying before
generally the p/e ratio that everyone's
looking for is 12 above 12 means it's
maybe overvalued below 12 undervalued
but again growth has a major impact on
this so and there's another one that's a
PE G ratio so priced earnings to growth
so that's another good one to use but
we're just trying to show an example
here but anyways so as a general rule of
thumb 12 is what we're looking for with
a p/e ratio so we're going to say we
want all companies that have a p/e ratio
less than 14 so we're going to wide our
net widen our net a bit next we're going
to in fact actually we'll leave that and
I don't think you can write like
multiple filters here so I think you
have to actually do this copy come down
we'll add another filter here and this
time we're going to filter based on the
price to book ratio and price to book is
basically how much basically the assets
of a company is the book value so the
price to book like for a technology
company let's say might be really bad
like the price may be way higher than
the book value of the company but say
the company is a manufacturing company
chances are their book value is going to
be pretty close to their price just
because that's their company's value but
then companies can have things like
patents and stuff like that that can
play in so a lot of technology companies
will have patents
and so on but the book value is
basically like if we took this company
and we sold all the assets of this
company and all the almost tangible
things that we have how much money would
we have and then so that's the book
value and then the price is the market
cap basically of that company so we do
market cap divided by the book value and
that's our price to book ratio so one is
pretty good anything over one means
there's the prices way more than the
book value anything under one signals to
us that this company is like way
undervalued but it doesn't necessarily
mean that you should invest into every
company that has a price to book ratio
less than one because generally a price
to book ratio of less than one can
actually signal that something major is
wrong with this company if that's how
cheap the company has become so keep
these things in mind again this is I'm
not really trying to create some sort of
epic strategy here or suggest that this
is how you should invest these are just
examples so P V underscore ratio and
this time we're going to look for
anything with a price to book ratio of
less than two again just like p/e ratio
depending on the sector of the company
and you know the business structure of
the company the PV ratio might vary
wildly luckily though if you want to get
crazy the Morningstar also has company
sectors so you can treat companies
different depending on their sector so
really cool stuff you can get pretty
fancy with just fundamentals here I
would say actually with the inclusion of
these Morningstar fundamentals and this
query incapability you can do probably
more than you can with the quant stuff
right now so it's but it's pretty cool
so anyways you've got filter you can
filter based on you know this data so
now we've filtered down significantly
but then we might still get more than
255 companies there are a lot of
companies out there so we can first if
you want if you've got a limit you
better order by otherwise you're going
to get like a random sampling so if you
want a random sampling fine don't order
buy but if you want something specific
you should order and because we don't I
don't really care for like penny stocks
if I don't have to
what we're going to order by is market
caps so we're going to say fundamentals
dot valuation and then dot market
underscore cap and then we're going to
say dot Dec DSC and that's descending so
this will order this return for this sq
alchemy query it will order it from the
highest priced market cap downward so
then we're going to order by that and
then we're going to limit by 10 so what
this is going to do is return to us the
10 most valuable companies they have a
p/e ratio less than 14 and a
fundamentals price to book ratio of less
than 2 okay so that's our before trading
start and then now with this return we
want to do update universe so update
underscore universe universe and again
the universe is your universe of
investable companies ok so these are the
companies that quanto peein is going to
be tracking the price of just constantly
and tracking all the information on
constantly and so that's probably why
they limit us I'm not sure who chose to
55 it might be like a memory thing like
255 times all the data equals less than
2 gigs of RAM I don't know no idea
anyway update universe and and then what
we want to update our universe with is
the basically the return of this query
so this query actually this is the query
is returned to context fundamentals so
the way that we can do that is we can
just do context dot fundamentals dot and
then columns and I wish it didn't do
this to me dots columns dot values I
wonder if there's like a way to turn off
the the autocomplete or type hinting and
stuff but I really like this
autocomplete that was great but the
little suggestions which I could turn
them off and I bet you can somewhere I
don't know anyway moving along so now
we've updated our universe
and then now we're going to go down to
handle data so this one hopefully we can
write pretty quick but again handle data
runs once per bar of data so if we're
using daily data that's going to run
once a day if we're using minute data
its running once every single minute now
since we're using fundamental data that
I don't really know I wonder if
Morningstar is update I believe it's
updated once a day but they might update
live I don't know but I'm pretty sure it
would probably be once a day but anyway
continuing on we're going to reference
how much cash that we have and this is
as usual context portfolio cash
easy enough then we want to reference
our current underscore positions and
that is going to be equal to context
that portfolio dot positions awesome and
let me make some space to pull this up a
little bit cool okay so now what we want
to do is we want to reference the stocks
in data so again
context is tracking us it's tracking all
the information on our portfolio and how
our strategy is performing data is all
of this stuff that we might be
interested in so data is basically
referencing our universe okay so coming
down here we're going to say for stock
in data so for each of the stocks in our
current universe what we want to first
check is the current underscore position
so are we currently invested in that
stock possibly context dot portfolio dot
positions and then we want to know the
positions for that stock and then dot
amount so the amount of positions for
that stock it might be zero but it might
be more than more than zero then we also
want to reference stock underscore price
and this is just the price of that stock
right now so data stock dot price okay
then we want to say our plausible
underscore investment is equal to cash
divided by ten point zero make sure you
divide by ten point zero you might have
a decimal cash but you
might not this is Python 2 code so don't
forget that decimal point otherwise it's
going to round to the nearest whole
moving right along that's your plausible
investment and then you've got shared
underscore amount this will be the
integer value because we can't buy
partial shares this will be the integer
value of our plausible underscore
investment divided by the stock
underscore price okay then
what we're going to do is we're going to
have a try and then we're going to
accept try accept exception as E and
then here we'll just print the string
version of a whatever that might
actually be if we do and that'll print
it out into the console then we're going
to ask if stock price is less than the
plausible underscore investment so if we
can at least buy one share then what we
want to do is we're going to say if the
current position of that company is
equal to zero and then also we want to
know we could use ands buts ands we
could make this all like one big long
statement but it's kind of confusing but
if you want to feel free to build it
into one giant statement and we're is a
if context dot fundamentals fundamentals
of the stock that work is in question
and the PE ratio PE underscore ratio is
less than 11 so now we're actually
looking for a company that is less than
11 so 10 or under or actually it could
be 10 point 9
I know 9 anyway less than 11 what do we
want to do we want to order so we're
going to place an order for that stock
and then the amount of that stock will
be sharing out that's it and let's go
ahead and just just run that actually so
we will let's we can build it but let's
just run daily let's just run for like a
year so oh six
17 2014 and then let's run that full
back this so this is just buying the
companies so we'll let that run but of
course at this point we're not actually
selling off any of the companies um that
we've invested in you know so we make
our buys and stuff but and then with
earnings maybe we can make more bonds
but really we made most of our buys
right here some more buys here's a
couple more buys some more buys and so
on
now return was 3.2 or beta 0.66 not that
bad or Sharpe ratio is absolutely
horrendous so not the best strategy yet
but the next thing that we actually want
to do is sell companies that change
because right now we're just buying
companies but the p/e ratio and the
price-to-book ratio can both change so
we need to handle for that so that's
we're going to be talking about in the
next tutorial is handling for changing
values so stay tuned for that and thanks
for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>