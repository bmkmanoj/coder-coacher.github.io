<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Bitcoin Protocol: Proof of Work shown in Python Code | Coder Coacher - Coaching Coders</title><meta content="Bitcoin Protocol: Proof of Work shown in Python Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Bitcoin Protocol: Proof of Work shown in Python Code</b></h2><h5 class="post__date">2014-02-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/K_Ac1Ko8-p8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody and welcome
to another Python tutorial where you're
going to be shown how to create your own
proof of work system as well as seeing
firsthand how and why proof of work
works so this video is both for people
who are following along with my Bitcoin
protocol series as well as people who
are interesting and interested in
possibly enabling proof of work within
their own website the idea of proof of
work is to inhibit spam and DDoS attacks
for the most part what you're going to
do is you're going to present the
computer that's making a request on your
server with a computational problem or
challenge where you're basically
defining the difficulty of that problem
and then you ask the requesting computer
to solve it now the beauty of this and a
proper proof of work system is that
while it takes you know a significant
amount of CPU power to solve the problem
it takes a minuscule amount of
processing power to actually validate
the answer that you're given generally
even with a simplistic hashcash or proof
of work system it's at least a hundred
times easier to validate that the
computer got the correct answer compared
to how hard it was to actually get that
answer so if you have Python 2:7 feel
free to follow along if you don't have
Python 2/7 I highly encourage you guys
to go ahead and head over to Python org
in fact I'll just show you guys real
quickly so this is the official website
python.org and head there go to
download' and scroll down and download
the proper installer for python 2 7 I'll
probably show the same thing for Python
2 3 3 rather eventually but for now
we'll use Python 2 7 once you have that
downloaded and installed the
installation process is extremely simple
what you want to do is come over to your
Start bar and just move this screen over
basically hit that go to all programs
find yourself python 2 7 click that
click on idle that will bring up a
version of um you know it's like pythons
command line base
luckily and then what you're gonna want
to do is go to file new file click on
that you'll get this and then just go
ahead and immediately save this wherever
you want I'm gonna put mine on the
desktop however and call it whatever you
want but be sure to end the like first
of all save it as all files and then
here I'm just going to save mine as
Hashcash example dot py hit save and now
you're ready to start okay so the
structure of something like hashcash is
a proof-of-work was described at least
introduced to you in the previous video
but I'm going to go ahead and summarize
it again so what ends up happening is
the server is going to pose a challenge
to that requesting computer and the
challenge is usually just a random
string so then the requesting computer
is tasked with finding a solution to
that string that when appended to that
string and added you know to the end of
that string it's then hashed and it's
supposed to produce the hash will just
have a certain length of 0 bits at the
start of the hash this is purely by
chance and the solution it's just random
basically so the best method of
discovery actually turns out to just be
brute force so that's what we're going
to do here as well as actually visually
see what it's supposed to even look like
since I'm sure a lot of people still
don't understand like what do you mean
by 0 bits at the beginning of the hash
table well so here we'll actually you
know see what the deal is so the first
thing that we're going to want to do is
we're going to import a couple things
the first thing we want to import is
string and we want to import strings so
we can actually make string text so
normally if you wanted to make text you
would just type it out but in it since
we're trying to generate random text we
want to first take string and then since
we do want to make it random we're going
to import random as well and so the
first our first challenge right that we
need to do is actually we need to create
something that just makes a random
string so that's the first thing that
we're going to do so we'll come back to
the rest of the importance we need a
little bit and first we need a challenge
now the challenge string can be really
anything so we're just going to use
something real simple and basic and I'm
just going to say example underscore
challenge so we're just defining
variable here equals oops not double
equals just go equals and we're gonna
make this uhm 9kz this this this this
you don't have to copy my challenge
string by the way your results are
probably gonna be different than my
results anyways okay that's a challenge
string now we have a challenge string
now we need to make our program be able
to you know just add something random to
the end of that so we're gonna say
define generation and this is going to
be our generation function that just
kind of generates an attempt and so
first we need let's see we're going to
say this will have a couple variables
first we'll just say challenge and
that's just going to be example
challenge and for now we'll say sighs
and then we're going to say size is 25
um
the reason why we're doing that is first
of all we want to know you know like
what's the challenge that were used
given and then also the size is just how
big do we want our random you know
answer attempt to be so the next thing
we want to do is we're gonna say answer
equals and then basically we're going to
start with a empty string and then we're
gonna say dot join so this is we're
appending to the end of this and we're
going to join random dot choice so it's
going to choose something completely
random between what and it's a random
choice of string dot ASCI I so ASCII
characters and these are going to be
lower case examples then we're going to
say that Plus string dot ASCII again
only this one is going to be uppercase
and then finally plus string dot digits
so any number and then what we're going
to go ahead and do is say plot or not
sorry and then 4x in range of size so
basically what this is going to do it's
a little challenging it's anybody that's
new but basically it's going to join a
random choosing of either in uppercase
or either a lowercase character an
uppercase character or a digit and it's
going to do this for X in range size and
basically what this is saying is for X
for whatever however many numbers are in
size so in our case it's 25 so for X and
range of 25 it's going to do this 25
times so it's just going to give us a
just at least a pseudo random answer so
that's our answer
now the attempts here will be equal to
challenge and then plus answer so this
is just going to append it so just to
show you guys let's first run print will
print the challenge and then after that
we'll print the answer so the answer
will be just totally random and then
we'll come down here and I'll just call
generation we don't have to put anything
in here because both variables we've
given a default so it's not a big deal
so generation we'll save and run that
and so we can see here that it you know
it repeated our example challenge right
here and then here we have an absolutely
random well not a truly random but
pretty darn random generation sequence
so if we ran it again
you would see that the first sequence is
obviously identical because the
challenge doesn't change but then the
sequence changes so we got a completely
different sequence here so that's the
first step right and then our attempt is
challenge plus answer so we could print
attempt here
save and run that and now we actually
have an attempt you know that is the
challenge plus and then right here well
here starts the answer so now what we
want to do let me close out of this is
this function needs to really stop
printing out stuff so I'm going to get
rid of this because eventually we're
going to make this generation and run
like a punch so we don't really want all
this printing and now what we actually
want it to do is we
not to return the attempt and we also
needed to go ahead and return the answer
because if it does indeed produce what
we're looking for we want to know what
that answer was because that's what
that's what we have to return to the
server so we do that now we need to if
you recall to find out whether or not
this is correct or not we have to make a
hash out of it and see if for example it
starts with three zeros okay
so to do a hash we're going to import
hashlib this is just the hash library um
so then what we're going to do is we no
longer want to call generation we're all
set there and for now just delete these
I think just so we can save some space
all right now what we're going to do is
we're going to say sha hash equals hash
live dot sha-256 so what we're just
saying here is we're defining variable
and we're just saying that that is equal
to a sha-256 done so now what we need to
do is we want to find out if this
attempt is correct so we're going to
come down here we're going to say define
test attempt and in here first we're
gonna say attempt an answer equals
generation empty so this return so
basically attempted answer equals
whatever this is right here so it's
going to run this function and return
attempt an answer as variables and now
what we want to do is we're going to say
sha hash dot update and what we want to
update this hash is attempt and then now
what we want to do is say our solution
is equal to sha hash dot hex digest and
finally for now let's go ahead and just
print the solution okay so then what
we'll do is I'll come over here and just
to show you guys a quick example of what
happens like for example if we ran this
right now
we'll run test attempt and we have it
the very first attempt here let's see
print and that's our
first attempt but if we could actually
just run it again so let's do this
answer second attempt we could do it
again you know this one at least started
with a zero but as you can see none of
these so far let's say our goal was
three zeroes um none of them hit it yet
so now let's make just a quick look oh
you could do something like this you
could say for X in values X range but if
you're in Python 3 of just B range X
range a 0 and 100 and what do we want to
do we'll just run test attempt just to
see here so let's save and run that and
so here we have a bunch of attempts now
I'm just looking with my eyeballs here
and I see a lot that start with zero but
I don't see any that are have two zeros
so now what we want to do is we need to
kind of change our function a little bit
here and what we want to do now is
instead of doing this we'll say uh if
solution diet starts with and let's say
we're only looks see we're looking for
three zeros if that is the case then
let's go ahead and print that solution
so we'll close this and then and then
we'll actually allow for let's say
10,000 and let's see if any of them fall
under that so we'll save we'll run that
and we'll run we need to see it well
this should have already run uh the ten
thousand so instead let's do a few more
here save and run that there we go so
now we got a few in a much larger number
we're still getting some so now it's
only spitting out ones that have three
zeros and I just saw one go by that
actually had four zeros but as you can
see it took us 1 million attempts to
start getting some and then if we added
maybe another zero and actually let me
just stop this one from running and so
we've had another zero let's run it
again and okay we're actually starting
to get some what's at another zero then
not bad not bad so as you can see it's
obviously slowing down though at the
pace that it's actually you know finding
these hashes that start with zero this
is next ones take it forever I have
found these two pretty quick and now
it's like nothing else so uh so the next
thing that up and only found two so
obviously so to find even a nut like
five zeros in a list of a million
attempts it only found two so two and a
million right so pretty bad odds
so anyways we'll close out of this and
now what we actually want to go ahead
and do is we want to kind of switch up
this attempt test attempt a little bit
so what I'm gonna do is let's say first
let's just get rid of this so instead of
having it be like a million what we can
do instead is we'll just delete that and
under test attempt I'm going to say
we're going to make a variable called
found and found is going to be equal to
false for now and then also well we'll
get back to the other thing in a second
so now I'm just going to delete this so
found equals false and now we're going
to say wow found equals false uh then
we're going to do these things so I'm
just going to tab these over and then if
solution dot starts with and again so
we're going to make this an infinite
loop so it doesn't really matter here
it'll never run out but we'll do five
just so the video will end at some point
if it starts with five zeros then let's
print solution and then we need to go
ahead and say found equals true and when
we come out eventually this function
would have to return an answer so for
now let's just print the answer we don't
really need to return it's not going to
use it for now so we can save that and
now we need to go ahead and let's call
test attempts here save and run it so
it's going to run run run run run until
it finds
something that are the hash that starts
with at least five zero so I'm going to
pause it until it finds something okay
that took like I know like a minute or
two minutes or something so here we have
the hash that starts with five zeros and
this is the answer to the challenge that
produced this hash so so now just out of
curiosity and interest we can come up to
the top here and let's import time for
time and then we can come down here and
we'll say a star equals time dot time
and then what we'll come down here and
says if the challenge is found let's say
how long did this take so we'll say time
took equals time dot time - start uh so
that I'll just do the math in seconds
basically and so we'll print the
solution and then we'll go ahead and
print time took and we'll say time took
here so now we can save and run it and
in fact while we could be prize should
change let's just make it 4-0 so to find
one quicker all right so this one took
only three seconds to find one now let's
go ahead and run it again and this one
took about another you know three ish
seconds yeah let's go ahead and run it
again one more time and this one took
about two seconds so anyway if you were
running say a website and you wanted to
protect against DDoS attacks for example
you know a typical mail abuser would
send maybe 10,000 emails a minute well
if you can only process like my computer
would be able to send 10,000 emails a
minute in my internet would allow it so
um I could get away with that but if the
processing time per email is costing my
computer 3 seconds well obviously now I
can only send like 20 a minute all right
so it's a very
cuts me down but then what happens is
when we find this answer we go ahead and
we're going to come back to that the
actual server that we're making a
request on and we say ok we got your
challenge here's our answer and then all
the the server has to do is run that and
say ok well here's a challenge here's
the answer that person gave us and they
try it and either it works and access is
allowed or it doesn't work and access is
denied and you'll see you know are you a
person that kind of stuff so that's just
kind of like the basics to it now as you
can see these are taking somewhere
between two and three seconds but if we
as you remove the zeros I mean it'll
come this one came within you know 0.05
seconds let's run it again point O 3
seconds point o 4 seconds ish 0.1 7
seconds and so on so as you add zeros it
gets a little harder and that's why
bitcoin is a little bit different
because uh wow we actually found this
one in one that was really quick let's
do that again
earlier it took us like a minute to find
so it was kind of funny the odds of that
are pretty rare I thought but no it's
fine and I'm pretty quit now anyways umm
so after I you know coded all this I
realized that maybe this was a little
more challenging for a brand new person
than I thought but do feel free to like
pause it or something and just copy the
code and but basically all that's
happening is this is where you know
we're creating the sample string this is
where we're testing it making a hash out
of it and finding out whether or not it
starts with zeros and basically you can
see here that at the more zeros that's
required the more processing time is
required in the morning you're literally
paying in CPU so it's pretty neat stuff
to be honest now I'll leave you guys
with this with hash cash in mind see
hash cash was never intended I mean
maybe it was but it was it it so far has
not been intended to actually make money
for anybody
it's basically meant you know hash cash
just means the requester has to pay
and that's it and usually that cpu power
is pure waste so with hash cash in mind
and a simple um you know monetization of
CPU power in the context of a
proof-of-work system we now have a new
way to monetize websites because while
proof-of-work here in this scenario it
was just kind of wasted you know we have
actually a system today where this exact
job is actually a profitable job see
traditionally websites have used hash
cash only in the sense that the the cash
was just something that was expended in
the cpu power was just totally put to
waste but now we can actually utilize a
system like hash cash be paid in hash
answers or even just attempts where we
use these attempts to actually support
the Bitcoin network for example so not
only can we use this to monetize a
website we can also protect against DDoS
attacks so while doing these things
we're supporting the Bitcoin network and
you know like more valuable parts of
your website's could be slightly more
costly than other parts you could pretty
much just have an infinite range in
pricing no chargebacks instant payment
no advertisement no middleman I mean wow
so you know you could either charge
people like obviously in this case the
typical case of hash cash the question
is you know please you know produce a
hash or the produce and answer to my
challenge that produce a sha-1 hash that
begins with three zeros okay um so in
that case you're just producing one hash
now in the Bitcoin network the hashes
are extremely difficult to achieve so in
this sense you know you could require
them to at least produce one hash that
you know starts with three zeros but the
next thing that you could do is you
could say not only do I want that one
hash that starts with three zeros I want
another hundred hashes just give me
another 100 hashes and if any of those
hashes happen to start with yeah let's
say 40 zeros thank you very much for my
free 25 Bitcoin so anyway so you can use
this
to actually monetize a website and be
paid in hashes that actually do have a
real market value on the Bitcoin network
so a lot of interesting things can be
taken from that and so I'll just leave
you guys there to ponder that so
hopefully you guys enjoyed hopefully
some of you guys are all wide-eyed right
now with aspiration as always thanks for
watching things for all the support in
the subscriptions until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>