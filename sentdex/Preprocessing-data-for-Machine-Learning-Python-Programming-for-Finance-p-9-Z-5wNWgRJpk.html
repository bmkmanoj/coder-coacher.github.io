<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Preprocessing data for Machine Learning - Python Programming for Finance p. 9 | Coder Coacher - Coaching Coders</title><meta content="Preprocessing data for Machine Learning - Python Programming for Finance p. 9 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Preprocessing data for Machine Learning - Python Programming for Finance p. 9</b></h2><h5 class="post__date">2017-01-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Z-5wNWgRJpk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's going on everybody welcome to
part 9 of our Python for financing
toriel series in the tutorials leading
up to here we've learned how to get some
data we've learned how to manipulate
some of that data a we learn how to
visualize a bunch of data now in this
tutorial really doing is since in the
visualization of a bunch of data
basically creating the correlation table
of all of our data we saw that sure
enough with pricing data there are
definite relationships between companies
sometimes it's very certain companies or
whatever or groups of companies but
they're definitely relationships there
and the question is can we get a machine
to recognize those relationships so my
kind of thesis as we move forward is
that ok
groups of companies are likely to move
together either up or down but it's not
necessarily always going to be the case
that they move exactly at the same time
at each other someone's going to be a
first mover someone's going to lag so
the question is can we take you know a
lot of times people look at one company
at a time period so they'll look at the
pricing history of a single company and
we'll chart patterns of just that
company or something another using
indicator on just that company to
predict whether that company will go
anywhere I'm not really someone who buys
into that I need there's gotta be
something more but the question is in my
mind what if we sure we're still going
to use just pricing data but what if we
take into account the movement of all
other companies as well as the current
company in question will that actually
give us a real edge so basically the way
I'm going to do it is pricing data we're
going to convert that to percentage
change so everything is normalized
percentage change data will be our
features so with machine learning
everything becomes features and labels
the features define something and the
label is basically the target in our
case we're going to say buy sell or hold
and we're going to try to label
everything as a buy sell or hold so the
way that we're going to do that is we're
going to take all of the feature data
and the way that we're going to generate
whether it's a buy sell or hold is we're
going to ask the question at least on
the training data did the price based on
these features right here within the
next seven days of trading
within the next seven trading days did
price go up more than 2% if yes that's a
Buy did it fall more than 2%
if yes that's a sell if it did neither
of those things
it's a hold will continue holding this
company okay so that's that's the
overarching plan and now we actually
have to execute that's going to take try
like three or four tutorials to do it
but we're going to do it so let's get
started so first of all what we're going
to do is define process data for labels
your labels or your target it's
basically the classification so we're
just passing ticker so each model that
we generate is going to be on a per
company basis but each company is going
to take into account the pricing data of
all other companies in the S&amp;amp;P 500 so
process data for labels for a specific
ticker we're saying how many how many
days that's going to be seven days so
basically how many days in the future do
we have to make or lose X percent we're
going to say seven days so again in the
next seven days does price go up two
percent down two percent less than those
or whatever so okay so how many days
seven then we were to say the F to start
is going to be PDI read CSV SP 500
joined closes dot CSV index underscore
call equals zero if you haven't been
following along this is going to fail so
if you're brand new to this tutorial
make sure you go to the previous one
Pickers equals the F dot columns dot
values dot two lists not quite we
probably don't need to be doing to list
top values is probably good enough I'm
just so used to doing values dot two
lists
I was probably unnecessary but whatever
if that filling 0 in place will be true
now what we're going to do is for I in
range between 1 and how many days plus
one so basically the range will go up to
a certain point but not actually do that
certain point so we want to run seven
days we're going to start if you do
range seven it will be seven things but
it starts
zero we're really we want to start at
one and so we want to start at one and
we want to go all the way to basically
what between one and eight which will
give us one through seven if it's not
clear to you you can always just click I
and you'll see what I mean but you take
my word for it as well so DF and now
we're going to create a nice custom data
frame colony it's going to be brackets
underscore brackets d dot format
ticker I so that column so basically
it'll be on ticker I so it'll be let's
say we're doing ExxonMobil exo-m so
it'll be x om underscore let's say it's
day 2 to D so this will be on day 2 into
the future what is the value the way
that we're going to get back is and
we're going to say what is the value in
percent change so so basically it's
today's price or I'm sorry it's the
price in two days for now - today's
price divided by today's price times 100
so the F ticker dot shift negative I so
when you shift things
your eyes are shifting them up or you're
shifting them like down in this case we
actually want to shift them negatively
because we want to get the future data
so what this is going to do is it's
literally like here let's see this would
be your your leftmost column and then
you've got a column here let's say
you're going to and then you've got data
the future data is like down here so
when you shift negatively you're
shifting up right so you're getting that
that teacher data I hope you like my
visualizations so so now so we're
shifting up by I numbers this in this
case you know one two three four five
six seven so that's how we're getting
the future you know value in the future
minus DF so percent change new my field
divided by the old times 100 so the new
is the future value minus the old is
today's value which is DF ticker because
again we created these columns to rather
than saying adjusted clothes since we
combine them all into one major CSV file
it's just about the ticker name so new -
the old and then we're going to say
actually want that to be all together
new messy old / DF ticker and that's
enough so that kind of went on to screen
a little bit but my big text is worth it
I think so anyways that's how we're
going to generate that new column let's
see if we can get on there we go looks
good so there's our new column we're
going to do that for every new day so if
you wanted to look 30 days in the future
that you would just need to change that
single value and you can play with that
to see how that affects things in
general I think if something's lagging
the other companies by 30 days it might
not be correlated anymore so I don't
know and that just made me think - don't
forget what I said before about
correlation we are we're checking the
correlation for like years of data and
in this case we're training on years and
years like almost a decade or more than
a decade and a half you almost like
don't want to do that because chances
are certain companies relationships to
each other have changed significantly
over time you really only want to look
back probably like one or maybe in two
years but you would need a whole lot
more data than what we have so you
really would probably need more than
daily you know one day data it's just
one day data is free so that's what we
using it anyway the Excel fill in a just
in case we have some with zero in place
these ones true and then return tickers
DF so at this point we're able to
process data for a ticker let me go
ahead and run it just to make sure I'm
not going to do anything further at this
point but I just want to make absolutely
certain that it runs it doesn't throw an
error or whatever for us I'm prone to
typos because I'm typing and talking at
the same time looks like it worked well
so far we'll see if it returns what we
want so that's it for this tutorial
in the next tutorial we're going to kind
of continue working on this we're
actually in this case we started
processing the actual data itself and
creating the future values and
next tutorial we're actually going to
write some functions that will map to
these columns now that will check these
columns to see did pledge raise or fall
or whatever by whatever number we choose
I think a little probably like about two
percent or something so anyways
questions comments concerns whatever
leave them below otherwise I will see
you in the next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>