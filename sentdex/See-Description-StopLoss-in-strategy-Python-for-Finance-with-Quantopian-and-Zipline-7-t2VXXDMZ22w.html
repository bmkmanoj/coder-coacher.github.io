<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[See Description] Stop-Loss in strategy - Python for Finance with Quantopian and Zipline 7 | Coder Coacher - Coaching Coders</title><meta content="[See Description] Stop-Loss in strategy - Python for Finance with Quantopian and Zipline 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[See Description] Stop-Loss in strategy - Python for Finance with Quantopian and Zipline 7</b></h2><h5 class="post__date">2015-07-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/t2VXXDMZ22w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
these seventh Python for Finance using
quanto peon and zipline tutorial in this
tutorial we're gonna be talking about a
couple of things but first it's going to
be these adding a stoploss to our
program so like I was saying before
stop-loss is a way for us to cut our
losses
it's generally used because it's an if
we're thinking price is gonna go up and
we make a buy but the market is telling
us nope that was a bad decision in the
price is falling we want to have at
least at some point it's a way for us to
cut our losses here so that's what we'll
be talking about here you don't want to
set a stop loss that's like too low
otherwise it's gonna be triggered you
have to account for market volatility
but a stop loss maybe somewhere can be a
good idea just like a limit by somewhere
it can be a good idea you can get pretty
absurd with your limit buys but it makes
sense to use them so anyway that's what
we're gonna be covering here is
stop-loss and adding that to our program
to see if we do any better now just for
the record when you're writing your
program here okay and you run a backtest
as long as you run a fullback test if
you run this build algorithm it won't
save it but if you run a fullback test
you can click on this back test button
here and you can see the back tests that
you've run so this was our first back
test this was without sales if you
recall but we can click on that and
reference an old back test that we ran a
while ago so this was without selling
anything and we did a little worse than
we did selling things so there's that
and also we improved our Sharpe ratio
which is a good thing by selling things
and if for whatever reason you want to
reference the code that was used for the
specific back test what you would do is
you click this button here and you can
go view code and this is the code that
you wrote that generated this back test
so anyway you can go to back tests and
then go back to all back tests here and
this was the one that we just run ran in
the previous video and this gave us
three point nine four and this was with
actually selling stocks and you can
actually see the sales that occurred
here and then up
here you can see that like I was saying
this sharp did improve but anyways so
going back to our algorithm so you can
write you can keep updating the same
script that you've been working on you
can always reference your old scripts
for you as they save them I don't know
if they have a limit but it seems like
they don't so anyway let's add the stop
loss now and to do that you just add it
in the order and it's like this for any
order so you can add it when you do
ordered target percent you can add it in
to order you can do order target and so
on basically any order type you can add
there and again if you don't know about
the order type so you can always go to
that the documentation here and look on
this side here and there's ordering
right so right on the left and to get to
the documentation again it's help-help
in API Docs you get here here's ordering
and then when you know here's all the
options for ordering you've got just
tons of options so keep it in mind but
anyway to do a stop order you'd use
style and here's a limit order but
here's an example of a stop order so
style stop order and then you put the
price of whatever that stop order you
want it to be so coming over here we
place our order for the stock the share
amount and then we add a quark
so style equals and it's already got it
there for us so stop order so we'll say
we want it to be a stop order and then
we set the price that we want the stop
order to be well this is gonna be kind
of dynamic right because depending on
what kind of stock we're investing in
we're not gonna know the price in
advance I mean you could be like if any
stock gets below $10 I don't want it any
more so you could do something like that
but that's probably not very practical
for the most of you so the way that we
can do that is we need to calculate
dynamically the stock stop price so
we're gonna just do stop underscore
price and that's gonna be equal to these
stock price minus the basically what a
minus like a half a percent let's say so
we're gonna say minus the stock
underscore price times 0.005 and that
will be a half a percent so the current
price now minus a half a percent of the
value that's what we want our stop
rice to be okay so we can just basically
do that and that's that if we do do
shorts so you can you can short
companies with quanto pian we'll talk
about that later but you can do that and
again with stop price you can have a
stop price for shorting - so your stop
price for a short might instead of B -
it would be like a plus okay so if
you're thinking the stocks going to go
down but it goes up more than half a
percent your you want out so with that
that should be it so let's go ahead and
run a fullback test and see how we do
now while we're waiting we'll just talk
briefly about some of these different
meanings so these different values a lot
of times people think of a back test and
they really only value the back test
based on one number one metric and
that's the total returns so a lot of
people will just simply only care about
what is this number right so what was
the return and that's all they care
about when really there's a lot more
that goes into an algorithm than how
much money did it make because a lot of
times you've got all kinds of questions
first of all did were they using what's
called leverage and leverages where you
take on more money than you have so
you're basically someone is lending you
money so this means you might make
exponentially more money or it might
mean that you will make exponentially
less money as leverage is usually in the
terms of one to one which is no leverage
one to two is a lot if you're taking on
double the amount of money that you have
and so on so you've you've got leverage
in that sense so it's generally like a
multiple of loss or a multiple of gain
so there's stuff like that but then we
have these metrics here like alpha beta
sharp alpha is basically your programs
irrespective of the market what your
gains
I guess it's how much of your gains were
made irrespective of the market okay so
that's the idea there beta is basically
how much of your gains were made
respective of the market Sharpe is how
much risk you took on in
in respect to how much you actually made
and so on so and then drawdown this is
another important one volatility is
pretty important you just want to get
that number low but max drawdown is
another one that's important and this is
basically from the highest high to the
to the subsequent lowest low so it's not
so much like you know this was the
highest and you know this was the lowest
it's mostly like it's it's from the
highest trough to the lowest subsequent
fall so in any one kind of cycle how
much did you lose in percentage for them
6.7 percent is good enough but this was
only a year of data so that's not really
that useful so you know people like to
do just returns only but you have to
keep in mind that some people like to
invest for maybe a steady income so
there are people that really like the
idea of high risk high yield so high
risk high yield strategies people just
care about the percentage return they
just like want to focus on that but some
people actually just want a steady
income and they actually want to smooth
out the fluctuations of the overall you
know S&amp;amp;P 500 market so you've got people
like that and in quanto peon at least to
me appears to be mostly interested in in
a low beta so for quant opium for
example they're looking for anything
between negative 0.3% or negative point
3 rather in positive 0.3 for the beta so
they want something that it's pretty
irrespective of market movements they
want and that's the only thing that
they're actually filtering for so if
you're not between negative 0.3 and
positive point 3 they will throw you out
but if you are it doesn't matter what
any of these other things are besides
total returns they want you to make
money but like they don't really care so
much I mean they care but then I care so
much about drawdown and all this kind of
stuff they just want a low beta that's
like their number one thing that they're
looking for right but as an investor you
should care two about thing all of these
metrics because they all matter pretty
importantly because let's say you've got
really high returns but you've got a
matched drawdown of like 50 percent so
that means at one point in one
fluctuation you lost half of your value
so the chances of you
at some point losing more than half are
pretty darn high so you want to keep
drawdown as low as possible and then the
Sharpe ratio is another really important
one basically you want to for sure be
above 1 I wouldn't want to trade
anything live that had a Sharpe ratio
less than 1 so obviously this is not
something I would trade and then 2 is
pretty good and anything like 3 and
above is just great ok so if you get a 3
or above Sharpe you're doing you do it
very well
alpha and beta I personally don't really
care I I don't see any problem with a
high beta but again it depends on who
you're asking so quanto peon wants
something that's basically not that
involved they want very low market
exposure so they want a low beta but I
wouldn't really worry that much about it
but alpha is pretty important right you
want to have a strategy that performs
well without just simply you know like
because if you're if you're if you've
got a strategy and a strategy adds risk
okay as opposed to just holding things
in the market so if your if your beta is
basically won and your alpha is pretty
much nothing then you would have been
way better off just buying and holding
let's say the S&amp;amp;P 500 spider index fund
right I'd have been way smarter so
that's kind of why we want to use all
these other metrics because they bring a
lot more to the table than just a simple
you know total returns you know they
helped us kind of evaluate how much risk
are we taking in you know so in the past
a lot of like quant traders for
institutions even we're judged you know
pretty much mainly based on their total
returns if you were a performer they
gave you more money but nowadays
actually there's a lot of risk analysis
that goes into every single trader
because they don't want to blow up
because blowing up is actually a lot
more common than we would think or even
like it's like one of those things it's
like the gamblers fallacy or something
it's just it of course it makes total
sense that gambling doesn't make any
sense or or that if you flip a coin 10
times and you have eight heads people
despite milling statistics think of
tails is just really likely to occur for
some reason you know it's just it's one
of those things that just doesn't make
sense to us
so so we use stuff like this to kind of
help us get away from our own biases
pretty much so anyways we'll probably
talk a little bit more on these so far
we don't really have the greatest
strategy yet we haven't really talked
too much about all the things that
quanto peon can do for us so there's a
lot more involved than what we've got
but these are just you know pretty basic
strategies to start but anyway that's it
for this tutorial
in the next tutorial we're gonna be
talking about maybe searching for a
strategy with with beta so for example
here with quant opium the question is
you know they want between negative
point three and positive point three how
do we get a strategy in that number in
that range so we can in theory enter the
contest well we need a strategy that's
going to do both by in short because
we're shorting shorting is going to
allow us to oppose the market directly
so that will help us keep a low beta so
that's what we're gonna be talking about
in the next tutorial because so far we
haven't done any shorting but we'll be
talking about that in the next tutorial
so stay tuned for that thanks for
watching if you have any questions or
comments leave them below and until next
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>