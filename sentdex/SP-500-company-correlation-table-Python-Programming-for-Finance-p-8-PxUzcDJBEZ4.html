<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>S&amp;P 500 company correlation table - Python Programming for Finance p. 8 | Coder Coacher - Coaching Coders</title><meta content="S&amp;P 500 company correlation table - Python Programming for Finance p. 8 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>S&amp;P 500 company correlation table - Python Programming for Finance p. 8</b></h2><h5 class="post__date">2017-01-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PxUzcDJBEZ4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everybody what's going on and welcome to
part 8 of the finance with Python
tutorial series in last video we
basically we've been pulling all these
stocks we save them all the pricing data
in the last tutorial we actually
compiled them all into one large data
frame and we save that data frame as a
CSV file now what we're going to do is
we're going to work with that data and
our intent is to just see can we at
least initially find any sort of
relationship with this data set now a
couple things to note one is a lot of
data has missing values another is this
is the relationship over the course of
over 15 years so 16 years basically of
relationships actually really like 17
years since its from the beginning of
2000 all the way to the end of 2016 so
chances are a lot of these companies
have changed over time so this is just
meant to be a super simple example but
really you probably want to look deeper
into specific time periods along the way
rather than holistically like we're
about to with that let's get into it so
what we're going to say is we're going
to call this define the visual lines a
beta the F is going to be PD dot read
CSV and that CSV is going to be what we
do s stays perfect so from here we could
do something as simple as DF if we just
wanted to look at Apple for example DF
Apple stopped flying you to show and
then we could actually call this
function to run
PLT not front so apparently we have to
import it when we haven't no we haven't
Wow okay so we'll do that first let's go
ahead and import matplotlib high spot as
PLT from that plot live we're going to
import style and then we're also going
to style I use ggplot will make more
money if our graphs look good
great so here's our graph for Apple and
it's just you know we're able to access
our data cool so but that's not why we
combined all of our data not so that we
can plot individual graphs but instead
so we could actually compare them so I'm
gonna go ahead and just comment the
these lines out here all three if I
haven't said that yet
now everything is DF for equal gf core
and what we've just done is something
that I've honestly seen paid services do
so if you need some side capital or
whatever make a web a web app out of
this and you're welcome so this will
just create a correlation table of our
data frames so of all the columns in our
data frame it's going to look at all the
information compare the relationships to
all them and generate the correlation
values and select calculate correlation
yes
which is just incredible because going
to do it really fast - which is really
cool but anyway that's a good about data
now that would normally be a lot of work
for us to write that out so now we're
going to do is we've got that and we can
actually do DF or head just to kind of
see what we're dealing with at this
point I think so good real so as you can
see of course you know the companies
specifically are correlated to
themselves but then we get all the other
correlation numbers from all of the
companies I don't see anything most of
these are pretty positive but you can
see here some negative correlations here
obviously a EES is fairly weakly
correlated at least to these first few
companies but I'll go ahead and say that
trend probably will continue they've got
over here some companies that are like
you know weakly positive correlated and
then X R X here is like almost neutral
so depending on what kind of an investor
you are you can kind of look at these so
if you're looking at something that's
going to be like mean reversion or
something like that you would get two
companies that are highly correlated and
once one of them starts to deviate you
can invest in one in short the other one
and then eventually they come back
together or some that are like
negatively correlated if they're both
going in one direction again invest one
short the other and then you've got
they're situations like like neutrally
correlated like if you're just truly an
investor and you want to be properly
diversified you should invest in non
correlation correlated stocks
so anyways that's a correlation data but
we're going to take it a step further
we're going to visualize it so now we're
going to do is we're going to first say
data is equal to DF underscore core
values so again that just gets the inner
values of our data frames so it's not
going to give us the index and the
headers it's just going to give us that
inside it's a numpy array of the columns
and rows so we've got the inner data now
and then we're going to define
specifiers figure which will be PLT dot
here and now we're going to do is define
our axes we'll say x equals fig add
underscores subplot we're just going to
one subplot so I'm going to do the whole
subplot to Grid stuff just the record
this means it's a one by one and it's
plot number one you can also do this
which I think makes a little more sense
it's kind of silly
I think it's legacy that this worked but
this makes more sense it's put there
like parameters so well I guess I'll
leave it like that for now
now Renu is defined heat maps so heat
map equals a X dot P colors which is
going to allow us to just kind of like
plot some colors now we're going to pass
data here and then for our C map we're
going to say P LTCM
and this is going to be all krd ylg and
note the caps capital R Oh Lord is d
Capital y so it's red yellow green so
this C map is a range from red to yellow
as neutral to green as positive so it's
going to be a heat map of those now
we're going to say fig dots color bar
keep this will just kind of give us like
a legend it's just going to be a color
bar that kind of depicts our ranges now
we're going to actually set up the graph
so we're going to say ax dot set X tip
and these will be I don't think we have
known by all have to get this in a
second through my a ring
data shape one then it'll be plus 0.5 I
will explain this uno momento
and then we're going to do the exact
same thing one more time for y and
actually let's see data shape now look
this we go okay so let me check to see
if we've got numpy which we do not and
for my is NP coming back down so what
we're doing here is we're just like
setting our ticks so in this case we
want we're going to take sorry data
sheet x2 yeah like we're pretty sure we
actually want to flip these it won't
actually matter because our data shape
should be identical but I'm pretty sure
those should be flipped some things feel
free to correct me from from anyway like
I said it won't matter in this exact
example but we want to be able to write
a heat map that could be used in other
scenarios anyway first now what we've
done here basically is it's just setting
a little ticks because we're basically
building this graph like the previous
graphs that we've made we've been able
to just kind of throw data at it and
knows what to do but in the case of a
heat map there is no official heat map
so this is how we do it so first we take
the colors and they're just going to
plot these colors and it's going to be
on a grid but then we want to have like
little ticks that we can mark and say
okay which you know where'd are the
companies like lined up but then also
we're going to add our company labels as
well so what we're doing here is we're
just arranging ticks at every kind of
half mark so at not the full one but at
like 1.5 there will be a tick and then
then at 2.5 there will be a tick mark
just and this is literally just like a
tick mark it'll make more sense I think
let me see it now we're going to do a X
dot invert y-axis and we're going to do
this just because there's always going
to be a little bit of a gap at the
of a matplotlib graph and in most cases
that makes sense but in this case it is
not now we're going to say a X dot X
axes dot tick underscore top again this
will move the x-axis ticks from being
normally at the bottom of a chart it
just puts them on top because in the
case of this it's meant to be more like
a table so it makes more sense for the X
axes to be depicted on top and the y
axis to depict deep it be depicted on
the side yet not have some random gap at
the top so we're just kind of doing that
to compensate for what otherwise are
pretty good defaults format plot lives
but in this case there's a name sense
now column underscore labels will be DF
DF underscores whole core columns and
then we're going to have our row labels
those will be DF chord in X now again in
this case these should be identical
because this is a pure correlation table
and it's just like all the stocks
compared to each other so both of these
lists ought to be identical that's why
data that shape did not matter it should
be you know like 505 by 505 so it
shouldn't matter here but this makes I
do it should be the X and then the Y I'm
not going to spend too much time thing
on this because I might actually might
not actually be the case because it
might be with height and then the other
one height would anyway sorry
so the next thing so we've got column
labels row labels now already we're
going to say ax dot set underscore X
tick labels we're going to cut loose
we're going to call those column labels
ax dot set Y tick labels we're going to
call those the row labels by default X
labels will be like horizontal we want
them to actually verticals so they're
not so squished up we're all it's
already going to be way too squished but
this should help so we're going to say
PLT x ticks rotation equals 90 so it's
going to be a 90 degree rotation keep
map dot set see Lim
negative one to one so what this is
going to do is it it's basically the
limit of these colors of this basically
this heat map it's just the color limit
so negative one is maximum and then
positive 1 and negative 1 is the minimum
and then positive 1 is the maximum so in
many cases like in this one we've got
enough data to where we probably
actually do have data that's dispersed
between negative 1 and positive 1 but we
definitely will have positive ones but I
don't think we have any perfect negative
correlations that would be really weird
so but in reality this is the scale that
we want we actually want this full-scale
sometimes you'll want a relative scale
but yeah in this case you don't but if
you were doing like covariance you you
wouldn't bound the scale you you simply
wouldn't have this you would let
covariance run its course
so anyway PLT don't type layout this
just kind of clean things up a little
bit hopefully so this is already gonna
be a pretty messy graph and then tail CX
show and then we're ready to run this so
let's go ahead and copy me and this
might take a while oh we already call it
I'm trying to think your Riccio see you
you could maybe shorten the columns here
or maybe if you already had shortened
when we pulled from Yahoo I don't know
this is going to get a huge graph I'm
just warning you so if you're on like a
netbook or something like that this is
going to be slow mostly the graph itself
when you pull the graphs it's going to
get huge graph so long as we don't have
an error we fruit
call labels that doesn't look Thai code
blue must have typos something else
let's see calmly please sure enough we
typo the original labels all right let's
try again that took a while to get to
that error it's not frustrating
with red will say it came up let's see
here we go beautiful yes I think it has
a huge chart all the data is there just
you can't see it very well let's see if
I can make it at least pretty big for
the video so yeah as you can see it Ziva
it's lagging on my computer and I've got
a pretty decent this is running on your
CPU so that's why it's pretty slow but
anyways you can click on the zoom and
like this little magnifying glass but
I'll let you zoom in so like let's just
zoom into like here you can pick
whatever you want but I'm going to zoom
into here so here you can see okay we've
now we've got a pretty strong kind of
representation so we can see like NWSA
which is News Corp I think is negatively
correlated pretty strongly and like when
we were fully zoomed out so if you want
to go back to the previous you can hit
this back arrow also you can go you can
click the home to go back home and I'll
hit the back arrow what we zoomed in to
is like this you can kind of see it when
you're zoomed out there's like a strong
line here and there's one here same
company actually Sony wheezes into that
spot so you can see it's very negative
pretty much all the way through and so
it's this line as well again it's the
same exact company where they intersect
it's the same anyway let's go NWS a and
then I know it was it anyway so we can
see like we've got a lot of correlation
here most of this table we can tell when
we look at the home is predominantly
green but we have a few very strong
negative correlations now of course
you're too careful
some of the negative correlations might
be companies that like legit just go out
of business or something so you do want
to be careful about those companies but
then it's my thing is like I like to you
know look at the totally looks like
neutral companies that are just yellow
like like m/s is Morgan Stanley I think
is pretty neutral to everybody which is
kind of strange so as a bank I wish we I
don't know if we'll find Bank of America
or something on here or JP Morgan let C
be varied Bank of America surely Bank of
America's in the S&amp;amp;P 500
I'm just not seeing it this would be Bo
here is fake Bank of America is Wes this
on this so far list let's scroll see if
we can control this so Bank of America
is also relatively either neutral or
even negative with a lot of companies
that's interesting I never knew banks to
be pretty neutrally correlated but
apparently I'm lost now we've dragged so
much but yet still neutral nursing yeah
cool okay so so there's definitely
relationships here we could go to play
with just looking on this graph all day
and I'm sure if you want to do that you
can just do that yourself you shouldn't
do that with me so what we're going to
do now is since we see that there are
definitely some relationships here the
question is can we code something in our
on our computer that will just you know
find sort of relationships like these
closely correlations just one possible
relationship so what we're going to do
is we're going to dive into creating
features and labels and see if we can't
apply some machine learning to this to
see if we can't at least get a slight
edge so that's what we're going to be
working on the next few tutorials of
turning this into features and labels
and feeding a through machine learning
classifier to see if we can figure out
anything interesting so that's what you
guys have to look forward to if you have
any questions comments concerns whatever
feel free to leave below otherwise I
will see you in the next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>