<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python and Pandas for Sentiment Analysis and Investing 6 - Basics for a Strategy | Coder Coacher - Coaching Coders</title><meta content="Python and Pandas for Sentiment Analysis and Investing 6 - Basics for a Strategy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/sentdex/">sentdex</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python and Pandas for Sentiment Analysis and Investing 6 - Basics for a Strategy</b></h2><h5 class="post__date">2014-05-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FT1oUKefDhs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what is going on everybody welcome to
another tutorial video in this video
what we're doing is just building on
what we've been working on and that is
using pandas to do some data analysis
and modeling with our sentiment analysis
data set and then we actually want to
formulate a strategy the best strategy
or the e I guess the easy strategy right
out of the gate would be to work with
some sort of moving average crossover of
the sentiment valuation so the sentiment
that we get is just a raw sentiment
value so really early on we plotted a
500 moving average okay and we're kind
of happy with that 500 moving average
but it's really hard for us to calculate
you know programming programming wise
whether or not that's an increasing
trend decreasing trend how strong is
that trend and so on so we can use
moving averages to sort of do that it's
a crude way of doing it but it's decent
enough so to start I say that we do
based on moving average crossover so the
easiest way is to have four moving
averages and depending on where each of
those moving averages is at the time
that's a strength okay now this presents
a problem right out of the gate for us
the default data that we have in this
file is 100 250 500 5,000 now for most
stocks something around there is about
right that's about what we want to use
but for still many stocks that's not
right so the best way to think of this
is a company like Apple so Apple has a
lot of updates every day so 100 250 500
5,000 is actually not large enough
moving averages to accommodate a company
that's talked about as often as Apple
same with Google something like that and
then we have other companies like let's
say trying to think of a good example of
something that's not talked about too
often but I don't know like like Arch
Coal or something you know a CI that
company isn't talked about as often as
something like Google or Apple or even
if some as often is something like
Groupon or Bank of America or something
like this where you know these companies
fit very nicely in the 100 250 500 5
so with that in mind I thought well
since for example Bank of America is a
decent company that fits in we can use
Bank of America as a sort of guiding
stock okay so what I was thinking we
could do is we can generate a sort of
dynamic moving average based on the
number of updates a stock gets so that's
what we're gonna be doing so let's go
ahead and get into how we're gonna do
that so first of all we have outlier
fixing here from the last video I'm just
gonna not call it that function we can
leave that there just for kicks later on
but I'm not gonna call it now we have
single stock we could leave that there
as well but I'm actually going to go
ahead and just delete this entire
function because we'll never use that I
won't use it again if you want to save
it for you know reference later go ahead
so delete so let's make some space here
and actually let's make some more space
so it's using the window properly and so
we're gonna define single stock Auto M a
kind of a long function name but the
fine is kind of what we're doing here
and then we can do stock underscore name
and now we can begin to work on this
function so to start how we price
shouldn't gotten rid of that data right
away but we'll just I guess we can copy
it from here so we're gonna go up to
outlier fixing we're gonna take the
whole stock name lower part and the
whole you know what data are we grabbing
just copy that come down here paste so
now we have that data now what we want
to do is we said we're gonna use Bank of
America as an example so what we can do
here is we could say count equals DF
type
die value accounts and then
we can do count equals in town stock
name and actually we would only have one
value count so I guess we didn't really
even need to do that but anyway let's go
ahead and print count just to see it so
we'll copy this paste it here and we'll
say the stock we want to do is bang from
America cuz we said that was the the
guiding one that we wanted to work with
so let's go ahead and run that and we'll
wait a moment and whenever it's done
it'll print the count and then what
we'll do is since we say we liked 100
250 500 5000 for a company like Bank of
America we'll use that as a guiding
factor so before while we're waiting on
this the reason why we don't necessarily
okay we got the answer what happens a
lot of times whenever people back test
and test a strategy is they know kind of
what they want to do but they're not
sure about the exact value so we can use
back testing and computers to get
fineness like the perfect value okay and
we might do that later on but the
problem is we could back test and use
our computer to find the perfect value
or every stock now we don't want to do
that because that's data snooping and
that's bad because if you want your
computer to find the perfect answer for
you the computer will it's very simple
to find the perfect answer but the
problem with this is that's only the
perfect answer for that exact data set
but then when you start to branch out
it's almost always the not the perfect
answer and it's kind of a bad practice
to do that so what the best thing that
we can do is we can either we can start
with our assumption that 100 250 500
5,000 is a good for Bank of America
numbers and if that doesn't work out
very well what we can do is we could
take Bank of America we can find the
perfect numbers for Bank of America and
then we can apply this to the rest of
the companies and by that I mean what
we're gonna do is we're gonna take 12
mmm excuse me we're gonna take 27,000
629 we're going to assume that 100 250
500 5000 are good moving averages
Bank of America so what we do is we can
take let me pull up a calculator here at
sea here we can take 27 629 and we can
ask well let's say for a 100 moving
average we can divide that by 100 and we
get 276 29 okay so well that was stupid
I can't believe I even did that math but
anyways we get 276 points to nine so
again we could do 276 29 and then for
250 we divided by 250 and we see okay
about 110 okay so the way that we can
work with this was we can say and then
come down here and make some space here
and we can say for example ma 1 equals
we don't need to print count anymore
okay so ma 1 equals P d dot rolling
underscore mean and what do we want to
do that to we want to do it to do value
and we're gonna do the actual moving
average here will be pound divided
behind that first numbers 276 let's do
too soon o'clock right so / - 275
okay so that'll produce the moving
average the 100 ma based on the number
of updates this company gets okay so
count now and this will be dynamic for
every stock right because every stock
will have a different number of updates
okay so this will be kind of like the
perfect so to speak at least that work
we're gonna put this we're gonna make up
our own value so we don't have any sort
of data bias here that we've kind of
generated to bio-data snooping but again
I down the road it might make sense to
perform some data snooping on Bank of
America and then apply it to the rest of
the stocks without doing it on the rest
of the stocks and that pretty much
leaves us without any major bias but for
now let's just start with this so now ma
to PT dot roll it was PT dot rolling
underscore mean
d/f value or totally copy-and-paste next
time I'm typing all this out
and count and then this one was 110 okay
and now let's just copy and paste this
twice so we don't have to write that
again paste paste MA - ma 3 ma 4 and now
we come back over here and what was our
County game 27 629 so so 27 629 divided
by 500 was 55 and then let's just do it
again 27 629 divided by five thousand
five point five okay so we come back
over here this will be divided by 55 and
this will be divided by five point five
now because we're using a decimal here
and keep in mind we're in Python to
seven so count count will always be a
full number right it's gonna be a whole
number so these will generate this will
generate a whole number this will
generate a whole number this will
generate a whole number this is gonna
generate a decimal for us so in Python
to seven just keep in mind this is going
to give it give us a decimal if you were
trying to do this tutorial in Python 3
and you're just converting what you need
to keep in mind that all of these will
produce a decimal and you might want to
round that decimal because we're going
to use a label later on I'll talk about
this again in a moment where you use
labeling and on your graph you might at
least want it you know it doesn't matter
if the moving averages a decimal behind
the scenes but as far as when you plot
up on the label you're gonna want to cut
that decimal a little bit otherwise it's
gonna take the whole screen so anyways
moving on let's go ahead and plot this
so we're gonna say a x1 equals PLT dot
sub plot and this is gonna be a two by
one by one and I'm sorry to buy one plot
number one I always say that and then DF
close fly and then we're gonna call this
label equals price
good enough that's gonna plot up our
price or stock price on the top chart on
the bottom chart let's plot the
sentiment so let's say ax 2 equals P Ltd
sub y again it's gonna be a 2 by 1 this
time it's gonna chart number 2 and what
are we planning here what we're gonna do
ma 1 dot plot label equals and in this
case we need to translate this to a
string so we're gonna say label equals 2
parentheses there string and then count
/ - 75 + ma so basically it's gonna say
whatever that division is + ma now again
if you're on Python 3 you're gonna want
to actually do what we're about to do
for the MA for but we'll get to that in
just a moment so let me copy this copy
that paste paste paste ma 2 3 &amp;amp; 4 now
this was divided by 2 75 this is divided
by 110 55 and 5.5 now what we're gonna
want to do for this one is the string
version of round count and in fact it's
round count 5 point 5 comma 1 close the
brackets close these brackets
Plus MA okay so if we didn't add this
rounding function it would be like when
we do the label you'd have a bunch of
decimals on the label and we don't
really care for all those tens moles but
we still want the 5.5 to be a real
division there because we actually cause
5.5 the difference of five point five
and six is actually a pretty significant
difference right so we're talking about
you know not 10% but almost 10% change
so anyway that's that now let's go ahead
and do PLT legend and we're gonna have
to do that legend up here on top as well
and PLT - oh and that should be it so
let's go ahead and run that and see what
we get here so again if you're on Python
3 while we're waiting you were on Python
3 this whole function here plotting
label string round needs to be applied
everywhere because python 3 actually
uses what we would expect for division
and it will create decimals out of all
of these and we capitalize pd somewhere
what do we do oh we did it up here
dummies okay PD Laura Hayes PD 4 3 &amp;amp; 4
we capitalized that Python actually we
haven't gotten to the plot so Python
probably won't yell at me
so basically what we're testing here is
we're just seeing that we can generate
an automatic moving average because
later on when we start developing the to
develop a strategy based on that moving
average we want to know that we have a
decent moving average for all the
companies so because we've already kind
of agreed that all one just a flat 100
250 500 5000 is actually kind of
inaccurate so we don't want to do that
okay so we generated a relative this is
Bank of America so this was our kind of
baseline here so we have a 100 a 251 a
502 and a 5000 and 23 moving average
good enough so we can kind of zoom in to
a specific spot here oh we didn't share
axis what a big dummy let's add that
really quick comma share X with a X 1
let's run that one more time and then
well after we run it on Bank of America
let's do a test on let's do Apple next
cuz Apple should have much larger moving
average requirements
so we'll do Apple next make sure it's
doing kind of a dynamic moving average
and then from there we'll translate this
to to our strategy so we'll develop a
strategy based on the dynamic moving
average so basically to be like if ma 1
is greater than ma 2 is greater than na
3 and so on okay then when we zoom in to
a specific area okay much better okay so
we can see here that were at least
somewhat interested in seeing further
Bank of America just simply based on the
fact that you know this run up here was
predicted the drop was good and then
we've got here and then the slowing down
was decent and predicted there so okay
so we're happy there
okay so now let's plot up Apple real
quick and see the difference Apple or
even Google I'm curious to see Google
actually sweet I used to be really happy
with the Google charts so mind seeing
Google as well so a plot of Apple Apple
have a lot more plots but it our dynamic
moving average should be much larger for
Apple yet still be somewhat accurate as
far as changing right so we want to want
to use larger moving averages for stocks
that are updated less frequently because
obviously the moving average in any sort
of reaction to sentiment would be very
slow on a company like Bank of America
if we use the same moving averages for
Bank of America as we did for our other
companies right so Apple is starting
with almost a thousand moving average at
twenty five hundred five thousand and
then 50 thousand okay which makes sense
for again for Apple but it wouldn't make
sense at all to do this to like Bank of
America okay so here's our sentiment
readings for Apple the other thing is as
we go forward we're kind of ignoring
what the actual sentiment reading is
right
so for Apple for a brief time we
actually started getting into negative
sentiment overall and that was at a time
when Yash or Apple was at its you know
saddest moments okay and then now we're
starting we get up almost into the fives
and we did for a short term anyways but
then it kind of has dropped down a
little bit and then maybe starts to go
back up but as we can see Apple price
yeah kind of had to run up right here
and then we saw a price go up but then
now we're kind of dropping down okay so
that was a Apple and then we can try
again for Google just curious to see so
our first strategy I think that we're
going to develop it's just going to be
the moving averages okay so we're just
gonna look at moving average crossover
and this is going to ignore what the
price is at the time so it'll buy kind
of blind to price and it's also going to
ignore what the actual sentiment reading
is we're only gonna look at the trend
for now but eventually we're going to
want to dive deeper into what is the
price at the moment but then also we're
gonna want
look at what is the actual sentiment
reading so are we in the negatives right
now are we in the positives so here's
our Google chart that kind of bigger
scoot over a little bit hopefully we're
not running into my face and so actually
Google has less updates than Apple we
already kind of knew that and sure
enough here's where the peak of
sentiment was and it starts kind of
dropping down and sure enough price for
Google did drop down so I'm pretty happy
with this chart as well and we'd be
curious to make a trading strategy based
on that and we can see again for Google
it started off at 2:00 was doing pretty
good starts dropping down did pass 0 for
a little bit and that was indeed kind of
a slump for Google and then really we
haven't come near the negatives at all
since then so anyway it'll be
interesting to see that and then also
again based on on the Senate reading so
it'd be kind of cool to say like okay
well let's take a stock and only buy
stocks that are in positives for example
or only buy stocks that are positive you
know three let's say so if the average
sentiment for you know the I guess
short-term moving averages so let's say
moving average one two and three if
moving average one two and three are
above four by that company right and so
we could do that across all the
companies and see you know maybe these
are the companies that show you know
monumental change so that'll probably be
the second strategy that we test after
the moving average crossovers and then
after that maybe we'll make a meshing of
all of them so anyways this hour can
generate a dynamic moving average the
other thing we might want to look at is
starting point so I've already closed
the chart but if you had your soap and
you would see that you know these other
smaller moving averages start but the
largest moving average doesn't start
until maybe you know a fifth of the way
through the chart already so we'd want
to chop all that data off and not
consider that data okay so anyways
that's going to conclude this video
getting kind of long but I did want to
show at least how we are going to
generate our dynamic moving average and
then talk about kind of how we're going
to base a strategy off of that and then
also maybe some future strategy based
just purely on that sentiment reading so
anyways that's going to conclude this
video if you have any questions or
comments feel free to leave those in the
section below as always thanks for
watching thanks for all the support and
subscriptions and until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>