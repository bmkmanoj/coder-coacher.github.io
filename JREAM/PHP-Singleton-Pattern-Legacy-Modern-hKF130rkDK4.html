<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Singleton Pattern - Legacy &amp; Modern | Coder Coacher - Coaching Coders</title><meta content="PHP Singleton Pattern - Legacy &amp; Modern - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Singleton Pattern - Legacy &amp; Modern</b></h2><h5 class="post__date">2016-06-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hKF130rkDK4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up youtubers I'll just listen
to Justin Bieber to feel good in my
heart with his new music I kind of enjoy
it I'm working on a little repository
called design patterns and I'm trying to
make it as simple as possible so you can
understand it it's a github slash dream
jRD a.m. and just look for design
patterns so what I want to talk about is
the singleton because this pattern is
the easiest to understand one of the
easiest and basically I just wrote a dot
block up here and to keep it as simple
as possible when I'm doing these I'm
avoiding interfaces if I can and
avoiding abstract forcing functions
unless it's required the reason is
because even though I would normally do
that it makes it a little harder to
understand the pattern if you're new to
it so the singleton legacy is the way
you would do Singleton's before PHP had
what's called late static binding and so
this is how I started when I first
learned it so I just created a class
called singleton legacy I'm calling the
classes the name of the pattern now
singleton legacy isn't really a pattern
it's just the older way of doing it and
I want you didn't make sure you know how
so you'll see the difference and I'm
gonna try to keep it simple so well the
singleton we only want one instance of
an object so if we had a public whoops
public function construct now if I
wanted a let's say a user equals new
singleton legacy right the problem is I
could do this and I have three of them
well let's do databases that might make
more sense
right so I could have if this was
actually called database pretend right
if we had a wrapper for it then I could
create a bunch of instances that would
create more connections then it gets
confusing so what I would do is not
allow this
so the construct should be private okay
so now all this is gonna break because
you're not allowed to do that so up here
I have a terminal on my left I'll say
PHP singleton legacy okay and it says
hey you can't call that alright and
that's what we want so that's good and
in here just to show you I'm just gonna
say echo class created okay whoops I
don't like to echo you always want to
return stuff okay and what we need to do
is we're not going to use a construct so
we're gonna do a public static function
and oops I need to give that a name you
could do something like in it or get
instance I would just I'll just do get
instance I think seems good and what
we'll do is we need to set a flag has
this class been constructed or no now we
can use a true or false a boolean but
really we want to store the instance of
this class within itself it sounds crazy
so I'm gonna say private static instance
okay and I'll just set the default to
false okay so when in the construct
let's put a comment here this stores the
only instance of this class all right
and this will be boolean or object okay
and then here this is how we get our
single instance okay and this will
return an object okay
I usually like to put it interline under
these okay and then this called
internally but must be protected or
private the other thing we want to do
before I get into how we do the instance
is a private function clone okay and
just make it empty so don't allow close
of this object because that would defeat
the purpose and then we're also going to
do one for wake up and don't allow
serialization of this object so they
can't try to create something out of it
okay so pretty basic and they get
instance would be if self instance
equals false we're gonna say self
instance equals new class all right let
me do I have to doing a variable so
class equals class that magic method new
class alright so the class all this does
is it references this you say well why
don't you just type singleton legacy
here like that because if I change the
class name to like it what it really
would be in this example it be database
then I'd have to change this this if I
made a bunch of these that I have to
change them in two places rather than
one okay so this creates the instance
and it assigns it to the static variable
okay so now we have our instance so if
the there it's false then it's going to
create a new instance okay otherwise we
just return self instance okay now we
can put these are optional if you have
no arguments for a new class okay and in
here I'll just say if we have no
instance great one
and here I'll say if we have an instance
return it so what's going to happen is I
don't have else statements because it's
a waste of space so if there's no
instance we created and we return it
right if there is if there is an
instance it's just going to skip this
block and return self instance ok so
down here let me delete some of these
instead doing this I'll say get instance
ok and I'm going to do a print R of this
database and I'll run it and it's a
singleton legacy object now for fun
let's just make a function I like the
the magic methods to be at the bottom
but the construct at the top so I'll
just put them here so say public
function set name right how about this
would actually be something like I know
set connection
and this would be like DSN let's just
pretend I'll say this TS son equals DSN
whoops set DSN okay now we'll do another
one public function get DSN and will
return this yes okay
so right here I'm just gonna put example
method not part of the pattern okay and
the per am here will just be let's just
this string and I'll just copy this guy
and paste them here okay so we have a
DSN we need to set a public variable up
at the top are protected because if
we're using getters and setters there's
no reason not to have it protected
because if you have public DSN then you
could just access it publicly so I'm
just trying to give you a kind of an
example so I'll just say protected DSN
you could do private if you want so down
here I'll go down down down down oops
it's lagging a little bit so I'll say
data base set DSN I'll just say MySQL
slash slash I don't want to set the
whole thing but like that right and then
database get DSN remember just please
remember this would be per class on a
per class basis this legacy way of doing
it so if this was called database you
would do it like that the class name
okay
and then I can echo this I'll do dot PHP
Yoel end of line okay so let's go ahead
and run it okay so that works now let's
do this database two equals because
we're forced to use this get instance
method so database to set DSN of let's
just say Postgres alright then we'll do
the same thing here and to okay just
remember all of these have the number to
buy them for this example okay yeah I
got up alright so if I run this alright
so we'll get my sequel and Postgres what
I'm gonna do is now that go out database
just a regular one and get the DSN so
what's gonna happen is Postgres should
be changing the actual database object
you see so even though I did an instance
of database - it's still changing it for
just the one instance of this entire
class and that's what the old-school
singleton is the only problem is you
have to do that for every single class
you want a singleton on so with that let
me just make a comment
making a getting the instance again will
only change but will still use the same
instance okay
so I can go ahead and do that other over
to this alright so that's how that works
um in this code will be on github and
now let's go to the singleton pattern
the better way to do it I'll just copy
this and go to singleton dot PHP okay
and this only allows you to have one
instance of a class and I can just leave
those comments there and I'll just get
rid of this and call it singleton no
we're kind of kind of do the same thing
where we have private static instance
okay so I'll copy this over like this
now you could obviously set this to just
nothing like that to check it if you
want it you can do it however you want
and then let's see what else we did
we're gonna use the same get instance
but we're going to modify it a little
bit so we can go ahead and copy this
block of code okay I like to me some
comments and then let's go down and
let's just copy all of this crap okay
all right the only thing I'm gonna do is
get rid of the set DSN stuff so that
this is only a singleton pattern right
so the construct really could just be
pretty it has to be protected and I'll
show you why because we're going to use
the single what's going to happen is
we're gonna make a new object that
extends the singleton pattern and we
want it deconstructed be protected so
that it can it can call the method from
the singleton parent this sounds really
confusing but it'll make sense must be
protected actually we don't even want
them to tal this don't allow the new
class construct okay
so here if the instance is false what
we're going we can return the self
instance instead of this we just return
them
return self instance yes because that
was sort of the instance and that's the
the difference between this is going to
be that the instance is going to use
lake static bindings so return new
static okay
and you can look up on the PHP Docs on
what the heck this is okay so to get the
instance this is late static binding
allows pattern to be reused so perhaps
in the notes is the modern way allows
you to define singleton once okay moving
on that's all we do let me check my
notes okay and that's it so what will it
do from there is make a new class so
I'll say class user now we're talking
about databases also class database
extends singleton alright
whoops so if we had a database like this
and I'll just do a public function act I
could copy the get DSN stuff
right here
okay I'll say protected DSN okay I'll
just put this is in example class which
we uses the singleton pattern okay
reuses
so the difference is remember in our
first one if this was our database
object here
you remember call it database for
pretend like that we define all the
methods within the actual pattern itself
because they didn't have late static
binding back in back yonder so with a
new way with returning this were allowed
to extend the singleton class and then
we constructed the same way so since
it's extending singleton and we have a
protected construct I might even make
this private if I didn't new database no
that wouldn't let me because this this
won't overwrite this so we don't want to
have constructs in here okay and then
let's go ahead and go down and we'll
make example let me make sure I have
this on the way to see one okay
okay so for example we would say data
blips database equals new oh we can't do
that sorry database equals on database
get instance database set DSN to Jessie
but we're sorry
MySQL I must be in love with myself if I
keep writing my name and then we'll do
the get DSN I fill that out
PHP EOL and I'm gonna try to run this so
all we did is that we created the
database which extends singleton so it
inherits its methods so it's an it's
inheriting the pattern right of the get
instance sorry if I move slow but I
don't know how hard this is might be for
people I'm trying to make it
understandable so I'll say PHP singleton
dot PHP and set DSN
protected DSN cult a member set dissing
on boolean alright so let me just above
this I'm going to do print R of database
and let me die because I got a fatal
error see what happens
okay so database is not giving us
anything so this extends singleton hmm
that's kind of interesting I didn't
think about this
because if I make a new single so the
question is is this even getting called
so let me just do echo 1 dot php' make
it a little easier to read I'll go a
bunch of one okay so let's run it so
that is not extending properly so it
looks like we got to do the parent
construct so this I believe
so public function struck that doesn't
make any sense
let me pause the video and double-check
hold on
yeah I'm back um this doesn't make sense
actually at all to construct so this
extends singleton database and class
singleton is right there so public
static get instance so when we do a
database it should set the child class
because what this static does Oh returns
self wait
I'm retarded self instance has to be
something else it's because uh the new
static so if it's false we create the
new static there and self instance
equals new static and then we were
little returns self instance okay so
without an instance we create the new
guy and what this does like I said a
moment ago it will create the class it's
called from okay I'm gonna try to run an
apple pie right there we go boom
all right so there we go so class isn't
even used here we can get rid of that
I'll go down a little bit
okay so there's that example there and
here we're going to kind of try to test
out the same thing so boom boom boom and
sorry for the long video but let's make
a database two equals we'll just copy
all this stuff and I'm gonna top you a
note that I had from here okay alright
so this I'll just called database to
database to database to I'll change this
to Postgres and then I will also echo
just a regular database okay it might
make more sense if I just changes to foo
right so it's easier to read okay I'll
do that for the other one - sorry let me
just do it because database to database
- I'll call it foo okay
and let's go ahead and run this and you
see that even if we change foo it's
really changing database get DSN so so
you would do now in this which is the
better way to do it is just have a class
like this where whatever you're doing it
just extends singleton and you're good
to go now I will upload this to github
these changes so let me clear okay git
commit dash em YouTube recorded it but
it might change a little more later all
right now get push
so my commit if i go here i was reading
the design patterns to try to get it
right
singleton legacy so what's a competin
umbers so if you're really curious the
hours that commits design patterns
commits how can I not see it right there
all right so it's this one if you ever
want it to look at it you could just go
to the Browse the code at this point in
the repository which would take you here
in case I change it later a little bit
like because I like to format stuff when
I get time because I'm picky and then
you just go to the singleton here and it
would have the code that we all wrote
okay thanks for watching guys if you
made it this far in the video could you
leave a message that said I survived
this video because I don't I don't think
many people are gonna watch it this long
alright thanks bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>