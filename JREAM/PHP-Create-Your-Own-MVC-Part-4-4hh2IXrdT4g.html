<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP: Create Your Own MVC (Part 4) | Coder Coacher - Coaching Coders</title><meta content="PHP: Create Your Own MVC (Part 4) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP: Create Your Own MVC (Part 4)</b></h2><h5 class="post__date">2011-08-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4hh2IXrdT4g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up this will be MVC part
4 and this is kind of a structural
tutorial where you're learning more so
how it works and a way to go about it
rather than a all-in-one start to finish
system to make it perfect so keep that
in mind
I've been busy at the old grinding stone
so sorry for my lack of tutorials to
start today I'm going to show you how to
include JavaScript files for each
individual section so index help and
dashboard also I'm going to start at the
dashboard oops let me log in real quick
and in the dashboard so first thing
we're going to do is open the dashboard
controller and what I'm going to do is
set a JavaScript variable to the view so
this view j/s equals array okay and save
that and then I'm going to open my
header file in the view which is down
here under views and up here I'm going
to do a little PHP command to say if is
set this is then we're going to loop
through the JavaScript and this remember
is we're inside the view now from the
controller it doesn't have the word view
in it so I'll say echo one just to make
sure it knows it's being set refresh and
we have a 1 up there looks good and what
we want to do is include all the
JavaScript files we tell it to in the
controller well see Daisy okay so I'll
start with my double quotes paste this
in there and what I can do is get rid of
some of this stuff I want that URL
constant in there and I guess I'll get
rid of this
and I'll do dollar oops
J s here dot dot okay
and what I'm going to do is a loop so
I'll say for each this J s as J s whoops
there we go and let's add a javascript
file now you'll notice down in my views
already added a folder called J s and a
file called default J s so in my array I
could put default / j s or sorry that
would be a dash board / j / default j s
and over here I actually have to change
the URL to fuse okay go ahead and
refresh and cool we get an alert 1 if
you don't get an alert 1 don't worry
this is all I put in my default
JavaScript file the reason I did this is
because now we can have independent
JavaScript files to only apply to each
controller so you know you could have a
lot of them for the dashboard and that's
a lot better rather than having them all
in like this custom dot J's file because
this could get large so now it's
dedicated to only this area cool
so now that we have some custom
JavaScript I'm actually going to do an
ajax call and this might get a bit
confusing so I'll try to go slow what I
want to do is it's not really going to
be very useful but I'm going to create a
little form here to enter some data in
the database and this will give you an
idea if you wanted to do some Ajax stuff
so I can go ahead and close the header
file and where should I start
I'll start in the index.php file which
is the dashboard view and I'm going to
create a form and I'll just say input
type equals text name equals text I
guess and I guess we'll do an input
control shift down input type submit
save and we want to give this an action
and I'll say echo the URL of dashboard
slash and this is where naming
conventions could get tricky
depends how you want to do it if you
want to say like Ajax
before everything so you know that it's
an AJAX thing I'm just going to go with
whatever I can think of right now and
I'll say function xhr insert the reason
I'm calling it xhr is for xml
httprequest rather than ajax mm-hmm
they're kind of the same thing but you
know you can do asynchronous calls on
other servers so I'll call this xhr what
was that insert okay and the method will
be post okay so let me refresh that we
got our form there good and time to get
our hands dirty with a little bit of
jQuery I'm going to give this form an ID
and I'll say ID equals a random insert
okay so here I'm going to do a random
insert dot submit function and I'm going
to return false because I want the form
to be handled through JavaScript and not
refresh the page and then I'm going to
say this serialize of our data equals
this serialize and let's console log of
data if you don't follow what I'm doing
I got a ton of tutorials on jQuery I'm
basically going to serialize the form so
that it's a lot easier to post
Sallah open up Firebug light refresh and
I'll type test submit and you see how we
get post variables here if we had a
headed any differently I'd look a
a little different yeah yeah you get it
and what we're going to do is an AJAX
post so dollar post and the place we
want to post is actually the action and
that would be this dot um
attr for attribute and action because we
already set that so we can just use
whatever this is I'll call this URL so
I'm going to post the URL I'm going to
post the data and I'm going to have a
callback function I'll call that oh and
what I'm going to do is just alert one
for now to see if that does anything
refresh submit good and you can see we
post it to the server on this page and
it went all down to render the views
which is not what we wanted so back to
the dashboard in this xhr insert command
let's see what we have going on okay
what I'm going to do is call a model and
do I have that set in here this model
xhr insert okay
and I guess I'll make a new model and
I'll call this s board model and I can
copy all this junk over just from a
random model file I'll say dashboard
model and we had one called
xhr insert sorry about my uneven marks
here actually I'm not even using that
right now and I'm going to post a text
I'm going to echo that out okay let me
go back to the controller and this
should call it I don't know if we have
model set I can't exactly remember how
this system was wired might not have
that okay there it is VV cool and with
that we're going to insert into the
database so let me go to boy PHP myadmin
MVC and I'm just going to call this some
called or sorry I'm going to create a
new table called data with two fields
and the first one we'll just call it ID
in this one text I'll just make this 11
long this one will be var character 55
Auto increment it primary key you've
probably done this a hundred times
and
go looks safe okay and we're going to
insert into the data field from the
model and I don't remember off the top
of my head how the model was set up
sorry so let me take a peek at my libs
folder so I have database available so I
can use this DB I could say this DB and
let's see is this extending PDO let's
take a peek we're just using straight up
PDO it looks like so let's do that and
we're going to do a prepared statement
this DB prepare of insert into data
we're only going to set the text values
text okay
and we need to set that text value okay
I'm a little rusty on this because I
have abstracted PDO in the past quite a
bit so I'll say this DB execute and
we're basically just saying what are we
going to replace text with in that field
we use an array and I'll say text is
there text is going to be whatever they
typed in text whoops
dollar sign I'll save that and this is
just a test from so let's see what we
get
undefined property dashboard model dB
oops we need to do a parent construct in
here why because in the model you see we
have this available we want to construct
the base model so that we have database
available so parent construct let's try
again I can just repost it to this PHP
fatal error come call two undefined
method execute oh this is so
embarrassing this has to be a statement
so I'll say statement handler equals
that prepared and in the statement
handler we execute it so let's try that
submit
scroll down and post it looks like it
went good so let's check the database
data and there it is in there now
obviously you're going to want to
sanitize this text I might get into that
in another tutorial I might I might not
I don't know but this is just a quick
easy way to do Ajax calls well it might
not look so easy just yet what we're
going to do is make it so that whatever
we insert it's going to be immediately
posted down here and it's going to be
you know it's going to list
automatically so what I'm going to do is
a get when it loads and I'm going to
call these uh list inserts that's going
to be the Dom element where my inserts
are listed so div ID equals list inserts
I know these are generic and they don't
really mean anything but hey what else
can we do I can't think of what I should
make list inserts and we're going to do
a get call so get and I want to get it
from boy the URL of our site let's just
start with dashboard
and I guess this will be xhr cat I'll
call that xhr get listings
I know these names are kind of confusing
looking but the only reason I put xhr in
front of it is so that you know it's
different than just like a standard
method so in dashboard I'll do a
function called xhr get sorry I forgot
what it was called get listings that's
so embarrassing
so I'll say this model boom boom
kind of the same idea and we're going to
let our model do all the dirty work and
we're going to do this DD I think it's
query select all from data and this DB
fetch all and we're going to return that
kay and with our gap we're going to do a
function oh I'm going to pop a little
Tom after here because I like it in JSON
format okay I can get rid of the pop it
up here we'll use that in a minute so
let me refresh and make sure it's not
all broken call the undefined method DB
fetch all again I'm rusty with PDO again
we need to do us a statement
so this DB I guess I'll just do a
prepare prepare and I'll do return
statement that's all hope that works
don't know if it will or won't that
didn't get us anything so select all
from data well half the problem is I
need to echo this out because we're
doing it a little different so there and
we have an array great what we need to
do is return this in JSON format
remember how in the JavaScript we said
JSON JavaScript object notation so what
I'm going to do is JSON encode this this
is a built-in PHP function and I'll say
echo Jason encode data and I can refresh
this let's see if we get anything and
it's empty but it's a JSON data
so I wonder why that is empty I would
really like to know that maybe it's just
execute just try something
refresh okay I guess I have to call
execute of the floor hand weird so now
we have our json encoded data and i'll
go back to my default here and let me
see how it looks this is our data so
I'll copy that
I'll paste it up here so I can look at
it and we have one object right here ID
one I don't know what 0 1 means that's
weird
oh I see our fetch mode is fetching IDs
and a associative arrays okay I need to
set my PDO fetch mode so I'll do a s th
set fetch mode PDO and fetch there it is
associative because that's all I want
that should do the trick
refresh and there we go now we only have
the associative array values so I can
paste that and what I'm gonna do is
insert one more thing in the database so
I can see what it actually looks like
easier so let me just uh I'll just use
this form okay refresh and here's what I
have an array of objects okay so the
square brackets are array
and these squigglies are the objects so
what I will do is I'll say Oh see what
old gives us should give us JSON format
refresh okay good so ODOT ID would work
so let me do Oh
zero Dottie I think that's right so we
get one
how about text okay remember it's an
array of objects so I'm going to do a
loop and say for VAR i equals zero I is
less than length I plus plus simple for
loop and we're going to append inside of
this HTML list so say dot append of OH
dot
texts and I can get rid of this so I'll
go ahead and refresh that and huh there
goes it get called looks like my
JavaScript's a little broke list answers
let me do an alert make sure this is
working
refresh okay it's getting called call it
ghost twice which I'm not sure why
okay there it is having a problem let me
just try HTML refresh doesn't want to
cooperate okay sorry I forgot the array
number there refresh okay
and we can do an append instead so this
should be the good looking code right
here and although I don't refresh that
okay looks good I'm going to wrap these
in divs so that they're in their own
spots so div plus oops and plus it's
just the I don't know how to say this
word concoct ination it's like coq10 8
it's kind of like that basically like
the period in PHP it kind of does the
same thing that looks all good so I'll
go ahead and refresh that okay beautiful
and what we want to do is when we type
this in submit it will actually go in
the list so let me refresh you see how
it's there so what we'll do is we'll say
list inserts dot append and what we're
going to append will be first of all I
give let me do plus plus and end the div
and what goes in here is what matters so
what I shall do is look at what this
post is returning so let's do a post
submit good and we're getting nothing
back in the response so I'm going to
make a little response in the dashboard
model so what I'll do is just echo JSON
and code of text try again
submit boom-boom response and we get the
letter F cool so with that we can use Oh
oops
oh I just like to console.log it make
sure it's working boom boom
oops I got a refresh because I was
JavaScript and we'll get FFF great so
now we can just put in oh ok get rid of
this alert and I'm going to go ahead and
refresh and slide this down a little
hey there's hey looks like I had some
quotes around it I'm not gonna care
about that right now I want to get a
couple things done and what we're going
to do is put a a href goes to nowhere
and this is going to be a way to delete
them boom boom copy that up there and
these are going to need probably like
IDs based on a
be funny the thingy yeah that makes a
lot of sense okay here's the exes and
when we click those they're going to do
something and I'm going to give those a
class name and say class equals Dowell
just short for delete and we're going to
make a thing called
of dot del dot click function and first
of all we return false at the end so
that it doesn't go to the link and we're
going to call a function to delete this
stuff and what I'm going to do is set a
RAL tag in the HTML and inside the rel
tag I'm going to have an ID so boom boom
ODOT ID o dot txt now this isn't set yet
so hang tight back in the dashboard
model we're going to do data equals
array and text will be text and ID will
be a-ok
I think this is what this DB last insert
ID save that and I'm going to test this
out submit
we get a a a this was with the insert of
we got output data save refresh AAA post
and we get cool beautiful and let's see
what do we got here
undefined at the moment text is AAA and
ID
let me a console log this real quick too
solutely are console dot log oh and I'll
refresh that again and I got text and ID
so OH dot txt and OH dot ID should
should be working alert to Oh dot text
better refresh that once more boom
undefined say what
I'm echoed oh post this isn't in JSON
friendly format so just like the other
thing we're going to do comma Jason me
refresh try it again there it is boom
I'm so happy about that okay and we need
a rel thingy up here equals oh I dot I D
and when we get the listings that should
be populated so I'll refresh wonder why
it doesn't load all the time there let
me inspect this X for l equals one seven
you see down here we have exactly what
we want
and what we're going to do is when they
click delete we are going to pass the
event here and say a dot target or sorry
I'll just use this in this instance I'll
say this dot attribute of rel so that's
going to be our ID and let's say alert
ID let me refresh this
whoo that didn't work Dell click
function you know why I wonder class is
Dell click what's not doing anything
Dell dot click here's the reason sorry
I've been in prototype so much I get a
little rusty but the reason is is that
when we get this data this is being
observed before the data is even on the
page so what I'm going to do is pop this
inside of this get function okay just
let me get rid of that a little bit and
I think that should work
refresh click there's the ID there's the
ID and what we're going to do with that
is make it so that it deletes the ID and
we're going to do a post so you can go
ahead and copy your previous post call
okay boom and the URL I'm going to post
so I'm just going to do this the short
way and say dashboard xhr delete listing
so let me create a function in here
am I missing a bracket Oh function boom
boom boom boom and sth equals this DB
repair delete from data where ID equals
whoops
i D
they're got my things right I was do a
regular post of what was that called I
didn't give it a value yet I was call it
ID so we're going to post the ID pass it
in there and we should all be happy
so ID and when I post this should be a
JSON object I'll say ID equals ID now
you can imagine there's going to be a
conflict with these two words so for the
key I will hold it up and let me comment
that out a sec and I'm just going to do
an alert one oh we have to tie this
together with a controller method so
this model boom boom boom and make sure
this is safe refresh click flirt 1 let's
see ok the post was good and what we're
going to want to do is let me refresh
make sure that was deleted refresh it
doesn't look like it's getting deleted
just yet however there should be an
error if it weren't Oh
look all the IDS say 1 zette could be a
problem and why they says that you know
the rel is numbered this dot rel
where's that delete singing this dot
attribute where l-let me alert the ID
refresh so that should be three right
and it says one two and one
five and one
boy it's getting quickie um oh that's
why this alert here if that is so
embarrassing
oh alright we're almost done this video
is getting really long we're going a
little JavaScript crazy here let me see
where I am so these are inserted in
their own divs so when we delete a class
or sorry delete based on the ID we're
just going to remove that div so what
I'm going to do is I'm going to say I
actually have to assign of every well
say Adele item equals this so that we
can have it inside of here so I'll say
Dell item dot parent dot remove okay
refresh
boom-boom and it removes boom-boom
removes and refresh it's not actually
deleting from the database and I'm not
exactly certain just yet but I'll get to
the bottom of that so this all works
good let me make sure the numbers are
going right post of six post of five
good do you see how our IDs are all
different
five four good
and all we need to do now is delete
listing as two's DB prepare we did not
execute its th execute and refresh
delete boom okay so all these asdf
should be gone good so it works now
here's something interesting you might
see I say test okay it says test down
here try to delete it and I can't click
this say why the reason is we need to do
something called live and this is in
jQuery which is really cool so when we
do an insert what we're going to do is
change this to live and submit them and
that applies to observe handlers to it
while we create it
the problem is submit the problem is
that it doesn't want to listen that's
the problem
basically what's happening is it's not
being observed random insert live submit
okay sorry I had to pause the video the
problem is we need to apply live to the
click right here on the delete item so
I'll just say live dot click like that
I'll go ahead and refresh I'll say test
delete test good
get rid of that I'm going to get rid of
that alert also right now this Java
scripts a little sloppy I know I know
but it'll help you get a good groundwork
I know the model doesn't have a
verification and it's not the most
secure but again it's just a kind of
like a ground working for you and I know
these names are not the most attractive
things you've ever seen but I hope it
helps you get started with some
JavaScript I might clean this up at some
point in the future I'll put this up on
the dream comm slash lab slash open
source and have fun guys thanks for
watching peace</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>