<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP: Create Your Own MVC (Part 5) | Coder Coacher - Coaching Coders</title><meta content="PHP: Create Your Own MVC (Part 5) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP: Create Your Own MVC (Part 5)</b></h2><h5 class="post__date">2011-08-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4gDLBMs_9ng" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up youtubers this is MVC
tutorial part 5 and I have a couple of
things we're going to do and I'll go
through the list real quick when we're
logged in we're going to show a
dashboard link so we're logged in let me
just log in I believe I just did Jesse
Jesse we're going to show a dashboard
link so that if they're over here they
can get back to dashboard without typing
it up there we're going to do crud
without Ajax this here which is create
edit delete update all that stuff
because the guy sent me about 100 emails
on it and although I don't appreciate
that I'll do it anyways but if you have
if you want me to do something just send
it to my YouTube the other thing we're
going to fix the paths for the live
server when you upload it to your FTP
and the last one is an access control
list and I'm going to try to fit this
all in about 30 minutes the access
control list is going to be extremely
simple just different permissions and
stuff so to get started we're going to
start with the dashboard link up at the
top by the way if you see this you're
not a lesson behind because I just
changed some CSS and HTML none of the
functionality has changed if you're
really picky you could just download the
file and start with that alright so
let's get started the first thing I'm
going to do is the probably the ACL
actually that'll be the easiest so I'm
going to go to local host PHP myadmin
and I'm going to open up MVC and none of
my users have an ID login and password
we need to create another row under
structure and I'm just going to put this
after password
and go and this is going to be called
roll and this is going to be enumerated
why I don't know but that's how I would
like to do this one third is and with
this the values are going to be admin
you can see I've done that before
default admin owner that's kind of how I
like to do it because an owner should
have more permissions than an admin but
I'll just do it that way and the default
will be default default would just be a
regular user save invalid default oops
gutting race those save okay so I'll go
back to browse with my nice little
enumerated thing and the Jessie login is
default I'm going to change him to owner
okay
now Jesse's the owner and I'm going to
create a new user with the same password
which is Jesse and I'll call him Joe
with the same password and he'll just be
a default user okay so now we have two
different users with two different roles
and back here what we need to do is
differentiate when they log in and the
way we're going to tell is we're going
to handle it in this session so I'm
going to open my controller and go to
login and under run it looks like
everything's happening under the model
run so I'll open up models and login
model and run so to track back a minute
what we're doing is we're preparing a
statement if the login password matches
if it does we get some stuff so what we
want to do is fetch some data okay so
I'm going to just try data equals
statement handler fetch and I'm going to
do print R of data and I'm going to die
so I can see what we get
you might want me to rush through this
but this will be good practice okay and
I get an ID of one and this is just the
integer value same ID so I don't just
want select ID I want to select roll
so I'm gonna select roll refresh
continue and there's roll okay and to
make sure I'm getting my data right I'm
going to say data of oh it's an array
data of roll
can't see my mouse echo data-role okay
refresh once more and we have owner good
so I can get rid of this stuff get rid
of the print R and I want this data roll
so I'm going to cut this and I'm going
to set a session session set roll and it
will be
the data-role okay and I'm going to go
back to this login once more I'll say
Jesse Jesse okay I'm in here now on the
index page or sorry the dashboard page
we can go to let's go to that real quick
to control our dashboard and how do I
want to do this let's just do a print
our session just want to make sure we
have it okay and you see we have the
role owner and logged in is good so with
that simple ACL type of thing I'm going
to go to my view of dashboard of index
actually I kind of want my data up in
the header I want all this to change up
here okay
so we're going to do that so in the
header
here we go so if they're logged in who
had a bug in my shirt that was weird
I'm just going to copy this line here
I'm going to say if logged in is false
then we will show the help in index
okay so I'll refresh and it only says
log out there
I want a dashboard link so say dashboard
boom boom save refresh and dashboard and
logout okay now for the fun part the
role which is if a guy's logged in we
want the type to be a special so I'm
going to say paste this here take that
there and we're going to get the role
and if the role equals owner we're going
to give a link to say dashboard slash
user
users I'm actually gonna call this user
instead okay so refresh oops what did I
do
I got an else statement I need a end F
sorry
don't forget your semicolon refresh and
we have users dashboard and users
doesn't exist no problem logout and
let's log in as Joe with the password
Jesse and he doesn't see that at all
okay so I'm going to go back to uh Jesse
Jesse and what I'm going to do is create
a user controller and what I'm going to
do is just copy this and paste
oops oh yeah that looks right and I can
call this user
and we can change this to class user and
the difference between this one is we're
also going to check if the type is admin
so session get roll
so we're assigning the role to whatever
water
so if vlogged is false or role is not
equal to owner they are going to get out
of here okay
so oops I'm going to actually need to
get rid of a couple things let me get
rid of some of those so it's a nice
clean controller and for the user view
I'm going to make a new folder for the
user index so down here I'll just new
folder user new PHP file called index
and just in case he'll make an extra
folder for JavaScript I probably won't
use it at this time and I need to look
at what I did in here okay okay so so we
put in some user stuff there
refresh go to users and we have user
here now to test our little system out
let's plug in is Joe and the password of
Jesse and I'm going to type this in
manually user okay and it logged me out
like we it should have now you see this
took me to the wrong URL
I believe that's in dashboard controller
logout and this is why really what we
could do is use our constant we set one
of these called URL like so
shoot and they see again let me try that
once more
log out okay and that take us to the
right place but I got to get rid of that
slash there boom okay
and that looks good so there's a simple
access control whatever we're ready
showed the dashboard when they're logged
in next we're going to do crud without
Ajax so I'm going to log in as Jesse
Jesse and go to users so I'm going to
open users dot PHP right click and close
all their documents and in here I'm
going to create a couple of functions I
like to put public before the name but
you don't have to if you don't want to
so we're going to do one called
create
edit and delete I guess now with
creating we don't need an ID because
we're creating the guy from scratch
right with editing we're going to need
an ID of the user we're editing same
with delete we're going to know who
we're deleting okay so I'm going to pass
these in here so I guess the first thing
I'll do is create a user model okay and
I'll just copy kind of the same layout
from another file and I can pretty much
delete everything in there and I'll call
it either model and what I want to do is
I want to list the user so I'm going to
say user list and I need to do a
database query I can't remember off the
top of my head so I'm just going to take
a look at say dashboard model here we go
let's copy this
and don't worry about copying that I'll
type it out as I go so I'll do a
statement Handler equals this DB
preparer and I'll say select all from
users and I'll do sth execute and sth
fetch all ok and I want to return that
and I'm gonna return that into my
controller okay I'm going to call user
list and I'll say this model user list
and I'm going to assign that a variable
to this view user list equals all the
goods that come from that and finally
back in the user view we're going to do
the PHP tag and print our of this user
list hope that works refresh and we have
all that good stuff now obviously we
don't want the password to show but you
could consider that we are the admin in
this area but just for precaution I
don't want to do that so what I'm going
to do is I'm going to select ID what are
our own names login and roll
now one thing you got to remember is at
some point you might forget to update
this and you come back here and you add
a table inside database and it's not
showing up so try to remember if you
accidentally do that and what we're
going to do is a little for each loop
actually got a look at that array once
more so we have an array of arrays so
let me just try for each this user list
as key value and I'm going to echo key
and echo value and I guess echo a BR so
I can see what I'm working with
okay and refresh and I have zero and
array and I'm just going to get a say it
was key role see if I give us it nope
it's value role
okay there it is sorry about that
and what I want to do is put this in a
little table so it's pretty so I'll say
table table row to the table row we're
actually going to want to repeat for
every user so I'm going to pop that in
here boom and boom okay and I'm going to
create a table divider with echo DD dot
b-roll boom boom and I'm just going to
ctrl shift down arrow duplicate that
line and I'm going to call this name or
what was it logging and the first one
will just be as ID okay so refresh and
we have a nice little table there that
we could make prettier at some point and
then on the I'm going to make another
role for some options
which could basically be delete and edit
so I'll do an a HRF and this will be
delete and I'll make one called edit
haven't decided on the names yet and I'm
also going to go up here and make a form
to create a guy okay so we need a label
for the logon a label for the password a
so a label for the role and a label for
the submit button I just put a nine
non-breaking space in there so this is
separated correctly it's although an
input type equals submit and let me go
up here input type equals actually this
is going to be a select select
and I'll pop that guy right there this
will be input type equals text now you
could do password for a password field
however what we're doing is in the owner
area again so we kind of want to know
what or typing in of those ID equals
password and this one input type equals
text sorry we don't want ID we want name
I keep getting that confused with
JavaScript they're select ID will be the
role okay and as you know I put in three
roles so my first one would be default
the second would be admin and since
there can be no there can't be two
owners I'm just going to leave it to
these two one thing you should know is
that whatever you put in here you should
really have a value inside your option
just the actual value of what we're
going to use so Evan
okay so I'm going to refresh that and
that looks terrible that did not turn
out right oh I forgot the brakes now
yours won't look exactly the same as
mine unless you use the CSS file I made
in the in the new thing okay so that
looks good
and I'm going to do a horizontal rule to
split it up so we need to do a form
method equals post and the action is
going to go to the URL and the URL of
user create okay so over on our user our
create here let's say echo 1 and refresh
so submit echo 1 okay that's good I'm
going to put a space between these
letters that's bothering me
okay okay so to create what I'll do is
just post I think I'm going to do the
post inside of here now there's a whole
other thing we can do and create a form
handler I have my own but that'd take
quite a while to build one on the video
so I'm just going to do a regular post
of sorrows' the login password equals
md5 Pat blue I'm getting messed up here
post password and role equals post role
okay now let me make sure I'm using md5
first of all so in the structure where
is it
users and I want to find out how long
password is
structure password is 32 so that is md5
okay
now I'm not going to go into preserving
your fields right now because I don't
want this video to get way too long so
once we get that let's just say do your
error checking I'll put it to do here
okay and now what we're going to do is
prepare statement so I'll do a statement
Handler equals this oops we don't have
database access inside the controller so
we got to go to the model so I'll say
this model create and I'm going to make
an array here data equals all right
and
a login data password and data role and
we'll pass in data now in my opinion and
I don't know everything
I think forms should be handled in the
controller but obviously if you had a
form handler be a lot cleaner so with
the create data we'll have will go to
the user model public function crate and
data and what we can do is we can just
copy all this and we're going to do an
insert insert into users what our field
names login sorry I keep forgetting this
password and role and I'm going to go
down the line so we can read this and
I'll say values
was a data login password and roll
okay and these should be in little
quotes I'm going to double quote them
and I know they're not going to parse so
I'm just going to do this the quick way
into a dot period instead of monkey in
on oh maybe I'll do the squigglies I
think the squigglies will work with that
can't no I think has to be double quoted
anyways boom boom boom boom boom boom
boom boom boom and we have an error
that's why I don't like using quote
periods
well period that I don't see I'm going
to pause the video a second all right so
let me I still have it squiggly there
and that should fix it
okay execute I'm not even using a
prepared statement here my goodness
that's embarrassing all right I had to
pause it a second here we go when I
execute I'm going to execute an array I
don't know why I did this way I'm just
not thinking clearly let me cut this out
and I'm just going to put in login
password and roll okay and for my array
here I will say of logon equals data
login we got to have double quotes
around these
boom boom and this will be password
password roll roll roll safe and what'd
I do wrong here I need one more okay and
right now I'm not keeping track of
whether a query was successful or not so
I'm just going to try and do one called
test undefined index roll so data roll
that comes from the user here of post
roll so in our index file let's see I
did idea of roll who is getting that old
JavaScript confused test and test and
submit and I'll go back refresh and
here's the user test let me make sure
he's in here with the password good and
what I shall do is the controller is
just going to automatically refresh the
page I honestly can't remember if we
made a refresh method or not so I'll
just do a header location of you'll URL
users save refresh test to test to
users it's called user that's so
embarrassing
so test to to test to to okay and there
it is
to edit a guy I honestly prefer
JavaScript let's do delete first because
that'll be easy
we're going to go to the index page and
the URL we're just going to do a some
quotes and we're going to do URL of user
/ delete / and the ID which is value ID
sighs right okay refresh so when I hover
over it if you look down there in the
gray thing delete / five I can get rid
of this / here okay so in the controller
I'm just going to call this model delete
ID and I can go ahead and copy the
Refresh here while I'm at I'll pop that
into the Edit function - and in the user
model under delete we got to create one
so I'll say public function delete ID
and sdh equals this DB there obviously
with all this typing we need a database
wrapper I for now I'll leave that up to
you if you'd like and what I'm going to
do is delete from users where ID equals
ID okay
and Sta execute and I'm going to pop an
array in here
and here I'll say ID of ID that we
passed okay and let's see how that works
let me just refresh and delete delete
good
now you'd want to make a way so you
can't delete the owner or anything and
to edit what I'm actually going to do is
take you to another page so let me make
a edit and there's going to have to be
an edit to save function
so this parts a little tricky I guess
this meant that this video is going to
be over 45 minutes but no big deal I'm
just going to copy this form here we're
going to make a new file called edit and
I'll say user edit
and I'll say edit and we're not going to
get ahead too fast right there so I'm
just paste on a form in K so back in the
edit page we can actually move this down
to the edit save in the edit we have to
first fetch the individual user and then
we pretty much just sign it to the view
so this view let's call it user equals
this model lists user
so we're going to list only an
individual user and then we need to
render so this view render and how did I
do it up here user splash edit boom and
we have to create the list user method
so up in the user model will go to look
at that user list what I'll do is make
this mmm I'm going to make a separate
function just because I want to so yeah
I'll do that
I'm going to call this user single list
just you could pass a variable in here
and do an if statement but I'm going to
do it this way and we can copy all this
stuff but from users where ID equals ID
and when we execute we're going to pass
an array once again and I'll say ID
equals ID and we're only fetching one
row so we should be able to get away
with a fetch user and in the Edit thing
we're going to print our of user
okay so I'll refresh and let's see what
we have the link it's not the correct
link yet we got to update our index so
pretty much going to do the same thing
here into URL user slash edit / boom
boom boom boom value ID okay and I guess
I could put those on separate lines so
it's more readable there we go and
refresh and if I hover I can edit one at
it too so now I get the data that I can
edit the dude with and I want to auto
fill these forms with the data that's
there so I'm going to go to edit and we
have this user so at so this user and
what's that in array okay so I'll try a
ID
and refresh and we get the correct ID
okay so what I'm going to do is this
okay echo the ID and this goes on the
end of the action URL so when we post it
it's going to call a user safe because
this is going to save it
users just to display it user save is to
save it in this case and for the log and
I'll do a value equals boom and change
that to logon and for the type we could
do a conditional to say if the user
equals default then this one is selected
I guess I'll do it real quick if
this user role equals default
let me shrink this down a second if this
user role equals default echo selected
and I think that is right and if this
user role equals admin selected so
refresh
let's go back to users and looks like
well got defaults I don't have the right
guy I want I want to test the owner
although we're not really going to be
able to change the owner or you
shouldn't I'm going to just do this so I
can make sure this is working and
refresh and edit and see that's selected
on the right guy now you should disable
that in my opinion but I'm just running
through this with you
so when we post this form we're going to
kind of pull it's the same thing as our
thing right here so we could actually
copy all this paste this into edit save
boom
I'll get rid of one of those and I'll do
edit save of data okay
login password role that's what we're
saving and under edit save we didn't
create one yet so I'm just going to
duplicate this call this edit save and
we're going to do update users will do
set
login equals logon
password equals password and role equals
role and we're going to do this except
for this we're going to md5 the password
as you know prepared it uh okay that
looks right so I'm going to go back to
my thing refresh let me go back we're
not pasting a password by the way
because it's md5 hash and we can't read
it anyway so for test let's try test to
submit and MVC user save looks like we
forgot a link under edit we need to do
user user save isn't this edit save one
of my own I've been programming too much
today my thinking cap pain on so let me
try that again
test two and okay looks like it it
renamed all our guys bad bad bad
we forgot our where so we're ID equals
ID and we're going to need to pass in
the ID of data ID and in the controller
we have to pass an ID through the data
array so I'll say data of ID equals ID
okay so I'm going to edit this guy
change them back to Jessie make sure
he's the owner safe okay good and that's
how we can edit and delete stuff without
crud lastly we're going to fix the URLs
now I've uploaded this and the MVC to my
site to test it so I'm not sure why my
server is going so slow
what I'm going to do is quickly help you
debug this and to do that I guess it's
going to take a long time I'm going to
open up the htaccess file and at the top
of this if you're using Santa wets or
you're in a mode where your errors
aren't displayed this is a nice way to
do it say if you're getting a peach P
500 error PHP flag was it display errors
on you can flag PHP stuff from htaccess
which is cool
and
and that should be right we're going to
turn that on so wow what is going on
okay there it is and what I'm going to
do is go to help I've already updated
that where my htaccess reflects this so
let me go to my config you're going to
have to change our paths to your site so
I would actually change this to to that
don't forget your backslash here okay
this is if you're uploading it to a site
so my error is that I don't have access
to the database so I'm going to open up
putty real quick and connect I'm going
to pause the video a second okay
and I just updated my database settings
so that they reflect a real database and
that should fix your problems if it
doesn't let me know so thanks for
bearing with me through this forty
minute tutorial guys I'd appreciate a
thumbs up if you found this useful at
all have a nice day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>