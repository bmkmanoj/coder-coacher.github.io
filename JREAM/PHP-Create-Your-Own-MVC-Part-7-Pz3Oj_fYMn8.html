<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP: Create Your Own MVC (Part 7) | Coder Coacher - Coaching Coders</title><meta content="PHP: Create Your Own MVC (Part 7) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP: Create Your Own MVC (Part 7)</b></h2><h5 class="post__date">2012-04-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Pz3Oj_fYMn8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi guys welcome to part 7 of the
model-view-controller tutorial and one
thing to continually keep in mind is
that this is not a 100% in-depth thing
to use for production it's something you
should work on and keep practicing and
improving so we're going to begin with
the null by character someone brought to
my attention previously in a comment and
that's if I did % 0 and they could trail
back to a different directory we need to
make sure this does not happen so I'm
going to open up my bootstrap and while
the URL is still a string I'm going to
sanitize the URL with a filter bar and
I'll do a filter sanitized URL okay and
that will clean up the null byte so
that's taken care of what I've also done
is in my database I'll open this guy up
now I'm using Heidi SQL I just prefer it
because it's a little easier than PHP
myadmin
so in my users table what I did was I
changed my password field to 64
characters that's because I'm using
sha-256 for encryption and that way
it'll do a bit more secure and how I
translated my passwords I went to my
index.php file I got out sha-256
password I want and the constant for the
salt okay now once I did that on my
index pay that is copy this strength I
pasted it into the data for each one of
these and I just made the password the
same as the logon and then the last
thing you'll need to do is for the
actual login part
that was under the login controller
model right here where we run it and we
do hash create you would need to change
your creation to shot 256 ok so I feel
like this file structure it's not too
bad I am NOT a big fan of the config
file being in multiple files because
that's more file requests and it could
slow things down a little bit so I'll
make a new PHP file and I'm going to
call this config I'm going to open it
constants database and path and you see
how we're not really using a lot of this
I mean a lot of the file is just kind of
empty we could really just combine these
all in one a database and the constants
and I know the comments aren't that
pretty I'm not going to use a video
recording time to make this all pretty
so I have my config file and now we need
to include that so rather than all these
I can just include config dot PHP like
that and I'll refresh the page to make
sure we don't have a problem it looks
good so I can just delete this whole
config folder which was overkill
so let's first go over to the login page
and make sure you can log-in if you
decided to change your tables and my
login is Jesse Jesse and we're here what
we're going to do is we're going to make
sure in the user section we can't delete
the owner to do so we need to close all
these guys open the user controller and
open the user model I prefer to open
them both together side by side lately
that is anyways because when you're
working with a lot of files you kind of
want to hop to one to another a lot so
um in the user model the delete is
deleting based on the ID so what I'm
going to do is a query for a select
statement
so I'll just duplicate this and I'm
going to throw in a die because I don't
want to accidentally delete my main guy
and when I'm testing it's a good way to
start things so what I'm going to do is
select count ID
from user where ID equals ID I are sorry
when I just do type it was called roll
by mistake just to show you I'm
selecting the roll
so they're going to select an ID so say
they want to delete user one we're going
to grab the roll from the ID they
selected and make sure it's not the
owner and I could probably pop this on
one line here because these are pretty
small little queries and we need to do a
fetch all that's I'm just going to give
it a variable of R for now and I'll do a
print R of R
oops and save that guy so I'll try to
delete the owner he's empty delete test
he's empty as well so this is incorrect
select role from user where ID equals ID
so we prepared the statement we execute
it and now we're trying to fetch it all
let's just try to fetch one that doesn't
do anything a little confused by that
fetch all four entire of our select roll
let me stress luck it all from user
where ID equals ID delete and we are in
the delete method the controller is
calling delete so it's calling delete
and passing in the ID
let's check the ID so say echo ID and
it's passing one which is matching that
up there so that matches one my select
statement does not seem to like me and
I'm doing a DB prepare for a select
statement which isn't really a big deal
I really do that all the time
so sth executes
I guess I'm so used to your working with
my own pedo wrapper that I figure out
how to just use the standard one so what
I'll do is I'll open the models of the
login model and I did an execute I guess
I did with a single fetch interesting
prepare select ID dotto to execute and
for this I did prepare I just did a
single fetch for this select all from
user where ID equals ID execute ID
refresh boy that is odd there oh you
sirs I wonder why it's not giving me the
error refresh there we go I'm so sorry
this is a little bit older of project
nowadays nowadays I prefer to make
things not plural so this would actually
be called user
I prefer everything not to be plural and
I can show you what I mean with the
sample schema I have in production let
me create a new database I'll just call
it karma what's this called utf-8 and
here I'll just run the query and you see
inside of here once i refresh it i have
all of these items system action
announcement
nothing's plural and that makes it a lot
easier to work with so I'll go ahead and
drop that table and I can't decide to
drop this too so what I'm actually going
to do is rename this to user edit user
and save so I'm going to have to change
a few things just to be sure
change user and I'm going to do a find
of users and I'm going to manually
change these because I'm not certain
where I might see I have user singleton
list if I did a replace it would replace
that with what I wanted but it wouldn't
be correct so user user I'll save that
and I should check the login model but
from user
and that looks like it's good and every
time I make a little change I like to
double check because one thing going
wrong could result in many things going
wrong okay looks good so I'll try to
delete again okay the thing is our
wrapper should have thrown an exception
if there was no table we might have to
improve on that later so with the user
model I'll go back down and with the
fetch we have one record but I just want
the role so I'll just try to fetch the
role and refresh oops
okay role is owner I don't like this P
do fetch style but again we won't get
into that so let's see what we have
array of role so if data role equals
owner return false ok and what that will
do is just prevent this from happening I
don't even need to throw an else
statement in there so I'll refresh
delete delete delete he doesn't work and
I'm going to duplicate my test guy here
just a two times so that I have some
samples so I'll delete this guy delete
this guy but I can't delete him looks
good and it looks like with this
creation form when we create a user
we're also going to have to update our
sha-256 password might have been some
place I missed and here we have it edit
saved it needs to be sha-256 create is
to be shot whoops
2:56 and refresh suit that edit page
does okay get some that stuff and
we're cleaning up a little bit so the
PDO library let's just take a glance at
that we're extending PDO so that we
don't have to read Eclair a lot of
functions such as if we were to
instantiate it within the class we'd
have to create a lot of custom functions
so we have something to build a query
for us which is really nice
we need a Select command I believe so
I'll say public function select and I'll
say SQL and array and let's see what we
did
statement handler equals this repair and
we're going to bind the values of the
array so for each array as key value
will bind those guys up and we're going
to prepare the SQL and then we'll
execute it and our equals
um return sth fetch all I'll just return
it so basically when you select there's
never a time where you select when you
don't use what you've selected otherwise
there's no point in selecting something
so what we're going to make this do is
all the work for us
so SQL will be a string this will be
array parameters to bind and it's going
to return mix what we could do is set
the fetch mode and in PDO so the Gopi do
fetch mode we have a set fetch mode to
such block set the global fetch mode
where are the fetch mode listings
I'll get Stack Overflow okay so fetch
object column class num socha
thats what i want so by default I'm
going to make this PDO fetch Assoc and
we're going to pass in the batch mode
okay and I better Ram constant fetch
mode and we'll say a PDO fetch oh okay
so let's try this out to make our lives
a little easier you see how we're doing
this rather than this I'll say this DB
select and I guess I could just copy
this guy here oops
role for music okay and for the second
argument I'll just have an empty array
in fact I should probably leave set this
as array just so that there's a default
empty so I could leave him like that and
then I can return the list so what I'll
do is here's my user list I'll refresh
and it looks like it's good because it's
still there we have oh here's an example
where we will bind the parameter so I'll
just to return this DB select and I'll
copy this guy
and and what I want to do is pass in an
array to bind the value if you recall we
have an array here and the array will
bind the value to the SQL query so I'll
say um ID of ID and the ID we're passing
in will be whatever is there there's an
insert and edit delete looks like we
could improve this one to this
DB select less code is less stress okay
and it will since I'll just copy this
guy in here
and what I need to do is the results are
done with a little different so I need
to give this guy variable so I can see
what he's given me remember the Select
returns stuff so I'm going to look at
what he returned I'll try to delete and
execute and develop parameters okay
let's just double-check this where ID
select role from user where ID equals ID
array ID and this says invalid parameter
number parameter wasn't defined
such a rule from user word ID sometimes
I get this confused and I put a comma
here and that takes it as two different
array values but I have the arrow here
and let me just make sure everything is
good
I'm a user delete the parameter it's
being passed okay line 27 of database
I'm not sure that's going to tell me
exactly what I want
statement handler executes okay so our
values being bound it looks like we're
already passing the semicolon in so it
looks like I need to get rid of that ID
but I put it up here that's what's on
let me refresh and see if it works okay
so I already have the semicolon going in
and that's going to be up to you that's
a tough one I guess it depends on how
you like to do it for me I prefer to put
a semicolon in because I feel like it's
like hey this matches up with that so I
am going to do it with the semicolon
manually and to do so I'm going to
delete it from the spine value here so
once more I'm going to refresh and it
still looks good
and my list is still showing up so once
more to print our result we need to
check that and let's delete him so fetch
all will fetch an array of a race or a
multi-dimensional array so what I can
say is if result zero row equals owner
and you can see zero role owner then
we'll return false and
that should do us justice to make the
slimmer we can get rid of these spaces I
only get rid of those really if it's not
I'm pretty certain that I'm not going to
add anything else after the bracket like
there's not going to be much else going
in here
so that's good go ahead and refresh try
to delete him looks good
what I'd also like to do is kind of
improve upon the delete where we don't
have to prepare a delete rather it's
going to be kind of like to select but a
little more intuitive so I'll do a
public function delete and there's a
couple of ways we could go about this I
think I'm going to do it a different way
so I'll say delete from table where okay
so what we'll do is we'll just grab
something like say here and we're going
to say delete from table where where
okay now this doesn't have any per pound
parameters going into it we really could
write this out as SQL if we wanted to
say like happen like this how the array
is here it's cleaner and more secure and
clearer and more secure always sounds
more attractive and smarter to do so
that's probably what we should do so I
guess we will go to bind data so instead
of delete from table I suppose I'll say
this SQL and find params sorry it's
really the same as this guy pretty much
so I'll just call it SQL and array so
that everything feels similar
okay delete from tables and prepare you
know the thing is this isn't really
helping us with a delete if we just run
custom SQL so what we could do is build
create a build string to delete I could
say let's see the way we built this you
see how we built these keys and values
for the thing what I could say well this
is a tough this is a tough one to decide
on what's best to do and I'm kind of
indecisive and I don't want to waste too
much time thinking about this so I'm
going to have it how I put it if you
guys want to change it that's up to you
so I'll just say table and we're and
with the tonal limit I prefer to put in
a limit because it prevents us from
making a very stupid mistake so by
default the limit will be 1 okay and I
could get rid of this and I'll say SCH
execute we actually don't even have to
prepare this there is a PDO method
called exact which will return the
affected rows right here and this is
generally a better thing to do for
deletes as you can see there so no need
to prepare since we're not preparing
really anything so I'll say this exact
and we'll return the number of affected
rolls and of course we should comment
our code up so I'll say delete and the
tight the table is a strength whereas a
strength and limit is an integer and
return integer okay
so we'll have this nice little delete
function and I'll say this DB delete
from user where ID equals ID okay so let
me just duplicate it Abu Sitta and you
didn't or do that now let's test that
guy out delete delete delete looks good
and try to delete him looks good so
that's a little cleaner at the moment we
have also on the dashboard model here we
have inserts and these should be
translated into selects so I would say
this DB select select star from data
and we'll change that to a result equals
blah blah blah and make sure that's
working I have no idea what even goes
here let me check the console get
listings okay we have an error
let me real quickly turn off X debug
because the output in JSON is terrible
see all those tables I can't ever tell
what's going on let me just find an X
debug comment him out and I'll just
restart wind pearl click there my
console and refresh oops
undefined variable data on line 23 so
line 23 that's the problem I'll just
change this to result make sure that guy
works there is and again here we have
this DB delete I want to delete from
data where ID equals id heck we could
even what scares me a little bit is when
we're deleting a listing this post ID
here this needs to be sanitized and I
think what I'm going to do is type test
this to an integer just for a quick safe
measure right now that way nobody could
type in any funny SQL code because this
is not a prepared statement so it's not
protecting against this kind of crap so
let's update our insert
this this DB insert okay and I have to
recall how we did that so we did an
insert into the table with an array yeah
it's beautiful
so insert into data array text equals
text the reason I leave this variable
here is because I never liked putting
this guy down in here it's scary to do
again it's a bound parameter so it is
going to be safe execute and we get the
let's insert ID okay so let's try that
out see if she works test okay it looks
like our insertion is going great so we
have a lot less code for the dashboard
one thing I don't like is that how I
name things xhr I think it just looks
stupid so if I was in dashboard you know
what else is another thing is having
these custom javascript file setup
through the controller I can't say I'm a
big fan of it because it just feels so
unnecessary to have a separate
JavaScript file but it could come in
handy I suppose one thing I have started
to do is not even include my own jQuery
libraries I'd go to a Google jQuery CDN
and I just grabbed jQuery here because
Google's very fast and
it's going to be less on my server less
to worry about and that's the URL so
that and there's the min and looks like
custom dot J s is still chillin there I
will note that you can also include a UI
and I think I'll do that because we
might want that later so I'll just
duplicate that guy and paste him in
there and with UI
we need a actual CSS file so okay and
just look for our other hosted things
anywhere and I'll just pick sunny off
Google CDN and you'll see that they have
a nice CSS file with the images hosted
on their server and we can do a
stylesheet
jQuery UI okay so what we have here
looks all decent for now I suppose
having here is kind of ugly and what I'm
going to do is just test out some script
and just some jQuery code document ready
and let me just make a input so I'll say
input ID equals test2 and I'll just say
test2 dot date picker is just to see if
the jQuery UI is working where was I
here there it is
isn't that nice so I can go ahead and
get rid of that junk and this junk okay
so when I look at the overall process of
what we're doing it's a lot of posting
data returning data and kind of
manipulating the database what we need
to do is create a form handler to save
us time to Santa sanitized data we
haven't even had to validate data for
example if we go to the login page
well the login model we're just taking
the straight-up posts we shouldn't even
have to run a query on if their post is
too short so if I log out and I just put
nothing in it's running a query even if
I put like two letters and and imagine
someone just spam attacking this they're
wasting queries when we could use PHP to
prevent that from even getting called so
you know obviously we could do something
like this if
it was a string one post login is less
than five you know give them an error
but that's going to get really ugly and
dirty so what we're going to do is
create a new library and we're going to
call it forum okay
I'll say class forum public function
construct and we're going to have a
couple base things so a public function
um post public function the Val I'm just
going to call this valve for my
validator and it looks like we're
getting pretty far in this video and
it's going to get too insane so um I'll
quickly wrap this up post field and I'm
going to set it as internal array of
private post data equals alright and
what I'll say is this post data field
equals post data field okay and that's
that's where we're going to start for
now and I think that's that's a decent
stopping point I'll upload this on my
open source page if you guys would like
to download it and I should export this
database so that you can have it and
thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>