<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Learn Node By Example - Part 6 - Save to MongoDB with Mongoose | Coder Coacher - Coaching Coders</title><meta content="Learn Node By Example - Part 6 - Save to MongoDB with Mongoose - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Learn Node By Example - Part 6 - Save to MongoDB with Mongoose</b></h2><h5 class="post__date">2017-02-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ysJaitmeu4k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we just want to make sure
we can connect to MongoDB first thing
we'll want if we haven't already is
installed the Mongoose package and that
makes it really easy to work with
MongoDB so inside our app you see I'm in
slash app I'm going to do NPM install
Mongoose - - save once that's done okay
we have that
we can say up here var Mongoose equals
require Mongoose okay and I could put a
little thing that says BB for that so
what we want to do is have Mongoose
connect to our application so we would
just say something like Mongoose dot
connect and our path would be MongoDB /
/ localhost and let's call this my app
okay and let's just see if that works
so NPM start ok doesn't look like any
errors
I always forget the debug command the
bug want to run that
okay and this guy here was looking at is
called passport js4 user user
authentication where you can do it
manually with Mongoose if you would like
to build your own or passports pretty
popular they also have providers for
Twitter Facebook Google and local so but
that's something to maybe look into
later I hadn't mentioned there's also
GUI clients like Robo Mongo org there's
one called Mongo chef and that can make
your experience a little easier perhaps
but Mongo stores everything in documents
and they basically look like JSON files
so what we're going to do is go ahead
cancellous and we're going to make their
called model alright so here we have
models and then we're going to make a
new file and we'll say bar Mongoose
equals require Mongoose and bar schema
equals Mongoose schema okay so those are
the two dependencies we need for every
model and I should probably save this I
don't really want to call it user
because it might change we could though
it's it's a hard call
so I'll call it gosh how do you help
what's a good naming convention for this
let me just check I think if I did
require user model that's just readable
maybe something like that because none
of the file names our camelcase
so perhaps we'll just do a user model
for now and with passport we might
overwrite it okay so that will save our
user schema equals new schema okay toss
them out object and in here we define
the schema for it so we could just have
like a username a password if they're an
administrator I always like to add it
created at updated at and sometimes if
you want a deleted at okay and we'll
obviously need to fill these in but I
want to show you mongoose schema type oh
here we go
so we can just pass in string organ
packs in an object and this is pretty
cool where we can define restraint
and then you can do nested items because
this is Jason which would almost be like
in my sequel like having a meta table
something similar to that so we can do a
string for I kind of want to copy this
okay
so created that will be the date and the
date now will be the default admin
username oh shoot we either email string
password will be strength admin will be
boolean this will be a date and this
will be a date so we want to put some
more rules on this so we don't have
their email so it's really up to us to
provide an email which could be a string
as well otherwise we could say meta and
say first name string last main string
gender you can do string there but let's
just keep it simple for now so for
username we want these to be unique so
we'll pop this in an object and we'll
say the type is a strength required is
true and unique is true and for the
password we'll say type is a string
required is true
it doesn't need to be a unique password
and it looks like email we'll probably
want to do the same thing we want that
unique as well as the username so we
don't have a little overflow I think we
could just ditch the username almost but
this is just an example so admin is a
boolean we could say type is boolean
default is false updated at delete it at
ok and then we'll make a bar for the
user catalyze this and Mongoose dispel
all right Mongoose model user of user
schema and then module dot exports
equals either ok and then we have a user
model it's reusable so we can go to our
routes and how about our user route so
this would be like slash user so I'll
save our user equals require a directory
down because one route to model slash
user that's renamed it's just a user
because it's not going to affect it okay
so there's the user you could call this
user model whatever you want okay but
the upper case indicates like hey I'm a
model in here when they hit the user
page what we'll just do is say var
john equals new user name is john
mother's name email is john at doe comm
user name is john doe password abc123
now there's no encryption on this right
now we're just making sure we can
connect and there are a lot of other
fields that we can check and then we'll
say john dot save function error so once
we say that we're just going to check if
error throw error otherwise it will skip
past this we could even put these in the
braces but keep it short hand and
console dot log user created ok so what
we're going to attempt to do hopefully
that worked correctly and the paths are
right is now run NPM start and what we
have here
where am i hat dot je s please include
the following file with support request
fails to start script okay let me just
comment this out and see if that was our
culprit okay so it is the models user so
models user
so that exports the user I see I don't
see anything wrong there
all right so VAR user equals so we're
here we're going add erector II down is
it 2-1 down like that all unexpected
identifiers up there called meta I
forgot a comma here shoot let's try that
again okay throw error looks like
I'll just do it this way little if-else
statement and this is not and here does
it john dot c yeah it does so that might
work there okay these were of no js' get
upon module models dot user so try to
directories down okay that seems to work
so we should be able to go to is it user
users users respond with a resource and
let's see user created okay so that
created a user now if i refresh there
should be an error
okay duplicate key error because we have
email one that's already being inspected
what i'll do is open a new guy and just
type mando and i'll say DB - Oh DeeDee
and use my app and show collections
users and then so this automatically
created the database and we want to just
eyeball what's in there
I could go ahead and open something that
might be easier on the eyes so I have
Mangal chef and Robo Mangal I was a CD
in the Robo Mongo the bin folder and
just run him and you can create a
connection is just localhost has the IP
I called mine localhost my windows too
big and here's my app collection and
here's users and it's pretty odd looking
but it's Jason and this underscore ID is
an internal ID the
to underscore Z is the version and then
the admin default is false created at
and since there was no updated at or
anything just left empty
you could add a default if you want it
what's cool about Mangal is you don't
have to define stuff we could even add
another field for a new user if I were
to go to sublime text and let's just say
we had a name name or let's do the meta
meta first name is John last name is Doe
okay and then if I go back to users make
sure we have met a first name and last
name there okay and this is without
putting a lot of restraints on here so
back here I'm just going to restart and
refresh oh shoot it's going to have an
error let me do Jackie Jackie Chan and
just change this to Jackie Chan
okay start that guy out refresh go up
user-created then up here as five to
refresh and you'll see if we look at the
tooth this one doesn't have Matta but
this one does so you can just add fields
and it'll appear you can even adjust the
schema for that so now we have a little
guy set up what I'm going to do is just
typically this isn't how I prefer to
handle errors but I prefer to say hey
you know there's a big problem there I'm
just going to comment this out and then
we'll get to more things and that's it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>