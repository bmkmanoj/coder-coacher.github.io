<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP MySQL Transaction Tutorial | Coder Coacher - Coaching Coders</title><meta content="PHP MySQL Transaction Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP MySQL Transaction Tutorial</b></h2><h5 class="post__date">2011-12-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CNt9HPqDIVc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up youtubers I know it's been
a long time since I've made a video I've
been quite busy and I realized I've
never even covered my SQL transactions
and I'm going to use my SQL I in PHP to
show you how to do a transaction and you
can use PDO which I would normally use
but I want to kind of make this quick I
prefer to use PDO but I'm working on a
server that doesn't have that at the
moment so to get started we need to
create a database and I'm going to make
this quick
you should know how to create a database
and all that already I'm just going to
create one called trance and we're going
to create a table I'll just call one
called user with two fields and I'll
stretch this thing out and the first one
will be an ID the second one will be a
name and I'll just put 11 for the length
and for the name I'll say I guess 35 and
we need to make this the primary key and
auto increment easy-peasy now one thing
about transactions is the storage engine
my ICM does not support transactions
okay now you can change this later or
you could change it here to nodb this
does support it so I'll go ahead and
save that and we're going to create
another table and lets me go to here and
I'll call this user detail with three
fields and this will be the primary key
the user that's assigned and the details
the ID will be 11 long primary auto
increment the assign user will be just
11 I guess and the details will be of
our character of 255 it doesn't really
matter what you put in here this is just
for example and I'm purposely not
changing the storage engine so that I
can show you how to change it if you're
inside of here the storage engine has
not changed on a database level meaning
if I went to operations I can't change
it here you have to change it per table
so if I click user and go to operations
you'll see this as nodb
if I go to user detail operations with
my I am and I want to change that to you
know DB and that way we'll be able to
rollback transactions and all that so
what a transaction is is it's kind of
like this let's say insert I insert an
insert cake let's I'm inserting three
things and if I have a problem with the
third one here these two records would
have already been inserted the first two
and let's say this guy he relies on
these two records or vice versa we now
have some excessive data in our database
that's going to be useless and you can
use this with updates as well too and
deletes and all that but what we want is
if we if we're required to insert a
couple fields or data into different
tables or rows we want it all to be
consistent we'd probably want to use a
transaction so to get started we'll make
a variable called MySQL I equals new
mysqli and I'll connect to the localhost
with root no password and your database
name I called mine trans and I'm just
going to write a query and it'll be
insert into a user I'm just going to
insert the name I'll call it Pigface and
I'm going to make another query insert
into user detail and oops I'm going to
do a sign user and details values of
let's say something there and for the
idea of assign user what I'm going to do
is make this happen automatically so
here's a little nugget - July insert ID
okay this gets the ID from the last
query that was inserted so it would be
this and remember we have a auto
incremented row so we're just going to
pop that guy into here
boom boom okay so here's how it normally
works I'll refresh the page and I'll go
to my database and here's Pigface and
here's this pig it's a pig with a face
and you see where it says assign user
one and there's the idea of one let me
refresh so you can see it with another
number there's two and there's two so
now for the transaction part one thing
we have to turn off is called auto
commit because when i refresh this page
it commits to the database so I'll say
MySQL I
Otto commit and we'll just pass false in
there okay so we have two records here
I'll go ahead and refresh this couple
times browse and see nothing happens and
that's good because we want to commit
things manually um and to actually
commit it we would do my sqli commit
okay now this is one ready to send it
all over and put it in the database what
we're going to do is a rollback okay so
what I'm going to do is get some fields
here I'll just duplicate whoops
duplicate this a couple times call it
dog face or face and cat face and let me
make sure the commit is on is just for
testing at the moment cat so hang on so
from our user table when they took
delete some ladies okay
and I shall refresh and browse and that
puts all that good stuff in there good
so when doing a transaction you could I
mean check for errors anywhere you know
if I did this result
equals this if it's all d equals false
well I'm not going to go into error
handling this right now so let's roll
back our transaction we just say MySQL I
roll back boom okay so I'll go ahead and
go here and refresh refresh refresh
browse and there's nothing in there
because we're rolling it back so I'm
going to make a fake error
okay if um not empty error okay so let's
say um error equals alright okay this
would store our MySQL errors if there's
a error in there we want to undo
everything okay so maybe you'd have like
after your query you to sign this a
variable and you could say I'm if I
already showed you this you know if a
equals false I'm going to do array push
error and we'll say problem okay but I'm
just going to put it right here so if
the errors are empty we're going to
revert everything refresh let's see what
we get and there's nothing in there let
me comment this out make sure that works
refresh go go and there's all of them so
that's generally a transaction how you
want to handle your errors is good so I
hope this tutorial helped and I hope it
wasn't too long I have fun guys thanks
for watching my videos bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>