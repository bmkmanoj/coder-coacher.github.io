<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP: Create Your Own MVC (Part 3) | Coder Coacher - Coaching Coders</title><meta content="PHP: Create Your Own MVC (Part 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP: Create Your Own MVC (Part 3)</b></h2><h5 class="post__date">2011-06-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2Eu0Nkpo6vM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up YouTube friends and
neighbors today will be a part three of
our MVC and I know these are long
tutorials but if you follow along you
could learn a lot so to start out what
we're going to do is make the ability to
log in with a user and we need to store
our data so we need to make a database
object and what I'm going to do in my
libs folder I'm going to create a new
PHP file and I'm going to call this
database okay
and we always well not always we want a
public function underscore underscore
construct and what we're going to do
with database is actually extend PDO and
in your PHP ini file you have to have
this enabled I'm going to just search
for PDL and right here I'm using PDO
with MySQL and you just want to take
away the little semicolon and then you
would restart your server so make sure
that's enabled once it is we can do PD
database extends PDL and if you're
wondering what this does I assume you do
but each let me just show you briefly if
I look at a PDL there's a ton of
functions or methods in it and there's
also a PDO statement
and basically what this does is our
database gets all of these functions
just by extending it and we can use them
and overwrite things in here so the
first thing I'm going to do is do a
construct and I'm going to do a parent
construct I got to lean into talking to
this microphone and to do this usually
it's kind of like this MySQL is the type
the host will be localhost DB name and
we need to make a database I'll call
this MVC DB name equals fat I think
that's right and now in our user and
password my users root my password is
nothing and I'll save that so what I'm
going to do now is open PHP myadmin and
that's probably under your local host
PHP myadmin if you're you would install
this stuff and I'll just create a new
database called NBC okay
don't need anything in there just yet
what I'm going to do is test this out
and a database should really only be
accessed from your model so from here
we're going to do this this database
equals new database to make it shorter
I'm going to call it this DB now we will
have the database object reusable
through every model okay
and let's see we have a help model let's
make a login model plug the new PHP file
login model and this needs to extend a
model and let's a public function test
and I'll say this DB well I think this
will just get called anyways because the
model should be getting constructed what
I do in here okay
let me test this out under the login
page I'm under login I need to be able
to access the model so let's see how
would I do it in here in help I did
require help model
usually I do this automatically but I'll
just copy this for now and go into my
login model or sorry login controller
under the index page just let's paste
this in and I want to require the login
model let's see if that does anything
refresh and it says class database not
found we need to include that I believe
it was the index page so I'll say
library or fire lids database try once
more and it looks like it is good so we
have database included what I'm going to
also do is create a way to make models
include themselves if they exist so to
do so let's see
login model help model model database
I'll just close all these for a second
and go to bootstrap
let's see down here a model is always
inside of a controller so I'll go inside
of the controller and we'll do if file
exists
and will require models /name model
about PHP okay and the name of the model
is going to have to be a child class on
my computer I'm using PHP 5.3 but on my
web server
it's 5.2 and there's not a good function
to get the child constructor inside of
the parent class if that makes sense so
a workaround we could just do a function
to load a model and I will pop this in
here so if file exists of name well I'll
just copy this whole line name equals
about
path equals models named model so then
we can just say load model of login and
it'll find it okay that looks good and a
file exists of the path we will require
that and then we want to instantiate it
and we'll say this model equals new name
and we need to make that a real thing so
I'll say model name equals named model
okay so you see what we did here we are
looking for a name such as login and
it's going to look in the models for
login and we're to have this attached
onto it if it exists we will require the
file and then we will create a name so
that we can instantiate it like this
kind of a funny way of doing it I
suppose so we'll go to the bootstrap
again
and we have a name for our controller
being called in here and it looks like
it maybe URL zero and where we
instantiate the controller right here I
can say controller load model of URL
zero now I'm assuming there's going to
be a glitch so I'll go ahead and try
that out
refresh cannot read it clear class well
I got to get rid of that thing in my
login model let me delete that and
refresh okay
index help so are these being included
let's find out I'll go to my login model
and let me just do a public function
construction and I'll just echo out ones
refresh and great that looks like it
works now you'll probably want to clean
up your code a bit better than what I've
done but nobody deal for now so back to
our database stuff what we're going to
do is make a form in the login view so
I'll open up my views login index.php
and I'll just say login and form action
I don't know yet method will be post and
we'll do a label for logging and a label
for password and we'll do input type
equals password name equals password and
we'll do a text one for this one oh we
also need a line break and we also need
a submit button so input type equals
submit that's good enough so pause the
video for now if you need to type this
out not too difficult and refresh and we
have a really cheesy looking login form
and where I want this to go is going to
be like let's say login do so I wanted
to go to MVC's login do so I'll just say
login do I want to stay in the log in
controller but I want to call the
function login do or I'll just call it
run so it's easier to understand so
refresh again and the page doesn't it
doesn't exist yet and back in our login
controller I'll make a function call to
run and now I can talk to the model this
model running and all the business logic
is going to happen in side of the model
so I know we're hopping around a bit
hopefully you haven't lost track yet
we're going back to the login model and
I will do a public function run you can
go ahead and erase this here and I'm
going to query the database so I'll say
this DB query now this is straight-up
PDO right here and I'm just going to say
selects ID from users where login equals
I'm going to double quote this actually
it'll be a little easier login equals
login and password equals password okay
let me pop that on two lines so you can
see it there we go and that looks fine
and what we need to do is obviously have
a login and password we don't have a
form object I'm not going to do that
right now we're just going to kind of
ghetto rig this and do a post of login
and a post of password and password
equals and login equals you will want to
sanitize these string posts so that
they're not dirty you know make sure
they're cleaned up we're going to use
PDO preparedstatement to clean up some
junk for our query so that they can't
abuse it actually I want to do a
prepared statement so that it cleans it
up for us so I want to do we're login
equals login and password equals
password whoops this is not right there
we go this DB preparer and then we want
to execute it this DB execute and we
want to fill in these little
placeholders here so I'll make an array
and I'll say
is login and password is password cool
and then what we have to do is fetch it
I'll just say data equals fetch all and
I'll print are both data not certain how
well this will work just yet
I could actually move these down here
and right here
they have a couple lines okay and might
work might not work let's find out
so refresh submit undefined property law
gun model DB call to a member function
prepare on a non object while selling me
I forgot to create the table so I'll
make one called users with three fields
the first one will be an ID the second
one will be a login and a password mark
character of our character I'm going to
do 32 for the password so we can do a
md5 hash for the login I'll just do 25
for the integer I'll do 11 and this will
be the primary key Auto incremented save
and I need to insert some guy in here
I'll call him Jesse and I need a
password that's 32 characters long so
let me just do echo
md5 of Jessie so back refresh and
that'll be my password go browse okay
and let's try that again
undefined property law gun model dB
that's not right I guess we have to
construct the parent to get that working
so I'll say parent construct I can get
rid of this line a refresh call the
undefined method database execute whoops
that has to be a statement boy I'm a
little bit off my rocker today so I'll
just call this sth for statement and
then we'll do the statement to execute
it because that returns an object and
okay I'll try that refresh and we get
nothing back because nothing matches
let's try Jessie Jessie we should have
had something but you see the password
that it's checking is an md5 so I will
say md5 and MySQL I'll try Jessie Jessie
and we have one great go ahead and copy
this code posit if you need to so what
we're going to do is if we have a match
where someone has a login and password
with the correct match we're going to
allow them to go to another page to do
that we could check the count so let's
say boy what was it okay I had to
quickly look it up
let's do echo of s th row count and see
if that works so submit zero and let's
try it with the real thing and we get
one that's what we want the row count so
I'll say count equals that
I could probably comment this out and
I'll say if count is greater than zero
meaning we have a record login else show
an error and the way you go about this
is really going to be up to you I'm just
going to test this once more to make
sure it works good
so to login I suppose we could create a
page called dashboard and I'll say new
PHP file I'll call it dashboard and this
is a club controller so I'll just copy
all this and paste it I'll call it
dashboard and we're going to need a
dashboard index so in our views I'll
create a new folder I'll call it
dashboard and I guess I could just copy
that paste it in there let's see what's
in here
- ball log in online okay that should be
good so I'm going to test out that
dashboard controller real quick real
quick dashboard okay and here's the
dashboard controller and what I want to
do is make it so that if they're not
logged in they can't see this page a way
to go about that would to be to create a
session so what I'm going to do is
create a session object something very
simple so session will be a new class
and I'll say class session and this is
going to be a public static function set
and public static function get the
reason I'm doing this is because in my
opinion it's nicer to type out so you
value session key equals value for turn
session key so this is just working with
sessions and a little easier way in my
opinion and we do want to make sure
session is started so I'll just do a
session start
maybe we should put this like in a knit
session I'll do it in that public static
function in it so we call this one we
want to start the session and we'll also
do one call public static function
destroy and we'll do a session destroy
now I am going to make a note you're
going to want to unset your session
stuff I'm going to leave that alone for
now
so we have our session we need to
include this in the index page so I'll
just ctrl shift down arrow in closed
session close that close that and we are
in the dashboard so I'll do session in
it okay
and let's see what's this page the logon
I can close that and we're going to do
session get I'm going to do this really
plain and easy for right now to say
logged in and I'll call this logged
equals session get logged in so if
logged equals true it's good
what if logged equals false it's bad
so we'll do a header location of oh
what's it called login dot PHP
make sure to exit and I'm also going to
for safety precautions I'll do session
destroy' okay kind of a ghetto rig way
of doing it but so what's going to
happen is we're going to set the session
variable logged in if there law if they
pass our little requirements this is a
static method function by the way so if
they are logged in first we need to set
a session set logged in to true
and make sure we do a session in it
actually where should we do that I guess
I'll just do it right here okay and we
will also do a header location of - four
dot PHP and this one will be a header
location of login dot PHP let's try that
refresh oops
ooh I need to get rid of that PHP
dashboard index I got to get rid of that
let's try that let's go back refresh
submit and it took us to login slash
login I didn't really want that to
happen but I'm not going to freak out
about it right now let's try to go to
the dashboard and it brings us right
back here good so we can't get in there
let's try it with Jesse Jesse and it
tried to bring us to this wrong area so
what I'm going to do is for the location
I guess I'll just do boy logon I usually
set my paths absolute but I haven't gone
through all that yet it's up to you how
you want to do your paths login and this
will be -
so let's try that again submit login
good so I'll say Jesse Jesse and
dashboard there we go and in the
dashboard to logout I will create a
function log out and we'll say session
destroy
and we can just copy this little piece
of code face good and we're going to
need a link inside of the header and
what I'll say is if session get logged
in equals true
okay so we're first checking if they're
logged in and then we're going to check
HP else and PHP and if so if they're
logged in they're allowed to log out and
this would be what dashboard slash
logout refresh line 25 sorry forgot that
little nugget there and go back refresh
undefined variable session ooh I didn't
init my session really if you want to
work with sessions I think it'd be a
good idea to initialize it in a global
place the bootstrap is a little low down
but I don't know maybe the controller if
you wanted for now I guess I'm going to
get over it I'll just say session in it
in case it's not there and now we have a
logout link let's see what that does
undefined index logged in well it logged
us out but now we have a undefined index
on line 18 so we need to change our
session clean that up and I'll say when
we get something we're going to say if
is set session key
we'll return it otherwise it's not going
to return anything there we go
so let's try that again Jessie Jessie
login and we're there now to get rid of
this notice a quick and easy way you
could put a @ sign before it so I'll
refresh and now it's gone
so logout cool now we have a very very
basic login system what you're going to
want to do is probably organize your
stuff and make your functions easier
this isn't a 100% coverage of every
little detail we could do it's just to
give you an overview one thing I would
do is make a config file for your
database looks like we have one and
database right here and some parameters
we need would be the type the host the
DB name DB user and DB pass okay so in
my database PHP config file
I could just do this and I'll say define
yeah I think I'll just do these as
constants and constants should always be
uppercase in my opinion to follow a good
standard so let's do define
now when we have DB host DB name TV user
TV pass okay and then we'll have a nice
little area where where you configure
all our junk from okay so the DB type
remember in our thing it was MySQL the
DB host was localhost the DB name was
MVC the DB user was root and I had no
password now I just gotta flip these
constants in here here is that and DB
tight oops
dot quote quote dot dot TV host
DB named DB user and TB did I call it
pass our password pass okay DB name
equals there's a dot there and refresh
to make sure it works logout let's try
it again
and it's still working cool now there's
a lot more to go into this well we just
did it very simply for now this database
object this isn't all we're going to do
but that's it for now I will upload this
to my site and I hope this is helping
you along the way give me a thumbs up if
you liked it and thanks if you lasted
thirty minutes of watching this man
that's a long time alright see you later
guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>