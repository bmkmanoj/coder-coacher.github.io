<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Dependency Injection Pattern - DI IoC Injector Container | Coder Coacher - Coaching Coders</title><meta content="PHP Dependency Injection Pattern - DI IoC Injector Container - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Dependency Injection Pattern - DI IoC Injector Container</b></h2><h5 class="post__date">2016-06-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qzpm65Jw9Wc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up youtubers this will be the
dependency injection pattern now I want
to forewarn you this is more like a
storage container or an injector and
there's a lot of heated well I won't say
heated a lot of debate on what a real
dependency injector is like even laravel
the ILC which is a dependency injector
and version of controls are the same
thing they say that's not even a real
one
pretty much what I would use a
dependency injector for is to load
services let's say you have s Amazon
PayPal and a database object and these
three things you want to be able to grab
in different places in your project now
it's best to use this within a framework
and it's advised not to make a
dependency injector static so without
further ado let's go ahead and write a
class so we'll start with PHP and in my
repository it's here on the left I'm not
going to type out all the the comments
that I wrote
but basically dependency injector so
I'll just save this I'm just gonna save
it to my home folder is di dot PHP I'll
delete it later but you you'll be able
to go to my github I'll link it and see
the dependency injection I have a static
one and a regular one you can disregard
this fake email there so let's make
class dependent dependency injection or
dependency inject or inject or do I know
how to spell you could even call this di
if you wanted so
they also advised not to make these
Singleton's I've been doing a lot of
reading before I made this video so I'm
not going to do a singleton so we'll
just do a public function construct and
I'm just gonna leave it empty and then
we want to keep a list of everything we
put inside of the dependency injector so
we're gonna do it I've protected the
services okay because there is there's
two parts there's the container I guess
you'd call it which is the DI in a sense
this class and then the services items
inside the container okay so I mean you
could call this container and it's going
to be a dependency injector but I like
the name dependency injector for this so
what we need to do is set services get
services so let's just make a few
functions we can say set service but I
like the word register okay and then
we're going to do get service and I'm
just going to double check my code to
make sure
okay so this is actually pretty basic
stuff it's just a container now there's
a library by Symphony called pimple and
it's a container now they use SPL object
storage which is a bit more complicated
than just basic erase storage it's also
slow it uses more memory I think twice
as much memory than array III did I
didn't see the benefit using SPL object
storage I have a Z experiment here where
I was just playing with SPL object
storage and it does have some methods
which make it kind of neat but I
wouldn't say you really need it unless
someone knows otherwise that's that's
cool I'm open to any correction or
improvement so what we want to do is
register a service so let's say service
name you could call it name and then
callable now to protect ourselves let's
reference callable and I'm gonna
backslash that actually I don't think I
need to yeah cuz that's like universal
if you were in a namespace maybe you
have to back slash it whatever so all
we're gonna do is say this services
service name equals callable okay pretty
much as simple as that
and then get service we can put a
service name again you you could just
put name it might be easier but I just
want to be very verbose so so we have to
check if it exists and actually I'm
missing lines that I usually like to put
in here about whatever I always like to
do those de limiters like this alright
so we're gonna say return this
services service name and we have to
check if this exists so if all right you
could do in array also if array key
exists this services service name but
we're going to check if it doesn't exist
so if not if it does not exist we pretty
much want to maybe throw an exception
let me see what I did in my other code
so throat I'm just gonna throw a generic
exceptions bro new exception now I would
get used to doing these escapes because
if this was like a namespace utils if
you try to throw an exception like this
but actually be trying to throw utils
exception right so it's always good to
escape like that that's how come I
mention doing that but I don't think I
don't even know if that's needed and
it's 4:30 in the morning alright so
throw new exception the service service
name does not exist ok
so that's pretty basic all right so with
this let me do this so it's a little
easier to read all right so here we want
to return the existing service check if
the service exists and this is just
register a new service ok pretty easy
but back to this it's up to you really
like you could say if it exists
do I want to overwrite it and in this
instance this will overwrite it so you
would do the same thing here you could
say if the array key does exist then you
could throw a new exception ok and say
the service already exists like that
right but I don't really care you can do
that if you want to I'm not gonna
because usually you just set your
dependency to inject air files all the
services and one in one shebang so what
we're gonna do is just say di equals new
dependency injector alright so to
register a service we use anonymous
functions so I'll say di register AWS
we're gonna pretend it to Amazon Web
service so function and I'm just gonna
pretend case so you would actually use
the real Amazon package
so I'll just say object equals new STD
class object
name equals EWS okay you always want to
return okay from the anonymous function
so then it gives you back this is a that
the object okay and then let's register
one more di register and it will do
database function I'll just copy this
okay and we'll just call this database
save okay and then we're just going to
say di get service database okay now
what you would have is this would be
defined all in like a services that PHP
file right and it would be included
somewhere and then this would be called
where you need it okay so I would assign
this DB equals that and it would be a
real database I'll do one for AWS also
just to show you so then I'll say AWS
name and then DB name just some fake
classes so I'm going to echo that out
I'll echo that out and I'm gonna echo
PHP AOL cuz I'm gonna run this in the
terminal all right I'm gonna open my
terminal and PHP di dot PHP alright so
argument to pass to register must be an
instance of callable okay
instance of closure given in my on am I
really I didn't even type this right
column all right let me try it again all
right so I got that part right
no I let me clear it yeah I got that
part right because I can't tight and so
the array key exists I have the needle
haystack in the wrong order which is why
PHP drives me nuts
handle what Terminal was it was this one
no is this one no let me close that all
right so I'll run it again all right
clear PHP di all right
closure object cannot have properties
online 52 and 52 is this so we do have a
problem because this is not returning
the service correctly so what I'm gonna
do is just a var dump of AWS and then
die because if it's a fatal it won't
show us the air sometimes so we have a
closure we don't want the closure we
want the object
so when we get a service we want to do
the function call so callable whoops get
serviced and we want to put this here so
that it runs the function which returns
our object all right so there's AWS and
I'll go ahead and delete this crap and
run it again and now we have a little
dependency injector on the most basic
level
now you're probably wondering well what
if I want to pass arguments you can do
that too
let's just make a fake config I'll say
config equals and pretend it's an array
okay and I'm just gonna make one config
AWS and then DB and here I'm just gonna
do a user and a password for this Jesse
password will be food and for AWS just
I'll just make a key is one two three
private key equals ABC okay so you can
do this and just say use config AWS
actually we can't I don't think we put
it on right in there so we'll just use
config and the same thing for this one
use config you can do this on closures
so I'll say object user equals config DB
password oops
user and this one will be password and
boom boom and this one will be this key
equals config AWS whoops
a key and then private key okay so now
instead of just echoing out one thing I
just want to print R of AWS and database
okay so I might have typed fast but you
can pause it and take a little gander at
it so I'll Pat I'll press up and press
Enter
using this one not in object context on
line 49 well silly me
sorry about that okay so and what do we
have we have an STD class SCD object
with a name and a key oh I'm so dumb
I need to change this to private key I'm
sorry it's late they're an undefined
variable database
this was DB there and you see how we can
pass this in and it's all gonna be set
for us so I mean if you're really clever
you would know how to say if pretend you
had a constant called environment right
equals local right you could change your
config elsif environment equals staging
you know and you could load different
configs and stuff make sure you're not
hurt in the real database
there is a magic method that could be
used which I'm going to attempt you
could stop the video here but I'm going
to attempt it so I'm gonna say public
function dip dip set and what this is
gonna do is say service name and it will
be a callable callable and it'll say
this register service name and callable
okay so with that we're just gonna try
this I like to take risks I'll say di
email equals function and return email
let's make a I mean you can return
anything I like to return objects though
you know it's got too close these with a
bracket ending thing because there are
anonymous functions so I'll just
duplicate this stuff and I'm gonna try
to do see if it worked
d I get service email okay
and we'll do email oops I forgot to
assign this email I don't know what's
gonna work all right so we're on it and
that did work so that would mean we
could use a custom gap on it if we want
it to this is like if you're lazy so
service name and then whoops here I
think we just call our get of return
this.get service service name and it'll
throw an exception if it doesn't exist
so we're defining it here
so instead of this I'm just gonna try to
say let me make email an object okay so
I'll just copy this oh and we'll return
the object boom and the name will be
email okay real simple so now I'm just
gonna try to call it so if I say email
name let's see if that works I'd be cool
yeah it works so that magic getter and
setter does make it kind of neat like
that and we could say maybe make a
method like this also if you wanted
public function get services and return
this services actually return array keys
of this services okay and this would
just show us what's defined or available
let's call it list services because that
confuses you with get service list
services so down here I'm just gonna say
where all this crap is to find extra let
me delete this and make sure it still
works all right yeah that didn't work
they get di email why would I think that
would work without calling di like that
that should work there we go all right
so that's the fix to that sorry about
that mistake because you know it's the
met the getter has to know what class
it's based on so
di lists services print our of all this
stuff and let's see what we get
alright cool so we can list out our
services you could make another function
to string or whatever I'll just put a
parameter and here is string equals
false and I'll say if string first let's
just call this keys equals that if it's
a string will implode it by commas and
this purse are keys and I'll say return
and plug that otherwise return keys all
right so now we'll try it both ways make
sure it all works and I'll say true and
I should be able to echo this because
one should be a string all right so then
we can list our services here which is
nice as far as arguments I actually
don't know off the top of my head but
just for the heck of it let's just see
what this does
argh I don't know what that's gonna do
now we did get an error missing argument
for closures so when we register this
and call it
we need you would need to if you wanted
to pass arguments who would actually set
it in the dependency injector so that
when we get a service let's see args
equals you know right so we'll check i'm
just free-balling it if not empty args
class equals new reflection class
instance equals class R
let me check on reflection class can't
remember
ours
new instance args new instance arcs will
be arcs alright so when we get it we
should be able to the only problem is it
is that this is just gonna overwrite the
instance each time so I'll try it okay
so if we were to pass args let's just
say argh object fake ARBs equals R ok
I'll do it twice fake are zero like if
you have more than one argument that's
why I did it alright
so with AWS when we get it we could put
a comma here and say hi comma mom I hope
that works I construct expects exactly 1
parameter 0 given I didn't include the
class name reflection class would be
service name that might be wrong
yeah cuz there actually is no class name
that crap
I guess callable but that's not a class
see that's where it gets a little tricky
if I don't know how to do that right now
you probably have to set a separate guy
and then instead you would say like this
arms service name args if not empty you
might need some validation I don't know
if that's even gonna work mmm it did ok
so like that I'm gonna put this in a
gist and I'll link it sorry for the
wrong video I hope this helped make
sense of dependency injection or kind of
the unofficial container for services
whatever you want to call it and I think
we covered most of it thanks for
watching guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>