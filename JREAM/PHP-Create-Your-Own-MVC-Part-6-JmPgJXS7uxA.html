<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP: Create Your Own MVC (Part 6) | Coder Coacher - Coaching Coders</title><meta content="PHP: Create Your Own MVC (Part 6) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP: Create Your Own MVC (Part 6)</b></h2><h5 class="post__date">2011-12-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JmPgJXS7uxA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up youtubers this will be MVC
tutorial part 5 the first thing we're
going to look at today is security with
your passwords and if you can remember
when you created this when we login
we're only doing md5 hash passwords so
if I go to my database and I look at my
passwords here this isn't totally secure
and the reason is because people can
have a dictionary in there all over the
web so if I just went to Google and
looked up md5 reverse let's pick one of
these and I'll copy this paste and this
guy's there we go and you see it knows
the actual what it is and the reason is
because they just have a big dictionary
to look up and all that so what we want
to do is something called salting our
passwords and basically you can do that
with adding just a string to the end to
it or whatever and I have a certain way
I like to do it I use a function called
hash in it in PHP so well I could
actually use it here what I'm gonna do
is actually create a new library and I'm
gonna call it hash okay
this will be the last hash and it's
gonna be a static function so that we
can just call it anywhere public static
function great and what I'm gonna use is
called hash in it there we go and the
third one the algorithm we want to use
the options and the key okay and the
algorithm
it would be like md5 here so you might
type md5 the options we're gonna do hash
HMAC and the key would be our hash key
so what I want to do is have the option
to have this class create any algorithm
we want so I'll say L go so they can
pass in the algorithm and then they can
pass in the key I'm gonna call it salt
just because it kind of makes more sense
and then I'll say context equals
passionate algorithm and I will do a
hash update of content and the text we
want to pass in basically let me show
you it we're gonna say this hash great
md5 password here and solved if there is
one we do want to have a salt so I guess
I'll do data context data and we could a
little return hash final context okay so
what we want to do is make sure we know
what we're doing here social is PHP doc
this stuff let me delete this so that it
hangs right there we go so this is a
string string string strength
okay that's good
so now we know what we're doing cool and
what we're gonna do is try out the hash
so I'm gonna go too long and not PHP and
for fun I'll say hash great and the five
of test and just leave it empty and I'll
echo that out I don't know if I have
this included yet so I might have a
little bit of an error where did I
include that shrimp that down if use
config Oh index okay okay so I'm just
including these manually what you'll
want to do is use an auto loader at some
point maybe I'll go over that so I'll
just ctrl shift down arrow and I'll
include hash inside of here and now here
go to the login page okay I guess we
have to include a key
oops photos put the number one in there
refresh does oh yeah so basically that
hash it up the same word yet it's
different you see how it was test in
this hash is different I just added one
one for the key I could say um life is
long and refresh and now it's still md5
yet it's salted and it's not going to be
the same as in these dictionary lookup
so that makes it ten times more secure
maybe a hundred times more secure so my
suggestion would be maybe have a config
file with some options maybe some
constants like a hash you want to use
throughout the system so I'll say new
PHP file I'll call this constants have
mercy on me I don't exactly know what
I'm naming everything I was called
assisted hash about hash key so we'll be
fine hash key and then you have
okay so hashkee okay so you could even
just type in some crazy thing like that
nobody whatever guess so that'll be my
hash key and I need to include the
constants PHP file so down here just
include constants okay
and inside my login I can change this to
the what is called hash key like that
and refresh and we get a crazy-looking
thing you don't want to change this
again because if you have them in the
password and your hash key relies on a
certain hash key if you change it you'll
get you won't be able to log in and all
that stuff so you really need to make
sure that this is not changed once you
decide on what you want to use so what
we'll do is with the login form I'm
actually gonna change this just one more
time so that it's easier to follow so
I'll say cats fly high to under miles ok
just something random and silly and by
the way you could also do sha-1 if you
desired I believe you can do two sha-256
all the hash keys that you want whoops
but we're gonna stick with md5 for now
so I don't have to change the database
so in the login model we want to change
something I'll just cut this
login model and you see how we're doing
the thingy here here it is post password
so what I want to do is we're getting
these posts down here and you know these
these aren't really clean sanitized data
we haven't got too far into that but
what I'll be doing is creating a hash
out of that post so for the password
I'll paste that in there get rid of that
semicolon and paste that in there okay
and that will create the salted
appropriate hash cinema doodle and right
here I can take off this md5 part in the
query because it's already being
converted down here I'll go ahead and
delete the little parentheses around
there okay now one problem we'll have is
that we don't actually have the new hash
passwords inside of the database so let
me just make one in here I'll say test
oops I need to echo that out
okay so refresh what did I do
log in on line 12 I forgot the semicolon
so refresh and here's my test password
so I'll edit this guy
and I'll paste him in there so that's my
fresh salt and let's see let's try Jesse
and test and that logs in okay so that's
one good step for security if you have
to redo your guy's logins you should we
also need to update the user model when
we create a user right here if you
remember when we log in we have users
and we can create a login and a password
so if I went Jesse Jesse - and test ok
that creates him but let's see what
happens see it's using the default md5
hash so it's not going to be good with
our system so that's what we're gonna
fix so when we create we're gonna kind
of do the same thing as we did with the
logon it's a hash create and data
password goes right there
ok now you could hard pull this into
your hash thing here so that you didn't
have to provide a salt you could
actually just delete and do hash key
like that the reason I didn't do that is
because it's less flexible yeah it's
more irritating to type in every time
you do this but hey maybe you want more
than one hash key for different things
you could have this as like hash
password key I'd say we'll go ahead and
do that
I'll open up my constants and call this
- password key and this will just be
attached general key so this is for
database passwords and this is so if you
wanted to mix it up and make it a more
secure and I'm just going to make sure
to change that in my logon models so I
have hash password key and under the
user model that's password key okay and
we're also gonna have to fix when we
update the guy here so right there and
face okay so I'll go ahead and refresh
make sure if I edit Jessie - I'll just
type in test submit and browse and he
looks like he has a different password
so that's a problem about if I create
test - to test browse ok that's good but
this guy I wonder what his password was
different what did I do
constants hash password key login I'm
gonna close that come on close index so
the login tomorrow
use the hash password key user model
that's kind of funny maybe I missed
something
mm-hmm so let me edit Jessi and change
him to test see if that updates okay now
I have the same password I'm gonna log
out and log back in just to make sure
good that did not work good
so my login it's because I messed with
all these constants sorry about that
hash password key that is the logon I
guess I'll just echo this out again to
see what's going on login.php okay
refresh and I get that f3b
thingy so something is going on with my
actual user model let me open my user
page and mm-hmm I go out the same thing
like why would it be different so I'm
gonna actually have to update this real
quick sorry about this so just test and
users and yeah I get the same thing so I
wonder what's going on with my password
field so OH here's why when I create I'm
encoding it before I pass it to the
model so I gotta get rid of that
and same with the Edit sorry about that
I can get rid of that and that should be
good so I'll go ahead and refresh and
try this again edit so this should stay
the same
and I'll do Jessie to rename them to
text I'm just going to change all these
to test
so hopefully the database reflects that
and browse there we go it's that f3 be
cool so just so that you got this really
good down if I were to work on something
and change a constant if I just added
one thing there and I want to login with
Jessie test I'm not getting in so make
sure you don't change this after you
decide what you want to use and what you
should do is use different hash keys for
different applications because that's a
good idea
so that takes care of that what else was
I don't look at let's see users
okay what we're gonna look at is an
autoloader and I'm just gonna close all
these right now and open index however
you decide to organize things that's
really up to you
Marlene so an autoloader I'm just going
to use the plane built-in auto load
function boom boom auto load now there
is one this SPL auto load register you
can take a look at that SPL auto load
register but we want to make this pretty
quick and easy for now so what we're
gonna do is require a class whenever
it's called
so like you know when we load a page and
it calls let's say the database object
it's going to automatically include it
with this auto load function so I'm
gonna use it the same way I'm doing here
which is with require okay and instead
of this database dot PHP I got to change
that to class so I'll pass in a class
here class and double quote that okay I
think that's good I'll go ahead and try
to comment those out oops
yeah those are all under libs okay so
I'm refresh and lives bootstrap not
found require the libs bootstrap oh
forgot the dot PHP
so let's try that refresh there we go
and now we just have one line of code to
require all these lips here you should
know that your class in this scenario
anyways the file name would have to be
the same as the class here
see how it's bootstrap capitalized on
Linux you know things are case sensitive
so you're gonna have to be careful about
that on windows they're not case
sensitive so not to worry and that just
loads up you could even do something
like if file exists if you want check if
it exists first in my opinion you
shouldn't do that because it'll waste a
little bit of resources and require I
think it kills the page anyways if the
class isn't found that's a good enough
error checking for me so all these lives
are good too though we probably want to
require these I think before the auto
load so let me refresh and make sure it
even works so log out Jeff seid test ok
and the reason is because these
constants and paths we could actually
use those at some point so if I want to
define libs
it's coming up here always provide a
trailing slash after eight
that's all I like to do it so have libs
and then I could just say lives class
dot PHP and make sure it works looks
good so now we have an autoloader
require all our goods so what else could
we do one thing we could do is pimp out
the database here how we extend PDO you
can also see how I pass in constants
here I don't think that's a good idea
so instead what would I do
I'll say where do we construct the
database where's that the index no no
that was in the bootstrap see that's
actually my model oops
there's database I won't construct
something I'm not gonna go into all the
details in it I've written a blog post
about this don't worry about it it'd be
better to just pass in an array of
things so I'll just say
hi TV host db9 TV user deep-ass okay and
I'm just gonna do it this way you could
pass them on all right name TV user DB
we don't want the database object to be
fixed on constants because if we use
this elsewhere then we're forced to use
these exact same constants from another
file and basically what it does is it's
not dependent on another file that's
what I'm doing it for so I'm just gonna
copy all these save that and when we
construct I'm just going to pass the
constants into the construct so now we
have a more flexible database object and
again I'm going to refresh to make sure
it works
users good
so this for extending PDO there's a lot
we can do with this it will take a quite
a long time to actually make it really
sexy one thing we can do is set an
attribute of how we want the database to
do stuff and I'm not gonna get into that
but here's how you do a parent set
attribute video if you want to set the
error mode this is all in PDO documents
opilio or mode exceptions I like to deal
with exceptions
so if you know it throws new exceptions
I think that is actually on by default
so what we're gonna do is make a little
more convenient of an insert and an
update so say public function insert and
with insert we always insert into a
table and we're gonna provide data the
data is gonna been associative all right
it takes a couple seconds to type in
your little comments and they'll help
you later
so boom this will be update and update
has table data layer so this part will
be a little different now close out the
model close out the database PHP comes
out the paths and close out index so in
the user model here see how we're doing
this dd prepare DB execute we'll go to
edit save we have a lot of redundant
data and we're gonna do something kind
of similar to this let me just paste
this in here okay
so first of all we want to insert into
table so I'm going to change this to
double quotes like that so so that
parses table so this is this is there in
the table then the values are here okay
we're sorry the columns and the values
here and what we want to do is create a
loop to match up the two so there and
execute a bind so this will be an
associative array meaning I'll when I do
an insert I'll do it like this this DB
insert users and array and what I'll say
is login this test
password this test
okay and this this will do all the hoops
this would do the entire thing and we'd
be able to add any row and value okay so
to do this I have to grab the second
argument which is the array the
associative array and that is called
data so what I'm first gonna do is sort
the data by key okay so case or data
this step isn't necessary just so you
know I just like things to be in
alphabetical order because who knows
okay and we're gonna try something out
real quick let me do die so I'm gonna
die here so that I can see what's going
on and it's I got these flipped around
then we'll confuse getting a little
comfortable he'll use a model so we're
trying insert and then we die so print
our data sorry if I'm going fast what
we're doing is we're just gonna see some
output when we try to create a user so
test two and here is the stuff that's
getting passed into the database kay oh
this prepare so I want to create a list
of the field names and the field value
so field names equals
I'm just doing an all-time field values
equals and this is going to be a list of
automatically generated names field
names field values okay so we have an
array we want to implode an array we
want to do Thomas and all I want are the
array keys I'm gonna echo that out let
me refresh okay see how we have that now
login password role and that will go
into the field names okay
and for the values
okay for the values it's just mm-hmm
it's the same thing but with a semicolon
let me echo this out and all this is
forced for the binding part so refresh
and here's password role okay
Oh login that's also gonna need it so at
this time I call them they're in these
fields need these little things just in
case it's a reserved word and I'm also
going to insert them right here so that
it wraps around it blue that's right
let make sure I'd die there just so I
want to echo this out
see what it looks like so far continue
let me get rid of these sorry well
refresh let's see what insert into users
login password rural values long and
password roll that does look good and
now all we do is a loop to bind the
values so I'll say that would come after
we set up the query and you see how we
bind stuff down here I'm going to say
for each data as he value and so let me
make sure that looks good so remember
we're still dealing with our array here
all we did was we have our login
password all the keys you see here they
are here on the password roll and
logging password a roll now we want to
bind the preparedstatement into each one
of these I'm gonna refresh and make sure
so I got test test test looks good and
to bind we'll say sth that is fine there
is fine value
and the key name the key and the value
okay and to execute we don't have to
pass all these in okay so this this is a
mouthful of stuff huh so there's our
automated insert let's refresh
I got a die-in they're still back to the
user model I'm gonna get rid of the dye
and I'm gonna try commenting these out
oops
save refresh ABC ABC and looks like we
have the word test in there for some
reason let me browse some day is not
passing just quite yet
oh here's why we still have to pass a
post of data in the model that's
embarrassing there okay I'll try that
ABC ABC there's our new guy browse and
cool he has a different password so now
we have a beautiful new insert feature I
don't know if I have any more insert
statements in here but when you use this
throughout your thing you'll be able to
do it all good so we can use the same
kind of context with our update I think
it's maybe no the update queries a
little bit different I'll try to go
through this quick so first of all we're
going to do the same thing here let's
just copy all this
okay just gonna sort of you know so
change our query to update table and
this does things different so set field
details I'll call it where where so as
you know an update is a little bit
different than the insert its update
table set I'm one equals a item two
equals B item three equals C where
something okay okay so so we got to
build the string out like that so we
already know what our database thingy
looks like so I'll say for each data as
equals key equals key
okay oh yeah we're going to want to
build a whole string out of this so I'm
gonna append to it so details so I'm
gonna see what this string looks like so
far basically we're just building this
piece right here so for the update it's
going to be kind of the same as an
insert it's going to look like it the
only difference is we're gonna pass in
an ID update and our wear statement was
the parameter right here so we're what's
where okay sorry about that I got a
little brain freeze IDs login password
let's see what that does
by the way you could also put this in a
separate array so it's easier to use
like this call it post data so you know
we were on our update right there so
let's go refresh let me edit one of
these guys okay so our string is login
equals log in comma password that looks
all good gotta trim the last comma we
are almost done
so um field to field details field
details equals our looks right trim
itself
the comma I noticed that I have a space
here so I'll just get rid of that you
can leave it if you want but it'll be
easier to remember like that so refresh
that's good and then we can prepare a
statement prepared table filled details
where something and we just kind of loop
through this again to bind it all up
execute oops let me get rid of the die
statement I thought I had one in that
refresh continue so let me edit this guy
here and say dogface and one two three
and dogface one two three
and here he is sorry for the long
tutorial guys and I hope I explained it
well enough again I will place the files
on journey.com slash lab under open
source and let's see it will be under I
guess it'll be on the part six I called
this part five for some reason anyways
thanks a lot for watching guys I hope to
help ya</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>