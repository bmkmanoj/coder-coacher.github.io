<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP: Create Your Own MVC (Part 9) | Coder Coacher - Coaching Coders</title><meta content="PHP: Create Your Own MVC (Part 9) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/JREAM/">JREAM</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP: Create Your Own MVC (Part 9)</b></h2><h5 class="post__date">2012-08-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7-_MaymNHMM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up youtubers this will be
part 9 of the MVC series and what I'm
going to do is actually download the
file because I don't always save it so I
just go to my lab open source and down
to MVC part eight so I have the latest
copy and the reason I'm doing this is
that so you could start off where we
left off I'll just copy this guy here
here's my MVC folder and I can grab this
SQL dump copy all that and I'm going to
open up heidi SQL i prefer using this
for my my sequel and I'll open up my
localhost connection I believe we've
already gone through quite a bit of this
so all I got to do is create new
database and the C and paste and refresh
so there it is
okay so we have that and I'll just open
up NetBeans now I'll open an existing
project MVC open and I can go to my URL
so I'll go to workspace / MVC there it
is
I'll log in with Jessie Jessie and what
we're going to do is go to users it
looks like we have a does it work yep I
can't delete him because he's an admin
so I'll say Jesse - Jesse - submit there
is okay so we have that working all nice
let's try making a collection of notes
for our users so what I'll do is go to
controllers and I'll make a new one I'll
just copy paste and I'll say note and I
can shrink this down a bit say class
note and our construct we're just
checking if the guy's logged in we get
his role all that stuff actually when I
look at this it looks like uhm this is a
lot of duplicated code right here if I
were to go to say dashboard and this
looks like something that's going to be
abused I'll let that stool my brain a
minute I don't want to make a project
too confusing what I mean is this an
option we could do and I'm just typing
this out so you can see it it's not real
code if I have my controller I could
make a another controller that was kind
of like my
controller and dashboard so it would be
like my dashboard extends my controller
and my controller would extend
controller and then there'd be
controller what I try to avoid this
because I'm I really don't like
hierarchies like this unless this will
be very simple but I would prefer to
have a function within here and
basically that is to favor a composition
over inheritance and this is inheritance
now it's not necessarily bad but getting
too many levels deep you'll find
yourself in a mess later so I just try
to kill it when it comes the whole
thought of it what we could do is make a
static system to check the session so if
I go to my models libs
I have a session in here we could create
a new class it's not necessarily a
library it's more like a helper or it's
really hard to say it could be a model
I'll just create a new folder
and I'll call this util and that's for
utilities and I'll create a new file and
I'll call it off
and this is for authenticate so class
off I'll do public static function so we
don't have to instantiate it I didn't
think of a name yet so I'm going to take
the session to get the logged in status
okay and I'll call this check logged
okay so this is dependent on the session
class which generally is not a good idea
our session class is static what are we
really doing here
I want to decouple session from off
because if for some reason if I ever
were to get rid of this session in here
then this whole class would be broken I
don't plan to and usually you never mess
with your libraries but in this case I'm
going to just because it doesn't feel
right like this so I'll say if
to session start and log will be session
logged in so soon destroyed and we just
do a header and I'm going to double
check what I did for my session start
inside the libs
I guess I put a @ sign before it we
could check if this session is started
but I'll just do this anyways okay and
instead of checking logged in this is
more like handling it so I'll say handle
logon okay so in the dashboard here I
can just say off and the logon
and note I can do off handle logon and
do I have any others error not help not
index not login
it's an user though okay one thing we're
going to have to do is load up the class
manually because we have a separate
utils folder so let's see index I will
just I don't know if you can do tool
autoloaders with this actually that's
not what I want to do I'll say require
util slash off dot PHP okay and let me
refresh make sure and behaved okay cool
okay so back to the note note and this
util would eventually grow so I'm going
to make a model for note I'll just copy
my user model and paste in here I don't
know nope model just to note and we're
going to get a note list
I want a single list yes for editing
create edit save and delete okay
and we'll adjust this in a little bit so
I'm going to run our note slash index
and I need to create a view for note and
then folder I'll call that note
and just like my user class I will copy
the index and note and I have a j/s
folder here I guess nothing's in there
did I put it in the actual code here
well lately I've been putting my
JavaScript code just in the view file at
the bottom of it because I don't know
it's just easier to get to read and make
it a bunch of folders but it's just
preference you know just change your way
sometimes I'll call this note and I'll
call it's for each note list as key
value there's a bunch of stuff here I'm
going to comment out and get rid of a
couple one of these
okay and we have to change it to no
slash create I don't get good for now
and we also need to change the header so
in the header if they are logged in
everyone's going to be able to create
notes so I'll call this note notes and
refresh notes so no models okay so we
can head over to our controller and on
the index page we have a user list
method
this needs to be no list and this needs
to be note list so that our view this
view note list oh I see we're assigning
note list to the view so we have to make
sure our model matches up with note list
and what I'm just going to do here is
select all from no we don't have a
database yet
but we will get one ball from know where
ideas ID so before I get into these
portions I'm going to create a new table
I'm going to call it note and I'm going
to call this no ID this will be Auto
increment for a note I guess we'll give
the title and I'll give it a bar
character of say 50 the default so no
default and how about a desk friction
you can use the word des see about my
SQL that means descending so you have to
put ticks around it if you do a manual
query so let's just do the description
this will be text or let's call it
content that makes more sense and then
date add it is a date time and make no
ID d primary and safe okay and so I
don't forget
I should probably export this table what
I'll first do is pop a couple records in
here so I'll just say insert Jessie this
is a no okay and date at a big time
default okay
so back to the here so we insert data we
are going to insert on the title the
content and the date edit other existing
data content data title and this I don't
know what I'll do with yet and I guess I
could copy this well I got a copy this
array paste it there so give it a date
added ok and delete you know what we
need to do is assign a user to these
notes so I'm going to make a new one
call it user ID and this one will be a
int
and I'll make it a key there so now
users will be assigned a note so when I
get the note list I want to select all
from know where these are d equals user
ID say array user ID is session user ID
I'll pop that onto my so you can see it
okay and for this guy this is just a
null and since we want it to be
permission based I'm just going to do a
precaution and say user ID equals user
ID and ID is ID so user ID user ID per
session I'm sorry okay and when we
create since we have user ID now we'll
say user ID session use your ID
I don't like this update I did but Wow
okay so I'll pop this on another line
basically it's I'm just checking if the
user IDs their forgot a comma there and
delete so we want to let guys delete
their own things so DB delete no and
it's pretty much the same thing as this
string here as the update okay so it
looks like that's all good so far and in
the notes instead of this we're going to
post let's do it a different way just
for fun I'll say title is post title
content
and we'll just redirect them to the note
page okay edit I change this to no it's
a lot easier than writing this from
scratch which I already have a template
laid out for us we don't have an edit
page for a note so up here the data just
give it all this crap done at it's a
delete ID okay and now let me just
refresh the page make sure we have it
legit note model line 1313 is user ID
undefined index is your ID I'm going to
print our session let me see if I have
in here we're all logged in ooh that's
not good what I want to do is when I log
in to store the user ID so my login
controller looks like I just do a model
run so I'll go to my login model so we
could do a prepared statement executes
this select ID roll
is that I really call it ID that is so
embarrassing
why would I do that so have person ID
what's that oh it's about I'm going to
change this to the user ID it just makes
more sense I'm going to change this to
data ID you might say why because if we
join tables we won't have an ambiguous
problem with an ID primary key here and
then one of the other tables so I'd like
to have a unique ID and that might cause
a couple of problems on a couple areas
so user ID and for the session I'm going
to set the user ID to data user ID I'm
hungry okay
and to be safe I'm going to check my
stuff in here now the model the user
model so select the idea just need
changes to user ID user ID
man
we're user ID ID I'm just going to
change all these these are DS your ID
because I do not like that inconsistency
I'm going to do a look for ID and I
still have one ID ID get it nice and
consistent oops
do we have any other culprits it looks
like it's it going to double check the T
user controller for ID okay okay this is
just a variable so it doesn't really
matter just to make sure let me make
sure this works nope I gotta go to view
page user index and I'll change the
value in this loop to user ID and
refresh and line 24 and 25
delete could edit the edit page also
needs it
sorry about the hassles but this is so
annoying
ID have any others doesn't look like it
undefined index online 10 user login
I want Sussex our arrow doing there I
guess it's supposed to be there I don't
see what the problem is user ID the
login in their user login oil owner on
the find index role so in the edit page
user these are single lists by the way I
just right-click my mouse wheel to get
to this or user D equals user ID how's
that an undefined index do I seriously
have a zero there it looks like I have
to put a zero in here I don't know why I
miss that let me just make sure that's
right i refresh
mmm whoops didn't save it there we go
refresh and you'll be able to download
the source code to make you happy okay
back to notes so log out and let me log
back in with Jessie Jessie and back to
notes and I have my user ID in there
sweet so all that little bit of
refactoring and close out some of these
pages so I don't get confused header the
note index so for this we're going to
need a title and content
change the name of this forum to title
the same as our database fields and I'll
comment some of these out so let's see
what we have
I know we'll have a title and that's all
I want to list date added okay and for
the note page for creating it we post
the title the content may refresh this
that looks bad back to the view forget
my break tag okay
title date added okay refresh so test
test submit let's see if we got anything
in the note table nothing but we also
should be getting some notes back oh I
don't have a user ID assign that's one
problem so I'll give my user ID I
believe it's one user one nope user ID
is one what's
refresh and he's not getting anything
there so note
no model so the note let's select all
from nowhere user ID equals one I'd like
to do it sometimes test this out just go
in here and these are D equals one
that's not it I forgot the work from
user ID equals one and I am I'm a buggy
guy today select all from now from now
refresh okay there's that note test test
it did not go in so create date added so
to make a my sequel date time we can say
date of H I s or sorry
why mdh is and we can pop that in here
that's how my sequel does date times I'm
not going to get into time zones with
this but you should probably do GMT GMT
akka UTC time which is at 0 hours
because it's the easiest to apply a time
zones to if your application does grow
so my problem is I'm inserting in the
user is what we call a newly mistake my
friends I'll make this a note this one I
have to say note let's try again
test test submit there it is there it is
and we want to delete and I want a note
ID
and we say a href equals
take this guy out
delete pop him in and we can make a call
to do a delete so what would I do
URL dot no dot delete okay
refresh I'm going to see what this link
is let me see nope delete one
let me see nope delete - okay I didn't
even try clicking that cool it deletes
it so let's do this
class equals delete and I've thrown some
JavaScript make some script tags and
we'll say document I'm ready
we'll say delete click
function preventdefault and basically
what that does is if you click this link
it's not going to go to the URL and what
I want to do is say VAR c equals confirm
are you sure you want to delete and if c
equals false return false okay and let's
see what that does
delete delete and it is not happening so
if we have a error but I have jQuery in
here okay query men coming from Google
API why does it not cooperate delete
delete a class is delete click function
let's go to that get rid of that
preventdefault
that's weird
function dot delete click function this
has no class in here why is that but I
have it right here my in the right place
nope I'm in users I'm so stupid
you sure want to Lilly cancel refresh it
should still be there we sure want to
leave okay it deletes it beautiful
yes I suppose we'll just quickly make an
edit page just paste that in there I'll
say no pet it and get rid of this stuff
and note edit save this note 0 we're
just changing values around in here so
title content obviously if you want to
style this already one that's your
almond and in here we'll do PHP echo
this note 0 content it's kind of hard to
read all this stuff with that title this
needs to be called title this needs to
be called title in the sky here nope
okay so refresh whoops nope okay so we
can put in empties and all that
if I want to edit it I need to create a
link so I'll just duplicate this guy and
I'll call this edit I don't need a class
for it but I'll say no / edit edit let's
see what happens
edit and undefined on line four and
let's look at the look at the note model
under edit you know list a note single
list so notes and goal lists I'll go to
note edit note single list let's see
what happens
print are of this note refresh and it's
empty
so if empty this view note I'm just
going to die
you can handle errors a way better way
than I want to do I don't have time to
do it in these videos it's already 30
minutes going so I'll say die
this is an invalid note also what I'm
going to do is I'm going to echo out the
ID so I can I can make sure that this is
actually going through so refresh cool
too is going through now the question is
in the note model let's see what's up
with this Oh nope user ID ID no ID oh
that is so embarrassing
note ID will do the same thing as I did
otherwise don't ID edit save note ID
note ID
and I'm going to check my controller if
I have any ID and pass that doesn't look
like it so refresh this is an invalid
note this is lying to me notes in the
list select all from note where does it
go - duh so embarrassing
this is being note ID and I gotta get
rid of the semicolon well I'll refresh
that
there goes there's that beautiful editor
I can throw a br tag here and let's see
if it this even works so I save that and
that did nothing so this goes to edit
save this no ID so in the no control I'm
going to look at the note or the edit
save here this post title post content
and it's safe I'm going to right click
with my mouse to go here and in the note
model
I'm just going to see what happens
select test test one okay so update note
with this post data where no ID equals
data I'm going to put quotes around that
and user ID equals that refresh why is
it awesome redirecting me to use or that
is so embarrassing
let me change this to no notes asdf too
I wonder why that's not saving so it's
safe if I don't do a redirect I can see
the error edit save undefined index note
ID model 9:40 I'm not even passing the
no ID in here but I think this is if I
edit save this the no ID is going to
interrupt with the data
I see post data is just like that okay
so that should be good and if I'm
variable no ID and I'm just not with it
today it's too late
alright there we go old ID refresh and
find the next note ID I am really sorry
that I'm that retarded this should just
be whatever this is up here I'll change
it refresh
so I can get back the header location
let's try it again notes edit okay okay
so that's working cool I was going to do
in Ajax with all this stuff and make it
nicer but you know this series is
already started and what can I do
let me make a new blog called Jesse -
Jesse - and log out and I'm going to log
in as Jesse - Jesse - notes he has none
because he's a new user say dogface ok
there's dog face
now I'll log back in is Jesse go to
notes and there's no dog face so now the
user has their own notes and I know this
site looks pretty pathetic it's just
really difficult to run through it all
smoothly sorry for the refactoring guys
might cause a bunch of headaches but I
already put almost 40 minutes in the
video so I might as well publish this
hope nobody gets mad and I'll upload
this new zip file onto the download area
of dream comm thanks a lot for watching
this</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>