<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Inserting Data Into MySQL Database Relational Tables Using PHP | Coder Coacher - Coaching Coders</title><meta content="Inserting Data Into MySQL Database Relational Tables Using PHP - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Clever-Techie/">Clever Techie</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Inserting Data Into MySQL Database Relational Tables Using PHP</b></h2><h5 class="post__date">2017-02-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/X0CNo2qAYy8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's going on it's clever
ticket and in this video were going to
be learning how to insert data into
MySQL database which has many to many
relationship syntax looks like for
inserting selecting updating and
deleting data into MySQL tables okay so
for the insert we have insert into
keywords followed by a table name inside
the round brackets will have columns
separated by comma then we have a
keyword called values and inside the
round brackets we have values separated
by comma and make sure to always enclose
your values into single quotes when
writing that code in PHP so the value
one is going to go inside column one and
valley two is going to go inside column
two and you can have as many columns and
values as you want next up is select and
we have select keyword followed by star
if you want to select all the records
from the table we have a keyword called
from table name keyword where and then a
column name equals valley in closing
single quotes and you can also have as
many columns as you want by adding them
with an keyword and then following that
by column name equals value enclosing
single quote next up we have update
table name set keyword and whatever
column you want to update so you set the
value of the column name equal to new
value and close that in single quotes
and you can also have as many columns as
you want by separating them by comma so
you follow that by another column and
another value and then you have where
keyword and column name equals value in
closing single quotes to make sure MySQL
knows which exact columns you try to
update finally we have delete delete
from table name where column equals
value and if you omit this part here so
you can just write delete from table
it's going to delete all the records
from your table so that's basic my SQL
syntax and that's all we're going to
need for this video okay so what we're
going to be doing here is we're going to
be inserting data which we're going to
be scraping from Internet Movie Database
IMDB com
now we're going to be inserting all the
data in our database which we have
created in the previous video with
many-to-many relationship
now that kind of a tricky part is going
to be inserting the data inside of these
many-to-many tables and the way we're
going to be doing this is inserting the
movie ID as you can see all these three
tables have movies ID and it also has
directors ID which corresponds to the
main primary key of the tables which
movies is linked to so for the directors
has the directors ID stars has stars ID
and genres have stars on rows ID and the
way the tricky part is knowing which
movie is associated which with which
director and what movie is associated
with the star and which movie associated
with what genre and for that we're going
to be using a special function called
MySQL I insert ID which gets the last
key of the movie ID which has been
inserted into the database so that's how
we're going to know which movie is
associated with which ID because we're
going to be getting the movie ID which
has been inserted last okay so if you
guys don't have this database yet
just go ahead and go to clever techie
calm and click on this article here and
I've included all the SQL source code
down here so go ahead and just copy the
whole thing and you can go to PHP
myadmin
and under databases go ahead and create
the database called movies hit create
and then go to SQL tab and just space
the whole thing there and call it go and
that way all the tables will be created
and if you go to my movies database you
can see that all the tables are there so
you're going to need that and also
you're going to need the IMDB scrape OMB
IMDB script which we've created any
other video as well if you don't have
that no problem go to clever techie comm
once again
and click on this article called web
scraping using PHP and I've included all
the source code there so just copy this
whole source code and I recommend that
you paste this code inside a new file
called scrape underscore IMDB PHP and
later on you're going to be able to
include it in your other file which
we're going to be using to insert the
data into MySQL database and let me just
take care of this okay so first of all I
want to show you guys what we're going
to be accomplishing here so if I run the
script the script is going to scrape all
these movies here including all the
movie data and then it's going to insert
all the data here into our database so
let's let's wait for the script to
complete and I want to show you what's
going on here so if I go to a PVR view
source now you can see all this data is
nicely formatted in an array and that
makes it really easy to start inserting
data into our MySQL database so if I go
back to the database and refresh the
page now you can see all these two rows
showing up and all of our tables so if I
click on movies for example it's going
to have all the movie information under
all the columns and that looks all good
so you can check out directors and
genres and stars and that's all going to
be there now for the relational tables
you may have noticed there's more
records like there's 300 total records
that's because one movie can have many
different stars so if I click on this
movie ID here on the first one the movie
City of God and it has three stars
because the movie ID is still the same
so if I click on star one is showing
Alexander Rodriguez for the star and
it's got another star and another star
name and then it's got another star so
same thing for their genres and
directors they're all being inserted
correctly and all the movies IDs are
associated with the right director stars
and genres so that's what we're going to
be creating here okay let's go ahead and
start coding now so the first thing I
want to do is include all the source
code for scraping IMDB and it's just one
big function so I'm going to go ahead
and use the include keywords to include
that function and then I'm going to
store everything inside data array so
I'm going to call that function and
include all the parameters which is the
start year of the movie and any other
movie as well as the starting page and
ending page for this lesson I'm just
going to be scraping two pages and I
don't recommend you guys scraping a lot
of pages to start with because I am DB
might not like it and they might ban
your IP so start very small when you're
doing the scraping okay so now we're
ready to connect to the database
connection settings of course your user
and password might be different so just
make sure you're entering your correct
username and password and for the
database I'm going to enter movies
because that's the database we're going
to be working with now I'm going to
create the new MySQL connection by using
the class name and provide all with
parameters that way is going to connect
to the movies database okay so next up
remember that we have this array and
this is how the data is formatted at
this time now let's go ahead and create
a loop to look through the whole array
and which is going to be using a simple
for loop because it's very easy to slip
through the numeric array and I'm going
to use count to know when to end the
loop so count data and now we're going
to prepare our data for inserting it
into our MySQL database
so for example the description I'm going
to store the description inside a new
variable called description and since
the description can have all kinds of
special characters that MySQL might not
like I'm going to use the escape string
function on this particular record also
I'm going to do the same exact thing for
the title just going to use ASCII string
to make sure there's no special
characters inside otherwise MySQL might
complain about it by giving us all kinds
of errors about improper SQL formatting
ok that's it for the scaping now also
votes which is both looks like this but
it's a number but we still want to make
sure it's a it's an integer so we're
going to use an int valve function on
that one and for the grass okay let's
look at grass so this is what the grass
looks like and it's a string because
it's separated by these commas so what
we want to do is we want to get rid of
these comments and then make sure we use
the in Val function to ensure it's in
fact a number otherwise the record is
not going to be inserted
since the grass inside the movies is an
integer so if you go to structure here
you can check out all the data types on
their type and you can see that in fact
draws and votes are integers so that's
why I'm making sure they're there
numbers by using an int Val function so
first of all going to replace those
commas by using an STR replace function
okay so I've made sure this common is
replaced and it has converted to a
number okay so that's it for formatting
our array and all the other values are
fine so you can leave them as they are
now let's go ahead and write the SQL to
insert all the data into our movies so
it's going to be all these records
including title your image URL
certificate etc so I'm just going to
write this big insert into the table and
a bunch of columns and then I'm going to
use the values keyword and provide a
bunch of values which are going to be
enclosed in single quotes separated by
commas just like you see here okay so
I'm just going to store the whole SQL
and an SQL variable insert and here I'm
going to use ignore keyword because
we're not because we don't want to be
inserting duplicate movies in case there
are any duplicates insert ignore into
and then our table name movies and then
we're going to write a bunch of column
names title here image URL certificate
runtime IMDB a rating then I'm going to
start a new line Metascore description
votes and Ross okay that's it for the
columns next up is values and make sure
it's still inside heat double quotes and
then the values are of course going to
be enclosed in single quotes so first
one is the title next up is the year
okay so what i'm doing here is you've
noticed i have used the curly brackets
and that's because we were inserting the
data inside double quotes and we're
using an associative array
it's called inter interpolation like if
you
get rid of these curly brackets it's not
going to work so make sure if you're
inserting data in this way you use the
curly brackets okay comma and then next
value which is going to be our image
same thing use the curly brackets and
close the whole thing next up I have
another associative array data
certificate data I runtime also enclose
that in curly brackets so it's an
associative array that we're running
through so make sure all that stuff is
working all that stuff is enclosed in
curly brackets
okay I think I messed something up here
ah okay let's just do this okay so I
just copied and pasted the code that I
already had so go ahead and type all
that up and this is going to be our
insert ignore insert statement into
movies database now that we have our
whole theory we're ready to execute it
and the way we execute it is by running
Scala mysqli theory and then just
providing the SQL inside a theory as a
parameter in case it fails we want to
say die and then my sqli error okay so
at this point are our movies that it
should be inserted inside the database
so I'm going to test this out right now
I'm going to go ahead and I'm going to
go ahead and delete this stuff I'm going
to drop database Moonies
I'm going to recreate it and then I'm
going to rerun the whole SQL script as
well I'm just going to use workbench and
forward engineer this database to
recreate the database so I'm just going
to try what I'm doing here is emptying
out the database so we have a clean
database with all the records in it okay
so now we have a clean database and we
can test this out now
okay so let's make sure all the data is
inserted I'm just going to terminate the
script here so it doesn't run any
further actually now not here over here
and then I'm going to run it and see
what happens
wait until the script finishes executing
and if everything works out we should
have some movies data okay so I'm
defiant index from line 18
of course I misspelled description
because it's a long word refresh
okay hopefully it works now let's see
what happens
okay so looks like it works I'm going to
refresh the page here and under movies
you can see that in fact inserted the
information about the movie okay so it's
working and let's keep going and this is
how you debug your script it's it's a
good idea to test out your script and
before you write too much code otherwise
you're going to end up with a bunch of
errors okay so like I said earlier in
order to keep track of which movies IDs
been inserted we're going to use a
function called MySQL I insert ID so
we're going to store this inside the
movies ID variable
okay so again it's going to get lost key
off it's going to get the key off the
last movie record which has been
inserted into the database otherwise it
will return zero okay so okay so it's
going to get the worst record if the
record has been inserted right and it's
going to get the movie ID if the record
however for whatever reason hasn't been
inserted like if the movie has already
is already inside database it's going to
skip it and it's going to return zero so
in if that happens if the movie already
exists in a database we just want to
jump back to the beginning of the script
because we don't want to do anything
else after that and the way we do this
is we can just say if movies ID is false
that means it's a duplicate movie has
been detected and we just want to write
continue and continue inside when you
use continue inside the loop is just
jumps back to the beginning of the loop
and increases the counter
and is going to jump to the next record
in the array okay hopefully that makes
sense you guys and now now we have all
the information all the insert data into
our movies table next up let's insert
the data inside the directors table and
stars and George table as well
since we already have the movies we can
easily do that by tracking which movie
ID has been inserted last so let's go
ahead and do that okay so let's go ahead
and look at the movies data array once
again because we're going to be doing
some more formatting so I'm going to
execute the script I just want to show
you guys how how the director stars and
genres are stored inside the array at
this point and the way they're stored is
their comma separated string values so
if I view page source here now basically
what we want to do is break those values
down and put them inside of a their own
individual arrays because right now the
way they're stored I don't know why it's
taking so long to load maybe the IMDB
website is lagging a little bit okay
anyway so you can see under directors
here their comma separated string values
and what we're going to do is we're
going to take in too long to load so I'm
just going to explain it in this way so
directors equals explode comma and then
I'm going to provide the directors key
which is directors stars going to do the
same thing
and a copy this and replace this with
stars and replace directors or genres so
what this is going to do is it's going
to just create different arrays out of
the string values so that's what the
explode function does and by providing a
delimiter it knows when to separate
those values okay let's keep going and
let's go over the directors array using
its own look this time so I'm going to
create another loop third in two
directories and make sure to use another
counter because we're still inside the
this loop here okay so now that we're
going through the directors loop I'm
just going to format the directors by
storing inside the director array and
use the escape string and trim function
now what the trim function does is it's
just going to remove space or any other
kind of odd blanks that will remain
after using explode function just in
case and then let's write the SQL
statement to insert the records inside
the directors table so what we're doing
here is we're now working with its
directors table so all we need is an ID
name all we need is an ID and name of
the director so insert signor into
director's name values now the ID is
going to be inserted automatically
because inside of our database the ID is
auto increment and it's a primary key so
the PHP inside PHP is going to know to
insert those IDs automatically for us so
what I have to provide it here and then
values so all we need is a director's
name and a director's name is director
okay so let's go ahead and execute using
same fury function or Die my skill I
error also we're going to be keeping
track of this director IDs which has
been inserted last so just like we did
on on the movies ID we're also going to
be keeping track of the lost key of the
director which has been inserted so
that's what we're going to be do what
we're going to do here your actors ID
equals mysqli and search ID and that's
going to provide the lost key of the
director which we have just inserted so
now that we have the last movie key
which is stored inside the movies ID and
we have a directors ID we're now ready
to insert this data inside the
relational table which is movies
directors and since we have the
information the movies is going to be
associated with the right director so
that's how that's done and that's like
the gist of this whole video so let's go
ahead and write the SQL which is going
to insert these two ids together inside
the movies directors table okay so if
directors ID then we want to insert
movies directors write SQL and third
into this time we're not going to be
used in ignore because we can have all
kinds of duplicate values because a
movie with the same ID can have a bunch
of directors and a director with the
same ID can also have a bunch of movies
so that's why it's called a many-to-many
relationship
insert into movies directors movies ID
directors ID which is our columns and
then the values are going to be two of
our variables which are movies ID and
directors ID okay so this is this is our
columns that were inserted in which are
these two columns here and the values
we're getting them from the MySQL insert
ID function which is the last movie ID
which has been inserted analyze director
ID which has an insert as well I keep
stressing this point because this is
kind of confusing for me when I was
first learning it so I know I've
repeated multiple times but I just want
to make sure you guys get this part okay
let's let's keep going here okay so
there also can be a case where we
already have a director so when we're
inserting our data inside the directors
table the directors are all unique
that's why we're using the ignore
keyword here so it's not going to insert
unique directors now when that happens
it's going to skip over and it's not
going to insert the director so the
directors ID is going to be 0 because in
case the last are insert of MySQL fails
is going to return 0 inserts ID will be
0 if no records has been inserted so in
that case here's what we're going to do
we're going to find the director name
which already exists in our directors
table by using the Select statement ok
let's go ahead and do that right now
ok so SQL equals
select ID from directors wear name
echoes director and it's as simple as
that
and that's going to find the director
with I mean that's going to return the
ID with the director and the director is
the one who already exists and it
searches them by name then we're going
to use the result
let's kill Curie because we want to
store the result and then we're going to
use Monroe and fetch the result
associated Lee so it's returned as a
associative array and finally we get to
the directors ID which is stored inside
the row ID so that's how we get
directors ID in an alternative way in in
case the statement fails for inserting a
director if the director already exists
then we search for the director using a
director name and we get the ID in this
way okay hopefully that makes sense
finally we're going to reinsert the
record by using exactly the same SQL and
then we're going to execute minus QL I
using the theory xql and that's it so
now we're inserting the data inside the
movies and we're also using we're also
inserting data inside the directors and
we're inserting data inside movies
directors by tracking the last ID or if
the director has been skipped we're
searching for the director and getting
ID and I'll turn it away where we
selecting and searching the director
using select statement okay guys so for
the stars and genres is going to be
exactly the same thing so I'm not going
to be writing the code here because it's
exactly the same I have all this codes
here so you can go ahead and test it out
for the stars
example I just renamed it to stars and
you can see how it's doing exactly the
same thing so so if the stars is not
found like if it skipped over the stars
and stars is already existing then we're
selecting it and searching by a star
name and the same thing happens with the
genres so it's exactly the same code
I've just replaced directors with stars
and genres so you can download the
source code from description of this
video and the code is also available on
the website you can go ahead and play
around with it and make sure they get
all the movies and that you get all the
directors genres and stars and you can
also check out all the movies genres in
all the many many to many relationship
tables to make sure all the data is
correct as well in the next video we're
going to be finally pulling the data
from our awesome database and we're
finally going to be displaying the data
in a nicely formatted way so make sure
to watch the next video what are we
going to be doing that and this if this
video has been helpful for you guys
please go ahead and like share and
subscribe and I'll see you next time
Kleber take you out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>