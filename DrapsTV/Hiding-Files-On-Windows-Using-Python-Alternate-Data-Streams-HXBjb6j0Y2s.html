<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hiding Files On Windows Using Python (Alternate Data Streams) | Coder Coacher - Coaching Coders</title><meta content="Hiding Files On Windows Using Python (Alternate Data Streams) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DrapsTV/">DrapsTV</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Hiding Files On Windows Using Python (Alternate Data Streams)</b></h2><h5 class="post__date">2016-01-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/HXBjb6j0Y2s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to an odds and ends video on
using Python and alternate data streams
to hide files on windows in this video
we're writing a simple tool that allows
us to detect files add files and remove
files from alternate data streams we
won't be covering what alternate data
streams are in much detail so if you
want to get an understanding of what
they are and how they work check out my
video on alternate data streams the
slideshow incurred are available in the
description
some quick prerequisites a beginner
understanding of Python is required if
you want to follow along the cetera also
requires a Windows computer alright
quickly
what are alternate data streams well
it's a substructure of the NTFS format
by Microsoft this is the format that
Microsoft stores your files in alternate
streams are like additional data
attached to a file or folder this data
is usually not meant to be there so it's
invisible to most Windows applications
and when I say most I mean that it can
only be accessed by a couple of tools
but it cannot be detected you must know
it's there to access it so how will that
program work we'll build a Python
program that uses the module PI ATS to
scan add extract or remove alternate
data streams from files or folders we
are using the PI a deist module as it
will save us time on writing at all PI
ATS we'll use the windows functions to
find the streams attached to a file I
highly recommend having a look through
the source code of piñata stop by and
seeing how it works we'll also use
aaaggghhh paths to interact with the
command-line when deciding what to do
with our alternate data stream ok let's
create a program called a TS tool by we
first require the PI 80s module which we
can download from github if you're using
Python 2 a link will be in the
description if you're using Python 3
like me I'll also have a direct link to
a modified version of Pi 80s that works
with Python 3 keep in mind that this
tool could be tweaked to be better and
more flexible in your own time ok so
here we have a folder and I've got my PI
80s to PI module in here and I've got a
thumbnail for this video and what we can
do is we can open up a command line here
and we can start by testing out that 80s
works so we can use notepad access
alternate data streams so do notepad and
we need a text file to attach alternate
data streams to so let's call it test
dot txt and we'll open up a notepad and
ask us if we want to create a new file
so yes I want to create a new file and
then here we can do something like this
is a test and we can say that so ctrl s
or file save we can close this and we
come back to our folder we've got our
test txt now we can add an alternate
data stream to it by using notepad again
and at the end when you put a colon and
then the name of our alternate data
streams let's call it hidden dot txt
it'll pop up and ask us if we want to
create the new file yes now we can put
something in here so we go this is a
hidden data stream we can save that and
when we close it and open up our folder
again we can see that it's there's no
hidden txt in this folder and it's been
attached to this test txt which is only
a total of 15 bytes and we open it up
and edit it see this is a test we start
to remove something from it so this is a
save that and close it because it's only
9 bytes now and if we want to access our
hidden dot txt again we just simply
repeat the above command so access our
hidden dot exe and open it up and we've
got our text back cool
so alternate data streams are working so
let's create a Python tool now that'll
allow us to access alternate data
streams search for them and add remove
and extract them alright cool so let's
create a new new file so just a raw text
document and you know change the name of
the file to ABS tool dot pi yes I want
to change the file extension and I'll
open it up in the text editor
I'm going to use notepad plus plus
and first thing we want to do is import
a glass so we can get options from the
command line and then from PI ADF we're
going to import ABS all right so now
we've got the ABS module in we can
define our main function
so def main and inside our main we're
going to create our parser our argument
passer surpass our equals hog pass got
argument parser and we're going to add a
couple options so when I have a
positional argument which is going to be
our file to search for alternate data
streams in and we're going to have an
option to output anything that's found
and we have an option to add stream 2 to
the alternate data stream and we're
gonna have an extract and a remove
option okay so our parser dot add
underscore argument and we're going to
have a personal argument file just gonna
be our file that we're going to search
we got now help to equal specify a file
or directory we can close off our help
for that that's our file argument now
let's add our output add argument and we
want to have the argument - per for
output and it's long form is - - output
and help for that will be print output -
terminal and then it's going to have the
action store true so this will store the
value true in our output variable
alright so we want another pass the
arguments add argument
and this one is going to have - a
because we're going to add and this
option will have the wrong form - - head
and its help will be let's have it equal
add stream to file alright and this is
going to take a filename as with the
option so it's action sorry no it's
action its type it's gonna equal string
and we want our parser dot add argument
and this time we're going to extract so
have - e for extract all and we'll add
our long form of - - extract extract and
it help for that is going to equal
extract all and it's action is gonna
equal store underscore true parser don't
add argument and our final one in which
is going to be to remove any of the data
streams it finds that long form is gonna
be - - remove and the help just an equal
remove whole action once again it's
gonna equal store and the score true
okay so that's all of our arguments we
can now pass them into a into our object
so Oleg's equals pasa pasa dot pass
underscore arcs alright now we've got
our arguments we can start writing the
main logic of our program so if dot file
so if there is actually a file the way
you need to search then we're gonna do
all of our programs logic else if
there's no file then we want to
print out the parser usage because we
require a fire for we require a file for
our program to work all right so we need
to create a handler of our IDs alternate
data streams so we'll call it handler
then it's going to equal 80s and then
our args dot file name Alex dot file all
right so now we've created an alternate
data stream handle we can start working
on it so if args add so if the user
wants to add a stream to our alternate
data stream then we're going to handle
don't add stream and we're going to pass
in hogs dot add so the string of the
phone and they want to add okay now
we've added the stream if the handler
dot contain streams so if it does
actually in fact contain streams inside
of the file that they're searching then
we do actually want to do any logic on
it or like outputting it or extracting
or removing so if it does contain
streams then we want to go through each
of them so for stream in handler don't
get streams now this will return a list
but we want to return a copy of the list
so we're going to use the copy syntax
which is a colon inside square brackets
then we use a colon to finish off at
four all right so now that we've got a
copy of our streams and we're iterating
through it we're going to output them if
the user is asked for it so if args dot
Pat put then we want to print how args
dot file so the file that the user is
searching + :
plus the stream that they're currently
looking at all that we're currently
found so this will give it a nice layout
so people can easily see what the
alternate data stream looks like all
right so with outputted if they've
requested it now we're going to extract
if they've asked for it so if hogs dot
extract then we're going to create a
file handle so call F H equals open and
we want to open up the stream so the
stream name and we want to open it up in
write binary it's gonna be writing bytes
out and then our file handle a dot right
oops right and we want to pass in the
handler dot get stream content and we
want to get the content of stream the
current stream okay cool so we're
getting on the boat so rewriting that
file and when you do our file handler
dot close we're done with it all right
so that's our extracting done there's
one last thing to do and that is to
remove if the users requested so if hogs
stop remove we're going to get the
handler dot remove stream and we're
going to pass in the string so we'll
remove the stream cool and we do that
last so that we make sure they request
out port or they want to extract and
remove that it extracts first before it
removes it awesome so that's removed
your stream so that's pretty much all of
our code left all of our code done we
just need to add our statement down the
bottom to run main so I'm just gonna
write main to get it to run if you want
you could use the if underscore name is
equal to underscore main but for now I'm
just gonna use main you can save that
and we can give it a shot so hopefully
everything's gone right we can use a new
tool so a TS tool dot pi and let's look
at our test txt because we know it does
contain an alternate data stream run
that
oh it doesn't do anything I need to put
my - over on the end to look at
everything in it and we can find our
hidden txt awesome so we can find the
alternate data streams and now what we
can do is we could try extracting it so
currently we don't have the hidden txt
inside of our directory so let's try
extracting it out let's do a - E that's
wrong open up our photo we've got our
hidden txt and size 28 bytes we can open
it up and we can see this is a hidden
data stream awesome now let's try adding
a file on so we'll add this JPEG on to
our test txt so we'll do our test
txt from a - add and we want to add the
thumb dot JPEG and we'll do a - oh as
well so we added our file thumb door
JPEG and we output and we can see that
it's now been attached to the test dot
txt going back up we can look at our
test or take seats still 9 bytes which
is definitely not the same size as this
file here which is 303 kilobytes awesome
so what we can do now is I could delete
that thumbnail sleep and we can run our
same command except this time we're
going to extract - oh as well look at
our file again and we've got our
thumbnail cope let's try removing it all
so we can do - ah now if we have another
look and we'll see that it's all been
removed cool
so working correctly this concludes our
alternate data stream program I hope you
learned something interesting and that
you can now muck around with yourself if
you want to learn some more about
alternate data streams click the
annotation on screen or check out the
link in the description to my video on
alternate data streams if you have any
questions leave it in the comments and
I'll try to answer it as best as
possible don't forget to subscribe
thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>