<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python3 Advanced Tutorial 8 - Database Interaction | Coder Coacher - Coaching Coders</title><meta content="Python3 Advanced Tutorial 8 - Database Interaction - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DrapsTV/">DrapsTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python3 Advanced Tutorial 8 - Database Interaction</b></h2><h5 class="post__date">2015-07-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NWU5i53m60Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to Python 3 advanced a database
interaction in this video we'll be
looking at database interaction with
Python every video of all slideshows and
code available in the description
some quick preamble as this tutorial is
all about interacting with the database
knowing SQL or at least a basic
understanding of SQL and how databases
work is necessary if you want to follow
along if you want to work with databases
I highly recommend learning SQL and how
it works ok so what is database
interaction interaction with the
database is the connecting to and
querying of a database this could be
inserting new data creating a new table
deleting data modifying data or just
viewing data these databases can go on
web servers local machine or even
database files we use the SQL language
to talk to databases and we can use
Python to send those commands this is
great for programs that need a store
data scripts that manage or clean up
databases scripts that backup a database
and more Python supports a wide range of
database types Python has written a
standard for how database modules should
communicate with the database this means
that all of the different modules that
talk to certain databases all have the
same methods some of the support of
database types are MySQL M SQL gadfly
Microsoft SQL Server Oracle SQL Lite and
many more let's quickly have a look at
the main methods we use for database
interaction firstly the connect method
this is the first method we use when we
want to talk to a database the connect
method is usually the only method that
will have differences from other modules
sometimes this method will take an
address a user password and a database
name and other times it will only take
the database name next the cursor method
this method will return a new curse
object that allows executing of queries
and holds the temporary data we then
have the execute method which belongs to
the cursor object and execute a single
SQL statement the fetch 1 method also
belonging to the cursor grabs the first
row of data that is in the current query
result the fetch ol method is like the
fetch 1 method however it returns a list
of lists of the current query result the
commit method belongs to the connection
object
saves any changes made to the database
in the proceeding queries the rollback
method boils back any temporary changes
made in the preceding queries pretty
much the opposite of commit we then have
clothes which also belongs to the
connection object and it safely closes
the connection finally we have execute
many and execute script these methods
execute multiple queries on the database
one is a parameter based and the other
is a single script we'll have a look at
this in one of the examples okay now
let's get ourselves set up we're going
to use SQLite as it comes with Linux and
it's simple to install and use SQLite
stores all of its contents in a single
file ok so there installs sqlite3
we're going to come over to ubuntu here
and we're going to do our normal sudo
apt - get install SQL ite 3 and then run
it it'll ask your password and that it
all go off fetch the package and install
it it's already installed on my machine
so as you can see it's set it's
up-to-date once it's installed we can
quickly create a database by running
sqlite3
and giving it a file name that doesn't
exist so SQL ite
3 and we'll call our database test dot
DB and that will run and it will create
the database and then we get this SQLite
prompt which allows us to start enter
entering SQL statements so let's just
check what the SQLite version number is
so select and we want SQL ite underscore
version close brackets and we put a
colon on the end to terminate the SQL
statement we run that and we'll get what
our SQL version is
SQLite version it's sorry so three point
eight point two cool then once we've
done that we can exit by doing full stop
exit alright we're back to the prompt
let's clear it
all right now that we have a database
set up in our local directory and
continue on okay onto some code let's
create a basic program that just prints
out the version of the SQLite database
let's call it D be test by ok let's
create a file so vim DB test dot type
and the first thing we're going to want
to do is import SQLite so import sqlite3
and now we'll define out define M and
now we'll define our main function
so depth main and then we want to create
our connection so we're going to call
call a connection con and that's going
to equal SQLite 3 dot connect and we're
going to connects to our test dot DB and
that's in our local directory okay so
now that we've created our connection we
can get our cursor object to start at
executing SQL so we'll call that cursor
car that's going to equal each
connection dot Tercel all right now
we've got a cursor we can start
executing SQL commands so cur dot
execute and we'll execute
select SQL eye and the scope version the
same as before and then we'll close it
off and that will run the command and it
all terminated if it isn't already
terminated cool so now that we've
executed that command we need to get the
data back so let's create a variable
called data that's going to equal our
cursor dot fetch 1 so we're going to fix
the first result in the table that's
returned and because we know that it's
only returned the version number then
is only going to be that one row all
right cool
now that we've got our data we can print
it out so print data and then once we're
done we can close our connection so
connection close and that's our main
function written let's do our if main
name is equal to me and we're going to
run main all right so that's that done
let's write quit and now we can try
running it so python 3dv test dot pi and
we get the version number three point
eight point two out awesome
worked give this a clear
okay let's modify our python file to
create a table of pets and their prices
we'll use some exception handling to
make sure that we don't break our
database okay so let's come back over
and we're going to modify our part so
then DB test dot pi and we're going to
do some error checking so we're going to
open up a try statement so we're going
to do try and then we're going to move
everything inside of our try everything
it deals with a database so all of our
execution a data fetching and also do
our print and we'll leave our close out
because that's going to go in our
finally okay so now we've got all that
let's do it except so there's an error
so except and we're going to check
specifically for SQL light three dot
error all right so there's an SQLite
error then we're going to if con so
there's a connection then we're going to
print out
era
rolling back alright and after that
we're going to do our con so if there
was a connection we're going to roll
back any changes that were made so that
we don't ruin it ruin our database okay
now we've done our except let's do our
finally so finally and now finally we're
going to do if there's a connection then
we're going to close the connection all
right so we've got some error handling
in there now let's start putting our
data in there so instead of our select
SQLite version we're going to input how
table creation so let's create table and
we're going to call table pets and
inside that we're going to have an ID
which is an int we're going to have a
name which is text and we're going to
have a price which is an int all right
so once we create our table we can start
putting things into it so we'll do our
cursor execute and we're going to insert
into pets the values one just going to
be a cat and LU price of 400 and we'll
close that off and we're going to add
another three different values so we're
going to add a dog rabbit in a bit so
I'm going to speed this up because it'll
take a little bit to type out
all right now that we've got our values
inserted into our table we want to
commit the changes that we've made to
our database so our connection dot
commit all right now that we've
committed our changes what we're going
to do is we're going to get some more
data to print out to make sure it'll
work so our cursor dot executes and
we're going to execute a select
statement so select star so select all
from pets so we're going to select all
of the data in our pets table and then
next thing we want to do is fetch all of
the data so instead of fetch one we're
going to fetch all all right now instead
of just printing out data which might
look a bit hectic what we're going to do
is going to go through a for loop so
tooth for row in data we're going to
print out the row that way we'll only
get each row on a line cool so that's
our file written let's save this let's
give it a shot so a Python 3db
test dot pi we run that we get the
output of our table that we entered so
the one cat 402 dog 603 Rabbit 204 bird
60 cool okay so now what we can do is we
can test our error checking so let's see
if we run it again it'll try and create
the pets table again and insert the same
values into pets so let's give it a shot
and we get error rolling back so our
exception handling has worked and it's
tried to put in a new table or exists
and it's errored and rolls back any
changes it may have happened cool okay
now let's look at making multiple
queries the Python database standard
allows to make multiple queries using
the methods execute script which takes a
string of queries separated with a
semicolon which if you have worked with
SQL before will be quite familiar we
also provided with the method execute
many which takes a topple of tuples to
use as data in a string template okay
let's modify our code again this time
we'll insert all of the data with one
query we'll also add some extra data in
using the execute menu method just so we
can see how it's used
okay so I'll come back across here and
that's edit out now so vim DB test dot
pi all right now instead of our
executing a bunch of commands here we're
going to create a script so let's do our
cursor dot execute script and inside
this script we're going to use a really
long string so to do that we're going to
do triple quotes so quote quote quote
and then we're going to write some SQL
so we're going to do drop table if
exists pets semicolon so the table pets
he already exists we're going to drop it
all right now we're going to create our
table pets with the ID it's an int our
name again there's text and our price as
an int again all right now that we've
created our table again we'll insert two
pieces of data like we did before so we
can just bring these back up so delete
this right
all right so we've got our two pieces of
data that we're going to put in put
ending statements that and we can end
off our SQL script cool so I've got an
execute script now now let's create some
extra data to put in using a tuple of
tuples so we'll call it pets and we'll
make that equal to a tuple and in the
first tuple we're going to have our
values 3 and we're going to have a
string Rabbit
and it's going to cost 400 actually not
200 wasn't there we go and then do a
comma and next one for and it was the
bird and the bird was 60 close that off
comma and we'll add one more end this
time in slot 5 and we'll make it a goat
and go it can be 500 all right and we
can close off our topple of tuples cool
now we can remove these execute script
it executes lines here and we can import
our execute many so our cursor dot
execute many and inside our execute mini
it takes a template and then a top left
apples so we'll use insert into pets the
values and open it up and we'll do a
question mark comma question mark comma
question mark for our template we'll
close out the string comma and then our
couple of tuples which we called pets
all right now that'll execute all of the
value for all of the values inside pets
and add them into our database
now we commit and we can leave the rest
as it is because we want to fetch
everything so we can write quit and save
this so we've got an example of our
execute script and we've got an example
of our execute money so write quit and
we'll give it a shot so python 3db test
dot pi and look we've got an error
rolling back let's check it out there we
go create table pets it's creating the
wrong table here we go all right sorry
about that I just had a bit of an error
error I forgot to remove one of the end
brackets off the SQL statement in the
execute script whoops and I wait back on
schedule
let's give it a run and we can see that
it adds all of it to our database and if
we run it again we'll keep doing it
because we drop our table the start of
our script cool some notes to keep in
mind is that most databases have their
own module however this code should work
on all of them only the connect method
might change when executing statements
avoid using the percentage operator for
inserting variables into your strings as
it can be abused
rather just put the string into a single
tuple and use the optional parameters
for parameterised queries I hope you now
have an understanding of how to talk to
databases using Python feel free to
leave any questions in the comments and
I'll do my best to answer them next
we're going to cover C extensions don't
forget to subscribe thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>