<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Advanced Tutorial 9 - C Extensions | Coder Coacher - Coaching Coders</title><meta content="Python Advanced Tutorial 9 - C Extensions - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DrapsTV/">DrapsTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Advanced Tutorial 9 - C Extensions</b></h2><h5 class="post__date">2014-07-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CYDakDJv2p4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to Python advanced 9c extensions
in this video we'll be looking at
extending Python with the C programming
language this is a pretty large topic so
I'll keep it as simple as possible every
video have all slideshows and code
available in the description
some quick preamble as this tutorial is
all about extending Python we see at
least a basic understanding of the C
programming language is necessary if you
want to follow along if you are using
Windows then the compiling process is
done differently and I suggest googling
how to set up the appropriate Python
development libraries with GCC or Visual
Studio or alternatively you can use
mingw okay what are C extensions
extensions are letting Python
communicate with a c program or library
this is done with a process called
wrapping wrappers are basically a
function that calls another function C
extensions can get rather complex really
quickly interfacing with a low-level
programming language means a lot of
functionality make up the topic so what
are they for Python is great is a great
high-level programming language it makes
a lot of tasks really simple and quick
to implement such as networking or
threading can be done in just a few
lines but because these features are
highly abstracted there may be times
when you encounter a new problem that
you need to build on a lower level
concepts to enable Python to solve that
problem or possibly you already have a
library of C functions or a whole C
program that you want to write wrappers
so that it can be used in Python the
Python developer installation comes with
the Python header file used for using
with C extensions all the types and
functions always start with a capital P
and a lowercase Y or capital P and a
capital y the header also includes some
of the standard library headers for
handling strings and memory allocation
whenever we are handling data that will
be passed between Python and C we use
the PI object type as a pointer as you
can see with this example you return a
Python object pointer and we pass in a
Python object pointer the header also
contains some core functions for
handling the data passing and other
tools for reference and error handling
the important functions that we'll be
using
is the pie argh under Scott past Apple
which pop Tate's the arguments that are
passed from Python the format string
that the arguments are in and then the
variables to store them in in C but we
used Jing we'll also be using the PI
build value function which turns the
values given to it into a Python object
it takes the format and the variables
the last function we'll be using is the
PI init module function which
initializes the module and attaches all
of the functions in a method definition
to the module it takes the module name
and the method def structure just as an
added bit of information if you wish to
return nothing from your C functions
return the PI underscore non value which
will be the equivalent to the Python nun
value okay now the Python method death I
believe this is one of the most
important parts to learn and get right
because the compiler will not pick up
any errors if you mix the information up
the Python method def is the structure
that contains the binding information to
be used with the PI in it module
function this structure must end with a
null entry to let the init function know
that it's hit the end of the methods to
be bound let's look at this example of
our Python method death structure we can
see that at the end we have the null
terminating entry we and then we have it
our two functions that we want Python to
be able to use it follows the pattern of
the Python method name the actual
function name the type of function it is
so whether it takes no arguments or
whether it does take arguments and then
finally Doug the documentation for that
method this should be easy easier to see
what's happening when it comes to
actually writing it okay let's get on to
some code so let's create a basic c
program that calculates the nth
Fibonacci number then we'll write will
write the binding code and we'll add a
version function just as a simple
example of a function with no arguments
so let's call it my module dot C so I
come over to Ubuntu
and we'll start writing our code so then
and we'll call it my module dot C and
we're going to include actually before
this let's exit out of this well what we
need is with Ubuntu Python doesn't come
with the development libraries for GCC
so to get the Python dot H file we need
to install the development libraries we
can do this with a simple apt-get so to
do this just sudo apt-get install Python
- Deb and once you install this it'll go
ahead and install it'll ask for your
password but it'll install say yes and
I'll install all the required
development libraries and headers and it
will attach them to GCC ok so go back
into my C ok now that we've got our all
that development libraries installed we
can include our Python H now so include
python H and now let's write our
Fibonacci function so it's gonna return
an end and we'll call it C fib and
that'll also take an int and sort the
number to return the nth number and
we'll start writing our function okay so
we're gonna do if n is less than 2 we're
gonna return n
else we're going to return see see fib n
minus 1 plus C fib of n minus 2 all
right now that's our Fibonacci function
written let's start writing our Python
bindings for all well wrap up for this
function so it's going to be static and
it's going to take 8 PI object what's
going to return a PI object I say
pointer and recall the function just fit
and just like Python it always has to
take a objective itself so it's PI
object pointer self and we also need the
PI object pointer of the arguments and
that'll be our end to pass to the fib
function okay let's so let's start
writing out our function so in time int
n which will be the end that's passed in
and to if and then we're going to use
the not pi
argh and the score pass tupple and we'll
have the args so this is going to pass
the arguments from Python into into our
C program and it's gonna come in the
form of an int so it's just going to be
an eye for an int and we're going to put
that into the n variable that we've got
there for
and we created just just before and now
the reason we put an F here is if
there's some sort of error that happens
on Python end pythons and passing these
values in we don't want this to continue
so we return null okay
and now now that we've got what our n is
that pythons giving to our our fib
function we need to call our fib
function but we'll just do it in our in
our return statement so return PI
underscore build value so we're going to
create a Python object pointer so build
value and this is going to go in the
form of an int so it's going to pass
back an int to Python and the variable
that we're going to put into it is the
result of C fib of n all right so now
that we've got our wrapper function done
there let's just create a another
function so static PI object and this is
going to be our version function just to
show our function without arguments so
PI object pointer and we'll call it
version and this will take obviously a
PI object pointer of itself and then
inside our function we're just going to
return hi underscore build value and
we're gonna build a string this time and
we're just gonna pass back version 1.0
okay so that's our version function done
now we need to write our method F so
this is a array of the PI method F
structure so static
pie method death and we'll call it my
methods and that's gonna equal open our
array and we're gonna start placing it
our functions so we want our feed
function to just be called fear bin
Python so fib and that's going to use
the actual function fib that we created
before is they'll wrap up and that's
gonna take meth underscore eggs
virag sorry so it's going to take is
going to take arguments and then the
document that we give it just be a
string of Co Q lights the fib not G
number and then that's that entry done
okay so coming here I'm go down to the
next line and we'll add our version
function in so we want it to be cold
version in pythons version and then the
actual version function and cuz this
isn't taking any arguments I'm just
gonna show that we can cast it into a PI
C function so it's PI C function and
that's that just make sure that we're
casting it into a a pipe in C function
okay now we're gonna pass it pass in
that it's gonna have no arguments so
meth underscore nerve args and the
documentation can just be returns the
version
okay and now we need one more entry
which is going to be our null
terminating entry so that'll take null
now zero and no and that's our method
DEP done just need to make sure we have
our closing curly bracket and that needs
a semicolon on the end okay now there's
one one more function that we need to
write which is our initializer function
for our module so this is a PI mod in it
underscore funk and most of that is in
capitals and we're gonna call it in it
my module now it's pretty important to
make sure that you name your dysfunction
in it and then your module name and it's
case sensitive and that's gonna take
void it's gonna take nothing okay inside
here we're gonna have a void cast for pi
and the score in it module this is that
init module function and we're gonna
call our module my module and then the
methods that we're going to bind to that
module is in the my methods method F and
there we go okay so that's how C program
written so we'll save this and now that
that's saved I'll just jump back over to
slide show ya
so now that I see extension is written
we need to compile it this thankfully is
really simple for those of us on Linux
Python provides us with some tools in
the modules disk utils core module if
you are on Windows and you have mingw 32
you can follow the same process in this
video by adding a dash c mingw 32 at the
end of the build command ok so let's say
let's create our setup script so I'll
comeback our Ubuntu here and we're going
to create our setup script serve in and
we'll call it setup PI and inside our
setup the PI we're going to grab from
the dist utils core so and then we're
going to import the setup module and the
extension module ok so now let's create
a variable called module so module and
that's going to equal an extension of my
module and the sources for our module
are equal to and open up square brackets
because it will take as many files as
you want but we're only using one so my
module dot C and then we'll close that
extension off and now we create our
setup so our setup and inside our setup
we have name of the package so package
name so we'll just call it package name
for the moment so package
it's not too crucial this one and then
it'll take a version so version and
we'll make it equal to 1.0 keep
consistent and take a description
description and you know this is a
package for my module he'll do and
lastly it takes the extension module so
XT underscore modules and again in
square brackets but it'll take as many
modules as you want we're going to just
pass in our module that we created
earlier our extension and then we close
that off okay so we can save this now
that looks alright okay so now that
we've created our setup script we can
use it in our Python program but first
we need to copy the compiled extension
into the running directory of our Python
program or alternatively we can run the
setup script again but this time we can
use the instruct instruction install
instead of build so let's go back to
Ubuntu and we'll run our setup scripts
so python setup doctype and then we can
also do build so this will build how our
extension so I have I run this you can
see goes through links everything and it
builds our extension now if I come over
sir just here we've got a build folder
in this directory and it has the C build
of it and it also has the SR which is
the what Python uses as a module so to
be able to use this we need
copy it and move it to the director
we're going to be using it in so you can
either copy and paste it into your
directory you're gonna be using it in or
you can run our our Python setup again
except instead of using build is
installed and that will install the
extension straight into your Python
folder okay so it's clean it's a clear
so now that we've got a built and I
copied it into my directory so it's got
my my module see my set up top hi and
I've also got my module module my module
SR which is our compiled form of the
module so it can be used now and let's
create a test python file so we'll do
vim and we'll call it test doctype and
in here we're going to import my module
and once you've installed my model we
can write out our main function so def
main and then inside our main we can
just do it print and we can print out my
module dot fib of let's say 10 it should
be 55 if I'm correct and in print my
module dot version and that should be it
for Amin so we'll just write how if
underscore name is equal to main then
run main ok so that should be it for our
test so that should run both of our
functions that we've made into our
module so we can do Python test pi and
as you can see we get 55 out and we get
version 1.0 which shows that we have
actually successfully made our extension
module and it's running those C
functions the fib function and
the version functionally created cool so
that's about it
some notes about extensions if you want
to get into writing extensions for
Python there's something called swig
which is a great tool to save you a lot
of time sleep will let you create an
information file which you can specify
what functions you want it in your
extension module and then take your C
code files and generate all of the
bindings and compile your module for you
another thing this topic is really big
and the Python header file has loads of
helpful functions for managing errors
reference counting keyword parsing and
all sorts of stuff but if you were able
to follow along with this tutorial then
the examples on the Python doc should be
an easy enough to follow I hope you now
have a I hope you now have a better
understanding of how to extend Python
with the C programming language feel
free to leave any questions in the
comments and I'll do my best to answer
them next we're going to look at PI
crypto as suggested by dark code
thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>