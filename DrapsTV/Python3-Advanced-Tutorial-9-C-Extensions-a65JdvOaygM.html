<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python3 Advanced Tutorial 9 - C Extensions | Coder Coacher - Coaching Coders</title><meta content="Python3 Advanced Tutorial 9 - C Extensions - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DrapsTV/">DrapsTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python3 Advanced Tutorial 9 - C Extensions</b></h2><h5 class="post__date">2015-07-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/a65JdvOaygM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to Python 3 advanced 9c
extensions in this video we'll be
looking at extending Python with the C
programming language this is a pretty
large topic so I'll keep it as simple as
possible every video have all slideshows
and code available in the description
some quick preamble as this tutorial is
all about extending Python we see at
least a basic understanding of the C
programming language is necessary if you
want to follow along if you're using
Windows then the compiling process is
done differently as just googling how to
set up the appropriate Python
development libraries with GCC or Visual
Studio or alternatively you can use
mingw ok what are c extensions
extensions are letting python
communicate with the c program or
library this is done with a process
called wrapping wrappers are basically a
function that calls another function c
extensions can get rather complex really
quickly interfacing with a low-level
programming language means a lot of
functionality to make up the topic so
what are they for Python is a great
high-level programming language it makes
a lot of tasks really simple and quick
to implement such as networking or
threading can be done in just a few
lines but because these features are
highly abstracted there may be times
when you encounter a new problem that
you need to build on a low-level concept
to enable Python to solve that problem
or possibly you already have a library
of C functions or a whole C program that
you want to write wrappers so they can
be used in Python the Python developer
installation comes with the Python
header file for using with C extensions
all of the types and functions always
start with pi the header also includes
some of the standard library headers too
for handling strings and memory
allocation whenever we are handling data
that will be passed between Python and C
we use the PI object type as a pointer
as you can see with this example we
return a Python object pointer and we
pass in a partner object pointer the
header also contains some core functions
for handling data passing and other
tools for reference and error handling
the important functions that we'll be
using are the PI arg underscore pass
tupple which takes the arguments that
are passed from python the format string
the arguments are in and the variables
to store the values in we'll also be
using the PI underscore build value
function which turns the values given to
it into a
Python object it takes the format and
the variables the last function will use
is the PI module underscore create
function which initializes the module
and touches all of the functions in the
method definition to the module it takes
a module def structure just as an added
bit of information if you wish to return
nothing from your C functions return the
PI underscore non value which will be
equivalent to the Python non value okay
now the PI method def I believe this is
one of the most important parts to learn
and get right because the compiler will
not pick up any errors if you mix the
information up the PI method F is a
structure that contains the binding
information to be used by the module def
structure this structure must end with a
null entry to let the init function note
that that's the end of the methods to be
bound let's look at this example of a PI
method def structure we can see at the
end we have our null terminating entry
we then have two functions that we want
Python to be able to use it follows the
pattern of the Python method nib the
actual function name the type of
function it is so whether it takes no
arguments or whether it does take
argument then finally the documentation
for that method this should be easier to
see what's happening when it comes to
actually writing it new in Python 3 is
the PI module def this structure is used
to tell Python module create function
what information the module needs to
create the module such as some
information but mainly the method
definitions to be used a quick example
of the PI module def structure shows an
easy to follow pattern the head of the
def the module name the module
documentation which can be stored in a
variable elsewhere the size of the pre
interpreter state which is usually
negative 1 for the state to be global
and finally the method def structure ok
on to some code let's create a basic C
program that calculates the nth
Fibonacci number then we'll write the
binding code we'll add a version
function just an example of a function
with no arguments and we'll call the
file my module dot C okay so before that
with ubuntu Python doesn't come with
development libraries for GCC so to get
the Python H file we need to install the
dev libraries we can do this with a
simple apt-get so come over T Bunter
and we want to get the development
libraries so we do sudo apt - get
install and we want the Python - dev and
that will install and we'll set up all
of our other paths and requirements all
right so let's call Oh how see file my
module dot C and inside here we're going
to first hash include Python H with a
capital P okay
now we're going to define our Fibonacci
function so we'll call it C fib so it
returns an integer call it C fib and
takes an int n inside of our function
we're going to write out Fibonacci card
so if n is less than 2 we're going to
return n else we're going to return C
fib of n minus 1 plus C fib of n minus 2
semicolon yep that's right cool
that's LC v function written now we can
start writing our wrapper functions so
these are all going to be static static
PI object pointer so it's going to
return a Python object and we're going
to call the upper function fib for
Fibonacci and it's going to take in a PI
object pointer self so just like Python
we passed inner self and a PI object
Poynter of the arts of the arguments
alright so inside of here we're going to
define a local variable n to store the
incoming n value from Python and then
we're going to write an if statement for
error-checking so if I not pi argh with
capital P any cable a underscore pass
tupple so this is going to pass a double
from python to C so we're going to pass
in the args that come through and we're
going to grab an integer out of it and
we're going to place that result in
integer into the N variable that we
created before if it's not there so if
this is true we're going to return null
but if it didn't fail then we've
successfully stored our integer e to the
N so we can return pi underscore build
value we're going to turn a book we're
going to turn a C value into a Python
value now and we're going to turn an int
return an int and we're going to return
the result of C fib of n cool so that's
our wrapper for fib done we can now
write our version function so another
static PI object pointer and we'll call
it version and that will take a PI
object pointer of self and it doesn't
have any arguments
and we're just going to return headp i
underscore build value and we're going
to return a string and we'll just return
version 1.0 awesome all right so now
that we've written out two wrapper
functions one passes back to version and
one that's Fibonacci the users see fib
we can write our method definitions
let's bump this down a bit and it's also
going to be static so static PI method
def with capital P m and D and we'll
call it my methods that's going to be an
array that equals open curly brace and
we'll do a close curly brace and then
the close we're going to put a semicolon
make sure we don't forget it later
inside we're going to define method def
structures so open curly brace and we'll
call our first function is going to be
our fib function so we're going to call
it just fit which is what it's going to
be in Python and that's going to wrap to
our fib wrapper function and that does
take arguments so we use the math
underscore VAR args which will tell the
wrapper that it will be taking arguments
and it's documentation so we'll do our
calculates the Fibonacci numbers and
then we can close off that structure
comma go down the next line and we'll do
our version function so it's going to be
version in Python and it's wrapped to
our version function here and actually
what we'll do is we'll
ask that to a PI C function just to show
that we can do this and I just make sure
that it's AC function that it's being
passed through so it's a p-type is a
function of version and it's going to
take math underscore no args so it
doesn't take any arguments and then this
documentation will do returns the
version and close that off comma and
then we needed where our null terminator
so that'll be null comma null comma 0
comma now close that off curly brace
okay so that's how method def done now
we need to write our module def so
similar again it's going to be static
but it's going to be a struct this time
that I extract PI module def and we'll
call it my module that's gonna Eagle
open curly brace and look my close curly
brace the semicolon so we don't forget
and it needs to take a method def head
initializer so PI module def underscore
head on the score in it comma and we
need a name for our module so we'll call
it my module and then we need a
documentation for it so this could be
stored another variable but we'll just
do Fibonacci module and we need to
specify that it's going to be global
state so negative 1 and the method def
is our my methods
cool so that's our module deaf written
now we can write our final function
which is going to be our I'll initialize
the function so it's going to be a PI
mod init underscore func so Python mod
in it and then it's going to have a
specific function name it's quite strict
so it's going to be PI with capital P in
it and capital i underscore and then our
module name so how it's going to be my
module and it's going to take a void
now inside we're going to return PI
module underscore create with capital P
m and C and that's going to take a
reference to how structure of our module
def so my module semicolon awesome so
that's all we have to write for our si
si func our C file so we can save and
quit hopefully there isn't any errors
okay now that our C extension is written
we need to compile it
this thankfully is really simple for
those of us on Linux Python provides us
with some tools in the modules dist
utils core if you're on Windows and you
have mingw 32 you can follow the same
process in this video by adding a dash c
mingw 32 to the end of your build
command
ok so let's create our setup script
alright so we come back over we need to
create our setup scripts so then I'm
call it setup dot pi and first thing
we're going to do is import sorry we're
going to from dist utils call we're
going to employ
setup comma extension so we're going to
import the setup and extension modules
and now we need to have a variable to
store our module in so we'll call it
module now it's going to equal an
extension and that extension is going to
be called my module and it's the sources
for that extension is equal to a list of
source files but we've only got one so
it's just going to be my module dot see
you can close off our list and close off
our extension and now we can call our
setup function to set up and it takes a
name for the package so name equals and
we'll do just package name you can call
it whatever you like and then we want
our version so version equals to 1.0 and
then we need a description so
description equals to this is a package
for my module and then finally we need
to tell it what modules to install so
extension extent underscore modules
equals and it's a list so it's that
we're going to get one module so inside
it's going to just be our module that we
created earlier all right now we can
close off our setup script and that's
all we have to do for that so you can
write quit now there's two ways to
install this so first is we can do
Python 3 setup PI build and when we hit
that enter on that it will run through
and we'll build it and it'll place it
into a build folder inside of it the
same directory alternatively instead of
set up you can use install and this will
place it straight into your Python
directory to be used in any any Python
script anywhere okay so we'll just leave
it as that we've built it okay now that
we've made our setup file we can use it
in our Python program so first we need
to copy the compiled extension into the
running directory of our Python program
and we'll create a test file to try out
on your extension okay so come back over
here now
inside of our build folder we've got a
temp folder which has our built c code
and then we also have a python compiled
library so we're just going to copy this
and put it into our C extension folder
here which we're going to use for our
code
okay so let's lim test pi so our test
file and we're going to import my module
so our module name and then the print
and we're going to print my module dot
fib so our fib function and we'll do ten
because that's 55 and I know that off by
heart and then we're going to print my
module dot version and that doesn't take
any arguments and that's all we need to
test out there are two functions so
write quit and save this and let's give
it a run so python 3 tests pi run that
and we get out 55 and the version 1.0
cool so it all worked
submit two bad extensions if you want to
get into writing extensions for python
swig is a great tool to save you a lot
of time circle that you create an
information file which you can specify
what functions you want in your
extension swig will let
create an information file which you can
specify what functions you want in your
extension module and then take your C
code and generate all of the bindings
and compile your commercial for you
another thing this topic is really big
and the Python header file has loads of
helpful functions for managing errors
reference counting and keyword parsing
but if you're able to follow this
tutorial then the examples in the Python
Docs should be easy enough to follow I
hope you now have an understanding of
how to extend Python with the C
programming language feel free to leave
any questions in the comments and I'll
do my best to answer them next we're
going to look at PI crypto don't forget
to subscribe thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>