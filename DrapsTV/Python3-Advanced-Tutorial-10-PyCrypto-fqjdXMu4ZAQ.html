<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python3 Advanced Tutorial 10 - PyCrypto | Coder Coacher - Coaching Coders</title><meta content="Python3 Advanced Tutorial 10 - PyCrypto - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DrapsTV/">DrapsTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python3 Advanced Tutorial 10 - PyCrypto</b></h2><h5 class="post__date">2015-07-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fqjdXMu4ZAQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to Python 3 advanced n PI crypto
in this video we'll be looking at using
PI crypto to encrypt data I'll keep it
as simple as possible every video up all
slideshows and code available in the
description
some quick preamble I'll assume you know
the basics of Python having some
knowledge of cryptography will be
helpful for your understanding of what's
going on
however it's not necessary to follow
along with this tutorial if you're on
Windows you can find PI crypto on the
Python package index on python.org ok
what is PI crypto PI crypto is the
Python go-to package for cryptographic
modules containing efficient symmetric
and asymmetric ciphers hashing
algorithms cryptographic protocols
public key encryption signature
algorithm and it also comes with its own
cryptographically strong random
functions just quickly what is
cryptography typically it refers to
encryption of readable text called plain
text into unreadable text called cipher
text as well as the reverse decryption
of cipher text back into plain text to
be read a cipher is an algorithm used
with a key to turn plaintext into
something that looks like random output
however it must be able to turn the
random looking output back into its
original plaintext form the strength of
an algorithm is measured by an adversary
breaking the cipher or an adversary can
determine the cipher text from a
completely random text we are going to
use AES it's fast secure and fairly
simple to understand
AES stands for advanced encryption
standard and is a symmetric cipher
meaning that both the sender and the
receiver share the same key uses a 16
byte block size meaning each part of the
encrypted data is encrypted 16 bytes at
a time and this must be full so padding
is required an aes can handle three key
lengths 128 192 and 256 bits AES also
supports many block cipher modes and
I'll have a link in the description to
Wikipedia page on the topic we'll also
be using an IV IV stands for
initialization vector and is used to
randomize but still create a distinct
cipher text for a certain block of
cipher modes we are going to use a
random IV for each file we encrypt as
it's important that we don't use the
same IV and key more than once the IV
doesn't give anything away about the
cipher text it was
they used once with the same key so it's
safe for the IV to be known because our
cipher requires a fixed key length of 16
bytes it's useful to hash the user's
password into a 16 byte hash shout 256
can do this for us and it's a secure
hashing algorithm by today's standards
this means the user can have a password
that is 5 characters long or 40
characters long and we still get a 16
byte output ok on to some code let's
create a file encrypting and decrypting
program we can then use it to encrypt
the contents of text files music files
video files and more
so let's call it encrypt py ok so we'll
come over to Ubuntu here and we'll
create our file serve in encrypt dot PI
all right first thing we're going to do
is import OS so we can use it to get the
file size if the files are encrypting
all right so from crypto with a capital
C dot cipher with the capital C we're
going to import a yes from crypto hash
to the capital H import sha-256 and
finally we're going to from crypto we're
going to import random with a capital R
all right it's that till the imports we
need let's create and define our encrypt
function so def encrypt it's gonna take
a key and a file name so the phone name
is gonna be the file that we're going to
encrypt and the key is going to be the
hash password ok now we're going to
define our chunk size which is going to
be the chunks that we read out of the
file the way open there are chunk size
is going to equal 64 times 1,024 all
right and our output
file is going to equal we'll just add
the string encrypted on to the front of
original file name so do encrypted plus
the file name alright now we'll get the
file size so file size equals string of
OS dot path get size so this will get
the size of the file our name and then
we're going to Z fill to 16 bytes with
zeros just to make sure that it
definitely fits and it's and we know how
big it is
to get it out later alright now we'll
create our I be so IV is going to equal
we're going to use the crypto random dot
new and then we're going to just read 16
bytes out of that alright so we got our
IV we're ready to create our in crypto
so in crypto equals a yes new and then
we're going to use the key we pass in
we're going to use the chain block
cipher modes so a yes dot murd
underscore CBC and we're gonna use the
IV that we pass in alright now let's
open up our files and starting
encrypting stuff so with open file name
in read binary as in file and with open
and it's going to be the output file in
write binary as out file
we're going to do outfile
dot right and we're going to write the
file size because file size is a string
we're going to encode it into bytes so
our file size dot incurred and we're
going to encode it with utf-8 right so
that will get written out now we'll do
our apt file dot write the IV and now we
can get on to encrypting the actual file
so so we'll do while true so an infinite
loop we're going to set our chunk chunk
to equal in file dot read chunk size and
now that we've got our chunk we're going
to do a quick if statement so if the
length of chunk is equal to zero then
we're going to break out this infinite
loop because we've run out of data to
read how if the length of chunk is
modulus sixteen does not equal zero then
that means we need to pad because there
isn't a 16 byte block all right so we do
chunk plus equals and we'll do a byte
form of Justice empty string a a space
character in the string three times 16
minus the length of chunk
modulus 16 all right
so that'll add any padding that we need
and once that's done we can ride it out
to our out file so out file dot write
and krypter dot and crypt and we're
going to encrypt the chunk all right so
that's our encrypt function written and
that will go through a whole file and
encrypt it all okay now we need the
opposite side of that so we're going to
define our decrypt function now decrypt
is going to be very similar except doing
things in a bit of a reverse order key
and the file name
alright now the first thing we're gonna
do in here is gonna strap our chunk size
again 64 times 724 and give us a bit of
space here so now we're going to set up
our output file output file is equal to
the original file name so assuming that
it has the encrypted still in the end 11
will strip the 11 characters off the
front with the encrypted brackets all
right so with open so we're going to
open up our encrypted file now so the
file name in read binary has in file and
we open this so we can get our file size
in our IV out so our file size is equal
to the integer of in file dot read 16 so
we've read 16 bytes and we turn that
into an integer which is our file size
and then we're going to get our IV out
of the file so our IV
equals in file got read next 16 bytes
and now that we've got our files out the
IV let's do it set up our
decryptor so IOT crypto equals AE yes
dot new the key that we pass in in a yes
dot murd underscore CBC and now IV all
right
and we can open up our out file so with
open and we'll do put file in write
binary as out file now we're going to do
our while true infinite loop chunk
equals in file dot read chunk size going
to read in a big chunk if a whoops the
Len of chunk is equal to 0 then we're
going to break run out of stuff to pull
out of the file and here we're going to
out out file dot write D krypter dot
decrypt chunk all right so we're going
to read in all of this stuff and output
it again decrypted cool now outside of
our while so after we've run out of data
we're going to truncate the file down to
its original file size so out file
dot truncate file size and this will
just get rid of any padding that may
have been added in from the encryption
stage of the process all right so that's
how decrypt function written now let's
write a quick utility function deff get
key and get key we'll take a password
and this is will be this will be where
we hash our users password so create a
hash ah it's gonna eat all the sha-256
dot new and we're gonna pass in the
password
these puts in and we're going to encode
it into a utf-8 all right now we're
going to return the hash ah
digest all right that's how utility
function written now we can define our
main so just main and the first thing
we're going to do is get the the choice
from the user of whether they want to
encrypt or decrypt so would you like to
do it in brackets capital e encrypt or
brackets decrypt all right so we can get
out get their choice so if choice is
equal to capital e and we'll get the
filename from them they want to encrypt
our name equals input file to encrypt
and we need to get the password as well
so your password equals input password
you could use a different library to
hide the password when the users typing
it in but for demonstration purposes
I'll just leave it this input and then
we can encrypt so encrypt get key of
password and then the file name right
and then we'll just quickly print out
that we're done
he'll if so else if the choice is equal
to capital D for decrypt then we're
going to do a similar thing
if our name equals input except we're
going to do file to decrypt this time
and get the password and input password
and then we're going to call our decrypt
function get key password and the file
name cool now we can print out done and
make sure it all worked and letting
these know it's done and finally our
else so if they didn't put in a OD then
we're just going to print out nerve
option selected closing all right that's
our main written so we can write our if
so if I understand this go name I'm just
going to store its equal to underscore
underscore main let's go underscore and
run main oops
all right so hopefully I haven't made
any errors within right quit and say
this and we can give it a shot
so in this in the same folder I've got
this is cat jpg she's a cute little
kitty and let's try encrypting it so the
Python 3 encrypt dot pie would you like
to encrypt or decrypt II we want to
encrypt we want to encrypt a cat dot jpg
and password will use hello I've got an
error encrypted not find me I have made
a mistake
yeah him encrypt and I need to put an
equal sign here quit let's give it a no
shot
the encrypt and rips cat dot jpg
password hello OOP got another error not
mr. moto misspelled mode here made two
mistakes on the same line alright quit
now let's give a shot hopefully this
works
cat dot jpg password hello and done so
we've had success finally now we open up
this far we've got an encrypted cat JPEG
and we open it up it's not going to work
would have renamed it to Clifford cap to
JPEG and let's give it a shot of
decrypting it now so on Python 3 in grip
the nd4 decrypt the cat dot actually
it's encrypted
cat to JPEG and password is hello and
dump success come back and have a look
this we've got our cat to JPEG and we
open up here's the kitty unharmed cool
so there's a simple encryption file
encryption program some extra notes
looking through the PI crypto library
you'll see quite a lot of ciphers and
hashing algorithms but some of them are
no longer safe and have either been
broken or may not be suitable for the
kind of task you're trying to perform as
it's just looking up the correct type of
algorithm to use for your situation if
you're interested in cryptography and
the algorithms you are using all of them
are open source and you can read them in
many places a word of warning please
never try to create your own algorithm
unless you know exactly what you're
doing and have a team of professionals
working with you
current algorithms are constantly tested
rigorously and all of the standardized
algorithms have been audited by
thousands of people in the cryptology
field I hope you now have an
understanding of how to encrypt stuff
with Python feel free to leave any
questions in the comments and I'll do my
best to answer them
next we're going to look at object
serialization with pickle don't forget
to subscribe thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>