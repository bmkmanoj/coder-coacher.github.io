<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Introducing Cloud Firestore (GDD India '17) | Coder Coacher - Coaching Coders</title><meta content="Introducing Cloud Firestore (GDD India '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Developers-India/">Google Developers India</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Introducing Cloud Firestore (GDD India '17)</b></h2><h5 class="post__date">2017-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2lbUV_-Km54" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone I'm Dan McGrath I'm a
product manager on the Google cloud team
and I'm going to talk to you today about
a new product of God called cloud fire
store so as a way of introducing
Google's newest database cloud fire
store I want to give you an overview of
building scalable apps with firebase
before we get started as people are
walking in I want to get to know the
audience a little bit better so by way
of showing hands how many people have
used the firebase real time database
before Wow how many people have used
cloud functions already not bad and
because this is about cloud firestore
how many people have already taken a
look at cloud fire still nice that's
more than I expected
so for the talk today I'm gonna give you
an overview of cloud fire store tell you
what it's about what sort of features
and functionalities it gets gives you
and then I'm gonna dive in to an example
and I'm gonna go through the code in
that example to show you how to build an
application in practice and then once
I've done that I'll show you a bit more
code on how you can use libraries and
frameworks to do a bit more
so cloud fire store was inspired by the
experience of building the real time
database and the community feedback
we've got over the years so bear with me
as I step back a little bit and take a
little bit of a walk in the history of
the journey that led us to build in this
new system when firebase launched in
2012 it introduced a fundamentally new
way of building apps the firebase real
time database solves many of the hard
problems dealing with app data
specifically it does three things very
well that makes our lives easier as
developers first it allows us to access
data directly from mobile clients and
web apps second and allows us to access
the changing data in real time and third
it allows us to build offline capable
apps very easily cloud via stores does
these three fundamental things as well
and I'll dive into why I think it's so
important in a minute at the heart of
the real-time database it does one thing
incredibly well syncing appstate in real
time with low latency over the years as
adoption of the real-time database grew
usage patterns evolved and expanded and
is being used by increasingly larger
applications when stretching the
real-time database outside of its core
purpose we run into two issues the first
is around data model and in querying in
particular
you can't query over multiple properties
at the same time getting around this
involves duplicating data or doing
client-side filtering the second is the
real-time database doesn't scale
automatically beyond a hundred thousand
concurrent users which means about tens
of millions of daily active users you
have to manually shot across multiple
real-time databases granted that's a
pretty high bar but we wanted to do even
better wouldn't it be great if you could
build an app that goes from zero to a
very large scale without having to
change a single line of code
this is why we built cloud via store
it's a no sequel document-oriented
database that we built specifically for
mobile and web applications cloud file
builds what users love most about the
real time database and combines it with
Google clouds powerful industry
it's flexible to build all types of apps
and scalable to grow to any size for me
this is really exciting prior to Google
I spent many years building complex
enterprise systems and tackled problems
of moving data between mobile devices
and the back-end database now this is
greatly simplified but often I would
start with something similar to this you
have mobile and web clients that talk to
a middle tier the middle tier is made up
of a web server handling your static
content and then either as part of that
or as a separate system you have an
application server that handles all your
business logic multi legged OAuth
authentication and then talks to the
database system in the backend that's
already non-trivial infrastructure that
you don't need to manage in terms of
deploying changes to it sizing the
machines upgrading the operating system
and various components like the web
server and database and at some point if
your app needs to grow beyond a single
database you start adding things like
replication and multiple database
servers which is another piece of
infrastructure you need to spend your
time managing now your apps hitting its
stride and continuing to grow you start
thinking about disaster recovery and
standby systems in a different location
maybe you've already tackled this by
this time you've got some pretty hefty
infrastructure you have people working
on this you're spending time on it
and frankly it's not something that
brings immediate value to users you're
not going to do a press release or a
blog post about your new back-end
infrastructure and how much value it
adds the reason I love firebase and I
imagine many of you do as well is it
takes care of all this for you and now
with cloud firestore completing this
picture to simplify that hefty
infrastructure you can do all this with
a couple of incredibly powerful services
that you can just drop an
SDK into your app to handle and even
though it's really simple to use you can
build some incredibly complex systems
with it you can use things like cloud
function to integrate into the full
capabilities of Google cloud cloud
firestore was a database I could only
dream about having available it would
have saved me many months of effort
months I could have been implementing
features we actually wanted rather than
being bogged down in designing and
implementing the basic building blocks
so now I'm going to dive into some of
the details to make cloud firestore so
special cloud firestore is fully
supported in the firebase SDKs this
means it's available on the web on iOS
on Android that allows you to access
data directly from your clients removing
the need for middle tier completely for
access control data validation and
delivery of data between different
devices and all this work seamlessly
because of firebase authentication and
security rules that let us control who
has access to read and write the data
now security rules is a declarative
security configuration language that
handles data authorization and
validation you can also extend your
application on the server side with
cloud functions server-side code can
still be very helpful for making fare
decisions for our users or including a
secret sauce algorithm you don't want to
have on untrusted client devices we can
also coordinate multi-party interactions
much more easier on the server side or
do things like autonomous agents and
BOTS now being powered by Google clouds
scalable powerful infrastructure this
means you've got access to a globally
distributed database that scales
automatically with usage if you're not
using it it doesn't charge you anything
the moment you get traffic it's there
and available for you now it's a service
system that the
doesn't mean there are no service that
just means Google is taking care of all
that for you
everything from capacity planning
upgrades and maintenance we do all that
with no scheduled downtime it's always
up and available speaking of that it's
very reliable and available it is a
multi region replication keeps the app
and user data safe even in the face of
natural disasters it's replicated across
regions in case of that disaster without
any configuration or management by you
that's right
cloud fire store brings you a fully
managed multi-region multi muster style
database just like you've had in cloud
datastore for the last several years and
it gives you the strong consistency that
we brought to you via cloud spanner last
year it's now expected that we have apps
that work across both mobile and web
even when we never plan to sync across
multiple devices there's a growing
expectation that our apps will just work
cloud firestorm makes it easy for
customers to transition between devices
or even use them at the same time
syncing is made easier by data binding
between client and server writing an app
this way
makes it easier to make aplaudes seem
faster you can display the minimum
amount of data when you load your page
and then render the new information as
it becomes available it's becoming
increasingly often for people to expect
our apps to work offline as many of you
know this problem is very challenging
because it requires building complex
sync and conflict resolution logic with
cloud fire store building offline ready
apps is natively supported the SDK
includes an on device mobile database
that supports and handles conflict
resolution having a local database means
our app functions smoothly even when it
loses connectivity or the connectivities
flaky this offline mode is available on
all platforms
including the web so you have a
consistent experience cloud via store
also lets our structure let's a
structured data as collections and
documents
this makes queries much easier to do we
store related to data together in a
hierarchy we base this model on what we
learned from the real time database
developers we studied how people wanted
to model their data supporting the most
common use cases with patterns that
people just used intuitively
so far we've noticed this reduces the
learning curve and gives a data model
that's designed to scale query
performance is based on the size of the
result set which means you don't have to
react attacked your application or your
data model as your app grows from
gigabytes to petabytes so here I've got
a screenshot of the data console UI in
the first column I've got a single
collection called items and in the
second column I've got a list of
documents that have all got a unique ID
when I click on one of those documents I
then display all the fields that are in
there now in the items collection I
actually have millions of documents and
this can very easily grow to many
millions or even billions of documents
and it will still handle it when you
look at the document you can think of
this as JSON like data so let's see what
this particular dataset
looks like rendered on a page so here
I'm showing cloud file store in action
I'm going to dive into the code behind
this soon and talk about some of those
core features and functionality so this
we build an offline capable progressive
web app backed by fire store the app
displays news stories submitted where
the community can upvote stories and add
comments it's displaying top-voted news
stories over the last couple of days
and it's done with just HTML CSS and
plain old JavaScript we serve those
static assets via firebase hosting but
all the content all the news stories in
the comments the metadata about them is
stored in cloud via store and we get
them directly from the database without
that middle tier there are no other
backends involved we store all those
documents in this collection I showed
just before each news story is its own
document it has a bunch of metadata with
it
such as the score the time it was
submitted who the submitter was okay
let's have a look at the code I'm gonna
go this through this line by line the
great thing about this app that we made
we spent a lot of time fiddling with the
HTML and CSS but the integration with
firestore was really simple in fact the
entire firestore code is on this single
slide so in the first line I'm just
assigning the result to a variable
called unsubscribe which I can use later
when I want to stop listening to live
updates the second store second line is
just grabbing a connection to the
database or creating it if we don't
already have it and then telling it I'm
interested in all the documents in items
and I want them ordered by a field that
I've called top which just gives me the
ranking on the page and then because I'm
only displaying the front page I'm only
interested in the top 30 stories the
real magic happens on the next line when
I call on snapshot on snapshot sends his
query to the server which then grabs the
initial results at those top 30
documents and sends it back and gives it
to me as data snapshot and then past
data snapshot to my display function
display stories that all is doing is
taking that list of documents and
rendering that page that you can see we
believe one of the most important
features in cloud firestore is the
real-time nature so on snapshot doesn't
get called once
it actually automatically gets called
any time the data changes on the server
if a story drops out of the top 30 new
stories come in or even if you change
the title of the story it will call it
again give you that updated data so you
can re render that and just make the app
actually live with the data you don't
have to worry about polling and sorting
out all that stuff we can even generate
other pages quite simply by changing
that code a little bit so here is how we
would display the user profile page
where I want to see the latest story is
submitted by myself I just add a where
clause and it handles it for me
I can even chain multiple where clauses
together so in this example Turing by
the submitter but I'm also limiting the
story submitted to within just the last
year we do this by attaching the other
where clause and all of the queries
continue to work in real time so keeping
that last chunk of code in mind we want
to talk about scalable queries a little
bit as I said before the performance is
related to the size of the result set
not the data set size so when we look at
our database
it could have billions of documents in
it and then I tell it I'm interested in
just a collection which is millions of
documents I then restricted by myself as
a submitter that's hundreds of documents
I then say within the last year we're
now down to five documents the query
time the performance of it will be
exactly the same for my database it has
billions of documents to my database
that only has those five documents and
so that's why it's important to think
about how you structure your data and
allow you to stripped it down to just
the data you're interested in we do this
by making indexing really easy we
actually automatically index all your
fields for you without any action and
all our queries are served using these
indexes for the more complex queries you
create composite indexes for the fields
you care about and even that I'll show
in a minute we make really
or for you to do we have really good
documentation on how to structure your
data and tips about doing it in our
documentation so i really suggest
checking that out so here's an example
of what happens if you try to do a query
on multiple fields when you don't have
one of those composite indexes the query
fails with an error but as you can see
here the error message itself has a link
to the console that will allow you to do
a single click so when I click on that
link or I follow it in a browser brings
me to the exact spot in the console with
all the information to build the
required index prefilled for you it's a
single click and off you go
this makes developing and iterating
really easy and fast remember we're
talking about offline apps cloud via
server supports this on Android iOS and
web we also added some we make it so
simple that it's literally just the
configuration when you initialize a
database and say I want offline
persistence when we're doing the on sync
changes we pass little bits of metadata
so you can know whether the datas
only exists locally or if it's been
submitted to the server the new stories
in our progressive web app are all
managed through Cloud feistel which
means we can cache the data and queries
will continue to work even when we're
offline but it gets better when you're
offline not only is that when we are
offline when you create a new item us a
bid a new story it will actually show up
in your queries in the local device and
when you reconnect or get a network
connection again will automatically sync
it down for you so that means when
you're offline and people make changes
update titles you can close your app
close the browser down come back to the
page and all those rights are still
persisted for you one other little bit
of magic we can do just to give you an
example of how you can string all these
things together is I can deploy this
very small cloud function snippet
quickly walking through what this does
is we're telling it we're interested in
fire store event and specifically I want
to listen to all events when I create a
new document in that collection called
items when I detect a new document being
created I grab the data from that
document convert it to lowercase check
for the word firebase if it exists I
take that text and I post it to our
slack channel that is literally all the
code you need to send any document any
item about firebase to a slack channel
and to show you I'm not cheating when I
look at the post to slack it really
doesn't have anything to do with
firestore here all I'm doing is a REST
API call to slack to give it the
information cloud functions itself is an
incredibly powerful way to do that
server-side glue to put everything
together
supported in cloud fire store the
real-time database cloud storage
authentication analytics crash analytics
many more you can really glue all these
things together without having to worry
about spinning up and managing servers
to do this task and so that was just a
quick run-through of an example in how
you can string all that together it
doesn't seem like much because honestly
that is how simple it is to hook this
into your system I want to spend just a
little bit now about talking about
frameworks and libraries I just showed
you JavaScript examples those exact same
patterns that I show work on Android and
iOS as well and you follow the same
model if you're doing server-side
development in more traditional VMs we
also have Python Java go and nodejs
libraries you can use as well so I want
to talk about a little bit about meeting
you where your app is perhaps you're an
angular developer our community has done
an excellent job already of providing
plugins and extensions to many of the
poplar libraries and frameworks that
already exist so in this case I'm using
angular file with angular
and the new firestore integration
they've gotten here you can see in the
first one I've got a home component for
render in the home screen I'm using the
observable pattern I'm looking at a
collection called articles and just
grabbing the most recent 20 published
articles
now the angularfire has a very light
wrapper over cloud via store and it's a
very similar API so you should be able
to jump between them very easily in the
second one I'm using routes so you can
look at an individual document and give
you a stable link that links your page
directly to the data in cloud via store
itself perhaps your react native
developer the same thing applies here
using react name react native firebase
you can do the same thing in your
constructor grab a reference to the
collection you care about and then you
can do lots of cool things with it you
adding a new document as as simple as
doing ref add and give it the fields
that you want to add when you mount a
component you can do that same on
snapshot magic that I mentioned and just
tell it what method to call whenever
data changes I mentioned the communities
being busy it's not just react native
it's not just angular perhaps you're
doing VR work and you're using a frame
maybe you're a backbone developer or
you're using flora all of these
integrate with cloud firestore today so
with that I want to thank you from
coming out here I hope this has inspired
you to go out try a cloud fire store and
see more incredible things you can build
with it if you have any questions you
can meet me at the office hours area
behind the main hall I'll be in the
firebase session you can reach out on
Twitter with the hashtag cloud fire
store or join our Google Groups where
we've got lots of engineers sitting in
there really keen to hear your feedback
and also see how you're using it
so check out firebase talk and Google
cloud fire store discuss thank you very
much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>