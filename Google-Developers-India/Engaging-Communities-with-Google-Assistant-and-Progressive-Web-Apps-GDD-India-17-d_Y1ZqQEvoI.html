<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Engaging Communities with Google Assistant and Progressive Web Apps (GDD India '17) | Coder Coacher - Coaching Coders</title><meta content="Engaging Communities with Google Assistant and Progressive Web Apps (GDD India '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Developers-India/">Google Developers India</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Engaging Communities with Google Assistant and Progressive Web Apps (GDD India '17)</b></h2><h5 class="post__date">2017-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/d_Y1ZqQEvoI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm Megan Carney I manage a team of
technical writers who help developers
build for the web I'm also a mom I have
two kids
their names are Amelia and Patrick and
for the past few years I've been an
engineering student learning to build my
own web applications one of those web
applications called village assistant is
the topic of this talk today and this is
Crystal Lambert she couldn't be here in
person today but I wanted to make sure
to at least virtually introduce you to
her together we spent many many long
hours building village assistant as our
final project in a full-stack
engineering course at UC Berkeley so
when I talk to the people about building
village assistant what are the main
questions that people ask is why would
you choose Google assistant like why not
just build all of your logic inside a
web application and the answer to that
question is basically a very personal
story I live in San Francisco and like
many San Franciscans
I wasn't born there and my family is
pretty far away
so my close circle of friends are much
more than my friends my kids call them
our family a year in a bit ago one of
our family members died of cancer sorry
to bum you out but this is really
important to village assistant and he
left behind his wife and three small
kids so I really wanted to help my
friend but I had no idea how best to do
that so I went and I created a Google
group for circle of friends
the idea was our friend could contact
the group and get whatever help she
needed so a little bit about my friends
she's a lot more capable than I am
she's more organized she's a lot more
relaxed with her kids I screaming mine
all the time and she's the one who
usually helps us and it's a really
strange thing to be someone who's strong
and capable and all of a sudden you need
help so a couple of weeks after she was
trying out the Google grill and we were
having dinner together and the kids were
going crazy in the background I asked
her if it was any use to her you know if
the group was helpful and she said I
tried the group situation a few times
but I have to be honest it's a kind of a
bit more work than it's worth and she
walked me through this example which I
found really interesting so around the
kids bedtime she went to the
refrigerator to get some milk and she
realized she didn't have any milk and so
she reached out to the group to see if
anybody could get her some milk and she
kind of experienced this weird anxious
feeling just waiting for anyone in that
group to respond but she was worried
about not having milk the next day when
the kids got up for breakfast but she
also then got this flood of people like
saying I can get you milk I can get you
milk I can get you milk and so she found
herself having to coordinate with people
since she didn't wind up with 510
gallons of milk the next day so the
other thing that was really tough she
told me was people who couldn't get her
milk still contacted her wanted to know
how she was feeling wanted to arrange
some other need to be met in the future
so reaching out to the Google group for
something as simple as milk turned into
something far more complicated and
unrelated to the direct need so
after the conversation with my friend I
spent a long time thinking about how
we've grown accustomed to communicating
with each other in social circles and
we're really comfortable exchanging good
and show goods and services with
strangers we get in cars with anybody
and they drive us around and we're cool
with posting pictures of our family
liking other friends and families
postings we're able to now raise funds
for causes through crowdsourcing but
it's still really awkward to make
specific requests especially to people
who we know and care about so I found
this quote by Marshall McLuhan who came
up with the term Global Village and
Marshall spoke a lot about how
technology advancements would vastly
expand the global village but also would
flatten it we kind of diffused the whole
essence of what it means to be part of a
small community so when I started
working on village assistant one of the
things I really wanted to do was to give
the user the ability to ask for help
with any specific need they'd have to
kind of smaller targeted communities and
I also wanted to soften that awkwardness
that comes with asking for help and
Google system provides a filter between
users and their communities so a user
can make a specific request to a chosen
group an assistant coordinates the
requests and responses using push
notifications users can decide to help
or not without having to engage in
lengthy conversations outside the scope
of the direct call to action so here's
where the app gets interesting village
assistant is both a Google assistant app
and a progressive web app it's built
using react and a host of firebase
products and as you know the more
frameworks and platforms that you bring
together the more interesting your app
can be but it's also exponentially
challenging
to get all of the pieces to work nicely
together so much pain today tomorrow
there's talks on Google assistant on
firebase on progressive web apps it's
kind of interesting about looking at
these products in relation to an app
like village assistant is you get to see
how they all work together so Google
assistant allows users to have a
conversation with Google in order to get
things done and actions on Google let
developers like me extend Google
assistant so that users can have a
conversation with Google about your own
app so in my situation a users can
connect a village assistant from Google
assistant by asking to talk to Harold
and here's this persona that Crystal and
I created so we had someone that we felt
like we were talking to we build a web
hook from our assistant app to the
server side of our progressive web app
so as user has a conversation with
assistant the web hook sends requests
and responses to and from the assistant
app and the server and her server is
built with firebase functions in
addition to firebase functions village
assistant also uses firebase hosting
authentication Crowell messaging cloud
fire store and real time database so to
my favorite things about firebase are
that I feel like they have really
excellent documentation so for someone
like me who's learning it's really easy
to get up and running fast with new
products but I also really came to love
the fact that firebase has one console
where you can manage all the products
that you're using so when I was
debugging with village assistant I could
watch my data I could check my servers
logs I could check on hosting and
deployment and I can do it all from the
same place so one key requirement for
village assistant is to create direct
active and easy engagement between users
and the villages
so I decided very early on that push
notifications would be the best way for
users to today active and engage with
one another so any user goes to the
village assistant progressive app web
app all they do is log in and receive it
touken and then they can create or join
villages and the token gets added to the
village and then our service worker in
the progressive web app handles the data
from our server sends the push to the
tokens in the village and then continues
to listen for push events so it can let
the Google assistant user know who's
able to help or not so I'm now going to
attempt something incredibly brave I'm
gonna do a live demo the Wi-Fi is
holding up okay Google assistant seems
to be behaving but if for any reason
that some kind of work out I also have
videos and slides and I'll walk walk you
through them and I'm really hoping this
works so the first thing you want to
notice is this isn't the first time I've
been to this page and you can see here
that chrome is saying hey do you want to
add a village assistant to your home
screen I'm actually not gonna do that
because I just don't want to mess with
any kind of both issues but I could do
that and then relaunch and it would work
fine so at this point I'm actually gonna
login oh sorry
and after I login I'm gonna hopefully
get a message that asked me if I allow
notifications and I'll allow them and
then I'm gonna go ahead I created
villages earlier just so if anything
went wrong it would would it be a bit
smoother I'm just gonna go in and view
some of the villages that are there
gonna join them and everything seems
okay so the UI for the progressive web
app is really just more of a demo UI
because in the future I want to move
most of this functionality into Google
assistant so you can actually control
your villages you can invite users you
can add yourself to a village straight
from the conversation okay so now we're
gonna try and talk to her
so let's see what happens okay google
talk to village Herald
all right let's get the test version of
village Harold hello Harold here would
you like to get help or check on
responses for previous needs okay Google
get help
great let's get you home
what do you need okay Google I need milk
select best village for your need
you selected poem we will see a push
notification oh there it is
now we're gonna say yes I can totally
help and I'm gonna add a message and say
I can't I'm typing really slow here
because I'm super nervous and it's not
easy to type when your hands are shaking
okay here we go okay so that's part two
now we're going on to the final part of
the demo please work okay google talk to
village Herald
all right getting the test version of
village Harold hello Harold here would
you like to get help or check on
responses for previous needs we need to
retrieve your active needs sound good
okay google sounds good
select need for updates
here's an update on getting help with
milk you can see here that it's
recording the number of possible
responses who said yes who said no now
I'm gonna click the shot and you can see
a message from only the person who said
they could help
ah
I do I actually really like what almond
milk all right and that's it that's the
end-to-end workflow for village' system
I know I feel the same way
so the really cool thing is there are
next few slides we don't really have to
look at them because the demo worked
whew
but it's nice to have these slides
assuming you can go back and look at
this in the future and you can kind of
get a better sense of how things are
working and the other cool thing is I
link to the site so if you want to play
around with it yourself you're more than
welcome to so okay let's move through
and so now I'm gonna take a little bit
of a deeper dive in the some of the
implementation specifics starting with
Google assistant one of the most
interesting parts of working with Google
assistant has been learning to code
human conversation and it's kind of like
learning how to talk to your kids does
anyone here have kids all right okay
you'll get this then so I have a
daughter and she loves to talk and since
she was very young we would have these
really cool engaging conversations back
and forth and I learned to ask her lots
and lots of open-ended questions so for
example in the morning I would say to
Amelia I'd say hey million what do you
want for breakfast
and she'd have some spontaneity each
morning my son on the other hand he
needs his he wants to have his needs met
immediately that's it that is the bottom
line for him so when I asked my son when
he wants for breakfast
and he says chocolate he doesn't like
when I tell him that he can't have
chocolate and so I learned when I'm
talking to my son instead of asking him
hey Patrick what do you want for
breakfast I ask him what he wants from
breakfast based on a set of choice
is that I've already checked are
available so my first attempt at
conversation assistant was kind of like
asking hey what do you want for
breakfast but the more I code a
conversation the more I realized the
value of giving users choice and then
directing the flow of conversation based
on their selection so I use dialogue
flow to build our conversation and one
of the trickiest bits to building the
conversation was cut was figuring this
flow out and I think as I didn't
discover context parameters until later
in my learning and these were exactly
what I needed so at the end of the talk
I provide links to the context Docs and
to the facts app sample and these are
incredibly useful things I wish I found
in the beginning so if you want to play
around with sistent try these out they
show you how to have joy in your
conversations and they also show you how
you can actually direct the flow with
context parameters so another aspect of
building an assistant map that took a
while to get used to was figuring out
the interaction between Google assistant
and our server code so if you start
playing around with functions and Google
assistant
you will notice fairly quickly that
Google assistant sends a lot of logs to
the server like I mean a lot of logs and
it takes a while to get used to parsing
the useful information from those logs
but the other thing that's kind of
interesting is if you're writing your
own console server code and you go to
kind of find out what they what they're
returning you'll find yourself like down
the pages trying to find them and you're
getting really good at it but it takes
some practice so lastly this is the
final bit if you haven't worked a lot
with OAuth and account linking I mean
even if you have worked with olaf's an
account linking prepare to spend a lot
of time figuring out how to link all
your accounts together a wealth is hard
and one thing I know about Google is it
takes security very very seriously so
you're going to
have to use tokens like you you can't
there's no other solution you need to
know how to pass your tokens and you're
also gonna have to figure out smart ways
to link users in different parts of your
end-to-end workflow together so in all
honesty I had to get help from an
assistant engineer to figure out how to
parse the tokens and I'm really grateful
to have that help and I just want to say
shout out thanks very much she yang for
that help after this talk and some rest
I'd really like to spend some time
diving into the the JWT token exchange
and properly understand it okay so now
we're talk a little bit about building
progressive web apps and hopefully most
of you had a chance to attend the talk
on progressive web apps today so you
know about service workers you know
about cashing resources off line and I'm
not gonna repeat that talk but I think
there's a few things worth calling
attention to first don't wait to use
lighthouse like don't go and bills your
out and build your app and then be like
oh cool I'll try the lighthouse tool
it's really much better to run
lighthouse early on and and if you
haven't heard about lighthouse yet it's
a tool that you run on your site and it
tells you a bunch of stuff in your app
that you're already doing well and then
it also tells you about stuff the really
specific stuff that you can do to make
your app progressively better there's a
lighthouse talk today you should totally
go and see that and the one thing I
would say about the lighthouse results
one thing you'll notice really quickly
it's really easy to fix the progressive
web app the harder is to fix her
performance yeah so I link to a blog
post at the end of this talk which gives
you a pretty good get started on how to
roll with lighthouse and and debug your
progressive web app and I'm hoping it'll
help
so I mentioned at the beginning of the
talk that we build our client with react
and crystal handle most of the react
code and she smartly chose to render our
components server-side using the create
react app so we didn't have as many
performance impacts but up until this
week we hadn't quite worked out how to
cache the
static resources that are minified in
our build and then less you gotta said
oh just try this out upgrade to the
latest first no create brat react up
over on my build and like all of a
sudden it was like oh my gosh my service
worker was completely creative for me
and all my static resources our minify
we're just like in inside the service
worker properly cached and so it turns
out that one of my co-workers jeffrey
posnick went and added work box straight
to the create reactive so you don't even
have to do anything you just run your
bills and it does most of all find
support for you so I will say this like
you don't have to use or create react
app you don't have to bill with react
but you really should use work box so
that you don't have to like wrap your
head around like all the promise chains
and everything else with offline caching
tada
that's my lighthouse core it's not
perfect there's a lot more that we can
do but it's it's not bad
true story up until kind of very early
in the morning yesterday my performance
core was more than 24 points lower than
that and I'm not gonna tell you what it
was but it was a lot lower and that's
because our app uses materialized CSS
which previously had a mandatory jQuery
dependency and we were using it to
activate our drop-down menu so I'm happy
to say that literally two weeks ago
materialized CSS released a beta version
which removes the jQuery dependency and
they try to clean up a lot of blue so
that you when you were using
materialized CSS things would move a lot
faster so I went yesterday and
implemented a react function and woohoo
the score went up so I'm kind of happy
about that the new materialized CSS
library also has support so now I can
basically under all my CSS server-side
and that'll make the score go even
higher
so developers love to save time and that
often means using libraries so we don't
have to write all the code but linking
to libraries in a website seriously
affects performance and I think users I
think it's fair to say me trying to test
my demo today and really bad Wi-Fi like
we are we're very impatient with waiting
for things to load and I think as as as
technology gets better users are only
gonna go to sites that load fast or fast
enough in the in an environment that
they're in so many developers who are
building libraries are are genuinely
doing their best to help make it
possible to render or take care of most
the heavy-lifting server-side they're
trying to remove as much bloat as
possible like they're really trying to
make it so their library isn't gonna
basically hammer your first page load
but I think we have a responsibility to
I think we have to think about our users
and make sure they're getting the
information that I want as fast as
possible so there's a balance here Wow
firebase products I mentioned a couple
times I really love firebase I do I
really love firebase but I wanted to
briefly cover a couple of challenges we
had with firebase there there aren't
many but there are a couple so there's a
subtle difference between firebase
notifications and how web push
notifications are structured and we
wanted to create the custom actions
inside our notifications so users could
click on them and we could record the
responses and since we're using a
progressive web app all our push is
handled by the serviceworker but the
firebase notification api doesn't
include an actions parameter so we had
to pass in our actions as strings data
and then parse the data in a
recognizable way for the serviceworker
it's a little tricky to get used to so
Matt gaunt and I documented
how it all came together on Stack
Overflow and also include a link to that
at the end of the talk so firebase
functions work great with Google
assistant apps but you gotta remember to
check your quotas you'll notice and
you're watching your function logs that
there's so many logs coming in from
Google assistant and if you're doing
your own console logs as well and as
your server starts to get more and more
complicated you'll start to notice that
your logs just stop coming in you know
you can't see anything and this happened
to us and we had no idea what's going on
or like what is the bug that we
introduced and it turned out we had
reached quota so I upgraded to a higher
version of firebase and all was well I
just think it's a really good thing to
start paying attention to if you're
gonna use functions with Google
assistant so finally the last thing
about firebase products we first created
Village Assisted there wasn't the cloud
fire store just the real-time database
and the database worked well for the
most part but it was really tricky to
query data it's really hard to have
nested data in the firebase real time
database but the new cloud fire store
removes this trickiness
so if you have a firebase real time
database and you're kind of nervous
about moving over to a fire store I can
honestly tell you you can do it
incrementally we managed to do this in a
couple of days
by like just looking at each of the data
exchanges one at a time keeping the
database real time database logic in
place while we changed over to fire
store and it worked okay so we're
getting close to the end of the talk and
I just wanted to leave you with a couple
to-do lists I love to-do lists and the
first one is my to-do list the basically
I put a link here to what I would call a
pretty experimental version of our code
a lot of the stuff we're using and
village assistant is
betta like it's Google assistant
functions firestore all these things are
really really young yeah so I've
actually I do want to move that code to
a more official github repo Google
github repo and when it moves I'll make
sure to put in the link but I want to
kind of mention some of the key issues
that I know are there so when you're
looking at the code and you're like oh
my god this is terrible
so first the way in which we match
villages to a user is it's just not that
pretty and I know there's a much better
way to do this you know ideally I would
like the user to enter in something like
a village name and we would do a kind of
clever matching to find the closest fits
and in like the super future way down
the line oh my gosh this app is actually
a real thing I'd love to get some clever
logic and identifying the best villages
like which users in that village are
actually close or inside a store to get
you milk you know but that's that's like
pretty far away so the other thing
that's kind of a bit wonky probably
notice in the demo is the UI where you
create and join villages and so when I
originally envisioned like doing kind of
the village creation and the the invite
of users to your village I wanted it to
be inside Google assistant I didn't want
to feel like I just wanted to push to be
the main UI for the progressive web app
but it turned out that there's there's
some security limitations in doing that
right now and I think eventually the
assistant platform will evolve and
that's something I really want to
implement but I will clean up the PWA UI
and at least add some functionality so
you can invite users to your village and
finally wanna do like the usual cool fun
stuff I want to make my response times
faster I want to make the web hook
faster and I also want to create a
pretty simple test suite and clean up my
code I one of the things anything it's
very worth mentioning when you start to
build apps to bring all these products
together creating test Suites are pretty
challenging like real test Suites me
waited test suite for things in
isolation but if you really want to
start to test how they all come together
there's a there's a lot of complexity in
that so that is something that I want to
take on board and now this is your to do
list should you take on the challenge
you know for sure start by creating a
PWA and host it with firebase it's very
easy I wrote a blog post that claims you
can do it in five minutes or less if it
might take you a little longer but it's
pretty fast make sure you run lighthouse
to test and tweak your progressive web
app and then learn to build
conversations with choices there's the
link that I mentioned before to context
and the facts app you want to create a
web hook and firebase functions and
learn how to get that dialogue going on
between your PWA and your assistant app
and then the final one which is really
cool is to add push to your firebase PWA
I linked to probably the best get
started video out there on push and also
the Stack Overflow discussion that Matt
and I had in general like push
notifications are pretty straightforward
you do get used to it once you know that
you have to kind of pass in the string
and parse it and it's worth kind of
exploring and playing around with it and
that's it so thanks very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>