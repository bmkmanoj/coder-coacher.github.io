<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Serverless Computing with Firestore, Cloud Functions, and G Suite APIs (GDD India '17) | Coder Coacher - Coaching Coders</title><meta content="Serverless Computing with Firestore, Cloud Functions, and G Suite APIs (GDD India '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Developers-India/">Google Developers India</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Serverless Computing with Firestore, Cloud Functions, and G Suite APIs (GDD India '17)</b></h2><h5 class="post__date">2017-12-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/hZqfsuaNtdE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good afternoon happy to see all of you
here have you had a good couple of days
absolutely the training sessions are
much more filled in than these Lite
sessions at the end of the day so today
I'm gonna try and do something a little
harder than usual and run some code
during a 30-minute talk and build a
couple of surrealist computing functions
both using cloud functions and G suite
API so my name is Patrick Martin and and
like I said I'm a bit of a masochist and
decided to inflict myself some stress
running some live code and attempt
Murphy's Law so let's see how it goes
so what is service possibly the most
exciting and technology that's come up
and the one that's freed me the most of
being able to really focus on building
applications right I'm old I've seen
quite a bit I did weekend gaming on
early Whang mini computers in the 70s I
had an Atari 800 in 1979 installed
network net where networks windows for
workgroup
build some GUI applications and I don't
have to do a lot of that anymore thanks
to while a service so I was looking for
an interesting quote and I didn't find
any so I decided that I'd simply simply
write this up so it is confusing because
serverless is a very wide catch-all
phrase and everybody's got a different
definition so eventually I went to
Wikipedia and I got this definition but
of course serverless computing still
requires servers and hence it's a
misnomer you know wrong or inaccurate
name or designation the name server less
computing is used because the server
management the capacity planning is
hidden from the deployer developer
you'll never have to provision computers
yourself and it can be used in
conjunction with other micro services or
really on its own but Google has been
leading
the service movement and for more than a
decade we started with App Engine back
in 2008 was one of the very first
platform as-a-service
in the market and one of the early tools
that I used especially using the Python
SDK we then released bigquery which is
our managed data warehouse that provides
analytics at scale using the charting
technology from Google we're able to run
through millions or tens of millions of
rows within a few seconds we then come
out with cloud storage which allows us
to store enormous binary files and serve
them hidden in App Engine for those of
you who remember was this thing called
datastore and then eventually we made it
we packaged it in an API and made it
available for you without having to go
through the past and that was cloud
datastore with the advent of Big Data we
have to do a lot of data processing and
cloud dataflow allows you to do both
real streaming data processing as well
as batch and mix both of them and
firebase which I'm going to be talking
more about today was originally created
as a real-time database and now is
Google's go to and even I would say the
markets go to mobile backend as a
service pop sub allows us to do
distributed real-time messaging at scale
if you have millions of users that are
exchanging messages this is how you're
going to be able to do it and cloud
functions this is where we're getting
closer to my definition of service
functions as a service and finally for
those who were in the training just a
while ago cloud machine learning engine
where Google was recently described by
sundar PJ as an IOT as an ia first
company rather than a mobile first
company so in this talk I narrowed the
focus to the function as a service and
basically if we look at cloud functions
there are single purpose JavaScript and
that I executed in a secure and manage
node environment for you they are only
executed when a specific event is being
watched is emitted perhaps also an HTTP
endpoint that you can hit
deploying your code to the service will
require just one command and after that
your cloud functions will automatically
scale based on the usage patterns of
your app you never worry about SSH
credentials server configuring or
decommissioning in many cases the
application logic is anyway best
controlled on the server to avoid any
tampering reverse engineering cloud
functions are fully insulated but I'm
also going to introduce Google Apps
Script for those of you who have gone to
Wesley sessions and understand the G
suite you understand that Google Apps
Script provides a high level of
abstraction to look at the Google API so
that while you're writing mobile apps
using firebase on the front end you
might want to do some processing within
the G suite capabilities whether the
docs or the sheets or the drive API for
that for that purpose so I'm going to
try to create a service API in 90
seconds or less combining the power of
Google Apps Script and G suite API s-- g
suite appears i'm not going to spend too
much time on this but these are all the
classic tools that you've been using in
the front-end and we are able using your
favorite platform iOS android or the web
and a variety of languages Java Python
node PHP Ruby you should be able to do
everything programmatically by accessing
these api's as you would on on the front
end in addition to these APIs that an
equal number or more of api's for the
domain administrator so if you're
working in G suite environment and you
want to provision users or you want to
user groups all these api's are even in
terms of understanding the usage
patterns and the analytics but the other
my favorite simpler quicker way to
interact with these api's is Google Apps
Script I call it a magical toolbox of
sorts allows me to integrate all these
api's in a convenient cloud-based IDE
without having to deal with the
authentication if some of you have been
to the code labs you know that dealing
with authentication going creating
credentials storing those credentials in
the secret gem JSON and then eventually
going through that
refresh token in order to call the API
is a bit of boiler code boilerplate code
that takes quite a lot of time to get
used to Google Apps Script also allows
us with HTML service to create complex
web apps so we can do tiny scripts all
the way to fully develop web apps also
it allows us with advanced services to
interact with other Google services as
analytics AdWords big queries and many
others so I'm going to look at a little
bit of code and this is a two line
instruction of code that's going to
allow me to do a little bit of work so
let's say I have a a business that's
selling some products and I want to be
able to send these brochures to
customers that register either on my
website or on my mobile app and ask for
further information so with two lines of
code I'm going to be able to find that
the relevant file inside of the Google
Drive folder as you can see I have the
drive app get folder by ID that returns
an iterator that I'm able to traverse to
find the file name or particular name
and then my second instruction is simply
sending the email to a particular email
address a subject and I'm able to attach
the file that I've just got after having
generated it as a PDF so these could be
deployed in a number of way one would be
a library another one could be a web app
so that I could quickly have an endpoint
and be able to send those emails to
anybody and finally we're going to do in
a final use case which is an API
executable that can be invoked using the
execution API we're going to invoke that
later from our Google from our firebase
environment so let's try and switch to
the demo so I am going to try and do
this in 90 seconds so I'm just going to
create a new script I just go to my
drive I create a script already I'm
losing time
I quickly give it a name so send
marketing brochure - I save it I'm
cheating a little bit unfortunately we
have a problem with the display ok there
it is I'm gonna get the code here it is
I'm pasting the code and that's not the
right code I told you Murphy would get
in the way all right I'm just gonna run
this code and go to the authentication
flow we as I am in Apps Script I don't
have to do any of this normally I would
have to get an API key go get a token
etc and I'm just going to allow this
authentication and this permission
alright and now I'm gonna publish this
as a web app and once I publish this as
a web app I'm gonna be able to access
that particular script so now I have a
script that I'm gonna be able to access
and what does this script do as you can
see here in these top two lines I'm just
gonna get the query parameters get the
email 90 min 90 seconds is done so I've
failed once again at this I'm gonna get
the email from the query parameters and
the file name then I will immediately be
able to send out that so I've got these
query parameters saved here just to go a
bit faster supposedly faster and put
them in here
and hopefully I get an okay and
hopefully if I can find my and here's my
request for information so we can go
back to the we can go back to the
presentation slides so here was a quick
API a service API that allowed me to
within a few lines of code send a email
with an attachment and with very little
worrying about setting up servers and
using infrastructure that was available
to me so the next but that doesn't scale
necessarily as as much as we would go
Google Apps and Google Apps Script have
coped ours and if I wanted to send
millions of emails that's not a way to
do it so there's another way to do it
and that's using possibly the firebase
platform so firebase is basically a
mobile backend as a service and the only
one you'll want I think it's awesome for
folks like me that need the laborious
laborious stuff taken out especially if
you want to build cross-platform apps
with support for Android iOS and the web
and for those who remember the platform
went before it was acquired by Google it
had some awesome real-time capability
but since then it's gone an enormously
long way and now provides the most
integrated comprehensive platform to
help developers and business power
they're absent platform it really
operates along four dimension one it
allows you to develop your apps with
authentication database storage hosting
and functions it allows you to stabilize
your app with crash analytics
performance monitoring and testing and
the test lab which allows you to test
against an array of Android devices in
the cloud it also then once you've
deployed your app allows you to analyze
what's happening in your app with
integrated analytics and segmentation we
can understand which type of user is
doing what and finally as you understand
what your users are doing you can grow
this number of users and we've just
recently released a I based predictions
so you can use the AI engine to
understand which users are likely to
churn so that you can make an offer to
them which users are likely to perch
and you can send custom messaging to
them notification dynamically and
revenue generation with AdMob are all
part of this integrated platform so as
part of the platform cloud functions for
firebase we log we talked about cloud
functions a bit earlier which is this
massively scalable noj's environment
where we can execute little pieces of
code for specific use cases and this
opens the door to great use cases for
instance we could send confirmation
email to users subscribing and
unsubscribing to a newsletter we could
send an SMS confirmation when a user
creates a new account when it comes to
real time database sanitation we could
do text moderation we could do sentiment
analysis we could move things to
bigquery we can also look at executing
intensive tasks such as image processing
image manipulation bulk image bulk email
to users and aggregating data we can
also integrate with third-party Services
and api's from getting notifications
when a github repository is being it's
being committed to all the way to
creating a chat bot so we're going to
look a little bit at firebase functions
and this is the simplest firebase
function when you initially initialize
firebase in your working directory
you'll be able to upload code with a
simple firebase deploy code and get some
scalable functions in a matter of a
minute so let's switch to the demo I
don't know I have so many blank spaces
all right so this is what it looks like
this is the console and here you can see
that I've deployed one firebase function
it's a hello world function it's the
function we've just seen and basically
it's behind a HTTP request and if I get
that particular request
it'll reply hello from firebase so now
we're gonna try and do something a
little bit more complex what we're going
to do is this code that I had written in
Apps Script I've deployed it behind an
API executable and now I'm going to try
and access it and so here here's my HTTP
func
so come and see always funny to see
people on the screen right there we go
I'm saving this I'm gonna use if I find
it one of the functions of the developer
tooling that allows me to serve my
function locally so instead of sending
it to the cloud and then testing it on
the cloud if I'm doing rapid
modifications I can just serve this
function locally so this is going to
create a local server for me and it's
going to take all of that code and allow
me to to execute a local were too many
desktops alright let's look at the
source code a little bit so I required
some authentication which I have
abstracted here I'm not gonna go through
it and basically what I do is I look at
the HTTP request again similarly to what
we've seen in the Google Apps Script
functions I'm looking at the query
parameters and extracting the email and
the file name and then very simply
reading my client secret requesting
phone with an off token and if I get
that off token then I call my app script
and in my app script what I do very
simply again is I've got the script ID
of the function that I deployed as an
executable executable API and then using
the Google API I create the script API
Handler and then I'll run my function
within that script Handler and I'll pass
this resources and what are the
resources the OAuth token that I just
got the function which is called send
marketing brochure within my script and
the two parameters and so here in the
meantime hopefully my terminal window
is not the one here dates and so now
you've seen that I have access to a HTTP
function and if I find a browser I'm
gonna be able to run it unbelievable
and there we go and similarly here I'm
running this and now I should have a
similar result as soon as I find and
here it is 457 is it 457 yes so that's
the one I've just received all right
going back to the presentation so now
when I tie it all together with the
final piece of the of the puzzle two
databases are made available for us on
fires on firebase one is the cloud fire
store which was really recently released
and better and the real time database
which originally made the product famous
what's important to know is that you can
use both of these databases in the same
firebase app they have different use
cases and you might have a project that
needs both of those use cases both are
no SQL databases they store the same
type of data and the client libraries
work in a similar manner both have a
mobile-first SDK and both support local
storage for offline ready apps the file
the firebase real time database really
stores and syncs data in a real time
whereas the firebase cloud file stores
and syncs app and data at a global scale
so again trying to continue on this vein
I'm now going to replace my HTTP
function by a function that executes
when I create a document so continuing
with my use case I am going to store
every request or every inquiries and as
I create a new enquiry record within the
database I want the email to be sent at
that time so let's try again
this is the fire store environment this
is my fire based environment and this is
my source code so I'm going to change my
function that was an HTTP function that
I had exported and I'm going to change
it to a fire store create function and
it's essentially you will see the same
function I just gonna replace that I'm
gonna deploy it and then talk about and
so here I'm gonna deploy the code while
I talk will I I'm gonna deploy the
function while I talk about the code
okay here we go
and so what we can see here is that I'm
exporting a function that on creation of
a document within the firestore database
within the inquiries collection i will
then fire this event this event will
allow me to take the data from the
document and once again just take those
particular fields that are important to
me
the email and the file name and then
really the rest of the code is the same
I'm gonna authenticate the feature
function and then eventually call the
Apps Script and it's exactly the same
call so let's see if that's going ahead
so one of the things that you can see
here is that it deleted the hello world
and so every time you re upload the code
only it will delete those functions that
are no longer there so if all goes well
I can now come to my database my cloud
firestore and add a document and so I'll
go to add a document I'm gonna have I'm
gonna not care about the ID which is
going to be automatically generated and
I'm gonna create those two fields
last time I did this I forgot the
dot-com all right and then the document
name that I want to send firebase what
is it
firebase indexing not PDF I'm just gonna
refresh this to be sure that my function
is deployed and so it's still not
deployed or it's you know what it was
deployed but it was the wrong one
because I hadn't press saved I'm doing
okay on time so I'm gonna wait for this
to happen so I'll tell you a little
story in the meantime so I've been in
India for 21 years and I live in Chennai
so vanakkam any any people from
Tamilnadu here all right come on give us
here when I come when I come when I come
all right and so how do you say it in
Canada you say namaste is it now as
Khurana mascara all right I have a few
guys in the room are they they at least
watching me can you put your hands up or
did income okay I got one there to there
you can you can ask them if I'm a good
boss all right so now I should be able
to first time I ran this it took an hour
second time 30 minutes and now I'm gonna
end up in 27 minutes so that's pretty
cool there you see so now my function is
no longer HTTP event but it is waiting
for a document to be created on the
firestore within the inquiries
collection
and so if I save this I'm just gonna
double-check that it's really completed
the process
next time I'll work with the AV guys to
remove some screens right we had too
many too many desktops all right come on
we're going to blame it on the internet
I need to deploy come I need a deploy
complete complete this one and let's try
anyway and then you'll they have created
a new document and oh my gosh any time
now we should see this doc this this
come anyway you believe me when I'm
telling you it's working yeah I'll come
back and show you later
all right so going back to the
presentation so I want to leave you with
a couple of caveats and actually three
Cavett's the most important caveat is
that of course this example was
completely convoluted and doesn't make a
lot of sense but what I wanted to show
you was that we could create service
functions very quickly with Google Apps
Script without having to worry with
OAuth and that you could be a you were
gonna be able to do that with and access
a wide variety of Google suite api's and
even I other api's and make interesting
use cases happen pretty fast
and the second one was we looked at it
at in a more scalable environment one of
the Cavett's that in order for you to be
able to call a Google Apps Script
project weave in you need to be within
the same cloud project and when you
create a standalone script basically it
automatically creates a Google cloud
platform and then you need to change the
script that it is change the project
that it is attached to so you find out
the project ID of your firebase project
and you change that and that's the only
way you can call the execution API and
the second one was that it does not yet
support service account so what I've had
to do in the background
I've had to go through that manual flow
once and store the and store the the
authentication the the token and a
refresh token so that subsequent
installation subsequent executions were
able to read that file and I've put all
of that in the in the source code and I
can show you that quickly but that's not
really necessary all right
oops sorry I'm playing around let's go
back to the presentation and finish it
so thank you very much for taking the
time to listen to me through my ups and
downs and if you have any questions you
can see me after the session thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>