<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>From Website to Progressive Web App (GDD India '17) | Coder Coacher - Coaching Coders</title><meta content="From Website to Progressive Web App (GDD India '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Developers-India/">Google Developers India</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>From Website to Progressive Web App (GDD India '17)</b></h2><h5 class="post__date">2017-12-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4SW_qfuD3XU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Pete I'm a developer advocate
on the web team at Google and I've been
working on the web since pretty much as
long as I can remember I love the web
because I think what's most awesome
about it is that it makes the world
accessible as a developer I don't need
any crazy hardware I can start with a
really low end computer or a really high
end computer and for my users it's the
same thing they don't need to go buy
some crazy brand new high-end computer
or high-end phone you can do it with
basically whatever device you have the
web really makes it easy for us all to
connect so it's one of those things that
is a pretty awesome experience that's
why I love the web and today what I want
to talk to you about is progressive web
apps how many people have heard a little
bit about progressive web apps so far
awesome yes that's that's the answer I
want well I want us today sort of blow
away a myth and that myth is the idea
that a progressive web app means
starting from scratch right you don't
have to start from scratch to build a
good progressive web app all of us have
spent a huge amount of time and effort
to build a really great experience with
what we currently have and to take that
experience and throw it away to start
all over again well it's a lot of work
and our boss is probably gonna say no
not gonna happen
so I want to think I wanted to walk us
through an idea of how we can take a
progressive or take an existing app and
turn it into a progressive web app we
need to do that we need to have some
ideas and sort of some tactical things
that we can approach in order to take
those steps to get there so in that
spirit let's set sail on a little
journey and turn our single page up into
a progressive web app
this app that I've got it is a single
page app like I said it uses the iFixit
API in order to access repair guides all
right and this initial implementation
uses client-side rendering to go in and
render everything and it uses react as
its back sort of rendering engine now
this uses react but everything I'm gonna
talk about today works for whatever
browser or nut browser whatever
framework you want to use if you use
angular angular's got stuff there you
can do this with polymer or whatever
that you're building your platform on
you don't just have to be using react
alright and in fact I'm not much of a
react expert I've played with it like
once so that gives you an idea of where
I'm coming from now if you want to see
the code that was used for this as well
as all the disks for each of the
different steps you can go to the URL up
there and and that'll give you all the
code you can grab the code play with it
see how it works and what's going on now
I'm gonna let you in on a little secret
I'm not gonna do any live coding today
and the demos that I have I pre-recorded
them a couple of days ago and I did that
because well sometimes the network goes
out and sometimes the network or the the
demo gods get really mad at you and so
rather than fight the demo gods I
recorded the demos so that we can see
them and also I have a hard time walking
and talking and typing so you don't want
to watch me do that anyways so let's
have a look at what the app looks like
so this is chrome type the URL in sure
this looks exactly like I expect it to
look I've got a list of different
products that I can repair I've got a
bar up top alright looks awesome
now as developers we need to be testing
in all the different browsers right so
let's have a look at it in Firefox so
Firefox same thing go type in the URL
see what happens do all right looks
exactly the same good
now safari now I'm going to do something
a little bit different here and I've
disabled javascript in Safari all right
because I want to see what the
experience looks like for a user who is
disabled JavaScript all right uh-oh
there's nothing there now there's
nothing there not because it's a problem
with Safari but because this is rendered
client-side and with no JavaScript we
can't render anything Wow
so yeah um this is not very good this is
one of the things that we're gonna want
to fix during our little journey today
now now that we've got a feel for what
this app does we're gonna go and use a
new panel and chrome dev tools called
the audits panel this is going to go and
run a series of audits of and tests on
our progressive web app or on our app
and give us suggestions on how we can
fix this now if you've played with
lighthouse before or if you were just in
the in the sandbox area and you saw a
lighthouse this is the same thing all
right
so it goes in we've moved it into Chrome
so that you could run it anytime you
want it's really easy to run but it's
also available as a node module all
right so that means you can run it as
part of your your build process maybe if
you're using something like gulp or
grunt or maybe you've got some Travis
integration so that when you check
something into github you can say hey
how's this gonna work and did this PR
did this pull request break anything and
in fact a couple of projects that we
have at Google we do that with our
github repos so that we can make sure
that we didn't break anything
all right so we'll run lighthouse to get
a baseline to understand what's going on
see what's working well and what maybe
doesn't work well and what we can
improve so let's see light to have some
action pop open to dev tools and go
click on it
this is gonna go and reload the page a
couple of times it's gonna reload and
look at the traces it's gonna turn the
network off it's gonna try and reload
the page then it's gonna see how long
fit for things to become interactive
it's gonna do all sorts of different
tests and you'll see things flash up and
down now usually this takes about 60
seconds to run so the other advantage of
doing this with a couple of videos means
that we don't have to wait for the 60
seconds um we can just sort of skip
ahead now lighthouse is a really great
tool and it's really useful in looking
at numbers and and seeing hey what score
did I get and looking at what audits
passed and failed and it's gonna give
you a score out of a hundred for each of
the different categories but I'm gonna
tell you right now don't focus on that
score that score is important that score
is good and getting a hundred out of 100
is awesome like if you get a hundred out
of 100 give yourself pat on the back but
also let's be realistic how many people
got 100 out of a hundred in every class
in school right nobody gets perfect
scores all the time and as you learn as
things change your scores will change so
don't expect to get one score and have
it perfect things will change over time
all right and the other thing is
lighthouse is a great tool to go yeah
this works well but this isn't the only
tool you should be using you should be
looking at things like your analytics to
see what your browse what browsers your
users are using and checking things out
in those browsers check excuse me
checking it on different operating
systems different ways of that so with
that caveat out of the way let's have a
look and see how we did all right so I
told you don't worry about numbers but
um 36 kind of sucks all right so we've
got one red we've got three green so
obviously there's a lot I can do to
improve my progressive web app score I
can get that from 36 up pretty high
formants is at 79 that's okay like if I
got a 79 in school I was usually pretty
happy accessibility 91 and best
practices 85 generally my goal when I'm
working on a project and what I
recommend to other developers is you
want to aim for like a score of above 90
all right above 90 says yeah you've
probably done most of the things that
you need to do might be missing a few
things here and there but there's room
for improvement but you've hit the major
pieces so let's have a look at why in
our progressive Web Apps core we've gone
a lot of failed audits you can see
there's seven failed audits there um
there's no serviceworker it doesn't work
when it's offline it doesn't work when
there's when Java scripts disabled we
haven't done anything to make the app
work well on our device like adding a
manifest or setting any of the meta
themes matter theme colors or anything
like that so really there's just a ton
that we haven't done which means there's
a ton of room for us to go do stuff um
we did have four tests pass woohoo but
really only three of those so I ran this
on localhost which says hey HTTP well we
don't need HTTPS because this is getting
served from your computer the page did
load fast on 3G we set the correct meta
viewport we've sized everything properly
so we've got a good number of things
that we did right then it also has some
suggestions on some manual tests that we
should run some things that we want to
check to say hey what else can we do
that lighthouse itself can't really test
now in terms of performance I'm ok I
could probably do better um but the big
thing that I'm seeing here is that time
to first meaningful paint so the first
time that I saw something useful on
screen was almost four seconds right you
can see the the filmstrip view of what
was going on up there so like at two
seconds well at about one second I got
the blue background and then at 3.3
seconds I got the the toolbar but it was
almost four seconds until I got
something that was kind of useful to me
that's really long and our speed index
is almost 4500 that's way too high um we
want to aim for that around twelve
hundred and fifty or so all right in
opportunities it gives us a bunch of
things that we can do to improve our
performance some things that we can say
hey enable text compression running this
on localhost not a big deal
reducing some of our render blocking
styles and all that kind of stuff I
could go and spend lots of time hyper
optimizing this and but I'm not going to
do that I've got other things that I
want to focus on today um we've done
well on accessibility there's a few
things we could change but again we're
above 90 so I'm gonna save that for
another day to go and improve those
pieces
we're generally doing pretty well on our
best practices 85 you know I could maybe
do a couple of things to get that up but
again there are places where I can spend
my time to get the scores up and do
better so I'm gonna sort of not do
anything intentional to change this so
the first thing that I'm gonna do is add
server-side rendering and that means
that the browser is gonna get that fully
populated page as soon as it makes one
request right it doesn't have to go and
make multiple requests to say oh hey I
need this and oh hey I need that kind of
thing so it means also that it's gonna
work if javascript is disabled right or
maybe switched off or maybe oops I kind
of goofed my JavaScript up and my
JavaScript died on me right so this
works for this app and it may work for
your app it may not so sort of take this
with hmm should I be testing this is
this really important for my experience
now it's fairly straightforward to add
in server-side rendering to this react
application using universal JavaScript
between the client and the server so
we're gonna share the rendering code on
the server and on the client it's gonna
be identical in both places I'm going to
use Express which is a web server to
serve my files because it works really
well with the react router it's just
kind of
my life really easy but speaking of
react other frameworks have similar ways
of handling server-side rendering so if
you're using angular you're using ember
whatever they have their own way of
doing that and you can just check that
out and go down that path so this is not
just a react thing so the first thing
that I'm gonna do like I said I'm gonna
show you the code snippets cuz watching
me type gets really boring and I have a
lot of typos and you don't want to watch
me typo it's just I've done it a couple
of times and I always fail and I'm just
like sad panda go on so the first thing
that I'm gonna do is add this serve task
to my gulp file so that's gonna go and
start the Express server and that's
gonna mean that I'm pretty much serving
this stuff directly from my server then
in the server I'm gonna add react and
I'm gonna go and render the content into
the react bit so I have to update my app
to go and add all the stuff I need for
that and then finally I need to update
my index file so go in so that it goes
and inserts and checks the right HTML
into the right place now now that we've
got this in set up let's take a look in
Chrome and Safari to see how it looks
now I don't expect anything to change in
chrome right like we're rendering
exactly the same thing it should look
exactly the same looks pretty much
exactly the same um one thing you may
have noticed is it didn't feel like it
rendered a little faster but I'm not
really sure like that's the thing about
not using a tool yet you can't really
tell how fast it did so we'll see how it
did in a second now Safari go run that
type in the URL dududu and it works
right because we got that fully
populated page there um even with
JavaScript disabled we're in a good
place so let's see how sir adding
server-side rendering did for our
lighthouse scores now the same things
happen again
go up to dev tools go to the auto panel
right click go
it does the same thing that loads page
refresh things trance Network off real
if you don't want to listen to be
talking and babble alright so this is
good
by adding server-side rendering we saw
pretty good jump in a couple of our
scores our progressive web app score
went up from thirty six to forty five so
we had about a ten point jump there and
our performance went up ice I can't do
math on stage eleven points went up to
ninety one like we're above that sort of
magic bar that I was talking about
earlier um let's take a look at why
since we only added server-side
rendering I wouldn't expect a lot to
change here and only one thing did
change we got nine point increment in
our score because the one thing that
changed was now that javascript is a
veil or now javascript is available even
when javascript is available now content
is available even when javascript isn't
there so alright that was nine points
that I got pretty nicely um in terms of
performance we got a huge bump right we
got eleven point bump and we're above
ninety one the biggest thing that
changed is looking at that first
meaningful paint remember before we were
almost four seconds we'll now we're down
under a second we're like 870
milliseconds that's a huge drop because
we don't have to make all these multiple
requests to get different things
compiled the Chavez and compile the
JavaScript thing go oh hey I need this
thing over here we're able to really
speed up that experience and our page
speed index dropped as well
it went from almost 4,500 to down to
just about 2,000 it's still above our
number that we're really trying to aim
for but it's a lot closer right it
dropped more than in half opportunities
to improve have now changed I could go
through and fix a bunch of these but me
90
be alright let's go ahead and add a
service worker to make sure that it
works instantly and reliably even when
the network isn't but one thing I want
to remind folks service workers are
great for that second load and they work
in a lot of browsers but they don't work
everywhere so we want to make sure that
we really focus on on that experience so
when we structure this app the way that
I structured it was to use the app shell
plus dynamic content model and that
means that I'm gonna take all of the
HTML the CSS the JavaScript the stuff
that doesn't change right the stuff
that's required for my app to run and
I'm going to cache that and load that
directly from the cache every time and
that means that I take the network out
of the picture I don't have to worry
about oh hey what's the network like I
don't have to worry about anything that
for the data I'm gonna use a set of
runtime caching strategies so that when
I go to ask for something I'm gonna get
it and then I'm gonna store it so that
if I need it later I can get it from
here but if I need something else I'll
go get it from somewhere else I'm using
in this tool in this project a tool
called sw-precache sw-precache is a
precursor to work box but both of them
have a set of predefined strategies or
their library with the set of predefined
strategies that are gonna help me write
my serviceworker code and really easily
be able to go and do a lot of the things
that i don't want to write a lot of code
to go do these things so this is a great
tool definitely worth checking out so
the first thing that I need to do in
order to get my tool to work is import
sw-precache into my gulp build script
and then I need to add a new task that's
gonna generate the serviceworker for me
you can see there what I've gone and
done is I've said hey I want to
statically cache these things and then
below that one where you can't see I'm
saying hey I want to dynamically cache
the rest of the content and
in my HTML I need to register the
serviceworker so that it's there and
works for all of the pages all right so
now that we have the serviceworker in
place let's run lighthouse and see what
goes on
we've seen this a few times so I'm gonna
skip the like watching of it of a demo
but another bump alright by adding a
serviceworker - precache our content our
progressive web app score has gone up by
almost 20 points now alright from 45 to
64 and we had a five-point bump on our
performance score that's really good you
know we went from 91 to 96 that's that
makes me a happy camper
we've really improved the reliability of
our app by adding that serviceworker
it's now gonna work and respond when the
network is slow when the networks not
working maybe if you were here yesterday
and the network was kind of so good
improved experience it's also helped to
improve our perceptual speed index and
dropped it down to about 1200 1300 so
just above our ideal number one quick
tip after you've added a serviceworker I
always recommend that you go into the
network panel and take a peek there and
have a look at that size column just to
make sure that the serviceworker is
handling all of the requests that you
expect this looks good and here's my
favorite bit those super fast response
times everything is essentially under 30
or so milliseconds so it means that all
of my pages are getting served up really
fast
well we're in dev tools I also want to
point out another really good important
panel and this is the application panel
this is the central place where you want
to spend all of your time for debugging
and understanding service workers in
here I can see that my serviceworker is
running and without errors one little
tip I'll mention I usually keep this
open if I change my serviceworker and
refresh the page before I refresh the
page I look at that
number you can see number 46 activated
when i refresh the page I expect to see
that number increment so I want to sees
47 48 49 from there I can also force it
to update I can simulate a sync event or
a push event I can unregister and get
rid of it or I can use a bunch of these
checkboxes to improve some of my
debugging experiences the offline
checkbox lets me simulate an offline
network failure right so it's gonna be
hey no network doesn't exist so I can
see how that behavior exists update on
reload is really neat what it does is
when this is checked if you hit reload
on the page instead of doing a normal
reload first thing it does is it goes
and refreshes the serviceworker so it
goes and reloads the serviceworker then
once the new just the once the
serviceworker has been reloaded and the
new ones been installed it reloads the
page so it means that you're always
running with the latest serviceworker
right away and then finally bypass for
network is super useful if you're trying
to figure out why your serviceworker or
why you're getting the old content
essentially what it does is it skips the
serviceworkers fetch handler and go
straight to the network to try and get
that now that request all right so
finally let's add the missing
application metadata these are the
options that we need to control how our
app appears on the phone or on the
user's desktop when it's added to the
mobile screen the first thing I need to
do is add a manifest and this is one of
those things that tells the browser hey
here's the name when you add it to the
home screen here are the icons all of
that kind of thing but I also want this
to work on iOS on in Safari too so I
also need to add a set of metadata
attributes or tags to the page because I
want to make sure that this works really
well so let's take a look at the the
manifest and what I've had to do there
the first thing I did was add an icon I
added just a single 512 by 512 pixel
icon and the reason I added only
an icon I'm not a designer and I don't
care if my icon when it gets resized is
not pixel perfect some of you in the
room are probably wanting to just come
up and hit me right now because you want
it to look pixel perfect if you want to
do that that's awesome you just need to
specify that in your manifest you can
see the manifests that I've got where
I've specified a full name of the app
the short name I've got the different
icons the URL that it should start at
background color theme color and all
that kind of stuff so I've got that and
then finally the last thing that I need
to do is add the link tags for the icons
so that Safari has something when it
goes to try and use those chrome also
uses these when you think of your tabs
in your top bar so I want to add those
icons and I also want to add the Apple
mobile hang on Apple mobile web app
capable yes I love that line it's so
long I can never remember it I have to
copy and paste it every time so I add
those two and then the other thing I
want to do is add a link tag to my
manifest and set the meta theme color so
that makes sure I've got all that so
with those added let's have a look at
how it looks in Safari on iOS so I
recorded this on the emulator so go
click Add so it gets added to my home
screen there it is on home screen and it
loads fullscreen looks pretty much like
I expect it to look so this is pretty
good it looks and mostly like a native
app it won't work offline cuz Safari
doesn't yet support service workers but
they have said they're going to and it's
coming so sweet good um now that we have
the service worker let's take a look at
lighthouse and see how it looks so we'll
skip the video all right with those
changes we're at 91 for a progressive
web app 96 I'm I'm above 90 everywhere
I'm a happy camper
the only outstanding issue is that I
don't have a redirect from HTTP to HTTPS
I'm running on localhost yeah I can deal
with that our performance still looks
great
time to interactive is under three
seconds our first meaningful paint is at
a second accessibility stuff that hasn't
changed but we're down to one thing that
we need to change in our best practices
we're not using HTTP - which is fine
we're running on localhost I also want
to point out in dev tools you can see
the manifest here and one little pro tip
that I always recommend to folks once
you've added the manifest just take a
look and make sure that all of the icons
are showing up properly there have been
a couple of times where I've gone and
done this and I've typo'd the icon name
and I get one icon that doesn't work so
just take a peek at that um you can see
in here your serviceworker that it's up
and running and you can dive in and see
what's been cached by the serviceworker
so you can go in and just make sure
everything's been cached properly now
there's one little bug I want to tell
you about cuz this has had me hitting my
head against my desk several times we do
code labs with progressive web apps and
this gets everybody um there is a bug in
Chrome right now I think it gets fixed
in 63 which should come out early next
week
but that little icon in that if is not
live so what you just have to do is go
right click on that click refresh and
then you should be able to see so if you
do go in and you're like why is it not
showing anything just refresh it and
you'll be able to see what goes on
making sure that you've got all of the
right stuff I think it gets fixed in 63
fingers crossed if it doesn't tweet it
at Chrome the chromium dev tools team on
Twitter and like when's this getting
fixed because the more people who yell
at them about it the better alright so
as developers you know I've shown you
sort of how you can do this sit down
with dev tools run the audit on your
existing app and find out how it works
does it do how does it score um and what
can you do where can you spend
a little bit of time to increase those
scores you can't necessarily always do
it overnight but if you start working
through and say hey I want to get this
up I want to get this I want to go at
this you'll get a better experience the
goal is not to necessarily like I always
get in a little trouble for this but
progressive web apps are a great
marketing buzzword really what they are
is building a beautiful amazing user
experience that's fast
that's integrated that's reliable and
that's engaging and that's what we want
to make for our users as experiences
that they love so they keep coming back
and buying stuff on our site or using
our service or doing whatever we want to
make sure that they've got that great
experience so using something like
lighthouse to help get you there is a
great tool I've got a few links here
with some more details um you can go
grab the code for this for both the
iFixit sample and for the for the for
lighthouse lighthouse is a great open
source project so if you have ideas for
other audits you can go to the the tools
and check those out or go to their
github repo see those and suggest things
there add comments um with that I will
say thank you very much I'm gonna go
over to the lighthouse booth and hang
out there at the lighthouse booth you
can run your tests through lighthouse
and see how it goes
hopefully the net works a little better
with that thanks everybody</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>