<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PWA + AMP = Easy for Users and Developers Alike (GDD India '17) | Coder Coacher - Coaching Coders</title><meta content="PWA + AMP = Easy for Users and Developers Alike (GDD India '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Google-Developers-India/">Google Developers India</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PWA + AMP = Easy for Users and Developers Alike (GDD India '17)</b></h2><h5 class="post__date">2017-12-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rtiwyyQspx4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello good morning thanks for being here
on a Saturday to hear more about PWA
amp'd other exciting things my name is
Ben Morse I'm a developer advocate at
Google where I work on the web
helping make the web easy for
programmers fast beautiful for users and
such before I was at Google I used to
make websites for companies like the New
York Times AOL and before then I was a
musician for some years the band last
night was incredible if I could sing
that way
I put coding tomorrow and be a singer I
won't sing for you today I promise but
we're here today to discuss something
else not my vocal ability or lack
thereof but the shadow reader an example
of the PWA
and amp pattern of combining these
things together into a single
application the first question is why
why do this why learn new stuff well I'm
thinking about what I call sometimes the
web app dilemma 19 years ago back in the
previous century the previous millennium
for front-end developers life was pretty
simple any kind of complexity almost all
the code was on the back end
there was Perl maybe there was PHP
something else the front end was HTML
and CSS and maybe just a little bit of
this cute little language called
JavaScript which was used for small cute
little tasks like button rollovers the
mouse moved over the button it would
change color that was kind of nice that
was JavaScript well it's changed since
then and now javascript is immense
complicated universe of frameworks and
technologies and ideas and these are all
wonderful don't get me wrong
but it ends up being a little bit hard
for you and for the user it can be hard
for you because you're learning new
stuff all the time you're learning
angular you're learning react learning
all the latest stuff that's going on
and if you want to have a fast
application it takes a lot of time
working on performance of tweaking
things again and again so it isn't too
slow because a lot of JavaScript a large
JavaScript framework takes a long time
to load and then to parse and execute on
mobile devices this was the problem if
you're on your nice computer in your
office and you've got a fast wired
internet connection then all the
JavaScript in the world might be fine
but on mobile devices especially in
countries where 3G is the norm it takes
a long time to load things up and parse
things so making the user actually deal
with all that is unfair to the user and
that you pay a price for that you can
see over here that over the years the
size of the average web page has
increased it's quite a bit it's just
increasing more and more and what
happens is users are waiting for
something to happen on their phone they
don't know all your wonderful frameworks
in JavaScript are loading up and waiting
to get partially executed they're just
saying why isn't this thing loading and
they're liable to bounce off your site
so okay the web is kind of hard to write
for in some ways how about making a
native app apps or easy apps are good
and apps are fine but the problem is the
average user will probably never
download your app it turns out that at
least in the US that's probably similar
here 80% of users time is spent in the
top three apps and out of the top 10
apps in the US last year eight of those
ten apps were owned by either Google or
Facebook so these are tend to go I
apologize for the large well-known apps
like Gmail like a snapchat and so on and
your app is not as liable to get
downloaded for repeat users it's good
for first-time users it's harder to say
download install my app and in fact can
you guess the average number of apps the
average user downloaded in the US per
month last year the average number of
apps the average user downloaded last
year per month in the US
was zero it was actually a bit less than
a half but the point is that apps are
very very useful but making your own app
and may never get used by anybody so
what do we do I mean the old days
weren't so good websites were very
simple and users now demand more
especially on their mobile phones
they want an immersive really nice clear
experience on their phones that website
couldn't provide 19 years ago so what
did we do you want a site that loads
quickly and that is responsive that is
beautiful
intuitive and so on what do we do is
there some easier way is there an answer
to this question no okay thanks
goodnight no wait hold on hold on I'm
just kidding you can also can try the
combination of progressive web apps and
accelerated mobile pages PWA plus amp if
you've been here with last day or so
you've probably heard talk about these
things who here knows at this point what
a progressive web app is how about
accelerated mobile pages alright so we
could maybe discuss this a little bit
further what these things are
progressive web apps as you may have
heard or not are an idea about making a
mobile site more of an app like
experience fast integrated reliable
engaging note the first letters there do
spelt fire this is not a coincidence the
idea is to make a mobile site as good as
an app and this is possible these days
with modern web technologies and modern
browsers you want to have things load
fast initially to load fast
throughout the app to be apt like
immersive to be in the whole screen of
the phone if they want it to have
offline content push notifications all
these things are now possible with
mobile websites and that is basically
the progressive web app idea amp or
again as we call I started mobile pages
is a way to make sites very fast and you
may have heard of it before because they
first became used by publishers for kind
of simple static pages but Anthes
evolves since its inception two years
ago and it's not just for publishers
anymore it's actually become a thing
that can be used not just for simple web
pages not just the way to get into
Google's amp carousel on google.com and
Google dot CEO that I am and so on but
it's actually a nice new pattern to make
sites faster especially and simpler and
easier for users and for you the
developers alike a little more about amp
so amp
first of all custom JavaScript is no
longer allowed with a couple of
exceptions here and there some
expressions and things were still
allowed so all your frameworks you know
before can't be used anymore except for
on the server side
this may seems very harsh but all that
javascript is useful they can slow
things down so it forces you to have a
performant fast sight
but on the other hand with amp you also
get an expanded version of HTML with web
components you get new HTML tags that do
the things that JavaScript did before
also CSS can be no more than 50 K a
little more about amp over here well I
forgot sorry the slide is next that
sounds kind of hard to do to combine
these things together we're going to
discuss a simple example of this called
the shadow reader which is so simple
that require no frameworks of any kind
in JavaScript not even jQuery I think I
skipped some slides somehow that's weird
I lost some slides where are they here
they are okay the later in the
presentation all right excellent so
going on over here let's say that you're
working at a major newspaper of some
sort and you've got a nice website but
it isn't that nice a website and like
most newspapers you've got amped on your
pages and the boss says you know what we
need a better news reader app over here
for our site we want to take our
existing amp pages
and kind of push those in to some sort
of nicer better because web app
experience so alright how is that
possible as we said before these things
can be combined the animation there
makes it clearer PWA and amp are very
different ideas but they're compatible
and we'll show you how to do it so why
do this first of all let's consider amp
and a few ways it's not usually
considered first of all we'll think
about amp as web components second of
all as a source of rich data and third
as portable embeddable units of content
thanks to a thing called shadow Dom
first of all amp as web components so
amp began as this way to make simple
webpages for publishers but it's evolved
since then into this powerful web
components library here's an example of
amp this actually will make an image
carousel those things where images slide
around the screen where users can swipe
images around or they slide by
themselves this requires some JavaScript
perhaps the JavaScript library it
requires some work to make it
performance the lazy load images that
are off screen
well amp does all those things for you
it's performance and it involves no
JavaScript you just say amp carousel
specify the size of the carousel because
an amp all elements have their size
specified in advance so as things load
in then things and the pages don't jump
around I think you just use amp image
tags in there which provide performant
versions of images and then that's it
that's the carousel
that's the whole thing another example
of an amp component a YouTube embed for
example you just specify the width and
the height and the ID of the video and
there it is no embedding JavaScript
nothing else there it is
and it's performance also this is
component actually involves some
complicated streaming technologies
YouTube uses you can't usually access
but it's all there as part of this
components there's a lot of components
in amp analytics
ads as you saw yesterday if you're at my
talk yesterday
anton blinded amp lists now enable
dynamic content on the page i think that
honestly a lot of pages on the web can
be translated over to amp and they
wouldn't lose a whole lot they just be a
lot faster again it's simpler than other
things in the web certain things are
harder to do or not possible to do
without javascript the most things that
most web pages do can be done with amp
components
pretty easily next amp as which data so
consider this amp instead of web
components and HTML it can be used to
store data say about articles or about
some sort of posts things involve text
images other things it's kind of like a
version of markdown on steroids because
it also combines the power of M
components into the data so for example
let's say if we had some JSON over here
for an article about some random band
called ancient babies I don't know who
they are
and then some content over there the
same thing an amped might contain things
like an image of a guitar and might
contain h2 some sort of markup
information and might contain also even
an ad all those things can be your data
so again amp as a source of very rich
data number three amp as portable
embeddable content units so you can take
these amp pages and they're already
units of content with this rich data and
markup you can plug these things in to
other pages so once again you can take
an entire piece of content which is rich
data with markup embedded into it even
things like ads into it and plug it in
to other pages which means you can take
existing amp pages as most publishers
have and repurpose those things in other
web pages and now you're thinking wait a
second that's what I was looking for for
my web app over here for my boss taking
existing amp pages repurposing our amp
pages
and something else well we can do that
but how we use the magic of shadow Dom I
love the term shadow Dom because it
sounds very mysterious because it
involves the word shadow so all shadow
DOM is as a Dom that's embedded in and
it capsulated in and attached to an HTML
element it's kind of like encapsulation
you'd use for objects for functions
basic good computer science practice but
the same idea applied to the Dom instead
so you see over here you can imagine
these amps kind of attached to Dom
elements and a PWA this allows a valid
accelerated mobile page to exist inside
a different page the thing is that as
you may know amp has to pass validation
if amp isn't validated then amp caches
won't serve it so Google for example
will not actually accept and pages they
don't pass validation that validation
includes no JavaScript for example but
with shadow amp you can have a totally
valid amp page stuck inside something
else another way of seeing this is that
a whole subsection of a page can be made
into amp and the rest of it doesn't have
to be here's how this is done if you use
damp before you recognize as a runtime
the amp loads up this is a different
runtime which is called shadow - V 0 J s
this is the shadow amp runtime how this
works is when this actually loads then
it creates a global objects called amp
and on the bottom we have an attached
shadow dock method that we use the amp
global object to attach to your chosen
container an entire amp document notice
also that we use as a synchronous
pattern here because we wanted things
heat performance so we load the script
async so then what happens if it's not
loaded yet how do you use it there's a
trick in the middle over here we defined
this amp ready function it takes a
callback and attaches that callback to
ray that array is window amp the app
global object if am busines loaded yet
we defined have to be an array would
impact loads if then knows the array
exists and sticks it back into the
object and then when it actually loads
up all your callbacks in the array are
executed in turn so thus you have
asynchronous loading over here this
still allows you to attach your document
it's your chosen container using shadow
amp so we actually made this thing
called the shadow reader illustrates
this pattern and uh I'll show you how it
actually works over here if I can go
over to the demo there it is that was
like magic so this is a thing that we
built that uses existing articles from
the Guardian in London and you can see
over here this is a nice-looking page
this is a PWA and these things over here
are all links to articles you can see
over here on the bottom if you look at
the source code if you can see it you
probably can't see it
it's normal HTML it's not am but
clicking on and the article over here
very very quickly see how fast that was
the Wi-Fi here's kind of not very good
today either it pulls up the next
article and this article is an amp
article we actually inspect over here if
you can see this way down there let's
see if I can find it over here you will
see all this amp stuff in there and
pixel and analytics and over here
there's an article with the shadow root
so that's where the amp is attached down
there we can go back to the other
version over there notice that things
animate nicely these cards animate
beautifully there's oh that's not
working we'll see this in a minute - if
it's not an amp version of the page we
check for that to avoid errors they made
eight kinds and let's do that again
pretty quick right notice also the news
here it may be historic in the US
Michael Flynn is pleading guilty
interesting stuff is happening in my
home country
so there's how the shadow reader works
I'll set this offline cache I think it's
gonna appear offline
it's a full-fledged PWA now let's go
back to the slides over here and I'll
show you more about how this was built
there's the slides ok so again as I
showed before the amp exists inside a
PWA here's how we do it first we pull in
that amp data from an RSS feed next we
take the amp HTML and inject it into the
DOM and finally the percussive web app
makes the whole thing look and feel good
for the user the first step pulling on
the amp content pretty straightforward
we use a response XML over here we use
the excess KML HTTP requests we don't
use fetch because it turns out that the
response XML already contains a parse
Dom so this is pretty convenient over
here we then removed parts of the page
that aren't needed so the amp page for
the Guardian has these things like the
header it's got a menu over there we
don't want those things showing up
inside a PW away a second header a
second menu that's gonna be strange so
we simply remove all those things and
notice also no jQuery has been used here
no JavaScript frameworks it's all
vanilla JavaScript second we inject the
HTML into the Dom as we showed before
you create a shadow routes you to attach
that there to your chosen container
elements and then set it to be render
and there it is so first we actually
loaded the amp from RSS second we inject
that into the Dom and finally a PWA does
all the interesting stuff let's discuss
the PWA part of it now first of all you
get a fast initial load using an app
shell so it loads quickly and it first
loads up and then as the user moves
around the app things remain fast and
then as user uses the app it's an
immersive app-like experience
we also use a manifest to let the user
add this to their home screen like it
was an app and to have the display taken
over entirely by the website like it was
a nap and then offline content is also
possible all through the magic of PWA
we'll go over these things each in turn
first of all the app shell the idea of
PWA the app shell is to have the basic
shell of the app load first so your logo
your title of your company or in this
case of your newspaper some color some
stuff to indicate to the user that right
away
you're there in the app as more things
load they can wait for those things and
here there's a very simple text-based
way of showing things are loading it's
just a bunch of Tilda's and a pattern
that kind of resembles an article you
could have graphics instead but this is
a simple app showing how fast you can do
these things with this minimal minimal
stuff to use it to actually make this
happen I've noticed a couple years ago I
was using Facebook and I was looking my
Facebook newsfeed and I said wow
Facebook's much faster all of a sudden
things are already half loaded I just
clicked on this thing here and the news
feeds already mostly loaded it turned
out that it wasn't hey they were
tricking me they were using these little
blueish grey boxes and lines a static
image that will then be replaced by the
actual content but I thought it already
was half loaded users like this kind of
thing here's an example of that using
just Tilda's the show the articles are
on their way next things load quickly
anywhere you are on the app this is easy
because we're using amp content and
content as fast is written for speed and
a shadow Dom it's a stick the amp
content into our app third the app like
an immersive experience this is part of
the pattern because as content changes
HTML gets injected into the Dom
automatically and we use a serviceworker
to handle URL transitions you put in
some animations and things like that and
it looks good this was not very hard to
do and by the way all this code is
available online
and find on github check out amp cards
look for the shadow reader online it's
all there to look at as an exemple
number for these kind of fancy app
features adding the homescreen
think that full screen display are very
easy to do the manifest.json file lets
you define icons and colors and things
like that your phone recognize these
things if it's an Android phone and
allow adding the homescreen and then the
display is similar you can specify what
kind of display you want in this case
standalone which means it'll take over
the entire screen like an app also very
simple to do pardon my drinking some
water over here that's some good water
and then finally offline content this
can be a little harder sometimes the PWA
because you have to actually use
serviceworker and define your own
caching this can be a little bit
challenging but in this case it wasn't
we did use one javascript library here
which is called work box which has been
discussed also at talks at this events
work box is a super useful and fast way
to have Kashuk happen and other PW area
things happen over here we simply cache
some common routes so once they're
actually executed
that'll be cached in the browser we
cache certain pre key elements like some
images and things like that
and notice again that these are some
examples of actual code none of these
things use jQuery you could use jQuery
but you don't have to do just to show
that you don't have to we didn't use
jQuery or any other kind of JavaScript
library so you've got your app it works
the boss is happy you did it
congratulations good job you kept your
job so you made this beautiful PWA but
is this amp
I thought amp was a thing that you have
to do for Google because Google wants
you to have amp so you can get into
Google search carousel and valid amp is
important so is that okay can I do that
I mean yes you can does it actually
matter if the experience is good for the
user is that the most important thing
and in this case if you want your pages
to get served from the app cache on
Google it still happens because you've
got your original news articles which
all have passed validation so they all
get the search results they're all
served from the app cache your PWA is
something else it's just a fast nice way
to read the news here's an example that
just came out about a week ago lottery
Publica did this exact same pattern just
now these two screenshots show same
things that amp cards shadow reader
actually used there's your home page
over there click on the article which is
in Italian and then there it is over
there over there on the right I guess
yeah your left your right it's your
right it's my left over there on that
side closer to that side where I'm
pointing
awkwardly is the actual article and if
you looked at the actual site if you go
to your laptop's after this and check it
out you will see in there the shadow
root and the amp stuff I showed you a
minute ago this pattern tells to go
beyond publishing so for example let's
say you're making a site which is a lead
generation site with a form that
involves multiple pages say five
different pages often these forms are
hard for users to do what if you use amp
forms which you have automatic
validation which are fast to load which
are quick and then use the PWA around
those form pages these are can then
swipe between them smooth transitions
seem idea different vertical or
e-commerce for example we discussed
yesterday whole different kind of
e-commerce pattern this pattern over
here might be for example browsing a
series of product pages and as you
change from product page to product page
PWA
make smooth transitions allows offline
content so amp product pages are more
and more common you can use those amp
product pages that already exists and
stick those things into a nice immersive
vwa another example travel let's say
you're looking for hotel rooms or some
sort of share
ruining service or something else like
that with multiple listings the listings
can be amp pages and then stick those
things into the PWA the upshot is all of
this makes you money you save money
because it's easier to write these
things you can reuse existing pages
they're simple apps and also you make
money because users like the experience
which is fast and engaging and you have
more conversions so you're making money
on both sides it's not all about money
though for me as a former musician and
still occasional musician it's also
about simplicity and beauty I think that
actually things that are simple and
beautiful our good things because I mean
as a programmer you learn to make things
that are clean that are clear that
aren't cluttered with extra code that
doesn't do anything you want things to
make sense to people it's the simplicity
in that beauty that make code good and
that's just good aesthetically but also
more maintainable because it's easier to
tell what's going on if you have less
code and clear code and simpler code it
works better people on five years won't
curse your name for putting in all those
complicated stuff another reason to
consider amp is the simplicity and the
beauty of things that are simple and
beautiful if you have questions you can
find me after this over at the sandbox
over at the office hours and also people
asking a lot about where they can find
about out about amp so I added this
slide just this morning these three
sites over here that you can started
with amped and project org is our site
that lets you understand the various
components the validation and the cache
has various amp things work amp start
calm contains templates you can download
to use that are pre-designed to make
beautiful sites quickly including
yesterday's ecommerce template the bike
shop ant by example calm is a good way
to actually see examples of amp
components and try out the components
yourself and a playground to make
modifications to things and to see the
result immediately thank you very much
and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>