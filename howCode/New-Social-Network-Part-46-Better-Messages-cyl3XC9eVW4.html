<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>New Social Network - Part 46 - Better Messages | Coder Coacher - Coaching Coders</title><meta content="New Social Network - Part 46 - Better Messages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>New Social Network - Part 46 - Better Messages</b></h2><h5 class="post__date">2017-07-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cyl3XC9eVW4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to be
completing our messages system because
if we look at what we created in the
initial part of this series before the
design you can see this is our messaging
system and I don't like to look at that
so for the design what I did was pretty
much start from scratch so here's the
design here we have a title of the page
and then we have done the left-hand side
everyone who sent you a message in this
case is just three people that's not
actually working it's just a design and
then over here we have the masters that
show up as bubbles so to get this design
to work what we have to do is we
actually have to change the way we're
trading messages from the database at
the minute what we're doing is we're
just selecting all of the messages and
all of the users and we're joining them
together but what we're going to do is
when I use a more advanced query that
allows us to download all of the
messages that were received by a certain
user so in sickle Pro this is what our
actual database looks like we have the
idea of the sender the ID of the
receiver and we have the status whether
it was read or not so this is what our
finished query will return it has the
username of the sender the username of
the receiver on the actual message
itself so here's our query so what this
query does is it selects the idea the
message is a message body the username
of the person who signs that and the
receipt and the username of the person
who received it and it uses left joins
to be able to join the same table
multiple times but you can see that this
query is going to return every message
for every user so what we want to do is
make it a bit more specific by adding a
war clause and what we want to do is say
where the receiver which we refer to as
our username our username and it equals
and in this case we're going to set or
logged in as how code and s username
equals and then in this case we're going
to refer to the sender as asked username
so if I run this we won't get any
difference because you can see all of
these messages the sender and the
receiver are the same but what I'm going
to do is modify this so if I change the
sender from the idea of one to say a
number seven that's going to give us a
different user so now when I run the
query you can see that that message
disappeared and if I remove the wire
clause and run it again now you can see
we have that other message so this is
what our query is going to look like so
we're going to copy that
and we're going to use our API to query
the database so within the gap method
we're going to add another end point to
the end point we're going to add it's
going to be as if get your equals and
the end point is going to be called
messages so we want to get the sender
and the receiver so we're going to say
sandir is going to be equal to get
Sander and the receiver and the receiver
is going to be whoever's logged in so to
get the user ID and
just going to get the token from the
cookie and I'm going to copy this query
and use this query for the user ID so
we're just going to pierce that in there
so now we have the stander and the user
ID or the receiver we could call it
receiver and neither we have the
standard receiver we can actually get
the messages for any particular user so
we'll just add messages is equal to DB
query and here we want to paste in our
query so here's the query we designed
earlier just paste that in there and
change user name to receiver or we'll
just call it R and asked our username to
sander or we're just going to call it s
so we want to pass our array with our
variables so the first one is our it's
going to be equal to the receiver so we
get the receiver and then we want to get
the sender and this is going to return
an array and before our query will work
what we actually want to do is change it
so that instead of targeting our that
username we want to target we want to
target our dot ID and Saed because we're
trying to compare a username to an ID so
that's never going to work
so standard takes an ID and our receiver
returns an ID so we're just going to
refer to these two as IDs so now what
I'm going to do finally is I'm just
going to echo out the JSON that we get
back so Matthews is an arrest we want to
say JSON encode to convert it to a JSON
string I want to convert messages and
we're going to print that out and if I
just print some pre tags above it by
printing the pre tags this plug-in I
have in Chrome was formatted nicely for
us so if i refresh there is the format
and what I did was they went into the
database and I just modified a couple of
the Sanders and receivers I'm just going
to do one more I'm just going to change
the standard of this 27 and the receiver
to one because that's the user who I'm
logged in as if i refresh now we have a
third message but we're not getting any
message that Francis sent to that user
because you can see I just added a new
one so what I want to do is just go into
our code and modify our query so we just
surround this in brackets that will just
make sure that this part of the query is
evaluated as one chunk and what I want
to do is I want to say what the receiver
is us and the sender is is this person
here or the receiver is the sander and
the sander is a receiver in other words
that means to all the messages that I
have received from this user who were
calling the sander or so all of the
messages that I have sent to this user
soy paste is in here and I just reverse
it so the receiver is going to be the
standard and the standard is going to be
the receiver now if I run this you can
see we get that new message printed out
and in this message the sander was made
and the receiver was the person I send
it to
which was also the person who sent me
these other matches but that's it for
this video don't forget to Like comment
favorite and subscribe don't forget to
follow us on Facebook Twitter and reddit
if you have any questions you can always
email me but that's it for this video
I'll see you next time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>