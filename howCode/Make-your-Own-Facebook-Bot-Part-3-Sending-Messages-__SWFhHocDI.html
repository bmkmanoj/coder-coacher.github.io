<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Make your Own Facebook Bot - Part 3 - Sending Messages | Coder Coacher - Coaching Coders</title><meta content="Make your Own Facebook Bot - Part 3 - Sending Messages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Make your Own Facebook Bot - Part 3 - Sending Messages</b></h2><h5 class="post__date">2016-06-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/__SWFhHocDI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in the last part we left off being
able to receive messages from Facebook
so never Facebook send us a message and
we'd be able to take it from our bot and
we can see here's the message here and
we've stored that in a file so what
we're going to do today is we're going
to be responding to messages from
Facebook so we're just going to do a
really simple Facebook send us a message
we're going to reply to it with a
standard response no matter what the
message is so the first thing we want to
do is want to get the Sanders ID which
is the ID of the person who sent the
message to us the recipient ID is the ID
of our Facebook page but we only want
the Sanders ID because that's the ID we
want to reply to then we want to get the
text of their Santos that's not going to
be relevant in this tutorial because
we're not really going to be focusing on
what they sent we're just going to be
focused on replying no matter what
message was sent so the first thing we
have to do is we have to read the
contents of FB txt so when we do that is
we just say Facebook is equal to file
get contents Facebook txt
because when we refresh the page we're
sending another gat request which is
going to show up in the PHP input and is
then therefore going to overwrite this
page with nothing because there's not
actually anything being displayed and we
have to just comment this out just
temporarily while we're working on the
rest of the script so we have that there
in the Facebook variable we can just say
echo Facebook we'll just save that and
refresh this you can see here it is here
here is our JSON from Facebook I'm just
going to put in some pre tags just so
that we can see our JSON better
whoops cap type there we go
and we're going to save that and we're
going to refresh this so now what we
want to do is we're going to go into the
JSON and we're going to get the sender
ID so the way we do that is we can use
the PHP JSON decode function to decode
this JSON into an array so we're just
going to say Facebook is equal to JSON
decode so
book and then what we're going to say is
echo Facebook again and let's just see
what we get we probably just get array
at printer like this so whether we have
our JSON decoded into an array if I just
print our on that array let's see what
we get so you can see we get an object a
PHP object with an attribute called
entry then we have a zeroth index which
is the 0th index in this entry array
within the object and then if we go into
the 0th and these 0th index we can
access the ID of the message the time it
was said and then we can access another
array called messaging and then the 0th
index of that and then we can get to
sander and then the ID so it's actually
quite it looks complicated but it's not
too bad at all so what we're going to do
now is we're going to go into entry and
then we're going to go all the way into
ID to find the ID of the message so the
way we do that is we say echo whoops we
say echo Facebook which is our whole
object then we say entry which means now
we're on this array then we get the 0th
index of this array and then within the
array within that index in the array we
get the ID so the way we do that is we
go back to our editor we use the array
operator we put in 0 to get the 0 at
item and then we say ID to get that
attribute so we just refresh you can see
here is the idea we just got it up here
now
and now we're going to go into messaging
and we're going to go into sander after
that so we're going to go into messaging
then we're oath index of that which is
here then we're going to go into sander
and then we're going to go into ID so
this should be the ID of the person you
sent the message ok so the reason that
didn't work is because we have we didn't
put the operator in properly so here is
the ID of the person who sent the
message to us
you can see here so that's the most
important thing we need for this
tutorial so after that we have this is
RIT here so we're just going to store
this in a variable call it a recipient
ID or I should just call it our ID for
to make it shorter now we have the ID
now we can reply to the message and we
need to use the file get contents
function to send a request to Facebook
so we say file get contents the URL we
want to pass it is this URL here if we
go back to the Facebook guide this is
the URL that when you want to pass a to
Facebook this is the URL we access to
actually send a message to the Facebook
API so we just paste this in here and
you can see this is where we put in our
page access token so I'm just going to
create a viral call a token and up here
I'm going to create another variable
call it token I'm going to go back to
Facebook and I'm going to get my access
token here I have an access token in the
clipboard I'm going to paste it in there
is the access token there before this if
we try to access Facebook using this we
wouldn't actually be able to send them a
message because we wouldn't actually be
able to send them any any JSON data to
actually tell them what message to send
you can see if we go to the guide this
is what Facebook wants us to send them
it wants us to send them some JSON and
it wants us to tell them the recipients
ID and the message we want to send and
then we send it to this address so the
way we do that is we go back to the
fagot contacts function the first thing
we do is we add another parameter we
just write false it's not important and
then we put another parameter called
context and this allows us to send data
in the body of our request so in a file
get contents normally we just send a get
request as we get up here and that sends
a get request to the server and then the
server responds back with the file we
asked for but since we're sending a post
request and we're trying to send data
within the request we need to send some
context which is going to be the data
we're sounding the header
and the type of request want to send so
the way we do that is we first I'm going
to actually on just delete the pre tags
just because they're getting in the way
and they're not actually important I'm
going to delete the print are because
we've got everything we need to get and
down here is where I'm going to create
the context so context is just a
variable that is equal to the return
value of this PHP function the functions
called string context create and it
takes the parameter of the things we
want to send so the data we want to send
the Hatters and the type of request
wanna send so we're just going to create
another variable call that options so we
don't really need to worry about too
much like this function itself just know
that you need to use this function to
create an context to supply it to the
file get contents function so above and
the context we're going to supply it
with the options such as the data and
the headers and things like that so we
create a variable called options and we
set it equal to an array and the array
is going to hold some information we
need to pass to the file get contents
function so the first thing I'm going to
tell the file get contents function is
what type of protocol we're going to use
we're going to use HTTP so what we're
going to do is we're gonna supply our
array with one value I'm going to
college HTTP and that value is going to
be equal to an array and the array is
going to hold everything like our data
on our headers and things like that and
we actually get rid of that semicolon so
the first thing we're going to supply is
the method of the request which is going
to be post so we say method is equal to
post what we're doing is creating an
associative array so instead of using
numbers to identify the values in the
array we're using strings the next thing
we're going to send is the content which
is going to just be content and that is
going to be equal to our JSON so because
we're going to instead of just sending a
string we're going to create an array so
we're going to say a JSON in
code turn code RA into JSON JSON string
and we're going to pass it on a rack
called data which is going to be whoops
which is going to be where we put our
data then what we're going to do is
we're going to tell it what Hatter's
force and which is going to be Hatter
and then we're going to talent the
string we want to sound so we go back to
Facebook we can see here is the header
they want you to send it is just to tell
their API that we're sending JSON and we
just piss that in there we can add a new
line if we like and there we have it
there is our our options are created the
only thing left to do now is to supply
the data to the actual Facebook API so
what we do that is we say data that is
equal to an array and this array is
going to be encoded into JSON so we have
to follow the JSON structure so we go
back to Facebook's guide you can see
that we have recipient here and we have
message here
but within recipient we have value
called ID within message we have another
value called text but as you can see the
way this is modeled in PHP would be an a
rare called recipient which has one item
called ID and then the value of ID is
the user ID and then we have another
array called message and we have one
item and message called text and the
value of that item is the value of the
string we want to send so if that
doesn't make any sense it will hopefully
make some sense in a second so the first
thing we have to do is within our array
is we have to create two more arrays so
the first thing we're going to write is
recipient and that is going to be equal
to an associative array and that array
is going to have one whoops one value
that's called ID and that's going to be
equal to the user ID which is what we
got over here and we call it our ID then
we want to create another array and
that's going to be called and message
and that's going to be equal to another
associative array and that new array is
go
to hold one value called text and the
value of that text is going to be the
value of the message we want to send so
what we're just going to write here is
something like and nice to meet you
and that's what our bot is going to send
back to Facebook
whenever somebody sends our blog a
message so that's everything
so for that we need so if we just save
this and we just go back here
we send our bot a message say for
example we said it hello world okay so
let's let's go back see whether didn't
work and it looks like yeah we had a
syntax error here we just refresh or we
just save this so if we go to our body
staff and refresh you can see it's just
a white screen and if we actually load
this it's a not going to change so the
first thing we have to actually do is
uncomment this line here because we have
to actually store the data we get from
Facebook's request when they actually
message us to ask our bought a question
and then our block can respond but as
you can see if we just were to refresh
the page Facebook wouldn't actually be
sending us any requests which means if
we were to try to decipher what that
Facebook request was and get the user ID
from it we wouldn't actually get one
because we would just have a blank a
blank message wouldn't actually have any
ID it's toward within it so we have to
save this and then we go back to
Facebook and we type in hello world and
we have to actually message the contact
the Bart through Facebook okay so the
reason our bot wasn't working was just
because we had single quotes here
instead of double quotes so let's just
save that and let's hello or link in as
you can see now our bot has responded it
says nice to meet you we could really
easily just run randomize in the replies
we could just say something like I'm
passing a variable called the place and
then up here just put in replace is
equal to an array and actually we will
just say
Rand will say zero to save five in here
we'll just put in five replies actually
want to put the 4 because that lot of 5
replies so let's just say um the first
one is going to be
you
so we just said something as simple like
this what it will do is each one of
these items in the array will have an
index so this will be 0 1 2 3 4 and what
we're doing is we're just passing in
random array we actually need to pass in
the array itself will stay replies and
then we'll just pass in a random value
for the index of the array so hopefully
if we just see the changes and message
the bots again say mine is prizes
hopefully the bots will reply and says
enjoyed the bots as we could do
something else say just a letter H again
and let's see what it says and says how
are you again
so as you can see sometimes the bot
seems to apply twice as far as my word
this is probably a bug with Facebook and
all other actual code it could just be
maybe Facebook's and responding to our
requests so for example if we message
Facebook face we'll send that message to
us at our callback and then our callback
will send a message to Facebook and what
probably happens is facebook replies
once more to say that the message was
sent successfully or something like that
which would run our call back again and
cause this to be set cause the message
to be sent twice but I will look into
that but either way hope you enjoyed
this tutorial don't forget to Like
comment favorite and subscribe and I'll
see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>