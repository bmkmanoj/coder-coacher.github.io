<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>New Social Network - Part 26 - Sending Notifications | Coder Coacher - Coaching Coders</title><meta content="New Social Network - Part 26 - Sending Notifications - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>New Social Network - Part 26 - Sending Notifications</b></h2><h5 class="post__date">2017-02-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LS9maQt14jc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to be
learning how to build a simple
notification system so whenever somebody
likes one of your posts or when somebody
mentions you in a post we want to send
you a notification when that happens so
let's get started so the first thing we
need to do is create a new table and
we're going to call it notifications we
have the ID field first we're going to
leave that alone then we want to get the
notification type that will said type
for a notification type we're going to
leave it as an int to allow us to have
lots of different types of notifications
we don't want it to be null and we're
gonna leave it unsigned then we want the
user ID of the person who received the
notification so we'll say receiver will
leave that unsigned and we don't want it
to be no the sander is gonna be an int
as well and it's gonna be unsigned and
we're not gonna let that be null either
so now we're ready to start sanding
notifications so before we satin
notifications we want to be able to
receive them so we're going to create a
new page and it's gonna be called notify
dot PHP and we're gonna click Save we're
gonna copy our index page just paste it
and notify and we'll just delete all
this and what's it eat these because we
want to know if the users logged in and
we don't want to show their timeline we
don't want to show it we want to delete
comment will delete post and that should
be us and what we want to do is create a
query so we'll create an F statement and
we'll check if their query successful
first
and user ID is going to be our user ID
so here we're selecting all of our
notifications and we're putting in an if
statement to check that it worked and if
it worked we're going to get the result
of that query but just copy the query
Gihon store the result in a variable
call it notifications and it's going to
be equal to that query and then we're
gonna loop through that we're gonna save
for each notifications hours and we'll
just say then we'll echo I and type so
we'll get nothing printed out initially
so if we go to notify dot php' you can
see we get nothing right but that's okay
because we haven't actually sent any
notifications yet so we'll go to post
dot PHP and here and here when we create
a post we want to sand a notification if
we need to so we can copy most of our
lingcod function like this and we can
create a new function above it and we'll
call it a notify we could create a
separate notification class and we might
do that if our notifications become
substantial enough as and we start
standing lots and lots of different
types of notifications but for now we'll
just create a notify function and we'll
paste in that so at the minute these two
functions are the CM but well instead of
creating a new string so we'll delete
that will delete that because we could
have two different types of notification
and here we have a new string we're
gonna call this notify and it's going to
be an array and then here what we're
gonna do is get the username of the
person who the @ symbol points to so
we're gonna say notify and we're gonna
use the square brackets to say notify
word to get the username and we're gonna
say it for example 1 because 1 is going
to be the notification type and if the
notification type is 1 then we know it's
an OP mansion if for example somebody
likes a post it's going to have a
notification type of 2 and we don't
actually need the hashtags because we
don't get notified when a hashtag is
used and then what we'll do is return
notify
so when we create a post so we're gonna
say if count self notify post body
doesn't equal zero in other words if the
number of items in the array returned by
self notify is doesn't equal zero then
we have some notifications to send and
self notify is because South means we're
getting it from the class we're
currently in a post body is the body of
the post that we want to check so now we
want to do is loop through all of the
items in the array that's returns we'll
say for each self notify post body as an
in other words for every item in the
array we're going to refer to it as an
then we're gonna run a query so we'll
say DB query insert into notifications
the values first one is the ID which is
Auto incremented so we'll leave that out
the next one's the type the next one is
the receiver and the next one's a sander
so here we want to add the array type is
going to be the value of the item in the
array which is going to be an the
receiver it's gonna be the person who
receives a notification so we'll just
call it R and the sander we'll just call
s so up here we want to actually define
the variables s and the variable R so
we'll define s as the person who sent it
which is then in this case the person
who sent the post which is going to be
logged in user ID because that's the
person who wrote the post so s is gonna
be logged in user ID and here what we're
doing is we're assigning and as the
value from the item in the array so what
we could actually do is change this to
as K and use this arrow operator and
point out to n so in other words this is
another type of the for loop in PHP
where we'll be able to store the key in
the key variable and the value in the N
variable so now we can say R is equal to
the user ID and we can get the user ID
because now we have the key which is the
user name so we're gonna say R is equal
to another query select ID from users
where username equals user name and user
name is going to be equal to the key
from the notifications array and here we
want to get the only item returned which
will be the 0th index of the array
that's returned and we want to get the
ID failed from that
so now we have the user ad we store that
in R we have s which is the logged in
user ad so now we should have everything
we need to store a notification so we
aren't actually passing any texts we'll
just a text and we spell notify wrong
somewhere
so that should be it
if we check now we'll go to our
notifications table there shouldn't be
anything in it you can see there's no
Sanders or receivers now I'm going to
say at higher code hello i'm gonna click
post so the reason for that error was
just simply because in our notify
function we're using word which includes
the out sign so what we want to do is
use the substring function to remove the
first ladder and we'll try this again
if we click post we get no errors we go
to our notifications table we refresh
and now we have a notification idea of
one the type is one because that is the
type for an art mansion the receiver is
PI code with the ID of 3 if I go to
users you can see how code has an ID of
3 and sander has an ID of 1 because
that's who I'm logged in as play if
someone tries to use an app mention of a
user who doesn't exist we don't want to
insert that as a notification so what
we'll do is we will say if R equals 0
and I'm sorry in this and we actually
just say F R doesn't equal 0 so so long
as the our variable doesn't equal 0 in
other words so long as the user exists
we're going to send them a notification
I'm gonna refresh and we'll test one
more time if I mention myself I click
post you can see there we go if I go
back to the notification to say but we
should have another notification if I go
to notify now and i refresh you can see
I have a 1 printed I because I have one
notification and if I just print out an
which is gonna be an arrest so if I use
print R we can see there is the
notification I've just received so
that's it for this video in the next
part we're going to be displaying
notifications on the notification page
but that's it for this video don't
forget to Like comment favorite
subscribe don't forget to follow us on
Facebook Twitter and rat it and I'll see
you next time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>