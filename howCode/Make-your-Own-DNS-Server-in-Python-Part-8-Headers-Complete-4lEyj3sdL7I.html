<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Make your Own DNS Server in Python - Part 8 - Headers Complete | Coder Coacher - Coaching Coders</title><meta content="Make your Own DNS Server in Python - Part 8 - Headers Complete - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Make your Own DNS Server in Python - Part 8 - Headers Complete</b></h2><h5 class="post__date">2016-10-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4lEyj3sdL7I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now that we have the domain name of
the question we can get the records
because we can load the zone file
because we know the domain name so what
we're gonna do is we're gonna create a
function called get Rex we're gonna pass
it the variable data and it's gonna be
the same variable as above then what
we're actually do is just delete this
and we're gonna come up here and create
get Rex we're gonna pass it a variable
called data and then in here we're gonna
say domion
comma question type is equal to the
return value of get question domain and
we just want to pass it the entire data
variable then what we want to do is we
want to say if question type is equal to
x 0 0 slash X 0 1 which means the two
bytes that make up the question type are
equal to 1 then we're going to say QT is
equal to err because if we go back to
Wireshark you can see that when the
question is of type a it is encoded as
r1 so we're going to just create the
variable QT up here so now that we know
the question type which means we know
what records to look for we can retrieve
them from the zone so we can say zone is
equal to cat zoom domain and we're going
to pass Thome into a new var new
function we're going to create called
cat zone before we do that what we want
to do is we want to screw up to the top
and we want to create a global variable
called zone data and it's going to be
equal to the output of load zones which
is another function we're going to
create now so load zones
it's gonna be a function that loads all
of the zones that we have under our
control
whenever the DNS server is started up
because it load them into memory then we
can retrieve them from memory whenever
we need them and it's good for
performance reasons because we're not
doing as much file i/o so we're gonna
create a variable called zone files and
we're gonna get our zone files from the
folder zones so we need to import a
library called calab and we want to say
zone files is equal to glob glob and
then here we just want to pass it zones
slash star zone which means we want to
lock in the zones
folder for every file that ends in dot
zone and zone files if we print it out
we can't run this yet because we have an
undefined function we have a gate zone
isn't defined yet so we want to go up
here and just to find get zone and then
just say pass this just allows us to
define a function without actually
giving it a method body so if we just
run this put in our password load zone
is not defined
I call it load zones so I'll just call
it loot zones
you can see I printed out a list
containing one's own file so what we
want to do is we want to take all of
those own files and we want to read the
file and load it into our program so we
want to say for Zone in zone files and
then we want to say with open
zone as zone data so now we have the
data stored in zone data we want to
create a variable called data we want to
set set it equal to JSON load
zone data and then okay we want to
include the json library too because all
of our zones use JSON so we're loading
the JSON and storing in a variable
called data and what we want to do is
come up here and create a verbal called
JSON zone and we set that equal to an MP
dictionary and then here we want to say
is JSON zoom and we'll pass it a key and
once added equal to data and the key
we're gonna pass it is just going to be
something like a zoom name and we're
gonna get zone name from data origin
and if we go back to the zoom file you
can see the origin contains the domain
name with an extra dot on the end of it
and then here we just want to return
JSON zoom so now that we have all of our
owns loaded in our program we can set
global zoom data which gives us access
to the zoom data and we want to get the
domain name obviously and enter the
function so now that we have this own
data we can get the data from a specific
zone because we have all the zones
loaded and we have the domain name that
we want to look out so we want to say a
zone underscore name is equal to we want
to join our less together so we're going
to say join the list on dots and we're
gonna set join domain and then we're
gonna append on a dot on the end of it
because all of our origins also have a
dot on the end of them and then we want
to say return zone data zone yep so this
will load all of the zone data and then
it returned it to us when we run the cat
zoom function so now we have the zone
stored in the zone variable and what we
want to do is return
Topol equal to zone QT for question type
followed by the domain name itself so if
I print out gat Rex
hopefully we'll get the entire zone file
of how kutaro printed out to us okay so
there's a syntax error there let's just
fix that so up here we just have to set
that to in equals let's run this okay so
the reason we got this weird error is
because we accidentally put in the X
plus one twice so we actually just need
to delete this and let's just run this
again you can see that almost fixed it
we just have this backslash X in it as
well
and we can easily fix that just by
saying if bite doesn't equal zero then
we'll pan it onto that string so let's
just run this and we just have an extra
dot so we can just scroll up here so we
can just get rid of the dart
and once it heats up print as well so
let's just try this one more time so we
have another typo just cutie instead of
a a okay so here we have exactly what we
wanted we have this own file printed out
and it's stored inside of a dictionary
and finally we just want to change this
so instead of returning the entire zone
we just want to return the records that
are relevant to this request so we want
a return zone and then we put in QT to
get just the air records let's run this
one more time we get an error because
for some reason QT isn't being set but
if we scroll up here the reason was
because when we fix this function
earlier we just need to change this to Y
and y plus two let's just try that again
no we should have the correct question
type and as you can see whatever Dead
was it returned all the air records in
JSON format I know what we can do is we
can finally print out the answer cone so
we can get the answer time by saying Len
to get the length of the first off it's
getting the length of this topple but
what you want to get the length of the
first element of the table so we can put
in a zero to get the first element of
the tupple so we just put a zero in here
so you can see now we get three
if I go to the zone file and I just
pissed in something another record we
have for air records now if I run this
again we get four printed out so the
answer count is going to be equal to and
current it's going to be equal to the
number of records but then what we want
to do is say dot two bytes but to
convert it to bytes but then what we'll
say is convert it to two bytes and then
we'll say byte order equals big and then
we'll just print out answer current and
we have a syntax error okay so we just
have an extra privacy there let's just
run this again and you'd see we get four
printed out we have two bytes and
they're equal four so there's our answer
current done the next part of the header
we have to do is the name server console
name server current and we're just going
to make this 0 it's gonna be equal to
0.2 bytes 2 and then we'll just do the
same thing in byte order equals big and
then finally we'll just copy this under
one more time for the additional section
and then that should be all of our
headers done do the additional section
and that should be it just to our
current and then finally we can just say
DNS Hatter is equal to transaction ID we
don't actually need the this part
actually we can just get rid of that
transaction ID plus the flags these have
to be in the correct order as you can
see they're in the same order as they
would be in the normal just DNS response
that's what we have the transaction ID
the flags
plus the QD current plus the answer
current plus the name server current
plus the AR kind
let's just print this I'm gonna get the
DNS how to print tonight so that's it
for this video don't forget to like
comment favorite and subscribe and I'll
see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>