<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Make a Social Network from Scratch: Part 19 - Making the Friend System | Coder Coacher - Coaching Coders</title><meta content="How to Make a Social Network from Scratch: Part 19 - Making the Friend System - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Make a Social Network from Scratch: Part 19 - Making the Friend System</b></h2><h5 class="post__date">2012-08-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8T8yonm_zbw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi and welcome to this video so last
time we left off I believe it was
allowing people to upload photos so
today what we're going to be doing is
creating allowing people to make add
friends to their cards so they can out
just to let me allow people to have
friends so let me open up profiles up
PHP okay so first we need to add the I
our thread our friend button so okay so
I think I'm going to have the bottom
here right above the person's profile
name so I'm going to put it in here so
I'm going to create a form and it's
action is going to be the page currently
on so I just need to say echo username
so now if we submitted that formats and
I would submit the same page we're sort
of a staff submitting form and the
method is as usual going to be post so
I'm going to first create one but our
two buttons they're both going to be
submit the first one's going to be
called and when I called um out friend
and its value is going to be
odd as fan so if we see that go to proof
of age now with the button that says
Alice friend and if I click it it
submits the form but it sends us to this
page which is normal and so that means
it's correct it's working so we can just
copy this one we can change this to send
msg from message and change us to send
message and now we have our two buttons
okay so the first thing we have to do is
go to our database in our users table in
our users table you can see right beside
the profile peg field I've created a new
one called friend array it's I'll just
go to structure so you can see what it's
just a tad just M of type text think
yeah it's just text and so just create a
new row called friend ray let's type
text so once you've done that we need to
go back out of our social network a
database and I'll create a new table and
this is table it's going to hold all of
the friend requests so while before the
person oh wait I don't I am I'm going to
import it because I'm in an SQL file
earlier so this will be in the
description is off so so it's called
it's going to create a table called
friend requests and this is where the
person's friend request will be stored
before they accept once they accept it
will delete it from the friend requests
table so in this table we just have
three fiends ID for the ID of the friend
request and it's auto increment and a
set to the primary key user from which
is the person that sent the friend
request
so whoever clicks out his friend on the
other person's will be our profile and
as a barge our of to blank tooth of
length 255 and user 2 is just the user
who the friend request is for and it's
also a voucher or Charles - over length
255 so now that we've created that table
we can start actually writing the code
so we can just put this in here it
doesn't matter and we're going to say is
if is set ok so what this says is if the
odd friend button is clicked so if the
if it receives data from the odd friend
button I've posted then we run this code
or else just do nothing as usual so what
we wanted to what we want to do is
create a variable oops and we want to
create a variable called friend request
which is equal to post add friend so
it's just for to keep it quicker when
we're typing zoning to keep typing the
side
so now we have that variable we can say
user which is our user two is we're
going to create a variable called user
two which is the same as the field in
our database but it doesn't matter it
doesn't have to be an user two is the
variable user and the variable use no
it's yes actually
actually I'm sorry that's wrong it's
user two is the user name which is the
variable we created up here
so as you always so whatever this value
is here is the value value of the
username variable so just find it okay
I'm user from equals user which is the
user is and if I open that you header
file user is the session user login
which is whoever's logged in so however
this is variable if I were set whoever
the friend request is for this variable
is forever the friend request is whoever
sent the friend request so we can just
do a simple check here so we can say if
user equals RF user two equals user name
then we just echo you can send a friend
request to yourself
so since I'm logged in as Francis and
I'm on my profile page if I try to send
a friend request myself we should get
that error
okay yeah here it is
you can't send a friend request to
yourself um all right so actually I'm
just going to keep it neater I'm just
going to create a variable called Error
error message so then we can say we can
just go in here we're going to step back
oh error message so know whatever i
refresh okay so to prevent this error
undefined variable because we didn't
actually define the variable here until
the form was submitted so we just above
this weakness error message equals
nothing so now the error is gone
check out friend Bob's friend um okay
actually all that's worked but it just
looks a bit weird so let's just add a
break in there so if we try it again try
that sound if I'm impressed yourself
okay so it looks a bit better so now we
do not check we can say it once we set
out we can just say else and then we can
actually so at odd the friend requests
to the front of quests table in the
database so we just create a variable
called create request and it equals okay
so it equals mysql query and we're going
to say insert and in into
friend requests values
I'm Grasso first when we leave blank
because it's the ID and it's Auto
incremented so we don't need to put that
in the next thing we say is we need
three of these action so the middle one
is just going to say user two which is
the variable we created earlier which is
the user name so whoever's profile this
is and user from equals whoever set the
friend request so now we can just act
underneath now we can just set error and
also now we can just say it I use it to
power your friend request as main set
okay so now if we click uhm actually
have a out friend will still get
same hours earlier doesn't start on my
profile so if I go to another one so in
fact I got a friend now or add as friend
hmm right so I change that to user and
not want to use your name click so now
if I try to stand it says your friend
classes been set and I go to browse ok
yeah that makes sense no ok so the
reason that didn't work earlier was
because the user - actually I'm not
quite sure what that works well it works
anyway so doesn't matter
so we must have a problem up here where
we've changed the value of the variables
or something I know but whatever we can
we don't need to do idle without
move on so that actually works no the
nods in the database so the user from is
Frances which is who I'm logged in as
the user to a cinema which is the
profile model so that means that work
that's worked on the friend request
isn't set so next thing we need to do is
just creating your page and gonna put it
in the main folder so dot PHP file so
we'll just go to our files and what kind
of call it friend requests so this is
the page the users going to go to to and
accept or decline any or ignore actually
any friend requests so let's go to let's
first include the in /m Inc files /
header top whoops so if we include that
and we go to to add friend requests now
we just have a black page and which we
should still be logged in anyway so that
means we can actually continue so create
a new PHP block and we're going to just
let it find and less because the first
thing we need to do is actually check
does the user have any friend requests
so we can create a new variable called
find request and it is also my query and
this query says select all from friend
request or user
- equals user so more the user to field
which is this one equals and the user if
I was logged in now we sad here so in my
case it would say select all from friend
requests or the user to field which is
this one equals Frances but I don't have
any from the other end any friend of
quests so I'm going to log in to another
one okay so we'll go to the friend
requests page and we can't see it yet
because we have told it to a quieting so
at the moment it just queried the
database so we need to send not MIT
create a variable called num rows which
equals MySQL num rows find requests and
then we say if num rows equals equals
zero so if the numbers equal if there is
no friend request basically we just echo
you have no friend requests this time so
I'm going to actually log out log back
in as Frances go back to the page that
says you have no friend requests at this
time but well let me just working which
is good so my lot now we know that it's
working if you don't have any friend of
quest if I login back to cinema' we
shouldn't see that because I should have
a friend quest okay so it's blank
because we haven't told it what to do if
it does find M rows so what we say is
else and we'll just create a while loop
and we say ok while get row equals mysql
fetch associate our a sock for short
friend requests so it's going to fetch
any friend request so we have in the
database if num rows is more than 0 so
if we have fried requests it will find
them and we just create variable called
ID which is the idea of the friend
request which is equal to cat row ID and
we just paste it in to a couple of times
just paste it up here so in here this
one's going to be called user for two
and equal to row user to this one's
going to be equal to user from and also
these are from so now we have these um
now we fetch the results we just need to
echo the Mart to page I never really
explained this but what a wide loop
actually does is it just go for every in
this instance for every not for every
row it finds it and run this loop move
again and it will a KO each row so there
was two rows we would get one a coup it
would echo a I want the one row but if
there was two rows would echo both rows
twice or twice it will do two it would a
code
it's kind of hard to explain but
hopefully I think of a better way Nader
book so user from is the username of
whoever sent the final best now we're
just going to say wants to be friends
okay so if we refresh this No all right
so I found the problem and so I just
miss about the variable up here so I was
look it was looking for then instead of
writing friend friend request I would
find requests so fresh
and I just have to put it back here as
well so refresh 9 okay so now it says
Francis wants to be friends and if we
look here it says user from Francis user
to cinema so when I since I logged in a
cinema tells me Francis lots of friends
so that's good that means it's working
so I'm going to create a form now to
actually accept the friend request and
it's action is going to equal friend
requests up PHP it's a method just going
to equal post again and it's going to
have two buttons first one submit its
name is going to be odd no accept
request okay um so I plan this tutorial
out first I wrote it out and then I to
make sure it worked I wrote it out I
know I'm just copying it from the screen
beside me because it's a lot of things
just to remember and chance of supple of
me making a mistake other than a typo or
a lot higher so I was going to leave at
except request that but I remembered
that caused problems wrapped later down
the line when I created it the first
time so I'm just going to echo user from
okay so why I did this was because I was
coming into problem where I said if I
accept requests so like on the profile
page or is it
it's a boost outran quad friend so when
you have more than one friend request
and you don't want to accept them all at
once what this did was i sat at fox
after quest accepted
when you collect that it would submit it
would do it every single request you
Hadi even if you only want when you
wanted to reply to one person so because
they're all the same so by adding user
from in the thing in the name of it it
makes every single friend request
individual so when you accept one it
won't accept the others so now we just
saw those a bit long but we just say
accept request so now we'll have a
button says accept request on the five
you the source it says except request
Francis and if I had a request from
another user in the database then it
would say except request and then I
would say the other users name so that's
just to stop ass running into problems
knit one that's one of the reasons I
sort of plan the might and do the two
top usually plan the might and usually
you do them first the tutorials because
and it means I don't run into these
problems when I'm recording so with two
buttons
they're both unique so because we did
that I can just press and click on one
works so because I did that now we can
move on or we can say if is that
okay so we're gonna say accept requests
but this is going to make us run up this
is going to look for any button let's
call it except by the name of except
request but as you can see none of our
buttons will because they're accept
requests and then the other users name
so what we need to do is we append the
user from variable on to the accept and
post then so that's really easy all we
do is but dot we're just to append
something in PHP just put a dot and then
you pen then you decide the dot what you
want so user from so try to check that
work so I'm going to say friend request
accepted I know it says a friend request
accepted because if we go here the name
accept request Frances is the same as
except request that user from because
the variable user from equals to vote
from the database which equals Frances
so we know that works we can actually
get a good move on with actually I am
adding the user into the database but
this is slow and that's it we're not
going to do it as a conventional update
like we're not just going to do it the
way we normally would where we just
create a query and we just update the
friend area row in the users table
because that would overwrite whatever
was previously in the row and then that
will mean to everyone could only have
one friend and when the added and you
want to remove the roller so what we
need to do is we're well I'll talk about
that one we get but first we actually
need to create a query
select well actually I could actually
say hi because it makes sense hope right
so what we're going to do is we want to
create two queries and the first query
is a to just comment
select the friend or a row from the
logged in user and the second query is
to select the friend of a row from the
user who said the friend request and we
need to do this because what we're going
to be doing instead of updating a row
instead of just having an update row or
what I we are going to be concatenated
and the new friends and username on to
the existing row and um I mean that's we
don't wait we're going to be creating an
array and it's going to be separated
with commas and if we have a calm at the
start of the array and then we have say
my username we have another caller then
another username then and the array
shows with two users because we're going
to explode the ran it looks okay it's
going to look for comments but if we put
a comma at the start of the array it's
it's going to think that's another user
so it's going to think we have one it's
going to think these are that the
comments start to user my username is a
user and this is using them the user so
we need to say that we need to select
the friends array row from both users
because they could have different
amounts of friends and we want to say if
basically in here's the logic behind it
if the user has no friends
we just um can cut I just thinking cap
for short the person the friends just
friends username so then all that's
going to do is just up if their friend
array is empty that is just going to add
who out the username of the friend to
the friend aware so the friend array was
empty and I had a friend request from
Francis I'm just going to say it would
opt it would concatenate the word
Francis to the friend aware row and that
one so if we were looking in a database
it would just be a roadside Francis but
if they already have a friend so if they
already had a friend called Francis and
we're adding another friend and say this
other friend was called cinema we don't
want to just concatenate the word cinema
because there's no comma here so it's
going to think that this is a user that
Francis cinema is actually a user which
it isn't in this case so in the key in
that case if they already have a friend
we want to add a comma can count we want
to concatenate a comma plus the person's
user name if they have that more than
what if they have one or more friends
but we need to do the row for both
friends because if one friend has a
foreign person's friend where Rho is
empty and the other person has 20
friends
you can't just concatenate the same
thing onto each person's row because if
one is zero then you put a comma at the
beginning then you're going then it's
good it's going to run into problems yes
again but that I would only work if the
both friends are the same amount of
friends so I hope that made sense but
that's the logic behind why we're going
to be why there's a lot of queries here
one is to but they're quite long so well
let's actually get started so we're
going to create a front a query called
out a friend check and it equals a MySQL
query
and this query just says select friend
array from users where username equals
user so what this is doing is it's
selecting the friend or a from the users
table whether user name equals user the
user variable is the user hovers log of
the username of who I was logged in and
then week I got a friend row and we're
going to say friend array so no wait
that's a lot so I left online get friend
row equals mysql fetch assess oh it was
a lot weird and then we say get friend
check and then we can say friend array
equals get friend row friend all right
so I'm sorry this tutorial on quite a
lot but the friend requests system is
quite complicated because we're
exploding we're creating arrays and kata
nating two arrays selecting and the
whole array and exploding the array and
thing and losing off a lot of things
that have to go on and then we can just
copy this just taste it done so we say
add friend check and then we just click
it we just make the variable different
I'm just going to write a user new item
or friend just a friend so I just add
this onto each of these just to make it
different
because the yeah okay they have to be
different so the only thing we need to
change here is change the VAR variable
user to user from so where username
equals user from which is the variable
we created earlier which selects the
user from row change from the row and
the friend requests table so this one's
going to query right actually to keep it
simple since I'm logged in a cinema this
query will all these these three lines
of code are going to check are going to
get my friend array from the database
they're going to get my friend rare from
the database which as you see is empty
and they're going to place it its value
which is nothing in Iraq called friend
array then we got this query just as the
same thing for whoever set the request
which if we go back to friend requests
is Francis which is also me but two
different icons so just get refresh that
I know we've got the two arrays first
thing we need to just going to comment
this actually I get friend RA for lock
in user and then down oops
put on your cat's friend array for a
person
who send requests okay so now we create
another variable and it's called friend
array um explode so I'm right what this
is going to do is it's going to explode
the rare but since there's nothing in my
array it might give us an error so I'm
going to since I'm logged in a cinema
I'm going to just manually add the name
Francis to the array and I'll do the
same for Center for Francis I don't
allowed to write the name cinema to the
Arab this is basically what we're going
to be doing but it's going to be
automated a wrong person but it's going
to be automated so our PHP script will
do this for us so um you want to start
Center so now it's going to look like
these two people two friends so when we
explode the array we will get and those
variable are those values in the array
because there'd be no point exploding it
and explaining it if there was nothing
in the arrest you couldn't see anything
so we're going to explode the array and
the a PHP explode function takes two
parameters the first parameter takes is
what you want to explode it by so what
your delimiter what is at what delimiter
you're going to use so we're going to
use the comma so every time it sees a
comma it's going to put that in our it's
going to like it take it out of the
array and then make it sort of its own
string kind of that's not actually what
it tells but that's just kind of a way
to explain it
so that we just to create another
variable after we've exploded the array
and let me just I'll just show you fully
echo and this variable and you should
just
we shouldn't actually see the word um
Frances we should actually just see the
word array where is it right so if I and
I click this button okay so we can we're
getting an error from defined variables
XI just declare them right here so
that's usually good practice but
sometimes when I'm amuse me I just don't
bother and I just talked about got any
errors but in this case we did snow
correct it and you see comes fresh this
see okay I'll come back I'll fix this
and I'll come back when it's done
okay so that wasn't actually the problem
I was thinking that wasn't it I didn't
really I wasn't even sure that was the
problem I thought it was probably wrong
so we just once again we could just keep
things simple I'm just going to change
this to get because and as you can see
that was called odd friend check and
this was looking for get friend check so
we change it here as well
we collect sap requests then I can see
as I said earlier we just get a ten the
word array so we create a new variable
called friend array Conte and air once
again I'm sighs taking so long there's
just so much to go through and with
France system because of the amount of
things we have to do and the might of
things to talk about and then because we
never done them before so there's an
awful lot of stuff to do so if this
function Conte is going to count how
many objects are in the array and this
is when this is the reason why in the
database oh yeah that's okay this is why
in the end database in the friend or air
column it counts um you might have items
in your air but it would think a comma
what if wait a comma at the start of the
friend array it would cantata is another
item and I can show that no so if we
just echo friend alright can't oops I
need to equit so echo and all we should
get one so yes we get one I'm taking a
case here I read I'll just append a
break tag on so fresh it so now we get
one so I'm assuming well this is we all
with diamond I'm assuming this is crack
so if I was to add a comma the start of
it the array wouldn't at the array
wouldn't contact commas dilemma her and
I would count as a friend request or as
a friend
so now get to which is why it will count
it as a friend so I just need to get rid
of this one
okay
so now we have the query for the logged
in user we just copy this and change the
name of it
so f-friend or explode we just change
that to underscore friend just once
again so it's different a friend or a
friend and RAF our friend reacts blue
underscore friend okay so that's a lot
of it done noise so now we can just say
we can actually add the users friend
concatenate em the friend request on to
the actual friends array at table so I
also that I'll just edit or I will
delete the I will empty these from the
rise so that we can add it with the
paint with PHP and actually prove it
work so and that's it so um I'm going to
save friend array equals equal to zero
so I'm no no not zero because the zero
is enough so if I am that won't work so
if a equals am if it equals nothing
which means if it's empty we just say
friend array count equals count
and if I was to say current and when I
was to pot um Friday the fret you see I
was to get it if I was to say friend a
wreck hunt then um what this would do is
basically what I would do is the friend
if the friend where was empty whoops
actually don't know so if the friend
room was empty and ie sad friend er I
can't
as you'll see like so actually I could
just prove it back ooh so even an empty
array still at once I went if you a co
an empty array you'll still get the
value one and you can see and that was
whenever I was going through this that
was making all the scripts mess up so I
looked for a solution like that's when I
found out it even an empty I I realized
why it was when I find out why I was
doing it from a lot of time spent
looking over the errors and things and I
find out that's when I found out an
array an empty array still equals one so
wanting to say if the friend away is
empty we can't get friend record to
equal one so we need to make we need to
get signed at a different value so we'll
just assign it the value of count and
we'll said no which is basically like
making an empty red and we need to do
the same thing when you do the same
thing for the other array so the friend
around the score friend um and once
again same thing there so now that means
if your eyes are empty that will equal
zero or not so if we have two friend
their girlfriend Iraq hunt we check this
we should we should we should get 0
which is good which 0 is e as the same
is knowledge means nothing it's empty so
now that works means we can move on and
now we can start telling it whether to
concatenate just the username of the
friend or concatenate a comma and then
the username of the friend so this is
why we said friend Iraq we set the if
it's FM the friend array is empty we set
the front of a contrary wall to null
because now we're going to say if friend
all right
current equals no so
then we're going to only concatenate the
just the friends username not the comma
so we're going to say add friend we're
great a query call that friend query and
then equals mysql query we're going to
say update I know I said I wasn't going
to use update but and we're not just
using the standard yet we have to
actually say update users because we say
update user set friend array equal to
concat or just concatenate it and here
we give it two values so we say friend
array which means keep the original
value basically and then we say the
value user from which is the user set
the request then we say or username
equals user so that's the query for
that's the for
half of the query so that's already the
first part of the queer there's two
queries to do there's the first one for
the person new for the first user and
then there's the one from second user
because we have to update both of their
arrays so just this is simple just
change slight things we change out the
user to and we're using equals user from
so now if we go here oops
okay so if i refresh this is the proof
that I haven't done anything can see all
these friend arrays are empty okay so
when I click the button and IMAX app
requests what it's going to do is um
what it's going to do is add the value
cinema to add this user there Francis so
it's going to add the value user into
cinema in this area and Francis into
this array without any comments because
third and fundraiser but with empty so
we can also just um add a confirmation
message as well so we could just say
something simple I'm like look you put
weight on you we just say echo you know
friends so now if I click this we see
now you're not friends and if I go back
to the yeah users table
mmm
okay so I'll fix this and I'll come back
when I'm done
okay so sorry about that so I have fun
the problem and you had another type
over me so I'm sorry with that so um we
just put these here so there's it I
think that should be working not so I
click accept request hopefully we will
have yep okay so now with two things in
already okay and I'm sorry I'm going to
have to end this video here because it's
gone on way too long for one video but
don't worry I'm not going to leave this
and like every food any other way I take
average few days I upload a video I'm
going to finish this friend and request
system thing over the next couple of
days switched out upload a video and I'm
trying my best
blue thumbs cut off another gun so I
will try to upload them more often
Mariamne so um but that's about it for
this video so I don't forget to comment
rate and subscribe thanks for watching
and and see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>