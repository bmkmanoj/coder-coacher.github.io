<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Make your Own VM in Python: Part 5 - The Stack | Coder Coacher - Coaching Coders</title><meta content="Make your Own VM in Python: Part 5 - The Stack - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Make your Own VM in Python: Part 5 - The Stack</b></h2><h5 class="post__date">2014-05-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jWjFTqQ2nCg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hi welcome to this video so today
what we're going to be doing is we're
going to be actually making our virtual
machine do something so the first thing
I'm going to do actually is I'm just
going to check that it's the compiles to
see using our Python so let's hit python
r the end of Pi and hit enter and
hopefully we'll get the errors oh yeah
so we didn't get any errors luckily and
then this is just going to go through
and run and do whatever it does normally
so we'll just give that a minute
it should take about 20 seconds because
we've done some things we haven't done
much so it might just only take about 16
20 seconds okay tap tap took 17 seconds
so if I try to run this program and I
give it a test dot whoops hello dot VM I
didn't see I felt that I'd just progress
on table when I hit enter that's exactly
the same thing but if we tighten this
again hello dot VM as we see it that was
a bit higher than it should
that's also because I'm recording on my
screen which is why these are me
slightly slower than they will be for
you probably so if I said time at Python
the end up I head out of the end as you
can see it's a lot slower even that
night so it's really a good idea to
convert it to see with PI R with a
Python he's our Python translator
so the first instruction we need to
actually make work as the plush
instruction because without push we or
that depression structure we can't do
anything so what we're going to do is
we're going to pass the push instruction
and the instruction obviously so we'll
say or actually don't need to pass at
the instruction we're going to pass it
the so we're going to do is going to
pass it the variable I which will tell
it whereabouts in the sort of list of
instructions we are that reminds me you
need to go up here and we need to create
a variable the variable in a create is
called stack and it's going to be a list
and this is going to be our stack that's
what we're going to push onto
and that's basically what we need all
you need to create for a knife so we're
going to do is we're going to go to our
post function I actually to pass at the
Al as well so that it can access the
array so if I said I you know and in
here we need to accept I on it so all we
need except I now so I'm saying I know
and then know what I'm gonna do is I'm
going to save print and you'll see it
prints out the entire list
unlike sheet just get rid of the time
function we didn't do that so let's just
go back as you can see it prints out the
list and then it's these just ignore
these for mine so what we're gonna do
now is I'm gonna print I and you'll see
this will tell us the instruction world
which in this case is 0 because push is
the first instruction in the fat so I'm
not going to make things really
complicated on lat numbers at all to
each other so for example 0 0 0 B add on
to 0 0 0 a and make a bigger number
we're just gonna keep it simple for now
so what I'm gonna say is to push isn't
variable I'm going to create and then
set that equal to L I so you say print
to question as you can see it print 0 0
2 but we don't actually print that we
want to print leenock the next number
which is I plus 1 so as you can see and
I print 0 0 0 a so I'm going to do is
going to delete that and I'm gonna
convert this to an integer because at
the moment this is a string to write if
I print oops if I just print type to
push
and I come to the terminal and hit enter
as you see it says type STR so what we
want to do is want to convert it to an
integer I'm going to convert it to an
integer using the in function we want to
keep this 16 so I need to pass it these
16 for all these pound or 16 which
converts the base all we have to do is
add that to the top of the stack so oral
actually would add it to the add it to
the end of the stack because it's more
efficient so we're just gonna say stack
dot append punch align it to the end and
stack which is kind of the top of it for
us I'm gonna append to push then what
I'm gonna say down here is I'm actually
I'm gonna do the print next because then
we can see the add value on the top of
the stack so the print function we don't
need to pass it anything we just need to
print the stack so I'm just gonna say a
print stack for a now let's print the
entire stack so as you can see it prints
10 which is the entire stack for 9 so
what I'm gonna do is I'm gonna print
stack and I'm gonna print stack minus 1
which will get the last sound that on
the stack which in our case is 10 so we
print function is actually done and it's
printing the top of the stack so the
next thing we want to do is we want to
be able to pop the stack and that's easy
too all we do is we say stack down path
because pop is a built-in function with
a Python that actually popped the top of
the list so are we the end of the and
end of a list so we haven't got pop in
our program so if I run this you'll see
we have nothing so what I'm gonna do is
gonna push another number on the top of
the stack and going to say a 0 to
actually don't want say end of program I
want to put this before the end of the
program I'm gonna say 0 to 0 0 0 and
instead of a I'm gonna say B which will
be 11 and then I'm gonna say a 0 1 to
say end of instruction and then they're
going to print that so as you can see it
says it prints the top of the stack here
which up here in the top of the stack is
10 and then further on in the program
the top of the stack is 11 which is why
it printed a land
so what I'm going to do now is I'm going
to pop the top of the stack and I'm
going to use the pop command which if we
go up here we can see pop is number zero
three saying this is zero three
tonight what I'm going to do is I'm
going to hit enter and we actually need
to print the top and stack after that so
if I just hit enter I can see it popped
the top of the stack and all we have tad
on top of the stack this might be easier
if I just print the whole stack for mine
so what I'm gonna do is gonna hit enter
and I've been seeing the stock non
consists of 10 up here
further on the program is Valley where
we've added 11 to the top of the stack
and then after that we pop the lambing
off the top of it so now we the top of
the stack is not just at 10 so that
shows our pop function is working so now
that we've done that we want we only
have ad and of instruction to do so what
atom instruction is going to say is we
don't actually need atom instruction
because this is a real similar machine I
was actually over complicating things so
we'll get rid of and of instruction and
we can get rid of these zero ones so
we'll just hit up an entire agency it
seems to be working so what I'm going to
say now is we're going to do the add
function so what ad is going to say is
and num 1 equals stack - 1 num2 equals
stacked -2 so what stock -1 is is it's
the number at the end of the stack and
number 2 is the number directly below
that so it's the number the second
number on the stack
are these the number that's the lot of
top of the stack the number attractive
of the way
so what we're gonna say just is numb
let's say solving equals actually that's
a function we can't use that we'll say a
total equals num1 plus 2 then we'll just
say
stack dot append
so this will add the total on the top of
the stack what we also want to do before
that I want to pop the stack twice I'll
tell you I know so I'm gonna pop that
they're gonna stack pop let's pop the
stack again so what this does is they
this gets number one off the top of the
stack and number two off the number
dress off the stack as well but it's not
the top it's directly below then what we
do is we add them together and then we
uh we need to get rid of those two
numbers to make wick or so that we can
add the sum on the top of the stack so
to do that we just pop the stack twice
so popping it the first time gets rid of
number one I'm probably gonna get rid of
number two and then when we append it
we're appending the result so we're
getting rid of the we're adding the two
numbers together getting rid of the
first two numbers and then just leaving
the result I'm putting on the stack we
can do exactly the same thing for sub
all we have to do is change the plus to
minus so we haven't actually got the
eyelid command or the subtract command
in at the moment so we're going to add
the add one first so we 1005 so as you
can see we've added a 10 and 11 to the
stack and we're going to say add 9 which
is 0 5 so that's gonna add them together
and it's gonna print the result which we
should get 21 and so it says list out of
range okay we have a problem but the
error is actually just we pop the stack
before so there actually was only two
numbers only one number on the stack
after he popped it so we just do that
again as you can see the result is 21
and the stuff things being common again
I'm just getting rid of the extra prints
because we need to print it after we've
got the result so you can see the result
is 21 and if we changed that to a 6 that
means were gonna subtracting the
so that means we're gonna subtract from
the top of the stack so I'm going to hit
enter and I can see it did an 11-10 and
give us one so why obviously there's way
more things you can do with a virtual
machine this is just sort of the
beginning and it's a very very simple
machine 3076 lines long yeah so what I'm
going to do now is and end the video on
in the next video we're going to add a
couple more things over to machine and
we're going to convert it to C and
that's as that's all finished so thanks
for watching and I'll see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>