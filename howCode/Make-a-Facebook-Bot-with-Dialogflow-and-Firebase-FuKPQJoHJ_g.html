<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Make a Facebook Bot with Dialogflow and Firebase | Coder Coacher - Coaching Coders</title><meta content="Make a Facebook Bot with Dialogflow and Firebase - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Make a Facebook Bot with Dialogflow and Firebase</b></h2><h5 class="post__date">2018-02-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FuKPQJoHJ_g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to be going
over the topic of creating a Facebook
bot again so the reason we're going to
go over this again
is because we're going to be using
different services to what we used last
time and the new services that we're
gonna use organ our lives to create a
much better more advanced more useful
bar so I installed the bot on the high
code Facebook page so you can see here
if I say hi the bot replies with the
word greetings and there's a hyphen and
then the latter's HB that stands for
high bar that's how you know that this
was response from the computer as
opposed to a person so I can say hello
and I got an instant reply from the bar
I can then ask it another question I can
say what can you do and the bar replies
to me and tells me I can do lots of
things it's one thing that the bar can
do is it can reach out to api's on the
internet and retrieve data so at the
moment all it does is it goes out to
youtube and it retrieves the latest hi
code video so if I said what should I
watch and now if I hit enter you can see
the bot replied and it sent me the
latest video on the hi code YouTube
channel and if I click on that it lets
me watch the video so this is just a
really simple example of what you can do
but I'm going to be making this bar more
advanced over time so that it gets more
useful on the hi code page but for this
video we're gonna be learning how to
create this really simple version of it
so the reason we're doing it again
is because we're going to use dialogue
flow to handle all of our artificial
intelligence for our bot what's really
cool about dialogue flow is we can click
on integrations and we can really easily
make our block work with Facebook and
make it work with just a website or we
can make it work with any of these
different services so dialogue flow is
going to do all of our artificial
intelligence but we're gonna use
firebase to host our bot firebase is
also run by Google and we're gonna use
firebase because it makes it really easy
to host the backend of our bot sort of
the brilliance of it and it makes it
really cheap as well so the first thing
we have to do is install firebase onto
our computer so what we have to do is
just go to this page I'll have a link in
the description scroll down and you want
to run this command npm install firebase
tools so to run this command you have to
have npm installed and you have to have
node.js installed as it says here
they're really easy to install you see
here you can go to the nodejs website
and you can download node and npm so
install firebase and then create a
folder for your project and then run the
firebase and net command so here is the
folder for our project it's called high
bot and this was all created whenever I
firebase Annette so here I'm back in the
root directory and I'm just gonna run
firebase in it so firebase has database
services and it has functions function
set us run tiny bits of code without
having to run a server so whenever the
bot wants to do something it can run
that code and we don't have to maintain
a server we just upload our code to
firebase so what you do is you press
space to select functions and you're
going to hit enter and it's going to
create your project so after you've
created your project you want to go to
dialogue flow and you want to link that
with your Google account that's how you
create a dialogue flow account so
dialogue flow has what are called
intents so that's when somebody asks are
about a question they give it an intent
and our bot responds so the default
intent if we click on that we can scroll
down and we can see this is what the bot
will say if it is asked a question it
doesn't know how to answer here are all
the responses and I can add more
responses if I want the default welcome
one is what we already saw if somebody
says hello the bot will respond with any
of these greetings the next thing I
asked the bartender bot responded with I
can do lots of things and the other
response it has is you'd be surprised
and here is the training data that the
Bart uses to sort of understand the
questions so the more training data we
give it the better our bot will be and
finally we have the choose a video
intent so when somebody says what should
I watch or pick me a video the bot will
respond with this video here so how does
it work how does it get the video so
what it does is we enable a web hook
call that means for this intent whenever
the BART tries to answer the question it
doesn't know how to answer it so let's
go off to firebase which is here and it
calls our firebase function I will learn
more about those in a minute
so the firebase function replies and
this is what it replies with that's how
we got that answer this allows us to
also hook into any number of api's that
we want to get relevant data and give it
to our bar so if we go to fulfilment
that's what they call it whenever you
try to use a web hook so you can use a
web hook and host it wherever you want
or you can use firebase so initially
there's something called the inline
editor this is sort of like a block of
code inside of dialogue flow that you
can add it and that will be your
function but that's kind of limited in
what it lets you do that's why I
modified it outside of the editor that's
why you're getting this error so what
you need to do the first time you get
here is you click enabled that will
enable the function and you'll scroll
down here and there'll be a button
called deploy you click that button and
it will deploy some code to firebase is
cloud for
actions so you can do that you can't ask
the body and you can see how the
webhooks work but what we're gonna do is
upload it using the firebase
command-line interface because that
allows us to our dependencies to our
function because to be able to call an
external API we need to send some we
need to send a request off to a remote
server to do that we need some external
libraries so in our functions we want to
go into this functions folder and here
is the code for the high code bot so
we'll include this in a link in the
description but here is the library that
we needed to include it's called request
so to install that library you just
simply say npm install request that will
install the library and go to our
package dot JSON and it will add this
dependency so if we scroll down most of
this is stuff that was generated by
dialogue flow but if we scroll down we
can see this input choose video so if we
go back to intents and I go to choose
video you could say we have this line
here called impetuous video this is
where we get the name of the function we
want to run and we've called our
function input choose video so what we
do is we give it our API key for YouTube
that allows us to access the YouTube API
and then we have the URL to the API here
and we can see that here this is just
the exact same address so we're going to
this address and we're going to go to
the items array in our JSON and we're
just gonna grab the first item so we go
to items then we go to snip it and then
we grab this first one here and that's
where we get the video from what we do
is we send our request to this URL and
that's what we do here when we run this
function called req we pass it the URL
of the API in here we say if there's no
error and the response code is 200 that
means the HTTP request was successful
and here is our response
it's called object and then we go to
objects items that's this part here and
here we build our response so we say if
the platform we're sending to his
Facebook we're gonna create a card that
is what we call this sort of block here
and we go to items we access the first
item we're gonna access the first video
then we're going to go to snippet which
is in here and then we're going to go to
title description and thumbnails to get
the picture for the video as well and
then finally we're gonna have a link to
watch the video and then finally what we
do is we send the response back to the
user this is what sends the response to
the bot and that is how it shows up in
this window so you'll see we're using
the YouTube API and we have an API key
so we need to generate that the first
time we do this so you want to go to
cloud Google calm and
an account that will let you use the
Google cloud platform then what you want
to do is create a project you just go up
here and click create to create your
project and then what we want to do is
we want to scroll down to err pas and
services this is the same for using any
Google API we want to go to library and
here is where we can pick an API so I'm
just going to type in the word YouTube
here's YouTube data API version 3 and if
this is the first time you've used it
you want to just click enable API and
then you'll see what I can see here so
next what you want to do is go to
credentials and you want to click create
credentials API key and this will create
on you happy I key and I copy appears on
API key into here I'm not sorry access
the YouTube data API so next what I have
to do is I need to upload all of this
code to firebase so that the ball can
actually use it so to do that it's
really simple after we run firebase and
net it's gonna go through all the
authentication and things like that it's
very simple it tells you exactly what
you need to do so assuming that setup
correctly
you just type in firebase deploy and hit
enter
so you can say that as uploaded our code
to firebase and you'll see the function
here in our firebase console so back and
dialogue flow that's all we need to do
because since the I logged flow is run
by Google when we create a dialogue flow
project it created a fire based project
for us
so the firebase project and the dialogue
flow project will be created and linked
together so that's all the work we need
to do the final thing left to do is to
go to Facebook so we create a new app we
give it a name we give it a contact
email address so when you create your
app you're gonna see a screen like this
you want to click on messenger I can't
see it anymore because I've already
enabled it but you want to click set up
on the messenger one that you can see
here and when we click on that it takes
us to this screen you want to generate a
page access token so you have to have a
Facebook page as well for this to work
so you select your page from this list
and it will give you an access token
then what you want to do is you want to
enable web hooks so the first time you
do this you're going to have to click
setup in the corner over here and you'll
have to go to integrations go to
settings over facebook Messenger and
you're gonna have to give it a callback
URL verify token and a page access token
and you get those all from Facebook so
this is very similar to the other BOTS
we created and then what you want to do
is you want to check the messages box
you want to subscribe to messages events
and finally what you want to do is you
want to subscribe your page to this
WebEx events so I subscribed heiko to it
and after I did that that was everything
done so if I went to the high code page
now and I tried to message it and I said
hello world
you can see the Bartra plays and that
was literally everything we needed to do
one last thing you might want to do in
firebase you want to click modify over
your plan and you want to click on the
blaze plan it's a pay-as-you-go plan
which is extremely cheap because you
only pay for what you use and you want
to enable this to allow your bot to
speak to external API on the Internet if
you're only on the free plan your
functions won't have internet access so
that's it for this video if you want to
see more of these sort of videos just
let me know but that's it for this video
don't forget to like comment favorite
and subscribe don't forget to follow us
on Facebook Twitter and reddit but
that's it for this video and I'll see
you next time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>