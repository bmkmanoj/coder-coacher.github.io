<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ðŸ’° Make your own lottery with Ethereum | Coder Coacher - Coaching Coders</title><meta content="ðŸ’° Make your own lottery with Ethereum - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ðŸ’° Make your own lottery with Ethereum</b></h2><h5 class="post__date">2018-02-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6GFOwXM69TQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in the last video we learned how to
create our own simple cryptocurrency and
in this video we're gonna learn how to
create our own simple lottery so where
our lottery works is you buy a ticket
with a certain amount of ether ether
goes into the pot and the winner is
determined based off of a random number
so if the random number returns a number
that belongs to one of your tickets you
and all of the ether that's been
contributed and then the lottery resets
so the way it works is we have an array
called tickets and it stores addresses
so every time you buy a ticket an item
gets added to this array so whatever
index in the array you are that's your
number so we just have the regular stuff
we have the name of our token we have
its symbol which is just a Lotte and we
can set the maximum number of tickets
the number of tickets left the current
number of tickets that have been bought
the random number that is going to
decide the winner and then the latest
winner which is just an address and down
here we have our sort of constructor
which sets up our token the first time
it's executed on the etherium network
then down here it starts to get
interesting when we have our buy
function so the way our buy function
works is you have to run the buy
function every time you want to buy a
single ticket so what we do is we
require the amount of ether contributed
to be equal to one ether so one ether
equals one ticket so now what we do is
we just say remaining tickets minus one
ask me less than or equal to remaining
tickets that's a mistake so remaining
tickets - Val should be less than
remaining tickets to prevent overflows
and here is where we give the user the
ticket we say take a stop push and we
push their address into our array and we
increase the ticket count by one then we
have a withdraw function but we're going
to skip that and go to the choose winner
function so what we do is we check that
the ticket count is greater than zero so
that there actually is some tickets for
the lottery sold and then what we do is
we generate the random number and this
is the number that determines the winner
so the way we get the random number is
we get the curb block number subtract
one and then we run it through the block
hash function to give us the hash of the
block which is just a hexadecimal number
so because it's a hexadecimal number we
convert it into an on-site int for
salinity to be able to process it
because otherwise we couldn't do the
modulus operator on it so we convert it
to an integer and the modulus operator
just ensures that the random number
generated is always going to fall within
us protected arrange so our range is our
ticket count so if we have 100 tickets
we only want the random number to be
between 0 and 99 because otherwise our
array will
Bonz now what we do is we just essere
the address of the latest winner is
equal to tickets random num so we go to
tickets and we put the user's number in
and that tells us the winner and what we
do is we take all of the tickets that
people buy and we essentially just give
them to the winner so if the winner buys
one ticket and they win the lottery and
there's a hundred tickets sold today
then essentially have 100 winning
tickets and then they can withdraw those
tickets for the ether so then what we do
after we've picked the winner is we
recently take a coin and we reset the
number of remaining tickets and then we
delete the tickets from this lottery to
reset the array so that the next time it
runs it starts with zero tickets being
sold then what we do you know withdraw a
function is we check that the person
actually has won something to withdraw
we checked that their balance is greater
than zero and then if it is greater than
zero we just get their balance out of
the winnings we set that equal to
among to withdraw and then neither we've
got their balance we reset their balance
in the winnings map so that they can't
withdraw more than once and their
winnings is measured in tickets so to
convert it into aether we have to
multiply it by this number here because
that's kind of like our exchange rate
and then what we do is we transfer the
ether to the user so what I can do is I
can run it in the web browser here you
can see I can use madam asked I have
three point at ether left and the way I
would run it is I would just give the
token an iam a symbol and a value so
it's name is just gonna be hi lotto the
symbol is just gonna be a Lotte and the
number of tickets is going to be one
thousand and I'm gonna click create so
this is just the confirmation window
ignore the prices because we since we're
on the test network you can see up here
on the Rob stone task network it's
completely free even though it converts
the ether into dollars it's completely
free so we click Submit and our lottery
is being created and because the task
networks are actually public you can
actually go on to the task network and
you can see the contract and what I'll
do is I'll include a link into the video
description for that so that you can see
the actual live contract so here our
lottery was created so you can see I
click remaining tickets we have a
thousand I go to December it tells us
the symbol the amount of tickets is zero
there's no latest winner the round a
number wasn't generated there's our name
and there is the maximum number of
tickets so I'm gonna buy a ticket so to
buy a ticket I have to scroll up here
and in the value up here I click on that
and I convert it to ether and I want to
send one ether to buy one ticket so I
click that I click buy and I click
Submit if I wanted to I could send
myself some more with the faucet so I'll
just click that
and I'll see if they'll send me some
more so there you can see the by
transaction went through so that
transaction went through if I go to
madam asked you can see I have my new
ether but you can see on a Thirsk an IO
and you can see a list of all my
transactions so there's the transaction
that sent me three ether and there's a
transaction I just sent to our contract
I send it one ether and that was me
behind a lottery ticket so here's our
contract that I just created the
contract was created then we sent one
ether to the contract I'm going to send
one more ether to the contract to buy a
second ticket so I scroll down I click
buy and I confirm that you can see now
if i refresh that we have three
transactions in our lottery so now I
want me to do is I'm going to pick a
winner so this is how we choose a winner
so our random number is currently zero
we've sold two tickets so the winner has
to have an ID of zero or one because
there's two tickets and we can see that
if we go to take account you can see
there's two tickets and there's 998
remaining so now if I click choose
winner and I click Submit so the reason
it is an instant is because we have to
wait on a theorem to mine the next block
but you can see there is the new block
there there is our transaction completed
so you can see here our latest winner is
that address third which happens to be
our address the random number that was
generated happens to be zero because it
can only have been 0 or 1 so it happened
to be 0 but you can see the latest
winner is us which means if I copy this
address into the winnings failed here I
click on that you can see we have two
tickets which entitles us to two ether
so if I click withdraw and click Submit
it's going to withdraw the ether so you
can see at the minute we have 4.8 ether
and as soon as this transaction gets put
into a block and gets mind we're gonna
get two more ether out of two our kind
so that transaction went 3 if I click on
madam asked now you can see we have 6.8
ether and you can see if we go to the
test at section of ether scan we have 6
transactions in our contract click on
the last transaction and we scroll down
you can see here is our contract and
here it says transfer our to ether to
this address so that's it for this video
don't forget to Like comment favorite
and subscribe don't forget to follow us
on Facebook Twitter and reddit but
that's for this video I'll see you next
time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>