<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>New Social Network - Part 49 - Finishing messages | Coder Coacher - Coaching Coders</title><meta content="New Social Network - Part 49 - Finishing messages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>New Social Network - Part 49 - Finishing messages</b></h2><h5 class="post__date">2017-07-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/pXUF7YZesiE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in the last video we left off being
able to San Matthews what we're going to
do in this video is we're going to make
the left side man you work so that we
can click between users and choose who
we want to send a message to so the
first thing you have to do is get a list
of anyone who's ever sent us a message
and anyone we've ever sent a message to
so to get that list I'm going to go back
to the API and create another endpoint
it's going to be a get request and we're
going to just copy this
we're going to replace us with em users
for a list of users we've set masters to
so the first thing we have to do is
obviously get the user ad over the
person who's logged in so we do that as
always and we call it user ad and then
what we're going to do is we're going to
run a query so we're going to say DB
query so this query just selects the
sender and the receiver from messages it
does this laughs join so we can convert
the ad we get for the Masters table into
a username using the users table and
this work clause at the end just means
that we only going to get Sanders and
receivers that relate to the user who's
logged in so in this case we've said the
user with the idea of one but this ID
will be the ID of whoever is logged in
at the current time so we're going to
copy that query and we're going to paste
it in here
we're going to scroll across we're going
to replace this one with the ID of the
person who's logged in so in this case
it's going to be user ID it's going to
be equal to user ID and then in here
we're just going to replace this with
user ID and this one with user ID then
we're just going to print our and we'll
call this users as you can see here is
the output of our query so we're just
going to save for H users as user and
we'll go up and we'll create an array
we'll just call it u and it's going to
be an empty array and what we're going
to do is we're just going to check if
the values in here or in this array so
we're going to say if an array user
receiver just in the array that we've
called U which is our array up here then
we don't want to add it again so we're
just going to invert that so that if it
isn't in the array we're going to say
array push and we'll push into the users
array the value user receiver and we'll
copy this and just do the same for
sender and then the end of that we're
just going to print underscore R the new
array which is created and we'll just
make sure that we have a capital S and a
capital R for receiver and sender
because because those are going to be
the values that we get in the array
because you can see up here at receiver
and Sandra have a capital letter so
here's our finished array it has Francis
Francis McNamee and Howe code and if we
wanted to stop people from being able to
send message to themselves
so we're going to do is we're going to
echo that out as JSON so we're going to
say echo JSON encode our array of user
names now we have our JSON and what we
want to do is go back to the Masjid I
want me load the page we want to send an
ajax request as we're already doing we
want to copy this one i'm going to send
another ajax request so this time we're
going to send the request to api / m
users so what we're going to do is we're
now going to insert the data into this
HTML so here's our let's group and what
we're going to do is we're gonna give it
an ID of users and we're going to just
copy one of these items and delete the
rest i'm down here when we get all the
data back and what we're to do when we
get the data back is we're going to
encode it as json so we're going to say
R equals JSON to parse itself and now
we're going through it so we're going to
create a for loop
and when we loop through it what we're
going to do is we're just going to
append into that div so to do that we're
just going to use jQuery to select our
users elements and we're going to append
some huge tml so the HTML we're going to
append is this so if we pair to this
HTML and now if I was to refresh we now
have three divs because we have three
users returned and they all say the same
thing
so I'm just going to get rid of that
profile photo for now what we're going
to do is we're going to store the user
name so in this case the way we get the
user name is we just set our I because
we're returning an array so we're just
accessing the first element second
element third element now if i refresh
we have our actual data and we can
change the background colors to white
and finally what we want to do is we
want to create a click event so that
when we click on this it changes our
dress bar so that Sander becomes
whatever the ID of this user is I know
we're going to do is we're going to give
each of these an individual ID we'll
kind of call it something like user I so
user 1 user 2 user 3 something like that
and then we're going to target that down
here we're going to say user I don't
click and what we're also going to do is
we're going to say data ID equals and in
here what we're going to do is we're
going to pass our ID and then over here
we're going to scroll across and REE
nearness to our I dot user name so back
in the API what we're going to do
instead of just returning a list of user
names instead of just returning a list
of user names we're going to return the
ID as well so to do that we're going to
select user names and we're going to
select STD has Sander ID and r dot ID
has receiver ID then what we're going to
do when we push into our array what
we're going to do instead of pushing
just the user name we're going to push
another array and that array is gonna
have two items in it the receiver and
the receiver ID and we're going to do
the same for the Sando the sender and
the sender ID
just like this and we're actually give
these a name so we're going to say
username equals receiver and ID equals
receiver ID and then down here we'll do
the same username is equal to the
Sanders name
the ID is equal to the Sanders ID so
whenever we click on one of these items
what we're going to do is we're going to
set this attribute and we're going to
get the ID attribute so we're going to
say Delta ID and that's how we get the
ID of the user so we're going to log
that to the console so now what I'm
going to do is I'm going to click on one
of these and you can see we're getting
the user IDs print it out to the console
because we're getting duplicates what we
want to do is instead of checking if an
array and then checking just the
username we want to copy this line here
and check that whole line under the same
down here
now when i refresh you can see we only
get three usernames returned so instead
of just logging out to the console we're
going to set window dot location equals
and we're going to say it's equal to
messages dot HTML and then we're going
to put the hash in there and we're just
going to your panda on the ID and then
we're going to scroll up to the top and
Sandra's going to be equal to window
location harsh dot split and we want to
split on the hash itself and access the
first atom to that array because by
default window dot location dot hash
looks like this so we just want to get
rid of that hash and just be left with a
number and we're just going to put in a
jQuery event actually as well and we're
going to say window dot on and we'll say
harsh change so the hash and your
changes we're going to run a function
and it's going to be equal to location
dot reload and that's going to reload
the page so you can see on the Matthews
pH at the moment there's no masters
because we haven't clicked on one so if
I click on Frances McNamee you can see
this seven shows up in the address bar
and the Masters appear if I click on
high code you can see now more messages
appear and I can send messages just like
before and what I want to do is also
just instead of saying when do that
location is equal to nothing I'm going
to say location don't reload so just
like before I can send messages I can
type the message in here clicks and and
there's the new message there but that's
it for this video don't forget to Like
comment favorite and subscribe don't
forget to follow us on Facebook Twitter
and reddit but that's it for this video
and I'll see you next time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>