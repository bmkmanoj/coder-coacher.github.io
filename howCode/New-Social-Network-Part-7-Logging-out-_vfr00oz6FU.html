<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>New Social Network - Part 7 - Logging out | Coder Coacher - Coaching Coders</title><meta content="New Social Network - Part 7 - Logging out - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>New Social Network - Part 7 - Logging out</b></h2><h5 class="post__date">2017-01-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_vfr00oz6FU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in this video we're going to learn
how to log users out of their accounts
so logging users out of their current
isn't actually that hard
and because of the way we've implemented
the login system we can actually allow
users to log out of their current on one
computer while the remaining logged in
on other computers because we allow the
user to have multiple login tokens at
any one time and that means that they
can be logged in on multiple computers
or multiple devices at any one time and
whenever we're logging the user right we
can give them the option to remain
logged in on all their other devices and
just log out if the one they're using or
we can give them an option to log out of
all of their devices so that's we're
going to do in this video so the first
thing we need to do is create a new file
and that's going to be log out soap HP
and then of course we need to connect to
our database
and then we're going to create a simple
page that the user can use to now go
you
so we want to do is preview this in the
browser
says would you like to log out of your
account are you sure you want a log ID
would you like to log out of all devices
and then we can click confirm so here we
want to do is check if the confirm
button has been correct
so now that we know if the confirm
button has been correct we want to see
if the check box calls all devices was
checked so to get the check box we need
to give it a value we will give it a
value called all devices so we can get
the value of the check box to tell
whether or not it was correct
then we know the checkbox was correct
otherwise we know to only log them out
of their specific device so now we need
to get our is logged in function and we
have that on our index page and rather
than rewrite it we're going to copy and
paste that into a tomb file we're going
to create a class called login
and then we'll just paste our function
in there we need to include our class in
our index page and we also need to we
need to give our function public static
before we can use it and then to
reference the function from the class
when we said login and use e to colon
operator to efference it when it's in
class so that should be it and in our
log ID page we need to do the same thing
will just include that so the first
thing we want to do is check if the
users logged in so we can do that by
saying if login is logged in is equal to
true them users logged in so we can get
that and we can say die to kill the page
not login so now the user won't be able
to see the form if they're not logged in
so if i refresh you can see we can still
see the form because I have my two
cookie set I'll just remove them all
I noted it has not logged in so now that
we know the users logged in and we can
get the user ID using this is logged in
method all we need to do is if they only
want to log out of their specific device
we can say DB query
and token is equal to the token from the
cookie
and before we can do that we need to
just
another check that says if is set
because the user could go to the log out
page and they could delete their cookies
before they actually click the button
and if they did that they would have got
an error so we need to put in this check
first we check if the cookie has been
set and it's the cookie set we delete it
from login tokens and then what we do is
we want to delete the cookie I want to
do is set cookie snad
and we want to give it a value of
anything and then we want to set the
time that the cookie expires to the
current time - say for example 3600
because we're setting the cookie to a
time that's already passed so Allah
demonically expire and that's how we can
expire a cookie in PHP and we want to
expire our SN ID underscore cookie as
well and that should be the user logs
out and then we want to do is log them
out of all devices so what we want to do
is just copy and paste our DB query and
we change it from more token equals
token to our user underscore ID equals
user ID and we change user ID to the
users ID and we get that from login is
logged in so let's try that now so the
first thing I'm going to try and do is
just log the user out of their current
session so here we are what I'm going to
do is just click confirm and you can see
it says not logged in the reason we got
that error was just because this post
variable was only set when the check box
is checked and it wasn't checked so we
got that error so what we can do is
change this comparison to and is set
and that should prevent any possible
errors so let's just try and log out and
if we go to our database table you can
see there is our newest token that we've
just added if we click confirm
so tokens been removed from the database
and says we're not logged in now we're
going to try and do is log out of all
devices so if I click log out of all
devices I go back to our tables and you
can see if i refresh the table those our
newest token for the user with the ID of
one and we have all these other user IDs
which should get deleted and what I'll
do is click confirm to log out of all
devices go to sequel Pro refresh and you
can see all of the rows in the table
with user ID of one where it removed
you can see if we click here it says two
cookies and use but if I go to inspect
and go to the console and I print out
document our cookie there are no cookies
currently set so the cookies have been
deleted but that's it for this video
don't forget to Like comment favorite
and subscribe don't forget to follow us
on Facebook and Twitter and I'll see you
next time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>