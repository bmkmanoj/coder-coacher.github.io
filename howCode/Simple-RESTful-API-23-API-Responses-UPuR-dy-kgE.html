<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Simple RESTful API - (2/3) - API Responses | Coder Coacher - Coaching Coders</title><meta content="Simple RESTful API - (2/3) - API Responses - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Simple RESTful API - (2/3) - API Responses</b></h2><h5 class="post__date">2017-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UPuR-dy-kgE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the last video we left off being able
to query the database we set up our API
we query the database and we returned
some JSON but no what we're going to do
is we're going to set up the various
endpoints for our API so certainly we
want to have at least two endpoints but
you're just essentially like pages on a
website we want to be able to go to
slash users to get a list of users we
want to be able to go to slash session
or slash off to log the user ends when
we send a post request to off we want to
send the users credentials that they
want to login with and then our API will
return the login token as we did in the
social network series and that's we're
going to use our API for we're going to
use it to log users in so we're going to
create the off endpoint first so if I
print are the gap variable and I refresh
you can see it says URL equals users and
if I go to the htaccess file you can see
now whatever page we go to is getting
set to indexed up PHP in the parameter
URL what we want to do is want to say if
get URL equals and in this case we'll
set off and then in here we'll put the
code for our endpoint called off when it
receives a gap request we'll have to do
another one in post when we get a post
request and things like that
and then we could also say else if and
paste this and again if the URL
parameter equals users so now if we go
to slash users we'll get we'll run this
code if we go to slash off
we'll run this code specifically to
authenticate users we're going to use a
post request because we're going to send
their data to the server in the post
request so we're going to copy this
first line of off we're going to paste
it in post
so we have our off stage here when we
get a post request to the auth endpoint
we're going to run this code and when
the user authenticates they sent us a
username and their password to get the
body of the post request we need to do
something special we need access what's
called standard input and the simplest
way to do this is just to say post body
equals file get contents and then
instead of passing a file name what
we're going to do is pass in PHP code on
for size forward slash input this will
allow us to store the post body in this
post body variable and then what we'll
do is we'll just echo it out now we'll
do is we'll run that so in part what
will happen if I run this as I post
request gets sent and we go to raw you
can see we just have had these are the
headers we have nothing below that the
reason for that is because we need to go
to the body time when we stand there
quest and we want to add some text just
like that we type it anything we have it
set to post we run that there's the data
we sent in the post body so we want to
send some JSON so we're just going to
click on JSON here and we're going to
add an item the item we're going to add
is going to be called username and the
value is going to be whatever the
username we want to sand is in this case
I'll just leave it blank the next one we
want ad is the password and the password
is just whatever password you want to
send we're going to sand down both in
the post body Knifer on that you can see
we get username it's an empty string and
we get password and it's an empty string
so now we will do is we will say post
body equals JSON decode post body a no
post body will be in a rare so if we
print that out
you can see we have our standard array
object with a field called user name on
a field called password and they both
have no values so we're going to do now
is iPad to get the user so to do that
what we're going to do is we're going to
go to the login page from the social
network series we're going to open that
up and you can see here is all of the
code to log the user in so the first
thing we have to do is check the
username if it's valid and the password
if it's valid so to do that what we're
going to do is we're just going to
simply say if DB query and then here
what we'll do is just copy that query we
have here select username from users
copy that
I know we can see that the username is
valid then if the username is valid
we're going to check the passwords valid
so to do that we're going to go to login
and we're going to copy this again
and we just let me change DB query to DB
just like that
so now if we get to this stage we know
that the user name and the password of
both violets we're going to echo valid
and before we can run that we need you
just say username equals post party
username and we'll copy PS and change
that to password equals
whose body password now we have the
username and the password now if we run
this with a blank username and a blank
password we get nothing printed out but
if I put in something like verified
which is a valid username and then a
valid password which is going to be test
pass and I run that you can see we get
valid printed out so instead of printing
out valid what we want to do is generate
the token and send it back to the user
so if we go to the login page you can
see what we do is we generate our token
here and we store it in our tokens table
and the only difference we do is we set
the cookie with the token in it and we
set the other cookie we're not setting
cookies at the minute we're just setting
the response back from our API so we go
to index dot PHP and we just piss this
then we change DB query to DB query and
then we change it again up here
then what we can do when you get to this
point is we can activate Jess and we can
set a coup and here we can say token and
then we can just pass in our token which
in this case is just the word token and
since we're using single course we just
want to put in a single quote and then a
dot and that allows us to put a variable
in there so if the users valid we sign
the back this JSON otherwise
we're going to stand back a response
code which is going to be here TV
response code I will stand back
something like 401 which means
unauthorized and now if we run power
again you can see we got our token
printed out this is our login token and
that if the password is incorrect we'll
put in another ass we run this so that
didn't actually give us the error that's
because this house Clause only applies
to it to check on the username so what
we'll do is just copy that paste it up
here so now if the username is incorrect
or the password doesn't match we're
going to send back a 401 response code
now if we run that you can see we got
401 unauthorized we stand back a valid
password and username we get 200 ok we
get the token return to us we might want
to send more data as well but for the
minute we're just going to leave it as
token we can add more data later on if
we feel that's necessary so that's it
for this video don't forget to Like
comment favorite and subscribe don't
forget to follow us on Facebook Twitter
and reddit don't forget you can email me
at francis at haiku org if you have any
questions but that's it for this video
and I'll see you next time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>