<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Simple Python Chat Server | Coder Coacher - Coaching Coders</title><meta content="Simple Python Chat Server - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Simple Python Chat Server</b></h2><h5 class="post__date">2017-06-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/D0SLpD7JvZI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we're going to be creating
a simple chat client and server they're
going to be built in the same file and
we're going to use command-line
arguments to decide whether we want to
run the server or the client and after
that it shouldn't be difficult to
convert it into a peer-to-peer chat
server so in the last video we created a
file called chat py and because we're
mixing the client and the server
together the first thing we're going to
do is we're going to put the server in a
class of its own so I'm going to create
a class called server and I'm going to
move our socket variable in there and
then I'm going to create a constructor
I said daph init my past the south's
variable this is just standard Python
object-oriented programming and when we
run the constructor we're going to bind
to the socket and we're going to start
listening on that socket and we run the
constructor I'm going to move our
connections into a variable up here so
it's just going to be connections equals
an empty list and we're going to move
the handler into the server class as
well
and then after the handler we have this
wild statements we're going to move that
into a function the function is going to
called run and it's going to take cells
and we have to pass after all of our
functions and when we refer to a
variable that's in the class itself such
as sock or connections we have to pre
pandit with self to self dot connections
self dot sock and self stop bein so dine
here in the run function I'm just going
to move this while loop into the run
function
and we have to say after doctor except
South thought Handler because we're
referring to the handler method in the
class self-talk connections and
self-talk connections again and we just
need to move this up one more and now
what we want to do is instantiate our
server so we want to say server equals
server just like that now we have a
server object and we can say server dot
run and that should be on our server so
if I save that and run it you can see we
get no errors so I'm going to assume
that our server is running
so the next thing we need to do is we
need to create our client but we also
need to have a way to distinguish
between whether we want to be the server
or we want to be the client so to do
that I'm going to import the Syst
library and down here what I'm going to
do is say if the length of sistar Arg V
so sister dog V is the command-line
arguments and I want to check if there
is more than one command-line argument
because the first command-line argument
is always the name of the file and we're
going to take the second my line
argument if there is one and that's
going to be the IP address we want to
connect to as the client so if there's
more than one command-line argument that
means we want to be the client otherwise
we want to be the server I just put in
past for now which just allows us to
have an empty if statement otherwise
we're going to be the server so we're
just going to be the server coming into
this else statement and now we're going
to create the class for our client so to
do that I'm just going to create a class
called a client and then we're going to
create a constructor so we said def
underscore underscore ini T underscore
underscore we pass it the South variable
like usual and here's where we want to
connect to our socket but before we can
connect to the socket we need to go up
here and copy this socket because we're
going to use that one for our clients
and then in the client we want to say
self dot sock Connect and the connection
method takes a tuple the first parameter
is the address and the second parameter
is the port we're going to get the
address from the constructor when we
actually run the client so to do that
we're going to say client equals a new
client object and the client is going to
get its address from the second
command-line argument so we're just
going to say assist or the one to get
the second command-line argument so we
save that this chat type I will be the
first command-line argument and the
second command-line argument would be
this which would be the IP address that
we want to connect to so next we want to
do is create a message to be able to
send messages to the server so to do
that we're going to say add F send
message and this math is just going to
be really simple it's going to say self
dot sock dots and to
and data via the socket and it's going
to send the baits that we get back from
the input method in Python the built-in
input method and paste on takes whatever
you type in the terminal and it returns
that from that function and the Bates
Method we have to tell it the encoding
of the string that we want to convert
into Bates so we're going to say utf-8
and then know that we can send messages
we want to do is create a loop that will
run in the client and the loops going to
continually receive data so it's going
to be data equals self Sark dot receive
and we're going to receive 1024 bytes
maximum and then like before we're gonna
say if not data Ric this just means the
clouds disconnected but above the while
loop what we're going to do is create a
new thread and we're going to send
masters via the new thread because our
main thread is going to be it's going to
have a loop that's going to continually
try to receive data we can't receive and
sand at the same time so by creating a
new thread we'll be able to send data at
the same time as receiving data so we're
going to create a new thread the new
threads going to be called a thread for
input thread and it's going to be equal
to threading thread and the target
function is going to be send message and
Sam Matthews no parameters we don't need
to provide any arguments then we're
going to set a thread is going to be a
daemon which means it'll close when we
close the program and ice read start to
start to that thread that just means
this function will be running in the
background because it's running in the
background we want to be able to
continually ask for new input so we're
just going to put this in a while loop
so it's essentially means it'll ask for
input we type some input the input
method will then return and then it will
send a message off to the server which
will in turn send it to all of the other
clients and then what will happen is the
loop will run again and I'll ask for
more input and don't hear what we want
to do is we want to print the data we
get back so we're just going to print
data and I just noticed we have a tiny
mistake you can see we're targeting sand
message but we actually need to refer to
it as self thoughts and message because
it's part of the same class so now if I
run that server and on my local computer
I have the exact same Python program so
I will type in Python 3 chat-up I and I
give it the IP address of the server
which in this case is 45.7 6.13 7.25 3
I'm going to hit enter now you can see I
was connected to the server you can see
there's the connection behind me and now
if I say hello
world today drew you can see I got this
string of bait sprinted back to me that
means the server sent it back because
the server set back raw bait on the web
Python will try to print raw bytes is it
will just print it as a string and
pre-planned to be to the front of it you
can see I have to chat when it was open
though I have a server in the background
I have my first client and I have my
second client I'm going to hit enter now
you can see the server has two
connections on it and if I type in
something hit enter you can see it sent
it back to me but I also send it back to
the other client it is working like a
chart that you would expect so before
the video ends I'm just going to tidy a
few things up the day we print out
instead of printing out the raw bytes
we're going to convert it to a string
and we're going to convert it to a
string with the encoding of utf-8 and
then back on the server what we're going
to do instead of printing out South our
connections we're going to print out who
was connected so you can see this air
variable is a tuple with the address and
the port of the person who connected so
we're going to say print string to
convert this Topol item to a string
because at the moment is going to be an
int so we print out the string which is
going to be the address we append on a
colon and we append on another string
which is the port and then we just say
connected
it might not make sense though but it'll
make sense in a minute and up here you
can see if not data that means declined
to disconnected we're going to say set
up connections not remove and we're
going to remove that connection then
what we're going to do is we're going to
say accede are close to close that
connection actually before we do a lot
is we're just going to copy this and
we're going to print out that somebody
disconnect is we just have a typo here
so we'll just fix that
so now if I run the server you can see
there is it running and now I'm going to
connect to it via the client you can see
it says the AP address of who's
connected followed by the port that
they're connected on I'm going to
connect again you can see now we have
another client connected but because you
can see they're coming from the same ip
address they have different ports so
they just type something else you can
see both clients received that message
now if this client disconnects by
killing the Python program you can see
one of the clients disconnected and now
we have one client last and now if I
disconnect from that one you can see
that that kind also disconnected so
that's a really simple chat server it's
an anonymous chat server pretty much
because nobody has nicknames or
usernames or anything like that and you
don't know who actually sent each
message so next time what we're going to
do is we're going to convert it into a
peer-to-peer chat server so instead of
having one one central server to process
the messages we're going to have a
peer-to-peer system and we're going to
add special features such as nicknames
and things I got to make it into an
actual fully fledged chat server so
that's it for this video don't forget to
Like comment favorite and subscribe if
you have any questions over it's Mme at
Frances at Haiku org don't forget to
follow us on Facebook Twitter and reddit
but that's it for this video and I'll
see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>