<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Make Your Own YouTube Part 15 : Finishing Video Upload | Coder Coacher - Coaching Coders</title><meta content="Make Your Own YouTube Part 15 : Finishing Video Upload - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Make Your Own YouTube Part 15 : Finishing Video Upload</b></h2><h5 class="post__date">2013-04-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TukBtlERWTQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I welcome this video so today we're
gonna be doing is we're gonna be
finishing the video upload script so
what am i by that is we're gonna be
doing things like checking for a joke
look at uploads by checking whether the
F of ad has already been uploaded but
we're not gonna be checking the file me
and we're gonna be checking the actual
video file itself and that way we can
stop duplicate uploads like YouTube does
so that everybody who has to be slightly
different so yeah that's what we were
doing and we'll also be finishing things
like the uploading the date the video
was uploaded because at the moment we
just have a date and well we'll see how
we get on with that and then if we have
extra time we'll do some other stuff so
what I'm gonna do is I'm going to I'm
gonna go to the database and I'm gonna
go to the values table and as you can
see here I have an extra file or an
extra column and then you new and it's
just a varchar' of like 32 it's the name
of it is file underscore md5 that's the
only difference between my values
alright yeah my videos table and yours
and so just add that failed into your
table by going to the bottom just
clicking go and yeah you should be good
to go after that so we're just going to
check that everything's still working
because it's been a while since the last
video so as you can see here I am
Vettius folder it's empty and the venues
table is also empty that's why we can't
go to browse so what we're gonna do is
we're gonna type in some information
okay actually yeah before we do that we
need it since we added a new row chart
or a new column actually to our table we
need to need to add the a column to the
query because of the column kind of the
query doesn't match the column coins in
the database the query won't work so
we're just going to write n be 500
file in here until we generate the md5
hash of the file just so that's sort of
a placeholder so we're gonna refresh
we're gonna try and let some ramen
information in nine so I'm just gonna
upload test video one and we're gonna
click upload and it's very quick because
it's uploading from my computer to my
computer and it's a small file anyway so
we're gonna check that I worked on so if
we click on the values table we should
go to the Browse section and it says we
have one row inside of our table now we
scroll down we have one row the one we
just added and everything seems to have
worked then we can check that our video
was uploaded and it wasn't so okay we
need our block okay the reason the video
wasn't uploaded is because it says here
once we finished inserting the radio
into the database we have a query or a
function here called die and that
basically stops the rest of the page
being wrong so it sort of stops the page
execution at that point and act was not
a message so what that's basically done
is when the query was done its killed
the page and then it's ignored all of
this which is the part where we actually
moved the uploaded file to the videos
directory so that's really simple
effects all we have to do is delete this
we will try to get so let's just put in
anything
and click on test video 1 and click
upload check the database it should not
have made any difference because we
didn't actually change the query or
anything so yes we have two rows at our
database and here's the Nu row we just
added everything seems to worked on the
query side now we're going to go to the
videos table and as you can see we have
our new video uploaded that we added not
before so that's sure that's the problem
we fixed it so we're ready to actually
start the actual video really with
comparing or storing the md5 hash in the
video file so we can compare it when we
upload a video ok so what we need to do
is to generate the md5 hash of the file
is a function inside of PHP that ad will
do this for us and but we need to we
need to tell the function where the file
is so that's really easy to do so what
we're gonna do is we're gonna scroll
down here and we're just going to call
the function file underscore md5 it
could be on defy file I'm not one of
those not sure but it doesn't matter we
can fix it if it's wrong so here we have
the file of the uploaded video file here
this is the file name because as you can
see it says data slash user slash videos
and then there's some variables so that
means these two variables together on
the video file file name which we can
see here the first part of the string is
the random generated text okay so the
first part of these file is the I ran
random generated string that we used to
uniquely to yeah give everybody a unique
name on the string at the end is just
the original video
finally okay so we we just need to copy
this and to make things look a bit
better we can store it in a variable so
we just call this variable file name and
store it in here and we need to get rid
of these two quotes on the dock because
we only need one because we're only
appending where I've had these two
variables together so to do that we just
put the dot in between and it adds them
together sort of and here we just want
to give the mu5 file function the file
name and we want to try out our script
line so what we want to do is we just
want to by running normally so you just
took anything into the box anything into
that box anything in this box doesn't
matter whether we choose private or
public with the privacy we upload our
video file and click upload so I'm gonna
find function so it turns out that they
function me and must be md5 underscore
file and while we're here we actually
want to echo it so we can see the odd
part of the okay we can actually use the
die function because the only thing that
this is doing is this is arming these
two lines of code are from the profile
image script and mr. stack was very was
successfully uploaded so we can ignore
these three lines and just replace this
with a die die function them to see the
result of the command or the F function
is not come on okay so we're not put in
some random information we're gonna
upload our video
okay so md5 file that failed to open
stream and and that's because what md5
file function is looking for is it's
sort of taking this and it's looking for
video box forward slash that video
and this obviously doesn't exist because
all of the videos are stored in a
directory words that they're stored in
the data / user stops videos directory
so obviously that's this function is not
going to work so we just need new talent
where the video actually is so and
that's really easy all we have to do is
go to text editor and we type in for
filename we just append a string on the
front of it and the string is data slash
users slash videos for slash so now what
this does is it tells the file md5
function or md5 file function to find
the video file it tells it the correct
directory to lock in so we're just going
to put some random information in here
we're gonna click Choose file again and
we're going to upload it let me get the
md5 string of the file this isn't the
actual string of the file me and this is
the md5 hash of the file itself so this
way we can use these we can ask store
this and we can compare it we can
compare videos when we upload them to
check for duplicate uploads so what we
can do now is we can a store that in our
database because we know it worked so
instead of dying that we can just store
it in a variable so we could say md5
file equals that and then we just use a
query so we could say in my SQL query
and since we've already inserted the the
video into the database up here we're
going to leave this blank actually and
since we've already inserted it up there
means we have a row in our database so
we can instead of inserting a new row we
can update it so what we're gonna do to
update it is we're just going to okay
instead of updating it we could just
copy insert and okay now I will just
update it so I'm we're just creating
your query and update the existing row
so we're gonna set up date videos once a
set md5 file equal to md5 file and what
does still do is just update the query
so the md5 file a column in our database
I think it's called so scroll over and
arts file at me five so we want to
update file underscore md5 and set it
equal to the hash of the md5 hash of the
file so let's run that line doesn't
matter what privacy we can just set it
to anything and we can upload the value
the video was successfully uploaded
that's good we click on videos to reload
the table we've section columns all
right six rows because we've had almost
a few times but this is the new one we
just done if we scroll over we can see
we've updated it but we've actually
updated all of the videos with the same
hash so what we need to do is we just
need to actually set out a where clause
to our query so what a work laws is is
it basically just means we are and this
is sort of a sac Clause technically so
we're just telling it to set that equal
to or set the fil md5 column equal to
the md5 hash of the file so equally
instead of a set in capitals we're gonna
use where because it's a were clause and
we just give it a condition sort of like
an if statement and if the condition is
true then it will run the query so what
we want to do is we just want to say
were let's
growing up actually okay we're going to
use the video ID because that's unique
to every video so we're just gonna say
we're video underscore ID is equal to
video underscore ID so what we're gonna
do is were actually going to erase all
of these rows and we're going to run the
script again okay so just to reinstall
of the values in the database and okay
well that will actually delete them in
the folder too so I've just deleted them
from the folders well and now we're
ready to go so what we're going to do is
we're just gonna put anything in the
title description and keywords
I choose file doesn't matter we'll just
choose that because it's the only one
we've got
we're gonna click upload and we're going
to check the videos table and the UAD
was folder the video was uploaded
successfully to the folder and then we
go to the videos table let me say the
595 is correct but okay I just thought
of a problem we can't really compare
this because the video is the sium they
are the video files the same even though
the file name is different but since the
file itself is the same we're gonna get
the same md5 hash every single time so
what I'm gonna do is I'm gonna click in
line add it here and I'm just gonna
delete it so we delete the average file
mb5 from that video and why I did that
is because then we can just use this to
check of our work clause was working
because if our work clause is correct it
means that won't get updated so that
will stay like and the new the next time
you upload the video the only the new
row will have the the md5 hash of the
file so I'm gonna put more add we're
gonna upload another video one more time
it's the same video as before we're
gonna click upload refresh the videos
table and what we'll see is one row has
an md5 hash I think other doesn't so you
can see the one we deleted in still add
and the new one has the Omni five huh
okay so what we're gonna do now is we're
gonna check one more thing I'm gonna
prove that the file name doesn't matter
so what we're gonna do just click on
that and we're going to rename it okay I
will actually copy it it's not we have
to vet two of the Yassin video the video
themselves are exactly the same the only
difference is this is how's it different
file name so I'm gonna upload that video
with a different file name now we're
gonna fill in the fields we're gonna
click publish and click upload so we're
going to go to the videos folder on the
Ave was TMI and as you can see in the
videos photo we have had two more rows
are two more files and if we scroll over
an eye and we see the other CM md5 hash
because it's hashing a file and not the
file name so no matter what the file
hash will be the same if they add video
themselves are the same so now we've
done that we want to put in a check to
check for duplicate uploads so what
we're gonna do is we actually should
move this query down and cut it we
should actually put it here because this
way we can if the video we're comparing
the video down here so if the video has
already been uploaded we can use this to
stop the upload twice because otherwise
it would still get inserted into the
database if it was up there and if we
left the clear up here we'd still be
inserted regardless of whether it was a
duplicate or not so what we're gonna do
is we're just gonna say create a query
says check and the v equals mysql
query select file underscore and d5 from
videos wire video or our file md5 equals
more the file md5 equals MV v underscore
file okay so what we want to do is we
just want to put a semicolon there and
we want to say if MySQL whoops MySQL num
rows check emily 5 equals doesn't equal
0 which means we're gonna duplicate we
just want to die this is it you can't
upload or else what we want to do is
just say or i just run all this these
queries so we just want to set up and we
want to copy this actually just PSN in
here we can get rid of those so that's
try it now let's say I run it and what
we should get is this is a duplicate
upload so we just put some in the video
description in the video keywords on set
it to public we got this is a duplicate
upload mmm and if we refresh we still
have three rows in our database so we're
going to do is when to empty it so that
there's no rows in our database in the
videos table
and then we're going to upload again and
we're going to tell eighth thing videos
as well in the videos folder so we're
just gonna run or a type of list to run
the Yak script and we're gonna click
Choose file choose the video doesn't
matter
I don't like upload we get your video
was uploaded successfully we get the
video stored in the folder and we got
the new room database so okay I just
think I find a problem so that's how a
lot this could be a problem might not be
I don't think we surrounded the movies
uploaded file in the else statement so
what might happen is it says this is
duplicate upload but yes it uploads the
video to our website anyway we don't
want that so what we're gonna do is
we're gonna say we're gonna delete the
file so to delete the file and that's
very simple before we said this is ebook
and upload we wanted to lead it so we
there's a function inside PHP to do that
which is called unlink what we want to
do is you just want to say on link file
name so now let's try and upload it
again and I'll actually just make this
smaller and I'll put the videos folder
in here so you can see so we're just
gonna put some information in here click
public choose a video and click upload
now as you can see nothing appeared in
the folder so one more thing we can do
in this video before it's over as we're
going to get the D at the videos
uploaded because that's really easy so
what we're going to say is we're just
gonna say it equals the dant function
and we're just going to say
f space J comma Capital y so what this
basically means is it's gonna get it's
just gonna say like if today was the 3rd
of April or or actually the fourth of
April so this would be 4 or 4 I can't
remember which and this would be April
and then this would be the year which is
2013 so that's really what it means and
we're just going to change to a variable
so because we've done that we have to
actually empty the table again so we're
gonna do is we're just going to upload a
video file anything doesn't matter
privacy doesn't matter either we're
going to put the video and we're going
to upload it the video was uploaded
successfully we checked the videos table
we have one new row and if we scroll
over we can see our website she got it
the wrong way around worth it this is
the month and this is the like date in
the month so their day in the month in
the year was 2013 so that's really
everything we can actually get rid of
the 75 field because we've got 595 so
you don't need it so we can go to
structure and just remove it and another
we've done that we just need to update
our query to insert into the database
and instead of just writing mb5 we can
just delete it so that's it for this
video don't forget to Like comment
favorite and subscribe and if you have
any questions or comments just leave
them in the comment section below or
send me a message
and we've also menu form recently that
just launched yesterday so you can find
that at hike org slash forum if you have
any questions just post them
and people reply to you and well okay
yeah that's it so thanks for watching
don't forget to Like comment favorite
and subscribe and I will see you next
time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>