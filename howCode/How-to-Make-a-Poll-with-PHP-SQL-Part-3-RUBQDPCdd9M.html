<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Make a Poll with PHP &amp; SQL: Part 3 | Coder Coacher - Coaching Coders</title><meta content="How to Make a Poll with PHP &amp; SQL: Part 3 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Make a Poll with PHP &amp; SQL: Part 3</b></h2><h5 class="post__date">2014-01-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RUBQDPCdd9M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so Highmark under this video so today
I'm going to be doing is we're gonna be
continuing continuing on in the how to
make your own four or pole series we're
going to be doing today is we're
actually going to be inserting the users
choices into the database so let's get
started so we're going to get we have
the submit button with the name of vote
so we're gonna go up here above
everything and we're just gonna say if
is sacked pose vote which means if the
button or if the vote button is pressed
which means the form has been submitted
we want to do is we want to say hold
option equals post hole option and
obviously we need to sign up how's this
for actor security but we don't actually
well I'm not going to do in this video
because thousands overcomplicate the
tutorial but so all I'm gonna say is
we're getting the option from the poll
option which basically means whatever
radio button is pressed we're getting
the value of the radio button restoring
it in the pool option variable so what
we're gonna do first we want to say if
pope option equals nothing which means
they haven't selected a radio button
we're gonna say die
you didn't select option then we're
going to say else now we're going to
insert their option into the database so
that's easy as well we just say - to
rely query connect goes here first then
we put in the query so we're going to
say insert into questions that's we
actually we're not going to insert we're
going to update the questions sort of
failed so when I say update questions
set votes equal to let's say
the boots thank you okay we need to put
this down here so we have access to the
votes variable from the database so
let's just cut that to go down here
where we have this here we're just going
to paste this in below we're below the
while loop and what we're gonna do is
we're gonna get the votes from the
database as well so we're gonna piss
those in here
whoops copy that paste below we're gonna
say vote equals I think it's the third
index but let's just have a look it's
the second so that's zero that's one and
that's two so we're gonna get votes by
changing this to a two and then what
we're gonna do is since we have access
to the votes variable we're going to say
new vote equals votes plus one let's say
new votes so I just want to set a vote
able to new votes wire poll by D equals
whole I what's not cool option poll ID
and then we also want to update another
thing we want to say that once we've
said set votes equaling you vote you
want to say set IP address equal to IP
which is that I what is the IP we're
gonna get from the user and the IP
address is gonna be I we're gonna set
the IP very poor yeah the IP variable
equal to the global they're the
superglobal variable server and then
we're gonna say a remote underscore addr
so now that we've done that that should
be all we need to do we're just gonna go
down here we're gonna say die
website you voted successfully so let's
go back here we're gonna refresh the
page so we want to click on let's say
task question and type of vote
so as you vote it successfully so if we
go to questions now I only click browse
okay I vote I didn't get updated so okay
so the reason that wasn't working as
expected it's because we're starting
equal to the question variable which is
this variable up here and that variable
the variable were getting from that is
the last row from the data as the sort
of the question that was last given
right in the query so we actually need
to get is the or is it the poll option
so we need to set that equal or we mean
we need to go to here and change whoops
question equal to poll option and that
should correct the problem so let's
refresh the page now we're going to test
question I will hit vote refresh okay we
have that increased to three votes
let's try test question again okay so we
have another bug let's see what what's
happening and the reason that's not
working is me let's try let's try
surrounding that in single quotes let's
go up here and refresh so the reason for
the votes problem is actually because
we're up here were saying you votes
equal two votes plus one and the votes
plus one is sort of this variable up
here and this is the variable that we're
getting from the last row in the
database so basically what it's doing is
it's saying go to second question take
the votes from the second question and
I'd won to it which is why we got three
the first time but since we're trying to
increase the task question when we're
not increasing second question which is
why the votes not going up so to fix
that what we have to do is just to come
up here cut this
here sit up here within the while loop
and we should that should I saw our
votes problem so let's just try this
again click test question click vote and
click browse and as you can see the
votes went up by one so the next thing
we need to do is we need to record the
IP address of the user so we've got that
stored in a variable so what we need to
do is we need to say I'll create another
MySQL query and we want to say update
hold set IP address equal to IP address
let's say new IP address we're gonna get
that from up here we're gonna say let's
go down here actually I will say IP
address or new IP address even equals IP
address dot that's to append something
we're gonna put a comma and then we're
gonna say IP which should append a comma
plus the IP address or actually what's
the IP address comma
what should an append the IP address to
the sorry the IP address of the new
Voter to the IP address the IP addresses
we're getting from the database so for
example if I had and one nine two dot
one dot two turned on nine six in the
database which would have a column
actually then what would happen whenever
the next person voted is there whatever
IP address got whatever dot something
dot whoops that's too many but I can see
that that's where we worked with that
like this and we'd have two IP addresses
and if we didn't have any IP addresses
it would just basically a pen the IP
address to nothing which is just what I
mean it can do it so basically the way
this would work is actually equals in
here
as we could say if there was no one had
ever voted in this poll the new IP
address will be equal to nothing so what
we're basically doing is appending IP
address
I mean IP address will be equal to
nothing also what we're basically doing
is appending IP and then a comma so if
it was equal to nothing and we just look
like this in the database when someone
voted and then we just put a comma here
so that's what it would look like so
let's just go back here and go back down
here and this should actually just work
we actually just have to put in where
hole ID equals hole ID so let's just
check the database to make sure this is
gonna work so it's going to pose or
pull-on equals pull on each that should
work so let's try the site time so let's
just refresh the page and what we're
gonna do is we're going to just click
test question click vote so as you wrote
it successfully so that's Roy's okay so
we're having a problem with okay so the
reason we're getting this weird sort of
IP address okay so the reason we're
getting this sort of weird IP address is
because we're using the remote Eddie or
EDD our function in PHP but what that's
Gabe what's that sorry what's that
what's that doing is it's giving us an
ipv6 address because my computer's sort
of configured to work with ipv6 as well
as ipv4 which is why we're getting this
but for example if I put it on my live
server what it would do is it would give
us an ipv4 address because it's not
configured to run on ipv6 so this should
work on a live server but it's probably
not gonna work on localhost which is the
reason we're getting this IP address
sort of just weird one with the two
colons in the one but rest assured
that's networking actually it's just
since my computer worked with ipv6 it's
sort of mastered up a bit but
the only other thing we have left to do
is to check whether the person's already
voted for voted before so if we go down
here and we say you voted successfully
before this we want to say we're going
to check and say if if we actually want
to say we're going to I say IP address
underscore P let's just say IP address a
equals explode let's say we're gonna
explode by the comma and then we're
gonna give it the IP address variable
then we're gonna say is if you need an
underscore array what we're gonna be
looking for is IP so let's say IP in
that's what the hair stock is going to
be the IP addresses so that's the IP
address on the score e because that's
the array then we're going to say die
you've already voted you've already
voted then we'll say else and then we're
gonna let the person actually vote so
let's give it a go so let's click test
question and what should happen is it
shouldn't let me vote says you already
voted let's go back to our to our
questions table and I'm just gonna check
did it go up so that's just right again
it shouldn't have gone up so as you see
it didn't go up but if I go to polls and
I click at it I'm gonna delete this and
I'm gonna try and vote I'm actually
gonna go to questions and I'm gonna
click check all just together to select
them on I'm gonna change it
I'm gonna say a zero and zero here just
so that all the votes go away and I'm
gonna click test question I'm gonna
click vote especially voted successfully
my book got counted if I try to vote
again for say a second question you've
already voted for you go back here I can
see it didn't let me vote so another one
can do just before I go is we can go
over here we can say let's say it was
vote vote vote sources just give us sort
of the number of votes
so it has one vote zero votes so let's
just give one more go let's just click
Add it let's delete that and we'll go
for the second question this time so
zero votes in zero votes
let's click vote we just have to refresh
again see okay that didn't work okay so
okay what will happen was we need to
just stop so let's go back here and try
and vote again so let's click second
questions like vote you vote
successfully and our vote counted so
that's all really we have to do for the
poll that's basically the basic hold on
I mean you could do things to make it
look nicer like for example in the how
to make your own YouTube series we have
sort of the like button that the green
and the red sort of resize themselves
depending on the number of likes and
dislikes do you do something similar to
that with me votes but for now I'm going
to keep it simple so we have one vote
here and zero votes here the test
question and second question are the two
questions that we have so the only thing
you have to do is you put in the give
the each poll an ID I'm not gonna make
an option or I mean a way to create a
poll because I mean it's not hard to
just go into a database and then insert
your questions unless you're trying to
get it to be usable by end users so for
example you want
really create their own poles then you
would need a form to create your own
poles but if it's just you to put on
your website then you don't actually
need it and actually I'm gonna put a
pole like this on haiku org it's gonna
be a weekly poll and I'm gonna have
something similar to this I'm just gonna
use this code probably from this video
so I just look out for that and I'll see
you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>