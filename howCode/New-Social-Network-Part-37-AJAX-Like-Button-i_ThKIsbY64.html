<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>New Social Network - Part 37 - AJAX Like Button | Coder Coacher - Coaching Coders</title><meta content="New Social Network - Part 37 - AJAX Like Button - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/howCode/">howCode</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>New Social Network - Part 37 - AJAX Like Button</b></h2><h5 class="post__date">2017-04-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/i_ThKIsbY64" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so in the last video we were able to
display posts in this video we're going
to be liking posts so whenever we like a
post we want to increase the light
current by one that is displayed on the
page we also want to go behind the
scenes and send an air Jack's request to
actually like the post so to do this we
need to modify our API again so we'll go
back to the API just create and you like
what we're going to do is we're going to
send a post request so we're gonna
scroll down scroll past all scroll past
users and what we're gonna do is we're
gonna say LSF get URL equals
likes so when we send a post request who
likes we're going to like the post so to
do that what I'm gonna do is I'm going
to go down to the posts class you can
see here is how we like and unlike a
post so we're going to copy this all
this and then just paste it in here and
then of course we have to modify our DB
query from DB query to use our DB object
that we created in the API series and
we're just going to copy and paste it to
overwrite all these old queries
at the minute the notified class will
bring everything's we're just going to
comment that I temporarily so you can
see we have a variable called post ID
and like your ID so like our ID has to
be the user ID of the user who's logged
in and the post ID has to be the post
that we want to like so post ID has to
come from our URL so we said post ID
equals get post ID and we'll actually
just call it ID so we get the post ID
out of the URL and we got the user ID
out of the database so what we're gonna
do is we're gonna scroll up and we've
already done this up here so you can see
we get the users login token out of the
cookie and then we get the user ID from
the token in the database so we scroll
down we're gonna paste that in there so
now we have the licker ID which is what
we're gonna call this like our ID and we
get the post ID from the ERL we're not
gonna deal with stuff like malformed
requests because that is more specific
to the API series we're not worried
about that in this part so I set a post
request I should end up liking the post
so to do this what I'm gonna do is I'm
going to go to the like button on the
index.html page and on each like button
here is the like button and what I'm
going to do is I'm gonna set data ID
equals our post ID so the post ID is how
we're gonna know which post to like so
we're going to copy this and then in
data ID we're gonna do is paste it in
there and we'll paste in post ID so now
that we're storing the post ID in data
what we're gonna do is scroll across and
inside of our each function what we're
gonna do is add an event listener on to
each of those buttons so that whenever
each individual button is clicked we can
send a post request and because we're
adding it this way we'll be able to tell
which button was clicked so we'll know
which post to like so to do that what
I'm gonna do is I'm going to access all
of the items with a data ID attribute
just like this I'm gonna say on click
we're going to run a function so no
we're gonna do is we're going to send a
post request whenever this button is
clicked so to do that we're just going
to do what we did before
get our Ajax method paste it in here we
have our success function next and then
we have our error function just like
that so now what we want to do is want
to send our API request to API slash
likes we want to change it to a post
request but there's not actually any
data this time and then what we're gonna
do on success is console.log the
response and we're just sending the
request to API slash likes we're setting
it to API slash likes
ID equals and here we want to paste in
our
post ad which means one up and on a
string and we want our panned on this
dot attribute and then we want app and
on data ID to get the ID and we want to
change our post ID variable to post ID
with a capital I and like our ID to like
her ID with a capital I because if we
scroll across you can see that's the
variables we've used later on in the
script so now what I'm gonna do is I'm
gonna run this code and hopefully it
should work so now if i refresh and I
click on this first one and now if i
refresh you can see it's decreased to
zero likes if I click it again and I
refresh you can see it's increased to
one like so what we want to do is we
want that to update on its own without
having to refresh the page so that's
really easy to do all we do is we scroll
down and next to the HTML so we can do
is say this which is how we access our
current button and we can update the
HTML just like this we go to the inner
HTML which is this icon which is the
heart we scroll across and we end here
on this span tag now what we'll do is
just scroll down and say this study HTML
and we'll update the HTML but instead of
setting it equal to post likes what
we'll do is we'll set it equal to our es
likes which is going to be our response
VAR re s is going to be equal to json
dot parse whatever response we get back
which is going to be r so we go back to
the API and regardless of whether we
like the post or not what we're gonna do
is we're going to echo out DB query
select likes from posts were ID equals
post ID and then here we'll just pass in
an array and set post ID equals post ID
and then as usual we access the zeroth
element that's returned and then we
access the likes column we're going to
echo out some JSON - so we're gonna echo
8 a JSON string then we're gonna echo 8
another string which is gonna be likes :
and then we're gonna equate this number
and then finally we're going to echo out
the closing JSON curly brace so that
should be valid JSON um we're returning
now if I click on a button you can see
we got likes 1 returned if I scroll down
and click here you can see we got likes
1 again click it again we get like 0 but
it's not updating our button so we need
to fix that we're gonna go to end exit
HTML one more time and actually that's
not going to work because at the minute
when we use the vest keyword we're
actually referring to this Ajax request
so to fix that what we'll do is create a
variable called button ID and it's going
to be equal to this
start our tribute theater ad just like
that just like we're getting here we're
storing the ad in botany d and then now
that we have the botany d what we're
going to do is we're going to change
from using the vest keyword to create a
string where we access all of the items
with a data ID attribute and then we say
we're data ad equals and then here what
we're going to do is pass in our button
ad or put in a string there so that we
can and the surrounding string and
piston button ad just make sure we
included the are variable in our JSON
dot parse so that it can actually parse
things a night we will click on a button
and now you can see it automated or
likes increased by one we click on this
one it goes back to zero and I made it
again we click it again and it's
animated again I logged in to a
different account so that we can see
more likes and if I click on this one
it's decreased click on this one it's
increased to 2 click on this one it's
also increased to 2 and we did all that
without reloading the page so I'll lose
bugs that were pointed out should be
fixed but that's it for this video don't
forget to Like comment favorite and
subscribe if you've any questions don't
forget to email me at Francis at haiku
org don't forget you can still enter our
competition the first winner has already
been announced but there's a second
winner so don't forget to subscribe on
YouTube don't forget to follow us on
Facebook Twitter and rat it to increase
your chances of winning but that's it
for this video and I'll see you next
time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>