<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>First remote root exploit - bin 0x1D | Coder Coacher - Coaching Coders</title><meta content="First remote root exploit - bin 0x1D - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>First remote root exploit - bin 0x1D</b></h2><h5 class="post__date">2016-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/HAN8Qun26cQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now that we know how to debug final
level zero of exploit exercises
protostar we can finish our first ever
remote buffer overflow exploit so in the
last video we wrote this Python
one-liner which crashed the process and
the instruction pointer was at hex 67-66
which is obviously fffg in ascii so now
we know which characters overrode the
return pointer on the stack so let's
start with our full Python script to
create the remote exploit let's start by
importing struct to convert addresses to
rob ID strings and socket to connect to
the remote service then we can simply
copy a part of our one-liner for the
padding up to the ffff G which
controlled the instruction pointer and
we can set up the socket like we did in
the soccer programming with Python video
then we can use the socket to send our
exploit string and at a new line at the
end so that gets stops reading input
theoretically at this point we should
have succeeded with the exploit so we
could send a command like ID and you
name minus a and then you receive to get
the response of that cool but before the
shell works we gotta make a plan on how
to get the shell and there are many
different ways we could for example
simply take a stack address and insert
some shell code with an OP slide into
the string we used to overflow but these
deck is always a bit unreliable so I
suggest to use the you read to Lipsey
technique which makes a more reliable
exploit at least for the system to do
this we need a little bit more
information first of all we should have
a look at possible functions we can
return to you can always start to use
any function Lipsy but in the future we
may encounter Lipsy to be randomized
with a SLR while the program itself
might not run with a SLR so generally
it's a good strategy to look for
addresses in the global offset table
which is part of the program we can use
info functions in gdb and specify a
filter like add PLT
this shows us now all reference Lipsy
functions by this program which can be
called with these addresses and we don't
have to worry about a randomized web see
there we can find exactly e which is a
great function because it can be used to
execute other programs like pin Sh
okay so we can add the address to
exactly in our exploit script so now we
have to figure out how to prepare the
stack in order to correctly call exact
ve the easiest way is to create a simple
example C program from the main page of
exit V we can learn how to call it and
write that in our code so execute then
the string to the other program like pin
SH and then 0 to indicate we don't have
any arguments or environment variables
now you have to make sure that you
compile this test program like the
target program meaning if you are on a
64-bit machine but your target is story
two-bit you have to make sure you always
compile for 32-bit just keep that in
mind things can go wrong here but in
this case it's easy and you can just
compile it now use gdb break in mine and
step forward until we are in exit v now
let's look at the stack with examine
eight words and hex from ESP this deck
pointer okay so this is how the stack
has to look like when we return into
exit we the first value on the stack is
the return pointer where we return to
after exit V is done this points back
into main but we don't really care where
it would return to because exactly e
execute another program and never
returns anyway so we can just place here
some a's and our exploit the next value
is in fact the address of the string
buiness age hmm how do we deal with that
an easy way which kind of makes us
exploit dependent on this current Lipsy
version is to look for this string and
Lipsy for an exploit that has to be
agnostic to the version you would have
to use some kind of information League
first but let's keep it simple for our
case so again try to find the string in
Lib C with grep we can use some
arguments to get the offset as well now
we need to know where Lib C is loaded
tool
let's find the process idea of final
level zero and then we can use the proc
file system to look at the memory map
make sure to be rude and there's the
memory address for let's see so let's
copy all this information to our exploit
script as well the string bin as H will
be at the Lib C bass at the offset we
get from grepping over the file cool and
the next two parameters are simply zero
awesome
now this exploit should work let's use
gdb to attach through a process set the
follow for run to children disassemble
the get username function and set a
breakpoint at the return and execute the
exploit we hit the breakpoint let's step
one instruction further and we should
return into exit ve now let's look at
the stack to verify everything is
correct so the first value is the AAA
that is correct the value afterwards is
the string business age followed by two
nulls awesome this looks correct and we
execute our script without debugging in
Ruby we can see the output of the first
command I guess we need to receive two
times to get the output of both commands
now one last trick to make the exploit
nicer I got this small snippet
I think from watching geo hard streaming
CTF channels a long time ago we didn't
use the town ad-lib module then hand
over the socket we open to the talent
lip and call interact
tenet is a very simple protocol over TCP
kind of like plain netcat which is often
used for remote shallow connections like
as it's age just without any crypto just
playing over the network and you kind of
have now a remote shell right so we can
use Python talent Lib to create an
interactive shell for us without having
to write any extensive code so we now
run the exploit we have a nice
interactive shell awesome and this is a
remote exploit now if somebody in your
network runs this VM and changes the
user and root password you can simply
use this exploit to get root privileges
here an example I have Python installed
on my Windows machine and I can copy the
exploit script here now I just need the
IP address of the VM change it in the
code and run it boom and there we have a
remote shell on this Linux system now
you have all the knowledge you need to
solve easy portable challenges and CTFs
awesome
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>