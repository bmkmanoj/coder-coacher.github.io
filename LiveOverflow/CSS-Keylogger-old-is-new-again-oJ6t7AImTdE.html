<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CSS Keylogger - old is new again | Coder Coacher - Coaching Coders</title><meta content="CSS Keylogger - old is new again - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CSS Keylogger - old is new again</b></h2><h5 class="post__date">2018-02-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oJ6t7AImTdE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the motivation for this video comes from
this CSS keylogger example shared on
hecka news Twitter and reddit and it's
incredible popular the github repository
with this example has thousands of stars
after just a day and I find this quite
fascinating but before we get into this
particular example let's go back in time
to 2012
in 2012 almost six years ago of this
video I was still at the beginning of
learning more about security I was still
reading and learning a lot of the very
basics like basic XSS vectors with
script alert and a friend of mine
invited me to a small closed hacker
conference and so there I am a complete
noob feeling like I don't belong there
watching these talks and there was one
talk called script less attacks attacks
in a post XSS world by Mario so the
premise of the talk as you can infer
from the title is about a world without
JavaScript and without XSS issues it's a
thought experiment first and foremost
because having such a situation where
you have an HTML injection with no
JavaScript context is rare maybe with
more and more content security policies
a bit less rare but in the grand scheme
of the web one could argue that it's
irrelevant or not really impressive
because it might not have much impact
but to me this was blowing my mind this
is research
this is posing an interesting question
and it makes you think about everything
in a much more intricate way you can
learn the basics of XSS in an afternoon
but then pushing the boundaries and
learning how far you can take that that
is where you get really good at it so
what if we defeat XSS what a text
surface will remain and will it make a
difference
first of all you have to think about
what even our goal is what would be the
goal of XSS so in general we want to
steal our excess stay that we are not
supposed to access and we want to do
this with HTML that we can inject into
the target website victim visits
so this talk shows a lot of different
techniques and tricks using various
features to extract different kind of
information from the site that could be
login keystrokes or could also mean
access form data such as a CSRF token a
password or a credit card number this
talk is actually based on a paper with
the same name and Mario gave this talk
several times in a linker recording
in the description but we had the rule
for this talk for this thought
experiment do not use any JavaScript do
not use any XSS so the question is now
how can we mitigate or bypass the see
sort of protection are just using CSS
and other inactive stuff not using any
JavaScript or can we do this well some
other people did this already some years
ago and I think that was also blue head
talk and excellent one - it was a Sardar
cut their face and David Lynn say they
they already did it and there's still a
demo out there you can never look at and
they also use cross they also use CSS
cascading stylesheets so what they did
they were abusing attribute selectors
and then we said okay select everything
that has value or every input element
that has a value that is starting with a
letter A and give it a background image
that is indicating that we have the
letter A so if there was the letter A as
the first letter it was sent out same
with b c d e f g and they could also do
this with the last letter or with some
letter in between what they could not do
is select me the enth character so they
couldn't say like hey ii select me in
element well the second letter is
actually the ABC or D or whatever so
they had to vote for us a lot they had
to write a lot of CSS to make this
happen almost like loads like literally
megabytes of stuff there to inject so it
was not very feasible also didn't scale
on attack or select to scale and then
Mario shows a more efficient and more
insane technique to pull this off but as
he pointed out this idea with attribute
selectors loading background images was
already introduced previously by Eduardo
ed surd sorry no clue how to say that
Gareth Hayes and David thorne maker now
let's fast forward to 2018
to a tweet I came across in February by
my Gualtieri who apparently discovered
this again independently you can see how
he explains the CSS attribute selectors
and then used the same background image
loading trick he put a lot of effort
into this wrote a detailed article
calling it stealing data with CSS and
even wrote a chrome and firefox
extension that is removing these CSS
rules as a form of protection I feel a
little bit bad for him because I think
he thought he stumbled over
something new but it was just a
rediscovery but yeah this can happen and
happens in security a lot different
teams find stuff independently and maybe
years apart and it's such an obscure
technique as well that it's very likely
you haven't heard of it before if you
don't spend a lot of time with browser
client-side security and I guess I was
just lucky that I saw Mario's talk in
2012 now a couple of days later this CSS
keylogger example turns up I'm not sure
if it's a coincidence or if it was
inspired by this article but this person
created an extension that simulates a
CSS injection into a page to steal
characters entered into an input field
you can see the injected CSS here it
uses CSS attribute selector for an input
password field and depending on the
value embeds a background image from a
URL which is sending that character to a
server to collect it now there's one
small detail here that is quite
interesting you see the CSS attribute
selector works on the value attribute so
it doesn't work in a plain HTML example
even though the enter text is available
via the value property on the input
element it's not the attribute value so
the CSS selector doesn't kick in that's
also why the password stealing example
of the blog post actually sets the value
of the input element it wants to extract
the characters from via a get parameter
so this is a technique to steal
attribute data so another good target
for this techniques is a CF token that
is usually set as a hidden input value
but the github example worked on inputs
where you just type in well that's the
small detail that is quite interesting
essentially what is happening is that a
lot of JavaScript frameworks such as
react we react on events like typing
into a field and automatically propagate
these values to internal variables but
also properly set the value attribute of
the input element so essentially it can
be brought down to this example on each
key event we set the value attribute to
the value property as a test I have to
find here sing
that only kicks in when the character ex
is detected so when we now test it and
type something in the field we see the
value attribute updating accordingly and
with an ex the CSS rule kicks in and
that could be used to extract the data
you can easily observe this behavior on
the Instagram login form as well so if
Instagram had an HTML injection and for
some reason you couldn't execute
JavaScript you could use that to steal
some input form data pretty neat
behavior right okay so I don't want to
talk down this research and I'm
definitely not saying this research was
stolen or anything I give them the
benefit of the doubt especially Mike
seems to be very genuine and discovered
it by himself which i think is
impressive and it's proof that he is
very creative in his thinking I mean I
didn't come up with this and I'm not
sure if I ever would have
I just knew about it because I heard it
in a talk but I think it's an amazing
example of research that has been done
in the past and is rediscovered or
resurfaces in a way the numbers of
people interested in the CSS keylogger
example shows that a ton of people have
never heard about it
didn't realize it was possible and so
now more people learn about it and it's
awesome so I hope I made it clear that
there is research contribution I
acknowledge and I don't want to be one
of those people who boast of themselves
for having heard of it already in 2012
however I want to put this also into
perspective and I have to criticize a
few things the name CSS keylogger okay
maybe the person who created it didn't
anticipate how popular it will get is a
short descriptive name and somewhat
fitting but damn this is easily
misinterpreted by most people and it's
fear mongering when we hear keylogger
we usually think of a malicious malware
running in the background recording
every keystroke and that is terrifying
then sometimes we hear about browser key
loggers and that already is a bit more
nuanced because it usually refers to
keystrokes captured on one particular
website via JavaScript which usually is
also fear-mongering by piggyback riding
on the keylogger malware term because in
such a context it's not a system-wide
key logger
and the JavaScript could do other stuff
that is worse than just logging keys and
now this CSS example is even less
impactful than that this specific
example can only capture attribute
values and usually only CSS injection
without as XSS is quite rare
like Mario already stated in 2012 it's
more of a thought experiment and an
interesting research question rather
than something realistic there are some
interesting edge cases for example how
about reddit that doesn't allow
JavaScript but CSS customization and so
you should know this techniques exist
when you are looking for security issues
but it's pretty much irrelevant for most
of the world the real world impact might
be low but like I already said it is a
mind-blowing idea it's may be comparable
to the discovery of a new distant planet
in a habitable zone many people say who
the eff cares about this here on earth
we have real problems but it is awesome
research it is pushing the boundaries of
technology and it's helping us
understand the world better and so these
CSS attacks help us understand web
technology and threats better and that
in itself is already awesome but it's a
problem when this travels so far and
gets so popular scaring so many people
this and many more techniques have been
known for like a decade and that is
proof that this is not a problem or an
attack you have to worry about so just
chill look at the underlying technical
data
ignore the FUD about the-- anonymizing
tor users or key loggers and just
appreciate how you can twist CSS to do
insane stuff</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>