<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rooting a CTF server to get all the flags with Dirty COW - CVE-2016-5195 | Coder Coacher - Coaching Coders</title><meta content="Rooting a CTF server to get all the flags with Dirty COW - CVE-2016-5195 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rooting a CTF server to get all the flags with Dirty COW - CVE-2016-5195</b></h2><h5 class="post__date">2016-12-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lj2YRCXCBv8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I was browsing reddit in this new CTF
for beginners popped up obviously I had
to check it out and directly head to my
favorite category the binary
exploitation stuff and of course there's
a server you can connect to as a regular
user and when you exploit the challenge
you will elevate privileges to another
user to gain access to the secret flag
but the biggest challenge of all and I
couldn't find rules that would forbid
this would be to gain route so let's do
that
remember my dirty cow explanation video
let's use the proof of concept exploit
that we had there and tested if it works
on the server so we can simply copy the
code to a file and TMP and compile it to
test if we can override files that don't
belong to us without overwriting
critical route on files we login as
another challenge who's all on the
system and create a file with some
content and then we go back to the first
user execute dirty cow on that file and
an attempt to write some other
characters to it and when we check we
can see that it works at this point I
wrote the author message on reddit to
inform him that the server's vulnerable
and he should quickly update but now we
need a plan what route file we could
override to become rude ourselves our
restriction is that we have to override
something in a file we can't append or
prepend anything the first obvious idea
would be a set UID binary but the issue
is that in order to write a backdoor
shell to the binary we would have to
parse the elf file format and figure out
where the entry point is an easier
strategy is to override data in a text
file and I choose etc' password you can
see here the user ID of the users and if
we would change the UID of the upon one
user to 0 we would log in as rule so the
dirty cow proof-of-concept writes to the
beginning of the file so first we have
to figure out the offset inside of it
it's a password we can use hex time for
that and count a little bit pone one
user is at offset hex for C zero plus a
little bit I use Python as a calculator
and modify the exploit code to write to
a fixed offset I think that would be a
good plan and you have to be very very
careful with choosing these offsets and
choosing what to write because you can
screw up the whole system if you don't
so I copy it easy pasady to try what I
want to do before doing it to the real
file and of course my first attempt
would have wrecked the system so
adjusting the offset a bit and also
appending a new line at the end is
finally successful and I write to the
real ATC passivity now when we switch to
pond one or SSH
in 2.1 we get a root shell then we can
read out all the flags and once we are
done we revert back ET pass with it to
the original state some important notes
be very careful what you allright with
an exploit like this just one bite
miscalculated and you might destabilise
crash dots the system or simply lock
yourself out also if you find a solver
vulnerable think about the impact or
context you're in this small private CTF
server project that is intended to be
hammered it's different from a web
server you exploded from some random
company so don't go around and try this
if you have no permissions or you could
cause a lot of damage make an ethical
decision be aware of the risks you are
taking in thanks Mario for being cool
about this and allowing me to make a
video about it good luck with your
platform
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>