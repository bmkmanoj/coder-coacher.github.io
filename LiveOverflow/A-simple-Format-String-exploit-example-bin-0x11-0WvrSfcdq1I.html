<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>A simple Format String exploit example - bin 0x11 | Coder Coacher - Coaching Coders</title><meta content="A simple Format String exploit example - bin 0x11 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>A simple Format String exploit example - bin 0x11</b></h2><h5 class="post__date">2016-04-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0WvrSfcdq1I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this episode we'll have a look at
format level 1 from explodes exercises
protostar this class of vulnerability is
weird
I was mind-blowing to me when I first
saw so first of all what our format
strings probably the most known function
in CES printf printf prints formatted
data to s CD out in my programming in C
video I've used printf to print a named
that a user can supply the parameters of
printf are the following the first
parameter is the so-called formal string
net early video that was knock-knock and
the percentage s and as the second
parameter we used our degree one which
contains a string so printf read the
format string and found the percentage s
which means that at this position
belongs a string so it takes the first
supplied variable in this case or b1 and
places the string there format string
supports a lot of different types of
variables for example percentage D which
is assigned decimal integer or
percentage X to display a number in hex
and can do even more than that for
example if you specify a number between
the percentage and the specifier you can
tell what size it should be petted to
and you can for example prepend a zero
to that number to bear the results with
zero format string functions like that
exists also in other languages for
example you can use pretty much the same
features in Python print a format string
with percentage and in the variables
afterwards with another percentage sign
or better use the format function which
has a slightly different syntax but in
the end it's all the same and now you
wonder how the hell can something that
just prints text be exploited so let's
have a look at the source code of format
level one main cause the function wrong
with the string from our v1 and that
string is placed in printf and then we
have a global variable target which is
checked if we got modified so pretty
similar to some earlier stack buffer
overflow challenges we need to
manipulate this value but how can we
many
pilatus verbal and memory with printf
well let's do the step by step let's
first execute the program as you can see
it will simply print whatever we supply
an arc v1 that looks simple but there is
one small thing you should notice which
parameter of printf does the attacker
control it's not the second parameter
like in the programming and see video
it's a first parameter the format string
can we just use some percentage syntax
let's try let's enter a format string
test percentage D oh damn it printed a
number weird let's add some more
wor of monomers let's print them as hex
instead of signed decimal numbers that
looks familiar
remember the videos where we were
looking at the stack do those values
starting with B ffff remind you of
something
those will stack addresses so what are
we printing here if you have watched the
previous episode about reversing C you
know how functions are being called
especially in 32-bit the parameters are
simply placed on the stack and then the
function is called so if you would use
printf normally your variables that you
want to print would be placed on the
stack
well now there are no variables being
placed on the stick so what values are
read are we reading obviously we are
reading whatever printf can find on the
stick so any value on the stick so what
can you do with it first of all it's a
memory leak vulnerability you can leak
all kinds of stuff from the stack
imagine you had a program with a SLR
meaning that the location of the stack
in memory is random and you don't know
where it is but you need the address for
buffer overflow to jump to shellcode
with this year you can leak values from
the process memory most specifically
from the stick and that's possibly
leaking stack addresses which then you
can use in a second step for buffer
overflow in a recent CTF which I played
there was an exploitable challenge where
I used to form a string mullen ability
to leak the stack canary I will do a
video about exploit mitigations at
another
point but the secondary is a random
value which protects from buffer
overflows if I can get this number I can
defeat the protection which I did so at
first leaking some weird values from a
process memory doesn't cyclic doesn't
sound like much but there are many
examples you can come up with where
disclosing some memory could help
exploiting a target after all bugs like
heartbleed were just leaking some memory
and was awful okay but in our particular
case how can we use that to modify your
value at the moment it only looks like
we can leak values from the stack let's
have a look at the printf main page main
3 printf and let's scroll to the
well-known box section it says here if
something comes from untrusted user
input it may contain percentage n
causing the printf call to write to
memory and creating a security hole in a
little bit further up the specifier n is
explained as the number of characters
written so far is stored in the integer
indicated by the int pointer or variant
point argument so percentage n writes
the amount of characters that were
already printed into a variable and a
variable is just some area in memory and
we know that to specify where the area
is we need to use a pointer or if we
just look at the assembler code a
pointer is simply an address so that
printf knows where to write the result
so if you were to write the letter D
program with percentage n you will place
a pointer to an integer variable as a
parameter to printf but in assembler
this is just simply putting an address
of the Barrell variable only stick this
means that whatever value is on this
deck is used as a location where printf
will write 2 now you can basically solve
this challenge alone we need to write
the value in Target so let's use object
dump - T to find all symbols from this
binary and here's the address of the
target variable now when we want to
printf to write something at this
location we have to find this address on
the stack let's start investigating I
will use Python in a one-line script or
inline script that
actually from the command line via - II
to help me with printing a test string
for example ten hex numbers
hmm maybe I want to separate them
doesn't look like the addresses is here
maybe if we print more values from the
stack nope not here maybe more wait a
minute
what is that weird pattern from the
values of the those hex values it could
be ascii hex 20 is a space after all
with python we can quickly convert those
hex values to ASCII characters and war
percentage eggs that looks like our
string that we have supplied let's test
this with adding some capital aids
because we can recognize those s key
values easily now we just have to look
for for one for one for one for one and
indeed there are our A's and it makes
sense because the program arguments are
simply stored on a stick like the
environment variables and other stuff
cool this means we can simply place the
address from the target on the stack
ourselves by adding it to our string so
get the address again for target and
then we can add the address in our
string maybe wrap it in some a s and B's
so we can find it in the output easily
oh yes there it is cool so in theory we
just have to play C percentage X that
was printing this address with
percentage n2 instead right to this
location to do this we first have to
change our format string and making the
number of X's we print lower so then we
can use a percentage n to write to that
number and now I'm start fiddling around
with it trying to get the right number
and if you pay attention to looking for
the A's and B's again that are wrapping
the address you see that it's not
perfectly aligned anymore so it's some
trial and error feeling of how many X's
we need so that the next X that I append
will hit the address exactly so I can
replace that with an N you could do it
more intelligently but I will just
figure it out with front error you have
to be careful because remember from our
previous videos where the stack was
shifting around because of stuff like
environment variables the different
lengths program argument that we supply
moves around the stack as well so you
might have to fiddle around quite a bit
until you
get it right okay that took a bit but
looks cool the last egg seems to
reference our address now and when we
place the X with the N to write to that
address we modified the target and you
can imagine that if we can write
anywhere in memory we could overwrite
things to redirect code execution as
well so that will be the case in later
levels just a small tip when you work
with foreign strings flights it make
sense to keep your text string always
the same length then you don't have to
fiddle around much just use Python
script that always extends or cuts the
string to add like 500 characters or
something and then you have enough space
to play around and a stick doesn't move
around much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>