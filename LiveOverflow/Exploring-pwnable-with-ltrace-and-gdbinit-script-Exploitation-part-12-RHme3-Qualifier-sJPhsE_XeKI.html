<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Exploring pwnable with ltrace and gdbinit script - Exploitation part 1/2 - RHme3 Qualifier | Coder Coacher - Coaching Coders</title><meta content="Exploring pwnable with ltrace and gdbinit script - Exploitation part 1/2 - RHme3 Qualifier - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Exploring pwnable with ltrace and gdbinit script - Exploitation part 1/2 - RHme3 Qualifier</b></h2><h5 class="post__date">2017-09-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/sJPhsE_XeKI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the qualification round for our hm III
is over so we can have a look now at the
challenges you had to solve to qualify I
really enjoyed the exploitation
challenge because it was pretty
straightforward and you have had a good
chance to solve it yourself if you are
familiar with my exploitation videos so
let's check it out
the binary is running on cone origami
risky Oh calm analyze it and find a way
to compromise the server we will find
the flag and the file system when you
try to access this to mean by the
browser it doesn't work but we are given
two files and I'm sure we can
reverse-engineer the binary to figure
out how to interact with the server the
fact that they give you a lip see is
already a good hint let me tell you what
I think when I see it first the target
system will be a typical modern Linux
system so no executable stack or heap
and thus we have to do Rob or return -
let's see and in order to do that
successfully you have to know where the
Rob gadgets are Lipsy functions are but
if you use your local loop C then the
offsets are probably different some CTS
don't give you ellipse see this means
it's harder because first you have to
somehow leak the server let's see or
guess it based on addresses you leak but
yeah and a typical exploited for CTF
challenge is to simply call the Lib C
function system with business age as a
parameter to get a shell so I already
expect that I probably want to override
some entry in the global offset table
and point it to system this means I'm
kind of looking at this challenge from
the reverse I know or at least guess
what I want to do and to achieve this I
am looking for a way to write in to be
global off the table or override some
other function pointer for that matter
only if after while I realized that dead
attempt would fail I consider other
possible techniques so let's have a look
at the binaries the main elf file is not
stripped which means it will have all
the symbol names in there which makes
reversing really easy but when we try to
execute it it doesn't seem to work and I
saw some people complain that it doesn't
work but what does doesn't work mean
that's one of my pet peeves we have to
be more careful with our observations we
don't see any of these arrows so for
example if I just rip out the start of
the binary and try to execute that I get
very obvious execution errors that's not
what we see so we have to investigate
why it immediately exits really good
tools to get a general first impression
of what is happening
it's esterase and el tres and when you
run the binary with it you first of all
see that it does in fact run so it works
it just exits for some reason el tres
will show you all the library calls so
you can see it executes get pwn em
before exiting and the main page tells
us that it tries to get the information
about a user from et Cie passwd and the
user was pone pwn so i guess it expects
this user to be there let's add this
user oh and also a good idea is to
switch now to root because it looks like
the binary wants to mess with user
permissions so we add this user and do
some random info there we go when we now
execute it we get further this time it
builds a path and this path obviously
doesn't exist so let's maybe create that
one as well maybe it wants that path one
other thing that happens is the fork and
fork means it creates a new process so
we should use the minus F flag to follow
also any child processes ah-ha and now
it tries to create a socket and open a
port 1 3 3 7 also we can now connect to
the sport and interact with the program
and that is also the port for the remote
server I heard several people patch the
binary to get around all these checks
but it's not necessary the program just
expects certain things about the
environment but whatever your solution
work to so now that we can see what the
child process calls with el phrase we
can explore the functionality and at the
same time CD Lipsy cause this is super
helpful to maybe even find issues anyway
as you can see this program is a team
manager where you can add players remove
players edit a player or show the whole
team so I obviously started by adding a
player and entered a format string as
the name to check if it's a format
string vulnerability but it was not all
outputs probably printed but it still
quickly found the bug because I noticed
I first have to select a player before I
can show this player and when I do this
and then delete the player I selected I
can still show the player and now the
values are weird so obviously when you
delete the player you have selected you
shouldn't be able to show the player
anymore this means we have a classical
use after free condition a reference to
the deleted player was not removed next
I want to see how the heap looks like
when we are creating players basically I
want to know what the play of structure
is but before we get there let's open a
binary in a disassembler you will
immediately notice that the binary
contains all symbols because it was not
stripped so that is really nice for
example here are demonized background
process and serve forever functions
which do all this well background
process and listening forever
unimportant of but more interesting
right now are the menu functions
including the Edit show and set
functions and to look at the player
structure we could look into the show
player func the cool thing is it is also
used in show team so every time player
information is printed it will call this
function here useful to dump some debug
info and in show player func it looks
like there is a parameter already that
is used to pass and we player address
so let's write a gdb init script that
helps us debugging first I copy the
default gdb in it will not lose Pitta
and then we set the follow formoterol
child so gdb will follow the child
process upon a fork then we set a
breakpoint and show player fung and use
RDI to print some memory silence so we
don't see gdb info messages and continue
afterwards so just print the memory but
don't actually interrupt and then we can
start gdb with - X to specify this gdb
init file which sets the breakpoint with
the commands and runs the binary then we
can use our other window to connect with
netcat to the local port and add a
player using a name we can recognize in
memory and when we then show the team
that's called show player func our
breakpoint will be hit and print the
memory and that work great let's add a
second player also with unique data
bbbb as name and 5 6 7 8 for the stats
then we select show team and we have a
look at memory so we can clearly see for
32-bit integers containing our stats it
was 1 2 3 4 for the first player and 5 6
7 8 for the second player then we seem
to have a 5th value which is an address
or pointer into the heap in fact this
heap chunk is right after this initial
structure so this is just the string the
name so to summarize we have a playoff
structure with four 32-bit integer stats
in a pointer to a char array of string
which is also allocated on the heap and
now we come back to our goal we would
like to overwrite an entry in the global
off the table if we could control this
pointer somehow and point it in to the
global offset table we maybe could use
the Edit name functionality to write a
new name or the address of another
function into the global off the table
right that sounds like a good plan as
the video gets longer than I expected
I will have to split it into two parts
maybe with the knowledge now of how to
debug it and some hints on what we want
to do you could try to do it yourself
and then in a few days I will tell you
how I did it
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>