<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Smashing the Stack for Fun and Profit - setuid, ssh and exploit-exercises.com - bin 0x0B | Coder Coacher - Coaching Coders</title><meta content="Smashing the Stack for Fun and Profit - setuid, ssh and exploit-exercises.com - bin 0x0B - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Smashing the Stack for Fun and Profit - setuid, ssh and exploit-exercises.com - bin 0x0B</b></h2><h5 class="post__date">2016-01-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Y-4WHf0of6Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in past videos we have learned how the
CPU works how to read assembler and how
to reverse-engineer the functionality of
a simple program in the upcoming videos
I want to go a little bit deeper and
explore how we can exploit a program
when we have the ability to corrupt
memory the first video will be more
about how to set up and get everything
running so we can focus on the technical
part in the next videos the title of
this video is inspired by the famous
frack article smashing the stack for fun
and profit from 1996 you can imagine
that a lot of stuff has changed since
then though we first have to learn about
the basics before we can have a look at
modern techniques we will kind of follow
the timeline of exploitation techniques
discovery and attempt at the mitigations
like DP or a SLR just name - its basis
for the next couple of videos I will use
challenges included in the linux images
provided by exploit exercise comm this
allows you to set up the system as well
which I highly recommend with protostar
you will start with simple memory
corruption and modification functionary
direction and finally executing custom
shell code in order to make this as easy
as possible to introduce a SLR and
non-executable memory has been disabled
so first download the protostar ISO
and boot from it in the VMware Player as
you can see it doesn't start with a nice
graphical user interface like our Ubuntu
system does but on panic you learned how
to use the command line from the very
first episode now I will use this moment
to introduce you to SSH which stands for
secure shell is a program that allows
you to connect to a system over a
network that has necessary server
running this would be the kind of access
you get when you have to administrate
servers that run for example a website
that's the reason why I introduce you to
the command line in the very first
episode because you really really have
to know how to use it you can also tell
that I run Windows as a host OS I think
I haven't mentioned it before but the
main reason here is that I imagine the
majority of people start out on Windows
which mean it's the best way to reach
more people we don't want to be
excluding like so many other parts of
our society at least for me hacking
conveys a spirit to be open and share
knowledge so that's why I have to
download putty for Windows now which is
a Windows client for SSH to use it to
connect to this machine we have to find
the IP address of it the username and
password for the protostar image is just
user so use that to login and then
execute the command I Piedra to fine TD
signed IP and then copy it into putty
save the session and press open you have
to login again but this is much better
now we can copy data back and forth and
we can have multiple connections the
equivalent for Mac and Linux is just
simply type SSH the username user at the
IP address okay at the moment all shell
has bin as age and as you can see tab
completion doesn't work but we can
execute bin bash instead which makes the
command-line a bit nicer so what do we
have here with you name - I we can see
that system information and we can see
that we have a 32-bit Linux with a 2.6
kernel so how does this work now on a
website that says the levels should be
exploited can be found in the ops
protostar bin directory so let's have a
look
LS to list all files in this directory
immediately you will notice this weird
red background color for the filenames
let's have a closer look with files we
can check the file tab and it tells us
that it's set UID elf 32-bit executable
from earlier videos you may remember
that we have never encountered said UID
before as always if you want to know
something in Linux we can look into the
Linux manual though the main page of
security is actually about the said UID
function provided by Lipsy but that
doesn't bother us because it might be
related so let's see what it says about
this function set UID stands for set
user identity and said UID sets the
effective user ID of the calling process
hmm with cat pass VD we can see all
users on the system
remember our users called user so we
have the ID 1 0 0 1 and root user has ID
0 so does that mean that we can simply
write a C program as our unprivileged
user and execute set u ID with ID 0 to
become root obviously not that would be
horrible further down it tells us about
possible errors like EEP erm which says
that the user is not privileged and the
UID does not match the real UID of the
calling process ok then
what can it be used for an example usage
is that a root process might want to
drop privileges to an unprivileged user
that in case the process gets exploited
the attacker does not gain root
privileges so if you have a process that
has to start as root but then doesn't
need it anymore it's good to drop them
anyway what does this have to do with
our set UID binary let's open a second
as its age session to look at all
running processes now open a process
that keeps running something like vim
editor and then we can use the other
shell to execute PS aux to list all
running processes now we have to search
a bit but here it is the first column
tells us the user of the running process
and because we as user have executed
them it will run with our privileges
so now let's it's accused one of those
that you
the binaries and do the same let's
search the program name here it is but
do you see the first line it says it's
running as rude what the fuck how is it
possible let's have a look again at the
file permissions okay first of all our
dash X means that anybody on the system
can read this file and execute it the
next three permissions are the same and
refer to the permissions of the group a
group is just an ID that multiple users
could share so we are in a group that is
also called user but theoretically you
could have multiple users together okay
now it gets interesting the first
character indicates of a file is a
directory well it's not so the remaining
three permissions are the on off file
the owner of the file is rude and the
owner has the permission to read write
and s so the s replace what should be X
for executable this is called the set u
ID bit we have already looked at the
running process so you can guess what
this does when this bit is said and I as
a regular user executed Linux will
actually execute it with the privileges
of the owner so in this case it will run
as rude why the hell would somebody do
this there are two good examples first
you may know sudo which is a program
that allows you to run something as rude
if you are normal user so how can Sulu
execute a program as rude even though
you typed in the command well it also
has D set you add a bit another great
example is the ping program ping will
also run as root because it has to set
your ID bit set why you ask because ping
wants to send an ICMP packet which is a
fairly low layer and Linux journey
doesn't allow normal users to create
such raw packets but because ping is not
evil somebody created as a duo VD binary
to allow normal users to send ICMP
packets what if there is an exploit for
a program like ping that would allow you
to execute arbitrary code as you root
right so it's clear that said UID can be
really dangerous well and that's the
whole point of the challenge from
if we can exploit one of these programs
here we can escalate privileges and gain
route this is basically like
jailbreaking on iPhones or routing on
Android devices you try to find a
vulnerability that allows you to execute
arbitrary code in a privileged mode well
on those real devices especially iOS
this is extremely fucking complicated
and a lot more layers are involved but
now you get a better imagination of the
whole thing one last thing before we
start with the challenges you know that
you can debug programs right for example
you can use s trace to spy on system
calls or simply use gdb and gdb allows
you to modify memory so you could just
open the set UID binary in gdb modify
the code and execute whatever you want
as route let's try it okay it seems to
run so let's rerun it and look at the
process list as you can see it doesn't
run as rude anymore the reason is that
gdb could not debug a process that runs
as another user
so gdb actually forces the binary to not
run as root so it can actually debug it
so good idea but unfortunately or maybe
fortunately it's not that simple
I guess we have to rely on good old
exploitation techniques see you in the
next video when we start with the first
challenge
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>