<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>First steps into networking with net0 from exploit-exercises protostar - bin 0x19 | Coder Coacher - Coaching Coders</title><meta content="First steps into networking with net0 from exploit-exercises protostar - bin 0x19 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>First steps into networking with net0 from exploit-exercises protostar - bin 0x19</b></h2><h5 class="post__date">2016-11-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2CL-AAcgyuo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the last few videos were already getting
really difficult to follow and required
a lot of concentration and patience to
understand them so I'm happy that we can
now move on to the network challenges
from exploited exercises protostar which
will be a lot easier because we have to
establish some basics first let's have a
quick look at networking level zero the
description says you have to convert
strings to little-endian integers and
this level is very easy but to fully
understand what's going on the code is
not quite enough I show you why so main
calls a function background process and
passes it a name and the user and group
ID it will run with now this function is
not a common Lipsy function you can also
check et Cie password a for the user ID
in 9 &amp;amp; 9 and you will notice there is no
such user this might seem weird but just
don't think so abstractly about
computers what does it mean to have a
user on a Linux system in the end a user
is just an ID a number in memory and for
example an owner of a file just mean
that this file has this number as owner
set now if the user is listed here in
ATC pasady Linux will be so nice and
display the name instead of the number
but under the hood it's still just an
integer so even though there is no name
assigned to that ID you are still free
to use it anyway back to the code the
other functions such as surf forever and
said i/o are also not known functions
and when you look at the includes you
will notice that it references a common
dot C file so the author of this
challenge implemented a lot of code in a
different file and we don't know what it
does but one function is here and that
is the run function you can see that it
is called at the end of main run
generates a random number tells us that
usual sent that number as little-endian
then performs a read from a file
descriptor in this case from standard
input interprets this input as a number
and compares it if it's the same as a
random number before so just a simple
test
as I said earlier we could solve the
challenge without knowing these unknown
functions below because just reading the
comments and function names tells you
everything you need to know but as you
know we are not satisfied on this
channel when we ignore underlying
concepts we want to understand computers
better and these functions implemented
two interesting concepts that are
mentioned here one is running the
process as a daemon and the other one is
about networking and sockets so how can
we figure out what it does well we know
already everything we need to to be able
to reverse-engineer this so let's start
by exploring the behavior of the program
before digging deeper when you try to
run the program nothing happens but when
you look at the running processes you
can see that net zero is already running
so let's quickly switch to the root user
so we can kill that process and start it
ourselves the default would pass out for
this VM is God mode now we can kill net
zero and we can verify that it's not
running anymore so let's execute it
again nothing happens but if we check
the processes we can see that it's
running again so what happened let's
kill it again and start it with s trace
so it finishes with an exit but what
happens before it seems to open a net
zero dot PID file with right permissions
then it changes the user and group ID to
nine and nine with said effective UID
and GID so this means the process drops
its root permissions after that it calls
clone the main page says that clone
creates a new process similar to fork so
this will spawn a new process as clone a
copy of itself and the return value is a
process ID of the newest process which
is equal to the value of written into
the PID file so that file just helps you
to keep track of the new process you
created and after that the parent
process accepts and leaves the child
process orphaned this is literally
referred to as an orphan process and
because we did this intentionally we
also refer to this now as a daemon it's
now a background process so what we can
do is we can run s race with the minus
F flag to follow child processes created
instead of staying in the parent process
when we do that we see that after the
clone we attach to the new process and
in the background the old process exits
then we change directory and open up
death null which is another special
pseudo file that acts like a black hole
and then we dump the sed input as the
output and sed arrow of this process
which basically means we Bend all these
stand up streams to point into the black
hole basically we just throw away
everything and then we write the child
processes Aidid through the PID file
from earlier which had the file
descriptor number three now the fun part
starts a new socket is created the
socket is used for network
communications and you can choose what
kind of socket you want with those flags
and settings but most importantly is
then the call to bind which attempts to
bind this process here to the port to
nine and nine which means that if the
operating system receives a packet that
wants to establish a connection with
this process it will do so and then
forward the packet with the data inside
to the process but this function call
fails because the address and port is
already used by another process which
makes sense because we called NetZero
already earlier so let's kill the
process again and retry this okay this
looks great
now we listen on the port we opened and
we are waiting for a packet to arrive
with the accept Cisco so let's open a
second terminal and use next set to find
this listening process and here it is on
port to 999 the process NetZero is
listening cool now let's use netcat to
establish a TCP connection with this
port this will cause the accept call to
return because a new connection got
established and immediately after accept
you see another call to clone which
creates another process to now handle
the server client connection this way
another user can also establish a
connection and doesn't have to wait
until you are done because you have now
your own dedicated process also accept
returned a new file descriptor that
references the socket so like with
regular files you can now perform read
and
with these file descriptors like you
would do with any other file the color
and the needs make sure to send the data
you write as at ESCP Packer to will
declined and when it receives data it
will make sure that you can read it from
the socket now it will change the
standard input and output and arrow
streams from deathnote through this new
file descriptor and the program can then
just read from standard input and will
read the data you send it and that is
what the run function does if you
compare run with the last two Cisco we
first have to write to se au which came
from the printf here and then an F read
from Senate input this is where we are
right now when we now type a line into
netcat that curl will send a packet with
this text through a network through the
program the server and on the server
side you can see that it read that
string you sent to it and then perform
the right telling you that it's the
wrong number
that's the failed printf in run so let's
summarize what the hidden code is doing
it first demonizes by cloning itself and
killing the parent to become an orphan
and then it starts listening on port 2 9
and 9 for TCP connections once a
connection is established and we will
have a detailed look at that he's a P
protocol some other time it will create
another process a clone of the process
to handle this establish connection
while the parent is really again to
accept another connection parallel the
child process that handles the
connection is now basically just calling
run so in simple terms you can say the
program runs as a background process
that executes run for every client that
connects to it awesome we understood
that now let's off the challenge first
of all we need to get the string
representation of that number we can use
Python for that specifically the struct
package which we already use before so
restricted pack we can convert a number
to the byte string representation but as
you can see the resulting string doesn't
use characters we can type with the
keyboard we can print these by advanced
with echo and - II but simply typing
this internet cat doesn't work because
the number is random
but we can use a simple trick we can use
echo - e but inside of the clothes we
use SPECT expects acute cat with a -
which simply redirects anything we type
to the output again and the output is
then placed in the quotes of echo so
when we now pipe that internet cat we
see the number and cat is waiting for
input we use Python to convert the
number and then we simply paste the
escape string back into the other
terminal hit enter and then used control
D to indicate that we are done with the
input which closes cat and echo will
send the string to net cat and it works
we get the success message thank you sir
madam
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>