<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Format string exploit on an arduino - rhme2 Casino (pwn 150) | Coder Coacher - Coaching Coders</title><meta content="Format string exploit on an arduino - rhme2 Casino (pwn 150) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/LiveOverflow/">LiveOverflow</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Format string exploit on an arduino - rhme2 Casino (pwn 150)</b></h2><h5 class="post__date">2017-04-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fRgNtGXDMlY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now that we solve the photo manager
challenge in the United exploitation
area
I thought about checking out casino
should also not be too hard with 150
points welcome to our casino risk hero
Royale please enjoy your stay by playing
a game or drink something at our bar
reach 1000 credits and you will be
rewarded with a special price we have
seen loads of cheaters lately so we have
extra guards walking around to not feel
threatened by them they will only kick
out the people that cheat of course once
you earn a lot of money they will start
investigating the matter let us spend
some money at our bar of this happen PS
we all know casinos are scams as you
know I'm hanging out on the Raj me too
IRC channel in a witness a conversation
some time ago by somebody who worked on
the challenge and asked if it's possible
to reach the 1000 credits through
playing and just getting lucky but this
person also said they tried running it
for days I think it didn't work so while
it's not a real spoiler it does save us
some time to not explore that path you
could have also come to that conclusion
reading their PS but it's not that clear
anyway let's slash the challenge onto
the board with a VR dude and connect to
it over 0 with screen welcome to the
casino get a currency of 1000 and we
give you the secret key that's what we
want occasionally we will give away a
coupon for free drinks we have guards
walking around looking for cheaters
don't get caught cheating or we will
take our current feedback currently we
got 50 credits and no coupon and the
menu offers to play to cheat go for
drink at the bar request some free money
or restart when we pick play we can
choose between roulette or spin the
wheel if we pick the lead we can enter a
number and in this case I entered the
wrong one the ball landed on 28 and we
lost and we are down one credit if we
spin the wheel it seems like we have a
chance to win the secret key and I guess
that's what the
personally I see just try to over and
over again for hours but consider us our
skin right but we did win a coupon
awesome let's try roulette again nothing
and obviously if we pick cheat we get
kicked out so let's start over
spin the wheel and oops we lost our
credit I only ask for free money we get
another 50 maybe we can just get up to
1000 this way let's request more money
only let us go up to 550 but that's
already pretty awesome so let's go play
in spin the wheel 110 if we keep going
like this we get to the thousand for
sure another coupon maybe let's go for a
drink at the bar we can type in our
drink now quote matter of course we can
hand in the coupon and get the drink so
here we have some string input that's
definitely something to consider
exploring further without a coupon it
seems to only offer our smelko beer so
let's pick the only viable option beer
didn't do much so hmm if we can't get
1,000 by just playing and getting a
lucky the only interesting input so far
seems to be going to the bar if we have
a coupon
so let's write a scrip to explore that
input further so this is the menu
structure to choose a drink we need to
get a coupon so upon starting it up we
read the menu until it's done with
printing it then we select play and we
read until the menu is finished printing
and then we spin the wheel and with a
bit of luck we get a coupon and when we
try now it seems to work fairly well but
we can't have bad luck and lose all
credit we could also see what happens if
we succeed with roulette so let's change
the menu selection to roulette and pick
a number and try that over and over
again until we hit it maybe that can
give us a coupon by only consuming one
credit side spin we don't lose
everything with like the wheel so we
make a loop to try it over and over
again until we read that we have not one
coupon let's run it
and yeah that works so we can now add
user input so we can then play with the
drinks at the bar okay that also works
cool so let's see what happens if we
enter a lot of a's it looks like there's
limited space as you can see the Ecotech
a's are way less than what we entered
also we don't get an arrow so the
students again by this time enter
different payload always when a program
prints out user input you should try out
format strings so let's enter some
percentage eggs and water surprise we
print some numbers this worked and if
you decode those hex values you will see
that it's the input string we entered
the percentage X itself to leak data
with a format string it would be cool to
place an address on our input and then
use percentage s to use that address as
a string location this way we could dump
the whole memory so let's enter some
recognizable characters and see where
they are and it's easy the start of our
string is already where the format
parameters will be so the first X
printed a B in a second X printed CD if
we now use percentage s instead it will
use hex for 1 for 2
a B as an address and print the string
at that location ha awesome
ABCD are already valid string locations
and by sheer luck we already hit a
string in memory the cards are keeping
an eye on you that's awesome so this
definitely works now all we got to do is
create a loop that simply tries to print
as many strings as possible by trying
different addresses so let's create a
loop that simply counts up all the
addresses and just leek strings on
everything
I guess it's best if we do it this way
we open a new connection and then we try
to get a coupon so we spin the roulette
multiple times and if we succeed we
continue to try out an address and then
we repeat also I add some code to really
extract the leaked string and then we
can move the address forward based on
the length we leaked so we don't like
read the same string at different
offsets all the time it's faster this
way oh and we also know that
a B and C D were valid addresses let's
lick strings so let's use that as a
started rest and in case we run out of
credit and didn't get a coupon we just
reset the game again so let's run it
this looks really cool
we leak all those strings awesome but
when I let it run for a bit I never saw
a flag and I decided to maybe it's
better to start from the beginning so I
entered the start address 0 1 0 1
because I didn't want to have null bytes
in the string
so that's the first valid address and
surprisingly there it is
we found it almost immediately awesome
so let's hand in the flag casino soft</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>