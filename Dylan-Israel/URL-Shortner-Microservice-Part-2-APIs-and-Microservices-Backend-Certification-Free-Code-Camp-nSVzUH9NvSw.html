<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>URL Shortner Microservice Part 2: APIs and Microservices Backend Certification Free Code Camp | Coder Coacher - Coaching Coders</title><meta content="URL Shortner Microservice Part 2: APIs and Microservices Backend Certification Free Code Camp - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Dylan-Israel/">Dylan Israel</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>URL Shortner Microservice Part 2: APIs and Microservices Backend Certification Free Code Camp</b></h2><h5 class="post__date">2017-04-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nSVzUH9NvSw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright guys so in the last video we set
up the basics of our index page to build
a front-end of our application we also
went over a little bit of angular and
the front-end part of this is completely
optional we're actually done with the
front-end we're never going to touch it
again and then the backend we set up our
requirements we connected to the front
end of the application and we set up
part of our basic of a get call and then
we made sure everything was working so
the next thing that we want to do is
really move on to the Mongoose side of
things now how do we do that what you
know how do we get started with that if
we want to oh and also what we want to
do is we want to set up a model a model
is basically going to be the structure
of our document that we're going to
create with MongoDB the way that we can
do that is we'll create a variable here
comps we're going to set this equal to
whatever you want to call it in this
case it's going to be a short URL and in
here we're going to require this file
now what's this file it's basically the
location models slash short URL and
we're going to go ahead and create this
file right now and this will be
basically this right here will be the
and let me control C out of here right
now
it doesn't exist so that's why we're
getting hair but what this is going to
be is the structure of our documents so
let's go ahead and create another folder
here so we'll create a new folder folder
we'll call it models and in here we will
have our short URL j/s this will be a jf
sock youment and you'll notice how
there's not a J is long as you're in a
jazz document in es6 the only footage is
if I remember in a note it's either in
here a node
document or a JavaScript document I
forget but I was going to create a new
file it's going to be that short URL is
now what we're basically going to do
here is first we need to require
Mongoose so I'll try for some notes as
we go here is what what this file is
it's going to be the template the
structure the model whatever you want to
call it for our short URL document data
structure next thing we want to do is
you want to require Mongoose which for
for some reason I have a tendency to
type moongoose I could not tell you why
so let's go ahead and require Mongoose
for here as well now what we need to use
for Mongoose is we need to create a
schema a schema is essentially our
structure so we're going to create a
variable here and it's going to be equal
to Mongoose schema this is what we're
creating is our schema I really think of
as the structure of the model
it's a schema and there's no need to
create a primary key because because
Mongoose actually does that for you so
don't worry about that now what we want
to do is we actually want to create our
schema this is going to be our structure
thanks and I call this URL schema and
this is going to be a new schema and
we're going to create our object here
this is going to be the rough way of
what we expect from our structure of our
documents essentially our rows if we
redoing the structure of the tables in a
SQL database or the basically our
imagina JSON this is how we in a perfect
world how we want those JSON to be
formatted we're going to have a key
value here because I called original URL
and what is that going to be it's going
to be a string and then we're going to
have a shorter URL which is going to be
the
it also going to be string and that's
going to be the item that we're going to
be returning and then we're going to
after that you'll see outside of that
object we're going to pass in a time
stamps thing here as well
this is something I thought was pretty
cool where it will when this item is
created time stamp it so that we know
when it was created so this is our
entire document data structure
essentially this is at just two strings
- two strings the last thing that we
need to do is we have to go ahead and
define a model class here and we're
going to set this equal to Mongoose dot
model and we're going to pass in the the
short URL right here this is going to be
the collection essentially the table and
this is the URL schema is going to be
the structure right here so kind of like
the table name and the structure or in
this case the collection and the schema
and then we're going to allow other
things to use that as well so we're
going to module dot exports is equal to
our model class so this is going to
allow us to access this in our app dot J
our node app jas that's our entire
schema for this not super complicated
but if your noona Mongoose like I am not
very intuitive to get going all right so
what do we do next
well the the first thing that we should
probably do before we move on is we
should connect to our database
now one thing to note is that you'll see
we have this short URL and let's
actually bring this up again you'll see
short URL right here this is the name of
the collection however when we actually
when Mongoose creates that collection it
will actually polarize it so we'll add
an S on to it because collections are in
theory going to be plural so we're going
to do Mongoose connect and this is going
to be more Heroku stuff but we're a new
process env dot MongoDB underscore URI
this is basically or let me just
actually finish typing this out
MongoDB colon slash slash and it's our
in our case this is our local version
which is going to be localhost / short
URLs so this is going to basically say
connect to the database here locally or
here on Heroku so if we're not on Heroku
this isn't going to basically have a
value so we're going to go ahead and go
here which will be our local database
all right we're making we're making
we're making progress here guys the next
thing that we should do why we're here
is let's go ahead and actually launch
our MongoDB so wherever your MongoDB go
ahead and launch it and there goes it's
launched and then now that that's
launched go ahead and launch your note
server from my understanding you
typically want to launch your database
before you launch your node server or
everything you may have kind of an issue
so see everything is working here and if
you want to make sure that your Mongo
connection is working fine use this
thing to do is to launch the editor and
type show DBS and you'll see you have
this short URLs database here you may
not have that there I have this here
because I've already put stuff in the
database don't worry about that it's
going to exist once there's something in
it
so how we're going to do this to get
going is we already have part of our
creating a new one set up we have the
value right here but what if the user
puts in something that's incorrect well
we want to just test to make sure that
it matches a regular expression right so
I have this massively long regular
expression that I got off a Stack
Overflow
shout-out to them so uh regex or URL so
I'll leave that up on the screen for a
second so you guys can pause it and copy
it over if you'd like but basically what
this is going to do is it's going to get
our regular our HTTP regular expression
so that we can test our string that we
already have the value of right here now
what we want to do is just have a if
regex savetti I just store this reg X I
actually for some reason this is one of
those things where you go back in your
view your code nearly good but so far
right I said this I said our set our
expression regular expression -
expression here so this is what I
originally did and I'm going to stick to
it because I don't want to follow to it
but we should obviously probably just
rename expression to reg X and never do
that again
but if we run into any issues I want to
make sure I can solve them quickly
without having to see what we did so
what we're going to do is we're in test
our string right here which is URL to
shorten and if it passes cool right now
all we want it to do is return console
dot log actually we wanted to return
works
else and works isn't anything so works
else return fails and we're going to
test that right now on the front end and
if you didn't build the front end all
you got to do is remember this so if we
did this / new flash test so this should
fail okay so we're going to a small
variation to the cone here
I'll actually found a little bug as I
was doing it I assume that this
evaluated true without having to put
equal equal true but it does not so what
we want to do is just want to set this
equal equal to true and I will have a
return statement if we return this well
for when it fails so it's going to test
that real quick so let's say we go to
test fix comm we should expect it to
return failed however if we go back to
WH T to be there ww6 comm whatever you
want to do it should go ahead and return
that back because that's in the correct
format so our regular expression is
working just fine sorry put a little bit
of hiccups with this now moving forward
what we want to do is we now want to add
to the database before we do that though
let's go ahead and create our short URL
the short URL is going to be pretty
pretty straightforward this is going to
basically just be a random number now I
just go up to I create a variable called
and we only need to create it in this
true statement because at this point we
know the long URL passes the statement
so where is that this math dot floor
because we want it to be a whole number
and then we want a random number and I
thought random times you know
and in a hundred thousand and there's
probably better ways I turn this into a
string by the way to string so we're
creating basically a flat a a whole
number between zero and a hundred
thousand that's what we're doing right
now and we're setting it to a string and
that needs to be complex and the next
thing we have to do is now we have to
remember we created that sort of data
model called short URL we're going
create a variable here called data now
this is going to be a new short URL
think of it as an object so that's
basically what we're creating here and
in here we're going to have these need
to match the name of what you have set
up in your lips in your string so
remember we have our ritual URL which is
what we're passing in and we called it
URL to shorten so we'll just go ahead
and pass that in there URL to shorten
probably the name that just original URL
and saved yourself a little bit of a
headache and then we're going to have
shorter URL let make sure that's what I
called it that called shorter URL I did
all right
shorter URL and this is going to be just
equal to the random number that we have
that we had right here so this will be
equal to our short so now that we've
created our object our short URL or
rather we've we've created a potential
document it's probably a better way of
putting it it has we haven't done
anything with it yet we now need to save
it to the database and the way that we
do that is we have our object here and
we call just we could basically just
call save on it save and then we want to
pass in a little air callback function
and we're basically say if there is an
air so if there we want to return to
rest offset and now in all theory there
shouldn't be unless your database is
down or something like that because
we've we've done some validation here
and air saving to database and then so
if there's an air do that so else is
just going to do what it does so you
could just in theory called data's out
safe but we're basically setting up a
fallback here just make sure that
there's no issues and then we want to go
ahead and just return our data object to
see it you want to see that everything's
working and before we move forward let's
go ahead and do that so refresh this
close that and we'll go to something
like www.facebook.com get short URL and
you'll see now the way that we know it's
working it's not just returning a random
item is it's actually generated this
underscore ID or the random primary key
we have our random whole number that
we've created as well oh my god think I
thought for a second I forgot to turn
record back on it's about to
throw my computer out the window by are
good but we also have this data this
whole data object here and I don't think
I want that now that I'm looking at it
so how do we fix that I don't remember
doing that
I wonder if I set up something
incorrectly my other project did not do
that we'll see if that comes to bite us
in the ass shortly so I you know what I
don't think I don't think it will I
think I think I remember why
if a
one second guys I'm looking I'm looking
at the code here alright so we have our
Sui save it everything goes well then we
make a return now if it fails the way I
originally set it up was I just returned
a new data object in here
I returned data again but Eirene Sanchi
8 what data is of our data is equal to a
new short URL and then this doesn't
actually ever get added to the database
but uh it's just kind of a way of
showing the user what failed and will
pass in URL shortened and then will also
pass in for shorter URL and the valid
you save it and right here we return
data all right now
let's save it and let's make sure that
our failure is working as well I'll have
tunnel tests 99 so this should fail and
we should get invalid you are oh you
know what it doesn't actually get there
yes 99 doesn't get there so we miss name
the variable it is a matter uh we'll
just throw something in here like URL to
shorten doesn't does not match don't
worry about that later
all right cool um match there's a
standard format all right but we know
that this is working this is hitting
it's returning something now the next
thing we have to do is we have to
redirect the user through a different
get call that that happens when they
have a you are they have a short code
like this it's going to go and redirect
them to their original URL so let's go
ahead and get started with that all
right so let's get started I did find
where my where I was a little confused
where we passing another object in our
read saw JSON response we I accidentally
wrapped our data here and a object so
that's why we're getting that additional
brackets but so this this last little
bit here of the video if you stuck with
me thus far
thank you I apologize if I've been
making little hiccups along the way it's
just part of doing these things live but
the last thing that we're going to be
doing is we're going to create another
get call that will actually redirect us
finally so what we're going to do we're
going to do the get call with the short
URL that we have and then we're going to
take that we're going to query the
database our MongoDB database using
Mongoose to see hey does anything have
this short URL and if it does redirect
us to the original you are
well and if it doesn't too bad so sad
yeah so I actually didn't put anything
there if it doesn't if it doesn't it
probably should return you to index on
HTML that'd probably be the better way
of going about it and I think about it
but you guys can cut that on your own
that's not - that's not too hard so our
common ear query database and forward
see the original URL alright so we know
how to do a get cult app bucket pass in
the parameter in this case is a /url -
forward that's what I call it
and then we're going to have our
callback function that takes in our
requests it takes in our response it
takes in the next all right so let's
store our URL so it's all of our
remember our es6 here our short URL and
we're going to set this equal to R X dot
params dot URL - forward excusa we don't
need to actually since I didn't name it
the same thing and I want to follow my
example and this is a something I will
change in my future code this will be
the second thing that I've seen that
I've done sort of bad habits which is
one of the benefits of doing videos is
you find out where you are making
mistakes along your code as well alright
so we store the value in this shorter
URL and what we want to do is we want to
call this function called find one now
find one is a built-in mung
Hue's function that will allow us to
pass in an object and see if it exists
in the database so we're going to call
now we're going to call our database
short URL don't get it confused as this
shorter URL which is bad naming
convention short URL all the way up top
here is our Mongoose collection our
structure the whole deal and we're
saying find one value of this collection
that takes in an object and what is it
that we're looking to find we want to
check the key value called shorter URL
which is if you go into here this right
here we're saying check this value check
this property and compare it with this
one right here and again another bad
syntax is I could probably have just not
done this and kept as es6 standards and
have a callback function here that takes
in two things one is an error and the
second one is the data the return data
right so first we want to go ahead and
do a quick error message if air returned
read send air reading database so if
there's an air do that if there is not
an air what we can do is redirect it so
but one issue I had was that when
redirected so the way that the express
redirect works is there's a function
Express has that we can have our
response it's restaurant redirect go to
a certain URL
however by default it assumes that if
it's done at HTTP with a colon slash
slash or HTTP colon slash slash or HTTP
colon slash slash
um URL so let's say we put in wwo URL
360 comma it's actually going to think
it's a folder structure that matches
that so what we need to do is we have to
check to see if it has it and then we
have to change the string that we're
going to redirect to so that's what
we're going to do right now and this is
all stuff that you would have seen you
work through this horrible thing so
we're gonna do regex is that it is
actually one of the most fun projects
I've done in a while so again I am awful
with regular expressions and things like
that I just google them but this is
basically going to check if it's HTTP or
HTTPS so if I create a variable here as
well called strings check we set this
equal to data and where are we getting
this the data that's in the database
right this is our return data and this
find one only finds one of them so the
first one that it finds that it matches
that it returns that that Colet that it
returns that document which is part of
our short URL collection now we want to
say hey check the original URL this is
the string we wanna check and we're
going to say if our you test so if it
matches SCR to check go ahead and rest
that redirect and then we put in a
basically a status code here and then
we're going to redirect to data dot
original URL because we don't need to do
anything with it else if it doesn't we
want to redirect but we have to
concatenate the string with HTTP and I
suppose you get in some trouble here if
they don't have an HDTV site but I think
by default everyone still has an HTTP
site although correct me in the comments
down below if I'm wrong original
URL it will redirect us and at this
point assuming this is a big assumption
that we did everything correctly let's
go ahead and relaunch our server check
to make sure everything is running it is
or that's our IDE but it looks like
everything's running here
cool this everything is working let's
jump back into our application test
everything out and we'll go to something
like ww1 last shout-out to the homies
the best J s comm we're going to get a
short URL and here we have this right
here so it created our database entry
and now if we did everything correctly
and we go there it should redirect us to
the best J s com and if you're wondering
how someone who started MongoDB Mongoose
and noted Express three weeks ago was
able to do this project it was because
of Stoudamire and his tutoring that he
was able to provide me so shout out to
him man this was this this project took
me about 12 hours this weekend from
start to finish with bugs and I did some
of it on live streams but that is the
URL shortener microservice from free
code camp dot-com part of their API and
micro service I had a great time doing
it I I hope I did my best to kind of
explain it as best as I could sorry
about the little hiccups along the way
but as always guys if if you not already
a member of our Facebook group code tech
and caffeine it's not really so much for
the channel as it is a place for us all
to share resources that I've started I
hope I hope you join it just the link is
in the description and if you want to
support me you can at patreon.com slash
coding to our o 360 I hope this helped
clear up any issues with MongoDB
mongoose
I really like it I like the no SQL
databases it's very I enjoy it I enjoy
it much more than I enjoy relational
databases but I'm just in the beginning
and technologies have a change a
tendency to lure you in being easy and
then our soup
hard to who knows but I'm really
enjoying it thanks for watching guys
I'll see you in the next video bye hey
guys thanks for watching the video if
you're interested in coding bootcamp
check out dev Mountain com where housing
is included in your price of tuition and
don't forget to like comment subscribe
and share and support me on patreon I'll
see you guys in the next video thanks
for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>