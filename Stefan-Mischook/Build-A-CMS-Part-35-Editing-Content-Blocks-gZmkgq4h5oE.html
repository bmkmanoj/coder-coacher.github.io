<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A CMS Part 35 - Editing Content Blocks | Coder Coacher - Coaching Coders</title><meta content="Build A CMS Part 35 - Editing Content Blocks - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Stefan-Mischook/">Stefan Mischook</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A CMS Part 35 - Editing Content Blocks</b></h2><h5 class="post__date">2011-05-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gZmkgq4h5oE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to part 35 in this video it's
time to move on to building up
functionality that actually allows us to
edit these content areas in the last
video we covered how to get the content
from the database and create it but now
we want to actually connect these
content areas and place the contents
within this content field and be able to
edit them so the first change i'm going
to make is I want to update the content
within these text areas to reflect the
proper content that appears in the
database so I'm going to open up edit
dot PHP and rather than saying content
here I'm going to use a function that we
created in the last video and to do that
it's going to be FP CMS load under
square block and it'll pass in the ID
variable so i'll save that go back and
preview you'll notice these fields are
now blank and just to test it slightly
more thoroughly if you open up firefox
and take a look at PHP my admin i'm
going to update one of the fields so
i'll update the header field i'm going
to add some test content in and I go
back to Kota let me refresh the page and
make sure this shows up properly so
you'll notice this does now show up in
the content block so the next step in
the process is to update our view and we
need to update this Ajax functionality
here to make sure that when the form
submits we redirect it to the correct
page and process it properly so the
first step here is to change login we
need to change it to edit instead
because that's the idea of our form
and we need to make some changes to the
variables here that we are pulling from
this form and the first thing I'm going
to do is I'm going to add a bar ID and
within that I'm going to include some
PHP and I can echo out this get data
excuse me parentheses there and we want
to display the block ID so that is one
part and the next thing is we want to go
ahead and rather than using VAR username
want to set very type and i'm going to
pass in the type ID which refers to our
hidden field here which has the block
type and then finally the for our
content it's going to refer to the item
with the ID of field and now it's just a
matter of changing the data string to
properly reflect these three variables
so i'm going to delete this and we're
going to use ID equals plus ID and field
equals plus content
and type equals plus the type then down
here within the Ajax function the type
is fine URL needs to be updated so that
instead is going to go to app CMS edit
dot PHP and everything else here looks
fine let me save this file let me make
one other change to edit dot PHP this
first if block is supposed to check if
the form has been submitted and if so
i'm just going to echo out some test
content here just so we can test this
let's go back to test i'm going to
refresh the page open up one of these
fields and our color box isn't opening
so let me just double check things
usually what that means is there's a
javascript error of some sort and for
Kota I like using the javascript alert
they says there's a post error so it's
probably a missing missing semicolon or
similar or quote here we go we're
missing a plus here
that's much better so we have this
popping up properly hit submit and we do
get the form submitted successfully
message so now it's going to be a matter
of editing this area here to properly
process this form the first step in
doing that is to get the data so I'm
going to create a temporary ID variable
and I'm going to get the ID the post ID
but first I'm going to clean it so FP
CMS clean block ID
like that and then I'm also going to get
the type so type equals and just to
properly escape that data and use HTML
entities and I'm going to escape post
type and as I've done in the past use
the nth quotes constant and finally the
content variable here and that will be
post content and then the next thing
we're going to use a function that we
haven't created yet but I will in a
minute so FP CMS I'm going to use an
update block function and I'm going to
pass in the ID and the content
and finally we're going to close
lightbox or not lightbox color box is
what we're using and refresh the page
and to do that like we did with login
dot PHP and use FP template and we're
going to load a specific view just for
this and that's within CMS views p
underscore saving PHP so I guess the
next thing I want to do is I'll focus on
the update block function and then we'll
create the V underscore saving that PHP
view as the last thing we do in this
video so the update block function will
go within our CMS object I'll put it
down here at the bottom
and this is a pretty simple function
sort of like the create block function
above so we're going to be using
prepared statements again so stmt equals
this FP access the database object and
we'll prepare our statement we're going
to be using update content and we'll be
setting content equals ? where ID equals
? and we want to bind the parameters
within that SQL statement so use the
bind program function and both of these
variables are strings so we'll use two
S's the comma and then we'll pass in
content and ID and then we'll execute
this statement
and close a statement like so and let me
go back to my edit PHP so that takes
care of this line and the last change
that I want to do is create the V under
square saving that PHP and that will
exist within views this file is
basically just a copy of V underscore
logging in PHP from within the core
folder and views so I'm going to copy
this code and I'm going to paste it in
place and we just need to make a couple
changes let's go ahead and you need the
resize we need to close want to remove
these two lines and rather than using
window dot location equals page because
the page locational a page variable no
longer exists I'm going to do window
that location dot reload that'll take
care of the page refresh and in case I
haven't mentioned it already the page
refresh is important because we want to
make sure that any edits to a Content
show up within the page without the
page.reload it's quite possible that the
database would be updated but those
changes wouldn't show in place on the
page and it might confuse users so the
last change here is that I need to make
is I want to go ahead and change the
header make that edit content block
and I'm going to go ahead and just rip
just going to duplicate the header here
so everything inside the h1 tag put that
in place and because we're using get
data I want to make sure we call set
data as well so back to edit dot PHP up
here right at the top I'm going to add
this and I guess we need to make sure it
appears below this ID variable like so
so that'll give us access to block ID
with envy underscore saving within our
view so it displays properly and instead
of logging in I'll do save and content
block there we go so that file is saved
let's do a quick test just close this
excuse me
that obviously didn't work but it seemed
like our color box appeared in closed
correctly so I'm going to edit it a dot
PHP let's remove the line here where we
load our view try this again and see if
there any error messages that appear oh
and you'll notice we do get one
undefined index content edit line 12
let's take a quick glance at this and
we're looking for post content and let's
check our view we're passing in ID ah
and we're passing in field not content
so change this to field let's remove the
editing and test this one more time much
better so now content is being saved and
you'll notice it's being updated it
updates existing blocks as well</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>