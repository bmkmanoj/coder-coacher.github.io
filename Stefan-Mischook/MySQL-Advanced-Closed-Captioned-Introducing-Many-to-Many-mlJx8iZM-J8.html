<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MySQL Advanced Closed Captioned - Introducing Many to Many | Coder Coacher - Coaching Coders</title><meta content="MySQL Advanced Closed Captioned - Introducing Many to Many - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Stefan-Mischook/">Stefan Mischook</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MySQL Advanced Closed Captioned - Introducing Many to Many</b></h2><h5 class="post__date">2011-05-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/mlJx8iZM-J8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi there this is John leben sold for
killer PHP calm and in this video on
advanced MySQL usage I'm going to be
looking at many to many relationships so
in the last video we created a table
called category and a table called
author and a table called post and we
had a one-to-many between category and
post and a one-to-many between author
and post in other words there could be
one author that would offer many posts
and there could be a category and the
category would contain many posts so now
we're going to switch things up a little
bit and we're going to create another
table that will act as a join table or a
cross table in order to facilitate a
many-to-many relationship between
category and post so I'm going to start
us off by adding a drop table by the way
its case insensitive but drop table if
exists on the top here and this is my my
script by the way and it's just going to
be a table called post category in other
words we're going to be joining the post
with the category now other
modifications that we need we're going
to have to create of course this table
and we're also going to actually get rid
of the category ID from our post because
we're actually not going to need it
anymore and I'll explain why in just a
minute so I'm going to start by deleting
that and I'm also going to delete the
foreign key reference or actually I'm
just going to cut it so if you look now
basically I've gotten rid of any
relationship between the category table
and the post table the next step is to
of course create this table that will
join the two so in this case I'm going
to create a table called post category
and it will have a ID
which will be an integer primary key
autoincrement and it will also have a
post ID which will be an integer and it
will have a category ID which will be an
integer and then we are going to have a
foreign key on category ID that
references the category table so if we
just look at this for a second here we
have the category ID and then we have on
delete no action so that should be good
there so we've got a foreign key here
but we also want to have another foreign
key and this foreign key is going to be
for post ID so I'm just going to copy
this paste it and then I'm going to
close this bracket and then specify the
engine as nodb and here instead of it
being a foreign key on category ID it's
going to be post ID and the it's going
to reference the post ID so there we go
so now we've got a category table a
author table a post category table and a
post table so if I also this select
statement down here is no longer going
to work for us because we won't be able
to just do a very simple left join on
category we can still do the left joint
on author but we won't be able to do the
left joint on category anymore that's
going to require a little bit more work
so the last little thing I need to do is
actually get rid of the category IDs
from my post here
so I'll just delete that and that and
that and make sure that this all looks
ok and there we go and in some ways our
post table has actually gotten a lot
simpler because now we only have one
foreign key constraint there and we've
moved all the count of the foreign key
constraints constraints to the post
category table so we've decoupled the
two essentially so if I select all this
copy it and then paste it into my
terminal I'm getting some error down the
line let's see this looks okay can't
create table post category error number
150 it looks like there's something
wrong here so if I say create table post
category maybe I'm missing something
here let's just go back for a second I
yes so in order to be able to do this
again order matters so I can't just put
the post category anywhere I mean I need
to insert this after I've got the post
table right because it's got foreign key
constraints so actually I'll just put it
at the bottom after the insert posts hit
save again copy it paste again and it
looks good except for the error on the
Select statement down here which can
easily be mitigated or remedied rather
good ok so if I do a select star if I
first do show tables will see that we
now have four tables instead of three if
I do a select star from author you can
see that i have my list of authors and i
have categories and i have posts
with corresponding author IDs but no
longer a category ID and if I describe
the post category table then I can see
that it's got a post ID and a category
ID now in order for this to properly
function it actually requires Orin keys
and here is our first example of that
one too many are that many too many
rather so down here what I'm going to do
is just start with linking politics and
international as two separate categories
for the first posting so to do that it's
actually very simple I just say insert
into post category post ID category ID
values and the first one is going to be
the post ID so it's the first post and
the category that I want to insert is
going to be politics so it's going to be
11 and then if I want to link it to
international at the top here then it's
going to be 12 and so I'm also going to
use this double dash which is a comment
so link post with politics and this is
going to link the posts with
international
so select all copy paste it in now
things get a lot more interesting if you
think about it we can't actually express
this in one particular view we have to
do some special left joins and when we
do those left joins our many to many
relationship is actually going to change
we can't just simply list out all the
categories what we can we can list out
all the categories that a particular
post has or we can list out any posts
that match a subset of those categories
or requires all of those categories so
we're going to be creating views in the
next video where we actually look at all
these variations but for now let's just
try and do a normal left join so I'm
going to start by actually saying select
star from post category notice we're
starting with the post category table
now and I'm just going to call it p c
left join post p on PC post ID equals
PID so if I left join on one hand then
I'm getting the political postings
because if I do a select star from
category post category then I'll have
the post ID in the category ID now if I
keep going I can actually do another
left join so I'm joining on one side of
the cross table to the posts and on the
other side of the cross table to the
categories so I can do a left join on
category C on PC category ID equals CID
hit enter and so now on one hand I'm
getting the first I get the first table
then I get it glued to the content of
the posts table and then I get that
glued to the author's table now why are
we only getting two posts the reason for
that is that in our post category table
we're only referring to that one post
and we're actually getting duplicates
right now which is a little confusing so
you can see that there isn't a
two-dimensional way of displaying this
kind of data if I wanted to display all
of the posts that had politics and
international then it would be a little
different it would be something closer
to saying okay well I would start by
saying ok select star from are actually
select ID from category C where C dot
name equals politics or C dot name
equals international so i would start
there and i would get politics i
misspelled that so i would get the two
ids right so then I would have to take
those two IDs and I would have to find I
would have to do something like select
star select post ID where the category
ID is one or two so i would have to do a
joint onto itself which is a little
confusing but in the next video we're
going to actually look at this where
we're basically grouping and selecting
and making sure that we can do these
more complex queries but just so that
you know when you're dealing with one
too many or not with one too many but
when you're dealing with many too many
you're not going to be able to easily
display the data without getting some
duplicates lying around so in this case
I'm getting you know a duplicate title
for political posting because I've got
to category names for it if I wanted to
get all of the categories for political
posting then I would do something where
I would just left join on one side so I
would probably start by setting select
star from post and I would get all the
posts and then I'd say ok there's a
political posting with an ID of one and
then from there i would say ok select
star from category where category where
ID is equal to and then it would be
actually it'll be first I'm sorry I'm
working through this in my head ok first
we would have to do select star from
post category where category equals one
right now we're actually looking for the
category IDs right so we would be select
category ID from post category where
post ID equals one and this will give us
the category IDs associated with the
post ID number one then we would do
something with the in parameter so then
i would say ok select select categories
select star from category where ID in
and then i would actually take this
select statement and paste it inside
here if that makes any sense so
basically what we're doing is we're
saying okay I want you to select all the
categories where the ID is in another
select statement which is the category
ID from post category where the post ID
is equal to one so I'm just going to
copy this into my little script
txt file here for a second so that we
can work on this query together so
here's the beginning of it but if I
wanted to make this more dynamic I
actually could I could say okay well
instead of saying select category ID
from post category where post ID is
equal to one I could say okay we'll
select star from select post ID where
category where select post ID from post
where name equals or where title equals
political posting and that would be my
first where clause and then I could take
that and stick it in here so then I can
have another clause in here and say
where post ID in select post ID post
where title equals political posting so
now I've got two nested queries which
now things start starting to get a
little more interesting where we're
using one query to drive another query
to dry in another query and you can only
really do this with a relational
database when you've got all your data
in separate areas and so now I've got
something that's very generic where I
can actually pick up any post I say
Olympics and I say where title like
which is a way of saying you know what I
won't I only want you to compare some of
it I can say something like okay well
get me all the categories for a post
where the title is like Olympics and
then I'm going to get something
different so i just noticed here that
actually i don't want to just select
from olympics i want to select the
post dot ID from post where title like
olympics so if i do a search here and i
run this query again i'm going to get an
ID of six which is fine but then you'll
notice that i don't have any categories
in my post category with this particular
query in place so if i wanted to i could
add to my olympics post which happens to
be 1 2 3 4 5 6 which happens to be post
ID 6 I could add the category sports
which is five so if i wanted to do that
it would be I would be inserting into
post category the post ID of 6 and the
category of five if I do that and then I
run this again I'm going to have that
which is a post ID of six if I paste
this again then I can see that when i
run this nested query i'm actually going
to get the category name so I first you
know at first glance this actually looks
quite a bit more complicated and it is
but the advantage is that you can go
both ways so just like I can have an
Olympic story that has multiple
categories or a political posting that
has multiple categories a category can
also have multiple posts so if I want to
do that it's just a matter of reversing
this query and then going from the other
end and doing the multiple select
statements backwards or simply doing a
left join if we were to do this using a
left join it would be a little simpler
and you could also see sort of how this
all works so if i do a select star from
post category p c left join post p on PC
post ID equal PID
oops select fra star from post category
p c left join post p on PC a real post
underscored ID then I would have the
titles and then I would have the
category IDs here and if I wanted to get
the corresponding category IDs then I
could just grab that as well with
another left join I can also start from
the posts and then do a left join
outwards so I could do select star from
post p left join where I join to post
category pc on p ID equals pc dot post
under square ID this is like a rite join
right so now i'm going to have political
postings more politics international
news and so on and so forth and then i
can see that oh I've got actually to
post ID or to category IDs associated
with this particular political posting
so an oil the only way to really kind of
get around this is to actually have
multiple queries that will represent
your many to many relationship properly
if this is still a little obtuse and
you're having some trouble understanding
the concept don't worry too much we're
going to be doing a lot more with many
too many's in the next video I'm dumb up
and sold and thanks for listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>