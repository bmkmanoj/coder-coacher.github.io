<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MySQL Advanced Closed Captioned - Joins with Constraints | Coder Coacher - Coaching Coders</title><meta content="MySQL Advanced Closed Captioned - Joins with Constraints - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Stefan-Mischook/">Stefan Mischook</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MySQL Advanced Closed Captioned - Joins with Constraints</b></h2><h5 class="post__date">2011-05-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/i8S3MxU2n1o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi there I'm John leben sold for killer
PHP and today what I'm going to be
talking about is left joins and right
joins or they're also known as inner
joins and outer joins and we're going to
be building off of an example from the
first video where we created a category
table and a post table so we're just
going to I'm just going to go back to my
wonderful script that was written in the
last video and here you can see that
we've basically got code to create a
category table and we've got code to
create a post table and then we've just
got a bunch of insertions into the
category table and then a bunch of
insertions into the post table so far so
good so i just select all of this and i
paste it in then i should be able to do
a very simple join by doing something
like select star from post p left join
category c on p dot category ID equals c
ID which was the last thing we did in
the last video so if i hit enter as i
mentioned before you're going to get an
ID and you're going to get a category ID
and so on and so forth now this isn't
exactly this the best way of doing a
select statement because you'll notice
that now we've got these two ID fields
which can be very misleading if you were
to run this query in PHP and then you
wanted to grab everything from the ID
field PHP might actually get confused as
to which ID column you're talking about
so we've got one ID column on the left
which is going for 126 and the other one
on the right which is basically the join
on categories so one way of mitigating
that is to actually be a little more
specific in our in our joints we can do
something like select p title comma P
content comma C name from
post p left join category c on p dot
category underscore ID so you'll notice
that this is exactly the same thing that
we just did except that now instead of
this star we're actually replacing that
by being a little more selective about
the columns that we're asking for the
only part of this select query that's
changed is the star the star has been
replaced by title content and category
name and so now I'm getting something a
little different oh whoops I forgot the
on category underscore ID is equal to
CID there we go sorry about that so here
now I'm getting something that looks a
little more useful to my to my PHP
application the advantage of something
like this is that lets say i want to
change politics and I want it to be
uppercase now I only need to make a
change to one table in one place so if I
do an update statement and I say update
update category set name equals politics
where name equals politics and then I
were to rerun this query then you'd
notice that both of these categories
automatically changed and that's really
the power of a relational database is
that you can change the way that the
database is relating information and
making sure that at the same time you
only have one copy of every single bit
of data and by ensuring the only f1 copy
you're going to make sure that there's a
high level of integrity to your data if
somebody changes something then
everything else is going to change as
opposed to you know if you had an
employee's table and you had you know if
you had like an employee with an HR
department and then you had a project
manager who also had their own lino
listing of the employee and one person
decided to change the salary of that
person and the other /
didn't get wind of it then you would
have the scenario where you'd have the
same data but it would actually be
different in two different places and
relational databases mitigate those
problems tremendously through building
these kind of relationships through
primary and foreign keys which is what
we're doing so that is a left join let's
go back to the first left join that we
did which was this one right here now we
can also do a right join which is
actually the opposite so if I do a
select star from post p because you
might see this the right join are also
known as the outer join on category c on
p category under square ID equals c ID
and we're going to get something a
little different in that now we're going
to get null values and the reason is is
that we're joining the category table to
the post table and we end up with
something like this where we've got all
the categories including the categories
that aren't even being used if we wanted
to take this a step further and we were
absolutely adamant about doing a right
join then we would want to filter that
out and we could do that just by saying
where PID in other words where the post
ID is not null and this would of course
clean it up now I want to illustrate one
more kind of caveat in all of this what
if we have a post that doesn't have a
category it's a good question so in my
script over here I'm going to just do
that and see what happens so I'm going
to create another post here and the
title of this post is going to be in our
own favorite sandwich recipes and it
doesn't really belong anywhere well
probably belongs in other but just to
illustrate my point I'm going to set
this to null so we're not going to have
a category ID select all copy paste
and we're good to go again if I say
select star from post I'm going to see
that i have my category IDs and then
I've got my favorite sandwich recipes
that are unfortunately not willing to be
represented here so I think it's a good
time now to actually start remembering
these join statements in my script I'll
go back to the one we just did so select
star from post p left join category c on
p category underscore ID equals cid see
it becomes like a second language and
i'm just going to paste this at the
bottom here so we don't forget about it
so here what we're getting is the
opposite problem where we've got a
category or we've got a post but the
post doesn't have a category now
depending on the kind of business rules
that you have this might or might not be
a problem and this is really the
flexibility that the database offers you
you know if it's not relevant to a
particular post then you might just want
to say where is not null for the
category ID much like what we did in the
last bit and the last example with the
right joint so that's a quick wrap-up of
left and right joints now if I want to
take this a step further I want to talk
about constraints and to show you what i
mean by constraints i'm going to create
a new post record except this one is not
going to fit our typical mold we're
going to have a title of a post called
poorly selected category ID and it's
going to have a post ID or a category ID
of 14 i'm going to select all and i'm
just going to paste it in so now we have
a different problem where I just did a a
join and my join had a category idea 14
but then my database didn't actually
know what to join it with
and this is a very common problem when
you're dealing with relationships if you
don't add constraints and a constraint
basically means that you're telling the
database wait a minute I don't want you
to let me put in any number into my
category ID table anymore or my category
ID field anymore I want you to force me
to make sure that that record exists
somewhere and doing a foreign key
constraint or constraint at all is
actually not that difficult in mysql
you'll notice however that once you do
have anomalies in your in your database
like the one that we have right now if i
try and alter my table if i try an altar
table post by adding a foreign key
constraint on the category ID which
references the categories ID field which
is what i want to do here basically i'm
saying hey there is a relationship
between category ID in my post table and
the ID in the category table if I try
and do this it's going to get really mad
at me and it's going to say no no no no
no cannot add up or update a child row
and it's going to say that the foreign
key constraint fails so we need to solve
all of these data integrity issues
before we start introducing foreign key
constraints I mean in our case right now
it's really easy right we just have to
go and we say update set up date post
set category ID equals null where
category ID equals 14 and then if I try
and realtor the table everything is
going to be fine now if I go back and I
try and take something where let's say
the category if the ID is is 8 which in
this case it is for poorly selected
category ID and I try and set
the category query ID to 14 now it's
actually going to protect me this is a
protection I mean this is basically
saying look I can't do a join on an ID
that doesn't exist so now if I go back
to my left join at least I'm not going
to get a weird anomaly where my category
ID is one thing and then the category
the actual category table doesn't
actually have that content anymore which
leads us to another problem and that's
cascading so when we do set up a foreign
key constraint there's another part of
this which is what do we do when
something is deleted in one of the
tables and the other table is dependent
upon it so like for example if I have
two postings in my post table that are
related to the politics column then if i
delete the politics category what do we
do do we delete the two political
postings or do we just set the category
ID to null and this is a really
interesting problem as well and luckily
mysql can actually fix and solve this
problem too so in my alter table post ad
foreign key categoryid references
category ID i can actually specify what
happens in the event of a deletion so i
can say on delete and on the default is
no action but i can also for example
have it delete a record so i can say on
delete cascade and what this will do is
it'll basically cascade the deletions
down to any relevant tables that are
dependent upon the category so now if I
say delete from category where name
equals politics
and it'll delete one row there but now
if I try and do my join here you'll
notice that it's also deleted my
political postings which is actually
exactly what we want and if I say select
star from post then they're actually
gone now so this is an example of on
delete cascading but we can also say on
delete mental action which is the
default behavior i believe so if i say
on delete no action actually let's start
back at the top here so let's we've got
our beautiful database and i'm going to
set this to null save so we've pasted
this all in and then i'm going to alter
my table post by adding a foreign key
for category ID which references
category ID and on delete no action and
it's saying that i can't do that for
some reason alter table post ad foreign
key category ID references category ID
on delete no action and it says that the
constraint fails let's just see why one
two three four five that looks fine
select star from category 12 ah we're
missing the first column which is the
category if i try and drop the table
category it's actually going to have to
be dropped first before i can drop the
table post and that's what happens so my
script failed now if i run it again and
I do select star from category
I'll have one two three four five six
select star from post and that looks
okay and now let's try altering our
table with the foreign key constraint
okay good so we can do that and then I
can add on delete no action hit enter
perfect everything seems to be working
now if I decide again I want to delete
from category where name equals politics
who needs them then it's going to say at
you can't do it anymore because if you
delete politics then it's basically
going to create an inconsistency or an
anomaly in your database which is
actually exactly what we want so this is
just an example of some of the ways that
you can deal with constraints and how
constraints can actually help you make
sure that your database is responding
properly another way of handling this is
actually to set things to null so
instead of on delete no action you could
do on delete set null and then if I try
and delete the category with the name of
politics it's going to let me this time
except that if I do a select star from
post again I'm now going to get the null
category IDs which is very important so
I hope this was helpful in the next
video we're going to start looking at
one too many a little more in depth and
we're also going to modify our little
table script to include an author's
table and also to include the foreign
keys right off the bat I'm John leben
sold thanks for listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>