<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JavaScript Speech Recognition #JavaScript30 20/30 | Coder Coacher - Coaching Coders</title><meta content="JavaScript Speech Recognition #JavaScript30 20/30 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Wes-Bos/">Wes Bos</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>JavaScript Speech Recognition #JavaScript30 20/30</b></h2><h5 class="post__date">2017-09-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0mJC0A72Fnw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">today we are going to learn all about
speech recognition in the browser well
it's not perfect it's actually really
impressive that you can do this without
any libraries or external api's just do
it straight in the browser so let's open
up our index - start and Phyllis open
all right I'm just gonna keep the sucker
running while I explain what we got
going on it's some hilarious results
here so we've got speech recognition
it's a global variable that lives in the
browser and that lives on top of the
window now in Chrome it lives a WebKit
speech recognition and currently it's
only all that's only available in
Firefox so the right here what we're
doing is we're just setting it to be
speech recognition even if it is WebKit
speech recognition then what we need to
do is go ahead and create a new instance
of speech recognition guys still go on
yes so we will say Const recognition
equals new speech recognition and then
we need to take that recognition
variable and set something called the
interim results and that has to be true
and that's what that's going to do is as
you are speaking you can see right here
as I'm speaking it's sort of populating
it and if you don't do that you need to
stop speaking before it will give you
anything that's a bit frustrating so we
want to be able to see what we're saying
as we are speaking so we've got our
interim results here then what we need
to do is create a paragraph and if I
inspect this right here you'll see
what's happening is that I'm updating at
the last paragraph in here and then when
I stop speaking it creates a new
paragraph as if we were saying a new
sentence and then when I stop speaking
again it's going to create a new
paragraph and the browser is gonna tell
us when it's finished processing what
I'm the
this is the best one ever all right so
we've got that recognition we need to
create a paragraph so let's say let P
equals and I'll tell you why I'm using
let there in just a second
we'll say document dot create element
and that's going to be a paragraph and
then we also need to get this words
right here div with a class of words so
we say Const words equals document query
selector dot words and then we'll take
that words and we'll append the child B
which is going to be our first one
because we want to put it in the Dom
just as we are working with it next this
works just the same as listening for
clicks so we take our recognition and we
add an event listener but we don't
listen for click but we listen for a
result and when the result comes back
we're going to get an event which let's
just let's just take a look at what that
actual event gives us here console.log e
so give that a save now you do have to
run this through a server just like we
did with the webcam you can't just run
it on a file it has to be localhost or
something like that so take your index
file and run it through some sort of
server if you're not sure I've created a
quick where is it here I've created a
quick little server for you here in the
speech detection folder all you need to
do is type NPM install and then when
that's installed you type NPM start and
what that will do is it's going to open
up a little server for you and then we
open up the index - start now that will
probably pop open a little dialog box
that will say can this access your
microphone and you'll say yes or no but
as we start speaking actually we don't
see anything just yet and that's because
we haven't started it take your
recognition and call recognition don't
start because you don't want to
necessarily run it on page load because
you might want to prompt the users that
hey we're gonna ask for your microphone
don't turn it down otherwise we won't be
able to see this so there we go now it
should be running so we see our
paragraph tag being put into here we've
started it
we have an ad Oh add eventlistener
result singular not results now when you
speak into the microphone you should be
seeing something popping up in your
console now when you speak into the
microphone you should be seeing some
speech recognition events pop up into
your console now when you speak into
your microphone you should see some
speech recognition event results just
flooding into your console now if you
don't see anything make sure that you
don't have like the answer or anything
else that's jacking your microphone up
open in another tab that's something I
spent way too much time debugging and
you just have to realize like sometimes
the microphone would be used on another
tab so we have this event and let's just
find a random one right here open up
that event and go to the results inside
of the results let's just console a dot
results that is going to be a list of
results and I say list because it's not
an array it looks like an array but if
you open up the prototype and see what's
in there you'll see that there is no map
or for each or anything like that and
that's gonna be a bit of an issue for us
so we can convert that to an array or
use es6 for of to iterate over it so
here we've got a list and if you open
each of those up you'll see there's
another thing inside of there this data
is so nested opened it up once more time
and then you see that is going to be and
then the second one will say open it up
again jumping around that is going to be
a list of and it tells you what the
person said and then as well as its
confidence like this one is 89 percent
confidence out so that's what I said and
here it's like less than a percent
confident and it builds up confidence
over time as it as it gets to analyze it
a few more times and then finally there
is an is final boolean here which tells
us is the person done speaking that
sentence so what we really need to do
here is to take this sort of mass of
nested stuff and could
convert it into just a plain old string
that we can see so let's go into here
and we'll say caught strands crypt
equals array dot from and we need to
convert it to an array dot results
because it's not an array by default and
then we're going to just map over each
of them and then just turn it from one
thing to another so first thing I want
to do is just grab the first thing from
each of them because this is the list
and we need to grab the first thing from
each of them so we could actually just
take
so we are going to map over it and take
the first thing that we have there so
I'm going to put this on its own line
and we're in a map the result is going
to return the result square bracket 0
that's the first thing that is there and
then if we call so log the transcript
let's see what we've got
hello I love to pet dogs let's see open
it up some of them are going to be two
things like this one will tell me that
hello I love and the second thing that
it gives us it's so nested the pet dog
and then I'm sure that it would correct
it as we go along so good and then we
need to map over that once more and grab
return the result dot transcript hello I
love to pet dogs
there we go look what we've got here
we've got a raise coming in and a run at
one more time hello I love Oh heart
there we go sometimes lol how did it
know that I was actually laughing out
loud that's amazing
I've got an array of the different
pieces that it thinks I said so what we
need to do finally is join those two
pieces together because we don't want
two strings or three strings or one
string we don't want one big string so
join at the end I'm gonna take this
console.log out now when I say something
now when I say something it tells me
exactly what I have you will notice that
if you stop speaking and then start
speaking again it doesn't work and why
is that and that's because we're
listening for the result but then once
the result is finished it does it like
unbinds itself it's no longer listening
so what we need to do is add a second
event listener for the end event and
when that ends we simply just call the
function we can just tell it when it
ends run the function for us recognition
don't start we don't run it here because
that would run on page load but we just
supply it the name of the function that
it will then call so if we give that
save
when I start talking and after a break
it will start up again and that's
because this end event is firing which
in turn is going to add the event
listener it's going to start listening
for it again good now what we need to do
is create a paragraph tag where we can
put these paragraphs actually we already
have a paragraph tag so right down here
we simply just say P dot text content is
equal to transcript now when I start
talking we should see it in the Dom but
when I start talking again it overwrites
it hmm what's going on here well what's
happening is that if I'm done with that
sentence this is going to run again and
replace it so what we need to do is
check if the result is final so if a dot
results the first one dot is final
then we need to create a new paragraph
we're going to overwrite this paragraph
we've created on page load so we just
say P equals nope don't put a borrower
light in front of it we're going to
overwrite this existing one here P
equals document dot create element P and
then we'll stick that sucker in the
words dot append child P now when we
talk
it should add a paragraph and when I
talk again it should add a second
paragraph and a third exclamation mark
do you get the point question mark sweet
seems to be working so that is the very
basics of speech recognition that we
have here it's actually not a lot of
code what you could do with this now is
that now that we have this transcript
you could say like if transcript dot as
it contains unicorn then console.log
unicorn whoa I love dogs oh it's not
contains its includes I love dogs
I love unicorns hey and when you say the
word unicorn it triggers it and goes off
so what you could do is you could listen
if it includes like get the weather and
then it would run a function that would
console.log getting the weather siri go
get the weather and then it will run
thus getting the weather function
obviously you'd have to debounce that or
only run it once every so often because
it will run it multiple times but you
get the point here I've seen people hook
this up to external weather api's or to
other functions and you can basically
have a hands-off application that
listens for what you're saying behind
the scenes and when it sees those words
that you want it will trigger some sort
of other function hopefully you enjoyed
that I would love to see what you build
with this there's just a whole world
that opens up when you have speech
recognition so please let me know what
you create thanks and I'll see you
tomorrow
[Laughter]</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>