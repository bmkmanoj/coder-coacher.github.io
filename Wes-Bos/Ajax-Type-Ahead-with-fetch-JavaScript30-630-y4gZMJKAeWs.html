<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ajax Type Ahead with fetch() - #JavaScript30 6/30 | Coder Coacher - Coaching Coders</title><meta content="Ajax Type Ahead with fetch() - #JavaScript30 6/30 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Wes-Bos/">Wes Bos</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ajax Type Ahead with fetch() - #JavaScript30 6/30</b></h2><h5 class="post__date">2017-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/y4gZMJKAeWs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">today we're going to create what I like
to call a type-ahead feature where I've
got a list of cities and states with
their population in it when I type
something in like new it's going to show
me everything that matches the word new
I type in York or Boston or West it's
going to show me every single city and
state that matches whatever I've typed
in along with the corresponding
population now this data is going to be
coming in from an external source what
I've done is I just want to get up here
and I found a city's JSON file which
will include the city name the state
name as well as the population that we
have here I put that into a URL so first
thing that we need to do is we need to
actually go and fetch this data which is
a huge array and then once that data is
back whenever someone types in to this
specific box we're going to filter that
array down to a subset of all of the
ones that either as a city name or the
state name will match so how are we
going to do that well first of all we
need an empty array to put our cities
into long as it counts cities equals an
empty array and then we need to go out
and fetch our data we're going to be
using a new API in the browser called
fetch and if you've done in HTML or xml
httprequest in the browser before you
probably have used like jquery dollar
get json or a library like Axios however
the browser now has a new one built in
which is called fetch so that's what
we're going to use we're in call fetch
and you fetch the end point and what
fetch will do if you're used to maybe
running a callback like this function
and you have the data and then you can
console.log the data it works a little
bit differently than that because fetch
itself will return what is called a
promise and I'll show you that if we
were to just put this in a variable
Const from equals fetch and console.log
the prom open that sucker up in our
browser you see that Oh from prom there
we go
you see that it doesn't return the data
it returns what's called a promise which
is sort of like a something will
eventually come back from this fetch so
the way that we can work with a promise
is you call dot then against it is it
dot then and it's going to return to us
just like a blob of data I like to call
it a blob and I'll show you why you
might think like oh why wouldn't that
just be the list of cities so from that
look console.log the blob okay so this
is what comes back responds cause it
worked 200 okay is true good headers we
open up the body there's just a readable
stream locked false T like what's going
on here and and what's happening is that
the data that comes back from our fetch
it doesn't know what kind of data it is
just yet it could be an image it could
be some HTML could be some music that's
coming back we explicitly know that it
is JSON so you might think okay finally
why don't we just do json.parse right
that should work but it doesn't because
the blob has to be converted from the
raw data that it is in in to JSON so
what you do from this is you call blob
and if you look at this blob and open
the prototype you'll see that there is a
method called JSON right there so if you
call blog JSON that itself is going to
return another promise which we're going
to call dots then on this is getting a
little bit hairy so let's do this oh
yeah that looks much better than and
that is going to give you the raw data
which we can console.log this data here
now when i refresh we get a massive
array of all 1,000 cities in states and
population latitude and longitude from
each of the ones now how do I get this
data into cities well you might think
I'll just do cities equals data right no
problem there and assignment to a
concert variable so we just tried to
wipe out Const variable by reassigning
it to be the day
so you what you could do is you say let
cities and that's a fine way to go ahead
about it our cities my array or if you
like to keep your variables constant
want that array changing you can push
the items into cities so you might think
okay cities push and we'll say data look
at cities okay this is an array of one
thing but if you open that array then it
says how okay that's not it as an array
of an array now we're nested so how do I
get each and every item to go into
cities well you might know that cities
dot push if you push something like one
two three four and then look at cities
you'll notice that every time I have
another argument to push it will put it
as its own item in the array and the way
that we can change this array into
individual arguments is we spread into
it a spread is part of es6 I've got a
whole bunch of videos in my other es6
series but you simply spread into a
function or spread into this push method
and that will give us proper cities
there we go
now that's an array of a thousand
different cities that we have good now
I'm happy with that the next thing we
need to do is when someone then types
into this box here I need to run a
function that is going to take this
massive array and filter it down into a
subset where you can then listen for it
so I'm going to create a function here
called find matches and that's going to
take in a word to match and it's also
going to take in the cities array
because we want to pass in the data into
this function that it's going to filter
and from that we are going to return
these cities array but we're going to
call filter on it which is going to sort
of chisel it down into a subset of that
initial array so each one is going to
have a place which is each individual
city and state and population and
everything like that and from that we
need to figure out here we need to
figure out if the city or state matches
what
searched right like if I were to run
find matches with boss it should show me
Boston and whatever other cities have
the word boss in it so we need a couple
of Reg X's because you might think like
okay we'll just return place dot city
match and normally you could do
something like this where you search for
the word boss and if it does match then
it will be true and we will give
ourselves a subset but the problem is
that the word to match is not always
going to be boss are always going to be
new or always going to be York it's
going to be a variable and the variable
is word to match so just pop in the
worst match no it doesn't work because
it's actually going to look for the word
or to match so how do you put a variable
into a regular expression well you can't
just do it in this syntax here we need
to actually create a regular expression
outside of it so let's go above here and
we'll say Const reg x equals new reg
octopus and you pass it the word to
match and that's going to be whatever
the person passes in boss New York etc
etc and then you pass it any of the
flags that you want so G is going to be
global I mean it's going to look through
the entire string for that specific one
and I is going to be insensitive meaning
that it's it's not a terrible person
worth in sense of it it's going to match
lower case as well as upper case
regardless of what you're searching with
so now we call that match with our reg X
in here and that's going to take the
play/stop city and if we take a look at
our cities here you'll see that as each
place is New York and the city is going
to be New York but we also need to match
the state which that's a bad example
here we go state is going to be
California so we got to return the place
of city match reg X or the place dot
state match
reg X and that will check if the city or
the state has either one so if this one
is true or this one is true the whole
thing is going to be true and therefore
our filter it's going to be made much
smaller so if I were to then run this if
we were to say find matches and we were
to search for vos and we need to pass it
our cities array here what it returns to
us is a smaller array of two things
Boston and Fosse a a city good we've got
our find matches function done then what
we need to do is create our display
function so if a function display
matches and that is going to be called
whenever someone changes the value one
here so I'm just going to console that
log this stop value and then we're going
to select this input that we're working
with here so what is the selector on
here input type of tax class of search
that's good for me so I'm going to go
down here in case search input equals
document dot query selector search and
then we also want to select this ul here
which is suggestions then we'll say
search input dot add event listener
we're going to listen for the change
event and when the input changes we are
going to run find matches save we should
now see when we run it type in here and
I click outside then it runs that
function oh we got an error cannot read
property filter of undefined in our oh
because we're not running fine matches
directly sorry we are running display
matches not fine matches so if I type in
here like boss and click outside it then
will trigger in console.log this which
is the input dot value and that's
whatever someone has typed into here new
that's
so why do I need to click up fund that's
because the change event only fires when
you go off that input not whenever you
type into and key up so if you want it
to also fire on key up just duplicate
that and we'll listen for the key up
event and we'll just rerun display
matches on that as well now if I type
new hello boss you get the point
every time we key up going to tell us
what the person has typed into that box
now what we want to do is go back to
this display matches function here and
we are going to use this find matches
function that we built so say Const
match array equals find matches and we
are going to pass it this value as well
as our cities arrive and that should
give us the eat match array let's try it
out whenever I type into it it should
run this call our function find ones
that match it boss
there we go see the first time I type B
there's a lot of cities second time i
typed o a little less and then the third
type I type boss it's going to give me
that array of just two cities that have
matched it good so we've got the data
and that's really what I like to stress
when we're doing this stuff get your
data first get all your functionality in
place and then we'll worry about hooking
it up to event listeners as well as
creating the HTML that we need there so
we're going to first loop over it so it
const HTML equals match array dot map
and each one is going to be the place
what did we use up here yeah place I
like to keep it consistent and from each
of those return back text is going to
hold our list item li inside of that we
want a span with a class of name which
is going to contain the place city and
the place dot state and below that we're
going to have a span with a class of
population plays
population then finally once we've
mapped over this array we can simply
call suggestions dot and what is
suggestions that's this query selector
that we've done down here the inner HTML
equals HTML which is this HTML that we
have here one last thing is this map is
going to return an array when we really
want just one string so we can call a
quick dot join on the end and that will
turn it into from an array with multiple
items into one big string give it a shot
off there we go Boston Massachusetts
Boston a city new looking good a couple
last things we need to do if we look at
the actual answer that we're working
here is we want to format these numbers
here as well as we want to highlight
actual words like Wes in West Virginia
and West Sacramento so how do we do that
well let's go back to our map function
here and before we return what we can
then do is create a regex will match the
city name and then we'll use that regex
to replace the word that it matches like
Wes with just a span of the class of HL
and the word that it matches so we're
just going to be like plucking the word
West out and replacing with a span class
of HL so say Const regex equals new red
jig X we say this dot value which is
whatever the person searched for we want
to search for that globally because if
it's if it's match more than once in the
city name will be kind of cool to show
that and insensitively we don't care
about capitals and then we will create a
city named variable where we're going to
take the place city and we are going to
replace the regex which is whatever it
matches with just a span with a class of
highlight and we'll pop in this value oh
I got to use back text there there we go
so it's going to find whatever it
matched in the regex and replace it with
a span of the class of highlight and the
the value that the person had searched
for so now when we take that city name
we can replace it place that city with
the city name variable which is going to
include the HTML for us I've been off
and there we go it's matching it if I
type in Wes working so far but we also
have to do it for the state name so
let's just duplicate this and change it
to state name and place that state dot
replace and then you take that state
name variable and replace it right here
there we go looks like it's working
finally what we need to do is find a
function that is going to put in commas
for us so I've just got a function right
here you can grab this from the answer
field if you like typing it or go to
your nearest Stack Overflow and take
that answer and I'm just going to paste
it in here number with commas is just
going to replace it and it going to give
you those nice commas so we can go to
our population is a number with commas
and it will then give us those nice
commas instead of everything that we
have there so new there we go we're
matching new in the state or matching
new in the city name as well as we are
putting in those nice commas to display
the data to the user that's it for today
if you want a little bit more of a
challenge maybe go to this data and say
what else could I use to sort this data
maybe you could figure out how to do
location work which is coming in a
future video and sort it by what are the
cities that are closest to me rather
than just the order that they appear in
this array explicitly thanks a lot I'll
see you in the next one
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>