<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How LocalStorage and Event Delegation work. #JavaScript30 15/30 | Coder Coacher - Coaching Coders</title><meta content="How LocalStorage and Event Delegation work. #JavaScript30 15/30 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Wes-Bos/">Wes Bos</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How LocalStorage and Event Delegation work. #JavaScript30 15/30</b></h2><h5 class="post__date">2017-09-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YL1F4dCUlLc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello hello hello today we are going to
be learning about two main things first
we're going to be learning about local
storage and second we're going to be
learning about something called event
delegation so what we've got here is
sort of a tapas menu where you can add
things and then if you want them you can
check in and check them but kind of the
cool thing where if you were to type in
like taco mom say pork taco hit enter
and then when i refresh the page it's
still there and if i click on one of
them to taco it or check it as normal
people would do you refresh it's still
going to be there so that's going to be
persisting our state with local storage
next up we're also going to be doing
something called event delegation
because when i add another item here
like fish and I click on it I can taco
it right away why can I do that because
if you add an event listener on
something that doesn't exist
you'll know that in the future it won't
be clicked so we're gonna look at that
error as well and use event delegation
to fix it so I've gone ahead and just
selected the add items which in our case
is this form element right here so when
someone submits that form we're going to
add an item and then I've also selected
this ul with the class of plates here
that's where we're going to load all of
our tapas dishes into and then finally
we're going to be storing all of our
data in an array it's gonna be an array
of objects which has the name of the
array as well as the status whether it
stuccoed or done or whatever it is that
we are here so we're gonna go ahead and
grab that form element which is add
items and we're going to listen for the
submit event why do we listen for the
submit event here because that's what we
actually need a lot of times people they
listen for a click on this button but
you want to listen for a submit when
someone hits enter when someone cooks a
button when some external thing submits
it we need to make sure that we're
covering all our bases and by listening
to the submit event it's much more
and by listening to the submit event we
cover all of our bases with that so
we're going to run a function called odd
item when somebody submits it and we're
going to create that function here it's
going to give us the event and let's
just console.log hello
gonna open mine up here and grow I'm
going to go to the console here now when
I type in something like fish you see
that
oh hello was quickly flashed there let
me do it again oh if you click on this
button here Preserve log you can see
what's happening here I'm going to hit
enter and then automatically log hello
and then we see navigated to and this is
the URL of where I'm working here so
what's happening is our page is actually
refreshing and we don't want that so
what we can do is we can say eat up
prevent default and that's going to stop
the page from reloading because by
default a form is is going to reload the
page or send the data to an external
source generally what's your server side
in this case we're going to be doing an
all client side so to prevent the
default of that happening now when I
type in sign and submit that we don't
get anything why is that because and
nothing is happening if I were to
console.log hello once more say hello we
see hello in the thing but the page does
not reload okay now that we have that
what we need to do is to take that text
of this box and put it into an object so
first of all we are going to make an
item and that item is going to have to
it's going to have text of item name and
we'll replace that in a second it's
going to have a done state of false so
by default it's not going to be checked
or tacos
now how do we get this text here well we
can do this Const text equals and we're
going to first grab this input box which
has a name of item on it so we could say
document the query selector but we can
also do this query selector
and why can we do that name equals item
why can we do that that's because this
is going to be the actual form that's
the whole form tag and then we'll look
inside of that form tag for something
that has a name attribute of item and
that's really helpful if you have
multiple forms on a page you don't just
want to be globally selecting it you
want to narrow down your search inside
of the one form that we're working with
so we've got that text and if we were
just to wrap that whole thing in
parentheses it's gonna execute first and
we can call that value against it
because that's going to give us the
input and then input has a property
called value which is whatever the user
has typed into it so we can go here type
text or if you've watched my es6 videos
you know instead of saying text : text
we can use the es6
shorthand property which is just text so
we just created this object here let's
console.log the item and let's go over
to our console type in something like
fish and now when i run that we you
should now see an object in your console
that has a ton of false any text of
whatever the user has put in there and
if you run it a couple times you're
gonna get it console logged one thing we
want to do is clear that input and what
we can do is we can say this don't reset
because what this is the form element
and form elements have a method called
reset on it you've probably run into
this where you've spent an hour filling
out a form online somewhere and you
accidentally click the reset button
instead of the submit button that's what
it's hooked up to it's a dot reset so
let's let's see we're at now fish there
we go it refreshes it it clears that and
we create this object we're not seeing
it because we're not console logging it
now what we want to do is take that item
here and put that into this items array
so what we do is you just say item stop
push item now let's take a fish and we
will say squid now if we look at our
items array you see that we have object
with two things in it we could go one
step further in console dot table the
items are
you see that we have fish and squid now
that's all we've done to get our data in
it it's not going to persist when we
refresh just yet we'll do that in just a
second but at this point we need to
create a second function that we're
gonna call populate list and that's
going to create the actual HTML here so
we're gonna say function populate list
that populate list function needs two
things first of all it needs a list of
plates to populate and we've stored that
where we stored that inner items array
so let's let me show you once more if I
die fish and look at our items array you
see that we have an array of things
which is has a text efficient done so we
need to pass in what that's going to be
called and you can call that items if
you if you prefer to to name the
variable the same thing but let's call
that plates and we're gonna set that to
be a default of an empty object and the
reason why I do that is because if for
some reason you forget to pass in
something it's not going to break your
JavaScript it's just going to loop over
an array of nothing and then your map
function will work just fine and then
second of all we need a place to put the
HTML and that's called the plates list
and we are going to pass in our items
list so why am i doing that why am I not
just like reaching outside in in pot
grabbing the list of items and grabbing
the place where it will dump them that's
because I want this populate list
function to be a little bit more
resilient meaning that I could pass in
any array of plates and any destination
HTML element and it will work so if in
the future I decide to have two
different lists or two different menus
that would be fine I could still use a
single populate list function and just
pass it a different array of items in a
different HTML element to dump it so you
go inside of here and we take this
plates array here and we are going to
map over it so we have map we take our
item or let's call it plate singular and
then we have the index and I'll show you
why we need that in just a second now
from here this is going to return some
HTML so we're going to use back text and
the last thing we need to do is
in front of this plates that map is we
need to stick this either in a variable
or directly into the HTML so I'm going
to say place list enter HTML
equals and I'll show you what this does
in just a second so we're going to loop
over every single item in our array and
that's just an object and we're going to
map which again a map will take in an
array of like raw data and return an
array of some other data and in our case
we're going to take in the objects and
return a string from each one that's why
we're using these back techs here so
we're going to give ourselves a list
item and then let's just take the a
label and let's forget about all the
stuff let's just get it working we'll
put a plate dot text inside of it so and
then last thing we need to do is call it
dot join on here because map is going to
return an array when really if we're
setting in or HTML we just need one big
string so this little dot join on the
end is going to take this array that map
makes and turn it into one big string so
if we have six or seven items it's not
going to give us an array with six
strings it's gonna give us one huge
string so now if we take this populate
list we go back up here right before we
run it and we run populate list we're
going to pass it our list of items and
our items list let's try it out I type
fish ah-ha fish and squid and tacos and
you see what's happening here is that
every time we add an item we are calling
this populate list function which is
then going to create a list item with a
label inside of it and you can inspect
this and see what we've got going on
here it's going to create a list item
one thing that I should say is this
populate list function every time we add
an item it's recreating the entire list
so if you are really worried about
performance in this case it's not a big
deal it's very very fast but if you were
doing this maybe every half a
or every second or you had a bunch of
animations you would want to look at how
do I update just that one list item that
I have rather than rerender in the
entire list and that's where something
like react or angular becomes really
helpful because they're smart enough to
know okay rather than just blowing away
this entire unordered list and re
rendering the whole thing let me just
figure out what's the minimum HTML that
I need to change on the page without
having to change the rest of it so we've
got this label here and above it I'm
going to have an input with the type of
checkbox we need a data index and I'll
show you why that's helpful in just a
few minutes and we're going to set that
to the index that we have here we're
going to have an ID which is going to be
item I because that's going to be item
one item two item four and here we need
to go back to our label and hook that ID
up so we'll say item I and that's how
when you click on the label the input
will check itself that's how we link the
to the ID and the four are exactly the
same thing and then finally we need to
know whether or not these items are
going to be checked or not because when
I rerender it if it's already checked if
it has a done status we need to put the
checked attribute so if I were to say
checked then all of them would
automatically be checked so if I had
fish see that has a check state but we
have to look at the items it's a look at
the items in there and the first one has
a property of done so if it has a
property of done put the checked
attribute otherwise we leave it off
because you might know that you cannot
say checked equals false that will still
make it watch if I say checked Eagles
false and I type in fish it still checks
it
I'd say checked equals emoji poop it's
still checked and that's because
anything any existence of the property
checked
or the attribute checked will make it
checked so we need to create a ternary
operator here where we say if the plate
done attribute is true then we're going
to put the checked otherwise we're just
going to do nothing which is just an
empty string you sometimes I thought to
put null here but the word null will
actually show up in your HTML so you
need two blank strings let's see if
anything's broken
good fish is working and then when I
click it it will check the taco on and
off if you're wondering how I did this
custom thing here if you take a look at
the input box you'll say that I've
displayed none it I take that off the
input box is actually still there I've
just hit in it with CSS and if we open
up our CSS here let's look for the tacos
here we go what we say is the plate
input the label before it has a blank
sort of emoji that's just a square but
then when the input is checked turn that
content from a blank square into a taco
so you could really put anything you
wanted here and it will turn it on and
off it's sort of a little trick that you
can do to make it work I think it looks
a little bit better and that's a way
that you can still have your your proper
check box for data but you can display
them with whatever HTML CSS that you
want so we've got that up and running
and every time I add a new item it will
add it to the list and I can check it
and uncheck it the other problem here is
that when i refresh the page that list
is not persisting so what we're going to
do is we're going to be storing our data
in the local storage now if you've never
worked a local storage before
essentially how it works is that you
have this object in your window called
local storage or object in the browser
sorry called local storage and if you
open that up this is just a list of
things that have been saved to this
domain so this is only computer by
computer browser by browser website by a
website basis but you're able to save
text to the
browser and then when you reload the
page you'll be able to grab this text
out of it so if you go to your
application tab in chrome dev tools
there's a whole bunch of stuff here if
you go to local storage and click on the
domain that you're working on in this
case I'm working locally so it's just a
file you should see that there's a key
of items and a value of something else
now you might see a whole bunch of other
stuff here depending if you've ever run
other applications on your localhost and
this is where I've stored the text of
what we're going for and the property of
done to false are true etc etc so how do
we actually save that to local storage
when we're done well it's actually
pretty easy
when we populate the list here what we
also need to do is set this items array
into local storage so we you think you
might be able to do this local storage
dot and then the API is that set item
dot get item and dot remove item or
delete item double check that so the
local storage set item and we're going
to set the item items that's the key
right here what it's going to be called
and then what are you going to set the
data to well you might just think okay
I'll just pass items because that's my
items array fish okay so we just ran it
we added the item we've populated the
list and then we called local storage
that set items we go to our local
storage here and you see this object
object what does that mean well what's
happening here is that local storage
although it seems like it's an object
it's simply just a key value store and
you may only use strings in local
storage so if we were to take our items
here and call that to string on it you
see the object object and what's
happening is that when you try to put
something other than a string into local
storage the browser goes oh I don't know
how to handle this let me just convert
it to a string and let me just use the
dot to string method that exists on the
number or the object or the array in our
case it's an array and in what returns
is the browser goes object object and
that's its representation
so we can't really do that because
there's not actually an object here it's
just the word object object so what we
actually need to do is stringify it
before we convert it so in the browser
we have this thing called json stringify
and when you pass it your items it's
going to convert your objects and arrays
into a JSON string equivalent so we just
need to wrap the sucker
hae-sun dot parse items and now when you
add an item in here fish o unexpected
token o at JSON what is our problem
oh not power stations stringify parse is
gonna be the other way fish and tacos
and yum and now when you go to your
application tab here you see that this
is now being stored it looks like an
array of objects but it really is just
text and I can show you that because we
can say local search like yet item items
that is just a string however what you
can do is you can wrap that thing in a
JSON dot parse and that's going to then
take it from the string and put it back
into whatever it was initially in this
case it's going to be an array of actual
objects so that's what we need to do on
page load we go down here and when the
page loads the very last thing we'll say
populate list and we can say items but
again you don't know it like we have to
do json dot parse no not here
we are going to say items and items list
but the items doesn't exist on page load
remember at the the first thing we do up
here is we create an empty object so
what we can do is we can say items
equals json dot parse local storage get
item items or a blank array and what
that will do is it's going to try get it
from local storage and then if it isn't
there it's going to fall back to an
empty array then
page-load before we do any of the stuff
our items is going to be populated and
then when we reach here we can call our
populate list just as we did right here
so if we refresh the page now oh ho you
see that our fish tacos and YUM is now
persisting I can refresh all that I want
and the data is always going to be there
so real quick review of what we just did
there when we add an item you put it
into local storage and you update your
local storage every single time and then
on page load what's going to happen is
that we check if there is something in
local storage and then we fall back to
an empty array now I just want to make
sure that that still works with nothing
so we can go to our application file
click on this thing and exit and then
when we refresh the page you see that
there is nothing there so if I type in
items you see that it's fallen back to
this square bracket which is a blank
array okay good good good we are in good
shape next what we need to do is persist
the toggling of it because if you add in
fish and tacos and yum and you check one
and refresh the page that state is no
longer handled so what we need to do is
create a new function called toggle done
and then we're going to pass the event
there now when will this function run
let's go down here you think that you
would select each of the checkboxes
right here and then listen for either a
change or a cook event on those
checkboxes and then when that happens
you will go ahead and perform something
now let me show you a real quick example
if I say Const checkboxes equals
document type query selector all and I'm
just gonna I'm just gonna select every
input on the page and I'll say check
boxes dot for each input input and event
listener click and then when that runs
I'm just gonna run a quick function here
that will alert
hi okay what I did there when I click on
a checkbox we should alert hi so click
it and when I click one of them they
should alert hi but it's not working
hmm what's going on here well if we look
at our check boxes array there's two
things in there and it's it's this thing
okay so I click on that that works if I
click on add item that works so where
are these three inputs why are they not
showing up in my node list and the
problem that we've run into here is that
when this code runs when our event
listener runs when our selector runs
this doesn't exist yet why because we
need to populate the list first so you
might think okay that's fine let's let's
populate the list first and let's take a
look at our check boxes array okay look
at there's more there they are okay are
we are we out now if I click on one of
these okay now it's working but what
happens if I add an additional item like
beer hello it adds it okay good now I'm
gonna click on this check box it doesn't
work this is this yum still work no no
none of these work now what's happening
is because these inputs here are created
after we listen for them they don't have
event listeners attached to them the
whole idea behind event delegation is
rather than listening for a click or a
change on these check boxes directly
what we do is we look for somebody who
is going to be on the page at the time
of listening and if we look at our HTML
here you're going to see that that
unordered list that holds everything you
will the class of plates that does exist
so what we're gonna do is we're going to
listen for a click on the plates and
then we're going to figure out did they
actually mean to click one of the inputs
inside of it
so I always like to think of event
delegation as very responsible parents
like you all with class of plates and
very negligent children who don't
necessarily hear any instructions
from the parent so what we're saying is
hey plates when your children inputs get
clicked can you please pass this click
on to them rather than you handling the
click directly we're just telling you
because you're the only one responsible
here so that when someone clicks it if
it's for one of your children I don't
know if they're your current children or
you're gonna make more children in the
future but if you make more in the
future make sure you tell them to handle
this click so you got to think of like
responsible parent negligent child who
doesn't necessarily know what to do with
the click so the parent has to tell it
what to do
so let's go back to this code here we're
going to delete these checkboxes here if
you type that we just want this populate
list and add item event listener and we
are going to listen for the click on the
unordered list which is this items list
right here
so say items list just duplicate this
items list the add event listener we're
going to listen for a click and when
that hat happens we're going to toggle
done and then inside of here I'm going
to console.log the e let's go back to
our console here now let's click on one
of these oh ok that's interesting we're
getting two different Mouse event
handlers let's click on this one right
here whoa what's going on here so we're
getting two different event listeners
here when we click on something and what
we can do a little bit further is if we
look at the target of that event let's
see what we're working with here
click on tacos so what's happening here
is that we're clicking on the item and
we're also clicking on the check box
because this is in turn our click on
label is in turn checking the check box
which will trigger a click on the actual
input okay good and then what what else
like if we tell if we click on something
here that isn't necessarily the list
item or the the input you see the the
labels there if we click right here
between why don't we get we get the Li
so you see as we click different items
the target is going to be a little bit
prynt what we want to do here is we want
to check if the target matches the thing
that we're looking for
so we'll say if the target dot matches
this is a new API in the browser input
this is sort of like if you've ever
worked with jQuery dot is an input it's
the same thing as thought matches then
we want to return which means they skip
this unless it's an input and then let's
console.log the target there we go now
wherever we click we're only getting
input checks good so now we have that
working that's again that's a vent
delegation where we listen for a click
on something higher and then inside of
it we check if it's actual thing that we
want because it trick could trigger on a
few different things now we want to do
is we want to go to our items array and
we want to find the one that was checked
and set the done to be true or false
depending on what state it's in so we
can first get the index and this is why
I gave each input a data index value
because we can then use that to
reference where it is in the array so if
we say it's like Const l equals e dot
target just put it in its own now that
we have that element we can console dot
log L the data set index and this is why
we put a data - index on each of the
check boxes and you check one it's going
to tell you the index of the
corresponding item in the array and then
from that we'll take that index we'll
stick it in its own variable just for
simplicity sake and then we'll take our
items with the index and it will access
the done property and we'll set it to
itself but this is the trick the
opposite so if it's true if this is true
it's going to be the opposite which is
false if this is false it's going to be
the opposite which is true so Ridgid
this is just flip-flopping between true
and false and then we're going to do the
same thing that we did with
stringify localstorage right here take
that and stick it right in here and then
we will run populate list once more
which will update the actual visibility
part on here so we're going to change
the property we're going to store that
in local storage and we're going to
visually update what's on our page so
now when we refresh tacos and I should
refresh the page now tacos is always
going to be true why because if we go to
our application and we look at our local
storage here you should see that tacos
is true and done as false and if I were
to just mainly change this to false and
the first one to true and i refresh the
page you see now fish is checked and
tacos so we're just every time we make a
change we are going to mirror that to
local storage and then we render the
entire list or even better if you can
figure out how do I just rerender that
just that one that's even better so
that's it for today's what I will now
challenge you to do is make a button
right here that says clear all or check
all or uncheck all and when you click
that delete button it'll delete all of
them when you click check all it will
make them all checked and when you click
uncheck all it will uncheck all of them
and mirror it to local storage as well
as we run this populate list thanks a
lot and I'll see you in the next one
[Laughter]</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>