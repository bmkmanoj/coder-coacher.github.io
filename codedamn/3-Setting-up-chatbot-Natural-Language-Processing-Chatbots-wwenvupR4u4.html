<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>#3: Setting up chatbot - Natural Language Processing Chatbots | Coder Coacher - Coaching Coders</title><meta content="#3: Setting up chatbot - Natural Language Processing Chatbots - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/codedamn/">codedamn</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>#3: Setting up chatbot - Natural Language Processing Chatbots</b></h2><h5 class="post__date">2017-12-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wwenvupR4u4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right everybody welcome to a third
chat pod tutorial with natural language
processing and in this tutorial
essentially what I'm gonna do is show
you how to actually set up the chat
board so that this guy can actually
start responding to the user and
essentially this is required because
once we have done that we just need to
make sure whether they assets in the
middle and now we just pass all our
messages to window there and essentially
we do not even need to do that with
Facebook because Facebook provides a
seamless way to integrate whether
they're and I guess we have done that in
the last tutorial so what we need to do
right now is pretty much set this chat
bot up so let's just do that well
instead of Express what I think we
should be using right here is resti fire
&amp;amp; rusty fire is actually used to create
restful api but apparently this is not
an api because I will not be echoing out
a lot of things on the screen instead
will be just sending requests back to
Facebook but it doesn't hurt to use rest
if I here and if you have used Express
it's pretty much the similar thing with
rusty fire so we can say rest if I hear
and rest rest if I rest make sure you
get that right rest T Phi dot create
server right and you can specify a name
for this as well if you want I can just
say code damn but and what we have in
here is first of all we need to have a
package.json so what i want to do is do
an NPM install or npm in it i want to do
an NPM install or st phi here i'll let
it this install so meanwhile it's
installing what I want is this is fine I
want to use to middle of ears rest if I
the plugins dot JSON B which would allow
us to actually parse the post data sent
by Facebook which is important body
parser right there
once we had done with that what I want
is listen on post request request
response our next I can just cancel off
here actually nothing because we are
using that interface this one so we do
not need to pretty much log anything so
what I can do and actually I have set it
up the endpoints and web hooks correctly
and if you have changed your way book
URL which you will if you close and croc
or you know just restart your computer
what you need to do is go to web hooks
actually it's going to add products
first and add web hook here once you
have done that go to web hooks and just
click on this edit subscription and from
my case it doesn't work if I change
directly here I had to remove the
subscription from here go back to
messenger and then add web hook again
because from here it does not allow you
to change the URL anymore so once you
had done that and go back to my center
find your chat board right here and send
it a message so inside this end rock you
can see we get a bad gateway obviously
because we are not running it so let's
just run old mana and extra cheese
jas and let's just see if facebook gives
us one more try and actually we can just
replay this thing so you can see that we
get an object of format something like
this so we have this as coming from
Facebook so what I want to do is
actually create a separate file here
which would be named as that's the same
method
starchy's and what this would do is that
it will export or not export because
that's es6 module not exports is a class
let's just say this is I don't know
let's just name this methods why not and
it has a constructor for us which we
would take a look later on and it has a
send text as the method right and
obviously this would be asynchronous
right so what we need to do here is
first of all get request module request
right and again require request and what
we're gonna do is actually make use of
requests here which would you have to
supply URL which is the Facebook's URL
which is graft or facebook.com/ slash
let me just see here what this URL is
and this is facebook.com slash our API
version 2 point 11 in our case and then
this is the endpoint then what we have
here is the query strings and the query
string would contain the access token
access token of this page so I can just
say that this is this dot access token
we can just get the access token here
and say this dot access token is the
access token no boy you don't need to
import anything so we have the query
strings with us we just need the JSON
data
which I will just create in a minute and
then method we have finally is post
right but the problem is that this is
based on callbacks and since promises I
do not like call max so what I'm gonna
do is well I know that there are
promised version of requests in the NPM
store but let's just request promise
create one ourselves why not when we can
so we can say a request promise touch
yes what I can do is my tool dot exports
is a function which takes our object and
returns us a new promise we'll just say
is request and then this would be our
object and then finally what request
does to us is gives us a bunch of
options which is error response and body
and till we obviously need arrow
notation here and I can say if there's
no error then resolve with the body and
I either true or reject anything with
the error right so we are done with our
promised version of requests so this
would work requests and what I can say
is response is oh wait this thing and I
can finally say that console or log
facebook says and then response and then
finally what we need to do is create a
JSON out of here constant JSON is what
Facebook expects us to do is to add a
recipient here our CIP ie and T make
sure you do that right
I D and we need to accept two arguments
error text an ID text would be the text
we want to send an ID is the ID of the
user and what else we have is message
and that would be text right so we have
our JSON with us so what this ID is
apparently is the sender's ID which we
need to extract from here so what we can
do inside our index dot JSON is let me
think so we have our post here we get
all this tank this response is request
body right what we want to do next is
get the ID so we can actually first of
all say constant first of all this is
important constraint methods is required
methods and then we can say constant
what is new methods right and actually
we need to supply a access token here so
we would get that access token right
here and there we are
so this is our access token and then
what I want is
we have the bots here so once we get
that request I just want to check if
response dot what we have in here
checked object is equal to page that
means we are getting a message from the
page and I want to get this message so
as a hack for now
what we can do is or actually you should
be just coded the right way okay let's
just go to the right way so what I'm
gonna do is create a method here get
message object and then JSON goes here
we're gonna do is this a bawd dot get
message object and I'm gonna say
response here say message object is this
thing I'm going to finally say that
we're gonna send the same message which
the user sent us so I'm gonna say bought
Todd sent text and then this would be
used said the message of check dot
message and the ID would be message
object dot ID which we're gonna create
in a minute so what I want to do is
actually say that message is JSON not
entry and again we actually have to I
trade over the entry because there could
be multiple entries but we're gonna do
that later on so entry and then
messaging
messaging me SS h g ing and then we have
to actually i trade over that as well
but anyways so message dot text is our
research that constant ID is json entry
dot this messaging and actually we could
have used that above here anyways not
sender ID right here alright and then
finally what I'm gonna say it's just
return message an ID right and yeah that
should do so I believe we look good and
if we take a look at the terminal we
have import token somewhere I believe so
we can just say strange request is
required request here instead of
importing at the es6 way and you cannot
find request because it's not there
there you go
so here we are and if you try our
brought out now and say hey hop over to
and rock just let us wait for facebook
to become active again and make sure we
are sending send 200 here are we know so
that was important okay
so now if our chat board is reloaded now
we should just wait a while for Facebook
to let us interact with our bot again
all right so now you can see that
Facebook is sending us messages again
and clearly we are not sending it back
and the reason is that two unknown part
components slash message all right so if
you take a look we can see here is that
this should be messages are not message
and once we fix that go back to
messenger send a hey you can see that
our chat wat responds you said hey Sarah
hello you said hello
alright so now if I just take a look
inside the NLP section and I enable this
thing right and if we go again Jolla and
take a look inside the end grog you can
see that in not sure inside our post
request we get another section and sent
messages not as NLP natural language
processing with the entities as blank
because obviously we haven't trained our
body yet but you can see the difference
between these two messages once we
enable enabled the national language
processing here which I had disabled
then we get another additional request
block here from Facebook and actually
let me just show you that if I disable
this thing so let's say if I make it to
fall English right and now if I say hey
my email address is may hold a pediatric
email calm can you help me you would see
that
Facebook's default NLP would see what it
does it provides me an entity of email
with the confidence of 96.9% and that is
a huge confidence probably you should
almost trust everything above 80 or 85
that's what I believe and then it says
greetings as well which is 99 percent
and value is true and you can see that
Facebook's natural language processing
is working as well but we're gonna make
use of width or the ass so you can play
around here a little bit you can send
some angry messages that I hit this chat
board its worst anything like that and
Facebook should probably take care of
that not really this time I guess
Facebook hasn't yeah
Facebook has an integrated the more we
say as emotional I guess this name I'm
forgetting yea its called sentimental
analysis so Facebook is not doing that
right now because yeah that is one of
the toughest feel of NLP right now to
determine the sentiment or office
intense because sometimes you need to
have you know the data mind sentiment of
a sentence you need to have overview of
the above conversation because you know
it's very hard to determine sir chasm
with just a single message right so yeah
so you can pretty much play around like
my phone number is plus nine one nine
nine and I know Facebook should just
take care of that you can see so that's
all for this one and in the next one I'm
gonna show you how you can pretty much
train your with the day I bought we're
gonna start off with that and the yeah
that's all for this one and if you liked
it then please don't forget to subscribe
and thank you for watching I'll see you
then in the next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>