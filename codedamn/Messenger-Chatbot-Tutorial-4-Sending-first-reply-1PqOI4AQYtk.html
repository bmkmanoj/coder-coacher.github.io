<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Messenger Chatbot Tutorial 4: Sending first reply | Coder Coacher - Coaching Coders</title><meta content="Messenger Chatbot Tutorial 4: Sending first reply - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/codedamn/">codedamn</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Messenger Chatbot Tutorial 4: Sending first reply</b></h2><h5 class="post__date">2016-08-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1PqOI4AQYtk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so what is going on everybody my name is
metal and welcome to your fourth chat
bot development tutorial in which I'm
going to show you how to set up a basic
actually send a basic reply to the user
who's messaging your chat bot and
there's a bit of change in plan now what
I'm gonna do is I'm gonna use end rock
instead of hero qu for the URL which
figure regarding us of a book now the
reason is that pushing files on Heroku
app deploying is kind of slow and the
free plan of Heroku when the dynamos
which is provides I don't know it's
called I knows I guess they are kind of
slow because when I deploy my up and
then go to Facebook to check it it kind
of does not work it works after like a
minute or so so what this end rock would
do is that it would done with your local
host to an online web address and it's
quite simple and easy to use just
download it and for example for me just
shows me Mac OS it's downloaded for
Windows just download it and you'd be
good to go
so when you unzip it and you'll get
something like this file right and then
what you have to do is go to terminal go
to or actually I'm already in downloads
right so I'm in this in crock right so
what you have to do is write and grok
HTTP and 80 now what it does is it
tunnels the HTTP port 80 to this URL
right here right so if I copy this and
open right here
right you can see that it shows me it
works because I am running a Bosch CTL
so you might need to run a bath CTL
start on your Mac before because mine is
already running so that is why it shows
me it works and it's working directory I
guess I haven't clipboard no I just copy
that so it's working directory is in I
guess your that library web server and
then documents right so CD documents so
now you can see that this index dot HTML
en is the file which is this one it
works right so if I create and I guess
you have to make use of sudo here
because in my guess this is restricted
so just say this is Chad board not PHP
and then sudo Adam Chad
right so you can see that I'm in chat
bar dot php' okay so now if I do
something like like that and I go to
actually you can go to localhost 4:04 as
well as an inspector go to status copy
this URL open it right here and go to
chat board PHP you can see that we get
hello world and it's HTTP it's not
localhost so Facebook would be good to
go
right and we are getting all the
requests right here so that's a plus
point okay so yeah we need to change our
endpoint in the web hook so I might
better create another application and
delete this one so give me a minute for
that and I'll be right back okay so now
you can see that I have coded this
verification web for verification and
let's just set it up real quick this is
our URL chat board dot PHP and just put
in there abc123
I'm just verifying save and you'll be
good to go right so now you have
successfully changed the web book select
the page chat bot code damn provided all
the access it wants and then select chat
board subscribe and you you're good to
go now what I'm gonna do is I'm gonna
send and receive some messages right so
let me show you something if we add
something like input is file get
contents and then PHP input
right and if I do like who are dumb and
put but check this out if I go to my
page again so
you're gonna see that if I pass in
something like hi and go to my end Rock
inspector you see we get a post request
and you can just either see here in the
post summary or right here so it's one
on the same thing so let's just see here
you can see that we get a JSON object as
a response by messenger and it consists
of the sender ID the recipient ID which
is already probably the center one is
the one which sent us so we are gonna
need this ID to reply and then the
system message so this might not always
be text for example if you send a
thumbs-up right and then first we get
there so I can see that here there's no
text right so here's there's a message
field and there's a payload and off so
okay so let's just keep ourselves for
restricted to text once only for now and
say that the user ID is input then entry
and what you need to do first is
actually just JSON decode this thing so
that we can just access it like I'm
doing right now
right so okay now input entry and reset
input entry messaging zero sender ID
entry messaging zero sender ID right and
then I need to have message what the
user gave me it would be kind of same so
input zero entry zero messaging message
text message
texts right we can just echo this user
ID and the message just in case you want
to check so if I hello here and grok
right here we get the ID and the message
perfect right so now right here we're
gonna add some conditions to check what
the message is and what we should reply
which we'll do later on but for now
let's just reply the user actually so
for that you need a URL to post to and
the URL would be the graph API of
Facebook which would be the graph dot
facebook.com and version 2.6 messages
and for this a CC e SS access token
now here we need access token and when
our access token was is that we do not
have one so go ahead right here and did
I really named it called am Chad boo
anyways so here's our token and let's
just create that so that actually need
it again right and access
and then what we need to do is we need
to perform a call request and before
even now we need a JSON data variable
and what this could be
is that it would contain information
like the person you're sending message
and make sure the spelling is right our
is c ii i ENT right so the ID would be
the user ID which we just got right and
then the message which I'm gonna send
would be let's say text and this would
be hello bro and yeah that would be our
JSON object and this codes if you want
cause we are gonna send the header as
well
so next thing what I'm gonna do is write
C edges in it and then URL then curl dot
set up then you so you see it post is
true and then set up CH 0 then post
fields fi eld s write JSON data then
setup CH the content type of application
GS well right and finally what I have to
do is say if message are actually not
message this whole
field right here this message field
right so if you see earlier you can see
that or actually let me just go ahead
put the text one or me so let's just
keep it to text for now so I'm gonna say
that
or actually yes we do have the message
field don't be because no it's just the
text okay I'm gonna see if message is
kind of not equal to something like this
it's not empty then what I want to do or
actually let's just say that if message
what should we do actually let me just
do with input entry messaging and then
my optimum messaging I'm just gonna
check this message right if it's empty
or not right so this one would be good
okay if that is true that means that is
not empty and just execute our stuff it
will be happy right so okay
and now if I message this see and rock
you got a request here and we get you
must use HTTP when passing access token
well oh I'm using HTTP version of
graphic yeah so you shouldn't do that
hey and you can see that we got a hello
bro message pretty sweet right and if
you check the end rock stats
and see that it received a high not high
actually it received a hello bro right
and no matching user fun I don't know
what's that okay yeah that is that might
be some sort of comfort conformation
called something no that one is another
one oh okay actually we're just echoing
this 1004 now so let's just comment that
out so what's happening here is that
eventually what would happen if I remove
this check well then what happens is
that and the user would be flooded with
your messages and say like if I pass
through hey I got a hello grow another
one and another one and it's kind of
slow because it's on my PC but if you
just choose a nice fast server then you
will see that these messages would be
kind of flooding your machine
and the reason is that now you're not
checking if the message is actually
empty or not and you can see right here
after this message hello bro Facebook
send you another post request without
any message and this was kind of a
delivery report right so that's why you
need to check if you are getting our
valid message or not I don't know what
it's dropping after three but it should
actually flood your stuff right you can
see it's it's four now and oh this might
be because I'm putting my cursor here
maybe so you can just play around with
this little and I'm just gonna fix it
again by just checking if it's really a
message or not you suck robell and as
you can see a nice little Robo still
replies me with hello bro so that is all
for this one and if you liked it then
don't forget to subscribe and thank you
for watching I'll see you then in the
next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>