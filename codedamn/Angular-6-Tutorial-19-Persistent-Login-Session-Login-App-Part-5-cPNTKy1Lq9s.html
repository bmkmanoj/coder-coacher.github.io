<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angular 6 Tutorial 19: Persistent Login Session (Login App Part 5) | Coder Coacher - Coaching Coders</title><meta content="Angular 6 Tutorial 19: Persistent Login Session (Login App Part 5) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/codedamn/">codedamn</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angular 6 Tutorial 19: Persistent Login Session (Login App Part 5)</b></h2><h5 class="post__date">2018-03-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cPNTKy1Lq9s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so what is going on Dahmer's my name is
male and welcome to your 19th angular 6
tutorial in which we're gonna take a
look at how to keep your session alive
whenever the user actually refreshes
your page or closes the window and comes
back at a later time and so on and so
forth so let's get started okay so the
challenge is to keep the session of life
and we have to do that on the angular
front end because on the back end we are
already sending and receiving cookies
perfectly fine but the angular also
needs to know that the user is actually
logged in so there are about two ways to
go for this the first one is that to
keep the storage persistent we can make
use of local storage another one is that
whenever your application reloads
angular can hit up a server with
obviously the cookies associated with it
because that's not what I'm Lorent
rolling so the cookies would anyways be
sent to this remote server then the
server can verify that whether this
person is logged in or not and then
angular can know so we're gonna take a
look at both of these approaches so
let's get started with local storage
what we want to do is go right here
inside our auth dot service and right
here when we say set logged in is this
store login status is value and what I
want to do is local storage
daaad set item logged in and true right
so here I'm gonna say local storage dot
kit item logged in or false I'm just
gonna chase on dot parse this thing json
dot purse
there we are right so we have our login
status from local storage now a local
story short said I am logged in true
make sense make sense all right now if
we can do is right here we can actually
just send this thing or or what we want
to do is this dot logged in status not
to string now the reason for that is
because we are JSON parsing that so we
just need to have a string value
otherwise the JSON won't field because
we can just do a quick check here as
well inside our console if you write
json dot parse or false it gives us
false but json dot parse off seriously
false gives also gives us false so yeah
that should not be a problem but it
usually is a problem with arrays so yeah
that would work anyway so yeah we can
just remove this and this
okay so yeah we can just keep this here
because typescript is complaining and
we're getting to keep this here as well
anyways it does not matter because JSON
that parts will take care of that so
what we have in here is that now if I
just clear my cookies in here
delete and if I log in now admin admin
hit summit you can see that this is a
secret message only for admins later a
taffy examiner localstorage we get
logged in as true and length of one now
if I reload this page you can see that
we got a loading message and this secret
message only for administrator so now
our session is persistent now the thing
is that if I delete my cookie what
happens or let's say my cookie expired
what happens that according to Luke
angular I'm still logged in but on
server I'm not so we get slapped when we
access slash admin angular allows that
because angular basically thinks that I
am logged in but the server does not
know that so we get the message who the
F are you okay amazing
everything is working fine now at this
point what you want to do is just remove
your local storage thing as well so what
we can do in here is once we get this
thing hot dot user dot service not right
here maybe inside our admin component
file if we get if data dot success is a
false and then I just want to remove the
local storage dot clear item logged in
something like this logged in or logged
in status logged in yeah so now if you
reload you can see that we would get
some message who there for you but the
next time local storage dot clear local
storage dot clear or it should be local
storage to remove item remove item just
like this now we should get this message
for the first one but from the
subsequent runs it should just redirect
us to the login page
as you can see right because at the
first one it has that local storage
information but from the second one it
does not so it's just the odd card kicks
in and redirects us to the log and farm
all right
this was our local storage approach now
let's just take a look at the remote
server access so what you're gonna do
here is that we're gonna remotely access
you're gonna send a request to the
server every time we are trying to
access a protected route and if that's
true then we're gonna proceed and if
it's not then well just gonna shut the
system down so we're gonna go to auth
dot god and right here I'm just gonna
say that too I'm just gonna switch back
to my default stuff here it's just gonna
say false in here and I'm just gonna say
this dot logged in status I'm just gonna
get rid of that as well now the thing is
that if this is true then we seriously
know that the user is log because
angular's application is not refreshed
and this is false by default so if login
tap logged in status is true that means
we are actually logged in to the
application if it is false then we're
not sure that we are logged in or not it
might be that we are not logged in or it
might be that the user has refreshed the
page but the user is still logged in so
we got to check that the false you're
sure if it's true then yep we are logged
in
otherwise we might be logged in and we
might not be so inside our earth but god
instead of this thing right here we
might be logged
so what I'm gonna do is send another
request to the server to verify whether
we are logged in or not
okay so in this case what we want is
that we want to return a boolean value
from the scan activate but instead I'm
just gonna check if this dot r dot is
logged in if that is true then I'm just
gonna return true otherwise I will check
from the server if I'm logged in or not
so I'm just gonna see with Dawn this dot
let's just say our login service right
here the user dot is logged in and then
I'm just gonna say that we just map over
the HTTP request we performed I'm just
gonna get a response and let me just
first of all create this user service
right here I can just split that on
lines so private user is user service
like that and there we are
so is logged in on user service would
return us this dot HTTP dot let's just
say we just do a get request of slash
API slash is logged in dot PHP right and
yep and we can just create an interface
for this one as well
is logged in and this I'm just gonna say
message is or just gonna say status as
boolean so I'm just gonna implement this
is logged in interface right here and
yep so what we're gonna do is right here
inside our odds but guard I'm just gonna
say ok so it says property map does not
exist on type observable okay to fix
this thing
what we're gonna do is we're gonna
surround this around pipe and the reason
for this is because angular from angular
5 onwards it uses
pipes do use operators I'm just gonna
import map in here and don't worry about
this if you do not understand our exists
it's completely different thing just
remember that this is kind of a thing to
work with asynchronous stuff so we're
gonna take a look at attic rxjs
later on in this series but for now
let's just stick to what we are doing so
I'm just gonna import map from the
operators and that is from rxjs slash
operators
from there we go so now if we see type
observable is not assignable to type
boolean also boolean or rottenness
boolean
type observable
and we can just return a type of boolean
here observable observable of boolean
and if you just save this thing let's
just see if we can just do it or we can
just say you return read status here
rest dot what we have status right so
observable is locked in something like
this and inside our card
we're just returning resto status okay
so let's let's take a minute out of here
and see what happened in our can
activate God I'm saying that is this
variable is true then we are 100% sure
we are logged in because the angular
application is not refreshed and yep
that is it pretty much so we have
manually said this whenever the user
logs in if this is false then we are not
sure that the user is the users log
logged out or if the user has just
refreshed the page so if that is false
we're gonna hit a request to come this
thing API is logged in slash slash API
slash is logged in dot PHP we can just
create this file as well really quick
and what goes in this file is I'm just
gonna start a session in here and I'm
just gonna say if session as CSS IO n
user is let's just say is not empty or
is set rather then what I want to do is
just echo status status is
true and else echo status echo status as
false just like that right so what we
are doing here is that if we are logged
in then we are returning true if we are
not then we are checking if you are
actually logged in and if we are then
this would be true so GAD activate would
return true otherwise it would return
false which would block our navigation
so we can actually just enhance this a
little we can save where such status is
true I just want to set this dot odd dot
set logged in as true and return true
else I just want to say return false
first of all and I'm just gonna say this
dot router dot navigate to login there
we are so now if we take a look in the
browser let's just clear
cookies in here and this lets us login
with admin admin summit you can see that
we get the secret message only for admin
now if I reload this page what happens
is that we first of all inside this
route we check from the flow can
activate if this dot or dot is logged in
is true actually this is false I can
also show you this thing so now if you
reload this thing you can see that right
here inside our debugger this dot auth
dot is logged and it actually Falls so
it skips this part it hits a request to
the server and we can actually see that
request inside our network's tab this is
logged in but PHP the soul returns
status as true because we are indeed
logged in as we are sending this cookie
to the server so the soul recognizes us
and logs us in and yeah the rest is just
the same we then hit the database call
and we just get the database response so
yeah that is pretty much it for this
tutorial and in the next final tutorial
for this mini lot in series we're gonna
enhance the looks plus create a logout
functionality as well for our
application so yeah I'll see you then in
the next video and one more thing if you
like this video then don't forget to
subscribe and press the bell icon to
receive instant notifications</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>