<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Tutorial - 30. Multiprocessing Lock | Coder Coacher - Coaching Coders</title><meta content="Python Tutorial - 30. Multiprocessing Lock - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/codebasics/">codebasics</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Tutorial - 30. Multiprocessing Lock</b></h2><h5 class="post__date">2016-09-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/POL7n754JTc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">dear friends welcome to core basics
coding tutorial I hope you are having
great time learning multiprocessing and
python in this tutorial we are going to
cover one very interesting topic called
lock now if you have taken in computer
science classes or any operating system
class you have already learned about
lock lock is a very important concept
when it comes to multi processing and
operating system concepts okay so let's
go over this lock concept first of all
let's think about why lock is needed in
our real life in our day to day life
there are resources which cannot be
accessed by two people at the same time
for example bathroom okay bathroom door
have a lock why because if two people
try to access it at the same time is
really gonna create a pretty
embarrassing situation isn't it so
that's why we protect the bathroom which
is a shared or shared resource with a
lock similarly in programming world
whenever two processes or threads are
trying to access a shared resource such
as a memory shared memory of file or a
database or it can create a problem so
you need to protect that access with a
lock what happens if you don't add that
protection I am going to show that by
running this goal so this program is a
banking software program and here
I have two processes you can see them
here the first process is depositing
money into a bank and the second process
is withdrawing money from the bank and
in the end I am printing the final
balance okay so I am starting with a two
hundred dollar balance
in deposit section I am depositing $100
so I have a for loop which I traced
through 100 times and in each iteration
it will add one dollar to my bank
account and similarly in the withdrawal
I have same loop which is 100 times and
every time it will deduct one dollar for
my from my bank account so in the end I
should have $200 left here okay now I'm
using a shared memory variable called
value so if you remember from my
previous tutorial this multi-processing
value is a shared memory resource let's
see what happens when you try to run
this program okay it printed $200 fine
so sometimes it will work but sometimes
it will print inconsistent results so
I'm going to run it multiple times this
time it printed 205
201 so you can see that every time it's
just printing different values now why
does this happen
this happens primarily because when this
process tries to read this variable
called balance not value which is in
shared memory let's say this has a $200
value it will read it and then it will
add one and then it will put back the
same thing into a same variable so let's
say this is 200 and it is doing this
addition operation at operating system
level so at operating system level it
will be executing multiple assembly-line
instructions okay so let's say we have
read the variable 200 it added one and
it's gonna write back 201 here now while
it is doing it at the exact same time
this instruction also got executed so
although I am depositing first and then
withdrawing what happened is when I try
to read this it will be still 200
because this guy has not written back to
the original variable okay so instead of
reading this as 201 it will read this as
200 and it will have a one-time 199 as a
balanced-load value instead of 200 so
that's why you are getting this
inconsistent behavior all right so now
let's use log to log the axis okay so
what you are going to do is create a log
variable and use multi processing
modules log class this is how you create
a lock multi processing dot clock okay
and pass that log to both of these
processes okay
and now here I am going to say lock dot
acquire so to put a lock you just call
lock not acquire function and then to
release a lock it's a release function
so it's pretty intuitive and
straightforward
okay so lock dot acquire and then lock
dot release now this section of code is
called critical section whatever part of
your code is accessing the shared
resource which you want to protect that
part is called critical section so you
always have to put locked or acquire a
lock dot release around that critical
section okay now let's run it okay
so now it's going to print 200 every
time so I'm running it multiple times
just to prove that I am NOT making this
up
it now works okay so the guys who write
your banking software they better better
use lock otherwise you will have cows in
your bank account injections you know so
yeah using lock is very very important
ok so that was all about locks we are
going to cover a few more multi
processing concepts in future tutorials
multi processing learning multi
processing with python is extremely easy
and I hope all of you are having great
time and I am pretty confident
all of you can done Python very easily
by following this tutorials so thank you
for watching and I'll see you in the
next tutorial bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>