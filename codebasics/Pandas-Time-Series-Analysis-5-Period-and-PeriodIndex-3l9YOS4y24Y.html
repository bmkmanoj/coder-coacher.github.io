<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Pandas Time Series Analysis 5: Period and PeriodIndex | Coder Coacher - Coaching Coders</title><meta content="Pandas Time Series Analysis 5: Period and PeriodIndex - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/codebasics/">codebasics</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Pandas Time Series Analysis 5: Period and PeriodIndex</b></h2><h5 class="post__date">2017-08-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3l9YOS4y24Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">when it comes to time series analysis
and pandas there are two important terms
that you need to understand the first
one is time stamp here I have apples
intraday stock price charge and each of
the price point is associated with a
specific instance of time for example
here one sixty one point $22 is
associated with August 10 two p.m. and
this August 10 2 p.m. which is an
instance of time is called time stamp
but when you're looking at apples
revenue for 2016 for example that
revenue corresponds to a time duration
or a time period which is January to
December so this one is called time span
and in this tutorial we are going to
talk about time span period and period
index I have a Jupiter not book launched
here by running Jupiter not book on my
command prompt and first I am going to
create the 2016 yearly time period and
the way you do that is by running PD dot
period in the bracket specify the year
and you can see here that it created
this period object a Dec means the
period is annual which is ending in
December if you look at all the
properties of this period you will find
many useful properties such as whether
this year is a leap year or not what is
my start time and what is my end time so
let's try few of these the first one is
start time which as expected is 2016
first January the end time if you have
any gas would be 31st December
you can also create a monthly time
period by supplying the month here and
you can see if my frequency is month and
that created a monthly time period and
you can run start time and end time on
it and it would be the first January and
the end time would be 31st January now
the good thing about period objects is
that you can perform asthmatic
operations for example in this month if
I add one more month it will give me a
month of February now if this month was
let's say 2016 February political hos 16
December and when you add M plus one it
will take you to 2017 so it is fully
aware about the calendar and it will
give you the expected result let's
create a daily time period now for daily
time period you would say let's say 2017
February 28 by default if you don't
specify frequency it will use this daily
frequency it will try to automatically
derive the frequency here and if you
want to be explicit you can just supply
a frequency parameter like this now when
you add one day into this day time
period it will take you to first March
now you would think that whether this
period object is aware about leap year
or not so for example 2016 was a leap
year and when you add one day into 28th
February
instead of getting force March it gives
you
29 months because it knows that this was
a leap year and it had an extra day in
the month of February so this is pretty
smart you can also create weekly time
period over the time period so for
example this one you can convert into
hourly if you just do this and specify
an hourly frequency I will just call it
h it created an hourly frequency and if
you do start time and end time so start
time is this and time would be the end
of that hour which is 23:59 again when
you add one hour into it it will take
you to 29th February so this is fully
intelligent period automatic you can
achieve the same result by using pandas
offset like this so in this hourly time
period I can add panels offsets hour one
and it gives me the same result you can
add like fire worse than hours whatever
you know and here also you can like
subtract you can say okay give me the
time which is six hour prior to my
original time period and it should work
as expected in financial time series
analysis people often use quarterly time
period because companies report their
financials based on quarterly at least
in u.s. most of the companies are
quarterly fiscal reporting companies one
quarter means three months and typically
you have four quarters in a year I our
typical quarter starts from January and
in March the second quarter starts in
April and
in June and so on okay so let's create a
quarterly period so for example I'm
creating 2017 q1 it created this
quarterly time period DC means quarter
ending in December okay so then you do
quarter plus one it gives you the second
quarter you can do start time end time
it will give you the expected result
which is 4017 q1 it will be first march
and first January and 31st March now
there are companies which has little
different fiscal year the fiscal year
which doesn't align with calendar year
for example Walmart their fiscal year
ends in January
most of the companies are January to
December this particular company is
February to next January okay so if you
are processing fiscal or data for
Walmart how would you create the
quarterly here well in the frequency you
would specify Q ending in Jan now what
this means is my period is ending in
January and you can verify that by
printing start time end time so here you
can see that 2017 q1 start time is
actually longer surprise this is true it
is in 2016 February because they're your
would end in January so it has to start
much early okay so that q4 will be
November 2016 to January 2017 you can
also use else frequency function to
convert this frequency into some
different frequency so let's say let's
say I want to convert this quarterly
frequency into monthly frequency and you
need to specify how do you want to do it
so I would say
use your start time and when you do that
you get a monthly time period which is
February 2016 you can also use n time
which will give you April 2016 so this
is how you can convert one frequency
into other frequency okay so let me
remove this and let me show you
something else so you can now create a
second period okay which is let's say
2018 q2 okay so my q2 is this and you
can perform a thematic between two
Peters so if your two periods you can do
addition subtraction etc and it will
tell you that there are five quarter
waters between this q2 and this Q okay
now you cannot perform as magic
operations on sequences that kind of
doesn't make sense
for example quarterly and hourly if you
try to subtract hourly form quarterly I
think it's not going to work
so you have to supply some sensible
input to you're asthmatic operators if
you go to pandas documentation it will
list all the possible frequencies which
are supported we used Q gen there are
weekly frequencies also our typical week
ends on Sunday so you would use W Sun
frequency but for countries like Egypt
where the week ends on Saturday because
their weekend is Friday Saturday so for
Egypt you would use W SAT frequency to
represent a week okay now we are going
to create a PZ
Index so if you remember from our date
time index tutorial there is a date
range function which you can use to
create date time index similarly these
periods can be used as an index into a
data frame and the index which has
period is called Peter index
so let's create some index right so PD
dot period range let's say I am creating
PDS between 2011 and 2013 okay and my
frequency is quarterly so it created all
these PDFs so I have all the quarters
between 2011 and 17 now again for
companies like Walmart you would use Q
gen so it will create these kind of PDS
now you're wondering why when I say 2011
it started with 2011 q4 so this argument
2011 means our calendar 2011 but that
calendar 2011 gets translated into
fiscal 2011 and that will be equivalent
to 2011 q4 I know it's confusing but
let's look at that a little bit in more
depth so I'm going to put in the start
time and end time of 2011 q4 okay so let
me put in end time now and here it says
that the 2011 q4 start is in November
and N is in January okay so since this
is curlier is an ending in January that
particularly q4 okay so that's what is
2011
q4 means for Walmart okay
and since you say - I won Peters between
2011 and 17 it will start with 2011 the
first quarter which is water for for
Walmart as represent is represented by
these days if you don't want to give
start and end date you can just give
number of
so I can just say I want to generate 10
periods okay with frequency this and
that will do the trick so this is pretty
much same as date range function okay
now you can import numpy module and use
an umpire's random function random
number generator to create a series so
when I create this series it looks like
this so I am using a period index here
and filling in some dummy values when
you type PS dot index it will show you a
period index years now the benefit of
period index is you can do partial
operation so for example here I am
seeing a P all the periods between 2011
and 14 if I want to retrieve only 2011
quarters I can do it like this if you
are interested in retrieving quarters
between 2011 and 13 you can specify a
partial index like this and it will
return you the expected output here the
index is period index if you want to
convert this into date time index you
can do it easily by calling - time stamp
function this created me a new series
but the index here is actually date time
index and you can confirm it by calling
PST dot index and you can see that it is
a date time index converted from period
index you can convert date time index
back to period index by calling to
period method
okay and then you get a period index
back okay now we are going to do some
fun exercise
so I will go to Google Finance and
download Walmart's financials so WMT is
wal-mart sticker and if you click on
financial this shows the financial
results published by wal-mart company
okay it has very important metrics such
as revenue gross profit profit and so on
and if you are doing a financial
analysis of a company these metrics are
very important to make the exercise
simple I downloaded these results into
this simple excel file and I have only
three metrics here and in the header of
this excel I have the financial period
and the rows represent the matrix along
with their values and what we are going
to do is we are going to transform this
particular excel sheet into this format
where I have transposed the table and
set my periods as my index and I have
these two new columns called start date
and ended which represents the starting
and ending date of that particular
financial period and since this is
Walmart you can see that the start and
end date are not non-conventional you
know they are as per Walmart's fiscal
calendar which is ending in January okay
so just to summarize the goal of this
tutorial and create these two extra
columns okay so let's first import this
CSV into a data frame and my data frame
now looks like this
okay now I'm going to call that index
function because my line item column is
a regular column and I want to make that
an index and the way you do it is by
calling
set index you need to supply in place
parameter to be true so that it modifies
the original data frame otherwise it
will just return you the new data frame
and original one will not be modified so
now I have my line item set as an index
and I can use D F dot T property to
transpose my table so this dot T will
just transpose the table which means it
will convert rows into columns and
columns into rows so now I have my
periods as an index if you print your
index you notice that it is of type
object I want to convert this index into
a period index and the way to do that is
very simple you will call PD dot period
index function on your original index
and supply a desired frequency so my
frequency here is Q gen and when I print
period you can see that it converted
regular object type into a period index
type okay
now let's create the start date column
in data frame whenever you want to
create a new column you will just have
that column assigned to something so you
say DF start date is equal to something
now what is that something so I want to
take my index and I want to I trait
through all of the index elements and
sync these elements are period objects I
want to call start time on these objects
and the way to do that would be by
calling map so when you call map it
takes if function as an argument so I
need to supply some function which can
take these elements and return start
time from each of these elements now the
quick way to define a function in line
is by calling lambda so lambda X X dot
start time you can notice that start
date column is created and it has an
appropriate start time so 2017 q1 is
typically started in 2016 February okay
so this is working as expected you can
create ended column in similar way by
calling end time and here you have a
desired result your start date and end
it columns created as expected this is
all I had for this tutorial the link of
this Jupiter notebook is provided in the
video description below so you can
download it from github you can play
with it and I would highly recommend
using pandas for our financial time
series analysis because we just saw that
it makes a lot of things easier you know
it makes all of the time related time
and data related of operations extremely
easy you get things ready made and the
benefit of this is that you can focus on
your business logic instead of worrying
about the syntax or details and
reinventing the wheel again in again
thank you very much for watching I will
see you in next tutorial bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>