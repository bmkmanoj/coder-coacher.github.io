<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Perf Best Practices in a SPA | Coder Coacher - Coaching Coders</title><meta content="Perf Best Practices in a SPA - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Love2Dev/">Love2Dev</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Perf Best Practices in a SPA</b></h2><h5 class="post__date">2017-03-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GKxkzu0pHUc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi it's Chris here with love dev and
today only to post a video sexually an
old video from a presentation I did it
at O'Reilly's velocity conference in
Santa Clara California back in May of
2015 and the title of this presentation
is I don't know crap
thanks t-that's that was really awesome
to have you introduced me and to be up
here at velocity and to share a talk
about two things that I'm truly
passionate about and that single page
web applications and making really fast
web experiences so hopefully this
morning I'll be able to share some
knowledge based on experience over the
last five maybe six years really and how
I apply that to building really good
user experiences and that's ultimately
what I try to do is take the user and
put them first and something I call user
first development and I think that's
something that a lot of developers
struggle with because we we tend to
think of development from our
perspective and I call it developer
driven development of developer first
development and I think some of the
approaches I've had to learn to do kind
of go against that grain and so
hopefully it'll make sense to you as we
go through this and it'll be educational
so like Steve said my blog is loved to
death and I go through phases where I'll
post a lot and I'll come back right now
I'm kind of in a phase where I'm posting
a lot so a lot of good stuff and works
I'm on Twitter quite a bit too and I
share a lot of stuff about web
performance optimization and just web
development in general and you can
follow me at chris love and if this will
go there we go all right so Who am I
always try to share a little background
information on me I've been doing web
development literally since 1992 back
when I was in college and we had on
we're on the fiber there and we were
starting to publish articles and stuff
and I say that because it actually is
kinda interesting because with single
page applications we've kind of gone
back and leveraged a feature that we
used back then primarily the hash
fragment to drive the application and I
think it's commissioned how that's kind
of come full circle from something back
then where we used to just publish these
big long articles with table of contents
at the top to something we're driving
this really rich experience off the same
exact mechanism so for the last eight
years or so I've been an asp.net MVP and
also an ASP insider it means I get to do
interact a lot with the team up at
Microsoft that builds and manages the
asp.net
a stack for them and it's been a very
interesting experience and really driven
me professionally and a few years ago I
actually went to an Internet Explorer
session at the summit up there looking
to pick a fight and wound up being asked
to be part of a program called the user
agents which has been fascinating
because that gives me a lot of direct
access to the Internet Explorer team who
is also proxied and introduced me to
guys on Chrome and Firefox but more
importantly it's given me a lot of
insight into how browsers work and how
they go about writing and organizing and
architecting the browsers which in turn
allows me to understand better how to
architect my stuff so I can leverage the
browser infrastructure to make things go
a little better and like Steve said I've
written a few books like I said the last
one is the single page app book which is
still available it's only ten dollars
and it's about a year and a half old and
there's some things that I did back then
that I've kind of refactored that it
will probably come out a little bit miss
talk you think about it's anything it's
eighteen months old and our world is
tends to get stale but a lot of core
concepts are still valid and I still
leverage them quite a bit
and you're gonna see those coming out as
we walk through the application now the
unfortunate thing is that I built the
demo application I wrote the book and
it's a demo that I've been using
probably for four years and refactoring
along the way and it's been based on the
Rotten Tomatoes API so it's like a movie
application sort of like a Fandango or
something like that unfortunately about
six weeks ago I realized that the Rotten
Tomatoes API is more or less becoming
deprecated which means my application
doesn't really work that's forced me to
have to build a brand new demo
it's a let's just say it's still kind of
baking there probably be some some
demons that we're gonna walk across here
a little bit but for the most part it's
it's coming together nicely I had a
question already posted on the the
session on the side about where's the
repo well I finally got the repo
officially public this morning and as
well as a slide deck the slide deck I'm
going through is also available as well
I put everything up on SlideShare my
repos up on github and I'll also send
the slide deck to the
or key organizers at velocity so they
can make it part of that as well so this
this is the one slide you want to get so
they can get the slide deck and go get
the coast if you want take pictures go
ahead I'll wait
there's lost there pal I think it's like
30 slide decks up on slides here and
I've got I don't know three or four
dozen repose and a lot of the repose
that are up there are little modules and
libraries that I'm gonna use in this
application to drive this experience in
particular I have a spa
Jas library and that kind of drives this
the single page application experience
and I've also added a view engine
concept to it there's a little caching
library and some some other little
things that I've built out of necessity
over the years to kind of drive this
experience the movie repos up there as
well so you can go kind of poke around
my repos and kind of get an idea of some
things I've been working on so single
page apps and everything all the way
who's actually written or tried to write
a single page web application okay
that's that's a pretty good number of
you out there good well so I've kind of
got on this journey over the like I said
the last six or so years maybe even more
they all kind of run together but if you
go back to when Steve produced the high
performance websites book back in 2007
there was I was kind of going through
this phase right there where I was kind
of starting to lose projects to some
other shops that were primarily PHP and
not dotnet and I always have been a
dotnet guy for a long time it was kind
of curious to me because I had to figure
out what was going on and what it really
boiled down to is they had learned how
to use jQuery at the time and so I
started kind of learning this jQuery
thing and somewhere in there I started
using the jQuery UI dialog and if you've
done any web developer over the last
decade or so you'd probably use
something like the jQuery UI dialog or
some other modal dialog concept and it
got me thinking right hmm all we're
doing is just showing hiding stuff on
the page and so we look at code and it
looked sort of like this this is
actually something I think I ripped off
their demo site
but you'll notice that all this is is
it's just a regular div and usually
place those somewhere down at the bottom
of the page and we would through CSS
styling somehow or another set it to
display:none and it'd just be hit him
and just be sitting down there in the
Dom and then when it came time to render
that dialogue over the content that we
were using we would it would just
implement this display block part right
there and that would be the only thing
that would change and then that modal
dialogue would display we would interact
with dialogue we hit OK or cancel or
whatever it was to submit or or dismiss
that dialog and it would just change the
display setting back to none and of
course process you know any kind of
posting or whatever we needed to do so
if you're like me maybe your wheels
started churning at a time and I was
working on I wouldn't say is necessarily
a large application but it was kind of a
complex application was a data entry
line of business application here in the
enterprise that's that's the majority of
what you wind up doing is his forms of
her data kind of stuff but it was it had
a lot of pieces to it and there was
actually a lot of dialogues in this
application so it was a really fertile
application to kind of drive my mind set
on this so I started kind of toying with
how can i leverage this high performance
or what performance optimization world
with this concept I've got in my head
because I don't know what call it at the
time you got to think about this is like
2009-2010 timeframe that this is this is
going on in my head and so I started
kind of playing with what if I put all
the pages into a single page see where
this is going and and I started showing
and hiding these things and I went
through a lot of gyrations trying to
figure out how to do this and it was
kind of well I'm a little side projects
that I'd do at night and stuff like that
so but after I finished that we wrapped
up that project you know a couple more
kind of came through and then the owners
of the company decided to peel a few of
us off and build a product that we were
going to sell and this was this was a an
opportunity that my initial plan was not
to do what we call a spa today but it
would really kind of forced my hand to
go
down this path and we started in mid-may
and by the end of the summer we launched
the application with 400 views in it so
we went from nothing to 400 views and
when I say a view that directly
correlates to a classic page and I try
to use views to really indicate a spa
because it's a different kind of beast
of an application no requirement of this
application it had to be modular and it
had to be extensible one of our plans
with this product was to be able to
build kind of sub applications inside of
this it really was more of a platform to
launch applications and within and we
wanted to make it something that we
could extend and an offer and just keep
adding more to it and then open up like
a marketplace so that third parties or
customers themselves could write custom
modules to this so there was a lot of
pieces to have to manage and think about
was this gonna look like in a year or
two kind of concept and of course we had
to do it in four months and here was the
biggest thing I had nothing to reference
at the time there really wasn't any like
this is a spa library this is a good
mobile first library oh it's the other
thing too we had to make it work first
on the phone and then tablets and
desktop as well and it had to be a good
experience across all those so I had all
these these challenges of course the
time everybody's like all native
applications but I can't realized the
native application was not gonna be
something we were going to be able to
launch cost-effectively and somebody was
talking to be a little head of time you
know when do you use native when you use
web and I say 99% of the time just as go
ahead with go with web because more and
less you're not going to need some of
the native features but you can also
make web experiences that are just as
good if not better than what we see out
of native applications and and I know
that because I've built a lot of
experiences like that and a lot of times
I'll actually look at native
applications and I'll try to apply them
to the web and I can usually make it go
faster and I do look at native
applications because they got a lot of
good UI stuff all right so I learned a
lot of
in this process one with 400 views and
you're trying to load it over a cellular
connection on a phone it doesn't work
very well you think about all the markup
and all the JavaScript and all the CSS
is involved and support you know right
out of the bat having 400 views
available it doesn't go very well and it
was about two weeks before we were
officially going to launch and I was I
was at a Phillies game and this lady
sitting next to me was we were talking
about kind of before the game and turned
out she was a target customer for this
particular product I mean we I was
telling her about it and she was getting
all excited she's like that will make my
job a whole lot easier and I was like
woo and she goes can I see it I was like
okay let me pull up my phone all right
so this is like 2010 I think anyway I'm
on Sprint 3G who has Sprint 3G or has
suffered through Sprint 3G I had like
the worst failure carrier in the world
slow I mean just really dogs slow 3G is
more like edge at best okay home sprint
and I know that because I've seen like
analysis and like PC Magazine and stuff
like that just showing how much slower
sprint was an AT&amp;amp;T and Verizon and
t-mobile at the time so look about my
little phone and try to connect to it
and you know I'm in a ball park with
about 35 to 40,000 other people and you
know just like we're here today you know
my phone's on poor gene here today the
one or last I checked and it was a
little sluggish didn't go very well she
was not very impressed and I don't blame
her it took about a minute to get the
login page up which was our initial page
to to go into didn't didn't go over well
and I knew there was a lot of stuff I
need
I still needed to work on I was just one
of those things that kind of emphasized
the work that I need to do to make this
thing go faster and have a better
experience so I had over the years I've
tried to figure out how not to load
everything at once not only is it just
loading but also when you have a lot of
say Dom elements in the browser they get
more sluggish
just because there's so much more they
have to process so one of the one of the
goals you've got to have is try to keep
your Dom as lean as possible and not
only is that a load time performance
enhancer but it's also a runtime
performance enhancer and like I just
kind of with that story mobile really
matters and this is something I see even
today most developers especially
enterprise don't consider this and I
think this is a big mistake a lot of
enterprise this IT decision makers
development leads that I that I talked
to don't seem to think that mobile is
happening in their company and another
story I like to tell about that I was at
a company in and I was in a meeting with
a development lead and she had 1500
developers that worked underneath her
between the US and India and we're
sitting in an office and it's one of
those offices I had a glass wall so you
could see the cube farm out there and it
was you know all her developers that
were there's you know probably up 50 of
them right there immediately with us and
she was telling me that that their
company doesn't do mobile yet I'm
looking at the cubes and they had like
short walls I could really see a lot of
stuff I was looking at tablets on ever
almost everybody's desk everybody had a
cell phone and I was looking around the
conference room she was the only one in
the conference room that didn't have a
tablet she was checking email and taking
notes on so for her to say that mobile
didn't matter in their company even with
her developers I think that was wrong
and when I talked to the actual business
folks they all like to use mobile and if
you're like me and you you get to travel
a lot you look around at the airport and
you see a lot of iPads and Frank and
pads turned into the you know trying to
be laptops or like a surface and I've
talked to some of these people and
they're like oh yeah I've got my
corporate issued laptop sitting in my
suitcase over there but it's a big
honking Beast I don't like it and I like
this device much better so we just know
how to get in the network without the IT
guys know how to do it so people are
getting around it and they're doing
mobile whether you like it or not that's
another advantage that being on the web
gives you you don't have to worry about
the device the person uses you should
able to meet them at their at their
choice and give them a reasonably good
experience the other side is you've got
to understand it at least 25% of the
time people are on cellular connections
and if you look at the stats like free
Commerce and stuff we're getting past
the 50/50 threshold where people are
more and more on mobile class devices
and you've got to consider and assume
that they're on some sort of cellular
connection and like I said test over
Sprint 3G or some facsimile thereof you
know it says this is actually a great
experience here if because I was sitting
over there also the network got dog
slowed it was a great test experience as
I was kind of walking through making
sure the application works right and I
was like oh yeah this is this is really
bad either that or go to a hotel several
times last night the hotel Wi-Fi went
completely down on me or take a flight
and try to connect to the in-flight
Wi-Fi and see what the experience is
that way if you're like me and you fly
Southwest they all have inflight Wi-Fi
the problem is they have the airplane is
sitting there streaming TV through the
disc the free DISH Network offering so
yeah there's not a lot of bandwidth on
the flight so that's also another good
test to see if your application is
structured well so like I said back at
the back at the that time I had no clue
what I was really doing I didn't know
what to call it necessarily I just
started calling it a modern web
application well other people who seem
to have more influence than I do I
started calling it a single page
application and I kind of liked it
plus we get to use the term spa and I
can find these really groovy pictures to
thing behind everything so we'll call it
a single page application and we'll go
from there right so there's a lot of
pieces to what a single page application
is and there's some concepts that I
think developers need to kind of grow to
grok and just get a hold of and some of
that is what exactly is a spa well like
I said it's composed of all the views
the views which traditionally would be
individual pages but instead of making
those individual requests to get each
individual page render on the server
we've got to kind of move some of that
constant some of those the mechanics up
to the browser now and we got to
understand that our spa has
all the views are all the pages to
compose our application available in the
client now or like I was talking to
Steve ahead of time when I go into these
enterprises the spa thing is really new
and there they're still kind of
intimidated by the concept and so what I
usually tell them to do is kind of go
down this you know do like a spotlight
pick a few pages that are related
compose those together get your head
wrapped around what the experience is
like so I call that a spa lit and I
think that's a good transition sort of
like when I was talking about the jQuery
UI thing it's effectively what I did I
went from a dialog to like some spa like
concepts and then up in fact when we
built that big application back in 2010
that's more or less what I had to do I
had to kind of group some of those
modules into a single spa before I could
get my head wrapped around how to make a
big full application spa and along with
all the views you've got all the styles
and of course you've got all the
JavaScript so you've got a lot of things
that are that are running in the browser
that wouldn't necessarily be there or
necessarily have to be there and of
course the spa mechanically you're gonna
leverage Ajax
or maybe even sockets if you're if
you're really fancy to make those calls
back and forth to the server to get data
or any other assets and resources you
may need and I think if you're doing it
right you're gonna be leveraging storage
and you're gonna see I use local storage
quiet exhaustively or a lot for a lot of
reasons and I was I was very excited
when I was watching Patrick's talk
before because a lot of those things are
really gonna help in in this aspect of
what I consider a good spa and of course
like I mentioned before you want to
leverage the hash fragment to drive the
deep linking kind of experience into
your application there's there's a
couple advantages to that it does
trigger an event that's your applicator
framework can pick up on and drive what
I call view swapping but it also gives
you that deep link experience so that
you can give somebody a link directly to
the output to that particular content
and it will hydrate itself based on that
link and the way you get around a
problem that
was kind of problematic especially with
like Flash and Silverlight with the rich
applications kind of getting deep
linking there was a lot of kind of hacks
that like that both of them did to kind
of drive that experience and some one
was based on this hash fragment thing
now another thing I learned the hard way
talking about the phones as mobile
browsers and these really kind of pushed
me to make a lot of decisions at the
time and they still do and I always make
these be my limiting reagent kind of
determining how far I can push stuff and
something I learned really quickly is
that the mobile browsers tend to
aggressively purge browser cache in fact
when I was working on that application I
learned real quickly that the iPhone
does not at the time did not cache
anything that was over 26 kilobytes in
size and I think Steve even had a blog
post or two about that and some tests
online to kind of to test that and and
so that was a real big problem so back
then I was using jQuery to build all my
applications from and jQuery completely
gzipped and minified was somewhere
around 30 to 32 kilobytes it was it was
too large so every single page requests
back and forth to the server meant that
it was going to reload jQuery along the
way it also meant any images that were
more than 26 kilobytes were also going
to get pulled back across the wire every
single time and that was not a good
experience and that was causing a lot of
problems in my early spa endeavors with
customers and myself and it was really
frustrating so I had to learn to adapt
and I'll talk about that here in a
little bit another reason why the
browser's purge a little more often is
because they've got a smaller memory
available to them and they've also got
weaker processes right so not only is it
in you know memory but the storage and
the processors just aren't as strong so
to compensate for that they tend to
jettison stuff when they determine that
it may not necessarily be needed anymore
and you don't really have the control
over it even on the desktop you don't
have control the desktop essentially has
an infinite storage bin for it so it
doesn't purge it quite as often
so the mobile browsers really kind of
forced me to kind of make some decisions
the next thing was like I said the
cellular connections they're obviously
slower than broadband and I think this
is and here's a common problem that most
developers have I think we need to make
some sort of effort to get developers to
understand that they need to test their
application beyond local host because
local host you don't have the network
latency and you definitely don't have
cellulite and C's I love the fact that
the chrome developer team is added like
the cellular emulator in the developer
tools where you can kind of spoof
different bandwidth types like you know
3G and stuff like that
to give you a reasonable idea what this
might this experience might be like own
on a phone or a cell your connection but
nothing beats having a real cellular
connection so you know like I said
hotels and airplanes nothing else
tether off your phone if you can do that
I actually do that from time to time
just to see what the experience is gonna
be like
unfortunately 18t seems to be getting
really fast lately and it's not giving
me as good of a test so to speak
another thing is solar connections are
kind of unreliable like I said I was
sitting over there in the first session
and my my connection was dropped down to
like two bars on 4G in my house it's
essentially a dead zone in some places
we have to stick the phones in the
windows half the time or if you drive
through tunnels or if you go to my kids
school their school building seems to be
a Faraday cage it doesn't let sell your
signals in or maybe that's just my
teenager not wanting to text me back I
don't know so but always assume that
connection is unreliable which is why
the Cole concept of offline is is big
and I don't see enough people working
towards doing offline stuff and here's a
big one and a love that Tim Kadlec
created the site what what does my site
cost I come because I had been thinking
about doing the same thing but he beat
me to the punch which save me some time
but if you really want to know what it
cost somebody to download your site rent
through a web page test or just take it
straight to well what does my site cost
com
and he gives you roughly what it's gonna
cost for somebody to download your site
assuming that their own published
expensive data plans in different
countries and lo and behold that
watching for some reason is extremely
expensive but anyway always encourage
you to do that now that's a big deal
because when you go look at how much
bandwidth each page or your application
actually requires to to work and then
put a dollar on that you know it should
not cost the user more to download your
page and it cost to buy your product
always keep that in mind okay and I
think a lot of pages don't and this is
one my favorite pictures now ladies
Jason Grigsby calling the term somewhere
in the last couple of years we've
created the web in our own image and
it's obese and that's that's definitely
true now you know go around talking
about web performance optimization all
the time and I was feeling kind of like
a hypocrite in a way so I went to the
doctor mid-december and I weighed in and
I was about thirty pounds more than I
expected to be and it's like I got to do
something about this so I set up this
year to lose to lose weight to get back
to where I was in college and and so
since the beginning of the year I've
lost 70 pounds and I can tell you flat
out I feel a lot better I actually feel
a lot like I did in college and I think
we've got to do the same kind of put the
same kind of effort and energy into our
websites so you gotta HTTP archive org
Steve publishes stats twice a month and
I think these are the beginning of maze
stats right here and there's some really
sad numbers here the average site has 99
requests and it's composed of over two
Meg's
of content and to me that that's a
really bad sign so I put this way back
in 96 I wrote a graduate thesis at 186
pages I could fit that I think four
times on a three and a half inch floppy
disk the average web page at least the
home pages here would not even fit on
that floppy disk anymore and that's
that's to me that's a really sad state
of where we've gotten with the web if
you look at some of the other numbers
it's 18 JavaScript files 318 kilobytes
and on down
it's just not a good sign
of course out of the two Meg's 1.3 is
images and I will talk a little bit
about images as we go through those the
thing about it I and Steve can correct
me from looking at the data that he runs
through there is really home pages but
as I go through and I kind of analyze
you know deep deeper linked pages and
sites I see a lot bigger numbers to me
these are really conservative so a lot
of times I'll go and analyze like you
know inside pages if you will of sites
and applications and I see 5 6 10 15
megabytes if you got any newspaper site
and punching the URL from the newspaper
you'll be appalled at what you see he
was talking about a thousand requests I
think a typical newspaper site is about
a thousand requests 318 kilobytes of
JavaScript and I think a lot of that is
a third party especially adware a
propagating around the web but you know
I see I'm seeing more and more problems
I'm going into the enterprise I actually
left a project about six weeks ago and
they had over 550 kilobytes of
JavaScript already and they just had to
partially working pages and I thought
that was a big travesty and they didn't
like the fact that I was kind of
pointing out the the problem with that
but I'm seeing more and more sites that
have over a Meg or even close getting
close to 2 Meg's of JavaScript in some
cases and they're just layering on
framework after framework because this
one had this little small feature this
one had this little small feature and
it's really causing a lot of problems
with sites loading they were just
rendering you know and and so we've got
to figure out a way to fix that and if
you get into single page applications
the potential for a lot of JavaScript
and CSS is high and so we've got to kind
understand how to keep this to minimum
without making it too truly difficult
for developers so I've come up with this
thing I'm gonna call them fast food
frameworks and love us are familiar with
these guys there are a lot of the big
libraries and frameworks that we've come
really happy using now the problem is
they're all big and some of them are
bigger than others and most of them are
not modular and the other thing I've
found too is I
tract memory leaks in a lot of them if
you're building a single page
application your application is very
sensitive to memory leaks because
somebody should especially in a lot of
business I have a rule I want the person
to be able to get to work
login to their computer at nine o'clock
on Monday morning and not have to hit
refresh if possible on that application
until they go home Friday afternoon when
they turn their computer off now if I've
got memory leaks in my application even
small ones but they're just gonna
gradually build up until the browser
can't move anymore it's just going to
crash for example I can spend about 10
minutes on my iPad on Facebook and crash
mobile safari and that's because there's
I've tracked a ton of memory leaks and
react and so whenever I consider a
framework or a library or something I'm
working on I always try to do memory
profiling in there too and make sure I
get that stuff cleaned up but you know
like I said they're very large they're
necessary modular bootstrap is kind of
the exception to modular a statement of
course it's a CSS library and it's got
some jQuery components to it as well I
don't use those but bootstrap is
actually modular if you know how to
create a less file to compile it the way
you needed to be compiled and of course
we've got some other advantages I'll
show you here in a little bit too so
something I had to learn the hard way is
I had to get rid of jQuery and I was
very painful because I loved jQuery
jQuery was my best buddy I told I told
somebody jQuery is really the Ironman
suit of web development you know or the
Dom elements if you will and it just it
just opened up a whole new world for all
of us but like I said jQuery was big and
it was causing my applications to load
slowly and as well they were they
weren't necessarily running as fast and
that's because they've got a lot of
cruft in there it's not that jQuery is
bad
the design of jQuery is fantastic the
but because it was trying to fix a lot
of you know issues with especially
legacy browsers and the variations say
on Android of browsers it got really big
and I've kind of actually noticed
they've been able to trim about 10 or
15% over the last six months which is
very admirable but I had to kind of
learn to to dump jQuery for a lot of
reasons
so it gave me faster load times when I
dumped that excess weight but it forced
me to have to master the Dom or the
browser api's and at first it felt like
a really intimidating thing but I've
kind of grown to learn there's only
about three dozen API calls that I
really need to be intimately familiar
with the rest of them I can learn as I
need to I don't necessarily need to use
them all the time but like a pen child
and stuff like that I use all the time
and I also learned that there are some
alternatives out there the person I
looked at was Zepto but Zepto was really
not good about backward compatibility at
all so I had to kinda know and there's
there was a few others I think filmer
group may have one and everything and
then one day I just one Saturday
afternoon I just created one called
dollar bill and I think I think minimize
I think it's like eight kilobytes and it
has all the functionality that I needed
from jQuery without the Ajax stuck in it
and honestly Ajax was the last reason I
was holding onto jQuery my applications
and I kind of looked at it and I found
it I found a couple of libraries and one
in particular I liked called request its
build already QW EST and it implemented
the jQuery API but is a standalone Ajax
called and even now I've actually purged
that one out and just replaced it with a
few lines of code that does mage acts
for me and I've abstracted it just a
little bit so I'm getting smaller and
smaller and smaller and losing weight
left and right this has also taught me
to be a lot more modular so one of the
big knocks I have against big frameworks
is that they aren't modular I can't just
plug and replace pieces of the MOG the
framework that I don't necessarily like
and I can't just pull out the small
piece that I do like remember I've been
in two different shops and they'll have
they'll have jQuery with backbone on top
of it with ember involved and angular
and also react because there's one
little piece of each one that they like
and for the life of me I don't know why
and I see I've actually seen blog posts
come out this year how to use angular
with react and I'm like oh my gosh
so but it's taught me to be a lot more
modular make everything kind of plug it
pluggable and the other thing too
the the fire hose that we we kind of
drink from goes really fast and we're
constantly refactoring coming new
concepts so like I say just use that
Ajax example for a minute so I replace
jQuery is Ajax stack with request and
then I replaced it with us with about 20
lines of code would be honest with you
for the core stuff but I was able to
quickly swap those out and some of my
applications because I'd made them very
modular and and pluggable and that's a
very key thing because you can keep
something that that you haven't really
had time to fix but you've made another
piece better and you can kind of
gradually improve stuff and yeah it was
painful for a little bit and I thought
it was gonna be a lot worse than it was
but in the end it actually was a pretty
great experience kind of getting rid of
that but to do that I did I did do a lot
of reverse engineering a jQuery Paul
Irish has some great videos on things he
learned by studying the jQuery source
code and if you haven't really dug deep
into JavaScript he'll watch those videos
it's it's it's a great kind of
intermediate advanced thing but in a
very approachable way so my ruling
against these fast food frameworks are
full of fat so there's a lot of pieces
in these frameworks you'll never use but
you still have to download the browser
has to evaluate those things so not only
is it bandwidth time the browser still
have to go through and evaluate and for
a desktop it's not really that big of a
deal that again when you get on the cell
phones and the tablets and stuff like
that it starts becoming a bigger and
bigger deal and when you've got 20 or 30
JavaScript files I have to get evaluate
and they're all a lot of clumpy
JavaScript and stuff like that it's not
that inconceivable to have a whole
second delay waiting for the JavaScript
just to be evaluated once it's
downloaded and there's a lot of
syntactic sugar this is a problem that I
also see with developers or they're not
trying to understand the browser API
they're not actually trying to
understand CSS or JavaScript and there
was a like I said I use local storage
quite extensively and I was trying to
show a developer on a team that I was
working with last summer how to use
local storage and he freaked out because
he saw this word this word this word
local storage and he goes where is that
in the angular library and I said it's
not part of angular it's part of the
browser because all you can't use it
then I'm a singular
and I've kind of run across that
mentality a lot and I think that's sad
because it's keeping developers from
actually learning the platform that
they're working on you can understand
the browser is your platform when you're
building single page applications and
they're loaded with preservatives I mean
there's just there's just a lot of stuff
that makes them stick around even after
you're kind of done with them you can't
really get rid of them so I'm a big fan
of micro jas libraries to go to my car I
think it's micro JSTOR he's the guy that
does depth it actually maintains that
it's a list of just hundreds and
hundreds of small libraries and they're
all small in fact the requirement to be
on there is gzipped you have to be under
five kilobytes and I'm finding that
there's a whole lot of stuff that I can
go out there and grab so for example
last summer I was supposed to I had to
work with thing or with angular and the
binding syntax I actually kind of liked
their bounding syntax but I found
another library called rivets 3.6
kilobytes compared to 120 kilobytes of
angular and all I did was just the
binding for me and it was it was great
they have a single focus they don't try
to do everything for everybody they're
not the kitchen sink solution so you
probably like I said you only need like
five or ten percent of most these
frameworks go find the libraries to
solve the needs that you have and
they're gonna promote a more modular
architecture so you can plug and swap
these things out and there's I think
over all your applications are stronger
because that and as developers it keeps
you kind of involved with it so with
single page applications there's some
there's some principles that I like to
say this is this is a good way to get
these things implemented first you have
to make them performance right you want
to make it a good experience and that's
the big advantage single page apps have
over legacy applications is they're fast
and the thing that really attracted me
once I kind of got into the groove where
it was I can build something that feels
like a native application and you know
that's the biggest compliment I get from
real users is when they use my
applications they go this is better than
the native applications I work with I
see I get that a lot and it's kind of
one of those things that really kind of
proves out that I did this right okay
and I keep stressing the modularity
point of view I want things to be
modular
I want to have a small footprint in fact
I haven't even gzip the code that's used
for this application when it kind of
work through walk through today but I
think it was like 56 kilobytes minimized
for the whole application and I'm giving
another example I worked with a start-up
here in the Bay Area last year and we
launched I think it had 75 views in it
and we launched with a hundred and
twenty kilobytes of JavaScript in it the
whole application so it's got a nice
small footprint and scalability and
scalability means a lot of different
things not only do you want your servers
to be able to scale out and you want
thousands and thousands and thousands of
users to use it simultaneously but you
also want those thousands and thousands
of years-- users not to create trouble
tickets all the time or help desk calls
and things like that so you want to make
sure that you've got you know your ducks
in a row and that it truly does scale so
that you you can get your most bang for
the buck and of course you want it to be
maintainable and this is again my stress
the modular thing plus your developers
if you get out of the frameworks I think
your developers will understand
JavaScript in the platform better and
they'll be able to understand and
maintain your application but one of the
other big things especially from a
business perspective is you want to have
that application last for a long time
and so not only don't want somebody will
use it all week long but I want them to
be able to use it for a couple of years
and only make minor tweaks if I have to
along the way and that that implies a
lot of stuff this is one of the reasons
why I love responsive design because it
gives me the ability to go ahead and
design an experience it's going to work
on a lot of different platforms a lot of
different viewport sizes and things like
that and still allow the user to be
productive and if I can do that I don't
necessarily know what devices they're
gonna use a year or two years out for
example the biggest rage right now is
wearables right so I've got a band and
of course a lot of people are ordered
the iWatch and stuff like that if you
don't think a browser is not going to be
on these things in the near future
you're you're probably wrong at the same
time we I've seen big giant kiosks and
monitors and stuff like 80 90 hundred
inch kind of TVs being used all kinds of
variability out there as far as how
somebody can interact with it so you
gotta kind of think ahead of time for
what can people do you know you know
touch has been a big
last few years but I think you're gonna
start seeing say concepts like Kinect
kind of start coming them to play and
somewhere down the line I'm sure things
like hololens and stuff like that are
also going to have an impact so start
thinking about how can we make this
thing adaptable
to take advantage of that now if we look
at the modern web application I like to
look at it and think about it as an
hourglass now we're in the past it was
more of a cylinder you typically you got
a lot of stuff going on at the bottom or
the back end of the application and
that's where your business logic your
database is services and things like
that are really humming along and then
in the very middle you've got a web
server layer and you know in the net
stack that's gonna be asp.net and I
guess the other stacks of Express node
PHP and Apache whatever you want there
we're in the past that would be really
broad there and there'd be a lot of
responsibility at that layer now today
that's really more of an API layer and
if you do a single page application
right you should only have one or two
endpoints of return markup so this this
little layer has gotten really thin but
a lot of those responsibilities have
been pinched up into the browser so
that's when we get this little hourglass
kind of look in the middle you've got
like little aperture there where they
can I communicate back and forth and
that's really the API going back and
forth another thing that you really got
to understand about a website or a spa
is that every time someone visits a page
or your site it's a it's a loading
process they have to install your
application think about it in these
terms they have to install your
application which means they have to
download it and then they have to boot
it right so you're talking about talking
about the JavaScript evaluation stuff
you got to think about it the fact that
they're downloading your code and then
they have to launch it so no different
than a native application where you sit
there and wait for the for the full
application to get downloaded from the
App Store and then you launch it where
that time you've you're probably about
45 seconds to a minute into the the
application engagement at that point if
you can make a web application fully
load and boot enough at least so that
the user can be fully engaged within
that one second goal which is always my
goal is try to get it in
one second threshold so that they
mentally are there you've far out you
far outpaced your native competition at
that point next thing you need to do is
the the initial request you've got to
understand the critical rendering path
and I'm sure we're people here are going
to talk about the critical rendering
path a lot over the week but this is a
big part of understanding how to
architect your application is knowing
that they're how the browser's actually
process the markup and the CSS and the
JavaScript and the thoughts and the
images and how all that stuff comes
together and so you need to kind of ever
stand how to architect your application
to take advantage of that for the
initial load so you get that initial
experience that you're looking for and
so I always look at well how can i
define a master layout of my page
because the spa works differently than a
regular web app because you're not
really rendering the stuff on the server
because if link let's say a passed
around a deep link like let's just take
my blog for example so I send you a link
to a post that I wrote four or five
months ago or whatever my blog is gonna
know how to instantly hydrate that but
I'm not gonna hydrate the markup and
stuff on the server at all and this is
kind of a debate that I get in with some
folks about how spas work and which is
faster server-side rendering or
client-side rendering well the the
server has no clue what page you're
needing to get rendered because that's
really gonna be masked behind the the
hash fragment the hash there so that
never gets sent to the server so it
doesn't know what it's actually
rendering so you need to kind understand
what the master layout is gonna be and
then another trick that I'm getting into
is is in lighting the critical CSS this
is kind of something I'm I'm kind of new
getting into it a little I think a
little late later than I should be but
get enough CSS in there so that that
master layout can get rendered almost
instantly and then look for the look for
the above-the-fold views what are the
were the first possible views that
person will probably go to and get that
CSS isolated out as well and then find
your core JavaScript and stuff like that
and make sure that that's initially
available so your application can start
running and make that as small footprint
as possible so in that case of that 400
view application going back and reacting
that today I'd probably start off with
like four or five views and the rest of
it I would defer or lazy load
and I'll show you kind of how that works
and that's what I'm talking about here
the deferred request is like the balance
of your application and most
applications are usually pretty small
and you don't necessarily need to be at
this level but 400 views you definitely
needed to be the 75 view application we
didn't do this
and I really felt bad about it because
we just didn't have a time to get get
this architected but something with 75
views you probably should have offloaded
this stuff and there's some parts that
you need to understand that the spa
needs to run that the server's used to
running and that's managing routing so
you need to have a little rowdy and
engine involved and a little trick that
I've learned that goes against the grain
too is to actually make the routes part
of my markup and have my spa engine
parse those out rather than defining
that in some sort of JavaScript driven
routing table I found it to be a lot
more brittle in the long run leverage
browser caching so Patrick was talking
about how service workers allow you to
cache content quite a bit and like I
said I use local storage lot and I use
it for some things that some people
haven't quite I don't know if they've
necessarily gotten to the main string or
not but I certainly do it and you've got
to maintain manager data a little
differently than you normally would have
to and finally the the client side is
responsible for the rendering worries
and traditional websites it's done on
the server and if you look at this like
a side view of my applications this is
generally what it is I have a small
library and I have a view engine that's
responsible for that rendering and also
parsing of the views and templates and
stuff and then I'll have a template
engine that template engine can like I'm
gonna show you today is really a 21 line
function but you can replace that I've
done a lot with mustache I did
handlebars for a while and I realized I
wasn't using 90% of handlebars so I went
back to mustache or like I said rivets
I've got another alternate version where
rivets which is a bonding or mvvm model
approach and over on the side I always
have an application object it doesn't do
a whole lot but it's really more or less
to kind of name space out the
controllers and the controller's map to
individual views if you're familiar with
MVC I kind of follow that pattern and
then I'll have like a data stack and the
data
does all my Ajax stuff but it's also got
a caching component to it so that it
goes through the cache to see if it's
there before you go down into the Ajax
and make the call and that's pretty much
it it's pretty simple anything beyond
that is really like I call a UI
component
so if markup management like I said I
want to keep the Dom glean I don't allow
leverage browser storage and persist the
markup and I've persisted in local
storage and there's actually one
Saturday back and I think 2011 I was
trying to figure out how to deal with
application cache and this led me to the
solution I believe I'm a gunner on
Steve's blog he was pointing out that
Google and being both offload their
markup and stored in local storage alpha
that was brilliant and I said gonna
wrote a prototype that afternoon and
that blog post is kind of the product
the product of that that afternoon so
I've really matured and pushed that
along in its bid to serve me very well
over the years so this view engine
basically like I said it parses the
markup for views and templates and it
stores all that into storage for me and
then I just retrieved the markup on
demand instead of essentially going back
to the server get a get out of local
storage and it also has the
functionality that obstructs the
template in your body and I put it into
a common interface that way I can
replace my 20 line function with say
rivets or mustache or whatever I want
there's there's dozens and dozens of
templating libraries out there so
whatever you you want to use feel free
to do it like I said the lazy low I'm
getting to the point consistently where
I can be well under 14 kilobytes and the
reason why that's important Billy Billy
was gonna speak earlier this week but he
published a lot of research around this
the way HTTP works the first packet is
14 kilobytes of actual data and you want
to eliminate the round trips to and from
the server so if you can get enough into
first 14 kilobytes to get that initial
rendering that's gonna be almost
instantaneous to the user the view
engine like I said it's still parses the
mark-up and caches everything and I also
set it up so on the deferred stuff it'll
actually store references for my CF the
CSS and script now to inject that in
there so that gets a little faster
and I'm getting better and better with
this so it's kind of a process so who's
heard of cutting the mustard yet okay so
this is something that is attributed to
the BBC I first heard of it I think when
a human was talking about how the
Guardian implemented it at a smashing
conference basically what you do is you
do some feature detection
in the the client and then if they don't
cut the mustard or else the browser
doesn't support some key features you
want then effectively you reroute them
back to the server and you you give them
that legacy website experience and you
the way I kind of look at it too at the
same time oh yeah don't use polyfills
so we're you're looking for features one
of the rules I have is to not use
polyfills so if something's not really
broadly supported I don't try to
leverage it yet until I feel comfortable
with it but this whole cutting the
mustard thing and going back and getting
it from the server it helps with SEO
because Google actually has a spec out
there or Ajax applications to be indexed
now the kind of the buzz here lately in
the SEO world is that the Google BOTS
can parse and do your spa applications
now and that that doesn't seem to be a
limitation anymore but they've had the
spec out there for a few years and I've
been implementing my sites they're
public to leverage this and it seems to
be doing fine they still have a lot of
SEO link juice and all that kind of good
stuff so I'm getting good placement in
the search engines so until I truly
trust that the search engines or or
partion through it I'm still going to
implement this so it kind of serves a
dual purpose if you've got to support
legacy browsers and search engines and
there's the link to it okay
like I said determine the pub the polled
using my rule is five to ten views you
know whoever can be accessible within
one click of the the first page is
usually what I'm gonna look at or
mentally what they might want to go to
for example I've got a link to the
privacy policy on my main navigation I
seriously doubt anybody's gonna go read
that so it's not in my initial load so
what this really looks like is you
determine like the initial views or
pages that somebody can get to and then
you kind of lazy load the rest of it
they kind of get added into the
application it just naturally flows from
there alright so the data management
this is kind of one of the big things
that that you should be doing with any
Ajax stuff now I'm just gonna I'm gonna
let you read these but some story that I
read about here's gonna for life and you
can't don't have a reference to it
anymore
they had analyzed
applications and they had determined
that the ones that they analyzed 96% of
the requests the api's were for data
that they had already gotten and had not
changed so if they had just cashed the
data locally their application we're in
a whole lot faster and their bandwidth
cost would have been a lot less and
their servers could scale more so make
sure you've got something in place to
cache the data somewhere in the browser
I love her something I got from Paul
Irish's he created a ajax pre-filter
just to store data in local storage and
so i'll leverage that concept and still
use that that main thing today so if you
look at local storage in my browser it
looks like this I've got all kinds of
pieces for my site and over on the right
I've got JSON data that has a lot of
configuration information a lot of data
that was retrieved so I don't go back to
the server and get something that hasn't
gone stale effectively if you actually
look down there's actually time to live
values associated with each one of those
references and storage if you look at
the actual flow chart to it this is what
it looks like
look at the data requested is that in
cache if it's not in cache where it's
gone stale then I go back through and
make the regular Ajax request and when
it comes back I catch that data with the
appropriate time to live that I you if
if it isn't cached let's go ahead and
return it so the timing on that's
usually about five to ten maybe fifteen
milliseconds compared to making a full
Ajax request to the server it's a lot of
benefit all around at that point
responsive images if you remember back
to the stats from HTTP archive writing
about 1.3 Meg's per page is nothing but
images and we were getting at the point
now where we're getting responsive
images implemented in most the browsers
and the way it's implemented in a way so
there's a natural fog fallback for
progressive enhancement kind of thing so
you can you can start kind of leveraging
this I haven't gone about doing this yet
and this is one of my tasks for the next
month or so is to start implementing
responsive images one of the things I
like to do if I can control the data I
want to have links or references to at
least four or five different image sizes
and those sizes are you know you can
also do art direction and that as well
and the reason is because I like I said
I don't necessarily know what they're
going to be viewing the content on
so I won't try to give them the best
experience I possibly can so you want to
do responsive images and try to have
multiple sizes available to you this is
a big deal because most even marketing
departments the stuff like that have not
grasped this concept yet so we've got to
figure out some ways to maybe automate
this as much as possible and make this
as easy as I can so there's some tools
I've been looking at and you can go and
kind of look with me and pay attention
my blogs I'll probably be writing more
about this over the summer another thing
to kind of replace images in a lot of
ways are fonts you can also do sprites
and SPG's and stuff like that I've
started to get more into the glyph fonts
like fun awesome and stuff like that but
again those font files can be rather
large so one of the things I like to do
is go to something like font ello where
I tell is really nice because it's got
like five or six different standard
glyph fonts that luckily use and you can
just go through and you can just select
the icons that you want to use and it'll
create a custom font for you and that's
actually what I did for this little
furniture site that I did and see now
you've got a little small font file
instead of more a larger font file and
then of course you want to implement an
exercise your common web performance
optimization techniques and best
practices most of these I still do not
see being implemented when I go analyze
sites and are brought into customers and
do analysis and reports for them very
rarely do I say bundling minification
which i think is should be like just the
the first thing you do when you go to
production first like me I don't know
why I don't know why CSS is scattered
throughout the page at all points and I
don't know why scripts are constantly in
the head and lots of them and I see lots
of inline scripts as well which is
really bad as well as putting scripts at
the bottom go ahead and add that async
tag I haven't really found much benefit
from it and my architecture and it's
maybe because of the way architected
it's not necessarily as prominent but if
I but if I use it with customers it does
make a difference
use the CDM back when Steve wrote his
book CD ends were super expensive and I
could not afford it so the best I could
do was create a sub domain on my web
server and put my images or something
you know like that up there but today
we've got Amazon we've got a juror you
know and
right now my my s3 cost for the last
five years has averaged about six cents
a month with the CDN thrown on top of it
I'm starting to use Azure and their CDN
and it's probably even a little bit less
be honest with you so go out there and
use the CDN and even if it's just like I
said the poor man's CD ends of Amazon
and use your that's another thing too
I'm not necessarily seeing leverage very
well in there there's gonna be a lot of
CDN companies here there's a lot of
competition in this space
another thing is optimized images I have
not done this for this application yet
because I've been kind of playing with
the image sizes and stuff try figure out
where I want to be at and I be honest
with you I had over 5,500 images so it's
been a little slower process and I would
have wanted for these images but I am
starting to go through and actually
optimize them and that means you know
essentially compressing the bits the
bits that are in there this is a common
problem that then I see across the web
so that one point three megabytes can
radically be reduced in most cases so I
was working for a big fortune on a 100
issue company last fall and they asked
me for some quick hits that they could
do to make what performance optimization
on their site and their site gets you
know several million page views of an
hour so I gave a lot of reference you
know things to point to one of the
things I pointed out was that their
images I could easily optimize the
images by at least 25 percent on average
if not more and I said nothing else look
at your CDN hosting cost and just cut
that by 25 percent and they like that
you know at that scale that's a lot of
money right there so that's exactly what
they did they actually went out at a
tool and started optimizing their images
and their bandwidth cost went down
dramatically dramatic dramatically
I wouldn't around long enough to see if
the customer response was good or not
but I'm pretty sure it was subtly there
and also HTTP cache if you notice the
stats there less than half the web uses
HTTP caching that's another bad thing we
need to do and of course shard your
asset about shard them too much I think
HTTP to you is going to change some of
that for us as well so there's a some
things around that so these are kind of
the best practices what I'm gonna do is
let's let's flip over and
look at the application so I've gone
from nothing to this application really
over the last three weeks on my spare
time so there's like I said there's
probably gonna be some demons we're
gonna come across so this is this is the
application in chrome this is actually
hosted up I got up on my virtual machine
so it's fast furniture love to dev comm
and you're the first people to see it
outside of myself and my wife who
probably hadn't paid attention to me
doing this but so you're the first
people to really see this outside of my
own workspace for the last few months
and I'll tell you what I did
like I said Rotten Tomatoes deprecated
their API and someone application really
wasn't gonna working well very well and
I had a customer about ten years ago
they were furniture store and they're
probably the worst customer I ever had
but anyway they when they when they went
out of business you know I still had all
their assets and stuff like that they
have over 5500 images of furniture and
most of them are really good
high-quality images to a certain degree
so I said hey I still got those images
let me just go generate a fake store
with all this stuff so that's that
specially what I've been doing I spend
half my time creating fake data based on
these images so if you go look at the
repo there there are lots of files there
the images are not part of the repo
they're actually hosted up on mazur but
I did instead of like tying this to a
particular back in data store or
creating a a true back-end API all I'm
doing is I'm storing JSON files as part
of the repo and I'm calling just serving
those those JSON files up so it's not a
true fullback in kind of scenario but it
is one of the things that I found to be
very beneficial with modern web
applications is having some sort of
denormalized no sequel kind of datastore
right behind the web because those tend
to work really fast serving up data and
let those lathe those kind of
long-running back-end processes kind of
work through something like a service
bus kind of message queue kind of
scenario for you and let your your
front-end data be optimized for the
front-end I've seen a lot of benefits by
doing that so anyway
this is the kind of a real simple site
at this point I've got some responsive
stuff in it but for the most part
they're gonna be there but it's kind of
your traditional site now I really have
always been a fan of Metro what
Microsoft calls Metro amount of modern
UI I really like that and a lot of those
applications have that horizontal
scrolling so I've got that in place here
too and I've kind of got them in groups
so it's kind of like a metro application
which I'm fond of but one of the reasons
why I did it this way is because this
homepage has a lot of images in it and
so it's very image intensive and so it
gives me a good idea of bottlenecks and
stuff with images and arc right now I
don't have these images optimized
somebody my waterfalls don't look as
good as I won't be right now but you
know if we can go here this is the
living room category and so you're kind
of seeing kind of how fast this goes
what I do there yeah they're now broken
it are the demons
we are trying to talk about a fast site
and it suddenly slows down as you
mentioned how fast it is let's just
relive it yeah it's probably the
bandwidth in here right this is what
happened while I was sitting there I was
going finally to just went to a crawl
and it looks like that may be what's
going on already let's go let's go to a
different browser reason why I went over
there is cuz I just figured out how to
get the the cross-origin stuff several
of fonts you'll notice these aren't
exactly the fonts the glyph fonts that I
had before but we'll just see what
happens here huh yeah that's really slow
here we go
kind of show you that it way to render
the rest of the stuff to let image
popped in I wonder why I did that
because it is a markup and stuff there
all right what I'm going to do this is
kind of do the nickel tour
or the behind the scenes here if it'll
let me there we go
all right what I want to do let's get
this out of the way
this is always harder to do when they
scratch your create your screen down to
so hopefully we'll be okay i'ma do is
let's minimize this I don't like that
flashing there we go this is not the way
it worked before alright alright so
let's do this
all right well my dues I'm gonna go back
to the home maybe here we go if you were
able to see if you were able to see it
it went kind of fast there if you look
inside this main content this is what I
use kind of my main hook where all my
views are gonna be and so I've got
things set up I actually have a child
layout concept that I can employ here
that's kind of what I've got here you
see the spa layout and I've got the show
class involved and then inside of that
is what it's called a spa child view
that's the actual content of the page
there and if I go back let's just go
back and hit one of these he saw it
really quick another the second child be
was injected in there he was animated in
so it's kind of slid in with CSS
animations and when that animation was
over the previous view was removed from
the Dom and this is part of keeping the
DOM clean so I had to put a lot of work
into this back in the tub back in the
day to kind of add and remove things you
know if we go down here you'll notice I
don't have that much content in here but
if you actually looked at the initial
request for the markup there was
additional script tags but I marked
those as with a special type on there
that indicated they were they were views
from my spa application or templates
from my spa application and those also
get removed and I think if we go up here
to the network tab see
oh yeah well this should be there anyway
so there would be in the original
request me so I can get this cleared out
and started over again
should be there yeah here they are so
see here's all the like the script tags
I was talking about so that when the
application loads part of the booting
process if you will is a spa library
interview engine going through bonding
these these sections and putting those
into storage and another trick when I
when I ultimately want to before a
launch I get to a point where the server
side actually cooperates with the client
side and I'll look at the if modified
since header and what it does is it
actually checked to see if the file on
the server has changed since the last
time that the client requested this
particular page and it only injects in
the ones the pieces that have changed
effectively at the views that have
actually changed so there could be a
very small amount of markup that gets
sent back down to the client or in the
at the beginning it could be a large
amount and so that can give you another
advantage in the payload stuff
especially if you're trying to get in
that fourteen kilobyte payload goal and
let's go I'm gonna go over to Chrome's
tool because they have better resources
here so I mentioned the local storage
piece and we sit down so we'll be
yelling so much so you see I store a lot
of stuff here so I've got adjacent
object and you look at this carefully
you can see it's got the markup here so
it goes through and parses the the
markup it puts it in here and it also
creates a JSON object for each of the
views and if you we go back and we look
you go back here and look at this you
say I've got some some attributes that
are important here I actually used the
ID on each one of these views to map it
to a controller and this indicates that
what kind of view it is I'm so I'm
looking for this spa view class and how
the animations supposed to work for it
the ID if it's got apparently out what
that's going to be and then here's the
route I was talking about so I actually
put the routes here as part of the
definition of the actual view and that
keeps a kind of direct relationship to
that particular view and then to get
around the script tag not part
processing this always have the type to
something besides script in this case I
just say it's the spa view you don't
have to do anything terribly fancy and a
lot of times you'll see like X something
which is what I do with my templates if
we go down far enough we'll see a
template there's one this one's got a
text and then X simple template kind of
thing going on here and that keeps the
browser from from processing this as a
regular script and you can look at this
is a more complex route I've actually
got it set up so you can do parameters
as well so if you put a colon in front
of that password there that would make
the password into a parameter and that
name would get passed in with the actual
value to the controller ultimately and
that way you can kind of branch off and
do different stuff all right all right
so alright so showed you kind of have
the view swapping works and so another
thing that I'm getting into you a little
more that I've kind of come back around
to is this the lazy loading stuff so
I've got another call here and this
one's to my deferred content or
effectively stuff that's not being
loaded up front when the first thing I'm
doing is telling you what CSS files to
go grab and inject those into the Dom
and so it kind of does this for me kind
of dynamically so it's a way to lazy
load CSS and JavaScript and we're you've
seen a lot of people starting to write
CSS loaders and things like that kind of
leverages those concepts and then here's
the secondary views they're gonna go
through that same processing and then
down at the bottom we'll have something
for the scripts as well and same thing
so this is production so I've got
bundles of minified files now for
development
I don't bundle and minify them I like to
keep them individual because it makes it
easier for me to kind of have a
one-to-one relationship to them I
believe one of these
okay
this is localhost good so if you look at
this waterfall you can see it's a it's a
lot bigger so I have a lot of individual
files and it helps me as a developer
maintain and manage where where I need
to debug effectively so you can see
there's a lot of requests here if you go
back and look at the the request for the
production version there's not near as
many requests this is gonna have a lot
of image requests because it's gonna be
the home page right there
so alright alright so let me kind of
walk you through a little bit the code
here too
get off all right so this is this is my
like data clash right here and like I
said I've got some basic stuff to
implement the the Java the the Ajax
calls here like I said it doesn't take a
whole lot of code to do Ajax I think a
lot people think it's very complicated
but you can get into some abstractions
and stuff like that
one of the things I've kind of found is
that pretty much the modern browsers are
really good at implementing core API
stuff pretty consistently and so we
don't need a lot of the kind of hacks
and the stuff we had to employ in the
past to to get around some stuff if you
do the cutting the mustard thing you
kind of can have a reasonable
expectation that that you don't need to
implement a whole lot of cross browser
kind of things to fix issues so I've got
some basic functions here that just kind
of abstract you know common HTTP verbs
for Ajax and stuff like that
and here I'm get a little lazy I just
got one big file with a bunch of calls
in here I'll probably eventually
refactor these out but if we want to
let's see it's asleep category or
whatever you know so I'm not gonna call
here to this get cached object function
and what that's gonna do is is go
through that pipeline and it's going to
first check to see if the data is and
local storage or not and if it is it's
going to just return that otherwise it's
going to go through the Ajax pipeline so
you can see here if I have this cache
data I'm gonna go ahead and make the
callback now another thing to notice
here I have not implemented promises and
the reason why I didn't implement
promises is I didn't want to have to use
a polyfill because most the promise
polyfills I think are kind of large
right now and we're right on the cusp
where the browsers are gonna cross the
board implement promises for us natively
and you know the lot people worry about
callback hell and the pyramid of Doom
and stuff like that I've never truly
felt like I fell into that so I'm not
terribly afraid of using callbacks and
it makes this process a little easier
too but once the once the promises are
kind of natively supported across the
board I'll quickly kind of swap this out
for a promise architecture but for now
I'll just make the call back the the
success callback and pass the the data
that was stored and then
whoever called its going to process it
as it needs to otherwise I'm going to go
ahead and go ahead and call that get
data to make the Ajax call and it's
pretty much that simple I've got a
caching object and I've got a few
functions that manage the the caching
layer and the reason why I've got into a
caching object they so I can leverage it
here in Ajax as well as say for the
views and templates and stuff like that
or either place that I want to leverage
local storage caching and have a time to
live associated with it so it gives me
the ability to kind of let all my data
to be stale and purge it out as I need
to are there any questions up at this
point yeah sure go ahead yes
so the question is how do I get around
limitations of browser storage and this
is the question I get asked a lot
because five megabytes is what you get
for local storage I've never run into a
problem with the quota on local storage
at this point and that sounds crazy but
you can pack a lot of markup in local
storage even with 400 views you're still
only looking at a few hundred kilobytes
that most of markup the data that will
drive an application generally is not
going to be that intensive if you really
look at it so I think like Patrick was
mentioned in his talk to do the
waterfall thing I forget how many
megabytes the actual image consumed with
the data to generate that graph was only
20 kilobytes so if you're if you're
looking at like JSON data it's usually
pretty small in format and that's that's
the nice thing about it so if he just
stringify that Jason and store it it
doesn't take up a lot of space so for
example that that 75 page view that we
that I did this past winter 35 pages I
think we may have had a hundred and 50
kilobytes at any given point in local
storage we had a lot of room left to go
and we were running that application
running it through different user
scenarios and stuff like that a lot of
data goes a long way and just because
it's being rendered for the screen
doesn't necessarily it's a whole lot of
data behind the scenes another another
question that I get from time to time
from customers and things like that is
well what happens if we need five
thousand records in a table or something
like that you should never have five
thousand records in a table I'm sorry
major different ways there's different
ways to deal with that scenario that's
kind of the exception to the rule having
something that large but even less you
got a really wide record set the five
thousand records still doesn't
necessarily means gonna take a blow idea
a common problem there I'll give you
example of how to a customer that they
had I think a hundred column wide record
and they were returning like five
thousand let's just use that for sake
but they only used eight of those
columns so I told them to create a
different API they returned a more
shaped piece of data to
what they were actually rendering
instead of returning all that data that
they never used because they very rarely
used any of the data so think about that
when you're you're doing things and you
had another question I've used it very
little because I've gotten away with so
much in local storage I just haven't had
to go to indexdb for anything yet it's
one of those things I just want the the
biggest queues to go kind of dig into
indexdb the serviceworker concept will
probably push me over the top because
some of the things Patrick was talking
about are things that I'm implementing
without service workers so effectively
some of the things I'm showing like with
storing the views and local storage but
effectively how now have a polyfill when
service workers are across the board so
yeah I haven't done whole up with
indexdb yet but if I did have some
scenario that needed more space or
really more query incapabilities over it
index TV probably the direction I would
go are there any other questions okay
all right yeah
so his question is since Java scripts
essentially single-threaded why do I
want to render my content on the client
side versus the server side and it was
interesting I've had that question a lot
and actually had a little debate with
one of the IE engineers a couple of
weeks ago so I actually peeled off a
little bit of time and played with this
application at one point and I rent I
did something where I was rendering the
mark-up via the API on the server or I
would compared that to what it took to
actually render it on the client and I
used like the timing API and stuff to
see what the differences were and apana
so there was no difference believe it or
not and you gotta realize I'm not using
like an expensive templating engine I've
got 20 line function that's doing my
templating for me so when I compared the
server-side market being sent over to
the client-side markup and and
essentially doing the same exact thing
app it sitting at dinner HTML the
timings I mean I did like a hundred runs
of each one it was roughly about the
same on either one of them so and it
also depended on how much markup it was
kind of too much and that's like the
home page had a lot more markup than say
the product detail page the home page
was rendering in 40 milliseconds on
average and the product detail was like
8 milliseconds on average so when you're
looking at those kind of things it's it
doesn't really wash out especially since
the server doesn't necessarily know
what's getting rendered so I had to I
had to essentially had to add a
different format up to my API okay so
instead of like he by default most
number JSON and XML I have one to do
HTML as well it's more or less what I
did it was a cheap way to do it but it
did it so yeah the rendering itself was
I didn't almost identical and I think if
you went to some of the more expensive
libraries it's probably going to be show
you some differences there so the more
steps you do the more process and I
think it's going to make a difference so
are there any other questions yeah
yeah mmm oh I oh heck no no let's go
look at that that's one of the things I
wanted to get to here we go so here's
the entire script to cut the mustard on
the climate literally all I do is check
to see if there's certain api's that are
supported now for mine I use query
selector because that essentially
eliminates like ie7
I think maybe I ate local storage which
by the way I ate supports local storage
and I ate should let's just say it's
gonna purge itself on January 16th with
Microsoft stopped supporting it
let's hope and of course add
eventlistener would eventually get rid
of IE 8 now the match media is a big one
I used that for especially responsive
images and I say to add a little
responsive pixie-dust
to my applications so that I can through
the JavaScript use breakpoints in the
JavaScript to drive slightly different
experiences based on the viewport that
I've got available to me now match media
supported in the IE 10 time frame and up
in all the browsers and it's kind of a
neat little trick that most developers
are not even aware of and I'll show you
how I implemented this here in a second
but what I'm doing here is I'm checking
to see in these last things I'm checking
to see are you in a browser that didn't
support these these functions and if so
I'm gonna route you back to the server
using the escape fragment query string
parameter which follows the Google API
Google specification now if someone sent
you a link from say a legacy browser
that had that query string parameter by
in inversely I'm going to redirect you
back to the high fidelity because your
browser is cool and supports all this
stuff and I'm gonna let you have the
better experience so that's the fact of
what's going on with this script right
here that's all there is to it it's not
very big at all and I'm not I'm not a
huge fan of having inline scripts but
this is one of the times that I'll give
it away plus it's the very first thing
that I'm doing in the top of the dom
there's all kinds of little tricks to
structuring your markup to make sure you
don't reach
the critical rendering path to recycle
right so you want to get around that so
for example you can put some directives
and HTTP headers instead of in meta tags
up here go ahead and do that because
those get evaluated before getting gets
to the markup and it allows the browser
to process things quicker all right so
let me just go look at this home or the
match media stuff real quick because I
found this to be invaluable in
particular for responsive images at this
point although hopefully this is going
to be something I can get away from in
the near future this little technique
but here we go so who's heard of match
media at this point I'll give you a real
quick explanation but to what it is it's
a JavaScript API that allows you to set
CSS media query breakpoints so that an
event triggers and you can determine if
the browser's it meets that criteria or
not and then you can react accordingly
so if you see all these these four lines
I've ever got one for phones small
tablet tablet and desktop defined and
it's called window to match media and I
pass in a media query breakpoint
definition there and then down below I'm
adding an event listener you know they
don't have add event listener this is
just add listener so they chopped the
event but it's the same exact deal going
on here and in that it's just a callback
function and the way I've set this up is
I've got in my main application I've got
a callback function placeholder
effectively and only each of my views if
I need to use any of these breakpoints I
just set a callback to and I clean up
after myself when it's destroyed and so
what I'm doing here is it's going to
call that function which if we go back
over here to home you can see I've set
that to this set images size function
and of course that's not going to do
what I asked it to do
hit the wrong button sorry guys so here
I'm kind of running through now if it's
a pitcher set or source set was was
fully implemented across browsers which
hopefully by this time next year will I
can probably eliminate all this code but
effective what I'm doing is I'm doing
some tricks I didn't really come across
well because the resizing and stuff for
the projector but the way I've set up
the application is if it's on a phone
format then I'm using a smaller image if
it's as you go up they change the bigger
images and that first it that first
product image say on the home page list
is bigger than the other ones right so
I'm using different ones so I've got
some logic in here to kind of set the
reference to those images so that it
pulls up a more appropriate image so
effectively it's kind of a Java
scripting what you can do with source
set and in the picture fills and stuff
like that yeah yeah so there any other
questions you know trying to see beyond
the lights just make sure all right well
I'm gonna be here all week and if you
got any more questions come ask me
afterwards and I appreciate you sharing
this time with me and let me talk about
some of my favorite topics
we hope you've enjoyed this video and
we'll select the like button below if
you haven't subscribed to our YouTube
channel please do and if you're
interested in our newsletter please
visit love to dev comm slash newsletter</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>