<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 11   Single table inheritance in linq to sql | Coder Coacher - Coaching Coders</title><meta content="Part 11   Single table inheritance in linq to sql - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 11   Single table inheritance in linq to sql</b></h2><h5 class="post__date">2014-09-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/R3Mn8Y4zJt4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 11 of link to sequel
tutorial in this video we'll discus
single table inheritance in link to
sequel single table inheritance is also
called as filtered mapping discriminated
mapping table / hierarchy mapping with
single table inheritance one database
table is used to store data for all of
the entity types in the entire
inheritance hierarchy let's understand
this with an example we'll be using this
employee's table in this demo here is
the sequel script to create this table
I'll have the script available on my
blog in case you need it now this table
stores the data for both the type of
employees that is permanent employees
and contract employees some of the
columns in this table are specific to
permanent employee for example annual
salary specific to permanent employee
this means when we insert a rule for
contract employee then that column is
going to be null for permanent employee
similarly hourly pay and doubles work
are specific to contract employee
meaning when we insert a rule for
permanent employee then those columns
are going to be null for permanent
employee the other columns like ID name
and gender are common to both the type
of employees that is permanent employee
and contract employees and it's
discriminator column here is what we
actually use to distinguish between
permanent employee and contract employee
now when we use linked to sequel class
designer and if we were to design a
class based on this table by default
link to sequel is going to create one
employee class as you can see here let's
actually look at that in action let's
flip to visual studio so here I have a
new empty asp.net web application
project to this project let's add a new
item we want to add link to sequel
classes let's name this sample click on
server Explorer drag and drop the
employee's table notice that by default
we have one employee class created now
within our organization we know that
we've got two types of employees that is
contract employees and permanent
employees so what we want to do is
design three classes like this so this
base class right here employee class is
going to contain the properties that are
common
to both of these employee types so ID
name gender and discriminator properties
are common to both of these employees
and we want this employee class to be an
abstract class because within our
organization we either have got
permanent employees or contract
employees we don't have an employee of
type employee which means we don't want
developers to be inadvertently creating
instances of this employee class that's
why we want this employee class to be an
abstract class and then contact employee
is going to contain the property
specific to contract employee and along
the same lines permanent employee will
house property specific to it so let's
see how to design these classes so right
click on the designer surface add a
class change the name of the class to
permanent employee and annual salary is
the property specific to permanent
employee cut it and then paste it on
permanent employee similarly add another
class and let's change the name of this
to contract employee and I will appear
and others that are specific to contract
employee so let's cut those properties
and paste them here and the next thing
that we need to do is establish the
inheritance relationship between these
three classes so right click on the
employee class add inheritance so the
base class here is going to be employee
class and the derived class is going to
be permanent employee
click OK so there's an inheritance
relationship between those two classes
there let's do the same thing for
employee and contract employee so base
class employee drive class contract
employee all right now how do we
distinguish between permanent employee
and contract employee we use this
discriminator property so we need to set
a value for this property so right click
on the inheritance relationship and
select properties and then within the
properties window
so the discriminator property is
discriminator so that's the property
that we're using to discriminate between
permanent employee and contract employee
now when is an employee permanent
employee when that property
has got a value of permanent employee
because that's what we are storing in
the database table so that's the value
so the derived class permanent employee
now the default is permanent employee
alright let's do the same thing for the
inheritance relationship between
employee and contract employee so
derived class discriminative value so
when is an employee going to be a
contract employee when the discriminator
property value is contract employee all
right now let's lay out this diagram
properly alright so we have done
designing our classes so with whatever
in a configuration that we have done
through the designer behind the scenes
what it has done is created three
classes for us employee class permanent
employee class and contract employee so
from employee class permanent employee
and contract employee classes derive so
notice that both the classes have
employee as the parent class and then
look at this there is an inheritance
mapping attribute so you know there's a
dis permanent employment contract
employee derives from the employee class
but when is an employee's had to be
permanent employee when the
discriminator property has got this
value permanent employee and when it's
contract employee the employee is going
to be contract employee and the stable
attribute tells this employee class is
map to employees table now if we quickly
look at this sample dot designer dot CS
file we should actually see those three
classes there so notice that we have the
employee class and we have permanent
employee and contract employee classes
deriving from employee classes so
employee class mapped the employee's
table and notice that we are using
inheritance mapping attribute as well to
map to permanent employee and contract
employee all right so now what we want
to do is design a web form that looks
like this e so to this project let's
the a webform
and we want to have a radio button list
with these three radio buttons and a
grid we control to speed things up I
have already typed the required HTML so
let's copy this HTML and paste it on the
web form so basically this is
straightforward HTML we are using a div
tag and setting font family to area and
then we have got a radio button list
with three list items and you know what
are the three list items load all
employees load permanent employees and
load contract employees and if you look
at the value you know when we load all
employees the value is all the permanent
employees its permanent and for contract
employees its contract and then we have
got a grid view control alright and
notice that we also have set auto post
back to true for the radio button list
meaning whenever the selection within
the radio button list changes it's going
to automatically post back to the server
that's when depending on what radio
button the user has selected we want to
load those type of employees now let's
auto format this grid we control so that
it looks a little nice and let's double
click on this radio button list to
generate the click event handler so we
are going to switch based on the
selected value within the radio button
list alright so when the selected value
within the radio button list when it is
permanent that's when we want to load
permanent employee so let's copy that so
when it's permanent then what we want to
do we want to create an instance of our
sample data context class so let's
create an instance of that let's call
this dbcontext equals new sample data
context so DB context dot employees dot
of type we want to load only employees
of type permanent employees and we want
to convert that to a list and then we
want to set this list as the data source
for the grid view controller and then
finally call the data bind method and
break out of this case statement alright
so on the other hand when the user has
selected load all contract employees so
in this case and the value is going to
be contract so let's copy that and paste
it right there so when that radio button
is selected be only one to load contract
employees on the other hand if the user
has not selected either of these two
radio buttons then we know for sure has
selected the other one which is our
default case so in that case we want to
generate I mean load employees of type
employee that is the abstract type
alright
now let's also log the generated sequel
queries you know onto the webform and in
order to do that we can make use of the
log property of the data context object
so let's write it to the response train
so let's run this now with all these
changes
so when we select load all employees
look at that all employees are loaded
and notice the properties that are
displayed I rename gender and
discriminator okay because those are the
properties that are present within
employee abstract type now we haven't
made this class abstract so how do we
make this employee class abstract simply
right-click on the employee class go to
its properties and then there's this
inheritance modify a property so here
select abstract okay so with these
changes let's rerun this one more time
so now let's select load all employees
look at this so we are getting only the
properties that are present in the
employee type because that's what we are
requesting the server to return and look
at the select query the selector is
actually loading all the columns from
the employees table but since the base
abstract employee class has got only
these properties that's what get
displayed within the grid view control
okay and here look at that we don't have
anywhere close because we are loading
all employees from the employees table
when we select load contract employees
for example look at this select these
columns from employees table where look
at that discriminator column is used way
discriminator equals at p 0 so this is a
parametrized query and if you look at
the parameter p 0 the value of that is
contract employee so here we are loading
only contract employees where
discriminator equals contract employee
and discriminator is not now similarly
when we select load permanent employees
only permanent employees are loaded and
look at the query it's a little
different here we're discriminating
north equals at p 0 again it's a
parameterize query and if you look at p
0 here its contract employee but here
the condition is we're discriminated not
equals contract employee meaning it's
going to load all the permanent
employees all right now when you select
load all employees if you want you know
all the other columns as well that is
annual salary overly pay and others work
to be displayed then you know we have to
write some code in order to achieve that
so to speed things up I have a private
method which is capable of doing that so
let me copy and paste this private
method on the wave form and then we'll
quickly go over the code so let's go to
the wave form and let me paste this
private method right here and if you
look at this private method it's pretty
straightforward so basically this is
going to return a data table and this
data table is present in systems or data
namespace so let's bring that in and
what is it doing you know to this method
we are going to pass a list of employee
objects and what it is going to do is
construct a new data table and this data
table is going to contain these columns
ID name gender annual salary hourly pay
hours worked and type okay so all these
columns are going to present within the
table and then what we are doing is
using a for each loop loop through each
employee within the list that gets
passed and then you know from the
employee object that's present with them
that place we are retrieving ID name and
gender properties populating these
columns within the row that belongs to
this table and then we also need to
populate the other columns that is
annual salary hourly pay and hours
worked and type columns and we can only
populate them if we know the type of the
employee object so that's why you know
we are typecasting the given employee to
a permanent employee if it's permanent
employee we are checking that in that
case typecasted to permanent employee
retrieve annual salary property value
and store it in this column of this data
row and also set the type to permanent
because we know it's a permanent
employee if the employee is not
permanent employee then we know for sure
it's going to be a contract employee in
which case retrieve the hourly pay and
hours worked property values store in
the respective columns and then set type
to contract and then add the row to the
data table finally after we are done
looping with all employee objects return
the data table back so pretty
straightforward private method now let's
actually call this method when we try to
load
all employees so when we select all
radio button that's when we want to call
this private method and then we are
going to pass this list of employees to
this function and this function is going
to convert that employees for display
purposes so let's rerun this waveform so
load all employees notice that now we
have got the other columns that are
specific to both permanent employees and
contract employees
that's it for today thank you for
listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>