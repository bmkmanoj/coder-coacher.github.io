<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Web API versioning using custom media types | Coder Coacher - Coaching Coders</title><meta content="Web API versioning using custom media types - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Web API versioning using custom media types</b></h2><h5 class="post__date">2017-03-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dTyY9wVadFs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is but the nine of asp.net Web API
tutorial in this video we'll discuss
versioning of a BPA service you can
vendor specific media types so here is
what we want to be able to do we usually
set accept header to application for
slash XML if we want the data in XML
format if we want the data in JSON
format
we set the accept header to application
for slash Jason so instead of using
these standard media types we want to
use our custom media type
notice here the accept header is set to
a custom media type then within this
custom media type notice we have got
this B and D prefix V and D stands for
vendor specific media type and then we
have a namespace we had set the
namespace to presume Tech and we have
the version of the service we want in
this case we want version one service if
we want version two we simply replace v1
with v2 and we also have specified the
format of data that we want in this case
we want JSON formatted data if we want
XML formatted data we simply replace
this jason with xml so when we execute
this request we get version one service
in JSON format so all that is left right
now is to read this version number for
more custom media type and then select
the controller so let's flip to vision
studio now this is the same example that
we worked with in our previous video at
the moment we are reading version number
from the accept header version parameter
let's comment this code and make a copy
of it so we can change the bits that are
required now we know within our custom
media type we also have the version
number we have to read this version
number and then based on that version
number we are going to select our
controller so to read the version number
they're going to make use of a regular
expression
so first let's come up with that regular
expression within the notepad right here
you have a custom media type let's make
a copy of it and within this media type
you have got some special characters
like this four slash is a special
character we need to escape that using
backslash let's do the same thing with
these three dots a dot is also
special character so let's escape all
three of them and similarly this plus
sign is also a special character let's
escape that as well we know this part of
the media type application for flash we
ended up resume tech this will not
change so I'm going to leave it as it is
but this controller here can change it
can be anything it can be students
teachers etc but we know it's basically
going to be alphabets between A to Z and
we can have any number of such alphabets
similarly the version here is going to
be a number between 0 to 9 and we can
have any such numbers and the same is
the case with the format of the data
that we want it's going to be alphabets
between A to Z and we can have any
number of such alphabets so here is our
regular expression let's copy this and
within visual studio let's create a
variable and initialize it with our
regular expression let's prefix this
regular expression with string
bare-bottomed literal which is add and
we are going to reuse this code request
dot headers dot except dot where a such
that they are going to make use of the
regex class this class is present in
system dot txt or regular expressions
namespace let's bring that in and then
we are going to make use of this method
is mad this method has caught several
overloaded versions we are going to use
this overloaded version which has got
three inputs they input the pattern and
the regex options input is nothing but
the media type of our access header
which we are going to get to using a dot
media type and the pattern is present in
this variable reg X and we want the
string compassion to be ignoring case so
this is match method returns true if
there is a match so if we have any such
accept header with a custom media type
that matches the pattern specified by
this regular expression it's going to
come inside this s block and within here
we want
treat the matching groups if you look at
this regular expression they've got
three matching groups here so let's use
the regex class once again and use the
match method this method returns a match
object so again our input is the first
accept header media type and the regular
expression is present in all rejects
variable and we want the comparison to
be ignoring case so since this match
method returns a match object let's
create a variable let's name it match so
within this we will have three matching
group and one of the matching groups
will have the version number so version
number equals of a match object dot
groups and within our second group we
will have the version number value let's
use the value property to retrieve the
value of the version number group okay
if this is not clear at the moment don't
worry let's run this in debug mode and
things will be clear issue a Request
from fiddler let's first set the exit
header to a custom media type and
execute our breakpoint is hit now let's
step through the code look at this match
object we've got groups property and if
you look at that notice at the moment we
have got four groups and if you look at
the results within the first group we
have our entire custom area type string
in the second group we have the name of
the controller students in this case and
in the third group we have the version
number one in this case and in the
fourth group we have the format of data
jason and to retrieve the version number
there using the group index so here a
version number equals match dot groups
of two dot value is going to return as
the version number we can make this code
more readable by using a group name
instead of group index at the moment
these groups are not named now we want
to retrieve version number so let's name
this version number group here and then
use that group name instead of group
index which is going to make our code
more readable so let's detach
the debugger - they make group we use
question mark angle brackets within the
angle brackets we specify the name for
our group so let's use this group to
retrieve the version number so instead
of group index let's use group name
let's give our solution to build one
more time and test fit read la here we
are requesting for version one service
in JSON format so when we execute this
we have version 1 students in JSON
format let's change the version to 2 and
when we execute this we have version 2
students in JSON format now let's change
the format itself from Jason to XML when
we execute this notice we still have
students in JSON format why is this this
is because we have not added our custom
media type to XML format we have not
added this to Jason for matter as well
but the reason we are getting data
formatted in Jason is because the
default format is JSON format so to fix
this issue we'll have to add our custom
media type to both Jason and XML for
matters we do this in Web API config dot
CS so from the solution Explorer let's
open web API config dot CS and within
the register method that is the config
object dot for matters dot JSON format
and we want to add a supported media
type so to the supported media types
collection let's add a new media type
header value and to its constructor we
pass the s to media type so we are
adding a custom media type to the Jason
formatter let's also add version two of
the custom media type and let's do the
same thing with XML format so let's make
it copy
and instead of using JSON format let's
use XML format and here the format is
going to be XML let's do the same thing
here as well let's give our solution a
build and tested fed live one more time
so here we are requesting for version
two servers in XML format so when we
execute this notice we have version two
students in XML format let's change the
version to 1 and now we have version one
student in XML format let's change the
format from XML to JSON so here we have
JSON formatted data so this is version 1
in JSON format here we have the code to
read the version number of from our
custom media type and here we have the
code to add or custom media types to
both JSON and XML for matters thank you
for listening and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>