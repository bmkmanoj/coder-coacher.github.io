<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 2   SQL query to get organization hierarchy | Coder Coacher - Coaching Coders</title><meta content="Part 2   SQL query to get organization hierarchy - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 2   SQL query to get organization hierarchy</b></h2><h5 class="post__date">2014-05-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Kd3HTph0Mds" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 2 of sequel server
interview questions and answers video
series in this video we'll discuss
writing a sequel query to get the
complete organization have RK based on
an employee ID to get the best out of
this video these concepts should be
first understood self-join CTE and
recursive CD we discussed these in
detail in our sequel server video
tutorial so if you're new to these
concepts I strongly recommend to watch
them first before proceeding with this
video so here is the problem definition
notice that this employee table contains
three columns employee ID employee name
and manager ID now if an employee ID is
passed to the query that we are going to
write then that query should list down
the entire organization hierarchy that
is who is the manager of the employee ID
that is passed and who is managers
manager and so on till the full
hierarchy is listed let me give it a
context with a few examples so this the
employee is table and this is the
organization hierarchy notice that Ben
is our super boss meaning he doesn't
have any manager so the manager ID
column for Ben is now and if you look at
mark Steve and Laura they three report
directly to Ben meaning their manager ID
column should have the employee ID of
Ben so if you look at mark Steve and
Laura notice the manager ID it's 8 which
is the employee ID of pan so now based
on this table data this is what we want
to achieve for the query that we are
going to write if we pass David's
employee ID so David is right here so if
we pass david employee ID then the query
should return data as you can see here
notice that employee name and manager
name so about David we have Tom about
Tom we have steve steve reports to pan
and ben is our super boss so david
reports to tom tom reports to steve
steve reports to Ben and Ben is a super
boss similarly for example if we pass
lares employee ID then the query should
return data as you can see here so Laura
reports to Ben and Ben is our sleep of
super boss so that hierarchy should be
displayed so Laura reports to Ben when
so a super boss so let's see how to
write this query and as I told you
before we'll be making use of the
concepts of self join CTE and recursive
CTE if you're new to those concepts are
strongly recommend to watch those videos
first from our sequence server video
tutorial before proceeding with this
video so let's flip to sequences or
management studio so I have already
created this employees table and also
populated that table with some test data
and here is the sequel script that can
create the table and populate it the
test data I have the script available on
my blog in case you need it
so let's write the query so let's
comment that so we are going to make use
of CTE so I am going to create a CTE
first so amp let's call it my ECT so I'm
not going to get into the basics of CTE
here okay so now we are going to write a
select query here select some columns
from employee's table and what columns
we want to select from employees table
we want to select employee ID employee
name and manager ID columns from
employees table there now we need to
pass an employee ID to this CTE so I'm
going to declare a variable here so
declare let's declare a variable at ID
of type integer and let's set that ID to
a value of maybe seven okay seven is
David's employee ID so we are setting
the ID to seven and now we are going to
filter employees based on that ID okay
so this is straightforward query we're
selecting employee the employee name and
manager ID of the employee whose ID we
are passing okay straightforward now
here we are going to apply Union all
operator so to this result set we are
going to append you know another result
set so what we are going to do here so
we are going to select you know the same
set of columns from
employees table but then we are going to
join this employees table with this CD
so basically we are joining the CTE with
itself so basically here it's actually a
recursive CTE so join with employee CTE
and we need to specify the join
condition so we are going to join on
employee ID column of employees table
with manager ID column of the employee
CDE okay and what columns we want we
want employee ID employee name and
manager ID now here both the city and
the employees table have got the same
column names and we want those columns
to be pulled from the employees table so
here I'm going to prefix the column name
with the table name so employees dot
employee ID employees dot employee name
and then employees dot manager ID
columns okay so that's our CTE now what
we are going to do is select star from
employee CD okay so a very basic CD here
first of all let's go ahead and execute
this and see what's the output we get so
incorrect syntax near the keyword that's
basically because we need to use a
semicolon there so let's put that there
so now look at this we get employee ID
employee name and manager ID okay so we
have the correct manager ID there now
what we're going to do is self join this
employee CTE with itself so what I'm
going to do here is we want to select
some columns and what are those columns
first of all let's write the self join
query so we are going to join employee
CP with itself
so join employee CTA so let's call this
instance a c1 and this instance se2
and on a one dot manager ID equals e2
dot employee ID now look at this we are
using e two so basically we are taking
the manager ID column in E one instance
and looking up the employee ID column in
a two meaning we are going to get the
manager name column from employee I mean
II two instance of the employee C T so
what we are going to do here in the
Select list we are going to say e 1 dot
employee name so this will be the
employee name because we are treating a
1 as the employee table and E 2 st
manager table okay and e 2 dot employee
name as let's give it an alias manager
name because that will be the manager
name why is that because we are taking
manager ID column from e 1 instance and
looking up employee ID column in E 2
instance meaning from e 2 we are going
to get the manager name ok so now with
this let's go ahead and execute and see
what output we get ok now notice that we
get 3 rows now if you look at what ID be
a passing ID 7 and if you look at ID 797
is David's ID so David report Tom Tom
report to Steve Steve repo to Ben and
Ben is our super boss so we should get 4
rows now if you look at the number of
rows we have caught it's only 3 but
that's correct so David reports to tom
tom reports to steve steve reports to
ben and we didn't get ben's record what
is that that's because we are doing an
inner join here and the band's manager
ID column is null so it doesn't match
that's why we are not getting Ben's
record so if we want a band record as
well then we're going to make use of
left join so instead of an inner join
here we are going to use left join let's
go and execute this query and notice
that we get Ben's record but look at
manage your name it's displaying null
because it doesn't have a manager ID but
instead of that we want this you know
string no boss and how are we going to
achieve that there are several ways
again to do that you can either use
function or is malfunction so I'm going
to basically use is null function so is
now and we need to pass two parameters
for this one so if e 2 dot employee name
if it's not null then that value will be
displayed but if it's now then we want
to replace that with the string no boss
okay so let's go and execute this so
notice that we get the output that we
expect ok so there we passed david's ID
let's go ahead and pass Loras ID if you
look at Laura our employee ID is 5 so
let's go ahead and pass 5 here and
execute this query so look at that lot
of reports to Ben bender puts I mean Ben
doesn't have any boss or super boss so
Laura reports Ben Ben has bought no boss
now let's pass for example you know
maybe Simon employee ID so if you look
at Simon his employee ID is 6 so let's
go to end pass that execute this one so
Simon reports to mark mark reports to
Ben and Ben is our super boss so Simon
reports to mark mark reports to ban ok
so they we get the output that we
expected all right and this exactly the
same query that we have written just now
that's it for today thank you for
listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>