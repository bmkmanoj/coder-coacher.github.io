<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>exec vs sp executesql in sql server | Coder Coacher - Coaching Coders</title><meta content="exec vs sp executesql in sql server - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>exec vs sp executesql in sql server</b></h2><h5 class="post__date">2017-04-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6ZoXXJ3hvRU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 144 of sequel server
tutorial in this video we'll discuss the
difference between exact and SP
underscore execute SQL in sequel server
we've got two options available to
execute dynamic sequel we can use exec
or its full form execute function or SPL
score execute SQL systems to a procedure
we'll discuss this in detail in part 138
of sequence of a tutorial the advantage
of using SPN is go execute SQL is that
with it we can create parametrized
queries which prevents sequel injection
attacks and promotes cached query plans
reusability if you search on the web for
the difference between exec and SP n
square execute SQL you will see that
many articles on the internet says using
exec over SPL score execute SQL has got
these two problems it opened doors for
sequel injection attacks cached query
plans may not be reused and leads to
poor performance while this is generally
true when we use codename function it
can prevent signal injection attacks and
with sequel server auto parameterization
capability cached query plans to
usability may not be an issue we'll
prove both these points in just a bit
but before that let's understand what is
exact in sequel server exec or its full
form execute function is used to execute
dynamic sequel and it's got only one
parameter that is the dynamic sequel
statement that we want to execute let's
look at an example now here we have a
variable at FN of type and we're care by
using this variable to store the first
name of the employee and then we have
another variable at SQL again of type
and we're care be using this variable to
create our dynamic sequel statement and
then we are passing the dynamic sequence
statement to the exec function to
execute so when we execute this code
notice we get employee whose first name
is John at the moment we are using X AK
we can also use its full-form
execute and we execute this code you get
exactly the same record now if you look
at the baby a building or dynamic sequel
statement here
we are building it by concatenating
strings which is dangerous because it
opened doors for sequel injection
attacks now what if someone says this
first name variable to something like
this look at what we are doing here we
are first closing the single quote that
we have opened here so the query will be
select star from employees where
first-name equals empty string and then
we are issuing another sequel command
drop database sales DB which is going to
drop this sales DB database and then we
have another single quote left here so
to comment that they're using these two
characters so let's execute this and see
what happens but before that let's
actually print what we have in this
variable at SQL look at the command that
is present in this variable at SQL
select star from employees where
first-name equals empty string and then
we are dropping the database sales DB
and then we are commenting out anything
that is left after that so let's execute
this code and see what happens now at
the moment sales DB database is still
there but if i refresh databases folder
look at that sales DB is gone so this
code is prone to sequel injection
attacks but we can prevent sequel
injection attack by using this codename
function while still using exec so let's
pass this at effing variable to codename
function and using the second parameter
of this function I am going to specify
single code as the delimiter which will
wrap the value that we have caught in
this defin variable in another pair of
single quotes treating all that as a
value for this first name column if this
doesn't make sense at the moment don't
worry we are going to print what we have
in this SQL variable and that should
make it clear since we are using code
name function we don't have to open the
single quote here and similarly we don't
have to close it here either so let's
print what we have
this at SQL variable look at that select
star from employees where first-name
equals so whatever we have specified as
the value for this a Defen variable all
that is wrapped in another pair of
single quotes so treating that as a
value for first name column since we
don't have an employee with such a first
name the result set will be empty but
sales DB database will not be dropped
let's prove that let's create a new
database let's name this database sales
dB
so we have our sales DB created here
let's comment a print statement and
execute the sequel notice within the
result set we don't have any records but
when we refresh the databases folder we
still have the sales DB database so we
are able to prevent sequel injection
attack by using codename function while
we are still using exact we execute our
dynamic sequel statement along the same
lines cached query plans reusability
also may not be an issue with sequel
server auto parameterization capability
let's prove that now so what is Auto
parameterization in sequel server sequel
server can detect parameter values and
create parameterized queries on its own
even if we don't declare them explicitly
this is called Auto parameterization
however there are exceptions to this
auto parameterization in sequel server
comes in two flavors simple and force we
will discuss Auto parameterization in
detail in a later video
now let's see what we already have in
the plan cache by executing this command
we discuss this command in one of our
previous videos so I'm not going to go
into the details of that they have a lot
in the plan cache to keep things simple
let's clear everything that we have in
the plan cache by executing this command
dbcc free proc cache
alright now let's set first name to John
let's execute this query now and let's
see what we have in the plan cache so
notice here we have a query selector
from employees where first-name equals
John and beneath that we have a prepared
statement notice here we have an auto
parametrized query so there is a
parameter at one that's the name of the
parameter and select star from employees
where first-name equals at one and at
the moment look at the you stones of
that parametrized query it's 1 now let's
change the first name from John to mark
let's execute the sequel and let's again
see what we have in the plan cache and
now if you look at this prepared
statement notice the used cones has gone
up by one okay so it's reusing this auto
parametrized query similarly if we set
it to Steve for example execute that and
now when we select what we have in the
plan cache notice again the use counts
for our auto parametrized query has gone
up again
so with this auto parameterization
capability of sequel server we are able
to reuse the cached query plans
finally let's quickly summarize what we
have discussed so far if you use code
name function you can prevent sequel
injection while still using exact test
query plan reusability is also not an
issue while using X act as sequel server
automatically parameterize as queries
it's always better to use SP execute SQL
over X as we can explicitly parameterize
queries instead of relying on sequel
server
parameterisation feature or codename
function we know Excel has got only one
parameter that is the dynamic sequel
statement that we want to execute as a
result of that it's not possible to
create explicit parametrized queries
using exag so that's why use exec only
in throwaway scripts rather than in
production code thank you for listening
and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>