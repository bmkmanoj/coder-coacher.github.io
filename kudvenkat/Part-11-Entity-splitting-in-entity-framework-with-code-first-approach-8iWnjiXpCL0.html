<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 11   Entity splitting in entity framework with code first approach | Coder Coacher - Coaching Coders</title><meta content="Part 11   Entity splitting in entity framework with code first approach - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 11   Entity splitting in entity framework with code first approach</b></h2><h5 class="post__date">2014-05-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8iWnjiXpCL0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 11 of entity framework
tutorial in this video we'll discuss
entity splitting with code first
approach and the splitting referee's to
mapping an entity to two or more tables
when the table share a common key we
discussed entity splitting with database
first approach in part 10 in this video
we'll discuss and it is splitting with
code first approach let's say we have
this employee class by default entity
framework code first is going to create
one table with name employees and notice
that all the properties are mapped to
the columns within that table let's
actually look at this in action so let's
flip to your studio so here I have an
empty asp.net web application project so
to this project let's add a class file
and let's call this employee dot cs and
this class is going to contain employee
ID first name last name gender email
mobile and landline properties now to
this project let's add another class
file and let's call this employee DB
context dot CS and this class is going
to inherit from DB contact class and
that class is present in system dot data
dot entity namespace so let's make this
class inherit from DB context and this
class is going to contain a property
which is going to return a DB set of
employee objects and let's call this
property employees all right now let's
add another class and let's call this
employee repository
and basically this class is going to get
contain methods to get employees to
insert update and delete employees and
in interest of time I have already typed
the code for those methods we have
discussed all these methods in the
previous sessions of this video series
so I'm not going to go into the details
of these methods so let me copy and
paste the code right here and then we'll
quickly go over it so basically we are
creating an instance of the employee
dbcontext flowers that we have just
created and but then get employees you
know we are getting the employees list
and then returning that and then within
insert employee method so obviously this
method is going to receive an employee
object which we are adding to the
employees collection and then calling
Save Changes on employee dbcontext
object and then this is our update
employee method where we are passing the
employee object that we want to update
so this object is going to contain all
the changes so again we are retrieving
the object that we want to update based
on the ID of the past and object so we
are taking the ID of the past in object
and comparing that with the objects that
we have within this collection and
retrieving that object so this is the
object that we want to update and then
we are setting first-name lastname you
know all the properties basically I
think here we actually missed last name
property so let's go ahead and set that
all right so that's our update employee
method and then delete employee the same
idea this object is going to contain the
ID of the employee object that we want
to delete we'll retrieve that from the
database collection objects and then
delete that and then finally call Save
Changes so straightforward employee
repository class where I took this
project let's also add a webform and
then on this platform we need a grid
view control first of all let's set the
style attribute let's set font family to
area and let's flip this to the design
mode we need a grid view control and we
need a details view control and an end
our object data source control okay so
let's go and below solution and first
let's configure our object data source
control so here the business object is
going to be your employee repository
class and keep in mind that class has
methods to select insert update and
delete employees so on the next screen
we are going to specify the select
method so get employees the update
method is going to be update employee
the insert method is going to be insert
employee and delete method is going to
be delete employing let's click finish
and then now let's configure the grid
view control so let's auto format this
let's select colorful scheme and let's
select the data source control object
datasource and we want to enable editing
and deleting write and one more thing
that we need to do is we need to specify
the key column using data key names
property and that is going to be
employee ID and we don't want employee
ID column to be editable so I'm going to
go into the source and then set here is
the bound feel you know employee ID bone
field so we are going to set this
read-only attribute to true so that it
will not be
editable' when the gridview is in edit
mode so now let's go ahead and configure
the details view controls first of all
that's Auto format this select the
colorful scheme and that select the data
source as object data source and we want
to enable inserting and first of all we
don't want you know this employee ID to
be visible so let's go to the source
mode and then we are going to set insert
visible equals false so when we are
trying to insert an employee we don't
have to supply a value for employee ID
so we are setting that attribute to
false all right and the default mode so
this details view is going to be insert
so let's go and specify that as well oh
it's going to be insert all right and
then one last thing that we need to do
you know we are going to use this
details between set an employee as soon
as we have inserted an employee you know
item inserted event is fired so within
the even handler we are going to refresh
the gridview control so that the newly
inserted row will be displayed within
the grid we control alright so with all
these changes let's actually run this
before we run this let's flip to sequel
server management studio at the moment I
already have sample database so let's go
and delete the database so now we don't
have sample database and one more thing
that we need to do is in our web config
file we need to specify a connection
string to our database and again in the
interest of time I have already typed
the connection stream so let's copy and
paste that right here so that's the name
of the connection string which matches
the name of the DB context class in our
case it's employee DB context so it
matches with the name of this connection
string and then there's the connection
string and we have to specify the
provider name as well and we have
discussed the importance of that and the
previous sessions of this video series
so with all these changes let's go ahead
and run this waveform and see if it's
going to create the sample database so
code
just by default it should create the
sample database and it should also
create the employees table okay so here
we have not customized you know the
model generation in any way so by
default for this employee entity it's
going to create one table called
employees and all these properties will
be converted you know into columns so
let's actually look at that so let's
refresh this databases folder so we have
the sample database and then employees
table and look at that we have all the
columns there okay now we want to do
entity splitting so we want to map this
entity to two or more tables so
basically the employee contact
information that is email mobile and
landline we want that to be present in
employee contact details table along
with the primary key which is employee
ID and then employee ID first name last
name and gender we want that to be
present in employees table so basically
we want this entity the single entity to
be mapped to these two tables so we want
the code first approach to automatically
generate two different tables for this
entity so we want to override the
default model generation and in order to
do that we are going to overwrite this
on model creating method and this method
is present in the DB context class and
if you look at our employee DB context
class right here that is inheriting from
DB context so within this employee DB
context class we are going to override
on model creating method and notice this
method you know receives a parameter
called model binder so using this object
we are going to specify the names of the
tables that we want our employee entity
to be mapped to and we can also specify
the names of columns within those tables
as well so this is how the on model
creating method is going to look like so
we have the model builder so model
builder dot entity so we want to map the
employee entity so we are going to use
the map method so we are first mapping
the properties so employee ID first name
last name and gender these properties
of the employee entity should be mapped
to the stable employees okay and then
these properties right here employee ID
email mobile and landline these
properties should be mapped to this
table employee contact details and by
default in both the tables this employee
ID B is going to be the primary key okay
so in the interest of time I have
already typed that code so let me copy
and paste this within our own model
creating method
okay so it's exactly the same code on
the slide let's format this alright so
now let's actually delete the sample
database that we have already generated
right now let's run this one more time
so now energy framework should create
two tables for that single employee
entity and that entity should be mapped
to both of those tables anyway so when
we perform insert update and delete it
should the data should be inserted
appropriately into both the tables so
let's flip the sequel management studio
refresh the databases so now look at
this we got two tables and if you look
at employee contact details it has got
employee ID all the contact information
email mobile and landline and if you
look at employee's table it has got
employee ID first name last name and
gender now let's go ahead and execute
this insert script to insert some test
data into those tables okay all right so
we have some test data there so let's
refresh this page so look at this the
grid view is displaying data from both
of the tables you know and then let's
quickly edit this let's say Mark X
Hastings X let's put an X everywhere and
then click update so let's quickly
select the data from both the tables and
see if the tables are updated
look at that both the tables are updated
as expected and let's actually delete
the trends if it gets really late from
both the rows from both the tables I
mean so look at that row one got deleted
from both the tables let's insert a new
row let's call X everywhere okay look at
that it's already added so let's check
the tables look at that first name last
name gender email mobile landline and
both the rows has the same key column
which is employee ID that's it for today
thanks for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>