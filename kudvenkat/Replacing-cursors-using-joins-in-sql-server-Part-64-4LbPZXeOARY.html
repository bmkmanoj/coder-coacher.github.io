<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Replacing cursors using joins in sql server   Part 64 | Coder Coacher - Coaching Coders</title><meta content="Replacing cursors using joins in sql server   Part 64 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Replacing cursors using joins in sql server   Part 64</b></h2><h5 class="post__date">2013-01-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4LbPZXeOARY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to prism technologies I am
venket this is part 64 of sequel server
video series in this video we'll discuss
about replacing cursors using joins in
part 63 we have discussed about cursors
the example in part 63 took around 43
seconds on my machine to complete if we
haven't watched part 63 I would strongly
encourage you to do so before proceeding
with this session in this video we'll
discuss about rewriting the same example
using a joint so if you remember in part
63 we updated the unit price in TBL
product sales table to 55 and the
product name is product 55 if the
product name is product - 65 then we
updated the unit price to 65 on the
other hand if the product name starts
with product - 100 we changed or we
updated the unit price to 1000 let's see
have to achieve the same thing using
joints and see how fast that query will
be so what do we want to do we want to
update TBL product sales table within
that we want to update unit price so set
unit price is equal to I'm going to use
the case statement but we'll come to
that in just a bit
first let's specify the tables so in the
from class we specify product sales
table so I want to update TBL product
sales I am saying from TBL
product sales and to find out the name
the name is not present in TBL product
sales table its present in TBL products
table so I have to join with the TBL
products table and specify the join
condition what is the common column
between the two tables in TBL products
the column is ID and within TBL product
sales its product ID so that's the
common column between these two tables
based on which we are joining them and
look at this so what do I want to do I
want to update the unit price - so I'm
going to use a case statement here so
case fan
name of the product is equal to ok let's
copy it from the cursors you know query
so if the name is product 55 then what
we want to do then we want to update the
unit price to 55 along the same lines if
the product name is 65 then we want to
update the unit price to 65 and along
the same lines when name like if it
starts with product - 100 then we want
to set the unit price to 1000 okay so
that's our condition and then we
basically want to end the case statement
okay so it's a very simple case
statement we have discussed about case
statements in the previous session of
this video series if you haven't watched
that I would strongly encourage you to
do so okay so we have that there and in
the weight loss we can specify what
products we want to update since we now
have access to the name column as we are
using a joint we can also filter the
rows we don't want to retrieve all the
600 thousand rows from TBL product sales
table we can filter them using the
bearclaw's so I'm going to specify where
name is equal to you know product - 55
or you know let me copy that or their
name you know name is equal to product
65 or finally name like product - 100
okay so whatever ROS matches these
criteria retrieve them and update their
unit price to you know fifty five the
product name is Prague - 55 or 65 you
know depending on these conditions so
let's go ahead and run this query and
see how long is that going to take now
remember in the previous session it took
around 43 seconds to update you know to
process the rules on a row by row basis
using cursors let me execute this now
look at this executing query it took
around 2 seconds and how many rules are
updated 1694 rows are updated now to
check our results we can make use of the
same query that used in the previous
session so when I execute this query we
should get all the rows and look at that
whatever has 100 you know name pattern
product - 100 and then anything after
that the unit price is updated to 1000
let's check it for product 55 and 65 +
f5 look at that product 55 all of them
are updated to 55 and 65 SAR updated to
65 ok so the update query worked as
expected and look at this the amount of
performance speed is 2 seconds and
varies 43 seconds there is a drastic
improvement performance and that is
because we are using joints that's one
thing joints work much better because
they operate on drawers on a set basis
okay whatever rules meet this criteria
they are updated you know in in sets
rather than processing the rules are you
know individually on a row by row basis
and another thing is since we are using
the where clause we are not retrieving
600,000 rules from TBL product sales
instead whatever rows matches whatever
the common rules between these two
tables and then we also have a ver plus
so it reduces the rows - 1694 that's why
this query is very fast okay we can even
remove this Faircloth so if you if we
remove this where clause then what's
going to happen we get 600 thousand
records okay but still since we are
using a join it's going to be very fast
you know so but then if I you know if I
remove this wave plus then what's going
to happen we get 600,000 matching rows
so if we get 600,000 matching rows look
at this you are saying
our unit price 255 and name matches to
product 55 otherwise 65 otherwise
thousand if the row if the name of the
product doesn't match to any of these
rules okay then the unit price will be
updated to now and we want to avoid that
because since we don't use this we get
other you know if we are not using this
where clause we get the other rows as
well and if the name is not matching any
of these three things then we don't want
the unit price to be updated to now
that's why what you do is have an else
class if the name doesn't match any of
these three then what I want I want back
the unit price you know just update with
whatever unit price that's already there
okay but usually we don't do this
because we already have access to the
name column as we are joining these two
tables you know you can simply filter
the rows but even if we don't filter
even if we are processing all the
600,000 rows and I'm doing that using
your joint let us see how long is this
query going to take okay now when we
execute this update query it's going to
update 600,000 records because in TBL
product sales we have 600,000 records
and there is a matching row for every
row in TBL product sales you know a
matching row is present in TBL products
that's why this is going to update
600,000 rows now let me go ahead and run
this look at this executing query it's
definitely more going to be more than
two seconds remember the previous query
using cursors took 43 seconds but look
at this query completed successfully and
how long it took six seconds and how
many rows has is affected 600,000 rows
okay though it's processing 600,000 rows
you know we still have you know we still
have the data processed in six seconds
but whereas when we do it with cursors
using a row by row you know when we are
processing rows on a row by row basis it
took around 43 seconds okay
now let's quickly check if the data has
been updated as we expect okay so first
I want to see for product 55 and product
65 so that's the same 55 and 65 and
let's check for the other things where
you
name pattern it's product - 100 so
that's 1000 and let's check anything
that doesn't match these things because
we don't want that to be updated to null
so let me select 10 star look at this
for the other products the unit prices
are the same they were not updated to
now now whenever you don't have the vert
class make sure you have this else part
otherwise what's going to happen if that
condition is not matching look at look
at what's going to happen if I execute
this update query you know some of the
rules will not match these conditions
for all those rules the unit price will
become now because none of these
conditions are met so a null will be
returned and unit price will be updated
- now you know all these rules will work
as expected 455 you know they will be
let's see you know for any product that
product - 100 that's ok and for product
55 and product that 65 also it will be
fine the data will be fine but check you
know top 10 maybe from a product sales
table check the unit price it will be
now and we don't want that to be
happening that's why whenever you use a
case statement and if you are expecting
rules that may not meet this criteria
and if you want that data to be updated
you know correctly make sure you have
your else part as well within the case
statement so when I execute this query
obviously you have seen that there is a
drastic improvement in performance okay
so this can you know you can imagine the
amount of impact that cursors is having
on performance cursor should always be
used as a last option if you don't have
any other way of achieving what you want
to achieve only then make use of cursors
or if it's a throwaway script you just
want to run it one time and if and if
performance is really not a concern
maybe we can make use of curses but
real-time production code you know you
know how bad the cursors are for
performance though so they should be
avoided as much as we can on this slide
you can find resources for asp.net
c-sharp and sequel server interview
questions that's it for today thank you
for listening have a great</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>