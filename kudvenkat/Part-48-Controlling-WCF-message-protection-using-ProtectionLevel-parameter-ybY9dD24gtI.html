<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 48   Controlling WCF message protection using ProtectionLevel parameter | Coder Coacher - Coaching Coders</title><meta content="Part 48   Controlling WCF message protection using ProtectionLevel parameter - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 48   Controlling WCF message protection using ProtectionLevel parameter</b></h2><h5 class="post__date">2014-04-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ybY9dD24gtI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">about 48 of wucf video series in this
video we'll discuss how to control the
WCF message protection using protection
level parameter this is continuation to
part 47 so please watch but 47 before
proceeding in the VCF most bindings are
secure by default for example when we
use WS HTTP binding by default the
messages are encrypted and signed as
well encryption provides confidentiality
and signing provides message integrity
let's say for some reason we want to
customize the level of message
protection that we get that's what is
the main purpose of this protection
level parameter let's understand using
this protection level parameter with an
example let's flip to visual studio so
here I've got the simple I hollow
service contract and notice that this
service contract has got three operation
contracts and notice all these three
operation contracts return a string and
the implementation for these operation
contracts is present in this hello
service dot CS file and the
implementation is pretty straightforward
in our basically look at the name of the
method here it says get message without
any protection so this method is going
to return a string which states message
without signature and encryption gets
signed message this method is going to
return this string message with
signature but without encryption and
this method that is get signed an
encrypted message is going to return
this string message signed and encrypted
all right now to host this WCF service
they are using a console application
this host is a console application here
and then within the app config file we
have they required WCF configuration and
if we look at the binding here at SWS
HTTP binding and we are not customizing
customizing that ws HTTP binding in any
way so here we are using the defaults of
this that we are sagely pre binding and
if you recollect from the previous
session by default WS HTTP binding is
going to n crypt and
Dilys sign the message okay so within
this program dot C is file we've got the
code to start the service host right
let's go ahead and run or WCF service so
the service is up and running and here I
have another windows forms application
so basically what I have done so far is
dragged and dropped three button
controls on this form and then as you
can see I have changed the text on these
three button controls the first button
controls a escape message that is not
signed and encrypted so basically when
we click this button we want to invoke
this WCF service method get message
without any protection so this message
is not going to be digitally signed and
encrypted so that's what we want to
invoke when we click this button when we
click this button we want to invoke the
method which just signs the message but
not encrypts it and when we click this
button we want to invoke the other
method which you know encrypts and
digitally signs the message and in order
for us to be able to do that we need to
first add a reference to our CC of
service so if you look at our WCF
service configuration we have made the
WCF service available at this base
address okay so let's go to the client
application and add a service reference
so select the base address click go it
should discover the hello service so
let's specify the namespace as hello
service click OK so this should generate
the required proxy classes for us so
let's double click on the button
controls to generate the respective
click event handlers and then within you
know this form 1 plus at the class level
let's create a reference variable of
type hello service client and then we
are going to initialize this client
within the constructor of that form
all right now when we click this button
get message you know we want to get a
message that's not encrypted and signed
so we are going to invoke this method
get message without any protection it's
going to return a string and we are
going to display that string using a
message box and when we click this
button which says get signed message we
want to invoke a method that is going to
return a message that is only digitally
signed so get signed message and finally
when we click this button get signed
encrypted message we want to return I
mean we want to invoke the method which
signs and encrypts message all right now
before we run the client let's actually
stop the WCF service that's running
let us enable message login for our WCF
service and to enable message logging
click on Tools click on wucf service
configuration editor file open config
file and open the app dot config file
click on the Diagnostics folder enable
log Auto flash enabled message logging
and then we want to set this log anti
MSH to true we discussed in detail all
these steps in part 9 of the study sea
of video series so I'm not going to go
into the details of it right now
so let's reload the config file all
right let's run the WCF service so the
service is up and running now let's run
the client and let's click these three
buttons so this should return that
message so message without signature and
encryption get message sign but not
encrypted so message with signature but
without encryption get signed an
encrypted message so message signed and
encrypted that's what we get back
alright now all the requests have been
logged so the messages should have been
logged so let's go to the WCF service
host project folder
and then if you look at this app
underscore message dot SVC log so now if
you look at the last request look at
that so here we have the soup board a
notice that everything that in the soup
body is encrypted the cypher value okay
this is actually the request and the one
here is again a response look at this
all the messages are encrypted and why
is that that's because we haven't
customized the binding in any way that's
why by default WS HTTP binding is going
to encrypt and then digitally sign the
messages now if we want to customize the
level of message protection that we want
that's when we use the protection level
parameter and how do we use the
protection level parameter so within our
WH service so within the service
contract these are the three operation
contracts which are returning those
messages so this operation contract
attribute has got an named parameter
called protection level and notice that
this parameter expects a value of type
protection level enum and that
protection level enum is present in
system dot net dot Security namespace so
let's go ahead and bring in that
namespace system dot net dot security
and then we are going to specify
protection level equals protection level
dot none so basically whatever message
this method is going to return we don't
want any form of protection so we are
using protection level of none which
means we are not going to have any form
of protection the message is not going
to be encrypted it's not going to be
signed it only provides authentication
ok and here we want to digitally sign
the message but not encrypted so we
choose this option protection level dot
sign so it's going to just digital
sign the message so here only message
integrity is achieved but message
confidentiality may be compromised okay
and for this one we want to sign and
encrypt the message so let's select that
option so first and crypt and then
digitally sign it so the message here is
going to be confidential and as well as
you know the message integrity is also
achieved all right so let's close the
service trace view viewer the client and
the WCF service let's rerun our WCF
service host and then let's go to the
client application and then we need to
update the service reference let's
actually delete it and re-add it so add
service reference we want to add a
service reference to the service that's
available at this base address simple
service click OK oh we should have
actually renamed that as named as hollow
service but let's change it to simple
service because that's what is the
namespace that we used all right so
let's go ahead and run the client now
click the button so we should get a
response from the WCF service so message
without signature in encryption let's
click this now message with signature
but without encryption message signed
and encrypted all right now let's go
back to the Service host project folder
and then let's open this log file select
the message and if we scroll all the way
down select this one and if we go to the
message so this is the last message and
obviously we expect that to be signed
and encrypted as well okay so message
body it is signed and encrypted and then
if you look at this message right here
it should say message with signature but
without encryption so basically here the
message is not encrypted but this is
digitally signed okay and if you look at
this message right here look at that
this is not encrypted this is not
digitally signed okay message without
signature and encryption
so using this protection level parameter
they're able to customize the level of
protection that we get all right so if
you look at the attributes you know here
we applied the protection level
parameter at the operation contract
level attribute if you look at the
service contract
notice that this also has got this named
parameter protection level meaning we
can also specify the message protection
level at a service contract level I mean
service contract attribute we also have
something called message contract which
we discussed in the previous sessions of
this video series we can also specify
protection level on a message contract
so basically all of these six attributes
service contract operation contract
fault contract message contract message
header and message body member
attributes all of these attributes have
this protection level named parameter
which implies that protection level can
be specified using any of those six
attributes and they're specified in the
order of their proceedings for example
if we specify protection level at an
operation contract level that is going
to override the protection level that is
specified at the service contract level
and if you look at this fault contract
and message contract they're at the same
level right so they're the peers okay
when we use you know we discussed this
before when we use WS HTTP binding by
default messages are encrypted and sign
encryption provides confidentiality and
signing provides integrity to customize
the level of message protection we use
protection level parameter and if you
have seen an example of how to use that
and this protection level enum is
present in this namespace system dot net
dot security and production level enum
has
these three values non sign and clipton
sign none doesn't provide any form of
protection message is not signed not
encrypted provides only authentication
whereas the sign option you know it
doesn't encrypt the message which means
we don't get the confidentiality feature
but it is digitally signed to ensure the
integrity of the message and whereas
encrypt and sign is going to encrypt and
digitally sign the message to ensure
confidentiality and integrity of the
message that's it for today thank you
for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>