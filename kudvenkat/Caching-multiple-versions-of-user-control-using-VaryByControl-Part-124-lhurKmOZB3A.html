<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Caching multiple versions of user control using VaryByControl   Part 124 | Coder Coacher - Coaching Coders</title><meta content="Caching multiple versions of user control using VaryByControl   Part 124 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Caching multiple versions of user control using VaryByControl   Part 124</b></h2><h5 class="post__date">2013-02-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lhurKmOZB3A" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello welcome to prism technologies I am
venket this is part one to four of
asp.net video tutorial in this video
we'll discuss about caching multiple
versions of the user control using vary
by control attribute of the output cache
directive in part 122 of the asp.net
video tutorial we discussed about
fragment caching if you haven't watched
that video I would strongly encourage
you to do so before continuing with the
session in this session we'll be using
the same TBL products table that we have
used in part 122 of the asp.net video
tutorial if you need this clip to create
and populate this table then please
refer to what 122 so on my blog at the
URL here you can actually find that
script on fragment caching in asp.net
part 122 so here you have a script to
create the table and populate it with
some sample data now let's go ahead and
create a stored procedure to retrieve
products from this table by product name
so I have the stored procedure here is P
get product by product by name and this
procedure takes one input parameter F
name so obviously by this name we are
going to filter and retrieve products
from TBL products table so if you look
at the implementation of the stirred
procedure this is straightforward if the
product name is all then we don't have a
ver clause
you know we select ID name and
description from TBL products on the
other hand if it is not all then we are
using that product name to filter the
rows based on the name column okay
select ID name description from TBL
products where name is equal to add
product name whatever we pass again to
the stored procedure now let's quickly
test the stored procedure so obviously
if I pass in all for the product name
parameter and they execute this I get
all the products on the other hand if I
just want you know iPhones then I pass
iPhone as the product name I only get
that product all right now let us flip
to visual studio and then what I
basically want to do is I want to create
a user control so to this web
application project let's go ahead and
add a product user control you see
product control tour asex I have already
added this to
web application project and at the
moment if you look at this we have the
control declaration itself and then a
table with one pixel solid black border
okay so let's see what is the design
that we need to have here I have already
typed that just to save some time in
typing so let me go ahead and copy the
HTML for the user control and then we'll
go through it line by line so this is a
pretty straightforward HTML let me
format that properly okay so if you look
at the HTML here this in this table we
have a TR here which just sets the
heading for the user control product
user control let me show you the design
so this is how it looks like that's the
heading with a gray background product
user control and then we have the static
text select product with a drop-down
list okay and if you look at that one
that the I look at that way that's the
static text and then they drop-down list
control and this drop-down list control
has several list items all the products
that are basically within the table
within this table products table
whatever products we have we have them
in the drop-down list as well that names
just their names okay along with those
products I have an additional list item
here which says all and the important
thing to notice here is that the text
and value are both names okay and
another important thing to notice here
is auto post bacc property is set to
true which means whenever a selection in
the drop-down list changes the it's
going to be posted back to the web
server immediately so that's the second
TR and then we have a grid view control
obviously whatever product that I select
within the drop-down list I want to show
that product within the grid view
control so to display those products we
have this grid view control and then use
a control silver time and use a control
in time so to print the client time we
have this JavaScript code we have
discussed about this in the previous
sessions of this video series so we are
using the date JavaScript function to
retrieve the client-side date and time
and we are printing that using the write
function of the document object okay so
since that is a Java Script as it's
enclosed within the script
and that's the client time and we are
going to print the server time in this
label control so we will compute that in
the code-behind file in just a bit and
obviously that's the gridview control so
that's the design of the user control
so let's you know specify the code in
the code-behind file so what we need to
do in the code-behind file again I have
this coded app so let me go ahead and
copy and paste it and then we'll go
through it in a bit so that's the piece
of code again this is pretty
straightforward code there so if you
look at this one in the page load what
we are doing you know if it's not a
postback in the sense if it's the
initial get request we are getting
product by name and what I'm going to do
here instead of saying all instead of
hard-coding the value of all I'm going
to say drop-down list 1 dot selected
value so whatever value that we have
selected in the drop-down list
ok so pass that value to this method get
product by name so what is this method
doing if we look at this it's a private
method and this method has caught some
simple ad or net code so if you look at
this method all it does is it makes a
connection to the database and then
executes the stored procedure SP get
product by name
ok and that's the stored procedure which
we have just seen ok so whatever
whatever we product that we select
within the drop-down list that name is
passed into this method and this method
will pass that name to the stored
procedure SP get product by name execute
the stored procedure retrieve the
results and display that within the grid
view control so this is simple ad or
dotnet code I am NOT going to go through
this ad or dotnet code because we
discussed about ATO dotnet code in a
great detail in a do dotnet video
tutorial please refer to that videos ok
so that is this method so so we are
calling this method in the initial get
request if it's not a postback then call
that method pass and whatever you
selected in the drop-down list initially
when the page renders all will be
selected in the drop-down list because
that's the first item within the
drop-down list so if you look at this
that's the first item so that will be
all will be selected which will be
passed to this method and this method
will retrieve all products and then
display them in the grid view control
and the other thing is label one dot
text which is nothing but this label
control which is going to display the
server side
date and time so we are basically
setting the text to daytime now dot two
string and then we have set the auto
post back property of this drop-down
list control to true so I want basically
let's get rid of that there
so whenever the selection in the
drop-down list changes we want to post
back to the server so if you look at
this we want to post back to the server
and what we are basically doing is
whatever the user or whatever the value
that the user has selected in the
drop-down list we are passing that
selected value to get product by name
function and what is that function doing
it's going to pass that name to that
stored procedure execute that retrieve
the results and display the results in
the grid view control okay so simple you
know all we are doing on this pages
basically within the initial page load
we are calling this get product by name
we display all the products but whenever
we change the selection in the drop-down
list this method gets executed and we
will only show the selected product in
the grid view control all right now we
want to use this user control on this
waveform one dot aspx okay now here I
already have a register directive for
the user control because if I want to
use that user control on this web form I
need to register that user control
either on the waveform or in web config
file okay so it is that register
directive if you're new to user controls
I would strongly recommend to watch the
video tutorials on user controls that we
have discussed about in the previous
sessions of this video series okay so
let's look at the HTML that we need on
this waveform itself
so again I have this here let me copy
and paste this let me format this
properly okay so if you look at this
again I have this table and within the
table this one TR so if you look at the
design you know it's pretty much
straightforward this is the user control
itself so if you go to the source that's
the user control in one of the TRS and
then above the user control I have
another three TRS okay so if you look at
the three tiers that I have here so here
I have a heading which is page content
that changes so maybe on this platform I
have some page content which dynamically
of it changes every time i refresh the
web form maybe company events company
news etc and then I have this page
server time okay static text and then a
label control to print the server-side
date and time and then obviously a text
here static text stating page client
time and if you look at that line time
we are printing the client time again
using the Java Script so we are printing
the server time and client time on the
web form as well as on the user control
okay all right so now we have all set up
but remember either on the web form so
this is form code we don't have any
caching enabled on the web form and if
you look at the user control again we
don't have any caching enable on the
user control as well so obviously if we
run this application as it stands let's
save everything you know every time we
request this Web form change the product
selection in the drop-down list you know
the wave form is going to be reprocessed
the wave form and the user control
everything will be reprocessed okay
basically we have forgot to set the page
server time so let's go ahead and set
that to do that and the page load event
I'm going to set label one dot text is
equal to date time dot now dot two
string
okay so let me run this now so when the
webform first loads up in the drop down
list all will be selected on all
products will be displayed and look at
this look at pay attention to page
server and client times and user control
server and client times all of them are
basically the same because everything is
is being processed on the server okay
so even if I change the selection for
example I just want LCD TVs look at that
all the times both on the page and on
the user control they are the same now
let's say you know we want to cache
multiple versions of this user control
okay to do that obviously we have to
enable caching on the user control so
let's go to the user control and enable
caching so to enable caching we can use
the output cache directive so output
cache director let's say I want to cache
this waveform for maybe 60 seconds so
I'm going to set 60 as the duration and
then I'm going to set vary by control is
equal to drop-down list one because we
want to cache multiple responses you
know based on varying value within this
drop-down list one control I am setting
vary by control two drop-down list one
okay that's that we enabled caching for
this user control and we have enabled
you know basically we are going to cache
multiple versions of this user control
okay for each different selection in the
drop-down list we will have a separate
response of that user control cache so
with this change let me go ahead and run
this
so now notice the times you know the
page and a client-server side times
they're almost the same this one second
difference here and one second
difference here okay now at this time
you know the user control time pay
attention it is 1302 53 that's when the
get request of this waveform one dot
aspx is cash and let me go to LCD TV and
then let's go to the get request again
look at that look at the user control
server time it is still 30 no to 53 it's
cached at that time I'm going to receive
this cached response anytime I see a get
request okay and if I change it to LCD
TV look at that again for the selection
this platform I mean this user control
is basically cash at 1303 13 and that's
what I get but look at the page silver
time and client time and the user
control client time they keep changing
all the time but not the user control
server time you always receive you know
a cached response in case if there is a
response still if it has not expired
okay so for each selection in this
drop-down list we are going to have a
separate response cache for this user
control so obviously to cache multiple
responses for a user control we can use
the very by control attribute you might
be wondering can't I use vary by params
yes we can use vary by parents usually
in general whether to cash in or
multiple responses for web forms or user
controls we usually use vary by params
when when we want to very you know
caching multiple responses based on
differing query string values or posted
form of values in the next video we'll
actually discuss about using vary by
params to cache multiple versions of
this user control all right another way
to actually cache multiple versions of
this user control instead I mean here if
you look at this we are actually using
the very big control attribute of the
output cache directive instead of that
and we are doing that declaratively in
the HTML now if we want to do it
programmatically we can actually use the
partial caching attribute so if you look
at this slide here
you know we have just seen how to catch
multiple responses of the user control
declaratively using the very bike
control attribute of the output cache
directive which is in the HTML on the
other hand we can also cache multiple
responses of the user control
programmatically using variable controls
property of the partial caching
attribute so on the user control class I
can use this partial caching attribute
so if you look at this at the moment in
the user control HTML I have got rid of
that output cache directive I'm going to
go into the class file of the user
control so this is the class of the user
control and then here I can actually use
partial caching attribute so partial
caching and if you look at the
constructor of this attribute you know
you can specify the duration and if you
look at the other overloaded version you
can specify named parameters as well
okay so basically I want to cache this
for 60 seconds so I'm going to set 60 as
the duration and look at this name the
parameters we can specify the name of
the parameter and its value that's what
this named parameters mean so I can
specify vary by controls property the
parameter here so vary by controls is
equal to then whatever is the name of
the control by which we want to vary
that in this case we want to you know
vary caching based on drop-down list one
control so I'm going to specify that as
the value for vary by controls parameter
named parameter so this is one way
another way is actually so that's one
way let me comment that let me paste
that here or let me open the attribute
once again so partial caching attribute
so partial cashing and look at this this
is the second overloaded constructor of
the partial cashing attribute you know
class but there is another constructor
which basically takes all these
parameters so duration is 60 and look at
the next parameter it's vary by params I
am NOT going to vary anything by params
so I'm going to pass now then you can
specify value by controls in this case
the very rate controls is going to be
drop-down list one so that's what we
pass and finally vary by custom I'm
going to pass that as now so I can
either use this constructor of the
partial cashing attribute or I can use
the constructor that takes named
parameters I would say this is clean
because you know what you are varying
the response just by looking at the code
here I am varying or I am caching
multiple responses based on vary by
controls parameter here it's not that
clear you will literally have to open up
this you know parentheses to see which
overloaded version of the constructor
that we are using to figure out you know
based on which we are cashing multiple
responses for this user control but you
can either use this constructor or this
constructor to cache multiple responses
of that user control as I told in our
next video we'll be discussing about
when and how to use vary by params to
cache multiple versions of the user
control we will also be talking about
the differences between caching multiple
versions of the user control by using
vary by params and vary by controls on
this slide you can find resources for
asp.net c-sharp and sequel server
interview questions that's it for today
thank you for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>