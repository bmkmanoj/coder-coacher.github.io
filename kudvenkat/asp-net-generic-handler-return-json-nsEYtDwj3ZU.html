<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>asp net generic handler return json | Coder Coacher - Coaching Coders</title><meta content="asp net generic handler return json - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>asp net generic handler return json</b></h2><h5 class="post__date">2015-08-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nsEYtDwj3ZU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 110 of jQuery tutorial in
this video we'll discuss implementing
asp.net January can law that calls a
stored procedure and return JSON data in
a previous video session we've
implemented this stored procedure SP get
employees that generally canler that we
are going to implement now should call
the stored procedure retrieve the data
convert that which is in format and then
we want to display that JSON formatted
data using jQuery data tables plugin as
you can see here so for this to happen
the jQuery data tables plug-in is going
to issue a request to the server in our
case it's going to issue the request to
the handler that we are going to
implement and the request looks like
this notice here the request is being
made to a file with extension dot a sh
ax so that's a handler that's the
asp.net Handler and notice we have got
several query string parameters display
length display start short column sort
direction and search so the generic
handler that we are going to implement
now should read the values from these
query string parameters called the
stored procedure provide those values
retrieve the data convert the data to a
JSON object and the JSON object that we
are going to send that from the server
back to jQuery data tables plugin should
look like this so it should be a
well-formed a JSON object with these
properties I total records so this
property is going to specify the total
number of flows that we have in the
database table I total display records
this property will also specify the
total number of records but after the
filtering is applied a data
this property is a two-dimensional array
that contains the data that we want to
display in the jQuery data tables
plug-in if you look at the request here
look at that the search query string
parameter is equal to female meaning we
want to retrieve only the female
employees and if you look at the
response here notice that look at the
gender of each of the employee object
that we have it's female okay and look
at the total records it's 14 so in the
database table we have 14 records and
after the filter that is you know the
search filter is applied beyond
for female records so that's what this
property specifies total display their
cards now the question that comes to our
mind is how do I know these are the
names of the parameters and this is how
the response should look like that's
from the jQuery data tables plug-in
documentation so if you visit the URL
right here you have the documentation
for performing server-side processing so
if you want to implement server-side
processing then these are the parameters
that are sent to the server from the
jQuery data tables plug-in so notice we
have ie display start I display length I
columns so basically those are the query
string parameters and as you can see in
the request URL here look at that I
display length I display start etcetera
so those are the parameter values that
are sent to the server ok and the reply
from the server should be a well form
the JSON object
with these properties I total records I
total display records and a data it's a
two-dimensional array okay so let's see
how to implement that handler which is
going to read the values from the query
string called the stored procedure
retrieve the data convert that to JSON
format and return that JSON formatted
data so we can display that using jQuery
data tables plug-in so let's flip to
visual studio the first thing that we
want to do here is add a class file to a
project and I'm going to call this
employee dot cs and this class is going
to have an integer property I'm going to
call it ID employee ID basically and I'm
going to have a property for first name
first name is is going to be of type
string
similarly we need for last name gender
and job title so let's change the
property names this is going to be last
name this is going to be gender and this
one is going to be job title alright so
we have the employee object now let's go
ahead and add a generic handler so we
want to add
a generic Handler and let's call this
employee data handler so we are going to
write some ATO dotnet code here so I'm
going to bring in the area or namespaces
we need system dot configuration we need
system dot data we need system dot data
dot sequel client and finally system dot
web dot script dot serialization all
right so within our process request
function we need to read the parameter
values from the query strings right so
for that we are going to use the context
object and if you look at the request
here look at that I display length I
display star
those are the names of the parameters so
let's use the context object context dot
request off so what is the name of the
parameter I display length so I'm going
to copy that from the notepad to avoid
any typos and I'm going to store that in
an integer variable look at the prefix
for the property it is I display length
of integer so I am going to store that
in a variable let's call this variable
display length of type integer and we
want to convert this to an integer so
I'm going to use in dot parse function
so in dot parse
similarly we need to read the other
parameter values from the URL and in the
interest of time I have already typed
the required code so I'm going to copy
this and paste it right here so we are
reading display start value short column
short direction and the search okay so
we have the values that we want to pass
to the stored procedure now let's go
ahead and read the connection string
from a web config file and to do that we
are going to make use of configuration
manager class configuration manager dot
connection strings off and the name of
the connection string is DB CS and let's
go ahead and create sequel connection
object let's call it con equals new
connection and this we have to pass the
connection string now let's go ahead and
create sequel command let's call it CMD
equals new sequel command and using this
object we want to execute or store
procedure and the name of the stored
procedure is SP get employees so let's
pass the connection object that we have
created above and this is a stored
procedure so we have to tell that to the
command object command type dot stored
procedure and this command object has
got several parameters so let's go ahead
and create a sequel parameter object so
I'm going to call this pair I am display
length equals new sequel parameter and
we need to specify parameters name so
display length parameter name in the
stored procedure is at display length so
let's go and specify that here and the
value for this parameter is coming from
this variable so we are reading from the
URL creating a sequel parameter object
and specifying that here so display
length and what do we need to do with
this parameter object we need to
associate that with the command object
so command or parameters dot add let's
pass the parameter display length now we
need to do the same thing for the other
parameters that we have display start
short column short Direction inserts in
the interest of time I have already
typed the required code so let's copy
all these parameter objects from the
notepad and paste them right here so we
have all the parameters that are
required for the stored procedure
display length display start and then we
have short column sort direction finally
search okay so we have associated all
the parameters now let's open the
connection connection dot open and then
let's execute the command so let's
create an instance of sequel data reader
and command dot execute Rita let's loop
through each low using while loop so
while our dr dot read what do we want to
do we want to create an employee object
and add that to the list of employees
that we want to return so at the top
right here outside of this using block
I'm actually going to create a variable
of type list of employee and let's call
this list employees equals new list of
employee and here inside our while loop
let's create the employee object let's
call it employee equals new employee and
we need to populate it properties
employee dot ID equals we need to read
it from the reader so RDR off the name
of the column is ID let's convert that
to integer so convert win32 and we need
to do the same thing for the other
properties of the employee object as
well again in the interest of time I
have actually typed the required code so
let's copy that from our notepad
and paste it right here so we are
populating the rest of the properties of
the employee object first-name lastname
gender and job title the next thing that
we want to do is add it to the list so
list employees dot add pass of an
employee object and that will be added
to the list now look at this when we
execute this stored procedure in
addition to ID first name last name
gender and job title we are also getting
the total count so this is basically the
count after the filter is applied so if
I don't specify any filter you know we
get all the rows right all 14 rows now
if I apply a filter look at this female
then we get the filter count so that's
four right so we also want to read that
filter it count so what I'm going to do
is outside again this using block I'm
going to create a variable I'm going to
call this filtered count equals zero
initialize that and then inside of a
while loop where we are looping through
each row what I'm going to do is
populate this property so filtered count
variable equals then we're dot two and
32 off what is the name of the column
here in the result set
total count so I'm going to specify that
their total count okay so now by the
time this loop finishes we have the list
of employee objects that we want to
return and keep in mind how should the
response look like it should be adjacent
object and it should contain a total
records I total display records a data
that's how the response should look like
so and to avoid any typos I have already
typed them in the notepad right here so
what we are going to do is once we have
the list
so this is where we are closing the
using block so right here let's create
an instance of actually before that we
need to create a variable and this is
actually going to be the result that we
want to serialize to JSON format so this
is going to be a new object so I'm going
to create an empty object here and this
is the object that is going to contain
the properties that we want to return so
what are the properties that we want to
return I total records so what is this
property going to represent the total
number of records that we have in the
DBA so the total rows that we have in
the DB are I think 14 right so we want
to retrieve that total right so if you
look at the count here on the right hand
side it's 14 rows now to retrieve that
I'm actually going to write a small
private function so this is going to
return integer get let's call this
employee total count and again here we
are going to write some radio dotnet
code just to save some time in typing
let's copy these lines from here
actually even this and paste it within
our private function and then we'll
modify it according to our need okay
so configuration manager we need to read
the connection string and let's create
the sequel connection object sequel
command this time it's not going to be a
stored procedure so we want to retrieve
the total count from the table so I'm
going to use select count of star from
TBL employee so that's the query that we
want to execute and this is not a stored
procedure so we can get rid of that and
I'm going to create a variable here and
let's call this total employee count
equals zero and we need to open the
connection so let's go and do that and
command dot since we are getting a
single value from the DB we can use
execute scalar and total employee count
equals that result and we need to
typecast that to
integer okay so we have the result
variable all we need to do is return
that total employee count okay so this
function is going to give us the count
of total employees and we want to set
that as the value for this property so
we are going to return an object which
is going to contain ie total records and
the value for that is going to be the
return value of this get employee total
count and the next property we want is a
total display records and where are we
going to get the value for that that is
going to come from this variable right
here
filtered count because I to the display
records represent you know the total
number of rows that we have in the DB
after the filters are applied so that's
filtered count and then the third
property that we want to have is a data
so a data equals that's nothing but our
list of employees that we want to return
so I'm going to specify that as the
value so now we have our result object
now let's go ahead and create an
instance of JavaScript serialize a class
let's call it J s equals new JavaScript
serializer and then J s dot serialize
function and let's pass our result
object to that okay and let's write it
to the response stream so we are going
to use the context object the response
dot write D JSON response all right so
we have our handler implemented so let
us go ahead and build our solution and
let's view that in the browser so let's
run this so when it first loads it's
actually going to throw an error because
we need to supply the values for
employee data handler look at this when
we issue a request to employee data
handler dot a sh
it's going to throw a runtime error
because look at that it's trying to read
the value from the query string but we
don't have any query string parameter
there so that's why when it is trying to
convert that to integer a null value it
throws an exception so this is how our
URL should look like let me paste that
here and actually we have a different
port number here so let's copy the URL
from there you know we only want the
query strings so if you look at the URL
right now look at that we have display
length 4 you know this query string
parameter we have display start sort
columns or direction and search and for
now let's remove search okay on that so
now we should get the response from the
server and so basically it says invalid
table name TBL employee because our
table name is TBL employees so let's go
ahead and change that there and let's
reload this one more time so now we get
look at this if you look at the output
here notice that we get all the records
you know the total records of 14 and
total display records of 14 because no
filters are applied so it's going to
return us all the rows and you know we
have 14 rows here now let's go ahead and
specify the other parameter so the
search parameter is s search right let's
confirm that from the jQuery data tables
documentation so the global search field
is s search so let's copy that to avoid
any typos s search equals let's specify
that as female so now it should only
retrieve the female employee rows and
look at that the total records in the
database of 14 but the total display the
cost that is after the filters are
applied it's only for
and what we get back is only those
female employees notice the gender there
now in our next video we'll discuss how
to display this JSON data using jQuery
data tables plugin thank you for
listening and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>