<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 97   Performance of a multithreaded program | Coder Coacher - Coaching Coders</title><meta content="Part 97   Performance of a multithreaded program - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 97   Performance of a multithreaded program</b></h2><h5 class="post__date">2014-03-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/aDCAMwTgiZU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">about 97 of c-sharp tutorial in this
video we'll discuss the performance
implications of a multi-threaded program
then run on a single core of processor
machine versus multi-core processor
machine first let's discuss how to find
out how many processes we have caught on
our machine there are several ways to do
that the easiest way is to use the task
manager and to get to the task manager
simply right-click anywhere on the task
bar and select this option start task
manager that should bring up the windows
task manager under performance tab you
should see CPU usage history and the
number of green boxes here represents
the number of processors you have since
I have two green boxes here it means on
my machine I have got two processors
that's one way and another way is to use
you know the processor count property on
the environment class so we can use this
code in any dotnet application here I
have a console application so let's say
console dot write line let's say
processor count equals plus environment
class dot process account so let's
quickly run this and see if we get
output look at that process account
equals two and the third way is on the
Windows command prompt window just type
this command echo number of processors
and that should give you as well so I am
at the command prompt at the moment so
if they execute that command there look
at that we get that too okay so at the
moment on my machine I've got two
processes meaning you know two threads
can be simultaneously executed all right
so on a machine that has multiple
processors multiple threads can execute
application code in parallel or
simultaneously on different cores for
example if there are two threads and two
cores then each thread would run on an
individual core this means performance
is obviously better so if two threads
take ten milliseconds each to complete
then on a machine with two processor
total time taken is ten milliseconds on
the other hand on a machine that has a
single processor multiple threads
execute one after the other or wait
until one thread finishes it's not
possible for a single processor system
to execute multiple threads in parallel
since the operating system switches
between these threads so for us it just
gives us that illusion that the threads
are running in parallel but that's not
true on a single core processor machine
multiple threads can affect performance
negatively as there is overhead in world
with context switching we discussed what
context switching is in the previous
session but let me briefly explain that
once again so basically let's say when
we have got two threads on a single
processor you know the processor can
execute only one thread at any given
time so each thread will get a time
slice you know for which it can run from
the processor so when the process is
executing a thread you know let's say
that thread takes five seconds to
complete but then the processor
allocates maybe you know let's say five
milliseconds
you know the thread is going to be run
by the processor only for five
milliseconds after that the processor is
going to save the state of the thread
somewhere and then switch to another
thread pick up that thread execute it
maybe for five seconds and then save it
state somewhere and then switch back to
thread one so the processor has to
switch between threads rapidly and
that's called context switching and
there is some overhead involved between
you know switching these threads okay so
if two threads take ten milliseconds
each to complete then on a machine with
one processor the total time taken is 20
milliseconds because obviously the
threads are still going to take ten
seconds each to complete so 20
milliseconds plus the thread context
switching time okay so it will in fact
be slightly more than 20 milliseconds
there now let's actually quickly write a
simple program so on my machine at the
moment I've got two processors meaning
two
can execute in parallel okay so here
I've got a tool functions basically even
number sum function so what is this
doing it's simply counting from zero to
five million and then it's checking
whether the number is divisible by two
if it's divisible by two then we know
it's an even number in which case you
know we are finding this you know the
total sum of the even numbers from zero
to five million and then finally we
print that Sam okay so that's that
function and we have a similar function
here but this one is actually computing
the sum of odd numbers okay so two
simple functions but then they're going
to take a few milliseconds to run
because you know five million is a big
actually it's 50 million not five
million it's a big number so now within
our main method what we will do is we
will actually call the methods you know
without using threads and see what time
it takes and then we'll create threads
to threads and execute both of the
methods and see how long will it take
okay so basically at the moment both of
them are static methods so I don't have
to create an object of the class so we
can simply call even numbers sum so
they're calling that function and odd
numbers are and we want to print the
time so to print the time let's make use
of the stopwatch class that's present in
systems or Diagnostics namespace so
system dot Diagnostics and then within
the main method let's start an instance
of a stopwatch so let's call it
stopwatch
equals stopwatch dot start new so that
would start the stopwatch and then once
we have executed both of the methods
stop the stopwatch and then
console.readline total milliseconds
without multiple threats so here we are
not creating multiple threats a single
threat is going to execute this code so
we will see the time it takes okay
while we are here let's also create
multiple threats and execute them and
see how long the threads take to execute
those two functions so let's go and
create a thread let's call it t1 equals
new thread and we want this thread to
execute you know even numbers sum
function and similarly let's create
another thread and call it to to t2 and
we want this thread to execute odd
numbers sum function and obviously we
want to start the stopwatch again and
then stop this stopwatch and then print
the time it takes
so total milliseconds with multiple
threads
actually we should print the time and
how do we get that stopwatch object has
got elapsed milliseconds property so
let's use that
so let's actually copy this code and
paste it right here okay so we are just
creating threads here we need to start
them as well so t1 dot start
and t2 dot star and then let's wait for
the threads to finish and to do that use
the join method on both of the threads
so do you wonder join and T 2 dot join
alright let's go ahead and run this
actually let's do the solution and let's
run this program from visual studio
command prompt so let's go to all
programs Microsoft Visual Studio 2010
Visual Studio Tools and we want to run
Visual Studio command prompt so let's
run it as an administrator right and at
the moment
our project is present in C Drive so
let's navigate to the Ben debug
directory copy that part and then paste
that within the Visual Studio command
prompt and change the directory okay so
our project name is threating example so
we should have an executable with that
name so threading example dot exe let's
run that so some of even numbers look at
that total milliseconds without multiple
threads
it has taken 766 milliseconds whereas
with multiple threads 579 let's run it
once more so without multiple thread 792
571 let's run it once again 785 566 so
obviously with multiple threads we are
we are able to execute you know the
threads much faster okay alright that's
it for today thank you for listening
have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>