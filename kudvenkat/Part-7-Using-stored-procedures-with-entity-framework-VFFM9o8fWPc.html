<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 7   Using stored procedures with entity framework | Coder Coacher - Coaching Coders</title><meta content="Part 7   Using stored procedures with entity framework - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 7   Using stored procedures with entity framework</b></h2><h5 class="post__date">2014-05-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VFFM9o8fWPc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 7 of entity framework
tutorial in this video well discuss
using our own custom stored procedures
to perform insert update and delete
operations using entity framework let's
now look at the steps involved we'll be
using this employees table for this demo
here is the sequel script to create and
populate it with some sample data i've
already executed the script so if you
notice a sample database we already have
employee's table then the next step is
to create the insert update and delete
stored procedures here is the sequel
script that can do it again I have
already executed the script so if you
notice stuartt procedures folder here on
the sample database we already have
those three stored procedures insert
employee update employee and delete
employee
I'll have this entire sequence available
on my blog in case you need it right the
next step is to create a new asp.net web
application project I have done that as
well already so here we have a new empty
asp.net web application project so to
this project let's go ahead and add an
ad or an entity data model and let's
call this employee model we want to
generate the model from the database so
select that option and click Next
and give the connection string a
meaningful name I'm going to call this
employee DB context and then click Next
so now entity framework is going to
connect to the database and retrieve all
the tables views and stored procedures
so we have there our employees table and
let's select the three stored procedures
insert update and delete employees and
let's give the model namespace a
meaningful name let's call this employee
model and click finish so this should
generate the area dotnet entity data
model for us and if you look at this
area dot entity data model designer
surface we can only see the entity but
we can't see the stored procedures to
view the stored procedures right click
on the designer surface and then select
model browser
so within model boss browser we should
be able to see the store procedures so
notice that under employee model store
we have got tables / views
expand that we find our employees table
there and once we expand that we should
be able to see the columns belonging to
that table similarly if we expand the
stored procedures folder notice that we
have got the three stored procedures and
if I expand delete employee for example
it shows us the parameters that this new
procedure expects similarly insert
employee and update employee all right
so now let's go ahead and add a perform
to a project
and let's set the style attribute here
let's set style font family to area and
let's actually flip this to the design
mode and we want a grid view control we
need a details view control and an
entity data source control first let's
configure the entity data source control
so click on this configure data source
link and select employee dbcontext
at the moment we have that error that's
basically because we did not build the
solution after we have generated the
Ariat or that entity data model so let's
build a solution and then let's now
configure the data source so let's
select employee dbcontext click next and
our entity set is going to be employees
and make sure you have selected these
three checkboxes enable automatic
inserts updates and deletes click finish
okay now let's associate this entities
data source with this grid we control
but before we do that lets actually auto
format this so that it looks a little
nice and now let's choose sequel entity
data source 1 as the data source for the
grid view control and we also want to
enable editing and deleting on the grid
view control and the reason why we are
using details view control here is to
basically to allow inserting an employee
record into the database so we're going
to do that using the details view
control okay so grid view is going to
help us editing and deleting this
details view is going to help us with
the insert of operation so let's auto
format the details view also to use
colorful scheme and let's also choose
the data source as entity data source
one for the details view control and we
want to enable inserting so let's select
that checkbox now we only want to use
this details view for inserting a row so
what I'm going to do is I am going to go
to the properties of this details view
control and there is something called a
default
and the default mode by default it's
read-only so let's change that to insert
and notice that at the moment this
details view you know is allowing an ID
to be entered but if you look at the
employees table you know DDL here this
ID column is an identity column meaning
we don't have to supply a value for that
when we are inserting an employee record
so it doesn't make sense to actually you
know I love the idea to be entered here
so we want that to be invisible in edit
mode and to make that invisible flip
into the source mode into the HTML
source mode and this is the bound field
within that details view so this has got
an attribute called insert visible let's
set that to false let's flip this to the
design one and notice that the ID column
is gone okay so with all these changes
let's go ahead and run our web
application project so we should be able
to insert update and delete data okay
now let's actually flip to sequel server
management studio let's select the rules
that are already there so at the moment
we have got seven rows and that's what
is displayed on the web form now let's
also fire up sequel profiler so click on
Tools sequel profiler so basically
sequel profiler help us you know
identify what queries are being executed
against sequel server so I'm going to
run the profiler right now let's go
ahead and edit an employee so let's say
we want to change marks name from mark
to mark M now let's click update and
let's go back to sequel profiler and if
you notice look at this here is the
update statement let's actually pause
the sequel profiler so if you look at
this update statement right here look at
this the entity framework has generated
a sequel statement a parametrized sequel
statement it's not making use of the
custom stored procedures that we have
written
okay so by default entity framework is
going to use the auto-generated sequel
statements okay if we want to tell the
entity framework to use the stored
procedures we have to map them to the
employee entity we'll do that in just a
bit the same will be the case when we
insert a new row let's say we want to
insert an employee called Josh male and
let's say his salary is 56,000 and once
we insert that at the moment we have a
problem look at this when we insert you
know the data the row gets inserted so
if we execute this look at that
Josh record is inserted here but then
it's not displayed within the grid view
control that's basically because we need
to rebind the data to the grid view
control and the easiest way to do that
is obviously as soon as we insert a row
using that this details view control
that's when we want to refresh this grid
view control so I'm going to go to the
properties of the grade details view and
then if we navigate to the events tab
there as soon as item is inserted so
let's generate the even handler for item
inserted event and all we are going to
do here is invoke the data bind method
of the grid view control so let's run it
once more and then let's actually insert
another row let's call you know let's
add an employee called Stacy female and
let's say our salary is 60,000 that's
insert that and notice that it gets
refreshed and if you look at we actually
pause sequel server
I mean sequel profiler let's actually
Aires everything that we have here and
let's start the profiler once again
let's insert one more row just to let's
say test male and let's say 34,000 let's
answer that now if we go back to the
profiler let's pause it and if you look
at this again look at that it's using
the dynamically generated sequel that is
the parameter is to where it's not using
those stored procedures let's see how to
map our custom stored procedures you
know to
Floy entered a it's very simple to do
all we need to do is go on to the ad
identity model designer surface right
click on the entity and then you have an
option there to map store procedures so
select that and then here look at this
you have the option to select your
insert function update function and
delete function notice that it doesn't
say stored procedures here basically
because in dotnet terms you know it's
stored procedure is essentially like a
function right so once it is brought
into dotnet 80 or dotnet entity data
model we call them as functions so
select your insert function that's going
to be insert employee so once we select
that notice that here we have the
parameters for insert employee stored
procedures and here we have the
properties so name property of the
employee entity should be mapped with
name parameter of the insert employee
stored procedure ok the same is the case
for gender and salary let's select the
update function in this case update
employee and again notice that the
mapping is done for us automatically and
finally we need to do the mapping for
delete so let's select delete employ
delete stored procedure has got only one
parameter that's ID all right so with
this change let's go ahead and run our
web application project let's clear out
everything that we have let's say we
have for example test three male 20,000
and before we click insert let's
actually start the profiler and click
insert and if we go back to the profiler
we should have look at that a call to
insert employee is is made so insert
employee look at that the values for the
parameters are passed name gender and
salary on the other hand for example if
you update an employee let's say we have
changing John - John one male to female
and maybe 80,000 to
maybe 90,000 and let's actually it is
everything on the profiler and click
update now look at that update employee
so we have again as you can see there
you know the parameter value so now
entity framework is using our custom
store procedures so it's that simple
you know mapping stored procedures with
entity framework that's it for today
thank you for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>