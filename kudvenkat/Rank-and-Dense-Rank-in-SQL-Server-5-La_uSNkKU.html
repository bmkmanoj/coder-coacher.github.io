<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rank and Dense Rank in SQL Server | Coder Coacher - Coaching Coders</title><meta content="Rank and Dense Rank in SQL Server - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rank and Dense Rank in SQL Server</b></h2><h5 class="post__date">2015-10-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5-La_uSNkKU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 110 of sequel server
tutorial in this video well disc is
Frank and dense rank functions in sequel
server rank and dense rank functions are
introduced in sequel server 2005 both of
these functions return a rank starting
at 1 based on the ordering of rows
imposed by the order by clause order by
Clause is required partition by clause
is optional when the data is partitioned
rank is reset to 1 when the partition
changes now we have two different
functions to provide a rank so what is
the difference between rank and dense
rank functions rank functions Kipps
rankings if there is a tie where as
dense rank will not let us understand
this with an example let's say we have
two rows at rank 1 and we have 5 rows
and total in the table in this case rank
function is going to give a rank of 1
for the first two rows 1 1 because there
is a tie for the third row look at that
it gives a rank of 3 it has kept Rank 2
meaning rank function is going to leave
holes in the rankings it provide if
there is a tie dense rank on the other
hand will not leave those holes so just
like rank function dense rank also gives
a rank of 1 to the first two rows and
then for the third row it's actually
giving a rank of 2 instead of 3 so
that's the fundamental difference
between rank and dense rank functions
and we have the syntax here we first
specify the name of the function rank or
dense rank followed by that we use the
over keyword and then within parentheses
we use the order by clause and then the
column list by which we want to sort the
data let's look at an example and that
should make all these points clear will
use this employees table for the
examples in this demo what we want to do
is sort the employees data by salary
column in descending order and then
provide ranks for every row so we
basically want to provide a rank of 1 to
the first highest salary rank of 2 to
the second highest salary so on and so
forth within our results that we want
name gender
salary and rank so let's use the bank
function so we first specify the name of
the function followed by that we use the
over keyword and then within parentheses
we use order by Clause order by clause
is required because rank and dense rank
are issued based on the ordering imposed
by this order by clause so we want to
sort the data by salary column in
descending order and let's give this
column Analia let's call this rank
since rank is a function name let's wrap
that with a pair of square brackets
let's do the same thing for dense rank
so I'm going to use dense rank function
as well and let's change the column name
to dense rank let's execute the query
and see what we get now the first thing
to keep in mind here is that we are not
using partition by Clause so the data is
not partitioned we have a single
partition here now look at what rank and
dense rank function starts for the first
two rows both the functions give a rank
of one and then for the third row rank
function gives a rank of three whereas
dense rank gives the rank of two so rank
function is going to leave holes in the
rankings it provides if there is a tie
dense rank on the other hand will not do
that it doesn't leave any holes so here
we don't have a partition involved and
we have that exact same example right
here now let's see what's going to
happen if there is a partition involved
what we want to do now is partition this
employee table data based on the gender
column when we do that we are going to
get two partitions male employee
partition and female employee partition
so let's use the partition by class so
partition by gender let's do the same
thing for dense rank as well now let's
execute this query and see what we get
the first thing to notice here is that
we've got two partitions the first
partition is female employee partition
and look at the ranking it starts from
one and goes till four same for both
rank and
slang when the partition changes look at
what happens to the rank it is reset to
one just like the rule number function
that we discussed in our previous video
section and we have that example right
here so the next obvious question that
comes to our mind is what is the use
case for rank and dense rank functions
well both of these functions can be used
to find entire salary however which
function to use depends on what you want
to do when there is a time for example
if we have two employees with the first
highest salary then there could be two
possible business cases if your gizmos
case is to not written any rows for the
second highest salary then use rank
function on the other hand if your
business case is to return the row that
is present after the tide rose as the
second highest salary then use dense
rank function let's understand this with
an example so what I'm going to do is
modify this query so with no result set
I don't want name and gender columns so
I'm going to get rid of those two
columns we just want salary and then for
now I'm going to use rank function I'm
going to get rid of this partition by
Clause just use auto by and let's call
this column celery rank and let's remove
this tense rank function now now
whatever result we get when we execute
this query I'm going to make it a part
of a CD a common table expression so
with let's call this result as
so that's our CTE there now what I want
to do is select top one salary from our
result city where rank equals one now
what I'm going to do is just about this
I'm going to include another query
select star from employees order by
salary descending order so let's execute
this and see what is the highest salary
so highest salary is 8,000 now if we
want to find the highest salary we can
use this you know the first highest
salary so actually the column name is
salary rank not rank where salary rank
is one so when we execute this we get
the first highest salary without any
problem but when I say I want the second
highest salary look at what I'm going to
get I get no rows if your business case
is this if there is a tie then you know
here the tie is for the first highest
salary that means we are not going to
have the second highest salary if we use
the rank function if that is what your
business requirement is then use the
rank function return no rows if there is
a tie for the first rank for the second
highest salary okay and and basically
that's because rank function leaves
holes so let's execute this query look
at that we don't have a salary rank of
two so that's why it returns no row for
the second highest salary on the other
hand if your requirement is you know
well even if there is a tie you know in
this case that I use for the first two
rows I mean for the first highest salary
so but still for the third row I want to
treat that as the row with the second
rank in that case use dense rank
function so when I use dense rank
and when we execute this we are going to
get 7,000 as the second highest salary
okay so depending on our your business
requirement you can use Frank or dents
rank now we can also use these rank and
dense rank functions to find the nth
highest salary among male or female
employee groups and by now you might
have already guessed the way we do that
is by using partition by clause so if
you want to find for example let's say
the third highest salary amount paid
among the female employee group we can
very easily achieve that by using
partition by clause so partition by
let's partition the data by gender
column first let's execute this query on
its own so this is going to partition
the data look at that you know this is
the female employee group we can very
easily that if we see that if we include
the gender column and this is the male
employee group so among the female
employee group if you look at these
salaries the third highest salary is
4,500 so I can say select top one salary
from results so we need gender column as
well within our result set so I'm going
to include that so select open salary
from result where salary rank equals
three and gender equals female okay so
when we do this we should get 4,500
there we go
thank you for listening and have a great
day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>