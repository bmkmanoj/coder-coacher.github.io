<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Sending emails using asp.net   Part 77 | Coder Coacher - Coaching Coders</title><meta content="Sending emails using asp.net   Part 77 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Sending emails using asp.net   Part 77</b></h2><h5 class="post__date">2012-12-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rMAAp5g7-1Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello welcome to prism technologies I am
venket this is part 77 of asp.net video
series in this session we'll discuss
about sending emails using asp.net in
the previous sessions of this video
series we discussed about logging
exceptions to a database table and to
the Windows Event Viewer in this session
we'll discuss about sending an email to
the development team or to an
administrator along with logging
exceptions let's look at an example
before continuing with the session I
strongly recommend to watch the previous
sessions of this video series because
this session is a continuation to that
on this platform one I have a grid view
control when this webform one loads up
we are creating an instance of the data
set object and we are invoking the read
XML method of the data set which reads
the contents of countries to XML and
loads the data into the data set the
data set is then used as the data source
for the grid view control and finally we
call the data bind method but in this
project we don't have this country's dot
XML file so obviously we get a file not
found exception and since we are not
handling the exception on this webform
it gets rolled up till the application
level and at the application level
within global data is a X file we have
application underscore error event
handler which retrieves that exception
using silver dot get last error method
and then we are logging that exception
and if you look at the way we are
logging it we are using the log method
of the logger class this logger class is
actually present in this logger dot C S
file and we discussed about you know how
to create this class and the log method
and what it does in the previous
sessions in a great detail so it
strongly encourage you to watch the
previous sessions before continuing with
the session so if you look at this
logger class it has got the static
logger method and this method takes in
this exception object as a parameter and
if you look at what this method is doing
it retrieves the exception type the
message and the stack trace and it does
that for all the inner exceptions as
well if any and then what it's going to
do it's going to log that exception
message to a database or to the event
viewer or even both and varied
it's log is actually dependent on a
setting that we made in web config file
if you look at this in web config file
we have a key with an app settings
element called log provider so based on
this setting the exception gets either
logged to a database table or to the
event viewer or even both okay
so in this session what we are going to
do is actually send an email and if you
remember to log the exception to the
database we have this method log to DB
and to log the exception to the Event
Viewer we have this method lock the
Event Viewer we are not going to look at
the details of you know how they are
actually logging it to the database end
to the Event Viewer in this session we
discussed about that in the previous
sessions okay so let me have another
method here which will actually send an
email and I'm going to make this method
as public because I want to be able to
call this method even outside of the
logger class anytime I want to send an
email okay so I'm going to call this
public static and it's not going to
return anything so would send an email
and then I'm going to pass to this
method a parameter email body and that's
going to be off string type okay so now
think logically when we have to send an
email what we do you know we have to
specify the from address to address the
subject and body okay but if we have to
create that email message
programmatically how do I do that we use
a class called mail message class and
that mail message class is actually
present in system dotnet dot mail
namespace so we have to import that and
then within that we have this mail
message class so let's create an
instance of that so mail message okay so
mail message and I'm going to call the
instance name also as mail message is
equal to new mail message and then I can
specify different to address and if you
look at this there are four overloaded
constructors for this class I'm going to
use the constructor that takes in the
from and two addresses as string types
so the from address I'm going to specify
my email address could wink at at
gmail.com and by the way they're going
to send the email you
gmail.com okay so good when good I'm
going to send an email to myself the
from and to in this case it's going to
be my email address okay so we have
specified the from end to address what
else is what else do we need to specify
the subject again subject is not
mandatory but it's better if we specify
as a courtesy to the recipient and that
since we are logging an exception I'm
going to say the subject is exception
and we also can specify the body so mail
message dot body and look at this this
subject and body are actually string
types so body we are going to pass the
body into this method when we call it so
I'm going to use the parameter as the
body now okay so we have created the
mail message that we want to send now
how do we actually send this mail
message now in reality if we use Gmail
or you know Microsoft Outlook after we
compose our message we just click the
send button so when we click the send
button what actually happens now there
is something called an SMTP server which
is actually responsible for sending and
receiving emails now since here we are
sending emails programmatically we need
to specify the settings for that SMTP
server things like what is the name or
IP address of that SMTP server what port
number does it use to send and receive
emails okay we have to specify things
like that and obviously when you are
sending an email you will log in and
then only can you send an email so to
log in you will specify your username
and password so for your SMTP server to
send emails programmatically along with
the server name the port number you also
have to specify the username and
password so let's see how do we specify
that to specify that we use another
class called SMTP client so I am going
to make use of that class so SMTP client
SMTP client is equal to new SMTP client
and this class has got a constructor
which takes in the hostname that's the
SMTP server name or IP address and we
specify that in a string format
and since we are sending an email using
Google SMTP server the Google's SMTP
server is SM TP SMTP by the way stands
for Simple Mail Transfer Protocol SMTP
dot gmail.com and the port number you
know Google's SMTP server uses is 587 so
I'm going to use that and not only that
I'll have to specify the username and
password so how do we specify that SMTP
client dot credentials there is a
property called credentials and if you
look at that it expects an object of
type system dot net dot ie credentials
or system dot net dot credentials okay
so I'm going to specify system dot net
dot Network credential and then we need
to specify oh let's use the new keyword
to create the object and we need to
specify the username username is going
to be my email address so could venket
at gmail.com and I need to specify my
password so I'm going to specify test as
bi password I don't reveal it now okay
so we specified the credential so what
else is left out all that's left now is
to actually send the email so how do we
send the email SMTP client dot send we
use the send method and if you look at
the send method it expects the mail
message object and if you look at this
we already have a mail message object so
we want to send this mail message object
using the send method of SMTP client in
the SMTP client you specified which SMTP
server to use what port number to use
and what are the credentials okay that's
it another important thing to send an
email using SMTP is because if you look
at the Gmail it actually operates on
HTTP protocol I mean it's a secure
socket layer as
CEL so there is another property since
it uses SSL we have to specify the SMTP
client dot enable SSL that's a boolean
property okay so we need to set that to
true because gmail uses HTTPS over HTTP
because that's more secure okay all
right so this is the code that we
require so obviously now when we run
this we get we get an exception and that
exception is handled in global dot a si
X and along with you know logging the
exception we also want to send the email
and to send the email we have just
returned the method so obviously we need
to invoke that method so when do I
invoke that method you know we are
retrieving the exception message and we
are logging the exception as soon as we
log the exception I also want to send
the email so I'm going to invoke the
send email method and then pass in the
email body the email body is present in
the stringbuilder object okay so that's
it this will send an email but the
problem with this is it gets sent every
time an exception occurs I feel look at
this you know the exception logging is
actually configurable I can turn it on
or off depending on this key okay now
similarly I want to be able to configure
the capability of sending emails using
web config file so all you have to do is
add a key something like this so add key
I'm going to call this a send email and
I'm going to set that to true so a send
email key within the block conflict file
is set to true only then I want to send
an email otherwise I don't want to send
an email okay so obviously within logo
dot C s file we have to read the value
of that key and based on that you know
if it is true only then we want to send
an email so how do we read that string
string send email is equal to we use the
configuration manager class or
configuration manager don't we use the
app settings property and to
this we specify the name of the key in
our case it's going to be send emails
let's copy that so we have retrieved the
send email string okay so if that send
email a string let's convert that to
lawyer just in case if the user has
entered you know capital letters or
small letters we don't want to really
differentiate between them so I'm going
to convert all of them to lawyer and
then compare that to true so if that is
equal to true
only then send the email otherwise to
understand it so if somebody sets that
to false or anything else we won't send
the email okay so it's configurable so
obviously now when we run this we get an
exception that gets a log if you look at
the web config file since we have
specified both it the exception get log
to both the event viewer and to the
database table and an email will be sent
I'm not going to run this now because if
I run this now you know an email will
not be sent that's because I'm not using
the right password here for my account
I'll have to use my actual password and
then if I run this you know an email
will be sent from me to myself okay and
that's how I have sent this email if you
look at this if you look at this email
so from could wink it at gmail.com to
could wear it at gmail.com and the
subject is exception and this is the
email body okay so in this session if
you remember we actually specified the
SMTP settings within code but it's also
possible these settings can be specified
in web config file we'll talk about that
in the next session of this video series
on this slide you can find resources for
asp.net c-sharp and sequel server
interview questions that's it for today
thank you for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>