<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 6   Export data from sql server database tables to csv file using asp net and c# | Coder Coacher - Coaching Coders</title><meta content="Part 6   Export data from sql server database tables to csv file using asp net and c# - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 6   Export data from sql server database tables to csv file using asp net and c#</b></h2><h5 class="post__date">2014-08-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_LtJzFECbKU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part six of dotnet return test
questions and answers video series in
this video we'll discuss exporting data
from sequence of a database tables to a
notepad in these two formats comma
delimited format and pipe delimited
format in this demo we'll be using these
two database tables departments and
employees so the first step here is to
create these two tables itself which I
have already done so here are those two
tables and here is the sequel script to
create and populate them with some test
data
I'll have the script available on my
blog in case you need it the next step
is to design a waveform that looks like
this so this waveform is going to
provide the end-user the format in which
they want the data to be exported so if
the end user selects comma delimited
option then data from these two tables
should be exported to a notepad with
comma as the separator so the data here
is present in CSV format okay if they
select pipe delimited then the separator
should be the pipe symbol now look at
the way the data is present first we
have the first department row so
department ID department name and
department location so the separator
here is come up and followed by that we
have all the employees belonging to that
department 1 so my John and Josh all of
them belong to department ID and then we
have the second department row which is
the HR department and following that we
have all the employees belonging to HR
department so let's see how to achieve
this now let's flip to visual studio so
what I have also done is created a new
empty asp.net web application project
named it export data and within the web
config file I have already added the
connection string I've given this name
DB CS and at the moment this is pointing
to a server that is installed on my
machine and the database name is sample
and we are using integrated security
that is windows authentication and I
have also designed the web form so that
it looks like what we have on the slide
so first we have this text called format
so that's where we have the text and
then the drop-down list
so at the moment this drop-down list has
got two options comma delimited and pipe
delimited notice for both of the list
items text and value properties are the
same okay and then we have the button
here and the idea of the button is BTN
export and this is the even handler
method that oh that gets called when we
click this button so within the
code-behind file we also have that even
handler method so all that is left now
is to write the ad allotment code
retrieve data from the database tables
convert that either into a CSV format or
pipe delimited format and then store
that in a notepad okay
now where we will be storing the
exported data is within this folder so
within the C Drive I've created a folder
called exported data so within this
folder we will have the CSV formatted
and pipe you know formatted data all
right so now let's go ahead and write
the required area dotnet code first so
we are going to bring in the area dot
namespaces that is system dot data
system dot data dot sequel client and we
also need system dot configuration so
within the button click event handler
the first step is to read the connection
string from web config file so we are
going to make use of configuration
manager class dot connection strings off
and we need to specify the name of the
connection string the name of the
connection string its dbca so let's copy
that and specify that here and then we
use the connection string property now
let's create an instance of string
builder object in a bit we will
understand the purpose of the string
builder object
now the string builder object is present
in a different name space that is system
dot text so let's bring in that
namespace as well system dot text string
builder let's call it s B equals new
string builder now let's go and create a
new sequel connection object sequel
connection let's call it corn equals new
sequel connection and we are going to
pass the
action string as the argument for the
constructor of the signal connection
class alright
now even before we do anything what we
need to first decide is what is the
format that the end user has selected
did he select you know a comma delimited
format a pipe delimited format how are
we going to know that that's based on
the selection the user has made within
the drop-down list so what I'm going to
do here is actually create a variable of
type string let's call it STR delimiter
and F D DL export format dot selected
value if the selected value is equal to
comma delimited okay then the user want
the data to be formatted using comma
okay so if that is the selected value
then we want the separator to be comma
else we know that he might have selected
the other options so then the separator
is going to be a pipe symbol okay so we
got the delimiter that's the choice the
user has made now let's go ahead and
create an instance of sequel data
adapter object so da equals new sequel
data adapter now to the sequel data
adapter we need to specify the sequel
command that we want to execute now we
want to retrieve data from these two
tables so I have already returned the
two sequel queries so select ID name and
location from departments ID name and
Department ID from employees so when we
execute these two queries that's what we
get two tables of data so I'm going to
precipitate these two queries with a
semicolon
okay and then copy them together and
that's going to be our sequel command
text and then we also need to specify
the connection object that this data
adapter is going to use okay so let's go
ahead and create a data set object now
let's call it D as equals new data set
and let's fill the data set with data
and now this data set is going to
contain two tables and by default the
table
you know we'll be named like tables of
zero tables of one you know using
indexes it's not that good because the
readability of the code will not be that
good so let's give meaningful names for
the tables so Dee has got tables of zero
the first table is going to be
departments table so let's set the table
name to something like departments and
let's change the name of the second
table to employees all right so at the
moment the tables have meaningful names
now what we need to do is read the first
row from the department's table and then
convert that to this format so we need
Department ID Department name and
Department location so we are going to
use a for each loop ER for each data row
let's call it D R let's actually give it
a more meaningful name let's call it
department dr n d s dot tables off which
table is that department table dot rows
ok let's create a variable here of type
integer let's call it department ID
equals where are we going to retrieve
the department ID from from the
department data row and what is the name
of the column the name of the column is
ID so that's what we need to specify
here and this is going to return that as
an object but we want to convert that to
an integer so let's convert that using
convert win32 so now we have the
department ID okay so how should the
format of the data be department ID the
delimiter Department name the delimiter
and then the department location and
here we have an instance of our
stringbuilder objects so this is what we
are going to use to store you know the
formatted data and finally whatever data
we have within the
stringbuilder object we will take the
data and then write that to a notepad so
now the stringbuilder object has got an
append method so SP dot append so to
whatever we already have within that
append this department ID can with that
the string and then immediately after
that we need the delimiter okay it could
be a the comma or pipe depending on what
the end user has selected from the
drop-down list so once we have that we
need the department name as well and to
get the department name we are going to
use this department dr so department dr
off name to string and then we need the
department location so let's copy that
and the column name is going to be
location so we are converting that to
string and then after we have the
department name we don't need the
delimiter at the end either the comma or
the pipe symbol need not be present
after you know the department name which
means we can remove this delimiter from
there okay so after we have the
department rule then we want all the
employees belonging to that department
which means we are now going to take
this department ID and then retrieve all
the employees from employees table
within the data set who belong to that
department ID ok so now we are going to
use another for each loop here so for
each let's call this employee data row
so employee ID are n data set dot tables
of employees dot rows now if we do this
we are going to get every employee row
from the database state I mean from the
employees table that's not what we want
we want only the employees belonging to
the current department ID so instead of
using rows here we are going to use the
Select function and that there is an
overloaded version where we can specify
a filter expression so now if you look
at employees table so there's a
department ID column based on which we
can filter the rows so we are going to
use that column
filter so department ID department ID
equals single code and then a double
code and then we need to specify the
department ID convert that to a string
and then close the single code and then
we are closing that you know bracket of
the select method and then another
bracket okay so we have the employee Dr
here now what we need to do is retrieve
the employee ID name and their
respective department ID so now we are
going to copy this actually let's copy
this line there so first we need the
employee ID so employee dr of ID is the
name of the column convert that to a
string and then append the delimiter
okay and then we want the employee name
so SP dot append employee dr off name
dot to string and then the delimiter and
then finally we want the department ID
of the employee and we already have
department ID in this variable so we
don't have to retrieve it from the data
reader object instead we can simply use
that variable so we can simply copy this
and paste that right there so actually
it's department ID
so department ID to string and we don't
need the delimiter there okay now
there's one more important thing that we
need to do now if you look at the data
here there are two invisible characters
that is after every row you know there
is a carriage rhythm that is an Enter
key there and what is the escape
sequence character for Enter key its
backslash R so at the end of every row
there is a carriage written and at the
beginning of every line there is a
newline character so we need to print
those as well so what I'm going to do
here is after we have printed out the
location of the department we need to
append backslash R that is for the enter
key and backslash n for the newline
character right and we need to do the
same thing after every employee row okay
so at this point within the
stringbuilder object we have the entire
data either in CSV format or pipe
delimited format now all that is left is
to write the data that is present in the
stringbuilder object to a notepad so for
that we are going to make use of classes
that are present in system dot IO
namespace so let's go ahead and bring in
that namespace first and then we are
going to make use of streamwriter object
so
Stream writer let's call it file equals
new stream writer and we are going to
use this overloaded constructor way we
can specify the part of the file now we
are going to store the notepads within
this folder sequel and exported data
okay so let's copy that sequel and
exported data back slash let's name the
file data.txt now at the moment here we
are going to have an compliation error
that's because of the escape sequence so
let's use verbatim literal or you can
use double backslash whatever you prefer
but using web and literature makes your
code more readable okay so that's the
file to which we want to write the data
that is present in the stringbuilder
object so now we are going to use this
stream writer object and then it has got
a method called write line and then we
are going to convert whatever data that
is present within the stringbuilder
object to a string give it to the right
line method and that's going to flush
that out to this file and then all that
is left is to close this dream writer
okay so with all these in place let's go
to and run this and now if you look at
exported data folder we don't have
anything in there so let's go ahead and
run this now and see if it works as
expected so we have selected comma
delimited export data let's go to the
folder open the file and notice that the
data is in CSV format now let's actually
select pipe delimited export data and
now let's open this so the data is
present in pipe delimited format now CSV
files will typically have dot csv
extension so if that's your requirement
you know for the data to be present in a
file that is named dot csv then you can
name it so so what I'm going to do here
is if it says CSV format that the end
user has selected then we are going to
call the file data dot CSV if it is a
pipe delimited format then we'll call it
data
so I'm going to create another variable
here let's call it STR file name equals
that depends on what is the delimiter
that the end user has selected and
that's present in this variable STR
delimiter if that is equal to comma then
we want the file name to be data dot CSV
yes we want the file name to be data dot
txt okay and then we will use this
variable okay so we are going to put a
double quote there get rid of this
hard-coded name so that is going to be
our file name let's go to this exported
data folder delete the file from there
so we don't have anything at the moment
so let's read on this page and see if it
works as expected so when we select
comma delimited export now the file
should be named data dot CSV now a CSV
file can be either opened with a notepad
or you can open that with Excel so I can
right click on that open with notepad
notice that the data is present in CSV
format and you can also open it using
Microsoft Excel so here I have Microsoft
Excel so all the F Oh
and then within exported data let's
actually select all files so there we
have data dot CSV so there you go now
what is going to happen if we select
pipe delimited format and then click
export now notice that we have another
file there data dot txt we open that and
the data is formatted using pipe
delimiter that's it for today thank you
for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>