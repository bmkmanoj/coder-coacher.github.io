<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 24   Entity for BridgeTable in many to many relationship | Coder Coacher - Coaching Coders</title><meta content="Part 24   Entity for BridgeTable in many to many relationship - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 24   Entity for BridgeTable in many to many relationship</b></h2><h5 class="post__date">2014-06-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/nP2d3OMrsJA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 24 of entity framework
tutorial in this video we'll discuss a
scenario in which entity framework
generates an entity for the many to many
relationship bridge table in part 22 of
this video series we discussed many to
many relationship using these three
database tables courses students and
student courses student courses here is
the bridge table notice the columns that
this table has got they are foreign keys
to courses and students table apart from
the foreign keys we are not capturing
any additional data within the bridge
table now when we create an entity model
based on these three tables we only had
two entities created course and student
notice that we don't have any entity
created for this bridge table now let's
say our requirements have changed and
the business wants us to capture
enrolled date as well so that the
business can know when a specific
student has joined in a specific course
for that purpose we have included
enrolled date column within this student
courses bridge table now look at this
this bridge table has got additional
columns apart from the foreign key
columns now when we create an entity
model based on these three tables entity
framework is going to generate an entity
for the bridge table also notice that
here we have an entity called student
course which you know basically
represents this student causes database
table and if you look at the property
student ID course Eddie enrolled at the
date they represent the respective
columns within this table let's actually
look at this in action obviously the
first step here is to create these three
tables which I have already done and
here is the sequel script that can do it
I'll have the script available on my
blog in case you need it now let's flip
to visual studio here I have an empty
asp.net web application project to this
project let's add a new item and we want
to add ad or that entity model let's
call this employee model and we want to
generate the model from the database
let's
give this connection string a meaningful
name let's call this employee dbcontext
so this is going to connect to the
database and retrieve all the views
stored procedures and tables and we are
interested in these three tables let's
give this model a namespace name let's
call this employee model and click
finish now entity framework should
generate an entity even for the bridge
table so notice that here there is a
bridge table called student course it
has not named the entities as we
expected to name let's call this course
with an e at the end and let's change
the student course also to have an e at
the end and this navigation property as
well all right so let's save these
changes so if you look at the entities
that we have caught now so notice this
these entities we have caught course
entered a course entity has got
one-to-many relationship to student
course
and similarly student entity has got
one-to-many relationship with student
course now there is no direct
relationship between student and course
so if we have to get course information
you know with the student object we have
to go to student course and from there
we go to the course object we look at
that in just a bit
now a possible interview question here
as you know an interviewer may ask you
explain when an entity you know will and
will not be created by the entity
framework for the bridge table in a
many-to-many relationship and entity for
the bridge table is not created when the
bridge table has only the foreign keys
on the other hand the bridge table has
any other columns apart from the foreign
key columns then a bridge table is
created and we have seen that in action
so initially when the student courses
table had only student ID and course ID
columns which are just the foreign keys
we didn't have any entity created for
the bridge table but now in addition to
the foreign key columns we also have
enrolled at date column so entity
framework created an entity for the
bridge
now let's have to query the data so for
that purpose first let's design a
waveform of the grid we control on it
and we want to display student named
course name and the date in which they
have enrolled in that specific course so
let's flip to visual studio so first of
all to this project let's add a webform
and let's add this tile attribute here
and let's set font family to area let's
drag and drop a grid we control onto
this waveform and within the code-behind
file in the page load so we first need
to create an employee dbcontext instance
so let's go and do that first and now we
want to write a link we read to retrieve
you know student name course name and
enroll the date student name will be
present in student entity course name
will be present in a course entity
enrolled date will be present in student
course entity okay now we can either
start from student and then go to
student course and then to course or we
can start with course and then go to
student course and then to student let's
actually start with student so I'm going
to write a link very here so let's say
from student and let's actually assign
this to a variable so let's call this a
query so from student n employee
dbcontext dot students okay
so this should give us all the students
and then from there so you're going from
student now to student course in so
student dot so student entity has got
one-to-many relationship to student
courses so we are going from student to
student courses okay so from student and
employee dbcontext students so from
student course and student dot student
courses so what we want to do we want to
select a new anonymous type and what do
we want to display within the anonymous
type I mean within the grid we control
student name course name and enrolled
date so I'm going to have here a
property with name student name equals
and how are we going to get the student
name we can use the student entity so
student dot student name and we want
next course names of course name equals
so here we only have student and student
course but keep in mind if you look at
the entity model that we have you know
we have I mean we don't have a direct
relationship between course and student
we have to go from course to student
course and then from there to store and
similarly from student to student course
and then to course so here we have
student and student course but now we
need course name so what we basically
can do is we can go from student course
to course and then get the course name
and finally we need enroll the date so
let's call the property and roll the
date equals and where do I get the
enrolled date from from student course
so enroll bed okay so that's it that's
our query now we are going to bind the
results of this query directly to the
grid view control so I'm going to say
grid v1 dot data source equals we have
the link very so convert that to list
and invoke the data bind
all right so let's good and run this and
see if we get the output that we expect
we also have some test data with the
grid we control notice that we have
student name
course name and enrolled date now if you
notice what we are doing here we are
going from student to student course and
from there to course okay
or you can rewrite this query so you can
start with course so from course in
employee dbcontext dot courses so from
course to student courses and from there
we can I mean to retrieve the student
name we go from student course to
student and then retrieve the student
name and here course name you don't have
to go from student course you can
directly go use the course object that
you have here so course dot course name
and enrolled date will be student course
dot enroll date now when we run this we
should get the same output it's just
that now we are navigating from course
to student course and then to student
all right
let's also see how to manipulate the
data that we have within student courses
table for that purpose let's actually
drag and drop a button control here
let's also set the format of this one to
use colorful scheme and then let's drag
and drop to button controls
and let's quickly change the text on
this one
to assign WC of course to Mike at the
moment Mike is not enrolled in WC of
course so let's change the text on that
to that and then let's change the text
on the second button to remove John from
sequel server course all right and let's
double click the first button to
generate a click event handler now let's
actually run this one so that we can see
what data we have within the database so
notice that at the moment Mike is not
enrolled in WC of course and let's
execute these select queries so if you
look at the data that we have here are
so WC of course ID is for Mike's student
ID is 1 so now we want to enroll Mike
into WC of course and to do that so we
need to first create an instance of
employee DME context class so let's do
that
now to employee dbcontext we can add a
the courses or students or student
courses now here what we want to do is
add a student course and to that I'm
going to you know add an object of type
student course so for that purpose first
we need to create a student course
object so let's go and do the add so
student course let's call this WCF
course for Mike so because we want to
assign Mike to WCF course so new student
course and here what are the properties
of student course we need to specify
student ID course ID and the date in
which they have enrolled to the course
so here student ID is going to be one
and course ID is going to be 4 because
WC of course ID is 4 and then we also
need to specify enroll the date so
enroll the date going to be you know
something like date time dot now and all
you need to do is pass that to this add
object method and then finally invoke
Save Changes as simple as that
ok so let's go ahead and run this ad WC
of course to Mike refresh look at that
Mike is now assigned to WCF and we also
have an enroll the date when we click
this button we want to remove John from
sequel server course let's you have to
do that first of all let's double click
on the button to generate the click
event handler so again you know the same
kind of code let's create an instance of
the employee dbcontext class and then
first we need to find out you know the
student course that we want to remove so
which is the student course that we want
to remove this one okay now we can
uniquely identify a student course using
student ID and course ID so John ID is 2
and sequel server course ID is 3 so
john student ID is two sequel server
course ID is three so what I'm going to
do here is use the employee dbcontext
and we have access to student courses
from there so I'm going to get the first
or default match where a given student
ID is two and the given course ID is
three so this method is going to return
the student course object so let's store
it in a variable of type student course
so let's call it student course to
remove and then we are going to use this
employee dbcontext student courses dot
remove or delete object and then we are
going to pass the student course to
remove to this method and then invoke
Save Changes method that's that so let's
go ahead and run this and let's click
this button it should have removed that
let's refresh the page notice that
sequel server is gone alright that's it
for today thank you for listening have a
great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>