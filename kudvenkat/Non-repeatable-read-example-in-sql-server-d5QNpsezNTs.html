<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Non repeatable read example in sql server | Coder Coacher - Coaching Coders</title><meta content="Non repeatable read example in sql server - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Non repeatable read example in sql server</b></h2><h5 class="post__date">2015-08-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/d5QNpsezNTs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 73 of sequel server
tutorial in this video well discuss the
non repeatable read concurrency problem
with an example so when does a non
repeatable read happen non-repeatable
reads when one transaction reads the
same data twice and another transaction
updates the data in between the first
and second read of transaction 1 let's
understand this with an example here we
have a table that keeps track of how
many iPhones we have install notice
there are two transactions transaction 1
and transaction 2 transaction 1 starts
first and it issues the first read it
reads items in stock as 10 and before
transaction 1 issues the second read
it's actually doing some other verb at
that point transaction 2 starts and it
updates items in stock as five when
transaction 2 completes at that point
transaction 1 issues the second read and
it reads items in stock as 5 so if you
look at these 2 reads read 1 and read
two the transaction 1 has issued notice
read 1 produce 10 and redo produced 5 so
we are not able to repeat the same read
that's why this problem is called as the
non repeatable read problem let's look
at this in action let's flip to sequel
server management studio so here we have
the table TBL inventory at the moment
items in stock equals 10 so let's make
this of a transaction 1 let's begin the
transaction and all we want to do is
select items in stock from TBL inventory
table where ID equals 1 so that's our
first read and then we want this
transaction 1 to do some of the work and
to simulate that I'm going to make this
wait for 10 seconds so we want this
transaction to wait for 0 hours 0
minutes and 10 seconds and then we want
to issue our second read and then
finally we want to commit the
transaction
so that's our transaction 1 I have
another instance of sequence level
management studio running let's make
this our transaction 2 and all we want
to do here is update TBL inventory table
set items in stock equals 5 wear ID
equals 1 all right
let's come in the Select query and
notice at the moment items in stock
equals 10 so let's execute our
transaction 1 and let's execute our
transaction to notice that transaction 2
completed immediately transaction 1 is
still being executed because we made it
deliberately to wait for Wen's 10
seconds and look at the reads read 1
produced 10 and read to produced 5 so we
are not able to repeat the read hence
the name non repeatable read so how can
we solve this non repeatable read
problem so if you look at this table
right here so we have the non-repeatable
reads problem here read uncommitted and
read committed transaction isolation
levels have that problem whereas repeat
will read snapshot and serializable
these isolation levels does not have
that problem so to fix this set the
isolation level of transaction 1 to
repeat will read or any other higher
isolation level so what this repeat will
read going to do is it is going to use
some additional logs to ensure that
whatever data this transaction 1 has
read will not be updated or deleted by
any other transaction in our case
transaction 2 will not be able to delete
or update that data so that is going to
fix our problem the reason why we have
that problem here is because you know
after transaction 1 has issued the first
tree transaction 2 is able to update the
same data to a different value and then
when transaction 1 issues the second
read you know it gets a different value
if we can prevent transaction 2 from
updating the data that transaction 1 has
read then we can solve this non
repeatable read problem and that's what
repeatable read isolation
is going to do so to fix this let's go
ahead and set transaction isolation
level of transaction one to repeatable
read and let's update items in stock 210
and now let's change it to five and if
we select the data from the table look
at that items in stock equals ten now
let's execute our transaction one and
let's exclude our transaction to look at
that transaction two now is blocked
because we have used the repeatable read
isolation level so transaction 2 now is
not able to update that data and when
transaction 1 completes at that point
transaction 2 is able to make any
changes to that data that's why this
transaction 2 was blocked until
transaction 1 is completed and if you
look at the reads here notice both of
them produces 10 and 10 in our next
video we'll discuss the phantom read
concurrency problem thank you for
listening and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>