<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 8   Using stored procedures with entity framework code first approach | Coder Coacher - Coaching Coders</title><meta content="Part 8   Using stored procedures with entity framework code first approach - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 8   Using stored procedures with entity framework code first approach</b></h2><h5 class="post__date">2014-05-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ChrFXuW8ULQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 8 of entity framework
tutorial in this video we'll discuss
using stored procedures to perform
insert update and delete operations
using entity framework code first
approach let's look at the steps
involved first create an empty asp.net
web application project and install
entity framework if it's not already
installed let's add a class file to this
project and let's call this employee dot
CS this employee class is going to
contain 4 properties ID name gender and
salary to speed things up I have already
typed the required code the next step is
to add another class file and let's call
this employee DB context dot CS this
employee DB context Clause is going to
inherit from DB context class which is
present in system dot data entity
namespace so let's go ahead and bring
that in as well and make the employee DB
context class inherit from DB context
class this class is going to contain a
public property which is going to return
a DB set of employee objects and let's
call this property employees and let's
have the get and set access and this
class is also going to override a method
that's present in the DB context class
to find out what are all the methods
that are available for overriding simply
type the override keyword and then plus
the spacebar we are going to override
this on model creating method now this
is where we tell the entity framework to
use stored procedures and the way we do
that is we use this parameter that's
coming into this method model builder
dot entity of employee so with this
employee entity anytime we insert edit
or update or delete an employee we want
to use stored procedures and we tell
that using this method map to store
procedures so basically we are telling
map this employee entity to use stored
procedures ok
right and to this claw I mean project we
are going to add another class file and
let's call this employee repository and
this file is going to contain the
methods to you know select employees
instead update and delete employees ok
so first of all within be at a class
level let's create an object of type
employee dbcontext and then this is
going to have a public method and this
is going to return list of employee
objects and let's call this get
employees and the employee dbcontext
object has got the employees property
which is going to return a DB set of
employee objects let's convert that to
list and return the list of employees
pretty straightforward method now we're
going to have a method to insert an
employee so this is not going to return
anything let's call this insert employee
and obviously we need to provide it with
the employee object that we want to
insert and we are going to use the
employee dbcontext object which has got
employees property the end to that
employees collection add an empty
employee object that is coming into this
method as a parameter and then invoke
employee dbcontext objects Save Changes
method which is actually going to save
the changes to the database similarly we
are going to have update employee method
which again is not going to return
anything let's call this update employee
and here what we are going to do is
first of all you know find the object
that you want to update so employees dot
first or default so we are using some
link methods here so X such that X dot
ID so what we are doing here is within
the employees collection retrieve the
employee object that we want to update
and this is the this object which is
coming into this update method is going
to contain you know whatever changes we
have made you know maybe using the UI so
what we are going to do is we are going
to take the employee ID of that object
match it with the object that is present
in the employees list and obviously this
first or default method is going to
return an employee object which we
actually want to update so let us store
it in a variable of type employee and
let's call this employee to update so
that's the employee object that we want
to update and what you need to do here
is obviously set all the properties so
employee to update dot name equals
employee dot name similarly set gender
and salary properties as well
employee to update dot gender equals
employee dot gender and finally employee
to update dot salary equals employee dot
salary and then simply call employee
dbcontext or Save Changes which is going
to save the changes to the database
similarly we are going to have a delete
method so again to the delete method we
are passing the employee object that we
want to delete and then let's call this
employee to delete so from the list of
employees retrieve the employee object
that matches with the ID of the employee
object that we want to delete and then
what we are going to do is we have the
employee dbcontext dot employees dot
remove the employee that we want to
delete and call employee dbcontext or
Save Changes so pretty straightforward
methods there ok all right within the
web config file we need to add a
connection string to our database and to
speed things up again I have typed this
connection string so let me copy that
and paste it within the connection
strings section of the web config plan
so notice that we have named it employee
dbcontext which is similar to this name
right here ok and we have the connection
string I am using local server databases
sample and I'm going to use integrated
security you can either specify sspi
or you can simply say integrated
security is equal to true and you will
have to provide the provider name system
dot data dot sequel client all right now
let's actually flip two sequences on
management studio at the moment notice
that I already have a sample database
there so I'm actually going to delete
that
and now let's actually before we run
this project we need a web form so let's
go ahead and add a web form and first
let's set the style attribute on the div
tag let's set font family to the area
let's flip this to the design mode and
we need three controls here first a
gridview control and we need a
detailsview control and an object data
source control at this point let's build
a solution so that all these classes are
compiled okay I think we didn't change
the name of the method here so this has
to be delete employee all right so let's
build a solution it should build now
successfully so notice the status bar
pill succeeded now let's flip to our web
form so first we need to configure our
object data source control so click on
configure data source and here our
business object is going to be employee
repository that is the class which
contains the methods to select insert
update and delete employees so let's
click Next on the select tab select get
employees method on the update tab
select update employee method on the
insert tab select insert employee and on
the delete tab select delete employee
and click finish so we are done
configuring the object data source
control now let's configure the grid
view control
first of all let's auto format this to
use colorful scheme and then let's set
our object data source control source 1
as the data source control and we want
to enable editing and we want to enable
deleting as well and another important
thing that we need to do is set the data
key names property of the grid view
control so by default I mean here ID is
going to be the key of the employee
table so we need to tell that to the
degree control and the way we do that is
by using this data key names property so
ID
column is going to be the data key okay
and yeah that's it configuring the grid
we control now let's configure the
details view control lets auto format
this also to use colorful screen and we
want to use object data switch one as
the data source control and here we want
to enable inserting and while we are
here let's also set the default mode of
the details view control to insert and
we don't want this ID to be editable so
let's flip to this to the source mode
and then set ID insert visible attribute
to false so at this point ID is not you
know a user you're not providing a value
for the ID because that's an identity
column it doesn't make sense to provide
a value for it okay
so at this point let's go ahead and
build our solution and let's learn the
project and notice within cycle server
we don't have the sample database so
when we run this it should actually
create the sample database automatically
for us it should also create employees
table within the sample database along
with that it's also going to create
three stored procedures for us to insert
an employee delete an employee and
update an employee at the moment the
waveform doesn't display any data that's
basically because we have a brand new
database and employees table within that
without any data that's the reason why
we don't see that would be control so
now if we flip back to sequel server
management studio refresh the databases
folder and notice that we have got
sample database and if we expand that
look at the tables so there we got
employees table and if we expand that
expand columns got ID name gender salary
and if you expand this program ability
folder and then expand store procedures
notice that we've got three stored
procedures there and look at the naming
convention use employee underscore
delete employee is the name of our
entity right so to delete an employee we
have the stored procedure employee emsco
delete to insert an employee we have
employee and let's go insert and to
update the employee employment score
update so these tool procedures are also
automatically generated let's actually
look at the text of this employee
underscore insert and to look at the
text use the SPN let's go help text and
then execute that so that should bring
the stored procedure text so copy that
paste it right there and if you look at
this you know look at this employee ants
go insert obviously to insert an
employee beneath name gender and salary
and those are being passed in as
parameters and a simple insert query
there and then notice you know an
additional thing that in this insert
stored procedure is doing now when we
insert an employee it's going to
automatically generate the ID column
value which is our identity column now
the auto-generated identity value look
at this we are retrieving using this cop
identity function and then that is
stored in this variable right here and
then finally we are returning that ID
value back okay so the insert stored
procedure you know it should also return
the auto-generated identity column value
okay and similarly it also has
implemented the employee update and
employee deletes or procedures okay
so now let's go back to visual studio
and then at the moment we don't have any
levitt in the table so let's quickly
execute the select query select star
from employees so the table at the
moment is empty let's actually execute
the sequel script to insert some sample
data into it
and let's refresh this platform so now
we should get the data so we have the
data grid view is displaying let's
actually fire up a sequel profiler and
we want to run a trace so click that and
click Edit and let's change mark name to
mark M look at this at the moment ID
field is also editable if you if you
don't want that to be editable simply
set the read-only attribute of that
column to true so let's update this look
at that it has got updated now if we go
back and if we look at right here look
at this employee update is called and
look at that ID value name value gender
and salary value all of them are passed
so it's now using that employee
underscore update stored procedure
similarly let's try to delete an
employee so employee is deleted now
let's go back here
it should have used employee aunts could
delete look at that it has passed the
parameter for ID
I mean parameter value for @id parameter
similarly let's insert maybe another
employee let's call Stacy female and
60,000 is the salary so look at that
that record is inserted and if we look
at CL profiler h left called employee
underscore instead if you don't want
this ID to be editable simply within the
webform in the grid view control we
should have an ID bound field there we
go simply set that read-only attribute
to true run this and then we edit it now
ID column is not editable all right so
it's that easy you know to use stored
procedures with entity framework code
first approach so basically the method
that we have overridden that is on model
creating this is where we tell the
entity framework to use stored
procedures and these are the stored
procedures
the entity framework has automatically
generated for us look at the naming
convention very important okay all right
that's it for today thank you for
listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>