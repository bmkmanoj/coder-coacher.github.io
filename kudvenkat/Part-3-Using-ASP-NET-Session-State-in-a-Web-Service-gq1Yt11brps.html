<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 3   Using ASP NET Session State in a Web Service | Coder Coacher - Coaching Coders</title><meta content="Part 3   Using ASP NET Session State in a Web Service - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 3   Using ASP NET Session State in a Web Service</b></h2><h5 class="post__date">2013-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gq1Yt11brps" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part three of a speed or net Web
Services tutorial in this video we'll
discuss using asp.net session state in a
web service this is continuation to part
two so please watch part two from the
web services tutorial before proceeding
with this video to use asp.net session
object in a web service there are two
things that we need to do first the web
service class should inherit from system
dot web dot services dot web service
class second we need to set an able
session property of the web method
attribute to true so let's flip to
visual studio this is the calculator web
service that we worked with in the
previous session at the moment notice
that this class is already inheriting
from system dot web dot services that
web service class the second thing is to
set enable session property to true
alright now this what we want to achieve
we want to display all the recent
calculations that the user has performed
in a grid view as you can see here look
at this this user has first added 45 and
36 next eighty nine and ninety six and
finally seventy eight and twelve we want
to display the recent calculations using
a session object let's flip to visual
studio so within the add method first
let's create a variable of type list of
string and let's call it calculations
now we're going to make use of session
object within this method so F session
look at that we have access to this
session object that's because this
calculated web service classes
inheriting from web service class what
is going to happen if we remove this
parent class look at that when I say
session you know you don't have direct
access to the session object that's why
we need to make this class inherit from
this class
not web dot services that web service
class okay
so let's use a session variable let's
call it calculations so basically we are
going to use this session key to store
all the calculations that this method is
going to receive
so if session of calculations if that is
equal to now then we know for sure the
user has not performed any calculations
yet in which case we are going to create
a new instance of list of string on the
other hand if session of calculations is
not now that means the user has already
performed some calculations and those
calculations will be stored in the
session so we want to retrieve those
calculations out of the session and
store in this object so let's copy this
session of calculations and then let's
typecast whatever we are going to
retrieve to be of type list of string
and then we are going to store that
within this calculations variable all
right
now how do we want to display a recent
calculation we want the first number
space and then a plus symbol and then
space and then the second number equal
to and then the sum of those two numbers
this is how we want the output to be for
every calculation that the user has
performed and in order to achieve that
let's use a string variable here and
let's call it a string STR recent
calculation and that one equal to we
need the first number so let's convert
that to string and to the first number
we need to concatenate the plus symbol
and then the second number so let's
convert that to string as well and then
to the second number we need to
concatenate
equal to and then finally to that we
need to concatenate the sum of the two
numbers so first number plus second
number add those two numbers together
and the result convert that to string
okay so basically this variable is going
to contain you know the output that we
expect and what we need to do is add
this string to our calculation so
calculations basically here is a string
array
so calculations dot ad all right so next
we need to store this calculations
object within the session variable so
session of calculations equals the
calculations object itself so very
straightforward implementation code here
so basically we are checking is there
anything in the session variable if that
is the case I mean if it's now then
create a new instance of this variable
else if if there is something already
within the session then go ahead and
retrieve those calculations and store it
in this variable and then every time
this method is called obviously you know
we want to build you know the recent
calculation that looks like this so this
expression here is going to do that for
us and then we are storing that
calculation within this calculation so
object and then we are storing it back
into the session variable so that we
don't lose it all right now we need
another method which is going to return
all the recent calculations that the
user has performed so let's include
another public method here and this
method is going to return all the
calculations and the calculations should
be returned as a list of string so the
return type is going to be list of
string and let's call this method cat
calculations and we need to decorate
this method also with web method
attribute and we want to use session
object even within this method so let's
set an able session property to true
right
so now what is this method going to do
it's going to check the session variable
if session of calculations if that is
equal to now then we know that the user
has not performed any calculations in
which case we are going to create a new
list of string let's call it
calculations equals new list of string
and to this calculations let's add a
string stating you have not performed
any calculations
and we are going to return that so
pretty straightforward on the other hand
if session of calculations is not now
then the user has performed some
calculations and we have stored that
within the session variable so we are
going to return those calculations back
so typecast that to be of type list of
string and then return it all right
let's build and then let's view our web
service in the browser so at this point
this web service should list two methods
ad method which is going to add two
numbers so let's add maybe 20 and 30 so
20 and 30 some is 50 that's what we get
back let's do another calculation maybe
15 and 25 let's invoke that so 15 25 is
40 now let's go back and test our gate
calculations method so this method
doesn't accept any parameters so simply
click on that button invoke and look at
this whatever calculations that we have
performed are displayed and they are
returned as an array of strings all
right so our web service is working as
expected all that is left is now to use
this gap calculations method within our
client of web application so let's slip
to visual studio so here we have the
calculator client web application and
within waveform 1 dot aspx let's drag
and drop a gridview control so let's use
it TR and let's specify another TD and
let's set column span to 2 and let's
drag and drop it repeat control and
let's call this GV calculations
all right so within the code-behind file
so let's go ahead and invoke get
calculations method so we have the
client object which is an instance of
the calculator web service proxy class
so client dot get calculations look at
that we don't have that method why is
that that's basically because if you
look at the proxy class that we are
using which is present in this reference
file we discussed this in our previous
session so here is that calculator web
service so client class and at the
moment if you notice this class it only
has God add function it doesn't have get
calculations function and why is that
that's basically because you know we
developed this proxy class long back you
know when the web service was initially
implemented after that the web service
implementation has changed and since the
implementation has changed we haven't
updated this proxy class okay so to
update this proxy class to use those new
methods as well all you need to do is
right click on this calculator service
under services reference folder and
select this option update service
reference and look at this after the
reference is updated it's going to
automatically generate get calculations
method so look at this we have kept
calculations method it's basically going
to return an array of string so now
let's go back to a code-behind file now
when we say get calculations look at
that we can see it so this method is
going to return an array of strings we
want to set that as the data source for
our grid view control and finally invoke
data bind
all right so let's go ahead and view
this waveform in the browser and see if
it displays the recent calculations as
expected alright let's go ahead and add
two numbers so let's add 45 and 55 look
at this
we already performed one calculation it
says you have not performed any
calculations let's try and do another
calculation maybe 12 and 13 look at this
it still says you have not performed any
calculations why is that and if you
recollect we have tested the webservice
method and it was working fine get
calculations was returning the
calculations that we have performed but
when we called that web service from the
client web application it's not working
as expected that's basically because at
the moment this web application is not
sending the same session ID to the web
service that's the reason why it's not
working to make it work all we need to
do is in web config file so here we have
bindings will discuss bindings in detail
in a later video session and within
basic HTTP binding look at this
attribute allow cookies that is set to
false by default and that you may be
wondering where did we get this section
from we didn't write this I know by hand
this is automatically generated for us
when we added a service reference to the
calculator web service okay so allow
cookies by default the set of false set
that to true and now let's run our
webform once again
so let's add 10 and 20 let's click Add
look at that 10 plus 20 equals 30 25 and
35 so now it's working as expected now
look at this by default it gives item as
the heading for the gridview control if
you want to change that within the
code-behind file maybe you can say GV
calculations dot header row dot cells of
0 dot text we want to set that to
something like recent calculations let's
run it once more
so 10 20 add them so recent calculations
10 20 10 and 6 day so basically it's
going to display all the recent
calculations and in order to achieve
this we are using section object right
so if the web service has changed the
proxy class and the client application
needs to be updated to do this
right-click on the calculator service
and service references folder and select
update service reference option set
allow cookies attribute to true for the
client application to accept the cookie
returned from the ASM X web service so
that de client can copy it it into all
the future requests that are made into
the web service and we need to set this
attribute when the web config file of
the client application this will ensure
that the same session is maintained
between the client and the web service
alright that's it for today thank you
for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>