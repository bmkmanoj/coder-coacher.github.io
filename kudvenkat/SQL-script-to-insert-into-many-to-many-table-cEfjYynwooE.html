<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>SQL script to insert into many to many table | Coder Coacher - Coaching Coders</title><meta content="SQL script to insert into many to many table - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>SQL script to insert into many to many table</b></h2><h5 class="post__date">2017-02-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cEfjYynwooE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part five teen sequences are
interview questions and answers video
series in this video we'll discuss how
to insert data into a table that has
many to many relationship right here
we've got two tables we've got students
tables on the left and courses on the
right they've got many to many
relationship between these two tables a
given student can be enrolled into many
courses and similarly a given course can
have many students enrolled into so
there is a many-to-many relationship and
to capture that many-to-many
relationship they've got this bridge
table student courses look at the data
that we already have to get this course
ID column into course ID one they've got
multiple students enrolled into student
ID one and two so Tom and Sam both of
them are enrolled into sequel server so
a single course has many students
enrolled into similarly a single student
can be enrolled into many courses so if
you look at student ID one he is
enrolled into multiple courses he's
enrolled into OCAD one and two so
student ID one Tom is enrolled into
multiple courses secret server and
c-sharp so to capture that many-to-many
relationship we have this bridge table
student courses now let's go understand
the constraints that we already have on
these three tables within the students
table the ID column is the identity
column meaning when we insert a new row
we don't have to supply a value for this
column similarly ID column that in
courses table is also an identity column
and student ID and course ID columns
with the strength courses table are
foreign keys student ID references ID
column from the students table and
course ID references the ID column from
the courses table so now what we want to
do is we want to come up with a sequel
script that's going to insert data into
these three tables and there are a few
rules that script should follow let's
look at those rules now first role
they're going to be only two inputs for
the script the name of the student whom
we want to enroll into a course and the
name of the course into which we want to
enroll a student so two inputs
name of the student and name of the
course so
number two if the name of the student
that we have supplied if that student is
already existing within the students
table then we want to use that existing
student ID as the value for student ID
column when we insert a new row into the
student courses table if that student is
not already existing then we will insert
a new row into students table and then
use that new student ID as the value for
student ID column the same rule is also
applicable for the course name that we
have supplied if the course name that we
have supplied is already existing within
the courses table then use the existing
course ID if that course is not already
existing then insert a new row and then
use that new course ID as a value for
this course ID column when we insert a
new row into the student courses table
and the final rule is the student
courses table should not allow duplicate
student course enrollment now if you
look at student ID one
he is already enrolled in course ID 1
meaning Tom is already enrolled into
sequel server now we should not enroll
Tom again into sequel server if such a
duplicate student course enrollment is
detected our script should throw an
error so let's see how to come up with
such a script now let's slip two secrets
of a management studio the first thing
to do here is to create the three tables
which I have already done and here is a
sequel script that can do it I'll have
the script available on my blog in case
you need it now let's write the script
itself first I'm going to declare a
variable called student name so within
the student name variable we've got Sam
let's create another variable for course
name and within this variable I'm going
to have C sharp remember the script that
we are going to write should have only
two inputs the name of the student that
we want to enroll and the name of the
course into which we want to enroll that
student so to hold the student name and
course name we have got these two
variables and I'm going to create
another variable and this is going to be
for student I
and student ID is of type integer let's
do the same thing for course ID again
course ID is of type integer now the
name we have supplied we have to first
check if that student is already there
within the students table so what I'm
going to do is select at student ID
equals ID from students table where
student name equals whatever name we
have supplied so if we already have Sam
within the students table then into
student ID we will get that existing
student ID so what we are going to do
next is we are going to check F at
student ID it is null if the student ID
is null then what does that mean it
means we don't have Sam's record already
within the students table that means we
will have to insert a new row into the
students table for Sam so insert into
students values and all we have to
supply is the name of the student which
we already have in this variable so when
we insert a new row into students table
you know the ID column value will be
automatically generated and we want to
retrieve the ID column value so to get
the identity column value we use scope
identity function so select at student
ID equals scope identity this function
is going to return us the identity
column value you know for the row that
we have just inserted and we have to do
the same thing for pools as well so
let's make a copy of this so if I mean
we have to select the course ID from
courses table where who
name equals whatever course name we are
supplying and if the course ID is now
then we don't have that course in the
poses table in which case we want to
insert into courses table we have to
supply the course name and we have to
retrieve the course ID column value and
to do that we are again going to use
this cope identity function so by this
time we have the course ID all that is
left is to insert a row into student
courses table so insert into student
courses and to insert a row into student
vs. table we will have to supply values
for student ID and course ID which we
already have in student ID variable and
course ID variable all right now let's
open another query editor window so
let's see what we already have in our
students table in the courses table and
in student courses table at the moment
all these tables should be empty so we
don't have any data here now we want to
enroll Sam into c-sharp course notice
the script has just two inputs the name
of the student and the name of the
course so let's execute this and now
when we go back and execute the select
queries notice we have Sam the course
name is c-sharp and student ID is
someone's course ID one Sam enrolled
into C shop now let's say we want to
enroll Sam into another course we want
to enroll him into secret server so
let's execute the script again and now
let's look at the data notice within
students table we only have one record
for Sam and within courses we have two
records see char
secret server and look at Sam student ID
he is enrolled in two courses
cool-headed one and two in both three
sharp and sigma server now let's try to
enroll Tom into sequel server let's
execute this and when we execute the
select statements notice within the
students table they have Sam and Tom and
in Corsa C sharp and sequel server in
student courses we have Tom enrolled in
Cygnus of a course now remember the last
rule is that you know the student
courses table should not allow duplicate
student course enrollments now if you
look at Sam he is already enrolled in
c-sharp course now let's try to enroll
Sam again in c-sharp and see if that is
allowed so when we execute this look at
this the script successfully execute and
now when we select the data notice you
know Sam is enrolled into c-sharp
coal's twice and we don't do a lot of
that so let's see how to prevent such
duplicate student course enrollments to
prevent duplicate student course
enrollments all we have to do is create
a composite primary key on the student
courses table and we're going to create
the composite primary key on these two
columns student ID and course ID let's
do that now let's fire up another query
editor vendor so what do we want to do
we want to alter the table which table
do we want to alter we won't alter
student cold table and what do we want
to do we want to add a constraint let's
give this constraint in named PK
standing for primary key and we are
going to create a primary key constraint
on student courses table and what type
of constraints are we adding here we are
adding a primary key constraint and what
is primary key going to do is going to
create a clustered index and we want to
create a composite primary key and what
are the columns on which we want to
create the composite primary key
student ID column and kuehl's ID column
so let's execute this and when we
execute this notice we are getting an
error that's basically because if you
look at the data that we have look at
that we already have a duplication so
first we have to remove that duplication
before we can create a composite primary
key on student ID and course ID column
so let's go ahead and delete the data so
delete from student courses where
student ID 8 plus 1 and course ID equals
1 so this is going to delete you know
the two duplicate rows let's select the
data one more time
now we don't have duplicate data here so
let's go ahead and execute this all the
table statement command completed
successfully now let's go back and let's
try to enroll Sam into C shop first time
it should be allowed so query executed
successfully let's select the data so
Sam is enrolled into c-sharp course now
let's try to enroll Sam again in c-sharp
and see what happens notice now we get
violation of primary key constraint
error so duplicate student course
enrollments are prevented now here is
that sequence crypt and here we have the
script to add primary key on the student
courses table if required we can very
easily convert this clip into a stored
procedure let's see how to do that now
to convert this script into a stored
procedure all we have to do is wrap the
script inside create procedure statement
let's do that now create procedure let's
provide this procedure a name let's call
it SP insert into student courses and
this procedure is going to have two
parameters student name which is going
to be of type and we're care let's
remove the default value and we also
want to have course name parameter again
let's remove the default value as they
can and all these statements are going
to be between begin and end
so let's execute this command completed
successfully so if we go to
programmability stored procedures so
there we have our stored procedure SP
insert into student courses and now to
execute the stored procedure all we have
to do is use the execute statement
executes SP insert into student courses
and we have to supply the name of the
student and the name of the course now
if we look at the data that we have here
notice tom is not enrolled in c-sharp
course
so let's enroll Tom into c-sharp so the
name of the student is Tom and the name
of the course is c-sharp
so when we execute this completed now
let's select the data notice Tom is
enrolled in c-sharp here is the stored
procedure and execute that we use the
execute statement thank you for
listening and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>