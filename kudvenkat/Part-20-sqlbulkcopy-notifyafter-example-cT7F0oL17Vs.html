<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 20   sqlbulkcopy notifyafter example | Coder Coacher - Coaching Coders</title><meta content="Part 20   sqlbulkcopy notifyafter example - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 20   sqlbulkcopy notifyafter example</b></h2><h5 class="post__date">2014-09-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cT7F0oL17Vs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part friendly of a deodorant
tutorial in this video we'll discuss
bath size property notify after property
sequel rules copied event of sequel bulk
copy class bath size property specifies
the number of rows in a batch that will
be copied to the destination table bath
size property is very important because
the performance of data transfer depends
on it
the default bath size is 1 in the
example right here notice that bad size
is set to 10000 this means once the data
reader has read 10,000 rows that's when
they will be sent to the database as a
single batch to perform the bulk copy
operation notify after property defines
the number of rows to be processed
before raising sequel rows copied event
we'll discuss the use of the sequel rows
copied event ingest appeared in the
example right here notice that we have
set notify after - 5000 this means once
every 5,000 rows are copied to the
destination table that's when this event
is raised so what's the use of the
sequel rows copied event this event is
useful for reporting the progress of the
data transfer let's look at an example
let's flip to sequence level management
studio we will be using these two tables
in this demo products underscore source
and products underscore destination if
you look at the sequel script here
notice that products underscore stores
table contains three columns ID name and
description notice the data that this
table has at the moment it has got 300
thousand records look at the name and
description columns the data for this
table is dynamically computed using this
sequel script right here so basically we
are creating an integer variable
initializing that to one and they're
using a while loop here so this is going
to run until you know ID value is less
than or equal to 300 thousand and then
we are dynamically calculating the
values for ID name and description
columns
I'll have this sequel script on my blog
in case you need it and I have also
created this product underscore
destination table with the same columns
and at the moment this table doesn't
have any data so what we want to do is
move all these 300,000 rolls from
products underscore source to products
underscore destination and along the way
we want to understand the use of all
these three properties so let's flip to
visual studio now here I have a new
console application and all I have done
sofa is added this app dot config file
and included a connection string to our
sample database and I have also added a
reference to system configuration
assembly and then with Nova program dot
CS file I have included a reference to
all these three namespaces so now the
first thing that we need to do is free
the connection string from app dot
config file configuration manager dot
connection strings of the name of
connection string is CS connection
string and we want to create a sequel
connection object let's call this source
connection and we are going to make use
of the connection string that we have
just read from the app config file now
let's create sequel command object and
we want this sequel command object to
retrieve all the rules from products
underscore source table so that is going
to be our query and we want to use this
source connection object let's open the
source connection and then let's use
another using block sequel data Reader
Rd R equals command dot execute reader
so we are executing your command now
let's create another connection to a
database so that we can actually write
data to our products underscore
destination table so sequel connection
let's call this destination connection
equals new sequel connection and let's
pass the connection string that we read
from AB dot config file
now let's go ahead and create an
instance of our sequel bulk copy class
let's call it BC and let's pass our
destination connection object alright so
we have the bulk copy object now the
within the source table that is products
underscore source we have caught three
hundred thousand records now if we don't
set bad-sized then by default what's
going to happen this reader is going to
read one record you know passed it on to
sequel bulk copy and it's going to write
it to the destination table so one
record will be returned to the table at
a time now instead of that we can
improve the performance by you know
including a batch size so let's say for
example we want to set that size to
something like ten thousand so BC dot
bat size equals ten thousand and BC dot
notify after so what is the use of this
property
you know let's say for example if we set
this to five thousand then after every
five thousand rows are copied to the
destination table then this object is
going to raise an event and what event
is it going to raise sequel rows copied
event so BC dot sequel rows copied look
at the symbol it's a lightning bolt
meaning that's an event and let's
associate an event handler with this
method so this is the method that is
going to be called when this event is
raised okay and if you look at this even
handler method right here notice that
there is a parameter called
sequel rows copied event arguments e so
this object has got this rows copied
property and if you look at you know the
type of this property it is a long you
know which means it's going to give us a
number that is the number of rows that
are copied right so what we want to do
here is print a message on to the
console screen console dot write line
you know whatever rules that are
returned by this property give a space
and then say loaded so every time 5,000
rolls are copied and it's going to print
that message to the console screen so
we'll know the progress of how many
rules are actually copied to the
destination table and then we also need
to specify the destination table name so
what is the destination table name it is
products underscore destination so let's
copy the table name and specify that
here and then we need to open the
destination connection so let's go ahead
and do that
and finally we need to write the data to
the server so BC dot write to server and
we need to pass our data source
I mean reader instance so let's go ahead
and pass this reader object to write a
civil method alright so with all these
changes let's go ahead and run our
console application look at that as the
rules are loaded you know we get the
progress back
so all 300,000 rules are loaded now just
to quickly verify that let's run this
select query notice that it's retrieving
the rows still so you can see ID name
and description columns and look at that
all 300,000 rows are loaded now if you
look at what we are doing here you know
when this event is raised you know we
want this even handler method to be
called so for that we have created a
separate method and then we are passing
the name of this method as an argument
to this delegate so this is actually a
delegate right so you know there are
several steps here now to reduce the
amount of code that we have written here
we can also make use of anonymous
function so if you look at this delegate
right yarm you know we have these two
parameters one is of type object and the
other is of type sequel ros copied even
documents so instead of creating a
separate function like this and then
passing the name of that function
as an argument to this delegate what we
can do is we can make use of an
anonymous function so we know that we
are going to get two parameters you know
these are the two parameters so we can
simply specify their name so we you can
give any name that we want so just to
give them meaningful names I'm going to
call them eventargs and sender okay so
this goes to and then we define what we
want to do so all we want to do here is
print this message onto the console
screen so we can paste that there and we
can get rid of this method now
altogether so this is an anonymous
function here so whenever this event is
raised all we are saying is call this
method and now here we have a
compilation error that's because we
don't have an object called e instead we
have something called event arguments
and that's what is going to have this
rows copy D property so let's specify
that there and now if we run this we
will get an error because we already
have data in the destination table
so let's actually truncate the this
table okay so
now when we execute the select very we
should not have any rows in that and
let's run this program one more time to
make sure it still works is expected
alright thank you for listening and have
a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>