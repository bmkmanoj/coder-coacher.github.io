<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Web api bearer token example | Coder Coacher - Coaching Coders</title><meta content="Web api bearer token example - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Web api bearer token example</b></h2><h5 class="post__date">2016-12-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8mHFxrGC88U" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 25 of asp.net Web API
tutorial in this video we'll discuss how
to use bearer token for authentication
and retrieving data from the server so
here is what we want to do we want to
implement this data dot HTML page which
is going to call the employees
controller retrieve it and displayed on
the web page as you can see here we want
to be able to get to this data dot HTML
page only if we are logged in if we are
not logged in the application should
automatically redirect us to the login
page in our previous video we have
already added the stated odd HTML page
at the moment it's completely empty so
let's copy whatever code that we have on
our registration page paste it on our
data dot HTML page and then change the
bits that are required so if you look at
our data dot HTML page the first thing
that we want is the slowed employees
pattern and this button is present
inside a bootstrap file and if you look
at the HTML that we have here notice we
already have a bootstrap Val here within
the well we have caught a table we don't
need this table anymore so I'm going to
delete that and instead of the table we
want a button so let's include an input
element of type button let's give it an
ID let's call this BTN load employees
and let's use the bootstrap button
classes BTN and bTW and success and the
value on the button is going to say load
employees let's close the button and
let's close this bootstrap Val device
Wow and we need another bootstrap file
inside which we have got this table that
displays the employee data so let's
create another div elements with class
Val and inside this we are going to have
the table that displays the employee
data but when the page initially loads
so when we first get to this data dot
HTML page we want to keep this second
well that contains the employees table
hidden so along with the vel class on
this div I am also going to use the
bootstrap hidden class which is going to
keep all
all the content inside that hidden and
let's give this div an ID since we are
using this development to display data
I'm going to call this their data and
inside this development we want a table
so let's create a table element and
let's use the bootstrap table classes
table and table bordered and let's give
this table an ID let's call this TBL
data and inside the table let's use a
section for table head TR and inside
this let's use th so we want ID column
first name last name gender and salary
let's change the text so first name and
this one is going to be last name gender
and salary all right now let's include
another section for table body let's
give the section on ID let's call it TBL
body and obviously in TBL body we are
going to display the data rows that we
retrieve from the server and then we
need this model as well so basically
when we are on this data dot HTML page
and if I click this load employees
button after the access token has
expired then we are going to use this
model to display session expiry warning
message and then once the user closes
that model we want to automatically
redirect the user to the login page so
he can login once again so since we are
going to use this for displaying an
error message a session expiry error
message let's call this error model and
the model title is going to be session
expired
and the message is going to be please
close this message to login again
alright so we have the model there and
we also need this alert this to display
any error messages okay so that's the
HTML required and we are going to change
this jQuery code as well for now let's
keep it commented save our changes and
navigate to data dot HTML page notice at
the moment we see only this well which
displays lewd employees button the other
well which has got the employees table
is hidden now let's write the required
jQuery code so let's flip to data tada
HTML page and uncomment the code that we
have here
we need this piece of code to hide the
alert div when we click on the little
cross and we want to wire up click event
handler with our load employees button
and the ID of our load employees button
is BTN load employees so let's use that
ID and wire up the click event handler
so when we click the button we want to
issue a request to our employees
controller which is at the URL slash
API slash employees and we want to issue
a get request instead of a post request
and we are not going to send any data to
the server except the access token and
if you remember in our previous video we
have implemented our login page once we
are successfully logged then we are
storing the access token in session
storage using this key access token so
let's use the same key retrieve the
access token and then send that access
token to this server we are going to
make use of authorization header to send
the access token to the server so
instead of data we are going to use a
section for headers and the header that
we are going to send is the
authorization header so authorization
and the value for this is going to be
our access token and remember we have
two prepend the word bearer - the access
token so to that lets append
our access token itself we are going to
use get item method to retrieve the
access token from session storage and
the key is access token
so they retrieve that we append it to to
this word bearer and then we are sending
it to the server when the request
successfully completes we are going to
get the data back so let's pass the data
to the success function now if you look
at our employees table this employee's
table is present inside this development
which has got the hidden class notice on
the data page when the page first loads
we are keeping that well which contains
the employee table hidden so we have to
unhide it and to do that we will have to
remove this class and this development
has got an ID so let's use that ID find
the development and then remove that
class hidden so when the request
completes successfully the first thing
that we want to do is find that
development with ID div data and then
remove the class hidden which is going
to make that visible and then what we
want to do we want to loop through each
row of data that we get back from the
server so let's use the jQuery each
function and then to this let's pass the
data that we are getting back from the
server and then we want to execute some
code for every row that we are iterating
over which is going to be part of this
anonymous function this function is
going to have two parameters the index
of the road that we are currently
iterating over and the row itself okay
so what do we want to do with every row
well we want to create a variable let's
call it row and we're going to create a
TR and inside the TR we are going to
create a TD and in the first TD what do
we want to display we want to display
the ID column value and where are we
going to get the ID column value from
using this parameter so value that's the
route that we are currently iterating
over and row will have ID column so
retrieve the data from the
column and then put it inside a DD in
the TR and then we want to close that TD
so let's close the TD and then create
another TD so we need to do the same
thing for lastname firstname gender and
salary and in the interest of time I
have already typed the code so let's
copy that and paste it right here so
what do we have here we have the first
name we have the last name we have
gender and salary so this is what
happens when the request completes
successfully and if there is any error
we are going to display those errors in
the alert div so let's save our changes
reload our webpage and let's click load
employees button since we are not logged
in I was expecting we get authorization
denied error but in this case nothing is
happening let's learn to browse the
developer tools and see what's going on
notice we are actually getting four zero
one unauthorized message but it's not
being displayed using the bootstrap
alert div let's understand why now if
you look at this error model div and the
alert Dave they're actually present
inside this bootstrap file probably
that's the reason why it's not working
so let's take these two divs and place
them outside this well let's save our
changes reload our web page and then
let's click load employees button now
notice we get authorization has been
denied for this request message as
expected now if the user is not logged
in we don't want to allow him to get to
data dot HTML page we want to
automatically redirect him to the login
page so when the document is ready so
the first thing that we are going to do
is check session storage for access
token so if access token is null that
means the user is not logged then so if
the user is not logged and what do we
want to do we want to redirect him to
the login page
so window dot location
dot href equals log in dot html' let's
save our changes reload our webpage and
look at this since we are not logged in
it has automatically redirected us to
the login page now let's log in with a
user that we have already registered and
we click the login button notice we are
on the data page when we click load
employees for some reason we only see
the header row but not the data rows
let's investigate why when the request
successfully completes we are looping
through each row creating a row but not
appending it to the table so let's find
the table element using its ID the ID of
the table element is TBL data so let's
use the jQuery ID selector find the
table element and then to the table
let's up in the row that we are creating
let's say what changes reload our web
page now when we click load employees
notice we see the data rows as expected
but we have got a problem here when we
click load employees again look at
what's happening it's appending another
set of rows so we have to empty the
table before we append a new set of rows
and if you look at the table element for
the table body we have given an ID and
the ID is TBL body so let's find the
table body element using its ID and then
empty the rows on that so let's use the
jQuery ID selector again find the table
body element and empty the rows let's
see what changes reload our web page one
more time now when we click load
employees you know no matter how many
times you click you only will see one
set of rows as expected we want to
implement another piece of functionality
here when we click on this load
employees button after the access token
has expired we want to display a message
to the user using bootstrap model popup
session has expired please log in again
to continue once the user closes that
model message we want
to be automatically redirected to the
login page
so he can log in and continue again if
you remember in our previous video we
have made a change in this file start up
dot auth dot CSS and the change is to
make the access to can expire one hour
after it is issued so if we click load
employee's button after the access token
has expired we want to display that
session expired message and then once
the user closes that message we want the
user to be redirected to the login page
automatically and the way we are going
to implement that is by using this error
even handler method so the first thing
here we are going to do is check the
error status code if jQuery
xmlhttprequest object dot status equals
four zero one so if the error code is 4
0 1 then we know it is unauthorized
error so at that point we want to
display the session expired message
using the bootstrap model pop-up we
already have a div for that and the ID
is error model so let's use that so if
the status code is four zero one
let's find
the model dev and then use the model
method and show it
if it's any other error apart from 4:01
then we simply want to display that
using the alert DEP
and we want to make another change let's
make the access token valid only for 10
seconds so we can test our functionality
so let's see all our changes give our
solution a build and navigate to login
dot HTML let's log in again we are on
the data page when we click load
employees we see the list of employees
as expected now we know that the access
token is going to expire in 10 seconds
if we click on this load employees
button after 10 seconds notice we get
this session expired message as expected
at this point when we close this modal
dialog nothing is going to happen what
we want to do is we want to
automatically redirect the user to the
login page when the model is closed so
let's handle the hidden event so the ID
of the modal dialog is error model so
let's find the modal dialog using the
jQuery ID selector and handle the hidden
event so the event is hidden dot psi dot
model the code is going to be part of
this anonymous function what do we want
to do when the model is hidden we want
the user to be redirected to login page
so let's copy and paste it right here
let's save our changes reload our
webpage and at this point when we click
load employees notice we get the session
expired message again and when we close
this modal dialogue look at that we are
automatically redirected to the login
page as expected at the moment the only
way to log the user out of the
application is by closing the browser
window since we are storing the access
token in the browser session storage
when the browser window is closed we'll
lose the session data and the user is
logged out in our next video we'll
discuss how to explicitly log the user
out of the application without having
the knee
to close the browser window thank you
for listening and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>