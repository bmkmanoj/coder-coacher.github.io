<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 21   Table Per Type TPT inheritance code first | Coder Coacher - Coaching Coders</title><meta content="Part 21   Table Per Type TPT inheritance code first - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 21   Table Per Type TPT inheritance code first</b></h2><h5 class="post__date">2014-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-tMX36hRSsU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 21 of Handy framework
tutorial in this video we'll discuss
implementing table pair type inheritance
with code first approach this is
continuation to part 20 in part 20 we
discussed implementing table pair type
inheritance with database first approach
in this video we will be modifying the
example that we worked with in part 20
so please watch part 20 before
proceeding by default entity framework
creates one table for all the entity
types in the inheritance hierarchy here
we have got three classes employee
permanent employee and contract employee
permanent employee and contract employee
classes are inheriting from the employee
class now by default the entity
framework is going to generate one
employee's table as you can see here for
all these three entity types in this
inheritance hierarchy let's look at this
in action let's flip regions to do so
this example that we worked with in the
previous video session we have generated
this employee model from our sample
database using database first approach
so let's go ahead and delete this
employee model and let's also delete the
connection string that's auto-generated
for us from the web.config file but from
one dot aspx and it's code-behind file
are not going to change in any way so to
this project let's add a class file and
let's call it employee dot cs and this
class is going to contain the properties
that we have seen on the slide that is
ID first name last name gender to speed
things up I already have on type the
required code so let's copy and paste
these properties within the employee
class and similarly let's add another
class file and let's call this permanent
employee dot cs and this class is going
to contain annual salary property which
is specific to permanent employee all
the other properties this permanent
employee class need are going to be
inherited from the employee base class
similarly let's add another class file
and let's call this contract employee
dot CS
and this class is also going to inherit
from employee class and here we are
going to have the properties that are
specific to contract employee which are
hours worked and hourly pay so let's go
ahead and include those properties here
and we need another class file and let's
call this employee dbcontext and here we
need system dot data entity namespace so
let's bring that in and we want to make
this employee dbcontext
class inherit from dbcontext class and
this class is going to contain a public
property which is going to return BB set
of employee objects and let's call this
property employees alright and that we
need to have a connection string within
the web token fig file and here is the
connection string so the name of the
connection string is going to be
employee Demi contact that's the
connection string and the provider name
is e standard data dot sequel client
because we are using sequel server
alright so with these changes if we now
run this platform 1 dot aspx so at the
moment we already have the sample
database so let's actually go ahead and
delete this sample database so now when
we run this project it should
automatically create the sample database
and by default you know if you look at
the types we have there are three types
in the inheritance hierarchy but by
default entity framework is going to
create one table to store the data of
all these three entity types
so let's actually run that and prove it
so that form one is being loaded so at
this point sample database you know when
we select this all employees radio
button this sample database should be
automatically created and then the
employees table also should be created
so it's still trying to load and it's
completed now let's actually refresh
this databases folder and if you look at
this sample database notice that we have
got the employees table there is only
one employee's table and if you look at
all the columns look at that you know
the properties of the employee class of
present first which is employee ID first
name last and gender and then we have
the columns you know of contract
employee class so contact employee class
has got hours work and hourly pay
properties so we have those columns here
and then we have annual salary property
within in a permanent employee class
which is again a column here so all of
the columns are not present in this one
employees table so that's the default
behavior with an entity framework but
other requirement is we want in a one
table to be generated per entity type in
the inheritance hierarchy meaning we
need one employee's table for employee
type similarly permanent employees table
for permanent employee and contract
employees table for contract employee
and to achieve that it's straightforward
all you need to do is decorate the
respective types with a table attribute
and that will do the trick so let's
actually go to the sample database and
let's delete the sample database and
then let's go ahead and decorate the
employee class with table attribute so
table and this table attribute is
present in a different native namespaces
under component model door data
annotations dot schema so let's bring in
that namespace and then you know specify
the parameter which is nothing but the
name of the table so we want to map this
employee entity to the employees table
so it's as simple as that
similarly we go to contract employee at
entity and then here we specify we want
to map this to contract employees table
and again we need to resolve the
namespace similarly let's do it for
permanent employee as well so table
attribute and then we want the table to
be a permanent employees and let's
resolve this namespace
all right so with these changes let's
run this webform one dot aspx so it's
still refreshing so it's creating the
sample database and they required tables
for us so now let's flip to sequencer
management studio reflash we have the
sample database and if you look at the
tables we get you know we've got three
tables employee entity information will
now be stored in this employees table
contract employees data will be stored
in this contract employees table and
similarly permanent employees data will
be stored in permanent employees table
so now let's actually execute this
insert script to insert some test data
into the respective tables so now let's
actually select the data so there we go
we have the data now let's reload this
waveform and when we select all
employees it should load all the
employees now to get the first name last
name gender annual salary hourly pay
hours for you know all these column
values you know obviously entity
framework has to write a sequel query
that's going to join all the three
tables whereas when we load permanent
employees behind the scenes sequel where
you know entity framework is going to
write a sequel query to join employees
and permanent employees table and when
we select this it should join employees
and contract employees table if you fire
up sequel profiler you should actually
notice the queries that are being
generated by the entity framework now
let's make another change here to this
perform let's add a button let's
actually add two button controls
and here let's change the text on this
button to something like add permanent
employee and similarly let's change the
text on this button control to add
contract employee let's double click
this button and then here we are going
to write some code to add a permanent
employee to the database
so let's actually copy and paste this
code right here so notice that here we
are populating these first-name lastname
gender and annual salary properties we
are creating an instance of the
permanent employee entity and then we
are adding that entity to the employee's
collection and then calling Save Changes
similarly let's go ahead and generate
the even handler for add contract
employee and here let's write some code
to add a contract employee to the
database table
so again straightforward we are creating
an instance of contract employee class
and then we are adding that instance to
the employee's collection of employee
dbcontext and then invoking Save Changes
now if you look the database at the
moment we have got look at that there
are seven rows with an employee's table
okay and then four rows within permanent
employees table and three rows within
contract employees table now let's run
this and then let's add the permanent
employee so now when we add a permanent
employee look at that it's loading
meaning it's adding permanent employee
to the database table behind the scenes
so once that is done when we execute
these queries look at that within
employees table the employee ID first
name last name and gender property
values are stored and within the
permanent employees table you know the
data that is specific to permanent
employee is stored so here annual salary
is stored okay now at the moment
contract employees table has got only
three rows
let's add a contract employee so that
should have been added now when we come
and execute this query notice that here
within the employees table now there are
nine drawers and then if you look at
contract employees table we should have
four rows okay so the data that is
specific to contract employee is stored
in this table whereas ID first name last
name gender our student employees table
so entity framework behind the scenes is
going to write the required queries to
store the data into the respective
underlying tables and we have just seen
that in action and another way to
actually map you know the entities to
different tables is by using fluent API
and we have been using this in the past
videos in this video series so simply by
overriding in our own model creating
method now what we can do is instead of
using the stable attribute with an
employee dbcontext class we can actually
override on model creating method and
then here we can say model builder dot
so entity of employee entity so we want
this entity to be mapped to table
employees
okay similarly we want to map permanent
employee to permanent employees table
and contract employee to contract
employees table now if we are using the
fluent API then again there is no need
to use this here so we can comment that
out and then let's quickly delete the
sample database
and when we run at this platform one it
should still create three databases now
we are using fluent API to map the
classes to respective tables so it's
still loading there now let's go ahead
refresh this
notice that we have those three tables
are created so at this time we are using
fluent API instead of that table
attribute just by overriding on model
creating method all right that's it for
today thank you for listening
have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>