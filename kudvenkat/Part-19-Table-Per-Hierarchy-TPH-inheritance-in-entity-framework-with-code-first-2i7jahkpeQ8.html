<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 19   Table Per Hierarchy TPH inheritance in entity framework with code first | Coder Coacher - Coaching Coders</title><meta content="Part 19   Table Per Hierarchy TPH inheritance in entity framework with code first - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 19   Table Per Hierarchy TPH inheritance in entity framework with code first</b></h2><h5 class="post__date">2014-06-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2i7jahkpeQ8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this part 19 of entity framework
tutorial in this video we'll discuss
implementing table / hierarchy
inheritance with code first approach
this is continuation to part 18 in part
18 we discussed implementing table /
hierarchy inheritance with database
first approach in this video we will be
modifying the example that we worked
with in part 18 so please watch part 18
before proceeding this what we want to
achieve in this video we are going to
have these three classes employee
permanent employee and contract employee
permanent employee and contract employee
classes will be inherited from the
employee class so this employee base
class is going to contain all the
properties that are common to permanent
employee and a contract employee while
these two classes will contain the
properties specific to them now based on
these three classes we want the entity
framework to be able to generate this
single employee stable because in table
/ hierarchy inheritance one database
table is used to store the data for all
of the entities in the inheritance
hierarchy so let's see how to achieve
this let's flip to visual studio this is
the example that we worked with in the
previous session this employee model is
generated using database first approach
so let's go and delete this employee
model from this project and let's also
delete the connection string that is
auto-generated by the entity framework
alright to this project let's add a
class file and let's name it employee
dot cs and this class is going to
contain ID first name last name gender
properties to speed things up I have
already typed the required code so let's
paste it here and let's add another
class file to this project and let's
call this permanent employee and this
class is going to contain the properties
that are specific to permanent employee
in our case perm annual salary is
specific to permanent employee so let's
copy and paste it there and we want to
make this class inherit from employee
class similarly let's add another class
file and let's call this
contract employee dot CS and we want
this class to the inheriting plum
employee base class and contract
employee specific properties are hours
worked and hourly pay right so we have
the three classes and they are related
by inheritance the next step is to add
another class file and this is going to
be employee dbcontext
and we want this employee dbcontext
class to be inheriting from dbcontext
class which is present in system dot
theta dot entity name space and this
employee dbcontext class is going to
contain a public property which is going
to return a DB set of employees and
let's call the property employees all
right the next step is to include the
connection string and a web config file
to speed things up I have already typed
the connection string so let's copy and
paste it right here all right
the code within webform one dot aspx is
not going to change in any way okay so
let's go ahead and build the solution
first to make sure everything still
compiles now we have an error here let's
actually look at that it says this
annual salary is not defined if you look
at the spelling here I think with our
employee class the spelling is I mean in
permanent employee class the spelling is
annual salary with double end there in
the code-behind file and ru we have W I
think in the previous session we
misspelled that
so let's correct that here alright now
let's go ahead and build a solution to
make sure it still compiles so build
succeeded now let's flip to sequel
server management studio so this
employee is stable you know we created
that in the previous session when we use
database first approach so let's go
ahead and delete that employee's table
from the sample database actually let's
delete the sample database itself
all right so the sample database is gone
now now let's go ahead and run this
project so when we select load all
employees you know the code within the
radio button list click even handle it
should be executed look at this the page
is being loaded so at this point the
sample database and employees table
should be created let's refresh this
databases
notice that we have called the sample
database and employees table and let's
look at the columns so there we go all
the columns are present you know ID
first name last name gender hours worked
hourly pay annual salary and
discriminated columns now if you look at
the order of columns you know in the
previous session if we look at you know
how this table was generated we have you
know ID first name last name gender and
then we have annual salary and then I
was working hourly pay and finally
discriminator but if you look at this
database table here the contact employee
columns are present after you know
gender column so hours work and hourly
pay we don't want you know the column
order to be like that instead we want
annual salary to be present after gender
column if that's the case then we can
use column attribute to dictate the
entity framework the order in which we
want these columns to be created within
the employees table so we can go to
employee for example so we want the ID
column to be created first in the
employees table so I'm going to use
column attribute for that now column
attribute is present in a system
component models or data annotation
start schema name space so let's bring
that in and then this attribute has got
a named parameter order where we can
specify the order of the column within
the database table so we want that
column to be you know the first column
so I am specifying the order s1
similarly you can specify the order for
first name last name gender etc to speed
things up I have typed that code already
so let me copy it
and paste it right here
so now first name is too last name is
three gender is four after gender we
want annual salary to be created so I'm
going to go to permanent employee class
and then I'm going to say here the order
is going to be so let's use the column
attribute this is present in system dot
component model so let's bring that in
and here we are going to specify order
as five so now after gender column
annual salary will be created along the
same lines for contract employee you
know hours work we want that to be six
and hourly pay seven so to speed things
up I have typed that code so let's copy
and paste it there okay so now let's go
ahead and delete the sample database
let's rerun the webform okay we need to
bring in the required namespace
let's bring the damn and then let's run
the webform so let's select the radio
button the page is being refreshed it's
done let's refresh the databases folder
so we have the sample database
employee's table and then when we look
at the columns notice that the order is
correct now now let's execute this
insert a script to insert some test data
so data is inserted now let's actually
refresh this waveform and I select load
employees look at this the bed form
continues to work in the same way here
we are using code first approach load
permanent employees we get only the
permanent employees and lewd contract
employees we get only the contract
employees okay now let's see what
happens when we try to insert an
employee so what I'm going to do here is
for webform one let's flip this to the
design mode lets actually auto format
this to choose the colorful scheme then
let's add a button control here and
let's add another button control so this
one let's say the text on the button
something like add permanent employee
and similarly for this button let us say
add contract employee
alright now let's double the button
controls to generate the respective
click event handlers and you know when
we click on add permanent employee we
want to add a new permanent employee to
the database table and to speed things
up again I have typed the required codes
let's copy and paste this code within
the click event handler so if you notice
what we are doing here is creating an
instance of permanent employee
now irrespective of whether it's
permanent employee a contract employee
they are always going to have first name
last name gender properties which are
inherited from the employee based class
and then the property that is specific
to permanent employees annual salary so
we are populating annual salary here and
then we are adding this permanent
employee object to the employees
collection using the add method and then
finally we are calling the Save Changes
method similarly when we click the add
contract employee button we want to
create a new contract employee object
and save that employee to the database
table so here we are creating the
contract employee against whispering the
first and last name gender and then for
contract employee we also need to
specify hourly pay and of us work so we
are adding that contract employee to the
employees collection and then invoking
the Save Changes method so these changes
let's run this and at the moment if you
look at the data that we have here
so we have seven rows now let's go ahead
load all employees for some reason it's
taking time here so yeah let's loaded
all the employees now let's click Add
permanent employee so it has you know
process that request let's go back to
the database table look at that
that new permanent employee is added and
look at the discriminator column is
automatically populated as permanent
employee we didn't tell in or we didn't
supply any value for that column but
entity framework was able to you know
add that you know value to that row
automatically because the type of object
that we are creating here is permanent
employee
that's why entity framework knows what
value to supply for that discriminative
column in fact entity framework is the
one which actually created that
discriminator column we didn't create
that right now similarly let's go ahead
and add a contract employee so that's
processed now let's execute the select
statement look at that stacy is a
contract employee look at the
discriminator column it says it's a
contract employee because the type of
object that we are creating within the
code-behind file here is contract
employee object right that's it for
today thank you for listening have a
great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>