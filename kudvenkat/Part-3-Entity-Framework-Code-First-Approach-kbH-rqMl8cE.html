<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 3   Entity Framework Code First Approach | Coder Coacher - Coaching Coders</title><meta content="Part 3   Entity Framework Code First Approach - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 3   Entity Framework Code First Approach</b></h2><h5 class="post__date">2014-05-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kbH-rqMl8cE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">since part three of entity framework
tutorial in this video we'll discuss the
code first approach of entity framework
entity framework supports all these
three approaches schema first model
first and code first in part one we
discuss the schema first approach model
first approach is discussed in part two
and in this video we'll discuss the code
first approach code first approach
allows us to create our custom classes
first and based on those custom classes
entity framework can automatically
generate the database and create the
required tables for us let's understand
using the code first approach with an
example we'll be modifying the same
example that we worked with in the
previous session of this video series so
let's flip to visual studio so notice
that we already have this employee model
dot e DMX file which we have generated
using the model first approach in the
previous session of this video series so
let's go and delete that first because
we no longer require that and let's also
delete this employee model dot e dmx dot
SQL file which contains the required
sequel to create the database tables so
let's go ahead and delete that as well
alright all we have at the moment is the
web config file and the webform which
contains the grid view control and
entity data source control so to this
project let's add a class file and let's
call this department dot CS so this file
is going to contain the definition for
Department class so what other things
that a typical department contains ID
name location and a department will also
contain you know some employees so it is
also going to contain maybe employees
property which is going to return list
of employees back okay so basically what
department class is going to look like
this with ID name location and employees
property which is going to return list
of employee objects okay to speed things
up I have already typed these properties
so let's copy them from this notepad and
paste within department class okay and
if you notice at the moment look at this
employee we have a compilation error why
is that that's because we don't have the
employee class
at so let's go ahead and create the
employee class so again to this project
let's add another class file and let's
call it employee dot CS and what are the
property is that an employee you know
should have that is ID first name last
name gender salary and the department to
which the employee belong so the
employee class will look something like
this and to speed things up again I have
all these properties type so let's copy
them from the notepad and then paste
within our employee class
okay now this department property within
the employee class and employees
property within the department class or
navigation properties the rest of them
are scalar properties
okay so department dot employees you
know we are trying to retrieve you know
objects of another type so basically
list of employees they belong to another
table so it's a navigation property in
entity framework terms similarly an
employee object department is a
navigation property okay so we have the
custom classes that are required for
every application because basically
within our web form we want to display
the department ID name location and the
list of employees you know who belong to
that specific department okay so
basically to achieve this functionality
we are first creating our custom classes
with the required properties and based
on these classes we are now going to
generate the underlying database tables
let's see how to achieve that with the
help of entity framework so the next
step here is to add another class file
so so far what we have done we have just
created our custom classes the
department and employee classes so step
three is to add another class file and
let's call this employee dbcontext you
can give this file any name you want but
the reason why I have chosen this name
you know there's a specific reason for
that will discuss that in just a bit so
we are going to make this class and flow
dbcontext inherit from another class
called dbcontext and this class is
present in systems or data entity
namespace which is present within this
entity framework assembly so let's go
ahead and bring in system dot data
entity namespace and then let's make
this class employee dbcontext inherit
from DB context class so this is the
class it does you know base class DB
context is what is doing you know all
the work to interact with the database
retrieve data for us and then then
populate our custom objects okay so we
are going to inherit from that class and
within this employee DB context class
I'm going to have two properties okay
and both of them are going to be public
and what are these property is going to
return these properties are going to
return a DB set of Dept objects okay I
am going to call the property
departments and then let's have a gap
and a set accessor similarly let's have
another public property and this one is
going to return List
I mean DB set of employee objects and
let's call the property employees so
very simple class employee dbcontext
with just two public properties okay now
there is another thing that we need to
do basically you know let's add another
class file and again we can give this
class file any meaningful name we want
but I'm going to call it employee
repository so basically this class is
going to contain you know our methods
which are going to return the data that
we want okay so here what we want you
know you can write methods to return
list of employees list of departments or
one employee one department you know
will write all our custom logic within
this employee repository file okay you
can do that within the code behind file
as well but since I want to use object
data source
control I'm going to use you know a
separate class file and then I'm going
to include all the methods which is
going to retrieve data within this class
so let's call this public this is going
to return lists of Department objects
back so I'm going to return a list of
departments and let's call this get
departments so this method is basically
going to return all the departments that
are going to be there in the
department's table within the database
okay and to retrieve the departments
remember this employee dbcontext class
is what is going to interact with the
database behind the scenes using this
dbcontext class okay so we are going to
create an instance of this employee
dbcontext class within our employee
repository so employee dbcontext let's
call this employee dbcontext equals
employee DB context dot look at that we
have departments property we have
employees properly
departments property what is it
returning back DB set of department
objects but this method is returning
list of department objects so we need to
convert that to a list and to do that
simply use two list method and we want
to return that back to whoever is
calling this method okay so that's a
pretty straightforward method okay now
another important thing that we need to
do is look at our DB context class it's
called employee DB context now the
convention is entity frameworks looks
for a connection string in the web
config file with that name to retrieve
or to save data back to the database
basically to connect to the database
entity framework is going to look for a
connection string with the same name in
web block config file so let's go to web
config file and if you look at this
connection strings section we already
have a connection string there that was
basically generated for us by the model
first approach we no longer need that so
let's get rid of that connection string
from there
and let's add a connection string let's
give it a name and keep in mind the name
should match with this class name you
can change it but there is some work
that needs to be done we'll discuss that
maybe in a later video session for now
let's use the defaults and then we
specify the connection string so server
is equal to dot in my case the service
is installed on the same machine and the
database is going to be sample and I'm
going to use Windows authentication so
integrated security is equal to true all
right so we have the name of the
connection string and connection string
itself now we have all that is required
so let's flip to our web form one dot
aspx now at the moment look at this we
are using entity data source control but
we have a custom object here employee
repository which is giving us the
objects that we want to display so I'm
going to make use of object data source
control instead of entity data source
control so I'm going to delete this
entity data source control from there
and then from the tool box
let's drag and drop an object data
source control and let's configure this
data source control now when we drop
this look at that we don't find our
employee repository class that's
basically because we have not built our
project so let's go ahead and build the
solution once and now if we go to
configure datasource so choose your
business object which contains the data
so employee repository is the one which
is going to give us the data that we
want and then once we click Next on the
object data source look at this we can
specify the methods to retrieve data to
update and sit and delete in this case
we are only going to retrieve data so
what is the select method going to be
get departments and where is this
present within our employee repository
class which is going to return a list of
departments select that and click finish
now we need to associate this object
datasource with this grid view control
so choose datasource at the moment it is
having that entity datasource one which
we used in the previous session but we
want to use object data source one
control which we just added the moment I
do that it's asking me do you want to
refresh fields and keys for grid b1 for
now I'm going to say no because you know
it's essentially going to be the same
properties ID name location and
employees is going to contain you know
the set template field which contains
another grid view control which is going
to basically display employee details we
discussed that in our previous session
so I'm not going to go into the details
of that here all right so with this with
these changes let's go ahead and build
our solution and then let's flip to
sequel silver management story if you
remember from the previous video session
we have already created the sample
database but with code first approach
the database need not exist at all so
I'm going to delete this database from
here so make sure you check this blog
box close existing connections and then
click OK
so if there are any open connections
it's going to close them and then delete
the database so we don't have the sample
database at the moment and then now when
we come here and then run this project
you know it should actually create the
database for us and then create the
departments and employee tables if
everything is done correctly but look at
this we have a problem it says the
connection string employee DB context in
the app config file does not contain the
required provider name attribute so for
the connection string within web config
file there is something missing and that
is provider name at the moment we have
specified name and connection string we
also need to specify provider name now
here we are using sequel server so the
provider is going to be systems or data
sequel client so that's what we have to
specify as they provide a name here
system dot data dot sequel client all
right
with that change let's go ahead and run
this form once again so now it should
create the sample database it should
create the department's table and
employee table and it should also
establish any primary key
relationship between the tables now
notice that we don't have any data here
that's basically because the application
has just created the database and the
required tables so let's come here and
refresh the databases and notice that
sample database is there and if we
expand tables look at that we have got
departments table and employees table if
we expand departments and then if you
look at the columns notice that we have
got ID name location which corresponds
to the properties that we have ID name
location okay and then if we expand the
employees table and look at the columns
we got ID first name last name gender
salary and we also have department ID
before and key okay so every employee
has a department associated with them so
there is this department ID foreign key
and to find out you know how many
employees belong to a specific
department we basically can use the
department ID and then tell how many
employees belong to a specific
department okay so it has created these
tables for us but then if you look at
the data they are basically going to be
empty why because it just created the
tables you know next video we will see
how to you know use entity framework to
populate these tables with sample data
but for now let's manually insert some
data into these two tables so let's go
ahead and execute these insert queries
now if we execute the Select query we
should get the data back all right now
let's go ahead and refresh this waveform
okay now look at this we get to see ID
name and location of the department but
why is employees blank that's basically
because remember within department class
we have this employees navigation
property which is going to return list
of employee objects by default the data
for the navigation property is not
loaded if you want the data of
navigation properties to be loaded then
we'll have to tell that to the entity
framework and the way we do that is
within a
employee repository notice that using
this DB context object retrieve
departments now this departments
property also has you know this method
called include where you can specify the
navigation property name for which you
want the data to be included in our case
we want employees data to be included
with every department so we specify that
as a string for this include method and
that's it we're done so let's go ahead
and run our web application once more
and this time we should say employees
data as well
okay there we go
that's it for today thank you for
listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>