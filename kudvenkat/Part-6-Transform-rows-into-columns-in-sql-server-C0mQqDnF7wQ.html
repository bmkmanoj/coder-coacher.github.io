<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 6   Transform rows into columns in sql server | Coder Coacher - Coaching Coders</title><meta content="Part 6   Transform rows into columns in sql server - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 6   Transform rows into columns in sql server</b></h2><h5 class="post__date">2014-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/C0mQqDnF7wQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part six of sequence of
interview questions and answers video
series in this video we'll discuss how
to transform rows into columns in
sequence server this is yet another
common interview question to get the
best out of this video I strongly
recommend to watch about 54 from
sequence of a tutorial for beginners
video series in part 54 we discuss the
basics of pivot operator so if you're
new to pivot operator I strongly
recommend to watch that video first and
here is the interview question write a
sequel query to transpose these rows
into columns if you notice the United
States of America has got three rows one
for each of the cities within that
country and the same is the case for
India and UK and if you look at the
result set on the right hand side these
city rules are actually converted into
columns as you can see here so let's see
how to transpose these rows into columns
obviously the first step here is to
create the table itself which I have
already done and here is the sequel
script to create the table and the
sequel script to populate it with some
test data
I'll have the script available on my
blog in case you need it now let's look
at writing the query itself so we want
to select some columns from countries
table so the columns that I want to
select our country city and row number
in a bit we'll discuss are in or the
purpose of generating this row number
and to generate the row number I'm going
to use row number function again we
discuss the basics of row number
function in sequence over tutorial so if
you're new to using this function I
strongly recommend to watch that video
first so we want to select row number
over a data set that is partitioned by
country column and that is ordered by
country column and let's give this row
number a column name and let's call this
maybe column sequence
let's execute the select query and see
the output that we get so we get the
wrong number there and the reason for
generating this rule number and look at
this the no numbers are unique only
within you know for a given country so
for India row numbers 1 2 3 4 UK 1 2 3 &amp;amp;
4 USA 1 2 3 and the reason for
generating these row numbers is look at
what we want in the out board we want
the column names to the city 1 city to
city 3 now to generate those column
names what I am going to do is
concatenate the word city to these
numbers and to achieve that the easiest
way is to simply you know append this
text city to whatever number this rule
number function is returning now when we
execute this query we are going to get
an error at runtime error converting
data type back here to begin
that's because city here is where care
whereas the number that this rule number
is returning is of type big end and when
we apply this operand plus between those
two data rights we are going to get this
error and the solution to this problem
is to simply convert the number to where
care and the way we do that is by using
cast function so let's use cast function
and what we want to do is cast the rule
number as where care of 10 now let's
execute this and see the output that we
get so we get city 1 city to city 3 now
this is the Select query which is going
to return us the result set on which we
are going to apply the pivot operator at
the moment notice the city one city to
city 3 these are still rows within the
result set in a bit we'll see how to use
the pivot operator which is going to
transpose these rows into columns okay
so let's give this result set a name so
let's say let's call this maybe
tap and then from this result sad we
want to select so what do we want in the
output we want country city one city -
and city three now at the moment this
result set is giving us the data that we
want you know we have the country we
have city one city to city three and the
respective cities as well but still
these are rose okay
so let's actually say we want city one
CD two and CD three so that's what we
want in the outboard now these are still
draws the pivot operator that we are
going to apply in just a bit on this
result set is going to transpose these
rows into columns and then this Electra
will be able to select that so now let's
go ahead and apply the pivot operator
and if you recollect the syntax of pivot
operator from part 54 of this video
series the first thing that we need to
specify here is the aggregate function
so I'm going to use max aggregate
function now when we use Max or min it
doesn't really make any difference at
least for this query but to satisfy this
index I'm going to use this max
aggregate function and the column is
going to be City this that's what we
want to pivot okay and then we're going
to use the for keyword and then we have
to specify here the name of the column
which contains the values that we want
to transpose to become columns so here
column sequence is containing this city
one city to city three so that's the
column which contains the values that
should effectively become the pivot
columns okay so here the name of the
column is going to be column sequence
and then we need to specify the pivoted
columns okay so what are the columns
that we want to pivot
CD 1 CD 2 and CD 3 and that's what we
specify in the list here so for in CD 1
CD 2 and C 3
and let's give this pivot and aleeah's
let's call it wave so we want to select
these four columns from this result set
okay and then this pivot is going to
transform these rows into columns and
once that is done we want to select
country city 1 CD 2 and CD 3 so let's
execute the Select query and see the
output that we get so notice that we
have one row for each country and then
the city rows themselves have become
columns okay
all right now here if you look at the
data that we have for each of the
countries there are three cities of the
maximum and you know we get all those
three cities as expected now what
happens if one of the country is going
to have afford the city now let's see
let's look at that in action so let's
insert some test data into this country
stable so insert into countries and I'm
going to insert in OECD for India so
let's say India is the country and
Chennai is the city so when we execute
this query now if you look at country
India it has got four cities okay but
then when we execute the query that we
have just written it is only going to
select three cities it's not going to
select the for the city okay so why is
that that's basically because you only
told your select query so let's execute
this query which is going to return us
the data you know on which pivot
operator will be applied so here if you
look at City for New Delhi and that's
not retrieved or displayed within the
output okay why is that that's because
we are only pivoting three columns I
mean three rows you say that is City one
city to city three and not the fourth
one so we want to pivot the fourth city
as well data if you have four of them
and then you want to select that within
your
final result okay so let's go ahead and
execute this one and now notice that we
have Food City for India but for the UK
and the US there's no fourth city and
that's why there is plain all values all
right so we have just seen how to use
the pivot operator and transpose rows to
columns that's it for today thank you
for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>