<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Anonymous authentication and asp.net impersonation   Part 86 | Coder Coacher - Coaching Coders</title><meta content="Anonymous authentication and asp.net impersonation   Part 86 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Anonymous authentication and asp.net impersonation   Part 86</b></h2><h5 class="post__date">2012-12-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/arHfdhBGwpg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to presume technologies I am
venket this is part 86 of asp.net video
series in this session we will discuss
about the effects of turning
impersonation on with anonymous access
in part 85 of this video series we
discussed that is provides anonymous
access to resources on the server using
I us our account but once the request is
handed over to a speed or net the
application code is actually executed
using the application pool identity in
this session we will discuss about what
impersonation is how to turn
impersonation on and what are the
effects of turning impersonation on with
anonymous access let's understand that
with an example let's flip to visual
studio I have an asp.net web application
project with named web application 1 it
has got this waveform 1 dot aspx on
which I have a grid view control and a
button control within the page load
event you know this is the same piece of
code that we discussed in part 85 of
this video series this line basically
prints out the name of the account
that's used to execute the application
code this line here tells whether the
user is authenticated or not and this
line tells the authentication type that
we are using if the user is
authenticated and the name of the
authenticated user ok so it's the same
piece of code that we discussed about in
part 85 ok and then when the user clicks
this button within the button click
event what are we doing we are creating
a data set object and we are reading
this XML data so in C colon backslash
data folder I have a I have an XML file
could continue stored XML so we are
basically reading that XML data into
this data set which in turn is used as
the data source for the grid view
control and we are calling data bind so
very simple application now this
application is deployed to is so within
is I have an application called web
application 1 now this web application 1
if I right-click on that and if I go to
manage application and advanced at
settings if you look at the properties
here
you know web-application one is
associated with C colon backslash web
application one web application one
that's our web application one and this
application is actually present in a
default app pool okay and if you look at
the authentication for this application
anonymous authentication is enabled okay
so as you might expect if I go ahead and
run this now since anonymous
authentication is enabled I will be able
to access this one and then once the
request is handed over to asp.net the
application code is actually executed
using default app pool that's the
application pool identity and is user
authenticated no because we are
accessing this resource using anonymous
authentication so obviously
authentication type and username will
also be empty all right so when I go
ahead and click this button you know the
application reads that XML data into the
data set and displace that fine all
right very good
now let's go ahead and see how to enable
impersonation and what actually happens
when we enable impersonation so to turn
impersonation on all we have to do is
within web config file under system dot
web I use this identity element identity
impersonate is equal to true that's it
so we have turned impersonation on we
have enabled impersonation now let's go
ahead and access this waveform we
actually will get an error now look at
that an asp.net setting has been
detected that does not apply in
integrated manage the pipeline mode so
what is this integrated managed pipeline
mode and various this Pleasant so within
is okay remember this web application
one is executed using default Apple how
do I know that just right-click on that
go to manage application Advanced
Settings so the application pool that is
used as default apple so where is the
default apple go to application pools
here and you should find the default app
pool and look at you know go to the
basic settings of this one and we can I
find the base
Seton's you can see that here edit
application poor basic settings now look
at the managed pipeline mode it's
integrated and what is the error message
say asp.net setting has been detected
that does not apply in integrated
managed pipeline mode which means we
have changed that to classic so when we
enable impersonation the integrated I
mean the managed pipeline mode must be
classic so I click OK now let's go ahead
and refresh this page ok so that error
goes away and look at the interesting
fact here now the application code is
actually executed using anti-authority
backslash i user so that's the account
which was initially providing anonymous
access to resources on the server no
that's the you know account that is uses
now even when the request is handed over
to asp.net the same account is actually
executing the application code as well
okay so why is this happening because
you have enabled impersonation you have
turned the impersonation on so because
of that the is account the I user
account is used to execute the
application code in fact this is a very
common interview question ok when the
application uses anonymous
authentication and if impersonation is
disabled then the application pool
identities you see is - is used to
execute the application code we have
seen that but if impersonation is
enabled with anonymous authentication
then the I user account is used to
execute the application code ok so the
next very important question is when to
use application pool identity over I use
u.s. are many a times it's actually
better to use application pool I didn't
today because we have discussed you know
about what application pools are what
are the advantages of deploying
applications to application pools
because they provide application
isolation and better security ok we
discussed that in the previous sessions
of this video series so you if you
haven't watched them I would strongly
encourage you to do so but then let's
answer this question now when to use
application pool identity or
ius are to execute the application core
if there are two or more websites hosted
on a machine with I user as the
anonymous account then they can access
each other's content let's say I have
web application one and web application
two now if you enable if you use I use I
us RS they anonymous account if you
enable impersonation
then I USR account is going to be the
one that executes the application code
for both the applications now for that
account you know you can set when you
set permissions you can either set
permissions to access a specific file or
deny access to a specific file when you
deny access to a specific file for that
account then both of the applications
will not be able to access similarly if
you grant access then both of the
applications will be able to access okay
so that's that's a security threat if
there are two competitors and both of
their websites are hosted on the same
web server now we do not want you know
one competitor's website to come and
access the contents that belong to
another competitor okay in that case
what we can do we can actually deploy
the application to different application
pools when we deploy the application to
different application pools each
application pool has its own application
pool identity now for competitor one you
know let's say I have application one
that is deployed to a application pool
one application to deploy to application
pool to okay now now I can deny access
to application pool one identity to all
the files that belong to you know
application to and along the same lines
I can do the same two thing to
application one as well in this way
application pools provides us better
security or files in fact we have
discussed about how to do that in part
84 of this video series now let's
actually see this point if there are two
or more websites hosted on a machine
with our user as the anonymous account
then they can access each other's
content how is that possible let's
actually look at that so I have web
application one here now the
impersonation is actually enabled for
this web application one I have another
web application here which is
the name is web application - but it's
exactly similar to web application one
so on web form one of this web
application - is the same piece of code
and then within the button click the
same piece of code again so for this
application at the moment impersonation
is not enabled let's go ahead and enable
the impersonation and to do that under
system dot web within web config file
all we have to do is identity
impersonate is equal to true so we are
enabling impersonation and now this web
application to advances settings and
even this one is being executed using
default app pool okay and if you look at
the default app pool
if we right click on default air pool
advanced settings you know the
identities application pool identity but
since we have enabled impersonation but
for both of these applications they're
going to use di di us our account to
execute the application code so let's go
ahead and run the application to as well
so now look at that even application to
is using I us our account I click this
button I am able to access this file now
both of the applications are able to
access the file ok let's say these two
are competitors only web web application
one should be able to access that file
but web application two shouldn't be
able to access if I go ahead and deny
access to I us our account what's going
to happen both of the applications will
not be able to access that that's
because of the fact they're using the
same account to execute the application
code we will not have that problem when
we deploy this application to different
application pools and then if we disable
impersonation okay so let's quickly
check that so I'm going to go to this
file go to the properties and security
I'm going to edit click Add that's the
name of the account check names so
that's going to be I USR click ok and
I'm going to deny so now if we refresh
this that's web application to I click
this button and I get a security error
and similarly I click this button here
look at that I get the same error both
of the applications are not able to
access the file but if we want to
isolate each applications content the
applications can be deployed to
different application pools and the NTFS
file permissions can be set for the
respective application pool identity in
fact we discussed about this in part 84
so please check that video session on
this slide we have resources for asp.net
c-sharp and sequel server interview
questions that's it for today thank you
for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>