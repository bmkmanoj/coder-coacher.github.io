<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ASP NET Web API MediaTypeFormatter | Coder Coacher - Coaching Coders</title><meta content="ASP NET Web API MediaTypeFormatter - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ASP NET Web API MediaTypeFormatter</b></h2><h5 class="post__date">2016-09-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tNzgXjqqIjI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part six of asp.net Web API
tutorial in this video we'll discuss
what is media type for matter how to
return only Jason from asp.net Web API
service similarly how to return only XML
how to return JSON instead of XML from
asp.net Web API servers when a request
is made from the browser and finally I
will point you to an article that
describes how to written CSV format data
from asp.net Web API service so what is
media type formatter media type
formatter is an abstract class from
which all the formatter is derived from
for example with an asp.net Web API
we've got this Jason media type
formatted class so this is the class
that deals with JSON data for example
when we issue a request to an asp.net
Web API service with accept had a value
as application for slash Jason we get
the data formatted in JSON and it is
this class Jason media type format
who is doing that for us so this class
is also inherits from this abstract
class media type formatter similarly we
have XML media type formatted class
which deals with XML data and this class
also inherits from this abstract class
media type format so if you look at the
code that we have got in Web API config
dot CS this is the code that we have put
in place in our previous video look at
this property JSON format also if we
right click on that and then if we go to
the definition look at this this
property is actually returning an
instance of type Jason media type
formatter so if we right click on that
and go to definition
Jason media type format a class is
inheriting from base
Jason media type format if I right click
on that and then go to its definition
that class is inheriting from media type
format a class so jason media type
format a class is inheriting from this
abstract class
media type formatter similarly we have
also got XML format and if we look at
this property
notice it is returning an instance of
type XML media type formatter if we go
to the definition on that
this derives again from the base
abstract class media type formatter now
if we want to create our own custom
format let's say for example we want to
create a formatter that is going to
return the data in CSV format then in
that case we will create a class which
is going to inherit from this media type
format a class and then implement its
abstract members in fact at the end of
this video I'll point you to an article
that describes how to do that now let's
discuss how to written only Jason from
asp.net Web API service irrespective of
the accept header value let's flip to
visual studio so within our register
method of Web API config dot CSV file
first of all let's comment these two
lines of code we are going to make use
of the config object that is coming into
this method as a parameter config dot
for matters dot Remo so we want to
remove a formatter which format ado we
want to remove we want to remove the XML
format because we know that we want the
service to only support Jason so to
remove the XML format we are going to
use the config object again config dot
for matters dot XML format ax so this is
going to completely remove the XML
format ax so whenever we make a request
to the service it is always going to
format the data using JSON format
irrespective of the accept had a value
in the request so use this technique if
you want to create a service that is
going to support only Jason and not XML
so the build has succeeded now let's go
ahead and issue a request from our
browser notice the response is in JSON
format as expected
now let's issue this request from
fiddler notice we have set accept header
to application for slash XML when we
execute this and when we inspect the
response notice we are still getting
Jason irrespective of the accept header
value we are always going to get Jason
look at that website application slash
XML but we are still getting Jason if I
specify application for slash Jason
execute that again you know we are still
getting tail
and so irrespective of the accept header
value we are always going to get json
formatted data here is the code that we
just discussed now let's see how to
return only xml instead of JSON so to do
that we will do the opposite instead of
removing the xml format we will remove
the json format let's save our changes
build our solution build succeeded now
let's go ahead and reissue this request
so when the request completes
successfully it's going to return xml
instead of jason notice we have got xml
back now lets issue request from fiddler
and say so we have set the accept header
to application for slide jason let's
execute this and when we inspect the
response notice we are getting xml now
if we set it to xml we are still going
to get xml so irrespective of the accept
header value we are always going to get
xml so notice again the result is an xml
format here is the code that we just
discussed now let's discuss how to
return JSON instead of XML from asp.net
web api service when a request is made
from the browser so here is what we want
to do let's flip to visual studio first
of all let's comment this line of code
let's build our solution build it
succeeded
now let's issue the request from the
browser notice we are getting XML we
always get XML back when we issue a
request from the browser and that's
because of the accept had a value in the
request let's inspect the request that
we have issued from browser so let's
flip to fiddler I'm going to drag and
drop this request on to the composer tab
and look at the accept header value text
for slash HTML so for this accept header
value the asp.net web's the Web API
service is always going to return XML
but we want to do the opposite instead
of returning XML for that accept header
value we want to return JSON so whenever
a request is issued from the browser we
want to return JSON instead of XML but
when a request is issued from tools like
fiddler or even fly
client application and when we set
accept had a value to something else for
example something like application for
slash Jason then we want Jason formatted
data if I set it to application for
slash XML then we want XML formatted
data so when a request is issued from
the browser we always want JSON data
back but when a request is issued from
any tools like fiddler or from a client
application where we set the accept
header value to application for slash
XML for example that accept header value
should be respected and the data should
be formatted in XML so let's see how to
achieve this there are two approaches to
achieve this approach one within our
config file let's use the config object
and get hold of the JSON format and then
on that we are going to call supported
media types collection property and to
that we are going to add a media type
and let's add new media type header
value and the media type header that we
want to add is text four slash HTML so
when the accept header value is text
four slash HTML we want to use JSON
formatter
to format the data so let's go ahead and
build our solution build succeeded and
let's issue the request from the browser
notice we got Jason data now let's
inspect this in fiddler now first of all
notice it says response body is encoded
click to decode so I'm going to click on
that and if we click on Jason tab notice
we got Jason formatted data but then if
you look at the response header
we've got content type here and look at
the content type it's still text four
slash HTML but if you look at what we
have got we actually got JSON back so I
expected the header value to be
application four slash JSON instead of
text four slash HTML this is a bit
misleading but then the good thing is if
we go on to the composer tab and if we
specify the accept header value as
location for slash XML and when we
execute this we are still going to get
XML back and ahead evaluates application
for slash XML if we specify this
application for slash Jason we're going
to get Jason back but the only problem
here is that it is setting the accept I
mean the content type header value in
the response to text slash HTML we would
actually like it to be application for
slash Jason let's see how to do that
here is the code now let's look at
approach to with approach to will solve
the content type header value problem as
well so let's slip to visual studio
within Web API config dot CS file I'm
going to include another public class
the name of the class is going to be
custom jason formatter
so here we are creating a custom jason
formatter so this is going to inherit
from jason media type format a class
this class is present in a different
namespace system dot net dot HTTP dot
formatting so make sure you have that
namespace included let's include a
constructor for our custom Jason
formatter with in the constructor all
I'm doing is adding a supported media
type so this dot supported media types
dot add and we want to add a new media
type header value and they had a value
that we want to add is text for slash
HTML and then we want to override one of
the methods in the base class that is in
Jason media type formatter so I'm simply
going to type override and then + space
and then it's going to show us all the
methods that we can override so I'm
going to override this method set
default content headers so that's what
we want to do we want to set the default
content header for Jason media type
formatter and I'm going to include this
call their base dot set default content
headers and then we have this object
that is coming in the HTTP content
headers object so we are going to use
that and set the content type to new
media type header value and the new
value that we want to set it to is
application for slash Jason and then we
will have to register of a custom Jason
for matter within the register method so
let's go to the class web a be a config
we just got the register method and then
here let's comment this line config for
matters dot R we want to add a new
instance of our custom Jason formatter
let's save our changes
give our solution a bell build it
succeeded now lets issue the request
from the browser now let's inspect this
request in fiddler so let's double click
this notice we get json formatted data
as expected and if we look at the header
notice the content type is set to
application for slash jason and if we go
to the composer tab and set you know the
accept header to xml we are going to get
xml data back if we set it to JS and we
are going to get Jason back with
approach 2 here is our custom JSON
formatted class code and this is how we
register our custom jason formatter
finally let me show you how to create
your own custom media type formatter
so here we have an article that
describes how to create a custom media
type formatter that's going to format
the data in CSV so let's navigate to
that article notice here they are
creating a class CSV media type
formatter that inherits from the
abstract media type format a class so
follow this article if you want to
create a custom format that is going to
return data in CSV format
I'll have this link available in the
description of this video if you need it
thank you for listening and have a great
day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>