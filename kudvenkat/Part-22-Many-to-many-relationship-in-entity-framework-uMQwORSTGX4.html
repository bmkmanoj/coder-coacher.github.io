<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 22   Many to many relationship in entity framework | Coder Coacher - Coaching Coders</title><meta content="Part 22   Many to many relationship in entity framework - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 22   Many to many relationship in entity framework</b></h2><h5 class="post__date">2014-06-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uMQwORSTGX4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this part twenty-two of entity framework
tutorial in this video we'll discuss
many to many relationship in entity
framework but the database first
approach will be using these three
tables in this demo courses student
courses and students table course this
table has got course ID and course name
columns here course ID is the primary
key column students table has got
student ID and student name columns here
student ID is the primary key column
there is a many to many relationship
between courses and students table a
student can enroll in too many courses
and similarly a single course can have
many students enroll so obviously there
is a many-to-many relationship between
these two tables and to store the data
we have this bridge table student
courses and if you look at the sample
data that we have here at the moment
student ID one is enrolled in courses
one and two student ID one is Mike and
courses one and two are c-sharp and
asp.net so Mike is enrolled and c-sharp
and asp.net and if you look at the
second set of data that we have here our
student ID two is enrolled in courses
one two three two is John and causes one
two three are c-sharp asp.net and sequel
server so John is enrolled in those
three courses now if we were to generate
an entity model based on these three
tables entity framework will only
generate two entities course and student
with a many-to-many relationship between
them notice that at both ends of the
entities we have a star which means
that's a many-to-many relationship
notice that we don't have any entity
generator for this bridge table student
corset but in spite of that entity
framework knows how to work with the
many-to-many relationship between those
entities because this relationship
itself will be mapped to student courses
database table we look at that in action
in just a bit another interesting thing
note to notice here is that course has
got students navigation property which
allows us to navigate from course to
students and similarly student has
caught courses navigation property which
allows us to navigate from student to
courses let's look at this in action
obviously the first step here is to
create these three tables itself which I
have already done
here is the sequel script that can do it
I'll have the script available on my
blog in case you need it now let's flip
to visual studio so here I have an empty
asp.net web application project to this
project first let's add a new item and
we want to add a do dotnet entity model
and let's call this employee model we
want to generate the model from the
database so select that option click
Next and let's give a meaningful name to
the connection string let's call this
employee dbcontext click Next so this is
going to connect to the database and
retrieve all the tables views and store
procedures let's go and select the three
tables that we are interested in and
let's give this model namespace a
meaningful name and let's click finish
now though we have three tables entity
framework is only going to generate two
entities and look at that entity
framework didn't really do a good job in
naming this course entity so let's stick
in any at the end of the entity name and
let's save these changes
notice that course has got navigation
property students
similarly student has got courses
navigation property and if I right-click
on this association and when we go to
the properties notice that you know End
one multiplicities collection of course
and n 2 is also collection of students
so at both of the ends it's a collection
so it's definitely a many-to-many
Association and then if we right-click
on this Association if we go to table
mapping notice that this Association
itself is mapped to student courses
database table so the course ID property
is apt to course ID column in student
courses table similarly student ID
property is mapped to student ID column
within this bridge table right now let
us see how to actually query the data ok
now to query data we're going to design
a web form that looks like this so we're
going to have a grid view and we want to
display the list of student names and
the courses into which they have enroll
your Mike is enrolled into c-sharp and
asp.net John is enrolled into these
three courses so we want the data to be
displayed like that so let's look at
that in action
so let's actually add a waveform to this
project and then let's first set the
style attribute on this div tag and set
font family to area now let's go ahead
drag and drop a grid view control onto
this waveform let's turn this into the
design mode and then auto format this
and choose the colorful scheme and
within the page load event we are going
to create an instance for employee
dbcontext class now we are going to
write some link queries here so I'm
going to use this employee DB context
and then this has got students property
navigation property which is going to I
mean students property which is going to
return as the list of students so what
I'm going to do is whatever data that we
get with this link query we are going to
set that as the data source for the grid
view control so from student so we are
going to load each student into this
variable and if you look at the type
look at this when I hover my mouse over
the student is actually of type student
okay so we got the student and student
will have you know courses and if you
look at the model that is generated here
student entity has got courses
navigation property so what we are going
to do here is we are going to load the
courses that a student is enrolled into
and you know obviously each course will
be loaded into this variable look at
that the type of that variable is course
okay so we have the students and we have
the courses all that is left right now
is to select a new type because look at
what we want to display we want to
display student name and course and
those should be the column headers so I
am going to select a new anonymous type
here and
one of the property names within the
anonymous type is going to be student
name you can give this property any name
that you want okay so I'm calling it
student name and how do we get student
name we have the student object and that
has got student name property and
similarly we want course name so course
name equals we have this course object
so course dot course name should give us
that that's it so that's the data source
for the grid we control and then let's n
work data bind method so now before we
actually run the webform let's turn on
sequel profiler and then we will
investigate the query that's
automatically generated by the entity
framework all right so the trace is
running now let's go and run this
platform so now entity framework should
generate a query which joins all the
three tables so here is the query notice
that it is joining students courses and
student courses tables all right now we
have seen how to select data from you
know this three entities three tables
now let's see how to actually write data
to the bridge table let's say for
example when we enroll a student you
know the data should be stored in to
this bridge table okay so at the moment
if you notice Mike who is who has got
student ID one he is not enrolled into
WCF so let's enroll Mike to WCF course
and to do that I'm going to drag and
drop a button control on to this
waveform let's change the text on the
button to something like assign the BC
of course to Mike
then let's actually double click that
and then create an instance of our
employee dbcontext within the click
event handler and now so what is the
course we want to enroll Mike into WCF
so we need to first get hold of that
course and how to get courses we can use
this employee dbcontext object and
dress-code courses property so it's
going to give us all the courses but we
want you know the first or default
course where the course ID equals four
because if you look at courses table you
know WC of course ID is 4 and this first
or default is going to return a course
object back so let's store that in a
variable of type course and maybe let's
call this WCF course okay and now what
we want to do is we want to assign this
course to Mike and we first need to get
Mike so what I'm going to do here again
use this employee dbcontext object and
it has got students property which is
going to return us all the students but
we want first or default student where
the student ID is one because Mike's ID
is 1 so 2 that student obviously will
have courses navigation property
recollect from the model student has got
courses navigation property so we're
using that navigation property here and
to the courses collection we are going
to add this WCF course okay so now WCF
course will be added to the student
whose ID is 1 and Mike's student ID is 1
so the BCF course will be assigned to
Mike so all that is left is to call Save
Changes method employee DB context dot
Save Changes now let's actually
clear the trace that we have run the
trace once again and then let's run this
waveform okay now when we click this
button it should assign the VC of course
to Mike and there should be a query
generated behind the scenes and look at
that we have that insert query so insert
into student courses and it's inserting
the values for student ID and course ID
columns student ID is 1 which is Mike
student ID course 84 is WCF course ID so
Mike is assigned to WCF so when we
reload this look at that Mike now is
assigned to WCF now let's see how to I
know remove a student from a specific
course enrollment let's say we want to
remove John from sequence of a course
and again to do that let's quickly add
another button here and let's change the
text on that to remove John from sequel
server course
so the same idea so let's actually copy
the copy and paste this code and change
it according to our need so we're going
to get the courses so which course we
want so here
sequence of a course ID is 3 so retrieve
the course whose ID is 3 so that is
going to be sequel server course so
let's give it a meaningful name and then
we need to retrieve the student whose ID
is two Mike's
student ID is two so we are going to
retrieve Mike and then from his existing
course collection we are going to remove
this sequel server course and then
invoke Save Changes method ok so let's
go ahead and run this let's actually
clear this trace run the trace once
again and let's click the button go back
to sequel profiler stop that and notice
that now we have a delete query so we
are deleting from student courses where
course ID where student ID is 2 and
course ID is 3 all right that's it for
today thanks for listening have a great
day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>