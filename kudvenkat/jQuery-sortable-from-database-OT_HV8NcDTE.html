<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>jQuery sortable from database | Coder Coacher - Coaching Coders</title><meta content="jQuery sortable from database - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>jQuery sortable from database</b></h2><h5 class="post__date">2015-07-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OT_HV8NcDTE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 100 of jQuery tutorial in
this video well discuss a real-world
example of where we could use jQuery
sortable widget so here is what we want
to do we got a question here which we
want the user to answer and here is the
question reorder to match the capital
city with the respective country so here
on the Left we've got some countries and
on the right we've got capital cities so
we want the user to be able to reorder
these capital cities to match with their
respective country after the reordering
is done the user can click this check
answer button if the capital cities are
ordered correctly then the background
color should change to green otherwise
it should change to red so this question
text the question options on the left
and the answer options on the right you
know and the answer itself that's the
right answer all these should be coming
from database so let's see how to
achieve this let's flip to sequel server
management studio so the first step here
is to create four different tables now
the first table is going to be TBL
questions and this table is going to
contain the question text and question
ID so we have got two columns there and
look at that this table at the moment
contains just one row so here we have
the question ID and this is the question
that we see on the screen reorder to
match the capital city with the
respective country so the question text
will be going into this table and then
here we've got question options so these
question options will be going into a
different table and that is TBL question
options and this table has got three
columns the question option ID and the
option text that is in this case it's
going to be country name and the
question ID to which that option belong
to so at the moment if you look at the
options that we have here we have got
four question options for country names
and here is that data USA India UK and
Australia so that's the ID for the
question option and then we have the
country name and the question ID to
which these options belong to so all
these options belong to question ID one
that is this question and just like
question options we need another table
to store answer options and here is the
table
so here we have got answer options table
and again it has got the same set of
three columns as that of TBL question
options we've got on answer option ID
option text and the question ID and here
we have the city's okay
and the question ID to which those
options belong to is one and then
finally we need one more table to store
the right answer okay so what are we
going to do here we're going to reorder
the cities to match with their country
right so the answer for this would be
the correct order of the cities so
within this answer table we've got three
columns the ID for the answer and the
question ID to which that answer belong
to and the actual answer itself okay so
that's the answer ID and that's the
question I did to which the answer
belong to so this is the answer for
question ID one and here is the actual
answer so the actual answer order should
be three four one two meaning look at
that the first country is USA so for USA
the capital is Washington DC and the
idea of that is three so it should be
first and India capital is New Delhi
it's ID is 4 so 3 for UK is London so
that should be next should be 1 and for
us tray latest can vary Canberra - okay
so the right ordering should be 3 4 1 2
ok so those are the four tables that we
require I'll have all the script
available on my blog and we need two
more stored procedures so the first
stored procedure is going to get all the
question data for us by ID so what do we
mean by question data the question text
the question options and the answer
options so we need all the data to
display that question to the user so I
have a stored procedure here get
question data by ID and the stored
procedure we are passing a question ID
and here we are retrieving from the
questions table where ID equals at
question ID the parameter that we are
passing in similarly we are retrieving
the options the question options for
that question and
answer options for that question so
three select statements pretty
straightforward short procedure and we
need another stored procedure and that
is to retrieve the answer by question ID
so we passed a question ID and we
retrieve the row that matches the
question ID that we pass to the stored
procedure from TB lancers table okay so
this stored procedure to retrieve the
answer and this to retrieve the question
data so that's it from the database side
and let's slip to visual studio so here
I have an asp.net web application
project within our web config file we
have a connection string that is
pointing to our sample DB database where
we have got all those tables and since I
have already executed these scripts look
at this when I execute the Select
statement from all the tables we have
the question data there we have the
option I mean question options answer
options and the answer text okay all
right and we have a connection string
point into that dB
so the next step is to add a web service
to a project so let's go ahead and do
that add a new item and we want to add a
web service and let's call this question
service and here we're going to write
some ad or dotnet code so I need some
namespaces in the interest of time I've
already typed the required namespaces
here so we need system dot configuration
to read the connection strings from web
config file systems or data and system
dot data dot sequel client for a do
dotnet and system dot Web dot script or
serialization to serialize the data to a
JSON string okay so in the interest of
time I have also typed the required ad
or dotnet code but before we copy and
paste that let's change the definition
of this function so we are not going to
return anything from this function I'm
going to call this get question data
okay and let's get rid of that and we
want this script to be callable from
javascript so i'm going to uncomment the
script service attribute
and within our function we are going to
write ATO dotnet code to retrieve
question data remember we have a stored
procedure which returns us question data
by question ID and here is that stored
procedure so for example if we pass it
question ID 1 notice we get the data
related to that question ID the question
text question options and answer options
so we want to call that stored procedure
and return that data all right so we are
going to write some ATO dotnet code and
in the interest of time I have already
typed that so let's copy it and paste it
in our function alright so what are we
doing here pretty straightforward we are
reading the connection string from web
config file now one important thing that
we have forgot to do is we need to
create some classes so the first class
that I am going to create here is answer
class so let's call this answer and this
answer class is going to encapsulate you
know this answers table and if you look
at the answers table it has got ID
question ID and the actual answer so I'm
going to have public and ID and this is
going to be an auto implemented property
so let's have a default getting set
accessors and i'm going to have question
ID which is also an integer actually the
data type is integer and the property
name is question ID okay and we need the
actual answer and the answer is going to
be string type and let's call this
property answer text ok so this class is
going to represent TBL answer table now
I'm going to create one more class and
I'm going to call it option and in a bit
you'll understand the purpose of that
class so let's call this option and this
class is going to encapsulate both the
question options table
and answer options table so both of
these tables if you look at those tables
they have got similar columns ID option
text and question ID so I'm going to
copy these properties from here just to
save some time in typing and let's paste
them here so we need an ID for the
option and we need the option text and
the question ID so we already have
question ID and another property is
going to be option text okay and now I'm
going to create another class let's
actually name that class so let's go
ahead and add a new class and let's name
this question page data so what is this
class going to do this class is going to
contain the data that our webform needs
so that's why I named this question page
data and what are the properties this
class is going to have now what do we
need on the page we need the question ID
and question text we need the question
options we need the answer options and
we need the actual answer but we'll
worry about the answer later okay so for
the question itself we need the question
text question options and answer options
so I'm going to create a integer
property let's call this question ID and
let's have a default get and set access
for question ID and I'm going to have a
string property which is going to return
question text and we need question
options and answer options so I'm going
to create another public property and
this one type is going to be list of
option and if you look at the option
class that we have just created it's
going to represent both the question
option and answer option so here the
return type is list of option and I'm
going to call this question options so
that's a list property okay similarly
I'm going to have another property
and that property is going to be answer
options again a list of option okay all
right so we have this class question
page data now let's go back to our web
service that we have just created and if
you look at the web service here we are
reading the connection string from web
config file and look at this this is
very important otherwise we will get a
null reference exception so what are we
doing here we're creating an instance of
question page data because that's the
object that we want to return from this
function so that's the object we will be
serializing to a JSON string and writing
it to the output stream right so we are
creating an instance of this class here
question page data which we have just
created and notice what we are doing
here we are initializing question
options and answer options to a new list
of option otherwise if we try to add to
that property you know question options
or option answer options without
initializing it first we will get a null
reference exception so it's important
that you initialize these two properties
and then we're using the sequel
connection object I mean we are creating
a sequel connection object using this
connection string and then we are
creating an instance of sequel data
adapter and look at what we are
executing using that sequel data adapter
the stored procedure that we have just
created get question data by ID so this
is that stored procedure which returns
us the question data and this stored
procedure has obviously caught a
parameter and its name is at question ID
so since it's a parami stored procedure
we have to tell that to the command
object it has got a parameter name of
the parameter is question ID and the
value for that I am actually hard coding
it in real time you may read it from a
query string or you know session
variable depends on how you have
designed your application but for the
purpose of this demo I have hard-coded
it to one because we know the question
is ID is 1 and we are associating that
parameter object with the Select command
of the data adapter object creating a
new data set and filling the data set
with the result that this whole
procedure is going to return and
remember when we execute the stored
procedure we are going to get three
tables back the questions table the
question options and the answer options
so what are we doing next now we know
that this data set is going to contain
three tables and look at what we are
doing here this question page data
object that we have created on the top
so that's going to contain the data that
our web page needs and it has got
question ID and where are we getting the
value of for that property look at that
we are getting it from the first table
in the data set so first table first row
in that table use the ID column value
and convert that to an integer
similarly question text is also present
in the same row but the column name is
question text so we got question ID
question text and next we need question
options and here look at that we are
creating an instance of option object
and we are populating the ID
option text and question ID and where
are we retrieving it from from table 1
that is that's the first table at index
0 that's the second table at index 1
which contains our question options so
here we're creating an option object and
look at that we are adding that to the
question options collection property of
our question page data object all right
and we are doing a similar thing with
answer options answer options are
present in the third table which is at
index 2 and again we are adding it to
the answer options collection property
also question page data object and then
finally what we are doing we are
creating an instance of JavaScript
serialize a class and then we are
serializing this question page data
object to the output stream ok so pretty
straightforward now let's go ahead and
quickly test our web service so now we
should be able to retrieve the question
ID question text question options and
answer options
so it's still loading so here we've got
at the moment one operation contract
let's click on that so we should be able
to invoke the web service and we should
get the entire question data that we
want to display on the web service on
the page for the user all right now we
need another function here so basically
at the moment we are only getting
question data we also want to retrieve
answer data so what I'm going to do is
make a copy of this one
and let's call this function get answer
data and the same idea we're going to
read the connection string from web
config file and now we don't need this
question page data because we're going
to get answer data and we're going to
store answer in this answer object so
let's call it answer equals new answer
and again we are creating a new sequel
connection object and this time the
stored procedure that we want to execute
is another stored procedure which is
going to return us answer by question ID
so for example if we pass at question ID
1 this is going to return us the answer
of that question ok so that is the
stored procedure that we want to call so
let's copy its name and paste it right
there and that's also a stored procedure
so we have to tell that to the command
object and this stored procedure also
has got a parameter and that is question
ID so you're creating that we are
associating with the Select command of
the data adapter creating a new data set
filling the data set with the data that
we get after executing that stored
procedure and now we have the answer
object here which we want to populate so
answer answer that question ID so where
are we going to get that from from
tables of 0 rows off the column name is
going to be question ID similarly we
need the answer ID itself and that is
going to come from ID column because if
you look at the column names here you
know when we execute that stored
procedure
look at that ID question ID and answer
so finally we need the answer text so
dot answer text equals and that's
present in answer column okay
so we have the answer object that we
need so we don't require these two for
each loops here so let's get rid of
those two and once we have the answer
object we want to see realize that so
let's pass that to this here lies
function let's save our changes let's
run this web service one more time now
we should have two operation contracts
so we have here get answer data when I
click that and when we invoke we should
get answer data okay so we have the web
service that we are going to use on our
page now let's go ahead and you know
write the required jQuery code so here
on the web form we have our ready
function wired up and on the page I
already have some HTML so if we view
this page in the browser now visibly
will only have check answer button right
so here we've got the development so
basically this development is display is
to display the question text and we've
got an unordered list here to display
the question options another unordered
list to display the answer options and
finally a button to check the answer
whether it's right or wrong okay so now
let's go to our ready function and
another thing that I have done here is
defined a style for list item so this is
going to display that list item like a
block element all right so now I'm going
to issue an ajax request
so let's specify our options so the URL
that we want to call is this web service
question service dot ASM x so that's the
web service that we want to call so
let's go ahead
and specify the service name here and
within that web service we've got a
function we've actually got two
functions but the first function that we
want to call at this time is get
question data so let's go ahead and call
that that's the URL that we want to call
we want to issue a post request and the
type of data that we are expecting is
Jason when the request successfully
completes this is the function that gets
called that's our callback function
similarly if there is an error we want
to associate another callback function
so it's going to receive that error
object and let's simply alert the status
text all right so when the request
completes successfully what is the first
thing that we want to do we want to
first display the question to action
where do we want to display that
question text on the page we've got a
development right this is the
development within which we want to
display the question text so I'm going
to find that development using its ID
and I'm going to use the text function
and we have the data object here so data
dot question text so that a property of
the data object should return as the
question text so let's go out save our
changes
reload this page now on the web form we
should see the question text so what's
our next step the next step is to
retrieve the question options and create
dynamically list items and append those
list items to this unordered list and
where are our question options present
now if you look at our question page
data object which we are serializing to
the webpage it contains this option
question options so that's the property
which contains all the options that are
specific to our question so I'm actually
going to use
data dot answer options property and I'm
going to wrap that using the equity
wrapper and use the jQuery each function
so now we are going to loop through each
actually it's question option isn't
there so we need question options
property okay now we want to find the
unordered list element so this is where
we want to display the question options
so let's find that using its ID and to
that we want to append a list item right
every time we are looping through we
want to create a list item and append it
to question options so I want to append
a list item we want ID attribute because
we are going to store the ID of the list
item in that attribute so Li list item
ID equals and we want to get the ID from
the question option and we are in a for
each loop in an each loop so I can use
this keyword here to refer to the
element that we are looping through at
the moment and that has got ID property
which is going to give us the ID of the
question option and then what do we want
to do we want to close the angle
brackets and within the list item what
is the text that we want to display the
option text so distort the name of the
property is option text how do we know
that because within the option object we
have got the property option text okay
and then finally what do we want to do
we want to close the list item
all right so let's save our changes and
now when we refresh this we should get
all the question options as well notice
that and for all the question options
look at that they're displayed using a
different style and that style is
specified here right here okay
alright now similarly we want answer
options so I'm going to make a copy of
this one and instead of looping through
question options property
I want to loop through answer options
property and as we are looping through
we want to create a list item and append
that to answer options unordered list so
the idea of the answer options is answer
options so let's go ahead and specify
that right here so let's save our
changes now when we reload we should get
answer options as well now we have a
problem here now we want the question
options and answer options to be
displayed next to each other
okay so to get that I'm going to specify
a style for our unordered list so on the
page I'm going to include another style
for unordered list and all I'm going to
specify here is float:left so we want
them to float:left let's save the
changes reload this page look at that
now they are lined up next to each other
but another problem here is we have this
check answer button shifting to the
right we want that at the bottom right
here and to get that I'm going to
specify some inline styles for the
button so I'm going to set the style
attribute and I'm going to set clear
style to both and I'm going to make this
float:left again so these two properties
are going to place it where we want it
so it's going to come right here so now
the UI is similar to what we have here
the only thing that's different is the
background color of these elements now
we want these city names to be sortable
these are the answer options so we
should be able to reorder them so we
want to make them sortable
what I'm going to do now is find the ID
of the answer options unordered list and
then make it suitable so let's find it
using the jQuery ID selector and I am
going to make that sortable so let's
call the jQuery Y sortable function and
let's reload this page now look at this
we should be able to sort these now
right now we have a couple of problems
here first of all we don't want the
background color to be you know white
like this now since these are sortable
items jQuery UI is going to apply a
special class to all those list items
and to see that class for yourself now
click on the magnifying glass and look
at the list items here notice the list
items they've got IDs and the class the
special class that jQuery has applied is
this uy dash sortable
- handle and what I want to do is change
the background color of these sortable
elements to maybe gray so that we know
that by the color we can sort them so
what I'm going to do here is use this
class on my page UI sortable handle so
within the Style section let's specify
that class as well Dodge UI sortable
- handle and I'm going to specify
background color gray all right so let's
save our changes let's reload this page
and look at that now the background
color changes to gray another thing that
we want to do is at the moment look at
that I'm able to drag it even
horizontally we don't want to do that we
want to be only able to scroll it along
the y axis because this is a vertical
list and another problem is
notice that the placeholder is a blank
white space
now let's specify a placeholder class as
well okay so to specify the placeholder
class I'm first going to create a class
for that so I'm going to make a copy of
this list item
I'm going to change the name of that to
placeholder so it's a class and for the
placeholder we don't lead cursor we also
don't need this list I'll type instead
what I want is a background color and
I'm going to set that to silver so
within our you know success function
here we are making the answers are no
that list sortable and i'm going to
specify the options here so basically
I'm going to say placeholder option is
going to be this class name so does the
class that we want to apply so that is
the style to apply for the placeholder
and I am also going to specify access
option because we want to be able to you
know move those items only along Y axis
so let's save those changes reload this
page now look at this we should get a
placeholder notice that we have a
placeholder there and I am able to move
them only along the y axis not along the
x axis alright so now we have everything
that we need okay now when we click
check answer button what we want to do
we want to check whether if the ordering
of these city names is the same as what
we have in the DB three four one two
that should be the ordering okay so that
means when we click the button we want
to make another call to the DB retrieve
the answer and then match that with the
order that we have here and if they
match the answer is correct otherwise
it's wrong okay so let's go ahead and do
that I'm actually going to make a copy
of this instead of retyping everything
so basically that's closing right there
so let's make a copy of that and now we
have the button here when we click the
button that's when everything should
happen and the ID of the button is PT
and check so let's find that button
using its ID so BTN check and what do we
want to do we want to associate a click
event handler
and inside this function I'm going to
paste the Ajax that we have just the
Ajax code that we have just copied now
when we click the button we want to call
the same question service but this time
we want to call a different function
that is get answer data so that's going
to return us the answer data so here
they're going to specify the function
name but still want to issue a post
request the type of data that we are
expecting is Jason and when the request
successfully completes this the callback
function that gets called and this
parameter will receive the answer right
so I don't need all this I'm going to
get rid of this from here and when there
is an error again there's the callback
function that gets called now the first
thing that we want to do within success
callback function is to find the answer
that the user has provided so I'm going
to create a variable I'm going to call
this user answer let's initialize that
to an empty string now how do we check I
mean how do we retrieve the user answer
now look at this when we click this
check answer button all we want to do is
look through each list item within this
answer options list and get the ID
attribute value in order okay so and
then we want to compare that with the
answer that we got from the dB
so I'm going to loop through now these
list items so we need to find the answer
options ID so that's the idea of the
unordered list so within our success
callback function here I'm going to find
that answer options unordered list
element loop through each list item so
this is going to return us all the list
items now I'm going to use the jQuery
each function and loop through each of
them so user answer plus equals what are
we going to do here we will use this
keyword which is going to refer to the
list item that we are currently looping
over and what we want to do is retrieve
the ID
attribute-value and to that we want to
append a question mark okay
and when we do this the last you know ID
value will have a question mark appended
at the end but if you look at the answer
in the DB the last option does not have
a question mark at the end so we need to
knock off that question mark in the end
so what I'm going to do is user answer
equals user answer dot substring so I'm
going to use the substring function and
retrieve all the characters starting
from index 0 that's our start position
and we want to do that until the last
index of the last comma right so I'm
going to again use here user answer dot
last index off comma all right now if
this user answer is equal to we have the
data option data a parameter and if you
look at what we are going to get this is
the property that contains the answer
from the DB so I'm going to compare that
with data dot answer text if they match
the user answer and the answer that we
got from the DB let's quickly alert the
message saying correct answer else let's
display
wrong answer so let's go ahead and run
this one more time and look at that at
the moment it's definitely wrong answer
so when I click check on so look at that
it says wrong answer and now let's go
ahead and order this correctly so
Washington DC and for India it is New
Delhi UK London Australia Canberra so
now when we click it we get correct
answer if it changed the order wrong
answer so it's working as expected but
that's not what we want instead of
displaying the alert what we want to do
is change the background color of all
these list items to green when it's
correct or to red when it is wrong and
to do that I'm going to create two more
classes on our page so here let's go
ahead and create a class correct answer
and all we are going to do here has
changed the background color to green
and font color to white okay
and similarly let's create another class
for wrong answer
so what do we want to do we want to
apply these classes depending on whether
it's correct or wrong so let's copy the
class name from here and within our code
when the answer is correct just a piece
of code that's executed so what we want
to do is find the we want to find the
selector find all the list items within
answer options are not at list and add
class and what's the name of the class
correct answer okay similarly if the
wrong answer we want to add wrong answer
all right so let's say we're changes
reload this page and look at this now
when we check answer saying it's correct
it's actually applying the wrong answer
so we should be applying this class so
let's look at what we have here so here
for run answer we have to change the
background color to red okay all right
now look at this when we click check
answer it's the wrong order so the
background color is red now let's go
ahead and reorder them correctly now
when we click check answer look at that
it still doesn't work and that is
possibly because we have applied both
the classes already look at that now
let's order this properly so Washington
DC New Delhi check answer green it works
now let's change the order check answer
it applies wrong answer right now
correct answer both the classes now now
when I you know both the classes are
already applied now let's correct it so
now it's correct order but when I click
check answer it doesn't change the color
again why is that that's because these
two classes wrong arms and
Hansa these are already applied if
they're already applied if you try to
apply again nothing happens so to fix
this what you need to do is if the
answer is right now what we want to do
is if so if the answer is right and if
wrong answer class is already present we
want to remove that and then add correct
answer class similarly the answer is
wrong we want to remove correct answer
class and add a wrong answer class so
this is going to fix that so let's
change this to remove class so we want
to remove correct answer class and add
wrong answer so let's see if these
changes now reload this page and look at
this let's order them correctly so they
are lined up correctly now check-ins are
green now if we change the order red if
we've put it back to the right order
now green and red
let's change red okay so now it works as
expected another thing that I want to do
here is look at this as we are dragging
it now we know that it's a wrong answer
and when I'm dragging and until I click
this check answer button the color is
not going to change what we want to do
is if I want to you know reorder them
again and if I start to reorder them
then immediately as soon as I start to
drag the first element what I want to do
is put its color back to its original
color that is you know gray color okay
so to do that I'm going to handle the
start event of the sortable widget so
start event this will be triggered as
soon as we start dragging and when that
even is raised we want to handle that so
this is the function that gets called so
what do we want to do when we start to
drag if we want to remove both of these
classes you know wrong answer and
correct answer so again we have
to find all the list items within the
answer options are not at list and
remove class we want to remove both the
classes what are they
correct answer and wrong answer right so
let's see what changes reload this page
and look at this it's a wrong answer and
the moment I start to drag you to that
it reverted to its original color okay
all right
thank you for listening and have a great
day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>