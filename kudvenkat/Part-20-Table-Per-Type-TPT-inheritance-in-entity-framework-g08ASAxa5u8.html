<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 20   Table Per Type TPT inheritance in entity framework | Coder Coacher - Coaching Coders</title><meta content="Part 20   Table Per Type TPT inheritance in entity framework - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 20   Table Per Type TPT inheritance in entity framework</b></h2><h5 class="post__date">2014-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/g08ASAxa5u8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part 20 of entity framework
tutorial in this video we'll discuss
implementing table pair type inheritance
and entity framework with the database
first approach in parts 18 and 19 of the
entity framework tutorial we discussed
how inheritance hierarchy can be
represented using table pet hierarchy
with the TPH one database table is used
to store data of all of the entities in
the entire inheritance hierarchy the
downside of this is that we have a
denormalized table and some columns will
have null values depending on the type
of the derived entity being saved to the
database table if you recollect from
parts 18 and 19 of this video series
these are the three entities that we
worked with so notice that here we have
the base employee entity and then
permanent employee and contract employee
both of them derive from the space
employee entity type now when we are
storing this permanent employee entity
data you know permanent employee will
have values for annual salary column but
not for hourly pay and hours work column
so both of those columns will be null
when we save a permanent employee entity
similarly when we store contract
employee entity contract employee will
have values for hourly pay and hours
work but not for annual salary so
depending on the type of entity that we
are storing to this employee's table
some columns from 0 have null values
because this employee's table here is a
denormalized at table in TPT inheritance
that is in table pet type inheritance
one database table pair type is used to
store data of the entities in the
inheritance hierarchy notice that here
we have the same three entities and on
the left-hand side to store the data of
these three entities we have got three
tables that is one table pair type in
this inheritance hierarchy so to store
the data of the employee entity we have
got employees table similarly to store
the data of permanent employee entity
we've got permanent employees table and
for contract employee entity contract
employees table if you look at the
relationship between these three tables
employee ID is the primary
he column with an employee's table and
within permanent employees and contract
employees employee ID is the foreign key
column now when B is to permanent
employee entity to the database tables
now the data of the permanent employee
is going to go into these two tables
permanent employee will derive ID first
name last name gender properties from
the base type so the values of those
properties is going to go into employees
table whereas annual salary property
value will go into permanent employees
table with employee ID column being the
link between these two tables and
similarly when we store contract
employee entity you know ID first name
last name gender property values will go
into the employees table and hourly pay
and hours work property values will go
into contract employee employee's table
with employee ID column being the link
between both of these two tables let's
look at this in action the first step
here is to obviously create these three
tables which I have already done here is
the sequel script that can do it I'll
have the script available on my blog in
case you need it now let's flip to
Visual Studio here I have an empty
asp.net web application project let's go
ahead and add a new item to this project
and the item we want to add is a Tod
identity model let's call this employee
model and we want to generate the model
from the database so select that option
click Next and let's keep this
connection string a meaningful name
let's call this employee DB context
click Next this is going to connect to
the database and retrieve all the tables
views and show procedures and we are
interested in these three tables let's
give this model a meaningful name space
let's call this employee model this is
going to generate the entities for the
three database tables now the
interesting thing to notice here is that
between the entities instead of an
inheritance Association you know there
is a foreign key Association okay that's
because if you look at the tables within
the database here
you know they have a primary key foreign
key relationship and entity framework by
default is going to generate that
association between the entities and
also notice that this employee entity
has got to navigation properties that is
contract employee and permanent employee
navigation properties so contract
employee navigation property allow us to
navigate from employee to contract
employee
similarly permanent employee navigation
property allows us to navigate from
employee to permanent employee now we
don't want you know a foreign key
association between the entities instead
we want an inheritance relationship so
to achieve that the first step here
let's go ahead and delete this foreign
key Association now look at this when we
delete this Association you know it will
automatically remove the navigation
property as well okay so let's go ahead
and delete that look at that as soon as
we deleted that the navigation property
is gone similarly when we delete this
Association the other navigation
property is gone now let's go ahead and
add an inheritance relationship
so select inheritance here and here the
base entity is going to be employee
entity and the derived entity is going
to be contract employee so when we click
OK
that should establish an inheritance
association between employee and
contract employee now look at this this
little arrow here indicates that this
contract employee is deriving from
employee entity okay similarly let's add
the inheritance relationship between a
permanent employee and employee so again
the base entity will be employee and the
derived entity will be permanent
employee all right so now if you look at
another diagram here both contract
employee and permanent employee are
deriving from the employee base entity
okay now since employee entity is going
to the base entity for these two entity
types here you know we don't really need
to have employee ID property again both
in contract employee and perm
why because since both of these entities
are deriving from employee entity they
will have employee ID property available
through inheritance so we can get rid of
this employee ID property from both of
these entities now let's validate the
model just to make sure it is valid so
notice that it says validation completed
now let's add a verb form to this
project we'll look at how to query this
you know model now for that purpose we
are going to design a web form that
looks like this so let's go ahead and
first set style attribute here let's set
font family to Arial and let's drag and
drop a radio button list control onto
the waveform and radio button list is a
collection of list items so let's add a
list item let's set text equals all
employees and let's say value equals o
similarly we need to add radio buttons
for loading permanent employees and
contract employees just like this and to
speed things up I have already typed
they require the HTML so let's copy and
paste it right there so here we have a
list item tulo permanent employees and a
list item you know basically to load
contract employees the next step is to
include a grid we control so let's drag
and drop a grid we control and let's
actually flip this to the design mode
and auto format this grid we control and
let's set auto post back for the radio
button list to true so that it will
automatically post back when the
selection changes and to speed things up
I have already implemented the code so
I'm going to copy this code and paste it
within the radio button list selected
index change
now we discussed this code this exact
same code in parts 18 and 19th of this
video series so if you want an
explanation of this code please watch
that video now when we go ahead and run
this code we should get the interface
that we have seen on the slides so when
we say all employees it should load all
the employees okay notice that we have
all the employees here and when we
select load permanent employees it
should only load permanent employees and
we'll have involute contract employees
only contract employees now when we say
all employees here I notice that is
still showing only employee ID first and
last name gender you know columns that's
basically because we look at employee
entity that's what we have caught within
the employee entity so those are the
properties of the employee entity now
when we selected load all you know which
is the case of default we are storing
that the list of employees and if you
look at the employee entity they have
got only ID first name last name and
gender properties now if you also want
you know annual salary of early pay and
hours worked you know to be displayed on
the wave form then you will have to do
that you know maybe by using a data
table which we have seen again parts 18
and 19 of this video series so what I'm
going to do here is again to speed
things up I have a private function here
where we create a data table copy and
paste this function within the
code-behind file
and again if you look at this function
this is a straightforward function
first of all data table type is present
in systems or data namespace or let's
bring that in so this private function
right here it returns a data table now
what are we passing to this function
list of employee objects so we are
creating the data table here with all
the columns that we need ID first name
last name gender annual salary of alipio
verse worked and whether if it's a
permanent employee or contract employee
okay and what are we doing here we are
looping through each employee object in
the collection that gets passed to this
method and then we are populating ID
first name last name gender column
values and then we are checking is the
employee type permanent employ if that's
the case then retrieve the annual salary
property value and store it in the
annual salary column of the data row and
then if it's permanent employees to a
permanent as the value within the type
column of the data row if it's not a
permanent employee then retrieve values
for hourly pay and hours work stow in
the respective columns and then set the
type to contract and then add the row to
the data table finally return the data
table so we discuss this code in parts
18 and 19 or this video series and then
what we are going to do is if you know
load all employees radio button is
selected then we are going to pass this
employees list to this convert employees
for display function
and then it should display you know
hourly pay annual salary and others
worked as well so let's run this so when
we say all employees so it needs to get
data from three different tables that is
employees permanent employees and
contract employees so when we select
this radio button obviously all the
three tables have to be joined an entity
framework will write that join query for
us automatically let's actually fire up
sequel profiler and investigate those
queries let's run a new trace right so
let's clear the trace there and let's
actually reload this form so let's
select all employees and then permanent
employees contract employees let's go to
profiler stop it and look at this here
there's a big query but basically if you
look at this query it should join in all
the three tables that is employees
permanent employees and contract
employees okay and similarly if you look
at this query right here it should join
permanent employees and employees
because we are loading only permanent
employees and similarly if you look at
this query it should join employees and
contract employees that's it for today
thank you for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>