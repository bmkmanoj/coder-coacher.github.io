<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 25   Self hosting a wcf service in winforms application | Coder Coacher - Coaching Coders</title><meta content="Part 25   Self hosting a wcf service in winforms application - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 25   Self hosting a wcf service in winforms application</b></h2><h5 class="post__date">2014-02-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6L86eqUK_qs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">it's part 25 of wucf video series in
this video we'll discuss self hosting
AWC of service in a windows forms
application this is continuation to part
24 so please watch for 24 before
proceeding hosting a WCF service in a
windows forms application is very
similar to hosting it in a console
application we discussed hosting a WC of
service in their console application in
part 24 in this video we'll be working
with the same example that we worked
with in the previous session so we want
to design a windows form that looks like
this with a start and a stop button when
we click the start button we want the
service to start and when we click stop
button we want this service to stop so
first let's go ahead and design a form
that looks like this let's flip to
visual studio so this is the same
project that we worked with in the
previous session to this solution let's
go ahead and add a new windows forms
application so click windows and there
install installed templates windows
forms application and let's name the
project as Windows host click OK
so this should add a windows forms
application now we need to design the
user interface that looks like this so
let's go ahead drag-and-drop two button
controls and a label control so we want
two buttons and a label so here we have
the label button 1 and button 2 and
let's change the properties of button 1
first of all let's call let's set the
name of the button to be TN start and
then the text to
start along the same lines let's set the
name of button to - BTN stop and the
text on that - stop and let's delete
this default text within the label which
says label 1 and let's set the name of
label 1 to LV our message and then let's
also set font size to 10 points and
let's also turn this bold flag to true
alright so we are done designing the
form now in order to host the WCF
service first of all we need to add a
reference to the WCF service so let's go
ahead and do that within this windows
host project so right click on
references folder add a reference and we
want to add a reference to hello service
project which has our WCF service so add
that reference and then we also need to
add a reference to the WCF assembly
which is system dot service model so
let's go and add that as well
alright now when we click the start
button that's when we want the WCF
service to start ok and one more
important thing that we need to do is to
add the configuration file the
application configuration file which is
going to contain the configuration for
our WCF service so first of all we need
to add that application configuration
file so add new item and we want to add
application configuration file now here
we need to specify the configuration you
know the endpoints the base addresses
you know whether we want to exchange
metadata or not and if you remember we
have specified the configuration within
the apt or config file of the console
application in the previous session so
we are going to copy this conflict from
there to the app dot config file of our
windows host project alright
so we have the configuration as well
right now so let's get to the form
double click the start button to
generate the click event handler and
then now let's bring in system dot
service model namespace so at the class
level that is at the forum level let's
go ahead and create a private variable
of type service host this is the main
class that we basically use you know to
host our WCF service so let's call it
host and when we click the start button
let's create a new instance of this
service host and when we create a new
instance of the service host we need to
specify the type of service that we want
to host and it is nothing but hollow
service which is present in hollow
service namespace and what we want to do
we want to open the communication
channels so invoke the open method of
service host object okay so at this
point we have the service host open ok
and what else do we need to do now when
we click the start button you know the
service should start and automatically
the button should be disabled ok and
stop button should be enabled and we
want to display this message so we
started within the label control so
let's go and do that so BTN start enable
equals false and let's set button stop
enabled to true and within the label
control we want to say service started
okay now let's actually copy this code
and then paste it within the constructor
of this form one so what is this going
to do when we run the windows forms
application obviously this form one will
be loaded so when the constructor of
this form one is called
you know automatically the service is
going to start so whenever we run the
project you know even at that point of
time we want the service to start
automatically so we are calling the code
within the constructor which is going to
start the service by default when we run
the you know program all right
similarly when we stop when we click on
this top button what should happen we
should be able to stop the service and
to stop the service all you do is invoke
the close method which is going to close
the communication channels okay so once
the service is stopped what we need to
do need to enable start button and we
need to disable stop button and here
within the label they say service
stopped okay so very simple code here to
start and stop a WCF service and this
code you can find on you know the same
code here on the slide okay and then if
you notice the code here there's one
more even handler method called form one
underscore form close so when is this
event handler invoked whenever somebody
closes the cell windows service host
what we want to do in that case is you
know we want to close the communication
channels so we are going to invoke the
host or close so basically we are going
to have the same piece of code within
form one I mean basically form close the
event as well so let's go ahead and
generate the event handler for form
closed and in order to do that click on
the form anywhere and then get to the
properties of the form by pressing f4
and then click on this even's icon and
then there within the UNC you should see
form closed event okay double click on
the event so the event handler should
method should be automatically generated
and here what we are going to do
is copy and paste this code and then
since the application is closed we don't
really have to set the text in the label
control because nobody gets to see that
anyway so let's go and delete that
all right so we are done now let's set
our Windows host as the startup project
and then run this program by pressing
ctrl f5 so look at that it's a silly
started okay and look at that start
button is disabled stop button is
enabled now when we click stop it's a
service stop start the service so the
host itself is working as expected now
let's quickly test if the WCF service is
working as expected so in the previous
session we have also created a client
project which is called Windows client
ok so here the Windows service is
already running ok so let's go ahead and
run the client right now ok and let's
pass you know name as plugin click get
message this you know the WCF service
should respond and it should work in the
same way ok so look at that we get the
response back let's say hello protein 1
to get message we get the message back
ok now let's go to the service host and
stop this service ok so basically you
know it's taking a little bit of time
here to stop the service it's going to
gracefully stop the service if there are
any outstanding requests it's going to
service them and then stop gracefully
now let's go back to the client and then
click get message now obviously we will
get an exception
you know the socket connection was
aborted and if you look at the details
basically you know it should mention
somewhere the service this is not able
to handle the request it has refused it
ok that's basically because we have
stopped this service so let's go ahead
and start this service and click get
message and see what's going to happen
look at that we still get an exception
okay and why is that you know because
look at this the services started but we
still get an exception okay that's
basically because look at what it says
the communication object cannot be used
for communication because it is in a
faulted State so the client proxy has
actually been faulted let's actually
look at that you know by debugging so
here the service has started now let's
go ahead and run the Windows client in
debug mode and then put a breakpoint
right here within the button click event
okay now when we say let's bring in the
service host s1 so here we have the
service host and the client now
obviously when we pass name and then
click get message you know we are going
to get the response back so we have the
response back let's go and stop the
service so it takes a second to close
the service and then once the service is
dropped when we click get message we
will get an exception so here when we
press f5 we get an exception and that's
understood and that's basically because
you know the service has been stopped
okay let's close that that's actually
stopped debugging so let's start the
service now here what we need to do is
we need to check the state of the client
so if client dot state equals
communication state dot faulted okay if
it is faulted then what we want to do is
we want to create a new instance of the
client proxy because if the client proxy
is faulted you cannot use the same
instance of the proxy class for
communicating with your WCF service so
if it's in a faulted State we are
creating a new instance of the proxy and
let's also try I mean wrap all this
inside a try-catch block
so that if there is any exception we
will have a chance to display that
within the label control so let's catch
the exception and display that within
the label so label to the text equals e
dot message all right so with all these
changes let's go ahead
you know the services already running
let's go ahead and run our Windows
client the build errors let's look at
what other is a local variable named II
cannot be used okay
that's because we already have another
object the same name so let's call this
exception e X alright let's go and run
this once again okay so here the service
is running let's get to the client
actually let's disable this break points
so let's pass the name click get message
so it should work hello protein let's
stop the service now
it takes a second to stop the service
and let's not click get message look at
that we get an error okay and that's
because the service is stopped now let's
start this service and then let's click
this get message look at that now it
works as expected
ok so basically the previous time it
didn't work when we start stopped and
started the service that's because we
are using the same instance of the proxy
class to communicate with the WCF
service while it has already been
faulted ok so here what I'll be doing we
are checking the client state if it is
faulted create a new instance of the
proxy class which will then be used to
communicate with the WCF service alright
the advantages and disadvantages of
hosting a WCF service in a Bendel's
application is very much similar to you
know hosting the WCF service in a
console application not the only
difference between a console application
and windows forms application is that
within windows forms application you
have a graphical user interface
basically to start and stop your
services but the console application we
don't get that but in either cases do we
really use these forms of you know
hosting the WCF service in real world
now these are ideal for you know testing
your WC of services but not for your
production live WCF services in a later
video session we will see how to
actually host the WCF service in a
Windows service you know which is one of
the options for live WCF services and
the most common way today is actually
hosting the WCF services within iis
where we have in a Windows activation
services enabled we will discuss both of
these options in our upcoming videos
that's it for today thank you for
listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>