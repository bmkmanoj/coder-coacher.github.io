<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 3   How does a recursive CTE work | Coder Coacher - Coaching Coders</title><meta content="Part 3   How does a recursive CTE work - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 3   How does a recursive CTE work</b></h2><h5 class="post__date">2014-05-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/N3ChrpDRcXY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is part three of sequence of
interview questions and answers video
series in this video we'll discuss how a
recursive CT actually works by looking
at its execution line-by-line
in part two of this video series we have
written a recursive CT to get the
organization hierarchy based on the
employee ID that is passed to the
recursive CTA after watching this video
a lot of you have asked me to record a
video explaining how this recursive CTE
actually works
hence this video will be using the same
examples that we used in part two so
please watch part two before proceeding
so if you recollect from the previous
video session this is the employee's
table now when we execute the recursive
CT passing in David's employee ID to the
recursive CTE this what is the output
that's produced so if you look at
David's position within the organization
this is where he is in the hierarchy
so David reports to TomTom reports to
Steve Steve reports then Ben doesn't
have a manager he's the super boss so
when we pause at David's employee ID to
the recursive CT it produces this output
so here we have got employee name and
their respective manager name so for
david manager is Tom for Tom Steve for
Steve ban bunnies or super boss hence
this text no boss is displayed and to
produce this output this is the
recursive CDE that we have written in
part two of this video series and notice
that we are passing employee 87 employee
87 is David's employee ID okay so let's
understand how this recursive city is
able to produce the output that we have
seen on the previous slide now the first
thing that we have to notice is that
recursive CDE has got two members the
first one is called the anchor member
and the second one right here it's
called the recursive member so the way
this CD actually executes is you know
first the anchor parts get executed and
obviously once this anchor part is
executed it produces a result set so
let's say it's our zero now that result
set is passed as input to the recursive
member
obviously this requires your member is
going to generate another result set so
let's call that result set you know
maybe r1 now that result set will then
be used as input again to the recursive
member and it's going to produce resulta
R 2 and similarly r2 will be used as
again the input for the recursive member
and it's going to produce result R 3 so
it goes on until the output of the this
recursive member becomes now so once the
output has become null at that point all
the result sets on all the results as
Union all operator is applied and it is
going to produce the final output
so let's actually look at that in
execution line by line so let's flip to
sequence or management studio so first
let's look at the table so select star
from employees this is the same table
that you have seen on the slide ok so
and here is our recursive CD that we
have written in the previous video
series and notice that we are passing in
David's employee ID that is employee ID
7 so we discussed that first the anchor
part gets executed so instead of using
that variable I'm going to hard-code the
value so let's execute this anchor part
so we are going to get an output so
let's copy this output you know along
with the headers and then paste that
within this excel sheet so we have
employee ID employee name manager ID ok
so first the anchor part is executed and
then you know obviously it has produced
it is upset let's call it R 0 so that's
the result set and that result set will
now be used as the input for this
recursive member ok so here notice that
we are joining this the employee CTE ok
so now the CTE contain this result set
so instead of this joint let's actually
get rid of that and then use a ver class
here
okay so this employee CD at the moment
it contains this result set and that is
going to act as the input for this
recursive member so we are going to say
employees dot employee ID equals in
employee CD what do we have we have this
result set and we want the manager ad
column value and manager ID column value
is four so let's copy that and paste it
right here so now this recursive member
will be executed with you know our 0 the
output that we have caught off the
executing anchor part okay as the input
for the recursive member so let's
execute that so we get this output so
let's copy these this row and then paste
it right there okay now again this will
be used as the input for the recursive
member again so now the manager ID is
three so that gets passed down to the
recursive member let's execute that so
we get that output copy that and then
let's paste that in the excel sheet and
now manager ID is eight that gets passed
down to the liquor receive member and it
gets executed again and we get this
output now look at that manager ID has
become now and that gets passed you know
null as the value for this query and
obviously we don't get any output from
the recursive member so that's when the
recursion ends so once the recursion has
ended Union all operator is applied on
all the result sets that are produced so
far and we get this output okay but then
if you look at this let's actually undo
whatever we have done so far okay
so now when we actually execute this CD
so we are passing employee 87 so we get
this output employee name manager name
we
not getting this hot butt so basically
this is what is the CT finally going to
produce so basically this CT right here
that is the recursive CTE okay so this
CT is going to produce this output and
we can actually prove that by commenting
all these lines and then simply
selecting everything from employee CD so
let's execute that part notice that the
output that you see here and the output
that we have within the excel sheet are
the same okay so this explains how the
recursive CTE works and if you are
wondering how did we get this output
that straightforward okay so once we
have this employee CD this query right
here is joining the employee CD with
itself so that's a different concept
altogether that's simple self join there
just like how we do a self join on
tables here we are doing a self join
using the employee CT okay but basically
the idea here is to explain how a
recursive CT works and I hope you know
this video has been clear in explaining
you know how the recursive CT actually
works in case if you still have got
questions please leave them as comments
and then I will try and answer them as
soon as I can
alright that's it for today thank you
for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>