<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Calling a stored procedure with output parameters   Part 7 | Coder Coacher - Coaching Coders</title><meta content="Calling a stored procedure with output parameters   Part 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/kudvenkat/">kudvenkat</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Calling a stored procedure with output parameters   Part 7</b></h2><h5 class="post__date">2012-10-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/stIWeAcO45Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello welcome to prism technologies I am
Venky this is part 7 of ATO dotnet video
series in this session we'll learn about
calling a stored procedure with output
parameters in an asp.net web application
before continuing with the session I
strongly recommend to watch part 7 8 and
19 of sequel server and part 6 of video
dotnet video series to make it easier
for you to find these video series I'm
going to add the YouTube playlist URLs
of these video series you know to the
description of this video alright so
what we are going to do as part of
calling a stored procedure with output
parameters
look at this we'll base our example on
this table TBL employees table which has
got the employee ID name gender and
salary columns in this table employee ID
is an eidetic identity column which
means when we insert a row into this
table we don't have to supply a value
for that employee ID column and then we
are going to design an asp.net web
application you know which looks similar
to this one that you can see on the
slide there is a webform which has got
employee employee name gender and salary
call you know fields now we enter
employee name gender and salary and when
we click Submit you know we need to add
this employee to this table ok now
obviously to do that we need to write a
stored procedure which our asp.net web
application can call so the stored
procedure looks like this
ok so let's start a step by step from
creating the table to creating the
stored procedure and then designing this
webform and actually writing code so
first let's create this table so let's
flip to sequel server management studio
so I have the script here already
create table TBL employees and then we
have got employee ID name gender and
salary employee ID is the identity
column that's important to keep in mind
so let's create this table execute
command completed successfully we have
created the table and sample database so
if you refresh sample database you
should see the table there so we see the
table now we want to insert some sample
data into that table so I have these
insert queries here and if you
the insert query we are only supplying
values for the name gender and salary
columns we are not supplying the value
for employee ID column why because
that's an identity column and we don't
have to supply a value for that when we
insert a row so let's execute these
inside queries and insert the sample
data
all right queries completed successfully
let's select and see if we have the data
from the table all right so we have some
sample data to work with
now let's create a stored procedure
that's capable of inserting a row into a
table now if you look at this stored
procedure it's very simple and if you
look at the body of the stored procedure
all it has got is two lines of code and
in addition to that there are four
parameters that the stored procedure is
accepting now if we have to insert a row
into a table into this table
specifically TBL employee employees
table there are four columns within that
so we have to supply the values for
those columns except for the employee ID
because that's an identity column so we
need to supply value for name gender and
salary columns so we are supplying those
values using these parameters name
gender and salary and then if you look
at the employee ID this is also
specified as a parameter but note that
it's an output parameter so essentially
we are creating here a stored procedure
with three input parameters which will
be used as values for the respective
columns name salary and gender and then
employee ID is an output parameter
because when we insert a row into this
table name gender and salary column
values are supplied and the employee ID
column is auto-generated because that's
an identity column okay so as soon as we
insert this execute this statement a row
gets inserted the value for the employee
ID column is auto-generated and if we
want to retrieve the value for employee
ID column look at this we are using this
cope identity function okay which
generates the last identity column value
in fact we have spoken about this n
part 8 of sequel server how to get the
last generated identity column that's
why I told you please watch part 7 8 and
19 of sequel server and part 6 of video
dotnet video series before continuing
with this session if you haven't already
done so ok so if you look at this this
is a very simple stored procedure which
has got just two lines of code in that
one line inserts the row into the TBL
employees table using the input
parameters and the other row actually
selects the identity column value that
is generated now let's go ahead and test
the stored procedure so to test this
since we have an output you know since
we need to pass four parameters let's
pass them so first let's create a
variable declared at EMP ID that's going
to be of type integer now we want to
execute the stored procedure SP add
employee copy that and now if you look
at this it has got three four parameters
so name let's say George and gender is
male and let's say his salary is 7600
okay and we have passed in three
parameters but if you look at this this
stored procedure is also expecting
employee ID parameter so I'm going to
pass this employee ID parameter since
this is an output parameter you also
have to specify the out keyword so when
we execute the stored procedure what's
going to happen it will insert the row
with these values into this table and
the last generated identity column value
will be stored into this variable that
we are passing in as a parameter so what
you can then do is print the employee ID
and to print we use the print statement
so employee ID is equal to now the
employee ID is going to be present in
this variable so the employee ID now
employee ID is an integer data type the
data type of it that is integer and we
are concatenate in that with string so
we need to cast that to be of type
string and to do that we can use the
caste function so cast employee ID
and we're off - okay so now when we
execute this before we execute that
let's select star from TBL employees to
see how many rows we have there we have
got six rows now so when we insert a new
row into this table what's going to
happen and if we get a new row with
employee ID seven and that employee ID
should be printed here so let's quickly
check that plus f5 could not find the
stores here so obviously we have to
first create the stored procedure we
haven't created that so let's create the
stored procedure execute command
completed successfully
if you refresh the program abilities and
stored procedures folder you should see
SP add employee there
so now let's execute this look at that
one row affected and then employee ID is
equal to seven so we are able to test
our stories here it's returning the
output parameter as expected now let's
turn our attention to calling the stored
procedure from an asp.net web
application okay so let's flip to visual
studio so I have a webform here we just
got you know these fields employee ID
gender salary and if you look at this
it's pretty simple all we have here is
couple of text boxes a drop-down list a
button control and the label to display
the employee ID after we call the stored
procedure and if you look at the HTML
it's again pretty simple I have this
HTML table created to properly you know
align the no label names and the textbox
names now I'm going to make this HTML
available as part of they you know in my
blog so that you can actually copy paste
that it's pretty simple you know just
this is the hard coded text and this is
a text box this is hard coded text and
this a drop-down list and if you look at
the drop-down list I have included male
and female list items there and then we
have the text box which can collect I
know
salary and finally a button so button
and then at last we have a label which
displays the message okay so now when we
double click this the email
handler for the button click event is
generated now we need to write the ad or
dot net code to execute this stored
procedure SP add employee and then that
stored procedure is going to return an
output parameter we are going to harvest
the value from that and then display
that employee ID that is generated okay
so obviously if we want to write any of
the area dot net code that has to
interact with sequel server we used to
use a namespace system dot data dot
sequel client so system load data dot
sequel client and we want to read the
connection string from web config file
so if you look at this the database
connection string is within web config
file I need to read that so I'm going to
use system configuration namespace ok so
firstly let's read the connection string
so connection string is equal to
configuration manager dot connection
strings off the name of the connection
string and if you look at that in the
web config it's all DB CS database
connection string dot connection string
and now we need to create the sequel
connection object it's better to create
the sequel connection object using the
using statement because this will
automatically close the connection for
us we don't have to close the connection
explicitly so sequel connection con is
equal to new sequel connection and we
need to pass in the connection string
parameter all right so we created the
connection the next step is to create
the sequel command object so let's
create the sequel command sequel command
CMD is equal to new sequel command and
this constructor of the sequel command
class is going to take two parameters
the command text that we want to execute
and the connection object it will use to
execute that command the command that we
want to execute is the stored procedure
SP add employee so we are going to pass
that as a string and then the connection
on which we want to execute this command
ok now the most important thing that we
have to tell to the command object is
that it's going to execute a stored
procedure and not an ad-hoc sequel
statement and how do we tell that we use
the command
type you know property of the command
object so command or command type is
equal to there is an c-sharp enumerator
command type in am which we can use to
specify that so the command type is
stored procedure and the next thing that
we'll have to do is if you look at the
stored procedure it's expecting four
parameters okay
so we need to specify all those
parameters and to do that command dot we
can use the parameters collection
property of the command object dot add
and we can make use of add with value
method which expects the name of the
parameter and the value itself for that
parameter so the name of the first
parameter is the name at name so I'm
going to copy that
so at name and the next thing we have to
supply the value for that parameter so
various name coming from name is coming
from this textbox and if you look at the
ID of that particular text box it's
called as txt employee name so I'm going
to say txt employee name dot text so
that's one parameter the name parameter
similarly dilip in Wanda gender and
salary parameters so the next parameter
is the gender parameter so let's copy
that let's go back to visual studio
paste that there copy gender
and gender is coming from the drop-down
list so let's call DDL let's find out
the ID of the drop-down list that s DDL
gender so DDL gender dot b1 the selected
value so we select the select we use
that property to retrieve the value that
the user has selected and the final
parameter is the salary parameter so
let's copy that salary and salary is
coming from
txt salary textbox okay so we have
supplied all the input parameters to the
command object the next thing that we
have to do is to also pass the output
parameter which is the employee ID and
to pass the output parameter it's
slightly different because for an output
parameter we don't really pass a value
we are going to get a value back so but
you still need to specify the name of
the parameter and the direction and the
datatype let's see what we mean by that
so in order to create look at this if I
have to associate a parameter to the
command object there are actually
several ways one way is to use this add
with value method which we have just
seen and other ways to simply use the
Sadd method and if you look at what this
add method is expecting again using this
add method there are several ways we are
going to use you know one of the
overloads where it's expecting a sequel
parameter object so if we want to add a
parameter to the command object you know
one way is to use the Sadd method where
we actually pass in a sequel parameter
object so first we need to create a
sequel parameter object so let's create
the sequel parameter object sequel
parameter let's call this output
parameter is equal to new sequel
parameter and if you look at this object
this object has got the sequel parameter
object has got several properties for
that the first thing is obviously we
need to specify the parameter name and
if you look at the name of the parameter
it's employee ID so let's copy that
that's the name of the parameter
and the next important property for an
output parameter that you have to
specify is the data type the sequel data
type in sequel server what's the data
type of this parameter integer so we
have to specify that so output parameter
dot sequel DB type is equal to sequel DB
type dot integer so the data type of
this output parameter is integer and the
next most important thing that we need
to specify is the type of the parameter
by default when you add a parameter to
the parameters collection of the command
object is going to be an input parameter
so if you want the parameter to behave
as an output parameter then you will
have to specify the direction is it the
input or output or both this employee ID
is going to be an output parameter so I
am going to specify output parameter dot
Direction is equal to system load data
dot parameter Direction dot output so
these are the three important things for
an output parameter that we need to
specify parameter name data type and the
direction and then we need to associate
this parameter with the command object
and to do that command or parameters dot
add I'm using the add method instead of
add with value because I have created a
sequel parameter object which can be
passed in as a parameter to this add
method so let me copy that and add that
there all right so we have associated
all the parameters that this command
object requires now all we have to do is
to open the connection and execute the
command so to open the connection
connection dot open and execute the
command command dot now sit this is an
insert statement so we use execute non
query so command dot execute non query
and then so we have inserted the row but
then if you remember we are calling the
stored procedure SP add employee and
this stored procedure is returning an
output parameter so we want to harvest
the value of this output parameter which
will be received into this output
parameter objects
okay so if we want to retrieve the value
you know then we can use that output
parameter object so output parameter dot
value so if you look at this there is a
value property which returns that you
know output parameter value for us so
I'm going to use that property and if
you look at this this is an integer type
but then I'm going to use string EMP ID
I'll tell you why I'm using string in
just a bit because I'm going to set the
employee ID as the text to a label so
I'm just going to convert that to string
and one more important thing to notice
here look at the value property of the
output parameter object it's of type
object okay so we need to typecast that
to string because we want to convert
that to string so dot to string okay so
we have the employee ID now all we have
to do is we have a label control that
can be used to display the generated
employee ID column value so the ID of
the label is LBL message so let's set
the text for that LBL message so LBL
message dot text is equal to we can
simply say employee ID is equal to M PI
D so here I am I'm actually concatenated
I'm concatenated this one you know to
the text property of the labor that's
why I connect converted that to string
initially rather than to an integer we
know that employee ID is an integer but
since I want to you know append that to
another lit you know hard-coded string
you know I need to convert that later to
string again so I thought I will do the
conversion first so that it will save us
one step so employee ID is equal to
whatever is the employee ID that we get
back using this output parameter so now
if we save everything run the
application we should get the form where
we can enter the employee name their
gender salary and then as soon as
click the submit button I know the rows
should be inserted into the sequel
server and then whatever the employee ID
is generated that should be returned
back and printed in the label so let's
say Sanne is the name of the employee
female and then salary let's say three
thousand five hundred and seventy so if
you look at the number of rules that we
have caught in sequel server at the
moment there are seven rows so now when
we click Submit it should insert a new
row and we should get the employee IDs
eight so employee ID is equal to eight
and if you check that in the database we
should have a new record that employee
ID is equal to eight so this
demonstrates to us how to call a stored
procedure that returns an output
parameter in an asp.net application on
this slide you can find resources for
asp.net c-sharp and sequel server
interview questions that's it for today
thank you for listening have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>