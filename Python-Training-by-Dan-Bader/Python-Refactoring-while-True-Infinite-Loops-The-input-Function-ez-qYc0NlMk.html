<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Refactoring: &quot;while True&quot; Infinite Loops &amp; The &quot;input&quot; Function | Coder Coacher - Coaching Coders</title><meta content="Python Refactoring: &quot;while True&quot; Infinite Loops &amp; The &quot;input&quot; Function - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Python-Training-by-Dan-Bader/">Python Training by Dan Bader</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Refactoring: &quot;while True&quot; Infinite Loops &amp; The &quot;input&quot; Function</b></h2><h5 class="post__date">2017-06-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ez-qYc0NlMk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone it's Dan in this video
we're going to take a look at some code
that I was sent by a reader over Twitter
so Michael sent me this piece of code
and he was asking for some feedback so
first of all let's take a quick look at
this get answer function that Michael
sent me so we can figure out what it's
doing what it's supposed to do and then
we can dive into some of the questions
that Michael had and do a bit of
refactoring right so if you're wondering
what I'm using here I'm trying out the
spiffy new IDE called Sawney which is I
guess like a wordplay on Python e or
something like it's kind of cute it's a
really good IDE for learning I think
it's not really a full-blown Python
editing environment like PyCharm
or you know the sublime text setup that
I use but it's actually pretty great for
these little tests and trying things out
so it's kind of a trial run for me so if
this is helpful and you're enjoying this
video then just leave a quick comment
below I'd really appreciate it all right
so let's take a look at Michael's code
here now what do we have here so this is
a Python function called get answer and
it gets one parameter called prompt and
then in the first line here inside this
function we're using the built-in input
method or the built-in input function to
request user input so this is switches
to interactive mode and I have to do a
bunch of typing hit return and then we
get the result of that you know what I
type in we get the result of that stored
into this answer variable and then we
have a bunch of comments that we're
going to take a look at really soon and
below that we have a while loop that
compares the answer that we got earlier
to the strings yes and no and if the
answer is not either yes or no then
we're just going to ask the user again
and we're going to keep asking the user
forever essentially until they finally
type either yes or no and hit the return
key and then at the end of that we're
going to return that answer so if you're
looking for a real world application of
this function imagine you were writing
some kind of tool that could delete a
file on your hard drive and maybe you
want to get confirmation from the user
right like you want me to wipe your hard
drive
delete a bunch of stuff and that would
be really good time to ask them you know
to actually type in yes or no so I
imagine this could be the sort of
function that you'd be writing there
anyway so here's how you would use that
function in practice so here I'm calling
the get enter function and passing it a
prompt and then I'm printing out the
result so let's take a look at what this
does and right now okay so now you know
running this and when you look down here
I'm getting this question yes or no so
you know maybe I can just type maybe and
see what happens
that wasn't it yes or no well that
didn't work either so it's going to just
keep asking me for a yes or no answer
right so if I go go yes then this is the
returned answer that we're getting back
out of the function and if I type
anything else and it's just going to
keep asking me for the correct answer
essentially now Michael had some
questions on the best way to implement
this function and this is why I'm
recording this video because now
together we're going to refactor this
function to make it nice and Python so
Michael is trying to make his
implementation more pythonic and he had
thought about some other example
implementations here so for example the
first one was using a while loop and
then explicitly checking the answer
variable against yes or no so you can do
that of course but I really like the
other options that Michael had here
where he was using the in operator and
then the negation of that would be not
in version or you know by prepending the
the boolean not before that and
personally I really liked this
implementation here we're having the
while loop and we're checking it against
a tuple of strengths rather than a list
because constructing a tuple is going to
be a little bit faster and really you
can use a tuple every time when you
don't have a mutable object so we're
never going to make a change to this
tuple here because it's just a constant
that we use to compare against yes or no
right so I kind of like this what I
think could be improved about this
implementation is that we're duplicating
some of this code here so we look at
that we're pulling the answer out of the
input function and then we have
that same line of code down here again
and you know it's not terrible because
this is just a very small amount of code
but any kind of duplication in the long
run it means that you have to spend more
time and maintenance you have to spend
more time and cleaning things up
so personally I retry to avoid that so
what I would like to do here is actually
refactor it is so that we can get rid of
this duplication so what I'm going to do
here is I'm going to rename this
function I'm just going to call it get
answer original and then we're going to
start re-implementing the same answer
function so this I really like this
prompt thing is kind of cool and the way
we're going to start now is we're going
to start with an infinite loop so we're
going to do here is we're just going to
loop forever because really this is what
the function did before anyway right it
it in my mind did we make sense to ask
for an answer first and then check it
and then keep asking for an answer in a
different place really what we're doing
here is we're saying let's just keep
asking for the answer forever if it's
not the right answer we're going to keep
asking again and again and again this is
never going to stop and if you like
representing this structure with a loop
that goes on forever with this wild true
loop that's never going to exit unless
we manually break out of it is is better
it's better to represent that structure
very explicitly and it's going to allow
us to get rid off the duplication so
what we can do here now is we can read
in the answer this is pretty much the
same I'm just going to call the input
function again now reading in the answer
and so now at this point this is looping
forever right this will just keep asking
for an answer so when I run this you can
see here I can type whatever I want it's
never never going to let me out because
this is just an infinite loop so what
what we need to do is we need to have a
condition where we're terminating the
loop we're leaving the loop so what I
would probably do here is I would check
answer
against this list of valid strings right
so I probably do something like this and
I'm a fan of single quotes but that
doesn't really matter at all so just
feel free to ignore that use whatever
you like okay so if answer is either yes
or no then we're going to break the loop
by returning this answer and in any
other case we're going to keep on going
so if we try this out now we should get
the exact same result so if I go yes or
no maybe didn't really work
I go no exclamation point no didn't work
if I go no then we're jumping out so
this has the benefit that we don't have
this line here duplicated right we don't
have a duplicate call to input and I
think for that reason it is some it's a
more concise and cleaner implementation
and this is actually something like this
pattern here this is something you can
do every time when you're faced with a
situation like that right when you have
some setup code that is also part of the
looping thing that you want to do right
if you want to keep asking for an answer
like keep reading from a file then it's
usually better just to have a infinite
loop on top that represents that that
ongoing operation rather than reading
the first bit and then looping over all
of the remaining bits I like code or
processes implemented in code where
every single step if it's a repeating
process is implemented in the exact same
way there should be no difference from
reading the first bit compared to
reading all of the remaining bits right
and this is a way to get here if you can
use this pattern now there are actually
some smaller tweaks we can make to this
code here but this was certainly you
know the biggest structural one so let's
try and do some polishing here okay so
I'm running the script again and what
I'm going to do now is I'm going to give
a valid answer
dads are going to fail the test so one
way I can fail the test is by typing
space No
or if I put a bunch of spaces and go yes
or if I go yes and then a bunch of
spaces that won't qualify as a valid yes
or no I need to go explicitly yes or no
with no extra characters and this is
technically correct I guess but it makes
a little bit harder for the user to
interact with our program so a small
usability tweak we can make here is
calling the strip function so let me
show you what that does so the strip
function is built into the string object
in Python so I can go here and I can say
hello and you know that's just a string
so I could go hello dot strip and it
wouldn't really do anything
now what strip is going to do is it's
going to remove leading and trailing
whitespace so if I put a bunch of white
space here and called strip on it I get
the exact same string with the
whitespace removed so just so you
believe me if I don't do this then of
course Python is going to include the
whitespace in the string and we can take
advantage of this behavior here by
calling the strip function or the strip
method on this answer string that we've
got here so what we can do now is now
when I go maybe you know of course still
going to fail the test but now I can put
as many spaces as I want and it's going
to succeed now what you've seen here is
that we didn't return the stripped
answer so you can see down here that the
returned answer still included the the
extra whitespace now of course you know
I would be tempted to go answer dot
return answer dot strip here as well but
then we have a bunch of duplication
again so what we could do here is
actually move the strip call up there
get rid of it anywhere else and now if
we do if we run through the same example
then we get the nice and clean return
value that only includes the actual
string content now another small issue
I'm not sure if it's really an issue but
you know just wanted to point it out if
I go uppercase no or you know any
combination of that it doesn't work so
something else that we could do here is
we could not only strip the string but
also convert it to lowercase and in that
case we're going to get the expected
result where we kind of normalize the
user input before we try and process it
and that's generally a good idea now
this new implementation it actually
moves away quite a bit from the example
code that Michael sent me but you know
it's kind of staying in the spirit of
this this for factoring and what this
code is trying to achieve I think it
makes sense to make some of these
changes or actually make make all of
them so this would be my final
implementation and then yeah it can run
through this again
now this is pretty resilient right so of
course this isn't going to work because
the exclamation point is not like
whitespace and gets filtered out maybe
you could do that as an exercise right
to filter punctuation I could be
interesting and but now if I go you know
a bunch of spaces or any kind of weird
spelling here this get answer function
is going to process it correctly it's
going to clean up the user input and
it's going to give me the result that I
want it so now that we have our
refactored solution let's take a quick
look at how this code actually executes
and this is where sunny comes in so what
I can do here is I can debug this script
just click on this little bug icon here
and this will execute this Python code
step-by-step and for every single step
every single operation that takes place
we can take a look at what's actually
going on behind the scenes so let's take
a look at what happens inside this get
answer function
so here initially I'm just going to step
over this function definition and then
I'm going to use the step into
functionality to step into this code so
we can see what happens behind the
scenes I'm going to step into this line
a couple of times so now we've got the
print function and so python is parsing
that out then it meets the process the
function call for the get answer
function and it needs to construct the
string so it knows what to hand over to
get answer all right so now we've
processed the string and now we're
inside this get answer function and we
can also see down here that we have this
local variable you can see up there
called prompt that is the prompt that we
passed in previously so now we can step
into this this implementation for the
get answer function again with the same
keyboard shortcuts so now okay we're
parsing out the true well true is just a
constant true and we're entering the
while statement and now this is where it
gets a little bit more interesting so
again we're parsing out this line here
and Python figured out what the prompt
was it's passing the prompts to the
input function the first thing we need
to do here is to call input off yes or
no and then once we get a return value
we're going to strip it first and then
lower case it right so here now I've
stepped into the the input call and then
you can see down there in the shell now
that's where the interpreter is asking
me to put some input so now I can go you
know I can go up a bond I can go yes in
a bunch of spaces when I hit return
we're back in the debugger so now you
can see that tawny shows me exactly what
happened we got a return value from the
input call that was lowercase Y
uppercase e uppercase s and a bunch of
space so just this string here so now
Python can evaluate the rest of this
expression and first of all it's going
to do this bit here or it call strip on
this string so it's going to shorten the
string because it got rid of the extra
whitespace and next up we're going to
call lower and it's already shortened
string so this converted our string into
a lowercase yes which is the cleaned up
version the normalized version that we
were looking for and now we can we have
the answer right it's yes and now we can
compare that to our tuple so grabbing
the answer
and then we need to build that tuple so
yes just yes/no is just know and the
whole thing is a tuple and so now python
can evaluate this in expression by
checking if yes is inside the tuple yes
or no and of course it is so the result
of this expression is now true and now
that means we're stepping inside this if
statement here and we're returning the
answer object and the answer object in
this case is yes so now we're jumping
back all that remains is a call to the
print function and when that executes so
we get a return value of none we're done
with our program you can see here we
also printed out yes so this was step by
step what happened there behind the
scenes and again I think is a really
powerful feature in Boni and if you have
any trouble figuring out with some
Python code or a snippet of Python code
is doing behind the scenes
then a tool like fawni can be very very
helpful so yeah so these are the changes
that I would make to this function that
Michael sent me and if you want to see
the comparison again this was the
original
and then we got
application and we make the function
more resilient by adding the strip and
lower calls here to get rid of some
extra stuff at the beginning and at the
end of this input answer that we're
reading from the user alright so if you
like this video you want to get more
just like it then click the subscribe
button in the lower right there's also a
free Python course you can take on my
website just check out the description
and it will have to link
alright that's everything in the video
so happy pie filling and have a great
week</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>