<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Arduino With Helium Part 3: Sending Data to Helium - Peter Dalmaris | Coder Coacher - Coaching Coders</title><meta content="Arduino With Helium Part 3: Sending Data to Helium - Peter Dalmaris - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udemy-Tech/">Udemy Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Arduino With Helium Part 3: Sending Data to Helium - Peter Dalmaris</b></h2><h5 class="post__date">2018-03-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tEPUCDUE9i8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay let's continue where we left off in
the previous part of this lecture so
what we now have is our atom sending
data from the Arduino to the helium
Network you can see that the data is
coming in every five seconds and it ends
up in the request being URL that we were
provided earlier by requesting and all
the data says is hello he lives just on
a fixed string of characters what we'll
do now is to make a little modification
to our sketch to simulate data from
sensors being sent over to our request
them so on the left side I've got the
sketch that we saw earlier and on the
right side a slight modification of that
sketch have a look inside the loop
inside the loop in the previous sketch
we just had constant array of characters
with the payload hello helium and on the
right side I've replaced that with a
little bit of code that allows us to
send random data to the request bin so
I've commented out the Const car data
pointer to the character array
understood the first thing that I do in
line 42 is the create an array of cars
you can see that it's name is payload
underscore message and I've specified
its size as well as 20 characters I only
really need four characters for the size
of this character array since the in
line 46 the function analog read will
return no more than four characters up
to 1023 but we are going to be
populating the payload message character
array with a little bit more data in the
next example so I thought I'd just put a
20 here the key is to make sure that you
allow enough space
you character array to accommodate all
of the data that you want to send over
there it's okay to be a little bit more
but of course it's not okay to be a
little bit less I'm gonna come back
actually to the size of the character
array in the next part of this lecture
as well so in line for the tiers have
said we specify the character array that
will receive our data in line 46 we
acquire just a random reading from Ana
look him 0 with analog read and we store
that as an integer inside random data
and then in line 48 we use this print F
command this is AC command that allows
us to take a bit of data formatted data
and store it inside the payload
underscore message car array so we can
find out more information about Sprint
Earth if you follow this link here you
can find more information about printf
which has to do with the available
formatting instructions inside print
Earth by using this link here what I
mean by formatting instructions I mean
those percentage followed by another
character like it could be an eye and as
a day depending on what it is
this value will be formatted accordingly
so if you want to learn more about it
invite you to follow this link here
so what's printf is going to do just to
repeat this point it's going to take
this string of text it's gonna it
contains a bit of fixed text like data
with two dots here and then it's got a
formatting instruction this formatting
instruction will be replaced by text
depending on the value stored inside
random data or see this in action very
soon then finally in 5954 nothing
changes here it's the exact same
instruction in line 44 in the previous
original sketch the only thing that I've
changed
is to change the name of the character
array it used to be done and now when
you sketch is haloed message and string
lends another c function that returns
the size of this character array and
everything else is exactly the same the
name of the channel we're using the
configuration of the item and how it
interacts with the and do we know all
that is the same but let's upload the
sketch and see it in action all right
upload it to go to the Hylian dashboard
first so you see that was a there was a
little delay here and I'd say in the
next packet that's with the Y or the new
sketch was uploaded then here's a new
that are coming in and also notice have
a size of the little dot here changes
depending on how much and bytes we sent
a cross so we have to think about six or
seven bytes here with hello world it's a
slightly bigger dot now we are just
sending a little integer with a bit of
text so that it's slightly smaller as a
dot and if i refresh this page and we
can see that in the debug log we've got
the new dollar coming in let's do that
bigger there you go and I said I look at
the request pin and he will refresh the
page and there's the dollar few seconds
later five seconds later refresh again
here's my new daughter just random
values one more time there's your data
another random value so what we now have
is our atom with the Adreno sending
random values to how helium dashboard
and that being forwarded to our request
in great so now we can simulate real
data going across a sort of just a fixed
text which is not very useful
what I want to do in the next lecture is
to take this set up one step further so
I'm going to connect my photo typing
shield with a couple of sensors and an
LED on top of the helium and I'm going
to get real data from the sensors sent
over to the request bin as well and I am
also going to show you how we can send
configuration values from the helium
Network over to my device here so that
we can adjust the frequency by which my
setup here sent Donna to the healin
network so instead of sending data say
every five seconds I can remotely
over-the-air configure it to do so every
10 seconds or whatever value I like so
let's move on and do that next and the
previous part of this lecture I showed
you how to take random data from your
other you know and then transmit them
over to the ilium and networking through
the HTTP channel to forward it to our
request in so the request is still here
and still listening just remember that
eventually they of course in will expire
if you don't use it so then you're gonna
have to use a different year elk rate
and you request it eventually will
expire so I keep it alive by
occasionally refreshing this page and
sending new data from helium so what
we'll do in this part of the lecture is
to plug in my shield here that her
diving shield that contains the two
sensors so that instead of sending
random data over the helium Network we
actually send real data so start by
unplugging power from the Arduino and
then gonna use a little post-it note
here explained by so here is my product
prototyping shield on the bottom of got
all the wiring happening
and I've connected the data pin of the
dht22 to digital pin number 2 which is
this pin right here and then the BMP 180
is using as the a and SEL pins which are
this your painter sorry analog pins 4 &amp;amp;
5 on the Arduino so that's what these
are the wires do you can do this of
course on a breadboard you don't really
need to have a prototyping shield for
this experiment a mini bread court will
do just fine I wanted to leave this
aside collecting data for a long period
of time so they send it more more
reliable way to do so I have also wired
this led here to digital pin number 9
which is a PWM capable pin right there
so I'm gonna use this LED to indicate
when the helium is transmitting data to
the network so when the operation to get
the readings from the sensors and
transmit it to the heal it to the helium
network against this LED will turn on
and then when the operation ends it will
turned off so because of course some
soldering happening here and exposed
copper and there is not enough clearance
between the the helium adapter and the
prototyping shield to connect the two
without the exposed copper on the
prototyping shield touching on to the
antenna especially the antenna
connectors I'm going to use a loop
hosted node and hopefully this will
provide a little bit of insulation I
need to cut it to the appropriate size
just like that and they will provide a
bit of insulation so I can go ahead and
plug in the prototyping board into the
helium adapter there you go you know
it's ready
so go ahead and provide power to the
Arduino the original sketch is still
running so we should see the payload
arriving to the channel any second now
okay the first one right there so the
sketches I'll be using for this example
is this one here it's number is 2 3 4 8
and you can see it on the thing
exploration settings domesticating
serious I get hub account right here
scroll down to the repository
they repository at least and this is the
sketch that we are looking at right now
have a look at a documentation that are
providing and the nodes that help you
out with the setup then go back to the
Arduino IDE
and you know as I said earlier we can
use a breadboard to connect the senses
just like you've seen in previous
lectures in this course and in Adana
step-by-step getting started we have
already set up here then IDE with the
appropriate library so the helium helium
II 2 or yr v NP 0 85 for the HD sensors
or whatever other sensors you want to
plug in that does not need to do much
work here now in the line 86 and defined
the channel name of this HTTP ilium test
which is the channel we'll be using a
lot known in these examples the one that
we used for the helloworld program and
onwards later on I am going to switch
channels to my Hiroko web applications
we are just by redefining a channel name
and without making any other changes in
the rest of my circuits I'll explain
more about this in a come in a later
part of this lecture the for now you can
totally ignore line 87 and just know
that we'll be sending all our data to
the edge of helium
as the channel you can also safely
ignore lines 91 and 94
these are configurations and I'll show
you how we can update through the air
later on for now we're just going to
concentrate to grab the data from the
sensors and send the data over to our
request bin nothing changes here lines
96 99 101 we just set up their various
objects that see objects that we need in
order to send out that a three lines 105
and 106 is where we set up the sensors
you can also totally ignore the code
inside the update config function I'll
talk about it later
in setup nothing fancy happens we start
the communications with the helium
Network I will start our sensors with so
that the H there that be a BMP sensors
and we turn off the LED inside the loop
the beginning of the loop with him on
the LED because next we get readings
from the sensors the HD and the BMP
sensor I'll explain what is happening in
these mines in a minute I want to go
straight into sprint F first which you
recognize from the previous part of this
lecture they would be doing here is that
we put it together the strain that
eventually will be stored inside the
payload and the score message character
array and the string is formatted as per
the contents of this parameter inside
the double quotes so we've got
percentage s which accommodates strings
so this percentage s placeholder will be
replaced by the contents of the t
underscore result character array that
is going to be followed by a coma which
is followed by another string this is a
placeholder for the second string
component which is a content on the H
and this
or resolved character array H S stands
for humidity that is followed by another
comma which is followed by another
string that's a placeholder for the
third string which is the content of the
P underscore resolved character array
hey stands for pressure that is followed
by another comma and finally we've got
an integer here that's what percentage I
is place order for an integer which is
stored inside the location this call ID
is that this variable set I define now
these variables here the score is old H
underscore is old here the score is old
and occasionally they put together up
here so remember up here at the
beginning of the loop for example we
populate the H float variable with the
humidity from the DHD sensor we need to
convert this into characters into a
character array into a screen so that we
can pass it on to or is it down here and
pass it on to the channel underscore
cent function so in order to do this
conversion from floating point number to
a string we use the D to SDRF function
this is another C function so the
parameters that that expected by this
function is first the floating point
number that we want to convert and then
the last parameter we've got a character
array with sufficient space to store
this new string and we define that
character array here the underscore
result will make it six characters
interval size so basically it's five
characters plus we need a terminating
character at the end to indicate the end
of that string that we're saying that
this is going to be a total of five
characters that will put into this
character array of which the last two
characters are the floating point number
so I'll make a little note here so let's
say that the temperature is on the
thread point
ten so you can set it we've got one two
three four five characters we've got
five characters in here and that's what
is number five means - for the decimal
past a little dot point we've got one
two and that is what this number two
indicates and that's a way by which we
can format a floating point number into
a character array the exact same thing
here for the humidity value the exact
same thing here for the atmospheric
pressure value so we get our component
strings we use a sprint F function to
put all that nicely formatted with
comments inside the payload message then
we use channel underscore sent to send
this payload message to our channel but
then eventually it will appear in our
request thing when the transmission ends
will our content of the editage that
goes low and you can ignore the rest
from this point on which I'll explain it
later thanks for watching if you'd like
to learn more check out my adrenal
step-by-step getting started and other
in a step-by-step getting serious
courses on udemy there I'll help you
develop basic and more advanced Arduino
skills including how to write your own
programs how to use all sorts of sensors
and actuators and how to create your own
gadgets you may also be interested in my
project courses where you get deep into
the development of wheeled robots
remote-control cars and drones please
use the coupon code in the description
below this video to get a YouTube
exclusive discount to my courses see you
there
right so let's upload this sketch
and see the actual data from the center
for the census coming in
okay done uploading let's have a look at
our helium test channel and there's a
first data point
contains you can see the little dog is
bigger than the dogs that we saw earlier
we've got 19 points coming in and let's
go and have a look in the console of the
utter device to look at the debugging
log you can see here's a dog here's a
payload that is coming through so the
temperature recorded is 20 point 16
degrees centigrade humidity is fifty
four point ninety and let's see
atmospheric pressure in MIDI bass 9008
I'm 74 son like that
great what about the request bina
there's the daughter
so the raw body of the post request with
God the data from the sensors exactly as
we see them in the dashboard awesome now
the next thing that I want to show you
is how we can update through the air or
the air the frequency of the internal
with a transcendent any today off so the
moment is 5000 tell me the change today
that they've anything at all in the
location ID we can do that through the
air fairly easily without much fuss so
you can see here that the LED is
blinking at a frequency of around five
seconds indicating when the I dunno
gadget gets a reading from the sensors
and then transmits Ted reading to the
helium Network once that process
completes the LED turns off let's say
that I would like to
now change that frequency to ten seconds
without reprogramming the other just
changing available controls the delay
between cycles I'll show you how to do
that in the next part of this lecture in
the previous part of this lecture I
showed you how to send real sensor data
through the helium network to the
request thing but who do now is to show
the opposite direction of communication
from the helium Network to the Arduino
gadget with the Optum helium on it in
particular what this communication
involves is updating local variables on
the Arduino let me explain what I mean
by that let's come back to our
application and you can see that in the
application that is running right now on
the Adina the one that I showed you in
the previous part of this lecture we
have defined a couple of variables
32-bit variables
there's the send interval variable and
the location ID variable in this case
I've set a couple of values as a default
value for this D variable so there's
5,000 milliseconds or send interval and
just for number one for location ID what
I'd like to do is to be able to
over-the-air change those values
occasionally so with a send interval for
example let's say that I'm now happy
with how the gadget is operating and
instead of doing an update of the sensor
variables every five seconds I'll be
happy to just do this every one second
which imagine that if you are using say
3G or 4G cellular data connection could
conserve you or you can could conserve
some bandwidth and lower the cost of
communications in the case of this
environmental sensor gadget that's
really
to update its values every five seconds
it's a bit too much within 10 minutes
would be enough so how can we change the
update frequency without having to
reprogram the adrenal which means how
can we update the value of said interval
without having to reprogram the other
you know bringing back to base and
upload a new sketch and we can do that
by using the infrastructure
it comes with Henning Network so there
we are got configuration variables and
we can create as many as we like here
the idea is that the case that we
produce and we define here with their
value can be transmitted to a specific
item just by filling this form here and
clicking on the update config button so
let's have a look at how this works
first of course in the sketch we need to
create a local variable so there always
need to be 32-bit integers because
that's how these configuration variables
work so 32-bit integers we define the
variables that you want to update we can
give them a default value then we need
to add the config object so that's what
I do in line 101 so they can sorry we
need to add the config class I should
say better and create an object out of
it the config object it's what we are
going to be doing then is that we'll be
using this config object the first
detect is a configuration variable has
changed and therefore needs to be
fetched over from the network and stored
onto the Adreno and if that is so then
the config object will help us to read
the new values we see from and from the
network and to confirm that they have
been read so that's the addition here in
line 101 can do scroll down into the
setup function then and there's a new
line here line 144 in which we call
update config function I just called
through earlier this one here which
takes care of the configuration update I
just pass a true so that no matter
whether there is a new value or not in
the configuration variables defined in
the dashboard the other will still read
whatever they are you can call this
function as often as you like so here we
are in the loop can you scroll down to
the bottom of the loop so you can see
that here in line 235 we can have got
the same call to the update config
function but instead of saying true here
I'm just calling the is stale function
of the config object and this way the
update config code will only execute if
there is a change in the configuration
variables otherwise you will not do
anything there so this means that we can
update the configuration variables at
any time during the operation of the
Arduino and not only when it's starting
and it's going through the instructions
in the setup method so let's have a look
inside update config we're going to
update config right yeah so what is
happening in here is that once we got
past this if statement the first thing
to do is to call the get function of the
config object and ask for an updated
value for the config in table underscore
key I have a look at that that config
interval and the score key is defined up
here the contents of this key is this
config dot interval remember that that
interval underscore Ms is the key that I
defined here if I had to find another
kid like a test okay then you would need
to also create
a new definition here I call that
something else test configure same test
config then pretend that with the config
string with a dot then and then followed
by the name of the key as you specified
that in a dashboard right there then
give it a value 93 I'm gonna do that now
and then once you do that and it's up a
bit once you do that then you can call
the get function of the config method as
often as you like in order to find out
the latest value as defined in the
dashboard and if this doesn't work you
can fall back to the default value that
you can set in the throat in the third
parameter in this case 5000 now we can
report status error report status is a
function that comes with the library
think can go into the helium Arduino
repository continue the source code that
believe that is in here in the details
there you go report status that's what
it does make this a bit bigger so report
status and you can look at the
implementation Mississippi file and
report status just prints out some debug
information like that back to our sketch
I do the same thing for the location
okay remember I've got another variable
that I want to be able to update called
config location key and the name of the
key is location which is what I have
defined here they configuration
variables segment of the page so I'll
update available for that and store it
in this local location underscore ID
local variable for this a pointer points
to this memory location so that's where
the updated value for this key will be
stored and one is the fallback value so
if all that works out okay and the
values have been updated then what I do
is sum inside this book I call the set
function so the same function just
reports back the contents of the sent
interval and the location ID so that
will appear down here in the reported
configuration so you can see that
because I'm calling location ID second
especially sending the value of location
ID second what you see here in the table
and the reported configuration is the
current value of that key so since the
sketch is already running on the Arduino
let's demonstrate what happens when I
make a change to one of these config
variables gonna bring up the serial
monitor first
all right so you can see that right now
the variable is set did five thousand
five hundred milliseconds this is the
number that you see here then it changed
that to five thousand milliseconds and
click on update config and let's have a
look at what happens at the other end
few seconds later was not totally
instant but it's very quick that change
will picked up and a number will change
to five thousand to five thousand sorry
milliseconds
there you go fetching new configuration
updating configuration 5,000
milliseconds and now our LED blinks
every 5000 milliseconds instead of five
thousand five hundred milliseconds and I
can also change the location ID let's
say that you decided to take this gadget
from the current location and place it
to a different location and you wanted
to now be able to transmit its new
location ID to your application you
don't have to reprogram you are doing to
do that you can simply pick the
appropriate album from your dashboard
and change this to whatever number you
like to allocate to it it's a location
ID and update this configuration and
this change will be picked up
automatically by the Aten and you're a
dinner gadget will be reconfigured
there you go picked up a new
configuration now still saying 500
millisecond 5,000 milliseconds here
because I haven't used a print command
to show us a new location ID but you can
see it in the data that is coming
through the form any location ID equals
1 is an allocation ID equals 2 you can
do you can see that in the CSV we can
also see that the value reported here in
the reported configuration will be 2 I'm
just going to refresh the page and you
can see that now it's become another -
what about the request then to get the
latest from the request bin and there's
another to report it for the location ID
that we just changed great so that's
pretty cool I think now the last thing
that I want to do for this series of
lectures or the last part of this
lecture is to show you how we can
redirect this traffic from the request
bin into a very simple web application
that we wrote using Ruby and the Sinatra
framework which is running on the heroic
who hosts so let me show you how to do
that in the next part of this lecture
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>