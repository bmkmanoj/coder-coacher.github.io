<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unity AI:  Simulating Crowds Part 2  - Penny de Byl | Coder Coacher - Coaching Coders</title><meta content="Unity AI:  Simulating Crowds Part 2  - Penny de Byl - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udemy-Tech/">Udemy Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unity AI:  Simulating Crowds Part 2  - Penny de Byl</b></h2><h5 class="post__date">2018-03-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Yzt6pHkYWWg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">as I mentioned in the previous lecture
developing the AI for a crowd of NPCs is
far simpler than most people think this
is because from simple rules complex
behavior can develop and although we
aren't programming the so called brains
of the NPC's they still appear to move
with some level of intelligence in this
lecture we will explore crowds further
with a group of animated characters to
follow along download the street scenes
starter that comes with this lecture as
you'll see when you open up the scene
which is called crowd there's a group of
people in there and they're standing on
a plane if you go to your navigation
window you'll find that there's a nav
mesh that's already been baked in there
so we're not after a complex environment
at this point we're just after something
where people can walk around now each
character has been downloaded from
maximo and they've got an animation on
them already so if you select for
example this girl here girl 3 you'll
find that they have an animator
controller on them and I've set that
controller up for you so if you just
double-click to open up and have a look
what is in there you'll find they have
an idol and emotion a walking animation
and a running animation and these
animations are set up to trigger between
each other so I've created transitions
from idle to walking and then back again
and the same for all the other states
and then for each one for the
transitions
we've got triggers so we've got an is
running trigger and is walking trigger
and it is idle trigger and we'll be
controlling these and when they trigger
from some code the characters themselves
also have a nav mesh agent attached that
you'll find in the inspector and their
speed is set to 2 so in this case
they've only got animations that are
having them walk and just stand idle is
also a run as well so they're forward
moving animations there's no strafe set
set up because this
movement isn't particularly complex as
far as it's quite simple and they're
moving in a straight line when they do
animate forward and if you can
coordinate the speed of your nav mesh
agent with the speed that's in the
animation itself then it's fairly
believable and it's a lot simpler set up
for us and I guess I wanted to show you
a different way of doing this as well if
you don't want to go to the effort of
the complexity of setting up a strafe
set or you don't have the skills to
create all of those different animations
so the speed is set to two for all of
them now if we press play they all go
straight into their idle animation and
they're all synchronized so they look
like they're a flashmob at the moment
what we're going to do to begin with is
get them walking towards a goal the goal
we will determine by placing a cube into
the scene so go to the hierarchy and
right click and create a new cube and
then we'll just move that somewhere on
the navmesh so let's just put it over
here while are at it we'll create
another one as well so they can move
between locations so control D and then
move another cube back to this so
they'll kind of I guess move between
these two goals might rename these goal
so that we know what they are and you
can delete the renders on those as well
if you don't want to see them I'll also
get rid of their collision because we
don't want that interfering with
anything now in order to find the goals
we will tag them so go over to the
inspector and with the goal selected in
the tag you want to drop that down and
tag them as goal if you don't have goal
as a tag you'll have to add that and
then set it to goal now make sure you've
got spelling this is a lowercase goal
which was what we will reference in our
code we're now going to add some code to
control the movement of the characters
go to the assets folder and in there
you'll find an AI controls
script that I've included with this
starter file just open that up and have
a look now it should be pretty familiar
because we've done all these things
before
where first of all setting up an array
of goal locations which will be those
cubes and then we're also grabbing hold
of the nav mesh agent that is on our
characters at that point in the start
function we're going to get all of the
locations that are in the scene that
have the tag goal and that's why it's
important that you've got gold tagged
exactly the same spelling as this on
those cubes and you can add as many as
you like into the scene then what's
going to happen is that the agent is
grabbing hold of its nav mesh and then
the agent is having its destination set
to a random location in that array so
we're using a random range on the length
of the goal locations array just to
pluck one out and then getting hold of
its position which will then be the
agents destination right so save that
and we're going to attach that to each
of our characters so you can select them
all and then drag and drop the AI
control script onto them in the
inspector right now press play and
you'll be able to see the characters
picking a location to go to
so they randomly picking their location
and moving to it what you'll also notice
at this point is that they're staying in
the idle animation so if you want to
synchronize your animation with your
character's movement or whatever they're
doing you need to trigger one of those
transitions that I showed you before to
do that let's go back into the code and
we'll need to grab hold of the animator
component that's on our character just
like we had to grab hold of the agent
for the nav mesh so animator Anam then
in the start you'll also have to set it
up so an 'm equals
this dot getcomponent animator
and then at the start because they are
walking straight away we can trigger so
to do that we go Anand set trigger and
then in quotes the name of the trigger
so is walking and save that this here
has to be exactly the same spelling and
capitalization as the animator if we can
just find that here these values here so
is with a little I and W with a capital
now if you press play you'll find that
they go straight into the walking
animation and they'll choose a goal at
random to go to and walk over and then
walk around it because they're not told
to stop walking once they get there so
stop playing that now if you want
another goal you can just select your
goal from the hierarchy ctrl D to
duplicate it and then you can add
another one and they're already coded to
pick them at random so you'll find that
they've randomly not picked the new one
let's just press play again there we go
some people have now
now what we're going to do is when they
get to their random location we want
them to pick another random location and
go to that figuring out when you're at a
location and then pick in another
location to go to is very much the same
steps that we took when we were moving
the tank around and patrolling between
different way points so it's the same
kind of logic open up your code in the
update what we'll do is we'll test
whether we've reached to the destination
or if we're in a certain distance of the
destination our goal and then we'll pick
another one
so the code I'll just paste in here and
then go through it it says if the agent
remaining distance so the nav mesh agent
has this value called remaining distance
which is keeping track of how close the
agent is to the destination goal now if
the agent becomes less than 1 distance
away from the goal cube then it's going
to set another random location and the
setting of the random location this code
here is exactly the same code that we
picked the first random location with up
here so that's all the lines that you
need and if you save that and switch
back to natee and press play you'll now
find that the agents will get to a
location and then they'll turn around
and move somewhere else the turning of
the actual agent if we select one of
them that's moving you'll be able to see
if we go to the scene view that the nav
mesh agent code itself does all of the
turning for you previously when we were
working with the tank and turning it we
would have to perform a slip and then
push the tank forward so this is the nav
mesh doing all that for us so we just
keep the animation in forward walking
and it's going to react really nicely
for us without us doing any extra effort
now if you want to large a crowd then
you just have to select shift select all
of your characters and just ctrl D to
duplicate them and then you might just
want to move them away from each other a
little bit just like that and then if
you press play they're still going to
behave in the same way because they've
got the same code they're on the same
navmesh and they have the same set of
goals to select from with what we've got
and before we move on to the next
lecture what I want is to set this
street scene up so that the people are
moving up and down the sidewalk like you
would find in a city first of all I'm
just going to remove this goal because
we don't need that and I'll grab this
goal and put it up one end of the street
and this goal and put it at the other
end so they're just going to walk up and
down this part of the sidewalk now to
prevent them going in here
which is where you might have buildings
or something we can just simulate those
buildings with the cube so let's create
a cube and I'll bring that over here and
resize it
and when you've got something that
you're happy with you can select it go
over to the navigation window and we
want to make this a not walkable area so
under the object tab you can make it a
navigation static but in the navigation
area you can drop that down and say that
it's not walkable then when you go back
to bake its going to exclude this so
that when the people start to walk we
press play then they will be going up
and down the sidewalk and avoiding this
area here some of them actually escaped
and we might say around the edge so you
could just grab hold of this cube and
make it a lot wider so it fills up that
entire block and that will dissuade them
from taking the shortcut and getting
them all over here of course if you
started all your characters overhead and
they're not going to go all the way
around there
so with that resize if I just go bake
again and press play yep now they are
coming back over to that side and we
want them walking up and down here for
the next lecture in which we will add
some obstacle avoidance
thanks for watching please support the
development of more superb online
learning content by subscribing and as
always visit holistic 3d comm to learn
more about awesome games development
books and tutorials
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>