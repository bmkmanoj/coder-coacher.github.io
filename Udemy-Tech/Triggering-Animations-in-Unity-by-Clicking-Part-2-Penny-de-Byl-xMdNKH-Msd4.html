<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Triggering Animations in Unity by Clicking Part 2 - Penny de Byl | Coder Coacher - Coaching Coders</title><meta content="Triggering Animations in Unity by Clicking Part 2 - Penny de Byl - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udemy-Tech/">Udemy Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Triggering Animations in Unity by Clicking Part 2 - Penny de Byl</b></h2><h5 class="post__date">2018-04-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xMdNKH-Msd4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in the previous video we created a
sitting down animation for our character
and put it into the animator so that the
character can go from idle into sitting
down and then it can stand up again when
we click on a particular object so in
this video we'll start adding some code
now in order to actually click on an
object when in this case is going to be
this chair if we find that chair in the
scene double click it on hierarchy to
bring it up into focus in order to click
on it the object needs to have a
Collider around it so what I'll do is
with the chair selected in the hierarchy
is to go to the inspector add component
we're going to add a box Collider now
that box Collider will be centered
around the origin now in this case this
particular chair it's origin happens to
be out here because of the way it was
modeled so we need to move this box so
that it sits around here so it's the
same process of moving the box using
these controls here to Center it and
then size it for the chair now you might
want it bigger if you want it to be more
clickable for the user and not such a
hard target to click on so I'll just put
something like that ok so that box is
pretty much around the chair when we
click on the chair we should manage to
hit that Collider box with the mouse
click because it's quite big alright so
now that we've got that Collider we're
going to add some code onto the chair
that controls the clicking so to do that
go into your project and go create
c-sharp script and call it sit on with a
capital S and a couple Oh I already
created it and you'll see it down here
let me open that up and we can have a
look what's inside there ok so let me
just get rid of this window in here
we've got our sit on public class which
is our opening for a code inside
this code we've got a public game object
called character now this will allow our
chair to point out our character so that
the chair can actually control the
character in the past what we've done is
control the animations on the character
with script that is on the character but
in this case this script is on the chair
so the chair needs to know about the
character and that's what this variable
at top he is going to do then we've got
this boolean value called sitting on
which will help us to keep track of
whether the character has sat down or
not this is not related to our triggers
that we created before okay it's a
separate boolean value just for internal
use on this script all right and then we
have an animator variable created so
that we can get grab hold of the
characters animations now as we've done
before in the start function we're going
to set the Anam to equal the animator
component but this time instead of going
this docket component animator we're
going character dot because we're
getting the animator that's on top of
the character okay then there's nothing
in the update function and we've
introducing a new function here called
on Mouse down and this function is going
to run when it registers that the user
has clicked on that Collider box around
that chair now once that happens it will
test if we're not sitting on then it
will set our walking speed to 1 and set
our walking to true and if sitting on is
true then it's going to fire off a is
sitting false our trigger for our
animations and then it will set our
sitting on value coaches this one up
here and then when we're using the if
statement to false because we're no
longer sitting now you might be looking
at this thinking what why are we setting
is walking to true when we've clicked to
sit on the
here the reason is that the bots might
actually be somewhere else in the scene
and so you don't want it to sit down
anywhere you want to sit down on the
chair so when we first click on the
chair if we're not already sitting on it
we want to start walking and we want to
start walking towards the chair now that
code isn't included just yet so we've
only just got the bare bones of being
able to click on the chair in here so
let's just save that and go back into
unity grab your set on script and drag
and drop it onto the chair
then select the chair in the hierarchy
just do make sure that your sit on
script is there now at this point you'll
see that there's a character exposed
variable sitting in that script and
that's waiting for you to tell it about
the character which is our Y bot so if
you grab hold of that Y bot and just
drag and drop it down into that
character space that script will now
have access to the Y BOTS animations so
at this point when we run it and click
on the chair the character will go into
a walking state or so you might think so
we're clicking on this chair we've got
the code in there that we are saying if
we click on the chair then we should go
into walking but obviously it's not
happening now at this point you need to
start debugging the logic of your code
because there's no errors if you have a
look at the console setup errors and so
there must be some kind of logic error
going on where we've got our messages
mixed up as to what we're sending the
bot ok so the first thing you need to do
is to go back into your code and go to
this onmousedown we want to check this
is actually working first of all and to
do that we put in a line of code called
debug log and then just put in a message
inside double quotes so clicked on chair
so this code will run when we click on
the chair so I'll just save that and
switch back and run and then click on
the chair and if we go and have a look
at the console will see that that
clicked on chair is running so that's
not our problem the onmousedown isn't
okay what is actually happening is you
have to remember that the bot itself has
that controller code on it if we go back
into its controller dot CS code and on
update this is actually doing a setting
is walking to true and false and so if
you're not actually walking around it
sets the walking to false so although
we're clicking on the chair which would
set walking to true in the same update
even though it's in different code it's
being set back to false okay so it's
actually negating what we're trying to
do because the chairs telling it one
thing and the controller is actually
telling it another thing so we need to
compensate for this because it's going
to be a common error that you get once
you start animating your character to
move around a lot and this is really the
process that you go through to debug it
okay you can't just when you don't have
any particular errors or read messages
popping up on the screen it makes it
really difficult to figure out where the
problem is and therefore you have to
step through your code and make sure the
bits of code that you've made to run are
actually running the way you expect and
the best way to do that I find is to put
these debug lines in all over the place
so that you can watch the code running
essentially alright so now what we're
going to do is to add some code to say
if the chair is in charge of the
characters animations then the code
that's in this controller script
shouldn't run so in the controller
script at the top let's create a new
variable that's going to keep a track of
who
owns the bots animations well the bot
owns its own animations but I'm who's
controlling it so we'll have a public
static game object and we'll call it
controlled by and that value that's in
control bar will be the object that's
actually running or in charge of the
bots animations now down in the update
for this we're going to put a little
test before we let the bots have control
over its own animation so we put if
controlled by does not equal null return
so this control by value will be empty
initially because we're not setting
setting it to anything here now we'll
get the chair to actually set controlled
by to itself when we've clicked on it
and what that will do is it's going to
say in this update
if controlled by is owned by something
else so it's not null it is a chair or
it is a box or whatever then return
which I'll just throw you out of this
update function and won't run the rest
of this code down here so save that then
we're going to just I'll just copy this
while I'm here just to make it easier
for myself let's go back to the sit on
code which is here now at the point that
we click on the chair we're going to set
in this here where we're sitting on
control by equals this game object which
will be this particular chair because
that's what the code is attached to now
the control by itself you can't just use
control by because it's inside of a
different script which call controller
so it's controller dot control by to set
the value of control by here that is
inside the controller class okay now I
understand this will be a little bit
foreign if you're not used to
programming
and I try not to make it much more
complicated than that for you
right so now that this is once you've
clicked sitting on the chair is that
you're now controlling the animations
with the chair code and not with the
controller code now at the point if we
click on the chair again and we go from
is sitting to false that means we're
standing up at that point we want the
chair to let go of control I'll just go
into here and just set this back to null
so the chair no longer has control over
the bots animations which will release
it so that we can use the arrow keys to
walk around freely so save that and
switch back to unity and let's just try
this out now so let's um play now when
we click on the chair
the bots going to start walking and see
it's just going to go walking off into
the distance because it's running that
walking animation if we go to the
animator we can see that it's now
looping here we've set the speed to 1 in
the code we're not using arrow keys
if this at this point you try and use
the arrow keys then they're not going to
have any effect whatsoever over the
bottom if we stop playing let's play
again
now let's not select the chair then we
have our regular control over the bot
okay so if we now select the chair it
will start walking and then if we select
it again the bot will keep walking
because of the way we've set that
animation up but we will have a little
bit of control with the arrow keys
though he's now run into the chair so
that's not going to work but the point
is that now we can press play we can
click on the chair start the bot walking
and what we want to do is make the bot
walk towards the chair so to do that we
need to add a little bit of code
that will do that for us now the code is
already moving the bots forward walking
when we click on the chair but as the
bot is walking we want to slowly rotate
the bot to walk towards the chairs
position so that means not only pushing
the bot forward but also turning the bot
to walk towards the chair now the way
that we do that is we can use a function
called loop which is a linear
interpretation and what it does is it
slowly makes little adjustments to the
box so that it will turn little by
little towards a particular object as
it's moving along so this code will put
inside our sit on function because it's
the actual chair itself we want to move
towards let's open that up and I'll show
you the changes that you need to make
now so at the top what we're doing is
going to add an extra variable which is
this one case called is walking towards
and we'll set that to false because once
we select the chair click on it well set
is walking towards to true which will
trigger our walking movement so add that
line there next down in the update
function we're adding this piece of code
if is walking towards then we're going
to start running a Auto walk towards
function which will write in a moment
and this will only happen if we've
clicked and set is walking towards to
true now where we set is walking towards
is going to be down in this onmousedown
so in here we're setting it to true for
when we've clicked and when we're
clicking to stand up back here
we're setting it back to false okay so
those are the two lines that you need to
add into the existing code then along
with that we're also going to add this
Auto walk towards function which you
will insert
immediately after on mouse down this
whole one here now very important that
you make sure that it's inside this last
squiggly bracket at the end because this
squiggly bracket right at the end
belongs to the class definition for your
code so it's got to be there and then
this square bracket matches up with that
squiggly bracket and that one matches up
with that one but basically what this
code is doing is it's calculating a
target direction that we want to go
towards and that target Direction is the
difference between the chairs position
which is transformed dot position and
the characters position okay so this is
calculating the vector or the line
between the character and where the
chair is
then what it does is it uses a look
rotation function which will slowly turn
the character to start looking towards
the target or at least that calculates
the angle that you need to turn to look
at the chair so if in this case just for
here the bot is facing this way then
what we've done is we've calculated the
fact that the target Direction is here
and the angle that we need to walk
sorry turn around it will be this angle
here and that's what that code does now
we haven't gone into a lot of coding or
math in this series so therefore I don't
expect you to understand exactly what
this is all doing except that it's
slowly pushing the rotation of the
character as it's moving forward towards
that chair now what's most important is
to check that we've got close enough to
the chair in order to start sitting down
and that's what this line here does so
as the bot is walking around and turning
towards the chair we test the distance
between the characters position and the
chairs position now if that is less than
some particular value our - oh I've got
0.6 is that we're saying
we are close enough to the chair to
consider sitting down on it
at which point we're going to trigger
the is sitting in the animation and set
that to true which will start our
sitting animation and at the same time
it's going to turn the is walking off
and put it to false to stop us from
walking ok we're then going to set the
characters transform rotation to that of
the chair and I'll come back to this in
a little while when we start to consider
how the character should be facing when
it sits down on something and then we'll
turn off the is walking towards because
we don't want to and set this sitting on
to true right so once you've typed all
that in save it fix up any little errors
you might have had and just check that
your code is correct now come back to
here and run it and then when you select
the chair you'll see the bots does to
walk it'll turn towards the chair once
it gets in a certain distance he's going
to decide is going to sit down on that
chair and you can see that he's gone
into this sitting idle which we can see
here now this isn't set to be looping so
you can see it's run through once and
then stopped and we can fix that easy
enough just by setting the actual
animation to be a looping one and it
stops there because we haven't told him
to stand up yet now if we click on the
chair itself it will then trigger the is
sitting to be off so I've clicked on the
check and see that actually turns off
over here and then eventually the
stand-up animation will work okay so
just to fix those transitions remember
if you want to go straight from idle to
that you've got to turn off all of these
has exit times in here and then to make
the sitting idle loop it's to click on
that one there in the assets and go down
and select loop time in your animation
tab and click on apply ok so that's
going to fix those things up in the next
video we will look at positioning our
BOTS so that when he sits down
actually sits down on the chair not in
midair near the chair thanks for
watching please support the development
of more superb online learning content
by subscribing and as always visit
holistic 3d comm to learn more about
awesome games development books and
tutorials</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>