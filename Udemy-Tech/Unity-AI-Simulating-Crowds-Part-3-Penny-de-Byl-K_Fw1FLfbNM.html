<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unity AI:  Simulating Crowds Part 3  - Penny de Byl | Coder Coacher - Coaching Coders</title><meta content="Unity AI:  Simulating Crowds Part 3  - Penny de Byl - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udemy-Tech/">Udemy Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unity AI:  Simulating Crowds Part 3  - Penny de Byl</b></h2><h5 class="post__date">2018-03-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/K_Fw1FLfbNM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this lecture we will continue working
on our crowd simulation since the last
lecture I've added some extra scenery
into the scene that you'll find in the
street folder in the project under
prefabs I've also added another goal
location so the crowd walks along two
sides of the buildings now it will make
some modifications to their animation
controls to stop them walking like a
regimented army before we add a dynamic
obstacle first thing that we need to do
is to stop them walking in step with
each other remember they're playing
exactly the same animation at exactly
the same speed what we can do to make
that look a little different is to first
of all make it so that they're not in
step with each other so that they're at
different phases through that walking
loop and the other thing we can do is to
change how fast or how slow they're
walking right so the first thing we want
to do is we're going to go and find our
animation let's click on agent people
and then this the crowd double click on
that and this is the animation
controller with our walking in it now if
you select the walking animation and
have a look over in the inspector you'll
see that there is a speed that we'll
come back to in a moment and a cycle
offset this cycle offset is a value
between zero and one which specifies
whereabouts in the cycle the animation
is playing now if you set that to random
values for all the characters they will
become out of step with each other now
to do that easily we need a parameter
that we can grab from our code so first
of all we go over to the parameters
section and then click on add we're
going to add a float and we will call
that float W offset and that's because
it's a walking offset then for our
walking animation select that and go
over to the inspector you want to tick
the parameter that's right next to cycle
offset and it will automatically fill in
W offset as the parameter
now whatever value we give W offset in
our code will come through here and set
the offset for the walking to set that
offset go back to your AI control code
in the start just after we've set up the
animator before we start the walking
animation we will set the offset value
for it so that it's going to be a random
value between zero one going into this w
offset and it's a set float in this case
because it's a float value so save that
switch back to unity and press play and
we should now see that our characters
won't be walking in sync with each other
which makes it look a little bit more
naturalistic now we can also do the same
thing with the speed if we go back to
our walking in the animator you're
finding the inspector that there is the
speed value we looked at before it also
is able to be changed with a parameter
and it has a multiplier underneath it
you can see here let's create that first
of all so we go over and create a float
and let's call this speed mult initially
it will be set to 1 otherwise you won't
be going anywhere because if you
multiply by zero then it will be going
at a speed of zero and then select your
walking animation click the parameter
next to it and then change its
multiplier to speed mult now we can
modify speed moult also in our script so
if we open up our script again the AO
control and we can do that up in the
start so we can give them a random
walking speed so let's go anam dot set
float speed mult
and then random.range
let's say somewhere between 0.5 and 2
let's put an F on there for our float
and there so if you save that at this
point what you're going to get is only
the speed being multiplied in the
animation so it will either slow down or
speed up but the agents speed the nav
mesh agent isn't being changed and
therefore you want to make sure that if
you change the animation speed that you
also change the speed at which the nav
mesh agent is moving as well and so you
can do that with first of all we'll
probably need to save what your
multiplier is for your speed so let's
put float speed multiply equals and
we'll take this out of here and cut that
out put that up there and then put this
as our speed mult and then we'll also
use the speed mult
on our agent speed so agent dot speed
multiplies equals SM like that and so
now we have the owl speed multiplier
applied to our animation and also our
agent movement ok so save that and we'll
go back across into unity and we'll play
it and we should get different speeds as
you can see there and the animations are
different as well
so multiplying it by what was it two
that we had is the maximum they do walk
quite fast but you can see that the
animation is keeping up with them and if
you want to slow those down because it
doesn't look particularly naturalistic
you could have people going along it'll
leisurely 0.1 pace and then maybe people
at say 1.5 F it's up to you what you
have in there and the effect that you're
actually after but at least everyone now
isn't walking in step with each other
and
some people are taking a casual stroll
and other people are in a hurry now
we're going to add a dynamic obstacle
onto the navmesh for our agents to move
around and that obstacle can be anything
but we're going to make it a
first-person controller so go into your
assets and import the character package
then once you've done that you'll get a
first person character package down in
standard assets characters of your
assets folder go into the prefabs and
grab hold of the FPS controller and drag
and drop that into the scene if it's
below the surface just lift it up a
little bit and I'm just going to move it
back
because I'm going to want to walk it
into these people going up this way so
we can see it now it has a camera on it
which we will use in a moment but for
now we will use the current camera
that's pointing at the scene because I
want to walk this around and for you to
see that these agents are going to
completely ignore it at first so with
that their press play and then you can
use the WASD Keys to move your character
around and you'll notice that you can go
straight through people and they don't
even care or know that you're there
so if you were playing this in
first-person mode the same thing
happened people would just walk straight
up and then straight through you ok so
just press escape to get your mouse
control back and stop playing to make
this first person controller into an
obstacle on the navmesh we add a
component to it called a nav mesh
obstacle so select the first person
controller in the scene and go over to
the inspector add component and we're
looking for a nav mesh obstacle click on
that now you don't have to make this
object static like we have with all the
other geometry because it's not static
it's going to be moving around and the
agents are going to react to it now
within the nav mesh obstacle you can
also set whether it's going to be a
capsule or a box our character is a
capsule so we'll put a capsule on there
at this point you'll see that there's
two capsules sitting over there one is
the physics collider and one is your MAV
mesh Collider and you can adjust them to
be exactly the same I'll leave them like
they are because they're pretty similar
so now when we press play and we take
our character for a walk we'll find that
people avoid it and so they're going
around and if we bump into people
we will also affect where they are
so to get a view of what this looks like
hit escape and stop playing let's go
down find our camera that we've got from
before and you can delete it or just
turn it off now when we press play it'll
default over to the first person camera
and we can now walk through people and
they will avoid us so you can see this
character going around
and we also affect those around us as
well
because you can push them out of the way
and as I said before you can add this
navmesh obstacle to any game object in
your scene to make it a dynamic obstacle
on the navmesh
so you could also have a car that you're
driving along and have it as a navmesh
obstacle so that any agents that are
stuck on there will have to navigate
around that moving object of course as
you can imagine the more of these
obstacles that you add that are dynamic
the more the navmesh code has to work to
keep recalculating the paths so when you
can have us something that static and
doesn't move you want to make it static
and think about what's going to move and
make it a non static and add the navmesh
obstacle to it
thanks for watching please support the
development of more superb online
learning content by subscribing and as
always visit holistic 3d comm to learn
more about awesome games development
books and tutorials
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>