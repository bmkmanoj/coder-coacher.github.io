<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unity AI:  Non-Player Navigation Systems with Waypoints  - Penny de Byl | Coder Coacher - Coaching Coders</title><meta content="Unity AI:  Non-Player Navigation Systems with Waypoints  - Penny de Byl - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Udemy-Tech/">Udemy Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Unity AI:  Non-Player Navigation Systems with Waypoints  - Penny de Byl</b></h2><h5 class="post__date">2018-03-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2cbLQgCQ6Hc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm dr. penny DeBell I've been
teaching and researching in the areas of
artificial intelligence computer
graphics animation and computer games
for over 25 years in both Australia and
Europe and along the way I've written a
book or two that are used in hundreds of
universities I've taught students all
over the world how to produce amazing
results with the Unity game engine to
bring their projects to life now I'm
thrilled to bring my expertise to you
through udemy in this video I'm going to
present an extract from my artificial
intelligence course in it you'll learn
about one of the fundamental navigation
systems used in games all my videos are
workshop based so fire up your computer
grab a copy of unity and follow along in
this lecture we will start looking at
one of the most fundamental AI
techniques used in navigation waypoints
waypoints are simply positions on a map
that when navigated in sequence produce
a path it's the same system used in a
car GPS that gives you instructions on
where to drive waypoints are an easy
system to implement in an NPC as it
makes them look more intelligent than
they are and by providing them with a
safe set of locations on a map to move
between they can also avoid obstacles to
follow along download the project
associated with this lecture and open
the tank scene in the scene you'll find
a little purple tank and it's this
little purple tank that will be our NPC
to begin we need to create some
waypoints and I usually create my way
points from spheres so that I can see
where they are so over in the hierarchy
right click and go 3d object sphere and
it will create a sphere for you I'm also
going to color it in red there's a red
material in this project file this is
just so that we can see it and you also
want to take off the sphere Collider as
well because you don't want it to be a
physics object all this is is a marker
for our tank to navigate around later on
you may even turn off your mesh renderer
when you don't want to see the waypoints
but when you're editing
it's good if you know where they are
exactly rather than just a transform
right so this is a waypoint and in order
to make it away point I've created a tag
and you'll need to assign this tag to
the sphere so just go over to the
inspector and look through the list and
you'll find Waypoint
if it's not there or you're creating
your own system you'll need to add a tag
and then come back and reassign your
Waypoint to the sphere take notice also
how it's spelt because we're going to
search for it later so this is Waypoint
all in lowercase so there's our first
Waypoint now with that created you can
move it into place and then ctrl D and
make multiple copies of it and make a
little circuit for the tank to move
around and it doesn't even need to be
perfectly round let's just go with
something like that next we'll create a
script that will follow the waypoints so
go to project create C sharp script
let's call this Waypoint follow and open
it up and we'll add in the following
code
the code includes a lot of the stuff
that we've done before and that we did
with our zombie example of moving her
around and following and slurping so
you'll see those same dynamics in a
moment when we get down there first of
all though you need a array of game
objects to hold all of those waypoints
and we're going to populate that
automatically next an int which is the
current Waypoint so it's the index into
this Waypoint array for the sphere we're
currently heading towards after that
you've got the usual suspects that we've
had before with speed accuracy and
rotational speed now in the start
function we're setting the waypoint
array to equal all of the game objects
that have the tagged Waypoint so this is
automatically filling up this waypoint
array for you if you wanted to specify
the waypoints yourself you could
manually drop them in to this waypoint
array through the inspector and then you
could put them in the order that you
want them in but for now we're just
doing this automatically because it's
just way quicker in the late update is
where all of the work is going to happen
and you can see it's quite short really
first of all we're going to check if we
have any waypoints if we don't when then
we're just going to return because
there's no point moving anywhere then we
have our look at goal being constructed
again again this is a 2d kind of look as
far as it being at the same height as
the tank but in the X and Z of the
Waypoint if you wanted a 3d system of
waypoints where you've got an aeroplane
or you've got a bird or something that
can move in three dimensions then you
would obviously put the waypoints Y
position in here instead of the tanks Y
position we then calculate our direction
as before and then we perform the slope
which will turn
the tank towards the Waypoint or in that
direction right we then go ahead and
test our magnitude for being less than
accuracy to say whether we're close
enough to that particular Waypoint if we
are close enough to the particular
Waypoint then we increase our Waypoint
that we're heading to by one so let's
say we're heading to Waypoint zero and
then we've reached it within our
accuracy this will then go to Waypoint
one and that will cause us to start
looking at Waypoint one and moving to
way point one all right now if we've
reached the end of that array we've run
out of waypoints then we just go back to
the first Waypoint so this is going to
cycle around for us
after all that happens we're then going
to perform our translate notice the
translate is not restricted in any way
it's just going to happen regardless of
anything except there being no waypoints
at all so where we're turning we're
looking at the Waypoint we should be
looking at and then we're pushing the
tank forward because this whole update
is about cycling around the Waypoint so
the tank will never stop at anything
right so save that then go back to unity
and what you want to do is select your
tank and drag and drop Waypoint follow
onto the tank now in there in the
inspector you'll see the waypoints here
now if you wanted to put your waypoints
in you could drag and drop them as I
said before from the hierarchy onto that
array and then put them in and change
the order that you want but we're doing
this automatically so there's no need to
in this case alright so once you've done
that press play and you'll find that the
tank starts to follow your waypoints
around okay so it's off to this one and
then it will turn and go to this one
this is a little bit slow for you we
just go back into the waypoints and
modify the speed so let's put this up to
say three now if you increase this
speed you also need to increase the
rotational speed as well otherwise
you'll find that you get a tank that
does an awful lot of swinging around in
big arcs so let's see if this helps
yep not too bad you can see that it does
take a quite a big arc to turn because
of that rotational speeds a bit slower
than the actual forward speed but it
still works it gets close enough to the
points now remember if you get a tank
that starts to go around a waypoint or
starts to jitter on a Waypoint it's
because the accuracy is too low and
you'll need to increase your accuracy
let's see if we can force the tank to do
that okay so open up your script and the
Acuras here which is currently 1 let's
make it 0.5 save that and let's go back
and run this and let's see if the tank
never reaches the Waypoint it will just
start to circle the Waypoint because
it's constantly changing its direction
vector to point at the sphere whilst
it's being pushed forward as well and
now it just can't get close enough
because of the speed and the rotation to
make it within that point 5 distance of
that Waypoint and therefore it's just
going to be stuck so it's the speed the
rotational speed and the accuracy that
all have an effect on whether the tank
will reach that particular Waypoint or
not so always consider those and check
out what's going on as far as the
behavior is concerned
before you go ahead and build yourself a
full-blown waypoint system you should
probably know it's already available in
unity so we've to this point built our
own little waypoint
circuit but now I'm going to show you
what unity has available in it for you
so if you grab the code that I've
included as a resource with this inside
you'll find a waypoint circuit and a
waypoint progress tracker script and
drag and drop those into your project
these two files I have gotten from a
download and import of the utility
package so that's under assets import
package utility that will bring in a
folder called standard assets and in
that somewhere you will find these two
scripts but I've included them so that
you can quickly add them and I'll show
you the difference that you get using
these first of all there's a waypoint
circuit and this will set up what we've
achieved with an array and these balls
but you'll still need to have the balls
in there because they are your waypoints
so first of all in the hierarchy create
an empty and we will call this our WP
circuit to the circuit drag-and-drop the
Waypoint circuit script then get all of
the spheres that you're using for your
waypoints click them up and drag and
drop them so that their child objects of
the WP circuit now select the parent the
WP circuit over in the inspector we have
added that code you'll see a button that
says assign using all child objects if
you click on that it will create an
automatic Waypoint out of all of your
objects now it will also link them up
with a nice curve which we can't see
because my spheres are slightly under
the ground
if I just lift those up you'll see this
circuit being drawn in the scene and you
can see very easily from that that you
have a circuit and none of the waypoints
of in the wrong order for being a
complete circuit if you want to change
the order they appear in over in this
waypoint circuit component that you've
added on to there let me grab the second
one and I'll move it up and you'll see
the result now that sphere one is the
first one and fear nothing is the second
one you're going to get this crossover
and that might be what you want that's
fine you can also grab hold of your
waypoints and move them manually around
as well to change the particular order
of your circuit so there are two things
you should be aware of in setting up the
circuit I'll just leave it crossed over
there for a little bit of interest at
this point at this point if you want to
keep using your Waypoint follow script
that we've already written on your tank
then you need to update it to use the
new Waypoint circuit instead of the
individual spheres in the game object
array that we had so let's take a look
how we would update the script back in
the Waypoint follow instead of this
public game objects are right at the top
we now grab hold of the circuit itself
now that circuit is a waypoint circuit
type and it's in the namespace unity
standard assets dot utility because
remember I said that it does come in the
utility import if you bring it down from
there so make sure that you declare it
like that it's going to be public so
that we can tell it where the circuit is
and drag and drop it in the inspector
the rest of the code is okay up here in
the start you won't have to get your
waypoints with a find object for the
tags anymore so we can comment that out
down in the update the late update where
we're getting each Waypoint and then
turning towards it moving towards it we
just have to change a reference to what
we're getting so instead of the game
object indexed by current Waypoint we're
getting the current Waypoint from the
list of waypoints that comes from the
circuit so the first thing we do is we
check the length of the circuit so
instead of waypoints dot length that we
had before it's now circuit dot
waypoints with a capital W in this case
dot length and then when we get our goal
we're getting the circuit waypoints
current waypoint dot position dot X so
the transform has gone in here because
these waypoints have the position
straight out from there you don't need
the transform so just be sure that you
haven't got that again if you're in 3d
space and you want to use the Zed for
the Waypoint as well go ahead put it in
here instead of the height of your
character and the other thing you need
to change is just down inside the
direction magnitude part where we're
testing if we run out of waypoints and
we're going back to the beginning again
we need to get the circuit dot way
points dot length not waypoints dot
length that we had before so save that
and switch back into unity and press
play and you'll be able to watch your
tank move around your circuit of
waypoints so it's the same way points we
had before but now we're just organizing
them using unities a waypoint circuit
code that it brings and it's very useful
because first of all it gives you the
visualization of what your circuit is
going to look like in the scene and it
allows you to reorganize these waypoints
using this method you'll notice that the
tank does not stick to the yellow line
the yellow line in this case is just a
guide for where the circuit is and which
Waypoint is connected to which other
Waypoint
now we're going to bring the Waypoint
progress tracker
into play so this is the other unity
created scripts that comes in the
utilities it's going to be attached to
our tank select the tank in the
hierarchy and remove the Waypoint follow
script that we created then instead in
the inspector you want to drag and drop
at the Waypoint progress tracker now
this progress tracker you'll see also
requires a circuit of waypoints and you
can give it the circuit that we created
just before the other thing it also has
down the bottom is a target the target
is going to be an object that is a child
of the tank so select the tank right
click this is in the hierarchy 3d object
and create a cube now we'll just grab
that cube and move it away from the tank
a little bit you can see it there the
cube is going to become like a goal for
our tank to travel towards and the cube
will stick to the circuit and be pushed
around the circuit by the Waypoint
progress tracker code and the tank is
going to follow it so the cube itself
doesn't even need to be visible and
later when you put this into production
you wouldn't have it visible but first
of all just turn off your box Collider
because you don't need any strange
physics occurring in this system now
let's select back to the parent tank and
drag and drop your little cube into the
target right at this point let's press
play and see what happens
all right so you can see that you've got
the cube and it's been moved it's
sitting on the circuit there's this
green line going between the tank and
the cube and there's also this ball here
as well on the circuit now all these
values are controlled in the waypoint
progress tracker script that's attached
to the tank basically what they're doing
is creating a little rubber band between
our cube and our tank such that the cube
can't get too far away from the tank
whilst it's staying on the circuit if I
move my tank closer to the cube and
start to sort of come up behind it
you'll see that the cube makes its way
along the circuit so that's the progress
tracker moving the cube for us
automatically now you don't want to play
your game by dragging the tank around in
the scene view so we want to program it
to automatically follow the cube and
we've already created this code so if
you remember when we had the zombie
following the drivable cube around and
we created a script called move local I
think it was it's that exact same script
that we now need to put on the tank and
tell it that our goal is going to be the
cube so I've created this script in a
file called follow gold besides the name
change to follow goal there's really
only one other line of code that has
been modified we still have our public
goal that we're going to pass through
here and now instead of it being a
drivable cube it's going to be that cube
that is being driven by the circuit we
still have our speed accuracy notation
as we have before and in fact we're not
even using accuracy in this case so you
could take that out in the late update
is where all the work happens so we
still want to do a look at goal then we
set our direction as before we slurp
rotate towards that direction and then
we push our character forward
notice that the accuracy if check has
now gone because we don't want our tank
to stop when it gets close to that cube
because if it stops the cube stops and
you don't want that you just want the
cube to keep moving around the circuit
and the tank to keep following so save
that and go back into unity select the
tank grab hold of that new follow goal
code drag and drop it on to the tank in
the inspector so that you'll have the
Waypoint progress tracker and you'll
also have your follow goal the exposed
goal variable you want to add your cube
object so drag and drop that down into
the goal now when you press play and
you'll see I've already aligned my cube
ready to go to point one and my tank
just behind it of course you can have
these anywhere let's press play and now
the cube will start calculating its
trajectory along the circuit and you can
see that the tank is moving the other
thing you'll find is because of the way
this tank is following the cube with the
speed and the rotation is that the tank
can cut corners because the tank is
trying to go straight towards the cube
it really has no knowledge and doesn't
care about your waypoints so the cube is
acting as a little guide now if you want
to modify how far ahead that cube can
get and how fast it goes around the
corners then you can change in the
Waypoint progress tracker how far it
will look ahead and how far it's speed
for look ahead will be as well you can
also modify a point to point threshold
and this threshold is how close we want
the cube itself to get to each of these
before it's considered having visited
them and that that's essentially our
accuracy and so that's the waypoint
script that comes with unity feel free
to use it both together the circuit and
the tracker or use one of them with your
code whatever you like they're all doing
this
same thing our code is really quite
simple because we're just pushing an AI
forward around the circuit and so you
might prefer to use that because you've
written it and you can modify it to your
own understanding
in this lecture we will create the
foundation of a simple racing car driven
by AI
so far we've developed an NPC that can
follow a waypoint circuit progressor
around at a constant rate but in reality
that's not how cars move instead we need
to consider the cars velocity
acceleration and deceleration and
program the NPC to know when to speed up
and when to slow down velocity is the
vector representing the NPC speed as
well as the direction it is traveling
the speed is used to drive the NPC
forward acceleration and deceleration
are considered forces that can increase
or reduce the velocity over time they
are also vectors usually acceleration is
a forward force and deceleration is a
backward force though they could be
applied at any angle for example in the
case of a collision from the side so far
we've developed an NPC that will follow
a point that is tracking around a
waypoint circuit this point we will use
as the NPC's eyes for how the track is
turning when the track is running
straight the NPC and the tracker will
have the same forward vector however
when the circuit is bending the angle
between the tracker and the NPCs forward
vectors will get larger
to follow along as we put together this
simple car a I download the Waypoint
cars starter resources with this when
you open it you'll get exactly what I'm
looking at here though you're seen in
game views might be slightly different
but in US you've got a racing track with
a waypoint so could already set up on it
using the same code that we used in the
last lecture and I've added in an orange
car that orange car has a cube attached
to it
now this orange car has the Waypoint
progress tracker setup on it the cube is
set as the target for that Waypoint
progress tracker and there's a t-shirt
file called simple AI script attached to
that car that's script if we open it up
you'll find is very similar to the last
sort of code that we've got for pushing
objects along in a straight line whilst
they're continually looking at a goal so
we're going to take this script and
modify it to add a little bit of car
dynamics to it you may also have seen
back in the scene and the game that
there's a speedometer that's been added
this is driven by code called analog
speed converter and we're not going to
go into that but the speed from the car
is being fed into the speedometer so it
gives you a sort of a visual
representation of what the car is doing
with respect to its speed now with this
car if we just press play then you'll
see it go around the track at a constant
speed so it's going to go up to 200 as
you can see in the dial and just
constantly follow around the cube
whether you're in the corner or not this
speed isn't very indicative of an actual
speed so it says it's going at 200 but
is this 200 meters per second or 200
kilometers an hour it doesn't look like
it's traveling at any of those speeds
and that's because of the way that we're
calculating it so we'll change that as
well and update it so the dial makes
sense back in our code the first thing
we'll do is to modify the way that this
speed is set up so I want you to get rid
of
these two lines or move them about and
we're going to put in this so we start
with an acceleration of five then a
deceleration which I've got as five as
well these two values you can change
based on how much power and braking
power the car is going to have a minimum
speed and a maximum of speed because
without this you can get your car going
backwards when you don't want it to
because its braked too much and a max
speed to stop it from going way too fast
to infinity speed itself comes down here
now I've taken the public off of this
because speed is not an exposed variable
anymore we're going to calculate it
we're not going to set it the other
things I've got here is acceleration
deceleration min and Max speed not as
exposed variables though you can expose
them later so they are to be set by the
user the reason I do this is because I
always forget when I'm editing that if I
try and change the values here and
they're exposed
it doesn't change in the inspector and
then I spend a long time trying to
figure out why my codes not working so I
find it better not to have them exposed
until I've got everything working the
way I want next we'll add our
calculation for the speed so come down
to just before the speed is used in this
translate function here and above that
we're going to add in this speed equals
we're using a math clamp and that's
going to make sure that whatever
calculation for speed we put in here
will get clamped between the min speed
and the max speed so this bit first in
the clamp is doing a calculation for us
which it will then put in to speed if
however it falls outside of that range
it will clamp it either to zero or to
whatever the max speed is this
calculation is increasing the speed with
acceleration multiplied by our time
Delta time and because we've multiplied
by time.deltatime up there we can come
down and remove it out of the translate
so that we are only doing a simple speed
now the other thing with
this speed converter which is showing
you the dial on the screen is it takes
the min and Max value to work out how
much it should rotate the needle and now
in this case this will be min speed and
the 100 will be the max speed
so it's going to go in this case between
0 and 100 so let's save that go back to
unity and press play and now instead of
the dials zipping around and hitting the
top speed it will slowly accelerate so
you can see the dial increasing and the
car following the cube you can also see
that we need to fix the formatting of
our speed and then we get to a point
that you can see here see how the car is
jumping round and round and doing
circles around that tracker it's the
same problem that we've had in the past
with our NPCs when they're not quite
reaching the point that they need to be
at and this car is essentially can't
follow the tracker because it's sort of
stuck going around it now to fix that if
you go into your car and go down to your
Waypoint progress tracker attach circuit
the look-ahead for target will be set to
one and so for the look ahead for speed
which is just too big turn them down to
0.1 instead so that we're not looking so
far ahead
we're staying much closer to that
waypoint tracker and then if we run
again
that staying nice and close but what
it's not going to do is get too far away
and it's not going to cut corners either
so as you increase that value for the
look-ahead target you'll start to get
your car further and further away from
the waypoint track and I just pause this
for a second because it's calculating in
a straight line to that point when the
Waypoint tracker is around the corner up
here and if the cars over here it could
track straight across the track here and
you will find that as you build more
systems that you will get the car
lagging behind the cube and it will cut
corners and not stay on the track
perfectly and that's where you need to
adjust these look ahead target and speed
values to your certain circumstance and
your certain tracks I've give it to play
we're now going at 100 which is
extremely fast as you can see on this
track but the car is following the
circuit tracker and following the track
so that's good now what's happening
though is it's getting up to a hundred
and that's it's constant speed of course
real cars don't do that you don't go
around the corner at a hundred so we now
want to change it so that will break
when we're coming up to a corner if you
can run and pause on a corner you'll get
a situation like this notice how the
cars forward facing vector is not
aligned with the forward facing vector
of the tracker whenever this happens it
means that the car is travelling in a
different direction to the tracker and
therefore we know that the tracker has
gone around a corner and the car hasn't
when this happens we want to apply the
brakes or bring in deceleration into our
speed calculation and we can determine
when to do this in our code by
calculating the angle between each
forward vector back in the code we'll
add in another variable at the top let's
call it float and have it as brake angle
and this will be the angle at which we
will apply the brakes so because it's a
variable you can change it for different
car types some can
very cautious and break when there's a
small angle or others can be a bit more
daredevil and you can have a large angle
but let's set 20 to start with as our
angle so that's our break angle that
will test the angle between our goals
forward vector and our cars forward
vector so we'll do that down here in the
update currently we're calculating the
speed all by itself just here and it's
only got the acceleration now
deceleration is going to be the same
deal but it will be a minus let's
replace this line here
with this so this calculates with a
vector3 angle you can give it two
vectors so the forward vector of the
goal and the forward vector of the car
and then test if that angle is greater
than the break angle if it is then we're
going to decelerate so we're going to
apply the brakes essentially otherwise
we will keep accelerating while we're in
here we'll fix that read out text on the
speedometer by casting speed to an int
just to cut off all the decimal places
right save that now let's go and play so
we begin by accelerating and when we get
to the first corner you'll see the speed
have a little hiccup and then as it goes
around other corners you'll see the
needle of the speed dip just down a
little bit by a little bit but the thing
is it's still accelerating and if we
leave it run long enough it will get up
to maximum speed now the reason that
that is occurring is because the
rotation between the cars forward vector
and the cubes forward vector isn't
different different enough for us to
worry about applying the brakes the
reason that that is if we stop playing
go into the car and down to your
waypoint progress tracker if you have a
look you've got this look ahead for
speed value which is currently set at
zero point one now that's the cube
rotating itself for however far ahead it
can look on the track and how much it
can rotate so this is kind of like the
cubes rotational speed now if we change
that to something like 1 it will allow
the cube to update a lot quicker for
further ahead now if you watch the cube
as we press play here you'll see it
turning on its own axis and what that
will do is then allow the car to apply
the brakes into the corner so as it
comes up the corner see that cube
rotates and flips around quite quickly
and up here again it will do it as well
and the brakes are now being applied a
lot because there
that big difference between the car and
the cube and you can see that it's
really putting a dampener on the speed
here so again it comes down to what are
you after in this and how do you want it
to sort of look and work it will depend
on the size of your world and also the
size of the truck as well because the
world remember that a cube is one meter
by one meter by one meter and therefore
this track you can see that that white
cube was made as a unit cube it's not a
very big track you can't expect to get
up to a great speed if you want
real-world speeds then you need to make
sure your track is in the real-world
size coordinates as well so let's leave
this here and in the next lecture we'll
start to look at customizing the
properties to make unique NPC behavior
we begin this lecture where we ended off
in the previous one with our orange car
that is following our tracker around the
track and also braking and accelerating
we want to add in now a opponent so
let's go up into the hierarchy grab hold
of the orange car and then go ctrl D to
create another one let's just change the
name of that and call it blue car and
then in the scene if you hit the W key
should be able to drag that extra car
out like that now this is our blue car
it's not very blue so let's create
another material for it now if you have
a look down in the assets there's a
cartoon free car models where the car
model is and then there's a material
this material here the cartoon vehicle
Atlas just control D on that which will
give you a second one rename that to
blue car so we know which one it is
then with it selected over in the
inspector you want to set the main color
to blue
something like that right so with that
new blue you can drag that over and just
drop it onto the car it's probably not
dark enough is it's just made the
windows a bit purplish see now you can
change it with the car and the scene
it's because the orange is already in
the texture that it's going to be a bit
odd if you want to make it a true blue
then you can take this texture here open
it up in Photoshop make the orange parts
blue and then put it back onto the
material but for now let's go with this
right so you've got the cars separated
you've got exactly the same thing on the
orange car and the blue car all you've
done is make a copy let's press play and
have a look at the behavior so the
orange car as it always has is taking
off and off it goes the blue car has
stalled completely if we switch over to
the scene we can see that it's just
sitting there looking at the cube and
the cubes not going anywhere now the
problem with this is well as two
problems first of all the car isn't
accelerating it doesn't believe that it
needs to accelerate and therefore its
starting value of zero for its speed is
still set to zero remember back when we
first started working with these
waypoints and the little tank and the
tank would be still and stuck to the
Waypoint and wouldn't be going anywhere
unless you dragged the tank after its
circuit to track up if I grab hold of
the blue cars just see if I can get this
to get going there we go so now that's
working because it added some speed and
new calculations to the movement of the
actual car now what's happening this is
the problem that's happened let's stop
this press play and then switch back to
the scene view
initially our code is saying if we have
a big angle between our car and the
forward-facing vector of our cube then
you're going to put the brakes on if we
have a look in detail of what we've got
here there's our forward-facing vector
for our car if we click the cube
there's the forward-facing vector of the
cube so right from the very beginning
we've hit that condition that says put
on the brakes because the angle is too
great between the car and the tracker to
fix this we go back into the code and
where we're testing whether we should be
braking or not we'll also test if we're
moving at a certain speed because if
we're not moving fast enough there's no
need to brake so we'll put an end speed
is greater than let's say 10 save that
and go back and run and let's see if we
can get our little blue car to move yep
so there we go so both of them are now
moving we go back into the scene be able
to see them come around who they are
they're on top of each other they have a
Collider but they don't have a rigidbody
so therefore they are not going to cause
collisions with each other
so that's easy enough to fix select your
orange car in the inspector you want to
add component and add a rigidbody and
then you want to do the same thing with
the blue car add component rigidbody
to see exactly what's going on you might
want to go in and select the cubes that
are our trackers and turn off their mesh
renderers so they don't get in the way
of the two cars right let's press play
and have a look at the behavior now so
you can see that the rigidbody is going
to keep those two cars away from each
other through the collision system
we can now customize the behavior of
each car by exposing all of those
variables in the script and then setting
them differently in the inspector the
first thing you want to do though is go
to the blue car and download it's got
access to the read out scripts just
remove its reference to the read out so
that the orange car is the only car
that's updating the speed readout
otherwise you're going to be getting
updated speeds from both cars then in
the code you'll need to make sure that
before you try and set the read out text
right at the bottom just put in an if
readout if it exists then put the text
in it of course if you don't want to
have the speed converter or the read out
you can just get rid of the whole system
entirely now at the top of the program
we can make all of these public which
will give you access to them in the
inspector so I'll just copy and paste
that in the only thing you don't want
access to is the speed because that is
what is being calculated so save that
and if you switch back into unity you'll
be able to select either car and change
all of these different values so you can
change the acceleration and deceleration
amounts the minimum maximum speed and
also the brake angle as well and see the
different behavior so let's leave the
orange car as it was before with the
blue car let's see if we can increase
its acceleration to say eight and it's
deceleration will put down at four and
let's see if we can get it to go
120 and we're going to make it quite
cautious so if it's brake angle will be
10 I doubt it's going to get up to those
sorts of speeds on this very short track
so let's just save that and run it okay
so the blue car goes off it's got a
fantastic acceleration it's actually
doing much better than I thought I with
what it would have slowed down a fair
bit around the corners and the orange
code have been able to catch up to it
but it looks like the blue car might end
up lapping it
there you go so yeah now at this point
you can add a lot of different cars if
you want to onto your track you might
need to make a bit bigger track this is
only a little one and you've got all
these different variables that you can
now change to get different behavior out
of the cars
you
in this lecture we're going to continue
working with waypoint systems but I
wanted to show you the more advanced car
AI that comes with the unity standard
assets so I've started up a project here
and added in my red spheres which I have
added to a WP circuit which is an empty
game object all the spheres are children
to get the Waypoint and the Waypoint
circuit code and also the car you need
to bring in to imported packages up to
assets click on import package the first
one you want is utility that has the
waypoint circuit and the Waypoint
progress tracker in it just import the
whole thing and the other one that you
want to bring in is the standard assets
vehicles so add those two things to your
project
next we'll set up our actual circuit so
the script you want we need to look for
our Waypoint
circuit there it is and I'll drag and
drop that on to the WP circuit object
and then remember that we assign using
all children like that
and it's given me a very nice circuit
which is all joined and in order
remember if yours is out of order then
you can reorder them here to get it to
the way you want it all you can
physically move them around in the scene
as well
now the AI car that comes with standard
assets already found it here because
I've searched for Waypoint is called the
car Waypoint based and you can find that
in the vehicles in standard assets if
you go down vehicles car and then
there's a prefab folder and it's there
as well so grab that car and bring it
into your scene now this car here is set
up with a lot of complicated things as
far as the sound and the colliders so we
probably don't want to shrink it or
enlarge it to suit our circuit instead
we should change our circuit and make it
a bit bigger so I'll just quickly do
that
the car itself is gray and you might
think that the textures are missing from
it but that is the actual color of the
car if you want to change that you'll
have to find the material and then put
something else on top of it but for now
we'll just stick with the default later
on I'll show you how to use another car
with this same system not just the unity
car right so select the car in the
hierarchy have a look in the inspector
and scroll down and you'll find the
Waypoint progress tracker already
attached to it so you don't need to add
a new one it's wanting the circuit as we
have used before and the circuit is the
one with all the spheres on so I'll drag
and drop that down into there now the
car has its own Waypoint target which
comes with it if you click on that you
can find it in helpers and then the
Waypoint target object this cars quite
complex it's got colliders and lights
and all sorts of things the actual model
for the car is under the sky car and
it's the body that has the current
shader applied to it I guess if you
don't want it to be grey I could make it
red or let's go with bright purple just
in there at this point we can press play
and have a look at the behavior of the
car in the default settings
so after a while it gets a little bit
out of control and starts to miss the
waypoints and that will be because of
its breaking habits its acceleration and
all those things that it has programmed
into it you can see here it's now quite
erratic if we stop and go back and
select the car and in the inspector
scroll down to the AI car control script
you'll see all the different settings
that can be used to customize your AI
and if I just drag this out be able to
see them a little bit better so you've
got things like cautious speed factor so
how fast you want the car to go when
it's being cautious and the cautious is
what we talked about before with the
braking you know when you're coming into
a corner how much do you want your car
to slow down sort of thing and there's
other stuff like steering sensitivity
acceleration sensitivity all these
things are defined in the script if you
open up that script and have a look down
here it will tell you in the comments
what each of them will do
but we're not going to go through all of
that you can read through it yourself
the best way to determine what these do
is to play and watch the behavior as you
change them so let's just press play
and we'll watch the car as it's going
around so this is the default values
that I had before and I will change the
cautious speed turn that down you can
see that the car has now slowed as much
cautious going into the corners and
because there's a lot of waypoints for
it to hit it's constantly breaking and
slowing down you can also change the
maximum distance that you want to be
cautious at so we could probably put
that down to like 10 which will allow it
to speed up more in between it and only
break quite hard when it gets closer to
a corner so you can see the different
behavior that you got there now you can
spend a lot of time on your own playing
around with all of these values to see
what they do and you can add multiple
cars like we did before just by doing a
control D on this car and then getting
another copy of it and then pressing
play and you'll have two cars in the
code if you're interested to have a look
at has avoidance of other cars as well
even though the physics system will stop
them from bumping into each other okay
so that's our purple car let me delete
that so what we're going to do is use
our own car model and your own car needs
to be set up the right way the car
itself if we have a little look at it
closer look
the wheels are separate objects to the
cars body and the script allows them to
turn and they have different colliders
on them as well so if you bring your own
model in it needs to have separate
wheels and they also need to be facing
the same way so have a look at the
access system on this particular wheel
the forward vector for the wheels needs
to be pointing in that direction
otherwise you will end up with strange
wheels that rotate around the wrong way
which might be the look you're after but
if you want a normal car it has to be
like that now we can get a quick example
of a car that fits our needs for this in
the asset store and this is the little
orange car that I use mostly for my
examples and if you read through the
description you'll see that it says it
has separated wheels so you can animate
them with the vehicle simulation system
which is what we're using so let's just
grab that car from there you can also
bring it in from the other projects that
we've created as well
now when that car finally comes in in
the scene we want to drag and drop that
car in and put it over the top of the
existing vehicle so let me find it
cartoon car proof up there it is let's
bring it in and put it with our other
car now it needs to be facing in the
same direction so let me rotate it
around
and we want to position it as a child of
the car Waypoint based object that's the
currently the purple car because it's
got all of the scripts and colliders and
we're just going to basically reuse them
also grab hold of your free car and drag
and drop it and make it a child of the
car Waypoint based so you've now got the
sky car and the free car with the free
card there you want to position it at
zero zero zero relative to the purple
car like that and we probably want to
resize it at this point because it's a
bit small so let's just hit the R key
select a car and just make it a little
bit bigger so kind of after the wheels
being about the same size all right so
from there I'm just also going to move
it up a little bit like that okay not
too bad now the next thing that you need
to do is to set the wheels up the wheels
are the driving force of the car the
first thing we're going to do is align
the wheel colliders and the wheel hubs
with the wheels of the orange car so we
got to the parent object the car
Waypoint based and have a look down
through the inspector and you're looking
for the wheel colliders here and the
wheel meshes so these are the colliders
of each wheel on the purple car the
wheel measures are the actual wheels
themselves and this is the reason why
they need to be separate objects now
these are the sky cars wheels we're
going to replace those with our free car
wheels so drop down the free car here
and what you want to do is grab each
wheel and drag it into correct position
here so the first one at once is the
front right wheel so it's a matter of
finding which one is the front right
wheel in fact I might just rename these
then when you've got them go back to
your parent object and you want to drag
and drop all of these into the right
spot so the first one is the front right
and then you've got the front left and
then you've got the rear right and the
left right so now at this point if we
play the car isn't going anywhere but
not for want of trying if we go over to
the scene view you can have a look at
what's going on so let's just turn this
around and zoom in so we've got two cars
the wheels for the orange car are now
sitting over the top of the purple car
wheels which is where we want them to be
so this vehicle system will move those
wheel models of the orange car because
we have assigned them now the issue of
why this isn't going anywhere is because
the orange car has a box Collider on it
and that box Collider if we can get in
close enough is on the ground so it's
dropped down onto the ground and it's
basically stopping the car from going
anywhere unable to push it forward so
the easy fix for this is to select your
free car and uncheck the Box Collider or
you could remove it entirely let's play
have a look at this so now the orange
car is going to drive and it's being
driven by its own wheels on the purple
car so let's pause that for a second
and have a closer look at what's going
on here as well we can't see the orange
cars wheels very well because of the
purple car so select the sky car and
just untick it turn it off so we can't
see it and as I said before the wheels
of the orange car are now sitting in the
locations of the purple car
and we need to move those so that they
sit naturally within the body of the
cars model and that's where these wheel
hubs that are part of the cars system
come into play and there's four of them
that you can see there if you select
just one of them let's hit the W key so
we can find out where it is this is the
front right and it's positioned near the
front right of the tire but it's
positioned near the front right of the
tire of the purple car but we want to
move it so that it now is positioned on
the front right of the orange car the
sky car itself is pretty superfluous at
this point because we're not going to
use it so I'm just going to turn that
off you could delete it let's go back to
our wheel hub this is our front right
and have a look at where it is so it's
positioned there we need to grab hold of
it and move it so that it sits nicely
over our existing orange cart tire and
you'll want to do that with each of
these hubs so I'll quickly do that
alright so with that done we can now
press play and just pause it again to
quickly find our car
and you can see that the wheels haven't
moved away from the body of the orange
car finally just for the physics system
if we grab hold of our car again we're
going to go into the collider section
which is under the Waypoint cusses the
first one at the very top inside you've
got a Collider body a Collider bottom
and a Collider front and they're all set
up based on the geometry of the purple
car if you want to fit them nicely over
your orange coach will give you more
realistic collisions with this one then
you want to just modify them so this is
the body of the car which is currently
there so let's just make that a bit
bigger and to move it up then there's
the front Collider which is on an angle
that you can see there it's not too bad
I might just move it up a little bit and
you can adjust that as you like and then
there's the bottom skirt which you can
see there which is quite low for the
orange car and again you can just not
resize it but move it up so that it sits
at the bottom like that and it probably
needs to be just a tad shorter as well
there alright so that is all of the
setting up that you need to do for your
own custom car in the vehicle simulation
system that comes with unity thanks for
watching please support the development
of more superb online learning content
by subscribing and as always visit
holistic 3d comm to learn more about
awesome games development books and
tutorials
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>