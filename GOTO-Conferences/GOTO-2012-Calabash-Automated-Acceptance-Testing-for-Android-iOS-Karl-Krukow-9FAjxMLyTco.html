<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2012 • Calabash: Automated Acceptance Testing for Android &amp; iOS • Karl Krukow | Coder Coacher - Coaching Coders</title><meta content="GOTO 2012 • Calabash: Automated Acceptance Testing for Android &amp; iOS • Karl Krukow - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2012 • Calabash: Automated Acceptance Testing for Android &amp; iOS • Karl Krukow</b></h2><h5 class="post__date">2012-12-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9FAjxMLyTco" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome I'm going to talk
about a project called calabash as the
title says it's a a project for doing
automated acceptance testing for mobile
apps it is an open source project it's
free to use it's open in the sense that
you can contribute to it but if you
haven't heard about it before I'm not
too surprised because it's a fairly new
project it's about 6 months since we
released it so even though it's it's new
it's actually some technology we've been
using for quite some more time the
company less painful where I'm at and
I'll tell you more about the company
later so the point is that it's
something that we've been using from
time to test our clients apps so it's
not completely immature technology in
that sense but now we decided to change
our business model we decided to open
source this technology and and to target
something which I'll talk about which is
a testing service cloud service for
doing testing on mobile devices and also
selling support and training on this
open source project so sort of a
classical classical way of making money
and supporting an open source project at
the same time so that's gone so the
agenda today is I'm going to talk a few
slides maybe max max 10 slides about
automated testing for mobile and some of
the challenges that are associated with
that and particularly I'll give you a
list of some properties that I would
like to have a matul that supports
automated acceptance testing for mobile
and this list of properties is actually
the reason why we created calabash
because none of the existing tools that
are out there would support all these
things so if that list matches your list
of properties that you want of a testing
tool then you should definitely check
out calabash and then I've actually
given this talk kind of before but I've
decided to do it differently today so
instead of my having about 30 40 slides
describing calabash I'm actually going
to have maybe 10 15 slides and then I'm
going to do the rest with live demos
so that's definitely gonna go wrong at
some point but that will keep keep the
you know the mood a bit informal and I
welcome you to ask questions and tell me
if you disagree and so it'll be I guess
a bit more live I am going to focus on
Iowa's because that's my area of
expertise I've been working at try Fork
for about six years and the last two
three years of my job there was
developing native apps for iOS so that's
the reason I came into this business and
I at some point I started looking at
automated testing for iOS anyway so the
point is that even though I'm talking
about iOS most of what I say will apply
equally well to Android development as
well so those are the two platforms we
support I also show you our our cloud
testing service and by way of example so
first I want to start off with the rent
or some of my own personal thing I'm
ranging currently so when we do service
our programming we have a couple of
things we do I just label them
professional practices you can call them
all sorts of things but the things we do
to ensure consistent quality and high
quality and a short feedback loop okay
like continuous integration unit testing
functional acceptance testing all
automated and then we go into mobile and
what happens nothing there we go all
right it's cowboy land for some reason
right no rules we just go in there check
it out ship it to the users it's like
all those practices that we used to do
they're gone
no continuous integration no automated
testing no automated functional testing
well at least that that was true a year
or two ago I'm thinking I'm seeing that
this is changing how many of the
developers in here are doing that's a
unit testing on their mobile products
that's not everyone how many are doing
continuous bills not saying how many are
doing automated
weapons are functional testing yes about
three so for some reason we seem to have
dumped those practices or we at least
not adopting and miss Foley probably
that's just because that we're we're
fairly new in the space and we need to
learn how to program first and so on but
I really want to encourage that we burn
this bastard and just invest the time
ones get those practices going again do
the continuous build and you're
interesting and seconds testing I'm
going to talk about automated accepts
and automated acceptance testing with
this you know there are techniques
together all those practices running on
mobile as well so invest the time all
right Rand over oh yeah I just wanted to
mention I was talking to the guys from
the eBay classified group they have a
booth out here vendor booth and they
were actually using this technology to
do automated regression and functional
tests and they reduced their manual QA
to from 2 days to about a few hours
using automation so I really want to
encourage you just not to listen to me
but also go out and speak to these guys
that are adopting in practice they have
a booth out here okay so what's the cue
a story like for mobile well as Brian
also said the reality is that we have
several devices you know they have
different screens they run different
resolutions okay so on iOS you have
three versions of the iPad you have
numerous well several versions of the
iPhone iPod touches even the newest
iPhone has a different screen size you
have the Rutina which is non macchina
and you know Android it's just man yeah
so reality is that if you really want to
test everything then well you can't
really write it's just too many so what
I mean by acceptance testing I mean the
thing that we do to ensure ourselves
that the app that we're going to deliver
to App Store or a market or whatever
channel we're using it actually does
what it's supposed to do so it's like
the final thing we do before sending it
off and saying okay we're good so
because it's the final thing we do we
want to ensure that it's done in a very
realistic environment because after all
there was this is the last thing so we
want to test on real phones you know
emulators and simulators are good but
we're more confident if we test it on
actual hardware that the users are
running and also these device
differences don't appear when you're
running at least a smartie not as much
when you're running simulators also you
know they're not only are the many
devices there are also many operating
system versions several versions of iOS
four to six now I guess is what's
commonly supported numerous versions of
Android as well and they have you know
different languages you may need to
support in your application and you have
a condition that's particularly are
interesting for mobile which is that the
network is changing a lot more often
like your network capacity is changing a
lot more often than if you're doing a
it's a web app for desktop the client
can be moving between no network
connection 3G or 4G or Wi-Fi and all
that impacts on how well your app is
functioning you can run out of storage
way more easily than another platforms
and so on
and from my experience all this testing
in most companies it's a manual process
so the companies I've been working on
we've had release cycles which are maybe
14 a release test release every 14 days
or three weeks and in principle you want
to ensure that everything is still
working right you have no regressions
when you ship this test version to your
manual QA people or your business users
and that is a fair amount of work and
quite frankly it's it's very boring
because you're repeating the same test
that you did over but you have to ensure
that you haven't crashed the I don't
know
submit screen or whatever and and it's
expensive it takes a lot of time and the
exam from eBay guys was was two days I
don't think that's unreasonable
and we just do see app crashes even
though something worth the previous
lease it's likely well it's not likely
but it happens that we break it in the
next release
so this costs another interesting aspect
for mobile is that the visual appearance
of the screen like the representation of
graphics and your brand that's really
really important users expect to have a
high quality user experience and so you
need to pay additional attention to this
and this is something that's kind of
hard to automate is the user experience
good are the graphics looking nice and
so on you can do something but it's it's
kind of hard to automate sorry I think
I'm making trying to make the case that
it needs to be done but also that it is
quite a lot of work in terms of hours to
do this just so to do this testing
whether it's automated or not so you
might argue well who cares I can just
test on whatever I have like an iPhone I
have an Android phone and and so on and
I just taste on that and it's running
the same version of Android or what
that's should be okay but the truth is
that you know these problems are really
significant so you can have crashes
depending on say rich iOS version you're
running that an API that may not be
available that that you're calling
crucial in the crash and also you can
have sort of graphical errors that
depend on screen sizes and resolutions
and so on and it was an interesting
example I think it was Android 2.1
yonis is sitting here you can correct me
if I'm wrong but there was a an Android
library project that try folk was doing
and they had to implement some security
infrastructure code and had to run on
Android to one and I saw that
occasionally so the log in thing would
fail for the Danish people this is the
nemi day library so you know what that
is and and it was sort of real really
weird and it turns out that on Android
two one I think it was the pic integer
class wasn't thread safe
this means that occasionally this crypto
computer
was going on would fail and cause random
sort of bad login failures so you can
have really nasty differences on
different operating system versions and
run the different devices also an
interesting thing is if you need to
support multiple languages text sizes
vary so if you have four languages in
principle you have four times the
testing burden because you need to check
that the all the text is still visible
and it look nice yam buttons and so on
so yeah there is a difference so here's
my list of criteria that I want of a
tool to support automated testing
acceptance testing so first of all and I
usually work in organizations working
closer together with business people and
for that reason I want to try and
minimize the distance between the actual
specification on what the app does which
is usually some kind of use case maybe
in a Word document and so on I want to
minimize the distance between that and
whatever my test code is doing because
if there's too big a gap then I'm not
really sure I'm testing the right thing
so particularly if there's zero distance
if the like the specification is acute
as an executable test well then I'm at
least confident that I'm testing the
right thing and also I want my tests to
be fairly expressive in a sense that
whatever the user can do I want to be
able to express the same thing same kind
of action inside my chest also I wanted
to be efficient too right because we all
know that writing tests code is also
something that costs time and
maintaining it cost time so the more
efficient we can have the technology be
and the last time we spent automated
testing and also we prefer extensibility
and that means several things but
particular one I'm thinking of here is
we prefer the open source versus closed
source model and for instance Apple has
a technology which is also doing
automated acceptance testing but the
problem is that the release cycle for
this is so unbelievably slow so if there
is a buck and there are box in a
particular version you have to wait for
a major or minor release of that
particular thing so just you're just
sitting there you can file a bark on
radar but you know I've never had
someone answer a buck that i file
so we prefer open source also this means
that you can take the project and build
your own version and use that for
testing all right there are also issues
of being you don't want to be too
low-level when you express your tests
because this means that if you're too
specific and what you test then when if
you change the UI slightly then all your
tests are going to break and you need to
go back to that so you want to stay
fairly high level so you want to test
enough but not too much because that
would incur too much maintain cost
finally we need to support testing and
realistic environments and what I mean
by that is I want to run my test on
actual devices running different
versions of operating systems and
supporting different languages because
that gives me more confidence in the app
I'm building is actually doing the right
thing and the final thing is I want to
support CI all right so this gets us to
calabash so the vision for calabash is
to do cross-platform
automated testing automated acceptance
testing I should say and the way the
sort of the interface you get to care
about is a technology called cucumber
and how many no cucumber already about
1/3 okay so I'll introduce it by example
and it's an extremely simple technology
but it gets us this property of having
the description of what the app should
do at the same time be an executable
specification well I say cross-platform
and I mean iOS and Android
because that was that's what
cross-platform means in Denmark or at
least in Europe of course there are
other players on the market and we will
will try to adopt those depending on
customer need and depending on you know
how it goes all right now we support
Android Annihilus and and one of the
visions is that you should be able to
reuse so if you're building an app like
the same app for different platforms
like using PhoneGap or you're using
native to build the same app for Android
and iOS then you should be able to reuse
as much as of you as you can of your
testing code to try and minimize the the
overhead again all right so calabash
will run on simulators emulators and on
physical devices that's one of the
project goals we support native and
hybrid apps
so by hybrid I mean apps that embed web
views inside of native apps and we do
not support pure web apps that's not the
intention of calabash it's free in open
source and an important point is that we
have a company that's backing the
project so that was a recent study of
testing projects and I think I don't
know was restricted to the mobile space
but certainly a study of open source
projects and it turned out that most of
them have about life span of one year
and then they sort of died one year or
less and sort of died but by having a
company that's backing the project
hopefully that can give more confidence
in so the long-term viability of the
project so that larger companies may
actually invest in it and of course
providing support helps with that as
well the final thing I want to talk
about is what we call device cloud or a
test execution environment and that's a
paid service that we offer like an
additional add-on service that you can
you can add to calabash and what that
does is that we are able to execute
calabash tests on real devices hosted
real devices and the test will run in
parallel on these devices and you get
the test results back and you know in
addition to that you get some visual
test reports so that you can see what
your app looks like on different models
at various points else you're an
examiner what this means and actually
I'll run a test live as well one
important point is that we run on non
zero non rooted devices and we try to be
as authentic as possible again to do
this we're aiming at getting as close to
what the end user will be running with
and we support CI with like this one
line command so I just want to show you
I should say this is a prototype but I
want to show this video because it rocks
was there an early prototype of the
testing lab where we run those tests
here so wanna see it in the big screen
it's actually sound but unplug didn't
you kidding at one point we had sound on
the phones as well and there was a
client that was testing a very very
strange app which emitted modem like
and that's the point where all the
devices simultaneously would emit this
noise and Yanis was sitting in the room
so he decided to turn the volume down
but the point is that we can run these
tests on real devices and offer that as
like a cloud service yeah it looks a bit
more organized now all right so now I
want to try and do demo for the rest of
the talk time is good and again I'm
going to focus on iOS because that's
what I know best and I'm going to use a
sample application that I helped
developed a try fork which is for the
Danish people I guess this is
international well it's the Roskilde
festival like this musical festival in
and the Copenhagen area where we have I
guess it's close to a hundred thousand
people so traffic developed an
application for this I'm not going to
talk too much about that the app it's
actually kind of interesting in its own
it uses react as its back-end it
actually created what this equivalent of
a react cluster of about 50,000 nodes
because each phone on the festival was a
react node and it would do peer to peer
exchange and so the application is
interesting is all right but I'm just
going to focus on testing and
particularly we're just going to test
something fairly simple there is this
menu the things you can see like the
artists they're just using test data
some some of the images some missing and
it may be incomplete but the point is
that you can like go go and find
whatever your favorite artists dead
skeletons and you can read a bit about
those and you can listen to some music
and you can favorite them and so on and
also we have this map component here
yeah you can use my location and we get
like an integrated festival map here and
you can find out where you are it will
actually if you push unless one of them
if you push this button it will find
your current location and which is
apparently somewhere in the US right now
which is because this is the simulator
and on iowa's it doesn't it just uses
this location you can
we set it button so that's I just want
to do a similar test like a lighter of a
test for for the artist list for this
and but first I want to talk a bit about
cucumber so cucumber is a technology and
well it's a notation way of writing
tests and a tool at the same time so
this is actually a cucumber
specification of a feature of your
application it's just a very simple
example and as you can see this is
actually written in pretty much natural
language you have something called a
feature which is like a feature of your
app it's called
artists and you can have a comment here
as a user I should be able to see all
relevant information about artists like
which artists are playing when and their
country and so on that's just a comment
and then each feature consists of a
number of scenarios and the scenario is
kind of like a use case so given I'm on
the menu when I go to the artists list
then I should see the artists list
sorted correctly okay so if you're in
the domain of this app you'd know
exactly what that means and I guess even
if you're not you still understand what
this means so that that's checkable and
here's another scenario so if I go to
the artists list and I scroll to death
skeletons and I tap the artists dead
skeletons then I should see details
artist details for dead skeletons so
this is something that's human readable
it's readable by non-technical people
like if you're in a bank you could
phrase this in the language of a bank
but at the same time this thing is
actually an executable specification so
this was the artist there's also one
from map as a festival attendee I should
be able to get a map of the festival
site it should include points of
interest and current location so here's
a scenario given I'm on the map when I
accept the my location button which was
the one I tried to find then the map
should move to my location that's very
understandable or given I'm on the map
and I'm at wrong she scene which is one
of the music stages when it's at my
location then the map should move to my
location and I should
see the orange page okay so this is
understandable and but the cool thing
and that's is that it's at the same time
executable so if I run this command
cucumber it will execute all the
features that I just showed you the SDK
version he'll just select the iOS SDK
version so 5-1 in this case actually why
can't you see that it's saying 5-1 okay
this is better so let's try and run this
it will detect where my app is currently
at and we'll start executing it we'll
wait for the menu and yeah that was
pretty fast it went into the artist and
then asserted it was there now we'll go
through artist detail and we'll check
that you're at the Dead skeletons page
now it goes into maps touch the map
button so do you see those and it waits
a bit because the device has to find
location now it does the thing where I
said once you seen so see that it
simulates the occasion at orange stage
here and it doesn't alright so this
seems kind of magical right I've written
this plain text and then I run a tool
and then boom it's an acceptance test
for my app and of course it's a complete
illusion and it's the way that cucumber
works is that you have each of these
scenarios that those correspond to test
cases and then you have each of these
natural language steps those are called
steps and the way it works is that for
each of the steps you have to tell
cucumber what does this step mean in
terms of executable code so for each of
these there is a what's called a step
definition which is actually you don't
have to understand the details of this
yet I'll just fold it in a bit what a
step definition is that it is that it's
a something that associates a regular
expression something that matches text
with a block of code so the way cucumber
executes is that it takes one step and
we'll find a step definition where the
expression matches that step then we'll
execute the code the corresponding block
if there's a ambiguity it will give you
a warning and the rule is that if this
block of code completes without throwing
an exception then the step past
otherwise it failed so a fairly simple
model and now my IDs gone crazy all
right and this is using Ruby because
that's the preferred language for
expressing tests for cucumber there's
also a project called cucumber JVM which
allows you to run or rather to define
steps in other well in jvm languages
like Java or Scala closure we're
supporting Ruby right now but we will
eventually also support JVM based
languages for expressing step
definitions okay now let me go into my
using Emacs for my slide presentation I
thought that oh yeah we've executed it I
want to submit this to the cloud so
execute while we are having a coffee and
having fun then run on real devices and
then we'll go back later and we'll see
the test results so you can do this
please don't look at what I'm having
because this is a secret key this will
be online this is being video recorded
so my secret API key is now totally
visible to everyone and I'll go and
delete it after this presentation so it
won't work the point is I have a
command-line tool I have a app I want to
run an IPA or an apk file and I have an
API key actually I'll use a different
one this is the less painful com website
here you can create API keys and what
those are is basically they lists how
you want to run some phones I want to
run a 3GS 5 1 &amp;amp; a 4 4 3 3 &amp;amp; a 5 forests
I don't want to run the iPad I want to
run English and I will generate and
what's called an API key for me and this
is this like the secret I use in my test
so let's go back where'd you go
yeah I use this key instead and it will
upload and check which version of
calabash you are using and what
dependencies you have and it will upload
this to a cloud execution will take a
few seconds okay now you go have coffee
or you listen some more to this so how
do you get started with calabash it's
actually fairly simple we want to have
you be able to install and run you can
go to these links I'll give you this as
part of the presentation material and
you want to see how cucumber executes a
run time and we will see how you can
refactor some stuff so let's go into a
fresh version of this mosque EULA
festival project I have one that that's
not using calabash already let's go in
it so to do this and in fact let me just
open it so you can see I'm not cheating
my Brian went I was going to tease him
with having a faster MacBook than he
does okay so I have this project well
there's not much to see I can run it
hidden simulator still a map okay I'm
not gonna leave this so from here you
can say you can install calabash by
reading instructions here once you do
this you can say calabash iOS setup
slightly different on Android but it's
the same kind of formula and this will
download the current calabash framework
version I'll explain that a bit more in
a minute and it will actually modify
your Xcode project file to generate a
new target that you can use for testing
and let's just verify that it was so
fast
you see here there is now a target no
you don't hmm okay there is a target -
kal which is a calibers caliber list
instead of word it's a version of your
app where you use in calabash and
there's a corresponding scheme you can
run and this gives you actually you say
the same app as you just had but it also
includes some code for automated testing
and I'll explain a bit what that code is
in a moment for now this is just for
doing setup so that will run and I have
to watch the video users got a bit tired
of that yeah if you are just less than
someone so now we are actually set up to
use calabash but we need we do need to
have a particular file structure to use
this cucumber tool and the tool can
generate this as well so do caralho
cyrus gem to generate and it will ask me
shall I create features yes please and
it's now created a features folder that
we can I don't know I don't even know
what the feature is but I'll run it by
writing just cucumber I'll run on the
most current iOS version starting up I
swipe left which doesn't do anything
that was just a randomly or not random
this is just a scaffolded feature so
let's remove this was the one that
ordered wart now you see this is my
project folder structure and the thing
that was generated was this folder
features where you put all your cucumber
features and corresponding step
definitions it's generating one that's
called my first feature which is very
uninteresting for most apps and so let's
write one which is artists artists list
and this doesn't make any sense right
given I'm on the welcome screen I swipe
left and I don't and wait until I see
you don't swipe left and I'll take a
picture so that's not interesting to us
so now we have to start testing and what
I want to test is if we just start yep
I should disable this and I can just tap
this and and I will see 2100 days okay
and calabash actually comes with
something which is called predefined
steps which is you can write some text
steps cucumber steps without giving a
corresponding step definition because
they were actually already they come
with calabash so you can actually start
writing a test in human language which
is kind of strange and I have to
remember what I want to test here we've
set up yeah okay so I wanna and I want
to wait for the video to go away and to
see this artists and I want to touch it
and then I want to see this
this band twenty hundred given wait for
wait see artists when I touch this thing
I should see 120 days okay let's try and
run this it's actually kept some of this
no let's run it from the command line so
I do cucumber and I want to run SDK
version equals five one and it will
restart the app start executing snart's
waiting touch and then something failed
which is kind of interesting it says to
me I should see 21 on 20 days but I
didn't find this text okay and the
reason that that's happening if we start
the app
oh man it was even worse as a developer
right
the reason this does actually slash
which is really annoying okay so let's
change the for some reason it was really
important that the bans were written in
this particular manner so let's watch
the video again you really hate this by
the end of the day it's nicely okay all
tests are green good
so you see I've not written a single
line of Ruby code by you actually start
testing so those are called predefined
steps with calabash okay yeah execution
with Ruby Mon you can actually integrate
this with your IDE which may or may not
be interesting to you if you're using
this Ruby mine ID you can actually run
it from in here except that it's hidden
by the IDE mmm which is kind of nice and
as I'll show you in a minute you can
actually set breakpoints and get a
debugging experience and so on all right
so one point of our cucumber is that
cucumber is really about the business
you should express your tests or rather
you should express your specifications
in terms of the language of the business
and this isn't really the language of
the business well imagine you're in a
bank so business is a bank this is the
Roskilde festival business and you know
I guess it's fairly neutral waiting for
some something or touching something but
it's really it doesn't have anything
particularly to do with Roskilde
festival or this app so let's try and
refactor this into like a cucumber way
of doing things and I want to make sure
I use the right wording here so I'll
cheat a bit just to make sure I'm not
inconsistent with some upcoming stuff so
I decided that the business of this app
is not to have two scenarios which are
not the same name so given I'm on the
menu right when I tap the artists menu
item and I see an overview for the
band's yeah so that's kind of implicit
but what I'm saying is that when I go to
the artists I
to see this band right but now I'm
certainly I'm not talking in the
language of buttons and texts and so I'm
just speaking about I could speak to
this to the like the customer and tell
him well is this what you want right you
go to the menu tap the menu item and you
should see this and they go yeah they're
worse but unfortunately this isn't
executable right so I run this it will
complain and tell me that after the
video
well you haven't defined all this stuff
what is all this stuff mean and it will
actually give you a definition how you
can do this right so you go into this
folder called step definitions there's
one called my first steps
this was auto-generated we don't need it
okay and now it tells me please tell me
what it means to be on the menu and in
fact you can use something which is
called macro or step which is to reuse
inside the definition not as a step but
inside the definition of a step you can
use another step so you could say macro
and I wait to see artists I think it is
which was just implementation I had
before but now I'm calling it so to
speak from another one and I tapped the
artists menu that's easy micro I touch
artists alright and I see overview for
the band so this is an interesting point
so I said that cucumber uses regular
expressions but you can actually have
capture groups inside those regular
expressions so you can have something in
quotes basically and that thing is going
to be passed as a parameter whatever
text this is here it's going to be
passed as a parameter to your test
script so this is an artist or band so I
could replace this thing in quotes with
anything retro I should see then I want
to
please excuse my Ruby this may look a
bit strange but this is just Ruby a
notation for a string where I can plug
in all sorts of stuff quotes and and
variables in here so I want artists but
then remember that I had to put a slash
right because there was a slash in the
text but notice that inside my business
feature I'm not using the slash so it
makes it a bit more readable and
understandable and hides away the
technical details run yay okay we can
express in terms of the business so now
you've seen like the most primitive way
of using calibration how to set it up
and and some of my presentation is gone
missing there we go
now what I wrote here is I just want to
have a few slides on the architecture
and I will check on time because I want
to make sure I have time for the fun
stuff I do so to get your back into
presentation mode just two slides here
so in general the architecture of
calabash is you have your app because
native hybrid and then you have
something which is called calabash
clients and you can have several
different clients so you have one for
iOS and one for Android those are both
written in Ruby and we have an
experimental project which is called
calabash JVM which should be a shared
client for calabash Android and calabash
iOS where where you write your step
definitions and JVM based languages but
the point is you can have multiple and
the reason you can S is because it's a
client-server architecture so you have
your app and then you have a calabash
server and actually the clients will
talk JSON over HTTP with your server so
this means it's fairly easy to create a
new client because all you have to do is
create the client side of this HTTP yep
so this server thing is sitting next to
your app and it does things like perform
touch events or look into the current
views what takes the there whatever
image is what buttons and so on and on
iOS and on and
there are slightly different
architectures but it's basically the
same thing that's going on on Android
you have a special separate app and your
unmodified app and then you do some
magic signing stuff to give the special
a privilege to perform reflection events
on your app on iOS you can't do that so
you need to link in a special framework
which embeds this HTTP server but it
doesn't change your app all it does is
perform touch events and query into the
view of yep okay so but it's the same
basic model and the way it runs is that
you have your features and you have the
cucumber tool that will execute your
features and that produces test results
and then inside your step definitions
that are written in Ruby or maybe Java
at some point then you will use the
calabash clients either calabash Android
or calabash iOS or both if you're trying
to do sharing we expose an API that I'll
show you in a moment that you can use to
do stuff too yet basically see that's
all I'm really doing light on slides
here so let's do let's do this yeah so
you've seen how you can use predefined
steps we've seen how you can use macro
steps but you haven't seen on the fun
stuff it's a shame for this guy he's
missing all the fun stuff okay the the
underlying API is what the power that
gives you is that you get to ride more
robust tests so it says that are not
sensitive to timing issues you get to
write more powerful there are so many
things that are not defined in
predefined steps so you have more
powerful api's you have faster tests
because there are some built-in weights
in the predefined steps and as you'll
see there's sort of an interactive
development experience that that I'll
show you so that means that developing
the tests is more efficient and so let's
start with that actually so using a
cucumber to run your tests is quite slow
right so if you're over here in your
editor writing your tests you're writing
your specification you're going into the
step definition and then you write
something here my weird function blah
blah and then you run your entire test
suite until the point where this exact
line of code is executed and of course
function doesn't exist you made a
mistake you fix it and then go all over
again
this is not a very efficient way of
working so for that reason we have like
an interactive mode where you can
interactively talk to your application
basically so let's show that the way you
run it is she's manually start your app
and then let's have the app over here
and then you um you run sorry from the
command line you run calabash hours
console and what for Ruby guys this is
just the RP that's loaded with the
calabash I ap is for everyone else it's
a magical thing that will make your life
better okay so what you can do here is
you can experiment with the calabash IP
ice so for instance that's tap artists I
never actually interact with their
scroll table view down Rob okay or you
can see I can't remember what this thing
is called but I can inspect it okay it's
query button hmm a lot of buttons all
this information is actually an array of
hashes array of maps and you can see
there are two buttons which are those -
the way that calabash iOS works is that
we use something which is called
accessibility on device which is really
funny I'd like to show it which means
that
you can't hear this on or maybe you
can't hear it on the video so that the
app is intended for disabled users to be
able to use apps so it's available on on
please shut up
good it's available on all iOS devices
that are more recent than 3d I think but
the cool thing is that it actually gives
us a very nice way from a test grips to
identify elements it's like IDs there's
actually something called accessibility
IDs which is this but accessibility
labels are the thing that it will say
when you get focused to a particular
item so we have a function that's called
label which will extract those labels
give me all the labels there's one
called back to menu and share likes on
Facebook
okay let's tap back to menu and there we
go okay so what you can see is that you
can sort of you can explore the API is
that calabash a iOS provides like query
like tap and touch it's failing because
I'm not giving any arguments and a bunch
of other APR start available and this
gives you an interactive way okay so
let's find an example suppose I go to my
less remote control is so fun go to
artists and I want to check that there
is a particular label that has a
particular text but I want to make sure
that that label is inside the table view
and you can use this query function
which is a very very generic query
mechanism that will do like arbitrary
queries into the current visible view
which is what you usually need and tests
so you can do it query table view and
will find all UI tableview objects in
the current view that's immiscible which
is completely nonsense because I want
the cells not the actual there's only
one table view but there are a bunch of
cells you see a bunch of those
but then query will support nesting so
you can traverse the hierarchy so inside
let's say the first table view cell find
me all the labels
okay so a bunch of labels I want to
filter no actually that's inspect those
so you can give a second parameter which
is a selector that's called on the
result oops
so inspect those labels and give me that
test text so there's this one which is
the one we want but then there's also
the description and the language code so
now I can write query say let's use this
I can filter based on this so inside the
first type of you sell find me a label
that has text 120 days slash okay right
and now I can express the test in terms
of this API which either fails throws an
exception that goes good depending on
whether this result is empty or not
right so you have quite a powerful
mechanism here another thing you can do
is you can change the Traverse direction
usually it goes downwards from the table
to the table you sell to the label but
you can also change direction so you can
do label text artists that's this thing
up here I happen to know in this
application there is a custom
implementation to the navigation bar so
but I can't remember class name so show
me the parent view so parent changes the
search direction to go upwards okay and
this is completely unreadable because it
gives you all sorts of useful
information and I'm only interested in
the class names so I could do ordinary
Ruby programming here that's an array I
can map an array result
give me the class of the results so I've
now discovered without looking at the
source code I've dynamically discovered
that the application uses a navigation
bar all right any questions on query I
mean I know it's a quick intro but you
you get the power that you can express
in in your test cases you can express
fairly detailed requirements on what the
UI should look like or what properties
like the text of a label or the color of
a label
let's try a new color I think I
implement that query label if I can
remember the correct selector it's not
color it's something else it was color
ah there we go I guess we got
representation of all the colors the
current colors of the labels the point
is that you have a fair amount of
expressive power in this query let's
move on all right yeah so let's try and
change our test suite I'm going to
deliberately go over time because I
promised because of the lunch thing so
hope that's okay so this was using
predefined steps let's change this into
using this API okay so I'm on the menu
what I really want to do is I want to
not just query for an aperture text I
want to query that there is a button
which has accessibility label artists
okay so something like this query button
there's a special name you use which is
marked to denote accessibility labels or
accessibility IDs and in fact I want to
do this interactively so let's check
this that actually gives a result
whereas this doesn't but this is just
something a return to result I want
something that throws an exception in
case this thing isn't there and in fact
I don't even want to do this let's just
try and do it
check element exists let's run the test
boom failure but the reason is what does
anyone know I'm saying this thing should
be there but the point is that there is
an animation that's moving right and
it's acid finalizes the menu becomes
visible and only then is the button
available so I need to use waiting okay
so there's a function and wait for
elements exists
note that this takes an array of
elements to wait for okay let's try and
run that and that will wait for a
default value of 10 seconds for this
thing to appear and then once it they're
able to discover it and it's just we're
going so you need to when you write your
test you need to usually express those
in terms of waiting instead of asserting
that something is immediately there you
need to say wait for this thing to
appear to obtain a robust test all right
and so I can go and tap the artists menu
and touch button mark that's the thing I
way for artists okay but then there's a
there's another thing going on here if
you start the app when I touch artists
there's actually an animation and then
you see this thing here it's a
navigation bar with the word artists
which tells me that I'm now on the
artists page so let's write a test for
that so I can wait for that's the same
thing elements exist and remember it
takes an array and then can you remember
from before if you do the console that I
I wanted to have a this label here but
that it was inside a custom component
right I did query you as seen via Gatien
bar if I remember correctly let's just
check yeah so what I really want to
express is not just the text should be
there but it should be in the navigation
bar so let's write a query for that
label text
artists all right that works it's tested
we can now paste it in and this thing
I'm doing now is what I mean by having
an interactive development experience
you test it out in the console paste it
into your code and then you're off yeah
I'm not gonna implement this let's just
run it last thing just a search that
this one hunt that this 120 days band is
there see I've given you a couple
examples of the API and this query
that's touch a swipe there's all sorts
of jesters you might need and so let's
go answer slightly more advanced yeah
you've all seen this a bunch stuff so
there's a couple of advanced things the
calabash iOS supports that at least not
all of them up I've not seen all of them
in other frameworks for doing automated
testing one of them is to perform
arbitrary touch gestures on views and so
particularly on iPad applications you
sometimes need weird just as to do
whatever the use is does and the testing
framework supports this I'll show you an
example let's go into interactive mode
and we wait we can start the console in
the meantime so let's go into this
kamemon simon show you this but it's
like the user can create its own
candidates and here you have this bigger
thing which reacts to direct touch
events you can actually interact with it
just by saying SAP I think 58 would work
yeah but let's ignore that for a moment
so there's something which is called a
record begin and that will actually
start recording a particular touch
gesture I'm going to perform so let's
just record a gesture where I move this
up here yeah then I say record end and I
can give this a name move up and now I
can actually use this as a particular
action in my test so you say playback
move up and perform that sequence of
touching so I was a bit slow which is
kind of cool but when you do this you
find that you often need to sort of you
know I want to perform this touch event
but I want to do it slightly differently
so what you can do is you can move the
location where you're playing back to
touch events by using query label text
Oh - so now I'm going to move the drag
event in a different location so now it
actually touched the zero - and move
that up and you can do other stuff we
can say interpolate and move up and now
I'm going to actually I'm going to take
that sequence of touch events I
performed I'm going to stretch it so
that will actually move two cells
instead of one you can imagine this
being useful if you have some kind of
drag drop functionality you just start
that's a query label text say oh three
and you can do end which is the end
point I'm stretching it to label text or
one and now I should see that it's
actually moving - which is kind of cool
I love this thing so this interpolate
which can remember I just did an
aperture recording of a sequence of
touch events and then I changed it I
transformed it using query and using
interpolate so this is a very very
generic mechanism that you should be
able to implement most gestures I
haven't seen it just I couldn't
implement on Iowa's using this so if
you're using iPad or if you have certain
drag-drop or whatever long press
whatever functionality you need then you
can use this mechanism but it's sort of
an advanced API alright a keyboard let's
do a keyboard entry because I think it's
fun can't name keyboard enter text car
something I want something longer
because it's fun to watch it
that's kind of cool right so it's using
the the software keyboard to enter
arbitrary text and it will actually flip
between these keyboard
Kiba planes to find the characters which
is kind of a nice thing to do so you can
use the keyboard inside your tests
location say feature it's only supported
on Iowa's 5-0 because it's using an
underlying API that's only available
there but you can actually do kind of
cool stuff set location actually let's
go to my location which is somewhere in
the States search location place is
office location disappeared but we can
tap this and we see we're actually in
all of us now and this is the API I used
to put my location at the anxious scene
at Roskilde festival so you can do this
but only on iOS devices iOS 5 zero plus
devices web support I should say a few
words about those yeah finally yeah yeah
it's on Android yeah no no it's because
my mind is wired into iOS so when I say
it's only iOS 5 oh it means it's only on
on iOS it's only file 5 over and above
and on Android it's there and although I
should ask you honestly sitting there
he's doing the Android development but
Android can do location simulation we're
using it for a client web so
unfortunately Brian's gone I'm sad
because the point is that with web we
can actually test PhoneGap apps and
hybrid apps which are native apps that
embed web components I know you're
getting tired but I want to finish this
and deliver my promise on getting you
late to lunch so where do we have some
webcam since news
yeah so in the implementation this is
actually come to management system that
generates this web content
it's okay as you're leaving I know
Thomas is running but usually the query
function you can actually query into the
webview so this just tells me yeah
that's a slight technicality here is
that the query function will let you
filter things where the center of the
component is not visible which was the
case here so let's query webview that
tells me okay there's a webview but what
I really want to do is look into the
HTML the current Dom of the webview and
you can use CSS selectors to do this CSS
: give me all the paragraphs okay a
bunch of paragraphs let's just look at
the first one so that you can actually
read what the result is and if you focus
on this so it's a map of all the
interesting stuff here's the HTML P
class named body text help us fill so I
guess that is yeah this thing here help
us fill the audience area blah blah blah
blah blah so you can look into this and
and you can do arbitrary CSS selectors
here you can use XPath if you want and
the cool thing is I don't have an
example in this app here but once you've
selected something you can perform touch
on it right so this means that you can
actually drive a web application by
finding the corresponding Dom elements
and performing touch do you believe me I
shouldn't try and find an app where I
can also don't believe me come down here
afterwards and I'll show you an actual
app where touch a link now everyone
believes me because I've just stated
that it works but there's nothing here
that's interesting to touch but using a
combination of query to assert into web
views touch to interact with components
and keyboard you can actually drive a
fair amount of web applications using a
fairly low-level API which we plan on
extending and making more as more like
the selenium API for web okay I think
I'll spare you for advanced query the
point with the one scary is you can form
arbitrary objective-c selectors on the
optics that you find when you do query
like you can form methods on a delegate
for a table
and so on but it's fairly advanced stuff
now back to the stuff here if all goes
well this a test report has actually
been run in the cloud yeah it did so
this was the test I initially showed you
running on the simulator which tested
artists and map I've run this on the
device cloud and fortunately everything
passed which is actually slightly
cheating which I'll show you why in a
moment and not because it doesn't work
but because the test was lying a bit so
when you go in here you will actually
see I've inserted screenshots various
points you can control it from the test
code so the point is you will see on the
I ran ran on three phones running
different versions of iOS 5 1 1 4 3 3
and 501 and different models the
forest's the four and the 3GS and and
will actually generate a visual test
report that you can show to your
business people or you can use just to
discuss and see whether our graphical
errors and this is working the
simulation stuff actually works on
device that's what's the first test just
a search that I can see my location
which is the location of the device
which is secret don't look at that now
it's not secret
it's our office and so this is the one
where I simulate location so actually
that was a slightly cheating here here
the simulation API worked here it
actually didn't and I was because that
phone was a 4-1 1 and here it didn't but
that was because I had a slight timing
bug where I generate the picture too
early depending on so there's like a
timing issue and it says so the point is
that you can run these tests on real
devices and on iowa's just seems to be
working pretty well and we have
customers that have crashes but on
Android you get kind of stuff like this
so we have a test report that's running
on number of different Android newer and
older Android versions and a number of
different models and this is just a
random like to screenshot the first page
of an app from Android Market go it used
to be Android Market
and you see you have this home screen
here and then you have like this weird
graphical thing happening in this case
on a HTC Wildfire on two to one and here
if graphics is kind of faded I'm lge
more weird graphics more weird graphics
and one of my favorites is over here
yeah this one is my favorite so this is
you have the home logo and it's weirdly
mirrored at the bottom of the screen and
the graphics is faded and this is on a
an exterior so what this test report
does is that it takes you calibers tests
execute on real in this case Android
devices and it great generates two
things an output for your CI so j-unit
XML that you can integrate in CI but
also something for humans like a visual
representation of your app and that's
what test reports - okay
I will wrap up now and just tell you a
few words on the roadmap so we want to
have more cross platform in calabash for
instance this query function I showed
you is not currently supported in in
Android but we will be developing that
quite soon and we want to have better
support for code reuse across platforms
so that if you have the same app for two
platforms you want to minimize your
testing code and we should try and
support that as well as we can and
there's also there's already a closure
based a proof of concept for JVM support
so I close your project which compiles
to JavaScript ease test from the JVM I
actually wanted to show it but now I'm
really running out of time and yeah and
it's open so we're very interested in
hearing your inputs on what's needed
what works for you what doesn't
you can contribute you can report box
you can ask questions on a free mailing
list and so on you have references and
now you have to ask questions for let's
say 8 minutes or just sit here and watch
me do closest stuff as I mean so any
questions
yeah question here yeah so yeah so there
are two stories here so the question let
me repeat the question that's the
important point the question is about
changing network settings so simulating
that the user has a slow or maybe no
internet connection or at maybe some
point later in the test he goes to wife
or he starts at Wi-Fi and then he goes
out the door and Wi-Fi disappears you
know all the stuff that makes your app
break and that is it's not out of the
box supported in calabash you can do
some scripting so on Mac OS so far OS
you can do some scripting of the
built-in firewall which will change the
the bandwidth that the simulator is
using so you can actually piss this into
your test on simulator so that's one
story on the device cloud with a hosted
service where we run on devices we have
no simulator and we we don't do this but
we're building it's not there yet but we
are building for a customer that needs
it we're building support to per device
turn up and down the network access
because it's really an important feature
so for a simulator you have to do a bit
of work yourself I know how to do it for
hosted we're building it but it's a good
question more questions yeah yeah
so cucumber is about the business and
we're working with cucumber and so this
mission you should focus on the the use
cases of your application driven from
the UI that's the test like the golden
path for use in calabash that's what we
want to do with that set you can still
do like functional type tests or
integration type tests where you're
driving the test from the UI but always
think of it as you're driving the test
from a UI from the users point of view
you can do like low-level arbitrary
invocation of methods in an epidemic 8
on iOS or arbitrary Android method but
that's not the intention but you can use
it to do this and in fact the libraries
are independent of cucumber so you can
download the calabash iOS and clevis
Android library and throw away cucumber
and just use the libraries
do automatic Nicolle system but the
cucumber side of it is about the
business I would I would test the
backend separately using whatever
technology your back-end is written in
so if you have a system for to say you
have a web back and rest service I would
use a separate system to test that and
like a functional integration type test
and then I would also test the same
back-end implicitly by going through the
UI because at the end that's what the
user is going to see the question is I
think the question is you can repeat
correct me if I'm wrong the question is
to get reproducible tests you want to
ensure that say your database is in a
particular state before you execute the
test and an answer is you can do
whatever you want because once you are
into step definitions you are into Ruby
code that's arbitrary programming you
can start your test script by before I'm
running the test I'm gonna call a HTTP
method that will reset the state of the
database to a known state and then I'll
run my test and then maybe after the
test like I set up teardown kind of
thing you can really say and yeah that's
a good way of doing it but you can
decide that's the point and because it's
arbitrary programming you're not bound
to like this text magical thing we're
into Ruby you can call methods on the
internet like rest services you can do
whatever you want so in your answer your
question yeah good more questions yes
you mean like the SQL database on a
iPhone yeah I mean there is no calabash
support for I did repeat the question
he's waving at me to not repeat the
question anything so the question is
what about support for the Vice local
databases like SQLite database and so on
and so in calabash you're going through
the UI and usually don't have it like
reset my database button and the UI at
least you could make a special test
build where you actually put and people
do this they make special builds where
they put reset buttons but you can also
do the bad stuff which is using some of
the lower-level functions to call a
custom method in
on iOS on your app delegate and then
have that do whatever evil stuff on the
device you want to do but only in your
test environment so just only compile
that function into your test environment
but yeah that I'm not talking about this
but there are like lovel low-level
backdoor functions to do technical
things like this and people use them
yeah not a question okay so the question
is will the tests take a lot of time to
run and is there a way to limit that
time for an instance to to do some kind
of analysis where you're running tests
that are only relevant to the code I
just checked in if you're doing CI and
no that's not something we support that
would be a sophisticated analysis to try
and determine okay I'm only on the
artist screen and I only want to return
run tests there no you have to set that
up manually if you have some kind of but
there are ways to restrict how often you
run tests there are ways to restrict
which tests to run you can use something
called text and cucumber to say I only
want to run the things that are tagged
with this particular tag and and you can
do various performance optimizations to
make the test run faster the way our
customers use us is they usually run I
mean on the device cloud they usually
run one test a day at night so they
don't really care if it takes five
minutes or thirty minutes because who
cares you're sleeping if you're running
CI on simulators then maybe you're a bit
more concerned and you can do some
optimizations try and eliminate sleeps
from your test and so on and try to use
waiting and speed-up in general but yeah
regarding analysis no no support for
that more question let me check time
yeah two more minutes we need at least
one more question yeah it's it's based
on how many apps you're testing so we
have we count an app as a platform so if
you're developing the same app for
Android and iOS that's two apps
otherwise you'd pay there is no
particular limit on on how long your
tests run and we will if some client is
using too much time we'll
try you know make a reasonable deal with
them but we don't have like a strict
limitation on how long time you can run
but you pay per app and you can run
whatever you want but we say once a day
is the the common thing because you're
running in CI it perhaps nightly yeah
and you have different prices depending
on how many ups you get some discount if
you have more EPS and something you can
check out the website for current
pricing now it's a fairly I mean the
device so the question is you have
instructions to set up like your own
device cloud the truth is that that like
that's our business we are pretty good
at developing and maintaining and
operating this device cloud and at one
story is that you don't really want to
do that because we know that there is
quite a lot of pain we're trying to do
less pain but there's quite a lot of
pain involved in operating and having
this run reliably and consistently so no
there's no instructions for that you
could build it but it would require
quite an amount of research and you know
sweat of operations to have it running
Stapley which is why we provided as a
service right we may at some point open
source a internal framework that we have
to do device automation on iOS we
already have some device automation on
Android that's available but scaling it
to a cloud level is something that we
sell and it takes a lot of work yeah
good question do you want lunch all
right thanks I'm very available for
questions and talks afterwards always
thanks for listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>