<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2012 • Support Offline Mobile Web Apps with HTML5 API's • Kim Dalsgaard | Coder Coacher - Coaching Coders</title><meta content="GOTO 2012 • Support Offline Mobile Web Apps with HTML5 API's • Kim Dalsgaard - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2012 • Support Offline Mobile Web Apps with HTML5 API's • Kim Dalsgaard</b></h2><h5 class="post__date">2013-03-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BmgDnlsm-kw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Kim delco i work as a
independent consultant in web and iOS
development and i will tell you about
supporting offline mobile web
applications via html5 so I got a little
agenda here first point is application
cache that's how we can take our
skeleton and and persisted on the on the
mobile device so we don't have to have
online access to to actually run the app
the mobile app the next three is a
different way of storing our data it is
very important here to separate the
application and the data that the
application uses it's a common pitfall
to to put all in in the app cache and
then help terrible things can happen so
first of all how do we take care of the
application and then three different
perspectives on saving the data on the
telephone or at the device too so let's
start with the application cache is that
big enough to read or should I make the
font bigger fine okay this is from the
date the w3c spec and it it's just
telling us what we can expect from this
specification it's it's about taking a
web application and and use and when
when we are not connected to the to the
Internet and the way we do it is by
providing a manifest so this guy is Jack
article he is he was a lead developer by
land yard and he is now transferring to
Google and he has been traveling the
world with with this with this store
called application cache is a douche bag
and if you look in the in urban
dictionary a douche bag is something
like like this in over inflated sense of
self-worth so it's not very flattering
to be called the douchebag and I think
maybe it's it's too harsh to call a call
the application cache at a douche bag
I'll i prefer a comparing application
cast to my sister-in-law and she helps
me out with my do-it-yourself jobs at
home and and she it's not very good at
it but she is very eager to help so last
time she was there she was tooling eight
millimeter holes in egg I wouldn't door
so the secret put a wall clocks in and
school and screws and so I think that's
the kind of guy this F caches eager to
help but but we take care of it it's not
always as good as it says it is ok now
the technical parts to to use an app
cache we have to to include a an
attribute manifest in the HTML tag and
then refer a manifest file on the server
and usually this file is called cache
manifest but it's it's a careful choice
the files that are referencing a given
manifest violence will go into the app
cache as master entry we will see why
this is important later so
a manifest file consists of four
different sections the first section is
a header and the very first line should
read cache manifest and there should be
no empty lines above we do comments like
this with a hash mark and then we have a
cache section a fallback section and a
network section and I'll go through
these in a moment when serving a cache
manifest file we have to serve it with
the content-type text / cache manifest
in it's about to be dropped this
restriction but in the implementations
now in both chrome and firefox we have
to to give the right mime type or we it
won't be treated as a cache manifest
file oh that was the cash part the cash
part is where we put in the files that
we want to be on the app cache control
so here we put a style sheets the
JavaScript files and the like we there's
the file that that has the cash
manifested it's no you don't have to
mention that once again it's it's will
be in the cache and you don't have to do
anything to to put it there the
resources has to be loaded with the same
protocol as the manifest file but do not
have to come from the same origin so if
it's a HTTP cache all the files that are
in the case has to be HTTP and not https
for example fall back
here you can if you if there's files
that you don't want in your case may be
there there big images or something like
that you can you can provide fallbacks
for these so here sa images / cars
should be replaced by images / cars grey
card at jay peak if we are on offline so
and we can we can give a URL name space
or we give a absolute you I'll yeah to
to the fall back and the fallback
resources have to come from the same
origin as s the manifest file the
network part it says it's very important
and in the misunderstand in this part we
if we don't provide a network section
here we cannot we can only serve files
that are in the cache application cache
so if our application has to go to
internet and get other files if it's
online you have to specify something in
in a network section and if you specify
a aspects it will be possible to to go
to any resource on the internet with the
same protocol if you specify something
more specific like this you'll be
restricted only to to use these
resources from within the cash
you can omit the the cash section if you
put something between the cache manifest
header and in the first section it will
be included in in the in the cache as if
it were in a case section this is a
little trap if the browser cache is
still active underneath the application
cache so if you request something from
the application cache it will go to the
Bowser's normal cash and that can be a
little bit dangerous we will see that in
in a moment here we had the double
refresh deal if if we are we don't wait
to see if we are online if we have
requesting something that's on the cache
location cache control we are showing
the page instantly and then afterwards
we'll go and see if we are online so if
we are online and they say something new
to our cash then that will be loaded but
the page will not be reloaded so we have
to make a double reload if something has
changed and we will see that in a moment
if we delete a manifest file then the
cached the application case will be
deleted on the client so that's a way to
get rid of of being under K application
cache control so we can just remove the
cache manifest and then the cached file
will be removed yes this was this is
actually enough to to make a application
to put our web application on the cache
control but
if that's not what we want this and in
the nice API to the application cache
too so it's placed on the application
cache poverty on the windows object and
that is the cash for this given master
entry so this this object has a poverty
called status and here we can see what
other status of our application
cash-on-cash that means that this is not
under any cash control an idol that
means that we are in s.s steady mode we
we have collected what there is to be
collected and we have refreshed and so
on there are some methods there's an
update method when calling this update
method we will we'll go and see if
there's any changes and the to see if
there's any changes the app cache is
looking for changes in the manifest file
so per definition if the manifest file
hasn't changed there's nothing new to
the cash and if the manifest file has
changed then we will reload the whole
cache if we will regret this operation
we can we can call a bot and then stop
maybe we are on edge network and and do
not want to to wait for the cash to to
download and when we are succeeded we
can call swap cash and then the new cash
will will come in the newly downloaded
cash but it will not reload the page so
resources being asked for after this web
case swept cash will will pick files
from from
gnucash this is a seldom-used normally
we will make a reload of the the whole
page there are events that we can listen
listen for checking is the first event
that we will get it will get it when
when we are starting and to look for a
new update the next event we can get is
a no update that means that the manifest
file is the same manifest violence
violet that we have on there on the
client downloading that means that we
have found a difference between the two
manifest files and we are now
downloading the cash again and progress
we are getting progress events so we can
see that something is happening cached
that means that this is this event will
only fire when we for the first time is
caching the web application so so the
first time that we are taking this page
on the under cache control will have a
cached event file and afterwards when we
have downloaded a new version we'll get
an update ready we can get an obsolete
that was what we saw before if you if
the manifest file is gone then we will
get an obsolete event and and the case
will be cleared and lastly we can have
an error that means that something went
terrible wrong
yes we can try to take this these slides
offline we look at the code go and find
the app cache file and here at the HTML
tag we'll just put in a manifests equals
cache manifest
and now we need to make a cache manifest
yeah I think we will steal one here
so now we made a cache manifest file and
and I'm referring the style sheets and
did JavaScript files that makes up this
application I have a single fall back
here I say the stylesheet github that
CSS should be replaced by style sheet as
passively / CSS when we are offline and
I say that the network you can you can
fetch whatever you want from the network
so let's see if we reload the page I
said error that's not good
yeah I did thank you I did that in the
html5 scary scary yeah so we when the
new now we introduce the appcache to to
this side and we send a la vie cut back
at checking event it found them deaf
manifest file we started downloading
there was some pocus and then suddenly
there was i catched and now we are under
cache control so let's try to kill the
server now we should be offline let's do
it again what's the saying this cash
okay that's choose files I missed so if
we are missing any files we will get an
error we can't use a cash that is not
complete so we we have a fully
functional cash or no cash that's the 22
possibilities so we'll go and fix this
case manifest
yep cassius's
more nicer
stop it
what NASA muddy can I spelled modernizer
I stop the server yeah right we have we
have to reload it while we are yeah
that's great and now we can stop this
over again now we have a new copy yeah
right
so game feel it's not failing
oh that's the camera here we are getting
so what happens here is that we can't
fetch the manifest file so so for normal
purposes this is on now on the cache
control so we can see the style sheet
has changed for them for the code and we
are now showing this page without being
online
so now we're back online again and it
should change the now the cash is
playing a game with me the browser cache
so it is a kind of a little bit of
douche-baggy but it it actually works if
you have the time to just fill it now I
think everything is back to normal so
there is a working group working on on
making this better but but I think it's
as it is right now it's usable and and
you can you can take a look at what's
happening underneath by by using chrome
tools the resources we can see that as a
cashier you can see what's files are in
the cache and why they are indication
and you can go and look at combs app
cache internals and we can look at the
actual files that I in the cache and see
the HTTP responses for these files so
even if it's a little bit tricky to to
to use this there's a good tooling fight
and and when you have it working you're
it is stable so now I have when I have
this one under cache control I don't
have to worry much about it anymore
the cash application cache is only for
for the skeleton of the application it's
if you use it for for data it tend to to
go wrong if if you change something you
have to reload the whole cache so if you
if you decided to pick one point one
data file instead of another data file
you have to reload your hole yep so I
don't I prefer not to use the app cache
as as a data storage so and here's a
little look at where we can use it and
on the mobile side it's in iOS and it's
on Android and it's coming on and the
windows phone so it sits perfectly
usable right now okay next up is it's
one of the three different storage
mechanisms and this is the most symbol
of them all it's local storage and it's
just a giant hashmap in in in the
browser
this particular storage type is spanning
a or F single origin so it's forgiving
origin and and the browser has different
hash tables different local storage for
each origin that it's it meets so it's
it's perfectly safe to use you cannot
you cannot go into another pages and
other origins hash map and do anything
there so this is an important part of it
the keys are strings so you can use you
can't use a a number you can use a
number but it is converted to a string
everything is converted to a string
before its use as a s a key and similar
values are strings so if you have
complex objects and you want to store
them in local storage you have to
realize the mess sta tion something like
that there is a gate item method that's
that takes a a key and we join some
value and you get a null back if if if
the key do not exist there's a set item
taking a key and value and and if the
key is already in use the value is
replaced and otherwise a new key value
pairs is added remove item take a key
and remove the item from map and there's
a clear that clears the whole the whole
local storage so you as a client can
always get rid of of the database
there's a length so you can ask how many
key value pairs are there in the
database and there is a key takes an
integer and give back the key if it from
the given key set at that index it's a
little bit of syntactic sugar on top of
this you can do use square brackets to
as you can in normal objects I think
that is the preferred way to choose to
use this key stone here's a little
example I i think i will go for the
console example instead we can add any
origin we can go in and say give us
local storage and then we get a starch
opaque object back and we can look in
that and say okay it has a key i have
been playing around with it so let's
let's say local storage that clear so
now we have a empty storage up yet links
0 so we can we can add a a key and a
value some string
you
so you can look at the object again yeah
we have a fubar key so if we try to
store something that is not by a key
that is not a string for example 1 we
look at the storage again we can see it
has actually converted this you can see
that it has converted the key to a
string if we use a more complex thing
for example a function we can declare
function if as it's very simple function
and we use that function as a as a key
we can store a value for
whew that went well and we can use the
same f2 to get it back but if we make
another function with the same this
looks exactly the same we'll get full
back that's because the function is
converted to a string everything is
converted to a string and and then used
as a key so be careful with non strings
like the key here is function as a
string there is a event you can listen
for an event called storage on window
and if we have two sessions open in the
same in the same origin on the same
origin will get an event from the if we
change the key will get an event in the
other session so we can synchronize two
pages from from the same origin that way
there are some limitations there's only
one hash map / origin so we have to put
all while they are data in one table and
it's synchronous one of the few things
and you have a script as synchronous
this API so if you stop really big
amounts of data you learn it will take
time to you'll find that that everything
else is going to a hold so you have to
take this in to consideration if if you
choose it it's a very simple way to get
storage so if if you can live with these
limitations it's it's very very easy to
use
so when can be used yes supports almost
all over you we need to go back to
internet explorer 7 fun for finding
something that do not understand this
and on the mobile side there's all green
the next possibility is web SQL database
this is an API for storing data in
database that can be crude using a
variant of SQL and this is actually a
way of getting a handle on a SQLite
database so so if you're familiar with
SQL Lite it's it's it's very familiar to
you to use this there is a problem
that's that the specification is no
longer an active maintenance so one of
the reasons why this has happened is
that to be a specification in w3c there
has to be two implementations and nobody
wants to reimplement SQL Lite just to
make this specification so they have
abandoned this and but there's still a
great support for for this on mobile
devices so opening a database there's
three different way to do that first you
can give a name a version a longer name
and the initial size of the database
in bytes you can also give a function as
the last parameter and that function
will be called for the first time the
database is created so you have a chance
to initialize it a problem with these
two is that if you don't if you guess
wrong with the version number then you
just get an error back and end and you
can't do anything so the best way to
open the database is by not supplying a
version give you the empty string and
then you'll get a database back in the
newest version that is you can then ask
if this version of the you have just
opened has the same version number as
the one you expect it to get and if this
is not true then you can call change
version give it the parameter of the
current version the version you want to
go two and then three callbacks change
error and success success and the change
function will take as the first
parameter and transaction and this in
this transaction you can alter the
schema of the database so here we have a
migration path you can go to so if if
you are if your database is a brand new
you will give it version 0 or otherwise
you will just take the past int of the
version and then you can say okay if you
and use you older than one please do
this if you're older than 2 please do
this and so on so you have a migration
path you can go to to get all database
schemas synchronized you can't just push
a new database schema to get to a client
you have to to wait for him to to open
the database
if something goes wrong it will call
error and if it succeeded we now have a
database with the new and and asked for
version number changing the database
scheme we use the transaction that we
were given in the interchange call back
and we can execute SQL on on that
transaction and we can do something like
create table alter table and so on so
here we we can change the database
scheme and we can can add in data or
delete data we can when we are finished
with the database we can do transactions
on that database to we can make a
transaction by calling transaction and
give a call back to that function and we
can do SQL stuff in indeed in that
callback from the function here and we
can provide an extra error and an extra
success callback so where we can get
notified when when the transaction is
over or if it failed we can also make a
read-only transaction so that be only
have read capacities but but do not
hinder order in inviting in the database
yeah we can we can execute SQL this is
an insert statement and in the ? CR are
just replaced by by parameters in the
next parameter and an array we can get a
result set back we do an SQL statement
we get a transaction and a result set
back in the success and we can then
transfer train trestle to reverse this
this result set if you look at the
support for from web SQL we can see an
in the mobile side we have full support
in iOS and full support the Android so
even in the newest version of iOS their
support for for web SQL so I don't think
it will go away in in in the near future
the only problem here is what would
happen in if if Microsoft's phone takes
off I don't think they will implement
this specification so so if if if you
have plans of being compatible with with
Microsoft Windows Phone you should maybe
consider the last choice here
and the last choice here is index DB
index database that was introduced as a
replacement for for web SQL when they
abandoned that and there's a common
pattern in the index to be and it is
that if you call an object with an
operation then you get a request back
and on that request you can attach
unsuccess and on error callbacks we can
open the database there is a special
call by cleared called on upgrade needed
we are providing a name and a version
and if that version do not match the
version that is currently in the
database upgrade needed will be called
and in that upgrade needed we can do our
schema manipulation so that's almost the
same as we saw in web SQL we have a
function here where we can do the schema
migration jobs and the the success
function here will be called when the
upgrade is is done we can create update
stores and an update store here is is
similar to a table in SQL world and we
can so that's that's kind of a bucket
where we can put in a JSON documents we
think we can if you just make a
updatestar called foo we will have to
provide keys for every update that we
put in if we provide a key path when we
create the update store
the object store will go and look after
this property on the updates that we
store and use that as key if you give a
auto increment to then we have an
automatic feature that gives a give skis
through our objects so I gave sequence
where we draw numbers from and if we
give both a key path and a auto
increment to then we will make
automatically make keys and the key will
be stored in in the key path poverty we
can make indexes and an index has a name
and a property that means that we are
making an index here called name and we
are picking out the the poverty name on
our objects and install that in the
index we can tell it to be unique and we
can only have one value / / / index and
we can tell it to be a multi entry to
that means that the property here emails
is an array of email for each of these
there will be an entry in the email
index we can make transactions we do
that on the database we specify here
what are the object stores that we want
to include in our transaction so we are
spanning over the two pockets here
called foo and bar we can span over all
the buckets by giving a empty array we
can make read write or read only
transactions if we only give a single
string here it's it's the same as giving
away with a single value in it if we
have created an transaction we can
attach and uncomplete on error and on
airport call backs on the transaction
and there is no explicit send or one or
anything on the transaction the
transaction is run the next time we hit
the the event loop on the browser so we
don't have explicitly to say okay go
that takes a little bit getting used to
writing the code it will events the
bubbles so you can you can attach an
error handler to your database and if
that goes anything wrong in a
transaction the the event will bubble
and an end here in this color back yeah
adding data you can add again this is a
synchronous data adding so we have to
make it a chance a request for adding
data and we will attach unsuccess so we
are having a call back when the data is
actually stored so this is this is a lot
of code but it gives us the possibility
to store things as when correctly we can
add data requires that that key is is
it's a new key and if you use put we
will overwrite anything that's in the
key
and we can get data again we call get
and we get our crest back and on that
request will put a a call back and when
the code like files we have gotten data
there's a little bit more compact way of
writing the same code here this is
assuming that that we are handling
errors on the database level so we just
attaching an unsuccess yeah but we can
chain chain the calls we can remove data
that's the same pattern as we saw and
there's a possibility to prevent default
that's normal the dumb scripting so if
we catch an error and we don't want it
to bubble we can prevent default then
there's cursors and cursors make us give
us the possibility to traverse our
buckets our objects doors the main thing
about these cursors is that we are
giving this callback is called for every
element and we call continue to get the
next call to so this is a kind of tail
recursive way of doing it
we can use when we get a cursor the
cursor has a key and a value and the
value is the object that we start under
the given key it's not so this is an
index so we can get a value from an
index by calling get the first element
get on sorry get the get the element
with the key one so that's the way if we
know the key we can get the element out
but we can also open a a cursor on a
honor index as we could open a cursor on
a on a up X door we can make a key
cursor and then we are not getting back
the value is really only getting back
the keys so we if the keys give any
meaning to us we can traverse the keys
and find out which element to be to want
to have the value for its a cheaper
operation that we have to make another
call to get the actual value we can make
ranges so we say I want the keys from 10
to 20 this is a very simple value
arranged consisting of only one element
that we can make them more complicated
we can see lower bound for that's for
and lower we can see lower bound for
komatsu that's lower than 4 and so on we
have a rubber and a bound that give us
the possibility to to limit in both ends
we can change the closest direction from
can not normally it's it's the next
so we started from the start and even go
up we can do an opposite and here we
have next unique it will jump over the
keys that has already been been been
used and previous unique if there was a
last call back on the on the database
that will have been looked at yet let's
unblocking unblocked if we have two tabs
open with the same database we can
update the one and not the other so if
the database is open and we try to open
yet another in another version that we
have open indeed in the other tab will
get a call back yeah unblocked so we
have to close all other types too to
actually be able to to update this
database
this is if and a new our specification
so so there's a that's vendor prefixes
so if you will use this you have to to
just bypass them in the perfect
something like something like this when
can I use it's all wet on the mobile
side here and that's not good but i
think it's the specification of the
future i think in in a year to we will
see that this will get in all the major
browsers we can take a look at the
complete here we can see that for Chrome
for Android Firefox for Android there's
already support what we can do while
waiting is we can use this gym that
takes index DB and put it on top of web
SQL so this is the same implement almost
the same as as firefox has done Firefox
has put index to be on top of SQLite so
this guy has has done the same he's
taking the the web SQL database that is
a SQL Lite and and he has put the index
DB on top of it so I think this is a
fairly good way to go until until them
until the specific case announcer the
implementations is catching up
yeah sorry this was that that was all
for sorry if I have delayed yeah I have
sorry thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>