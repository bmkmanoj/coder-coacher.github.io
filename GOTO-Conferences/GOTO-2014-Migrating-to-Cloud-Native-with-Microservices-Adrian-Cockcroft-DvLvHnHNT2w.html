<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2014 • Migrating to Cloud Native with Microservices • Adrian Cockcroft | Coder Coacher - Coaching Coders</title><meta content="GOTO 2014 • Migrating to Cloud Native with Microservices • Adrian Cockcroft - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2014 • Migrating to Cloud Native with Microservices • Adrian Cockcroft</b></h2><h5 class="post__date">2014-12-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DvLvHnHNT2w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I've been giving versions of this
joke for quite a long time and several
years and for a long time it felt like
you could summarize it up as baffling
later doctors as a service that was what
I did I was like that was my job to go
out and talk about these things we will
just get a powerful phone I'm gonna sort
of go through how that evolved over time
and so starting in 2009 we started
talking about Netflix doing stuff in the
cloud and everyone just said we're just
crazy people and we weren't even doing
that we couldn't there's no way we could
be possibly doing that we were just
trying to get some press and making
stuff up what we actually did in 2009
was we moved the movie encoding back-end
which is several thousand machines
because we only had a few hundred
machines in the data center and we had
to encode more and more movies so the
encoding was a huge batch job it's not
customer-facing if anything went wrong
with it it didn't matter we use that as
the first test to see how the
relationship with AWS would work right
it was a fairly large scale we ended up
with several probably a few thousand
machines in that account and we
developed the support relationship but
it was not customer-facing so if you're
looking at moving to the cloud working
with a cloud vendor for the first time
put something that's not customer facing
but as as big as you can get it's a big
batch processing kind of jobs is good
the other thing that moved to the cloud
then was the logging we were overflowed
the disk space in the data center for
all the logging information so we
started writing it to s3 and then we
started processing it in the cloud by
using Hadoop in the cloud and we used
Amazon's EMR because it was easy and
then they just stayed easy so Netflix is
one of the big users of the elastic
MapReduce function that amazon has and
well these people are keep complaining
it's hard to install Hadoop clusters I
have no understanding of what that's
about because you just say please make
one and ten minutes later you have a big
Hadoop cluster that's that's the way
it's been since 2009 so anyway that's
the Netflix approach so that's all batch
processing kind of stuff the next thing
that happened
was people said okay we believe you're
doing it now but it's not going to work
when you try and put customer-facing
stuff in the cloud so at the beginning
of 2010 the very first piece of
customer-facing
website was put on AWS and by christmas
all of the customer-facing website was
on AWS and the example internal
presentation we had at the time was an
aircraft going down the runway and you
had two choices when you get to the
runway you either get enough airspeed to
take off or you crash and there's a big
ball of fire right those are those
really your two choices and it was like
you either get everything working in the
cloud or we run out of data center space
around about November and Christmas is a
big traffic load and there will be fires
and there will be sort of failed
whatever there would have been a Netflix
equivalent of the Twitter fail whale
right nobody knows what that was because
we never ran out of capacity because we
did get it running in the cloud so that
was important but it was a you get one
chance and there's a deadline and you
can't move the deadline you just have to
get this to work so that was a fairly
intense year
that was where most of the architectural
work was done and most of the
presentation layer code and the business
services and a lot of their data feeds
were moved to the cloud but the backend
original data source was still in the
data center so we didn't have backups in
the cloud and the system of record was
still some data center systems that were
supporting some previous logic for doing
DVD shipping so 2011 people said okay
this looks like it works but you're a
unicorn
they were very strange no one else will
ever want to be like this and that was
the year we started using Cassandra some
of you may have been in the data stacks
talk just now so 20 late 2010 we did the
evaluation to decide what to try and we
tried prototyped a few different things
in the beginning of 2011 we rolled out
the first Cassandra cluster and it
seemed to work so we kept working and by
the end of 2011 basically all of the
data sources that mattered we're running
a cassandra in the cloud in multiple
clusters there were probably ten or
fifteen different Cassandra clusters
this is distinct every micro service or
every data source has its own cluster
right if you think about everything
being any different cluster you can't
really do transactions and joins anymore
because the data you're trying to
transact isn't in the same database
and the data you're trying to join isn't
in the same database so it forces you to
put all your transactionally enjoy any
kind of stuff and anything that needs to
be consistent is handled in application
level code right that is no longer a
database function so that's why it does
there's no point having all the
functionality of a relational databases
no doesn't make sense when you've only
got one table right in per data source
basically so that's kind of the way that
looks so people basically started
agreeing that maybe yeah this looked
useful but it was kind of weird
so during 2011 there were a bunch of
outages where Amazon went down and
Netflix didn't and everyone else went
down Netflix didn't so why was that
what's because we actually architected
to be highly available and people said
okay well we like that
so in 2012 we said okay we do like these
features it's scalable it's highly
available you've got a very fast
development pipeline you stay up when
amaz when Amazon goes down and and it
looks very in its low cost and you keep
carrying up at conferences and baffling
people so that looks good but they
couldn't figure out how to do it
themselves because the gap from what
Netflix was talking about to what
everyone else was doing was just too big
so 2012 studies seriously open sourcing
a lot of code there's now I can't even
keep track I think while in the last few
weeks Netflix has released four or five
new projects on github just in the last
few years there was another new one
yesterday I came over what it's called
there's somewhere between 40 and 50
projects on github when they're not all
cloud architecture pieces but probably
half of them a cloud architecture about
a quarter of them a big data analytics
related and then there's a bunch of
random libraries and stuff so we started
on that program we started open sourcing
it and then in 2013 I'd be going off
doing roughly the same presentation and
I'd run into people saying ok we're
using some of your stuff we just need to
figure out how to use it we just don't
understand why it's done this way you
know how do you put this together so the
conversation just evolved right so that
was kind of fun and the end of 2013 I
made the decision to leave Netflix
because I found so many other people
trying to use our code and trying to do
this work I wanted to work on a broader
platform I want to instead of just
trying
get Netflix to work I wanted to see if I
could get everyone else to work right so
I have a new job but just before I
talked about that and we talked about
the what I learnt in that time you know
what did I take away from it and what
Netflix was optimizing for with speed
like if you're a small company and you
want to win in a marketplace you need to
be able to run faster than everyone else
you have to develop faster you need to
learn things faster and use the clicker
country and to do that you take friction
out of product development you want to
getting things built faster and you do
that with a high trust low process
environment with no handoffs between
teams and that comes from having a
freedom responsibility culture that's
that's a really key thing it's very hard
to build cultures like this and it's
very difficult to keep them but this is
one of Netflix's key competitive
advantages is this culture and we've
talked quite a lot about culture and
Netflix and it's a key key competitive
weapon that Netflix uses to compete
against companies that don't have a
culture that will let them go fast you
also want to take out all the stuff that
gets in your way that's boring that
isn't key to your business so this is
undifferentiated heavy lifting so
building data centers somebody else can
do that it's very hard when you're
growing fast I mean the interesting
companies are growing fast right if you
have a companies it's almost running
exactly the same size all the time
they're not growing their share price
probably isn't going up they're probably
not that interesting to work out right
they're not developing new products if
you're developing new products and
you're growing fast that's the
interesting companies and those
companies make it have a lot of problems
predicting how much capacity you're
going to need so Netflix didn't know how
much data center space it would need
where it where to put it and it would
have if it had guests it would always
have guessed wrong and there would have
been big outages so by using AWS is
capacity and using a small proportion of
it just a few percent of the big you
become a small fish in a big pond and
this works the cloud if you're using a
cloud vendor you want to make sure
you're a small fish and that they're a
big pond if you end up as a shark in a
paddling pool it doesn't work right
inflatable paddling pool with a shark in
it that's not a good place to be right
so if you discover that you're like
the biggest customer of something or
you're 90% of the traffic into something
that's not comfortable right it's there
are times when you kind of have to just
there isn't really an alternative but
generally speaking you want to make sure
you're using a cloud vendor that has
enough capacity that you become a small
piece of it and then the statistical it
starts to look elastic and it starts to
look infinite you know you want to you
want to have it feel like it's
infinitely elastic even though there is
a limit somewhere then the other thing
was as a architect for this team what I
did we didn't have an architectural
review board and architecture documents
and definitions of what the architecture
was it was an emergent architecture
there were a lot of very senior people a
lot of very experienced people coming up
with ideas and the good ideas would get
traction and people would listen and I'd
write them down and I talked about them
and the ones the bad ideas we'd have
arguments against them and sometimes
they'd implement them anyway and then
they find out really they didn't work
right so we didn't talk about that
publicly so the bad bits of the
architecture never got talked about
publicly but I picked the good bits and
talked about it and one of the side
effects were that was new people would
turn up for Netflix you know new
recruits and they'd have read the
architecture slides that I'd been
presenting and they think this is the
architecture so we go Camp retraining
the engineers we were hiring by talking
about our architecture in public and the
other thing is that you get to try out
ideas and public and find out whether
they're good ideas whether there are
better ideas because you get into
interesting discussions at conferences
so definitely encourage everybody to
take whatever internal architecture you
have and talk about it externally go to
meetups go to conferences talk about it
you will learn so much more about your
own architecture and you'll be able to
influence your own engineering team by
the fact that you're talking about it in
public it's very powerful I really
encourage it and made a conscious
decision in 2010 to go to the Q con
conference and then I found about the
go-to conference and this holds this is
probably the best overall global
conference series the Q con go to
combination and Yao in Australia it's
it's an extremely good series of
conferences they're very well run and
just some of the bit you learn a lot
here so that so I've been very very
happy to get more and more involved in
in the
this whole series of conferences and
happy to get invited to Berlin as well
then there's this thing that you can
take stuff you were doing in the data
center and just do it quicker in the
cloud but then you're not really you're
missing something you can do things in
the cloud that you could never have you
would never have attempted to do in the
data center there's things that don't
make sense to do in the data center and
you can go you know I can just do this
in the cloud because it's there I can
I'm a little you know two person company
but I want to have a ten thousand node
machine for a few hours you know we
could never you don't have a data center
to do that but you can just go and
create a ten thousand no to do cluster
if you you know for a short period I
weigh me might need to argue is Amazon
to get your your yeah your account limit
set fairly high but but it's poor it you
know it's certainly possible to do we
had some experiments where we launched a
few hundred machines in Brazil it's very
difficult to ship machines to Brazil
they have all kinds of importers and
things like that but we created it one
afternoon in about ten minutes then
after about a week we discovered that it
wasn't really helping optimize our
network latency in the town in America
so we shut it down again walked away
right don't try that with a real ops
team because you'll have to hire someone
in Brazil and then they get really
pissed off when you fire them and you
know six months later because it didn't
work you know that's really annoying but
you can do this sort of experiment in a
week we did a large-scale like once we
decided we wanted to test Cassandra for
a multi region very right intensive
workloads so we just deployed ninety-six
nodes with two terabytes each there was
200 terabytes of solid-state disk so we
did that in a hallway conversation after
a meeting about 20 minutes later it
existed and then we loaded 18 terabytes
of data into it and while that was
running it took a few hours we went home
the next day we beat the crap out of it
and every possible dimension and then we
shut it down a couple of days later
right I don't know what even what that
machine would have cost 96 machines with
64 gig of ram 2 terabytes of SSD in 6
different data centers spread on in
Oregon and Virginia right don't go into
your ops team and ask them to do that
and listen you will not get a happy day
right but it was trivial they have to
ask permission I know we spent a few
thousand dollars but we went to that
same meeting the following week and said
okay this is what we tried we worked we
benchmarked it if you want to use
cassandra for right incentive
replication we proved it works we know
how many gigabits we can drive we know
that this is stable right and the whole
architectural argument they've kind of
gone on for weeks was just like shut
down right at that point okay
it works like this okay okay let's worry
about the next problem now so you can go
to you know it's like working code wins
arguments you know infrastructure
experiments in the cloud wins arguments
too so you can win those those does this
work arguments by just trying it out and
that's something you could never really
do in in a in a normal environment all
right so this is this is the enterprise
IT adoption curve missus the cloud one
so Netflix in 2009 was doing cloud and
then actually the rest of world you
can't really see it the green is very
washed out here there's a line there
that his rest of world was doing cloud
and they can enterprises ignored it
ignored it then they said no and then
Kurosawa was doing it I said no damn it
oh no oh crap now we have to do and then
they went over and did it so this is my
Twitter icon I was playing around with
this stuff fairly early and my new job
is over here where there's sort of big
collision as Enterprise IT is finally
adopting cloud and there's sort of all
of the big noise and explosions and you
know things that are happening in
enterprise IT is there trying to figure
out what this means
so my new job at Battery Ventures is a
venture capital company we invest in
small companies and big companies and we
particularly investing in enterprise IT
and companies around things like docker
things like cloud oriented security and
automation and sort of monitoring tools
and things like that okay so this is
actually the year that enterprises
finally did embrace cloud and I put this
up at the beginning of the year as an
assertion and more recently I've had
some evidence and this is one piece of
evidence from October Liddy Liang who's
the Gartner analyst covers cloud what a
difference a year makes my Gartner's
one-on-ones the
gartner symposium everyone's already
comfortably using infrastructure and
mostly amazon bit of as you write that
is the state of the world right now and
that's big old companies that have
probably been saying we don't use cloud
for the last few years and they are
doing it now we also have the DevOps
Enterprise Summit and this is something
I tweeted Nordstrom went for optimizing
for IT cost to optimizing for delivery
speed and that really summarizes up
what's going on an enterprise now they
are you know the IT group used to be a
cost center and they would optimize cost
and they finally realized they were
slowing everything down too much and it
was ending up costing more because it
took so long and then if you stop
optimizing forecast and you start
optimizing for speed things happen so
quickly that you don't you can't
actually spend much money on them and
they actually end up cheaper so there's
this weird thing where if you just
optimize the speed you get low cost but
if you optimize for low cost it ends up
costing more right so there are a number
of number of projects that were just
that the DevOps Enterprise Summit this
is the other comment and you can't
probably read this very well but this is
a VP from forest and he says this is
this may be the very best conference I'd
ever been to unless this so go look at
the if you really want to see what's
happening go watch the videos from the
DevOps Enterprise some it was two weeks
ago in San Francisco was the first time
had ever been held there was 600 people
from make said this was for the horses
instead of the unicorn so it Netflix and
Etsy where the unicorns of DevOps right
this were the horses there was the
Department of Homeland Security
seriously they are now an agile shop
turning stuff around in days to weeks
that used to take years the UK
government is another one
Macy's Target Nordstrom Raytheon were
doing sort of military projects with
agile in them now and they find you know
there's endless stuff like this it quite
incredible it got really really worth
seeing that's if you're in a big
enterprise and you want to inspire your
management for how you could really
reorganize and really make an agile and
speed everything up your go find go find
something there all right
so talk about you know if you're if
you're an incumbent you're one of these
big oil companies what separates you
from the people that are trying
to disrupt you and this it comes down to
this
this quote it isn't what you don't know
that gives you trouble it's what you
know that ain't so it's the things that
you've believed in that are no longer
true and you know things change over
time so you set yourself up you create a
business the business has some
assumptions and then the business model
makes some optimizations and you
optimize for these assumptions and then
you have a billion dollar business
running on it and you say this must be
good but meanwhile somebody else's
notice this assumption isn't true
anymore
and they found a better way of doing
things and what happens then is you
suddenly disappear a market will
disappear or almost overnight because
you don't see the disruption coming I'm
just going to talk about one kind of
disruption here the assumption that
processes prevent problems right if you
look at any HR manual or product
development process or government laws
right what does it look like it's scar
tissue it's like every time somebody did
something wrong they made a law to say
don't do that again right and that's all
your product development process
consists of every screw-up that ever
happened every time you have a broke
production you made a rule or a meeting
or a process step that stops it or a
gate right and it just slowed down and
if you actually think no scar tissue
think of a sportsman think of somebody
who was in then in their 20s was like a
Olympic athlete or something and then
you see what they look like when they're
in their 50s they can usually hardly
walk and they've got boned me I've got
knee joint replacements because their
body is a mess they've tore it apart
right and they wore it out and they've
had so much scar tissue they're no
longer agile right so you get this
problem old companies old countries and
old processes to get less and less
i-chart
so you have to keep tearing things out
and removing laws and there's actually
the UK government right now is
systematically cleaning clearing out
lords you know they're going I'm just
just removing stuff simplifying you know
then what I wish the US government would
do that we just built a new thing coming
in it's going to be a big mess there
anyway
we shall see so there's a couple of
couple of books that are useful for this
the goal is a book from 30 years ago
it's a lot of MBAs you know
businesspeople they've studied this book
it's about how to optimize manufacturing
which was the problem then people had
Theory of Constraints totally all the
sort of quality management things this
is a a book that's written it has the
same plot it had some of the same
characters but it's set in a modern
software development environment and it
talks about a company that can't figure
out how to get software built because
there's complete warfare going on
between the development and the
operations and the security team and the
management and the product management
that know everyone hates each other and
they're just all biting and that's kind
of the normal stage for a lot of
companies so this book is about how they
fix that with DevOps basically so and if
you if you're trying if you're in a big
old company you're trying to get them to
figure out what the new world looks like
this is it this is a novel it's actually
a horror story if you're in IT because
it contains everything that ever went
wrong that you've ever worked in there
we go oh we did that oh you know it's
full of moments like that the target guy
the DevOps enterprise summit got up and
say the target the guy near target the
big retailer they said he bought 23
copies of this book he gave a copy to
all his management chain and all his
direct reports and he made them read
them and they went to an off-site and
they raw played scenes from it now you
don't have to go that far this is the
impressive dedication but the entire
target team is now running full agile
devops and they are you know for a big
old retailer they are becoming extremely
effective so I'm going to look at the
product development process briefly and
this will kind of lead into the whole
microservices thing because it kind of
ties into this so this is what well the
colors are very washed out sorry the
screen said so this is a great thing
so we observe orient decide act this is
Condor sometimes called the OODA loop oo
da that's you can have any kinds of this
loop but the idea here is that you start
off by trying to see you're you know
trying to innovate
right how do you what does innovation
mean innovation means you can measure
customers and you can see something you
need to do
maybe there's a customer with a pain
point you've got a customer acquisition
webpage and you know certain number of
customers land on that page but only so
many customers finish it right so you've
got a funnel that's dropping people so
you go why are people not finishing this
is can I improve that page so that's
that's a common kind of bit of
innovation and then you do some Big Data
you pull in log files that have never
been looked at before and you join them
with other log files that have never
been looked at before and this is why
big data is unstructured if you've
already got all this data it's probably
in your bi system right that's not quite
the same thing the whole thing about
having having to get masses of data
throw it into Hadoop or something the
key here is that you're trying to figure
out what to do next then you want to
basically plan the response just do it
and share the plants because this is a
this is a continuous delivery agile
model where the engineer that noticed
that there was a problem is empowered to
fix that problem right you're the owner
of the the customer acquisition flow you
don't have to go and make every change
doesn't have to get approved by
management right you're just working
you're working on this you're doing
going around this loop several times a
day perhaps right and then finally you
use make an incremental feature change
or automatically deploy it and you
launch an a/b test to prove that it's
better right
and this goes side-by-side and if you
prove that you've actually improved it
you switch over to the new code so what
we're doing here is we're launching
features behind a/b tests rather than
changing the entire production
environment now there are also
arrows pointing in the opposite
directions so things go you know you
don't just go around the loop in one
direction you bounce back and forward a
bit but the key point here is that a
company that can you know have its
workers bounce around this really really
quickly learns a lot more you learn more
about your customers you learn what
works and one of the reasons that
Netflix has been so successful is
they're extremely good at navigating
around this kind of Luke you have a
question just do it
that was yeah it was there's one of the
managers a son is they before him
something obviously just do it
right that was his response so that's a
JFDI you just did why you asking me to
do this you should have already done it
you know it's one of those things just
look at the silos yes thanks for
spotting the little jokes there not
everyone spots that so this is kind of
what a typical organization looks like
you got the product management
organization with their own reports and
then you've got the user an inter user
experience people maybe they've got
their own management chain development
have their own management chain then QA
probably reporting to the same people as
def but the DBAs may report into the
admin chain on the sysadmin they've got
network admins and admins or maybe even
another bunch of varieties of admins
right all with their own reporting
chains and to get anything done
you basically have to try and get it
across this this end-to-end
so you have you know meeting meeting
meeting meeting ticket ticket ticket
ticket and you wonder why everything
takes a year to get anything done right
what you really want to do if you form a
product team that goes horizontally and
you say these guys are going to pretend
they're a start-up and they've put in a
different building and they can do that
whatever they want and they don't have
to use our computers and processes
you're building a monolithic site team
that has owns everything from the
product through to delivery right maybe
your mobile teams are organized that way
so you do a bunch of those than you
realize that it's kind of messy because
they teams aren't learning from each
other well right in the infrastructure
as if it's kind of commoditized so what
you really want to do is have micro
service product teams doing lots of
stuff independently but talking to each
other with api's and then you want to
have one platform team that takes into
account all this stuff and have an api
between the two so now you've got this
is an end-to-end team that doesn't need
to have meetings and tickets to get
something done and when they want
something from the platform they make an
API call they don't make they don't file
a ticket right that this is the key this
is what cloud and DevOps and whatever is
where it all meets you know with Netflix
the
platform team mostly work for AWS like
up to about there and then there's a
platform piece of the platform that
Netflix had to build to customize it to
what we wanted
and there's actually pieces of platform
and stuff in the in these product teams
as well and it's actually much more
complicated than this but this is the
general idea the point here is that
these aren't just like project teams
these are actually the organization of
the companies along there so this is
actually the reorg is that now you're
your senior management sit here and
these are alignment line management's
that report into it so this is a team
with its own management and everyone
reports into that team and the managers
set out on the site so it's kind of like
a 90 degree shift on the org chart and
that's if you're really doing DevOps
properly then you you do the blending
and you do this sort of team oriented 90
degree turn on your org chart and then
everything gets much easier to do the
problem it's a little less efficient but
the point is that it's a lot faster and
if you go faster you end up winning
somewhere else so this is part of you
know robbing Peter to pay Paul kind of
kind of things that if you know about
that an analogy is so what's this one a
monolithic app looks like you've got a
release plan you have a whole bunch of
developers they're all using the same
language framework you throw their code
over into QA who work on it for a few
days to get it working then they throw
it over to ops who replace the previous
release with the new release but every
now and again QA find a bug so you block
the entire release then ops find a bug
and that blocks the entire release and
one developers blog bug blocks all the
other developers work write that work
doesn't work out reach the customer no
work at the work that has not running in
front of the customer hasn't achieved
value yet right so this problem here is
this is fine when you've got four or
five developers right when you've got a
hundred developers it's insane because
one developer blocks everything and you
can't really tell where in this monolith
something broke so you have to call all
100 to say who broke it right will be
every Friday
Netflix there'd be an email to like
everyone in web engineering it the
release broke can you consult can
everyone have a look to see if their
stuff broke and we went this is crazy we
have to do something better so that was
kind of the realization that we had
break this up and this is kind of the
fundamental reason why Netflix
transitioned when it went past about a
hundred developers on a monolithic app
it is too painful so we switched to this
this other way of working we have lots
of release plans independently happening
at different times with different
product managers and lots of different
groups of developers working on totally
different timescales updating at
different frequencies using different
languages you no longer really care and
they have api's between them to the
extent that they need to talk to each
other and then they release using a
standard framework and I've just put
docker on here because basically I don't
care what it is once it's in a container
I know how to deploy it so this is a
containerized deployment platform for
the way Netflix built this originally
was with a Mis the Amazon machine images
anything you could put in an ami we knew
how to run that in production right
doesn't really matter it was in Java or
Python or closure or what doesn't matter
right but it's an ami and so the system
that puts code in production you had
about a.m. is in production so nowadays
but ami is take minutes to build and
minutes to deploy whereas docker a
second so it's nice it's much better to
do this with docker and you'll see next
week there's a lot more to talk about
docker now and Netflix is actually doing
a lot more stuff with darker and
Amazon's doing more things with docker
so look next week there's the Amazon
reinvent conference so at the end of
next week
hear a lot more about this you can speed
stuff up so basically if I get a bug now
and one of my things I just go I'm just
gonna redeploy that one thing and they
didn't block anyone else so although the
all of the other developers get to
deploy and any one thing that breaks
doesn't cross break right now
occasionally you get things that
coordinated across more teams but that's
an exception so you optimize for the
usual case which is I can change this
thing as often as I want and every now
and again there's an exception that I
have to coordinate more broadly because
I want to change an interface right and
that's you optimize for the normal case
and you treat exceptions on it as per as
you need it basis so this to be really
clear this is for non-destructive
product updates I didn't remove the old
version of the code I run the side by
side lots of versions so this is really
this it sounds a bit odd until you
realize how powerful it is
I can deploy totally broken code to
production
okay no one's talking to it the old
version still there I didn't remove the
old code so ever all that cost traffic's
going to the old code that works the
fact that I have new code in production
doesn't matter I'm the only code I'm the
only user that has tweaked a variable to
make my account point at this new code
I'm the only person in that AP test cell
right because I'm the developer and I
poked at it in production so I could do
my testing in production in a fully
product environment on my one little
test account that I've got set up it
sits there it figures it all out and
once it looks like it works to me I'll
point the product manager at it and
they'll get happy that it looks good to
them and the QA team maybe we'll do some
end-to-end testing and say it looks ok
then the product manager will actually
allocate a group of customers into the
test cell right using some tooling to do
that and then maybe a few weeks later
they say yep that definitely is better
than the old way of doing it and they'll
to make that default for everybody and
that's the way almost all new features
deploy at Netflix it's that's the flow
right there's a test so you twist check
it in production and then you turn it on
it's actually quite difficult to
generate Netflix and test because a lot
of the Netflix clients are things like
Xboxes and Playstations and they they
they talk to the the external
PlayStation Services and it's actually
quite hard to tunnel them into a test
account it's actually much easier to
test television sets in production it's
kind of hard to get a TV set to talk to
an internal system ok so I talked a bit
about docker this is kind of what
Dockers like that there's a company I'm
working with it builds a complete API
server in dock in go write all their
codes written in go they wrote an entire
API server and go and they said you know
how long it takes to compile that from
source code from just text to an
executable built binary it's 400
milliseconds it's not point four seconds
this is a substantial piece of code so
that's how fast docket that's how FAR's
go compiles then you stick it in a
docker container which takes you know a
second maybe probably less than a second
and then you deploy the container on
your laptop which in the first time you
do it you have to pull in the
dependencies but the second time you do
it it takes a second maybe right and
then you go to a test environment and it
copies just the differences to your test
environment
mean you've normally done this before so
all the other dependencies already there
takes about a second let's go to
production yeah another second so it
just took like five to ten seconds and
I've gone through maybe if I can run my
test suite in a second as well right I
could have a completely tested
environment that's gone all the way to
production in almost like running a
rebel but you know this is a compiled
system with all the different steps you
used to do but things that used to take
minutes or hours are now taking seconds
okay so does anyone see why docker is
viral okay this is why developers once
they get their hands on this they go I
don't want to go back to the old way why
should I take minutes or hours to do
things that take seconds it's you know
so there's a better way it's a proof
that you can do it so this is really the
key thing and now there's docker itself
is becoming pretty well-established and
Chris Swan is doing a talk tomorrow
about the ecosystem tomorrow afternoon
if you're into that into this ghost see
Chris's talks it's really he's been
tracking this very carefully there's a
whole pile of people building
orchestration options Amazon is talking
about doing something in this space they
haven't said exactly what but they
started saying they're going to Google
has got very strong support for it as
your has strong support for it Microsoft
is now figuring out how to do a Windows
version of docker
so there's lots of different tools so
that's cool so what's happening here as
we keep making the cost on the size and
the risk of change smaller and we kept
going faster and faster so if you
basically if you'd start if your company
figures out how to use micro services
you start developing stuff in deploying
it in seconds right you can turn so fast
and then you start using a/b testing to
figure out whether things really make a
difference and your teams are operating
independent you can get a big team of
people working on it so that's that's
why this ends up disrupting people that
are doing waterfall or doing sort of
old-style stuff that takes weeks so
let's look a definition of micro
services isn't my definition anyway
right look it's a loosely coupled
service-oriented architecture with
bounded context loosely coupled means I
can update them independently because if
I have to update everything at the same
time it's not loosely coupled and the
biggest problem usually is that the
database over couples it and Martin
Fowler talked about this this morning
right if you've got one database schemer
and you have to change that before you
can update all the services
your coupling through the database skin
so you want to split your database apart
and you then have to figure out how to
keep all of the bits of data in sync but
that's a different problem you still
have to do that the other thing is this
boundary context comes from domain
driven design some of you might have
seen Eric Evans there's a book on this
think of this as what do managers do in
a development organization well I've got
a big problem that we're going to launch
in Germany you know Netflix has been
workers working on this over the last
hole of this year probably one way or
another so let's break that into smaller
problems and have teams working on each
of those parts and then those teams
break it into smaller problems where an
individual engineer gets to build a
piece of it those are the bounded
context right that's it's a management
discipline of how do you decompose a
problem into chunks of work where you
can work on it in a relatively isolated
way right so that's something that
managers should learn and they should
understand the domain driven design
concept right it's it's not an easy
thing to get right but there's a whole
book you can read on it I'm not going to
try and explain that in this
presentation but if you get good at
doing that then you automatically get
lots of little micro services that are
nicely isolated have good stable api's
and contain one thing and don't don't
contain like half a thing or four things
right that's kind of the way to think
about it so what we're trying to do here
is we set up an organization that
basically follows Conway's law backwards
so we Conway's law says that the code
will end up looking like the
organisation that built it so what we do
is we build an organization that looks
like the way we want to the code to look
right you lay your organization out and
then you assume that teams will build
groups of microservices and that's the
architecture you'll get and it makes it
very easy when you see something broken
to go to a certain team and say you
broke it right it's over everyone ended
up in pager duty size isn't really the
issue with micro service it's more about
being single function
the average machine size at Netflix is 4
cos 32 gig of ram that's kind of the
typical you know there's some bigger
ones are some smaller ones but almost
all of it that's a single jpn yeah with
20 gigabyte heap yeah the big fat
machines they're not really micro in
that sense and you don't really care
what your idea of a container is but
there should be a container there should
be a stat the platform nodes
a container you can put anything you
want in it so if your container is a JVM
you can put you know Java or scholar or
closure in that container because your
continue know how to deliver JVM based
stuff right it gives you a more freedom
and then this is stateless you know if
people heard the capital versus pets
analogy it's become reasonably common
some of you have alright so so my
version is is ok so I have a pet cat at
home and if it gets sick I've taken to
the vet and it's very unhappy right and
you know if there's machines in your
infrastructure where you know their
individual names and when they go down
everyone gets unhappy that's a pet
machine right sometimes click call them
snowflakes or whatever but that just
means but it's a pet if there's one
machine that can take down your entire
system or enough of your system that
people get unhappy
it's a pet but let's say you have a herd
like a herd of cattle and you want milk
right so I get so many gallons of milk a
day and a few one day several of the
cows die overnight or get stolen by a
bear or something or whatever they run
away whatever that my herds a bit
smaller but I still get almost as much
milk right I didn't you know and we're a
bit short let's get some more cows right
I don't the cows don't head individually
have names they have numbers right so
you know Daisy and Buttercup or whatever
you call cows here right so you don't
make known into pets and this is this is
the important thing it's heard so what
Netflix did in production we said
everything in production has to be a
herd there will be no pets right and
even if it's a herd of one that's a
replaceable one and it's in an amp they
use Amazon Auto scalars to say there'll
be one machine and if it goes away we'll
just make a new one the older scaler
automatically makes a new one and if
there's ten machines and one goes away
well then we've got nine that will just
make a new one so Amazon automatically
remakes the autoscaler automatically
creates the right number of machines and
you can dynamically order scale if you
want to change with traffic but the
point is that you're growing and
shrinking a herd and you can lose an
entire herd if they all get sick through
the same disease or have the same bug
right but but that's a different problem
what you're talking about here is I can
kill any but individual service and if
any individual instance and the system
will repair itself so this is why the
chaos monkey that Netflix has just
conditioned
shoot anything it likes because they
just automatically replace and every now
and again the cows monkey finds a pet
that somebody snuck in and there's an
outage and management's a great win for
the chaos monkey and this was after a
major outage the site was down for an
hour's like the chaos monkey found a pet
that was that was the response they
didn't have a go at the guy who'd put
the pet in he just give us a ready
he was already embarrassed enough right
you can do this on the business logic
layer you could the chaos monkey also
takes out Cassandra nodes which have
terabytes of in disk that disappears
when you delete the note like this is an
attached storage we just deleted the CPU
you deleted the disk space too right and
it just creates a new one it sucks the
data over
it's a hands-off operation if a met
Cassandra Clinton node goes bad it
repairs itself right that's that's and
there's a there's a blog post about
about the fact that they do that
so I'll take betweem at Netflix this is
the Netflix OSS lots and lots of code
here it's a globally distributed
large-scale system it's one of the
larger customers one of the larger
customers of AWS and it's one of the
larger applications out there lots of
projects on github lots and lots of
posts on tech blog just I have trouble
keeping up with them myself right so
just how big is this well this is us
bandwidth for Internet and you know this
is the Amazon ELB this is inbound
traffic to basically to AWS right bigger
than YouTube there's more traffic going
to Netflix from TV sets this is logging
traffic then youtube uploads okay and
then this is the outbound which is
basically nginx based traffic from
Oakland connect which are CDNs this
isn't coming from AWS this is coming
from machines that Netflix owns when
they launched in Europe recently they
set up a rack of machines in France in
Paris and it's a one terabyte capacity
rackets sort of turbit switch and it's
capable of feeding a terabyte of videos
to France right and I don't know they
probably have one in Germany as well so
that's kind of the level this is this is
lots and lots of terabytes of
traffic this isn't nearly that much but
this is probably you know tens of
millions of requests per second going
into AWS anyway so development actually
much time have I got all right and
getting a bit and going a bit slow here
there's a whole bunch of things here
about good ways of getting into micro
services let's skip on a little bit
something to talk about fuel things so
there's there's lots of code here
there's some good examples we'll talk
about monitoring micro services right
you've in cloud native system you've got
a really high rate of change code pushes
calls floods of new instances coming in
configurations don't stick around very
long and it's very complicated to do it
so you have to kind of build systems
that can deal with that
and then well question is how many micro
services should you have well Gilt
Groupe can really see the line on nexus
washed out but they have 450 services
right and this is their architecture
diagram for 12 of them and this is the
Netflix architecture diagram the Twitter
architecture diagram which is a chord
graph again it's washed out of it and
the group on one looks the same and that
there are all of these architecture
diagrams look the same and you're
changing this stuff really frequently so
you need better visualization so you
need tools that can track stuff that's
changing so if you break it you need to
know that it broke and the problem is if
you break something and yours you get
one minute updates a few minutes after
it happens you could have a 10 20 minute
30 minute outage because you turned on
you hit a you enabled some software and
in production but if you can see that
you see it every second you know you get
a 10 second outage right so what you
need is monitoring systems that can tell
what's happening second by second and
one of the Netflix projects called
hysterics and you've got you know you've
got circuit breakers that flick in and
you say if you you push code and it goes
like that you go oops turn it back off
again it goes bad like that okay that
was good we just had a five second
outage that's within the retry of
everybody's browsers no one will notice
it's not really an outage if it's less
than the browser really less than 30
seconds that's my role right because
you'll just get a retry
and there's some monitoring tools to do
is vivid cortex company I work with who
I've been working with them they're one
of the battery portfolio companies it's
a my sequel monitoring tool but it's a
very very detailed look inside what's
going on on the pipe on the protocol
wire they're also working on Redis and
Postgres
I think they've got post grows out in
beta right now but basically database
layer monitoring with one-second
granularity they can see that they can
see your database stalling for a second
and boundary who have a monitoring
system that runs on a one-second update
as well so what I basically want is your
metric to display latency mean the time
between it actually happening in the
real world and customers getting
affected to you seeing it on a graph
needs to be less than ten seconds right
so that think of that as an important
way to look at your monitoring systems
okay I've just got a couple more slides
and this is a new slide I've been
playing around writing some code yeah
can't see those either I've been trying
to model and visualize microservices and
I've been writing some coding go and I'm
building it as a it's a simulator is
really nano services because all of
these are running within one go program
but I can have tens of thousands of go
routines where each one is pretending to
be a micro service right and then they
can all chat to each other and I can
actually play around with protocols and
behaviors of a large scale system so I
could simulate a Netflix size system
which is maybe 20 or 30 thousand
machines I can actually lay that out in
the simulator and have it generate
traffic as if it was behaving you know
coming and going right and then I'm
trying to figure out how to visualize
that so I'm using d3 to do that and I
don't know maybe I can show you this
very quickly
oops yeah come here there we I have to
click on now
where's my browser stupid thing come
back over here that is not my boat
somebody asked never buy a boat find
other people that lifeboats if we got
any traffic oh it's not yeah I think the
Wi-Fi is too bad all right forget it
yeah that's boring
all right how do I get back to my stupid
keynote thing yeah anyway
it'sit'sit's force directed graph and it
Wiggles around very satisfying looking
way it looks like a jellyfish it's very
cool so I wanted to show you the
jellyfish but you know this is there's
too too bright all right it's not all
hooked up so if people want to go and
play around with microservices and go I
have some code and I've just I'm hacking
on it in my spare time right and if
anybody really knows how to use d3 ice
is like Adrienne's first JavaScript
program okay I am NOT a front-end guy
right so if anyone wants to help me use
d3 to build a really interesting
visualization of how the stuff behaves
I'm looking for help basically but I
thought I'd put a slide I'm just gonna
tinker with this anyway but if somebody
wants to get involved I'm gonna happy to
play around and it's just don't get help
me converse for Kim so what I'm talking
about his separation of concerns
separating concerns in the right way so
project teams have concerned separated
and they build micro services that are
separated and then everything is a
bounded context so you don't you just
have to know how this micro service
works you the rest of the world is a
bunch of api's that are relatively
stable so a couple of things
looking forward just to wrap up here one
is that the go language is becoming
increasingly important about
three-quarters of everything I see is
written in go every new thing is written
in go Cloud Foundry just got rewritten
and go the hallo cab service is written
in Goa they rewrite their entire
back-end and they have a they almost
built a clone of the Netflix
architecture cloud native architecture
which Netflix is stuffs all in Java or
JVM based but they've done it in go
so they've open sourced it so if you
want to build a large-scale you know
micro services based system I'd go
look at what halo have put out there
right now yeah lots of stuff
Dockers written in go all these things
the other thing is this book which does
humble has been banging away out for a
long time and he claims that it's
finally in copy editing and it will
really be out soon but this is really
what's going on enterprises are adopting
continuous delivery DevOps and lean
startup at scale they are doing that we
had evidence a few weeks ago that
they've actually further down the road
than anyone really believed and the
other thing is this whole monolithic
versus micro services thing it's it's a
way to go faster and to be able to go
fast more safely right because I can put
broken things out there in production
without actually having any affecting
customers because I everything is being
controlled and the traffic flow through
my systems it starts to be the thing
that controls it all right Wow all right
well there's a lot of links here I've
got a lot of videos the slides I've
given out I'll actually put these slides
up on SlideShare the SlideShare dogs
comm slash Adrian Cockcroft is my
current battery ventures slide decks my
Netflix ones are slash Adrian Koh which
is my twitter handle okay all right out
of time any questions yeah
I'll be around until roughly tomorrow
lunchtime so as well if anyone's to grab
me yeah so Amazon is always changing its
price model but so is reducing its
prices so it's actually great and then
Google comes along you don't even have
to use Google Amazon reduces its prices
because Google did so there's a it's now
this is the prices are not going up and
it's different it's like if you buy a
machine from HP or somebody right you
paid for it right the fact that that
machine is cheaper in three months is
irrelevant because you really bought it
right but if you're buying a machine
from Amazon you should expect in a year
in one and a half years for it to be
half the price and in three years for it
to be a quarter of the price so if
you're modeling prices don't mobile the
current price for cloud model a having
every year and a half model so if a
three-year pricing model you'd have to
have it drop to a quarter at the end of
what you're currently paying and that's
just that's the top line price there's
volume discounts and things I'm writing
a presentation which I should have
already finished writing by him for
Amazon reinvent somewhere on this it's
trying to explain cloud native cost
optimization and presenting that in
Friday next week so I do have to finish
writing it because Amazon's getting
hassling me so but it's a start of a new
presentation because there's two things
everyone always wants I want it to be
faster and cheaper right so I've got a
whole presentation about how to do it
faster and I'm starting a new
presentation I had to do it cheaper and
the first version of that will be here
and there will be another presentation
of it in London in December where
there's an I Triple E ACM cloud
conference in the first week in December
and I'll be doing the again there so
that's my next next presentation that
I'll be doing and I think probably as I
get a bit further with my go program and
d3 I'm probably going to turn that into
an entire presentation where I actually
have code and stuff to look at yeah
these slide decks are boring after a
while I want to do some code stuff
okay another question yeah there so the
current version in AP is you basically
you let multiple versions run at the
same time you introduce new versions
whenever you feel like it but you keep
the old versions around until nobody's
talking to it so you acing it's like you
have to garbage collect the old versions
that asynchronously and and there's a
number of there's a whole argument that
versioning is one of those things where
you can say there are no there's no good
way to do versioning but there are some
less bad ways all right
that you can have an argument there is
no perfect way to do version Li but you
come up in the end with we let you put
an end of the thing can be in production
at the same time you have to control the
traffic by version so if a service wants
to talk to version 3 of a service the
version 3 has to be running even though
version 4 is there and version 2 is
there right so that the calling between
system so what the Netflix platform
contains a very clever traffic routing
code there's other things like you know
drop wizard does something similar there
aren't anything and the finagle zip kin
things if you're looking at a micro
service framework look at how it routes
traffic and how you can control version
routing that's an important part of it
you didn't really have to deal with in a
monolithic app ok all right thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>