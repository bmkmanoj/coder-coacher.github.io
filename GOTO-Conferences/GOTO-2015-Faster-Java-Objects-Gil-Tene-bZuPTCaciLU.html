<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Faster Java Objects • Gil Tene | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Faster Java Objects • Gil Tene - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Faster Java Objects • Gil Tene</b></h2><h5 class="post__date">2015-07-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bZuPTCaciLU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the subject is faster opposite race
hopefully during a rec room what this
meeting is about is trying to address
what i believe is the last inherent
speed difference between java and c
based languages that's not to say it's
the last difference but it's the last
impairment and we'll get into my finger
and what we can do to address it in the
content emitted describes under a
project to go hard about optically our
object layout corner if you like the
classpath this work first and you can go
to the website look at it you can do it
live if you want might find some
interesting things as we go i'm going to
describe what it is status of where it
is this presentation you can put it
together first for the most recent java
language of it and we are trying to
advocate for this to become part of a
jealous standard version in some future
point maybe not maybe then maybe we'll
see anyway let me start by introducing
myself like at is guilty how many of you
have seen and if my cock's performer
okay so some of you have seen this slide
when it's like making it in one piece
right why
um I'm the CTO visual systems one of the
things people know me for is that have
been working on garbage collection for a
while now about 13 years and when I say
we're going to especially think of it as
kind of thing different carbons
collection this is what the industry is
doing about garbage collection we went
all the way rather than incremental
solving things and improving them slowly
and reducing the pressure here and
they're going to said you know how do we
just solve it in from and we did it so
we believe the orchestration is simply
so probably have a working shaping
solution we think others will also solve
it over the coming decade it takes a
little work but when I say salt I mean
you don't have to worry about it anymore
you don't have to worry about pauses you
don't have to worry about not having too
many objects route 85 it's a me that's
product that's what we have to do if
you're interested they have a booth
outside but that's not the office for
just some evidence that i actually do
this stuff this is me working in garbage
collection in my kitchen that
contraption over there
compactor obviously those guys that have
seen this 17 times already it's a trash
compactor the job of the trash compactor
home you have a trash compactor I want
to know somebody who has a trash
compactor douche bags I have an IM lazy
the job of the trash compactors to
perform minor garbage collections during
the week delaying the fuji see when you
take the back out to the weekend and
when it performs well as well tuned into
that very well and in this case it was
broken fragments were coming out of that
the compassion function was important
perfectly i have to debugging that that
actually happened better I just thought
really funny to take a picture with the
garbage
theory behind I did that problem the
lane data point in this picture is it
was taken two thousand four so that's
just to prove you have been doing this
we're thinking it's funny for more than
30 um anyway I've built a lot of things
everything from virtual machines to
physical machines actually design of
CPUs a partner bill operating systems
and drivers and firewalls and switches
and big management systems for millions
of subscribers built in Java which is
gonna fire fell into this view another
pet peeve or habian minus to actually go
around oppressing people of the state of
their lives measurement I have a whole
set of talks on that and actually a full
workshop on Thursday if you really get
depressed or learn how to impress other
people or just point the finger at laugh
but it's just an interesting subject
Thanks imagine and good how are you
doing in measuring something other than
not but this is not working trauma today
talk about our karate camp so what is
this the focus of what we've got object
clatters to match the raw speed limits
the raw benefits that see based
languages can commonly get economy use
in job and we're talking with the layout
related benefits I'll be specific as we
go we want to expose those benefits in
job for claim java objects for regular
job objects from all judges that you
know we don't want to create an entire
video when you go to an awful occasion
we don't let you start on hurting from X
or not be able to do by if it's a pojo
we're going to be able to lay about
efficiently and deal with it officially
similarly to have seen does the same the
focus is very narrow I'm very specific
we are focusing on speed so regular job
objects on the heat that's a matter of
keep repeating okay it is not any of
these things it is not about improvement
but we are not trying to reduce the
footprint of anything I told you I think
garbage collection is a soft problem
right I actually think our problem is we
got using enough memory machines yeah
machines with hundreds of gigabytes and
we think that you know but as a smaller
is a big number so I don't have a
problem with waste I have a problem to
speak what the recipe is spiffy
forbidden rusty that's about
the memory is cheap and if you want to
solve it so bad but not as part of this
off he great things about our future
example when I talked to something it's
not java or maybe other garbage
situation that the support corrects you
want to get objects out of this way but
it's just not related to what we're
doing here and you need a building good
or bad is again we just don't care
immutable objects are great and so are
you logic and they want all objects to
be able to benefit from speaking talking
about all these are simply orthogonal
concerns are not good or bad I just
don't care about them so keep that in
mind as we go through this the next
slider to is the focus is one object leo
is and there's a reason to that every
time I mention it to people they say
value things are packed objects so it's
not the relationship between object a
land value tax is none the relationship
do not to play out
objects or jinn are I think there was a
general talk or something mention a
cardinal didn't actually attended but
Charlie's here right summer um and it's
not there good reasons to help those
hopefully though works through exactly
what they need to do show up in a java
version this is not an overlap at all
the laser focus is on a different
problem neither one of those things is
focusing on speed for regular job
objects on the heat there is no conflict
with other things so this is not instead
this is not done to death do this this
is we should do the same rate and other
things are good artistic there is a tiny
bit of order it's the same head of
overlap you have being in an ArrayList
national both of our good bags to put
things it but if you had both of them if
you only had one
prom like there's a good news for this a
good news for that is it where the fit
hit one more pictorial way of looking at
this is here's the space in a kind of
urban charter Valentine's fact objects
in Africa el valor types are about on
heat things you know cause like a class
act like an end cover sorry like their
whatever yeah then you get the nice
immutable nature for small objects
probably small object praying for on
stock thanks I can't tell how many times
I really wanted a foul reflect instead
of having to do weird things packing
things or creating objects just to pass
a couple so return values classic
directors are great for that for life on
staff on thread things maybe for some
thread little things in the heap most
likely you're going to see data types
there are handed between threads be
inflated being basically wrapped types
that are
has like your object box if you like but
we'll see in others butcher they're
really useful I'm anyone I wish it were
each other line probably not going to be
durable we know it's not gonna be there
but hopefully in javatm we look at that
objects packed objects first and
foremost this is an IBM initiative and
there's some other theorems of it first
and foremost it's about precise the draw
of layer and there's a really good
reason to precisely control layout when
you talk two things are hot Java if
you're looking at a TCP header the bites
dog certain places if you call a native
API and that may be the API has a/c
struct as a parameter we need to get the
bits by construct or if you're not
passing parameters right and the new
logic that we have today around those
things is very cumbersome especially for
my stable so I'll keep exactly out for
things that create structural things not
just other bids are important and if you
look at what people actually do about
that they usually create some big
biography but any great light or flying
objects that can scroll over and look
like objects spectra know what vice to
do what with we all do that over and
over and over again and like
standardized would be very useful I
would very much like to see something in
that space involved and i hope the Jedi
will do it and learn a lot from our pact
object it's about sharing information
with non Travis tougher primary thing is
keep sharing a Ganza you can't let the
gender male suffrage have been born yo
honestly I'm declare speed for objects
on the heat regular jack-offs last thing
look at this is Valley types is going to
be about new code a value type is a
class that does not be quite like an
object there are things you cannot do
with it for example you can't get a
identity hospital you can't lock it you
can't synchronize like it which means
that you can't give it to code that
thinks this is an honor it is dangerous
to do so so ground on tech shouldn't be
very useful for new code that is written
40 meters I love that similarly impact
objects are inherited from a new base
life that is not an object so clearly
hoping for things without that code and
Congress object
design to address any existing
constructible Java object in the world
then you can take off your scriptures
participated in some of these in handle
around 26 year old code because it knows
what to do with them so the scope of
what we're going to touch as
dramatically bigger especially if you
look at them at the echo system as far
as what we can interact okay enough
about what it's not let's look at what
it is in what the origin of this
actually started from an argument
argument became me and Mark Thompson is
Martin here he's seen this three times
he doesn't it to me here he reminded me
that the argument last until 3am sitting
in a cart side of this hotel the signs
of the argument looked like this on one
side there's we need stress in Java
you're sick and tired of building these
weird arrays and running these weird
things on top of them it's just it's
ugly ugly code it's why do you
have to do it and look at what all the
unsafe stuff you guys make history can't
we just have structure in the language
in this good reasonable driving the
other side is to say we don't need
anything
language we already have structured
better than stress they're called
objects they can do everything is struck
can do and more so let's look at what's
missing but you're actually trying to
achieve and see if we can achieve it
within the thing you already have and
that's what object era really is
attempting to do to settle this we said
you know what let's just still start
coding it up and see what happens and
that's where the project came from so
Martin and I will start building the
structure great for example to see if
you can capture the things right as we
are doing this we realize that what
we're actually doing is trying to
capture enabling limitations and I'll
explain what that is in a cup of cider
its semantics that we're trying to
capture not to code not setbacks or
anything else with the semantics that
allow things to be fast and capturing
the enabling surrounding efficient is
the key thing and every one of the
constructs will have here so when you
think of this from a design perspective
don't just
what these classes do but you can also
look at this as a development exercise
if you were designing something you
wanted to are potentially affect things
mainly affect the GDK in the future you
can look at this for someone hopefully
good muscles so when does the speed that
we want come from why nice let this see
happen in Java though doesn't happen um
since they are benefits really come from
two key things first one is something
all dead record then reckoning is the
ability to get to something and memory
from the address of the base of
something without too many data t
references on them for example if I were
an array of structs in job in C and each
strike has three fields XYZ and I want
to get to element number 19 field why in
seeing if I think the base of the rain I
can do math and figure out the memory
location of wine Almighty without
looking anything else and coming so
taking this computing at a slow strip
there that's dead reckoning as opposed
to look up element 19 follow follow
follow and then get there so that
reckoning is about getting strengthen
and
that gives you all your speed especially
given what cpu pipelines that are really
good at running through a lot of maths
well as superscalar things but are
really bad at saying well i don't know
where to go next so let's wait until i
compute that and then other the next
step in I expected breaks pipelines they
have a dependent operations your
serializing our personal asst in yet the
other one is streaming streaming is
about is really about exchanging latency
end up series of tons of that memory
gestures are apparently the problem we
have is that the latency to the memory
is very hot and we miss in the cache
when we go to a place we have a bottle
before it takes hundreds of cycles to do
and if we handed in l1 cache and spun
through cycles effectively um yeah
because of that gap be like to prefetch
data if we know what we might need to
access and the CPU can get it for us
then it's going to spend them with
getting it before we eat it and then
Italy determine needed sometimes thats
waste sometimes and get us that we don't
really need because it's guessing but it
gets to burn that benefit in order to
improve our latest streaming is
extremely powerful when you have
Constance tried access you're going
through the right looking at field wipe
everything or all the fields of
everything so if you look at the
addresses your access to the murders of
Carcosa pattern to them modern CPUs have
hardware prefetcher they're sitting or
actively looking at the pattern of your
memory accesses saying oh you did this
and this and others of how to let's keep
going they get it an even a prefetch
point if they do it well you do not you
miss in the cache but you don't wait for
the Miss because the Miss hopper before
you bring up since straining powerful
it's an order of magnitude improvement
on accessing through things but it only
is there if you're accessing inning
powder the reason array of structs are
very powerful for streaming is because
they're laid out flat so if you access
all the elements you are accessing them
in a pattern if things were jumbled up
that we've got me a pattern and when we
get 0 in 19 after moving to only 89 we
don't know where that is because we
can't
in these two things are vertical honesty
a la bastie these two things are hard to
do in Java so let's look at that
enabling or the speed labeling
limitations and look at specifically
what the semantics are that make it
possible to achieve he's with an arrest
wrong to do that we should just compare
the range on the computer NZ we have an
object array in Java that's the only way
you can have an array of things that are
not just a primitive field and we have a
array of struct in the CEOs of the sin
taxes so in Java and a rail object is a
beautiful classroom beautiful because i
can replace what they'll win 17 is
anytime i lock so Roman 70 was this and
later it's down so I can mutate their
rank and it's a rate of same base like
objects the base ty baby object or
suppose I have an array of points it can
be an array of point are you subclass
appoint reason that's important because
the elements don't have the same size
they might or might not have the same
size these two things in combination are
our problem if we compare them to see
and see an array of structs is an
immutable funny to see me her poems
evening it's an immutable construct of
exact same type finish to very hard for
bodies immutable because it's a flat
array of structures ailment 17 is
element 17 you can't change who it is
you can go mess with its contents but
you can't change which element is number
17 and it's same time because it's a
strengthened its the same struggle right
that's trivial but that means it's the
same size well these two qualities are
the things that enable or breaks TV
because mutability and non st. Agnes
individually break those qualities of
dead reckoning and string you cannot
directly or strain into a mutable ray or
into an exciting time of it why well if
i can replace open 17 in the right and
by definition there is going to know
what that is given their address I can't
think of a address and know which 17 is
with now I need to look at what you did
to mess with it that's the required your
honor that's no good record right
similarly if i can replace them that
they're not going to be more remember i
might get lucky they sometimes occur but
they're gonna get shuffled especially
when garbage collection thing together
separately the non same size
individually without the mobility and
where those things because if each one
can be a different size there is no
matter what number 17 is right there
different
with the number 70 so I like to figure
them out and similarly if they're not
same size by nice equal strike will
break too because i'll be talking in
different sizes every time researchers
won't disrupt problem anyway we need to
eliminate both of these qualities in
order to gain speed and see hassle and
that's what structured array one of them
that one of those worms and classes in
ArchiCAD does structure you're a severe
collection that says i need those
qualities so it's an immutable
collection any it starts and your stuff
in it and you can't put anything in it
whatever is there the start state of
exact same type object you can't put on
also different types simply because you
can't plug you say i gave 100 of this
and that's what you have you can't
change that later that's the capturing
of the semantics now when we look at the
target forms we have 3 featuring forms
of see that we're trying to imitate the
first one is it array of structs we just
spend some time talking about it the
second one is a struct inside the
structure and this is
tax refining them so struggle
destruction side rather than a structure
pointed now the nice thing is those
decomposable together because you have
an array of structs that have stretched
its life and then you can give that
multiple references you say and then the
last one that's very interesting is a
stretch with an array dangling off there
a variable size of a gentle enough there
that's very commonly used in
communication messages with headers
payload header back mr. sorry
contraseña and see it's very common to
have that flat you matter the entire
thing and you have a structure beginning
in the Restless array of bytes or
conserve all celebrities those three
things are very useful each one of them
gives you either dead reckoning
restraining or goes none of these can be
replicated for speed today in Java it is
possible to emulate the function of them
easily but each annulation method you
have cannot match either stringing of
the reference fees and job its inherent
to how the JVM base of things and what
the semantics are and that's what we
want to fix you want to remove then
hearing on so the starting point here is
to say they want to capture the
semantics the legal speed and the
theories that we can do this with no
changes at all and if you capture them
in a way that lets us take plain vanilla
java classes that one of any jdk
function on an agenda you don't have to
have a special environment to run them
but they're not going to run any faster
on an EGD k and just that you can have a
future jdk recognize what this is
understand the semantics that realize
that they can optimize them because the
semantics tinabell optimization so
knowing this is immutable same time you
can actually lay it out flat because
they are allowed to and as a result you
can actually do all the transition see
natural investor the difference between
what we called vanilla and what we call
intrinsic file which is optimized
version has to be speed and only speed
we do not cause you have any way to
write something that only worst interest
by the only works for mutates
differently in Bloomington that's a core
requirement of this now why didn't we
choose these partly because we're
thinking forward was saying we want to
get this into the language or sorry
we're not change in language into a
future of our prison job
they can happen in a special year the
best possible way no recipe and in doing
that we wanted to emulate successful
things there's an example of an
extremely successful external
contribution to Java the most successful
history it is Java util Colonel
gentleman Kurt was not developed by son
it was developed outside by Dudley and
union square how many we had use Java
util cooker before George are you jokin
her Union swinger classes right so the
way it was about this there was this
class my brain and it captured the
semantics for fast concurrent operations
the semantics that define what they are
that would enable the speed or
implementation there were no language
changes no JVM changes needed to run
that code it rather resistant to
Indiana's now it knows that there is
still not on your support for gentlemen
it's purely a set of classes we might
get support in Java nine with diatomic
revolta now then Jim initiative vanilla
rosen multiple JD case but in
slow for example you can emulate an
atomic integer compare and swap or
comparison with the synchronous block it
won't be faster the work you then have
JT case improved to recognize what that
is and not do it with a synchronous
block with a single instruction out of
CPU and intrinsic fire and you move it
into the jada jada jaada namespace so
that it will be locked up there and JT
case can safely know what it is rather
than some oh I think that random
third-party library just other testing
semantics I hope the next version is
different if it's in the Java namespace
that is specified you know exactly what
it will do you can replace their
conversation so let's look at the forms
of the document and zoom into one of
them racist our structure the right is
simple it's a collection of type T and
it happens to be arranged like in a
you have a get by index you get an
object that's the AP line simply
calculate right there is no fun um it's
immutable and you can't replace elements
and to make it you have to use a factory
for example here we're making an array
with a hundred objects of some cost some
pasta console.write that's going to make
one of these all the ones that created
instantiated and constructor when you
made this so they'll be a hundred
constructor calls let me do this because
there's a hundred objects beam
construction and we support all kinds of
interesting and structure forms because
if you have to create all the stuff at
the beginning and we want to support any
constructible java object we can just
say the ones with default constructors
which you know that's not a visual
instructor would be you can get into
some interesting complex things so take
as an example suppose you have a class
like this class do and it's got an
internal final feel you have to
neutralize it a constructor can't touch
it later and that farmer field will
support you somehow I gained my exes
think bigger why because that's what
that's what I chose you suppose I want
to create an array with eight elements
of that what I need to do is say which
constructor erroneous that's in Java how
to say I'm going to use that constructor
and this is how you make their record so
I'm making their ideal of that should we
do for rather than mine under object
sorry for the typo and see that diamond
expression there you can you don't have
to use a lot of expression that is a
perfect fit here where I say for this
context created unit structure and
arguments with that constructor in the
parameter is actually the index into the
rice so each down it can get a separate
parameter that depends on the context of
where you are in the right that's an
example of a fairly complex interaction
of the constructor betting goes to that
level you don't have to do these unless
you need that conference it's much safer
if you don't but we needed to enable
that kind of stuff in order to support
arbitrary object membership in this
collection like this is a very
interesting quality here what we found
we didn't if you started working on this
is that we look at this is something
that other people have already done
arrays or big objects with a
the middle of them because they're flat
and you want to give people a reference
and they can hold it it who looked it up
about Ottoman times doing in Jeremy what
they all do is there's this container
thingy point to the middle of it and
playing to the middle of it keeps the
outside of life and we started that
that's a big if you if you have a live
member of structuring the structural
identification and we were going to see
okay what would we need to do that I'll
be supporting a runtime and a garbage
collector is what we used to change and
this is doable because otherwise I was
doing but it's kind of complex to change
what Java does to do that and about a
month into this whatever pgc guys you
know said if I me again why you're doing
this remember there's a complexity is
you know as it should make you rethink
the thing so why are we trying to keep
the container
to the matter why do other people do it
well the reason other people do this is
going to the field in an object feel
doesn't live by itself if you can point
to a member of an array that's a
strikeout an object a struct ass truck
doesn't live by itself it doesn't have
like this so what you're actually doing
is keeping the life the closest thing
that contains it that has like this just
why others chose that but we have proper
java objects these things that we put in
the collection of regular and java
objects it means somebody else to keep
in mind that you have divers if somebody
comes in there is not they're not and
whether it was sort of you know a whole
bunch of things that completely
eliminated this work the work actually
came much procedure to intrinsic I and
we found that is very very natural so
structured rate is just an idiomatic
Java collection you already know how it
behaved are there any other collections
that you use when you put something in
it the collection stays alive if you put
something in a hash brown doesn't that
doesn't be dashed at the line with our
vegas the library bitbucket life
whatever it is you're doing
if it's a lot of mileage it's not it's
not if the object is aligned with its
their line even if the collector stop
that's normal idiomatic sure you don't
think about that's natural so structure
is the same um there are under the hood
implementations are going to do now
strikes if we want to optimize this then
yes we need to move everything in the
collection together but that's a
quotation it's not semantics now the
benefits of this is that there's no
special behavior it acts like any other
collection from an optimization
perspective from the coding perspective
you don't have weird surprising things
like I'm really giga byte array of
things and one of them stayed alive so
I'm still holding on to me but again
that would be highly surprising so quite
a passionate right um and it happens to
be may be easy to optimize for so
almonds in the circulator just regular
armor comments you can do anything to
them because they are just regular
objects you can lock them together
identity hash codes you can put them in
captions you can take your array of
objects and then set the 17 different
hash marks try to pin that live in a red
face um and you can pass that content
it's just a regular object you can take
that number and give it to anything to
inspect the java object you can give it
to not rejecting you can get into some
old code then you don't like and don't
know but in this something it's not
going to break it doesn't need to be
recoded to deal with in your special
thing structure itself is also an object
and it's not specially so this is all
natural ice it's this audience that
falls out of the decision where you
immediately know it's right you see all
the things that get me some other things
in the stretch in the rain well I wish
you say 2015 4 2015 and be silly to
think of
with two to this very first limit on
length the that would be a fundamental
mistake almost as bad as build a
language with no 64-bit integers in it
all right its previous talk not there
javascript just doesn't have them I hope
maybe a transcript will get them Nestor
the Rays are supported in here in
multi-dimensional support is built in so
you can have structure versus
retrogressive structure raise if you
want na- structured rays are just
element members so if you have rows and
columns and indexed cost and then
they're things inside subject structure
is classima this is a powerful feature
we think you'll be the idiomatic way of
using yes you can college two brackets
if you want if you like generics and a
lot of them no problem but it's very
convenient to subclass a generic type in
a non generic formula simplifies of our
code certainly makes it much easier to
do all the casting and checking and
avoidable introduces restaurants over
the structured array is also not
constructible you can't make a
structuring on Ewing it you have to make
it to the factory now that's the
fundamental thing that we needed to do
because of Java symmetrix Java doesn't
instantiating something of variable size
except for a primitive very new and Java
is always a fixed size already is a very
good size but only a little crazy
primitive the raindrops this is a thing
that we need to make that has a
different at length that betting on
parameters to instructor and by the time
again to the constructor it's too late
we're supposed to allocate the stuff so
need a factory paradigm saying factory
keys make this for me rather than a new
and is constructed what I just out of
hidden garden which is why it has to be
done on the factory now is anybody
noticed a contradiction in this slide so
the last two bullets here contradict
each other I'm saying that you cannot
new you cannot construct structure race
but they're so classic and you can't
subclass something that doesn't have
exposed the structure that's a basic
requirement for surplus and super has to
be constructed from where are you doing
it so how do we bridge that well it
turns out that that we wrestling with
this a lot because we wanted the quality
is glad you know that's not a static
spark what we settled on is we need to
make it impossible to construct a
structure right that's not the same
thing
to write something that tries to
constructor surgery you can write
something equals new structure all
implementations agree with an element
will throw an exception if you drive
around that code so it'll never work
anywhere which means that we don't have
to deal with it in one it'll feel
exactly the same everything so it's okay
if you actually want to rough terrain
you will use a factory if you try to
construct it directly the base
instructor will throw exceptions level
we use something like all constructor
magic that makes it safe to construct
through the factory including all the
next constructor for yourself classes
but not a few directly construct and if
you want to look it up for other trick
works they will consider it might be
useful in other fields it they'll
optimize them to the implementations of
structure rate it need to do something
interesting here and this is your first
recurring lot of forms to you don't have
to do this you just rather than look
good but it won't be any faster what we
store but won't be faster if you want to
get the speed you need to lay things out
flat that means you need to start
thinking of contained and container
objects a relationship in your container
container a container has regular
objects in the container itself is a
regular objects you can have harpies of
this and give it a contained object the
jvm not you the JVM needs to be able to
get
contained to the container the reason
that needs to do that is if the garbage
collector is moving things around
copying compacting where I was doing and
the first thing it ran into is a member
object of a larger thing it can't just
pick that up and move it it needs to
move the whole thing together to retain
the flowers so if it gets to something
that's contender needs to look for the
outermost container and move that as
well there were a lot of container to be
specific now you don't have to deal with
the details the jvm writers like us into
but that's basically the whole thing
that's the most you need from bronchitis
virus new features when you behavior
under foot this happens to be very
simple pendulum we've been implementing
it in the same on art collector to see
for collector but also we
like a proof of concept are open to BK
graced with pearls you see doing this
and we looked at were things to do CMS
in g1 and none of them are highly
complex this isn't introducing thing
fundamental difference that the
collector does have only seen two no
penalty there's certainly were clear but
it started it's not trivial that's not
highly complex and risky so let's look
at some more things about this what are
we going to get from optimize
implementation but once we link things
that are memory flat because you can
streaming just happens streaming is
simply result of having good things in
memory anything put them in there made a
nice flight has always liked the
structure array of objects and their
strengths and all straining operations
will simply happen as a string a group
researchers will just in the work you'll
need your special optimizations now dead
reckoning des needs in compiler
interaction but the reason for that is
when we want to get to open 17 we don't
look a reference up to get there but we
have to do an operation that looks like
this this is actually a few minutes so
you can get to address a government I
need to take their gray address and the
body size of that of the rain and then
indexed by the size and the helmet
that's how you get in a personnel in
this statement body size and eleventh
size may vary in different instances of
the same structure so I thought
structure it so body size could be
differently this structured or I could
have subclasses different structured
raised that so classically have been
different money first element size can
vary between two instances that you have
a structural point in the structure in
box those are two different islands
islands so these are not at the
reference but there are data dependent
calculation of the final address that's
what do we do about it well Alan size
and body size is not constant but it
turns out that they're susceptible to
optimizations that we do in chain the
apps for other reasons not the same
optimizations but i'm using analogies
yet who here knows what class are key
analysis does so that's a whole
different JDM mechanic stock photography
so i'll do a quick thing on that
phenotype class ranking analysis is is
super powerful is why you don't have to
do final methods and you don't have to
expose private feels when you have a
method that is the only implementer in
the world for example i have a base
class animal that has color so animal
get color gets the field cover private
come then have a dog in a cat the burn
all those don't overwrite come there's
no
gentlemen classic analysis allows us to
say hey in the world we know today a lot
of attention is only one implementers so
I see that virtual fall to get cover
this was a great time okay i know
there's only one so i'll go straight
down if i look at past later that makes
that assertion wrong I'll throw away the
code or even pilot that's actually what
happens okay so low the classroom like
the optimize things at work that were in
classic analysis is then when you look
passes or and actually when you vote the
custom you make assumptions begin with
this more likely the earliest in college
we can do a very similar thing here to
say yeah Adi size is not constant but is
there a subclass obstruction of this
structure a track that I'm looking in
structuring of the pore cleansing and if
there is it and I know exactly what the
sizes and it doesn't change into any
plaster subclasses it appears it's a
similar analysis now the other
implementation our position is causally
like cash what if I have in that world
they gave you a chameleon chameleon is
this animal it says a branch and get
color depends
browse trying to override it no longer
one implementer you have to throw by the
transition however if the code is
sitting in a dunk em on all season
starts in ever season community and
actually consider and say no I've only
seen God's I think I need to call the
dog get color which is animal good color
and I never see condones it can
speculate and we say if it's a dog
called out which is much cheaper than
figure out which method to pop in a
similar my darling size fits in a
similar statement you can say hey this
thing you have anything in it but I've
only seen points so if the element type
is point then use point as size
otherwise distance lower thing that
replaces a data dependent operation
getting the time with a control flow
operation that branch that's speculates
that something is right and we'll have
to reverse it basically miss predict the
branch if it turns out to a co point
which won't happen these organizations
are common for other things we believe
they'll be coming here too and that's
why I'm dead reckoning should and we
believe the Lord there's a lot more
detail to this I won't get into here
I'll quickly looking at the other forms
we have other things reference trucks in
an Iranian structure than
and strep construct something the whole
intrinsic objects intrinsic in the
English language reading hitting
intrinsic to not allow optimizer stick
is intrinsic sole object X is intrinsic
to object whites and slightly created at
the same time it's a natural part of it
etc for example this is a syntax for
declaring a endpoint in a line it's a
private final point the sin that should
be readable business love you there's no
my language stuff and but there isn't it
actually saying this is in transit and
you initialize it with the factory
there's an intrinsic object constructor
there this is as thin as we've gotten
the spelling so far person you know you
could get this thinner but then you look
mean language changes so this is a
source or think you can go right now
without changing the language so
intrinsic objects are there and that
would allow us to lay around with an
object an important thing to know is we
put the object inside but we will keep
the reference field and a refreshable
pointed object then recently that is
because there are all kinds of things
and JVMs that unfortunately come
to the GBM for example final doesn't
mean final you can all right if I'm
feeling put something else in it for
example every time you deserialize the
class that has references if you problem
doing that first you make it then you
plug into something and that means that
if that happens you may point to
something that's not the one we picked
so we need to get with father loves the
right place again the speculation here
is it doesn't happen so when you get to
the inner class you go straight without
referencing but if so many using
reflection already an elevator filled me
throughout my dog position actually use
the referencing just go as slow as
regular geometers today doing that's the
trick their stress with an Iranian are
simple because we just created this
subclass of all right a sub classical
raising natural way to extend fields and
sister doesn't know anything is actually
a napkin to a structure and if we take
an array that's a way to represent them
we also have a reference to arrange to
have a generic reference rate structure
ray is aureus and possible so it already
allows you to have a destructive this an
array of structs append that's just a
result now these forms together are
composable which gets interesting so
this is where
to have to like them you can have a the
heat and inside of you can have regular
absolutely you have a structure of
structure right on food and then you can
have that structure if who is a member
of that then influence a member of that
and inside fool you have to strengthen
objects that are in doofen in addition
to other fields in insane bar would you
have another array of fixed size length
that isn't translate to borrow this
entire thing can be flattened memory and
to show you what it looks like in
example code here's an array of the
dollars it's a class that's called
octagon some classes structured wave
optimum makes a nice to deal with after
those and then within our Kadaga
intrinsic array has eight points because
it's an octagon fixed length and that's
an intrinsic structure right point
counts and then we can do the rest down
there go the next thing there's you look
at the statement the bottom getting to
point X of circuit element coordinate
exit point point index of off to the y
inside an erratic and there's not a
single required you reference me and you
can stream it's flat on memory so in
that is central now
and receptacles now the nice thing is
you can use them the natural beta
readers like this can iterate and
optimize iterative points and then go to
get the things and there's no memory
access and innovators these are all just
an optimized so you can get rid of you
shivering matter and mocking them okay
that's quickly look at status code is on
github it works we're still working on
some still and looking for in one but we
think it's really mature intrusive
fundamental issues are being worked on
for those things openjdk we will
sheraton very soon think when trying to
propose on a particular project that's
the next step mocha shake-a project and
the aim is to add object layout is a
library and only that to subversion job
the negative ambitious will work fine
but if we look at this since this will
work on any JD training what we're
actually asking for an adding it to a
Java spec is not to
the organization in a geometric happen
any time later we just want these
classes in the namespace trees that if
we mature them with the right synaptics
for the classes because you smooth the
middle it'll just work but they'll
change anything so we're just asking you
some classes that work can you move them
into the namespace that's the only
actual change will be asking for once we
get there then we go out with everybody
optimizing we will contribute
optimization still educate to do it we
don't have to do it maturely and in time
for some specific java version so that's
it I think I'm on time I don't know
about the questions we probably don't
have the true for those but here's the
slide for questions and I do have a
second talk tonight if you like my
children my style I'm talking about a
dull max case study of using our actual
product thing at the last time today
time stopped there's a links here and do
we have time for questions question okay
the three serious questions we answer
let's take this week your first</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>