<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2017 • Serving User-generated Content on a Global Scale • Matthias Huttar &amp; Pedro Proenca | Coder Coacher - Coaching Coders</title><meta content="GOTO 2017 • Serving User-generated Content on a Global Scale • Matthias Huttar &amp; Pedro Proenca - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2017 • Serving User-generated Content on a Global Scale • Matthias Huttar &amp; Pedro Proenca</b></h2><h5 class="post__date">2018-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GKYMz_Ipovs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">again good afternoon everybody thanks
for joining
this is serving user-generated content
on a local scale by Taylor parantha and
myself mighty Sutra we're going to talk
today about ten practices or tips or
ideas that we learned when building our
media service called Apollo
right now we're ramping up global
globally we are in a couple of countries
that all exerting we're getting to most
of them over the next couple of months
but before we actually start I'd like to
know of you who does know no legs and I
don't mean who has seen a lot of people
running around with that t-shirt who has
heard of all acts before there's
actually our people but we did a lot of
recruiting here right so OLX is or the
OLX group actually is a global
classifieds company we are basically
delay basically trying to connect users
to sell previously use goods to each
other if you don't know us
you might know companies like Craigslist
in the US or Gumtree Eva Clements I'm
here in Germany Russians might know one
of our business is called a veto we're
doing the same thing
did I mention country any case it's
classified
besides that we also have a couple of
more specialized experiences around real
estate and previous used cars and we're
actually quite big the reason why most
of you haven't heard of us
I guess is because we're focusing on
potential high-growth markets in the
future we're investing a bit more long
term into markets that will hopefully
grow to a crazy size within the next
couple of years mostly of them are in
Asia
so we're picked in India and begin
Indonesia but we're also quite present
in Eastern Europe quite a household name
in Poland or the Ukraine we do a lot in
Africa where this company actually comes
from and a lot in Latin America we are
quite big I think by the time might
already realize but we are present in
way over 40 markets the company itself
has over 4,000 employees that work
around the world in 25 offices
as most of you might be developers here
I guess I can't tell you the number of
developers because I don't know it but I
checked our github and there is 500
registered people in our github and I
assume most of them have something to do
with software engineering for
development our most important offices
are in Berlin in Buenos Aires in Delhi
and in Lisbon as well as in Poznan in
Poland looking at our scale of business
we're talking around 300 million monthly
unique users that is pretty much close
to Twitter to 300 million monthly unique
monthly active users are numbers that
were reported last year publicly so I
can only tell you that number but those
numbers are 10 months old and we've
grown quite a bit since then
so by now maybe we are a bit bigger than
Twitter maybe not I can't help 80
million of them are selling something on
one of our website each month thank you
so we're gonna be talking specifically
about one of our services we have so
here in Berlin we have office and our
office is mostly like hundred percent
tech let's say we have some product
managers but they're mostly around our
services right and images is what we got
to talk about why so just to give you
before I jump into that just to give you
some other perspective 300 million
active users that is like more than it's
the population of the United States
something like that or if you multiply
the population of Berlin 100 times and
that not only not it's okay I can just
throw around numbers but it's actually a
big challenge right it's not just 300
million people it's a lot of challenges
and 18 million posting things are trying
to sell things one of the things is
images images when you want to sell
something is a first-class citizen in
the platform and when you take a picture
you just don't take one you take
multiple right if you sell a car you
just don't take a picture of the car you
take multiple pictures and some of them
are
it for sure because the car is broken I
don't know it sometimes happens so oh
you click right yes yeah I don't know
how this so we're talking about 388
million images that we have in our
service right available globally and it
grows with a number of more than 100
million images per month it's a lot and
you can already imagine the
possibilities if you associate metadata
with those images there is a lot of
things we can do with that and that's
amazing like really it's like if you
just walked into a huge playground and
someone says do whatever you want and
you're like this sounds weird but it's
fun and it's true
so this is where Paula comes in the
images it's something that there is a
lot to do around images for example when
you resize an image if you're selling an
item there is an item in the middle of
the picture right and you don't want to
resize the item because if it's a book
then nobody can read what the book is
saying right so what you do is you
resize everything else except the object
and this requires some work and also for
example for us images mean something for
computers it doesn't mean anything just
a bunch of pixels together he talks to
the graphic card and the graphic card
goes like hey here is an image and the
computer is like cool right for us
there's a lot of more meaning in the
images there's death there's perception
there's so many things honestly it's
insane and centralizing this in one
service is what helps us bring that full
potential so that we can Arvest and
build on top of it so this is one of the
first steps you do is you find something
you isolate it and then you make it grow
right so the word the way it works is we
have there our friend John John is
really happy I don't know why but so
he's there and Johnny's let's say that
is in our platform right
so I post an app with some MIDI content
whatever it is how do you file I don't
know
so we posts it and what happens is it
goes directly to Apollo so Apollo is the
one that receives the content right so
what then happens is you have Joana
she's upside down this is really bad
joke I have really weird Mateus told me
this I never knew before so let's say so
you have Johanna Johanna visitor Ana's
is John's sister because they are very
similar names
so Johanna visits and what happens is
here's where it gets weird first of all
we are in underdeveloped countries so
the good thing here is that we have
amazing internet whatever really fast we
can do whatever we can download a video
legal of course very fast but Johanna if
she is in India she's not able to do
that and you have to take into account
this and when you operate at scale this
is one of the things you have to take
into account there's very very very
niche situations that are not so niche
when you go to big markets so bandwidth
is one so Apollo what it does also is it
takes into account the device Europe
loading or receipt or checking the image
in and it tailors that out for you in
terms of bandwidth in terms of size if
the website wants a different size right
so phones laptops they all have
different needs they work differently
but now if you talk so I was talking
about the scale we're talking about
30,000 requests per second that's a lot
like really if this was my salary that
was amazing
thirty thousand years per second that I
would be so happy so 388 million images
if everybody in the United States would
take a picture and upload it to Apollo
it would still not make this number it's
a lot really 100 terabytes of data so
this is also related to how you store
the image
impressions etc 95% of these requests
actually go to cash so out of these
thirty thousand ninety five percent goes
to cash and the thing about the cash is
the cash is close to you so if you're
accessing it from I don't know Berlin
you will not go to United States and
bagged and portugal then around the
world then you go another loop no you
actually connect to Berlin office not
our office so we actually connect to a
server in Berlin and then how it works
and now I give it new yes do we have
somebody here from eBay ok by the way
guys going from Germany to the US to
patronage to go back here this is how
you guys do it awesome so let's talk
about a couple of things that we do to
scale up as a preface some of these
things might seem trivial and very
simple still want to repeat them because
them really matter and make sense
something might not at all make sense
for you please don't find the copy that
this is stuff that work for us we're
also not completely there in terms of
scale where we wanna be so 30,000
requests per second for us is a
beautiful start hopefully next month
we'll have it doubled and from then on
10x by next year so this is like we're
still in ramping that thing up
I thought we group it into two things
we're gonna go first with some more
technical things and then some cultural
or actually behavioral things like
things the team does in order to achieve
that scale which is super important as
we figure out however first I'd like to
just I thought it might be cool to just
show you how about the public works so
come up with you know an architecture
diagram I'd be like very simplified
Apollo it's a bit more than that but I
guess you all want to know how this
works in theory so every request that
comes in goes to Akamai which is our
global CDN Akamai's awesome in the sense
that
they have like edge notes absolutely
every word with tons of tons of mirrors
around the world even countries such as
Indonesia which is for us a big market
you don't get about from CDN presents
they're never less present super
important and especially their internet
connections are really bad that thing it
takes care of those 95% of requests
approximately but everything that goes
through goes to the polar front and web
app classic Java spring application
although Java 8 and spring boot and then
we use summer for resizing number is I'm
not sure if you've heard of it the
number is quite a nice open source
product it comes from Brazil but it's
also utilize the Wikipedia for reciting
images and rest writing images basically
it's a web service that does image
processing you give you the URL and the
URL you encode the URL of the image to
load and then you parameterize what you
want to do with it like resize it encode
it as JPEG encoding it ed Cody that's
web P set quality parameter to 60 or 30
or 20 whatsoever and then return it and
yeah all the files that people upload
gets stored in a three bucket which is
quite nice because as three as we all
know it's a nice service product that
scales quite nicely horizontally the
latest version apparently it can go up
to 20 256 charts important with s3 if
you ever store a lot of files keep in
mind that it's it's important to turn
around file names so common prefixes or
sub directories or actually what make s3
behave perform really poorly the first
four or five characters must be really
unique and random so that it can
actually utilize that for charging
otherwise you end up having everything
on the same chart and performance of s3
is gonna be really funny at best images
there it's quite awesome for that
because scale horizontally beautiful but
there's also of course in metadata that
we're storing right now most especially
like where it is file coming from we
have a lot of business law classified
sites which size of this image belong to
when did you receive it how long do we
gonna we need to store it there's a
couple of legal requirements around that
like we have to store images for at
least two years after we uploaded
because if police comes in there was
something illegal we need to be able to
give that to police all all these kind
of funny thing
that you get when you operate in a lot
of countries and then we we have a
back-end application which is just doing
that job like cleaning up images or
files that we don't care for any more
archiving them actually what doing batch
imports and so on we all be running all
of this in a carbonaceous cluster quite
convenient which brings me to practice
number one that is to get about servers
you know coming from at least and at
least when I grew up and I see I was
coming from this old school thinking of
bare metal right we got a half bare
metal and I mean this is quite
straightforward right we have a polar
front in - that's a server group we're
gonna have let's see five a polar front
end servers then we're gonna split it
out from numbers numbers gonna be I
guess ten servers right whatever number
of servers gonna give it ten servers
then of course we have back-end which
also needs to be two servers of four
high five and Lizzie then we go for our
yes or RDS doesn't really exist but
we're going to go for my sequel in that
case so my sequel is our master it's
gonna have a standby master because off
if what happens if master fails and we
all have a couple of slaves and that
comes with a couple of limitations that
say first of all you end up with a
couple with a lot of service and all of
them being quite underutilized and even
if you're able to you know exactly get
the Sandberg class or assembler server
groups to be exactly at 80% CPU
utilization all of the time maybe your
Ram sits there and dials and has nothing
to do so I mean yeah of course utilize
one part of the system but still you're
under utilizing all things looking at
that instant that Apollo thing actually
I think quite typically what happens is
in Denver we have a lot of CPU usage and
put in the full Pollack wanted for
example we'd have like next to zero CPU
utilization because all we do is wait
for bytes over the network coming from
database coming from uploads or coming
from somewhere so those two can could in
theory live perfectly with each other
but then in a classic old-school searle
server environment we wouldn't do that
because that comes with a lot of other
problem cannibalization quite complex
then of course is all the server classes
would be different and would be
different to be set up the java
applications each JVM install
then we have number that's Python and
somewhere
uses open CV open CV is an awesome and
native C high performance computing
library which needs to be compiled into
a Python module so ok there another can
install Titan compile open seaweeds into
it and then we're done then my sequel
setup replication is all tricky right
and finally because of all that if an
engineer now comes up with the idea here
like micro-service can I make a new
micro service yeah sure go to your
operations guy sitting two floors below
us
and asking about ordering five servers
right that's not that fun and that's not
how it should be anymore
kubernetes is really helping us there so
first of all the resource allocation for
us is simpler we have for all Asia we
have three servers they run all of it
quite well aligned you can specify like
rules like what things should be
together what things should not be
together but you can switch the whole
thing in Asia into three servers and it
works out and kubernetes in talkable
take care of isolation of these
processes so that you don't get this
funny eating into each other cpu spare
situations then every service is
obviously container which is great
because then there is like not server
servers and snowflakes anymore you can
just say okay I have a deploy container
I deployed in any kubernetes and what I
can find that has enough available
resources and for engineers we have a
set of llamó documents which are in
version control which actually describes
infrastructure and if they want to
increase increase the number of replicas
for instance they just do it push
changes to production that's it if you
want to create a new service they copy
IMO file change some values in there and
here we go quite easy and finally but
also super nice about this we then took
all of these docker containers and
create a development environment locally
so that everything everything there is
runs on a developer's PC or laptop or
MacBook whatever in a way that actually
you can really work in a companion
airplane again against the running
Apollo instance four RDS and f3 it was a
bit funny but there's a lot of open
source projects that can fake f3 and RDS
or
is actually like my my sequence-specific
version and I can really get recommend
doing that it's quite nice and way
faster than working against real AWS
services also a bit cheaper obviously
cool let's go to practice number two but
now we're warning Pedro did tell you a
little lie about having one place to
store everything look globally because
that's not what we do we actually split
it up into three regions we have three
different Apollo clusters one for Asia
one for far away I'm sorry I really
tried hard to draw the world I figured
out this is quite a hard job to do but
hey I got Europe kind of right but then
one colleague told me who comes from
Greece hey man you forgot Greece and I
was like oh sorry for that
but anyway so we've got one cluster for
Europe and Africa one cluster for Asia
and one cluster for 40 Americas by the
way an advantage of that way of drawing
is actually you can draw the map in the
way that your lines are straight which
is quite which is at least one good
thing about it for like charting is a
super tricky topic and I cannot
recommend it however to us we found a
really nice hack because classifieds are
such a local business I mean when you
try to find a couch when you sit in
Berlin and you want to buy a sofa you
don't care that somebody in Delhi has a
sofa to sell and even if you do care you
don't care that the image loads faster
or not it's for us really couldn't find
any single reason why we would need to
have like a central brain a central
storage on the other hand for us it was
quite convenient to have more local
servers so we have one data center in
Singapore taken care of Asia which is
just in terms of network speed like
network connectivity speed much quicker
and we're really not getting any any
negative from that kind of sharding so
when charting is something you consider
always figure out a fun way to like a
creative way of how can you make sure it
costs very little and directly getting
benefits without paying a lot where the
one thing we need to replicate it WTF
now sweet bananas clusters we have three
kind of pay to do two alerts okay but
that's that's not too painful but then
of course we get
that each of those riches can go offline
and the others are not affected at all
because they don't even know that each
other if it exists go now a bit deeper
into into practical things keeping your
skimmer clean when we all start with new
applications we have some beautiful
database and we draw nice diagrams and
everything's so simple and clean then
requirements come in and we add
end-to-end relations we had joined
tables we have a lot of joins and all of
a sudden we wonder why a plication so
slow and obviously they are right one
thing we're doing is we try to split up
our database into two part into two
segments the one segments being like the
high load segment and yet a segment
being like the lower load segment the
high-low segment is the ones where we do
a lot of queries per second the lower
one is like batch jobs don't care it
doesn't really matter not not so
important there but for the high load
segment we will ensure that the index is
arrived to the indexes are performing
well Aurora is in my secret the rivet
and as we all know my sequel is a bit
unique around index and index
optimization but really we really
enjoyed everything that happens on these
tables we review very all the queries we
review that the queries get the courage
the indexes we also check the tables
there are really cheap in terms of bytes
per row so we really have like fixed
code fixed row with tables there try to
not we've completely disallowing any
joints and as little queries as possible
in the hot past and definitely only one
transaction for one thing especially
when you do batch things this is kind of
usually you fall into this okay now I'm
like man all request is just one
transaction but for the web that's thing
I need to call the service 10,000 times
and every time that's created
transaction ends up being a bit funny
figure out the way how to avoid that
engineer around it's really saving a lot
of performance especially when
performance is critical now then coming
from table going to go to or ends again
something really funny happens when you
map out your model and we had to Don
situation where we're doing a bad job
and we thought okay that's very simple
straightforward it just makes one query
and then another one to load two
relations
no actually was we hit the n plus one
problem because I just wanted to model
like a relationship one one directional
relation in hibernate
coming from the other end so that the
target entities would know the parent I
put the other way around because it's
also necessary so you know the parent
only knows target but not the other way
around ticket wasn't necessary and
having it figured out it's a great idea
to make 1,001 queries instead of one
so therefore really look at look at
query logs from JPA from hibernate look
what they do
it's like it seemed it seems so logical
what happen it was supposed to do but
still it just came up with its own idea
then adding that making death the
direction be the direction of from
having a point of view went back to one
to two queries para we also really
abstracting chippie hibernate entities
away from from the from the api so there
is an object between hibernate and the
rest of the application to just not
allow expose that directly because
eventually otherwise we end up stuffing
too much business logic into having the
entities whose job it is to map objects
to the database and then quite often you
end up in the situation where you get
data inconsistencies because you caught
the code around and forget to modify one
thing when you supposed to modify to and
not that awesome um speaking of high
load for us the most important code
execution palaces actually when you
download an image this happens 95 to 98%
of all requests that we get our download
an image and for us we've always taken
care from it from the winning on the
discord path is as dumb as possible
there is as little happening as possible
especially with external systems so when
arecas comes in that the tries to
download an image we only touch the
front of the web app we don't do
anything there we definitely don't at
all touch the database that's clearly
forbidden we go December to fetch the
image from a tree and return you know
usually you like at least the least the
least parts you involve and request a
list can fail about it basically even
farther there is the thing about
timeouts
we've all had situations where websites
just gone down because in linking bit
slower so we really ensure that
everything original thing that
as aggressive time and set on to it
the reason is actually just mentioned it
but things some things get slow like you
did if it gets a bit slower and all of a
sudden where your website gets down now
the reason why this is called I need to
click here damn it it's called the gem
theory I know enough about the gem
theory to have no clue what is this
because this very complex math and it's
dynamic it so that in a feedback loop
basically what happens is this you have
a highway you drive around the highway
everything in which you're going in
holiday with your kid in the back right
your kid is having a nap right now it's
just try it we need to go it fell off
lap like my son and then all of a sudden
nothing goes anymore and then you sit in
the jam for one hour you keep away
except again realize it's pouring it
wants to go outside we're not moving
over there yet and so on awesome cool
and then finally you kind of like the
jam dissolves without nothing there was
nothing every of sudden you know the car
start driving again and oh what just
happened what just happened most likely
was there was an accident but not on
your side of the lane but of the other
side of the lake people going in the
other direction had an accident but
somebody in front of you was watching a
bit and forgetting to push the gas pedal
right so it was just relaxing it's what
muscle tiny bit going for some seconds a
bit slower until you realized hey I need
to like be I can be a bit faster now and
then the people behind him also and just
becomes this short thing what happens is
it causes like exponential waiting times
you have limited set of of lanes a
utilization of that Lane actually has an
exponential relationship to the waiting
time in the system
same with checkouts but also same as web
apps especially when we talk about
tomcat web apps with request connection
pool service requests and in pools or
like the thread based model of
processing requests to drain from that I
prefer to cut off one weakness too early
just because I don't know the image
doesn't load from s3 in 100 milliseconds
then have I don't know 500 cos jamming
up another like another thing about this
by the way if you do ever load testing
and you put a bit of load on system and
everything is fine and you better put a
bit more load on the system till
everything finally then you just put a
very tiny bit of extra list
gun debt what just happened what
happened is of the exponential thing
we've been going here here and then
that's exactly the point and that's also
would happen some website time outing
everything can really set you but I'm
looking at those timeouts where is that
right so those were the six technical
things now gonna head to work for the
behavioral things as well thank you so
when you're operating at scale it's not
just about technology it is also in part
but that's half of the problem if you
for example there's books like people
wear something like that that say what
fails is people fail right and one of
the things is taking to account small
things because some things are so
obvious that we just ditched them out
we're like yeah that's this is never
gonna happen and then it happens exactly
in the worst time possible that's how
life goes you know there's karma and
karma comes in and say by the way I
don't know why karma talks like that so
breaking things is part of progress
right it's it is part of it if you don't
break something you either like really
good at it and please join our company
if you break things you're you're just
learning it's part of it so please also
join our company we broke some things by
the way just out of curiosity how many
like just put your hand in the air if
you use corny T's or you have to deal
with it okay and just put your hand in
the air if you ever drop the database in
the testing environment okay guys our
booth is over there okay I've heard
production somewhere yeah that was me
okay
so as I said breaking things is part of
progress but when you are 80 years old
you're gonna look back in your life and
you want to reduce as much as possible
regret right
and one way to do that is taking small
steps you can still break things but the
impact is not as much as if you I don't
know for example releasing in one small
country against releasing it really
really big country right the
consequences are huge so as to give a
real life example Apollo was released
initially in one of our small not so
small but small markets against for
example releasing in India right if
suddenly nobody sees images you get
pissed off like I would get I would like
I wouldn't break my phone but I would be
imagining it I don't know and we are at
the time where if a page takes ten
milliseconds more time to load we get
pissed off it's true it's sure I hope so
another thing is optimizing lazily and
this is this is actually sounds very
obvious but it's not so obvious and
recently I was talking to a developer
and we're discussing the architecture of
something we're developing and it's like
yeah you know what let's think about the
caching and maybe like another layer of
cash no no don't introduce cache so
early on in the process because you have
no idea what you're optimizing you're
just like putting a layer of cache and
that's it you can think about things up
to a certain point but first check how
things react how it reacts to the
traffic whatever is happening there
employee s eries and this is a super
Urich this is our s for Simon which is
our s re we're now have more people in
the team so who knows what is re is by
the way who is a necessary oh god I was
going to throw a lot of lies which I
know I'm in a bad spot anyways so s
arteries are not only responsible for
the performance of your application but
also if you have s la's part of the
responsibility is of them as well also
of team because we're
team we're not just working individually
right so if you have someone
specifically responsible for the
performance of our application trust me
this will help a lot especially because
it's let me give an example if I do
front-end it's gonna look horrible
and you're gonna say immediately or some
programmer did this right with really
weird colors but then if you have a
front-end engineer you know with a lot
of experience and design background
whatever it comes in and it makes it
really look beautiful and you know I
never knew could make things like that
that's what happens when you hire essary
right also he comes in he starts I don't
know creating these dashboards or like
throwing some mathematics at you and
that you don't know of I should know but
I don't know yeah so one person
responsible for performance of the
application it's really important we had
before we ordered or Gandalf a good
example is actually number number comes
with a lot of different backends you can
go for the simple one where just do the
image resizing in Python at super
blazing the high speed of Python but of
course you can also compile OpenCV
against it and we are all Java
developers we're not compiling C code
right we don't know what making is you
gotta not touch make no actually I built
this in make but you get the point right
so and rs3 was actually looking into a
heyguys Python for that sucks when you
can have open CV because that uses
single structure multiple dates of
things on the CPU and I'm like wow
single instruction multiple data sounds
awesome and he compiled something it
does arcane magic to it and all of them
that thing is three times faster which
is a system that is heavily CPU bound in
terms of scaling images this doing math
doing calculations calculating averages
and then all of a sudden you get a 3x
faster how often do you get things
reacts faster in a web application it's
quite awesome and usually operations
engineers go for like setting up your
server and Turing's everything runs
everything recovers and the engineers
maybe they make timeouts configurable
and you know like putting knobs to
configure connection pools for databases
but who actually looks at what is the
right time out what's the right
connection pool size
what's happening exactly on the database
our legacy database able to optimize the
table finally both of those guys don't
really have the time to look at and this
is actually part where Esther is sitting
between those really can rock and they
get three at 2x 3x performance
improvements so let's all give a clap to
that guy at the end so thank you for
that
so another practice is to say no and
this is why we'd like but here's draw
Gandalf he has like a very pointy beard
but so saying no is also it's a hard to
say no especially if the person on the
other side is someone like you know for
a while and you know that they're going
through I don't know they need it and
you know that they are under pressure
there's so many reasons for it to be
able to say no and there's other people
that just like no like parents right
like parents are like no and then you
why because I said no if you say that to
a client he's gonna be like how you want
drugs it's like I'm just gonna like use
another service provider and we're
talking about internally in the company
so say just to give you a practical
example one of our teams came to us and
they asked you know we have this
business platform and we have
professional users that spend a lot of
money here and what they need is a
watermark for the images right they're
selling cars so you need to put a warmer
okay sounds so far good and they asked
this okay so since you're providing or
you're using the images serving them
through an API can we just you know put
their the ID of the user and then we
send the watermark there and then when
we fetch the image we use the ID for
this and then I'm lost
what like no this is where you say no
but then you show an alternative okay
then you just upload the image to our
service and then
through a signed request you can
actually say this images uses it was
watermark and why sign so nobody can
change it you don't have the secret you
cannot change this we actually use
jadibooti for this so it's everything is
encrypted inside you it's actually not
transferred for the user it doesn't see
actually no one cares honestly I don't
know maybe the cybersecurity guy
actually looks at the URLs but but
overall if it's there you find an
alternative you give an alternative and
clients are like ok it works that's how
they care for it works and that's it
yeah before we go to questions I just
want to say thank you to talk to those
two to that lady in that gentleman in
the front right front left for you who
actually two of the software engineers
making a Paolo great ally if you have
any like of course you're gonna do
question ii but if you have to what you
want to know what we tell tall the truth
maybe putting a little extra Gatien here
or there go over there ask them yeah
and now do you have any questions
if it's too hard the questions just take
us on the side because we don't want to
get embarrassed here the question was
what about drunk face development
because it was written in the abstract
we figured out this morning we have to
refactor the slides and there they went
yes we're doing this development that
means every software engineers pushes to
master and we do a video siren if that
passes it can go to the right key we use
chat ups for that so in in slack you get
a information saying you could not
deposit into the direction we've always
done it from the beginning on first of
all because we believe that this
enforces the right kind of practices it
removes artificial safety nets and like
there is a beautiful website rank based
development comm pretty good really
in-depth about what can if you do if you
are as crazy as going push to master
like we did in university what can you
do to make that safe a couple of things
to make that safe is programmed like
programmed offensively so first like if
you write new code only have it executed
by a unit test and you can commit at any
time as long as it compiles but then the
moment you're done with your new code
you just make one commit that enables
the new code effectively the same as a
full request that you work actually for
enforce test driven us you can also
build a bigger safety net around
automation test we've done that we have
quite a nice automation test coverage
for what we believe is important to not
break and everybody like it's also it's
a bit of a cultural shift it's not it's
not like you can just go and commit to
production every day there is a sort of
responsibility and people need to know
what to do and commits need to be right
it puts a lot of it puts a lot of
responsibility on the commit being like
following good practices because if you
commit half-done features that break the
break production of course is not going
to work
but if you if you get if you change your
minds it's going like it is committing
compulsive production by building in a
feature switch I'm just gonna be test
driven this code is not gonna be
executed if you have a class that only
gets called by a unit test you can
deploy it to production anytime it you -
or it can't matter I think it's also
giving a bit of freedom to software
engineers we don't have this revenue
which in many companies is a bit
poisonous at the same time we said we
want to go with this very small team we
believe in small teams being empowered
to do big things you give us much if you
have a big company like Google it's
awesome because at any point at any
second of the day you have 50 software
engineers you can do a code review right
now for you and it will just do just
that and give you feedback and you wait
10 minutes and then and then you get the
feedback and then you can actually merge
or dead guy emerges for you whatever
awesome okay Apollo team is right now
five people and all of them are busy and
you know waiting for somebody really
pull request is probably not a matter of
minutes rather hours or maybe a day and
then you know it's not a smooth anymore
you introduced already delays when of
course we want to go more like
continuous deployment continues delivery
when we really get our coach into faster
production but entry that introduces
another halt in the process that's the
short version there's this awesome
website rank based development comic
really recommend it and we can also chat
afterwards if you want more reasoning
because I have a ton of it and just I
just want to add something so I was not
coming from the trunk by Slaton and it's
quite a shift like mentally it's you
have to go through this change and at
some point we're like okay guys we're
gonna switch completely from like a no
request whatever just to trunk based
development like your inner self is like
what you're like you get scared and like
what the
and it's true it's quite a big shift you
can do it and I can tell you that after
a while it actually feels just natural
and it's like everything there is a
learning curve to everything any new
language you learn there's always that
but after you cross that line he
actually feels
right because you know you feel
comfortable and now it's your new home
or whatever so I think that's actually
worked out pretty well how often do we
deploy the new versus direction
I mean Apollo we right now at how many
times three will be a week yeah we still
the still in the learning process I
think there's still a bit of a being
scare to actually really go to
production all the time which is by
nature we all use to you know if you
have this I have a feature branch I
could only when i merge it and then of
course releases are always like Indiana
Jones when he tries to swap that golden
figure with the sent back we all still
used to it we're trying to get get
better at that I think for next year
we're going to look at having at maximum
to commit spur deployment we're just
gonna give us more yeah I'm gonna just
add something also for example when you
pushed Jesus Christ sir when you push to
master something that happens not in our
projects at least I know one that
happens you push it and there is a
percentage of the traffic that gets
cloned to the staging environment and
this means that very quickly you get
feedback so if you break something quick
feedback because quick feedback is also
extremely important to make sure you
don't push it to production there you're
like oh god now we have to roll back and
yeah there's consequences for everything
right we have time for one last question
okay I think you were first
how do we structure the database with
kubernetes and the different charts we
have three identical databases in each
cluster they don't share database it's
the same database schema obviously we
use flyweight to worship their face so
we can be sure that it's the same
everywhere but they're completely like
those three clusters don't know of each
other we can switch off to at any point
in time of course somebody will get
really pissed with us but you know in
theory the surgeon would continue to
work they're really all identical ok
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>