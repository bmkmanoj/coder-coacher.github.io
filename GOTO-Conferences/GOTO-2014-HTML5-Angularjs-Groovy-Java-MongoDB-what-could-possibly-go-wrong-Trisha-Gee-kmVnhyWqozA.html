<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2014 • HTML5, Angular.js, Groovy, Java &amp; MongoDB - what could possibly go wrong? • Trisha Gee | Coder Coacher - Coaching Coders</title><meta content="GOTO 2014 • HTML5, Angular.js, Groovy, Java &amp; MongoDB - what could possibly go wrong? • Trisha Gee - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2014 • HTML5, Angular.js, Groovy, Java &amp; MongoDB - what could possibly go wrong? • Trisha Gee</b></h2><h5 class="post__date">2014-08-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kmVnhyWqozA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you may or may not seen that there's a
video of this presentation has already
gone up on
so I thought well since there is a video
of it already I'm going to completely
rewrite it for this which I did on the
plane on the way over so that's not
fraught with danger at all it's gonna be
completely fine the point here is I
wanted to demonstrate a building
application end to end including MongoDB
at the back end obviously because that's
who I work for but a web app from the
front end and try and do that inside 50
minutes to show mostly to disprove this
idea that Java is kind of slow and
boilerplate II and you want to do your
prototyping in Ruby and then eventually
migrate it to the JVM I kind of wanted
to disprove all of that so it's a fully
buzzword compliant application I'm doing
angular in html5 and JavaScript and all
that funky new stuff using bootstrap for
the UI and I'm using a library a really
lightweight library called drop wizard
which brings together lots of standards
and lots of standard libraries to build
a web back-end in Java
obviously MongoDB using a library called
Mongo Jack to talk to MongoDB which
you'll see a bit more of later and then
in sort of supporting roles you'll see
grade or groovy Spock and and I lean
heavily on IntelliJ IDEA to actually do
this performance which now I feel very
worried about because Dan said earlier
that leaning on the IDE is a sign of a
lot of complexity which may or may not
be the case and the idea here is so who
is a Java person here good I'm are you
doing JavaScript as well or mostly just
JavaScript as well a few of you so if
your Java people you might learn a bit
about some of angularjs and web
front-end stuff I was very new to this I
haven't done any web development stuff
for five or six years if you've already
done angular and this sort of thing then
you're probably not going to pick up
anything new here the idea is just to
kind of show everything working
end-to-end obviously I don't have time
to go into anything in any real depth
and for non Java people then I kind of
want to demonstrate that Java is not
necessarily big and heavy and clunky and
clumsy although you may or may not agree
with that conclusion and obviously
you'll get an idea of using MongoDB to
prototype rapidly I mean one of the
ideas of MongoDB is it's really
lightweight it's very easy to get
started in your application without
having to kind of come up with these
massive data schemas upfront and you I
was going to push really strongly about
how much you're going to learn to use
your IDE but now I feel really nervous
about saying that so you might learn
that if you've got the right tools you
can be very productive if you know how
to use those tools including your IDE
the idea of the app is very simple the
app is designed to work on your phone
it's not an Android app because I'm not
that mental what it is is you navigate
to a webpage you it will locate for you
your nearest coffee shop you'll place an
order for that coffee and then you will
walk into that coffee shop pick up the
coffee and hopefully drink that coffee
it's quite simple app that the concepts
are quite simple probably someone's
already done something like this but I
wanted something which is kind of a real
life possible app not a toy app
necessarily to demonstrate this
end-to-end functionality so let's jump
straight in because I'm very worried
about getting it all done inside 50
minutes I want to do it this in a kind
of user story kind of way so story zero
is as a user of this amazing application
and need to be able to see it now that
sounds a little bit like story zero
implement app and that's not quite what
I meant it's basically code for as a
developer I need an app server to deploy
this too and I need kind of
infrastructure and framework before I
can get going so let's dive straight in
can you see that okay in the back or do
you want me to make it bigger hands up
if you want it bigger loads of you okay
fine
is that big enough - big big enough yes
okay so I'm using Gradle to manage my
dependencies who's using Gradle quite a
few of you not that many it's okay so
who doesn't know what Gradle is okay so
Gradle kind of I'm just using it mostly
to pull in my dependencies for Java it's
only for the Java side it's not the
front-end side it's just Java and here
I've got to run some dependencies so I
mentioned I was going to use drop wizard
so that's this one here and Mongo Jack
for talking to MongoDB the others are
testing dependencies and this is all
there is to it for Gradle to kind of get
up and running I can create this into my
massive build script if I want it to be
a massive build script but out of the
box
it just works and I get a lot of the
default targets like spec like test and
run and compile and build and all that
sort of thing
so this is a release of the most
skeleton Gradle build file you can have
so that's Gradle so what I need to do is
I'm going to create a service which is
going to spin up the backend and and get
my app server running hang on this is
not that's better
if people have questions halfway through
then they can ask them but I may or may
not have time or ability to answer them
while I'm typing at the same time but
feel free to shout out questions so this
is going to extend a drop wizard service
and now I remember I have not put my
glasses on and I can't see anything
coffee and this needs this takes a
configuration file so I'm going to give
it a coffee shop configuration but I'm
not really going to do anything with
this because I have no special
configuration for for my for my service
I'm going to implement the default
methods I'm going to get IntelliJ - you
can't really see any of this can you
it's a bit too big
can you read enough or do we want to
make it tiny bit smaller silence but a
bit small a tiny bit smaller let's try
that in between ok that seems to fit on
the screen and it's a bit bigger than it
was before all right so I'm just going
to get IntelliJ to fix all my problems
for me which is make this thing extend
this other thing I don't really need to
worry too much about this the
initialization I'll come to in a minute
and the run I'll come to in a minute
this is our main this is our main
application which is going to run on the
back end so it needs a public static
void main method that's a default
shortcut which comes in IntelliJ so I
didn't have to do loads of typing it
just works we have a new coffee shop
service dot run that's going to take my
args I'm going to tell it to deal with
exceptions the way it knows how
implement the run method resource
I typed coffee shop a lot of times and I
was creating this and this is going to
be my my web research resource my web
services resource so people using
restful web services okay there's some
nods around the room so this is my
restful web service for more information
you can read the web services Weber's
and Weber they're worth of services book
but I'm going to tell it that it's my
route with the app by saying the path is
going to be slash coffee shop I care
about consuming and creating JSON I'm
not going to do much with this right now
that I will definitely come to this
later but I need one of those to get my
application up and running now if I try
and run this it should fail for the
correct reason which will be I haven't
given it enough initialization yet so I
need to tell it what I'm trying to run
as a server
oops
which I've spelled badly
now when I run that it shouldn't error
what we should see
oh no I've let you enter there so we
should see a 404 so that means at least
I have a web server up and running
super easy peasy I don't have this
coffee HTML file yet so I'm getting a
404 now one of the things I really like
about this is drop with sadducees jetty
as its web server and it's like super
lightweight and super fast and I used it
before and I find this really nice
especially for development because the
startup time is like a second or two and
that just comes now I've done this as
part of drop wizard it just does all of
that for me so it just gets out the way
and I don't have to worry about it too
much now what I want to do is I need to
serve my aesthetic coffee HTML file
let's call this something useful and I
need to tell it that I'm going to serve
static content as well as my Java for
dealing with my web resources so I need
to have a configuration file and I need
to cheat I just got a quick cheat in
there because otherwise I'll type it
wrong which says that anything I post or
get from the /url at the URL with slash
service in it I want that to go to my
java stuff I want that to go to
ultimately coffee shop resource okay so
that's how I point all of that stuff
over there and then what I want to do is
I want to say I want to serve a static
HTML as well so that was a bit of a
cheat as well because all this typing
would be too boring and so here I say
I'm going to initialize my application
with this bundle slash HTML is where my
HTML is it's in resources slash HTML and
so anything that just goes straight to
the the root of the of the application I
want it to serve static HTML content for
that so what you should see when I do
that is if I restart the
server there's an awful lot of shoulds
and hopefully in woods when you're doing
this live demo thing or totally not work
what did I not do I remember it's the
same thing I always do wrong but you
need to tell it where to find the
configuration file so it needs to have
config you know what was called coffee
dot yeah more so now when I restart that
yay no more 404 and from the title in
the top we know we're serving the
correct page okay so that was kind of
the the necessary evil of setup now when
I started projects in the past I've
always found that getting everything up
and running getting a web server getting
the the the glue to get everything to
work is quite tedious but I've just
found that with drop wizard it's not
that difficult it's just a few lines of
code and everything is kind of glued
together and ready for me to start
implementing the more interesting stuff
in my application so story one as a
coffee drinker I would like to be able
to select the coffee I want to order
because otherwise what's the point so
what I'm going to do is I'm going to
have a drop-down on here which is the
type of coffee I can order and I'm going
to do this in in the angular so let's
get rid of the stuff we don't need that
means I'm going to make this into an
angular app oops I couldn't put that in
the wrong place and I need to include
angular this is a shortcut that intellij
comes with so I don't have to type
everything and it also really nicely
does autocomplete on my includes as well
which I when i was doing web development
about five years ago everything was just
typing right and and now a lot of this
is automated so you make a lot less a
lot of fewer errors so the other thing I
need is I need my own javascript file
which I'm going to call surprisingly
coffee I need to create one of those
I need to tell it it's an angular module
this is another shortcut that comes with
IntelliJ coffee and I get my the things
I'd expect as a Java programmer I can
extract this as a variable even though
it's JavaScript like this is probably
not used to some of you but for me it
was really nice to be able to use a
proper IDE for doing JavaScript
development because I always did it in
notepad before right so I've created my
application I have included it in my
HTML page I need a I need the list of
drinks to select from so I want to be
able to select a cappuccino or a latte
or whatever which means I need a
controller for this so this is like
those of this angular stuff is just
built into the angular plugin for
IntelliJ
and that is not built into IntelliJ so
who I'm just got an array of the
different types of coffees that you
might be able to order and for now I'm
using a hard-coded array but you can
imagine over time you might you might
refactor this to be something that you
pull out of a database or from a file or
from another web service something like
that so now I need to actually have this
in here so I need in a div this needs to
be an NG controller because I said there
was a controller I need to call this
looking again I get my nice autocomplete
so I need to call it the same thing it
was called in my JavaScript file and I
am going to have a slight shortcut just
for creating this div with a form group
so might form elements are separated I'm
going to call this type of coffee and
I'm going to create a drop-down an
angular drop-down populated with the
data from from angular so this is going
to be drink dot type this is going to be
type dot name for type in types and so
here my array is called types and these
are objects JavaScript objects
lightweight objects so they've got a
name and a family so we've got coffee
coffee the other thing that's not coffee
and I only want to display in the
drop-down I just want to display the
name so for that I just say type name
just show me type dot name for every
type in there so I'm going to iterate
over that and hopefully yes so now we
have our type we've got a drop-down we
just got the same values from the
ArrayList and I can do things that you'd
expect to be able to do so I want to be
able to reorder this alphabetically
because it's just coming in the order it
came from the list because lists are by
default ordered and so I'm gonna do that
by saying order by name
oops wait for it sir there we go so a
CLT great so that's kind of the really
simple stuff of using angular to get
stuff from some sort of data source in
this case an array and just shoving it
onto the screen that's story one but as
the coffee shop I need to know what size
you wanted because it's all well and
good saying cappuccino but which sized
if you want but I also want to know your
name so I don't just hand it out to
someone randomly so it's the same sort
of thing here there's no real magic here
I just want to build up something which
is more useful so here I've got an array
of sizes small medium large these are
simple these are just strings they're
not objects and similarly here I have
that was an intelligent for another
drop-down for size here I just need to
do size for size and sizes because I'm
not pulling out a specific value off the
object so that's easy and then in here
I'm gonna have a name as well so label
your name and drink drinker so that's
you I'm going to make this a required
field so that you know you can pick up
the correct drink in the coffee shop and
then I'm going to reload that so now
we've got type and we've got size and I
can put my name in here so that's all
great but I promised you angular and
HTML of modern web application
development and so far you've seen
something which looks a little bit like
the stuff I was doing in 1997 it's not
terribly pretty
so this is where bootstrap comes in so
bootstrap is a really nice
CSS library from Twitter I think and
it's it's just really really awesome so
I'm going to include this in here
bootstrap CSS
I've already slightly cheated because I
put the correct class names on here
anyway so I've got container and form
group I've got form control so there's a
tiny bit of cheat the other thing you
need is the magic incantation for making
it friendly on phones which I won't
pretend to understand but it works
you can see I'm not a web developer
right so then when I've done that I get
magically something which kind of looks
like it's a bit more polished and the
nice thing is do people use the web
development tools in Chrome yeah I don't
know how we did web development without
it before but there's also a cool kind
of thing here you can do an emulation
mode for your mobile phone I'm emulating
on the Nexus 5 so you can't really see
it very well but you get the idea of how
much space it's going to take up on the
screen so you can even you know do that
in mobile type mode but we're not going
to use that because no one can see that
so the bit that I always found quite
painful about web development this idea
of trying to apply a CSS in a useful way
which will lay it out in a pretty
fashion and took like almost zero time
at all sorry I was doing story three it
didn't take very long to get something
that was a very basic thing looking a
bit more polished and you can imagine
that you can iterate over this and make
it more custom to you but you don't have
to spend ages learning CSS and wondering
what a div is supposed to be and that's
it oops
now I've done that I've got a screen but
I actually need to be able to send it
send the order to the shop this is where
we start doing the interesting bit of
tying up the web front-end stuff to the
the Java back-end using rest and JSON
and all those buzzword compliant things
so obviously we need an input button
and this one is going to be called given
coffee the more exclamation marks is the
more you need the caffeine these are
classes that come from bootstrap I'm
just going to make this button even
bigger so I'm going to make it a large
button I'm going to put this inside a
form which shouldn't come as a shock to
anyone I'm gonna put it in an angular
form it's got ng submit on it and this
is going to call give me coffee now
before we go much further with this what
I'd like to do is I'd like to have a
look at the data I'm going to submit to
the backend so this is more for debug
purposes than anything else
but if I output this drink object so you
see I've got here drink type drink lot
size drink dog drinker so this there's
this idea of a drink object I'm going to
output that in JSON style on the screen
we've got a big button and then as I add
things there I could see my JSON object
so I've got I've got my object which is
the drink type I've got the string value
for size the string value for for me Who
I am
so this is the thing this is the JSON
that's going to get submitted to the
backend when I press this button so
let's implement give me coffee in my
JavaScript I need scope dot give me
coffee there's a new functional function
and then it's just going to be so I get
a complete blank coffee order dot save
what I'm going to do is I'm going to
give it in real life or in a further
later iteration it's going to need the
idea of the coffee shop that it's going
to go to but we haven't done that yet
we've just said this is the order so I'm
going to hard-code an ID for the time
being the scope drink which is the thing
we printed out to this to the screen
that needs to be submitted
now this coffee order is going to be so
I'm not I'm not going to pretend to be
an expert on angular or angular best
practices at all because I'm not and I
learnt this in about a week or so but
that's kind of the point you can get up
and running in this fairly quickly
without having to learn everything about
JavaScript HTML on the web and so ng
hole so IntelliJ does actually provide
lots of useful shortcuts but then you
have to remember what they are coffee
order this is going to use resource
which I'm going to go to in a minute and
this is going to do okay so this is
going to take this drink object with
this coffee shop ID it's going to post
it to slash service which we said was
the URL for the the Java classes slash
coffee shop because in my resource
it's called slash coffee shop the ID is
the coffee shop ID and I'm going to post
the order object off to that URL this
resource here I need to include another
module from angular to use that and the
resources to do the web resources and so
I need to include that in here as well
and then in theory in theory if I if I
try and post this order that we created
here let's reload it because that's all
it changes what we should see down in
the resources is we in the network
resources you can't really see the text
very well but you should see it trying
to hit that URL so here's my order ok so
we're going to order coffee shop service
and we get a 404 which is the correct
arrow because we haven't implemented it
yet
so let's go to the backend and let's do
a tiny tiny cheat to magically get what
I want so this is the this is the URL
that I said I was doing the ID is the
coffee shop ID so path program ID coffee
shop ID we're going to post it and we're
expecting JSON and the the drink object
that was on on the UI is going to be an
order object on the backend save order
and then when it's successfully done I'm
going to create a I'm going to return a
response of created which is a 201 and
so I have to create the URI and this is
going to be the idea of the order so
later on if I want to I can get that
order and I'm going to post the contents
the order so that the the UI can look at
it and do useful stuff with it so let's
create this order class here let's get
IntelliJ to create this for me so what's
this done this has created me an idea on
the order I need a magic incantation to
tell Mongo Jack that this is an ID for
MongoDB so when you say something into
MongoDB without an ID by default it will
generate you an object ID now I want to
treat that as a string I don't want to
treat it as a MongoDB object ID class
because I don't want that leaking all
over my domain I just want to treat it
as a string so I need this magic
incantation does they turning it turn it
into an object ID when it goes into the
database and I know this to tell Mongo
Jack that this is the unique identifier
for this object
so let's build up this objects as we go
so I want to set this coffee shop ID on
the order set coffee shop ID
so that's created me a coffee shop ID
field the other thing is what else are
we missing so here this is the JSON that
I'm expecting to see posted back to the
backend so I want my order object to
look a little bit like that so let's
just paste that in there so that I know
what it looks like so we remember that
this type is an object in its own right
so I'm going to create a private drink
type type here just to make things as
easy as possible I'm going to map the
field names to be exactly the same as
the the name that comes in off the JSON
you don't have to you could say it's
going to be called something different
if you want to but the simplicity it
just magically Maps this to this and
I'll come to that in a minute
private string size and private I'm
going to need this later on selected
options and that's yeah I'll come to
that later on and a private string or
drinker not that Trisha is a drinker at
all no no no so let's create this drink
type great clustering type
and the drink type had a name and a
family and that's all we need on drink
type but because this is Java we also
need getters and we need a equals and
hashcode this is mostly for tests
because I'm going to do comparisons in
the test and we need a two string so
that when my test fails I can see what
the object looks like so I don't know
what they mean when they say Java is for
both so I really I think it's fine
nothing wrong with this class with two
fields in it it's totally fine
what's that the setters I don't need the
setters for this and so the mom no Jack
will use the getters to figure out which
fields to serialize and deserialize
either into well Jackson will do it for
the JSON side and Mongo Jack will do for
this putting it into MongoDB you can use
setters as well especially if you're
going to play with the names and I would
also have yeah I would make these
immutable and have a constructor with
all the things in but to get the
absolute bare minimum working this is
all you need so if you're doing some
rapid prototyping you're not quite sure
of the shape of your and of your objects
yet all you need is the fields and the
getters and it will just do all that for
you so let's go back to my order because
we'll we'll also need all the all the
getters for the order why do I have a
constructor I don't need one of those so
I need all my guesses for these I'm not
going to put equals and hashcode and
stuff because I don't need those for the
the tests I needed them only for the
tests so what we want to do though of
course is the meat of this who want to
save this into MongoDB I've received an
order from the customer it's been
serialized magically from JSON into my
order type which is nice have just got
two main objects to deal with I don't
have to deal with the glue of saying get
this field get this field get this field
it's just taken care of but I do want to
save that into MongoDB so I'm going to
save it into my database
oh come on IntelliJ don't fail me now
and I want to have that's final because
it's a good thing to do MongoDB has this
idea of so it's a no sequel database is
a document database still stuff in a
JSON type way not in tables and columns
and rows and things like that and so
instead of having tables we have
collections so I'm going to get my
orders collection which I might actually
have called order now I think about it
I'm not sure we'll see the test will
tell me if I've done it wrong and in
order to get Mongo Jack to magically
turn my order object into something that
MongoDB understands I need to create a
jackson DB collection I'm gonna wrap
this underlying orders collection I'm
going to give it the type that needs
transforming so I I'm storing orders so
I need to give it an order doc class
because Java is a bit twitchy about
generics for example I'm gonna give it
the type of the ID because I'm storing
it as a string not as an object ID so
I'm gonna give that the type of the ID
as well so then I end up with a
collection which is typed with order and
string and then it's a simple as
collection dot insert order
and it just does it just saves it into
the database for you so obviously I'm
going to have to do some sort of error
handling maybe so it's just some simple
basic error handling just because it's a
good thing to do and of course as your
application matures you can add more
complex error handling for different
error cases but if it's no I want to
return response dot let's call it server
error which isn't quite right because
that's a 500 and if it's it should
perhaps be a different error but that
will do for now if it's successful what
I need to do is Mongo will have
allocated me a unique ID for this order
so I need to set my ID and this is going
to come back on the right result so get
saved ID and this will come back as a
string because I told it it was a string
type now in theory that's all I need to
do but because what's that yes I did
that last time and wondered why I kept
getting further errors thank you and
that's why you pair with people because
people are idiots mean not you not
obviously you're obviously much smarter
than me but you can't see when you're
that close so I've written a spock test
anyone does anyone know what spock is
and you will not know what Spock is
spock is amazing and if you're doing
unit testing or acceptance testing i
definitely have a look at spock it is
written in groovy which made me a bit
like oh I don't want to write groovy
code because like I write Java I don't
need groovy code but it's much more it's
much more descriptive so here I want to
do this so my test is should give me
back the order ID when an order is
successfully created and this is a
string and I've got a given and when and
then and and it's just much more
descriptive what's going on it kind of
forces you to think about what is setup
what is what's the thing you're actually
testing and then what are your
assertions and it also makes mocking
like really ridiculously easy so we were
switching all of our unit tests to Spock
even though it was supposed to be
writing just Java for the Java
Java driver for MongoDB so let's run
this and see what I've done wrong
because I will definitely done something
wrong as always because and I don't want
to start up the server and then do UI
stuff to find out I did something wrong
the unit tests will show me much sooner
what I did wrong so here I changed the
signature so it takes a database but I
didn't say how to initialize the Mongo
database now I'm going to run my I'm
running my Mongo on on defaults so by
default Mongo client is localhost on 27
Oh something something so I don't find
those because I've already got them but
I could pass in the host or the address
of where the server is that's super easy
and then I just need to get the database
from there so Mongo client get database
Trisha coffee
and pass that in now my test should pass
downside a Spock it's a little bit
slower than using unit test J unit unit
tests right so that went green yes I
love green test they just give me
validation of my existence that's not
really true that would be quite sad if
that's true so have a functional test as
well that was just a unit test so I had
some mocks mocking out the database now
I want a functional test just to provide
that extra step of safety to make sure
I'm saving all the fields I think I'm
saving into the database which means I
need to spin up my MongoDB instance and
in order to do that I just need to start
MongoDB that's it it's running let's
have a quick look at it at the moment so
if I do show DB's oh no I've already got
coffee let's get rid of that so let's
clear that that's create a new one
let's start that back up again
how puzzling
let's drop that
drop
yeah I see the drop database will drop
dB yeah so now we should see that we we
don't have all you can't really see that
very well but can't change the font size
on that he says some database admin and
local so there's like no databases in
there at the moment so if we run this
functional test and we're inserting this
into Trisha coffee the database and the
collection of orders and it went green
first time that's amazing
did not expect that and then if we go
here and we just do show DB's it's
created Trisha coffee so we're going to
use Trisha coffee and we're gonna do dB
orders dot find just play it in a pretty
way you can't really see the shape of
that row well but we've got this
generated objects ID which MongoDB gave
us we have this embedded document which
is the drink type with a name and the
family we've got a simple field which is
a size of medium we have an array in
here which is the selected options in
this case soymilk we've got the drinker
and then we've got a coffee shop ID as
well so it's just basically JSON --is--
data stored in MongoDB now if we where
was I if we restart our web server we
should pick up our new message we've
created a new method so we need to do a
restart it's just not going to hot
deploy that in theory now when we post
this we shouldn't get the 404 okay so
what we've got done here is we've got
two or one create it and if I look here
I can change the size of this view they
go
it's a bit better so now if we do find
we've got two we've got the one that was
created by the test and we've got the
one which I created from the webpage and
they're not exactly the same size same
shape because this thing's got an array
in it and this thing doesn't have an
array in it and that's totally fine
Mongo doesn't care about that which is
why it's quite good for prototyping and
rapid development because you can just
chuck stuff in there over any shape and
it's like that's totally fine it's just
up to you how you get that data back and
how you parse it what time is it I've
got ten minutes ten minutes cool what
could possibly go wrong
we are saving stuff into the database
and I've got ten minutes left so that's
quite good but we want to do some good
stuff we've heard a few things about
DevOps and about the responsibilities of
developers to try and make things as
easy as possible in the transition to
production for example one of the things
you don't really want is your production
web server running out of memory or
connections or just basically falling
over for whatever reason so you need to
make sure that you close all your Mongo
connections when your web server shuts
down and drop wizard makes it really
easy to manage things like this manage
the lifecycle of this stuff as well so
all we need to do to be a responsible
developer is in our coffee shop service
where we created our Mongo client we
need to add a new manage resource
I don't know why it's asking me about
get I didn't even know I had to get on
here create field for this blah blah
blah I only need managed I'm going to
implement all my methods from here a
MongoDB I don't care about what happens
on start maybe I might want to do
something like make a test connection
and make sure it's there and
everything's fine
but for this purpose I don't need to and
it don't care about that at the moment
but on stop what I do need to do is I
need to close all my connections when we
stop the webserver and it's as simple as
that
and now I just need to restart my my web
server and just make sure everything
still works the same way it's supposed
to
and we can see in here that what so
that's great and we were responsible
developers and it took us like zero
effort now one of the things you don't
really want users doing is checking the
Google Chrome Network window to make
sure that their order got sent right so
you want to give some sort of feedback
saying yes your order was received thank
you very much so we're going to use some
widgets from UI bootstrap to do this for
us so this UI bootstraps kind of cool it
uses some angular stuff and some
bootstrap stuff to give you some nice
pretty widgets that are reusable and you
can you can do cool stuff with them
without you having to write everything
from scratch now now I just have to
remember how to do that so let's have
ourselves a new array called messages
it's got nothing in it at the moment
what we want to do is on this coffee
order dot save there are some extra
parameters we can put in here so I can
put in a success callback so I'm gonna
say here's one I prepared earlier oh no
you guys didn't get that in this country
nevermind
and so when I want to get a successful
save then onto this messages array I'm
going to push a message of type success
with a message of order sent now you
could do all sorts of stuff with this so
for example I was sending back the order
ID and the whole order objects if you
wanted to you could display the details
of the order in the success message you
could link back to the original order
stuff like that but for the simple thing
I'm just going to say yeah I got it
everything was fine and then I'm going
to put in here
a shortcut I can't remember oh look at
that message so yes that was another
cheat not and IntelliJ reading my mind
moment so here I'm using this alert
reusable thing to read everything in
that messages array and to display it in
some useful way I also need a way to
close that so I need a close alert which
will close that down
and this is using UI bootstrap so I need
to add this to my modules UI bootstrap
and in here I need to add UI bootstrap
j/s you are a bootstrap and then it
should work
so now I get a nice green that is green
right I'm red green colorblind so I
can't tell the difference but you get a
nice green alert at the top saying yeah
your order was sent and you could put
things in there like a link to the order
and you can close that down and the
other thing you could do of course is I
added a success message but the next
parameter in would be a failure message
so something went wrong I could display
an alert saying I couldn't find a server
or your order is ridiculous and there's
no way we're going to fulfill that
there's a couple of other extra things I
wanted to cover but I don't think we've
got time so this in the back end I added
this array for selected options so you
could kind of freeform add like soy milk
and caramel and decaf and I mean who
wants decaf coffee that's ridiculous and
to be able to freeform add stuff as well
and I wanted to show that you can add
that and just put them into MongoDB
without MongoDB knowing what those
values are and it's totally fine you'll
just have to take my word for it because
I think I don't have time to do that but
what I did want to show is I need to
know where to pick this coffee up from I
said we were going to order it from our
nearest coffee shop but I haven't done
anything about nearest coffee shop and
I've hard coded a coffee shop ID so it
has no idea where it's going so I'm
going to use some of mongos geolocation
geo features to show you how geo stuff
works with Mongo and it's just kind of
it just kind of comes out with the box
if you like so enough talk what we want
to do is we want to write firstly I have
a groovy script well that's not firstly
firstly I used
oh that was a bad idea that's just gonna
take forever oh my goodness
I'm the street map data I downloaded a
bunch of open street street map data in
XML form which has got the amenity of
necessarily the cuisine of coffee shop
so anything which has a cuisine of
coffee shop I've downloaded it in this
XML file it's it's not comprehensive but
it's is a good indication anyway and but
this XML is not in the form that MongoDB
needs it in firstly it's an XML not
Jason and secondly it has the latitude
and longitude of the points as
attributes on the XML
I need those in Geo Jason form before I
can put it into MongoDB because what I
want is a list of all the coffee shops
obviously in MongoDB so I wrote a groovy
script to do this because groovy is my
new favorite toy and I also want to show
that with groovy you can connect
directly to MongoDB using the Java
driver the same way you do in Java
without any problems I'm going to read
this coffee shop resources file I'm
going to go through each of these XML
nodes the XML stuff in groovy is really
really awesome if you've done XML stuff
in Java it's painful and in groovy it's
it's intuitive so I want to pick out the
the latitude and longitude from the XML
and I want to put it into this format
which is the Geo JSON format and then if
it's got a name then if it's got a name
and it's valid then I'm going to put it
into MongoDB so I'm just going to run
this there's a few of them
I've got 887 3 4 so now I want to do in
here
DB coffee shop doctor account I've now
got eight thousand seven hundred and
thirty-four coffee shops in here so if
we want to do let's have a look at one
of these so now we can see it's in kind
of JSON form and I've put it in geo
Jason location ok there's like loads of
it so what I want to do is I want to be
able to return I want to give you or to
give MongoDB in my current location
which is here and for it to return the
number one closest coffee shop to that
point so let's do that in here we're
going to do this as a get because we
want to get our newest location so tiny
tiny cheat there get nearest
it sounds an object and another tiny
tiny cheat because I knew I was going to
run out of time so we're going to do
that we're not using MUNGO JERRY we
don't need to use Mongo jack we just use
the raw Java driver I'm going to use the
coffee shop collection and and then I'm
going to create this query let's put
this down here so we can see it so query
builder using the location field because
that's where the location is I'm going
to give it my current massachu de'longhi
tude and say find me the closest one
within two kilometers and that's
hopefully going to find us our nearest
coffee shop and if it doesn't find one
I'm gonna get a 404 because that's the
right error to try let's test that we've
got this right so Chicago when I ran
this rather sadly the nearest coffee
shop turns out to be Starbucks which
didn't really narrow it down and that
went green so that's kind of working so
I can at least redeploy that and see if
I can get it working on on the web
server what's how we'd enter time
three minutes it's a race against the
clock and I don't know what I'm looking
for right so our previous controller was
for ordering coffee we're gonna have a
new controller for coffee shops coffee
shops which I happen to have created
earlier and I'm not an expert on angular
so I don't know if that's all best
practice but I do know that it does work
and what we want here is the coffee shop
locator because that's what I pass in
here there and I need resource and not
that and here I'm going to do the get to
the to the method I just created on the
server and then finally I need a button
to call that which I can't remember what
it's called
I was doing so well right which I called
find my coffee okay so this is another
div which uses the coffee shop
controller I just created it happens to
have a button in it which is got fine my
coffee shop and this will fire off the
the call to find a coffee shop nearest
to me now I have to turn the Wi-Fi on
which means I probably get 30,000 tweet
messages when I turn that on
please start to eat anything and when I
press find my coffee shop yes
Starbucks is my nearest coffee shop I've
created a massive hack to try and show
it onto Google which is you you pass in
the name and the location and it will
perhaps show it to you I didn't want to
do a whole embedding Google Maps into
the thing because that's not what this
talk is all about and apparently the
conference Wi-Fi is just not having any
of it but take my word for it that is
the Starbucks closest to this hotel and
that is my web app built in under an
hour thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>