<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2013 • Exiting Vacuum: Integrating Configuration Management into your Ecosystem • Sascha Bates | Coder Coacher - Coaching Coders</title><meta content="GOTO 2013 • Exiting Vacuum: Integrating Configuration Management into your Ecosystem • Sascha Bates - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2013 • Exiting Vacuum: Integrating Configuration Management into your Ecosystem • Sascha Bates</b></h2><h5 class="post__date">2015-10-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/sxNRvWXiowQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">um so in case you don't know me at all
I'm Sasha Bates I'm from Minnesota and I
have a little bit of a web presence i
have a blog where i say things with
opinions i also bootstrap to Twin Cities
the Minneapolis infra coders meetup
basically a couple of months ago and I
also podcast with some release engineers
and that's kind of fun and you can find
me on twitter if you want um why am i
qualified to talk to you uh i have been
in love with configuration management
since I met it in 2010 for that I had
been doing several years of consulting
where I did a lot of building of
infrastructure by hand writing scripts
and trying to get dev teams to use them
and that never worked well and then I
would move on because I was consulting
and pretty sure that everything would
crumble as soon as I left and so when I
met configuration management stuff in
2010 I was just like where have you been
all my life and why haven't I ever heard
of this before and why isn't everybody
using it and so that's kind of where I
was that then and also what I have found
over the years is that I've worked on a
lot of different areas in systems
whether it's ops or infrastructure or
building things and I've even done time
on Deb teams and things and what I
really find is that one of my favorite
things is working in conjunction with
dev teams to help them get going with
their apps figuring out why they can't
go or how they need to configure them or
what's going to make them work best in
production that sort of thing and so
really I'd like to think of myself as a
curator for developer happiness in a lot
of ways um so that's kind of why I think
I'm qualified to tell you things here
about this stuff um today I kind of want
to share some of the things that I've
learned in the last three or four years
with configuration management things
that I've done badly things that I've
discovered hopefully things that you can
shortcut after I tell you about them so
full disclosure I just started working
for opscode about eight weeks ago it's
no big secret that I liked chef chef is
my configuration management tool of
choice I've used a couple of others and
it's what I prefer and you would have
heard that long before I ever started
working for Opscode and that's the thing
though and that's what I have to say
about tools basically is that a tool is
just a tool
matter what you use I think it's
important for you to use something these
days with the scale that we're trying to
drive to a lot of us there's just no way
for you to get away with handcrafting
servers anymore or trying to cope with
handcrafted servers getting handed to
you and so really it doesn't really if
you came here expecting me to maybe talk
about different tools I think you're
going to be disappointed because it's
not really the tool itself it's what you
do with it that matters and most of
these tools are going to do a lot of the
same things their implementations will
vary a little bit but in general they're
all the same as far as what we're going
to talk about today they have a lot of
the same implementation types and the
same styles and for me I want you to use
one and we can argue about it off lime
over a beer which one is best but here
I'm not going to do that so why am I
here I like to dive into things I don't
read the manual I'm very bad at first
attempts I never asked for directions I
just like to take a use case and dive in
headfirst and figure out what I can and
that's pretty dangerous it almost never
goes well for me but it's fun and it's
interesting and so you know I think that
we might have some things to talk about
today based on some of the stuff that I
have done I have some really great code
examples at the end that are just truly
horrific that I wrote when I first
started doing this so I guess one of the
first things I want to do is start
talking about configuration management
what it is and why you might want it so
it used to be and it might still be
actually for some of you took a long
time to get a dev server and you might
be sharing it with lots of people and
there might be 30 versions of the app
running on it so that everybody could
have their own little dev space and you
might all be connecting to the same
database server right and so now one of
the things that we're trying to do is
get past that but in the meantime other
things that I'm sure have never happened
to you but sadly have happened to me in
my life wrong database connection string
information goes to production all of a
sudden it's trying to call dev and
nothing works and everybody's in a panic
right somebody the app gets deployed
with the wrong smtp settings somebody
goes in fixes it by hand and forgets
that they did that and then the next
time you deploy the app the same thing
happens your test apache server has some
funky settings that nobody understands
how to setup and the guy who did it
doesn't work here anymore and all of a
sudden you're building new servers for
whatever reason right i sat next to a
team trying to figure this out when we
were migrating from a base atg set up to
jboss several years ago and it took them
like two weeks to get this app working
and test two weeks pushin SSH keys by
hand these can get lost overwritten
they're probably somebody has to know
which ones need to go out to what
servers depending on whether or not you
have batch files that care about this
stuff or even why are you pushing SSH
keys in the first place like this right
but this kind of stuff happens all the
time in your infrastructure for a lot of
places these things can all be
controlled by configuration management
and made safe or non-issues depending on
which one you're talking about right so
let's talk about a little bit what we
want to we want to really define
configuration management here and just
say that right now it defines and I
definitely enforces system state across
your infrastructure components that
means the short story you can run
something 10 times it will configure it
right the first time and then it will
stop trying to configure it again so it
has built-in checks for everything that
it's trying to do so if you have a
package installed it will say oh hey
look this package is installed I don't
need to try and do that again that's one
of the really great things about these
tools is that they all have this
built-in to the point where you don't
have to worry about that anymore all you
have to do is tell it to use the package
manager for your OS install the package
and it's good so and the other thing too
is that configuration management and is
automation and you'll hear me use them
interchangeably quite a bit it doesn't
encompass all of automation but it
really is and so I to tend to fall into
automation this automate that
configuration management this because
just because automation is easier to say
a lot of the time
so what else configuration management
automation its freedom right it's not
it's there to remove the the uncertainty
in chance from your life you want to be
able to deploy your app in a way that
makes to make sense to you that's the
same everywhere it gives you it should
be giving you certainty it shouldn't
make you feel like you're being tied
down like you're being forced to do
something that's horrible right it's
supposed to give you a level of
certainty about what you're doing it's
supposed to give you confidence right
it's supposed to get let you know that
whenever you build a new system it's
going to look just like the system next
to it that's what it's supposed to do if
you've got 50 app servers and you need
51 your 51st app server is configured
exactly the same as the other 50 next to
it and you don't have to worry about
that it should take you 10 minutes to
provision a server once you have it in
the data center less if it's a virtual
right so I mean these are the kind of
things that you want to think about you
don't want to it's easy to feel
sometimes oppressed by this stuff
because it's new and it can be hard
especially if it's not your primary
focus right if you're trying to get code
done writing configuration management
code is it can be a hardship and the
thing to remember is that it's there to
make things easier for you in the long
run even if it's a little harder in the
short run what it's not though
configuration management it's it's not
going to save you all by itself it's not
magic it's a framework right all of them
are frameworks and so if you think that
it's going to come in and make
everything work and it's going to create
your new world order for you and make
everybody happy and work together it's
not it's just a framework you still have
to understand how to use it it can't
make decisions for you you have to make
the decisions it just makes them easier
to implement so it's really important to
understand that there's no develops
magic coming in with these tools you got
to make your own magic it just makes it
easier to make the magic really and if
you don't remember that you could be
hanging out with these guys instead
so I do have want to ask you guys a
question I'm not going to do too many of
these because people think they're dumb
and I don't really like from either
myself but I kind of want to know what
you think who I'm talking to where
you're at with this stuff because I've
worked with a lot of devs and some of
them love this and some of them rage at
me because all they want to do is write
their java code not write the
configuration management code so let's
talk about where you might be so this is
people who haven't really heard of it
don't really know what to do with it
want to like get somebody else to do it
for them maybe raise your hand that's
good I don't see any hands what about
are you in a place that's trying to do
it and you just want nothing to do with
it really nobody really well we can all
go home let's go so let's just go to the
bar I got nothing to tell you guys
you're all happy and ready to go all
right so where do we start though I mean
if you really are not sure where to
start what should we do where do we go
we really don't know because there's a
lot of stuff to do when these tools are
complicated right i mean if you sit down
with chef if you sit down with puppets
CF engine ansible any of these guys
right there complicated they have a lot
of documentation there's a lot of code
examples out there there's a blog post
for every day of the year for the last
four years probably for every one of
them and some of them are very
contradictory so what do you do where do
you start so what I want to talk about
with you guys today I'm going to do so
little infrastructure review for anybody
who I want to talk about why you should
care about infrastructure if you're a
dev and some basic expectations you
should have and be working towards with
your configuration management I want to
talk about getting started what you need
to think about both when you're wide
open and when you need to work on legacy
systems what do you do and then we're
going to spend a little bit of time
talking about all of the things which
that tools need in order to work in
concert together because your
configuration management tool can't live
by itself I mean it's a great tool but
there's all kinds of other stuff out
there that it needs to exist and work
well and then we'll have some practical
code examples at the end and I actually
have a vagrant vm that we can pop up and
try that I should probably kick off
about halfway through here because it
takes about six minutes or so to run so
and it may or may not work because it's
live it worked in my hotel room but who
knows right so the next infrastructure
who cares you care you should care a lot
infrastructure is where your app lives
it's the baby incubator the baby goes
there and it never comes out you should
care about this stuff and I know it's
hard especially in times gone by because
there's just these guys in charge of
your stuff and you don't know anything
about it and a lot of times your dev and
your test environments have nothing to
do with production nothing and you can't
see production and you don't know what's
there and so you get to this point where
you're just like whatever I can't see it
I don't know what's there I can't help
anything I'm just going to deploy my up
and pray right and so you need to care
about this stuff and configuration
management is going to make it easier
for you because once you start doing
this and once you start working towards
provisioning everything the same
everywhere you can see everything
because it's going to be in source
control you can see how their
provisioning how their bootstrapping how
they want you to build stuff what's
going into the configs and things like
that and you should be provisioning
everything everywhere the same and so it
should help you with that so in a
perfect universe this is my perfect
universe infrastructure that we want to
work towards you want to provision
everything the same I want my vagrant
box I want my dev vm i want my 51 prod
servers I'll provision the same I want
them all to have the same bootstrap I
want to know what's going to go into
them and I want to be able to reproduce
it on my laptop in my dev environment
and wherever else I need to be and I
want other people to be able to take my
app and reproduce it in their
environment too because our eps of
course these days don't live by
themselves they integrate with each
other
and it would be really nice for that
other dev team over there to be able to
pop up my app so that they can test
against it and we can only do that if
we're provisioning identically
everywhere so then next we want it's so
often the case that there's a very
there's there's the production
deployment process and then there's
everything else right you just never
know deployments are complicated they've
got all these things they've got all
these moving parts they've got databases
they've got a pup grades they've got
connection pooling they've got all kinds
of things that you need to worry about
and it just makes it worse when dev
deploys one way and I mean not just one
way but like some some dude your release
engineer maybe wrote the script for dev
but the ops team wrote it for production
and it has nothing to do with anything
that you do in lower environments I mean
this is a problem and this happens a lot
especially the bigger the company the
more likely this use case is going to be
and so what you really want to work
towards is the idea that you have one
deployment process and you want it to be
the same everywhere I mean if you have
to start by researching what's happening
in production and seeing if you can pre
reproduce it in dev and that's hard
because you have to actually talk to the
apps guys right and sometimes it can be
hard to get the information but if
you're doing all of this anyway it gets
easier so again in my perfect universe
we have repositories for everything if
you've got an RPM if you've got a dub
it's on a repo it's not on your web
server somewhere it's not out on the dev
server somewhere it's in a custom repo
where you can pull it with a package
manager I did a really big long rant
about this it chef comp and i think i
read about 6,000 words on my blog about
this so i'm not going to belabor it too
much you should have them they're very
important you should want them we don't
make changes to servers by hand anymore
if we can avoid it it never it never
completely goes away but you really want
to work towards this idea that all the
stuff that we do is done with
configuration management code someplace
else and then we can push that in via
the clients the less change
is the fewer changes that we do by hand
the happier we're all going to be
because then it's all going to be in
source code and people are going to know
and you won't get things like Sasha
there was this thing it was broken so I
fixed it but now it's broken again help
right and so that's what happens we want
to change things less by hand and more
with code so getting started what are we
going to do what can we make with
configuration management right there's
all kinds of stuff that we can make that
people may or may not have thought of
this is the big thing right server
provisioning these are the this is what
people think of most of the time when
you're talking about this stuff it's
making servers so that they're the same
everywhere provisioning is really the
last place we think to formalize this
too so a lot of times it's a kickstart
file somewhere out on a server somewhere
that has like 30 backups with funny
names right it's just a kickstart file
that's been changed for the last three
years as needed and it's generally bad
and it generally requires a lot of ssh
fixes after we after we bootstrapped arm
at our machines so with server
provisioning this is like your big win
people think of us a lot because
generally this is the last place we've
done anything and there's a lot of stuff
that can be done to make things more
stable in this area but server
provisioning not the only thing that we
can do a player configs right keep your
configuration data separate from your
app why should you have to rebuild your
ear file because the database password
changed and if you're in a place that
has pci or other compliance you can't
put the database password in your ear
file because you can't know it which
means the apps guys have to do it
somehow how are they doing that they're
probably going into the servers after
you've deployed and changing it this
hurts me it hurts me a lot to even think
about it and so if you can actually keep
your data outside your ear file outside
your war file outside your ruby file
files because we don't have anything
like that but it makes it a lot easier
you shouldn't have to recompile your
code because configs change you really
shouldn't there are ways to do that
there are ways to keep them in chef
there are ways to keep them in puppet
there are ways to keep them in all the
other tools or you can there are other
ways to also keep them in an external
databases and pull them in via the
config tools so that you don't have them
in your app where you don't want them it
also makes it possible for you to only
build one binary so that you build a
binary and dev and that same binary
makes the journey all the way through up
production nobody has a chance to insert
any last minute changes because you're
rebuilding the binary for every
environment right I covered that one two
different configs and different
environments too so we can it makes it a
lot easier to set things up for dev and
production and things so that the apps
guys or the database team or whoever is
going to be in charge of your database
password can change it without you
having to worry about what it is because
a lot of times with compliance around
nobody can know what that is anymore
except for special people right
deployments are controlled by different
teams and so this is also the same kind
of thing right so you do this in dev you
do this in test somebody deploys its a
lot of times just to really fun janeiro
it might be just you know somebody on
the dev team or it might be your
automated CI process it doesn't i don't
know but generally upper and lower
environments a complete car managed by
different teams in which case this sort
of thing is a really great place for you
to help separate out your configs and
make it cool the next thing we can do
that's a little scary some people don't
like to do it and it's tough for folks
who don't have a lot of trust
instability on their teams already is
dynamic discovering across tears so I
can build an app and then once that app
is built tomcat can or Apache can notice
that i have a new app and that it should
probably configure some instances for
that and it can configure those to talk
to the app and then the load balancer
can actually notice that apache is
configured for something and set up a
load balancing pool for that i did
recently work with a client who did that
and it's really exciting when you see it
happen it can be scary because it
involves trust in your tool trust in
your team and trust in the
infrastructure and it's it can be a
tough place to get to if you have a lot
of legacy and you have a lot of siloing
but it's really awesome when you can try
it out what else can we do workstation
automation how many people here can
configure can on
it's somebody in less than a week with
all of the app.config that they have to
do right I mean you have to download
this thing well when I started at one
client it was you have to download this
thing that there's no way you can do it
on the network here you have to go home
and download it it was Xcode a couple
years ago right you just the proxy
wouldn't let you do it I you have to
configure our VM if you're using a ruby
environment you have to configure
eclipse or one of the Eclipse variants
if you're doing java stuff or or a ruby
mine or all of the things that you could
be using right and it's complicated
especially if you have both Java and
Ruby based development teams or
development systems right so if you're
doing both Java based development plus
you have config management stuff going
on a lot of that stuff is Ruby based and
so you have a lot of configs that have
to work and if you have somebody who
hasn't used me before or who hasn't used
a lot of Java these things can get
really complicated and the way I am
seeing this happen with folks there are
two main tools that people are using
these days box in which was written by
github and that uses puppet to do
workstation provisioning and sprout
which was written by the pivotal labs
guys and that uses chef solo and a lot
of us have written our own stuff to the
big thing with workstation automation is
that you have to stay on top of it
otherwise it goes stale really fast but
it is really awesome from when you are
bringing people in and don't want to
have to walk them through the wiki page
of death right so it makes onboarding a
faster happier process people aren't
like just worn out by the end of their
first week trying to get stuff not just
downloaded and installed but then
configured and working and following of
course the wiki page of death because we
all have these right the thing that gets
written and maybe gets updated once in a
while and it's 10 miles long and most of
its stale so I love workstation
automation with my configuration
management what else local testing
combined with vagrant and your
provisioner of choice whether it's
virtualbox CC to VMware these all work
really well and your favorite
configuration Matt
tool there are others I just didn't know
what the list was this is really awesome
for testing I mean if you run your app
inside of eclipse or whatever it will
tell you that the app runs but it can be
deceptive and what you get with this
with the vagrant combo is you actually
get a provisioning system like the one
you're going to use in dev and
production it will build you a nice vm
with your operating system and some
basic configs and it will you can
provision your app you can run it you
can start it up so I had a dev team but
I was working with last year and they
spent a week in hell trying to figure
out why something wouldn't work even
though it worked locally and they came
up with the brilliant deduction that it
was obviously the Java patch version on
the test servers that work was
completely throwing them off and so we
dug in and we really looked at stuff and
we really and we found out what-what it
was is of course OS X is not case
sensitive where it really matters and
they hadn't been able to catch that and
so if you had actually been testing that
in a vagrant vm with Linux which is what
a lot of this stuff deploys on you would
have been able to catch something like
that and that's really one of the things
that you get over just local app testing
inside your Eclipse p.m. or whatever it
gives you just a little bit more
certainty a little bit more looking like
where you're going to go with that up
then just your laptop and a lot of this
stuff and I should say this applies to
windows boxes too if you're using a
windows box you can still do all of
these things vagrant works there chef
works there a puppet works there all of
these things work there it's just that
we don't talk about it as much because
there are fewer but I have worked at
clients that had even splits between Max
and windows and I wrote workstation
automation that works for both it can be
done the last thing we're going to talk
about real quick is beefing up your
pipeline configuration management is
great for CI stability right so Jenkins
and your configuration management of
choice really makes things awesome
because you can use it to do things like
bootstrap instances whether it's virtual
machines Linux containers whatever it is
and then you have functional testing
right there as part of your once you've
run through all of your unit tests and
things pass you can actually pop up
instances and see if the app will deploy
and turn on
then you can run in a functional test
against it too so most of the most of
the you can run functional integration
tests with almost all of the CM tools
that I'm aware of so we have many tests
that works which stuff and we have bats
that works with everything and I think
there might be a puppet mini test I'm
not positive but even if you don't have
something that can use mini test there's
bats which will run a lot of the
functional tests for you after your appt
pops up so I mean these are great things
to be able to do before you get
deploying for real so that's basically
what i wanted to say about that and then
i'm going to talk about next how you
want to get started what do you wanna
think about i mean if you guys are
already i'm on your way then possibly
you've already thought about all this
stuff or you already know the answers or
you've already discovered that you know
you did it right or wrong but i'm going
to talk about it a little bit hopefully
it's not just server provisioning
because there are so many things that
you can do you really want to think
about what problem you're trying to
solve where you're going to have some
impact especially if you're trying to
pile it in something like this you want
it to be impactful or people are going
to be just like your configuration
management tool that sure is sucking up
a lot of your time and that's it right
so if you really want it to be
successful it's important to to think
about a few things and the one is you
need to pick a use case that works you
don't want to automate your whole world
right away right you don't want to pick
anything that's enormous you need to
pick something that is small is
achievable measurable so that you can
say look this is how it used to work
this is how it works now and impactful
so that people care about it right so
generally people will start with
operating system provisioning because it
is a big one because we have a lot of
configurations rift in our operating
system configs because a lot of places
are still configuring that stuff either
by hand or with bad scripts that have to
be fixed by hand however I did have a
client last year who had massive
instability in there tomcat we're over
Christmas and it caused more problems
for them and so they actually looked at
making their tomcat layer more stable
first by fixing the configs there with
their staff implementation and that was
really cool to see but generally I mean
if people ask me I will have them start
with OS stuff because it's it's easy
it's very straightforward it's generally
a package and a config file and maybe a
service very straightforward but it
really you need to find something that
works for you that people are going to
notice right so you need to stay agile
and you need to stay visible with this
again configuration management not sexy
I think it's a lot of fun I think it's
really interesting but it's you know
it's kind of like network engineering
right the network engineers think it's
fun the rest of us don't or operating
system design right some people think
it's fun but I you know I wish operating
systems would just work I don't want to
mess with them mixing that every time
something doesn't work so that's the
thing with the stuff you need to take
something that is going to keep you
agile and invisible and you want to work
small do little things and then change
as you go I mean this is a lot like I
mean you can call it agile
infrastructure or whatever you want to
call it but it's it's very similar to a
lot of the concepts that you use with
with agile development which is
basically you want to pick something and
see how it works be able to change it
quickly if it's not right and be able to
refactor it quickly as well because
generally the code is going to be pretty
ugly the first couple times through you
want to keep an open mind this is tough
this was really hard for me because as
we accumulate experience we know what
the right thing is to do we just know
right when you make a JVM you always
have the same in a max amount of memory
right well you didn't ten years ago but
it took a while to get there and so the
idea is that I things that we know we
don't always know anymore and it was
tough for me to get there because I was
pretty sure I knew everything of
importance anyway and the idea that
there are new ways to think about this
stuff that I hadn't really considered
like the idea that maybe you don't need
to cram as many possible instances of
jboss onto a server because now you can
make tiny
you know I mean and that makes
configuring things a lot easier because
then you don't have port cons like so
you don't have to have special port
files so you really you start thinking
about different ways to implement things
that you might not have thought before
and the trick is to really keep an open
mind as far as questioning the way you
do things the way other teams do things
and to really listen if somebody
questions how you're doing something
because a lot of this stuff is new and
figuring out how to do it better is
going to be helped by that a lot and it
was hard for me to get to that point
refactoring right you guys know all
about this I you are going to have some
ugly code I did but I'm system so maybe
you guys are going to have beautiful
code because you're all your help
programmers right i mean the trick is to
work fast and don't get bogged down in
too many details don't worry about
making it just right make it work this
is a lot again like like agile
development you want to just get stuff
done and going and then go back and
refactor some things you know you are
gonna have some ugly code I call up my
ugly baby right the ugly baby is right
out there in the recipe or the module
files right and then eventually what you
do is you start to see patterns and you
say oh I don't need this recipe anymore
I can actually factor this back into a
library and then you only have to write
two or three lines out in the public
area and so it's just something that you
need to keep in mind again with the
don't try to automate the whole world
you want to make sure that you know you
can come back and refactor later so
don't get hung up on things brown
fielding legacy systems anybody here not
working with legacy ever right okay
because we all hit it eventually and you
get two main problems with legacy one is
people want is requirements they're both
very uncertain at this point um there is
the right way to do things and then
there's the way that legacy app owners
know will work it's really important to
listen to these people when they say
things because even though we know the
right way to do things if you're trying
to get something done a lot of times
it's just not going to work right on
legacy because it works the way it works
chances are the person who wrote it is
long gone and the support person is the
only person who knows anything about it
so I kind of call this coloring inside
the lines we don't have a lot of freedom
when we're working with legacy systems
they have to work they generally have to
continue working as we are automating
them on the fly to right so it's touchy
and the people that you're working with
tend to be very possessive there they
own these apps they understand them they
probably are really unhappy to own them
most of the time too but they still own
them and so you know it's it's there
it's there ugly baby right they said
they're going to be both possessive and
defensive and I have been on both sides
of this I have I have had people come at
me and my apps and I have had to come at
people and try to automate stuff I have
worked with hostile Ops teams who don't
want anything to do with this stuff and
it's it's it can be difficult you have
to put on your empathy hat and really
listen to folks when they talk to you
one of the things is that one of the
things is that really this is an art not
a science and one of the things that
you're going to want to do is listen to
what they have to say about stuff and
try to get them involved in whatever it
is that you're trying to do with the app
because it's it's hard when somebody
comes at you and wants to do stuff to
your app but if you get them up into
your space or if you go down into their
space and really kind of work with them
it mitigates a lot of that defensiveness
and that feeling of being pushed aside
and that really helps a lot with trying
to figure this stuff out so
collaborating it's an art not a science
but really important for this stuff and
then so yeah be you want be inclusive
ask questions and listen when they tell
you what will work because while you may
know what's right it may not work and
it's very likely the truth with legacy
apps because you just never know and you
don't know what decisions went into
making things when they happened either
2 3 5 10 years ago when they were made
right try not to be too critical despite
the fact that the person who owns it
might hate it too it's still hard to
have to hear criticism of stuff like
that because there's nothing you can do
about it
it's hard so I guess that's really all I
have to say about legacy systems if
people have questions and I want to talk
through use cases I'd be happy to do
that after two there's a lot of things
that you could talk about that's kind of
a little detail ish and things the next
thing I want to talk about is the things
that you want in your ecosystem with
your configuration management tool your
system is more than just a sum of its
parts the tool itself really needs a lot
of things to work well it makes
assumptions and it wants things so what
isn't it if not a package manager so I
had one but one person in in a chef's
chat be like i did this tutorial and i
installed this package and then I
changed the package version and now it
doesn't work why not and I was like well
dude there's no package out there for
that I mean you have to go have the
package somewhere it's not going to work
chef doesn't have packages puppet
doesn't have packages see if engine no
packages it just goes out and gets them
and it can abstract the actual operating
system layer so that they can get
packages for you bunt to windows Red Hat
whatever right so that's a thing it's
not a package repo it's not a package
manager it's not a substitute for
version control it's really not I
actually don't have to tell you guys
some of this stuff is really obvious to
developers it was a harder learning
curve for systems folks in some ways you
want package repos you don't want your
your things that you get off the
internet to just be stashed wherever and
this can make a whole world of other
problems partially in the kind of code
that you're writing and partially in
that you are going to install something
in dev and it's going to be great and
then somebody's going to deploy your app
to test and you like it doesn't work why
doesn't it work and you may be on
vacation you may just be at lunch it
could take them a couple hours to get
the app deployed and the keyway folks
are sitting around going we were
supposed to start testing this and now
everything is behind and it's because
somebody just dumped something that they
needed a package somewhere over on a
server where everybody who was important
knew about it but the people who were
deploying stuff really didn't and then
that happens again in test it happen
in stage and then three I am in
production it doesn't work because
people keep forgetting in every step
that there was this thing that they
needed right this happens it really does
so I mean I have a really long package
weibo a rant like I said in my chef com
video you can read it or watch it or
read the blog I'm not gonna belabor it
that's basically you really need them
you want them they're good you want your
configuration management code in version
control you must have version control I
actually still have clients ask me
should we be putting this in version
control and the answer is yes it should
be rare right next door to everything
else that you are putting in version
control please need to manage your build
tools chef is great puppet is great CF
engine is great all of these things are
great with build tools they make build
tools easier to use but they don't
replace them and they're very important
so you want your Jenkins or whoever
you're using to do your pipeline work
you want your your binary containers
your artifact or your Nexus which are
also good for having custom yum repos
and things right and so the last thing
we want to talk about real quick is
virtualization this makes everything
nicer this makes everything like sugar
and ice cream once you have
virtualization available to you
everything is so much easier it's nice
so if you aren't using vagrant you
should use it locally because it's
really great for a lot of things if you
have vmware available to you and your
infrastructure you should use it if it's
out there and it's very difficult to get
your hands on start a crusade to make it
easier to get at you can watch some good
presentations from the best buy.com team
about how they implemented an OpenStack
infrastructure for their dev teams and
so the dev teams have at will pop up VMs
whenever they want them as many as they
like pretty much I mean I think they
have quotas but in general they've got
what they need whenever they want it and
that turned their development cycle into
something really fast comparatively and
so virtualization you really want it as
much as you can get of it
so practical configuration management um
let me see if I can get it my so this is
my kid but you guys can't see oh you can
see anything that's no good so I can
move it hi all right probably nobody can
see that can any it can you see this at
all yeah you guys uh it's a little
surreal so vagrant status I don't think
I killed it before the last test running
all right so so anybody here use a
vagrant every day it's the best thing
since ice cream it really is i think
sliced bread way over rated but vagrant
and ice cream it's really awesome for a
lot of stuff so basically what i've got
here is a vagrant instance that's going
to pop up install Tomcat and and forward
the port to my to my laptop so that i
can show you tom cat box it's very
simple it's all chef and vagrant and a
little bit of Berk shelf and i'm just
going to run it here and we'll run it in
the background because it took the last
time I rented it was like four hundred
and three seconds so we have a lot of
stuff to talk about one going alright so
i can i'll review that once once we're
done all right testing I got a couple of
slides here that don't have a lot of
good technical information because I'm
running out of time and I added these
late just because I wanted to get them
in here I want to try them out there
just so that you know about them because
as does I realized that this is probably
a lot more important to you than some of
the the system's folks that I talked to
we're still getting we're still wrapping
our heads around things like unit tests
I mean when I met unit tests my mind was
blown and every time I have to write one
I have an existential crisis that lasts
like an hour so I mean they're hard and
so we don't always think about them but
you guys this should actually make you
happy to know that you can write tests
for configuration management tools we
have unit testing with our spec for the
Ruby based tools and we have functional
integration testing with mini test and a
tool called bats which is a bash based
test tool for functional tests that can
run at the end of convergences four
nodes and things so that's really nice
it's really nice for you when you're
doing local testing so I can run a whole
conversion run tests and then later my
CI pipeline can actually pop up an
instance and actually run those tests at
the end of all the other tests which is
kind of cool we also have dependency
resolution there is librarian for both
puppet and chef and that will go out and
find modules and cook books that have
dependencies on other modules and
cookbooks and pull them all in so that
you don't have to be like in the old
days with with redhat going searching
the internet going I need this thing
that needs 10 of the things that need 20
other things and I'm just going to go
drink right I mean I don't even know how
I coped before we had decent dependency
resolution I didn't I mean really we've
Burke cell for chef which is more than
dependency resolution but that that was
its main main goal in life when it first
started so I don't want to belabor the
stuff too much there could be other
things I don't know as much about other
tools and dependency resolution really
these are this is the place where I
really know anything so then on to
things where I actually have some code
and some talks practical configuration
management learning primitives one of
the first things we all want to do when
we do this and I am not joking everyone
wants to do it I wanted to do it you can
find the discussion message a message on
the discussion board for chef in 2010
where I was like I want to do this thing
and it like no you don't want to do this
thing and I was like no really I want to
do it they're like no you don't and it
really takes you a while to get to the
point where you don't want to migrate
your bash scripts verbatim into your
tool
but you shouldn't because the tool has
primitives and it uses it's better to
use those than trying to migrate bash
scripts exactly so just like programming
I mean this is just another higher level
of dsl right so you've got files users
packages directories templates chef has
a get resource it's got a deploy
resource it's got a resource for just
about everything puppet has the one that
I always think that they have a nagios
type so chef is called resources puppet
is called types and puppet has some
interesting ones that Chef hasn't
doesn't have whether I think it's just
because puppets been around longer and
it has some really interesting stuff
that we haven't gotten to yet right so
like and the one I always think of is
the nagios type for them so these are
primitives they have built-in idempotent
right so if i install a package if i set
up a file if i have a checksum with that
file chef knows chef will check some of
the file when it installs it and knows
the next time whether or not that's
changed and it will overwrite it if it's
supposed to so the primitives they're
good to use because of the built-in item
putin's and readability and operating
system across functionality right so let
me go one more page here right bash
install my package this completely
subverts any kind of cross functionality
right so exact blocks and i don't know
this for sure but I'm guessing that as
programmers you think that selling out
is probably the last thing you want to
do it should be a last resort it should
always be a last resort with your
configuration management tool as well
because you subvert any kind of cross
functionality and you no longer have
built-in item potent because Bash blocks
can't you have to write your own checks
and if you're doing that you might as
well write bash scripts right so this is
a bash block it makes me sad because now
I can only install this package on
redhat or Red Hat variants that have yum
and that's it right so instead we can
have this and it would install that
package anywhere anywhere at all that
Chef knew about apache packages
which is just about every Linux variant
we have and windows right so all right I
think I got that big enough right this
is an actual script that i intercepted
from a dev team and I was like no you
can't use this let me help you with that
their laser pointer up here nope that's
okay no big deal ah the big deal here is
that this doesn't have any built-in
checks you see how it downloads
something and then removes it later that
means it's going to download it and
remove it every time the client runs
every time it's going to enter it every
time the client runs it's going to
install it every time every 30 minutes
which is the default I think for both
chef and puppet right I mean you just
don't want to do this because why you
don't want to do it for so many reasons
right so instead if you have this and a
package repo and an ability to make your
own RPM or Deb that's all you need you
don't even have to use the built-in Red
Hat tomcat package that thinks you need
77 other packages to install with it
right you can make your own package put
it in your custom repo and that's all
you need instead of that whatever that
monstrosity that that goes out and gets
it from somewhere downloads it on tars
it deletes it delete some extra
directories out of a tomcat stuff I
really write templates templates are
awesome templates can take code
basically these with the ones that I
work with Ruby and chef mostly they to
use Erebus type code inside them and it
allows you to lay down flat files across
all your environments and different
kinds of servers and have custom configs
in every single one and it's kind of
cool so this is just a snippet to show
you what custom code inside a template
looks like it's just a piece of the temp
the sudoers file nothing terribly
exciting
it just iterates over a user's
collection and sets them down in the
file but it's kind of cool because you
can have different users in different
environments right so then this is kind
of a why you want to use templates piece
here I wrote this in 2010 this is a
piece from a kickstart but I was trying
to mop that I was deconstructing
basically it's a piece of something for
ssh configs and that's how it was set up
in the kickstart file and I didn't know
any better and this is part of what I
was trying to ask on the chef for him
how to do and they were like no you
don't want to do this you want to own
the file and I was like it but no I do I
want to said things and they were like
no you don't because with configuration
management tools you own the file the
file does not own you we no longer make
bits of changes to files the
configuration management tool owns that
file and we want to be able to do
something readable and idempotent right
so this is what it should really look
like you see that okay we got a package
declaration word installs things it's
got the service definition where it says
it should be enabled on startup so
that's the check config and then it
should be running and then we have a
template with configs that we configure
in the tool and we manage that in the
tool and we check it into version
control where everyone can see it and if
we have configs that are different
across environments so if you have
something more restrictive and
production that can be cared for in the
tool and in version control so that
everybody can see how Isis H is
configured everywhere for anything which
is kind of cool you should extend and
abstract everything right learn to have
learned to abstract things and then a
bonus slide where I wrote this really
great Ruby code and it was a great
learning experience but it shouldn't be
out in your recipes or modules you
should be able to expect it back and
then here there
sorry time for maybe one questions you
get to pick which question you can all
sit in 30 seconds huh anywhere you can
hold down long enough to version your
configuration everywhere whose question
oh that was the first one how how and
when should be version control
everywhere you can get it to sit still
long enough to version control it okay
the second what's a good way the candle
shared configuration modules across the
entire organization is a whole talk and
I would advise you to go out and watch
Jamie windsor's Burke self-talk as a
starting point yeah I buried a bookshelf
a good place yeah yeah I can stick
around to it people want to talk what's
virtually we have to use the big room
for the last session of the diet stick
around outside yeah so stash is gonna be
here outside if you provide her with
beer she'll stay around for longer so
we're going to say thank you very much
to Sasha</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>