<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Insights in Container Security • Nils Magnus | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Insights in Container Security • Nils Magnus - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Insights in Container Security • Nils Magnus</b></h2><h5 class="post__date">2016-09-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7-9P2mINKhM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome well you make the right
decision for choosing this track not
just because this interesting subject
but also because we have the comfy
chairs in here I think I really like
this this room here in session vol well
everybody is talking about containers
and yesterday we had a short speakers
meeting and I already promised that I
like to to break everything a little bit
so there is so much excitement about
containers it really pays off to look a
little bit into the details how actually
our containers work and that's what my
presentation is all about my name is
needs Magnus I'm working for linux tag
or linux talk it's kind of a hobby and
one of the founder of the linux tag
associations and we run a couple of
linux and open source-based conference
as ourselves most predominantly the
linux truck itself but most recently we
decided to shift a little bit our focus
on hosting more smaller more focused
conferences as well so we did for
example the host the system dr cohn a
couple of weeks ago also here in Berlin
we did the committal cons and other
stuff like that so and as part of this
volunteer work for for linux tag i
investigate a little bit in subjects
that I really like and containerization
and
the system engineering around that is
also my my job and so I prepare this
presentation so why are we talking about
security why does we need to talk about
security in the container context
actually I think it was red hat yes
redhead commissioned Forrester Research
to conduct a survey about measures that
prevent companies to actually implement
the container continue ization patterns
into their applications and getting the
hd2 productive use and more than half of
the decision-makers always an important
group of people had concerns about the
container security actually and several
other speakers already mentioned there
is a famous question that then word is
also from Red Hat and he was for a long
time the maintain of the selinux a
framework asked do containers actually
contain and that is one of the question
I'd like to investigate here on a single
container context in this situation we
had some several interesting talks as
well about the environment those
containers live in but I focused mainly
here on the on the single container but
as a short detour I have a history
lesson a history quiz for you um there
is a Russian proverb I don't speak
Russian very bad but it translates or it
reads dovrei nope all right
has someone heard about this already or
have happy any idea who actually used to
state that so one of those was this guy
this is leaning and intra as an
interesting fact this guy also used this
a couple of times as well mr. Ronald
Reagan President of the United States at
that time and actually the the proverb
I'm translates to trust but verify and
this is kind of a motto for for this
talk so many people have a suspicions
about a container security that it
really makes sense to check what can we
trust and what not so several people
approached me and asked me well you play
with docker and you're investigated a
little bit is it actually secure see
this is a very complex question because
the secure nurse of something the
security of something depends on the
actual security objectives what are you
looking for and keep this always in mind
if you deploy some kind of container of
virtualization in your environments that
most probably the use of something like
a container makes your application at
least slightly more secure compared to
not using a container application at
least if you compare the same
environment so it's important to find
out what you actually are planned
protect your software from what kind of
TECA profile
do you have in mind and how do you
actually try to prevent those attack us
from what you try to prevent so most of
the time the security feature that
docker implements is isolation isolation
from one service from another and as
well to the horse but if the isolation
from one container to the host is
breached obviously the isolation to all
neighboring a containers is breaches bar
so most of the security researchers that
focus on trying to break out of the
docker environment the docker jail to
show if this isolation can be breached
in some way or the other or to prove
that this is not possible Dhaka itself
made an important statement they said
Dhaka protects against mistake but not
abuse that actually means that it is a
very nice feature to structure your
deployments and structure your
applications themselves so we had lots
of talk about microservices being the
most predominant implementations of
those separate separated and chopped
down services they really come handy but
they are not the premier security
feature to isolate them from each other
well I already mentioned the containers
do not contain a statement from den wat
actually funny enough he said that
before he moved inside a redhead to some
other company especially promoting
the whole the redhead containerization
products I think it was it is called
home shift and all these ecosystems and
now he works actually to make containers
more secure also implementing a little
bit of the old office or old project
selinux and stuff like that so just to
give you a rough idea in which context
those quotes are well if we try to
characterize the isolation features of
environments it makes sense to look at a
couple of properties what kind of
resources do systems and our
environments actually share what to what
kind of attack scenarios does this lead
what kind of security controls are
usually in place to prevent those
attacks in areas and how complex is this
kind of mitigation or prevention as well
let me start or this is interesting so
this is in German I hope I think the
other let me show you all of this at
once so you have the proper english
translation as well if you have a
physical host you usually share at least
the network or maybe even the storage or
something like that and to attack that
you have to attack the host itself its
ports and services running on this host
so if you are in Attica you usually use
a network scan a vulnerability scan or
something like that or some scripts you
brought yourself and to prevent this you
usually use a port filter you use
firewalls you
segment your your networks and that is
kind of easy it is at least a best
practices approach that several classic
operations people or network operations
folks learned and exercise for a couple
of years if you run your services inside
virtual machines you share the same host
hardware we have several support from
from the hardware itself built into a
couple of CPUs as well and if you
actually want to attack this scenario
you have to attack the hypervisor and as
we've learned from previous presentation
the attack the hypervisor itself
comprises itself of a couple of ten
thousands of lines of code so this is
still a lot but this is kind of a
manageable amount of code at least for
for skilled team so the security
controls to maintain isolation on a vm
level is actually having a good
hypervisor on hypervisor like
environment which is still kind of
rocket science but it has a more or less
defined attack surface and you can
manage that from a centralized point so
if it comes to container we share not
only the same network not only the same
hardware that also applies but we also
share the Linux kernel itself so all
containers run the same color and if you
actually get and gain access to the
innermost colonel features the vote
limitations then you own the whole host
and by that you own all containers that
run on that host
and maybe even more there are quite
credentials or stuff like that involved
so the text scenario is go inside the
corner and there are several ways to
actually do that and we learn about a
couple of them in a minute and the
security controls have to be implemented
inside the container manage or in
additional security features like a
saline of the capabilities and other
security features that typical container
security solutions like docker or rocket
or whatever actually do we have a lot of
those mitigation features implemented in
existence of in container virtualization
software but still they are very tricky
because of all the of the large tech
surface so so given this overview I
prepared four types of attacks or threat
types that apply to the containerized
environment and the first our tech
attacks so approaching actually the very
technology that containers are built
upon there's architecture I keep this
short because we had several other
presentations focusing on this subject
as well they are the sources who can you
actually trust and one of the important
threats to those environments are the
users themselves because we have a
couple of security features that can be
turned off and it's usually the users
who turn off those security feature I
come back to that little bit later
so Fred number one is the complex attack
surface think about well I think in a
couple of days the what is it part
episode 7 or something of Star Wars gets
to the movies and you probably remember
a star wars episode for the great def
star and Luke Skywalker actually are
blowing up this complex piece of well in
this in this case our hardware but think
about the very complex attack surface
with all those details and this applies
a little bit also to contain a
virtualization because the surface of
the Deaf stars in this case the surface
of the Linux kernel and there are a
couple of preventive measures that
implements the Linux counts one of them
is are the so-called capabilities I
don't know who's familiar with
capabilities can you raise a hand okay
so not probably not everyone but I think
most of you have heard about root rights
so the the superuser in Linux or UNIX
system is able to access all files
access or devices access all everything
Wallace and for a couple of years right
now the Linux kernel developers
introduced something called Linux
capabilities shopping up those root
rights in in a set of about well I think
there are 30 35 or 36 capabilities at
the moment that you can assign to a user
and you can withdraw from a user and
for example and in the first part of my
of my slide I showed you the output of
the capabilities of a typical root user
see this because of the hash mark on the
first command I retrieved the
capabilities of the current process this
is the dollar dollar sign and there are
lots of different capabilities and after
you launch a docker container like I did
here on on the second command dr. run I
tu12 I just started a bash in a you bun
to image container and after that we
have a lot we have fewer capabilities
than they had before and this did the
doc a demon he withdrew those
capabilities from from the container
itself because it's not really necessary
in general to have those inside the
container and if you had them you could
kind of restore the situation on the
host as well because to actually spin up
the container you have to set up a
couple of other features like namespaces
that come to that in in a minute as well
and see groups applies as well and if
you had all those capabilities you could
easily revert those measures but there
are still a couple of issues with
capabilities there are large number of
use cases that you
that they actually have to cover so
access to devices to access to
networking interfaces access to specific
device specific functionality and so on
and so on and they are just about 40
capabilities available and their
semantics is unfortunately not very well
defined so for example there's a
capability called capsis p acct and that
has more than 30 different use cases so
if you don't have this capability you
cannot sync up with the random device
for example and restart the side side
will a number generator for example so
you need that capability to do this but
at the same time you need the same
capability to turn on dma in the XD
drive I have no idea what the HD drive
actually is but it does not really sound
very related to the random device
management for example so I think we
really need the Linux developers to
improve a little bit on a capability
scheme and to provide a little bit more
clear semantics and more fine-grained
implementation of the whole thing the
most premier attack surface are the SIS
calls themselves the number of this is
called into the Linux kernel is rapidly
growing when I was back in universities
we learned that there are in a typical
UNIX systems we have something like 100
watt 156 quads like open fire read and
write close by those operating system
primitives and
days or the last time I checked we had
almost for hundreds of them so about
three times the number of his calls then
we had well 10-15 years ago and each
core is actually a potential attack
vector into the corner because the sis
codes are the API to the Linux corner
and if there is just a single tiny bug
somewhere behind one of those four
hundred gates you can explore the whole
isolation so actually Wow today it is
more than a year ago I think it was in
yeah in in jun 2014 sebastian karma from
the overall project released an exploit
code so called shocker that enabled him
to escape early version of dhaka 0 dot
11 version it was the pre predecessor of
version 1 dot 0 so today we are at one
dot 9 and in this case while dhaka
creates a new file system context switch
virtualizes or isolates a part of the
file system and attacking those mounds
by mounting is the measure that is
employed inside the corner to map part
of the file system inside this container
can be tinkered with the open by handle
a texture score I never heard about this
specific to score before and it also
implements some rather specific kind of
use case and you also need a specific
capability the cap deck over right
for that which took a head at that time
and all those ingredients put together
you have been able to start a program
inside the container you have to compile
it or download it from some external
location and that program had to call
those open it open by hand at Earth's
core and then it got hold of a specific
file system structure and attached to
this file system structure are some is
the Tree of inodes and then you could
hurt reverse this tree and you could
also reverse this tree of inodes on the
host because at this part this was not
isolated by the namespaces and thus you
could for example access the et Cie
shadow file of the holes or any other
file on a 5 of containing secret keys or
credentials to log into the hose for
maintenance or stuff like that but this
is a very specific and rather complex
attack but it shows the general pattern
it's not a single back that got exploded
here but the
well composition of several smaller
weaknesses of all together but how
actually works the separation the
isolation means itself those are
implemented by the namespace so-called
namespaces they are used inside the
Linux kernel to virtualize important
system resources especially things like
process IDs network interfaces user IDs
and the host name the time for example
well and actually it's a pretty simple
mechanism inside the corner usually as
well in the old way we had a global
variable within the Linux kernel that
pointed for a linked list for example of
the network devices and the namespaces
we have kind of a proxy in front of this
global structure virtually size
virtualizing those linked list for
different namespaces you can create new
namespaces and actually that is what the
docker container does for you actually
if you really want to do this as an
exercise we we try to do this for
testing purposes it is actually possible
to implement well say something like
eighty percent of the the docker
functionality with say 100 line shell
script yourself because there are
command line utilities that create new
name spaces for example to bind mount
specific file system in a specific place
inside such a namespace or something
like that
yeah so this is why all access pass
inside the crown needs to be scrutinized
and well this is a lot of work and I if
you hear a very simple example for for
example the hostname command that
actually sets or retrieves the hostname
cause a cisco that is called you name
and then it gets into the kernel space
and traverses a couple of of functions
and in the old they have I have pointers
and where let me check yeah great yeah
okay we have to fill this this structure
here and this is the old function and
this is the implementation and well and
what is actually new is this namespace
proxy which which is placed before the
formerly global variable UTS name
something like that and well this is not
much code and this is not so complicated
to understand but you have to actually
change the whole kernel of all in every
excess to those global instances of both
global variables to actually isolate all
the services and which is also why he
took rather long to implement it to
implement that we've seen in some other
presentations a timeline so the openvz
which is technique technologically a
kind of a predecessor of the
a doctor and virtualization and the
namespaces stuff we see here started in
2001 and on the low 20 project started
in 2001 I think openvz has started in
2005 or something like that so it took
10 to 15 years to actually implement
that and this is still a work in
progress okay yeah this is the app this
is the second excess path who also
accesses the name not through the
command line interface and the cisco but
also by accessing the same information
through the proc file system just to
show you that is that it's important to
use the same interface in this case we
have as well a bind and other mounts
amount there are a couple of services
mounted via virtual file system and all
of them also implement way inside the
corner and provide some information that
may or may not be vulnerable so all of
those mounds need to be protected as
well then we have the C groups and the
sea groups are a means of limiting
resources so that one container cannot
eat up all the say CPU or network
bandwidth or memory resources resources
from one container
you can restrict the consumption of
those resources a little bit in security
terms this primarily applies to do s
scenarios if they are feasible in your
in your context then you can limit those
resources so that you can ensure that
the service can actually run did I skip
ok well there is they are architecture
issues as well so one of the issues that
get frequently raised is the daka demon
itself the daka demon is a permanent
running process then rest api on the
dhaka host and the command line tools
that you usually use docker runs
whatever actually issue an API call
against this docker demon and the Dhaka
demon spins up starts a new process and
applies namespaces cgroups capabilities
and all the other stuff to this demon
add to this new process resulting in a
new container and those this demon is
usually you're running on a socket on a
unix the main socket by default today
they started to exposing the socket to
the network but the default behavior has
changed in the meantime but you have
still to re-enable that if you run some
kind of orchestration frameworks like KU
Benitez or whatever you are running to
orchestrate or your host and and
rayna's because you have to start and
access the the demons and in some way it
is very important to protect those
connectors with SSL and TLS and
especially the new project rocket
addressed several of those issues it
includes all the communication and
implemented also some some ways of
assigning images and stuff and made some
of the issues that I addressed some of
the issues that Daka the first time
postponed but they are still kind of a
head-to-head race between those two
projects as well and rocket to my
opinion is still in an early stage and
the world can progress a project but
check it out frequently what is the
current situation well I skipped very
quickly about this slide because we
heard about this in more detail already
application architecture most of the
time it is not a single container we are
talking about but a complex application
landscape of several containers that
need to be orchestrated and well we need
a couple of properties in there being
able to scale out to implement high
availability to do load balancing to
implement statelessness and and to
separate all those few G's I think you
heard about this already
but they are still the security our
architecture defense in depth is a very
important pattern to implement in this
context that actually means not to put
all your what is what is the english
medium for that not to put all your eggs
into a single basket not rely on a
single measure to protect your
application and especially in a protect
your data use the container implemented
isolation but also rely on different
measures like firewalls that segment
your security network zones for example
or to encrypt your your Vela very
variable data when you store it in the
object stores when the databases or
whatever it's good practice to put
senior applications in a single
container I that pattern you don't lose
your whole environment by a breach into
a single component and a last advice is
in general it is not necessary to
actually log into the single instances
of your of your containers because of
the pad versus kettle a pattern it is
much better to do to dispose of your
specific containers and spin up a new
one then trying to log in to this system
and try to repair something so keep that
also in mind when you craft your
security architecture then there's this
is last light of the architecture a
thread then
network security you have to know that
in the default setup all containers
share a common bridge so a bridge is a
virtual well kind of a virtual switch
appliance that is set up inside the
Linux kernel so I have point in here so
this is these are the boundaries of the
the Linux corner the light blue one
there's the host running inside this box
and this is the VirtualBox the virtual
bridge and all the new containers are
connected / default to this specific
bridge and if you want to do something
more complex some network separation you
have to do this by hand or by your as
the ends of failure is the end
configuration this can be done but this
is not the default keep this in mind so
this means specifically that for example
container number 2 can easily access
container number 4 over the network and
also keep in mind that if you use some
kind of orchestration frameworks like
when it is or the HDD or whatever to
encrypt that to apply as a ltl as
encryption and as well as some kind of
authorization and on authentication
especially so there's also the threat of
untrusted sources we have images to run
and as it is the case with all kind of
software it's important to know how to
trust or if to trust your sources the
images are very convenient the the user
interface to
excess images is very comfortable on the
on the dock our tool set is very easy to
download a new I say readies instance
and use that but the problem is speaking
of database like Redis you have several
options to download those images and you
never know exactly who who built this
image and who actually plays some
malware in there as well so make sure
that you actually know what kind of
software you're running is obviously
applies to all kind of software
repositories to libraries and to package
repositories as well but I think it's
double important in this context
so too as one of the solutions to this
dilemma and how to actually increase the
amount of trust why not build your own
images Dhaka comes with a very easy
description of images the so-called dr.
Phibes work like kind of the shell
script and they specify how image is
built and this is not so also difficult
so and as well it's not so difficult to
set up a repository server of on your
own for your own environment and so you
could combine this with version control
and integrate all this in your CI
pipeline so that you create your images
based on your own base images and store
in your own image repository and access
only this kind of registry one important
step is just to remember not to put
credentials themselves inside containers
because you never know where those
containers actually end up and actually
a container is not much more than then a
big tar fire and decomposing that and
inspecting that is not really difficult
the last threat model is especially the
turning off of the security features of
implemented by users so for example
there is a very easy command-line switch
on the dock a command line so if you use
the doctor run command with the minus
minus privilege equals true most of the
security features i just presented are
turned off and you
easily can access the host environment
again so containers are not small
desktops it is does not really make
sense to try to implement everything
that you do on your desktop system to
have all those features inside a
container so people ask me for example
how can I actually start graphically you
eyes or something inside from inside a
container well to do this you need some
access to your graphics hardware for
example and well you can forward access
to a process inside a container that is
possible but by this means you open up
another very broad channel inside the
crown and so on and so on this is not a
good pattern to do yeah well and also
keep in mind that containers are meant
to remain small and don't try to
implement all the features you know from
a classic linux distro inside a
container and because the more
components you have running inside the
container makes even more complex to
keep all those components secure and
safe yeah to wrap all up in four easy to
memorize sentences for essential facts
and tips dhaka is a good and convenient
piece of software it has a lot of
security measures already built in and
they are really constantly improving
so it's it makes really fun to see the
project to progress and at the moment I
even recommend using that even in a
production environment that is possible
if you take some care of several
appoints I mentioned in this
presentations containers protect against
mistake not abuse that summarizes it
very well to my opinion this is the the
advice that dhaka inc themselves gives
us all don't put all your eggs in one
basket if you implement microservices
that is an implementation of this
pattern and never rely on those sources
you don't trust or you don't have cost
checked yourself so basically that's it
if you have any additional questions
about container security ask them now or
just in me an email or or rate the
presentation on the cool go to earth as
anyone actually downloaded it yeah ok a
few of them ok I think you should use
the green smiley here for at least for
this blog ok thank you very much for
your attention are there any questions
dookie here's one I have to run
untrusted customer called in our data
center we currently use virtual servers
and demonized songs to protect our
services would you consider replacing
this with containers and maybe not a bad
idea because technology wise what was
what kind of technology was it to open
visit was it a virtual server or virtual
server in general well dhaka is kind of
a reimplement ation of the concepts of
virtual servers in the end you should
have to reconsider if this is a good
idea in the whole context because most
of the concepts of breaking out of a
docker container also apply to breaking
out of other types of container
virtualization so if there is actually
data involved that is very valuable or
very sensitive it may be a better idea
to host this in a at least in a virtual
machine more questions so it's not them
thank you again for attending and enjoy
the conference</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>