<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • All Your Code Belongs To Us (Dismantling Android Secrets With CodeInspect) • Steven Arzt | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • All Your Code Belongs To Us (Dismantling Android Secrets With CodeInspect) • Steven Arzt - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • All Your Code Belongs To Us (Dismantling Android Secrets With CodeInspect) • Steven Arzt</b></h2><h5 class="post__date">2015-10-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/O79Ai5H5hpo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">afternoon and welcome to my talk about
dismantling Android apps before I start
that's the usual slide from the
conference organizers so please do rate
this talk if you think it was the most
awesome talk ever rated if you think it
was the crappiest talk ever raided this
is very helpful information for both the
conference organizers and me before I
dive into the topic of what code inspect
is all about and why I think all your
code belongs to us so me and my
colleagues I'll give you a short
introduction about myself and the
research group I come from
so I come from technische universität
dumps nut which is the university in
germany about 30 kilometers south of
frankfurt and we do security research so
the subgroup I'm in mostly on applying
program analysis to Android for security
reasons who of you knows about program
analysis okay that's a few for the
others program analysis is creating
algorithms and programs that reason
about other programs so you're
developers you write a program and my
programs take that program as input that
you give me and say ok this is a
potential security vulnerability this is
an inconsistency here you don't have
this access control check that you had
over there all that say ok this is a
potential nullpointerexception that
might be flying around at runtime and
this is especially helpful for security
as we will see and if you're interested
in what we do in the group then you can
also visit our block so we occasionally
publish vulnerabilities we detected in
the Android operating system we already
had a couple of them that were also
acknowledged and fixed by Google and if
you're looking for tools that's also the
right place to go and now without
further ado let's dive into the content
I think all of you know that Google Play
Store
who of you has already published an app
on the Play Store okay majority that's
great that means I'm in the right room
so normally when you think about
publishing apps on the Play Store you
have a certain model in mind this model
consists of a developer and the user and
usually your idea is that you as a
developer you're the one in power you
have the mighty source code this means
that you can create the app you can
modify it you can reason about the app
and you're the only one and the user on
the other side just gets the binary code
so all he can do is run the app and
nothing else but what I will show you is
or what I will talk about is how easy is
it for the user to actually gain more
power and to dismantle that Android app
and say okay I want to behave like a
developer I want to know what's going in
on inside this app and this is a
question not only I am asking because if
you look at Stack Overflow you find this
quite a number of times so for instance
here's a guy who said that okay I've
heard that it's very easy to pirate
Android apps is there anything I can do
about it to make it harder for people or
here's another guy they complained that
only about 5% of all installations of
that game were actually paid for and the
other ones were from some shady places
on the net and we're not being paid for
or an even another one this guy is also
asking ok if there's someone determined
to pirate my app exploit security
vulnerabilities to any strange stuff
with it
how easy is it for him so even if he has
not doesn't have the source code can he
do bad things to my app can he know what
I did in terms of protection and undo it
and this is exactly what I'm talking
about I'm talking about how we can break
into your app so the stuff you do for a
living I'm telling you how to break it
and for that I'll introduce a new tool
called code inspect which is a binary
analysis framework for Android so again
the model is that you have the developer
that has the source code and the user
only has the binary code but we're doing
what we're doing here is we give him a
tool that allows him to act as if he had
the source code do the very same stuff
inject code remove coat modify code
debug the app understand what's going on
there
and so what's your first thought when
you hear that usually people ask me but
why I mean I'm standing here I'm not
trying to run away from the police so
why should I kind of break into other
people's apps one answer because I can
second answer is there's actually good
reason for it because there are
legitimate apps where there is usually
no reason to break into and there is
malware on the Play Store or on the some
other source so for instance in China of
app stores that have apps of about one
third that are malware so one out of
three apps is actually something you
don't want and for these things you also
only get the app but you want to know
what these guys are doing you want to
find out is this app for which I only
have the binary code is this malware and
if so are they stealing my credit card
data are they running some premium SMS
scam so sending SMS messages to premium
write numbers at my cost or are they
actually trying to encrypt my phone and
get some ransom for me so what is this
guy and there it makes sense to kind of
break into the into the malware and this
is the the usual process that for
instance AV companies - antivirus
vendors here just replaced the developer
by the fraudster
and replace the user by the investigator
and then you exactly have the have this
scenario where someone needs to go the
development cycle the other way around
and reverse engineer an Android app and
that's in the end what it's all about
making it easier for the reverse
engineer to understand but also too many
you light question why manipulate
because sometimes if you just read code
you don't directly understand what it's
all about but if you're for instance
able to inject a monitor inside there
that gives you runtime information or if
you're able to inject additional
debugging and logging this makes it way
easier so as another analyst I sometimes
also want to change the malware or if
there's specific protection in there
that tries to hinder me from inspecting
the Melbourne like only do the malicious
behavior if you're run on a film located
in southern China I want to get rid of
that I don't want to fly to southern
China just to inspect that Melbourne and
this is a quick glimpse of the of the
tool so the idea is that you have
something that looks just like the
development environment with the only
difference that it's an analyst
environment let me quickly go into the
over the details here so who of you
knows the the old Android developer
tools for Eclipse okay
quite a few I know that Android has
switched to IntelliJ but our environment
is still based on on Eclipse because we
started when ADT was still for for
Eclipse with the first version of that
code so what you do is you can import
your binary application into the tool
you get the packages and the class names
in your normal hierarchy just like the
developer ahead you can look at things
like the manifest file to see which
components there are you can look at the
assets see if there is anything hidden
so some malware applications for
instance they give you a secondary tax
or apk file hidden in the original one
so that if you just look at the outer
thing you don't find the malicious code
but the malicious code is somewhere else
sometimes it's even in something called
a JPEG file that is not actually a JPEG
but that is code and this is also
something you can see here and I'll show
a live demo about that in a minute
of course you have the code now this
code might not look too familiar to you
if you look at it this code is not Java
code and it's not assembly code either
in the instead it's a language called
dimple dimple stands somewhere between
assembly and normal Java code symbol is
like Java but simple and the idea is
that if you have a malware developer
he'll try all sorts of stuff to try and
prevent this reverse engineering so he
will inject code that you cannot easily
get back to to Java code for instance in
Java there is a quite clear semantics to
what a loop is on byte code I can create
loops that jump everywhere in the code
on certain conditions this is not
possible in Java so I can't possibly get
Java code back from such an obfuscated
app and this is why we instead rely on
this intermediate representation instead
of just going back to to Java then as
usual for these for the Eclipse paste
tool there is the the code outline so
you actually see what this consists of
you see the fields you see the methods
and so on you have the usual thing like
syntax errors because I can also change
this cultural presentation if I want to
if I do something wrong I want to get
alerted about it I see the output from
the lock at so what the application
writes back to me as an analyst and of
course I can search through it and this
whole thing just looks and feels like
Eclipse for the analyst this means that
it's not too hard to get started reverse
engineering Android apps so you can just
obtain the tool and look at your first
Melbourne but for you as a developer
this also means that every guy from the
street can just use a tool like this or
one of the other competitor tools and
say ok I take your app that you develop
and I reverse-engineer it and so
protection against reverse engineering
or against all sorts of attacks is more
important than ever and as we have heard
in one of the previous talks there are
ways to to protect apps as I'll show you
it's it's a bit horror or Scott it's
getting harder and harder
because some of the protections we've
heard in the previous talks like
checking the signature or doing an MU
lie to check a root check can actually
be bypassed pretty easily but we'll
we'll see that in the in the live demo
and the most important thing is with a
with these tools you can also debug
because just looking at the disassembly
will not give you the default
information about what this what this
app does what you instead can do here is
you can just at any position set a
breakpoint and say okay I want to know
what this binary application is doing
here you have the normal stack trace you
have the variables view you have all the
things you know from from normal Java
debugging lock it console we all that
stuff so these features are just those
that you that you as a developer are
known to that is available to everyone
who just has the apk file so there was a
short short intro over the tool let me
just quickly go over the architecture I
know that this this architecture thingy
is maybe slightly boring but I'll do it
quickly and then go into the live demo
because I think that will be much more
interesting doing life hacking than just
going about boring architecture slides
anyway so to build a tool like this what
kind of foundation can you use so this
is built on the open source compiler
construction framework suit
does anybody know it okay so at research
conferences usually there are a couple
of hands when I mentioned suit this was
originally started at McGill University
and used to to optimize Java bytecode
and has more recently evolved into into
a compiler and optimization and
instrumentation framework also for
Android the idea is you have input
formats that can be Dex files apk files
Java source code files Java class files
and you can input
and out pulled those so I can easily say
let's take a dex file put it in to suit
come back with a with a Java class file
or take a Java class file and merge it
into an apk so I can just add code to an
existing apk and besides being such a
translator the suit framework also
offers things like giving you a call
graph so showing you for every method
call where this goes to or where this
can come from so all the interaction
between the methods can just be put into
one concise graph by that tool or you
can also do called synthesis so if you
for instance want to say let's put in
put a locker print after each statement
that accesses my device lady that's
something that you can do with this
compiler framework and since we built on
top of the compiler framework the the
code inspect tool can can use all the
the expressiveness of the of that
framework which makes it possible to not
only have something like small your box
smaller that you might know which just
is a translator but to also have things
like powerful with all the stations and
so on by the way who if you know small e
bucks Molly quite a few so this is just
a translator from text to some human
readable code and back to dex and we're
going beyond that and this whole suit
framework has been under development by
research groups around the world for
more than 10 years quickly I told you
about that intermediate representation
called simple so the idea here is that
you have something that is close enough
to byte code that you can represent all
the weird stuff that people can do in
byte code but also be still human
readable which is not the case with
things or not that easily the case with
things like like small e code that is
just plain hard to read and this
language can can also be used for for
manipulation just a quick
quickly going over that so this is a
actual piece of malware this comes from
from the Korea banking Trojan I'll also
use for the live demo and which I'll go
into the details on in just a minute
and what you see here is that this
malware actually takes some apk file
from the SD card and later on installs
it and this APK file was originally
downloaded from a server so there is a
command control infrastructure here
where the server tells the thurston
malware I've got a new version or some
code that you need to execute the
malware downloads the code puts it on
the SD card reads it in installs it and
deletes the file from the SD card and
the interesting thing about this mana
class of tools for which cons back is an
example is that they will give you
something that that has the constant
string serial so even if this originally
wasn't a constant but this was computed
somehow there is a so-called constant
propagator and folder running through it
that will make sure that even if this
was originally a concatenation of SD
card and test somewhere up there that
you will get the string the full string
here and you as an analyst can easily
see it another advantage of of these
modern kinds of tools is that you
actually have a type language so if you
look at things like small e code or like
disassembly that you get from things
like Ida Pro you only get registers here
you have actual variable names that are
type as you see on top so Arbeit is
actually abide and this is a file output
stream so it's very easy to read this if
you've just if you know Java and you
spend like ten minutes going through
that code you have the usual style of
first year method declaration then the
variable declarations and then just the
implementation of the method actually
this cheat sheet that describes the full
language that we use here if you print
it out it fits on one a4 page for
PowerPoint I had to split it up onto
slides and tall but what I want to show
here is simply that this is something
that gives you quite a lot of
information along the way so for a field
you see the modifiers you see the type
you see the field name for a class you
also see the modifier you see what it
extends whether it implements an
interface so you get all this
information directly like you had in
Java and for the code the the biggest
difference to normal Java that you will
notice is that the method calls are a
bit different so on on the bytecode
level which we're talking here so where
we but this originally comes from you
don't just have a method call that you
have kind of four different method calls
and the three most important ones is
that it distinguishes between whether
you call an interface a static method or
the kind of the normal normal virtual
call but again this is if you just want
to read the code and this is still
fairly simple and one other thing we
need to take care of when we're talking
about about something closer to byte
code there are no blocks so there is no
if-then-else instead if just as in byte
code are represented by if this
condition holds then go to there which
is a jump instruction if not fall
through same story for loop a loop is
just a go to an if and so these three
things loops conditions and and the
split-up invoke these persons they are
the biggest difference to two normal
Java code okay
enough of the boring stuff I think half
of the room is asleep so let's go to
something more interesting that is not
just academic stuff but but the real
deal
we have analyzed a piece of malware
coming from Korea so if you're looking
for for funny malware don't stay in
Europe the the much more of funny melba
you get from places like Russia Korea
China there are actually mail place
doors as I told your play store
equivalents that serve you one-third
malware so just download ten apps
usually you get three malware apps by
just picking randomly not good if you
want to use them on your productive
phone if you're trying to analyze
malware there you go
this one they had an app on the on the
market that told you it you would get a
preview version of the the interview
movie and that was before the movie was
out so people download that and said hey
I get the movie before my neighbor gets
it and I get it for free and this is all
because they are nice people and and
there were a lot of users that didn't
really think that there might be
something slightly wrong with it and
well actually there is something wrong
with it because this was by no means the
the interview movie this was just a
plain old piece of malware and this in
fact at over 20,000 phones so they were
apparently a lot of people that were
keen on getting the movie if you look at
this this malware it's actually a fairly
complex piece so from the users point
what this does is it first checks
whether you have a certain number of
Korean banking apps installed on your
device if not it will just don't do
anything if you have these apps
installed it will impersonate them so if
you're a customer of bag a and have
their app installed this malva will just
look like the user interface of banking
app a if you have be installed it will
look just like banking at B and they
have this implemented for ten or twelve
apps
so someone was actually putting real
effort in that not in getting the movie
but in getting your bank data and this
melba then had depending on the bank
they had emulated the security features
of the bank so if your bank had a
special let's say password for a
certificate you had on your phone for
accessing your bank account then this
malware would know that and ask you for
the password to that certificate if
you're a customer of another bank where
you don't need a password for a
certificate it won't ask you for a
password for a certificate so if people
have been in the talks here and go to
call about user interface design those
guys got it right because they knew what
to steal from you and so what did they
do if they showed the the banking API
ask for a username password bank account
number the certificate password if
required and a lot of other stuff and in
the background
they had a command and control interface
running so actually a server could send
additional commands to the malware to
activate extra features so for instance
update this stuff that's great we've
learned about continuous delivery at go
to Khan
these guys do it additionally the
command and control server can send an
SMS message to that malware to activate
SMS message interception so whatever SMS
message you get it's leaked to the
attacker this is not because the
attacker wants to know what your
grandmother's telling you about her
birthday this is because you get
transaction numbers from your bank via
SMS and that's what the attackers are
interested in and they are also able if
people get suspicious or if police are
hunting after them to disable that again
and then the application will just well
hide its icon from the launcher and more
or less be gone another story that we
see here for all this this data
exfiltration they use two channels so
for stealing your SMS messages they will
send it out via HTTP but at the same
time they will send it out by email
because they want to do resilient
programming if something goes wrong you
don't want to disrupt the user
experience right all the malware
experience because if police is taking
down your HTTP server why stop stealing
the stuff just go over email and I think
sometimes we as normal programmers can
learn quite a bit from malware
developers when it comes to things like
user interfaces resilience and so on so
what do we get this piece of malware
from that was an ongoing collaboration
with McAfee the antivirus company from
the pretest they knew that this was
going on so there's some emails sent and
there are some HTTP connection well the
big question was where is this data sent
to so what is the email address there
and hopefully if we get a password we
can then give this password also to the
to the police so that they can check
whether there is still stolen data
inside the account and now the big
question is how do you do that and this
is the the content of the live demo so
what you usually what you usually do is
you first have to import the the apk
file what I can do is I can just put the
apk or I can attach my phone and import
the apk file from the phone I'm not so
keen on running malware on my real phone
so I'll just import a file and just in
like in normal development environments
I can specify a project name and the
file since the import takes a while I've
already done that for you because I want
to waste your time on the left side here
you see that this is the the contents of
this of this piece of malware so what
you see here is let's go through it you
see the assets oh interesting there's
another apk file so they don't want to
see us want us to see all the code they
put a second apk file and somewhere
inside that malware they're actually
loading that additional code interesting
you see that there is some native code
inside there so apparently they are
trying to hide stuff if we decompile the
the dalek part or the the android part
and hide inside native code or another
interesting thing is if you look into
the resources they actually they're
actually rather good developers because
what they do is they don't just put the
the user interface strings as as normal
strings they use the string store XML as
an abstraction and they put it all into
resources maybe in case they want late
too late to translate their malware to
Russian or whatnot so for things like
enter password and recount they even
have proper error messages like hey you
entered in an invalid password that's
too short I don't speak Korean but if
you put this into Google Translate it
will tell you something like that so
that's also an interesting story this
Melbourne actually checks whether the
data you enter makes sense if you enter
an account number that it's not valid
for the for the bank that you originally
that was originally detected on your
phone they tell you hey you missed up
your account number I'm not gonna steal
it well they're not showing you the the
second part of the sentence but they're
showing you hey check what you injured
so that's all interesting now let's
let's log into the manifest um we see
another story that is quite normal for
Melba's so you see that they request one
or another permission and these are like
I wouldn't say harmful but let's say
interesting permissions like read SMS
read contacts call phone read call log
also very interesting a receive boot
completed because just because the user
rebooted his phone you don't want to
stop your scam keep the business going
and AH there's also killed background
processes because if you detect the
original banking app you of course don't
want the user to use the original
banking app but you want him to use the
malware and if you go through that let's
just see where to start because usually
these apps are are rather large so let's
see if we have something like main here
or now even better let's let's go for
what is in the launcher right
and you find something that is called
mainactivity that is good and never mind
the package name this was chosen by the
malware developers they are funny people
they name packages like this now let's
go to the definition and there's an
uncreate let's look into this for a
second so first of all you will see that
there's actually a lot of code but this
is already something interesting right
there is something called get bank's
info so as I told you they're checking
which bank your customer off they don't
want to scam the wrong bank they have
things like the bank URL and oops here
we go there is something that is that
looks like a username and a password
here so this is our first candidate for
that for that email access remember they
were stealing your data also by email
and we were interested in getting the
username password for that so probably
we should set a breakpoint inside this
method and see what's happening here
let's just do that yeah this is the
normal debug configuration thingy from
from eclipse only thing is I'm debugging
on on a binary now not on source code
and I want to use Miami later here I
could also start a new emulator or a
real device but running Melbourne on
real devices is a rather bad idea so I
won't do it so waiting for debugger to
settle uh-huh it's asking me whether I
want to open the debug perspective sure
I do
okay so this is essentially a super call
that's nothing too interesting let's go
further now they call a method that is
called ECE and they store the result in
something called z0 and the result is
true what we see here is if that zero is
true we go to label three let's see what
label 3 is oops that's killing the app
so the question is why does the the
malware just try to kill my app
and so let's just look into this is
because apparently is he made the app
kill itself and if you look in here
that's interesting they get the mobile
info and the phone state and then they
check well this contains drinks such as
goldfish SDK and draw it does anybody
have a have a clue what this could be
yeah this is an emulator detector so we
saw that this the return value was true
of course because I'm running on
emulator but I don't want the app to die
because I want to continue my
investigation here so let's just fix
that set zero okay now I'm not running
on an emulator sorry here we go
set zero it's false jump over it no it's
not an emulator these aren't the droids
you're looking for
okay let's let's just go over all the
garbage here we were interested in
whatever they were doing with that
password or username or what business
okay so what they do is they call a
method called string user here just give
it a try and see where this comes from
oh this actually comes from native so
this is exactly what this native library
was for because this string user and
string password these were native
functions so they're trying to hide the
username and password from us but just
putting it in native but we're in a
debugger so let's say this variable
string is the outcome of this call so
they put it in native but it's all of
not much use because I can just see the
value here and this has been taken down
now so don't try to steal the account
later and sell it on the black market
it's down same story if we step on and
look for the password here we go so even
if you put things into native code they
are not gone they're simply there put a
debugger and the
now before we go on let me just make one
change because I know that I will forget
this emulator check at some point during
the demo so let's let's get rid of it
for good I just commented out save the
project
it says building workspace here we go
emulator check is completely gone so I
don't have to fiddle around with this no
I'm not an emulator thingy now what we
haven't found yet is where they actually
sent this email right what we can do
here is at some point these guys steal
SMS messages right so we can see whether
they well they actually use this receive
SMS ah here we go so this is an internet
filter for SMS received let's just see
what this goes yeah there's this is an
intern filter for a hell of a lot of
stuff you never mind let's go into that
once again melba developers are
interesting people they they seem to
like four-letter words I don't know why
okay so there is a non receive method
and once again what I can do here is I
can simply set a breakpoint so I need to
run my app again yeah same old emulator
yeah installing launching connecting
debugger okay if I forgot to put out the
breakpoint and I'll create in main okay
now of course this is intercepting SMS
messages so let's to send it an SMS
message let's say it's coming from 40 to
42 and it's an SMS saying hello go to
con let's just send it
that is yeah okay I didn't activate it
so the interesting thing about this is
this is that as I told you there is a
feature that enables you to activate and
deactivate the SMS dealing if we go back
into the code we can see that pretty
pretty simply this this activation and
deactivation thingy is is controlled by
by getting the first the phone number so
this will only accept phone numbers that
start with 86 or 82 which are the
country codes for Korea and China and
then they do some some funny parsing
gear and what they do is yeah they they
check for a command called a K 40 ask me
why they named it this one and if you
send a message with a correct telephone
number so plus 46 a + 42 something and a
k4000 one it will enable the SMS
stealing a K 40 underscore zero it will
disable the SMS stealing and in case the
the app gets restarted it's good
practice to save it right persistent
state so they just use shared
preferences and save it as SMS status
don't make the attacker sent the status
twice that's a bad user experience you
want to avoid this so now let's just
start that one again and send it the the
magic activation as some s message yeah
by the way you might be wondering why
there isn't an error coming through this
is a pretty simple thing because it says
unknown host exception cannot resolve
host this one first of all I'm in an
emulator so this has no internet
connection and secondly police tend to
take down malware hosts so this is just
not resolvable anymore
that's also one of the things you have
to deal with when looking into malware
sometimes these hosts are not reachable
anymore or there is some other funny
behavior going on okay for for this one
we were looking for a to write +82 so
let's just do plus 82 what you sent us
here
Oh
okay yeah that's that's apparently new
one anyway so this will usually just
make the debugger hit the breakpoint and
show you the incoming SMS message and
they will write this value into share
preferences also interesting is that you
find calls to a bot broadcast what this
does is if this message is actually
coming from your bank they want to or
that make it differently if you want to
contact your bank and say hey I think
there's something wrong or if your bank
wants to contact you and say okay your
account has been hacked you want to
disable this because you don't want the
people to be warned about the Melbourne
so what the developers actually did here
they mailed the writers the aborted
incoming phone calls and SMS messages
coming from the bank so that people
aren't warned interestingly there was a
bug inside there so the original version
of the malware they aborted also
incoming phone calls from other people
not only from the bank this is a bit
unfortunate but you see that sometimes
malware developers aren't go to
developers either so I guess they should
have put in more testing some regression
tests some J unit tests should have
fixed the stuff so if there are Melvin
developers among you do test your code
before rollout that might actually
hinder your scam if you're doing it
wrong now let's just quickly go into the
in the interest of time let's just
quickly go into the into the the actual
scamming parts you see this call here -
to post Jason so this is doing the HTTP
sending part and I think it wasn't so at
three there is the actual mail send and
if I set a breakpoint here and run the
app once again which I want to in the
interest of time you will see that this
was the very password that we saw when
we debug the the oncreate and you also
see the content of your incoming SMS
messages being stolen here
I think that's that's enough for the
live demo let me just go back to to the
slides so you have seen that the tools
like this can be very helpful for
inspecting Melbourne if you're a malware
writer times are getting harder for you
but also for software development
sometimes you have a library of which
you only have the the binary code but
not the source code but something's
crashing in your app when you use the
library these tools you can just debug
inside the library and see what the real
cause is and how you can get that fixed
you can look for security
vulnerabilities inside these libraries
and you can see what happens under the
hood so you can understand these
libraries better of course don't be evil
so copyright laws still apply these
tools can be used to steal intellectual
property from other people's apps for
instance a nice algorithm
reverse-engineer it copy it possible but
illegal or you remove licensing checks
assume you have an app in the Play Store
that is free but if you want to let's
say play more than three levels in the
game you have to pay for it if this is
simply a check hey if I'm paid I can
command it out it takes me about a
minute still it's illegal but possible
and if you want to protect your app keep
that in mind so simple checks like this
emulator in the malware example they
won't do it anymore
I guess we've talked about most of that
so my claim is all your code belongs to
us so much all apps are essentially open
source in one way or another as we have
seen never hide secrets in the app code
so credentials for for backends
encryption keys just don't hide in there
because it's visible to everybody and if
you release an app it's totally simple
to to piggyback malware inside there you
have seen the code you have seen that I
could change the code I could have also
injected an alga is simple and cracking
paid apps is also rather simple one more
concrete thing we have conducted a study
on back-end as a service providers so
you know what began as a service
okay so there are people that don't run
their own back and stay Rendon of Emma's
know what not we have looked into how
people access these back ends and
usually they hard code they username and
password we will present that study at
blackhat in a Europe and Amsterdam in
November interesting is we found in
total over 80 million records and more
than 56 million individual data items
that were accessible just through the
credentials that were openly available
inside apps we conducted that study
together with the respective providers
so we are in contact with Amazon or
Facebook who owns parse comm so this is
not just some shady hacky business we do
on the side we cooperate with a with the
vendors to close these gaps and these
are not just gaps in these are not gaps
in the back ends these are things that
developers got wrong they threw their
credentials to the world by putting them
into the or yeah we have seen Melville
but also good work with these
vulnerabilities what we got there these
records they were email addresses health
records employee databases customer
support databases we have seen full
server backups residing there or also
voice records of car crashes so please
if you store sensitive data privacy
sensitive data whatever do not put your
credentials inside the app or else the
data's just gone and we've seen cases
where an attacker could actually
manipulate the data so increase your
salary or whatever you want
countermeasures in one of the previous
talks we've heard of you so string
encryption doesn't help too much because
you can still use the debugger and when
the string is used it has to be
decrypted in memory for string
encryption when the string is finally
used it still has to be available in
memory so then just set a breakpoint and
run off with a string a cone encryption
well at some point the code must be
decrypted put a breakpoint and access
the file before it's loaded
hi calls and reflection well I might not
be seeing from the cold where this call
is going because it's a reflective call
with a weird string but I can use the
step into a feature and arrive from the
right method or a debugger detection
just like the emulator detection in the
malware we patch it out I think I only
got a couple of minutes left so one
thing I want you to show us the the
plug-in system so one of the plugins we
have for this tool is state of flow
analyzer so this will automatically tell
you which data is read and well the data
is sent to and this can also help you
analyze such a piece of malware by
saying ok this reads from here and
writes to here yeah for instance in that
case you see that this is the source
this is a sink method and the data is
flowing along the arrows and in the in
the code inspector I this is just a list
of the data flows and the propagation
path along which the data is shown in
the program for instance here this you
see the source mode you click on it you
see all the statements involved in
propagating the data and you can jump to
the code where this happens and this is
also one of the things we can use for
looking into malware we were working on
more plugins like automatic deification
reconstructing encrypted runtime values
fully automatically and much more maybe
I can show you this in a future edition
of go to Chrome one thing that might be
interesting for a few of you is how we
can get the tool we're currently looking
into commercializing the product so we
do a university which means that the
basic technology is is free and open
source it's all on github
the UI is not but you can send me an
email and get a free 60 day license
that's no problem
so with that let me add the talk I hope
you had a bit of fun and learned
something about investigating malware
applications and
remember to read that session thank you
okay thank you very much Stephen you
actually answered a lot of the questions
that came in during the last slides I
just have one question for you you
mentioned something about a Android
studio is it something that you're
working on getting code inspect to run
in Android studio well this is something
some of the core problems of academic
research you don't get people to do the
the engineering task or the boring stuff
so we started this in Eclipse and I'm
afraid it will stay in the clips for for
most of the of the current time or the
more recent time because we just don't
have developers that explicitly work on
product features we have we have
researchers we have student assistants
but they want to do the cool stuff they
want to do the hacking the reverse
engineering so just this thing like
going to a new new platform is something
that's rather hard for us to do thank
you yeah I think that's about it time's
up so thank you again yeah thank you for
having me here
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>