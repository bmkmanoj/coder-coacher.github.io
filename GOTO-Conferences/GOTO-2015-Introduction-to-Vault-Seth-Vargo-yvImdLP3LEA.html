<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Introduction to Vault • Seth Vargo | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Introduction to Vault • Seth Vargo - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Introduction to Vault • Seth Vargo</b></h2><h5 class="post__date">2015-12-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yvImdLP3LEA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm super excited to talk to you about
Walt and just kind of before we get
started how many people here have heard
of Walt before
okay a fair number how many people work
in some type of security related field
including software engineering pull so
do not forget to engage and rate this
session and ask questions on the go-to
app so this is me
my name is Seth Fargo I'm a software
engineer and open source advocated Hashi
Corp so many people have heard of Hoshi
court before cool so this is our logo if
you haven't heard of us before or seen
what we've done before but you might be
familiar with some of the open-source
projects that we make like vagrant
Packer surf console terraform and most
recently volt so vagrant is a
development environment automation tool
Packer is a build environment automation
tool surface low-level gossip protocols
console service discovery and
orchestration terraform is provisioning
infrastructure and then vault is
managing secrets on both a small and
large scale so let's talk about secret
management and I want to talk about
secret management pre volt so for the
next let's say 10 minutes let's just
assume vault doesn't exist and that this
is six months ago before vault existed
what is a secret I think this this is
different for every person like what do
you consider secret information I think
there's some really obvious answers like
database password but then there are
things that we consider sensitive that
aren't necessarily secret right so would
you consider something like a customer
phone number a secret piece of
information probably not but it's
sensitive
it could cause personal harm to that
customer if that information is made
available so let's look at some examples
when we talk about secret data we have
some very obvious things like database
credentials SSL CA certs your you know
AWS access keys
encryption keys even things less obvious
like the Wi-Fi password or source
control and we do a really good job of
keeping those secret we put them under
lock and key we only share them with the
people that need have to have access to
them but on the flips we have sensitive
information which traditionally our
industry has not protected very well
things like phone numbers your mother's
maiden name why is that one so important
well that's the number one security
question in the world email addresses
which we traditionally store in plain
text so that we can grab those back out
and send some marketing email the
marketing department really likes to
have those emails available to them
things like our data center locations
doesn't seem you know too terrible to
have the data center oh yeah we're in
you know our customer personally
identifiable information so things like
home addresses phone numbers anything
that uniquely identifies a customer
possibly things like email and chat our
slack our internal communications how
well do we secure those and more so how
well do we protect them my laptop is
sitting over there unlocked someone
could walk up press the Escape key and
how difficult would it be for them to
access my company email or my company
chat you know we've seen incidents where
iPhones have been left at bars and it
happened to be the new version of the
iPhone and that cost companies like
Apple a lot of money because of the too
soon of a release so we need to do a
better job of sensitive information keep
it so I think as an industry we're
really good at this we have some pretty
decent solutions around spirit
management when it comes to what we
traditionally do use a secret but I
think it's an industry that or unaware
of the way that we treat sensitivity I
think to have a different definition and
I think this really is home for a number
of people it doesn't matter whether the
data is
or sensitive I consider a piece of
information secret if releasing it would
cause it to hit the news in some type of
negative way and I think one of the
prime examples of that is most recently
like Ashley Madison
so obviously Ashley Madison had some
secret problems they made their database
accessible attackers were able to gain
access to that database and as a result
they had a dump of the database that's
obviously you've gone perfectly however
the information in that database was
sensitive the names and contact
information of the people who are
interested in having an affair was all
just stored in plain text and I think
our systems are designed like this a
little bit today I think most corporate
enterprises look something like this we
have this giant external firewall that
has maybe a few security gates but once
you're inside the you know the
demilitarized zone once you're inside
the military fort we don't have a lot of
secure controls of who can access what
it's kind of like once you're in the
data center we trust all of the traffic
and once we assume that everything comes
from the application and I think we need
to design our data centers a little bit
more like this where each individual
component is not only surrounded by this
giant external firewall or series of
firewalls but that each component is
doing validation each component says
okay I trust the information you're
giving me and I trust that I can
exchange information with you and that's
kind of what SSL was built on was this
trust model so let's talk about secret
management one point out so we have
these secrets like database credentials
how do we get those into an application
so traditionally the answer there has
been you either hard-code them or you
use something like configuration
management to lay them down at runtime
but more importantly how do humans
acquire those secrets so you have
operators and application engineers and
they need to get access to those secrets
so that they can do their job they might
need to be digging into the production
database they might need to be relaying
something
- perhaps reproduce a bug so that they
can fix it on the software and how do we
invalidate those secrets so how do they
get updated so if I hand you the
database password how long is that good
for is that good until we rotate the
database password what are the policies
around rotating the database password
that comes to questions which is when we
rotate the database password how do we
make sure that the humans and the
applications have the new version and
that they're still authorized to
communicate with that database it's a
very unsolved problem right now
and then lastly let's say something
leaves the company there's a malicious
attack how do we all those spirits how
do we make sure that even if our
database credentials are leaked we have
the opportunity to shut everything down
before the database dump can be acquired
so this is traditional secret management
you just hard code it in the config
maybe you're using development variables
if you're doing like a 12 factor app but
even then if someone gains access to the
system they can just dump the
environment so why isn't configuration
management a good solution for dropping
off secrets well I think first and most
importantly it's centrally stored so if
you're using something like chef or
puppet or ansible or salt whether you're
using like their server Edition so all
of your secrets are stored on the chef
server or if you're just using the the
freemium and where all your secrets are
stored on something like git or SCM so
you're checking in secrets into a system
that wasn't actually designed to be
secret so things like chef encrypted
data bags have known vulnerabilities and
the community for example has come up
with alternatives because of your
vulnerability to each other so it's
proven that they're not a great solution
for storing secrets or so the
authentication procedures with who can
connects to the chef server connect with
the puppet server is also not 100%
secure so it's possible for a rogue
client to join a cluster and potentially
gain access to secrets that it shouldn't
have access to just by pretending to be
part of the cluster
writing out the secrets to a file and
then reading them straight from disk
it's eventually consistent
so if you're running chef or puppet on
some type of interval it takes 15
minutes 30 minutes until that a
convergence change has happened so that
means if right now you have a database
breach and you need to completely change
all of your database passwords and
rotate everything you have to wait 15 to
20 minutes or 30 minutes or you have to
force a configuration management run
across your entire clock and this this
poses lots of problems if you have a
number of servers for example you might
be introducing a thundering heard
problem you might not actually converge
and at some point your application is
going to be communicating with bad
database credentials until that
convergence happens there's no access
controls or very little access controls
but more importantly there's no auditing
around those access controls so who
access to secret why did they access it
how long did they access it what did
they use it for these are all questions
that we asked and when we talk about I
know we're in the lean track but when we
talk about rugged somebody said
something two days ago that really
struck with me which is you're never
really going to be able to prevent all
of these attacks the the value is that
you want to make it so difficult that
people choose a different and
alternative route that hackers to
something different because you've made
it so difficult for them to hack you
technologically so they'll resort to
something like a social engineering
attack instead when that happens
auditing and access controls are super
important it's very important that
you're able to track all of this because
in the event of a security vulnerability
the last thing you ever want to have in
a press release is we don't know what
happened it's much better to come out
and say here's where our vulnerability
was here's how we assay here's how we
mitigated it and lastly there's no
support for revocation so if you delete
the chef encrypted data bag or you know
remove the the puppet manifest all of
the machines that have been provisioned
already have access to that see its
historic Armin there's no way to revoke
that so why not something like an online
date of it tolls you keeper of those
types of things they're not designed so
at Hasek harp we believe in the UNIX
philosophy which is do one thing and do
it really well
and you would never expect ls to create
a file for you and we like to take that
same
with our tools and things like post
graphs and console art designed to be a
secret storage engine or if they do
those actors are very various opponents
code they're typically stored in plain
text a number of these have the ability
to be encrypted but they're not
encrypted by default so that means that
if you're using them for secret storage
you have to go above and beyond with the
traditional setup just to get the added
level of security that you need and then
lastly a very few of them have any type
of auditing or revocation abilities
built in you have to build custom
Postgres extensions you have to write
tolling a round console to make that
possible so another question is how do
we handle the secret sprawl which is in
a large organization we talk about human
humans
operators developers and machines having
access grids how do we deal with the
fact that there's secrets everywhere and
most importantly what do we do in the
event of a compromised what is our break
glass procedure so we see some anomalous
logs and think someone might have gained
unauthorized access to one of our
systems what do we do what does that
break glass procedure and most
importantly how does that break glass
procedure affect the rest of our
application the rest of our environment
they're gonna take down production are
we able to recover quickly and a lot of
the existing systems can't answer that
question they don't know the attack
surface they don't know who's accessing
a secret so it's difficult to have a
break glass procedure so if we talk
about the state of the world prefault
we have a lot of secret sprawl who has
keys why do they have them what are they
using them for with very little auditing
or visibility we have these
decentralized key storage and
potentially multiple systems and lastly
we have the this poorly defined grade
class procedure and in security it's
kind of terrible to say it but you have
to optimize for the worst case scenario
it's a field where the thing that can
happen will always happen best to
optimize for those scenarios like the
break loss procedures so let's talk
about secret management to point out we
were really aware of a lot of these
problems it was problems we were facing
internally so we maintain an
application called Atlas anybody heard
about what's before cool
so Atlas the way Atlas works is you have
to give us your cloud credentials it's
pretty scary
right like we're gonna provision your
infrastructure and manage your
infrastructure for you but as a result
you have to give us your clock
credentials which means we have to
create a system that you can trust us
enough to give us your GCE file or to
give us your AWS access keys and that's
a difficult trusted build so instead of
building some complex Postgres
extensions and blogging about it we
decided to make a tool and we made that
tool after talking to a number of
customers and we realized that pretty
much everybody has very similar problems
they're just thinking about them in
different ways so we came up with a list
of goals the first goal was volt needed
to be the single source of truth for
secrets and volt could be backed by
another storage engine that you might be
familiar with something like Postgres or
console but vault itself needed to be
the entry point for ceilings we need to
have programmatic application access so
tools like chef and puppet needed to be
able to access those secrets via some
type of authentication that proof access
to them but that whole process to be
automated we can't have manual
figuration in the modern world it
doesn't scale we needed also to have
manual access though so operators need
to be able to go in and get a typical
protocol or get an API access key they
can replay an attack or so that they can
potentially debug some type of issue in
production additionally it's not listed
here but developers might need access
but they might need a different level of
access so operators might have a full
open view of everything but developers
can all access so here it's in the
organization it had to be practical and
this was really open-ended but what it
really boiled down to was that it had to
work out of the box a lot of the
existing secret management systems were
black boxes you deployed them and this
is what you could do and it was very
much an entry point and you were done
and out of that came the fact that it
had to be open source and being open
source provides two advantages first it
means that you can dive into the code
right now and you could take a look and
you can find any security
vulnerabilities that you might want and
you can assess it most other security
tools aren't open-source and they won't
provide you with the security assessment
if one was done the second thing that
came out of practical security was the
user experience so we put a lot of time
and effort into the tool to make sure
that it's easy to use out of the box but
scales to hundreds of thousands of
devices or servers accessing secrets and
lastly it had to be modern data center
friendly or as the term that I've had
heard thrown around a number of times
here is that it had to be a cloud ready
or a cloud ready application so what are
some of the features of vault vault is a
secure secret storage mechanism and you
can use in memory which we can talk
about a little bit console you can use a
file system based Postgres and we're
adding more and more of the community is
interested in more and more of there's a
zookeeper back-end now as well one thing
that really separates vault from the
interesting secret management tools is
that we have this notion of dynamic
secrets so when you traditionally think
about a storage a secret storage engine
you put secrets in and you pull them out
you think it was something like LastPass
one Operator to pass an operator type
some secret an or copy and paste from a
web form and they put it under this
database type thing then when they want
to retrieve it there's apples around it
they put password in that's the master
password and they get the data out we
didn't think that was sustainable so we
took a different approach so vault has
the ability to create and dynamically
distribute secrets and I'll show a demo
of that here in a little bit but
basically with vault you can point vault
to a Postgres server you give alt root
access to your Postgres database and you
tell it hey when somebody reads from
this endpoint with an authorized token
give them credentials and those
credentials have an expiration they have
a renewal interval kind of like a TTL
and they can be revoked at any time and
they can be revoked on a prefix at any
time so what this means is operator is
no longer have to work it'll enter a
ting secret vault can do that for them
in fact the applications themselves can
request unique database credentials so
if you imagine you're running a Python
application or rails application
five hundred servers each of those 500
servers can uniquely request database
credentials and in the event of a
compromise not only do you have the
auditing and Ackles in place but you
have the ability to go back and find out
exactly which server was compromised
based on the credentials that were used
we needed built-in support for things
like leasing renewal and revocation as
well as key rotation which was recently
added we needed the auditing in the
applicable MRP explained and lastly and
most importantly is we needed the
ability to work with everything so
initially we looked at something like gr
PC if you're from the PC M it's goes
protocol for inter process communication
and eventually we just settled on an
HTTP API and the reason for that is even
though HTTP a guys are traditionally
slower the the restful area is a bit
overblown at the moment modern tools and
pretty much every language work with
some type of HTTP API in fact at the end
of the day you can always resort to curl
to get secrets from vault and you can
get that information out and JSON and
pipe it to something like JQ but we also
have first-class support for things like
Ruby so we have the wall trooper client
there's a node.js client a Python client
the official go client and there's a
rail client as well and the community is
working on more and more so in order for
the POSIX flow we built the pinna
environment we had a civil way to get
secrets so we chose an HTTP API for that
as far as secret storage is concerned
data is encrypted at transit and every
send stuff to the vault it is encrypted
and it is encrypted on disk or in memory
etc everything's 256 AES GCM we enforce
TLS 1.2 so no SSL v3 if you try to
communicate with vault it's not
downgrade your SSL protocol it will just
reject your request and then there's no
HSM required and this is both a positive
and a negative and a lot of people have
this notion that HSMs are like the
future and they add a whole lot of
entropy we found that that's actually
not true the end of the day you get more
a really good software algorithm
as opposed to an HSM which adds very
little if any entropy to a system an
entropy is important in secret
generation so we don't yet have support
for HSMs we're going to add support for
HSMs because the number of customers
have requested it what we found is that
in showing them at the map we did
typically change their mind because
software to find out rhythm can actually
have more entropy so I had slides in
case my demo didn't work but I'm gonna
switch to demo mode can we turn that off
so instead of instead of going through a
whole bunch of static slides that I
would just actually show you false and
so what I've done here is I've kind of
prepared a little script to set up vault
for me this is just a Astra
that I'm happy to show you so this is
just a batch script that's basically
starting vault and creating a whole
bunch of backends for me so you can see
that it's it has set up the AWS back-end
the Postgres back-end the transit
back-end etc so what I want to show you
is the very basic vault use case so I'm
gonna tell Walt where I live or where
the vault server lives and now I can
check the vault
so ass Turkey and then you can create
key holders use a Shamir secret sharing
so this eliminates the whole one person
has access to everything so in the event
of a compromise you can seal the vault
and it requires a quorum of key holders
that are set up whenever vault is
configured to unseal the vault so for
example at Haji carb there are five
people who have keys and I like to use
the analogy if you've ever seen like a
movie where people capture the President
and like three people have to like type
in their access codes
disarm the nuclear bomb that's actually
how vault works it's very very similar
like five people have access codes and
three people need to type them in in
order to unseal the vault
and all of that's configurable at boot
time you can have a hundred keys with
two people who need to unseal or you can
have one key with one person who needs
to unseal but we definitely recommend a
higher number than one and one I
couldn't seal the vault right now and
then unseal it but I don't want to do
that instead I want to show you kind of
writing to the generic back end so by
default without mounting anything vault
behaves very similarly to something like
LastPass or one password so you have the
ability to just write and it actually
just post command with Girl the tap well
not with but like curl under the hood I
can write up the two secret and then
then above a secret so in this case I'll
write to foo and I can say data so all
of the all of the data that gets written
to the secret store is in a key equals
value format and then I'll actually come
back as JSON so if I did this right I
did the date it was written to and the
way I can get that data back is the
exact opposite and you can see we get a
little bit more information back than we
did when we wrote the data so we get
this lease ID lease duration and whether
the lease is renewable or not talk about
renewable and a little bit because it'll
make more sense in a different context
the lease ID and the lease duration
actually uniquely identify this lease so
we have the ability to revoke this
secret without actually knowing its
contents so this means that we can
safely store that UUID somewhere else
and in the event of a compromise we can
revoke that UUID and vault we'll know
what secret it maps to so we don't have
to know exactly that the secret is named
foo all we need to know is the UID the
ability to output this as JSON which is
super useful for things like automation
and a lot of the the scripts that I'll
show you here today I use a tool called
JQ which will allow me to like pull the
data out at zip for example and so this
is a really easy way to
the data out of all put data into vault
you can write you can't write files but
you can write from a file so if you have
a bunch of K equals value pairs in a
file you can use the app sign and vault
will read each of them in and create the
value out of that so that's the generic
backend it behaves very similarly with
one password you just give it a password
at a particular key and then you get
attributes back out cool so the next
thing I would like to show is the
transit endpoint so how many people are
familiar with Amazon's kms okay so the
transit endpoint behaves very similarly
to Amazon's kms the notion is that vault
is going to maintain this encryption key
so this is where vault acts as an
encryption service and this is super
useful for things like web applications
or client applications traditionally
your web application needs to know the
encryption key so you have sensitive
information maybe it's a credit card
number even something like a phone
number that you want to encrypt in the
database but you want to store that
encryption key offline you don't want
your web application having access to
the encryption keys because if someone
compromises the database or the web
application they have everything on one
you want to make the attack surface as
distributed as possible so that multiple
systems have to be compromised in order
to actually have a successful attack
vault provides this encryption as a
service and the way it does this is
through the transit back-end so vault is
going to create an encryption key for us
and then all we do is we write data to
vault and their response is the
encrypted data and then we store that in
our database and at any time we want
access to the unencrypted data we write
with the encrypted data and vault gives
us back the unencrypted data assuming
we're still authorized to do so so if
you have an application that is behaving
roughly you can revoke that applications
access and when it says hey decrypt the
secret vault just as now so what that
means is your applications need to be
resilient to that and if you're using
any of the official plugins they they're
built in resilience is there it'll just
return like the empty value and login
exception as opposed
- like freaking out but I'll show you
the application that I built today that
will freak out just for the purposes of
the demo that shows you what happens
whenever the key has been revoked so if
we take a look at the transit setup it's
pretty straightforward I'm writing to
the transit encrypt demo with a
plaintext value and then I'm gonna
output that ciphertext value so I'm
gonna go ahead and run that and you can
see we got back this kind of goggly goop
vault with a prefix anything that comes
from the transit back-end in fact it'll
prefix a lot of its secrets with an
indicator that says hey this is from
vult and this is version zero of the
cipher the next version of vault 0.3 is
going to support inline key rotation so
that version of the cipher is super
important so the next version of vault
if you want to rotate your key that the
web application would say hey vault
decrypt this data and if alt would say
oh this looks like the old safer I'm
gonna decrypt it re encrypt it with the
old key and I'll give you back not only
the plaintext value but the new
ciphertext value that has the new
encryption algorithm so this means you
can do online key rotation without any
interruption in fact your developer
maybe need aware of it so let's go look
at what this might look like in
something like a rails application so I
put together this little rails
application yesterday which stores all
of my friends and their credit card
numbers I don't know about you but I
really like to keep my friend's credit
card numbers on on hand just in case I
need to buy something on Amazon
okay I don't know why it's not working
but
the demo gods are not with me this
morning I can move on to the next one
and hopefully figure out why this one's
not working but basically what I was
going to show you is that the
application will encrypt the data and
it'll store in the database it only in
stores the encrypted value but we're
able to get the plaintext value back by
querying fault but I have some other
demos and that we can come back to this
if there's time and so the next thing I
want to show you is the actual dynamic
secret generation and this is where
vault is very very different than any
secret management tool so let's take a
look at something like post graphs so
here what I'm doing is I'm telling
Postgres hey like I want you to give me
credentials but I'm doing laps through
vault so in that setup script what I did
was I I gave vault access to the
database kind of is the root user of the
Postgres user which has the equivalent
of sudo and Postgres LAN that means it
can create databases create users etc
and it would be from the hook as path
you can mount multiple paths what I'm
going to get back is a unique set of
credentials that have a certain
expiration so I'll go ahead and run this
just to show you what happens so you'll
notice that we got back the don't worry
about the host but this is the username
and password that we got back from
Postgres and then I just connected with
Postgres so this is actually a remote
piece equal instance that's running on
ec2 somewhere and I have the ability to
list all of the databases and this user
actually only has read-only access so we
set up the template so that any
credentials that get read from cred
slash read-only endpoint controls that
are read-only you can imagine this is a
scenario that's great for something like
application developers where they want
to be able to go in and debug the
database they want to inspect some
values potentially diagnose an issue but
you don't want them to be able to do
anything damaging you just want them to
be able to read data so with their token
they might be Emily they'd be able to
generate read-only values so I'm just
going to copy this here
we will quit Postgres so I can read this
any number of times it will notice that
the value we're getting back is
different every time so if you look at
this username password it's constantly
changing if I went into Postgres right
now and I list the users we would see a
user for each of these now after I think
I said it for 15 minutes
but whatever the least duration is if
these secrets haven't renewed themselves
I'm sorry it's one day 3,600 if they
haven't renewed themselves in that time
frame vault will revoke them so what
that means is your application needs to
have intelligence to say almost like a
TTL hey I'm still using this secret and
it does that on some interval we
recommend least duration over two so you
would renew every 1,800 seconds in this
case instead of 3,600 so every 1800
seconds you have a background job that
pings vault and says hey I'm still using
this secret and that will reset kind of
the countdown clock if you will of this
secret if that has zero there's two ways
that that secret is revoked first of all
it uses a right ahead log so even in the
event that something terrible would
happen vault could rollback and the
issue of failure but we also create the
Postgres user with an expiration so when
the back-end that supports it has the
functionality vault we'll create the
user with it if someone is able to
completely sabotage fault the Postgres
user itself is created with I'll show
you here the valid until clause and that
expiration value comes from vault it's
based off of that lease duration so that
means that even if vault completely goes
offline I could completely tear down
this particular vault instance Postgres
will still expire those users after 3600
seconds so we have that double layer of
security that even if vault itself is
compromised the secrets can still be
revoked if the storage back-end supports
it so for every every value that we're
getting back this is creating a new user
and if I leave this run for an hour
those users will all be volta vlog
you'll actually see over oak provoked
and you could either wrinkles they're
taking place if the application is
renewing so I think kind of the obvious
question that is how do we get these
secrets on to like our application and
you have a couple ways so you could use
something straight up like curl and grab
the JSON output and put it on disk or we
have a tool which is console template
which will actually allow us to open up
from vault directly into the filesystem
and you can change the permissions on
those files so that only the application
can read them you can also pull things
into the environment with other tools
that are not console template so if I
look at this console template basically
what we're doing here is we're querying
vault for the passwords key and then
we're grabbing the data at go-to so what
I'm going to do here is I have to
actually create this password so I'll do
a vault right secret passwords what do
we want our go-to password to be go to
London okay I'm doing this to prove to
you that this isn't just some elaborate
scheme that I've pre-recorded so now if
I run template dot H you can see it's
actually pulling out that password but
obviously that was very quickly because
it's communicating locally but if we
change this password it'll automatically
update very similar to the edge term
that happens in Kabul template with
concept and the advantage here is that
consul template is actually doing that
that lease renewal intergroup interval
in the background for us so you could
actually replace this with something
like reading from Postgres creds
read-only so if I edit this and instead
of reading from secret passwords I could
read from Postgres creds read-only and I
think it's username
I guess their own key but this is
actually querying for new Postgres
credentials so every time this actually
asks for a new value it'll get new
Postgres potentials but once it has the
credentials
it'll renew them so this means that your
application could use something like
console template to request secrets
assuming it has the proper authorization
and then once it has the secret the like
something like console template or vault
Riviere vault rails would be responsible
for renewing it in the background and it
has built-in support for that so you
don't have to worry about the complexity
there hmm
so this is great for something like you
imagine like a rails application you'd
be writing out your your database yamo
file so that you have the ability to
have dynamically generated secrets
without the application needing to have
all of this intricate knowledge of how
vault works you just give it a path you
read from that path and you get secrets
back so it looks like I'm actually rate
at time so we're not going to have a
chance to go back to the template demo
but I'll get it working and tweet out
the URL so that everybody can take a
look at it and you can put your friends
credit card numbers in for me if you
want it's totally optional I think I
don't know if we have time for questions
Martin okay
Wow we have 20 minutes
well there are no questions in the app
so I'm happy to take real-life questions
yeah in the back some production a
minute you mean to repeat that okay uh
the question was this was an impressive
talk thank you
who's using vultan production this is a
difficult question to answer because a
lot of the customers who are using vault
that are impressive have asked not to be
named there's a very large coupon
manufacturer that's based in the United
States there are a number of financial
service firms that I will not mention
expressed a lot of interest involved and
I think the majority are now running it
in production a lot of the
zero-point-three features are as a
result of enterprises running this in
production we obviously use a vault in
production atlases all of the keys that
you add to Atlas are encrypted in vault
and I have a very detailed blog post
about how that works on the architecture
on the high score photograph' you're
interested in reading like the
nitty-gritty technical details of how
that exchange happens vault is a weird
one so for other one source products a
lot of people are like yeah we totally
use vagrant and you find when you get
into the security space a lot of the a
lot of the ways that organizations
protect themselves is by not telling
what told using because that's a
potential attack vector so if I know
that you're using LastPass I might be
able to exploit the vulnerability the
same way that I know if I know you're
using an unpatched version of open SSL I
might be able to exploit vulnerabilities
so they're very less open to talking
about who's using it I can say that on
the day of release it had over 2,000
stars on github and it continues to grow
it's one of our most quickly growing
open source projects we hired a
full-time engineer to work on it so it's
definitely popular it's used by a number
of people I just can't really talk about
a lot of them other questions that I saw
wasn't go ahead
so when you're talking about the dynamic
secrets and stuff I guess you have to I
mean you hit a couple of scripts there
it's not like I sort of took point that
because I - I think we quite in Sun was
going on so if I have my own database
and I want to like dynamic secrets
obviously I've got a provide vault the
way to create new secrets inside that
how do I do that yeah I did that in the
setup script but I didn't really go
through it for two reasons so first of
all the reason that I use scripts is
because I can't type and talk at the
same time I've done it before and it
doesn't work out very well so it's much
easier for me just to instead of you
watching me typo 30 times it's so much
smoother demo if I just have the scripts
pre pre filled out but if we just go
through this file here or do I do it oh
I didn't show the AWS demo so you can
dynamically generate AWS keys - but
here's where I set up the back end so
these lines here and you can see what
we're doing is so we mount the Postgres
back in and then I give it my connection
so we have a PostgreSQL back-end which
is where you can store secrets and then
we have a PostgreSQL secret back-end
that is how you can generate dynamic
secrets from post graphs we've talked
about renaming it but it's actually both
so you can use Postgres to store vault
data the same way you could use the file
system or in memory but you can also use
post press and we support my sequel
uncas to dynamically generate secrets
using a vault
so you give vault kind of the keys to
the kingdom and you say hey manage
Postgres credentials for me and you tell
vault how to do that so like if you go
to this RDS instance you can login with
the username vault and the password is
vault password obviously very secure and
like I've configured all of this for you
and then you tell volts how to create
the users so you're telling the ball at
the read-only point so when someone
reads from read-only I want to create
them a user and then I only grant them
select
on all tables in the public schema so
we're doing them to select instead of
the ability to modify tables and that's
like postcard specific
right so the question is this template
needs to be stored securely because it
has the credentials to vault in general
you actually put this in a template an
operator would configure by typing
something into the configuring vault
there's there's a number of ways to
configure vault internally we is private
github repo that has our configuration
in it and then for like things like post
graphs we have an out-of-band storage
engine that pulls that data in I'm at
Reaper vision time but once it's
configured you no longer have to do this
and even if vault is turned off if
you're using a persistent back-end so
anything other than in-memory when it
comes back online it knows all this
information it's all encrypted at rest
so you only have to configure at once so
ideally you would actually never put it
in a template unless you were doing like
a disaster recovery thing I just made
this template because watching me type
all of this stuff out would have been
boring for you and very embarrassing for
me I can show you the AWS backend if
you're interested in that that's
actually super useful for developers so
what I have is a policy here if you're
but yes it's just an IM policy for
developers so what I'm doing is in chart
I'm forcing two-factor authentication so
I'm saying you cannot use our production
infrastructure unless you have to factor
off enabled pretty basic but point so
this allows anything on you to if the
developer has you factor off and if I
will read AWS creds developer I'll get
back life access keys and so that's an
eight if you're familiar with AWS that's
an access key ID and a secret access key
and that has access to my personal ec2
or my personal AWS account please don't
go Bitcoin mining if you have two-factor
authentication enabled which like the
developer who actually requested these
would need to have two-factor
authentication enabled or else it over
object
the actual creation at the ec2 level so
the ami are the I am policy will
actually reject creation unless the user
using these credentials has the
two-factor authentication is a something
you could use for like a system that
uploaded assets maybe it's like a CI
server that compiles your JavaScript and
uploads it to some bucket on s3 you
could have that system dynamically get
secrets from the assets endpoint and the
only thing that you change there is
instead of reading from creds developer
you read from creds assets you get
different credentials back and these
credentials one spot expire in one hour
if they're not reviewed so I don't even
have to go delete them no just expire
and when they expire they'll
automatically be removed for me to be
awesome
aunt furball other questions
do you
yes so one thing I did not show because
it's really complicated and assumes you
have kind of a deep knowledge of how PKI
works is vault can actually act as a CA
so if you give vault a CA certificate
people people or computers can request
certificates from vault and not only can
they use that to authenticate with but
you imagine most most organizations have
to distribute SSL certificates onto
client machines if they're doing
termination on something other than like
a load balancer and getting that
information from vault as a CA is
actually super helpful we do this
internally you can also enter Kate with
vault using a certificate and so that's
the flip side of things so in addition
to being able to generate certificates
and then write those to disk you can
actually authenticate with vault using a
certificate with my clients certificate
exchange private public key those types
of things you can authenticate with
vault using github that's how our
internal stuff works so we have people
who are in on github and only people who
are in team are able to have root access
to vault everybody else has which is
your developer app just of all which
means they're much smaller scope and you
have full control over the apples that
you set up in volt and you just give it
a policy and you tell it's all path
based so if you don't want developers to
be able to touch the AWS back end it's
denied by default so you can give them
access to a particular point and as long
as their key fits within that role
they'll have access to it the only
exception is the root key or route
anyway so that's initial 5 or 100 or one
unfed rated access everything's logged
and audited it but it's usually
recommended that you take that root key
and you put it on like a USB Drive and a
safe and then you give like a pending
patient about name password
authentication to operators and you can
still tie them to a pseudo policy but
they don't have that root credential
which is like the keys to the kingdom
okay regarding revoking access of
seniors potentials the quantity left is
a core work required and have it be
reinstate okay so the question is with
regards to revoking secrets is quorum
required the answer is is no I'll talk
about leader election in a second are
ackles required so yes you have
so everything involved is a brief so the
path is very specific so like Postgres
creds read-only you have to have access
to either that element so you can revoke
a token that you're a key that you've
created so I could revoke anything I
created here I also happen to be logged
in as the root to vault right now so I
can delete anything if I'm logged in as
a developer I can delete things that
I've created and things that fall under
my tree so there's a command called like
revoke tree and they that will literally
revoke everything you've created but I
can't revoke someone else's keys unless
I'm above them so it's very similar to
like an organizational hierarchy in a
way what was your third point no so once
they're deleted they're deleted you can
generate new ones and the notion is that
the same way we throw away
infrastructure talk about mutable
infrastructure we throw away
infrastructure we're starting to think
about secrets the same way right we have
these dynamically generated secrets and
we really don't care what the database
password is as long as it's valid so if
you accidentally revoke a key you just
reauthorize the access and the
application will just generate new
credentials and you're like okay
whatever it's a new password I don't
care those passwords have a very high
degree of entropy as far as is quorum
required and so vault will support hae
mode or are you talking about quorum
about people or quorum about computers
okay so no quorum of people is not
involved the only time a quorum of
people is involved is when the vault is
skilled
it takes whatever the key threshold is
to unlock the vault as far as quorum
goes with a chase of all it does support
a che but it has to be backed by a
back-end that supports leader election
so console zookeeper I think are the
only two that can do a che
and it it's a very primitive h.a we're
going to improve it in the future
but you don't require a quorum to do
anything so one of them is elected a
leader the followers will forward
requests to the leader vault 0-3 we'll
have a few read requests that the
follower is going to respond to to take
the load off the leader but write
request fall forward to the leader if
the leader goes down you know something
like council lock or zookeeper lock
would just elect a new leader and then
request will start right so it's a very
basic election algorithm but you're only
ever writing to one server and right now
you'll only have a read from one server
unless you're running on like vault
Lasser other questions comments
complaints concerns
well I don't have anything else feel
free to find me I'll be around for the
next like four or five hours and then I
got to go catch a flight back to the US
but feel free to ping me on Twitter or
you can email me I'm Seth mark on the
internet I'm South Fargo at hash Gorp
so if you have any questions or you want
follow-up I will publish the demo
materials probably on github somewhere
and I'll tweet that link out shortly so
if you're interested in diving in to my
terrible shell scripts you're more than
welcome to do so cool thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>