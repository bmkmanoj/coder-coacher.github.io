<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • The Future of C# • Mads Torgersen | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • The Future of C# • Mads Torgersen - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • The Future of C# • Mads Torgersen</b></h2><h5 class="post__date">2015-07-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/AU9VzbdkVy8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well so yeah what's the i was involved
in java generics for a while there back
then i think some people blame me for
wild cards which may have been while
microsoft hired me you know he's he's
good idea as ruining the story for the
java guys do i apologize for that but i
bet at my ways i now work on the
sous-chef language that microsoft these
are great times to be in that position
because stuff is just going pretty crazy
around c-sharp internet right now we
have the the thing that sort of at the
core my talk today is what we call
project roslyn for no particular reason
other than it's named after a little
town in in central washington state
which is sort of a completely
reimplemented language engine if you
will for c sharp and also for visual
basic so you can just sort of
generically apply and for visual basic
wherever appropriate and the rest of
this talk and i won't mention it again
language engine that is yes a compiler
but also the language service for ide
support working in a sort of mostly tool
agnostic way to serve up information
about the language in real time and also
a driver for any kind of static analysis
you want to do over the language
something that understands source code
and produce a source code with extremely
high fidelity that's that's the core
that protein and when we've then sort of
been going to rebuild all our tooling
for c sharp on top of that and so we're
going to be playing with what that means
during this talk we're also open source
about a year ago we took the c-sharp
compiler open source on codeplex and
then a couple of months ago in january
we move to github because otherwise
you're not really open source apparently
it's a whole lot more fun going on there
we also recently open source what we
call dotnet core it's sort of the modern
component highest version of net that is
now completely open source and maybe not
completely done but at least the work is
going out
on github for a a clr that is that I can
run on much a smaller footprint because
it's a well componentized then that is
cross-platform so it will run on Linux
and Mac as well and so with net going
cross-platform in anger being able to
for instance run in all the different
kinds of VMs that we offer up in Azure
or whatever it that's really important
for us it also means that we can now
consider having cross-platform tooling
support as well and again the rosslyn
language engine place a core part in
that and how would you do how would you
do c-sharp have a great sous chef
editing experience from some tool on
let's say sublime text or whatever well
there's an answer for that because of
because of this infrastructure and we
actually have our own Visual Studio code
lightweight editor that we just released
that is on across these these three
platforms in particular right now
there's an another open project going on
called Omni sharp which actually again
benefits from having a core language
engine written in C sharp putting
putting a layer around it making it
essentially a standalone language server
if you will you can run on your machine
and talk to buy a protocol to get
completion events and other kinds of
things from IDEs so that rather than
having to do a completely new a deep
integration of language understanding
into your ID you just have this sort of
loosely coupled you just need a little
thing that can talk to the language
server and so we're hoping to CC sharp
start showing up in many more IDs over
the next year or so so if C sharp wasn't
for you a year ago it may be now if it
is now it may be a year from now we're
definitely looking at going out and a
lot more places into a lot higher
quality of the development experience at
all levels we're also doing a lot of our
design now completely in the open it
used to be that we SAT around as Gilad
bracha used to say in smoke-filled rooms
and plan the future of C sharp and
someday two years later we would come
out at a big conference and say Tara
here is here's the word here's what
we're doing and people say oh we wish
they'd ask us before they didn't usually
say that but we we just totally open
that process up we are we're still
designing we're still planning even as a
version C sharp six is coming out now in
the next couple of months we're already
the signing of C sharp seven but we're
doing it completely in the open we're
putting the sign notes out we're taking
proposals and github lots of discussion
lots of feedback so it's a nice nice
open cross-platform world to be in but
that sort of the context I want to start
focusing in on the rustling engine
itself so it works both it's a batch
compiler it'll generate IL and it's also
at the same time the driver for the Ides
a big challenge here for us is that
they're sort of conflicting pressures on
a language engine for those two purposes
for batch compilation you want to focus
on throughput correctness you want to
produce you know great executable code
based on correct programs and that's
that's the main and you want to do that
fast right so that's the main pressure
on their wares in an IDE you want to be
responsive you want to have great error
recovery so you want to be able to deal
when somebody is typing in an ID the
code is wrong most of the time and you
want to be able to deal with that in a
graceful manner right it's only like
fraction of the time that they actually
happen to have a well-formed syntax tree
so we've really sort of taken those
pressures and and pushed on both
insisting that we wanted the language
understanding to be implemented only
once you can't have if you have separate
implementations for different purposes
they will drift apart they won't be too
full quality so we've insisted on having
it in one place and i'll show you some
of some of why i actually isn't it next
point speaks to it at the core of
Rosslyn is an object model of code
there's an API okay that represents
source code so syntax trees fully
concrete syntax trees all the way down
to the individual tokens and white space
and so on represented as data structures
in a public API that anyone can access
right in target at source code in the
tool or as a standalone analysis process
or whatever you can also get a semantic
information all kinds of binding
information and all that um in an API
that's completely immutable ok so we
represent all these vast trees are
immutable and we use all the tricks in
the book for working with immutable data
types including lots of sharing an
incremental modification non-destructive
modification creating new trees out of
old ones by reusing you know 99 percent
of the sub trees and and at the same
time also using laziness and other
techniques and so on so so we've done
all the work to make these very
efficient data structures to work with
for anyone else both of you are using
them in batch mode and and in sort of am
an interactive mode as part of a tooling
experience and again yes it's open
source we take contributions and get up
come and visit us on github.com / net /
rustling and and pitch in there so i'm
not really i don't have a lot of slides
i'm more sort of a coating live and
possibly crash and burn kind of guy so
today i'm going to tell you in a minute
i'm going to switch over and we're going
to spend essentially the rest of our
time together in visual studio and and
i'll show you some things and we can we
can take it from there right so what
we're going to look at is i'm going to
walk over here because if we've got my
watch what we're going to look at is
some your language features that we kind
of had time to build in between
buildings all this infrastructure and
they're kind of fun maybe a little
lightweight it's definitely sous-chef
six is not one of those releases tuvalu
shin eyes the world it's essentially
about cleaning up your code and getting
rid of some boilerplate making your C
sharp code more concise and I'm going to
show some examples of that it's not
going to be a thorough breakdown of
everything that's going on i'll point
you to where you can find that online if
you want to we're going to also see how
r us in place in the IDE how you can
build your own analyzers make them work
in the ID some improvements to the
debugging experience
and then we'll go and build our own
analyzer based on the rosslyn API and
just just to feel that sort of easy
extensibility of a sort of language
based analysis that anyone can go build
and time permitting at the end we can
look a little bit at what's going on
with sous-chef seven what our initial
thoughts on that but if we don't get to
it you know track me down hunt me down
wrestle me to the floor at the party
tonight and ask me until I you know I
promise you do to put in your favorite
feature and this will talk about later
that was exactly the kind of thing that
I didn't want to get to it so let's go
to visual studio without further ado
this is the release candidate a visual
studio that was just visual studio 2015
it's just released you can go download
it it's free it's going to stay for you
if you're not in an enterprise community
edition you can go play with this at
essentially released quality right now
so here we are in just some sample
sample program in the new in the new C
sharp ide and and Millennials become the
biggest generation in the US workforce I
should have turn that off probably I had
such lousy internet here before but now
it seems to be doing fine so one are
they let's start with with one of the
language features that Java has had for
a long time that we've stole because you
know we like to respond in kind to some
of this when some of the transgressions
that have happened in the past so you
can now in Sioux tribe you also now have
a using static that can put static
members of a type into scope so we'll do
that's a system but math which is a
standard library of static functions
doing math and you'll see it's great out
here because the language engine knows
that you're not using making use of it
anywhere okay and you can see down here
now the mass square root here has become
great out as well because well you don't
actually have to say it anymore so now
if I if I hit control that you can see
there's a light bulb out there if a
controlled art I get one of the the
built-in fixes suggested to me which is
you know
simplify it it shows it before and after
good solid IDE behavior here certainly
better than what visual studio users are
used to maybe uses of other tools don't
really impressed by this and that's okay
still a lot of people that are that are
happy but this is building behavior and
and kind of what I want to point out in
a minute is this is this built-in
behavior is built on those same API is
that we're going to go and build on in a
minute and I'll show you some custom
built analyzers and fixes in a minute
that have the same behavior
indistinguishable you can essentially
plug into the itu visual studio or any
other ID that will support this okay so
that was um that's the first little
language feature there let's just all so
go let's do it again with the system
console I believe in Java it's eleni
Java programmers in here did they all
leave the room Wow ok that's a few good
because I'm I'm I'm operating under the
assumption that it's not all just see
share folks though it seems to almost be
who's not a c-sharp developer in here oh
good thank you great almost half was
worried there for a second um there's a
program here that has a bunch of
recurrences of console the right line
there's also this ability to go and say
we'll fix all of them in the document
you get a nice preview show us all for I
can turn them on or off apply after the
preview and boom okay nice building
behavior now let's go look at these we
have these short little methods and
properties here here's a method that
returns the two string is an information
to string hits a property the computer
property with the Gator they return some
stuff and you see that stuff here is
grayed out as well well that is not the
that's not visual studio itself graying
out these things that is a user build
plugin saying you don't need this
consider using an expression body member
so what I have is I installed a little
extension that will suggest use of the
new language features to me so whenever
you can use one of the new language
she will suggest to do so because it's
probably going to make your code nicer
so I'm going to say okay it looks like
this a light bulb it may not even want
to fix it for me use expression bodied
remember it says well sure let me go do
that that's a nice preview that looks
good and that the bug that it jumps
there has been fixed by the way oh I did
it on just one down here instead
nevermind that's a property same idea so
it fixes to this new shorter syntax here
which uses a what we should probably
call a function era proper function
arrow with an equal sign not a that
little skinny minus there that some
other languages have for their lambdas
to say you know why why I provide a
whole statement body for for the simple
method or the simple property when you
can just put the expression after all
lambdas allow expression sets the bodies
as well right do they in Java or do
lambdas have they have to have statement
bodies oh who are you who are you
wealthiest an idea for you allowed on
that allow it on a function members too
so so this so this whole behavior that
the preview and everything was computed
from something that the built-in that
the not built in but that just one of my
colleagues building uploaded as an
extension analyzer and fix you know just
provided by those so we can go you can
do the same for these operator overloads
here she also don't have in Java and we
can we can just no han um we can just go
and do them all in one fell swoop here
and the the whole point again is i don't
don't have don't don't have so much
boilerplate lying around just to just
write your code concisely when it's when
it's simple make that stand out so so
that's the point of the language I'm
kind of into mixing language and ID
features here just for to make you
completely confused so that's that let's
look at so that was all so that's an
example of some some analyzers that show
the problem or a suggestion with the co
ode and then there was a fix for it this
also you can also build your own
refactorings so C sharp now actually
does have a significant number of
refractories as opposed to like two or
something but you can also build your
own so if you look at string out format
here it's it's not marked in any way but
if I go there and ask hey what can I do
here it's going to suggest that well you
can expand that expression body remember
right back out if you want to but you
can also convert to an interpolator
string so interpolated strings people
might know from other languages it's the
idea that you don't need to do a gnarly
library call in order to have your code
format it's actually sort of built in
syntax for it in the language and we
have that to hear string that format in
net you have to put these numbers and
curlies inside of the format string and
they refer to positions of the
subsequent arguments and that's just a
pain you you add one and you remove one
and you move it around in the string and
all of a sudden it's all out of
alignment and you're full of bugs so why
not why not turn this into why not take
in and choose it that one oh that was
the wrong one and choose the convert to
interpolate string and it'll use the
syntax here or you put a dollar in front
of a string and that turns things with
curlies into real holes that you can put
expressions in and they will just get
formatted right into place there and so
string formatting becomes a lot more
concise in the language they're also
hidden tricks that i'm not going to show
you if you don't like the the formatting
to current culture that is default here
they're hidden tricks that you can do it
differently but i don't want to show
those so yet another little language
feature let's get to some of the maybe
slightly more interesting ones actually
let me you know most ids nowadays have
have a good inline rename refactoring
and we have one as well now hit f2
they're on a name and you and you get an
inline remain rename experience of
course if I rename to just to show you
how deeply this engine understands the
language if you rename the keyword it
will escape the keyword it will solve
the conflict for you essentially if you
rename to let's say why it'll tell you
that here's a conflict I can resolve and
give you give you
red everywhere let's let's see if I
rename it let's actually hang on a
second let's expand this constructor
here if I rename it to say lowercase X
you'll see that down in the constructor
it automatically resolve the conflict
between the two lowercase X is by
putting at this start in front so we
essentially have a mechanism in there
that takes any any piece of code that
may be affected expands it to the most
elaborated syntax that will get the
right answer and then removes everything
that can be removed without changing its
meaning and we use that in factoring
support automatically to to fix up
conflicts whenever we can to the
shortest possible way of expressing the
meaning of what was there before even if
the thing they're no longer means that
so that you can trust your refactorings
and and don't have to kind of double
check yourself all the time okay now for
some fun stuff maybe here is a method
that takes this point class that I have
and turns it takes a JSON object and
turns it into point so first it checks
is it is it actually in the right shape
then if it's not it throws in them an
exception here and if it is it turns it
into a point by creating them on here so
you see that there's a squiggle here
because again my plugged in thing is
giving me a warning saying this is
probably wrong because you have a string
of the same name as an argument ugh
O'Kane so if if someone was to go and
use the the fancy new inline rename on
the argument well that name down here
wouldn't automatically follow you'd have
to remember to include strings and you
might forget and so refactoring where
their string representations of program
names around is a dangerous business and
we figured it was best to address this
in the language so that's actually hear
a refactoring to use a new name of
feature which is just essentially pass
any named entity from the language and
get the string out I'll resolve the
compile time of course just to a string
so that you know if you go in and do a
rename now it works across this guy as
well here if you if you change the name
to something that isn't allowed you get
an error and so on so more annoyingly I
have this lump of code up here to check
his situation in the right shape first
of all you know is it null if if if I
index into the X which is how the J
object API works is that null was it
there or not and then if it was is its
type and is it an integer okay so it's
all this null checking and no checking
is everywhere and it's really annoying
and when it's not everywhere it's
because you forgot to put it in and you
have bugs so we wanted to make it a
little easier with what is sometimes
known as the Elvis operator question dot
you know the two eyes and there's the
swoop of hair so salvus we call it a
null conditional operator which will is
a dot that will check first if the thing
on the left is null and if it is then
the whole thing becomes no and otherwise
you do the dot and get the value out ok
so it kind of its null propagating if
you will if there's null on the left
hand side the thing on the right hand
side we come to all instead of throwing
an exception and so of course null is
not equal to j token type that integer
so in this case we can just go and
remove the explicit and i'll check here
is questioned out instead do that here
as well and actually you can do it for
indexing as well so i can put a question
i can put a question mark here and that
means only do the indexing if Jason
wasn't null and so I can actually remove
all these null checks here and just sort
of have the essence of the code stand
out I'm saying if the JSON object
doesn't have an x and y of type integer
throw this exception and that's all it
kind of says now ok so that is pretty
much all i'm going to show you about c
sharp six there are more features they
have
same kind of flavor of little things but
hopefully your coat looks nice or after
you apply at them and then unless you
have some quick questions you want to
throw in there any quick questions yeah
i think that the saml binding i think
that doesn't completely work yet we're
working on it that's that's a place
where they they don't necessarily we
don't necessarily talk to each other at
the right point so that is where name
shows up in markup but now at least we
have the foundations in place to be able
to do it so hopefully that works the
rename refactoring is proud of visual
studio using things from Rosling okay
the other refactoring i showed you
before the other infections I've showed
you are completely there's a framework
that you can completely plug into where
all you have to write is language is to
like Gnostic it could be plugged into
other tools as well if they supported it
emacs could use a service service and
have refactorings in it yes so I mean
that's a promise at least right we don't
we had nobody's actually build it for
emacs I think yet well maybe they have
at the Omni sharp guys have built quite
a lot of this for quite a lot of
different editors you should really go
and visit the Omni sharp website if
you're interested I think there's a lot
a lot of room for improvement still but
it can definitely be done so i'm going
to move away from this toy example and i
am going to now change gear a little bit
and we should and we should implement
one of these analyzers together because
that gives us a chance to kind of look
at the rosslyn infrastructure and how it
works talk about how it works so what i
did here is I actually I went and
started a new project that's actually a
project template if you go and say new
project in visual studio and you install
the right extensions for it you can go
and click on extensibility
here once it wakes up there we are and I
can do a standalone code analysis tool
or I can do and analyze it with code fix
which is what I've done here I can build
a refactoring and it kind of comes with
some some pre-built sort of already
working code out of the box that does
something stupid but shows you how to
how to get started okay so I did that
already and I did clean it up and put
the right things in but I actually have
an empty implementation of the analyzer
right here so you see this method down
here is empty um so I this this method
here gets gets registered up here as one
of the actions that will analyze code
and it it sort of registers with some
kinds of syntax nodes that it wants to
get called with so whenever the tool
whenever you do an edit and the tool
analyzes the code and there are if
statements or else clauses in the code
this method will get called with an
object representation of that so that's
what we're going to go in them and and
cost to happen so when you when you
enter debug mode in one of these
projects that are meant to build
analyzers the way debug this actually it
launches visual studio in a nested
visual studio and installs the the
analyzer and cold fix into that it's a
it's a version that lives in its own
hive as we call it has its own settings
and so it can install it install its own
extensions so now I start a visual
studio from Visual Studio it's being
debugged from the outer visual studio
and I'm going to open a piece of just
sample code here to talk about the fix
we're going to build which is so one of
the ways that people are going to use
analyzers is to Rick use for style
guidelines right your company in your
company it's a sin and a crime to have
if statements or else clauses that
aren't and curlies where the body is
nina curley so we're going to we kind of
put a warning into to tell you please
put curlies around this and and so
that's one kind of analyzer that you
might want to consider I think the other
one possibly more important is the or
equally important is to wrap up
analyzers with ap is that you're
distributing that come along that know
about the api's and help
use the API is in the right way saying
you should not use a constructor in this
thing you should call the create method
or you should not this and use your not
that so that your guided to you with
fixes and everything to use the API in
the right way we call that code aware
libraries where the library comes with
its own guidance in shape of these
analyzers okay let's get going here we
want to figure out ok we're going to be
presented with some syntax notes in a
minute what are those syntax notes well
let's go and and open the rosslyn syntax
visualizer to have a bit of a look at
this code here so that's a little
helpful tool comes in as an extension
they can just download off the gallery
that you know when I click around in the
code I can see the tree structure of the
code and the properties of the nodes
there I know it's a little tiny here the
font but it says things like if keyword
and under the if keyword there's some
white space and here's the if statement
and and it kind of just you can kind of
navigate around the code and see what
you have there so we're definitely going
to be looking at if statements where the
expression inside of it the that sits
here where it has curlies in it which it
currently does not so why does it look
when it has curlies in it well let's try
and put some in and see how that how
that changes the tree over there I'm I
don't have that much screen real estate
here in this resolution but I'll do my
best let's put a curly around this and
we now see that a block appear so
apparently a thing with curlies around
is called a block so we essentially an
analyzer is going to look is there a
block in the if statement if not give a
squiggle okay and actually if you want
to get a the the full picture pun
intended we can go and view this as a
graph so here's here's that here's the
block for instance as the syntax graph
you can go and look in visual studio and
and that's how you learn about that you
can look at before and after and that's
how you learn about what is the
transformation I want to make what I
what are the patterns I'm going to look
for so now I've done that I'm ready to
go and start writing my analyzer but one
thing that's really annoying is that it
took some time to start up this nested
visual studio whenever I want to test
what I'm doing I don't want to wait for
it to start up any time so i'm going to
write my code while i'm in the debugger
it's what's called edit and continue
we've had it for many years in Visual
Studio it's always sucked completely
because they didn't know about new
language features and and so the word a
whole lot of edits you could actually do
that's been completely revamped now it
knows very many it knows how to do most
things that even make sense to compile
and keep running so what you're just
going to write the code while we while
we're actually executing it so I'm going
to put a breakpoint in this empty method
here and I'm going trigger going to
going to trigger a call to the node by
going back to my test here and doing an
edit so let's just put a space somewhere
there and now it's analyzing the code
because there was an edit and so it's on
my first if statement and it's going to
come in here we can see that the context
that was passed in it has a node which
is the syntax no time operating on and
that node is an if statement syntax so
that's good if we look in the if
statement itself has a has a lot of
stuff on it so you can learn all kinds
of things including all kinds of
nitty-gritty details but one thing it
does have is a statement that's the
nested statement decidedly if so that's
the one we want to look at okay but
remember we can get called by both with
both if statements and else clauses here
so let's write some code to distinguish
it so let's let's try to write the code
for if statement if statement is context
node that was the one that had the stuff
in it as if statement syntax and it
helps me complete here so now down here
I will now get a and if statement
variable as well you just can't see it
because oh you can't see yet because I
haven't executed it but let's go and
move the instruction pointer is right
over here let's move like that right
back up there and run again and now we
have an if statement as well down here
because we ran a little further in the
code now we're just going to see if that
if statement was actually null if
statement well if it's not null and
if it's if it's statement is not a block
and if statement statement that's a
method to help me ask that question is
kind of syntax kind dot block so if it's
not a block not then we should that's
when we should give it a squiggle that's
when we should warn that something's
wrong with your code right does that
make sense so we just writing code over
an object model here and what are we
going to do well the only thing we
really have to muck with is that context
there so hopefully it has something it
has a report diagnostic method what a
lucky thing how do we get a diagnostic
well let's ask it has to create method
good we need to pass in a descriptor I
cheated and put that already in code
above we need to decide where should
where should the location of the
squiggle be let's put a squiggle on the
if keyword right so just that little
keyword so it doesn't like span too much
code and maybe shadow other squiggles
that you want to see so why don't we
take the if statement and get its if is
if keyword and take the location of that
is there something with location yeah
that's a good location method let's do
that all right so now i created a a
diagnostic that was somewhat long maybe
we could take some of this and factor it
out with the refactoring let's do a
introduce low poll here so it guesses
that I'm looking for a location because
the method was called get location yeah
so that's a good name let's keep that
I'm doing all this editing while the
program is running so now let's go and
remove the the breakpoint drag the
instruction pointer up to where we were
oh I can't do that here did I do
something wrong I don't think I did
let's just try this right continue here
and I'm I'm back in my test program here
and you see that I get a squiggle on the
first if statement so it saw this did
not have a block and then I don't get a
squiggle on the next one because it did
have a block and that's just that's all
it takes now I've ridden all the logic
that it takes to now have the tool warn
me about something and then all we need
to do and I'm not going to do it here
live but all we need to do is to write a
fix that transforms the current code
into the into the future code and I'm
going to let's go look at that coat but
not write it because I don't want to
confuse you too much but you kind of get
the idea right it's just an object model
just poke around ask questions register
a little here and there and and you
quickly learn it and now you can
implement your company's style
guidelines if you want to pester your
co-workers with that or you can put
guidance on your API since I does that
make sense ok so I do want to say that
this API is is it's really supposed to
be complete and efficient and so we
built all our IDE on top of it there's
no secret handshake or special language
knowledge that our ID has that isn't
exposed to this API ok so that is that
is how we know that it's good enough for
for everyone to use we build our own
things on it we could also built the
else logic I don't want to probably bore
you with with copying it's going to be
pretty much the same but let's go and
actually I already so I said I already
implemented the fix so you can see here
it says if statements and else clause
that should use braces if i look at the
fix here it says add braces and it shows
the diff here so how did I get that diff
how did I get before version and an
after bersin well let's go look at that
so now i add braces it's going to add
them there and if i had implemented for
else it would also do that for the else
else classes ok so let's leave the
debugging now no I don't want my changes
and go and look at you can see there's a
diagnostic analyzer here that I just
built and that's a code fix provider
that
is where the fix is and there's some
boilerplate but essentially i'm writing
a function here that digs into the the
dicks into the tries to find out okay
all it knows is where am I I have a
diagnostic which diagnostic is it well
is that the one with that number and
what piece of code am I on from that
we're going to find out well okay okay
let's get the root of the syntax tree
for this document here for the one we're
viewing and that's a tool agnostic
version of the document concept let's
find the note that it is at the location
that we put in the diagnostic when we
put the squiggle let's find the syntax
note that's there and actually let's go
so that's the if keyword and let's go
find its parent which is the if
statement okay actually quick aside if
you have a immutable API that's based on
sharing of large parts of your sub tree
one of the things that you know is that
a sub so a subtree can't be it can be
part of multiple different trees at the
same time so it can't know what his
parent is it can't know what it's
location is that it represents in the
source code because it can be multiple
multiple ones of those and the magic to
be able to go to the parent anyway is
it's kind of part of the cool
architecture that's in here and i can
tell you after that's more sort of
algorithmic but um we go to the parent
we we create a variable for the new node
and then we go into the if statement or
the else Clause case here and because
this this is an immutable API so we have
to create a new a new world from the old
world we can't just mutate it so what we
do is we say if it was an if statement
let's say let's take the statement out
of the if statement create a block
around it and take that and replace
create a new if statement from the old
one where we replace the block for the
old thing that was there okay so that's
kind of the construct a new thing from
the old bits now we have a new if
statement that has a block with it the
original expression inside and then down
here we take the new node
we go to the root and we say replace the
old node with the new node we go to the
document and says we played the old
replace the old rude with the new rude
and then we return that new document so
what we did was create a new data
structure from an old one that's all we
did and then the whole infrastructure
will compute the diff between the two
and present the nice preview and all
that based on that computation we did
here so that's kind of getting into the
immutable programming style that we're
very fond of and why is it good that
it's immutable well first of all we're
handing these trees out to all kinds of
people who plug in and we don't want
them to mess them up and we don't want
to have shared mutable state or
something we don't what people to be
able to muck with the model they can
build their own but they can't muck with
the existing one and but also in order
to achieve part of the efficiency of
also the batch compile being able to
paralyze a lot across you know compiling
different parts of the program becomes a
lot easier when all the data structures
involved are actually immutable there's
no risk you don't have to lock anything
right you just take a snap snap shot of
the universe you compile add something
changes or whatever it's not your
problem those are just other universes
but you're compiling this one okay so
immutable has turned out really well for
us it's been a it's been hard to
optimize it to where it competes with a
C++ program using mutable structures
which is what we had before but it's
been worth it like once you get to a
couple of course we're a sufficient we
get faster okay more on batch compile
because of this ability to parallel eyes
okay that is probably what I wanted to
show so before I go and talk a little
about the future the next installment of
C sharp and so on I want to ask if there
any questions you have any submitted yep
the new note assignment oh you notice a
local variable that I declared further
up let's see where is it right here so
I'm just saying if I mean if case assign
the new you know transform the if node
if I'm in the else case transform the
else node in either case it's going to
hold the new syntax node the new if or
else clause and then the rest of the
code is just shared to wire it into its
right place in a new tree right it's not
obvious that they are wow you guys are
going to go do this right after the talk
huh yeah um Oh would we have a constant
well constant meeting read-only um it
well well this this one is meant to be
read only actually this one this one is
mutated later but but yeah we could have
we can certainly add we could have bar
and Val in the language and that's one
of the many many proposals that's there
for the next version of the language
yeah we if we don't have a notion of
read only locals or parameters right now
if we did we already have a read-only
keyword we would probably let you put
the read-only keyword and everything and
then in the case where it's read-only
bar we would let you abbreviate that to
bail how about that it will be one way
to approach it pull request yeah great
there are definitely things that where
we need to catch up any other questions
i'm sort of the whole whole idea here so
again they the idea here is this code is
the code that backs all this stuff the
whole rustling api is written in C sharp
so it's going to run on all the places
where net is going to run now and
and the whole infrastructure should be
pluggable into all I des as long as they
have the right sort of you I hooks and
the right extensibility make the right
infrastructure to hook that up
underneath right Charles oh you mean
like a recursive loop or I'm not sure I
I'm sure you get the question okay let's
do the offline okay I want to talk a
little bit about C sharp 7 so to do that
let's go let's go to github I'm going to
do it in Chrome okay chrome chrome is
better with github um so you can laugh
you are your sniggering I can hear it
well just wait until edge comes out so
all the stuff is up on github right and
we if you want to learn more about the
language features you go click here and
there on the readme page and here's the
list of well okay internet in here not
so fast I luckily pulled it up before um
you can go look at then that's an
overview here of all the language
features that went into C sharp and vb
this time around C sharp six we be 14 I
believe and if you want to double click
on that that's like a document about all
the new languages here so if you're
interested in digging in more just start
there if you go to the issues and github
here is your issues sorted by or
filtered by labels
area language design and feature request
so these are proposals that people some
of them are from my team some of them
are other people have put up with new
language features and I don't know why
this only 10 open there and one closed
this is definitely not the search i was
looking all right I you search for
something I that's more that's about 130
I'm i filtered it too too hard at some
point here um so there's definitely
proposals and discussions our our c
sharp design process involves meeting
once or twice a week and and and
processing some of the proposals and
having thoughts about them and then i
write up long notes and i instead of
sending those around just within the
team i put those up and get up okay so
they're here to sign notes we started
designing c sharp well we consume it to
how cool is that I love chrome there we
started in January and that's already
all this stuff up here and so if you
really interested go see what we
discussed in particular this I recently
put up sort of an overview of the
features we've looked at so far and what
we thought about them so if I click on
that you know there'll be a list here of
some things that we rejected some things
that we haven't really decided on yet
some things that we think really have
legs so I'm here you'll see things like
tuples pattern matching records or
algebraic data types null ability
tracking the ability to have the type
system help with where the reference
references are null and not a sixth
reams maybe some of you saw the talk
earlier today about about reactive
programming definitely I mean we a lot
of the problems in that talk we're not
really problems of human c-sharp I'm
gonna say on modestly there was they
were Java because Jabba doesn't have a
sink but we only have support for single
asynchronous results and having support
for streams as well in language would
probably be a good next step so we're
considering that as well and then there
are several things here all of these are
juicy things it's just like deciding
what to go for and what not and our team
is still finishing up there
building the previous version so we're
still just playing with ideas will start
soon hopefully be able to put some
prototypes together maybe some people in
community will also prototype language
features and and just have an
environment where people can try out
well how does this version feel like and
very sort of just hacked up rough
prototypes and and get feedback on that
so some of the some of the features that
um that we considered there I do have
slides for which I accidentally showed
you before so let's go and look at two
bulls for instance the thing that we're
thinking about four tuples is that the
core problem to solve with tuples is
having multiple results out of out of
functions out of methods and so we would
have a syntax that's very similar to
parameter lists it's just going the
other way and that means two bulls would
have that would have types for each
component but they were also have names
and you can use those names if you want
to at the consumption side to get at to
know okay I got three ends which one is
the summon which one is the count and
which one is the to know what you're
getting back and to be able to access
them through that we would have to bow
construction and probably deconstruction
as well so kind of standard stuff but
would be very useful to have in in
c-sharp I'm kind of fit in nicely think
syntactically it doesn't really stick
out too much one of the more crazy
things that I'm still eager to see if we
can land is after having had six
versions of the language where you
cannot distinguish in any way between
references to objects that can be null
and once the can't can we go and
retrofit that in in a natural way into
the language and get some benefit from
it and saying okay first and last name
have to be there string is nullable so
it doesn't have to so if i dot into them
it's fine to dot into the not so na
level ones but it's not fine to dot into
the one as novel you have to check for
now first okay so that's one kind of
warning that you want to get to find
bugs in your code the other one the
other direction you would do things like
making sure that the the things that are
none nullable actually get initialized
to an unknown value that you don't
just leave them hanging with a default
value of know the problem internet is
everything can be null everywhere every
reference can be null and we can't go
fix that retro actively if we try that
ambition will just fail but what we can
do is we can express intent and we can
give you guidance and bugs or warnings
wherever you are going against the
expressed intent that we can probably do
and so if that's our level of ambition
maybe we can help tony hoare you know
old theoretical computer scientist he
always said and that's a theoretical
said null pointers were my
billion-dollar mistake and so our
ambition is to get him back probably
about half of that billion like it would
they totally eradicate the problem like
some languages do but it would be
definitely better so that's all I have
to show and I share and I think we're
probably out of time it took some
questions along the way is what do you
say we are we done we are any any last
questions okay immutable what sorry yes
I'll tell you after I'll tell you
offline now that's a good it's a good
comunicando sation topic for the party
tonight if you don't know what to talk
about you know just ask me about that
okay thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>