<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Maximising Side Effects When Adopting Functional Programming • Dan Macklin | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Maximising Side Effects When Adopting Functional Programming • Dan Macklin - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Maximising Side Effects When Adopting Functional Programming • Dan Macklin</b></h2><h5 class="post__date">2016-06-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7nr41jCWAF8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello thank you very much firstly it's a
honor to be here and talk to you today
and please if you if you like to talk
the green button is the nicest and
easiest one to press on the application
so so today are I'm going to talk to you
about bet365 adoption or functional
programming and Erlang and when I was
asked to come up with title for a talk I
kind of thought to myself maximizing
side effects for those who've done a bit
of functional programming might be might
be a bit of a a good idea may live to
regret that as we go through here but
we'll see how it how it goes so to start
with I thought I'd give you a little bit
of a background about a history of
bet365 we were founded in stoke-on-trent
in the year 2000 we're privately owned
company and we still are privately owned
right from the start and the graph is
basically to talk about dramatic growth
in the year 2000 we turned over no
pounds at all in 2003 we got up to 370
million pounds worth of turnover last
year we were 34 billion pounds worth of
turnover so so basically the growth
inside the company has been being pretty
you know pretty exponential it's been a
been a very interesting place to work we
currently have three thousand plus
employees in stoke-on-trent which is
north of Birmingham self of Manchester
it's the old potteries area of the UK
werewolves a porcelain was that was made
we spend around about 60 million pounds
a year on our IT budget we are
pathological about doing absolutely
everything ourselves so we run our own
data centers we right around software we
have an ethos that if something's going
to break we want full control of it and
we want to be able to learn from our
mistakes at peak we get around about 2.5
million concurrent kind of customers I
got a customer base of around about 19
million gambling is a is a very
interesting industry in the respect that
everything is really really peaky
so you can imagine the world cup final
last year the kind of loads that we're
going for our system when all those
girls started started going in finally
and we're still growing the numbers just
from this year alone are still quite
interesting and I'm sure share them at
at some point in the future so sticking
with a space-themed what does it feel
like to work inside of a a company like
that well my honest answer is quite
intense because you have to do a mixture
of two things the first thing you have
to do is you have to build features that
engage and excite your customers and
you've got to keep on doing that to get
traction with and keep customers coming
back the second thing is is is that
every week you have to rescale your
systems because you know last week's was
last week and the next week you've
suddenly you know doubled up and the
number of bets that you'll be going
through your system and so it's sir it's
one hell of a ride you're kind of
constantly doing new stuff but you're
looking back over your shoulder to make
sure the old stuff scales at the at the
same time so a lot of people ask me you
know how why have you come across a
business that has managed to a kind of
out scale of a competition you know what
is the what's the secret sauce what's
the key fundaments of what we we do and
in answer to that I'd say it largely
comes down to two culture you know we
take on really hard problems the owner
of our company her personal belief is is
is that you know nine times out of ten
people don't really like doing the
really really hardest things so if we
focus on doing those really really hard
things then naturally will be better
than the competition and so we go out of
our way to do the hard things we try to
innovate as much as possible so in an
online gambling we were the first
company to put live Odds in television
adverts we basically were the first
people to move to in play betting which
is basically betting on the sporting
events as they're actually happening
rather than on the end result and we
were the first company to actually start
pushing our data to our customers rather
than them kind of pulling it across
different platforms and another key
thing is is that we have great desire to
be the best and i think that second to
last point there was one of the ones
that
that makes me you know happy to work at
the company is that a lot of companies
will water things down when the going
gets tough so if we say that our latency
is going to be two seconds and we do a
whole load of development work of two
seconds to get in the odds out and it
looks like we're not going to hit that a
lot of companies will go 30 seconds
that's all right we know we'll live with
that we don't we just try and try and
try and try to get that customer
experiences as good as it possibly can
be and because we're private company we
can you know allocate capital and
resources really really well if there's
a big problem to be solved we'll put the
money in we'll put the resources into a
to physically actually get that so you
know if as I think it's that culture
which has enabled us to become I believe
we're the biggest online betting site or
sports betting site in the world and I
think we would take more online bets
than all of our competitors combined
well it's the three main big ones so how
did we get there if if I was to describe
our historical text stack I'd say it's a
bit like fish and chips really in that
you know it was quite tasty but just
like a good fish and chip shop in the UK
it's about mass-market appeal and just
like with all the burners has proven
delivery models for the technology so
that keeps the project managers happy it
was very traditional and you know we use
to solve problems in a pragmatic way you
know we want to keep things as simple as
they possibly can be and we want good
solid solutions because of a dynamic
nature of online gambling and the need
to to get features out to our customers
and to scale quickly we were focused
around rapid delivery so we tried not to
do anything too clever so to speak
because we wanted to be able to be very
incremental and we wanted to be able to
get the features out quickly we
basically use a few ingredients so our
old texts at was mostly net with some
java middleware and lots and lots and
lots of sequel server we had a huge
monolithic sequel server database with
lots of store procedures inside of it
but saying that it doesn't sound that
funky but you can build a multi-billion
pound turnover business using those
those technologies so but
with growth you know we found out
identify if anyones begin to determinate
in movies but but that's the Terminator
scene farewell you know there's a storm
coming so to speak of everything from
the outside look really Rosie there were
some large problems on the horizon the
first one is that productivity was
declining for a couple of features some
of our customers some are competitors
sorry started to to get there first it
was taking more and more effort to get
code out the door and for company like
us that is an absolutely huge problem
because we'd always read from lead from
the front and set the agenda and the
management team have very high
expectations about customer engagement
and growth and you know how happy our
customers are and online gambling is
fiercely competitive there's nothing
really stopping people other than a
couple of ID checks to move into another
supplier if you're upset and we want to
keep hold of over our customers the
second problem was that our systems were
becoming unreliable basically the
complexity of our our code and the way
that we're writing our software
basically meant that we have to get more
and more scalability hacks inside of our
software to make things things work you
know at the peak event at the peak time
in a sporting match at football like
five o'clock on that on a Saturday you
don't really want any downtime downtime
at that point in time costs lots of
money but also cost you in reputation
because some of our customer sees us
almost financial transactions and so if
they want to be able to put a bet on and
your site is unavailable then you know
they will be very very angry on on kind
of Twitter one of the reasons i already
said was that our Cobras becoming overly
complex due to scalability hacks scaling
software is in a multi-threaded
environment is it is a really really
difficult thing and one of the things
that we like about our software is that
gambling is quite complicated there were
lots of different rules and those rules
themselves are quite hard to implement
but what you want to be able to do when
you look at a bit of code is you want to
be able to see what the business logic
is and our business logic was getting
clouded by lots of concurrency
scalability hacks so you had two
problems no one really understood why it
scaled anymore
and no one really understood how the
business logic worked all they were
confronted with was was a mess about the
same time as well you know there was a
significant change in in computing
previously we used to scale vertically
and so what we do is is that obviously
we're relatively cash which we wished
get a whole new load customers we'd go
to you know the owner of the company say
can we have n number of new servers so
to speak or can we replace the service
with a faster clock great server and you
know we'd going by and away we would go
we never really you know towards
probably the last three or four years or
so had to make that many scalability
hacks we would scale out and by spending
money this was a monumental change for
us it basically meant that we had to
look at a different kind of compute
model fundamentally our software had
reached its limits I've been if that's a
metaphor for how we were building
software that is it I'm reliable and
that's the whale shark and that is the
biggest fish that you can you can
possibly get everything in nature has
limits we had started to started to hit
ours so we needed to wear to reinvent
I'm a massive fan of Madonna most of our
project names have stupid stupid names
associated with songs or different movie
trivia or stuff like that but Madonna
she does look really really well in that
she's able to track the market and she
knows when the right time to reinvent is
one of my favorite books I won't
recommend reading all of its it gets
into kind of mergers and acquisitions
after a while is a book called break
from the pack and what it basically the
premises is is that we live in a copycat
world and someone will move and then the
rest of a pack follow and there's
someone will move and the rest of the
pack will follow and you've got people
who are slightly in front of a pack and
you've got people who kind of trail back
and really really far behind pack and
always struggling to catch up well what
we want to be able to do and what
Madonna does really very well is that
she's constantly able to break well away
from the pack and do stuff but the
competitor other artists and stuff like
that can only just imagine and so by
doing that she reinvents herself and
this is effectively what we needed to
needed to do we need to really raise the
bar we wanted to not just be better
dinar cast of our competitors but we
wanted to be all do a magnitude better
we wanted to kind of take a massive leap
into the unknown we wanted to really go
out there and we wanted to create a
platform whereby we made some really
radical changes so we could get back to
doing the good incremental stuff again
to to keep our customers happy going
back to a fish analogy we wanted to wear
to ditch the whale shark and we wanted
to become I don't know what kind of fish
they are actually which is a bit
embarrassing google image search didn't
tell me to do that we wanted to create a
culture where it was ok to take really
big technical risks everyone you know in
well I say everyone lots of people are
scared of failure and we wanted to
create an environment whereby it was ok
to fail because if you're going to try
and do something big it's never going to
work first time we wanted to experiment
so we wanted to basically try lots of
different things we want to try and get
a hands dirty wanted to see what was
working what wasn't working and where
some of the pitfalls and and and
problems and benefits would be we wanted
to get our hands get hands on and try
lots of stuff but most importantly we
wanted to place where i have lots of
conversations with software engineers
and it's all we think this and we think
that and you know and the great
conversations and they're brilliant for
building a springboard to actually start
coming up for ideas but what you really
want to know is is that you want to be
able to speak from experience you want
to know that in my world it's sometimes
just as good to be able to prove that
something is definitely a bad idea then
it is to actually prove it it sir it's a
good idea because ultimately we just
reduces the size of the search space
when you're trying to solve a problem so
again not all companies would probably
be able to do this but because we're
privately funded and we've got good
applicant applicator we can apply our
capital well to to solving problems we
decided to wear to set up an R&amp;amp;D team
and one of the reasons for that is the
culture bet365 is very delivery focused
and so everything has to have a time
scale and our senior management realized
that solve some of these problems you
know you're not going to be able to say
it's going to be delivered on the first
of January going back to a little bit
for us time scales are
really important because no one will
change the date of a sporting event for
us so if we've got to get some software
out for the grand national or we've got
to get it out for the World Cup you know
we can't kind of ring up various
efficiently how can you knock it back a
week for us so so our culture of
deadlines actually is based in something
in that was there's lots of unmovable
events out there but for this purpose we
wanted to try and take time scales out
so we started recruiting people and the
main thing we were looking for was
curious people who were free thinking
and we got people from various
backgrounds we got some people had been
doing computer science we got someone
who'd done a PhD in watching paint dry
he's fascinating guy and he enjoyed that
PhD be a lot but then decided that
software engineering was a was it on it
he did he did his entire PhD in putting
white paint on boards in the Sun and
seeing how it degraded we took ourselves
outside the day-to-day software
development concerns as I said we're
looking for flexible and entrepreneurial
people i think entrepreneurialism in
software development is a massively
underutilized thing you want people to
try try stuff and do rather than rather
than think too much we wanted people who
are not scared of big problems and but
this was a key thing we were well
resourced so you know we could go off
and buy servers and experiment and this
kind of stuff but good sponsorship and
good sponsorship is something I'll
probably go on a little bit about later
in the talk so going back to the space
theme what was the mission of the R&amp;amp;D
team so our job was to explore pharmacy
methodologies seek out novel technology
and languages and to pragmatically go
where no one has gone at bet365 before
now you might say well why have you got
the word pragmatic in there and the main
answer is is is that we're not a blue
sky research and development team we're
not trying to find the latest or
greatest way to create in the new
software-defined Network what we're
trying to do is we try to we architect
our platform and given the company that
we are no matter what we did ultimately
had to be pragmatic had to be relatively
real world you know we could go out
there but we had to be able to get
software developers developing stuff and
getting product out the door you know
pretty quickly so going back to the time
you know what's the link to were to
functional programming in
in all of this and so the answer is it's
like you know going back to that shoal
of fish to achieve our aims we would
need to start writing distributed
systems and this is challenging because
distributed systems can very quickly get
very very complicated and we needed a
way to express these difficult things as
simply as possible and we kind of
stumbled across Earl angrily with its
functional heritage and we thought it
might offer some answers and I'll go
into that and a bit more depth later and
we thought okay well if you know in the
telecoms industry if they've been
solving these kind of scalability and
distributed systems problems for a long
time maybe we should stand on the
shoulder of giants but if you really
asked me why we started looking at
functional programming and Erlang it's
that in order to attempt to solve these
really difficult problems we wanted to
really strong fundamental foundations
and you know the rest of my talk is
really you know kind of describing about
how we found those foundations and how
we went on to verify them so i thought
i'd give you a quick overview of a ver
lang so we're Erlang i was designed for
high concurrent fault tolerant systems
it's not new so everyone kind of thinks
hi we're searching developed team
they're gonna be looking for all the new
stuff well no you know we spend a lot of
time looking back because maybe sound a
bit cynical but it's not really that
many new ideas in computer science
there's just lots of old good ideas that
didn't get the marketing hype over buzz
and didn't make it into the mainstream
so as much as we you know we look at the
latest a new stuff of which the stuff
out there you know you want to look back
for your history and I like going to
conferences like this and this one's
most of you know about NASA in the
keynotes but sometimes you go to like
code measure some like that and they're
talking about you know the pioneers of
computing and some of the problems that
they they solved so you know one piece
of advice is don't always look for the
new stuff look back to the old stuff and
see how it can that can be reapplied
anyway Ericsson had some really
interesting problems in that they
developed telephone switches and in the
days before the internet if you think of
the concurrency and reliability and
uptime requirements of a telephone
switch and you play that on to today's
modern web environment you can see that
the two are relatively relatively in
parallel with
each other I'll go on about this a lot
later on as well but erland is greater
than the sum of its parts it's got many
different features that work well
together so to start with its soft
real-time basically the way Erlang
virtual machines work is that you put on
a 30 core computer and if you were if
you set it up right it will start at 30
schedulers and it will basically break
the task down into little jobs and it
will give each job a time slice on each
of the schedulers on each of the
processors it's got this concept called
lightweight processes so in Erlang it's
perfectly okay to spin up a million
processes or half a million processes
basically because each processes are
very small independent heat and it's got
this and it takes a bit of time to get
your head round it it's got this let it
crash kind of kind of error recovery
mode and what the feeling behind that is
is that everyone in computing is always
kind of paranoid about how they deal
with errors or they like to put a
try-catch around them and lug them to
wear to some various file system now
what you want to be able to do is you
want to be able to build systems that if
they have a failure in only one part or
one process and remember us talking
about systems where those millions of
processes floating around fails the
software or the virtual machine realized
that it's failed and automatically
restarts it and so one of the really
cool things about Erlang is is that it's
quite hard to completely an ugly kill a
machine it can be done but it normally
is it's quite hard and it leads to a
less defensive coding style whereby you
know you get something out there you see
why it crashes and then you modify it
rather than upfront trying to worry
about every single ever scenario that
ever will be and writing some really
complicated software this is giving you
the safety to say my software will have
errors it will have bugs problems will
happen but I'm pretty confident it's not
going to wipe out my entire system the
actor model so all these processes are
spun up inside of Erlang they will
supervise so if they crash they gay they
restart and the way that programming is
done or concurrency done is that each of
these processes send immutable messages
to each other so effectively you can
think of and writing the code inside of
each process is writing lots of single
Freddy programs that communicate via
message passing and because the pros
so lightweight and you've distributed
your processing over so many processes
garbage collection apart from binary
references which everyone kind of goes
on about a lot is normally fairly
straightforward because the art of
programming an earlier use to have lots
of short-lived processes so what happens
is is that you spin a process up it does
something as in calculates the value of
a bet or something it passes that
message on and it dies ergo there's your
garbage collection you just had a short
lift process it's done something done
something interesting died you know you
don't get along GC pause another really
cool thing about Erlang is OTP so OTP
stands for the open telecom platform and
what that is is a series of libraries
which come bundled with Erlang that
fundamentally our design patterns for
some of the main kind of concurrent
concurrency problems you might solve so
you've got things like gin fsm which
allows you to implement finite state
machines you've got things like gin
servers which basically allow you to
write reliable processes and effectively
it it basically means that you've got a
trusted mechanism or trusted design
pattern upon which to build a lot of
your code and if you follow them a lot
of your code looks the same and you know
when you try to get new developers to
understand the system or get people
involved in a project or if you want
develop a mobility to be able to look at
different projects and stuff like that
keeping your code looking kind of a same
whilst on the face of it might sound
boring has tremendous business benefits
finally a hot code upgrade and of course
you know an Angus based on unfunctional
programming so what was so special about
functional programming well when you do
functional programming a computation is
the result of evaluating functions
preferably really small functions in my
belief every function should just do one
thing well an output should only depend
on the inputs so side effects and I know
I'm going to be talk about side effects
that should be eliminated as much as
possible now you can't really write too
many practical programs without the
occasional side effects but for your
core business logic you want to try to
write as many small testable functions
as you possibly can immutability and
further for people like me from a Java
background you know once you've assigned
a variable you can't change it
again you kind of sound a bit
self-limiting but once you get your head
round it and you learn how to program
more recursively it you know it makes
perfect sense but we started to look at
you know our functional code base was we
were building and prototyping and
hopefully a functional code should be
inherently simple easy to understand and
test the one kind of thing with Orlando
it puts a lot of people office the
syntax takes a bit of time to get your
head round and when I go for the journey
of how we actually started get some of
our developers involved in that you'll
see see why that that is however
fundamentally I believe that functional
program would be a good thing for bet365
because complex system should be
designed in the small and I think that
this very much matches the ethos of
functional programming however there is
nothing in functional programming that
makes you follow these rules I've seen
just as much badly written functional
code as I've seen on any kind of code
and really you know if I really put my
heart on a sleeve I'd say that it's more
about our ethos or people's definition
what complexity is that actually maps
onto how simple your code is rather than
any you know programming language of
stuff like that programming language
like Earl angle getting into functional
programming will make you think about
the world in a different way and will
hopefully make you or help you to write
better code in in any language at least
that's that's what I think so we've done
a fair bit of research and theoretically
we decided that functional programming
would make it easier to build these
reliable distributed swarming shoals of
fish like systems that we we wanted to
build so how did we go about proving it
because we needed to start trying to do
some stuff in the the real world and
I've kind of simplified this a bit
because I could talk about this for four
hours we kind of went through three
stages of adoption so the first stage of
adoption right at the beginning was when
we first started to look at Erlang and
and we basically just wanted to know if
Erlang functional programming are these
these kind of kind of good ideas so
you've got a fine starting point and
this can be an incredibly chaotic kind
of process because you've got all this
code you've got these new languages
you've got these new things you want to
try
where do you start how do you how do you
attack this problem there isn't a
requirements document isn't a
specification you just sort of know
vaguely you want to make things better
you've got all these problems are and
it's going to be really kind of chaotic
and google images when i put in chaos
that's the case quite beautiful actually
so one of the things i would say if you
want to get inside of R&amp;amp;D inside of a
company's stuff at like you know be
embrace chaos because chaos is actually
actually a good thing and it's trying to
plot your way through that myriad of
different possibilities and stuff at
that to get your starting point so after
a whole load of chaos we actually came
up with a relatively simple methodology
after we were running around a lot so
the first thing that we we did after
kind of learning to program in Erlang
and worrying a lot was that we found a
well-defined project so we found a
well-defined project that seemed to suit
what this languages or what does
paradigm was about and we had a clear
definition of success so what we did was
is that we wanted to to get something
where we could apply something new we
could compare it to what had gone before
and we could measure the differences in
terms of what it was like to develop
with how many lines of code failure and
for as ultimately performance and
horizontal scalability we made sure that
we had really good sponsorship so so my
reporting chain is is that base type
report directly to the CEO a CEO of
Hillside technology is kind of our CTO
and I've got the head of software
development and you've got to make sure
that the people above you are kind of
bought into what you're doing and
understand the risks and the benefits
you've got to really kind of communicate
with them because sometimes as much as
you you're going to need their their
support God keep things really simple
you know go back to my you can a whole
philosophy of software is keep it simple
but you know really when you're trying
to let you you want to keep as simple as
you possibly can and you want to measure
absolutely everything that matters and
if you don't know what matters measure
everything and you want to measure the
kind of quality of the numbers you know
sort of quantitative the numbers how
fast it goes hand your lines of code how
many failures how much memory it's using
yadda yadda all that kind of stuff but
you also want to measure what it feels
like to actually do
because if you're in a high-pressure
environment which about getting stuff
out you want people to be happy doing
what they're doing and you want them to
we get into the flow so to speak so it's
just as important for us to try and find
something that was fun that it kind of
infused people that you know motivated
them as it was to build something that
that physically scaled well well a lot
of our problems were to do with
performance so you know run repeated
performance tests throughout the entire
process so we do things like replay
testing so we all capture eons and eons
and lots and lots of our data will earn
amin eyes it and then we will pass it
back through our our test systems to
constantly you know run our production
load through it and then we've scale it
up two three four five boom times so to
speak so we really get to to learn what
something breaks and another key thing
that we found was that a lot of our
current systems already had measurement
systems in place metrics and stuff like
that so we use them so in your first
prototype you can kind of you know
compare apples with apples because it's
a much easier discussion to have with
people if you're both talking about
bananas rather than if one of you is
talking about a tangerine so when you're
doing something new as well you know
you've got to remember that you're doing
something you you've got to remember
that these things are going to take time
the classic thing is to try and build
something overly complex to start with
and I've mentioned this before what we
did for our POC that I'm going to get
into in a second it is that we got the
bear thing to work the initial
performance out of it was rubbish we did
it in the most rubbish way that we we
possibly can but then as soon as we got
something to work we iterated on it
really quickly to solve some of the
problems and no skipping a point here
but accidental complexity all too often
you kind of you think that there's a
problem and so you put something in
place to solve a problem that you don't
really have yet and all you're doing
there really should try to make that
initial hill that you're trying to push
the ball up to get going that little bit
higher we want to flip that on its head
we want to do the dumbest thing possible
measure it under production load and go
ah it's fallen over there I will fix
that problem fallen over there we'll fix
that problem I don't know if any of you
know of a guy called Garrett Smith he
said kind of talks a lot of the airline
conferences but one of the method
letís that we we follow through a
certain extent it comes from a talk that
he did three years ago it's called the
drunken stumble and basically what it
does is it takes off a development and
it says okay you've had one too many
beers you roughly know where home is so
you know a home is and that's your
vision that's where you want to get to
and the way that you solve your problems
is is that you stagger one step at a
time and if you stagger them away you
can always stagger back and kind of get
yourself out of it and by series of
staggers and staggers eventually you
kind of hit your goal and you know it
sort of works for us so we're we don't
really do the drinking part at part of
work so some details about the first
project now I said all our projects have
stupid names so the POC that we we did
is as I said earlier we were first
company to do in play push betting and
so we have a component called a
publisher which pushes messages from our
central systems out to hundreds of
thousands of connected customers at the
same time and from salt and pepper push
it push it real good really the name was
born so it was a business critical
pub/sub system and its responsibility
was you know giving our data to our
customers at low latency now in online
gambling especially in play betting
latency is really really really
important because the markets move and
obviously we attach our odds to the
moving markets now if it takes over a
period of time for a person to be able
to see a betting opportunity and place
their bet on it if a market moves in the
background out of a certain range of
tolerance we can't accept that bet so we
really need things to get out to our
customers really really quickly the
publishers have an awful lot of data
flowing through them so on a busy
Saturday or you know champions we will
have like 3.5 million topics across all
different sports and we'll be pushing
more than it's about date now more than
a hundred thousand updates per second
but objectives of a POC is can we use
erlanger functional programming to solve
this problem how will an erlang system
perform in terms of performance and
availability because again uptime is
really really important to us and then
you know maybe what does a development
feel like as I said early it's really
important for us to build you know put
tools in there that people love using
so the results I'm going to label on
this too much Ellen worked really well
and given the nature of a publisher's
about passing messages is out to
hundreds of thousands people it was a in
hindsight was a bit of a no-brainer the
two of you know fairly well life L
matched to each other you know it's a
slightly different use case for whatsapp
because we're sending the same messages
to kind of everyone to a certain extent
but but but yeah Erlang was was good and
we managed to get the PFC running in a
couple of months so that was going from
a cold start not knowing any Erlang
really because we were from from diverse
teams we didn't really have an
understand the business problem so image
to bootstrap ourselves up and get
something working for months even our
first you know couple of prototypes
could handle way more load and way more
clients than the existing Java based
solution and we know by testing it and
injecting failure into our POC were able
to see that you know we could have
isolated failures on a per or group of
customer basis but the rest of a system
would start would carry on working the
code was smaller and it was simpler and
it was easy to understand you know we
really spent a lot of effort breaking
stuff down into small small functions
which were very easy to unit test and
you know you can basically the code red
like a story and to me that's one of the
things that I really got into us I'd
written a lot of Java written a lot of
you know 00 based systems and over time
the meaning of the code gets lost and it
becomes really hard to work out what's
going on and that can happen with her
long and it can happen with functional
programming but with the right
discipline I finally found something I
could go yeah look at that file its 100
lines long oh and that does that and
that does that and to me that was a real
breath of breath of fresh air so you
know we could her like we could learn
early on the job and enjoyed using it
the results look good you know what we
did was is that our R&amp;amp;D team were
working for a very small production dev
team who looked at this one product so
we handed it off to them and with their
support they moved it to a full erlanger
implementation which has played been out
there now for about two and a half years
or so that that part of the part of the
system and that part of handover because
it was us talking to a very small team
was actually relatively relatively
straightforward which gets me on to
stage two so
you know we can't with a good idea we've
written a POC we kind of worked out
there lang is a good thing it had a good
fit we'd played with it something had
worked what we need to do now was widen
involvement so we needed to do the the
first big sales pitch but actually that
last slide was a joke because you know
this when you're trying to get other
people involved and get people as
enthusiastic about something as as you
are you don't really want to say you
don't want them to buy you want them to
buy in and so we took her you know we
took a lot of time and we put a lot of
energy into how can we get people to
feel as enthusiastic and happy about
these these technologies as as we were
so for this one when you want to widen
involvement well they're picking a
problem that we knew about we decided to
choose a challenging new problem and we
asked the development teams to spec out
using the traditional tools and
technologies how they would would solve
a problem we didn't really ask him how
long it would would take but we kind of
said you know how would you go about
about doing it and then as the side or
on the side we put a POC to validate and
Earl and approach we have to formulate a
strategy to help with own teams take our
PC and deliver a production system and
we wrote extensive documentation around
the problem domain now you say that
swords was really really important
because this was a new problem so we
actually did more research in how to
solve the problem and what the problem
was rather than actually how to write
any code because what we wanted to do
for for this was is that we wanted to
make the problem very understandable so
that people weren't worrying about the
problem of the business problem so to
speak they spent a lot of air time
worrying about how to actually implement
it in erlend so we tried to split a
complicated problem into into two so
some of the things that we we found when
we're widening involvement you know it's
tempting to try and I really love this
you'll love it too so too so to speak
you know you can't force people to be
enthusiastic about stuff and it can be
really challenging to move people from
their comfort zone and yeah we had some
developers and I don't know you know in
the UK sometimes your career is more
defined by how many years you've been
using this particular technology for
rather than being someone who's willing
to like a carpenter has many tools I am
a Java programmer I am a dot net
programmer
and so people worry about their skills
and and they worry about the future
careers what would it look like on my CV
if I still have been doing for years
Erlang and I mean doing a whole Noda
java you know I searched and I don't
know what the website is here but in the
UK job surf and you search for airline
jobs and compare that to number of Java
jobs out there and you know it's like
orders of magnitude different and people
really worried about it and rightly so
you know this is people's livelihoods so
we needed to spend a lot of time
listening we needed to try and really
emphasize or emphasize never say that
word address concerns and be be positive
and having a listening culture being
able to work just like you know the talk
this morning being able to listen to
people's problems put yourself into
their shoes see it from their side and
try and change what you're doing is
something that we tried to spend spend
lots of time on but fundamentally
adoption requires people goes on a
journey and I deliberately had multiple
paths in there because everyone's
adoption journey when you're doing some
of this is completely different erlang
is not something that's easy to learn
and in order to really get it you've got
to understand how a number of different
concepts functional programming
lightweight processes let it crash all
this kind of stuff linked together it's
not the kind of thing can be one booking
oh yeah I get it and so you've got to
give people the space to go on that
journey you've got to have balance so
one of the things we took a lot of time
to given as well our corporate culture
was about delivery we try to give people
space to learn so we didn't push it in
people's faces we kind of said you know
this is Erlang we've had some really
good you know stuff with us we're here
to help but you go get your hands dirty
you play with it you know you tell us
what you think and then will you know
offer you our best practice guidance you
know we'll share what you've learned if
you find something that's really bad and
it's an insurmountable problem they will
listen and maybe Erlang isn't forever
for this project so one of the key
things we try to do was to give the team
space to learn but also be close enough
to step in and help when you know
problems arise the other thing is is
that you know in trying to get people to
move their comfort zone you can
guarantee that lots of mistakes will
happen and there will be some massive
bloopers inside there and you've got to
be able to have in your cultural DNA
get people to kind of cope with that
because you know you in this we were
doing everything completely differently
and you know as Albert Einstein said you
know you only only learn by making
mistakes you learn so much more by going
down the wrong path when you do the
right path and culturally you know we
try to get out there when we you know we
got top-level this is where sponsorship
is really important because without the
top-level sponsorship without them
understanding that there's going to be
some food bars in here you know you kind
of on to untie it into nothing and as
soon as someone gets criticized for
making a mistake then that's it
culturally bang everyone goes back to
well I'm just going to do it this way
you don't get fired for or in trouble
for for doing that so the problem we
chose with something called cash out so
cash out is attached quite interesting
and difficult problem what it allows you
to do is that it allows you to close out
your betting positions early so if
you're half way for a football match and
your team at Enlil up lucky you and you
can close that bit out early and we'll
give you a price for it and you can take
your winnings and then you can place
another bet if you also where you can
withdraw your money the flip side to
that is if your bet on the other side in
your ten kneel down and it's half time
we will give you a portion of your money
back so that you can kind of cut your
losses and run and it's some something
our customers absolutely absolutely love
so basically the problem was that for
many millions of open bets so you can
imagine on the bitties busy Saturday all
for football leagues going we have many
millions of open bets for any change in
any of those markets its associated with
them remember people can better many
things and multiples at the same time we
have to calculate a cash-out value and
at peak times the markets move really
quickly we've got to do miss low latency
we've got to support very complicated
business logic and aggregations and bet
types and the products got to flow
really nicely you know where it's going
to be a nice interesting usable usable
thing in some way it's kind of like an
embarrassingly parallel problem where
you've got lots of simple ish maps to do
and you can't think I'll get the
parallel ism but then I just not really
that good at doing maths and so it was a
judgment call really to user long as to
how fast can we do the mass versus how
parallel and how reliable can we build
the system
so what happened next arm indeed we put
a POC the initial performance looked
encouraging concurrently the development
teams built a a PFC our strategy really
was to help people understand the
benefits and we put significant effort
into getting everyone to fully
understand the problem as I said earlier
we documented the problem to death you
know adding the problem domain you know
what cashout was and what is object on
what we're trying to achieve and what
the customer experience was ours we gave
people space to learn we preferred lots
of presentations we made ourselves
available we try to get people hands-on
and we try to get people to start on
their learning journeys unfortunately
though initially in the wider
development teams Erlang was was
disliked and there was significant
resistance and so why was that was quite
puzzling hey we're trying to sell you an
exciting heaven or don't like that and
as I said earlier this is one of these
magic I kind of things I'd say learning
Erlang is a bit like a magic eye some
people like me well I can never get that
I just stare at it for a rat for hours
but it's about learning multiple things
and chide me focusing on something
slightly different and focus and focus
and try lots of different things and
eventually you get it and so you can't
really expect many people unless they're
exceptional to pick up Erlang like that
like doing a magic eye it takes a bit of
time of reasons for resistance this was
a really hard problem and it was a
problem potentially that would you know
it had quite a lot of business impact so
as it could make us or loses a lot of
money the whole domain was a huge
paradigm and language shift our
developers none of them really had done
any functional program at all but they
were really good at our coding and
despite the fact we're trying to give
people space to learn you know some of
our old culture of delivery kind of
snuck in there as well and people felt
that some of the learning with getting
in the way of delivering we had to use
our kind of top-level support to her to
get around that however strategically
despite the fact he was a bit
uncomfortable we believe this was the
right thing to do so we persevered with
being nice and positive and helping
people out and then a few leaks later
something interesting
started happening to some of the
developers have really really kind of
immersed themselves in and got their
hands dirty you could start seeing some
little shoots of light going and then
suddenly someone said hey it's a shark
you know how many do is a shock I hope
it's not who I was won't really worried
because i can't do these there'd be some
kind of really rude picture so i got
people who could to to verify i believe
it was a shark there please tell me if
it's if it's not so we got people
engaged and you know these puns are kind
of subtle and they began to appreciate
the subtle tea and they began to see
that complex concurrency problems could
be solved quite elegantly with a few
lines of code and they saw her it's let
it crash I just thought that was a
marketing kind of thing I don't really
appreciate what it means at a code level
just to kind of have the freedom to go
yeah it's going to go wrong will we
start itself and they realized they
could attack more challenging problems
and they began to see some of her
benefits and understand the rationale
for change as in why we were trying to
trying to do this some of them you know
kind of gotten over latitudes and they
really really started liking it and so
we were so infused by this apparent kind
of erlanger love in some areas that we
thought we were really happy we fought
the harvest is this is excellent um you
know some of our developers it was like
that scene in Titanic you know we had
grown men kind of i'm frank i can solve
any problem in the world this is this is
amazing and then we kind of ran into
some some problems the main problem was
is that got so Erlang over love that
people started to find solutions really
good solutions for the wrong problem
people kind of got a bit carried away we
had envisaged that when you take away
one source of complexity and you give
people something new and they really get
into it that they'll suddenly just you
know kind of go get maybe a bit too
enthusiastic and happy about it I'll
everybody kind of say it but in my view
of actually trying to make money out of
writing software that thing about good
solutions for the wrong problems is
absolutely key because you know that i
believe is where a lot of time and can
eating is is kind of wasted it comes
from a guy called John Caswell who
basically seemed to kind of visual
thinking and stuff like that but he
writes a lot of interesting papers about
how to actually find and define what the
real problem is or how to show
management and all senior people this is
where you really want to spend your time
and money so we've all been enthusiasm
we actually lost quite a bit of time and
your honor of the reasons why we went
into a language simplicity and we ended
up with quite a complex system but that
said we got a product out the door and
on the whole it work well our mistake
was we invested so much energy into
building lover leg that we didn't really
spend too much energy into working out
how to manage the the love that
physically actually happened but you
know it's about culture mistakes happen
this was actually a big mistake but you
know we learned from it and no one got
kind of you know put against the wall or
shouted or screamed and stuff like that
because right from the beginning we'd
sold to our management that this is a
big strategic massive change there's
going to be problems and they were just
happy to get something out the door we
found that a stove height we just needed
to maybe be a bit more chip more mature
and so we started thinking about how to
form a more mature relationship with
functional programming for some of the
some of the next project that that we
weren't so we've got our first two big
airline systems out the first one was in
in getting odds out to our customers the
second one was in this cash out problem
the next kind of stage that we went
through was okay where we've got certain
teams using how do we move to more
business as usual how do we for the
right problems make this the the tool
that that people people use so we got
our foundations so from those
foundations we were able then or we had
the confidence to actually do some
really really good research into enter
distributed systems and you know we
moved on too much more difficult
problems so because once you got the
bases covered and you're kind of going
well that was a really hard problem and
hey I kind of know how to solve that now
you know you can really do something
special and so there's a project our
European project called sink free I'd
recommend that that people take a take a
look
that they do lots of interesting
distribution systems work and they write
lots of meta programming languages about
where you need to synchronize to still
be deterministic but make systems at
scale we did lots and lots of work in
eventual consistency eventual
consistency in kind of a gambling kind
of context is is interesting and so we
did lots of research about how to
control and one thing if there's one
thing coming out this conference other
than functional programming another line
that I would recommend anyone to take a
look at its CR DTS they're from a guy
called Mark Shapiro effectively what it
means is that if you're able to write
algorithm where it is commutative as and
you can flip the order of operations
around associative and adam posen it
means that you can almost right systems
in the right context that do racing
repair in that you don't synchronize
upfront you allow data to flow for your
system and then hopefully as long as
your use case allows it within the time
that it takes for user to actually look
at that information the algorithm of CRT
algorithms will of kind of merged any
concurrent updates or any failed updates
together to make the data make sense and
so we've done lots and lots of research
on how can you write systems that scale
without lots of lots of coordination and
we would not have been able to do that
if we hadn't got our foundation sorted
now a number of these next generation
systems are now live I can't really talk
about them too much and we've got many
more of them in the pipeline and so by
going through this kind of process it
has been quite transformational inside
the business so going back to you know
what were the side effects of all this
stuff what the first one was we found
our solid foundations we found something
for some of the use cases that we have
we found something that we could just
that made difficult things relatively
relatively straightforward we open minds
and so by giving people space and by
trying to do something that was very
very different from what was gone before
we put people in a mindset where they
could experiment a bit more and we freed
people and we allowed them to imagine a
bit more you know we increase the
possibilities we I said look you know we
can do these really difficult things
we found that learning motivates a happy
workforce is a productive workforce is a
great place to work to work giving
people a learning challenge you know in
the right environment with the right
context really does motivate people you
know with not just you know adopted
erlang we've adopted a whole suite of
new tools relatively recently that was
something that was unheard of and so now
when we're faced with a problem where
I'm going well you've got done it you've
got Java oh and you've got Earl and now
we're now able to say okay well what
really is the right tool what is the
best way to solve this problem and we're
you know we're much more relaxed about
you know don't using different
technologies we've shown that we can
adopt new things we made it easy to
solve really hard problems and that's
key one we gained confidence week and if
it may be for my other sides in some
aspects we gained a bit too much
confidence but we gained confidence to
accept to attack some seriously
difficult problems learning functional
programming i think it's with
distributed systems as i said before are
hard you know and learning about
erlanger and learning about functional
programming and the way that they work
in the way that to use them effectively
I think is really good preparation for
anyone who's about to about start moving
into that field you know probably from
the financial bottom line we now have
much more available and responsive
systems that continue to keep our
customers happy we have a pipeline of
innovation so before we were just
scrambling to kind of keep up and I just
felt like a bit of a kind of like a
churn inside the company now I would you
know I would say that things are still
hard to work there and there's still a
lot of interesting stuff going on but we
feel now we have a pipeline of products
in a way of delivering them it's going
to be order of magnitude better than
what we believe our competition will
we'll put out and we have significantly
less downtime so at the beginning I kind
of promised about something about
maximizing the side effects so these are
my tips for maximizing side effects
getting the most out put the most side
effects for the effort of change that
you you put in first thing is you've got
to really make sure you have real
reasons to change sometimes you start
off on a journey and you're changing for
changes sake you know don't do that as
compelling and as nice and as cool as it
might be to to play with stuff from a
business perspective or getting the
support of your management
now that change to happen make sure if
you have real reasons and then validate
them because the world is dynamically
complex you want to go from A to B and
there's a five-week time lag the world
will change in that five weeks so
measure dynamic complexity validate that
the reasons why you're going to be
changing are there and then communicate
them all the time get people to
understand why you're changing people
want to know why because as much as we
like learning we also don't like
changing and it's a painful process and
you've got to move people into doing
that and well for me personally and for
a lot of our developers understanding
why is key sometimes the reasons why
you're doing stuff in a big project but
just completely lost half a complexity
debate we never really had the
complexity debate and by that I mean
talk to people about why their software
ends up being complex understand within
your context we organization what
complexity is have some examples of
different code that your team have all
across different teams have written get
different people to look at it and
explain why that is more complex
ultimately in a high-scale environment
you want mobility between teams you want
people to be able to move around they're
not going to have to do that easily if
people can understand the code you know
so have that debate get complexity out
there get it something that certain has
talked about involve people support them
coach them and mentor them so you know
that it's coaching really is its kind of
sitting in the background sometimes and
letting people come to their own
conclusions and asking the right
questions you know it's invaluable when
you're trying to move people in their
comfort zone you know you've got them
going to be like a good basketball coach
shook our nephew no doesn't say you
throw it like this they can't say what
does it feel like when you throw like
this and then they describe what it
feels like and by describing what the
process is they kind of get to
understand it a little bit more let it
be known that failure as a distinct
possibility and let it be known that
that is okay and that's really really
important and and then finally if you
actually do get it right first time
you've probably be doing it wrong and
you'll get some nasty surprise around
the around the corner that you didn't
didn't physically actually expect you
know if something is too easy when
you're making a big change you know it's
probably wrong you've got to recognize
that not everyone's going to be happy
you know I would say that you know we
had some real lovers of her leg we got
some
pretty much don't want to go anywhere
near bit still so it's not you know all
go go go but you got to go the extra
mile to get people on board make it fun
humor can go a long way adoption will
take time there will be difficult days
so you've gotta persevere be positive
and got to think for the long term so I
want to change personally I wish you had
tried this soon i think functional
programming makes you a better
programmer in every language different
paradigms it kind of messes with your
brain makes you more creative makes you
see problems from different viewpoints
we thought adoption would be an uphill
struggle if it's surprised at how much
some people loved it and as i keep
saying though some excellent solutions
to the wrong problems we could have done
a better job of explaining positive
long-term career implications of
functional programming my view it is is
that it's much better what a modern
programmer is is a pragmatic problem
solver rather than somebody's got X
number years experience in a certain
thing and conclusions there are many
side effects some way easier to mission
and others but from our perspective this
was a very worthwhile endeavor because
open the floodgates to a series of big
improvements and it gave us that space
now to go back to being a little bit
more incremental and feature driven and
it really did form the basis of our our
new platform but most importantly you
know we grew with people as part of this
project and we grew as teams and we grew
as an organization and that's what
people really want so my advice you know
if you've not really tried to do
functional programming and you have a
project that needs it and you have the
you know where is try it because you
know you is a journey and it does change
you and it does make you better and and
hopefully you know you'll uh you'll grow
and there we go Michael timer stopped so
I don't know how much time I got now
basically none but it was a great talk
thanks a lot damn thang
so thank you for rating the sessions
thank you for asking some of the
questions we only have time for two of
them merged into one okay so I'll just
ask them directly so one of the things
that came up in the questions was how
hard was it for you to find new
developers who know Erlang or did you
find others then even retrained and have
you lost any during Andrew it was tricky
yeah it was very hard to find people who
trained up in Erlang because you know is
quite a niche and especially stuff so I
would say that most of our programmers
are being retrained and they've
basically I were on the job getting
stuff done we've had very few people
actually leave and because there are a
number of kind of yukon unicorn
companies or suffer that who were using
these these different technologies and I
think that there is a vibrant job market
out there but I think people respect the
fact that we gave them the freedom and
the opportunity to learn this stuff and
so you know you got to trust people if
you're going to you know give out then
you know you tend to find that people
will that will give back so we've not
really had many people leave that one or
two but but on the whole yeah it's been
difficult a lot of time training but the
people we've changed seem to be staying
that's your question good so thanks a
lot please find them for extra questions
and hopefully see you for the next step
thank you thanks again</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>