<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Build, Ship and Run the Docker Way • Maxime Heckel | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Build, Ship and Run the Docker Way • Maxime Heckel - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Build, Ship and Run the Docker Way • Maxime Heckel</b></h2><h5 class="post__date">2016-03-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xRj9rYKV48k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I will talk about tudom so that's
great because not a lot of people know
about to them so I hope you will enjoy
that so first I'm going to present the
landscape of dockers product currently
how to room is really situated then just
talk about the key features before doing
a live demo so pray the demo God's
please and then talk about what's next
for to tomb because as we got acquired
things are gonna change a little bit but
for the better good and so so this is
the current state of Parker product so
we have the classic built rip run
schemes and so tudom is the cloud
solution for the run part so to room is
really a platform to run container super
easily and you have the equivalent which
is a four on Prem which is a talker
universal control plane that has been
introduced at taco come recently so
basically two products will do basically
the same thing in general with different
we have different waves of course the
one being a solution the other one being
an on-premise ocean so for concerning to
them so i was saying so it's a SAS and
we're currently in beta and we're aiming
to a two-hit GA as soon as possible for
beginning of 2016 we have a set of nos
on ocean so here I just defined what is
a node a node cluster so basically node
is just a machine that you bring a to
them because that to them you bring your
own machines you bring your AWS
instances your digital ocean it senses
and then we will take care of the
plumbing and everything so that's a note
and you can build a set of nodes which
is a node cluster then add to them we
have this notion of services so that's
important for the rest for especially
for the demo and that our set of
containers basically so we scale
services by adding up containers and the
same for
stacks stacks basically our Tucker
Campos files but a little bit different
going to show you after that yeah so as
I was saying so you can provision from
different hosts providers like AWS
softlayer Escher and you can also bring
your own machine so if you have like
you're in a company that has its own
data center of all machines you can just
bring them onto them really easily like
just copy paste the script and just
works one of our main feature is that we
also allow to build and test
repositories on any kind of registry
whether it's a private one whether it's
the darker one we help you to just test
using a simple compose file so with a
yellow syntax really familiar from
comparing to other tools and the
difference with the build that the hub
has done is that the bill will happen on
one on your note so it will not happen
in a built form like you like it does on
the docker hub so basically well you can
specifically add a note with the
configuration you want just to build
docker images with a single git push
really really handy otherwise we have
another set of services that we provide
all the plumbing basically like DNS
based service discovery a overlay
Network we're currently still not using
docker network that has been released
but we are working on it so we have our
own custom overlay Network and we also
do also we deploy and push the basically
what will happen is that once we detect
a push through github or a merge of
thing through a pull request or whatever
we're going to detect that event and
we're going to redeploy your service by
removing one by one all the containers
that were inside that service and
launching them again but with the new
definition of the image that has been
built on your own machines so that's
what I will show you for the demo so
let's hope everything works today
so I have a so I have a little
application that for the ones who went a
darker con you might seen it it's a
voting application when you can vote
between two solution and see the result
in another app so basically we have we
have a darker compost file that is
classic that most of you are probably
using already but today I'm going to
deploy that onto them easily in a matter
of seconds I mean minutes because we
need to build but still it's going to be
really really easy so first if I just
build the app to show you so classic
darker compose up and now if i refresh
my daugher machine so yeah we have the
app here and we have the up here as well
so it's a simple voting up its really
really easy really easy simple app trick
let's now take a look at to them so so
here you can see the note dashboard so
basically it's where you manage your
machines you can simply launch a new
node cluster from any provider or as I
was saying before bring your notes so
bring your own machine and bring your
machine it's just copying pasting that
simple script and it will be like
launching a classic note and I already
have several notes so I have one called
builder I call it builder because up to
them if you call the note builder all
the bills will occur on that note only
if you don't call a note builder they
will just up here under the note that
has the lowest number of containers but
I want the bill to appear on that note
also i have several nodes in production
and i want a node and staging and today
i'm going to put that app in staging and
do some changes and show you how the
redeploy works so you have also the
repository section that says that's
where i well I register my app so i will
just deploy the voting up just for a
matter of time and so you have all that
kind all those repository basically our
images now available for me to
use on my own to them account so I'm
gonna go I already created the repo
because they take some time but oops
twitter so i'm gonna i just created a
repository now i need to link it to my
to my application that is on github so
it's really easy you just need to link
your github account on your twitter
account it's just a single click and
then you can edit the repository and you
have just a simple form just choosing
your organization and the repository is
so for me its voting app.com and here
you arrive at the tag mapping section so
what we all owe is that you can map a
darker image tags to actual guetta
branches so whenever you will push
through a specific branch we will build
that tag and only that tag so today I'm
going to build two tags I'm going to
build staging which will match the
staging branch on my app and if I take a
look at the I will just shut that down
if I take a look at my rep oh you see i
have two folders so the two apps are in
different folders so it's in voting app
so i just need to basically add that to
the doctor file path the docker file is
on this folders so here we are so we we
just set up our our app we also have the
auto built so basically every time you
will push if you activate auto bild we
will automatically be able to dr. image
every time but sometimes you don't want
that so that's why we gave the option to
the user just to disable it for instance
for a master release or something like
this you don't really want the auto bild
you can just simply do it disable it
sorry so now let's hit save and build so
now both of our tags are our building
and their building on the builder note
that i showed you here this is where the
bill occurs right now so clearly what's
happening we have a open source
container called student
builder and basically all the repository
are going to are going to be built
inside it we just put the code inside
and we run the build of the doctor of
the docker file and run the test as well
so if the tests pass we're going to push
the image if the test doesn't pass we
just give you some logging or
notification and what we have also extra
possibilities for that like putting
hooks like other see icd a service
usually do and you can put a pre pre
push hook pretest post-test hook
whatever if you need to build you can do
really a lot of things like for instance
when I'm working out to them I'm doing
basically going a lot so I'm building my
going binaries in a goal-line container
that allows inside the goal the tuden
builder so everything is like container
inside a container inside a container so
this can be a little bit extreme but
that works well so I just put a prebuilt
book basically I built by binary and
then I build my darker image that works
just fine so the build is going to take
some time so while it's building i'm
going to show you the stacks of my app
that i'm going to deploy into them which
is quite different a little bit
different of the darker compost file we
basically have another file dude does
everyone see it's okay oral i zoom tiny
bit here yeah okay so this is a this is
called a two-term yeah Mel basically
it's like a darker composed at yamo it's
it has the same aim but we have a tiny
difference in terms of notions of what
we're deploying here because here we're
not we're not deploying containers stack
of containers we're deploying stack of
services which are a set of containers
so like the the result app will use a
dot the docker image that I've built the
voting up as well that that's the one
right now that is being built with a
specific tag and everything so but here
we you can notice some extra key words
that you haven't seen before in the dr.
Campos syntax like tags
I put staging because i want that app to
end up on the staging node it's really
easy so you can really tag your notes
tag your apps so they end up in the
machine you just want you also have
target them containers basically you can
set immediately at launch the number of
continues you want in every service and
that's really neat because sometimes we
want to scale immediately to 35 four or
five containers so you can do that
straight from the vowel and so so as I
was saying so it's like the darker
compose one the only difference is that
I wanted to show you that as well i
added a load balancer in front of it we
have our own h a proxy image definition
that works out of the box like you just
need to link it to the service you want
and every time you will scale the
continued will get the event and the HR
proxy will update its configuration so i
will deploy that as well to do today and
oh it's built so now let's create a
stack so it's really easy you just need
to cure you just need to go to create a
stack basically name it so call it go to
Berlin and I'm just going to copy paste
that inside that file you can also drag
and drop directly to EML files and we
also have another service called stack
files io basically where users from to
do mo can share or from github in
general can share darker compose files
or to the memos so you can get really
configuration to be ready just to deploy
a simple stack it's really neat with a
search engine and everything so it can
really look for whatever you need and
I'm going to hit create and deploy now
its creating the stack and if everything
runs fine it will deploy a each one of
the services with the on depending on
the dependencies so because both voting
up and result apart depending on Redis
will first diplo Redis then we'll deploy
the devotee cap and a result app
only once the voting app will be
deployed will deploy the load balancer
and because the load balancer is linked
to to the voting up and if everything
runs fine at the end of the deployment I
should see end points here that will
lead me to my application so to them
automatically attributes end points to
your service if you publish ports so you
can expose them from the container to
have them existing it and accessible
inside the node but it can also publish
them to have an end point directly to
that up so that's ease up the whole
process and then you if you need the
domain name or whatever you just need to
set up either a load balancer or nginx
in front with a virtual host or you can
just use the cname it's really it's not
that complicated it's going to take a
little bit of time because i scaled
immediately to three containers but if
we're going to the details of the
service will see like we immediately
have our free container starting right
now on our staging machine and that's
just for the definition of the stack
files it's really it's really easy to to
get also in the end every time you every
time you need to do some changes to your
stack files you can do them directly
onto them so you don't need to terminate
the actual stack and do the modification
I'll launch it again you can just edit
it here and the service affected by the
by the modifications will be
automatically like they will have like a
orange dot next to them that will
require redeploy to help their newest
definition so wills should soon be good
to go
yeah so the result up just launched the
voting app should follow and now load
balancer is following as well so
everything runs fine so far so our load
balancer will automatically detect the
configure will automatically be linked
to the voting app will get through the
overlay Network will be able to access
juice container reduced containers and
just linked them and add them to the
config of HR proxy automatically nothing
to do right now I just copy paste stack
so it's available so we have here our
load balancer so basically it's a load
balancing a load balance the voting app
it will it might take some time to just
access through the because of DNS can be
it can take some time and on the other
hand I have also my result application
let's see and you can also have because
that's that load balancer service
basically has one container so you can
have basically also a hand point for
directly the container not just the
service that should work sometimes the
service works better
well last time we hang like this I'll
run out of internet in front of 200
people so I hope it's that the case this
time should be okay sometimes it happens
we have dns issues that's why what tests
I should have yeah i have so i think
it's the dns we take sometimes to to
update yeah it's just not available so
between while it's loading i'm going to
show you what the edge of proxy has
actually done yeah so yeah so when we
are looking at the service we have
different options we can check the
monitoring the end points but also the
logs at sometimes debugging with the
logs should be okay so ya know the HR
proxy has load balanced correctly so if
i zoom in and I check here here we have
our VIPs of our voting apps so it should
be okay should be okay and I'll time out
and sometimes it's just dns takes time
well that's not the matter you saw the
app it should be ok just dns issue it
takes time so now that my app is
launched and that is running fine I mean
I hope what about just doing a little
change and see what happens when we get
pushed something to the repository so
what I'm going to do is that I'm going
to just do a small changes in the app
yeah so the voting app I'm just going to
change the options like here it was cats
vs dogs I'm going to do that versus ops
and
just going to do that I'm going to save
and I'm going to just commit that and
push it to my repository so in the
meantime maybe the dns will work
correctly yeah so call that update
choice and i'm going to get push
well that's kind of slow I think it's
internet again
if everyone has everyone else has issues
right now or it's working fine well if I
cannot get push that's problematic what
oh really oh yeah that that sucks quite
a bit if i can get push if anyone has a
hot spot or something to save me yeah
I mean google worked quite well if I
want to bring my machine
as well and i cannot get push that's
quite annoying too that's a ssh i mean i
download this repository for ssh i git
clone eight so again i can try
I'm not used to the new interface of
github yeah yeah I can also edit the
file here it will work better thanks for
the trick yeah it's not a good practice
don't do what I'm doing so i'm going to
edit the file live on github well
happens so that vs ops let's go should
trigger the build so yeah oh yeah right
good one I would have pushed that to
master imagine
and let's go commit changes so now if
everything runs fine yep it works so
basically our voting app just cut the
modificator the modification i did on
live on github which is not good at all
but stood up for it from get push but
it's the same thing basically we gotta
change the code has been updated on the
staging branch so the staging tag is
building automatically and so once the
also so what I wanted to show you from
the previous file is that the you can
see that additional field here auto
redeploy true so the voting app is going
to auto redeploy any change to for this
image specifically so once the tag will
be built again well really play
automatically the app which will be load
balanced automatically as well so we'll
see you during the logs because I can't
sadly for some reason show you the app
so we'll see during the logs of the load
balancer that it will be load balanced
automatically again without any issues
and to just to spoil a bit the thing
when we have a load balancer connected
to a set of containers what we do during
redeploy is that we terminate them one
by one I hope so bad I cannot show you
that because you can see like the the
changes occurring one by one on every
container so we you don't have actual
downtime you can really ought o redeploy
it without downtime we just remove them
one by one and if the app would have
worked but here it's more of a
connection issue I guess what are
blocked Oh seriously well I'm gonna yeah
I'm gonna so I'm gonna do at once where
we deploy I'm going to do something
really easy i'm going to edit the port
on the stack file to put it for 80 so no
ports so going to be like them as well
so that's but i'm gonna do it and it
should work it yeah so let's wait until
everything is built correctly so that
one's a repository we'll bill I want to
show you like okay in the stack it's
working well it's really blowing as
expected
but right now it's still building we
also have yeah that I want I can show
you doing the bill we also have a
timeline of what's happening that's for
every kind of object every kind of
object so here it was the image so we
know the build we have the logs and
everything we know where I have actually
done my built so here in Germany we have
the logs of the build so if a test fails
will I will pipe the logs outside of the
container I just show it to you so you
can see what's wrong so yeah here I
didn't have actual test I have a simple
test just to echo something but you can
do it whatever you need you can put just
a simple darker compost test llamo
that's how it works there is
documentation about that and you can
just set you suit test that you want to
execute if you come in and you can
actually build that inside another
container if needed that's really that's
another level of isolation oh it's built
so now we should have yet so so yeah
because the result app and the voting a
bar in the same repo they cut the event
so both of them are redeploying but the
voting app is redeploying so if i go to
the detail view again so one by one so
they are terminating so you see voting
app one and waiting up yet that's done
so but i am one two three have been
terminated and then relaunched with the
new definition of the image and now if
we go to our load balancer we can see
yet the configuration has been unchanged
because basically they kept the same IP
address so we don't need to change
anything but it can happen what we
deploy that the container changes its IP
address so in that case we're going to
just update the configuration so now I'm
going to do something so just to show
you so you can either do what I will do
you can either do that on the stack
files I to do that on our service
wizards so basically we're just load the
image information and instead of
exposing port 8080 I'll just do port 80
that's really easy so i'm updating the
definition of the load balancer so
you guys can see the app and i'm just
going to redeploy the service so it has
a new definition so you have a deeper
look and redeploying containers yep it
works so we check the logs we relaunch
our HC proxy and he has load balance our
applications again so let's check that
if that works that works better so yeah
so sadly I I didn't know about that poor
thing but now we have our change their
they're so we had cat vs dog before I
push we have the British ops so next
time I'll put that direction port 80 for
the next demo so here so yet so now we
have a start working so we have a CI CD
workflow really easy set it up and we
can easily change our current stack you
have yoga mo you saw that just pushing
code or editing services just really
blowing is really quick load balancing
is really easy we have other images that
that to them has done to ease up the
process of deploying stuff like
wordpress or ingenix we just tweak them
a little bit to make them more easier to
use and I'm going to go back to the
presentation to talk about what's next
for to them so first sorry for the
internet outage happens and so what what
we'll do because we got acquired by
darker so you you might expect more more
stuff to get along with the hub that is
that has been there for quite a long
time now so what will happen is that dr.
Hammond to them will eventually just
being unified completely so we want we
are currently using we're currently
switching registry before to tomb has it
had it hones registry now we using the
doctor once so every image that I push
today they push to the locker hubba
automatically unified belt test system
so we
basically dr. having us we built the
build and test system at the same time
but before the acquisition so for the
moment is quite different but we're
going to like take each other's IDs to
build up a unified build test system and
basically what you will just do on
children will like for build test stuff
it will be exactly the same on docker
nothing will change the interface
whatsoever and also the UI yet we're
gonna we're working hard with the front
end team of darker just to unify the UI
from docker hub and children taking
what's good from both of the apps and
just building 11 like cloud service that
is really working well and yeah as I was
saying before darker one night a darker
19 that has tons of new features that
are really neat especially the network
stuff because right now we're using our
own network of La that is built on top
of weave which allows like just putting
a Rueter container on every node and
just the traffic goes through that
container between them and well it was
where it's working well so far but we
want to go more native because of course
it's better and you have better
performance and also our aim for the
rest of the year and the beginning of
the new year is to squash the last few
tiny little bugs that we still have to
improve the little details so we'll be
ready for GA and you'll be able to use a
nice product so thank you and sorry that
the demo didn't work well as expected
but I hope you enjoyed it as so far and
also they they told me to remind you
that so to rate the session so i hope
the demo won't win remove me a star or
two but sadly it was more technical than
actually demo God stuff so well thank
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>