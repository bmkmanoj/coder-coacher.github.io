<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2014 • Mobile CI at Etsy • Daniel Schauenberg | Coder Coacher - Coaching Coders</title><meta content="GOTO 2014 • Mobile CI at Etsy • Daniel Schauenberg - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2014 • Mobile CI at Etsy • Daniel Schauenberg</b></h2><h5 class="post__date">2014-07-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OhconFwX-2g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I want to tell you a little bit about
how we do see I for mobile adapt see I
work on the infrastructure team I would
probably consider myself an
infrastructure plumber tool smooth I
write a lot of tools I do a lot of chefs
tough love the like general
infrastructure bibs and yeah today I'm
going to talk a little bit about how we
do see I for mobile so at see if you
haven't heard of ab c before we are
market players around the world that
connects people that brings people
together if you handmade things yourself
if you craft stuff you can sell it epsy
we bring people together we enable
people to sell and buy from each other
and hopefully create a more lasting in
fulfilling world and we are known on the
technology side of things I guess for
like deploying a lot we have a very
successful technology stack on the
website we have basically the
traditional lamp stack we run a giant
PHP monolithic application which we
deploy a lot and we also have this thing
that apparently everybody loves mobile
and a lot of a traffic more than fifty
percent to be exact is actually mobile
now so it's a big and important part as
more people try to engage the side on
mobile and we're in the same boat is
probably everyone else and we want to
make the infrastructure and the
ecosystem around mobile mobile
development better we have a bunch of
applications most of them are basically
for buyers so we have a bio NFC app for
Android for android tablets we have the
same app for the iphone for the ipad we
also have an app for sellers so if you
are selling of a shop and hep c there is
an app that just helps you manage your
listings yeah setting you up with new
listings in
and they all run on a bunch of devices
we also have some internal apps so we
just getting started and also creating a
lot of tooling we have internally for
mobile platforms so for example we have
an app called thief which is basically
you open it and you can figure out is
there a meeting room available right now
somewhere in the office and then it
tells you yeah you can go to so we have
those beings rooms they are all named
after food and music so you can see in
your phone Oh REO Speedwagon is open or
bon bon jovi I guess is open so we have
like a bunch of rooms and like the next
task a second figure out where this room
is because it's not always obvious and
we have a big office we also have an app
called app signal which is like lens
name from Bab signals basically a way to
page someone from the staff directory if
you need help and they get like a
mention on IRC and I think a text
message and email so we have a bunch of
different apps and we also have internal
builds for all the public apps so if you
are an employee let's see you can get
like the beta builds of all the apps
from an internal site and basically we
want to make this deployment more like
we know deployment like we know
development on the web stack and when we
start out on like the mobile site there
was like this very basic premise of
every commit to build the main line on
the integration machine so there's no
like so definitely on mobile development
you would have your laptop one of the
developers in the team as we heard this
morning from jasper is like you open the
laptop you built a thing you upload it
on the web page and hopefully that was
like a good built and apparently there's
problems with debug symbols and
everything so this was like the classic
problem of hey it works on my machine
and we didn't want that anymore so we
start with the basic premise of
everything should build on basically
this GI cluster so what does development
look like for us we run github
enterprise internally we have all the
web coding
FC calm is basically a giant repository
that has everything in there but we have
a bunch of the tooling and other
reporters on their development does all
on the master branch that's true for the
website of things but there's also true
for mobile so future development takes
place in master because that's where we
integrate that's where you know this is
going to go out this is where you want
to have see I always green we use pleura
quests as code reviews so if you want to
get like quick review on something you
wrote on your small change you did there
we wrote command-line tool that
basically takes your patch committed to
a branch pushes it up to get up and then
signs that issue to someone so that
person can review the code and this is
all existing tooling we had for web
development and we're using that on the
mobile site as well so if you change
something in iOS code you run review on
the command line it opens a pro request
you specified someone who should review
this on a command line and the person
gets assigned the issue Jenkins builds
that version of the app can comment back
on the if you know if you've used
travesty I before that's basically the
same a little bit like it used to
comment now like github has this claw
request status apia can just say this
works and this is what we do it like we
built a test we run the limbs and it
reports back on the floor request just a
screening okay everything's fine and
this is a known workflow for us that's
what we carried over from the website of
things and we run Jenkins there it's
also what we know on etsy.com for the
web development we have about 350 build
slaves which are basically lxd
containers because they're faster than a
full-blown virtual environment and it
turns out that running the Jenkins agent
is really really good if you run one on
a machine be used to run I think
10 on one machine it just like started
traveling all over itself it was
problematic so we split out those
physical hosts into Alexi containers so
each container runs one Jenkins agent we
spread them over the three SSDs so when
we run io intense of tests like the DB
unit test for example only everyone
intensive job runs on my necessity to
not like collaborate the disk most of
those pups are actually attached to try
which is our tooling that gives you a
way to build your changes on the CI a--
cluster and we call them the bobs
because they build our tests and it's
basically the same for the mobile world
so except we don't have Alexa containers
we have mac minis racked up they run the
android and the iOS toolchain they run
lind and builds on each push so whenever
you push to get up we at least run the
unit tests the functional tests and the
limiting jobs and this is all automated
with chef and by all i mean ninety-eight
percent because it's i was ten and
there's not like everything in the whole
epic xcode to Jane you can actually
automate with chef there's some stuff
you still have to click ok ok I agree I
totally have read this agreement blah
blah blah so not everything hunt the
sender's automated but most of it is and
yeah it's automatable chef so chef runs
configuration for a whole infrastructure
basically every machine that lives in
the FC network is configured by chef and
that's true for production is true for
development all development machines run
the same cookbooks and production it's
true for the corporate environment and
is also now true 4 molesey I in addition
to that we also have a vice labs so
there's this we have this very nice full
shelf of all different devices you could
test on you would test on there are
different Android devices their iPads we
have on there
I don't know how many we have by now but
it's so big shelf and you can borrow
devices if you have to do longer testing
I think like last month I have to fix
the bak for mobile login on the Kindle
Fire I think so there's like a lot of
different like HK sparks we have if
you're at velocity next week there will
be a talk about how we set this up and
how we use it and how it helped us small
speed up mobile development yeah so the
whole infrastructure for testing
basically looks like this as I said
everything lives in github as soon as
you push to github that push is tested
and lintels and everything and what we
don't do right now from this was
actually cut releases so it does the big
problem is as you might know when you
are writing mobile apps is that the API
to actually get released into the app
store it's not super computer friendly
there's still some manual steps for the
most part but we build everything and we
build the release on a release machine
and basically then you upload to build
from that machine it's still not a
hundred percent automated but it's
better than having this one weird laptop
somewhere where you built our release
new uploaded in that has diversion so be
right now we have once the imac that
actually always is used as the build
machine we run a set of functional tests
based on cucumber and calabash which
basically gives you the functional test
so that we know from the website of
things on mobile devices the nature of
functional tests however are that
they're a little bit flaky they're not a
hundred percent always working so we're
not blocking right now in functional
tests but we run them and we're also
using a service called effort that
basically test stuff on actual mobile
devices for us and of course we wouldn't
be at see if we didn't have a dashboard
for tests
we have this heat map kinda dashboard
that gives us an overview of like which
tests ran on which platform and the
failure rate over i think the last week
on this dashboard so we can see like
some tests in the middle have been
failing more than others most of them
are stable and this gives us a really
good overview over the current state of
CI on mobile how it works for us and
basically where we have to invest make
tests better what are the current pain
points we have so summer we started to
really improve CI for mobile it's been a
very recent undertaking for us I think
it started I would say it really started
end of last year beginning of this year
we now have repeatable repeatable tests
that run on dedicated infrastructure we
know that if you push you can get
insights into does that work on a
different machine we expanded testing to
physical devices there was a big thing
for getting mobile web up and running
but also Tesla actual physical devices
we're still working on improved flowing
automation as I said we're like
ninety-eight percent there with like
having all this mobile CI infrastructure
fully shaft and of course deployment
would be the next awesome thing wait you
don't have to click through a forum
anymore but just like half maybe even
Jenkins upload something to get approved
by the apps or team we if we when we
improve on this there will definitely be
a block postal codes craft Lockyer
already is the overview of how we do see
I from februari there's a great blog
post about our mobile device lab which
we use for testing of course just think
this sounds like fun you want to help or
of course hiring and I think like two
minutes left for questions for actual
releases we do create a raised ranch
right now that only gets bug fixes so
there's no future development enough
that so we have this we usually don't do
branching and get we do branch in code
so we try to keep this so every all
future development is only in master and
the grease vendors are really really
short lift and only get bug fixes for
that specific release right now thank
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>