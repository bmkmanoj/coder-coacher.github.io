<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Highly Available &amp; Scalable Solutions with RavenDB • Maxim Buryak | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Highly Available &amp; Scalable Solutions with RavenDB • Maxim Buryak - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Highly Available &amp; Scalable Solutions with RavenDB • Maxim Buryak</b></h2><h5 class="post__date">2015-07-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QBHClZJvhHA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi guys and I'm here to speak with you
about how we can create scalable and
highly available applications using the
ravine DB docomo database but first let
me present myself this is everyday me
i'm a software developer and I come back
here with will it work actually with a
bird so my public speaking level is
something like minus 100 so I'm not
going to show you any sales pitches or
stuff like that i'm going to show you
things that I know how to do which is a
coding which is a live demonstration and
let's get going reven DB ever'thin DB
you ever seen on a roll ups and at the
outside it's a document database and
document that way actually it doesn't
stall or documents or PDFs it stores a
JSON objects but you know I'm not going
to talk to you about the how you model
data in the document databases and how
you normally stuff just going to show
you that I'm going to fire reven d11 DB
instance and another one for later
actually if you can see it actually
listens to the to the 8080 port means
that its API is a is the rest api and on
base of this api we built a management
studio and
that's how it looks great
here we go I have this magic message
because I'm lying on windows 7 and there
is no web sockets in Windows 7 so go
ahead and create a sample database good
and create a new document now I've been
thinking what I want to present and
actually and what I like the most is my
fiance and then my tickets so and I have
two cats and so let's have from cats
I'll create a any most document and I'll
create my first kid whose name is Chaka
he's great he's a eight kilograms he's
pretty pretty chubby and his own house
I'll me and my fiance which are maxing
and Gilly and that's it we have our
first document is this thing it's
actually a JSON object that's what it is
now shaco has a stepbrother his name is
better he's a bit fitter he waits 6
kilograms and we have a baby cat and
name is a vanilla and she's really
cinches something like four I think okay
that's it what we have now is until now
is some kind of key value store of keys
as you've seen animals 1 2 3
the day json documents but for the for a
database that's not enough we actually
want to query the data alright and
that's what I'm going to show you now
I'm just going to choose the dynamic
index and I'm going to look for get
shocked see
and
but
one moment that didn't happen in the in
their household
I'm going to give it a title a couple of
a couple few seconds and I'll continue
if we can't go on
to try that
well never minded there's some
unexpected the condition and so I'll
keep going what I wanted I wanted to
show you is how r Evan DB actually
queries documents how according to any
any field that you enter it knows how to
process all the documents and actually
on the way index them so for the next
thing the operation will be much much
faster so that was about the remedy be
in general sorry about the little
technical problem I hope well not we
want to experience it anymore but I came
to talk to you about first about high
availability how another NDB we gain
high availability we gain it using
application I know this if anyone is
here at the water plication how it works
I'll explain we have two different
independent instances of the database
each one of them has its own storage and
its own application and they communicate
between each other and they synchronize
each other now let me show just
go ahead and use my demo helper it's a
little application that does a couple of
things that I just didn't want to do
during the conversation with you
including creating and you databases and
configuring them but let's look at that
at the 8080 database we see the zoo
database appear and actually all the all
the demonstration is has the animal
setting and let's have a look it's
actually pretty empty but it has a
replication configuration and that's how
it looks and that's how a typical system
system administrator should configure it
and very very similar thing is in the 80
81 instance
here you go as you can see again it's
very very simple you we state the URL
destination database and that that's it
it works how well I'm going to prove it
to you every time that I press a button
from now on a new document will be
stored on the 8080 database afterwards
the 8080 that waste will copy then you
document to the 80 81 instance so here
we go and we can see that we have big
amount of animals in the 8080 and the 80
81 databases and actually no they
synchronize but what if see now is a no
leader application best case it can be
used for no very quick and alive back up
but I came to talk to you about the
availability anything so in order to
demonstrate availability I have to make
something unavailable so let me just go
ahead and kill the 8080 instance
and it's not with us anymore I'll reload
the page nothing no one answers I reload
the page here 881 still alive and I'm
going to go back to the to my demo up
and press the key again okay actually we
see that it took a bit more time I'll
explain why what the client API did it
actually access the 8080 instance once
it didn't answer and said okay maybe
it's some kind of the network failure
let's stir again it tires again fells
again for the third time he tells him
itself okay let's try the replica the
other the other game he does it and the
operation is complete from now on it
continues talking with the other
replicas and everything is going as
smoothly as before now what will happen
if we'll far again the 8080 database now
what would you expect to happen now and
I guess that you would expect that
you'll have to ask the system
administrator to copy the files all the
data files from the 80 81 is instance to
the 8080 and they to ask the databases
keep going actually what happens in
revenue be is that the 8080 database
when it comes in comes alive it acts ask
the 80 81 otherwise your fellow which
what changed since the last time we
talked in tells him how you know what
actually received bunch of new documents
and here we go we have 30 we have tilted
to documents in the 8080 database the
same amount in the 80 81
means that after the crash after the
system administrator got the machine
alive we just keep going
now
how did we do it actually the syntax
that we use and here i show you the
the.net client api version and also i we
have a java client api version and the
dispersion we can show you at our boot
we just open a new session it actually
looks a bit like like an owl em I get a
hibernaculum we ask it to store a new
animal Save Changes and that's it we're
good to go so you must be saying to
yourself okay so maybe the connection to
the database is more complex and we have
to do more work and actually you don't
that's all you have to do in order to
configure the connection to the cluster
you state the URL you set the database
you're good to go what happens in the
client API it asks the 8080 database
well who is your replicas it and the
answers in and the client I pay knows
what his behavior should be from now on
so all the work is done by the guys who
configure the database and as you've
seen before it's actually pretty pretty
easy
and then we would have a problem but
this moment is actually the first moment
when you fire up the whole environment
when you do that most cases I think that
you you're sure that everything is up
the problems happens after the you know
after we go to the production now
there's a electricity a crash or
anything like that actually there is a
way that you can also configure in the
client side this structure and in this
case this case we actually will be able
to to work it up now next one day today
I want to talk to you about is the load
balancing you see what we've done now is
in order to gain a high availability we
made you buy two machines to gravity be
instances and you say well now I pay so
so much you know I paid so much money
for the for the hover and I pay for the
licensing and all I get is a is a
failover for anything actually we allow
you to use this cluster for low effort
for load balancing this way in the
regular conditions we're a load balanced
and what was the there is a clash a
crash we just keep going and yes there
will be a bit more stress on the
surviving database
now that said let's imagine a the next
CT situation I'm only for this slide I'm
going to leave the the animals team I'm
going to go to the banking thing imagine
that you have a bank and you have that
account a corporate account and you give
away your your card stole your employees
and all they do all day long is going to
ATMs and the and then taking money out
of your account and there is a specific
moment in which to different users went
to the ATM and withdrawn $100 what will
happen now what will be the the
situation of the account actually 11 DB
knows how to spot this DCT situations
and it will help you to resolve this
conflict and that's what the next
demonstration is about the demonstration
itself will be in the animal stream just
in order to make it simpler and what's
going to happen now is the that the zoo
database is going to be recreated and
every time i press a button a conflict
will be created because the same animal
will be created in both databases and
revin DB will have to figure it out for
a figure out what to do and let's have a
look
okay so and I hope that you see that we
have here any molds five underneath it
we have animals five conflicts some good
and any mods five copied some other game
let's see that one we see that we have
named dog number 5a wait zeros dog and
the other one is the name just ends with
a B so let's look at the animals five
document and what we see here we see
here actually the Trevin d be processed
both versions of the document and find
the conflicting field and now as tell
she tells you well I've seen this filled
with value dogs number 5a and I've seen
this filled with value dogs another fav
be what they want to do and let me
answer him what I want to do is that I
want the name to be dogs number 5 c and
that is what are going to see now is
that the other two documents that
represented the conflicts are gone
because the gun the conflict is resolved
we have the final version Doc's number 5
c and in the 80 81 in database and
animals five already has the final
version now and so we will say okay you
find my problem but you didn't solve it
and actually i believe in in cases where
there could be hundreds of conflicts
like that in in a minute this solution
won't work for you or else you'll have
to have now hundreds of workers just
looking for company that's why we
actually have the ability to allow you
to have your own conflict resolution
logic so it will just keep going as you
want but there's another case there is a
case that you don't care you just don't
care you say okay whatever just let me
keep working and and and just figure it
out for this case if we go back to the
application configuration we can see
that we have this conflict resolution
field for now it's none none means that
we do nothing we could choose one of
these other options I'll choose resolve
to latest which means that the latest
wins
and I'll do it on the other applicator
here we go
from now on I can create as many
documents as a one and all the conflicts
will be resolved by himself as you see
you we have no other conflict
indications that was easy right it is
you know considering that that all you
have to do is enter the web UI and
change them some configs now well what
did we have until now we've seen that we
can configure application between two
servers in a minute we've seen that we
fail over without any code written on
the client side by you it's all all the
code is already written by us you know
pretty rich a planet API and you see
that you know we know how to resolve
conflicts and in to load balance now if
that's not enough let's talk about
scalability
actually and in revenue being we get
scalability by shouting we actually
allow the users to divide the data set
into several machines this way the the
load will be divided between several
machines of a ravine DB and this leads
to my third and demonstration
okay now let me just explain the setup
because this time it's a bit more
complicated okay what we have now is
that we have dogs ooh get the replica in
8018 and dogs replica and katsu in the
80 81 as you see it's kind of crisscross
so each database has it has the hales
main purpose and has the fall back for
the other shop this way our cluster in
case that one of the parts of the
clusters crushes it actually can
continue going on and on and on and let
me demonstrate you and I'm just keeping
pressing the button and just I just keep
generating random animals and let's have
a look we have a 31 wait
the number isn't the way whether 6063
animals in the dogs are in the 80 18 we
have 64 animals in the cat zone and the
same situation is the in the 80 81 as
you can see
now
you would said you would say maybe this
configuration will require from you too
really lots of job and actually it isn't
that's all it needed to configure and
the client-side connection to this
cluster we define a dog shop for the dog
value of the species that who's the
default database dog zoo in the URL
there is the 80 18 cents and we have the
cat whose main urology day is the 80 81
instance and the default database is the
Quetzal and after that we define the
shoving strategy and we're good to go
and actually its usage is as simple as
you've seen before we just say we create
a new session we ask you to store and
the client appear according to the all
the configuration we've seen before nose
to which one of the server to send the
data now just in order to for the
demonstration to behold I'd like to shut
down one of the instances
and see what happens
actually after the first start first
delay that we've seen in their
application scenario we just keep going
we can look at the 80 81 database and
see that it keeps updating and as you
can see the numbers just update again in
this scenario also we fire again the
8080 instance and
if this is it is synchronized and in
this time we can kill the other instance
also and have the same results
ok
good
as you can see here also we just keep
going and if we'll fire again the 80 81
instance
it will be just fine now I see that I
spoke a bit first and so I'd like to
show you a couple of more things that we
can do with the revenue be and not just
not to waste the time so I'll go ahead
and go to the 8080 and database and they
create a new Northwind database and now
it's empty and actually a nice thing
that we have is that we allow to create
sample that I know just to have
something to play with and here we have
it it's nice and then let's hell let's
have a look at our indexes we actually
index that according to lots of things
like totals of the orders but we have
this in this index which is only 89
entries and this in this index is
actually a MapReduce index now what
happened here is that and revin DB
allows to do a pre computed MapReduce
which means that like unlike in other
cases it a you have to go to the all the
documents for each query and put and do
the MapReduce operation it does it it's
free time and then it stores it in the
leucine index this way this record that
you see of the company count in total
can be queried and OH unfortunately
again I have the same arrow try to
overcome it
No
ok
and
see what else I'd like to show you
well okay I'll show the patching ipi
actually we allow you to send a Java
code that will process a whole very very
big amount of the document and the
server side so you want me to know to
query document to change it and to send
it back just let the database do the
whole thing and just for example I'm
going to pick a collection say a company
and to ask it
well
just
hmm
creating a creating new field and
actually in weight
in pretty simple manner we can achieve
it as you can see every new company that
we created we had it we have it with
this dump it ok any questions yes yeah
first it's it's about how we look at
transactions MongoDB is is a good first
database and as far as I know
transactions ends up with the data being
saved to the ramp in its optimization is
to choosing by itself the right time to
take all the changes that need to be
saved and serve it to the storage we
take the time and we wait until the data
is actually in the database so in case
that the system breakdown something like
that we know that the storage has the
data its first second how we look at the
queries whoever uses MongoDB unless it's
a very very basic case i would like to
actually integrate it with some search
engine it could choose to implement it
by by himself to implement it on base of
the same machine or choose you know
engines like LA or electric
elasticsearch which are also based on
loosing which is just a very smart
technology in order to query in 11 DB
you're just ready to go you don't have
to do these integrations the the
dilution is integrated loose internet
it's a poor to.net of loosing its
integrated inside the vendee be so it's
all about simplicity as you've seen the
syntax is very all and all I'm like you
just can start working and get the
results were very fast
because I don't have a wife a connection
here I'll just use the demo code because
otherwise I'll have to download the
client from from nugget until take time
no I don't want to preview license is
over
and
let's say that we have a sum
Plus person is
here we go
from
mmm
that's it sorry mother delay what do you
mean in the interactive show that's the
one I couldn't comment but don't you
have the quality you have to write an
order to connect to the database to
authenticate yeah actually we have the
rest api and which you can do you can do
the same actually same query that
doesn't return values actually and
that's how their quest looks so yes if
you want to be a very very you know a
low-level outcall you know a rest quest
user you can do it all the client api is
based on the rustic guy
so does that mean through crusted guys
anyway
the dashboard shows the database had
evidence that was doing sharding had 100
of these through the recipe as in the
way
to the true the rest api you'll have to
yes you have to remember it by yourself
a client a paid membership the client in
the a in through the recipe will have to
implement all the shouting logics
actually cools in the client side so
you'll have to implement it it all by
yourself but again we have the dotted
client and the Java client so in most
cases it will be enough it will be good
also we have customers who chose to use
the rest api and they're happy with it
my question is if I wanted to use it in
a fast pace
r
yeah and you would quit the database
have the information that there is a
conflict and use a specific API do to
help to receive all the possible
resolutions and choose one or create or
one of your own thank you very much for
listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>