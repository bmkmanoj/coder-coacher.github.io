<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • Security Threats and Mitigations for iOS Developers • Emil Kvarnhammar | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • Security Threats and Mitigations for iOS Developers • Emil Kvarnhammar - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • Security Threats and Mitigations for iOS Developers • Emil Kvarnhammar</b></h2><h5 class="post__date">2015-10-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/penTcaONtjs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everyone and to my session about
security threats and mitigations for iOS
developers and my name is a melanoma I'm
from true sick a Swedish company in
Malmo and our headquarters is in
Stockholm but I'm based in Malmo and
that's also where we have our main
developer unit and where we focus on
secure development so my background is a
software engineer but nowadays I work
more with security related things in
development projects and so today I'm
going to talk about specifically
security for iOS developers how many of
you are iOS developers I guess that's
why you're here right so how many of you
are not developing for iOS a couple
that's very very glad to see you here I
hope you find it interesting still a lot
of this applies to OS X development as
well so and of course some generic best
practices in terms of security so about
iOS and security is an iOS secure yeah
many of you are nodding actually i agree
i think i think iOS is one of the most
secure platforms out there today but
there are still security considerations
that we need to make and we need to be
aware of the threats because the threats
are becoming different compared to many
other platforms just because of the
security design in iOS and that's what
I'm going to talk a lot about today
because there has been some security
failures right and one heard about go to
fail yeah but you didn't miss that one
good fail was a security mistake or a
quality mistake in certificate
validation in the security stack on iOS
and also in a short time window
disaffected OSX and what this meant was
that it was really easy to just
man-in-the-middle attack the iOS users
which means that basically all SSL
sessions were readable by attackers
without the user having a chance of
noticing this of course this has been
patched for quite some time now but
they're probably use is still out there
on older versions of iOS even if iOS
uses in general tend to upgrade for
quite fast especially you guys your
developers right you always want to run
the latest and greatest but on all the
devices people are concerned about
performance and things like that whiler
Kerr was probably one of the first more
famous malware attacks on iOS uses
that's also something that caused large
headlines why lurker was utilizing the
enterprise in-house application code
signing features and and that's an
example of how the code mandatory code
signing is actually possible to be
bypassed without actually using a
security vulnerability but rather use
weaknesses in the overall process and
the overall design and the ecosystem
around the platform
more recent attacks has been dubbed
masks attacks and this is actually if
you heard about Sora across app resource
attacks it's very similar or sometimes
small as the same as mask attacks mask
attacks is a GRU group name or a group
definition of several different types of
attacks where you somehow mimic another
apps behavior or you replace another
another application i'm going to show
you this later how easy it is to just
replace another application entirely in
iOS and take over the sandbox of that up
there was a vulnerability in a drop it's
been fixed in iOS 9 and this was also a
serious vulnerability leading to the to
malware malware authors being able to
plant malware on iOS devices just by
sending an adverb message or sending
payload over a drop and it doesn't
actually matter if the users decide to
decline that or if they decide to accept
it it's still going to be planted this
is iOS 9 so my point here is not that
you should always run the most decent
recent their software because that's
important of course but also that this
is going to continue it's going to be
like this more or less at least for a
couple of years maybe always who knows
because in software securities it's been
like like this forever like in the 90s
people said sequels sequel injection
that's going to be done done in like 10
years it's not it's not going to exist
anymore in 10 years still we find sequel
injections we find command elections
we found all of these most basic
security vulnerabilities in software the
reason that is that software keeps
changing right so as long as we do new
features like in iOS for instance
there's been new features added like the
ability to develop extensions for
applications and plugins and that's
where people find munnar abilities like
mask attacks there are one category of
mask attacks called extension mask
attacks in September this is quite funny
right xcode ghost and in September and
it was revealed that there's been an
attack going on for quite some time in
China that where they utilize the fact
that developers iOS developers in China
we're experiencing slow download times
when downloading the the xcode tools
from apple's servers in the u.s. so
someone was being creative and realized
well this is an opportunity to plant
malware on those developers machines so
they provided a repackaged version of
xcode on a local server in china a
repackaged version containing malware or
malicious code that will in turn inject
code malicious code into the
applications being built by that version
of xcode this affected hundreds of
applications and hundreds of
applications has been removed by apple
because of this this hasn't gotten that
much attention here and that's probably
because it mostly affected chinese
applications so it's probably bigger
news there than it is here so think
about that what that means in terms of
the possibility of detecting such such
malicious behavior
all these attacks all these hundreds of
applications past the App Store review
so we can't rely completely on that
Apple will find the security
vulnerabilities for us or find the
malicious code that got injected in our
apps and Apple when they realize the
fact that our applications has been
infected there's really no way for them
to just clean that up I quash the
vulnerability or wash the malicious code
away so what they need to do is
basically ask all these developers
contact all these developers to say
please clean up your environment install
the real version of xcode build a new
version of the app and send that again
to us for review when we talk about
security threats we always talk about
security from an attackers point of view
there's no point in talking about
security from a defenders point of view
you need to know how attackers think and
what the goals of an attacker is and
this is if you heard about threat
modeling threat modeling is a concept
that you can use to improve the security
in your software development project
threat modeling is also about being
proactive with regards to software
security and thinking from an attackers
point of view so what's of interest it's
of course one of the most obvious is
extracting app data or stealing app data
that could be credentials documents
emails depending on what type of app it
is so think about in your applications
what kind of credentials are being used
or being input in that application
sensitive date that you have in the
sandbox or in keychain for instance what
is that the information falls in through
into the wrong hands not because of
using a vulnerability nuh selling your
applications but maybe because of using
something that's vulnerable in some
third-party component that you use or
through for instance masks attacks even
better is the possibility to execute
code because if you can execute code
then of course more or less always it's
possible to steal data that's enabling
the other plus more and if we're able to
execute code then we can also
impersonate that application so we are
not only put it's not only possible to
steal data that's a tryst stored in
keychain or in the sandbox it's also
possible to to perform phishing attacks
or like fool the user to to supply
credit card information or things like
that which they might do if they trust
your app right
but fortunately there are several good
security mechanisms in iOS without those
it would be in disaster already would
look like Android right well Android
have they actually have some of these
security mechanisms and I'm not like
religious about iOS it's I think they
have benefits on both sides but there
are definitely big benefits in the
security design of iOS that android
doesn't have and probably never will
have so I think the App Store review is
of course as you all know it's a good
sanity check not only in terms of
security but also about about quality in
general like following best practices
and everything but the most powerful and
that's what I mean is the biggest
difference compared to android is the
mandatory code signing there is no
possibility well there has been more
abilities in the code signing
enforcement and that has been utilized
but in general this design is a lot
better that the code signing is enforced
so there shouldn't be a possibility to
execute code that hasn't been signed but
there are still differences and there
are a few different options probably
most of you are developing applications
for distribution in the app store but as
someone of you using the enterprise
in-house applications distribution type
yes quite many then you know that you
have the possibilities to sign
applications and run them on the bar on
any device without passing the App Store
review that opens up for a lot of
possibility in terms of enterprise use
of the
iOS platform but it also unfortunately
opens up for some security
vulnerabilities that's not about like
buffer overflows it's about weaknesses
in the overall ecosystem so for about
two hundred ninety nine or for 299 US
dollars you get access to signing with
an enterprise certificate and there is a
procedure invalidating that you're a
real company supplying this or
submitting and this request to become an
enterprise program member but but still
this this has actually been used to
bypass the App Store review and it has
been used by malware it's also you
already used by my people behind gala
breaks so it's a fact that this is used
to bypass security mechanisms number
three Sam boxing you probably know all
about what Sam boxing means but in
general it's enforced by the platform so
it really doesn't matter if I you
started use posting a POSIX api's and
bypass iOS specific ap is it doesn't
matter because this is enforced by the
colonel so there's no way for me to
write outside outside my sandbox unless
there is a weakness in the sandbox
design which has happened that's been
patched at least the known
vulnerabilities and even though there is
a sandbox in mechanism you still need
you can't have applications living on
isolated islands right the need to
somehow have some kind of interrupt
communication one is it
through customer uri schemes one could
be developing extensions which is more
recent feature of course that's more or
less necessary because otherwise it's it
wouldn't have been that flexible in
terms of like developing more more
integration between apps and you using
for instance using documents from one
application and process them in another
and things like that I'm making an
application flexible in terms of the
data source of what we're processing I
mentioned the importance of protecting
data at rest and there is something
called data protection you probably
heard about it this is nowadays the
default behavior but there are still
there are still things we need to
consider that data protection is only
working if we have a pincode set on that
device and nowadays it's not only pinkos
it could be touch ID as well touch ID
with you can where you can always fall
back to pinkos how many of you have a
pin code like 1 2 3 4 0 1 2 3 4 5 6
don't raise your hands you don't want to
reveal that in public right but you know
somebody who has it don't you probably
heard about someone who has one two
three four five six it was wanted two
one two three four but then they they
made it be you have to have at least six
numbers right so then it's one two three
four five six maybe well and but there
are attacks against data protection as
well and then the most obvious is mask
attacks but still there are ways to
depending on what storage flags you use
in data protection there might be there
might be data that's not
accessible through backups for instance
but think about this when writing your
applications if the data is not supposed
to be read on another device for
instance and I mean if if this is hard
well it's actually quite hard to find a
good example but if this if this is like
a unique device key for instance being
stored in the sandbox then there is no
purpose in migrating that to another
device through backups whether it's
iTunes or I Club backups so the wrong
ways to to turn that off right the same
goes for keychain items you can
explicitly save for that specific
keychain item it's only going to be read
on this device only and then it's not
gonna end up on another device and that
makes it tougher for attackers to reach
that because then they need to jailbreak
or use masks attacks or instance which
get is getting patched
the last part in terms of security
mechanisms is app Transport Security and
to talk about apt Transport Security I
like to talk a little bit about SSL and
TLS I'm sure everyone knows what s cell
is but it's not only about encryption
right it's worthless having encryption
only it's not entirely worthless but
close to worthless because think about
if you're transferring money is the most
important that you know that no one else
is able to read how much money you're
transferring or is it more important
that you know that you're actually
talking to the bank when transferring
the money that's probably more important
right still it could be sensitive
information we're sending so ideally we
should have confidentiality as well the
confidentiality is about encrypting the
data integrity is but and making sure
that this data is not being modified by
somebody else on the way and
authenticity is about ensuring that
we're talking to the right party the
bank so the way this works is that there
is a handshake procedure between the
client and the server the client starts
by sending a client hello the server
responds and the service sends its
certificate chain to the client and then
it's up to the client to validate that
chain and making sure that this server
certificate is actually intended for
that server that we are connecting to
and no other server if you don't
validate that then it's very easy for an
attacker to perform
man-in-middle-attacks and just send
their own certificate to the client so
if you choose to
ignore certificate warnings for instance
then it's completely open for an
attacker to eavesdrop on that
communication in plain text to modify
the communication and the same goes if
you in your applications actively choose
to ignore certificate warnings or if you
choose to bypass certificate validation
which we still see some developers do
mostly in testing code but that tends to
end up sometimes into production as well
so please make sure once again that you
actually follow the best practices and
this is becoming more important with app
Transport Security I bet you already
read about this in news about iOS 9 if
you haven't done so Google is and or go
to the iOS documentation of iOS 9
because this is going to be enforced so
all applications will have to explicitly
define and opt out from some from a
subset of these rules if the design not
follow it so best practices of secure
communications is about doing https only
ssl/tls right they raise the bar even
further this is TLS version 102 which is
the recommended version at least TLS
version one or two and also something
called forward secrecy that there is no
no possibility to decrypt that
information if it was captured today
this is not going to be a possibility to
decrypt that communication in the future
so forward secrecy algorithms is the
recommendation and that's what app
Transport Security will make sure and if
you you are to make exceptions of that
because of some legacy thingy on the
server side maybe that you have no other
option or maybe you don't have control
over the server side or maybe you're not
good enough to convince the
the developers or the server
administrators to use TLS one or two and
use forward secrecy algorithms then you
need to define what exceptions you're
making 22 app Transport Security but
please don't opt out of this because
there's a purpose with this there's a
reason why you shouldn't opt out so we
recommend that you use set paintings
that if you're pinning because by
default the certificate chain is going
to be validated against the platform and
that's more than 100 is I think it's a
up to 200 certificate authorities
nowadays that are trusted by the
platform and that's actually that could
be anything from government owned
certificate authorities to like
certificate authorities use owned by
banks in the US how do we make sure that
all of these haven't been hacked because
if they have been hacked then that also
open opens up for security
vulnerabilities or open opens up for man
in middle attacks so the reason they're
there is like so many tificate
authorities is that as a sale was
originally developed for for web
browsers right where the web browser
doesn't necessarily know where the
server certificate have originated from
or what server certificate that
corresponds to a certain hostname but in
your applications you almost always know
what server you're connecting to right
so for that reason is recommended to use
sat pinning and pin to that certificate
only or that public key only and it's
also good practice in terms of public
key pinning it's a good practice pin
against like
a couple of public keys so that you have
something for back up in just in case
the private key is leaked so you could
still have more than one accepted that's
that's more advanced design of course
and remember again not only validating
the certificate chain but also making
sure that this service ative kit is for
this hostname that I'm connecting
against and nothing else how many of you
have heard about afnetworking how many
of you are using it in upstream do you
have there is somebody using like
version 2 52 or older no one that's good
because there were vulnerabilities and
we're actually as long as you didn't
have any start pinning which few did
then it was open to men in middle
attacks so if you're using afnetworking
make sure that you have control over the
certificate validation that you use set
pinning and that you use the latest
version because there has been actually
at least two different vulnerabilities
that were pretty interesting for
attackers so time for some demos we're
going to look at mask attacks and a
simple mask attack where I have an
iPhone here it's going to be a lot of
switching because I need to load the app
from somewhere so I'm going to load that
through this cable but let's switch over
to the iphone you I so I have a couple
of applications installed and then the
one that I
should be the victim today is the skype
application from Microsoft I i love
skype skype is a good good service when
it when it's working they they had a
quite long downtime a couple of weeks
ago and but i'm going to do an attack on
the skype application and you'll see
that i'm able to replace the skype
application completely and take over the
sandbox of that application so i'm going
to inherit the sandbox data the
application so this is the way it works
before the attack looks before they
attack sorry and see if we can do this
right not supposed to let's go back to
the computer and so it's pretty obvious
that i'm not an app developer right
because or at least you see that when
you see my UI because i'm terrible at
making user interface programming but
this is just a simple wizard project for
for iOS to show this and you'll see the
bundle identifier of my sky up skype
application now is combed through sec
dot skype the bundle identifier of skype
is comrade skype skype do you think it's
not easy
yeah it is it's that easy so we'll see
I'm learning that over to the phone
running running running running so now
you see that all of a sudden the skype
application change the icon I decided
not to embed the regional skype icon
here because then it wouldn't be that
obvious to and you see if I click on
this then it starts my skype mask demo
and again did you notice the blink here
that the original icon is actually
blinking there so it's a bit confused
about whether it's so that's probably a
caching mechanism in in the main screen
right so it's that simple and as long as
I have an enterprise distribution
certificate then I could just sign my
own application with that bundle
identifier there's been several patches
on the mask attacks now so I think most
of the known mask attacks are patent
fully patched in 902 at least
yes exactly so that's the way to
circumvent or mitigate this more or less
that there are more explicit trust
warnings and things like that in in the
platform for the users because of course
it's it's hard to to define what bundle
identifiers that are reserved for the
App Store what bundle identifier that
are reserved for enterprise use only the
same goes for URL mask attacks with
custom you arise and if you've been
working with custom you rice games you
know that in the Apple documentation it
says that there's no clear definition
what happened there is no there is no
definition what app that's going to be
launched if you launch a certain custom
you awry and have multiple applications
installed that defines both that both
define this Kazmir I so skype has this
like skype colon slash slash if I define
in my application that I also support
that and it's not clearly defined
actually it seems to be last in that
that's going to be launched but there's
no clear definition that that's always
going to be the case and again well with
skype maybe it's obvious that maybe that
should be reserved for for the skype
application only but there are other
other you rise that might not be that
clear and that it can be reserved for
just one application so that's the mask
attacks explained and
let's go back to the slide for a bit so
i talked about xcode ghost and that
xcode ghost was an attack based on the
the fact that they actually repackaged
xcode but what I'm going to show now is
not under the assumption that we're able
to repack Xcode it's about injecting
code into an existing Xcode instance and
you'll see how that can be used to steal
your Apple ID developer account and how
it can be used to inject code into the
applications being built so let's see if
that works so the Apple ID you input
into Xcode to use as your developer
account and does anyone know where thats
sword make it guess keychain yes of
course so here's mine and if you looked
into the kitchen you know that there is
always allow access by these
applications and the only application
usually that's listed there is the
application that has created this secret
and if I try to access that using much
much simple utility keychain view the
user will get a warning saying that this
is trying to access the ID MSA apple.com
from your keychain and maybe some users
will click allow anyway but developers
your security conscious right so you
will not you will probably click the
night instead
but if we make the same code run in
injected into Xcode you'll see that and
notice the difference this is NS log
output you see the process name is key
or the program name is key to you and
here it's injected in Xcode this is not
my real password in case you're
wondering oops I forgot that would have
been embarrassing so the last part
talked about injecting code to write so
this was what we saw and basically
initializing Xcode up ladies dealer and
printing the password of IDM si tu
t'appelle com so what I'm going to add a
call to I know this is probably not the
best way to do it but this works that's
the only thing that counts if you want
to make a hack right so what what this
is going to do is this is a really
primitive version of of making a code
injection but this is going to subscribe
to the notification campus center add an
observer to that notification center and
then and when we get events internal
events in the Xcode process I'm going to
look for a certain event called ID
editor document change locations key
this was the best I could find yesterday
evening when putting this together but
this works and when I received that
event I'm gonna
run the inject method and the inject
method is gone check is this file that's
been changed or loaded is that abdel
delegate dot m and if it is i'm going to
write void injected at the end of that
file so if you want to make code
injection as a stealth-attack you
probably you're probably not going to
inject it in the source code for that
developer because the developer will
notice eventually did you add this I
didn't so but I think you get the point
right because this is executing in the
Xcode process so we have complete
freedom of where we want to put it so
now we're launching this and now we're
not xing it exiting xcode immediately so
we're launching a new instance and we'll
see in the skype project by the end
makes this work yeah it works so this
called injected so probably a better way
would be to like replace an object file
that's already been compiled just before
it's getting linked or something like
that and then it would be a lot more
difficult to detect right
do you think an antivirus was catch this
probably not definitely not on iOS at
least if if this would have been clumsy
attack like my version of it just to
show you clearly two you clearly that
this got injected then of course someone
would eventually detect it this was the
way well it was not in code injection in
Xcode but this was more or less the way
Xcode ghost worked but they were using
in a repackaged version right so to
summarize there are several great
security mechanisms in iOS and there are
still burner abilities as well maybe not
that many in iOS 9 as it was in iOS 8
and not that many in iOS 8 as it was in
iOS 7 and we're probably going to say
the same when its iOS 10 right but now
we know a lot about one were built this
in iOS 9 that we didn't know by them so
don't rely on the platform completely
but of course we should still utilize
the fact that we are somewhat isolated
and that apps Transport Security gives
us better tools to protect our secure
communication for instance but because
of these security mechanisms and that
Apple has raised the bar so high then
attackers find new ways to circumvent
all these security features to use
enterprise applications signing instead
and to use for instance that attack the
developer environment because OS X is a
less secure platform than iOS how many
of you by the way in when talking about
sex how many of you are using have their
gatekeeper set to accept App Store apps
only know one because that's the best
the best option right but still there
are vulnerabilities in gatekeeper that's
been published by a guy called Patrick
waddle he presented it just a couple of
weeks ago so there are ways to
circumvent gatekeeper as well so it
doesn't matter right now what setting
you have so we need to be cautious about
what software what useful tools that we
are downloading and installing on our
development machines we we often try new
tools at true sick as well but we use
virtual machines to isolate that testing
and keep that away from our original
development environment the virtual
machines is extremely useful if you just
want to test something and then you can
snap shot and you can revert back to
that snapshot after testing that's a lot
better rather than this realizing that
this infected my machine completely I'd
like to recommend we have a full
security day and together with our dev
in malmo it's in november i think it's
november third november third so if
you're in mountain by that time and stop
by and join the security day it's going
to be a lot about security for
developers remember to rate the session
and there oops that was supposed to be
one more slide and but there is not so
that's it thank you very much
so I got one question that came up
during the session what is the
definition of a mask attack I think you
might have explained it during the
session but I was also wondering if you
could maybe explain a real world
scenario of a massive attack yeah that's
a good question and there is as far as I
know there is no like agreed definition
of what a mask attack exactly is it it's
more or less becoming like the name of
attacks where you and where you try to
mimic another apps behavior or try to
replace another apps behavior in the
platform so that's basically what it's
all about and um and this the the the
most common use of this is of course to
to bypass the restrictions of the
platform to steal data out of the
sandbox that might be tough to access in
other ways and there are actually
examples of mask attacks where you can
get higher privileges than other regular
applications camp for instance there is
something called plug-in mask attacks
and where you can write an application
that acts as a plug-in to the vpm
framework so that that plug-in is able
to eavesdrop on communication being sent
through the VPN tunnel still if it's TLS
or as a cell protected then clearly it's
not possible to eavesdrop but plain text
communication so that's also a typical
scenario okay thank you I think we all
of them yep thank you
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>