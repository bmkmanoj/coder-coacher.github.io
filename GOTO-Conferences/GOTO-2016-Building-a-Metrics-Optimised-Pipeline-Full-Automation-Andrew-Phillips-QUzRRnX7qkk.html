<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2016 • Building a Metrics Optimised Pipeline (Full Automation) • Andrew Phillips | Coder Coacher - Coaching Coders</title><meta content="GOTO 2016 • Building a Metrics Optimised Pipeline (Full Automation) • Andrew Phillips - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2016 • Building a Metrics Optimised Pipeline (Full Automation) • Andrew Phillips</b></h2><h5 class="post__date">2016-08-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QUzRRnX7qkk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thanks everybody for for staying late
and the last person like it's a terrible
place to be I'm like it's a beautiful
day outside I'm between everybody and
beer so that's not another good place to
be so thank you for staying also one of
the things i should say i mean those of
you who go the lots of conferences will
have seen this you've had an amazing set
of speakers here it's been a really
really high quality set of talks and i
really hope i can finish up with
something that that lives up to that
particular level so you know thanks to
go to for organising a great event and I
can sort of now say this having tried to
organize conferences myself it's
incredibly hard it's really there isn't
that there's so many emails you have to
write just like you need your own mail
server it's really really crazy so I
think there's something not quite oh I
see stuff on that slide there we go I
think we're all set so let me try not to
speak too fast because I have a lot of
stuff and we don't have all that much
time um first things first like I'm not
going to spend too much time talking
about me because you can read the me me
me slide in extraordinaire from the site
basically I've done development work
I've done ops work I've spoken to
executives in a suit and I've also i'm
now getting my hands really really dirty
with a fantastic a big data AI platform
running on spark with a bunch of all
kinds of other junk and node
applications and it's really fun to get
my hands dirty again I've spoken at a
bunch of conferences and I do a bunch of
others crazy stuff like that that's me
at the bottom there so you know that was
actually fun jump i'm actually not on
that formation yet but anyway so as I
said like this is me as well because
that's you and there's beer so I will
really try to to keep things short I am
well aware of my position in the order
here so what's the plan for this last
talk of go to Stockholm 2016 I'm going
to try and do something we've had a lot
of very interesting technical content
and there's no IP tables in my
I can show you lots of IP tables but not
not now i'm going to try and do two
things i'm going to try on the one hand
to strike a balance between you know
giving you some thought-provoking ideas
around continuous delivery especially
and on the other hand give you something
where you know when you go back to work
tomorrow in the real world implodes and
your inbox is full you actually feel
like you have something you can take
away and really do now one of the
challenges I always have as a conference
at in these incredibly motivating if
you're lots and lots of great stuff and
you go back on monday and the web
servers down and the inode table is full
or whatever and then you know the real
world intrudes and all these lovely idea
is just like crew back to writing shell
scripts so the plan really is to give a
very brief intro to the extent that
that's necessary of continuous delivery
i'm sure more likely than not you're all
just entirely sick of the subject i'm
going to then do a little bit of that
sort of thought provoking stuff and try
to reframe it along a couple of lines
and then we'll dive into you know what
you read in the program know it's like
metrics metric metrics and they'll talk
a bit about micro services and then
we'll finish up by looking a little bit
beyond like the the go-live moment and
to see you know what we can do with that
so there's a warning people who've maybe
been to my talks before know I'm a kind
of like I like to engage the audience if
you have tired arms bad luck like I will
ask a couple of questions and just
because I think it helps give a feel for
where we are so let me start with the
first one who works in a company of say
less than a hundred people on the whole
bunch and maybe between a hundred and a
thousand like large enterprise like
5,000 plus okay so that's about the
third to third to third an interesting
mix so we'll have a very big spectrum of
experiences or maybe one other question
and I probably will see some correlation
here the time it takes on average in
your apps so of course if you're a large
company you'll have thousands and
thousands of services it's very
difficult to get an average but
something that wasn't written 50 years
ago how long it takes from the moment
like a line of code goes into your rep 0
to the moment it goes into production
less than say a day okay up to a week
like three times a year four times a
year
stuff there's still a few don't be
ashamed all rights and we know it's not
your fault okay so yeah there there is a
mix and I think this is part of the you
know the challenge of the industry that
we're in is that not every application
written is brand new like in fact we all
know the majority of the life of any
line of code is in maintenance ninety
percent of it so well there's lots of
fantastic ideas and you know sure
everybody would love to just migrate
everything over to the the next latest
and greatest thing we've been there
before it was you know web services and
soap remember that similar kind of
everything must go to soap and they'll
have a service-oriented architecture and
will be great so the reality is stuff
that we have stays around so let me just
one quick question I guess everybody's
heard a whole bunch of CD I'll phrase it
the way I like to phrase it and you'll
see so the similar but maybe also a
little bit different basically for me
it's about trying to figure out how to
have a reasonably continuous or an
ongoing flow of ideas or features or
whatever you like to call them to your
users it sounds very abstract and high
level what that sort of typically means
of course in practice is that you have
some way of going from stuff code to
production systems on a reasonably
regular basis and and that could be
fully automated typically if you want to
go really fast there's no really any
other way to do it but it could be
something manual that kind of stuff the
main characteristic of one of the other
main characteristics for me is that it's
moving away from this big bang release
like we all know what releases looked
like they usually look a look like this
right so you've been working for months
and months and months and there's
enormous list of features that you've
implemented and then you've had like
four weeks of merge hell because you
know everything is broken in the
repository and then you skip all the
testing because you don't have any time
and then release day comes up and then
they open the floodgates and then and
then 10 million production issues come
out and it's really super painful so we
really don't want to do this anymore so
that's really I think to a large extent
what continuous delivery is about why
well I mean there's a couple that the
third reason to some extent is usually
why the manager of signs off on it
because it actually reduces risk which
sounds very counterintuitive you know i
don't know if i got a swedish krona for
every time i had the discussion wait a
minute you're telling me to do stuff
faster but you
reduce risk at the same time how is that
possible well we all know it's you know
by doing small making smaller changes by
not you know releasing the entire basin
but a little trickle of water into the
production environment then you reduce
your risk I think from a developer
perspective or even from a development
manager perspective what may be more
interesting about continuous delivery is
that fast feedback cycle it's nice as a
developer to get reasonably quick and
efficient feedback I mean that's
partially continuous integration but the
more we go to services that need to talk
to lots of other services the more you
really need to test in a semi connected
environment to get realistic feedback
and then there's the sort of managers
version of that which is if we can get
stuff into production more quickly we
can become a more responsive
organization that sounds very nice of
course the challenge in selling this to
your manager it's very difficult to put
like a dollar figure on to the idea of a
more responsive organization but we'll
see this topic come back a few times as
we go through this so what are the
motivating numbers I mean everybody's
seen these they're incredibly boring
you've seen them a million times like
there are some really cool companies out
there that have some pretty staggering
numbers like Amazon something goes to
production every seven seconds or
something like that of course they have
lots and lots of services so that's not
like every application at eleven second
and I think one of the problems with
this set of numbers originally was that
people saw it and they're like yeah but
I work in an organization for Willian
doesn't have 10,000 IT people who all
the smartest graduates that we could
find we have other jobs as well and I t
is just a supporting function and I
think one of the big changes last year
and really that the lesson of this slide
is nothing more than like it doesn't
really matter what organization you work
in continuous delivery can be done in
your type of organization as well I
think that's a key lesson to take away
because it takes away some of this yeah
but only the Amazons and the NCS of this
world can do this and admittedly the
kind of benefits that these companies
get out of it aren't the same
necessarily but they're still incredibly
significant and the fact that you know
the managers in these boring
organizations this is just big corp a
corp a corp if you're not familiar with
them they feel that this is worth doing
and worth investing in that sort of
means that there are now more and more
examples that if you want a much longer
list go to the
DevOps enterprise summit you'll find
tons of examples of large corporations
from pretty much every vertical defense
aaron aeronautics pharmaceuticals
they're all doing something in this area
i think we did this already oh yeah so i
talked about these three benefits i
think there's two more that they're kind
of interesting and I'd like to focus on
these a little bit because we'll come
back to those and they're kind of like
version 2 if you like or level 2 you
know if you've heard talk about moving
to product teams or the Spotify model
which I guess here people should be
pretty familiar with and this idea that
we need to move towards more
experimental organizations these are
other things that can come out of CD or
that CD is a kind of foundation for and
we'll revisit this topic a little bit
later because it sounds a little bit
more nebulous but I mentioning them
because I think in terms of when you
come and think about what CD might mean
for your company having this in your
context is very important and so with
that let's get to this discussion of
what this kind of context might look
like so the typical kind of CD pipeline
that you might have read about in the
book or that you might be thinking about
when you think of your own installation
something like this like bang source
code commit and then we do some build
222222 and then we you know the bill
passes we do some functional testing to
delete it today and then we do to
employment and then yeah everybody's
happy that's great and that's very
useful and convenient or maybe your
pipelines a little bit more funky like
you know it's not that trivial you do
some stuff in parallel and you have some
Dockers thrown in there to know spin up
some more smarter but what however
complicated that particular pipeline
looks like what I'm trying to get at
here is that in a lot of cases people
think if a pipeline is a device of some
technical nature to enable a commit to
production flow and that's okay but i
think the following is i say you're an
architect you're building an enormous
skyscraper and you're the chief
architect that's you there and you know
you're trying to think of this whole
project like there's a lot of stuff that
needs to be done and then somebody comes
up to you one of the workers and he says
oh look we've just received consignment
blah blah blah blah
random identifier like a get sha then to
be honest what you're going to do is
like her because at the level of a large
project a commit means nothing it's just
it's it's nothing it has no relationship
to the overall large thing so to have a
system that is great at moving commits
into production it doesn't help you
understand anything in terms of the
global context of how are we doing how
well are things going and so I think one
of the things we need to start to think
about in terms of having the right
context for continuous deliveries not to
think about commit to production but I
dear to user it's about a flow of ideas
or features or whatever you want to call
them and of course ideas and
organizations come in very different
sizes like there are certain features
that are really sort of commits eyes
like we want to change the sort order of
a list or something like that and then
it makes sense to have this pipeline
because you have a nice commit message
you know it's a JIRA issue and then
change sort order of list and then you
watch it go into production you see oh
yeah on this particular day we deployed
that and that relates to this business
feature bingo we're done but there are
many many other ideas that your business
cares about or your team's care about
that they're way bigger than a single
commit there are things like we need to
support you know finish or whatever
Japanese is a language like that is a
and especially as we start breaking down
our applications into snow not
monolithic things where you could do all
the work in one enormous repository but
where you're basically trying to modify
10 15 20 different services this work
it's not commit sized and so this sort
of simple pipeline we have here that
goes from committee production really
doesn't help you understand certainly
doesn't help them if you try to look at
what we're delivering to our users it
doesn't really help you understand where
you're going and so you end up with a
sort of pipeline structure that looks a
little bit more like this so it starts
out with this you know first of all it
brings in the notion of an idea or a
feature and this lives in wherever you
keep your it could be Trello it could be
XJ it could be a confluence it could be
a boring requirements management tool it
could be MS project whatever
but you need to have some kind of
relationship between the idea and the
stuff you're developing and then of
course that idea will be broken down
into work that one or potentially
multiple teams have to do and that each
one of those teams may be owning one or
multiple services and then each one of
those services or repositories or many
applications or whatever you'll be doing
work in each of those and then that work
will be going through the pipeline
that's at least the traditional picture
and it will be going to production and
once you can establish this link a
little bit then you can start to sort of
understand well how we doing with this
big idea or how much of the big idea is
done but of course this is kind of
tricky because you know in an ideal
world all these commits that the
individual teams are making a sort of
independent of each other and it doesn't
matter you can just put them into
production and if the magic switch isn't
enabled then nothing happens who here
knows the term dark launches doing your
rmx now there's a few who feels that
they have a production-ready capacity to
actually do doc launches so there's what
so so that gentlemen go talk to him
because I think he knows something
that's really really interesting and
important basically you know this
canonical model that you know you have
all these independent teams you have
pipelines for the individual repos they
just run through the production doesn't
work if you have work that needs to be
coordinated unless you have some
sophisticated ability to get the code
into production but somehow not activate
it so your users don't see it so it
doesn't break basically we can't always
just take the stuff and put it there as
an aside by the way I'm sure you've seen
this kind we talk about micro services
and containers how they make everything
flexible and then people show this
picture me this is like the weirdest
thing because that is the the biggest
Big Bang picture that you've ever seen
is like load everything onto an enormous
boat and launch it and won't go that's
ridiculous like microservices look more
like this individual things like
uncoordinated with each other just a
random thing at these events that also
astounds me like getting back to this so
what happens because it's actually not
that easy to have these individual
trains that sort of go to production
independently of one another is we end
up seeing this kind of release train
pattern and if this is the pattern that
you end up having then you're in very
good company face
book does this lots of very cool
companies have not solved this problem
if you like they solve it this way so
you have you know those individual teams
and they make their nice commits and
then each component gets tested to a
certain level of reliability or a
certain level of confidence and then you
push that into some artifact repository
you know are the factory or Nexus or s3
or your file system wherever you want to
put it a thumb drive and then once a day
or once a week or once a month or on
demand or whatever you pull the latest
and greatest release candidates and then
you do some kind of integrated testing
and then you go forward to deployment
and I think there's a very interesting
question you because this this sounds it
sounds fancy if you call it a release
train but this is a big bang it's a
smaller bang maybe than doing it once
every six months but this is still a
reasonably sort of big ish bang approach
we're moving lots of things into
production at the same time there's
still more risk than if we can do them
individually now I wish I could come
with some sort of standard answer to how
to solve this problem i think the real
answer is that there are no easy answers
i mean us dark launches are certainly
the canonical way to address this and to
look at it there's a more radical
approach you can take and which day
farley who is the co-author of the
continuous delivery book somebody who's
thought long and hard about this problem
says is that software projects are just
wrong like thinking of software as big
batches of work that need to be done and
coordinated and delivered it's just
bound to fail it's just the wrong
approach for developing software so we
should get rid of them poof well if you
work in large enterprise that's got to
be an interesting discussion to have
we'll just scrap solve the idea of a
software project will move to ongoing
product teams I think Dave certainly has
a point and it's well worth reading his
blog post because I think he goes into
some interesting detail to justify this
assumption but the idea that sort of
software projects a really bad idea to
me only go so far because if you think
of the notion of sort of continuous
delivery the classic examples you get
are exactly the ones like I'll change
the color of the homepage or you know
make a little tweak to the icon tweak
the CSS basically small tweaks and small
tweaks in the sort of maturity cycle of
a product they help really at the
beginning here right so that's when you
you know you start out you really don't
know quite where you're doing
you you realize something then you can
make small tweaks you can get a lot
better but the reality of small tweaks
is that they fast or fast reasonably
quickly approached some kind of
asymptotic level there's actually not
that much you can squeeze out of a
particular product or feature by
incrementally improving it so you reach
this kind of point of saturation which
is almost impossible to see here at some
point you have to realize that you're
hitting a point of no return or
diminishing returns and then you have to
make another big leap the Great Leap
Forward I guess of innovation and so
Spotify again talks about this in much
more detail how you have to like pair
this notion of tweaking stuff and then
you have to really risk something and
try something big and then if that works
then you can tweak it again and that's
the way you kind of keep growing so even
if we get rid of the idea of software
projects you still have this this moment
in your life cycle where you're making
big changes as opposed to small changes
and I think the only consequence I can
draw from that and I've seen this work
pretty well and a bunch of organizations
is to accept it you know you are going
to have multiple pipeline patterns
within your organization especially
those of you who are more than 100
people and even those who are less than
100 people as your single product maybe
matures over time the kind of pipeline
pattern that is relevant will need to
change so you need to sign the think of
an approach this all right metrics
metrics metrics so I spoke a lot about
like this the importance of this
beginning piece of the pipeline which is
really not automation at all it's it's
just like remembering that there's an
idea behind stuff now let's focus on the
other bits that is really the automated
part of the pipeline the kind of classic
bit that we know and you've got like
puppet or mantle or chef or dock Roku
pernetti's choose your poison as like so
many of them out there um one of the
things I think that's worth pointing out
is that often the discussion in this
area is around what kind of provisioning
to all do we need what kind of OS do we
need what kind of cloud provided we need
and that's all important stuff but that
stuff is really I mean that's an enabler
the pipeline isn't there so that you can
have a bake-off between puppet and chef
and sold and ansible like the point of a
pipeline is to give you data about your
product or project right it's to give
you just enough data so that you can be
confident that you can hit that big red
button and that if you hit that big red
button good things will happen
the automation is just a way to make
that work and what's the reason I'm
emphasizing this is because for a lot of
people testing is like the thing we do
last in the pipeline will figure that
out once we have the automation done
which is totally back to front if you
don't have tests in your pipeline your
pipeline is just a big automated
accelerator into risk land that's not
particularly smart and I've lived
through that so you know it's not that
I'm saintly basically the question is so
I talked about you know a pipeline is
there to give you confidence to release
but what can you be confident of so
you've got this room you've got this new
version out there it's like the best
thing you've ever built and you want to
get it out there into production so can
you be confident that this version is
going to be so good and just just better
better than the one you have out there
right now and if you talk about pure
functional use cases yes you probably
can you can count the number of
functional test passes and you can count
the number of functional test passes in
the new version then you can do a count
you know X greater why but better is
more than just functional test cases
that you've ticked off and I think the
reality with modern complicated
distributed systems is that it's almost
impossible up front to know for a fact
whether the system is really going to be
better in all aspects like I'll give you
a nice example I'm getting my hands
dirty with an AI system right now really
interesting machine learning problem you
know parsing data and I'll pee lots of
cool stuff like it's impossible to know
before you go live what your performance
is versus the current version you can
make a statistical estimate but you
don't know for a fact and you have to
measure quite a long time after you go
to production to really have some kind
of statistically significant solution
and the same goes for load testing I
mean I think well let's skip this
question I'm getting a bit shorter time
so i think the other type of confidence
you can have is that it won't end like
this and it's really important to keep
these two apart like one is confidence
that you're actually going to get better
and the other is confidence that you're
not going to fail catastrophically those
are two different things and it's much
much much easier in a pipeline to
determine whether you're at risk of
failing catastrophically or not than you
are to actually know whether you're
going to get better unfortunately if
we're trying to talk about preventing
catastrophic failure
then the kind of classic functional and
static code analysis cyclomatic
complexity all these kinds of so they're
pretty useless a telling you whether
your system is going to survive in
production when you get out there that's
why I'm here to talk about architectural
metrics so not cyclo metric code
complexity what I mean by this is the
kind of information that you know we can
collect about our systems that will tell
us whether it can scale whether it will
perform and so on and that's very hard I
mean I don't know you know I think we
all know setting up a load testing
environment that has sufficiently
accurate test state and performance and
behavior that we can be really confident
that it will replicate what happens in
production incredibly hard takes forever
you certainly can't do it on the sort of
day by day basis and the trick is you
don't actually need to replicate
production performance to get an
indication of whether you're going to do
something catastrophic Lee wrong all you
need is anomaly detection like you need
to you know you need to be able to have
a baseline for what kind of metrics we
expect the system to have and if it are
if it goes really crazy then you have a
problem so for the next couple of sides
thanks to Andy Gardner he's a
performance guy from Dino trace he got
some of these metrics out we did some
work together on this problem so here's
the kind of use case so we have some
tests like we all know this Oh test case
these are just standard unit tests and
you know they're good and then bang we
break something okay and then the
developer goes in and fixes the code and
oh look it's green again and everybody's
happy and then we deploy to production
everything dies and then we ask
ourselves why the bill was Green what
went wrong and so imagine that you could
have these numbers you could measure not
just red or green on your functional
tests but also things like how many SQL
statements are you executing how many
exceptions are being thrown what's your
CPU utilization blah blah blah so this
might look like this everything looks
okay and then we obviously we have a few
errors because stuff failed well that's
unsurprising then we fix it but by
fixing it we now we tweak the hibernate
configuration to do n plus 1 loads lazy
loading versus whatever and now suddenly
our functional tester all green but
we've totally changed the
characteristics of our system this is
the kind of stuff that brings down your
systems in production you scale up
suddenly your database has 10,000
connections open to it everything dies
like that's catastrophic ly bad and you
will not see that from your functional
data so the point is can we make use of
this information during our continuous
delivery pipeline to give us kind of
architectural confidence in our system
and the good thing is that we can of
course and I mean this is one of these
like you can take this home tomorrow
because it doesn't matter what tool you
have chances are you have some kind of a
PM like tool or nagios or New Relic or
something like that data is in there
that's the data you need what you need
to figure out is how to incorporate the
data into your pipeline and some of the
tools do better than others in doing
that for you automatically but you have
the data like it's all there you don't
need to do anything funky so long story
short what we typically measure in terms
of metrics for our application during
testing is like this stuff did test fail
how long did it take and this is the
data that's actually still there that we
don't use or we use very rarely and
there's much much more than this
obviously like you know how many layers
of overlay networking how many bounces
through H a proxy blah blah blah blah is
there's so much stuff that can give us a
much better level of confidence and we
really don't use it so I'll give you
some instant examples because I see I
have like 8 minutes left so here's a
couple of nice examples and how does
this relate to microservices well all
these examples relate just as much to
micro services as to any other
application microservices is especially
important because it's those of you who
are thinking of trying to transition an
existing application to microservices
you are going to be making fundamental
architectural changes to your
application so it's almost inevitable
that you will be fundamentally changing
the architectural characteristics of the
application and that will go wrong no
problem that's that's how we do it right
we do it we fix it we learn but this is
especially important and I'll weave in
some microservice specific examples is
so this is an interesting one very
simple so what was happening here well
the functional test passes but you've
got missing files they delay the
response time you've got you know you
factor something out make lots and lots
of calls instead of bundling them up
into one there's just lots of traffic
going on there overlay network stuff is
slow lots and lots of stuff going into
the database not very good and if you
know this could be 10x from what you had
before and so then this is the kind of
stuff you
want to know here's a micro servers like
refactoring example where they pulled
out the front me this is this is really
bad microservice refactoring if you ask
me because it's classic service oriented
architecture pull the layers apart as
opposed to pull the business functions
apart but they pull the front and out
into a service and then they pull the
the detail thing out into a service and
then they had a storage service
otherwise known as a database but but of
course they messed up a little bit so
first of all they forgot to have all the
access going through the middle tier so
you had that happening and of course
they you know because if you write a
nice API bulk queries look oh they look
ugly so you just make them query one by
one but suddenly you're querying all
this stuff over a network and then you
know what was happening in practice here
is they were getting an account and then
for the account they were getting the
details and instead of one batch call to
the database do get me these 50
customers with all their details which
is a joint on another table they were
getting 33 times the details is a
separate call blah blah blah blah and
that takes a long time and that breaks
I'll give you another example for which
I don't have such a nice such a nice
graph because this is one we used to
experience recently um Mongo sort so we
had a we had a query we're running a
query against Mongo it had a sort and a
filter and everything was running really
nicely and then we changed to tweak the
query a little bit and we ran into
something fun called Mongo split query
script but index stuff so long Mongo is
able to join indexes that you have but
not under certain really small edge
cases and we ran into one of these edge
cases which meant that instead of the
filter happening in the database the
loading everything into memory of that
the the sort return and all that the
query returned and then trying to filter
and sort it in memory and it went bang
unsurprisingly but this is the kind of
stuff memory usage of that node would
have shown this like immediately so this
is the kind of data that's important and
so what does this look like well you
know in some tools this is Dinah trace
you get this really fancy graph and all
your tests what's important here i think
the interesting bit is this auto
baselining stuff like that's what makes
this work that it doesn't really matter
what the metrics are or even whether
they're a hundred percent production
equivalent what matters is you can track
them within a range and when they go out
of that range you get
a big alert and then you know that you
include them in your pipeline and then
they're just simple tasks that happen
somewhere along with all your other
stuff so pipelines they're about
gathering data it's much easier to get
to the level of confidence that you're
not going to break stuff catastrophic
Lee and architectural metrics are really
good for that right beyond go live
interesting bit so i'll come back to two
statements I made at the beginning of
the presentation one is that CD is not
about commit to production but it's
about ideas to users and the other one
is that you know it's actually hard to
gain confidence about how well your
service will be exactly when it goes to
production so the the logical conclusion
I guess is well the pipeline shouldn't
stop when we go to production like users
are not they're not sitting on your
production servers there somewhere else
they use your service later all that
kind of stuff they use it through mobile
devices whatever and similarly that's
what you need both the time and the kind
of distance in the pipeline so you need
to extend it beyond the go-live you need
to say okay now we do the deployment and
now we need to go and figure out whether
we actually did anything useful but what
do we measure what do you measure to try
to figure out whether your service is
good and again this unfortunately turns
out to be a surprisingly hard problem
all these tools give you wonderful data
though you can get the low level
technical stuff server CPU usage you can
get some higher level stuff like you
know revenue rates and conversion and
you know clicks from Stockholm Central
or whatever so there's a bunch of data
you can get but that just because the
data is in the dashboard doesn't mean
it's the right data and I'm just going
to give you some ideas because I don't
think there's a right answer there's a
lot of technical stuff but what we're
really trying to get at is to try to
understand the user experience and you
can see companies trying different
approaches to this problem so some of
them you know they have that feedback
button if you've used some SAS
applications there's a little boring
that pops up you like this new feature
they throw stuff in your face they ask
you for surveys I know other companies
monitor Twitter you know get the social
dimension to try to see what people say
about the service they look at referrals
you can do traditional UX testing
obviously a large element of this is
heavy client-side telemetry like
instrumentation actually write code in
your code to figure out how people are
using it and why is this interesting why
is this in
important because it can lead to this
magical notion of more user-focused
teams I had an interesting discussion
with someone from netflix who said look
you can build all the pipeline's you
like until your organization accepts
that your product managers don't know
everything and that you're actually just
as likely to get ideas wrong as you want
to get ideas right you will never be
able to compete with us pretty
aggressive statement but he was he
wasn't saying it sort of to make Netflix
look good it was more than saying it's
not about the technology it's about that
cultural shift and I mean so Amazon this
is Amazon's number one leadership value
customer obsession like I know because
I've been in them there are meetings in
which somebody from amazon says they
have some technical discussion they say
what's best for the customer and that
decides the decision this isn't easy
like this is an interesting study
Microsoft did with an interesting link
like about even amazon fifty percent of
the experiments they put out there fail
microsoft they reckon about a third of
the features they put into being i have
a positive impact on the user about the
third do nothing and about a third have
a negative impact on the user experience
that's the reality of thinking about and
delivering features in software and of
course this is not like i need to you
know there's a financial regulatory
compliance thing and i need to be able
to send back this xml document that
we're talking about different kind of
requirements here but the challenge here
is if you want to get to that level it
requires organizational and cultural
change this is mad men's like an
advertising series from the 50s and a
lot of this is to some extent outside
our hands where we are in the
development or IT area this is really a
product management culture question an
organizational leadership question but
that's what the really successful
companies use continuous delivery to do
to leverage the power and the
imagination of their developers by
hooking them up with their users and
admitting that the best thing we can do
to be a successful company is to let
people try and try safely and fail and
then roll back and try again so some
takeaways really quick you can read the
slides i have 30 seconds CD is not about
ideas is about ideas to users not commit
to production and as your application or
service goes through phases you're going
to have different patterns for your
pipelines think about using the right
kind of metrics to get confidence when
you go live and think about how you can
go from
sort of just build what we tell you
culture to an actual experimental
culture so we're almost there just for
fun because it's always good for people
to learn something totally different
there's a character called the zero with
joining this has nothing to do with
continuous delivery but it's fun it's a
Unicode character and what it does is it
makes characters be connected so this is
important in certain languages in Arabic
and other languages where you can
basically by adding this character you
can see you get a totally different
thing but the reason I'm showing you
this at the end of the conference is
because you can use it for fun stuff you
can use it with emojis so you can take
these four characters which a man woman
girl boy and you can add this zero with
Joyner and then you get this isn't that
cute so the one of them is Android one
of them is iOS so yeah that fun stuff
and with that please remember to rate
the session rate the conference I hope
you had a really good time thank you
very much so a couple of questions
because it's the best the emojis line up
anymore what tools are you using for
architectural data testing ha so we are
duct taping together what we have right
so we have new relic that was there
before I started messing with the system
so we are using that and we're hooking
that up into our circle see I flow which
is our pipeline and of course for some
of our other products we're using our
own product so we dog food our products
oxo release uses you know the new relic
data or we have some nagios stuff and
we've hand written some instrumentation
as well so we basically use a dtrace and
some of those things to get some low
level metrics but our use of this stuff
obviously only goes to the point you
know where we feel we have enough
confidence I mean this is not the thing
where you say oh good I heard this nice
idea of the conference let me spend the
next three weeks adding all these
metrics in there what you need is
confidence to to go life and if you feel
you already have that and in practice
things don't blow up then you're okay
it's once you start to see that maybe
things don't always work out too well
that's when you need to start to figure
out so what kind of problems do we have
in our application what would it make
sense to measure okay so of all the
metrics that you use which one do
the most important for JVM applications
typically memory so memory usage because
that's you know memory leaks that kind
of stuff file descriptors is another one
depends a bit on the kind of application
for container based stuff anything in
this sort of micro service e container
based environments network the size of
stuff going over the network and the
number of network calls is a very big
component because you know anybody who's
run docker composed up on their local
machines lovely its localhost like group
everything super fast but then if you
stick it on a marathon or a mantle or a
kubri Nettie's cluster and maybe you've
got it hi available across multiple
availability zones and suddenly your
service scales out to where some of the
nodes are in a different asean as we all
know amazon's network connections across
different az's or are not so great so
yeah having a good handle on how much
network traffic you're paying around is
really important good that's it thank
you very much thank you gibbeh now</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>