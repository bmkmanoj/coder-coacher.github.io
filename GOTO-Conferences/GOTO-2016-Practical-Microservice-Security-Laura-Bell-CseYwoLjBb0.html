<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2016 • Practical Microservice Security • Laura Bell | Coder Coacher - Coaching Coders</title><meta content="GOTO 2016 • Practical Microservice Security • Laura Bell - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2016 • Practical Microservice Security • Laura Bell</b></h2><h5 class="post__date">2016-08-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CseYwoLjBb0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right good morning
that was my nice Mic Check sounds loud
to me can you all hear me alright
fabulous are you all caffeinated yes
good awesome that's even better
my name is Laura and if you like their a
screens each side you can find me on the
Twitter's as lady underscore nerd I
mention this because the underscore is
important the real lady nerd does not
understand micro-services all security
all like people who find me after a
conference so please find the right one
all right okay so this talk is being
recorded so please excuse the slide this
is for the people who are going to watch
videos at home we are in a fast-paced
industry really really fast-paced so
this is all relevant for today all of
the examples are pulled from the last
couple of months some of it from the
last couple of days but if you're
watching this at home please make sure
you're watching the latest advice for
whatever field you're in because
seriously there is some scary stuff out
there okay so who the hell am I and why
am I on a stage here you can tell by the
accent I'm not from around here I live
in New Zealand I'm from the UK
originally and I run a small security
phone called safe stack I'm not here to
sell to you which is a beautiful thing
because I live thousands of miles on the
other side of the planet so what do I do
well I've spent the last ten years doing
bad things to good people code to good
people in general lying cheating and
stealing and doing a bit of software
development on the side this is my
window in my office
it's my Kanban board we spend 50% of our
time doing software development and
building things and 50% of our time
helping very fast-moving companies do
security and that means doing security
in a way that doesn't get in the way of
doing awesome things because please
raise your hand if you think Security's
the cool fun part of your job just me
right
good all right so what are we going to
do today well we're gonna look at some
fundamentals obviously you've got to
start at the same place and I'm not
going to
sumption 'he's about where you're all at
we're not all the people who wrote the
book on a subject we don't all get to
use unicorn technologies and we don't
all go clad first all of the time I know
this because I work with people just
like you we're going to talk about
prevention and how we prevent some of
the attacks are gonna happen against
your micro services your micro so Sarka
textures and then we're going to talk
about detection because actually
prevention is an impossible puzzle
you're never going to be a hundred
percent secure we may as well give that
up just right now if you came thinking I
will be safe at the end of this no sorry
you're screwed
but we're going to talk about how we
know that we're in trouble because
that's just as important so let's start
at the beginning this is how we used to
build applications I don't like putting
code slides up very often because well
most you spend time looking at my syntax
and I'm what they call an ops coder
which means that I've written some of
the dirtiest C++ you'll ever see in your
life and I'm proud of it I write Python
day-to-day you're just going to judge me
by language choice so this is a monolith
it was a big piece of naturally evolving
source code which basically meant we
gave some interns of project to write
once they wrote a really good little
project we've put it live on the
Internet and 15 years later we inherited
it and somehow that is still life and in
production we nice split back into lots
of little bits and pieces each with its
own age and story sometimes each with
its own technology that's where we are
right now why is this important for a
fundamental because what we're talking
about is we've changed our attack
surface we've changed our architecture
we should know the basics of Microsoft's
is by now you've literally got the
person who wrote the book in the room
running this this kind of track today so
you know I don't need to go into this in
depth but we know the benefits of that
that are there for someone like me
however someone who has lived in the
dark places on the Internet has spent a
lot of time breaking things it changes
the way we have to approach security a
little
I'll have to excuse the voice I've flown
in from New Zealand and somehow caught
airplane plague okay right so what do we
care about security before we get into
the prevention and the detection all of
the practical so if you want to get on
with let's get a couple of foundations
straight there are three things I care
about as a Scrooge person I care about
confidentiality so if you trust me with
your information and you only trust me
to give it to one person in the entire
world then that is my duty of care
that's what I have to do how many of you
worked for an organization that stores
data for other people good awesome most
of you in software jobs then that's good
it's what we do day in day out we are
secret keepers for all sorts of people
whether that's card information or
personal information health information
it doesn't matter what we're storing you
could be writing tinder for French
poodles it doesn't matter you're storing
something for someone else integrity if
we start with our data inform a we want
it to be form a at the end or at least
we need to know what form its gonna be
in and availability let's not forget and
a lot of people say well a secure system
just turn it off and wrap it in concrete
and put it the bomb the ocean that's
your secure system it's just not true so
secure systems are available systems
their systems you can actually get to
and do the job you want to do security
people we're not actually the main
attraction here we are like side caste
we are here to make sure what you do is
amazing and people can use it because if
they're not using it we don't get paid
and I quite like being paid so the last
bit of our foundation is the types of
things we're going to care about in this
session so if any of you've done threat
modeling before you'll notice this is
the set of stride threats that we look
at it's the common six security risks
faced by most applications so spoofing
tampering repudiation information
disclosure denial of service escalation
of privilege these are the things that
are our path as an attacker to getting
the good stuff this is what I am doing
when I am attacking application to try
and get to
data or to other systems you control and
don't forget I might be doing these
against you I might be doing it against
your user base I might be good doing it
against one person to get to another
it's not all as simple as we like to
make out so let's start with prevention
how on earth do we stop getting attacked
in a micro service space because
hopefully we get all of that bit perfect
we never get attacked and then we never
have to worry how many of you sat there
going I've never been attacked so it's
awesome I must be doing it right already
anyone there's not only one person even
if in your secret self you're like yeah
I've got this prevention is actually a
big area and we spend almost all our
resources on it but it's what we call an
asymmetric problem for every developer
out there there are 10 attackers doing
vulnerability research or looking for
some way to forward their objectives and
motivations so when we try to prevent
them we don't have as much resource or
time as our attackers do so it's a
flawed problem we can never actually get
it to the point where we could fend them
all off so let's start with some basics
first oh my god the Internet is a
terrible place how many of you have ever
written some code and got stuck part way
through and going onto Stack Overflow
for a solution anyone not raising their
hand is a liar ok I'm not saying you
can't do this not by any stretch of the
imagination we all do this in fact
places like Stack Overflow have become a
good source of crowd-sourced information
however not always true this little gem
came from Stack Overflow this morning
recommending that our lovely question
the original question producer should
just use empty five stories passwords
great because anything else is just
being paranoid now
how many of you have a graphics card in
your computer yes all of you do most of
you I
there's a reason we don't like md5
anymore it's because that little
graphics card in most home computers is
now fast enough to crack passwords using
md5 that even when they're salted this
is not a control but the internet said
so
so somebody somewhere is still building
a system like this I walked into a
client two weeks ago and they said it's
okay we've started using bcrypt and I
went yes but we found that was quite
hard so next to it we've put the
plaintext just in case customer support
need it okay yep this is a kind of crap
that we have on the internet calling
itself security advice I'm not here to
give you the magic tricks of here's an
OAuth top ten and here's how to pop up a
JavaScript alert box I don't do that
kind of talk there are hundreds of talks
out there that are just like that what
I'm here to do is kind of show you some
of the real pitfalls that I'm seeing day
today and how we're addressing them so
firstly raise your hand be honest if you
don't know what a wasp is all right hi
welcome this is the most important
lesson you will take from today
Oh wasp is the open web application
security project it is free it is a
global community of security people who
are working to give free resources to
the community tools guidebooks cheat
sheets all about security it's awesome
you should be getting involved there is
a link on this slide the slides we
shared afterwards but just go and dig in
now it comes with a caveat their website
does look like it escaped from 1998
that's not my fault I'm sorry but the
advice is still very good so that's the
last of our places to go for information
so Stack Overflow
can be good but use some common sense
check authoritative sources first now
this is my personal crusade so what does
all stand for can we all be clear for a
second we have two oars in our life we
have authentication and authorization
and they are not the same thing now when
we are dealing with micro services it
becomes really important to get this
straight
because the components that are doing
your authentication may not be the same
components that are doing your
authorization your authorization might
be happening differently in different
places of your application
whenever I see a specification that says
do off stuff I get a little bit
concerned because often we we generalize
and we put them into the same bucket so
my first thing I ask you your homework
anytime you go and see a requirement
spec and it says do auth please just
push it back with your red pen you just
go big cross through it say try again
try harder because this is the root of
our problem is security we use buzz
words we use abbreviations we don't
really consider them now in micro
services we have the luxury of breaking
down our components and actually doing
this in individual places now we're
going to come back to orchestration
layers afterwards because they're fairly
significant in this space but you don't
have to have one you can just create
your little services to either be Tommy
just gonna work on the room or you could
just have one of your little services
that does authentication another one
with this authorization
you've got ultimate flexibility that's
part of the beauty of this part of what
can scale and part of why you can send
it over multiple teams but at the same
time it means you don't have an even
surface when it comes to your
authentication or your authorization now
if we look at all sent occation first we
might identify central components like
the little white square on this one and
say we'll have to factor on this one
it's definitely importance in the middle
but what we don't factor in is that
there's implicit trust between our micro
services that while I users might
authenticate and authorize at border
points where they interact there are
little trust mechanisms going on inside
the app that mean you can go from an a
low trust application to a high trust
application without without really
noticing you've done it oh I'm losing
microphones good also the thing with all
the education is it has to be consistent
it has to be planned now this might seem
like common sense but a lot of the time
I've seen Microsoft's architectures
spring up in places that have a large
legacy code base and if you're working
with a legacy code base and leave you
still got dotnet god knows what version
old in your
life yeah Java 1.4 oh yeah I'm sorry yep
this is the world we live in our
services are not all written in latest
node with react to eyes and with scholar
over here and rust over there that's not
how this works so most of us so you end
up with components that are limited by
the technologies that they're actually
written in old versions of Java and.net
do not have the same features as new
versions of some of the later languages
so we have to have a consistent planned
approach and we have to be able to test
it authorization now authorization is
your next step right your authentication
is you are who you say you are great
wonderful I'm going to let you in the
door but am I going to let you do
anything well probably not by default
hopefully think of this like your
sliding doors going into the lobby of
somewhere sliding doors have a tendency
to fail open if they break they're going
to let you in and out because if there
was a fire or something they're gonna
let you leave the building and not have
a horrible ending in security we
actually want to go the other way you do
not want to be your sliding doors you
want to be a prison if things are going
wrong if you have not made a decision it
should be closed so many frameworks give
you this you know you can use the
decorators for your services or you can
use some thinking your general
configuration have your base one the one
is going to fall through to be no get
out nothing for you here
because failing open is really dangerous
for us we don't want our public facing
API is failing open and this has to be
applied to every object every methods
every endpoint in your architecture now
if that's fine when you're doing like go
101 micro sources and you've got three
micro services and you're feeling really
spectacularly good in the world I've got
customers who've got 300 plus micro
services that's not easy to do on that
kind of scale it also gets challenging
when we start looking at the mechanisms
we're using for our authentication or
authorization the tokenization
so there's a lot of different schemers
you can use for your tokens you can
homebrew absolutely anything you can
write you can definitely write it then
do a token system with it I probably
wouldn't but you can the problems we're
seeing commonly goodness me I do
apologize one second I'm going to end up
holding this to this right ok so the
problems we commonly see in the
authentication authorization space is
that the tokens are not being well
managed there are not high quality that
they survive much much longer than they
should so we had that this is not a new
problem this is an old problem we've had
this for sessions for a very long time
but now we've got different tokens so
the only thing that we're passing back
and forth is this very large token now
things you need to consider where
they're being stored where your tokens
typically being stored in your
applications now well it definitely uiz
right it could be nowhere could be
you're just writing Curl requests or
using postman and it's just getting
coffee and paste it in but it could also
be that you are storing them in local
storage or somewhere in a mobile device
and remember a lot of these storage
places are not secure by default these
are not encrypted stores if you've got
Chrome on your laptop you can interfere
with your local storage or mess around
with those tokens if you can do it as an
engineer you have to assume that your
users can do that too and your attackers
so you need to be handling that token
very carefully and aggressively
monitoring for strange behavior or
strange usage of that token because if
that usage pattern changes you need to
go nope I don't trust you right now
we're going to need to relocate we need
to check that again we need to do input
validation now it's been a long long
time since I've been in the field and
the one lesson we keep saying again and
again and again and again again and
again is please validate your input and
yes the URLs top 10 has remained largely
unchanged for about 10 years because
input validation sucks we are not good
at it at all now many of your frameworks
do really good stuff
standard set up so don't let there's
some amazing stuff c-sharp does amazing
stuff Django which I spend a lot of time
in has some really good defaults out of
the box but the second you start writing
custom api's or things that don't use
the big bulky generic framework stuff
and you just try and write something
lightweight on the side you forego some
of this the other thing that happens is
we expect to all of our languages to do
this for us so if you've come from say a
c-sharp background and you move to
something like node for example you
often assume that if it's using the same
word it means the same thing
it really isn't I'm going to come back
to that when we talk about the languages
we're using in them and how they're
affecting a security validation has to
happen on every header every request on
every method that sounds really common
sense but if you couple this with the
fact we very rarely put the right
content type on our returns that
validation is stopping us returning
scripts and things to our UIs which
don't know any better they're just going
to render things on screen so service
composition you've got a monolith great
awesome fantastic meteor and business
and that's great you're going to break
it down into small pieces and you're
gonna ship it onto the Internet as
Microsoft sees and the world will be a
great place awesome regardless of how
many books you read and how many videos
and how many tutorials you watch this
actually isn't that easy first time
round especially if you're dealing with
a complex existing application we tend
to split it will code our small service
start deploying them out and then we
move on to the next one and it's very
hard to come back to the old ones to
have a look at them now that has an
interesting effect when we start looking
at the security of our applications so
this is a crude example again seen in
the world
obviously no code don't get confused you
know it's the same lesson just without
the code there so we have three micro
services two of them using JWT tokens
for their authentication stuff great
simple good line libraries and
frameworks last one what's that
base64 and if you are not familiar it's
been a while since you looked at the
difference between encoding hashing and
encrypting that's not particularly
secure and also if you were to decode it
it's probably not a high quality token
either so remember the way to the heart
of an application as an attacker is
through its weakest part so normally the
oldest service you've written the one
you wrote when you were still watching
the tutorials from a drink or craft or
something on the Internet
so go back and look at those old bits of
code I know that I have gremlins in my
old bits of code I'm probably sure you
do too we all know that Microsoft is
supposed to be small and simple that's
quite straightforward awesome how many
of you have come across a monster micro
service a micro service that is
pretending very very hard that it's a
cool kid and it really wants to come to
the party but actually you took a
monolithic developer and you said making
an API and lo and behold they did but
it's giant it's 500 plus lines of
massively complex highly coupled code
that probably does three or four
different functions when it should be
doing one yep this is Microsoft's I'm
not here to tell you the glorious future
of micro services I'm here to show you
the skeletons that I see every day and
that's okay don't worry if you see that
kind of stuff it means you're in a
normal organization you haven't quite
got there yet that's all good but call
it out we all know the rule if you're
doing a code review if you're given
10,000 lines of code to review you will
spot how many bugs 10,000 lines zero
you'll say it's fine ship it if I give
you six lines you'll find ten books so
treat your micro system the same way if
you've got thousands of lines of code
it's not a micro service it's okay do it
in a blameless nice kind of way but just
you know say come back again try again
remember that while we're breaking down
our services there is going to naturally
be some coupling between them it's
highly unusual for you to be able to
make micro services that can work
entirely atomically
all on their own now that's interesting
when you start breaking out some that do
heavier lifting than others so for
example batch processing or dealing with
any kind of large data transformation or
say your authentication system because
if you don't consider this coupling you
end up in denial of service territory if
I can't get my objective so if I want to
take money or have problems
oh my microphone against there we go
awesome oh I'm gonna get sellotape this
is fantastic yeah saw it here first all
right it'll come right off is this
awesome fabulous all right so if we have
got services to connect to each other
and I can't get to my objective so my
objective is your intellectual property
or children's data or whatever I'm
trying to get to then sometimes just
causing a denial of service can be in
effect in and of itself I can destroy
your reputation in the industry I can
interrupt a crucial transaction that's
going on so making sure that the
coupling in your services means that if
one fails that the others don't go down
with it how many of you do any kind of
load testing or kind of failure testing
in that way if you don't it's a really
fun way to do testing if you think
testing is boring this is the one to get
started in because basically you're
gonna destroy your entire architecture
and it's all for good things you can
like get KPIs and things for us the
other thing to know is it may not be
your code that fails under pressure now
we've all decided that using the cloud
is good and we'll come back to that I
like the cloud don't don't worry about
the cloud but how many of us love AWS is
documentation yeah there'll be no one
sometimes it's not our code that is
going to cripple our market services
it's whatever we posted it on and
however we've configured it whether it
is going to auto scale or not our auto
scale whether you've set a billing limit
on it and you're going to hit that
billing limit and actually lock out all
your accounts for all time which is
here's your approach we have managed to
cause three week outages and systems by
triggering in
controls on platform-as-a-service not
because we intended to obviously but you
don't want to live in an industry where
three weeks outages a thing that you
could actually happen that they should
be happening to you right how many of
you think your boss is gonna be happy if
three weeks later your code is still not
running yeah nobody's gonna be happy so
we've started breaking down our services
we've decided we don't want to put all
that acacia northen in each of them
we're gonna outsource all this to an
orchestration layer fantastic there are
great ones out there are many available
I'm not here to shill for a vendor I
don't care which one you choose choose
the one that has nice stickers as a
starting point I think that's how it
works right so great you're gonna have a
really powerful component and lots of
little tiny components awesome how many
of you feel slightly worried about this
should this is worrying because claims
like this happen this was taken for a
vendor website this morning they are
promising not only to do your
orchestration to protect you from all of
the OWASP top 10 and adaptive threats
such as bad BOTS I don't know what bad
BOTS are and I'm a scourge person so if
you can figure that when I please do let
me know I'd be interested to know what
that actually means but there's a worry
here what we've done is we've said well
you know the security thing I don't
really need to worry about that because
my orchestration layer is gonna do it
for me yes that is really dangerous
that creates an approach in our
development teams of not my problem
somebody else can deal with that bit we
just do our core pure functionality this
is rubbish
at some point you are going to change
your castration layer or your
orchestration layer is going to let you
down in some way and you're going to be
really really in trouble at this point
if it looks like magic it's probably
 okay other things you should
know people like me attackers people who
do what I do but they look like me we
are incredibly lazy incredibly lazy if
it's a choice between doing some side
kind of Ocean's eleven kind of heist
it's gonna take three weeks of planning
and like I need a wheels person and
somebody who's really good at talking to
humans or I can just steal your laptop
in the lobby I'm gonna steal your laptop
now same goes for orchestration layer
attacks if you've got 300 micro-services
but I know your orchestration layer is
the Gateway to every single one of them
I'm not going after your micro services
I'm going after your orchestration layer
now for many of us that's an area we
don't even control that might be a third
party service a software-as-a-service
product it could be something we have
internally in our network but for most
of us is somebody else entirely
now these are the features I'm starting
to see in orchestration layers that
scare me so impersonation somebody in
the support team full orchestration
service number three can pretend to be
me at any time and show up in the logs
as me now that's really scary I want to
be able to see if an admin or super
admin logs in I want to see what they do
specifically and it shouldn't ever be
disguised as me we're seeing
investigation mode or SSL interception
so SSL is a pain in the ass to configure
at the best of times if you haven't run
your tools through something like SSL
scan or use SSL labs to test what your
SSL status is then please go do that
because you'll start to get a feeling
for how complex something like SSL is to
configure and maintain day to day I do
not want some of the vendor on the
internet meddling with my SSL traffic
that kind of breaks the whole point of
it being encrypted now if you're putting
any services into your networks that say
oh it's alright we man-in-the-middle the
SSL traffic and then we rebuild it we
send it on its way always ask yourself
well who's looking at that point who
actually can't see that data and you'll
see why that's important in just a
second password sins of the third party
provider I am unlucky enough to have
done so many SAS reviews of security in
the last few months that I can probably
do them in my sleep how many of you run
it or work for a SAS product three or
four of you please I'm asking you please
just once I'm gonna ask you nicely as
ambassadors for your industry
please get better at passwords please
start caring about things like
two-factor authentication
please start caring about having good
password Lentz do not Maksim have a max
length on a password it's not a good
idea so how do we do this we need to
choose appropriate technologies it's
okay to say no to new hipster unicorn
technologies because they're not ready
yet it's hard you won't feel like a cool
kid but it's okay
restrict access to these things your
orchestration layer is the most powerful
thing in your architecture at this point
so not everyone needs access to it
monitor it aggressively and configure it
well if it doesn't come with any awesome
I will work with your monitoring system
here's a little of a tip for you if it's
got an API query the API just use
whatever scripting language you like and
use AWS lambda ship the logs to whatever
monitoring system everything else goes
into you can be up and running in less
than 40 minutes as long as you know your
script works okay and lambda honors your
versioning which doesn't always happen
but you're going to have actual
monitoring that you can actually
interact with in the same place as
everything else goes don't assume
anything don't assume just because
they're marketing website is super slick
and has all the right buzzwords and it
means anything I don't give a rat's if
you say you're PCI compliant that you
have Sox written all over the website I
really don't what I care about is that
you care about my security that you are
gonna take steps on your behalf and
they're gonna roll out to all of your
staff not just one person in your team
and then I want you to test these people
regularly I want you to make sure that
they're getting pen tested if you are
you working on an application that's
going onto the internet but isn't
getting penetration tested or being put
in a bug bounty program or having a
responsible disclosure process you're
doing it wrong now in this space there
is a weird misconception that security
vendors know what they're doing when it
comes to secure development now I want
to ask you all as better engineers than
anyone in my community will ever be
please challenge us on this I want to
show you just the last two weeks from
one of our researchers in the community
this is Tavis
Thomas has a problem with security
vendors he has been systematically
vulnerable doing vulnerability research
over every antivirus a security product
he can find and it is raining
vulnerabilities now this was last week
this is a week before that it goes on
and on and on now these are we're
talking about Symantec Norton Kaspersky
I'm gonna get in trouble with someone
because this is on the internet but
don't assume if it's a security product
they know what they're doing challenge
them push back push back harder than you
would on yourself because they have a
greater duty of care than you do also if
you have a Fitbit set of scales you
should probably patch it which i think
is hilarious that we live in a world
where you're patching your scales but
please do that
okay so identity and access management
we've got our orchestration layer it's
going to help with that we hopefully
haven't decided to homebrew or any of
this we're going to use some nice
practices so things we need to care
about principle of least privilege and
who you work for an application
development firm or of on an application
that has a god mode or a super user or
super admin mode most applications have
it somewhere hidden in the backend
it's the backdoor route that you get in
and you do raw database queries and
edits it's the one where it's all gone
horribly horribly wrong and there's
still a way to get in I know about these
things I've seen them I've written them
your sins are my sins we are in this
together we have to get used to the idea
it's ok to say no that it's ok to say
actually you only need this permission
and that's gonna mean that your roles
available might get more diverse you
might end up with more off them and
that's ok you don't have to just have
one role that can do all of the things
but to do this you need to define your
roles well what are the people actually
using your application for now how many
of you work with marketing teams and
have analytics tools in your application
yeah hopefully lots of you because
that's how we know what our customers
are actually using any code that we're
not using where the customer is dead
code and needs to be deleted which hurts
us because we've put our time and money
and love into it but still delete the
code that's the best thing to do now use
those analytics tools I'm going to
a security person tells you to go use
crazy marketing tools to figure out what
people are using your application
because then you can do set theory
because maths is fun and I look at what
roles exist
you know what groupings are actually are
being used what functionality means
stuff to different users I'm going to
ask you category please do not go it's
okay we've got fine-grained permissions
fine-grained permissions is the pathway
to dragons nothing good comes from this
I work with a client they have nine
hundred and eighty seven different
fine-grained permissions in their
application which means if you talk
about the possible permutations that
make up roles there you're talking in
the tens of thousands of permutations of
roles in the application you don't need
this I'm gonna say it engineers we're
really good at this but the users don't
care the user will be happy if you just
make their life simple so don't go down
the road of fine-grained permissions
always calculate how many permutations
does that mean because every permutation
needs monitoring and love in its own way
and then audit the heck out of this you
really really do need so much logging
and monitoring your application it's
unbelievable so I I commonly see people
using Sumer logic and Reagan from the
vendor Hall doing great stuff with their
application logic but they ignore the
security stuff around the outside access
logs if you're integrating with
something like Active Directory all of
these things need to be pulled together
how many of you have ever been near a
web application firewall okay a couple
of you yeah I'm sorry
right sad realities web application
firewalls and normally the primary
defense we have in our organizations
against bad things happening however
they are given to the security team
which is someone like me or someone
who's a sysadmin and they go protect it
so we put it into monitor mode you put
it into monitor mode and it observes
thing and it goes well if I was in real
mode I'd be doing stuff right now and
here's what I'd be doing now in a
perfect world we would then go and look
at these logs and we go oh right yes
that one can go on and that one doesn't
and that was a false positive and that
was okay and we turn it on to full mode
and it'll be fine
eight out of ten of the companies I've
worked with in the last 12 months who
have web application firewalls are still
in monitoring mode twelve months after
deployment they are generating in excess
of sixty seven thousand alerts a day
that are never getting looked at and
processed why is this happening well
because your security team don't know
your codebase they don't know what's
normal and what's not they don't know
what super awesome micro service number
three is supposed to look like they
don't know what crazy parameters you've
said they're okay so then it looks like
Jason being fired around here there and
everywhere hopefully and not XML please
if you are in an environment that is
outsourced to all of its security
monitoring to another team that knows
nothing about your application go and
ask them and give them help go and pull
those logs to way you can see it because
the engineers are much likely to much
more likely to able to use this than
anyone else
now just to react reiterate what I said
about AWS or is your or any other cloud
platform as a service these are awesome
the the number of controls you're going
to get in this space compared to running
your own infrastructure is great however
this is a complex space this is not want
to just dive headfirst into please
consult a grown-up before trying to
configure security groups and roles and
test them in any of these things it's
really tricky to make sure you've
understood all of the complexities of
the different components that are coming
together there was an interesting
article recently calling amazon amaz
offering more like having blocks that
you can string together rather than
tools and I think that's a fair
assessment there are not things that
they you can just intuitively use on
their own you need to know about 13
different components that all string
together in different ways where their
documentation is written in a different
style where you may not know all of the
things that you need to configure in
advance so please don't think the cloud
is going to save you go in with the
knowledge you're gonna have to do some
learning or find someone who's already
done that for you and mutable
architecture is how many of us are
playing with the vagrants and Dockers
and all of that kind of stuff in the
world yeah that's awesome it's really
really great and I'm gonna tell you why
I'm going to tell you why it's great as
a defender white sucks as an attacker
that you're doing that please keep doing
it
so first things first we all probably
live in some form of compliance
environment and that sucks I really
don't like compliance very much it can
be a waste of energy and it distracts us
and it gives us a certificate so we feel
like we've done stuff but that's how we
say in business so we're going to accept
that think you're gonna like about this
faces are gonna be auditable there are
nice open-source tools out there that
can show you where the security issues
are with your configurations especially
for things like docker which are very
fast evolving just in the last week
docker released security review for its
containers are held up in the registry
so this is really really good
there is a docker audit tool that's been
around a while there are similar things
for answerable for vagrant but the most
important bit not the audit ability its
configuration prakrit that it's getting
rid of because it turns out you're not
the only one that's turning your server
into a special snowflake you might be
doing it but in reality is actually an
attacker who's gonna do the most
interesting changes and immutable
architectures get rid of this for you so
I want to give you a bit of perspective
as to what actually happens when we
compromised your hosts because for most
of us this is just you know fuzzy black
cloud of doom contrary to popular belief
we don't just go in there ransack it a
bit steal the data and get out most of
the time that's actually number three or
four on our list first thing we do make
sure we can come back and play another
day because everyone likes fail to come
back and get the stuff you forgot last
time or come back outside of working
hours or you might want to use that host
for other things like mining bitcoins or
setting up to pivot into another network
so attacking someone from someone you've
already attacked it's super useful and
you can oh install tools there so it's
very rare that all of the tools I need
in a job are installed already on the
box if you have PowerShell I can pretty
much do a lot but Linux hosts hopefully
if they're configured well don't have a
lot installed on them so I might need to
put SSH on I might need to put and app
on all sorts of fun things nothing
particularly exciting they're not you
know crazy magic wand tools but I want
to see them next thing
I'm probably going to clean up but
anyone else who's been there before me
now as an attacker we're kind of
parasitic we need the host to be healthy
to continue so if we get into a box and
we find someone or someone was already
there then we might actually patch the
vulnerability that they got in via and
kick them out because I don't like
sharing sharing isn't that much fun so
we'll clean up we might patch we might
change video configuration lock someone
else out and then we're happy going
about our business binding data and next
thing last thing we're going to try and
pivot so we're going to try and go from
this host which might be interesting to
this one over here which might be even
more interesting so in your micro
sources this means going from one to
another to another to see if I can find
different data sets accesses to
different systems now it's really really
hard to persist access and to keep all
of these nice and no flick changes going
as an attacker if you're using something
like lambda or if you're using immutable
architectures that are destroyed every
24 hours because you've done a tweak or
a change so don't just see them as a
cool thing that you could be using can
save you time there's actually a massive
security benefit to this there is
nothing more irritating than trying to
attack on an organization that
infrastructure does not exist unless
you're sending your query to it it's a
beautiful thing and please i want you to
infuriate all of the penetration testers
that ever come near at architecture and
make it non-persistent alright that's a
fancy word for saying hmm we've been
doing some silly things with languages
so one of the beauties of Micra services
is that we can use any language we like
that's great awesome
fabulous but we're like kids in candy
shops right now it means people are
going nuts going well they've got some
node over here and then I watch this
talk about go and well you know we've
got a bit Java over there because you
know rock in the old school and we
decided to fought grab it and cue so
there's an Erlang stack somewhere over
here and before you know it bad things
start to happen bad things starting to
happen because we're not always using
the right tools for the right jobs not
all of these tools are as mature as each
other and not all of them are designed
for
certain purposes so if you find yourself
using a language just because you
watched a cool talk about it or because
you saw a really woozy demo always ask
is it the right one there was a really
interesting article from journals for
Etsy and talking about how they hire
engineers and he was talking about
actually they don't want to bring more
tools into their architecture of good
engineer can take a small subset of
pre-vetted tools and do amazing things
with it now from a security perspective
this is even more important because not
all of our technologies are equal when
it comes to what they're providing you
now how many of you do note any know
developers in know well that's really
good actually please yay awesome
I'm sorry node people and but I'm
talking about left pad I'm talking about
the things we've learned in the last few
months about interdependency inside our
package management systems la left pad
was taken out the developer said nope no
more what happened we expected it to
just silently go into the night it will
be fine what happened was most of node
fails it's because node NPM is a highly
connected highly dependent package
system most of the packages are less
than 20 lines of code in length and what
we've got is a cascading failure
situation where you can put code in or
take code out and it breaks everything
around it this is not the same for all
of the languages so when we have so much
variety in our language space we're
opening ourselves to risk from the
package management systems themselves
other interesting things about node you
don't actually need to do any validation
or have your code check to have it in
NPM you sign up you create an account we
push gone done now if you're someone
like me what we see is the ability to
then push malicious code in and have it
adopted by many many many other
dependencies and get into this highly
connected mesh of packages now this is
basically the same way that worms work
so I could put malicious code in have it
three things become dependent on it each
of those have ten things are dependent
on those and before you know it I'm
touching every piece of the NPM
infrastructure or ecosystem that's scary
how many of you have a good Pro
for vetting your packages you're pulling
from these places I'm not seeing
anything in the wild yet that actually
you could use this and vet whether these
packages are safe or not safe we're
seeing CVE checkers and things but we're
not seeing anything that goes all right
do I actually need this this is the is
this good code is this sensible
engineering now to end this little
section on some horrific leet right
analogies think of it like puppies every
language and every package you bring
into your system is like a puppy it's
cute you get to play with it and do all
some cool things you've not done before
and that's awesome and it's gonna poop
occasionally and that's okay because
it's a puppy and you just scoop it up
and you deal with it great then you get
300 puppies and now suddenly that poop
problem seems like a lot bigger problem
than it was previously
so please before you start bringing in
more puppies into your life consider
what you're gonna do with the poop right
so I'll wrap up with detection so
prevention it's not gonna get you the
whole way please log all the things
we've mentioned this previously I'm
going to spend this section hammering
things I've already talked about because
it's the most important it takes up to
18 months to spot you've been
compromised and that time all sorts of
fun things will have happened if you've
only got 14 minutes of visibility in
your logging you're in for bad times
when it comes to investigating what went
wrong you have to saw you log somewhere
that's immutable itself that's secure
seems like common sense right but what
we see most of times is stored on hosts
it's fine now do you remember that thing
where I told you what I'm gonna do when
I compromise your hosts part of the
cleanup is I'm going to flush myself
from your logs your locks are gonna be
crisper and cleaner than they've ever
been in their life your logs and poorly
managed logs are actually a really good
way to denial-of-service things if
you're sending them all to a poorly
configured end point it's a really good
way to take you down is if you take away
that end point so yeah please be careful
another bit of homework how many of
you've heard of hacking team ok hacking
team was a prolific group of
vulnerability researchers out of Italy
and there was a report put on the
internet very recently from the guy who
compromised
them and add all of their dirty laundry
online and he compromised them and this
is a very security focus company by
attacking their centralized middleware
so their logging systems their backup
systems their systems health checked
anyone still using Nagios this is where
we're going to come after so please bear
in mind when you've got this very
fragmented in infrastructure like this
this architecture then we're going to
look for anything the shared between all
of your components and we're not afraid
to go after things like Nagios most of
these systems have really really
elevated privileges too and then watch
your logs how many of you filter the
alerts that come into your inbox into a
folder and eventually get to them aha
how many if you don't even get the
alerts because you unsubscribed how many
of you have the slack channel of doom
where you're logging goes to and one
person goes in occasionally but most of
the time it's just noise and then
occasional gifts yep we are crap at this
your biggest the biggest thing you can
do is to not worry about which hits the
language you want to do next is get this
stuff working automate the heck out of
your logging and get it monitored
investigate things and go find out
you'll find more scaling and performance
issues looking at security logs and
you'd be then you're aware of at this
point I can find security flaws looking
at slow query logs in my sequel your
logs are super valuable but we don't
look at them unless somebody tells us to
look at them or we've broken something
so ok it's a bit of a whistle-stop tour
I appreciate that
and when I say demos of things you know
everyone expects me to go Lowell his I
popped a shell for you you're not going
to learn that way it's a magic show but
all of the examples I've given you are
from real systems from things in the
wild and written by real engineers not
unicorns who write books and presenter
things so please go into your world do
simple things keep things simple and
keep them reviewed keep them logged
because it's all very well moving from
the big monolith that's costing us
lossless painful to deal with the lovely
awesome micro services that we can be
much more flexible with but remember
that as we break things into small
pieces the surface area increases and
surface area is all of the points and
security that we can attack if there are
more points to attack the more
successful I'm going to be
so if you have any questions people know
I obviously there is an application that
you're supposed to give me a feedback
scoring I did not at any point tell you
to try and give me the score of purple
so that never happened just for the
record thank you very much for your time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>