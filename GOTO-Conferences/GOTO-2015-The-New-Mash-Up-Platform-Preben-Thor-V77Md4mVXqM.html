<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GOTO 2015 • The New Mash Up Platform  • Preben Thorø | Coder Coacher - Coaching Coders</title><meta content="GOTO 2015 • The New Mash Up Platform  • Preben Thorø - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GOTO-Conferences/">GOTO Conferences</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GOTO 2015 • The New Mash Up Platform  • Preben Thorø</b></h2><h5 class="post__date">2015-11-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/V77Md4mVXqM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what we're talking about today is drones
or actually to be more precise drone
because this is the one that we will
talk about today and what we will well
we will look at code at the end but on
the way to that we need to define a use
case for this it turned out to be quite
important dealing with these drones then
we will take a look at how it works
because that will reveal strengths and
weaknesses in the platform and then
finally looking at code how we realize
the use case and summing things up at
the end and what really qualifies me to
be here today is the fact that I am a
bit of a spare time nerd I guess since I
was 67 years old I've been doing the
most hopeless things with anything
between a rubber band and something
running Linux and this is also why I
felt it was such a brilliant idea that
we should buy a drone and start doing
experiments with this drone some a year
ago in this case we means me so we SAT
started searching for a drone which one
to buy and it turned out that this one
from DJI systems was a decent choice it
was actually something you could pay for
money still being serious and first of
all it has an SD case you can actually
you can do something with it so we
bought this drone and we downloaded to
the SDK again we that means me and with
the SDK as a beautiful demo app showing
how to control the camera on the drone
and that's it I was a bit disappointed I
was hoping to actually control the drone
and now I had
and sdk so i could control the camera on
the drone so i contacted the support
forum at TK I systems asked if I cannot
I was actually hoping to control the
drone can I do that with the SDK and
they said well then you have to apply
for SDK level 2 and I said fine I hereby
apply for SDK level 2 and they told me
no you need to tell us what you're going
to do we need to see your use case and
you need to send a copy of your passport
tools and I ok I've known you for two
minutes now and you asked me to send a
copy of my passport to a company in
China I don't think so do I start
googling for something else and while I
did so I found this on the Internet it
turned out the two weeks before had
drone had crashed into the White House
and not only a drone it was actually my
drone so suddenly it made sense but ok
the whole use case thing this is about
responsibility this is in fact what you
were talking about son and you
previously we want a license plate or
something they actually want it to be
able to identify me if I crest yet
another drone into the White House ok so
maybe I did need a use case the truth
was I just wanted to do some experiments
with my drone but I guess that's not a
very decent use case represents to
accompany that just crest into the White
House so we need to we need to find
something I think in this sense it's
obvious that location and geolocation is
important I mean when we're playing with
a drone it's it happens to be somewhere
and it does somewhere at that position
so location is important if it was not
sit well it is important so I step back
a couple of months back in time
we all want to know where are things are
that's just the way the human mind works
we're location oriented and we want to
know where things are we've been doing
this for years at least 10 years maybe
15 years ago we could mount these things
in our cars if we could afford them but
I guess if we could afford a car that we
wanted to track we could also i thought
the thing we had these things in our
cast 10-15 years ago in our boats and
now we have something we call internet
of things connected words we all carry a
gps device and a map in our pocket at
all times so this actually fits very
well into now we can really find out
where are things are and we all want to
know that especially if the things are
not where we thought they should be I
have two things that I really want to
know where are they look like this Oh
actually very often they look like this
and when they do so in a place like this
I really like to know where my things
are so I make the same app as everyone
else did I call it with my kid I can
install this app on two phones it has
two modes follow and being followed so
the one app can well follow the other
app I could have downloaded this that
probably a thousand of these apps in the
App Store but we do things ourselves so
sorry
so I make this app and through some
magic the one uploads its position to
the cloud and I can monitor the position
on the other phone and that revealed
first scary fact of today take a look at
these two phones let's zoom in they're
located right next to each other but
still they claim to be 15 meters apart I
know dps is not accurate but apple
claims that they have what they call
supported GPS so they use not only GPS
they use mobile net and Wi-Fi and still
those two devices are 15 meters apart
this could could be useful information
later on in a way it seemed to work ok
my little tracking thing here so I
decided to extend it or to replace one
of the phones the phone being followed
with a thing like this which being so on
apart looks like this i mounted this in
my car so now I could find out where is
my car and I extended the app with a
speed alarm so if the if my car suddenly
moved where I would not expect it to
move I could get an alarm on the phone
so now my setup looks like this and just
to complete the picture the cloud
service actually happens to be my
private server room which at the same
time is my blu-ray player so what did we
learn from this we learnt basically you
cannot trust GPS and as a side effect I
learned that speed measuring is actually
quite difficult there's so many corner
cases you need to take into account here
and the reason why the GPS in our cars
are always so precise is the fact that
it assumes that you are actually on the
road and not beside the road though the
GPS might
thought so and it assumes that you have
been moving at this speed for the past
second so you probably still do so but
actually GPS is not very precise anyway
now we have our use case so I want to
mount this thing on my skin these
reports its location to my blu-ray
player me standing on the ground with my
phone I get the location on my phone I
can upload it to the drone and the drone
can follow my skin that is my use case i
reported that to DJ I systems and they
say fine that is indeed an accepted use
case now you just need to tell me the
name of your app so if any of you are
planning to do something like this just
note this the name I above has been
taken now so the name then they wanted
an icon for the app ok I made the icon
and this is no joke just mark this if
you plan to do experiments with this
drone you have to provide your use case
the name of your app and an icon so I
gave them that and they said fine now i
just need a copy of your passport no i'm
not giving you a copy of my passport but
i gave him a link to go to Berlin and
said I'm actually part of a team making
these conferences and wouldn't it be
great if we could make a talk about
Chrome's and like two seconds later they
said I was approved here
but please note this you need to prove
that you are who you claim to be and
provide use-case name and icon and what
they give you in return is a download
link to the SDK level 2 ok we have a use
case and how does the drone actually
work well how does this thing work
basically it doesn't because this is a
plastic model but if it was the real
thing how does it work well when the
rotor rotates where the blades tilted of
course it produces an up drift and as it
does so it lifts the helicopter and if
it does so at a vertical line if the up
drift is equally distributed around the
circle we call this collective pitch and
how does it fly in some direction and
most of us think that it just flips the
entire circle here no it doesn't
actually exactly it has a little gizmo
here under and every time I Blake passes
by the rotation or the tilting of that
plate is changed so that means that the
up drift on the circle is not equally
distributed when we want to fly in some
direction we call this a cyclic pitch so
we're pitching and that can be
collective or cyclic then stupid
question number one of today what
happens when they thing rotates well
because Newton decided some hundred
years ago that there should be opposite
force
in this situation the body of the
helicopter will start to rotate in the
other direction which is of course why
we have the propeller here so we can
keep it stable or we can actually turn
the body if we want to we call this that
the helicopter is yawning so pitch and
you're flying a helicopter is actually
not for everyone the collective pitch
you control with the handbrake the
cyclic pitch your control with a
joystick the join you control with your
feet and being present at the same time
I can tell it's not for everyone because
that excludes me and it definitely not
for me how does a drone work how do we
do these things with a drone ok it's
pretty obvious that if we turn all the
propellers in the same direction we will
have the thing turning around so of
course true propellers turning clockwise
and the other two turning
counterclockwise then like I'd of equal
out each other and the same velocity of
all propellers means we have a
collective pitch and it can rise what if
I actually want to fly in some direction
well that's pretty easy I just increase
the speed of one propeller then what
happens well it tilts but at the same
time I will have more rotation clockwise
and counterclockwise so the thing would
start to rotate so I have to increase
the speed of two propellers so they
equal out each other then it tilt and it
flies away and if I want it to just fly
in one direction but not increasing the
altitude of course I increase the speed
on two propellers and decrease the speed
on the
other two so that the combined pitch is
kept the same then it is tilts and go in
one direction what if i wanted to rotate
the yawing here well again I could just
increase the speed of the troop repeal
of the two propellers turning clockwise
then the thing what starts to turn
counterclockwise but at the same time it
would gain altitude because now now I
have increased the combined pitch so
again I have to increase the speed of
two of them at the same time decrease
the speed on the other two then it hang
stable and it rotates so everything is
about speed and controlling speed on the
motors here how do we do that well
anyone that had a mother trained as a
kid and try to tune it know that it's
pretty simple when you apply a voltage
to a motor it starts to turn and if you
apply a higher voltage it will turn
faster and we could do that here the
problem is that we cannot control this
very precisely first of all we cannot
control the voltage and the speed very
precisely and if we do so we cannot
control it instantly if I want it to go
from one speed to another it will not
happen instantly it will take time so
when we dismantle this drone here we see
that the I in fact three wires on the
modem this is because these are not
conventional motors what we have here
these are step motors and a step motor
works in this way I apply a voltage and
nothing happens until I apply a pulse on
the yellow wire and that makes the motor
move one step in this case I have 24
steps for an entire revolution
so one pulse means that the propeller
turns 15 degrees or in other words if I
can apply 24 pulses within a minute
their propeller will turn at one rpm
which is probably not enough to fly the
thing the truth is probably closer to
10,000 RPM so I have to apply like 4,000
pulses per second to the motors and then
the thing flies and these motors are
actually the most important and the main
components in this drone these are the
muscles of this drone if you buy a cheap
drone in toys r us you can be sure that
it's not equipped with step motors it's
equipped with conventional motors and it
would not be able to fly as stable as
this one this is in fact what you pay
for the rest is just software and
sensors so what census does it have for
this one has a GPS it has a compass it
has gyroscopes and it makes us the air
pressure and then there's a lot of
regulation let's see how it flies
now before we move on I'd like you to
know two things here first of all how
stable it is well of course it's stable
now because now the movie has stopped
but in what but when it flew how stable
it was and secondly take a look at the
car behind by holiday home here on the
parking place behind that car this is
where I took off and when this drone
takes off it notes the position that is
the home position so if at some point
the battery level gets low well the
drone gets out of reach it will return
to home to where it took off I tried
that it's pretty simple to do that I
just I just turn off the remote
controller then it loses signal and it
comes home and guess what it landed on
the exact same spot as where it took off
and how is that possible with the GPS
that is so inaccurate by nature does any
of you have any clue how this could
happen
yeah but even with the gyroscope you can
feel movements but how could you get to
the same spot no the truth is actually
it was let's see what happened the next
time I tried the same thing now when I
turn off the remote controller you can
see it goes to a predefined height which
is now the go home position or go home
hide so now it searches for the home
spot it sets down
right behind my car
okay it seems my rule about GPS is still
valid that position was off by at least
five meters maybe six seven meters but
still when it flew it was as stable as
ever before it is incredibly stable I
decided to stress test that this summer
on a windy day I flew with the thing and
it was just as stable as ever before and
to prove that I built this kite and I
sent the drone up right next to the kind
let's see how it looks from the drone
now please note what happens about two
seconds in into the movie here oh dear
it caught the tail of the kite it
flipped 360 degrees around and they did
just hang there at the same spot again
let's see the second part of the movie
yes it is but is not me hanging in the
drone filming it does it itself
that could be a long movie here
Oh
well I'm a positive person so when
something like this happens we need to
be constructive the thing was well not
very damaged but at least so damaged
that this propeller could not turn at
all so it gave me the chance to make yet
another experiment here i mounted two
metal plates under the motor and
realigned it so now I have this drone
and there's no chance in the world that
this propeller health this propeller has
the same angle and the right position as
compared to the other three I made this
and I try to fly the thing and guess
what it was just as stable as ever
before it just hanged there so where
does this leave us what did will what
did we learn here well it seems the
drone is able to correct based upon the
sensor input instantly and at all times
it seems the GPS is as inaccurate as
ever before so chances are that the
drone will at any time be very stable at
the wrong position that's actually good
knowledge when we want to implement
implement my use case before we get to
that there's one more thing we need to
establish here GPS is not very good for
determining altitude or in fact it is
very good because it gives you the point
in space the problem is you don't know
the ground level you don't know how far
about above the ground this is so the
drone has an air pressure sensor
and it always takes off at altitudes
zero then everything is measured
according to that level using the air
pressure sensor so if I want to get the
real position above sea level I need to
know the offset between sea level and
where the drone took off and now some of
you may think that using air pressure
sensor is not very accurate and what if
the weather changes well this battery
has a flying time of 12 minutes and I
think if the weather changes that much
over 12 minutes you shouldn't fly the
drone anyway so it seems to be pretty
safe let's see how we can control the
drone from software then again we first
need to establish a couple of things in
the software you will see the term main
controller and we like to think as the
main controller as being this one it is
not the main controller is inside here
let's just keep that in mind that one is
a remote controller or the ground
station
and not only the main controller is here
that's a Wi-Fi access point in the drone
2 and this is what we use we connect our
phone to the access point so we has to
and that way we establish the line of
contact let's see how it works this is
objective c i think it should be ok for
everyone to follow it if you think back
yeah it's pretty bright here huh if you
think back and when i received that i
mentioned that i received the link to
sdk level two will that link i also
received an appt key every time i start
up my app i have to register the app
with this app key it's kind of unlocks
the sdk and if i don't do so the sdk
doesn't work so again if you plan to do
something like this well there's no
short circuit here i could give you a
copy of my sdk but you couldn't use it
without an appt key so you really have
to register and apply for sdk level two
in order to use the thing ok this is
what we do we make an instance of a
drone object that object is basically
our entry point to the main controller
and to the camera we're not going to
talk very much about the camera but you
can do everything with the camera I just
printed one example here you can
actually get the live video feed from
the camera you can make still pictures
you can make all kinds of filtering
settings this is a GoPro camera and
anything you can do with this kind of
thing you can do with this from software
there's a lot of things you can do with
the camera
but with the drone object we also get a
hook to the main controller and if we
register a call back on the main
controller and week and we apply the
method start update MC system state we
get callbacks with these system States
and this is where the good is begin take
a look at what we get here get almost
everything about the drone its position
well it's it's home location not that we
can trust it anyway but we get it power
level set alight count anything I know
the velocity we have the velocity in
three dimensions here so if we want to
calculate the combines or the resulting
velocity this is a vector in 3d space
that we have to take you now if I want
to control the drone I cannot just set
velocity X and it flies in that
direction these are read-only values if
I want to control the drone I need to
make a software ground station good
thing is the main control actually
happens to be a ground station at the
same time so I can cast the main
controller to a ground station object
and I can start doing things on a ground
station or with the ground station you
do tasks a task is something you want
the drone to do there's one obvious
predefined task eight called go home I
can actually call this method and the
drone returns home by the way you may
have asked yourself why didn't I stopped
the drone when it crests when I had it
trying to return home in the previous
video well the truth is I couldn't with
that firmware you couldn't interrupt the
go home
no once it ends at go home owned you
could just stand and watch it crash that
has been corrected since then also
please note you can set the pit speed
order your speed here setting the pit
speed doesn't mean that the letter drone
actually starts to pitch it's just that
when at some point it does pitch it will
be at this speed
on the ground station you can register a
call back to now you'll get flying info
call backs or ground station callbacks
this is very much the same as you cut
with the main control system state call
backs which is no big surprises the main
control underground station is in fact
the same objects there's a bit more
information here but basically it's the
same thing so to entry points to get the
same thing but let's see what we can do
with the ground station if we can make a
task a ground station task that actually
makes the drone fly on a ground station
task you can set a lot of numbers here
or parameters and you can add a waypoint
and a waypoint is the location in space
and this is where the drone flies to you
can actually add a number of waypoints
and then the drone reply to one after
another you can set the loop property so
we will loop between the waypoints so
this is what I'm going to do to realize
my use case I'm going to use waypoints
download skiing slope and here is my
entire use case on one slide so what I
do is every time the skia changes
position I note the change in longitude
latitude and altitude compared to the
previous position then I take the drones
current position and I apply that change
to the drone and it moves I I make a
waypoint ask the drone to fly to that
way point and it moves to that then
there's an interesting race condition
here it may not have reached the
previous Waypoint so I have to remove
everything I don't care about previous
waypoints now I just wanted to fly to
the new way point on the other hand if I
wanted to fly to the new way point based
on the location that it just had and it
reached the last Waypoint what do i do
so it may actually come more and more
off here and I still have to test that
to see how it actually works but this is
in fact my entire use case has been
implemented with these code lines here
if you think back on what I mentioned in
the beginning I said that I am a spare
time nerd I didn't say that I'm a spare
time designer so this is how my appt
ended up look like so it's pretty simple
I send out the drone at some point i
press the follow button and the Machine
starts then I have a camera button and
if i press that it's flips to camera
view rather than the map you an hour Oh
surprise now I have a map button while I
make this use case dta I invented the
new degeneration of drones take a look
at the sensors in the new drone there's
been an ultrasonic sensor built in the
drone too so now they actually have
collision control and they claim that
you can fly with this indoor I wouldn't
dare to do that with this drone based on
a compass and air pressure sensor in a
room with at least 100 smartphones and
air-conditioned I wouldn't do that they
claim with you could do that with this
actually they they say explicitly that
you should never fly indoor with this
drone i have here and as explicitly you
can fly in door with a strong they're
the new generation but with that there
also was an extension to the sdk
now we have a notion of navigation and
mission they actually implemented my use
case at the same time as I did it I have
a follow me follow me mission now the
way it works is if I let the drone go in
to follow me mission mode ideas keep
updating user coordinate and the drone
will keep following that coordinate so
they're actually there is my entire use
case in one code line take a look at the
hotpoint mission with a hotpoint mission
you can have the drone lock itself at
one point and just stay there or do
things there see what you can do here
you're going to lock yourself to the
position you can circle around it and if
you circle around it you can actually
you can actually set if the drone should
keep looking at that point or if you
keep should keep its orientation
so what let's see if we can sum this up
what I made here was actually what we 10
12 maybe 15 years ago called a mash-up
if you think back there was a movement
on the internet that we should all open
up our data sources and if we started to
do so the most brilliant new
applications would arise well a data
source doesn't have to be well data from
a database of something you can take
from an HTTP endpoint this is in fact a
data source too and many of those
matchups that we did back then were
actually about taking some data and
visualizing it on a map well now we can
actually be at the position not just
show the position with a drone and I
really think that only our own
imagination is the limit here on the top
of my mind there's something I need to
try out here I want to attach an
infrared camera to the drone then it can
seek its hot point by itself I imagine
if there's been an accident send out the
drones to get an overview so we know the
size of the rescue team that you should
send out afterwards well here's one of
my favorites that I need to do too it's
quite common that we carry one of these
which measures the pulse I want to do
something if my pulse suddenly
disappears the drone should do something
and I'm not quite sure why did you do
maybe you should maybe you should come
to me or maybe it's a fly away because
since my heart start and stop beating I
don't need it anyway what I want to do
it and at some point there will be some
maniac trying to make a drone for human
transportation if that maniac happens to
be one of you
just think of this the reason why this
works so well and why you can control it
instantly is because these propellers
have close to wait 0 if this thing
should lift me and carry me I will need
something more heavy than this and I
could not control the drone as precisely
and instead and instantly as I can now
so one last question here is this only
something that has to do with the DJI
drones I don't really think so I don't
see that this is rocket science or
something that's not anyone could do I
would assume that any drone at this
price level which by the way is around
thousand dollars could do the same thing
so with this talk i hope i have sown the
seeds to some inspiration and shown some
of the weaknesses and strengths in this
platform thanks for being here
yeah there are some questions what is
the reach diameter of the Wi-Fi link 800
meters 800 actually there is on the
remote controller here there's a
repeater here which extends the reach to
800 meters yes and then one on the GPS
in precise pneus how come that the
Amazon can use them then for delivering
packages for homes in u.s. I'd like to
know that too came out yet no okay and
one last one on legislation is it
allowed I allowed to to use your camera
at your home the video you showed is
there some someone questions there I
tried to fly the thing back home where I
live in Switzerland and a police officer
came to me and said you're not allowed
to fly this here it's a civilized area
that's actually the word he used you
cannot fly it here but he told me that
if I could go out in the middle of
nowhere I could fly the thing I should
just be aware that if a police officer
came to me he could actually claim or I
should be able to at any time show that
I have an insurance with the courage of
at least 1 million euros if something
should happen and he could actually
asked me to provide this right now he
said but since he in fact was my
neighbor he wouldn't do later
but there are a lot of regulations about
this some of them about privacy some of
them just about security I just read
that in Austria you are only allowed to
fly the drone if you have two remote
controls you don't have to have
redundancy in the drone itself but you
need two remote controls I know in
Belgium you're not allowed to do to use
drones for commercial purposes now a lot
of these individual rules which I know
the EU is trying to combine there are
talks about you should have helicopter
certificates and stuff and they're
trying to figure out what should there
must be a low and limits and how big
should the drone be if listen that there
are a lot of regulations and I'm pretty
sure privacy is an issue too yeah thank
you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>