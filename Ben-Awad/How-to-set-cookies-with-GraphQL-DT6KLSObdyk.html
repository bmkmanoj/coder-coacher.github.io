<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to set cookies with GraphQL | Coder Coacher - Coaching Coders</title><meta content="How to set cookies with GraphQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to set cookies with GraphQL</b></h2><h5 class="post__date">2018-04-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DT6KLSObdyk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so I've been discussing some
ideas I've had with using cookies for
authentication and I wanted to take this
video and show you a very simple way of
doing this without any extra libraries
and this was basically the beginner what
I first started with and then how I
actually took this and added more stuff
onto it so to demonstrate this I am
gonna be showing you how to basically
set cookies and graphic UL so right now
I have a simple graph QL schema and I
have a type mutation and it is just a
register mutation and you'll notice
we're not returning anything so normally
if I was building this before I would
probably send back a JWT token or maybe
I would do that when they log in right
or maybe I do it when they registered
either way in this case I'm assuming I
just have one register and then I'm
logged in after that okay so let's take
a look at what that resolver looks like
for register so first off I have three
fields at the top of my function I have
the arguments coming in and in my
context so my context what I like to do
is pass the response and this is the
express response now I was originally
gonna do this example with the
boilerplate that I set up that was using
graph QL yoga but I actually had to yank
graph kill yoga at and AD Express and
let me show you guys why so if we come
over here to graph kill yoga you'll
notice when creating the context object
you can either pass in an object or
function and what that function has is a
parameter is the request and this is the
Express request and they talked about
more about it here but notice one of the
parameters that's missing is the
response and we actually need the
response to set a cookie
so you'll notice I actually just set up
the server basically built my own graph
QL yoga here
with express and Apollo server so here
is graphic you'll Express and I am given
two parameters on this function which is
really nice their request which I don't
care about in the response
so I'm actually passing the response and
this is the Express response and this
object will allow us to send cookies
back so I'm passing that in through the
context and then you'll notice here a
few things I'm doing so my front-end is
running on localhost 3000 so I have core
is set to that and I have credentials
true so this is important for the cookie
actually to be set so you want to make
sure you have that and then you'll
notice I'm also using some middleware
called Express playground and this is
kind of like graphical but it's coming
from the playground and that's just
because I've been enjoying the graphical
playground better than graphical but
that's just a side note ok so that is
how my response is getting or got here
so next the usual stuff you would do
with a register right so I would
encourage or not encrypt but hash the
password and now I have a hash password
here so I would create a user and then I
would I'm using type Orem here so you
create the user and then you save in the
database and then here I am signing a
JWT token so normally I would just
return this token but you'll notice
after I create this token and same old
stuff it lasts for seven days here I
just misspelled user so you can add them
last there and I'm saving in the user ID
so I can use this later
now instead of returning it what I'm
doing is I'm basically sending back a
cookie as a response and you'll notice
I'm just returning a boolean here but so
in the response of this request is gonna
be a cookie and I want to just go over
real quick some of the things I have
right here these are some of the options
you can pass with the cookie and these
are the ones that I like to use so first
off here's the name so I'm just gonna
call it ID could call it token could
pretty much call whatever you want I
just want to do like a vague name and
then I'm passing in my token so I'm
actually storing the JWT tok
as in the cookie or as a cookie and I
think that's a fine way of doing it you
can also store it like an ID in a
session which we'll talk about later and
then so here I have three different
options first is ACP only so that's an
important one so that means the
JavaScript cannot access it when the
cookie when it's actually sent to the
client so that secures the cookie when
it's there you'll notice the second one
is called secure this means the cookie
will only be sent when it's on HGPS
so I only want this to be run when I'm
actually in production when I actually
have a GPS so I usually do is check the
environment so if I'm in production I'll
make it secure otherwise if I'm just
testing in localhost I'll not make it
secure and then max-age I'm sending it
for seven days here and then it'll
expire so I think this is a decent
settings for the cookie that'll keep it
secure in your token secure so it won't
be able to be accessed in the front you
could also sign the cookie if you want
to but I don't really think it's
necessary in this case because we
already using a JWT token so you know if
someone tampers is the token already and
yeah so this is what it looks like so I
want to show you guys a quick little
example of what that looks like so
here's just a little form and I'm just
gonna type and I'm just gonna call my
mutation there so here's this cement so
I want to show you guys what this looks
like so here if you go to the network
tab in chrome you can actually see the
request so here are the headers and we
can see this is a post request to graph
QL and we could see the data we sent to
the server and then we can see this
little thing called set cookie and
that's what's actually a response from
the server and then we tells it here's
the name of cookie ID here's the value
of the cookie and then here all the
different variables or basically options
you pass for the cookie
and you can see that also in the cookies
tab here so now if I go to applications
I can actually see that I now have a
cookie here called ID and just to show
you that it does show up we can refresh
and we can see ID does pop up every time
you make a request so that is how you
can actually set a cookie in graph QL so
just a quick recap important things to
note are we are using Korres here and we
set credentials to two origin to a
little close 3000 and we're also using
graph QL or Apollo server that way we
can send the response as a context and
then in our register mutation we can say
res doc cookie which will send a cookie
back and we could do this in any of our
resolvers if we want to and now another
important thing here's just a quick view
of the front-end I um using Apollo
client very important to say credentials
include and you also notice I am not
using Apollo boost for whatever reason
apollo boost would not work for me maybe
I was messing up the settings I don't
know what but if you just would not be
set so here I'm just creating a HUP link
and setting the credentials to include
so make sure you have that it's very
important or else your cookie won't get
set but the next step in this is really
to be able to accept cookies or how are
the cookies getting sent and processed
right so how is my server going to react
now that I have a cookie being sent to
it so I'm gonna cover that in the next
video and also in the future I'm going
to be hitting on using the session
library with Express and that's actually
what I'm currently using so this is a
nice way to do it if you want to use JWT
tokens I don't personally use this
method right now we'll be getting to
what I like to use very soon
but that's it for this video guys thanks
for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>