<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a GraphQL Server with Node.js and Redis | Coder Coacher - Coaching Coders</title><meta content="Build a GraphQL Server with Node.js and Redis - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build a GraphQL Server with Node.js and Redis</b></h2><h5 class="post__date">2017-09-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_Zwqn7FV6ms" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be building a graph
QL server from scratch today with Redis
now we're gonna be using at a couple
different tools to help us out with this
and the first is babble babble is gonna
allow us to use nice es6 syntax while
we're coding it we're also going to be
using something called no daemon which
is a development server that will
automatically reload when you make
changes in your file so you don't have
to come over to your command line and
restart the server yourself for the
server itself we're gonna be using
Express and something called a Palo
server to help us out with the graph QL
person and we're also of course going to
be using red us to actually make
bringing use node Redis to make the
connection to the Redis database now for
this I'm gonna assume you have Redis
installed on your computer but other
than that we're going totally from a
blank directly from scratch okay so
let's get started the first thing we're
gonna be configuring is babel so it can
figure babel we're gonna install two
things first this preset m and also
stage 3 so this is gonna give us the
basics and then stage 3 will give us
async await and also spread of objects
which is very nice so we're gonna come
over here I just have a blank folder
nothing inside of it I'm gonna say NPM
an it to start our project off I'm just
gonna keep all the defaults and then
what I'm gonna do is go ahead and get
started I'm gonna use yarn to install
these you don't have to you can use NPM
if you want to as long as you do them as
dev dependencies so we're also gonna
download no daemon while we're here
might as well so babble CLI this will
allow us to use babble node and then the
- I just was talking about so babble
preset and
and bowel preset stage three and go
ahead and let this run and then when
those are finished what we will have is
a dot dot dot babble RC file and what we
want to do in there is just specify that
we're using M and stage three so here I
have the folder open in Visual Studio
code and I'm just going to create I'm
gonna open it up create a new one called
dot babble RC and here I'm just gonna
say pretty sad soups presets and we're
gonna say M and stage three and those
are the two we just downloaded so that's
just telling babble node what we're
using and now we're gonna go to a
package.json over here and you notice
how in our scripts we only have tests
we're gonna add a start command so start
and to start up our server we want to
call node demon and we want to exact
Babel node and we're gonna create an
index on JS file that's gonna be where
our servers at so babel node is gonna
call our index a GS so we're just
telling no demon to call Babel node
which then calls index J s now Babel CLI
download Babel node for us so that's how
we're able to use that okay let's go
ahead and create an index J s file here
is we're going to actually put our
server and for our server what we're
going to be using is Apollo data and so
this is called the Apollo server express
we can go ahead and copy this in and
paste it so we need to go ahead and
install the dependencies for this so
Express body parser and Apollo Server
Express
but first let's clean this up I'm gonna
use constants at a var I'm also going to
put this on port I think I'm gonna put
this on port 8080
you can put on whatever port you want to
and then we actually need to create a
graph QL schema for this as well well
first let's go ahead and install these
so here's terminal over here you're
gonna go these are regular dependencies
for adding so we also need graph QL
Apollo server express was I believe the
name of it
yep server express body parser and
Express okay so now that we have that
our servers good the next thing you want
to do is to do the schema so for
generating a schema we're gonna do
something like this where we just
basically have some string and that's
gonna be our schema and then we will
write resolvers like this and then we
mash them together by using this make
executable schema so we need to install
graph QL tools to help us with that
so I'm gonna say yarn add graphical
tools to our project as well and then we
can copy and paste this into our project
right here okay and so these we need to
go ahead and create some and import type
deaths from schema and import resolvers
from dot slash resolvers
okay so we need to add both of these two
files now so let's first do schema j/s
and here we're just gonna export default
a string and now our string here I'm
gonna just start this off with a basic
query to make sure we set everything up
okay so I'm going to say hello which
returns a string and then I can also do
the resolver so resolvers ojs and here
your resolver is just going to be an
object and we have a query type and our
query type this is an object our query
type it has a hello in it and it returns
a string so we can just return hi and
there's one last thing when you need to
do to test this guy out and make sure we
have everything good is to do set up a
graphical endpoint so this is something
that comes with our server
it's called graphical express we just
say app dot use whatever endpoint we
want I'm gonna say graphical and then we
just say graph a cool express and then
here you can pass in a couple different
parameters the one we care about is the
endpoint URL so endpoint URL and this is
just where your graph QL is set up so
our graph Gailen point is slash graph to
L so we're gonna put that here okay so
now if I start this server and I go to
localhost 8080 / graphic 'l we should be
able to run a query so i'm gonna go
ahead and say npm start which is gonna
start up no demon and babel node looks
like there's no errors everything up
looks like we have one oh we forgot to
change that so I called this schema here
and then here we have a different name
so I just need to change that all right
so let's see so notice how the app crash
nice thing about no daemon it recognized
that I saved it and what it does tries
to restart the server so it's currently
restarting right now and it looks like
it worked ok or else we'd see an error
so if I come over here to localhost 8080
/ graphic 'l we can see if we did
everything right we should see graphical
pop up and we do so now what we can try
is the query that we created I can say
hello and we should see hi papa nice so
this is our graph QL server it's all
setup the last thing we want to do is
setup Redis so now to do that we're
going to be using this library right
here called node Redis so the first
thing we're going to do is install it so
I'm gonna come over here I'm gonna open
up a new tab in my terminal so I have
the server still running here and over
here I have a new tab and I'm going to
just say yarn add Redis to install it
and now what we can do is we can come
over here and just import it so import
Redis from Redis and we can start using
it now we're gonna do a simple example
similar to this we can copy this guy and
I'm just gonna do this above the app
right here this is just initiating the
client I'm gonna use the default server
here I'm gonna say Const and actually we
don't need that because I'm gonna say
Const here because we're importing Redis
up here we don't have to read we don't
have to re-import it with require here
if we can change this to an arrow
function and we're gonna console.log if
we get any errors here this is actually
you know the actual meat of the thing
meat of our so these are actually
register commands right here so we don't
need to put them here where we want to
put these is in our resolvers so what
you can do is you can put a parameter
here called context
and the context will get past all your
resolvers so notice how in Redis over
here it says client dot set client each
set so you want to be able to access the
client in your resolver so you can call
these things so the way you do that is
you pass it through your context so I'm
gonna pass client in and now in my
resolvers I can actually access this but
first let's set up our schema to support
now that we have Redis I'm gonna do a
little different setup so we have a
query I also want a mutation so I'm
gonna call this mutation set which it
takes a key which is a string and I'm
gonna make it a non null and I'll say
the value which is also a string and it
returns a boolean of whether or not we
set this correctly and then our query
I'm just gonna call get you pass a key
and then you get the value which could
be a string which is going to be a
string actually okay so you can set
stuff with our mutation and then you can
get it with the query so when our
resolvers you can say so that's our
gonna be our query there let's do our
mutation first because the query we're
gonna have to do a little different set
up and I'll show you why in a second so
set this has a couple different
arguments the first is parent the next
is arguments arguments is going to be
key and value so what we can actually do
is to expand that and say key and value
so we can use that the third is that
context that we get passed in here so
what I can actually do is actually just
grab the client and that's all we need
so now what I'm going to do is I'm going
to say do a try/catch try catch
so I'm gonna just try to say clients dot
set key value and I'm gonna make this an
async function so we're gonna await that
and if it if we didn't get any errors
we're gonna return true otherwise there
was an air we can console.log see what
happened and return false we did not set
it okay so that's our set the next one
is a get so get parent again we are only
passing a key for the argument so we can
just expand four key and the client is
here as well and so here what I'm gonna
do is very similar right so try oops
catch and I want to say return client
dot get key right otherwise return null
so if there's a problem we're not able
to get it for some reason we want to
return null saying there's no key right
but this actually won't work and the
reason for that is this client get here
it actually only supports callbacks and
not promises so if we come over here we
can see how they're doing it is this is
one example they have a function here
that they pass in which is to grab it
but what we can do is we can actually
pass in bluebird which is a promise
library and then you can do promises and
then we can do something called get
async which will work so instead of
doing get we're gonna call get async
here and we need to install bluebird so
i'm going to come over here and say yarn
to add bluebird and then all we're gonna
do is import bluebird and call these two
things so this is gonna happen over here
so my client right here I'm just gonna
basically add bluebird so that way Redis
uses bluebird so promises work so import
bluebird from bluebird
all right so now on our resolver up here
we try to get this key if we don't get
it we return null all right otherwise we
just return what we did in our set so
let's give this a try our server should
have automatically restarted now you'll
notice the server restarted and Redis is
having connection errors and the reason
for that is I haven't started Redis so I
just downloaded Redis from using the
command line I have the command-line
tools so I can just run Redis server to
start that up now we have it running you
should get this little thing instead
ready to accept connections and you
should see this no longer is spitting
out errors so now I can come over here
this is graphical I can restart it and
I'm just gonna say get and I'm gonna say
my name so this should return null
because we haven't set any keys right
and sure enough it does now let's try
setting something with the mutation so
mutation set key is gonna be my name and
the value is gonna be then so hit run
set is true so it's set correctly and
now I can do git and I can save then
oops
the key is my name we should get been
back and bam we get bitten back so
awesome so that is it for this video
guys that's how you set up Redis with
graph QL now you're not limited to this
I just showed you a getting set example
there's plenty of other things you can
do with Redis and to set up your schema
and get it more advanced and actually
use Redis with other databases as well
so plenty of stuff you can do from here
but I recommend trying out but this is a
nice setup a nice getting you started so
thank you guys for watching and the code
will be up on github
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>