<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>React Apollo Subscription Component | Coder Coacher - Coaching Coders</title><meta content="React Apollo Subscription Component - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>React Apollo Subscription Component</b></h2><h5 class="post__date">2018-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GqIMNp7POJw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so react Apollo came out with a
new component called subscription at
first I wasn't quite sure what the use
of this was going to be whether you
combine it with the new query component
or if it's something you kind of just
use by yourself now with further
inspection of it here's an example of
how you would use it and it looks like
you kind of just use it off on its own
and that you don't combine it with maybe
the query component and I'll show you in
a second how you would add a
subscriptions to the query component but
what it looks like to me is a component
where if you only care about the
subscription part so before this if you
want to do subscriptions with Apollo
what you'd have to do is you'd make a
query and then you'd call subscribe to
more and then you get updates what this
allows you to do is forget the query
part and just subscribe to updates so
here I have a subscription very simple
just noon um and I'm basically listening
for the event where a new number is
added and then I get this data and then
I wait I'm waiting for it until the
event fires and when it does I display
it now how this works is my default data
is null so that's why you see me doing a
little check here to see if it's null
and if so I do waiting dot dot and then
every single time an event fires it
updates the data with a new number so if
we get an event for example five new num
will be equal to five and then we will
transition to six if we get a new event
so we don't keep a history at all of
previous events at all if you wanted to
you could like in the state for example
keep track of all the new ones but I see
this component really being something
where you only care about the latest
event that has happened and this will
make more sense when you see a demo of
this so compare this with how you can do
it with the query component so here's my
query component right here I have my
query and then my subscription so for my
subscription is the same one as over
there my query gets an array
of numbers so my query I'm fetching the
array of numbers again I'm getting
loading data and there's this subscribe
to more this is familiar if you use the
higher component before for graph QL or
Apollo I mean and it does the exact same
thing and you'll notice how it's not
inside data either
so if loading I'm returning null
otherwise I'm doing kind of an
interesting thing right here so usually
what you'll do is you'll subscribe
when component mounts so component will
mount our component did mount so if I
want to keep it strictly without
creating another component there's not
really a component did mount here right
that I could call subscribe to more in
what I could do though is create a new
component like instead of returning this
maybe I returned like my component and
then I pass my subscribe to more
function in like that and that that's a
fine thing to do and then in the
component did mount of your component
you would call this function and
subscribe but what I did here is I check
for this variable called unsubscribe and
if I have not subscribed or if I have
not basically if it's null I subscribe
to more and this is where I subscribe so
basically the first render that happens
I subscribe and then here is just me
calling the update query inside of here
so this is what to do when an event
fires and this is just merging it into
the query so I keep all my previous
numbers and I add a number at the end
but as you can see here you can do
subscriptions with a query component or
with the subscription component the
difference is with query there's gonna
be a query fire before it and this makes
the most sense with an example so here's
my quick query component over here and
the right here is my subscription
component so if I click this ad number
it calls a mutation which then will sub
make an event fire and we'll see a new
number
so you'll notice there's some numbers by
default over here so zero through three
and that's because the query ran and I'm
displaying them mapping through them but
notice there's nothing here but if I
click Add num we see both a for add to
the end and a for here so that's what's
happening so both of them are able to
listen for the event and get the
subscription but notice when we hit
adding them again so over here we just
have the latest number which is 5
whereas over here I have basically a
history of all the numbers before this
and we can just keep doing this a couple
times if we want to and we can see ok
this is only the first latest and this
one we get everything so I think it
really just comes down to a use case
whether you just care about the newest
subscription or newest event or if you
really want to keep all of them and have
like a query so I think they're both
useful and they both have he uses I
think 9 out of 10 times I'm going to be
using this thing over here where I'm
wanting to basically update my query in
real time maybe this is like good for a
dashboard or maybe a count where I just
care about the latest of something but
yeah so that's how the subscription
component works and that's how you can
subscribe to more using the query
component so next I'll be checking out
one of the new components I think it's
called Apollo consumer it's the last new
component or maybe there's one or two
more new components out of Apollo that
I'm going to be taking a look at that's
it for this video guys
thanks for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>