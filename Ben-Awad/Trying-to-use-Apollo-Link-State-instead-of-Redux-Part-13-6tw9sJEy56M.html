<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Trying to use Apollo Link State instead of Redux - Part 13 | Coder Coacher - Coaching Coders</title><meta content="Trying to use Apollo Link State instead of Redux - Part 13 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Trying to use Apollo Link State instead of Redux - Part 13</b></h2><h5 class="post__date">2018-02-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6tw9sJEy56M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so I read your comments and I
agree Redux is definitely overkill for
this project so I thought why not this
will be a good learning experience so
I'm gonna show you guys how to do the
exact same thing that we did with redux
two different ways the first is with
Apollo link-state this was highly
requested and then also how to do this
without any estate management library
because really for this project we don't
new it we don't need it but it's a good
idea if you're making a bigger project
that you'll probably have things you'll
need to use
so using Apollo link state or redux is
nice so what I'm going to do is
basically just go back in time like we
never even did Redux
so I could either just you know take
Redux out of the project but instead I'm
gonna do is just go back a couple
commits so I'm currently on branch ten
this is before we added Redux but
unfortunately we're also missing a
couple other pieces of code that don't
have to do with redux that we added now
the backend we can keep the same but
what I'm gonna do is I'm gonna add the
stuff right now that we are missing
which is just a few pieces of code and
then we are gonna go ahead and see how
you can add a Paolo link state to this
and so I'm gonna create a new base
branch so I'm on branch 10 right now so
if you want to follow along I'm about to
create a new branch that you can clone
or you can either go back before you
added redux or go ahead and just cut
redux out altogether okay so with that
said the first thing that we changed was
how he got our token so to copy this and
by way I'm just copying this off of the
code on github this is our latest code
so instead of just getting a refresh
token we now get a new token and a user
ID and pass the
joking in here and then the reason why
we're getting those is because we
changed our server and we get a token
and a user ID now I believe is how we
did it yep
okay and the other place is in our new
products so in new products we are now
updating the cache so let's go ahead and
go over to new product and we're gonna
paste this in right here and so we also
need to import products query and we
also need to grab some stuff from our
mutation so you can copy this and there
we go so these are all the fields you
want to get from our product that we
added and then at the top we're just
gonna import like we did before so we're
gonna get this from products and then in
products we just need to grab the seller
ID from the products query and then we
just need to export this and cool we are
now up to date with the code the only
difference is we don't have Redux so
we're gonna do the same thing with
Apollo link state so I'm gonna just do
get checkout create a new branch and I
think I'm on 13 and this is just gonna
be our base branch I'm gonna go ahead
and add all this stuff commit this is
basically just removing redux this what
we just did on this branch okay so go
ahead and clone this branch if you
alight to I'll pop this code on github
so branch 13s we're going to start off
and yeah let's add a palo link state in
this video so here's a palo link state
it's readme and the first thing we're
just gonna do is just add it to our
project it's a dis separate library it
does not come with I am pretty sure it
doesn't come with our preset we can
double check this
so we come in here with client yeah
doesn't so we're gonna install this and
then you'll notice a public state we
actually write the resolver on our front
end so that's pretty cool but open this
up the yarn add a poly link state so now
it's added to our project and I can do
it ahead import it and I'm just gonna
copy the code and the readme because
this is basically what we want to do
alright
so pretty simple stuff we're grabbing
with client state from Apollo link state
so that's our import we're going to use
they're creating another in memory cache
so this and we're gonna put it right
here okay so state link we actually are
gonna add to our client like this and if
you look at the readme the way they do
it is they say Apollo link dot from and
they put it in front of the ACP lick so
for us we don't have a Pollock imported
right now but we it comes with the
Apollo client preset so we're just gonna
say Apollo link and then for our link
right here we could say Apollo link dot
from and then we can pass in our array
now I assume this is doing the same
thing as the concat here so what I'm
gonna do is just put off link there now
if this crashes we can go ahead and
change this later but we have off link
and then we also have our State link so
we're just adding all our links in here
so to create the link for a client we
add our state link our off link and then
our HP link which is an upload file link
so that's now in our client and then
what the heck is our state link doing
over here right so we call with client
state and notice how we pass in a new
cash
similar to how we add a cache to the
clients or we're have two caches going
on one for regular client and one for
our state so here you'll notice we have
resolvers and this is just like how you
would do it on the service side you're
gonna have a mutation and all right well
mutation do we want to run right so for
us we want to add user and we're just
gonna grab a user here right and for us
what's coming with the user is just a
user ID so we can say data and what's
the data and I don't think so network
status I don't think the name matched up
right so update network status is
different than Network status but you'll
notice what we're gonna do is how do we
call this mutation afterwards we're
gonna be adding a at client link so it
knows not to make a server call and it's
our client and you'll notice the name is
matching up so the name here matches up
with our name and our mutation and then
our query over here we can set defaults
to which for us is not really necessary
to add a default but we could and then
you'll notice how we're gonna write a
query and we act client but now notice
this this thing is called a network
status and that's the name we use here
so this is the name of your mutation
this is the name of your query so we can
say get user is the data here and then
here it's gonna have a user and the type
name is gonna be a user so we're gonna
return a user from this so this is the
name of your mutation this is the name
of your query remember this because
we're gonna be using it and then you'll
notice we're getting cash from what
usually is the context and then we're
just writing that data so pretty simple
so now we can call this mutation like we
would call any other mutation so on my
check token beige right I can add a
mutation here and I really want to call
this mutation after I get
so we're just gonna add another mutation
which is fine so we're gonna say Const
add user mutation and this is gonna be
gql and now we're gonna be adding
another one to graph QL here so we can
either just stack them but there's also
a function called compose from a react
Apollo this just makes it a little bit
cleaner to have multiple higher-order
components so how it works is you have
all your higher-order components passed
to the compose function so we're gonna
have graph QL there and we're have graph
kill again add user add user mutation
that is and then this is a little bit
cleaner syntax just compose graph QL
graph QL and then it wraps all of those
and then it calls it on check token now
there's a bit of a conflict because both
of these are gonna add a basically a
thing called mutate and so what we're
gonna do is give them a name instead so
I can say name the name of this is gonna
be add user alright so this looks good
we need to add our GQ LS data here but
now we can call this add user from our
props okay so here we're gonna say
mutation and we have a variable right if
we come back over here we know our
variable is a user and in this case we
don't really need to cut make this a
user we could just say user ID cuz
that's all we need because we need to
have a type here right so I'm actually
gonna change that so it's just an
integer that way it's really easy here
oops
and actually before I do this I want to
make sure that this does go ahead and
work with at least this Apollo link from
but yeah so now let's just passing a
user ID but you could have a user if
there was more fields you wanted to add
right so for us our user is going to be
you know let's not even bother with that
let's just say user ID so we're going to
say just get user ID and this is gonna
be of the type name this is really just
an integer so we'll say user ID all
right so this looks pretty good here now
I'm gonna refresh to make sure that
works the only thing is our mutation is
not filled out so let's finish filling
that out so add user ID right so let's
change the name of that and again the
name here matches the name we use here
so add user ID
let's get that matched up and the user
ID is just gonna be the user ID we get
from our variable and then we don't
really need to return anything but again
remember to add the Act client so it
knows this is not a regular mutation so
let's reload let's make sure things load
all right so stuff loaded good so this
Apollo link from works just fine that's
good okay so I think this is this
mutation is good to call so after this
we have our user ID so we can just say
oh wait this stopped crops that dot add
user ID and then we're just gonna pass
in right so
just like you would do anything else you
pass in your variables so you'll notice
this is just like using Apollo client
anywhere else and calling mutation so
add user ID we just didn't name it that
so let's change it alright cool so it
added the user so how do we get this
user ID right well how do you get
anything from graph QL or with Apollo
it's with a query so we want to get this
from our products over here so we're
gonna add a query so we would like to
get the products and we also would like
to get our user ID so we could create a
separate query but why not just have
this bug built into one right so here
we're gonna get and remember use the
same name so here it's gonna be a get
user ID get user ID and it's gonna be
returning in it so there's really
nothing to like you know grab from this
and actually I want to change this
because this is only an integer we don't
really need to add a type name
I think we can just do that so the data
is gonna be get user ID which returns an
integer so here I'm gonna say I just get
user ID this is gonna be a client I
don't know if my syntax is quite right
on this it looks like it's wrong
hey guys so I figured out why I was
getting that error and I kind of got a
to a state where it partially works but
let's talk about what that means so the
first thing that I was doing very wrong
was passing the cache okay so I was
passing a new cache to both the state
and the client and instead we want to
create a cache up here and then pass
them the same cache to both of them but
then after that there seems to be a
problem that emerges as they do with
Apollo link state so in the products
what I did is I commented it out
products and I got rid of the client and
then I'm just console logging to see if
I get a user ID and I do in fact get a
user ID now but to do that what I had to
do was pass in a query right here and
just a function that returns an empty
object they're just this is like a
little thing to make it work and I oh
notice this is a not how the readme
looks the readme they say add act client
so it knows what's what right so that's
that's what the first weird thing but
here's the thing notice how I commented
out product right it doesn't work with
running products they or two but notice
one my mutation now I don't have to add
a type name I can just pass it like this
and also in my products our check token
user ID is not an integer is a string I
forgot about that that's not really
causing us a problem I don't think but
that was just one of the things that I
forgot to switch I keep reading that
user IDs a string I was
thinking it was just an integer like 1 2
3 or whatever that wasn't really causing
the problem we don't had a type name but
notice what happens when so this is me
when I add the client it will break over
here and we get missing field so I don't
know why so like if I run this with
products it's wearing it the same
problem it's able to fetch the products
but I can't find this get user ID and
I'm not sure why and now if I get rid of
that and run both like this it has
trouble getting the user ID because
we're not getting it from the server
right we need to tell it to get it from
link state and I looked on appalling
State I looked up some of these errors
looks like there's an open issue about
this and maybe by the time you're
watching this is all fixed but there's a
pull request about it and as I'm
recording this five hours ago it hasn't
been accepted yet and it looks like
there needs to be a change with it but
anyway it looks like a Paula link state
is not currently good to go now I could
just be doing this way wrong so do let
me know if you think I'm just this is an
error on my part I'm thinking it has to
do with something with Pauling State I'm
gonna wait for them to up their version
and go ahead and install their new code
and then maybe that'll work
but what I think I'm gonna do is just
leave this for now and then I wasn't
gonna finish out the rest of this video
with Paula link state either because I
think a Paula link state and redux are
both overkill for this because really
all we need is to grab the user ID in
one place right in the products so I
know this doesn't really work but I'm
thinking this has to do with appalling
state I had time for watching this maybe
this will work out for you so do give it
a try yeah but that's it for this video
guys and the next one I'll be showing
you how to actually do this without any
state management libraries without redux
without paul like state
but let's it I'll see you guys then</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>