<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to setup GraphQL Subscriptions Nodejs | Coder Coacher - Coaching Coders</title><meta content="How to setup GraphQL Subscriptions Nodejs - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to setup GraphQL Subscriptions Nodejs</b></h2><h5 class="post__date">2017-06-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/XmNmiBfk6M4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys so I'm going to show you
how to set up subscriptions graph QL
subscriptions on Express server now if
you don't have a server setup I'll have
some starter code link below if you want
to follow along that will be on github
they can follow along with this if not
you can also work on your own Express
server and I'll show you how to it I
really want to make this video though
because I feel like there's not a lot of
good like resources out there for how to
do subscriptions and also the
documentation like scattered between two
different sources so I'm going to go
ahead and put these links and
description below as well that way you
can follow along and get more
information but yeah without further ado
let's get started so like I said we're
going to already have an Express server
setup and so same one I've been using
graphical template if you've been
following along and we're just going to
plug it into that so I'm literally just
going to take this right here and copy
and paste it and then I'm just going to
remove this stuff we called it I mean we
obviously don't need these three lines
here so you can undo those and I'm just
in the index folder of my our index file
of my project and I'm going to paste it
down here and imports that we're going
to need we're not going to need pub/sub
here I'll explain what that is and we're
going to use with that later don't worry
about schema we have our schema but
these three things we need so I'm going
to put them at the top all right this is
already installed comes with node we're
going to have to install graph QL and
subscriptions transport so I'm going to
pop over to terminal and use yarn from
the yarn add graph QL and then let's
just copy and paste this you transport
oh that did not copy well
at all there we go let that run add it
and we can come back down here alright
so we already have an Express server
setup running so we don't need to create
it we don't need this we already have
our endpoint right here for graph QL you
don't need that so really just we need
to create a server using the app now app
matches up with whatever you use to
create your graph QL for us it's called
app 2 and then we're going to do server
dot listen to start up the server and
then our schema is called schema server
is called server and we can lab that all
tab over in good
yes lint doesn't like this because I'm
using new but there's no error here
that's fine because I'm not saying it to
a variable we're just going to leave it
here in this path is very important
slash subscriptions we're going to be
using that in the client now let's start
the server we would do app dot listen
before instead we're going to server dot
listen so it creates it with this
subscription server now our graph QL
still works though because we plug that
in to this create server so we can just
delete that and literally just copy this
entity and by the way this imports path
here can be anything you like I have it
on flash subscriptions that was the
default that they give us recommend I'm
going to keep it and just have it like
that alright so now we're you can accept
subscriptions what we need to do is we
actually need it in our schema defines
and subscriptions and then handle them
in our resolvers but where our server is
now capable of accepting subscriptions
and here's the port number it should be
three thousand all right also let's pop
over here real quick looks like
everything got started okay installed
okay if I go to package the JSON okay so
this happened to me so before is
notice how grass ql went to a dev
dependency and I'm pretty sure yes lint
the FCI es Len doesn't like it what I
did to solve this is I just did yarn
remove graph QL because graph QL is
actually a regular dependency it's not a
Deb dependency because if we're going to
add this to production we'd want there
to buy new yarn remove and then yarn add
graph QL and usually that work if it
does not work for you do an NPM install
- - save so notice how graph QL works
for me now that doesn't do yarn remove
graph QL and then go ahead and do MPM
save graph you'll and give that give
type this command and it should work out
for you all right well yeah it's
important you wanna see graph - well
here we have this set up there we're all
done with this page now in this page it
shows us how to actually add the
subscription to our schema so I'm going
to copy this and we're going to come
over here and we're actually not really
going to use this I just like it as a
starting point so we don't need this
type basically we what's important is we
need to create this type subscription
and then we create like a schema we can
copy this part we put this at the bottom
so schema right here is graph QL expects
three different things this one you
don't really you know they're all
optional but you have query mutation and
subscription I don't actually have to
call my types for each one of these
query mutation subscription I could call
this Bob if I wanted to but I would need
to come over here and make this type Bob
right but this just Maps saying the Bob
type is the root query but it's better
practice to use good naming so we're
saying query type is a query the
mutation types of mutation and that's a
subscription it's subscription type so
all our subscriptions should go inside
the subscription type now here you want
to basically say what you're listening
for and then this is the output of what
you're listening for
now that output of what you're listening
for should be you know whatever changed
so a concrete example this is what I
showed in the demo and if you want to
see subscriptions in action you didn't
see the video link below you can see
subscriptions in action I show will demo
how they work so here what I'm going to
be doing is user added and then we're
going to return a user and we don't want
it to be null so every time we're going
to we want to listen for whenever users
added we can tap this so it's good
spacing so whenever a user is added we
would like to get a user back right so
the client is actually going to call the
subscription called user added it's
going to subscribe to updates and then
every time a user is added user whoever
subscribe to user added is going to get
that user those created pass to them and
you'll want to create one of these for
each one so let's say I have like I have
a board type right I could say board
added and you could pass it on board and
so you have subscription for board but
it's not just limited to added you can
do remove to write you could say board
removed and you could listen for that or
user removed and you can have you know
you could return the board that was
removed or sorry the user that was
removed but for now we're just going to
do user added and I actually remove
create user but I'm going to put it back
just for simplicity so create user I'm
going to add to my mutation so this
example and just takes a user name which
is a string and returns a user so we're
going to hook it up to this mutation so
every time this mutation is run it's
going to alert all the people subscribed
to user added alright so now we can come
over to our resolvers and this is where
pub/sub comes in so we can pop back over
here pub/sub is how we alert everyone
that hey an update happened so what
we're going to do is we're going to
create this pub/sub object here and then
people can subscribe by calling pub/sub
a think
iterator then you pass in a key right
and what's important about this key is
whenever there's an update we pass this
key in and then anyone who subscribed to
this key will get this whatever this is
right here because this is the update
this is the object that's going to be
sent to everyone who subscribed to this
so we can just go off to copy that
we'll copy this though so we're going to
create a new pubsub at the top of ours
and we actually need to install graph QL
subscriptions as well some of the yarn
add graph QL subscription to add that up
and then down here in my pub sub we
actually need to create a new one here
called subscriptions just like it is
here and we can copy this if we want to
do so we have subscription on the outer
later this is very similar to how we did
query down here is we'll have our query
type inside we'll have all our queries
so our subscription and then all our
subscription so our subscription was
user added and yeah user added and then
subscribe is what they do to subscribe
and we return a sync iterator this is
just from pub sub what they use to
listen all right so we can create a key
we don't we'll call it user added it's
just user edit so this is just a string
that references it user at it alright
next thing we're going to do is we need
to publish an event so anytime we want
people to get updated you need to
publish an event right we said we want
to update people that there is an event
every time we create a user so when our
mutation is out here we actually need to
remake create user and I'm going to copy
register because it's basically the same
thing so create user it's going to be a
think takes apparent args all that stuff
looks good and we're going to pub/sub
here
to a walk us through your house is going
to work so first we have our user here
so args we're going to get past a user
name so this is really just an object
that's like this we're going to keep as
args we're going to put a password in it
just because that's what our database
takes we're go ahead I don't know
because this is not you know this is
just a dummy creating user to show you
guys and we need a password to create it
in the database so then I'm going to
create the user rate and this is
actually what we want to return from
this query so I'm gonna say Const user
added is equal to and then we're going
to wait so this is an async function so
we can use the await syntax and what
this does is just waits for this finish
like it suggests so whenever this is
returned we get the user so this is the
user that we just added to the database
so hey guys we just added a user right
so now we want to do pub subs up publish
we want to do our user added so everyone
that subscribe to this string and then
here we're going to say user added and
then our user right here which would
just we could just put in our user added
thing here and at the end here we're
going to return user added and so this
is the part this is because we have a
subscription we're doing this right this
pub/sub thing returning here and doing
this this is just so we resolve this
mutation and then we're doing a pub sub
before your return that way everyone is
alerted and that is pretty much it the
server is set up and it is good to go to
accept requests so now our client can
hook up the first thing our client we're
going to do is it's going to call the
SUBSCRIBE function and so it's going to
be listening anytime a published event
called user added everytime pub/sub
publishes user added it'll get that
information so here when we do pub sub
it's the client subscribe to it when we
publish it here they're going to get
whatever this object is
that's going to be sent to the client so
that is it for this video guys our
server is good to go and I'm next going
to show you how to implement this in a
couple different starter kits so I'm
going to start out with react QL and
then also do in next gist and maybe I'll
do some more as well to show you how to
take advantage now that our server is
able to handle subscriptions so if you
guys have any trouble setting this up
who do you leave a comment below I'd
love to help you guys out and I'll see
you in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>