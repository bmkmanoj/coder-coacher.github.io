<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>I Figure Out What I Was Doing Wrong With GraphQL Subscriptions | Coder Coacher - Coaching Coders</title><meta content="I Figure Out What I Was Doing Wrong With GraphQL Subscriptions - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>I Figure Out What I Was Doing Wrong With GraphQL Subscriptions</b></h2><h5 class="post__date">2017-08-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/HkSu74fIGuU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so I was struggling with
subscriptions on Sunday night trying to
figure it out and I was being super
stupid I just realized what I was doing
wrong and I was being super silly
everything's set up right it's going to
be a super quick change so let's fix it
now I was just like reading a comment on
YouTube and it just hit me I'm doing
subscriptions slightly wrong here's the
subscription tab on Apollo and notice
how they're calling graph GL here
they're passing a query you pass your
subscription hear you call subscribe to
more here's what I was trying to do I
was trying to call graph QL on the
subscription which does not work at all
so I was being super stupid so let's get
rid of that because that's not how it
works
now instead what should happen is if I
come up over here and in my component
little mount because I can call
subscribe to more from this data that I
get from here I'm not supposed to do it
from over there so if I come over here
to react and I just pop open this and I
think I have my server running still
let's make sure I do yep cool handles
real quick
I make a new branch subscriptions
working because I think I know how to do
this now actually we're not trying to
change anything with baklava it's only
rows that needs to change right because
check out because the branch we knew the
server was working when you something
wrong with the client when I was doing
this so creating new branches for this
subscriptions working okay
so come back over here popular reacts we
can see the props of just this component
here alright so home component we had
data I was thinking you had to have a
sub here I don't know why I was singing
this I've done this before too so this
is a subscribe to more function we want
to call here so that's good we see it
then data subscribe to more so we're
going to say this dot prod subscribe to
more and then here's where we put all
our logic for a subscription all right
so come up here to subscriptions and now
we can see what we put there so I'm just
going to copy this we're going to change
it out for what we need so no variable
for this subscription on the document is
going to be what are you know graphic
well for the subscription which we're
importing here cause what happened so
what happened in the update query this
is what you want to do after you get a
you know an item a revoked
you know once the subscription has been
triggered so subscription data situation
data that data and this is going to be
common added for us it should be vote
happened what happens and then here what
we should get is two things the
suggestion ID and then the increment
amount and so what we want to do is we
actually want to go through the previous
I'm actually not sure what the value of
previous is so I'll just return previous
and console.log suggestion ID console
dot log increment amount and console dot
log press and see what all these values
are and then we can do stuff with them
so console log subscribe to more is not
as function and that's because I just
need to stocks data
okay all right so this will happen when
a vote happens so let's create another
one of these guys and it will vote so
okay so here's what it looks like and
what we want to do is we we actually
don't know what board it's on so we're
gonna have to loop through all the
boards and then all the suggestions only
find where the ID matches we increment
the what is it what the vote Mount is
all right so let's do that
so this is an object with all boards
soap Rev all right so we want to loop
through and I'm just going to be a for
loop on so I think this will be the
easiest way to do it so let I equal 0 I
is less than will take on all boards
equal to probe and we'll say all boards
dot length I plus plus and then here
we're going to loop through these
suggestions so let j is equal to 0 J is
less than all boards I'm going to get
the position and then we get the
suggestions and then dot links I plus
plus oh sorry
J plus plus and then here we're going to
say if suggestion ID equals all boards
at position i dot suggestions a position
J check against the ID then what we're
going to do is we're actually done right
we can break out of this for loop
so we'll say calm what done is equal to
false if done break so here we're going
to say done is equal to true because we
found right because we found the board
that we want to increment the suggestion
so all we're going to do is say all
board's position i dot suggestions J dot
votes I think is what we called it we
can see position up votes and we'll say
plus equal increment amount and then
here I'm going to break and so we're
breaking out of this for loop and then
we finished in the breakout this for
loop and then we return prod and
actually I don't know if this reference
is the same thing so I kind of want to
say pres dot here just to make sure
because we want a beaver mutating this
all right
I'll see if that works all right so I'm
not there and we have plus and so if
this did work which it didn't reach you
this increment to 1 so it can't assign
to read-only property both okay so I'm
trying to mutate this object and it
looks like this is an immutable object
so it wants to create a new one so let's
do that
so I'll get rid of all this junk I just
created we're going to have to do this
the hard way
so preval boards dot map all right so we
have X we want to do the same thing so
for each board we want to return the
same board and then oh this is add we're
gonna have to loop through all this this
is such an efficient algorithm that I
have right now I'll leave it in for now
and then maybe I will make this faster
later because what we're going to do is
we're looping through all the boards and
then all the suggestions even if we're
already done that's the only thing I
could slightly speed this up now we'll
just do this this way should be pretty
fast as aren't going to be a ton of
boards anyway all right so we're mapping
through all the boards here and we're
putting the values of the boards here
and then suggestions we're going to do X
dot suggestions and we're going to map
those too so that's going to be Y and
for suggestions here we're going to say
keep the same value and then the votes
now the votes should only change again
if the suggestion ID is equal to the ID
here so wide ID is equal to suggestion
ID then it's going to be Y dot votes
plus and commit amount otherwise if it's
not that we just return Y dot boat
all right and here we go I believe that
we're first and hang up vote missing
field and boards are three missing a
field all boards and the array
oh he I need to keep the same prep
object so all boards if you go to probe
to all boards so does a lot Creve there
and I mess it up somewhere oh that's
that so take this back there and that
should be a comma here okay I messed up
the things here what we want to do just
put this back what I want to do is set
this to a property in an object so we're
ending it here so this is now going to
be an object I'm going to say all boards
equals that and then we also want to do
prep all right so we're modifying only
the all boards property of pres and I
don't even think anything else was
improve I don't remember when we
positive logged it but this should work
for us now okay damn so now you notice
how it popped up there so we know
subscriptions is working and now let's
do one final test so I'm going to open
in another browser here and put these
guys side-by-side we'll come over here
login we'll create a new account slash
register or call us Tim Tim
some and I don't remember if we and it
looks like we got an object back I don't
think I am transitioning pages yet if
this successful I need to do that though
so I'd submit cool so now ten can vote
on this and when 10 votes here we should
see in our other window here that this
updates - so I'm gonna say hello - so
hold - should go to - so we see two here
two here and bam look at me just like
come over here vote up all these guys
they pop over here so nice
we have subscriptions correctly working
now apologize for me being dumb over
there in the last video with this we got
this working nicely now so that's good
so thank you guys for watching and I'll
see you guys next Sunday
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>