<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>One to One Relations in Typeorm | Coder Coacher - Coaching Coders</title><meta content="One to One Relations in Typeorm - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>One to One Relations in Typeorm</b></h2><h5 class="post__date">2018-03-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tewE75bsek4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I want to go over how
relationships work and type arm the
first one I'm going to go over is
one-to-one relations so I want to kind
of just copy this example and show you
how it works so right here we have a
profile and we erase it up a user entity
in the last video and I went ahead and
just simplified the user itself and if
we take a look under my user entity I
have one field just first name that way
we don't waste a lot of time typing out
fields so I'm gonna create a profile
that type script paste this in and this
is what our profile is gonna look like
and I'm just gonna get rid of that
column and I'm gonna call this favorite
color as one of the fields now this
doesn't automatically it relate to user
to actually get it to relate this is
just another table right now we have to
use this right here so let's copy that
and what this does is actually create
the relation now I need to go ahead and
import each one of these things join
column and also profile okay so right
here I'm specifying the type or the
relation that I am gonna be related to
right so I want to have a one-to-one
relationship with profile and profile is
entity over there that we just added
now I also need to say the type script
type which is also a profile and we're
gonna be getting a profile back from
this so now if we come over here and I
were to just play around with this and
I'm
just gonna open this up say Const user
is a wait and make this asynchronous I
can say user dot profile and there's now
gonna be a profile on the user possibly
undefined okay if you use it it's
telling me that because I could get
nothing back from this so we have now
dot profile on this now something we
don't have automatically is the profile
ID so if you are familiar with tables or
databases if we go into this we can
describe what our user table looks like
it's just described there so you notice
we have a profile ID and we don't
currently have that on our table right
here we only have the profile it Excel
itself and sometimes you don't always
want to just load in this profile you
might just want to deal with the profile
ID so what you can do is add a column
and make it knowable true and this is
going to be profile ID which is gonna be
a number so now I have the ID of the
profile in case that matters to me so
now I'm at this console dot log a user
here and see what it looks like and what
fields are on it
and I don't care out this is statement
now all right so switch over here and
I'm just coming to my playground and I
need to really create a user first so
I'm gonna create a user first name is
gonna be Bob
alright so idea of one user ID one and
let's grab its first name all right so I
can't return null let's go ahead and
return this at the bottom all right but
notice how we now have this field called
profile ID but we do not have for
example profile even though we see
profile column here so by default it
does not fetch the profile it just has
the profile ID on it notice if we look
at the query at R and it says from user
right and not from the profile table -
if you want it to grab that you have to
specify relations and then you pass any
relations you'd like to and now the
relations are going to be strings and
they're the key so I called it profile
here so this is gonna be profile so now
we're gonna fetch the profile for this
user now he doesn't have a profile so it
should return null so fetched that I
forgot to actually return the user here
area
but you can see now we're doing if I
scroll up we have a left join on the
profile itself and nothing going on here
so now let's say I want to create a user
with a profile how would I go about
doing that
so let's create a user here and before
we fill in that
why don't I create a type called profile
and it's gonna have favorite color which
is string and we're gonna have a profile
on my music and now one of the
parameters to create user I'm gonna say
is an input type profile input which has
a favorite color which can be a string
so now I'm gonna create one so profile
is gonna be a profile input and I'm
gonna make it optional you don't have to
pass a profile in creating a user so now
how would I do this
so first thing I'm gonna do with the
args now that I want to create a profile
and associate to the user I actually
need to do this in two steps so I'm
going to say Const
profile is equal to profile create and
I'm going to say args that profile so
that's gonna create the profile for me
and I just need to import this and I'll
top over here I just need to say extends
face entity
and now I can do this okay so after I do
profile dot save and await it it now has
a ID in it so now when I create my user
here so first name our stuff first name
I can now pass in a profile ID which is
just profile that ID and then I can't
return I can actually just return that
and just do dog save on it and let's put
those on the same line so now we're
gonna create a profile first and then
create the user notice I have to do this
in two steps i I don't know if there's a
way to create it in one I saw that there
is a profile type on this it's not
showing up in autocomplete right now but
doesn't seem to work for whatever reason
so here's creating the user and we
return back a user now so let's try
creating one so create user pass a first
name it's gonna be Bob - and now I also
in a passive profile let's go ahead and
reload profile and it's gonna be
favorite color which is gonna be pink
now we're about to get in air let's get
the profile as well at that favorite
color object has own properties not a
function I don't know if this is a bug
with type worm or what but if I just
pass the arguments and with the profile
like this as you saw we get that air and
I can show you in the console object
that has own property it's not a
function but if I just spread the object
like this all of a sudden it works just
fine besides not returning null for the
profile
notice how we create a user and create a
profile creating profile first and then
the user I'm not sure why the user
didn't create it on it I don't know how
I guess so it didn't pass back the
profile when I created it for some
reason what I can do to get around this
to say it's user is equal to that and
then user returned user and then profile
like that so now when I create Bob 3 who
likes pink 3 Oh what now we don't have
to user ID all right I'm gonna do this
in two steps
oh I didn't oh wait it a wait user dot
Save there we go so now Bob for pink
four and bam so I want to query my users
before - actually I'll - keep what I
have
so query user
I actually just get all my users so
notice again we return null and that's
because we inspect by relation so it
doesn't fetch it so if I say relations
profile it should fetch those for me now
and left join profile looks like I
crashed something or broke something
I'm curious what this is returning
because it's not returning my profile so
Kant's users are gonna wait that console
dot log users and just return users now
I believe it did work up here so let's
try it with that so user ID and I have
an ID of three so fetching a single user
works just fine and we can see it does
do the left join profile like we want it
to so I'm gonna save this and see what
we get when we try to find a profile so
users
and poops
so profile is just I guess it's no on a
single field and that's causing the
problem but it actually is fetching the
profile that's good I thought it wasn't
fetching the profile so let's just let's
just change our type so I said profile
is mandatory let's make it a knowable
field and now we have no problem or this
query should cause no problem anymore
and perfect so this guy didn't have a
profile that's why I was throwing air
before so this gives you an idea of how
you can create and fetch users with
relationships I don't tend to do this
very much since I'm usually using join
monster to go ahead and run the queries
for me but this I do do so creating the
user like this I wanted to go over real
quick one-to-many relationships to those
are pretty simple as well there's
nothing much to them and then I want to
try a little experiment with this so I'm
gonna copy this example as well so this
is with photos so photo type script and
so they're creating a many-to-many
relationship with user
we're not many many but many to one and
so we're gonna add this now you'll
notice no go ahead and tell me there's
an error because user dot photos doesn't
exist now if I add this that should go
away
because it was looking for that type oh
I've got an important photo so now that
we have a photos type on the user on
this error goes away but for example if
I was gonna call this photos too
immediately we get another ear so notice
that's matching up and checking the type
for us there now with this notice one
too many from the user and many to one
from photo so the way we're setting this
up is the user can have many photos so
the foreign key is gonna be here so this
is where I could say column knowable
true and I could say user ID is equal to
a number and then fetching this is the
exact same as we did over here find and
creating as well and also sometimes when
whenever if things start acting wonky
always come back to this the query
builder I've noticed is super solid and
works really well sometimes the
relations these thingies can act a
little weird like here when we weren't
getting the profile back when creating a
user this has always worked really well
for me so check out the working with
relations with the query builder that
also works really well but what I want
to try next is if I create a user
if I can say user dot profile is equal
profile so if I could just I want to see
if I can set the profile like that and I
still need to save there and then if I
can just return the user so console dot
log user so let's see what this looks
like I think this is probably the
correct way to do it so create user and
let's make this a mutation first name
alpha profile favorite color is black
okay well just say that all right nice
so we got it back so this looks like a
better way to do it so interesting
enough the profile ID is null so we get
the profile from this or the idea of the
profile so profile dot ID so here you
can actually just set the property of
user and then save the user and did it
relate them it did go ahead and relate
them we can see notice it does
transactions for the inserts and it does
them in two bits right there that's kind
of interesting transaction one
transaction two I guess for each safe
but yeah that's all for this video I
want to look at main to many
relationships next those are a little
bit interesting so I'm just keep that
into a separate video but that's all for
this one
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>