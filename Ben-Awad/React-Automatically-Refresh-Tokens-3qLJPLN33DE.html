<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>React Automatically Refresh Tokens | Coder Coacher - Coaching Coders</title><meta content="React Automatically Refresh Tokens - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>React Automatically Refresh Tokens</b></h2><h5 class="post__date">2017-07-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3qLJPLN33DE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys I'm going to be filling
you in a little trick that I like to do
to basically keep users logged in all
the time with refresh tokens so there as
long as a user this is how I want it to
work
I'm leaving the memory fresh token that
will last a week and if they don't login
within a week they have to real aughh in
but if they log in once and then they're
constantly coming to the site they
should never have to login unless they
haven't used this site within a week
that's how I'd like it to work and right
now we're never refreshing the token at
least in the front end and react unless
they login so I'm going to show you a
little trick I like to do so we're
always refreshing the token without any
work at all and if you don't have the
code for this server or for the react
stuff I have links in description below
you can get in take a look at so the
trick we're going to use is after we're
so this is something that Apollo client
gives you that is run after a query or
mutation so we're going to copy this and
we're going to use this so it's kind of
the opposite of middleware middleware is
run every time before a quest this is
run after a request and you'll notice on
the server here's the server code I was
actually this chunk of code right here
what was this doing or I'm exposing
headers and then I'm passing these back
right you know this is what the response
and the reason I'm doing this is I
actually want to pass the refreshed
token and the Refresh refresh token back
to the client so they can automatically
store that in local storage we're not
doing that right now but we can be doing
that with lope with this after we're so
we're going to actually look at the
response from the server see if they
gave us an ecto connect refresh token
and if they did we add it to local
storage automatically so that will
automatically refresh us because you
notice right here we're checking if the
token is good if not we try refreshing
it and if it gets refreshed we actually
just pass it right back to this
all right so on the client side what are
we going to do so we don't need this
stuff here this is just the basically
bare bones of what after where it looks
like so we say use after we're and by
the way you'll notice that this is an
array right here and there's an object
inside you can add as many afterwards as
you want
same with middlewares we only need one
and in the response we want to look at
the header and actually I'm not sure if
it's header or headers
I think it's headers actually you know
what look I'll just
console this so you can as you can see
what this looks like so I'm going to
console dot log response and show you'll
see like when this is actually fired off
and what it looks like so we can see the
response you know it's only consoled
once because we aren't making one
request and if we open up we can see it
here okay it is headers so we're going
to want to read the headers here we
didn't refresh any tokens at sign but if
their words headers we want to so
headers here and I'm going to say comps
token you're going to be equal to
headers that get and then X token and
then refresh token is X - refresh token
now the name here and here
match up with what we're passing back
here alright so we can grab those two
and then we're just going to a little
check if token because you notice
sometimes we don't pass it back if
refresh token so we're going to say
local storage dot set item token token
and same thing for refresh token
all right so this will do is just as the
user is using the site and making
requests going to different pages every
time they send a request to the graph QL
server the server's going to check if
the token is valid if it's not it's
going to try refreshing it if it does
refresh the token sends it back to the
client and then our client side runs
this after where where we actually just
add the Refresh token to local storage
that way the user can just keep adding
you know keep using the site without
having to login now if they don't use it
for a week that's fine right did we just
say you have to go back and login
because this code will never get run to
refresh add new tokens to local storage
so that's how I like to handle this
you'll notice just look how little code
we must look how little code we wrote
this right here on the client side this
on the server side and now we're
handling we don't have to call refresh
token ourselves on different places on
different page on app load we don't have
to worry about any event just like a
little thing we do after every query it
doesn't take a lot of resources at all
so I really like doing it this way quick
little trick for you guys recommend
trying this out if you would use refresh
tokens and that's it for this video so
thank you guys for watching the code
will be up on github and see you guys
next video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>