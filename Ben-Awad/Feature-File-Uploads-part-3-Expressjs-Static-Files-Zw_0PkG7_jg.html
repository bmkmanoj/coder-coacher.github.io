<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Feature: File Uploads part 3 - Expressjs Static Files | Coder Coacher - Coaching Coders</title><meta content="Feature: File Uploads part 3 - Expressjs Static Files - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Feature: File Uploads part 3 - Expressjs Static Files</b></h2><h5 class="post__date">2017-11-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Zw_0PkG7_jg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so we're able to now upload
images and files to our server and
actually see the files pop up on our
computer and see them being stored so
next step is to actually show them in
our application here render the images
have them pop up but before we get into
doing that I want to fix two small
little things the first is notice how I
can figure out how this get this button
from not clashing and how it gets even
worse as I shrink the screen you guys
gave me a nice suggestion on how to fix
this in the comments with CSS so we're
gonna fix that real quick and we just
need to add 50 pixels here and what that
does is gives a fixed width for our
button and then our input just stretches
the rest of the way additionally you
could do this with flux and we could
have a display flex and then settle with
and then have the input flex the rest of
the way so now it looks nice and notice
when I shrink it it still looks good so
perfect the next thing is with our
sinned or a message container here I had
file upload just kind of plopped it in
here but that causes a problem and the
reason for that is it's wrapping the
comments which is fine but if there's no
comments it actually just shrinks to
nothingness so take a look at our random
Channel if I inspect notice how our
ignore div that's our file uploader is
nothing I can't drag nothing happens
when I drag over here because it's so
small so we're gonna fix that the
easiest way that I thought I would fix
this is just make messages file upload
basically just mesh the styles together
so I'm gonna create a style tag here
and I'm gonna pass all the styles that
messages has so I'm just gonna get rid
of messages delete that all together and
just gonna copy all the styles and have
over here our file upload this this
component is just going to be our
wrapper for the messages now we have to
change some stuff here we're gonna have
commas instead of semicolons at the end
and we just need to camelcase stuff so
in the styles that's how that works
and then we just need to wrap everything
in a string there we go there we go give
that a save so this is our Styles we
want to apply to this file upload now
our file upload is not expecting a style
so we just need to pass that in so style
and we're gonna default it to an empty
object because not every time we call
file upload we want to change the style
and let's take a look at that now
okay so everything looks the same but
let's see if we're able to drag and the
notice ignore is now this and dragon
perfect we see a pop up all right so
that fix that now let's get started and
getting this picture to show up here so
the first step in doing this is to
actually get our server to show the
files that has so right now we have
these files here here all the files that
I've uploaded some of them are extra and
I deleted the messages that's why you
see a bunch of files here and only one
message here but anyway we want to take
these files and serve them allow users
to see them and so Express lets us do
that really easily with this right here
app that you static Express static
so we're gonna copy that and this allows
us to basically whatever folder name we
select so ours is gonna be files though
every file in that folder is turned into
our URL so slash hello / images all that
stuff is turned into URLs that people
can access so for us if I come over here
to the index here's our server and I'm
just going to paste this in so the name
of ours is called files that's the
folder name that we have here and then
here's the URL I want it to go to I'm
gonna do slash files and to visit the
individual files I go to slash files
slash files slash and then whatever the
name of the file is so upload bla bla
bla bla bla would go here and I'd be
able to access it so that's cool so now
we actually see the files are able to
access them because there's a URL to
them an express is exposing that URL
that we can access
so in our server over here we're already
have access to the URL there on our
front end I mean because in our schema
we gave you the URL and the file type so
we don't need to use as a file type
right now but we'll be using the URL so
in our message container over here and
the two queries I can grab that URL and
I'll type
so this is for our subscription they
also want to do it at the very bottom
here for our query our message is query
so we grab it for both and now what I
can do is I can say if m dot URL we can
say image source and here I'm just gonna
specify the server URL so HP / localhost
8080 1 and then / whatever the URL is
which is in that URL and there we go um
it's getting red lines because I didn't
do an alt and say that and let's take a
look and bam we see our team will pop up
very cool and if we drag over we see
another Timo appear we have to teemo's
and we could do that as much as we want
now now that is well and good but what
about other file types and also this is
kind of annoying here having dat add the
localhost here every time so there's we
could do it like this this is not
terrible right it's kind of annoying but
another approach we could do is actually
add this to the graph QL because we
expect if we're given a URL we shouldn't
have to pin stuff right we should just
have to do MDOT URL and it should work
so in our server over here I can come
over here to message and I can say
message URL I can say parent
and I'm just gonna check if there is a
URL right if there's a URL I'm gonna
format it otherwise I just return what
the default is if it's null or whatever
comma and now here I can grab that
parent I you are L and I can format it
whatever I like
so in our message container we want to
grab that and put it over here so now
every URL that we pass back to the
client will already have this prepended
to it so the client doesn't have to
worry about that I just have to pass in
my dot URL give that a save I'll just
refresh and we see timo pop up same as
before but now we letting our server
handle this and we're gonna hard code it
like this for now but this is better to
be stored in a environment variable
because when you're going to production
this is gonna change and different stuff
so but we'll keep that for now so cool
so that's all good let's worry about
other file types so about text file hope
that doesn't work what about an audio
file that doesn't work so the way to
handle this is to detect what the file
is because we shouldn't be serving an
image for text file or for audio file
each one is going to need a different
format so we're gonna create a message
component here and we're just going to
pass in the message and
and we're gonna let our message
component um handle this now our message
component isn't very complex so I'm just
gonna put it at the top here
Kant's message but you could get as
fancy as you would want with this paste
that in here so from our message we only
care about the URL the text and the file
type so if we come over here to our
database I'm gonna go to peace equal
connect to slack and I'm gonna select
file type from messages so I can see
these are the different file types so I
can detect if it's a text or an audio
file and handle them differently or if
it's an image so right here I'm just
gonna say if URL we're gonna do some
stuff to detect it otherwise we're just
gonna return here and what we're gonna
return is this text that we have that we
wanted to do before just paste it in all
right and then our URL with the source
this stuff is gonna come up here so
we're gonna check if it is if we have a
URL then we're gonna render stuff
differently up here if we don't have a
URL though we're just gonna render as
default which is a text it's a comment
and here we're going to say if file type
dot starts with and I'm just gonna do so
for this we have image slash JPEG PNG
all kinds of different stuff right so
I'm just gonna do starts with so image
slash if it is I'm going to return an
image tag
and you save instead of em that URL we
just do URL so we basically have the
same logic as we had before but now
we're detecting if this is an image tag
we're gonna get nothing to render for
these guys cuz we're not handling them
right now but at least same thing works
if I say hey we see it handles those two
good so now what I can do is I can do an
else--if file type dot and I can just
say equal if I want to if I want to do
text slash plain specific way techstop
plain now there's not a tag that we can
just use to render plain text so I'm
gonna have to create my own we'll call
it render text given a URL we're gonna
have to create our own component for
that so I copy this render text we're
gonna come create our own component
render text and alright that's good so
for render text what we're gonna do is
import react from the act is we actually
just need to fetch the text from the URL
and display so export default class
render text extends react component so
we're gonna have a render function here
and in a render function we're gonna
render the text of the text file so
texts is going to be a string and I'll
just say Kant's text is equal to this
state and now slack has this all pretty
and it has a nice little frame that adds
for a text if you enjoy CSS and styling
up you're welcome to stylus up as much
as you want for now I'm just gonna do
like a little little pattern here with a
little border so we know that this is a
text file versus a regular text and I'm
just gonna render the text in a
paragraph tag but like slack you could
dress this guy up and some nice styling
and see nice text here but right now
we're not actually fetching the text
we're gonna fetch the text and our
component will mount and I'm gonna make
this an async function so I'm gonna say
Const response and we're gonna use fetch
await fetch at this dot props type loops
the URL that was passed in so we're
gonna fetch the URL that was fetched
passed in which is a text file so we can
say context is equal to response dot
text and we need to wait that so
basically all it's doing is getting the
text from the response and the text is
what we want to render so I just say
this set state does equal the text so
the text file that I dragged in now
hopefully will get fetched and show it
here and it does hi I'm a text file
that's what I wrote in here we can take
a look if we open it up says I am a text
file cool and I can drag him in pops up
again our new message which is really
cool to see it just in stoop op up here
I can do that I can do an hour timo if I
want but we don't have our audio file
working so let's get that working real
quick too because that's really easy
so that's in our message container and
as you can see you could do this for as
many file types as you wanted to support
in your slack clone so here I'm gonna
say slash audio since there's lots of
different audio files this one looks
like it's some weird format and we're
gonna return an audio tag so this is
something I did not know about the HTML
actually has its own audio tag that we
can just use so I'm gonna copy that
paste this guy in and we can just do
controls like that we don't have to
worry about browser support we'll assume
your your browser has this tag give this
a save
I think it's complaining because I'm not
adding a caption
oh no closing tag oh for our source
there we go
and what does it like now I need to add
a caption we won't worry about that so
the type is whatever our file type is
right so oops
so delete that and pass in our file type
and the source for it is our URL so 0 so
this is kind of like a image except we
can rat we wrap it in this audio for
controls all right so now if we screw up
we can see all our audio tag did not
work
did I do something off source URL file
type file type and I need to do file
type dot starts with not equal to
since we're making this generic you
could also do regular expressions if you
wanted with this fresh and cold now we
see our thing I'm going to add a div to
this so it drops down and here's the
audio player that comes with just an you
know HTML that's there I'm gonna upload
a new one so we can do it at the bottom
and I'm gonna play it I don't know if
you guys could hear that but that was me
saying hello with the record audio file
and I can download it if I want so sweet
that's all I wanted to do for this video
so I hope you see how you can support
different file formats and display them
in different ways however you want to
and just check the file type render
conditionally and express is really nice
allowing us to grab the files really
easily with the static and you saw how
easy it was it even worked with
subscriptions no extra work needed to
add there it just instantly pops up
which is really cool and we can we can
check with this I didn't do this one
once cool still works but that's it for
this video guys thanks for watching and
as always I'll push this code up to
github
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>