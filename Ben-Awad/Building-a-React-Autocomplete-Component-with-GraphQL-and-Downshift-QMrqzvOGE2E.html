<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a React Autocomplete Component with GraphQL and Downshift | Coder Coacher - Coaching Coders</title><meta content="Building a React Autocomplete Component with GraphQL and Downshift - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a React Autocomplete Component with GraphQL and Downshift</b></h2><h5 class="post__date">2017-11-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QMrqzvOGE2E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're able to direct message
with other users and the same team as us
but we're not able to easily navigate to
this right now we're just having to go
into the URL and changing the two IDs
here and what slack does to navigate and
to be able to direct message with users
is they have a little plus here that you
can click on and what that does is
allows you to pick up a little pop-up
and you can type the user's name you
want to talk with and it'll do a little
auto-completion where it has all the
names of the users and the team and you
can select that and then they'll pop up
a little dialog like this and you can
talk to them so that's what we're gonna
be building the little pop-up that you
type so first thing we're gonna do is
add a little button to our direct
messages right there and then to bring
up a little modal kind of how we're
doing this with channels if you're the
team user or team lead so we're gonna
first go into channels so this is the
container we're gonna be working on the
sidebar our channels here we're just
gonna add like another little button to
it
so kind of how we added this little add
circle icon to our channels we're to say
do the same thing for direct messages so
here's where we say there were direct
messages and we're just gonna copy this
and you'll notice we only show this if
we are the owner of the team for direct
message you can message users if you're
not the owner of the team so we're gonna
get rid of that oops
we're always here going to show this
icon and
let's just go to our front end real
quick and see the whole icon that
appears make sure it works cool so now
we have this little button so now when I
click on this what I want to happen is a
little modal to come down and I can
invite people to the team ok so I have
this on click so I'm gonna call this
direct message on click or will just say
direct message click and we're gonna
pass this on a prop so on direct message
click and I didn't put on in front of
here so on there we go
and so we need to pass this prop air
down to this in our sidebar over here so
similar to how we're doing it over there
and we have a toggle for each one we're
gonna have open direct message modal and
that's gonna be false and then we're
just gonna copy a toggle for this so
instead of toggle add channel we're just
gonna toggle direct message modal so
open direct message modal ergo so now
down here at the bottom we can copy this
and we're gonna create a new modal this
is gonna be the direct message modal and
we're gonna have a team ID passed in
because we need to know the team that
we'd like to chat with the user so
that's important to pass down and then
on clothes we're gonna call toggle
direct message and then we need to grab
it from the state whether it's open or
not so we call it open direct message
modal and then that's what I'm going to
use here to say whether it's open open
direct message modal and in here sidebar
direct message modal okay so we changed
the key because that needs to be unique
pass those and we need to actually
create this component and then right
here we need to pass and the on direct
message click passing in our our
function that toggles and not the ad but
the direct message okay
so now let's create this little modal
copy this direct message modal I'm going
to create this in our components so a
direct message modal and now if I come
back over here should Gera the red and
we don't need a decode anymore summary
with that from the top there alright so
I'm gonna go ahead and just copy what
we're doing over here because it's gonna
be very similar at least the modal part
now I'm just gonna make sure our opening
and closing of the modal works so let's
just click on that and it does that's
good so now we need to talk about what
we want in our direct message modal so I
want a little input box like this where
I can type and it will autocomplete the
names of users and then when I hit the
name of a user that I like it'll
actually just take me to the page where
I can chat with them so the way we're
going to create this little box is we're
gonna create an auto completion one and
I really like this component it's called
downshift that helps you create these
and so we're gonna use this and I'm just
gonna copy their getting started example
because I think it's really easy and
we're gonna take this and modify it to
work for our setup so I'm just gonna
copy that and to come in to this direct
message modal and paste it in
and I'm gonna come over here to terminal
and just say yarn add downshift to add
it to the project okay
so let's first carve out the stuff we
don't need from this cuz we have a lot
of stuff we don't care about any of this
we really just care about open on
clothes and then we also have a team ID
which we don't even know if we need to
here for now
we don't need any mutations and we're
not using formic because we don't well
we could make this into the form but
we're not going to we're gonna just use
downshift for this so this is going to
be a direct message modal and we'll
paste that here and so we don't need
this query here we don't need this stuff
and I don't need all this we're gonna be
using an input field so I'll keep that
and I'll keep a cancel cuz why not
so we can have a little cancel button
and we don't have to worry about
disabling and then on click fluid that
looks good
I'm not sure oh the tensions just off
and then input field here we're gonna
we're gonna change so here's gonna be
search users and then we're gonna copy
and just move our autocomplete up here
okay so we're importing downshift and
then our little example here we're using
this downshift we can copy all of that
we're gonna put down shift where our
input field is and for now we're gonna
hard code so they're they're calling the
values and ok so they're on change
they're just console logging and they're
calling items so actually we're gonna
create - to make this simple I'm just
trying to think of the simplest way to
move this over
tarus because I want to use this input
field so instead of exporting direct
message modal I'm just gonna export
default this little function here and
instead of calling basic autocomplete
it's gonna call our downshift or our not
a downshift but our function up here
direct message modal and you guys will
see what this is doing in a second okay
so now I can move down shift and put it
here and get rid of this basic
autocomplete and then the items and on
change we can take as parameters here
this is what I was talking about I
suppose we could actually just hard code
it here so I'm gonna say selected is
equal to console dot log selected this
actually makes more sense let's just
hard code it for now are we using items
anywhere just there so the items I'm
going to keep Apple orange and carrot
and now I can get rid of this actually
so export default direct message modal
okay so let's just go over real quick
what I just did I'm gonna comment out
this input so right now we have this
downshift
component basically that I just copied
in here I haven't gone over how this
works or what it's doing let's see if it
works and what it looks like and then
we'll explain what it's doing alright so
it looks like cancel works that's good
looks like it doesn't show it says
favorite color and turned it and put it
into a thing but nothing happens when I
type which is kind of weird I don't know
if I broke it actually I didn't start
typing wait all right there we go now it
works so favorite color I can type in
and as you're typing look how it filters
and I can hit enter and then you notice
in our console we get which we selected
as you can see it's a little bit buggy
and I think that could just because our
modal right here on the way it renders
so I'm gonna make this input how we have
this so I'm going to create this as an
input capital I so this uses semantic it
looked like it was using it anyway
though and I'm gonna make you fluid and
we can change the placeholder if we want
to notice how they're doing this get
input props and they're passing the
placeholder in through here instead of
just saying placeholder like that the
reason they're doing this is just so it
doesn't get over it in this is something
they have in their documentation they
talk about but all right let's see what
that looks like now so orange or if I
say a PL and so as soon as I select it
for us what we want to do is we're going
to navigate to a new page so let's look
at what how this is working so we have
this downshift component so this makes
sense we pass an on so every time we
select something we get the selected
item cool that makes sense so then we
have all these props so downshift is
I don't know if you've seen this before
these are called rendered props I
believe we're down shift go starts here
ends here the tag does but you'll notice
in between here we have a curly brace
and then a function call so here are the
parameters to the function so down shift
actually is calling this for you and it
passes you all these parameters and then
you create the function so you take
these parameters that down shift gives
you and then you output HTML or
JavaScript JSX
all your stuff that you have here so
down shift takes as a child a function
and it calls that child and gives it
these parameters so we use them and
you'll notice is open input value
selected item all these things make
sense to how this is working over here
and you can use them to customize the
experience okay so we have this thing
right here which is our input so we
notice we're taking input props so as
we're typing it actually knows what to
do we have to pass in these props so I'm
sure there's on change prop in there and
some other stuff is open now takes up
the rest of it and is open this is that
little box that you see under it so as I
type a or letters you see it underneath
and I was when I hit s just disappears
that's because there's none with an S
and the reason why they made it like
this
is so you can customize how everything
looks like you notice how they just have
divs here with borders you can make this
a lot prettier if you want to so here it
has is open like basically have we
started typing it I believe is pretty
much what's close to with is open so
whether we should show this thing and
then it has the items so here are the
items this you can pass in as a profit
that if you want to this is basically
your data and you're just gonna filter
based on what the user has input so for
us the input value so the input value
would be whatever I'm typing here so I
have type
ABC so or a B so the input values a B
and all it's doing is its filtering from
this list all the ones that it doesn't
match and then after that it's mapping
the results so it's actually pretty
simple so it takes the whole all the
suggestions possible filters away the
ones where it doesn't match whatever you
typed here and then it displays a div
with each item and here we're just
giving it a key and some styles and then
we're passing the prop here the item
prop that we get from down shift and
this is just something down shift needs
us to do so this is pretty close to what
we want but instead of a favorite fruit
hard-coded we want to show different
sets of users depending on our team and
all the users in the team so let's do
that so the way we're going to do this
is to add graph QL to this component and
make it display all the users that we
have in this team and that's going to be
like instead of Apple orange carrot so
I'm gonna import gql from graph QL tag
and we're just gonna do a little graph
QL here now we don't have a query in our
back-end that supports this so we're
gonna have to write this we're gonna
create some kind of query called get
team members and we'll call it this is a
query get team members query and we're
gonna fill out this query in a little
bit and I'm just gonna call graph QL on
this guy passing in my get team members
query so then here I can say data I'm
gonna say loading and get team members
query and so I'm gonna call it get get
team members actual query that we write
which we haven't yet and so that's what
I'm gonna feed here so get team members
so get team members is going to be an
array of users and then the item here
it's gonna have an ID so I'm gonna use
that as the key and then item dot
username is what I'm gonna show to the
user and this is fine and get item props
I think we can just pass the item like
so there and then loading we're not
gonna show this this until it's done
loading so I'm going to say loading
or not loading will show this downshift
component and let's see why just
expecting there yeah okay so that looks
good so now let's actually create this
get team members query so we're gonna
come to our back-end down here so first
we're going to create the schema for it
let's make this in the team so we're
going to make a query get team members
so this is given a team ID which is
gonna be an integer we pass back an
array of users where the users are the
team members of that team now this is
our mutation we have to go to our query
do we not have query here I guess we
have no queries alright let's add our
first query I guess we have our query in
other places or we got rid of them so
what I named this get team members so
copy that paste it here and this is
gonna require off so we can copy that so
we're gonna get past a team ID as an
argument and we're gonna have model site
user and let's just close that close
that so here's our thing so console dot
log hi okay so here's where our query is
gonna go and now I'm gonna write this as
just a sequel eyes Roth query because I
find that easiest to write because we're
gonna be doing a join similar we're
basically going to be doing what we did
with our a guy right here where we're
fetching against members so I'm actually
gonna just copy this
because it's gonna be similar ish and
come back to our team resolver so this
is what I'm gonna return the return
value of monoliths equalizer query here
I'm gonna have one replacement the
replacement is gonna be a team ID and
the model that we're gonna get is users
back and we should get an array of you
this back
and so here we're gonna select all from
users as user and I'm not even gonna do
any of this join stuff we're just gonna
say we're or sorry so select all from
users and we're also going to actually
know it was to drawing I was just gonna
do an implicit join but I think this
will make more sense if we do a regular
join so we want to join this against
members and find all the members of the
team and get all the users so we have
their username so select all from users
as and we'll just call this you join
members on emmerich say members as em
and we're gonna check m dot user ID is
equal to and that's gonna be you ID so
we're matching up or finding the member
for each user
oops and then we're gonna come down here
and we're just gonna say we're member
dot team ID and we're gonna check that
against the team ID that we received up
here and we can even say you know join
on this as well so let's look at our
resolver how was I doing replacement is
it just a question mark yeah so we'll
add a question mark here
um graph QL is not defined oh that's
that's our front end so let's see what
the problem is here I think I just have
a missing parentheses or something oh
there we go okay so now our query is
done I believe there's gonna be a
problem with this and we're gonna get
duplicate values but we're happy to run
this and see I think we're in a
duplicate values because I'm not
filtering I'm not saying distinct users
and the users can be part of multiple
teams but we'll see I'm gonna get rid of
that because we don't need it here let's
create the query and run it now on our
front-end so I'm just gonna go a little
closed and create it so we're gonna
query given a team ID and this is going
to be an int and we're gonna say get
team members given a team ID and all we
really care about is the ID and username
of those users run it prettify it to add
to our front-end so that's our modal
here paste it in here and looks like I
just forgot oh I forgot to copy it looks
like I forgot to import graph QL
so let's import graph QL from react
appalled alright let's see if we get any
errors now and let's see what the value
of get team members is what do we get
back I think we're gonna have to use the
distinct keyword so click this and
crashed it so right now we're assuming
eyes a string here when I call when
we're filtering i dot to lowercase which
now it is a knot it is what's it called
an object and I'm just gonna do a little
trick here I'm gonna console dot log get
team members so we can see what the
values is notice how I'm using an oar
here that just means it's gonna log this
and it's gonna show this all right so
we're getting two values we get to users
perfect so we have Bob and Bob too
so we're getting our users correctly I'm
gonna get rid of this now and I'm gonna
move this back up
so now over here with this I I just have
to say i dot username and i looks good
let's see if we have any other errors Oh
unexpected token I'm just gonna undo
undo and then undo that again there and
do da username okay
no if we type Bob I can't do Bob - or I
can do Bob there and we get this object
thingy here I think that's because I
need to do item item dot username so
item or Bob we get Bob Bob - we get Bob
- now the only problem with this is I
want the object here alright I want so
like I want it to show Bob - here but in
our console you notice how we got a
string I want Bob - I want this object
because the object has the ID that way I
can actually change the URL they go to
so I think all I have to do is right
here actually I guess that's not what's
controlling it I don't know how to
change this so it shows there passes me
the item to the on change but what it
shows here is not the object I'm sure
there's a parameter and
downshift that we can do but worry about
that in a second what I want to do is
real quick finish this so when I call
that what I want to do is I want to
actually change the URL up here and
navigate to the user page so right here
what I want to do is something like this
so this should be selected user and I
want to say history dot push push we
don't have currently access to the
history object so we're going to talk
about that in a minute
but I want to go to slash view team and
just make sure we get this route right
slash review team slash user slash team
ID slash user ID so slash user slash
team ID and the team ID we're getting
past as a prompt so a team ID there and
that's you don't remember where we're
getting this team ID from in our sidebar
over here and channels see how are
passing the team ID in so now we have
access to it there and slash here's the
user ID so that's gonna be the selected
user ID so now this history thing so
with history since we don't have access
to this history object because we're not
a route only these components have
access to the history object we could
pass the history object all the way down
or I'm gonna show you another way you
can do this since this is a couple
components down and it'd be kind of
annoying to pass it you can say with
router
from react react router Dom I'm not sure
why they didn't autocomplete and with
router is a higher-order component and I
can just wrap my component like this and
then wallah I have access to this
history through my object up here it'll
pass that prop in so now let's give it a
try so now when I actually select one of
these teams like Bob for example and hit
enter what it's supposed to do is call
this function here and move us to a
different page but it did not so
something went wrong let's see what went
wrong I'll to copy this and I'm gonna
just put some console.log statements
here and I'm gonna say console dot log
history console dot log yeah let's just
console.log the history object that's
the thing pushes how you change page
right let's make sure I'm not just
messing this up am I using a search for
history so in my source
this star props yeah pushes how you do
it
alright so oh you know what I think it's
cuz I was on that page Aereo bob is a
thing Bob BAM okay notice how we are
changing your URL up here so Bob it's
changing I just need to close this modal
so there we go
and then let's just call on close so Bob
awesome do Bob
one awesome pulls up so it looks good
and I don't even think we need to worry
about getting it till it's automatically
clearing already for us which is nice
and we can switch back and forth so
that's cool so that's how we're gonna be
selecting and changing different users I
want to do a quick little check on that
and make sure we're not going to get
duplicate values on users it's because
we only have two users and two teams in
the next video what we're gonna do is
we're going to test out this component
more rigorously and make sure it
actually doesn't get duplicate values
the way we're gonna fix that oops is in
our resolver here we can use the
distinct keyword in here distinct which
we'll add in if we get problems with
this not working and that what that will
do is we'll fetch only not the same user
object basically twice but that's it for
this video guys I'll push this code up
hopefully you see how cool down shift is
we're able to easily made a little auto
completion field that's pretty nice and
I highly recommend if you like coming
back in here and making this a little
bit more stylish because you can get a
nice little autocomplete styling
sup nicely but that is it for this video
guys thanks for watching and I'll see
you in the next one
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>