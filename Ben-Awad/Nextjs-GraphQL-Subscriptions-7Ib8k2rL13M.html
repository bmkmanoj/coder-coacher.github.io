<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Nextjs GraphQL Subscriptions | Coder Coacher - Coaching Coders</title><meta content="Nextjs GraphQL Subscriptions - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Nextjs GraphQL Subscriptions</b></h2><h5 class="post__date">2017-06-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7Ib8k2rL13M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys I have a next-gen up and
running right in front of me and if
you've been following to my other videos
you know it looks very similar it's the
one I've been working on we have it set
up with a graph QL server and next year
F is up and running - so in this video
I'm going to be demonstrating how to do
subscriptions with next years now I have
that video before on how to do it with
react QL which is gonna be very very
similar but I wanted to make this -
because next year is actually slightly
different and if you do the exact same
thing as reactive L it actually won't
work so I wanted to make this video to
show you guys now if you just wanted to
follow along and you don't have any of
the other code don't know what I'm
talking about I'm going to put links
description below and you can get the
code off of github and I'll link the
videos if you want to see how I got this
do you even work without further ado
let's just get started with this so
we're going to follow the same kind of
documentation that we had last time
except we're going to do things slightly
differently we're going to do the same
structure but you'll see what I mean in
a second so we can just go ahead and
copy this this will be in the link in
description below - so you can follow
along with this and copy and paste so if
you have the same project as me go to
Apollo and in it Apollo if you work on
your own next year's application
wherever you're creating the Apollo
client all right so we're just going to
copy and paste this here and we're also
going to paste the subscription client
as well and then we can get rid of the
stupid guest and we can also before we
get started coding go ahead and install
this library so I have already have this
is the next year server up and running
and I have the graph QL server up and
running - I'm going to yarn add just let
that run and install okay so I'm going
to do things slightly differently I'm
going to write out these variables so
Yuri
which is your graph QL endpoint this is
what it is for me and then I'm also
going to do the subscription and grab
that here
and this is actually a different
location if you've been following me my
servers running at four three thousand
and these subscriptions route okay um
and we'll put that here we connect URI
URI and cool that looks good we don't
need this okay
so this code I'm going to get rid of the
comments this chunk of code right here
where I'm creating the WebSocket client
the network interface and then attaching
the two we're going to move down below
and we're going to keep these up here
you can move them down here if you
wanted to I guess you don't will the
year you want to keep up there though
but the other one you could tab this
over one more time okay
so we're actually going to change how
this create function works the reason
why I have to do is slightly different
in this code is run on the client and
the server side so right now it does not
take a networked inner loops I don't
know okay I just hit undo on accident
okay so this create function we're going
to pass in the network interface I'm
going to short case it to an eye instead
of creating it here so we can get rid of
that and I'm just going to put min up
and I now we're not going to supply a
network interface all the time and when
we don't we're going to do network in a
create network interface and just create
one with the URI that we have here but
when we on the client side we want to
create that with subscriptions so what
we're going to do is just pass and our
network
interface that includes subscriptions so
what's going to happen is actually going
to get run on the server side this is
going to run and on the client side it's
going to run this which will be with
subscriptions if you're on the
subscriptions on the server side it gets
messed up so that's why this is an
important difference between doing it
next yes and doing like a server side
rendering compared to other things okay
and now that we have this set up it's
going to be the same process as before
for setting up subscriptions so we have
some react code here we can just create
a subscription right here and this is
just going to be our graph QL
subscription code mine is right here I'm
going to copy and paste it so this is my
subscription so I can start listening
for this query and we're going to
actually have to make this a real
component or not a real component but a
non-peer one kind of created into a
class so let's move that over right now
react our component and the reason why
is we need to use component will mount
that way we can subscribe to more and
we're going to render and then return
and we can just copy what we have here
and then we're going to say Const
all users which is going to default to
an array and get that from the props and
we get rid of you and down here we're
going to call this on uppercase index
okay so we have we actually haven't
changed any of the code we just
converted this to a non peer the class
now component and now we want to add our
subscription to this component and
actually call subscribe to more alright
so for
thing let's add it to our component so
we can actually even do it so one ways
what we could do is we can do graph QL
subscription and then we could wrap it
like this so you have this guy is a what
they called a higher-order function
that's going to return a component and
then we do it again with subscriptions
or as both query and subscription but as
you can see this can get very messy very
fast so Raph QL actually supplies a
helper function which we're going to use
called compose which does the exact same
thing as this but it makes it a lot
prettier so it's easier to read edit
your code so now instead we're going to
put all our stuff here and then we're
going to call index at the end so we can
call graph QL subscription and graph QL
query so these two lines of code are
actually equivalent right here and here
like if we just did read Const graph QL
index these two lines would return the
same code but this is a lot easier to
change manipulate and if we need to add
like a couple more you know it's very
easy I can swap it out do I do add a
mutation or whatever whereas this I have
to keep wrapping so we use that okay so
it's added in now we just need to
subscribe to more so that's going to be
the exact same code as what we did in
react ul so I'm going to copy and paste
it I'll post a link to this as well if
you didn't get a chance to this this is
just the other react starter kit that I
did subscriptions in and I'll explain
how this works when we paste it in
so because we added our subscription
there is a subscribe to more function
that we can actually call from our props
and we first specify the subscription so
we're going to change this because ours
is called subscription
and I should actually change that to
subscription so yep okay we recall it
subscription here and then here is the
update query where we have what the
previous value is where here's what
previous value is for us it is all users
so it's that array that we have so and
this is the new user that I'm getting so
I'm checking if we're actually got some
data if not we just return what we
previously had if we did get a new user
we're grabbing the new user and then
we're adding this new user to the front
of the list and that's it we did
everything correctly subscriptions
should be working okay guys problem was
twofold one and index I did component
will mount which is wrong Annette Apollo
is all right everything's working in
there with the component will mount this
is wrong it should be component did
mount reason for this is component will
mount is run on the server and so you
can't subscribe to data on the server so
stuff gets messed up because next years
is using server rendering so it'll
actually be called twice now this
problem so with component did mount this
is only called on the client side which
is what we need second I forgot here
this should be the stop crops data and
that's it we are now done with this so
I'll demo it real quick if you haven't
seen it but yeah very important this
need to be component amount I bad on
that so okay so just give it a refresh
here so we have our list of things here
now whatever I add is going to pop to
the top here just the way I code it so
let's say side key we user hit run and
damn Kiwi pops to the top so that's it
for this video guys subscriptions are
pretty sweet they're a little different
next yes there's a few little different
tweaks you have to do to make sure they
work
but yeah I'm working so that's good if
you had any questions during trouble
please let me know and also I demote
descriptions quite a bit so I'm not
going to go to ended up but I recommend
given feed subscriptions play around
with this it's pretty cool so thanks for
watching guys and I'll see you in the
next video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>