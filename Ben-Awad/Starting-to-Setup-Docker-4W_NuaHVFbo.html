<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Starting to Setup Docker | Coder Coacher - Coaching Coders</title><meta content="Starting to Setup Docker - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Starting to Setup Docker</b></h2><h5 class="post__date">2017-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4W_NuaHVFbo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys there's a great suggestion in
my last video in the comment section
where they recommended doing how we're
doing babble and how we're building it
in a slightly different way and I really
liked it so we're gonna go into that
real quick and then we're gonna start
our journey with docker and get our
nodejs server set up with docker so
here's how we were doing babel before if
we come look at our package JSON where
you ended up using this runtime and
we're using preset F and stage 3 as if
we click on our babel RC we can see
these things are getting run when we do
npm run build but this is actually not
necessary or we can actually specify
which environment we want to target in
the vironment we want to target is
actually a specific version of node
since we're not running this in the
browser there's no need for us to
basically simplify or transform the code
more than needs to because I forgot how
many features the burg currently on node
9.3 so I went ahead and installed that
and there's a lot of features it's
getting very close to Babel it's gonna
be a very soon where we don't even need
babel at all because no GS just supports
all the features but we can actually
tell babel to transform the code so it
works in 9.3 and that's what we're going
to do and that just transforms less code
and transforming less code is good
because it just leaves more room for
less room for air which is always good
so I went ahead and upgraded mine ojs to
9.3 I went ahead and using the latest
stuff the there's 8.9 is also still
available for the stable but I don't
mind using 9.3 and getting the latest
stuff but up to you which one you want
to use there and a new version might
even be out by the time you're watching
this but anyway so I have that installed
so if
just type no - V we can see oh and I'm
actually on 9.2 I thought I was using
9.3 and let me just close my terminal
window and reopen there we go
mb m and I'm just going to know - p mb m
used 9.3 okay there we go okay now on
9.3 so if you don't know what m vm is
it's called node version manager so
right there you just saw me switch from
9.2 to 9.3 and now my note is 9.3 and
that's what I'll be using so I recommend
upgrading if you if you'd like to and
use mb m because it makes it really easy
Trin to transition between different
versions okay so now that I have that
setup what I'd like to do is over here
in our dot Babel are C so we're using
this in preset over here what we can do
is we can actually target what type of
node we want so I'm gonna copy you and
paste this in here and I'm actually
gonna get rid of we don't need our
runtime plug-in anymore and now that
we're targeting a specific node version
that's high enough so we're gonna do and
we're actually gonna do nine point two
here and the reason for that is a docker
does not have nine point three yet but
even though my know version is nine
point three targeting nine point two
still works and we could also do the
other way I have a target nine point
three and docker be a little bit off but
either way it should work and maybe
everybody time you're watching this
stalker nine point three is out too and
you can try that so anyway so switching
that this over now we're we're using
node nine point two and if I do am p.m.
start it's going to transpile using that
and we should get an air with this
okay I couldn't get that and we have it
installed right here babble preset em
I'm pretty sure yep it has it right here
so I'm guessing it's having a problem
with I just upgraded to node 9 so the
best thing to do when you will change
node versions to this to actually just
kill your node modules so I'm gonna do
that and just do NPM install and have it
install everything to make sure I have
everything up to date and I did try this
before and I believe what will happen is
we'll have a problem with bcrypt and
we're gonna have to rebuild that guy as
well and when I using 9.3 I was actually
using an old version of NPM before I was
using below 4 and the reason for that is
if you've heard of Expo it's a react
native kind of a spinoff from react
native where it just it's create react
native app uses it and allows you to
basically add some features to your
development environment which is pretty
nice but anyway they only use NPM less
than 5 I believe in p.m. Forks they had
a bug with it I don't know if that's
fixed yet I need to look into that but
now that I'm using NPM 5 or whether I
just did MDM and switch to MPN 6 or node
9 I mean my NPM improved or upgraded so
I think I'm on 5.6 let's see em p.m. - V
we can see ok I'm on 5.5 one so that's
above so we should see also I get a
package.json a walk file for that
all right but anyway when this is done
and it gets running we're gonna see a
new error and that is with object
spreading so we're gonna have to do is
install plugin for that and if you
remember that's why we installed stage 3
I'm not really sure if it's better to
add another preset or to just add a
plug-in for this transform object I'm
thinking this is better because this is
specific to just this object spread so
I'm gonna go ahead and go with this over
using stage 3 so we're gonna install
this guy like so and let's see how far
we're almost up looks like it's just
about done and you can notice we're
getting some bcrypt looks like we're
rebuilding that that's good
all right cool that started so I'm gonna
do MPM start I'm hoping this will crash
now hopefully crashes on babel node now
let's see yep see how it says it can't
find the operators all right so I'm
gonna paste this in install that plug-in
and how they recommend adding that is in
our babel RC we're just gonna copy this
and then we're gonna come over here to
babble or c comma paste it in and now
that I'll transform for us and now the
nice thing about this in reuse 9.2 is I
can actually uninstall babel plugin
transform runtime and also and we can
close that and also one of the 10 C's
over here babel runtime we can actually
totally get rid of ok so and if you have
trouble with bcrypt make sure to run npm
rebuild like this so all right let's do
a p.m. start oops and see if everything
starts up good so now we're pointing it
to using node 9.2 so when I build it I
can use note and coolest starts up
so I'm just gonna do yarn remove that
will run time and also the plug-in here
transform runtime because we no longer
need those it's always good to get rid
of dependencies you don't need and now
we can go ahead and run npm run build on
this and use our latest version of node
when this is done installing and then
after we get that set up we're gonna
start using docker and i wanted to show
you guys so here is all the versions of
docker that we can choose from or not
versions the talker but the versions of
nodejs that we can install using docker
so you can see the hot latest they have
is nine point two point one and we can
and get this version by saying nine
point two or nine or latest in our
docker file which we're gonna create in
a second so if we come over to our
server we can create a new file called
docker file ok but we'll do that in one
moment to finish installing a bit npm
run build and you'll notice a lot
changes over here and our dist we just
take a look and actually let's just do
npm run serve and make sure that does
work and we don't get any weird errors
or anything cool it does startup so nice
so we were able to eliminate one
dependency there babel runtime by
targeting node cool so you also notice a
lot of this code is a lot more readable
because it didn't have to transform the
code as much so that's really nice so
but let's start on dark daugher now so
what I want to do in this video is just
get the server started so here we're
going to say from and say what version
of node so we saw over here the versions
we can choose from all the way here and
this could be updated if more versions
of node come out so I'm gonna say 9.2
and we're gonna say node and then so you
this is the name of the package or image
and then here is the specific so I'm
gonna say 9.2 I could also just say 9
and that'll give us as it upgrades it
should change and then here I'm going to
specify a working directory slash app
and then I'm gonna copy over package
walk that JSON you normally just need to
do package JSON but if you have a lock
file you want to copy over both and then
here we're gonna do copy or not copy run
NPM install to install all the
dependencies and we're actually gonna
get an error with NPM install I'm gonna
show you guys that in a second
so NPM install and then what do we want
to do after that so once we saw
everything we want to copy over dist so
that's our built this is the code that
we actually want to run we copy it over
into that and then we can just do
command and we're gonna run node and
index ojs now remember it doesn't copy
over the folder itself so when we copy
all these things into the current
directory I don't have to do dist slash
index dot JSP cuz it's gonna be right
there it doesn't create a disk folder
okay so it's gonna run it like that so
come in over here let's clear that
I'm gonna do em p.m. 9 p.m. we're gonna
build our image now it's a docker image
docker build and - T I'm gonna call it
slack clone - server and dot because
we're in this current file and I'm gonna
hit enter and we're gonna get an error
when it does npm install because on my
computer current this Mac that I'm
working on I have Postgres installed
globally and so I didn't have to install
the PG package but in docker I don't
have any global things installed so what
we're gonna have to do is in our slack
clone server over here so I'm just gonna
start the install NPM install PG well
which is Postgres so we'll see that the
air pop up over here will actually no
this will build okay but when I start
the server we're gonna get an error
which I'll show you guys in that in a
second when this finishes installing
stuff and when we do make what we'll do
is since we just made a change to our
package JSON we'll need to run docker
build on our server again to rebuild the
image and then to run the container and
we're actually gonna be having another
problem after we do this and that's
because our server doesn't just run node
or it does run Express but it also needs
to connect to a Postgres sequel database
and a Redis server now because we are
using that for pub/sub and docker
containers are don't have access to my
max localhost so right now if we take a
look so how are doing pub/sub take a
look at this notice how i'm connecting
to this host and this port here
well inside the docker container where
this is gonna be running this is
pointing to basically that inside of the
container and inside the container we're
not running a wrist instance at least
not right now so it's gonna be an air
for that because I have Redis running on
my Mac not that okay all these errors I
think are fine they're just installing
bcrypt and different things are
happening cool so let's I want to make
sure yep looks like PG install it over
here okay
but our container that we have here does
not have PG yet so when I do docker run
we've run and we're gonna use this
command and we don't need net so I'm
gonna do docker run - P I'm not going to
run in the background because we're
gonna get an error and I want to show
you guys that and I'm binding it port
8081 and 8080 one over here is coming
from our index J s which is running on
so let's run that so now this is gonna
start up our server and you'll notice
how it says please install PG module
manually alright so we just installed
that so we're gonna have to rebuild now
and then it'll be good now you'll notice
now that we run this build again and I
had run this before so I don't know if
you saw but some of this stuff is
getting cached so I want to show you
guys the output of this when we get to
that point but when you run successive
builds notice how it goes through those
pretty quickly it's gonna have to run
the npm install here again because
basically something has changed in our
package not JSON but see how it says
using cash for that I was able to just
grab it from the cache and didn't have
to rebuild it which is really nice and
if we don't make any changes to our
package JSON and we just make a change
somewhere else
it can interpret it also I forgot to
mention if docker is if you've never
used docker before and this is looking
quite foreign I did do a hello world
with docker with express that I
recommend taking a look at where I just
did a simple Express server from start
and you can just get it working right
away and I'll put a link in the
description below with that okay so it
looks like we're getting close with our
NPM running here all right we got all
our packages done in just about a minute
here and once we have this we're gonna
start off the server and it's gonna
crash because it can't connect to Redis
so here we go start our server and
you'll notice we just keep trying to
connect and it's gonna go on forever and
this is gonna hang your terminal window
so be careful with that so I'm gonna
come over here and my other terminal
window and just type docker container
and we kind tan docker container oops I
meant to say LS I was wondering why I
wasn't seeing this output I thought I
was spelling it wrong I was just typing
their own command okay so this is the
container that is running currently that
is just infinitely going to connect and
I'm gonna copy the containers ID and
just say container oops
docker docker container stop and an ID
of the container and then what will
happen here is after a little bit this
will stop so that's how you can stop
this from going infinitely and that's
we're gonna end this video so here you
can see I got my prompt back and what
we're going to be doing next is getting
this set up with Postgres and Redis so
our server doesn't crash infinitely
trying to connect to them so that's it
for this video guys thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>