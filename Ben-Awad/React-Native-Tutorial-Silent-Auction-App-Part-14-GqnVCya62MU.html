<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>React Native Tutorial - Silent Auction App Part 14 | Coder Coacher - Coaching Coders</title><meta content="React Native Tutorial - Silent Auction App Part 14 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>React Native Tutorial - Silent Auction App Part 14</b></h2><h5 class="post__date">2017-04-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GqnVCya62MU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys welcome back in this
video we're going to be fixing up the
server I just want to thank my crew this
he brought something to my attention and
basically our server has like a small
fall on that right now basically how
we're doing things so thanks Mike for
pointing this out so the flaw that we
have right now is notice how we are
adding the seller ID here or the seller
username here we're getting the seller
ID from a foreign key relation with
users but in our model here we're
setting the seller username and we're
setting it with a hook here add Tiller
username right there's a problem with
this though when we add the seller
username it stays like that forever and
let's say we go like our users Bob and
we set AB username and now it's in our
auctions malasadas your name is Bob but
what happens and this is there's no
updating this like for example if I then
change my username from Bob to like I
don't know Ronde then the seller user
name here is still Bob and that's now
incorrect because the user has been
updated so basically if you change the
user model or the user at all the
auction it gets out-of-date the celery's
negative eight so the way to handle this
is to just remove both of these fields
same thing for top better that's the
wrong way to do things instead we should
use this populate hook and just add the
user name so I'm going to walk you
through adding that in and this is a
much better way to do it so again thanks
Mike for pointing this out and now we
can fix this so the first I'm going to
do is kill the celery well we can keep
celery the name and top bitter for now
we're just going to remove them in the
future
so what we're going to do is first we
can go into hooks
and we're just going to import this so
this is going to be from feathers Hookes
common and I'm just going to follow how
to sub this relationship that they have
right here and actually fault copy both
of these and we don't have the import
feature so we're going to have to just
use require the feather server doesn't
come with it by default and here we have
the easier old schema you can call this
user auction schema and then we're going
to include here the users and the name
that we'd like so for example seller so
what's this popular and going to do what
it's going to do is when we get a
auction we want to get the sellers user
name and the top bidder the values of
these so what we're going to do is
instead we're going to look at the ID
field which we get here
so our ID and we're just going to add
the object so just kind of just show you
what does it look like is we're going to
make some post requests and the server's
not let me turn that on so just starting
server running and so I'm going to show
you I'm just going to indicate with Bob
I'm going to show you what it looks like
before and after adding these the
populate okay paste this in here and
research okay so this is a little looks
like right now if I search this we just
have objects and then we have as we can
see the seller ID here until our user
name is Bob so instead we're going to
basically and remove this field and our
hook is going to look at this value and
it's going to go fetch the user JSON for
that
and so I'll show you what I mean so
first let's go ahead and add it so we go
to this hook so we're going to do users
it's going to be seller is the name so
this is what you want to be called in
your JSON and then your parent field is
going to be cell ID this needs to match
up with what you have in your JSON and
then here child field there's going to
be ID and that's the ID of the user
model and we want two of these so I'm
going to create an array and we got this
to the next line tab all that over
because we also want to get the top
bidder and I'm just going to put a two
so it doesn't conflict with solder one
and we get this from the top fitter ID
so now we can use this and populate our
fields so this is going to be in the
find and they get and if I come back
over here it shows you just go like this
call populate and you pass in the schema
that you make the schema above basically
tells you what data to grab so we're
going to grab the user option schema and
that's just going to grab the user for
the auction all right and then we're
going to have to do one other thing and
that is when you're using the populate
field what you have to do is use plain
JSON objects when you're using hooks and
I'll show you what I mean so if I were
to use this debug and I'll debug find
hello what debug does it just print what
the basically the object looks like now
if I stop this that you're on this right
and I run the send notice how I get this
big ugly object back this is a sequel
eyes object and what we want is just
plain JSON so we're going to create a
hook that just sent that just gives us
the raw JSON so we can say feathers
generate hook and I'm going to call it
sequel live raw and it's going to be in
a before hook and auctions and we're
going to put it for all now we can come
back over here and then in our sequel
eyes draw all I have to do is this is
just a parameter to the sequel eyes hook
or object and we just set we're all
equal to true so now when the return
value from doing a sequel eyes query
it's no longer going to be this gross
object which can be regular JSON and
I'll show you so now if we hit run let
the server start back up and we can
notice we actually see real data now and
it's cleaner and if we come back over
here you'll see now the seller notice
how it passes the whole object back and
this is now we can grab the username the
email all these other data fields which
are really nice so instead of just like
setting the seller username here which
is static we then grab the seller every
time using this ID which never changes
so now if I change my username just
something else besides Bob it still
works
and just to show you where this conflict
is I'm going to actually rename myself
real quick so localhost 30 30 and we do
a patch request and I think it's one
so to update a hip ID one so I specify
what I want to change here or I give the
ID of which object I want update and I
want a song and I want my username to be
Ron instead of Bob and in the header I
just need to pass in my off so can to
actually change that you can copy the
one we're using here page not found I'm
just going to do option oh my gosh not
Auctions users okay so now this guy is
wrong so now if I were to pull this
again notice how we I'm now updated it
wrong with my seller username here still
Bob
so that's incorrect so that's why the
static why this is bad and why this is
better we scroll down here we should
also see for top bit or two but when
there is a top bidder we see this data
as well now I can come back over here we
did break our code slightly by doing
this so now I just go to auctions not
auctions our hook our place bid hook
we're using data values which no longer
exists now that we're using the raw
keyword with sequel eyes but we can just
remove that and we should be good so I'm
just going to restart the server I'm
going to come up come over here and I'm
just going to try to place a bid I'm
going to copy this headers
just to make sure everything's still
working I'm going to place a bid I'm
going to place the bid on auction one so
right now for auction one we have the
top bidder as a but after this we should
see Ron as the top bidder so if I send
this no errors that looks like it worked
- ten dollars more
one hundred sixty two hundred fifty two
now if I request this stuff again we
have Ron as the top better and a seller
all right so that's all good now I'm
just going to clean up this stuff I will
have to reset the database because I am
going to remove some columns here so I'm
no longer going to store seller username
and top bidder I no longer need a add
the the top bit or username here for add
top bidder I still need to add the ID
though for this hook and then the add
seller the add seller username hook is
no longer needed so I'm just going to
leave that and when you remove a hook
you also need to remove it from where
you call the hook so ad seller username
here and solo username kill that okay so
add Scylla username is gone and you
notice how we got removed two fields
from our auctions so I'm just going to
wipe the database so I can hear the PC
go real quick drop the database recreate
it and now I'm just going to just
repopulate the database listing data
making some post requests and then in
the next video we'll be fixing up the
client because we made some changes here
so we have to change basically just how
we handle the data on our client side
and then we should be good but this is
much better now for our back-end so
thank you guys for watching and I'll see
you the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>