<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating PostgreSQL Database Models with Sequelize | Coder Coacher - Coaching Coders</title><meta content="Creating PostgreSQL Database Models with Sequelize - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Creating PostgreSQL Database Models with Sequelize</b></h2><h5 class="post__date">2017-10-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BpEw1PNdvkg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be setting up the
database for our slack clone and we're
gonna be using Postgres and right here I
have the schema that I think I'll be
using here all the tables and then all
the attributes that they will have so
I'm thinking of four main tables a user
table a team table Channel and messages
and then having a join table called
member so a member is someone that is a
user that's part of a team so you notice
I have the team idea pointing to user in
the user ID or sorry the team ID is
pointing to team and the user ID is
pointing to a user and then our user
when I have user name email password
that's usual for our team we'll have a
name and an owner the name of the team
and then we'll actually link back who
created the team that'll be the owner
then our channel here will belong to a
team and also will be linked to messages
so messages a user creates messages and
messages are in channels so we have a
channel ID pointing to a channel and a
message also has a user ID and also as
text and then our channel here can have
a name of the channel it can either be
public or private
so we have a boolean here and this team
ID is pointing to the team itself
because it's within a team so this is
the schema we're going to be creating
and to use it we're gonna be using
sequel eyes seek wise is a node.js
library that helps us actually create
the database models and do all the
database things so we're gonna be
following along with this example here
this is an Express example that's
equalise recommends using since we're
using an Express server so we're gonna
follow along with these guys and create
the models so we're gonna start off by
doing this index J s this is the index J
s is where basically you configure your
models and then if we click on over we
can see what a model looks like here and
you'll notice how they'll actually
define data types and then also do
associations here so let's go ahead and
get started
so here's the code and last time I left
this export kant's kima we don't need to
export so I can go ahead and just kill
that real quick and let's install sequel
I so I'm gonna pop over here to the
command line and say yarn add seek wise
so we'll install that library and then
we can go ahead and use it now I'm gonna
go ahead and create a folder called
models which is where we'll put all our
sequel eyes things and go index ah yes
so as me to create our models here what
sequel eyes will do is actually create a
post rest sequel database and use it so
let's copy this and paste it in here now
they're doing a lot of things here that
we don't need to do so I'm gonna get rid
of a lot of it what this example here is
trying to do is basically read all the
files that you have in your models
folder and then associate them but this
is a very confusing example I like to
simplify a lot because you don't really
need all this so I'm gonna get rid of
this stuff here we do need sequel eyes
but since we're using Babel we can use
this syntax let's gonna say import
sequel eyes from sequel eyes and then we
don't have to worry about the node and
for right now config file we don't have
made we don't have a database URL I'm
gonna get rid of that we want to create
Const we're gonna create a sequel eyes
object like this passing in the database
username password config we're not gonna
have any config so I'm going to get rid
of that we're gonna have a database
object here we can call this I'm gonna
call this models
and that's what we're gonna export at
the bomb so export default models and
we're gonna say models that's equalize
here but we'll talk about what that's
doing a second and get rid of all this
jazz as well get rid of that and we can
actually put this all here okay so we're
gonna have a user model so we can put
that here this part we're gonna keep and
I'll talk about how this works we're
grabbing sequel eyes and we're doing
uppercase sequel eyes here
okay so this is basically how we're
gonna do it and instead of this what we
can do just go ahead and do a dot slash
okay and we're gonna put a comma there
so let's start up at the top so we're
importing sequel eyes and then we're
creating a sequel eyes instance now the
sequel eyes instance here will connect
to our Postgres database so what we need
to do is actually create a database and
make sure we have Postgres installed on
our computers so I have Postgres already
installed so I don't need to install it
but if you don't have Postgres yet go
ahead and install that and with it
should be coming something called P
sequel P sequel lets you basically do
operations from the command line on
Postgres so here i'm going to create a
database that we're gonna use so I'm
gonna say create database and I'm gonna
call it slack and I put a semicolon at
the end and then I'm gonna do backslash
Q to get out of it so now I just created
the database so here I called it slack
so whatever name you call it you want to
put that same name here and then here
I'm just gonna set as a user name
Postgres this is like a default username
and password that's usually on there so
you can just put Postgres Postgres and
then here this is where i'm gonna create
models so we're going out a couple
models user j s and we can come back
over here and see so user team member
channel messages so user member team
message message not messages and then
channel oops that should be channel at
yes so we create a new file for every
single database table and then our index
here we just need to import these models
so here we have a user model and then we
do this for each table we have so we
have a channel and we have a member and
we have a message
and the team so that's five we have one
two three four five cool so then here
you'll notice in our Express example
there is this associate function that
they use and what that does is that's
where you see where I have arrows over
here this is an association so to create
associations and sequel eyes you have to
create this function and say how they
relate and then we actually create the
relations by looping through our objects
so here I'm going to say models and then
for each model I have the model name so
for example user and then all we're
gonna do is we're going to say if that
has a associate method or function then
we're gonna call associate so model our
models and all that's going to do is
kind of loop through all these models
and then associate them together and
then we're just exporting this model so
we can use it so in our index that J s
over here what we can do is we can
actually just say import models from dot
slash models and now we have our
database models right here and we can do
stuff with it but worried about that
after we actually fill out our table so
let's start with the user so we can copy
this as a starting point and paste this
guy in so we don't have to use use
strict here we can just export default
so I export default and we're gonna
export default a function so we're gonna
do an arrow function here and here I'm
gonna say Const and this is gonna be a
user in the name of my table is called
user so this is the table name when you
do sequel eyes that define this is
actual name of your table and they'll
usually add like an S at the end of it
so if I do user this will actually name
it to users and then here we can put the
different things that we want so I want
a username and
I'm gonna say type and I actually want
to make a constraint that it's unique so
I'm gonna say true and we're gonna put a
comma here and I'm gonna put some other
fields but first here we're gonna have a
user dot associate and then here's our
function we can do stuff with and I'm
gonna go ahead and get rid of that and
then we're gonna return user so this is
what our functions going to look like or
our model is going to look like for each
table and now here I'm gonna go ahead
and copy this three times so we have a
username a email and a password so we
want the username and email to be unique
but we don't want the password to be
unique so we can just get rid of that we
don't need to make it type we can just
say the data type is a string so there
we go so now we have our user model and
there's a couple relations we have with
user so messages belong to users team
belongs to users and also members belong
to users so if we come and look at the
sequel eyes documentation there's a
couple one to M relationships we have
but we're gonna actually use those on
the other end so we're going to define
the Association from message not from
user but for n to M we actually will
have to do it from user so we're gonna
say belongs to and we actually have to
create a what's called a through model
or we basically say what we want to do
it through because we have to have a
separate join table so I'm going to say
models or we can say user dot belongs
I think it was belongs to many okay
belongs to many models dot team and then
here we put our options so we're gonna
say through and I believe you can just
do a string you can also you notice how
you actually put the model name here I
believe we can also put just a string
they have another time example it but I
believe you can just do a string of what
the name of your three table is if not
we can actually create another we
created a model here called member we
could if we wanted to we can say models
dot member but I actually don't think
you need to because we don't have any
extra fields and our member table yet if
we did we would actually want to create
another table so I'm gonna go ahead and
get rid of a member for now we might add
it later and we don't have to import it
anymore so here I'm gonna say member and
we can say what we want our foreign key
to be so I'm gonna say user ID all right
so now our users done I'm gonna copy and
paste this and go on to team so we're
gonna say team lower case team so the
team had a name let's let's make the
team names unique I think they're unique
and slack as well so here we're gonna
say team team team and actually in my
index over here I want to make these
uppercase oops I just like to reference
them that way so back to team so a name
and then that was it the only other
thing is team belongs to user so this is
the other way and it's through the
member table and here is a team ID but
also remember had one other field here
which was the owner notice how I'm not
supplying the ID sequel eyes will
actually add the ID for us so let's add
the owner field so this is a 1 to M
relationship so we're gonna be using
belongs to
so team dot belongs to and we're gonna
say models dot user and then here I'm
going to say the foreign key is called
owner
alright so now our team is good to copy
that and we'll paste it in here so here
is message so this has a couple of
relationships to 1 to M relationships so
we're gonna be doing a belongs to many
so we can do a little comment this is 1
to N or 1 to M and this this would be a
n to M relationship so copy this guy
we're gonna do two of them for message
and make sure we rename the table up
here message so both channel so this
will be oops channel ID actually I
actually don't think we do this here so
messages actually how we do because we
want to Pat we want to do the the we
want to store the user ID and the
channel ID so it belongs to channel we
add the channel ID here we add the user
ID okay
and I'm gonna put this up here because
both of these are 1 to N and instead of
names is gonna be text and of course we
don't need to make this unique so
message is looking good copy again we
will were to channel
so channel channel so this is gonna have
a name
I believe channel names need to be
unique but they don't need to be unique
they need to be unique per team so we
can't enforce them just with the unique
so what I mean by that is team names are
unique across teams right but channels
there are a lot of channels and a team
so my team might have the same channel
name as another team and that's okay
because usually all teams have a channel
named general so we won't worry about
that for now so we need a name into
public so name and public so there's
gonna be a boolean and just a channel
okay so this needs to belong to a team
and I believe that's the only
relationship we need to add for this guy
so that's just a team ID and I believe
we're all done creating our models so
let's just count the relationships and
make sure our arrows count up so we have
one here we have two here so that's
three we have and yeah four five and we
don't want to count this one twice so
that's one here so I have five
relationships I counted so one two three
four five actually we don't want to
count this twice so this is one right
here this one member is a relationship
two three four five so we did five so
we're good I believe and we can double
check this in Postgres equal to okay so
now we have all our models and
everything is filled out what we want to
do if I made new mistakes here we want
to come over here we have imported our
models and now we want to sync this with
the database so if we see our example
over here this is how they reckon
and doing it we can click on app dot J s
see how they import the import their
somewhere over here
I guess maybe they're not importing it
here
let's see where they're doing their
database so we can search the repository
I guess they're not importing it they
should be sinking somewhere I'll search
for the word sink okay here we go
is this a test this is integration test
so they should see okay models that
index their sink here we go
so they're doing models that sequel eyes
dot sync and then after they do dot then
they start their Express server so we
want to do it just like this
so when we call sync like this what that
will do is it'll actually create the
database tables assuming they don't
exist so instead of calling appleís in
here we're going to say models dots
equalised sync and then we're gonna save
dot then and then i don't think we
listen for anything or we use the X for
anything and then we just put it in
there and cool and actually we don't
actually have to use this you can leave
it empty so let's go ahead and run this
and see if we get any airs with that so
we might and clear and do NPM start and
then you should see if it works
correctly a bunch of output okay so that
we did something wrong dialect needs to
be explicitly supplied as of v4 okay so
we need to tell tell it we're using
Postgres sequel so I forgot about that
so right here and we need to specify I'm
assuming we just put the word dialect
and we put I believe let's try post
Postgres
see if that works if not we can look it
up in documentation
okay looks like that worked so can't
find users so I use the wrong name and
my index so here we have user maps to
user and ok so this is the output I was
talking about so it looks like it
created the tables we're getting a
validation error not sure what that's
about I might have messed up in one of
the models so what I can do is I can
type P sequel and I can do backslash see
to connect to my database my slack
database and I can do backslash D so
backslash B will show me all the tables
I just created and this looks pretty
good and then I can actually describe a
table so I can do channels this looks
pretty good so we have a team ID and we
notice our team ID should have a foreign
key that looks good so channel member
see what that has member looks good
users this looks good
and then messages this should relate to
both the user and the channel so you see
the user ID and the channel ID and then
we can just verify our last one which
was team owner all of this looks good
was it maybe our maybe it was our
members well it had the foreign keys
messed up no everything looks good I'm
not sure why I got this
so backslash Q gets you out I'm not sure
why I got that little air everything
looks sound I guess we'll find out later
if this was incorrect and we can go
ahead and fix it but looks like we got
everything set up so that's good one
thing I want to try and see if we get
the same problem sync here I can say
force is equal to true and what that
means is it'll actually drop all the
database tables before it starts and
redo it so let's see if there's anything
output nope so now I'm not getting any
read so maybe I just had a database
table or something in there that
conflicted I didn't think I did but
there we go everything is working nice
now I'm gonna go ahead and get rid of
force so we don't just keep dropping the
data and cool so that is it for this
video guys let me know if you have any
questions getting this set up because
getting the database up is a little bit
tricky but we now set up all our models
so we're ready to start actually storing
the data so next what we're gonna be
doing is in our resolvers over here on
our schema we're going to build out to
be able to support all these the team
message the channels and actually do
some permissions and a bunch of cool
stuff so we'll be starting that tomorrow
so thank you guys for watching and the
code is up on github and it's in the
link in the description below if you
want to check out any of this so thanks
for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>