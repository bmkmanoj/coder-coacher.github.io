<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Register, Login, and Join Monster | Coder Coacher - Coaching Coders</title><meta content="Register, Login, and Join Monster - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Register, Login, and Join Monster</b></h2><h5 class="post__date">2017-07-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UdokxkOZbTk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">it's alright so we have our two branches
up on the dam p.m. start to start server
um start here to stop the react
application wait for both those to do it
up man open visual studio code and my
front end here and I like to have my set
up or have my window here and then code
in the middle cool alright I think I had
set up maybe a little close thirty
thousand I think I set up maybe a
sign-up slash login page if we get a
route we can see got home got register
register it looks like it has some stuff
in it
state unexpected token is equal sign I
don't know why you Slynt doesn't like
that maybe because we have this is like
a static so that help it don't think it
does okay that's fine we can keep it as
is so let's hook up the register I don't
think we had that complete flu we're
gonna hook it up with graph QL now and
actually submit this to our database so
slash register so username email
password submit and I believe right now
it should just I type these guys and
then she go to console so Bob Bob calm
Bob submit and it does so now I want to
change it so it goes here's our onsubmit
here these are our things this let's eat
up fields I want to actually send those
to our graph kill server so I create a
new folder called mutations and put my
mutations in there does that make sense
I'm trying to decide right now whether I
want to like put my graph QL in the same
location as my components that were put
it somewhere else I think I'm going to
put it somewhere else
I'm gonna call putting mutations for now
I might change this later and then we'll
do index IDs and then in here we'll
import graph QL tag or gql from Apollo
actually it's react Apollo I believe
it's called and we're gonna export Const
register and then here is where we
actually put the graph kill out we want
to execute when we run the form so to
figure out what I want I'm actually just
going to go to graphical and go to the
graphical for the PI server and this let
me format what I want my graphic QL
mutation to be so register I want a user
name to be so we're gonna use variables
so have here user name
it'll be dollar sign at the front all
graph QL variables start with dollar
signs so we have string I'm gonna have
an email and the bank sign at the end
here says it's a required field so we
need to have these password just also a
string and then lastly is is admin and
this should be actually not something we
want to pass through here is I setting
the admin something only I want to be
able to do so at least for now so I'm
not gonna allow the ability register as
an admin so okay so this is we're saying
the username to the username variable
email to email variable
and password to the password variable we
can go ahead and run this and see if it
craps on us required string was not try
it okay this is good it's okay we got an
error here because we don't have any of
the variables we can go ahead and paste
these in here so now we can actually
register users using this mutation and
then we just need to pass in the
variable so in our register here instead
of exporting default I can import graph
QL from the act Apollo and then I can
import register from my mutations
mutations all right and then at the
bottom I'm actually gonna just export
default graph QL passing in my register
mutation and then the component which is
called register so this actually takes
the user mutation puts it in the
register component that way I can call
it so now I can say this dot props dot
mutate and then variables vehicle to
this top state dot fields and the way I
made it is so the names here line up
with the variables so I don't even have
to change anything I can just put it in
right here and I like to make this an
async function and what we can do is we
can say can't see user we can await it
and then we can console.log the user now
we're only expecting the if we go back
to our graph here we're only grabbing
the ID back just so we can see let's
grab the username and email as well so
okay
I'm gonna save this register looks good
now I want to go ahead and run this and
I actually don't know if her backing is
set up to handle this I don't remember
if it is or not so
we're gonna run this mutation see what
happens so run submit bad request cannot
query field email on type user alright
so this is not a fun problem this is a
back-end problem so here is baklava I'm
gonna open up visual studio code in this
folder and I'll see if we can figure out
what's going on so let's put that here
and I'm gonna close this so you'll have
to Visual Studio codes running at once
alright so there's gonna be in our
resolvers is where the problems going to
be so index and resolvers and here is
our register where is our register
okay here's register so from args we're
picking username and is admin we don't
worry about his admin and I'm actually
gonna just go to the schema real quick
and in the logon not login register
where's register here oh my remove is
admin I don't want to be able to set
that property there by default should be
false and you can't set it okay so user
we pick username for local auth we're
picking the email and password password
promise or creating the okay so what's
happening right here is I'm getting the
promise for hashing the password and
creating the user at the same time so
then we're promising both of those so
they run concurrently then we're getting
the local password and we're saving that
and the reason why you'll notice I have
basically I'm creating two objects local
off and user the reason for that is I'm
generalizing it so later I can do
Facebook off and some other OAuth stuff
okay so user ID here is gonna be created
user dot ID and guys I actually in my
models I think was I using underscores
yeah I don't want to use underscores for
these things anymore because I wanted to
directly match up with what my
JavaScript is and in my JavaScript I
never use underscores so I'm gonna
rename all these table thingies it kind
of makes Postgres sequel wonky because
you have to do quotations around stuff
but that's okay
as long as it it's better for it to
match up directly with the what's it
called JavaScript code itself okay so we
have that and then board board looks
good so I'm just checking and these are
all my database models making sure my
database models are all camel case
instead of snake case and they are
that's good is admin so it just made
changes to my database so I want to
rebuild the tables so to do that what I
can do is I can either drop the database
or there there's a cool trick that
someone just showed me ma sequel eyes
dot sync I can do force equal true and
when this my server's gonna reload and
rerun when it rewrote loads and reruns
it actually will drop the database and
remake it for me and then it's good and
I can take this off because I don't want
it to force every time just when I make
changes okay so my board I don't I
actually my resolver looks pretty good
here I want to run it one more time and
see exactly what the air is that I'm
getting we might have actually solved
air
because cannot query field email on type
user
we're not even querying the type email
here I don't think I don't I don't see
it
so either registers is not getting
called or I mean we're picking the email
here but yeah let's rerun this make sure
it we are well we'll actually get like
it the exact line that's causing there
so Bob Bob Tom Bob when submit so bad
requests still cool so this is gonna be
this is an Apollo air I'm gonna go to my
back-end here and actually undefined
back-end is not getting an error
so let's look again what's going on
uncaught Eric I cannot query field email
on type user oh oh oh I know what the
problem is I'll show you guys so my
schema here for user there is no email
but then I was looking for email so
let's add email which is a string and
now I think we should be able to get it
if we're passing the email back so Bob
at Tom icon and by the way we're
actually I believe creating the user
yeah so we're able to successfully
register Bob nice so what I want to do
next is actually create a login page so
I just made some changes so switch
models from snake case to camel case and
we'll close this so now we're going to
go back and do more
front-end things
I hate how my windows always switch oops
and then apt to go fix it again okay so
now we're gonna create a ref you can
kind of copy our register page because
it's almost the exact same for login so
now instead of a we're not gonna have a
user name field they should already know
we're going to have login we're gonna
get a login mutation we can keep the on
change this we can keep as well except
here we're gonna get passed back is a
token and a refresh token well actually
it's not it's gonna be well I'll show
you what the response looks like will
grant console it out because it's I
believe it's like response data dot the
name of whatever your invitation is to
actually get whatever it is well you'll
see in a second what I'm talking about
so get rid of user name here okay graph
QL register here it's gonna be log in
and log in so our components called log
in our mutations called log in
alright cool beans
this looks good so yeah as you can see
this is how fast you can set things up
because registers the exact same in our
mutation here we can copy the mutation
too because it's almost the exact same
it's gonna be log in log in here and ask
for token and a refresh token and
I'll have an email and a password oops
and will not have a username variable
okay that looks good for our graph QL
this will be our request we'll make one
week submit the form and now I just need
to go back to my routes and create a new
route slash login and then we'll do the
login one alright and let's see what it
doesn't like your parse error imported
unexpected token I have no idea what
this means
I'm sure what es ones complaining about
I don't know exactly this means
important domain as default doing an
export default here yeah not sure
alright let's see if it works and this
is something again I'm not sure if the
backend is set up to handle but we're
about to find out
so submit get our object back and cool
as our refresh token and your token so
this is data login so in our response
here you can say data token refresh
token
actually it's data then it's login okay
this see how there's there's so many
different levels what I'm gonna do is
I'm gonna get the date out of this and
I'm gonna say Kant's token your first
token is equal to data dot login and
then I'm gonna store this in local
storage
that way we can persist it and like keep
the user logged in for a week or longer
if they keep logging in or not they keep
logging in if they keep using the
website then I'll automatically refresh
which we actually need to set up but
we'll do that in a moment what I'm going
to look for here is my application local
storage have tokens from past projects
probably so I'm gonna refresh
and I'm gonna try doing logging back in
I'm gonna submit and make sure this does
go it's local dot set item and you need
to actually call the function okay
that's set item refresh all right so Bob
at Bob calm and well I push submit to go
through it did I don't see anything here
Network tab it went through again oh
there we go I figure out we're not
console logging anything so here it is
our tokens getting saved now cool so now
we're able to log in we're able to sign
off so I create my user I was able to
sign up with that user
this should be this should be register
so what I want to do next let's create a
page reeking crepe boards I think is
what I want to do next so go to material
UI
and see if there's some good components
we can use so I'm going to create a new
route here should we do this on the home
page
yeah let's seal it got kind of a home
page view that has stuff on it okay so
I'm gonna go over here to components and
I'm thinking something like a card view
/ maybe a group of cards I think there's
something a grid list I think it's
called yeah something like this maybe
but with cards I don't see let's see if
there's a card group I don't know if it
talked about it card actions card media
what else is there there's a list I
don't know what I want to use I wanna do
you have like basically just like a list
of cards and maybe I can in my grid list
I can specify I want cards no image
tiles now you have to use grid tiles it
looks like I mean there's got to be a
way to do a card group there's no way
there's not what else would be called
chip is something else you get just a
list they'll be maybe a card list down
here
no paper maybe paper no I mean I can
basically make my own list with cards I
suppose we don't have to use an exact
component so let's get this card set up
though I'm going to import it our cards
not going to have any type of images so
what's the name of this card example
avatar yeah I didn't like it cuz they
didn't put the end on there okay
we don't have this picture that it has
right here so I'm gonna have to get rid
of it I think it's two pictures on it
yeah I don't have that and at all of
this
so card media you get rid of and avatar
it's gonna be a no-no and let's see this
render on our application though so this
is on the home page which is the index
page okay so what I'm thinking is you
put the title text thank you this is
pretty decent and what I'm thinking is I
can have lists of these so maybe like it
div
and maybe inside this div I have a class
name
I'll go say like maybe like column 1 or
something and have like columns have
this column 1 this is column 2 I wanna I
want to style it so these are side by
side but I mean these cards I mean this
makes a decent card list I suppose I
just have divs next to each other with
like adding some margin I think you can
add margin with doing it like this
margin bottom - if that adds some I
think it does yeah it does
ok so that looks nice adds a little
space so I guess I want to have a list
and then inside the list of the board so
ok let me look at what I have in baklava
because I actually have in my models
it'll actually show them models so in
board
I have board and then I have a
suggestion so suggestions are on boards
so go back over here this is going to be
each card is going to be suggestion and
then there'll be boards with lists so I
think for now what I'll create is have
one board with a bunch of suggestions so
should I just do one of these these
buttons to create them let's see where
are they they're called fab buttons yeah
floating action buttons
I could add one of these style we don't
three about style glad the floating
action button and then we can have it
let's make sure that I want to make sure
I want them on the same div the margin
doesn't hit of course that's fine I
guess
and then while we were just gonna have
like a lot of divs they're like gonna be
stacked eventually but here we will have
floating action
what does content add oh that's an icon
yeah we'll take that icon we want to add
it to ours too and have our div here I'm
not sure how it renders the floating
action because it kind of just like is
floating I'm not sure if it'll be at the
bottom of the div or what okay now I
want to it on the right side is there a
way to say way you want the left or the
right side or I have to add my own style
looks like I'm gonna have to add my own
style which is okay and I wanna I need
to make this scrollable so I just want
to make sure this automatically Scrolls
if I have a bunch of them okay it does
but I also want this guy to be here
floating if there's more so maybe I
add to the top but then it's going to be
up here I actually don't know how to how
this thing works
because I basically want to give it an
absolute kind of absolute is used for
frequently used I guess we won't we
don't have to use this
it doesn't make as much sense on a
website because we want to have like
lists we could do it a different way
okay
so for now the only thing my suggestions
are are you know what
since our suggestions are pretty simple
we'll just switch to this to a list I
think it'll work a lot smoother and
let's do so one I like this these are
nice then we can have like okay I eyes I
just I've just thought of how this is
going to work I've thought thought it
out okay so I'm gonna grab my own mobile
tear sheet is that what this thing is
called and then we have oh I guess this
is what the so we have a divider I mean
I don't need I don't need to tear apart
let's pick one without the tear or they
all tear they're actually all using the
tear I mean that's fine I'm not for the
tear am i against the tear just kind of
there and I also want this this one
because I want to add like little
widgets in there actually this is too
complicated at first we'll copy this one
okay
so let's get all the material UI things
content ad mobile - OH
mobile tearsheet is not I thought both
will tear she was a component for
maturely UI it did not they want me to
create this little just ordered of these
guys same thing here
mobile tear sheet yep opal tear sheet I
coulda sworn I've seen this
maybe it's under it's not paper just go
one by one through these things bottom
nav no I know there exists a divider
drawer icons list menu there's gonna be
like a little piece of paper thing tabs
table header stepper I'm not trying to
light I'll be right back
it's a shame I mean it's basically this
paper thing this little crunchy crunch I
hate how material UI is get it has all
these examples but then I have to create
this stupid little mobile tear
okay their search see material UI mobile
tear
you know let's go to stack overflow they
usually are the most helpful
by all means copy for mother dog site
it's just oh it's an image images bottom
tear SVG so we would need to then get
that okay I am actually just like
annoyed at material UI right now and
kind of want to pivot cuz I don't want
to make this I'm gonna I'm gonna create
the list see what the list looks like if
the list looks ugly without this mobile
tear thing that I'm pivoting to semantic
UI because I do not want to deal with
the UI
I just want to code this up and I want
to use a framework that handles that for
me so copy the lists we only need one
list for now list item this looks all
good
okay this is not my favorite but and
then what I'm what I want so this is
what I'm imagining guys I'm just gonna
keep that by the way I'm like happy
enough with it so we want text field I
can always come back and change what the
UI of it looks like slightly and copy
some of this oh I copy that and then I
deleted some things then I lost the copy
okay copy so the name is going to be
suggestion in tech suggestion suggestion
value is gonna be we don't have to worry
about the value for now on change all
three about after now okay and we want
this to be full with two so what I
imagine is you type your suggestion here
so ABC hit enter and it pops down here
that's it so that's what I'm going to
code up right now I'm gonna create a new
component for this it's gonna be called
board dodge is so board is actually not
really a route it's more of a component
so I'm gonna create a new folder called
components and move board to components
and I'm actually just gonna copy home
paste in board because it's really hard
stuff actually I should have also found
a react so
and then what I'll do is I'll just
render a board on the home screen and
the board ityou should render you should
pass in board ID and will render bore it
with the board with 4 ID 1 and import
board from up up component slash board
okie dokie so we have board here we're
gonna pass in the Bridey so we know what
board to grab from the database and cool
this is actual UI of it we're gonna make
this a react class so class react from
this should be called board yeah so
bored from react component then we'll
have our render function returned put
that there and we'll get rid of our
semicolon that's messing stuff up can
shed one of these as well and state here
is going to be suggestion so as they're
typing it and so we'll say this let's
value is equal to this dot state
suggestion and then unchanged for this
it's gonna be say 'hey this thoughts set
state you know what actually it will
just copy and paste beyond change I
should know because they're on change
there uses field so that's fine this
will be suggestion an eat out target dot
value
cool and why are you being weird
expected semicolon
oh this extends not from okay we're also
going to import okay so here we're gonna
create a new file we're gonna create a
suggestion that's yes and then import
suggestion from suggestion okay
so I'm gonna create a suggestion
component and that's going to be
basically what our list is here and I'm
gonna render here is going to be called
get bored yeah so we'll call it get
bored so this is the graph QL call I'm
about to do
I haven't hooked any of this stuff up
but we're going to so in the props I'm
gonna get past the data which is it
going to be get bored dot data which is
gonna be an array and the board is gonna
have like a name and stuff so the data
that we want from this and maybe we
should come up here and do Kant's name
comma suggestions is equal to the stock
crops get bored alright so I'm gonna
show the name here and just as an h1 and
then our list here we're gonna say
suggestions dot map and here it's gonna
be our suggestion and we're gonna
actually render the a suggestion to
component passing in well set a key of
exid and then the actual suggestion it's
gonna be a back ok so this looks good
so as we're typing nice and then we need
to make this a form and then when they
on submit we're gonna do stuff
form so there's going to be a lot of
graph QL in this page so import
graph QL thrown react follow and then so
we're going to do a mutation whenever we
type out this and this mutation is going
to update the suggestions here which
will trigger a query and each suggestion
will be stuff to I'm going to create the
suggestion component real quick because
this is really basic and this will from
react and this will get rid of one of
our dependencies that we need to create
so export default so one of what we're
expecting from being passes a prop is
the suggestion and that's where we
actually just create a list item I
believe yep and we're gonna get that
from list and we don't get a list here
and primary text is gonna be suggestion
do we need an ID no we need a name I
believe I think it's called text so
while we just render the text as the
primary text yeah and what's going on
here suggesting the missing prop type
validation that's fine for now maybe
I'll add prop type validation later all
right so our suggestion right now is
only a list item which showing the
primary text where the text is
alright we're also gonna grab compose
here because we're gonna do a mutation
and a query so I'm gonna do query
and oops I meant to make this a folder
so there's gonna be all our graph QL
queries queries and next up is import
gql from graph y'all okay so I'm gonna
first write the mutation out and the
mutation is to create a suggestion I
actually don't know if the mutation here
if we have in the back end yet we'll see
when we type this create suggestion
creator ID text board ID
yeah that's not exactly what I want so
we're gonna have to edit some back and
stuff I think all of this needs some
back end stuff the board needs some back
and stuff because okay so there's two
queries we want to do we want a query to
grit the crap react Apollo sorry not
react Apollo we want a query to get the
suggestions for a board get the data for
a board this is going to be one graph
you'll query get board and we're gonna
do more queries when we on submit here
actually this will be a mutation on
query ok I'm gonna pop up just CEO code
for the back end and just code up the
mutation slash queries that we need to
get like get these guys set up and
actually no I I said I was gonna do this
I want to actually finish the front end
first and the reason for that is I want
to set up a library called join monster
and it'll take some work and won't take
a lot of work will take a little bit so
I want to get the front and all done
before I switch over to that
so okay queries
so we're gonna have a query here called
export Kant's get bored I don't know
exactly what the graphic UL it's gonna
look like for this yet so I'm just gonna
leave it blank
and then we'll come back and fill this
end when we actually get the Joan query
like I was talking about um the mutation
here oops okay yeah I know what the
mutation is kind of so I can kind of
write it out and then we're gonna have
to change it later in the back end so
create suggestion so this mutation just
requires some text and the board ID the
text is going to be a string or ID is
going to be an int and this is the ID of
the board that we want to add the
suggestion to and here we're going to
actually create suggestion and then text
being text and board ID or a key and
we'll just grab the ID that's fine so
this is actually not implemented in our
backend yet but we will add that soon
well we're about to do a decent amount
back and work very very soon here should
be eight oh this should be a rack react
Apollo all right so suggestions good
this is board okay so let's actually
call the autograph cool stuff so so we
have here our board we're gonna export
default compose and in our compose here
we're going to get all the graph QL that
we need and then we're gonna call it on
our component our component is called
board it's a little type board here and
then here we'll have graph QL and it one
more time
the tooth I need to do get bored and the
other one was for create bored so import
get bored from up queries and then
create suggestion from mutations okay so
these are the two graph QL things we
want to run on this component I added
them here and then I'm adding them to
our component here so we're importing
and adding it to the component get bored
is gonna just flow right in here and
actually get bored we needs to be called
with some props that we get from when we
call it so our home
you notice how we're passing a bore ID
we need to actually use that bore ID to
make our graph gel query so let me I
forget how I do this Apollo client will
look it up but here we can go ahead and
do our on submit so when this is
submitted
we're going to call this dot mutate and
actually we're going to need to create a
mutation function because we're going to
do some fancy stuff well not fancy stuff
but just some stuff so more we're gonna
do an update in it so it's going to be a
little bit more than just on submit oops
okay so on submit we're going to call
this on something all right and then in
our on submit function we're gonna call
Const response
I cannot spell today response it's equal
to a wait this dot mutate passing in
variables and I'm actually gonna rename
my well you know what that's fine an
octree any of it so text is the variable
is one variable and that's gonna be this
that's this lot state dot suggestion and
the other one is the board ID which
we're getting passed from the props and
then here I need to make this a sink
because we're using a weight alright
that's good
pop in over here I need to look up how
to do this too we need to do an update
here because we just got a new
suggestion okie dokie so what are we
looking for this is for queries that
require prompts do you talk about it he
is it here compute computing from props
options yeah we're gonna copy that do it
down here okay so the prop that we need
is the for ID and we actually just
passed that right in and that's it and
I'm so I think something else is broken
here else something would have formatted
oh there go form is now good must have a
parent yep I think it's just lagging
that's why that Esalen is not gone away
and now for mutate here we actually want
to update that so they have an
optimistic UI we're gonna do I don't
know if I want to do optimistic UI or
not I guess I might as well add it
because I'm gonna do an update anyway
makes it a little bit snappier for those
of you that don't know what optimistic
UI is and let me just make sure this is
in the right place
nope it's not in the right place you put
this in here sorry oh well optimistic u
UI does or optimistic response it's
called here is before it actually even
gets sent to the server it pretends like
the server said yes and your UI responds
and shows them and this will make more
sense when you see it it'll just
immediately pop up on the screen before
the server even like gets a chance to
like create the suggestion it just
assumes the suggestion is good so here
what I like to do is we'll need an ID
justified either negative one we don't
need created at what is this field
content
I'll have text which we can get from
this thoughts date dot suggestion type
name this is a suggestion and submit
comment this is called what's our
mutation called create suggestion all
right so one this is fired off we're
gonna pass this it's going to go to our
update function here it's going to be
create suggestion I don't need any of
these comments so okay so our query is
get bored now we're going to be updating
so we're gonna say data dot I don't even
think I have to do data I think it's
just actually no it'll be sections and
we're pushing create suggestion and
we're gonna get a small I think we're
gonna get a small error because create
suggestion here is getting married here
the name but maybe the scope here should
take effect okay that's it I'm not sure
if ever its update quite right I think
it's I think it's close to right this
optimistic UI in this update will give
us errors if you don't do it right and
that's okay
but what the optimistic response and
update do here is when I when actually
you can't see it now but if it led us
we're typing in our form when we hit
enter it I'll actually update the UI
afterwards so cool stuff there so our
update is good here we're getting the
data here I think we just need to fix
the back in now crate board is not
defined and components board I'm not
sure what creep Ord is there should be
nothing called create board create board
that should be create suggestion now
let's see we should we should still have
errors that we shouldn't have that error
okay that's what I was expecting there
to be so let's do some backend work guys
so what I'm gonna add to our project
real quick is something called join
monster so this is something that
someone recently showed me actually
someone that watches my youtube videos
it what it does is it only selects the
fields that you need from your database
so you're not selecting all of them and
it also helps when you're doing multiple
nested graph QL statements for a query
it does one join and you can see right
here they have a great example of how it
works so you see how this would this
query here it turns that query into this
statement you see how it adds enter
joins and stuff so pretty cool they're
not enter joins left join so it talks
about why I recommend them taking a look
at this page if you're interested in it
it's very informative so we're gonna be
using join monster and since we're using
Apollo join monster Apollo we have to do
with something extra because they don't
support Apollo out of the box but there
is a project that does fix it for us
there we go so I'm gonna go ahead and
add both of these join monster graph QL
tools yeah enjoy monster so coming over
here to back and doing ad join that and
then join monster to install both of
them and this will basically any queries
that we write we're gonna do through
join monster
so dudududududu we have queries here all
users me you don't care about any of
these we're gonna say get bored and
we're gonna pass in the for ID which is
an int what we pass back is a board now
the board might be null because if they
give us a bad board ID and then board
has a name owner and suggestions cool
so this give board we're gonna create
with
join monster so first we need a set of
join monster and using join monster it's
a pretty much replacement for data
loader so I'm actually gonna just go
ahead and remove data loader from this
project so by data loader and remove
data loader here so come back over here
do yarn remove data loader so we no
longer have that dependency okay so now
we need to do this graphical tools
adapter thing where you can copy this
and I'll show you guys what we're going
to do so the reason we have to do this
is we need to add basically some types
so join monster knows how to work and so
I'm gonna create a special file for this
so coming up just new file called join
monster metadata and this join monster
adapt adapt we're gonna actually import
our join monster metadata this is going
to have everything that joined monster
needs join monster metadata and do join
monster adapt passing in our schema
right here make sure you do it after
it's been executable made executable and
then we pass in our metadata and casing
does not match oh yeah
so in our metadata here we are gonna add
some stuff so we're just going to export
default an object so that's all the
metadata is just like some stuff to tell
you know how to work and this is what it
looks like so for us very basic one is
gonna be board and all I'm going to say
is the table name that board is
associated with and we're gonna copy
this query so board I can say what the
sequel table is we're gonna get the
query two as well so sequel table is
named boards and unique you also need to
supply a unique key so that is ID for us
and then query fields so I want to make
a get board query and this query is
gonna have a where clause and for this
where Clause we are gonna do this is
empty we'll have the board ID here and
yeah I actually just need the bore IV
okay so here we're gonna say table ID
the ID in this table is going to be what
we put for a sequel table which is
boards so we're going to get boards dydy
I'm gonna set equal to bore ID and then
in our resolvers here we are going to
create a get board resolver so parent
and then the args is going to be the
board ID and we can just keep the args
here and then here we're gonna have
models that's fine
this is our sequel eyes models it'll
actually run the query and this is
called info and we actually need this
info for join monster and now I'm going
to import join monster from join monster
so I'm gonna run it oops that's just
because we didn't finish typing this out
so I'm gonna run join monster here it
takes info as the first parameter second
parameter is any kind of variables you
want to pass to it for us we're going to
pass args
so the arcs we passed there will
actually go to the where clause here and
this where Clause is going to be turned
into sequel as you guys will see and the
last one is what join Monster does is it
actually doesn't execute the sequel for
you but what it does do is create the
sequel and then you can do whatever you
want with it
so then that allows us to do models dot
sequel eyes dot query and we can
actually do a raw query here and we can
move this up and I want to move you down
so this is easier to see
so sequel eyes query passing in the
sequel and the thing about sequel eyes
is it passes in a bunch of junk there's
like a bunch of metadata tags and
whatnot that they pass in when you do
query so I like to get rid of that
because I don't need it and it's just
bloat so you can do this right here here
so in case you don't need metadata which
we don't you can do this pass in to your
query so there we go and the sequel eyes
we're getting from our model okay so
let's just recap what this is doing so
our get board function and this is a
resolver this is going
to resolve this get bored here it takes
in board ID as the argument so we get
that here we're passing that to the RX
to join monster it's going to take the
information in the arcs to generate
sequel for us and then we're going to
actually run that query and pass the
results back so that's it
I think the query is good to go I am
going to come over here this is our back
end I just want to make sure there
weren't any air is there and I'm gonna
come to graphical and I'm gonna try
doing a query say get bored and I think
I have to refresh because I don't see it
here so get bored passing a bore ID of 1
and cool it's an all and I just want to
show you
Smoove this over here so we can see it
better so this is a sequel that we ran
select get board ID as ID and you'll
notice what's cool about this and we
said get board where IDs 1 if I did two
it would do it for two all right
the cool thing about this is it's not
selecting all the fields for get board
so it saves you that it's not doing a
join or anything but like if I did get
boards dot name you'll notice the Select
query now grabs the name as well now the
thing about this is the get board is if
we want to do get our sex suggestions
for this we're actually have to do a so
like sex suggestions which then has
other stuff right an ID and whatnot
we'll run that you'll notice how nothing
is added here for suggestions and the
reason for that is suggestion is
actually a many-to-many
let me let me make sure it is I think
it's a many-to-many if we come to our
models we can see so board here has many
suggestions if I go to suggestions okay
it's one too many so that's fine and the
documentation here for join monster you
have to do a join to create this so
joining objects we just need to add a
sequel drawing that looks something like
this so I'm going to come back to my
back end and our metadata here so for
boards there's something we can do
fields and we can specify if we want to
do select any of the fields differently
than the default and so for suggestions
that's something we want to handle
differently so suggestions here I would
like to do a sequel joint and so for
this sequel join what I want to do is
grab we don't need any args and the
table the user it's not user table it's
going to be board table for us and then
this is going to be suggestion table and
here we're going to say board table that
ID is going to be equal to suggestion
table dot and I believe it's gonna be
called board ID and this is the field in
our database so I'm just going to go to
P sequel Connect ooh what did I call
this database um baklava cool so baklava
select all from suggestions okay so we
have a board ID so that's perfect so
grab the bohr ID for ID here matches up
with board ID in our database for
suggestions where to make sure these
match okay so now it'll actually do a
joint
I don't think laughs I don't think it'll
actually do the join right now cuz we
don't have any oh do we break something
okay just taking a second startup I
don't think it'll actually show the join
code here that's because there's no
boards but if there were boards it would
so let's actually create a board which
I'm actually going to just do in peace
equal so I'm gonna say insert I think I
can do I think it's just like this let
me do select all from the boards and I
first need to connect to not falafel two
baklava select all from boards so when I
insert name is going to be board first
board first board I don't know if double
quotes works but we're about to find out
and the owner is going to be one and I
don't think I have to worry about adding
these fields we'll see if this breaks
and two boards I think I broke it yeah
doesn't like the double quotes I think
still no what is it not like insert into
boards values maybe I forgot my syntax
for Postgres equal guys still doesn't
like it but now what doesn't like is
that first character see how it doesn't
like that okay I don't know how to do
this I figure out what my syntax is for
that I thought be easier just insert it
that way let's just run the mutation
let's make sure the mutation works oh
it's gonna be in a resolvers create
mutation you're not creamy cheesy crepe
board
all right yeah I'll just run curry board
so I'm gonna copy this mutation create
board owner it's gonna be one name
there's gonna be first board not
authenticated I'm gonna get rid of the
requires admin that way we can actually
run it and run this guy again when it
comes back up cool so now if I do a
fetch on one load of undefined okay so
we are oh we just need to come back here
to board we don't need to do data loader
stuff anymore okay now run that guy
again get board dot suggestions does not
exist user okay we can get rid of this
and we can get rid of this the reasons
we can get rid of those is because and
okay that's there's we can get rid of
those is because we're gonna do one
query with join monster and we don't
need to like do the sub queries that
we're doing okay I just got rid of those
and it's still all I can am i doing get
bored I'm doing get bored I'm getting
the suggestions so the reason was not
working before is because we are calling
other code after get bored dot - Oh call
okay now the column get bored suggestion
is like this so we can see the sequel
that's actually running here so it's
doing get bored dots suggestions so that
means our metadata here is not working
because we told it
suggestions is supposed to do a sequel
join and it's not suggestions and I
spell suggestions write suggestions and
we have suggestions here whoa alright
let's put these right next to each other
wait they're all right next to each I
okay
oh wait I wanted to switch it over here
that's what I was there okay so the
suggestions the field should match up
boards matches up suggestions should
match up with suggestions here it does
it should be doing inner join so let's
go back to this and make sure we're
doing everything right Fields is an
object sequel join user table type it's
gonna be a comment suggestions isn't in
our schema maybe as I call something
different no suggestions which is an
array of suggestion
okay don't know what thank is going on
with joy monster Ike I just want to
restart the server and maybe some wonky
happened and now I writ it starts up
it'll just work cuz it should be reading
that the fields suggestions and be like
oh when you do a sequel join and it's
not running the joint on it right now
so no still it's still trying to do this
get board so boards it's not even
running that are where our where is
happening correctly like oops come back
over here if I were to get rid of
suggestions I think this works yeah see
how first board pops up there's just
something wrong with our or sequel join
so let's just I believe they have a demo
well let's yeah let's make sure ours
matches up exactly so they have so their
user they have fields and inside of
fields they have posts and they I do a
sequel join oh I'll tell you what's
wrong guys we just need to do suggestion
we just need to put what the sequel
table is we didn't say which table this
listen so suggestions and then the
unique key is an ID alright now I think
it's gonna work I forgot we had to do
that
okay so this is a new heir suggestion
that poor ID does not exist and the
reason for that is right here
sequel eyes does not not civilized
Postgres sequel does not like camelcase
you have to wrap it in quotation marks
letter server restart and bam we have
zero suggestions that we can look at the
sequel that it ran you'll notice to the
left join grabbed only the ID but if we
wanted loops come back over here if you
wanted to get the text of the suggestion
it would run left join suggestion dot
text whereas up here did not get arab
the test the text of suggestion so cool
our get board is all set up is our
create suggestions set up think it is so
we can copy this and we need to do query
we can do a board ID dollar sign is
going to be a int so now we can go back
to our front-end and do some front
didn't work so now our back-end is all
set up i believe we're grabbing the ID
the name the suggestions I think that's
all we need
so yeah come back over here this is the
front-end stuff we can actually fill in
I think if I just paste in this to get
bored I think we're good to go I think
everything if we did everything
correctly we should see something render
okay we did something wrong I can't read
name of undefined
this stuff props
don't get bored the reason for that is
we need to do data dot that's just what
the convention of a graph QL calls it
now let's take a look at this refresh
all right still undefined so what I'm
gonna do just do a console of a log of
this dot props just to confirm what we
have in there because I that's what I
expected called
that it could be something else I guess
okay so Bor ID so props is an object
okay so I've actually never seen this
before
we have mutate here we have data our
bore ID is here this is weird okay so we
should expect the ID the name
oh the Bridey is just what our query was
that's good data oh it's still loading
and when it's loading it crashes okay so
we just need to have a default value it
looks like so index get bored all right
so I'm gonna keep that I'm going to say
name is equal to an empty string and
suggestion is equal to an empty array
just so I can make sure everything else
is in order and I'm gonna comment out
this does work I'm gonna go ahead and
give make these defaults
all right so that rendered all right so
get board is now here but here it is not
right yeah okay so I'm gonna say I can
do a check if it's loading the stop
props dot data dot loading right I think
it was this I props out data and then
loading so if loading is true console
that log we can return null we could add
a spinner we'll do that later I'll just
say loading and then when we get data
we'll go ahead and grab it here so now
we'll refresh so it's loading pops up
here we see the name of our board first
board
I'm gonna write a suggestion suggestion
one I hit enter it runs our mutation
this dot mutate is not a function and we
air out okay should be the stop crops
okay rerun that Larry fresh and also in
our on submit we need to pass in the ER
X so you can say you got prevent default
and what that does is it just stops the
the page will reload if you don't do
that just because that's how forms are
supposed to work in HTML okay
loading pops off first suggestion hit
enter all right I've never seen this air
before in my life
failed to execute post message on window
update could not be cloned field execute
okay so we have something wonky
happening in our update and that could
just because of this we're gonna do some
console logs so data create suggestion
I'm just gonna call so data dot so I'm
gonna call this a new data and we'll say
data is equal to new data and I'm gonna
console that log new data to make sure
it is what I think it is and there is oh
this should be suggestions why did I say
sections and I also want to call it so
log data now rerun this s1 okay same
same error I wonder if the mutation is
even being called I'm not sure if it is
so I'm going to comment this out I mean
it a sinky yeah it is mutation that's
messing stuff up okay
so constant response for waiting this
mutate console dot log update it could
be the optimistic response create
suggestion I don't see anything here
that would mess stuff up
all right we have loading oh I think I
know what the error could be because
we're returning null here possibly and
then that's just breaking everything
when this goes to loading so what I will
do is I'll set the name to this well
I'll say if this table drops I'd data
dot loading I don't I didn't need to
retype that statement I don't know why
just that we'll say let name is equal to
this let suggestions equal to an empty
array and then if we're not loading will
actually set it will say Kant's get
bored equal this dot props dot data and
we'll say name is equal to get bored dot
name and suggestions is equal to get
bored dot suggestions okay so now we
shouldn't crash when it's loading but we
should also not be returning null and
then just like getting rid of the form
okay what I want to try is to make sure
our mutation is not the problem
so Oh guys I have this inside of
variables there we go that's your
problem
oh that was just a silly mistake that
should be it should be outside so s1 hit
enter this is much better so we're
actually gained update now can't find
field to get bored on object route query
oh we need to pass in variables for this
read query so how we gonna do that
read query so I'm thinking Apollo client
read query may be this function you can
pass variables into it and if so we can
actually pass and because okay if you
don't know if you guys saw what air was
so the air was can't find field get
bored and we need we need to pass and
get bored with the ID that we want so
what I say was eath query yep variables
cool so variables board ID is equal to
this the props dot for ID so let's try
this again see how far we get
do s - all right so we get here pushes
undefined so suggestions may not exist
so get bored so it's going to be new
data dot get bored dot suggestions was
how that worked and then yeah that might
work a little bit better us three last
thing that broke graphical field create
suggestion argument creator ID of type
int is required but not provided oh I
forgot to fix that in the backend so in
our schema here we should not when we do
create board
sorry create suggestion we should not
have to pass in the creator ID or ID we
should just know what that is based on
auth tokens which we're passing in
hopefully so that'll be our resolvers
create suggestion so there'll be a user
here we can grab so it's thought that
args and then creator ID is equal to
user ID so just expanding the args that
were passed to us and then adding an
another one the ID which we're getting
from the user here right now we're going
to rerun this s1 cannot read properly ID
of undefined okay so we're not properly
passing oh that would be our fault or
the front ends fault
the
we're not passing in authentication
tokens so optimistic UI there's going to
be a ossification section and yes we
want to do this
so in this network interface that we
have we want to apply some middleware
and we hear these comments and we're
gonna say headers dot I like to call it
X token X usually is for means custom
and this is our custom header so I do it
like that and then refresh token so pass
both those in which we're getting from
local storage which we have because we
logged in and anything else
reformat everything local storage is not
defined that's fine this is global let's
fix that our es line real quick
Global's we can say local storage all
right let's run that again so that's one
and still same thing ID isn't all so
let's come into our back-end now make
sure we're actually properly reading
these in so this is our add user so I'm
looking for X token I'm verifying I
should be adding a user so let's see
what is getting run here select ID
username is admin created at from users
as users cannot read property ID of null
Oh
touken has an OLE in it I think so I'm
just gonna decode our tokens and make
sure they actually have an ID in it cuz
notice what this is it's trying to fetch
null which it should not be doing so
something went wrong pass our token in
here yep look our user does not have an
ID okay so let's fix that so when we
login we want to pass that in so off
here so try login so find one yep
create tokens or passing in our user
here if it's valid
we're ID is equal to local auth dot user
ID area that should be user ID like that
now since we fixed it to be camelcase
and then in our tokens here you're
passing is admin and all that jazz okay
I think we're good now to test this out
I'm gonna log back in oh good
hopefully when I decode the token now
it'll actually have stuff in it so Bob
at bob submit copy and our user is still
blank and let's see if the user is blank
for this one too
and it is
so this is is that this is try login
okay so we're trying to find the local
auth where the email is given to us if
not that's fine
I'm gonna do console that log look law
to see what we're getting back then we
find a user on a console that log the
user and console dot log off stuff so
these should be getting called and then
create tokens here just grabs the ID
from the user and stuff so that should
be pretty basic so over on that went off
okay okay so off stuff so getting the ID
we have an email okay so awesome the
first thing we're printing is local off
email and okay I know what the problem
is and our resolvers and our register
user ID is no longer camel case our
snake case so now I need to read this
this user has actually been corrupted so
we can't use Bob anymore I'm gonna have
to register as a new user should
probably delete yeah I'm gonna refresh
I'm gonna drop the database real quick
so force equal true let's save let it
reload so we just drop the database get
rid of that and now I can recreate a
user so I've got a register I'm gonna
recreate my bob user Bob Bob at Bob calm
Bob submit
good again Bob I'm calm Bob submit
nothing scene console but if I were to
take this token and decode it here we
should see user stuff and we do with an
ID so all right we're in action now if I
come back here and I create a suggestion
we'll see if it pops up Oh we dropped
the database so yeah we need to recreate
our first board create board owners one
name is first board so now we can reload
and it should not crash and now s1 new
air name of cannot repay name get board
so it's undefined
all right that's interesting so at our
server code here's our front-end code so
our board here this stuff you'll notice
console is actually not even being these
are not getting console.log don't think
actually JK they are but they are
working too so I'm gonna get rid of them
then if that's all good and here I'm
gonna say console dot log this stop
props dot data not sure why get board is
undefined if it's not loading it should
be there Oh unless we're getting an
error could be getting an error
we're about time out though Oh guys
check out s10
s2 hey we see s2 here but yeah that's
variables
for whatever reason get bored is just
not here that's weird
loading is false refetch everything
looks fine query get bored I'm gonna say
maybe I need to pass in variables to
write query I probably do board ID is
equal to this top prop stop board ID
okay because it getting created
correctly it's just after that it just
like craps out so that's three hit enter
same thing I don't understand why that
disappears get boards just gone it's
there and it's gone cuz look we're
printing it here get board is there
there's array of three suggestions oh
this is why missing filled text so we're
just breaking it this is fine we should
just read our warnings more so to fix
this we need to go to our query here
good mutation we actually need to grab
the text when we're mutating all right
so s4 aha everything uh I was getting so
excited cuz I thought it worked and I
just did it I fixed the mutation so it
returns text now missing field text and
ID text but I just want to make a point
about optimistic UI watch as I am typing
this so you guys see how there's an
error but you'll notice how when I type
it instantly pops up there
that's because of optimistic UI okay
looks like the server was just slow to
refresh because now there's no errors
now we're working good alright so now I
can add all the suggestions that I want
cool so I want to also clear when we
type that type our suggestion so that's
going to be in our board here but the
optimistic UI just makes it look like
pop up really fast eat up print so we're
gonna wait actually you know I'm gonna
instantly we can instantly clear this
this thought so let's get the value of
text first text is equal to this thought
state now I can say this thought set
state text is equal to emptiness and
then here you can just use text and here
is text and constant response oh is it
because we're not using this or is it
okay and we actually don't need a
response here you can just a wait it now
put us 8 plus 8 we broke it text text
text is equal to this this state oh this
is gonna be suggestion
so text is equal to suggestion text a
little stretch / God I named it
suggestion not text okay so I say it so
that pops up here this did not change
though so this thought set state text oh
that should be suggestion so now
hopefully when I type this and type in
add a new one
it'll reef it'll go blank in nice so s
10 so I can just add as many suggestions
as I want and they pop up cool that took
a while
well we got that that's sweet most of
the time was me just federal honoring
around
with getting trying to pick what card
view I wanted to do or whatever but cool
I think this is a good stopping point
right here getting the board set up so I
will put this code on github here I'll
push it up and I don't know what I want
to do next with this we're definitely
gonna have to do some CSS of some sort
to make boards so you can have boards
you know multiple boards on a single
page not just one so maybe we'll work on
that we need to be able to create boards
too right now we're just creating
suggestions so that needs to be done
maybe I need to do a voting function for
these two there's lots of stuff to do
good more graph fuel will happen next
video but that's it for this video guys
thanks for watching I'll see you guys
next week</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>