<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Autocomplete in React using Downshift and GraphQL | Coder Coacher - Coaching Coders</title><meta content="Autocomplete in React using Downshift and GraphQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Autocomplete in React using Downshift and GraphQL</b></h2><h5 class="post__date">2017-09-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lh_6HmkCoZ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys someone pointed out this tweet
to me by Wes where he made a
auto-completion form as you can see her
here or input field he's typing and then
you can click on Ohio man autocompletes
using downshift with his which is a new
library by paypal to do auto completions
like this any hughes graph QL which I
thought was really cool now he didn't
leave any code on how he did it so I
thought I would show you guys how I
would go about building something like
this so the library that he's using is
called downshift and this is relatively
new I think it just came out or got its
first version I'm not sure but here it
is and here's what the code looks like
for just a little whole world for the
auto completion so it's just one
component and then you have basically a
function you put inside of it and it
returns two items so here's what apples
orange carrot would look like with this
so basically what I did is I took this
example here and I added graph QL into
it and I did it in two different ways so
I'll show you the two different ways I
did it and the advantages of both so
here we go here's the little input form
right here so let's clear that off so
here is what it looks like so I have
just some random names for books here
I'm storing all these in a Postgres
database and I can come over here and
click which one I want gambling or I can
type and it will filter for me right
or I can say wolf I can do it click and
it'll autocomplete and you see it in the
console log down here so pretty cool
let's see how this is happening so here
is the code right here you'll notice it
looks super similar to what he has I
find it helps to start from the bottom
so let's start there so here we have a
search component and you can see this is
the basic autocomplete that is something
that is straight from the example of
downshift but you'll notice what I'm
doing is I'm doing this all books query
and I'm feeding it into search so this
query is getting run when this component
is mounted and then it's just passing
all the books that it gets from the
query into the basic autocomplete and
it's Auto completing those books right
now I'm Auto completing on ten books and
you'll notice all the filtering and
stuff is happening in memory and
JavaScript on the client side so I fetch
all the books or I'm fetching the books
ten books that I want to do for the
drop-down that's what this is doing it
feeds it in to the basic autocomplete so
and then of course on change we're just
console logging so let's take a look at
this down shift so we have this get
input props get item props these are
both things that we just put into the
input and the basically our little menu
window we just spread the props you'll
notice how we're spreading them here and
we're spreading them there and you'll
notice how we are adding the the item
itself the name of it and you'll notice
how we're doing the place holder here or
passing those as parameters to these so
these are functions so we're calling
these functions which return objects and
then we're spreading them so the props
get passed to the input and the reason
for that is this function right here is
gonna return what down shift needs to
control the input or not control and put
the passed props to it so this is doing
is passing props from down shift to this
input and this div below it is open this
is basically just a function that's
gonna say whether the little menu is
open and the input value is when they
type so input value here would be the
letter A is the input value now then
input value is a B and there's nothing
there and then of course it passes the
selected items so you can do this little
highlight thing that we're that they
have going on here robots so you tells
you which one you're hovered over is
highlighted and also tell you when it's
selected
so you can come here and bam okay so
notice we're just putting the input
props on the input here and then here
this div we're doing items dot filter
and then we're mapping these items which
is pretty nifty and basically all we're
doing is we're taking our initial items
which is ten items because I'm putting a
limit of ten here on my query and we're
filtering so we're saying if it's a null
item throw it out or if the item is
included so that's what this is doing
it's making sure it's a lower case so
it's checking the title of the book
check and then making them both lower
case and checking its input value and
seeing if it's included what I'm typing
is it included in the title and if it is
it keeps them if not filters amount and
then I'm mapping so each book that
basically meets the criteria so we're
basically doing a linear search these
items and seeing which one fits the
criteria based on making them both
lowercase and then we're mapping this on
to a div and as you can see this is
pretty basic the div has a key so it's
unique because we're mapping and we're
just putting a style on it this is
straight from downshift
the default style that he has an example
and then we're just putting the title
here so that's kind of how this is
working now I want to go over a few
things this is a cute little example
with 10 items what if I had a couple
more items so I actually in pie example
or my database I have a thousand plus so
we'll start with a hundred so we have a
lot more and you'll notice how we have
this giant list now which is kind of
annoying but you'll notice it's still
pretty buttery smooth like you're able
to search it pretty fast there's not any
noticeable lag and it still works just
fine but the most annoying part is look
out stretch down and you get this
monstrous list one thing that you could
do too
just kind of get rid of that is once you
filter you find all the items that meet
your criteria slice it so only show the
first ten results or something there
that's we're doing we're only show the
first ten results that way you don't
have this monstrous list so research
still searching all the items here or at
least the hundred that we're pulling but
we're only displaying ten what's helps
with just the load it should well it's
not really lagging right now but it
helps with the performance and also
doesn't do this giant list but let's
let's get rid of the slice and let's go
to a thousand what you'll notice is when
we're loading all the thousand in here
and then sorting them in memory it gets
pretty slow so you'll notice it just
lagged for a second there when I deleted
that the D because it's searching the
whole thing um you'll notice this goes
quite a bit down now which is giant but
the biggest problem is really good
rendering I mean the initial data load
is also pretty big but the slicing
really helps out so if we do that ten
and we only show ten now we're doing a
lot of refresh as you can see this is a
nice buttery smooth even though we have
a thousand items so that's pretty nice
so even with a bunch of items we have
loaded in memory we get pretty fast
search results so that's pretty nice the
condo of course is this does not scale
like sure we're doing a thousand maybe
increase this the ten thousand we're not
going to be able to just search through
this and it have a smooth animation so I
want to show you an alternative that you
can do where you actually do the search
on the server so this is search number
two
and I'll show you that so the way this
works is every time you type what it's
doing is it actually goes to the server
fetches all the search results so a and
again I'm not slicing this so you get
all the results here but it's doing the
search on the server so every time I
type a letter is searching the the
server instead of loading all of them in
memory and JavaScript and then searching
them all we're doing is sending this
request to the server saying they
searched a de tell us what the results
should be so to do this we have a search
books query where I pass it in the title
and it gives back the ID in title so
each time I type a letter I'm actually
making graph QL requests I just made her
graph yo request here's another one and
another one and so on
it looks like I have duplicates that's
not good ideally you don't but like when
I was making my data I guess I
accidentally added some but as you can
see as I'm typing each one is a request
and so how did I get that to happen so I
have this item items component which is
the search results right here and this
query right here I'm feeding into this
component so as you can see it's graph
QL I'm doing search books query and I'm
passing I'm getting the title from the
props so when I create this items
component I need to pass in what I want
the title to be I'll go ahead and fetch
here and then what it's doing is it's
just mapping over the results in a
similar manner that this guy over here
was doing so instead of the filtering
here
we're doing the filtering on the server
and I'll show you that in a minute
we're getting the results and then we're
just mapping so we're just mapping the
results there's no filtering that needs
to be done because the server is doing
that for us and so we're showing the
title and of course if we're loading
I'll just show no no which will show
nothing
so let's look at the basic autocomplete
now you'll notice it's exact same except
we're just doing fetch items here and we
notice we're passing in the input value
so we know which title to search and
we're just passing in some props that it
needs from downshift that way it can
communicate okay you can see I'm passing
in these three props and then at the
bottom here you'll notice nothing really
has changed on change again so when you
select an item you would still see it
here so beekeeping and bam okay so as
you can see though we're still getting a
bunch of items it's not too slow right
even with all these items even like that
we're not slicing at all but you can
make this even faster doing the same
technique we did over there just slicing
the results that we don't render so much
and maybe you don't do ten maybe you'll
show the first five maybe you search do
the search 20 but don't render a hundred
search results that's not gonna help
anyone so as you can see as I'm typing
pretty fast results so that's pretty
nice but I don't see so every time the
input value changes we're passing that
to fetch items that is another graph QL
query because when the props change so
go ahead and cut recall this query for
us so if we just open up the network tab
this could be interesting let's refresh
we can see how many queries were running
so we've done four and I'm just gonna
say wow wow you notice we're up to eight
now so we actually just did what one
extra one two but three letters
and as I'm so so that's that was pretty
cool did you guys see that um as I was
typing this right you'll notice how I've
already searched awhile so there's no
more requests
Apollo actually cashes the request which
is really nice so you notice requests no
longer in Greece because we've already
typed while before so look how instant
the results are but you saw how I
accidentally typed a letter O and the
requests jump and then if I type
something else like dog you know the
request jump up the see me requests were
making when we type that now let's look
at the server how this is handling this
so here we go I have two queries I'm
using this search books and this all
books so search books we're getting a
title passes back an array and then all
books is a key and a limit this is for
pagination you don't have to worry about
the key for now but basically I'm just
limiting how many books they go back so
we don't overload sonar resolvers here
search books is pretty self-explanatory
as I said the data store in Postgres so
on what I'm doing is I like with the
title which means find all the titles
where it fits this pattern and putting
the % here it means match any characters
before and after so basically it's like
it includes or a star character in UNIX
so any letters before or after as long
as it includes the titles okay so I'm
finding all that match that whenever I
do a search and then all books I'm using
join monster to do this and then if we
just go over to the metadata we can see
with the book here we go we're just
limiting it and then we're doing aware
by the ID if you pass an ID but we don't
go into that that's has to do with
pagination but the all books we're just
doing a regular query for whereas in
search books we're doing a find and do
an I like on the server so this I like
on the server side is something
as opposed to loading it all in memory
and JavaScript and then filtering it but
as you can saw search wasn't too bad
like this was not very slow this was
pretty fast even though we loaded them
all like it might take a second to do
that initial load like we just loaded
all the books in but once we load all
the books this is pretty fast to type
like there's not a lot lag because we're
slicing but once you get you know scale
up to higher numbers you're gonna need
to run like for example Google it can't
pull all the results back they have to
do the search on the server so what
they'll do is something like this where
they make a request every time you type
now Postgres might not be the best for
doing searching through a database you
could replace this with elasticsearch or
something else as well
this just gives you an idea how to do a
graph QL query every time they type
using downshift which is pretty cool so
these are the two different ways you can
go about doing this little
auto-completion there could be more I'm
excited to see how West doesn't compare
it against mind when he releases the
code for it or maybe he has released the
code if you guys know that'd be awesome
I'd like to see how he does it too my
code is gonna be up on github a hop a
link in the description below thank you
guys oh actually before I end real quick
I'll show you the data here's the books
all the books I added I have like this
giant JSON list and then all I'm doing
is I'm seeding the database with a
sequel eyes and I'm just doing a bulk
insert of all these books I'm mapping
over them all adding I created at so if
you're wondering how I got a thousand
books this is how I found I just Google
a list of books and like pasted them
here and then formatted them so that's
it for this video guys thanks for
watching and check out the code
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>