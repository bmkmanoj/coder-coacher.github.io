<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Typeorm Migrations | Coder Coacher - Coaching Coders</title><meta content="Typeorm Migrations - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Typeorm Migrations</b></h2><h5 class="post__date">2018-04-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JfIvPDPUFo4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I want to go over how
migrations work in type warm because
they're pretty sweet so what are
migrations in the first place well here
is an entity I have right here called
user and let's say I have my first name
here and I want to change that to
something like username right and then
save it I could just use one of type
forms features if we look in orang
config there's this thing called
synchronize and so what that'll do is it
will update your database to make sure
it matches this entity because before it
had a first name field right and now
that first name field is gone and now
there's a username field so it needs to
update the database and type warm we'll
handle this for you and that's fine but
in production it's usually not good to
have type warm automatically do it
because if they do anything wrong you
just lose data and that can be really
detrimental so what you want to do is
something called migrations so the way
you can do these in type warm is the CLI
helps you a lot so in my arm config
you'll notice I have these
configurations are important so we're
pointing to our entities folder in our
migrations folder so I have just like an
empty folder here called migrations I
guess I think it created it for me or
maybe I created it but it'll also get
auto-generated so if you just type MPX
type arm you can see all the different
options that are available to you and by
the way I am running this right now on
my boiler pulley on a branch seven if
you want to follow along but also this
works for any type arm project so what I
can do is these four commands right here
the ones I use the most so first off if
you want to just create your own
migrations what you'll do is you could
just do MPX type work
and let's clear this MPX type arm
migrations and then not generate but
create and then this - and at the end
you then specify the name and so after
that what's gonna happen is it's gonna
create a file in your migrations folder
with the timestamp and the - and the
name and basically you now have this
bare-bones
class right here where you can do stuff
so they give you this in called query
Runner and you can do query on their dot
query and then here you have to write
raw sequel so right now I don't think
they have anything to help you out with
this I think that's something they're
wanting to add in the future but for
example I would just say alter you know
users table rename that one field to the
other field so I would just type this in
sequel myself and then I would await it
like that and then you can also do the
reverse of how you would put the table
back if you wanted to and then after you
do this how would you actually run this
migration well there's a couple ways the
one I like to do is I'm usually using
this in conjunction with a server so for
example here is my graph QL or yoga
graphical yoga server and you'll notice
I am creating a connection and this is a
type warm connection and then I'm
starting my server and what I can do is
right before I can grab my connection
here and I can just say connection run
migrations and I can await this and I
just need to make this asynchronous now
so what's gonna happen is it's gonna run
my migrations every time before the
server starts and now don't worry this
only runs the migrations it hasn't
already run so that's one option of
doing it the other option is if you
noticed in the
right here you can actually just run
this with migrations run and that works
just fine from the command line but I
want to show you one of my favorite
things about this so you guys saw that
we just renamed this field to username
so type arm actually knows about this
so you notice how one of them was called
migrations generate write what it'll do
is that actually compare your database
with what your entities are and it'll
write the migrations for you and just by
default for whatever reason you can't
just run it like this you actually need
to run this with TS node so I had tried
doing it like this because the other
commands work so if that happens to you
you just have to run TS note in front of
this and you have to get type ormd from
node modules so node modules dot been
and then that's currently where my oops
there we go and then i want to do
migrations generate test too so I just
had to put TS note in front and then run
it on the executable type worm and then
that will work for me
and oh it just didn't like that I I
didn't do anything with these so I'm
just going to remove this file real
quick
okay so it added this new migration over
here now you can see it's basically
prefilled with some data so it looks
like there's something wrong with the
vote or at least it didn't sync up with
our table but this is basically all the
changes they would make to sync your
database so you can now go in and
manually look at them how they work and
then get rid of the ones you don't
really care about or you know just the
ones you want to happen so for example I
might come over here I'm like I don't
really care about the vote I didn't
change anything with vote I want to see
anything happen I just care about my
user so we'll notice there's two
commands so it says it wants to drop the
first name and then add the username so
a lot of times you may only want to do
additions and not kill any tables that's
a common use case so I could just come
in here and just like I don't want to do
any kind of dropping I'm only gonna add
back so to go down I'm just going to do
something like that
right to drop the username but when
adding this I'm not gonna get rid of the
first name column but again you can do
whatever you want right but it just
gives you the option so a lot of times
this is what I end up doing and then
I'll just come in and tweak the sequel
that they auto generate so that's pretty
nice so just to wrap up you can either
create the migrations yourself with just
the create function or you can do
generate which will Auto compare for you
and then it'll be put into the
migrations folder or whatever you
specify and the CLI and your arm config
and then to run it you can either run it
over here when your application server
starts or from the command line using
migrations run so if you wanted to we
could just run that fix we just did so
type worm
and I just want to do migrations run and
now it should update okay it looks like
I need to just go ahead and run this
with TS note as well or maybe there is a
type error okay so it looks like and
this is what it looks like if you get an
error so the username contains no values
and I didn't make it knowable so if we
come over here we can fix that and we
can just say knowable is true and then
you'll notice like nothing's changing
here so I can either change this equal
or I could delete this and now it's
gonna remake that migration file and
it'll have nullable in there so and come
with this again I don't really care
about voting and I don't want to drop my
first name and I can just leave the down
if I don't plan on changing it or I
could change this however I like if
you're not familiar with how down works
this is for reverting back after you do
any type of migrations if you wanted to
okay so now we have this and it's not
specifying it has to be null or not all
I mean so we should be at least fix that
error and there we go so now we can see
one migration was run and fully executed
if we run this again type arm knows that
there's no migrations that need to run
and it doesn't have to do it again so it
actually keeps track of them for you so
that's it for this video guys I hope
that helped you and you can see kind of
the power of migrations and type worm I
really like how it Auto generates these
changes it just makes updating and
making the migrations faster so I hope
this was helpful and I'll see in the
next one
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>