<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Handling Errors in GraphQL and React | Coder Coacher - Coaching Coders</title><meta content="Handling Errors in GraphQL and React - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Handling Errors in GraphQL and React</b></h2><h5 class="post__date">2017-10-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fUq1iHiDniY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I want to show you how to
handle errors and graph QL so here's a
little example of what it might look
like so here I have a register form and
I've typed a username that is too long I
specified I want to use the name between
5 and I believe 10 characters long so
when I click register I get a little
pop-up that says username needs to be
between 5 and 10 characters long so we
got the little pop-up validation to tell
the user hey they type something wrong
so I'm gonna go through how I got this
set up and how it works so here's the
back end what it looks like so the first
thing is I have the username here I'm
doing validation saying I want the
length between 5 and 10 and you'll
notice what I'm doing here is I'm
specifying a message and that's the same
message you saw over there so username
needs to be 5 to 10 characters long I
can change the string to whatever I like
so whenever this you know it's not
between this length it's invalid this
message will be sent back to the client
and then they can display that to the
user and now I can do this for multiple
things so you notice how the length here
I'm so saying the args args says how
many how long you want it right so you
can do check other things as well any
type of validation you can always
specify a message
so sequel eyes lets you do that which is
really handy also notice it's unique so
I'll show you when we create a username
that array exists we get a unique air
and then in a resolver over here this is
what it looks like us handling those
errors as they come back to us so here's
what the register looks like before I
show you the error explain how the
resolver itself works I want to show you
the schema because I changed how this
worked so here's how the registration
work so it takes a female here right
here an email a username a password and
is admin and it returns instead of a
user register response so what is
register response so this is a new thing
that I picked up from the creator of
react QL I saw him doing this and I
really
SOI I'm using it as well or you carried
this response type and what it does is
you specify whether it went okay there's
any validation errors and you pass back
the user
so notice airs I'm passing back an array
of errors and both of these can be null
so either we're passing back airs
or passing back the user otherwise the
other one is null so error there's two
things the path and the message the path
says which field is wrong for example is
the username wrong is the password wrong
and the reason to do it like that is it
and I also like to match this up with my
front-end so it's easy to use the same
name so I say which field is wrong and
why it's wrong so here the path would be
username and the message would be
username needs to be two characters long
that's what we're gonna return as one of
the errors but it's possible there's
multiple errors and then Internet is all
over here here's how it's working so
first of course trying to hash the
password then we try to create a user we
take the arguments that are passed in
the hash password and then if everything
goes good you know everything validated
we return in okay and we return the user
as normal but if we in err a couple
things could have happened unique could
have gone wrong the validation could
have gone wrong we don't know so we have
to catch this error and then we need to
format the air figure out what air it is
and format the way we like it
so I create a function called for my
errors which I'll show you guys how that
works to handle that and I'm just
passing the air itself and then the
models this is the sequal eyes model so
I can check whether what type of air it
is and then I'm saying it was not okay
so let's take a look at this function
called format errors so it's up here and
you'll notice the first thing I do is I
check is the error a validation error
that means one of these things if it's
in this validate block one of those
otherwise it's unique or some other
constraint foreign key constraint went
wrong we don't know right we don't know
that particularly what what went wrong
if it's not a validation error right
because here we know it wasn't unique
but what we could do is we could
actually read the e and see what type of
air it is but for now we say something's
not something went wrong if we're just
passing back that air an array and then
just brackets path name message
something went wrong this is just
generic otherwise we're taking the map
of arrays we get back so we get a list
of arrays or a list of errors back
usually if it's a validation air and
we're gonna map through them and we're
just gonna there's a lot of extra seek
wise stuff so all we're gonna do is we
only care about the path and the message
so if you not used lodash before the
pick method what that does is if you
have an object a b and c and we just got
set up these all to one does it matter
sit down with it - if I do pick on this
object so I come over here got pick and
then I do a and B alright what's gonna
happen is that object is gonna be a B so
it just picks those properties so C will
get will go away so the only thing we
need to return back to the client is the
path in the message so I'm only picking
those two properties and returning it
and that's all that's happening on the
back end so basically it's just a
try-catch and I'm passing back in air
bringing it back here yeah passing back
those airs to the user so we can see
this is the data object that we're given
so it's false in the airs we see the
path the username as well as wrong and
the user name needs to be between 5 and
10 characters long so let's go ahead and
satisfy that this is seems good go ahead
and register we can see if we get it
right so ok is true now I'll show you if
it's
I'll see what happens if I I just
created this right it says okay it's
true we get a user ID so everything
seemed to work let's try and register
again user name must be unique cool so
we get that unique air the validation is
off this error message is coming from
Postgres or sequel eyes I'm not sure
quite who's making it because you'll
notice here it's not in our validate
it's just getting passed to us it's just
it is a validation err but it's not one
of these problems right it's not one of
our validates just something else so I'm
not sure we don't know what we don't
know if it's not a validation error we
don't know what it is but unique luckily
is a validation error so we are able to
handle that but I don't know how to
customize the message with unique that's
the one thing so you would have to maybe
search in your message look to see if
this is the message or the air type you
may be able to do it that way but I
haven't looked into too much how to do
that for the most part this is a decent
message the show username must be unique
or something that's not great show to
the user so we probably want to change
it but this works nicely so I'm gonna
show you now what it looks like on the
client so this is how I'm handling in
the client so you notice I was doing
that little pop-up thingy there's other
ways to show areas on the client than
just to pop up like sometimes you want
this to turn red or a message to come
underneath so I'll show you how that's
happening so when I click on that
register button and actually let's show
you the graph QL it's getting fired this
is the graph QL it's getting run we're
registering username password and then
we're asking for the okay we want the
errors back we want the path and message
there's and should the user ID okay so
here's the on submit we're passing in
just that our state for the variables
and they're awaiting the response when
we get the response will console.log it
so we can see what it is and then I'm
grabbing the register value so as we see
this is what the register value looks
like it has air is okay and use
so the first thing I checked check is if
it's okay
the we've successfully register you use
there we go into this block here you
should redirect or something whatever
you want to do otherwise we handle airs
so we don't actually need this a bit
here where I'm setting the state I have
that there in case you want to actually
update the client itself or the UI right
here I'm calling message air and just
passing the first air so there it's
possible you get multiple airs so
there's other ways to do this so you
could you know loop through the array of
errors and then call message the air
this is coming from ant design this
message so not every UI library has a
little pop-up that you can just call
like this to show a you know pop up that
shows up a lot of times you want need to
store the airs in the state so that's
what I have here so you could just do a
pop-ups like this that's one way or the
other way we can comment out that pop-up
is here what I'm doing is I'm taking the
airs so we have a list of errors right
path and message
that's the shape of our basically our
list I want to make that into an object
where the path is the key and message is
the value so the path being username so
like username should be the key and the
value should be needs to be between five
and ten or whatever right that way it's
easy for our render function down here
what we'll do is we can do this thoughts
State Ayers username so we check if
there's any air username airs and we
display it here right you could do a
ternary if you need to if you want to
say username era right if you want to
display something else and do no but
what I can do is I can actually just do
this because it'll display the air for
me underneath this input and then I'm
doing a reduced function here let's
explain what's going on there so I'm
going through each air and I'm basically
just converting and flattening it into
this so we're starting with this so if
you don't know how to reduce works it
takes this is my first value so that's
what PV is gonna equal so this iterates
through the list first PV is gonna be
equal to this and CV this is previous
value this is current value current
value is gonna be equal to the first
thing in the list so PV is going to be
equal to that cv is going to be equal to
an object that's path message so then
we're gonna be setting PV which is an
object we're getting the path which
would be like the username we're setting
that is the key and the message as the
value and then we're looping through and
continuing to do that so after that we
return it and PV is equal to this value
and it keeps going creates that object
for us so let's see this in action how
we have the errors popping right here so
I'm just gonna hit register and we can
see it pops up here I was trying to make
a form with a zero you link the username
and it tells us username you
between five and ten characters long so
we can set the state show the errors
keep it a little object of it and have
that display in our UI here or you could
do a pop-up if you want to with ant
design or any other UI library but that
is kind of how I like to handle errors
right now and graph QL and do validation
so I hope that's helpful let me know
what you think if you have any better
ways of handling errors in graph QL I'd
love to know
I'm sure there's much better ways to do
it than this but I just have found this
is the best way that I've seen I really
like and it's very easy to display the
errors and forms and different things so
that's it for this video guys the code
will be up on github if you want to see
either the front end or the back end
right here how it all works
I'll have it posted so thanks for
watching guys I'll see in the next video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>