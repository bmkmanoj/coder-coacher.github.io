<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating GraphQL Schemas and Resolvers using Sequelize | Coder Coacher - Coaching Coders</title><meta content="Creating GraphQL Schemas and Resolvers using Sequelize - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating GraphQL Schemas and Resolvers using Sequelize</b></h2><h5 class="post__date">2017-10-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DlNVHWo_nq8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be finishing up our
graph QL schema and starting our
resolvers but before we get into that
there's two things I want to talk about
real quickly so the first is in my user
model I made a quick typo or copy and
paste error I was trying to set up an
into M relationship between users and
channel but I just forgot to put models
that channel here and set up at models
team thank you for the person that
pointed this out to me and then the
other thing is notice how I have to put
underscored equal true on every single
model because this did not work the
reason for that is because I needed to
do define I just had the wrong basically
syntax or option you have to pass it in
like this so now I can just go in and
remove underscored from my user from my
team for my message and for my channel
so I don't have to have in all those
places anymore that's not necessary all
I have to do is define underscored and
now they're covered okay so that's all
good now we're gonna hop into our schema
so right now our schema we have one file
for the schema and we have one file for
our resolvers and this is fine for small
graph QL projects but as someone pointed
out in the comments as this grows as we
get more resolvers or more schemas this
is not going to scale well and it gets
really messy really quickly so what you
can do is there is a library that helps
you with this what you can do is you can
split up your schema into smaller files
and so that's what we're gonna do so
it's called merge graph QL schemas so
I'm going to copy this we're gonna go
ahead and install it and what this will
let us do is create schemas so here we
have schema one schema two it's gonna
match those two together for us so we're
gonna be using the merge types right
here and there's also merge resolvers
which we'll use as well so let's give
this a try so I'm going to say yarn add
and
go ahead and install that and then here
I'm gonna instead of doing schema J s
I'm gonna create a schema folder and
then I'm gonna put my schema in there so
for now just to test this out I have one
query a high query so I'm gonna call
this the high dot J a schema and I'm
gonna create a folder for resolvers so
resolvers and I put my resolvers in here
and I'm gonna call this the high
resolver because this only resolves the
high query and so now we're gonna go
into our index file here and instead of
just importing type deaths and resolvers
we can import it ourselves so that's the
manual way but I wanna try out is
actually this file loader which lets us
just point at a folder and it grabs all
the schemas inside of it so I'm gonna
copy this and give it a try
so let's paste this in here so we can
bring this down here so I'm gonna call
this Const
is equal to file loader and we're gonna
do this from our schema so a schema and
we could have called this type so if we
want to but I like to refer to it as the
schema and then we're gonna merge all
the types together to create the type
deaths so conce typed FS is equal to
merge types so we don't need to import
here anymore and we don't need to import
the resolvers either so types so what
this does is it reads all the schema
files so right now we just have high GS
into an array and then we merge it
together using the merge types which we
get from here as well and then here
we're just pointing to the folder we
want which is schema and then we're just
feeding type deaths into what we did
before and so we're gonna do the same
procedure for the resolvers as well so
here's what it looks like with resolvers
and this looks quite similar we could do
this manually as well and import each
file but I don't see why not just
the file odor cuz it's faster so merge
resolvers song resolvers so we're gonna
say Const resolvers is equal to
importing the resolvers folder and in
here input resolvers and we'll do COS
resolvers we'll go ahead and call this
the cons you know what why don't we just
merge resolvers let's just wrap it here
save this ourselves an extra variable so
do the same thing here
where's types and we'll say type deafs
ok so now we have our type thefts our
resolvers and now we can create multiple
files so the idea is I can do a high in
abide is you know read in both right but
let's go ahead and before we actually
add in all our schema so team channel
message just go ahead and run this and
make sure it is all good so I have mine
running and looks looks like reading in
air so let's see what the problem is
first argument should be an array with
at least two elements Oh to merge we
need at least two so i guess because i
only have one it doesn't like it so what
i'm gonna do is i'm gonna create a
channel oh why don't we do a user that's
simpler user j s so here i'm going to
export default and I'm gonna do a string
and I'm going to copy the types that we
have
just over there that way we have two
files that we are reading from alright
and then I'm going to create another
resolver called the user resolver which
was export default an empty object we'll
see if that works
if not we can create a resolver for one
thing and see if it works okay so I'm
gonna come over here to the local host
I believe I'm around 80 81 slash
graphical to try this out and we can see
if the air goes away yep looks like the
air went away now and I'm just gonna go
ahead and run hi and make sure it
actually functions okay cool so now it's
functioning okay so I'm gonna go ahead
and get rid of hi and the hi resolver
because we don't need that and let's go
ahead and get started in our schema so
I'm going to create a user channel
message team and actually just for write
1 2 3 4 yep and so in each one I'm just
gonna export defaults I'm gonna put in
the type so grab the channel type and
because these are all gonna get merged
in the end we don't have to worry about
for example the user type being the same
file ok so give that a save an export
default so right now it looks a little
silly having to split all these up
because we don't have a lot of types but
as we start to grow this makes it very
easy to go hey I need to look in this
file to change the mutations or whatever
alright and team which we'll put over
here
so export defaults and we paste in hoops
paste in our team cool so now we split
up all those guys and let's create crud
operations for each one so crud you hear
me saying crud crud stands for create
read update and delete these are like
the four operations that you can do on
objects basically so a user I can create
a user look at a user change the values
of a user or delete a user I'm gonna go
ahead I think and start with doing just
creating the user and then we can create
and read and then we can do update and
delete if we need it
so I'm gonna create a query type so type
query and we'll have create user create
user will have for now will probably
replace this with like a register
function but just to make sure
everything is working so this will
return a user so we're gonna take in a
username which is the string a email
which is a string and a password which
is a string now pops out a user oh wait
this is a query and yet I wrote a
mutation so we're also going to do
queries so this is gonna be like get
user for example
we could get a user passing in an ID so
int or we could say all users and we
could return an array of users so let's
go ahead and just to implement all these
to get practice with it so we're gonna
create a user I think these are all the
variables we need and we're gonna return
the user that we created and we're also
get user and have all user okay later on
we will replace this with register so
now in our resolvers we want something
that matches so I'm gonna go ahead and
say channel yes and for now we're gonna
export defaults that and we can create a
team J sx/4 defaults of an empty and
finally message
okay
so now my clear is Oliver I'm gonna do
two two or all my functions so query and
mutation let's start with mutation
because that's how they're actually made
so create user so just like before this
is getting four properties to be parent
the arguments context and info we don't
really need info so we can just leave it
off we're gonna be using context and all
these guys so what we want to do is pass
the sequel eyes object over here to our
function that way we can query our
database or call Postgres from this
function because what I'd like to do is
create a user whenever this resolver is
called so I'd like to basically call
create user from sequel eyes so what I
will do is in my mutation area my index
over here in graph QL Express I can say
contacts and I can pass an object and
this object here is going to be passed
its called context so you'll notice that
matches here so that's going to be
passed as an argument to our function so
here I'm gonna put models and then if
you remember last time we set up models
to have all our sequel eyes models in it
so now what I can do is I can say models
to grab that and I can say models dot
create passing in the arts and that that
is it so that will create a user for us
so the arguments here is what we're
gonna be passed from our graph QL
mutation so a username and email and a
password now this is a very simple
example and it's bad because we were
storing the password as plain text which
is okay when we're first starting
you should never do this in production
or pretty much ever but we're gonna do
authentication in the next video and
that we will hash the password here we
will do get user so parent args and
again passing the models we're gonna say
models dot find one in here we're gonna
say we're and then we can pass and how
you want to find it and we're gonna one
of our arguments is an ID so we can just
pass the ID in here and oh that should
be a comma and then our last one is all
users so here we have no arguments so
we'll just say args and we do find all
loops and I made one big mistake here
this should be models dot user right
because we have to tell we have to tell
it which model we want to use so the
name here I'm using upper case you user
this corresponds to what I named it here
in my models so I call it upper case
user this references the user model and
the user model is doubt slash users
which we made right here all right so
let's see if we're having any problems
with our code we should have everything
we go to terminal over here it looks
like everything is running let's go
ahead and see if we can create a user so
mutation create user and we're gonna
have to refresh because it's not Auto
completing for me so create user
and username first user email email at
email comm and password super secret so
I'm gonna go ahead and create that we
create our user if we wanted to we could
ask for more fields back right I could
get any username email oh we said you
had to have a unique user name and the
email see notice we got an error there
because they weren't unique all right
again we get the values back you'll
notice teams won't work right now
basically this is a flawed version of
how query and mutations work we're just
getting something simple set up so we
can then expand on it later so let's try
getting the user this says it user ID of
three so I can say ID three and I can
ask for the ID user name you know cool
so we got the user back now instead of
get user we can say all users all users
is required but not provided okay so
let's go back to the schema I think I
accidentally yeah so we don't want to
pass any pram oops
there's no parameters that we want to
pass to all users so this is how we
specify a query where we want no
arguments so now I can run this again
we got no users oh I forgot to take off
force true so it just dropped the
database so since we have our models in
a good place I'm gonna go ahead and take
force off so we don't lose all our data
types so I'm going to ctrl Z and go back
to where I created users and just create
a couple more users so create that
and that so now we have two users and I
can say all users ID username email
alright cool so now I've all that's
working how we expected let's go ahead
and the user here is not what we want
the user mutation and query these are
are not going to work very well because
there's two problems this teams is not
given to us and that's something we're
gonna deal with later because grabbing
the teams is more complicated and we
basically either have to do separate
query to get it or do a join on the
table since this is in a different table
what I want to do now is just go into
team and channel and do those because we
can do more of those right now so
mutation so type mutation we're gonna
say create team so when we create a team
we really just have to give it a name
we're just gonna be a string and when we
return and really what we could do is we
could just return an okay right we could
just return a boolean of whether the
team gets created and that's an
acceptable way to do it if we don't care
about getting the object back so we can
just do that if we want to and then our
query do want to query it right now
we'll worry about queries in a second I
think so we have a create team and
you'll notice how I'm not specifying the
owner here so I'm going to come over
here to the team and I don't know if you
guys caught this but you notice how I
put tight mutation here and type
mutation here the library auto merges
those together so there's one mutation
and so same thing here so I'm going to
say mutation
create team and this is gonna merge with
the user resolver over here so here
we're gonna have parent args context and
so we really care about the models we're
going to say models team create and we
want to pass our well this is not gonna
work and I'll show you why we're missing
an argument right so if I tried to come
over here
I said mutation create team and after
refresh great team name my first team oh
we forgot to return
let's do I guess we could just really do
a try-catch right I like a sinking
weight so I'm gonna cook make this an
async function and I'm gonna say try
oops
return true so we're gonna wait the
response of this and we're gonna catch
any air that occurs an air they can
console.log there and we can return
false I'm actually really surprised that
it returned true but let's see if this
also returns true
okay this returns false and let's see if
we can read the air I don't know if this
is a validation error yeah I think it's
a validation ship it looks like a
validation because I really named it
this before so is create another one
okay so this creates the team okay I'm
really surprised let this create the
team okay so let's go ahead and go into
the database real quick I want to show
you guys why I'm surprised so select all
from teams
notice how the owner field is null I
thought for sure we would have to it
would be like hey we don't have an owner
so that's what I was gonna talk to you
guys about so we don't want to pass in
the owner as an argument I mean we could
but we really like to kind of just infer
the user so what we're gonna be doing is
using JSON web tokens later on and
that'll tell us what the user is and for
now it'll come in like this a user which
we pass in through the context and so
what we're gonna do is we're gonna
create this we're gonna spread the
arguments and then we're just gonna add
an owner there's gonna be the user ID so
we're just kinda gonna add that on now
for now since this is a we don't have
any of the infrastructure set up yet I'm
just gonna pass in the context a user
and I'm going to say his ID is one
so now when I create a team I'm gonna
create a team for the first user so
create that and now when I select we see
we get an owner of one so just that's
perfect and I think what we're gonna do
might want to start doing is starting to
start the front-end so we can start kind
of pairwise as we build up stuff in the
backend we can start getting to work on
the front end and we'll work a lot
smoother so we don't have to mock as
much okay so our team has we can create
a team now that's good
let's create channel I think for our
application we actually only need like
one one or two queries and I'll talk
about that in a second let's do so for a
channel there's gonna be create channel
this is gonna have a name
we'll also pass the the team ID because
remember how we said that channels are
inside a team so we have to specify the
team that the channels inside of this
will be an int so this is gonna be a
name whether it's public so public
boolean and we're gonna set default way
set defaults in graph QL is you can set
equal sign here and we're going to say
equals false and we can actually set a
default in the database level which
could have been better either way works
though Bernie goes ahead and say false I
don't know if they want uppercase or
lowercase false let's see if we get an
error this compiles okay looks like it
compiles okay and runs so you can use
lowercase F
and then it looks good for creating a
channel so let's go ahead and we're
gonna do channel doesn't need to have to
be associated with a user I don't think
so
mutation create channel parent orgs
models and we're gonna do the same thing
we did try catch
and we're gonna await the response of
models dot this is a channel create and
this one I think we can just take the
args we select the channel we can see
what channel's name public so we're
gonna we're getting the team ID in and
the public so we can go ahead and test
whether the sequel eyes correctly
translate this this into a underscore
just notice how the field name here is
called team ID underscore or team
underscore ID whereas in my graph QL
schema right now I have it passed in as
camelcase so this argument here where
did I go channel is gonna be camel case
when I pass it in so let's see refresh
we created a team I believe there's a
team with an ID of one so let's create a
channel team ID is one name is gonna be
c1 and then public we want it set
alright so we created the channel okay
so it looks like sequel eyes correctly
yeah looks equalized correctly converted
it went in okay awesome and we should be
able to create a message now message is
going to be interesting because we also
want to hook this up with
subscriptions so whenever I type a
message everyone can see it instantly so
create message this is going to have a
channel ID which is an int it's gonna
have a user ID which is going to be the
user that sends the message so we can
infer that from the JWT token which
we're getting from the context and then
the text which is a string and none of
these things can be null so I put bang
signs and if we can just return a
boolean of whether it worked
and I'm just gonna go ahead and copy
this because we're basically doing the
same thing except instead of creat
channel and create message and here
we're gonna get models and user and
we're gonna do channel doc not channel
message and then we're going to keep
args and then set the user ID equal to
user died ID and then what we can do is
give this our run try it out so we just
create a channel channel 1 so mutation
create message ID well it's in case
being err let's console dot log the air
now let's also put that in our channel
over here too that way we know if
something goes wrong create message 1
and text of hi alright cool so we create
the message we now can see it in our
database hopefully we do we see hi
and so now we're able to create all
these things so earlier I alluded to we
will only be doing one query I think
it'll be either be one or two query
queries so what I'm thinking is I do a
query kind of like this when you open up
slack
you'll be basically we know who your
user is so we'll basically call like get
user on your your person and then from
that what we're gonna do is we're gonna
get all the teams that you're associated
with
we'll get the we don't really need to
know the owners per se why not we can
get the owner we can get the owner of
the team we don't care if not so we get
all this we get all the teams that the
user is part of with this and then we
get all the channels that each team has
and then we could get all the messages
that every channel has now this is very
heavy like this is a CME nested deep we
are and we don't want to select all the
teams and all the channels if it's not
open so what we will do is we'll
probably split this up and query
channels but I'm not sure quite yet how
I want to query things so I kind of want
to start implementing the authentication
and the front-end and kind of see how we
want to query things after we create
them but it's good we got set up these
mutations are good the create ones for
you not our user our users gonna change
but for creatine message and channel are
all good and what we'll do in the next
video I think is we'll probably set up
authentication or maybe we'll start on
the front end and start using the back
end that we've set up we have a pretty
good fundamental core set up and now we
can start making changes easily and add
on to this so this is a good set up so
that is it for this video guys I will
push up this code and a link will be in
the description below if you want to
check out the code it's gonna be up on
gift
thanks for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>