<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Optimistic UI in React GraphQL Starter Kit | Coder Coacher - Coaching Coders</title><meta content="Optimistic UI in React GraphQL Starter Kit - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Optimistic UI in React GraphQL Starter Kit</b></h2><h5 class="post__date">2017-06-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wyz5w9pSv40" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys so we have this little
form here where you can create users and
it makes a mutation using graph QL and
sends it to the server and adds that
user to the database and it does this
but then we don't see it actually lose
our list of users right here right if I
create a new user like so new head
create user I don't see my list here
with the new user there but if i refresh
I see new pop up I would like to it so
when I type hit Enter when I type and
then create user pops up here right away
and we're going to be using what's
called optimistic UI to make this happen
I explain more how that works we're
gonna dive right into it if you don't
know what I'm talking about what this
project is I have links in the
description below this is basically a
graph QL starter kit that I'm using
called react QL and is currently pointed
at a graph QL server that I set up the
graph QL server is made with node and
we're just talking to it to get this
information right here so making a query
request all right so let's jump right
into it
so there's this thing called optimistic
UI what type is optimistic UI what I
want it this is how you do it too so I'm
going to copy and paste as this guy into
our code I'm going to walk through how
it works so first I want to explain
though what the heck optimistic UI is
how optimistic UI works is if I type a
name here like 10 and I hit create user
it's going to pop up here immediately
before I even submit it to the server it
assumes I'm submitting something correct
and that will validate then once it goes
to the server the server comes back and
it says hey this new Tim user is good
and you don't change anything here or
hey the Tim user is bad you're not
supposed to making users named Tim and
it gets rid of it here now let's make a
way more sense when we actually code
this out that it makes sense to you so
wait until we finish coding this and
I'll like a ton of sense we see it in
action all right so I'm going to paste
the
here if you don't like to get this chunk
of code I'll put the link in the
description below to this website right
here this is the Apollo documentation
site and it's you can see the link right
here it's just on a mistake UI alright
so got the code here now we're going to
modify this for our own thing so we're
going to start typing a mutation is
perfect submit comment this is the name
of your nutation ours is create user
type name here is this is a user type
and then right here this is what you
expect the value to be so if we look at
all users we expect to have an ID and a
user name so we need to have an ID and
username here so ID username so the user
that we're creating here ID a like to
just put negative one because we don't
really know what the ID is going to be
so it's fine just to put that value and
the user name we actually do know we're
getting it from the state right so when
we do we're updating the state the value
that these are inputs and we expect that
value to be the value when we get back
from the server okay so now what we have
and we actually update so we're going to
have right here
create user but then has a conflict as
we're doing this error because it's
already in scope so I'm just going to
get rid of that right here and use data
and data is complicating with this one
so I'm just going to call this data 2
and then this is data 2 here and this is
data to here ok so first we're going to
read the query so this is so there's two
components to this there's an optimistic
response and there's update right
optimistic response is what we expect
the returned from the server to be so we
expect the the server to give us back
the ID of the user and the user name
that we passed it and an update is what
we actually do with that data so the
first thing we want to do is we want to
read
from the store and we want to get all
the users that we already have so so
it's gonna be it's a all users query so
we're going to make this query ready and
we expect to have an array of users
right we expect nice this array of users
to be there so that's what data two is
going to be and data to dot all users
right because we expect if we scroll up
we expect data got all users and this to
actually be an array you can change this
and we don't we don't do it this was
just a comment but as you can see from
the prop types we expect this to be an
array of objects so we're going to push
another comment or another sorry excuse
me user and the user is going to be data
dot create user so that's just the
response from the server right here that
we're grabbing this data element is
actually here and I recommend just
console logging these if you want to see
what state the values are but create
user matches up with this here and then
all user matches up with our query and
then we're going to do a store write
query and then here get rid of comment
query ready do users so notice though
we're using the all users query because
that's what we want to see updated right
whatever query you want to see updated
after a mutation that's the query you
want to pass right here and also notice
we're doing all the stuff in the mutate
function so you can have an optimistic
UI for each mutate function you have
alright so then we add our user so these
I would recommend reading these comments
too we add our users to the mutation
then we write it back to the cache
all right cool and actually that's it
this is all you need
there's one piece missing notice we need
to get the ID and username and we're
only getting the username back from the
server so we also need to get the ID
back that way we can
ah it matches up exactly with this
because if we just get the username then
we're going to be missing the ID field
and we're expecting the ID field so it
messes things up I'm going to actually
throw kind of a warning I won't work so
that's that so now I'm going to show you
what this looks like so if we refresh
and if there's no errors we should see
it pop up here after we type so I'm
going to type Tim hit create user and
bam Tim shows up immediately and now I'm
going to show you kind of how the
optimistic UI works with Sally now I'm
going to show you this is the server
code now I didn't want to just add this
in I didn't really feel like I need to
show you guys this because I'm going to
remove this and this is only for
demonstration purposes but if they pass
in the username Sally I'm going to throw
an error I don't actually want the name
Sally so we're going to get an error
when we do this but because of
optimistic UI we expect for Sally to
work because right when we create the
user Sally we don't know that that
shouldn't work so it's actually going to
display Sally here for like a
millisecond and then when the server
throws an error back it actually removes
it here so what's nice about optimistic
UI is it's actually faster it doesn't
wait for the server to respond it shows
it here right away and they correct that
if it's wrong for example Sally is going
to be wrong so watch it pop up here if
you pop up for a millisecond this is oh
that was an error
Sally can actually be added there and
then it removes it you can watch that a
couple of times and see it pop up but if
I do any other name you know we actually
have that already it pops it up
immediately and then you get the return
from the server it's good - nothing
changes here alright so that is it for
this
that's how optimistic UI works this is a
little tricky to set this part up and
what the names of everything should be
so if you have any trouble with that let
me know in the comments
I'd be happy to help and that's it for
this video I hope you liked it I'm not
sure what I'm going to do for my next
video it could be authentication or I
might do slip something else in the
middle before we start doing
authentication because I want to be able
to log in and do some stuff with that
and show you guys I'll 10th ocation
because that could be really helpful I
see I'll see you guys in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>