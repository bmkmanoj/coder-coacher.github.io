<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Fullstack Feathersjs and React Web App Updated - part 22 | Coder Coacher - Coaching Coders</title><meta content="Fullstack Feathersjs and React Web App Updated - part 22 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Fullstack Feathersjs and React Web App Updated - part 22</b></h2><h5 class="post__date">2017-05-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yLmyP01XhSg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back guys so we just finished
setting up our server and now we are
going to continue with our login and
sign up page so I am just going to open
up the console so you can see what's
going on all we do this now we're able
to create a user and not found but it
created it oh that's an old that's old
that's why I was like I don't sure what
that was and now we could try out
indicating and let's see what happens
all right we got a bad request missing
credentials so let's see what we posted
to this preview Oh
our login saga we need to change here
because remember we need to our login
saga has now a two things it has data
and has redirect and we call redirect
here after we're done and then we pass
data to our login oops so now when we
try login 10 10 awesome looks like we
got the decayed and nope we didn't so I
thought we have to decay because I saw
this and it gave us an access token back
but it looks like we did some kind of
problem Oh next is undefined so come
back to the login view this stop Rob
stall location so why don't we just
console.log props and we can see what
we're working with so location might
have changed a little bit
looks like we have location and the
query dot next okay so query is not even
there if we don't have anything here now
so one like little quick hack fix is to
do this
so if query doesn't exist
we then wrap it within our object and I
think that's fine so now 10 10 and we go
here awesome so this is not a function
we'll fix you in a second so that's good
we can out login it recognizes that
we're logged in now what we need to do
though is our authenticate component
though this off thing is we need to
change how this is working so we're
doing this thought check off this stop
check off if you really don't need to do
this all it often we just really need to
do it when it's mounted so we're going
to move it here and then here we don't
really need to check whether they're
logged in or not we will have to do a
browser dot push actually this is going
to be interesting I guess I guess this
dot props
okay we're it's getting the props
nevermind I was going to say trying to
think of how this was going to work that
I think I understand how it's going to
work so okay so location not path name
do we have that know-it-all okay I just
want to see that was left because I want
to see what the value of this was but
now we don't have to worry about this we
will always show the component and we'll
redirect if they're not all indicated
okay
and we don't need actually I don't even
think we need to connect this anymore oh
no we do because we need to pass the
user we're actually gonna create a new
action for this so there's a new way to
authenticate and feathers Jas and that's
what's going to be happening here so I
don't need this
do i and let's stop check off we don't
need this we don't need this is fine
because we'll we might be doing stuff
with this okay so the new way to
authenticate is before you used to
seeing this you just off the de Kate and
then you get users but now the new way
is to use this feathers authentication
client and what we can do is after we
get the access token after we login we
store in the local storage and we use
this passport verify now and that's how
we can get the user to and oh I guess
there that's actually they're just
getting the user ID from this payload
I'm not sure I would have success
expected to also get the user but we'll
see okay so what we'd like to do Leedy
get is the user so what we're going to
do is for now we'll comment this out is
we're going to do we're going to import
an app and we need to get app from the
module index so that's going to be up
one three modules and then here what
we're going to do we can console dot log
local storage get and I believe it's we
can come see what's being stored if you
go to application you can see actually
your tokens here so I come here to local
storage I see it get this feathers JWT
others j15 okay so we'll get that item
will print it out and console a lot log
and the reason why we're getting rat
read lines are on local storage so we
just need to add it to this global
little coal storage Oh to make sure
they're okay so now you'll notice how
total solar local storage no longer read
so now we can you ab dot passport verify
GWT passing in the token so let's print
the token to make sure we're getting a
good token and then we're just going to
print out what that looks like okay we
get not authenticated no auth token so
let's slash recipes okay that's fine
so now we want to require auth actually
on the home page actually we don't want
to acquire okay we're going to put
acquire off on the home page for now but
we don't really want to do that it
should be is an X so we don't really
want require off on the home page but
I'm just putting it there for testing
purposes real quick okay okay so it is
promised okay so notice how it's a
promise so I just want to see what the
return value is because we're arguing a
promise though we want to put that in
our module up here
sorry not modules our Sava so do dot
then data and let's print out console
dot log yeah
and take a look at what it's going to
give us when we verify the token and
okay and it looks like we get that we
get the expiration date of the token we
get this sub and get the user ID okay so
now what we'll do here is we'll actually
go back to using this what I had before
now we'd like to get the user from the
state and we're going to do a little
check here so we'll say object dot
values of user dot length it exists that
we can just show the component if not we
are loading data loading because we're
off indicating so it's a problem here Oh
your must be O 0 and this will be this
dot prop stop trailing space alright
cool
we also want to do Const we want to grab
this bind we're going to do the same
thing we're doing here and our off so
paste that here
and copy the import statement okay and
now here we're going to do like a
request request off so import request ah
from and we'll go up into modules and
then user and then actions so actions
over here will create a request ah
request ah quest off so we're going to
call that action from one rather where
you want to off looks good and then
there's needs to be like that so when we
mount what we're going to do is where
you want to request off this dot request
off and and we should pass in here a
redirect actually we can actually just
we don't even need to we can actually
just pass in a function we don't need to
wrap it in a what's it called an object
so here what we'd like to do is do this
to our props that history so we're only
going to call this function if they are
not logged in in that case we would like
to push them to the login page so
they're not if we can't authenticate
then we push them to the login page
so this request off we actually need to
make a saga for so alright cool
you can copy this
this will be um check this will be off
saga this will be call off and then
we'll call off and then here we'll get
the payload and then the payload is that
function that we got and we'll just call
payload and then if it did work here
what we'll do is we'll call our reducer
here off good all got done augered off
good so we'll call that function and
we'll get we'll get a user from this
console dot log user so when we
authenticate with like two user and
that's what we will pass there all right
this looks good
not sure what this is oh this just needs
to be caught
call off and here oh and the world
listening for is request off here we
request off okay so now we actually just
need to create this off in the API so
off oops not here in closed we have way
too many things up let's close some
stuff so okay
API export async function off and what
we're going to do is basically this I'm
going to copy this uses as a template oh
and before we continue we should
actually configure stuff like this too
so now in our welcome back to the API
momentarily
now instead of
am i doing authentication anywhere here
nope I'm not so this will be import off
from feathers authentication client so
yarn add feathers authentication client
so we need to add that library out that
load and then down here looks like
configure looks like I just need to do
that off ok I think that should be it
we'll see we get problems with it so
again I am going to use async await so
try and then catch air if there's an
arable console dot log air and then we
will return an empty object ok there's
not an error during a value ok there's
not an error the first thing that we're
going to do is we're going to get the
token which is local storage type get
item feathers then what we're going to
do is we're going to Const payload with
the payload from the object so now what
we'll do is do a wait and we will call
app dot authenticate or sorry not app I
don't know why I was going to app top
hat for top verify and then returned
will be that I guess while we were what
we can do is we don't even need to check
I was going to say we could check on
whether the the token has expired but I
think verify verifying the token like
that
is checking whether it is expired or not
so the next thing we can do is just we
have that so now we can get use the user
service so user do user service get and
then payload dot user ID pass it in
there get the user then we return the
user and we await it looks pretty good
and then you they have an error thing at
the bottom we don't eat that all right
I think the auth function is good so now
we can refresh this and see what happens
okay so we have a problem request
request auth is not a function so
request off this here auth is here Oh AB
dispatched props we just need to add
right there to our connect is it same
thing ok same thing so request off which
we're getting here and we don't need
these things I want a console dot log
console that log this top crops oh it's
not this but a check off it's this stop
props the check off alright so we loaded
and then we were not authenticated so we
redirected Oh redirect hee hee so in our
SOG is here we only we don't redirect
every time we log in or sorry check off
if object dot values of user dot length
so if that's a bad value then we
redirect
so now let's see what happens when we
just go to the main page so it loads for
a second that loads in the user then it
comes here and notice hey look Tim we
have the user
so we're successfully authenticating now
that's awesome there's one last thing I
do before we in the video because it is
getting a little long is just do this
next thing here so we can get the
basically if they're not authenticated
we want to pass that in copy that I
guess what we should do is we should
just make this into a regular old
function here and then we can put these
guys here oops and then instead of that
you put it there
and cool again we're not doing prop
validation yet I'll add that at the end
but now if we're on a page we're not
indicated we're not logged in it'll
redirect cool so that is it for this
video we're now six able to successfully
get the user and request the
authentication and that's it so I'll see
you guys in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>