<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GraphQL Join Monster Tutorial | Coder Coacher - Coaching Coders</title><meta content="GraphQL Join Monster Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GraphQL Join Monster Tutorial</b></h2><h5 class="post__date">2017-08-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/n-Mb2HiFVKc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys I'm going to show you how
to add joined monster to your graph QL
server now for this example I'm going to
use my graph QL template which codes on
github if you'd like to follow along now
from last time I've changed this I added
a mini tamiya relationship for this
example I created author a book and a
book author of these three models right
here so author has a first name last
name and I made an association to the
book that way you can have a
many-to-many just specifying that the
join table is going to be book author
and the foreign key is author ID and if
we come over here to book you can see I
just have a title and then we're
connecting from the other side to create
the mini main relationship with the
author here and then book author here I
wanted to create just one field in the
joint in the join table here so that way
I could show you guys how do you get
something so I've made the connection
being whether there's a primary author
that doesn't really you know if there's
multiple authors on a book maybe one's a
secondary author or something or
whatever so yeah so that we're going to
be getting this field when we're doing
queries and so yeah that's the model we
have set up let's go ahead and start
working with join monster actually
before we do that let me show you my
schema too I changed that as well as
just adding an author type in a book
type so ID first name last name primary
whether the primary author and then we
want to get a list of books that's
related to the author and then the book
it was the other way I want to get all
the authors associated with that book in
the title and then the ID so that's that
and I just made three mutations create
author create book add book off there
just to be able to add some data for
this and if you guys I'll just show you
guys my resolvers real quick for this a
create book you'll notice I'm just all
knowing is grabbing the args creating
the book and then returning those and
then returning empty for authors since
no authors are going to be in the book
when you first created
same thing over here the opposite fur
and creating author books and then just
here when I'm adding an author to a book
just creating a returning trip okay so
that is the code I added and now we are
going to talk about queries and setting
that up with joy monster but first one's
configured to a mobster on the server
okay so here's the joy monster
documentation we will be hitting that up
later I have an Apollo server so I need
to use this guy right here so this is
the readme for joy monster graphical
tools it after this is the library to
make it work with an Apollo server which
is what we're using if you don't use
Apollo so reuse something else you do
not have to use this adapter but I like
using Apollo some of these as a factor
so I'm going to install this library and
join monster as well somebody yarn add
that library there and then join monster
and then we'll have both of these okay
and then what we need to do here is we
actually need to add some metadata
that's what all this junk is and then we
just tell add it to our schema here so
copy this actually I'm going to copy
this here because we're going to be
needing this and you'll notice because
nothing's for going on with join monster
join monsters and there resolvers here's
the resolvers usually monster and
resolvers and then uses adaptation to
your schema and that's it that's all you
have to do is setup there's nothing else
out there doing so let's go ahead and do
that so in my index page at the top not
my models index we're done with models
index of the application I'm just going
to do an import and we're going to say
from this and then we're just going to
come down here we're going to create a
join monster metadata from dot slash
join monster that is data so this is
where we're going to put I'm going to
create a file here
called join monster metadata so this is
what we're going to put in all our stuff
for joy monster to configure it and then
right here we're just going to call join
monster addict adapt on the schema and
then passing in any kind of
configuration that we're going to have
and that's going to be metadata and then
we are all set here for join monster
configurator with the schema now we just
need to set up our metadata which we're
going to export default just an object
that's going to be where to come back in
to listen in a second first look in our
schema there's two types of queries I
want to show you guys how to do the
first is just grabbing all the books or
all the authors the second is grabbing a
specific one so the first query we're
going to start with is going to be all
books and we're just going to return an
array of books so all books what we're
going to do is bring it array of books
and then there we're also having array
of authors right for each one because we
have has learner types so we're going to
come over to our it honor index or
resolvers and then in our queries which
is right here we're going to say all
books we can copy this all books what
we're going to do here is call this is
where we actually call join monster so
come up to the top and do import join
monster it's from join monster and in
our query here we're going to call join
monster and this is exactly we're going
to pass it so you can copy this paste it
in here and so resolver info this is the
fourth parameter of the resolver so info
if you
areas going to pass here it also wants
to be context contact or context here
but this is any like arguments you want
to pass so the best thing to do here is
just pack the Arts is what I found is
just pass that in and then the dialect
we can put coats equal if we want to it
should by default actually I'm not sure
if it will pick it up by default so I
guess it's good to put that there
Postgres equal or maybe actually not
sure if it's peace equal or if it just
goes by Postgres equal we'll put up
there
I haven't actually put this before if we
get rid of it it'll still work so I'm
going to actually just remove it because
I don't remember what exactly we're
supposed I don't know what the
configuration is four beats equal what
it once it's there all right and then
here it what's going to happen is I want
to show you guys before we even do this
we'll do console.log sequel this will be
console dot log in all books and we're
just going to return an empty object
which will crash of course that's fine
and in our metadata let's find let's now
see if this will resolve for us I want
to call all books and show you guys what
the value of sequel is now what it
should be is what it's going to do it's
going to read the query all books and
see what
so all books over here ok refresh we
crashed it and the reason we crashed it
is cannot find module join oh I spelled
monster wrong and the index here monster
okay yeah so how that's going to work
very cool is whatever we're going to
come over here right into graph QL or
graphical and we're going to say all
books right and we're going to specify
what fields you want if you want to see
the ID author and the title so we want
to see all the fields right and author I
just want to do the IDS so it's going to
read this query that we passed in look
at the different sub I don't know to
call these subtypes properties that we
want to get back and it's actually going
to generate sequel to be executed it
doesn't run the sequel for you it just
tells you what it should be and then we
were going to run it with what they're
called sequel wise so we're gonna call
models let's equal eyes doc query on
this but first let's print this out show
you guys what it looks like but it
doesn't actually know how to turn this
right here into sequel unless we give it
some metadata so that's what we're going
to do and if we come here we can kind of
see what the metadata looks like here is
an example user is imposts basically
what's happening these are the two
important fields to put for every type
that you want and for us there's two
types associated with destroy monster
query book and author so here we're
going to create two just like this so
we're going to have a query we don't
need a query for now since we will do
query in a minute for and you put all
books here but we're going to have a
user or now user we're gonna have an
author a book so an author here in a
book and then you tell it and so the
name here associated to a type and then
you tell it the table name in the
database so for here its book and the
unique ID is equal to ID and the same
thing is for author so now that knows
that this is associated and it looks
over here into graphical if you don't
specify a property then it assumes as
the same
name in the database so let's run this
real quick can I'll show you what I mean
by that so if we were to run this for
example of course
let's call John monster and resolver on
a field where type is decorated with
sequel table Oh should I just do the
wrong thing
yeah sequel table sequel table I just
totally made up my own props their
unique key so not unique ID you can meet
key and its sequel table by that okay
there we go maps to sequel table awesome
after that you must define Seigle joins
you will okay yeah that's fine okay it's
crashing I wanted to show you guys I
wanted to see if it would let me just
like print a sequel out but it won't
even let me do the sequel as forcing me
to make a joint because it knows but a
title for example the name of this is in
the database is the same as in database
so I don't need to do anything the
author's for example that's not just in
the database I mean it's in the database
but we have to specify we want to do a
joint and we want to do a mini two mini
join so to do a mini two mini joint we
have to make a junction like this I'm
going to copy this right here this is
from the documentation and I'm going to
the justice for how we want to do it so
we are doing a the first thing we're
doing is book write all books so one of
the fields here and you'll notice in
this we specify field and we basically
say how to resolve each field here so
the only field I need to tell it to
resolve is authors because that one's a
little bit different and that's where
I'm going to put the junction so go
ahead and format that we're going to
change this the junction is for many to
many relationships you could also put
title as another field if you want to
change how title is being resolved but
we like how title is being resolved
because there's a normal property
okay so sequel table here is going to be
book name our model book author
and this thing I think I need to wrap it
in double quotes and the reason for that
is I have an uppercase a here and so
this equalised is not or not utilized
but a post-race equal handle set like
that so include here this is the include
that you put in all the fields you want
to grab from the join table so for us
that is primary so that was what I added
book author right primary here so any
field you want to grab you want to put
it in the include and you can do
multiple keys here and then here you say
how to actually do the sequel joint so
here is the the first one here is going
to be a book table here is going to be
the join table or we can call it
junction table that's fine and it's
spelled table wrong and then here this
is going to be the author table so if
there was any arguments we could grab
the arguments we don't need any and
that's passed in with the context I was
talking about earlier right here that's
passed in here and okay so book table
and junction table we're going to say
book table dot ID is equal to junction
table and we called this book ID and
we're going after at this and quotation
marks same reason there's not the case I
and then here we're going to say this is
author we're going to do so junction
table we're going to specify the author
ID and then here we're going to put
author table ID so we are basically this
is just a logic for how we want to join
the two tables together so we want to
say which properties we want to look at
to actually do the joint so the ID and
the book ID should be the same where
we're looking at the book table
here the authorization matched author
cable ID so that's just how we do our
join and then I'm just looks pretty good
to me I think this should now work we
have no errors over here in our servers
so let's come back to graphical and run
this must return a promise or do so
we're just printing the sequel so you'll
notice here this is the sequel that it
prints out so it created all books as ID
all books title so it's grabbing the
title and ID and then you here you'll
see that join that we created so book
author and you can see how like junkie
like underscore book off like it's a
little junky and some of the like so
prefix it and stuff the sequel but if we
were to go and run this sequel it would
actually work and fetch back what we
want and you can notice it adds joins
and the nice thing is as you guys
probably know if you know about join
Monster if I were to get rid of that and
just go for the ID in the title it would
just do a select statement here and
notice how the joins are gone because we
don't need to join to get the ID in the
title so it only runs for the fields
that we need but okay let's go ahead and
run that and do a full finish this
example off so let's go ahead and return
models dot sequel eyes and I forget how
to do a raw query I think it's just
query what the see actually let's just
google it real quick sequel eyes we're
all query I believe it's just doc query
yeah it is not query and we can run it
with this type sequel I select that way
we're only returning JSON because a lot
of crap comes back from sequel wise if
you don't do this so okay so we're going
to do a query passing in the sequel we
have and then just doing model dot
equalize our career type dot select
there let's see if we can drop this to
another line
okay so just running the query and
that's what's going to get returned here
and then this junk here this type is
just specifies you don't have to do this
if you don't want to but the type just
simplifies and doesn't return as much
sequel eyes makes the arm less heavy
okay go ahead and run this our relation
book does not exist could be upper case
B no it's not okay so it's books that
you're called books so I think so we're
going to come into our database real
quick and see what it's called you need
to make sure the names are matching for
us and all the good names are matching
so select all from book yep see how my
thing is called books I forgot sequel
eyes automatically plural eise's so that
just means we have to save books here
and authors here okay
now we run this and okay so I had two
books in the database that I already
added we're getting ideas the most
foreign book ever and just another book
now I'm going to go ahead and give the
authors for these books using the ID and
the name and first name and go ahead and
run that book author does not exist
could be book authors let's see what
it's called if book authors so just if
you are having trouble with what your
table names are just go look in your
database maybe using P sequel like I am
or another method to see what your table
names are and we'll go ahead and rerun
this we have no authors here I think the
join got messed up because we're
supposed to have author z' so if this
happens for you what I like to do is
just actually keep the query over here
and see what happens but also let's
select all from book or book office yet
oh okay none have actually gotten
created so I I thought I had run by
resolver here to create one but it looks
like I didn't so down here I have
Oh ad book author is creating another
author that's awkward
I meant to do no wonder it wasn't
working here I meant to call book
authors to create the relationships so
rerun that so let's add some book
authors so as you see I have two books
here and Boni and make this a mutation
and book author so book ID so let's add
this to book one and the author ID I
recreate some authors will do all
thirty-one and we'll make this guy the
primary author so we'll save true here
so go ahead and run that Oh violates the
key constraint book authors okay so it
looks like I don't have any authors I
thought I had added authors
I must have liked to you know look few
authors Oh his IDs ten for some reason
it's not one so ten eleven twelve so
create an author now if we come back to
our query we can do all books title
authors ID last name first name all
right cool and we see Bob and we can
notice we can actually get the primary
field and we see it's true so nice so
our query worked um
so I'm just going to go ahead and go
back to our mutation and I'm at another
author to this book I say this is false
so I just added another author and in
the book too I'll add this thirteen
thousand twelve authors that would be
primary so just added two more authors
now we can do that query again and make
sure all books is working like you like
it but as you can see this is how you do
a many to many relationship one so first
name last name
primary so Bob Joe is true false true
and we're getting the authors so nice
and you'll notice how we're doing the
join become aware here you can see we're
doing this is a sequel getting run on
the database now there's two more things
I want to do the first one I know works
second one I hope works I haven't tried
doing it both ways so like putting a
joint so we have a junction here for
books but what if you want to get all
authors and get the books associated
with them that's what I want to try next
but before that let's do a query let's
do this in our schema let's say we want
to get a particular book so gift look
and we pass in the ID so and our ID
could be end and we want to turn a book
we can return a null book because if
they give us a bad ID so how do we take
in the arguments and do a query with a
joint monster it's the point of this so
inner resolvers here we're going to come
up to the top where we did all books and
we're going to copy it and this we're
going to do what should we call this it
should match we said good book so our
one of our argument here is going to be
the ID right so we need to use that idea
to find it this is actually we keep the
same right we only need to change the
metadata for this so we going we come in
to join monster and we're passing in
those arguments remember so the
arguments that we get here we're gonna
have an ID we're going to passing it as
a joint monster then here we're going to
do fields and then for query we want
that name to match up with our query so
get book so I'm going to say gift book
here and then here
going to do where and we can come I'll
show you guys where it is here so where
gives us the table the argument and we
can go ahead and do our where clause so
then go ahead and copy this this is the
where clause for our select statement
but something I noticed is args null for
me and this third parameter so empty
args here is not all I don't know why
but I tried doing this with I thought
the arcs here would be half definite but
for a reason argh whose this position in
this function so this will work now so
we're packing the idea we're going to
call arcs that ID looks like I owe it
just needs one comma there so the table
the table name is going to be the one we
grab here so we're going to get the
sequel table name books since we're
returning a book and it's going to say
books that ID is equal to the ID that's
passed in that's it
so I'm going to making errors let's see
this at work so all books will get this
first book so actually instead of
calling all books where it's called get
book and which refresh this so I can get
it autocomplete for me an ID of one and
bam we just got the first book and same
thing as before we get all that
functionality that we had super easy
right so now if we've query just like
before if we don't create authors we
don't do a joint we only do the joint if
we pre-authorized so all we have to do
is specify how we get it with this where
and notes enter resolvers we just kind
of copy and paste it this thing here so
it's super fast add queries on with this
so that's what I really like about it so
let's do one last query all authors I
have not tried this before so I do not
know if this will
I hope it does it will make sense if it
does so all authors what I want to do is
do a very similar thing I am doing four
books right so the books filled of
author I need to do a join I need to do
it on the book authors table I don't
care about actually no I do carry about
primary right I want to see if the
author is primary or not still so we can
keep up there and actually I think I can
keep everything the same except for our
sequel joints because authors and here
the author table is going to be first so
actually can I so I actually need to
flip-flop these so author table and then
this is going to be a book table so it's
going to be book table so we're going to
be author table so we need to flip these
as well
author ID and book ID all right all
right we'll come over here oh yeah
first we need to come to resolvers too
so copy/paste this we say all authors
all right are you fresh set all right
looks like there might have been a yep
crash something oh I put this in my
colon oh that's fine is it should be
fine I think I just messed up the curly
braces somewhere so let's see that -
leaves look good semicolon at the end is
fine right yeah fields and their books
and their I understand what I messed up
well everything formatted looks like it
fixed itself it just looks like ever
I've curly gray somewhere right refresh
so let's call all books for sorry all
authors so ID last name first name
cannot do null for nominal will feel
alright so something could not work so
let's take a look at the sequel let's
extract getting executed last name first
name so let's go ahead and copy this and
run this here see what's giving output
so we're getting a laugh oh looks like
these fields might be messing things up
so what I'm going to do is say delete
from authors where ID is greater than 12
and now if we reduce select again we
only get good rows so I had some bad
data in there that I was messing up but
okay so it looks like we're doing good
here so now if I do books also let's see
if we can do primary here primary yeah
primary doesn't really make sense
primary I'm going to have to do a join
on it so I'm going to have to fix that
so books ID but if I do is if I do books
here I feel like maybe I can get a
primary on it as well because we're
joining on the books table nope I don't
know how to get primary from all authors
but I don't think it really makes sense
so I think that's okay alright so title
yeah
all of their stuff Oh so in our author
fields oh we have books here what's
happening so call them authors stop
books does not exist so we should so
books here should be lining up with the
field that we have here and it should do
this Junction thing so we are returning
authors from all authors yeah all those
returns on author so field books I want
to make sure my schema I have books here
yeah folks its type is book this looks
all good to me I would think I don't I
wouldn't think we get that air I'm going
to try getting rid of this primary call
them all off their cell focuses on
exists okay let's see what's a sequel um
so when we run this I think it's still
running the sequel and back here let's
see the sequel is generating yep it's
executing sequel so doc books Oh
something weird happening right because
I'm certifying the field here okay I
broke something so when I added this a
crazy break down here I was supposed to
go up here and put a comma here area so
I messed things up when I did that
so let's rerun this alright so this is
better
so all authors we can see Joe is the
author of this book here um Todd is the
author of this book and Marcus authors
this book and we can see that this
there's an overlap here so I still think
primary is not going to work and it
doesn't okay that's what I expected I
also got no idea rid of it there to give
primary to work guys I think
what you would need to do is the do
primary here in the fields and then do a
junction
I'll see you let's try it see what
happens actually this doesn't even make
sense right because we're getting an
author can be can only be primary on the
other end so I was going to add primary
here but notice how Joe can be primary
in one book the primary author on books
with a secondary author of another book
so it doesn't make sense that the
primary field and this query so actually
I think this is totally fine and I think
this works I think there's nothing I
would change about this now
I think authors good book is good and
this good book query is good um and by
the way get off there would be the same
logic here very similar logic not the
exact same right but you would do the
similar thing but is it for this video
guys I hope that helps on how to set up
queries with a join monster and you'll
notice how it only has to do with
queries to a monster does not help with
mutations this is for batch querying but
I think this is pretty cool right
um I I really like this it's super fast
to set up different stuff like we have
to do a little work here right to set
the metadata but once you setup the
metadata you saw how fast we're able to
just add on queries that are really
efficient because they're only doing it
on the fields that they need for the
properties that they need and then we
just copy and paste for each query so
I'm in love with this library I really
like it let me know if you guys are
having trouble with joy monster making
any queries because it can be a little
weird so far I haven't had any problems
like any query I wanted to make with joy
monster I've been able to figure it out
so let me know if you guys are having
any troubles with any queries you're
trying to make I want to test this guy
out and see how good join monster really
is if there's anything it's missing so
if you guys have found
let me know I love to define I'd love to
know about it and see if there's a way
to do it so thanks for watching and I'll
see you guys the next video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>