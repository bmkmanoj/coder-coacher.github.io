<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Fullstack Feathersjs and React Web App - part 9 | Coder Coacher - Coaching Coders</title><meta content="Fullstack Feathersjs and React Web App - part 9 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Fullstack Feathersjs and React Web App - part 9</b></h2><h5 class="post__date">2016-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oh6e5BzOCpY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up so I want to work on
the login so right now if I login test a
test comm test login oh well we see our
username but if we refresh the page
Oh No our logins gone what the heck this
should be persisting so on what we're
kind of showing you how to persist it
now how it's being persisted is we're
actually saving a feathers token and
local storage so if your application
local will see these feathers JWT and
it's like a little token which can be
used instead of your username your
password to authenticate so they don't
have to log in every time so we're going
to use that acid to F indicate so we'll
do this and the index cage because we
want to do this on every page wanna make
sure they're authenticated or check
whether the earth indicator on so first
we're gonna pass in the app from local
storage they're not from local storage
from the store and we do app down
authenticate if it's successful we want
to add the user to our state and then
render the page so to add it to the
state we're gonna dispatch in action
this action we're gonna have to create
auth good passing the user so let's add
that import oh good this is gonna be
from our action careers wide that next
and then we're also gonna check to see
if there's an error or if they're not
authenticated which we actually don't
need to do anything else besides just
render the page because we're assuming
they're not logged in to begin with okay
so this is set up nicely here let's go
into store before the set up our action
I misspelled store right here should be
storage this should it be an uppercase s
there yeah now let's go into our action
and create off good so oh good
and that's gonna take a user so good
user and then we're gonna add a reducer
to handle that we're not going to add
reduce so we're actually just going to
update this one so case off good we're
just gonna add the user I should've
asked you see to this state now let's
check that out so it try to authenticate
because I just logged in it had my token
and it went ahead and saved it so if i
refresh the page again oops
refresh the page again it'll be there
but if I walk out it's gone forever so
you walk back in test home fresh Oh
are we getting in there nope okay so
that is nicely set up the next thing I
want to show you guys is how to restrict
access so we're going to create a
component that actually restricts access
to different places so for example if I
only want signed-in users to add recipes
we can do that so what we're gonna do is
we can off component and we can do this
now because we actually are keeping
track of whether the user is logged in
or not so yeah okay what we're gonna be
treating is kind of like a class and a
function that returns a class and we're
just gonna like wrap different routes in
it
so like this route
need authentication this route will not
so we can just easily add authentication
where we need it and this should be
react rather so we're gonna export a
function call to require authentication
it's gonna take a component and we have
a class in here dedicated a column it
extends yeah their weekend component
okay so the first thing I want to do is
do a component will mount so basically
we just want to check for authentication
a couple places I'll do a check off and
we will do component that will mount
will receive props next props this check
off and then watch you can check off
functions
if not this props that you use your
property will redirect it's a login page
and we also want to take account what
page they're on now it's that way we can
redirect them to this page after they
log in so browser history top push and
what's back ticket
log in next is equal to a redirect after
log and we'll add the logic to make that
work in a second so basically at every
point we're just going to check if the
users logged in they're not logged in
then we redirect them because on/off
indicated page and they shouldn't be so
now we're gonna render return to do this
props that user dot has some property
we're basically just gonna check again
then we're gonna do the component
passing in the props else okay so our
authentication is set up there's just
one last thing we need to put at the
bottom here Const that state to props
and we're don't actually need to do
anything here and we're gonna return
connect app state to props authenticated
component okay very nice now we can use
this off in our index so under index
will require authentication to import
require authentication from components
OH
now whatever component we would like to
be a car authentication we just wrap it
in a function so I would like add recipe
to require authentication so all I have
to do choir authentication that's it so
now let's test that out I'm logged in
right now
can I add a recipe yeah works just fine
but let's try logging out add recipe oh
look it redirects mean along it perfect
now notice it has up here next is equal
to recipes slash add we can actually
right now if I log in test com it
actually redirects me to the home page
but what I would like that to do is
redirect me back to add recipe because I
was on that page and it was just logged
in I just need to log in first that's
what we can do is we can actually
implement this in our login page
opponent login page okay so now I'm here
it'll be right here so right here we
want to look at we're gonna pass into
our login so we're gonna actually change
our action as well as this component and
what we're gonna check in this component
is just make sure that check if there is
a next if there's not a next then we
just want to redirect them to the home
page but if there is an X then we want
to direct them to that specific page
that they wanted to so this stop drops
that location dot query next this will
get us whether there's a next if there's
not just return an empty string okay now
let's change our action the action we're
looking for is login so next
and then the last thing we need to do is
just edit our saga so it'll be right
here so we're passing in action next so
let us say action um so let's try that
now so let's log out let's try to access
that recipe page doesn't let me read
actually made a login and I wall again
and sure enough or you direct me back to
add recipe perfect that's exactly what I
want so I think that's pretty good its
be nice I like where the application has
come we're really really close to being
done there's just one last thing I want
to add is cleaning up backend a little
bit making sure we're giving good data
to it if we just send an empty object
it'll take it and I don't think the
backend should take that
so we'll fix that and then I also want
to create I want to be able to click on
my tests and just see the recipes that
I've made because theoretically there
could be several different types of
users so we'll work on that in the next
video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>