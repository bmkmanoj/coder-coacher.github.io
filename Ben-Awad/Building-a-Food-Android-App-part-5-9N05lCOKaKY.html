<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Food Android App - part 5 | Coder Coacher - Coaching Coders</title><meta content="Building a Food Android App - part 5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Food Android App - part 5</b></h2><h5 class="post__date">2016-12-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9N05lCOKaKY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys this is exciting video
because we're gonna actually put stuff
on our app so right now we just have it
plain and you know nothing's dynamic
we're not showing any pictures yet well
in this video we're gonna put some food
on here and make it look nice so let's
go straight into that so the first thing
I do is at our restaurant a class that
we made and I want to keep create a
integer to keep track of the current
picture that we're on so we're gonna
nishal eyes it in our constructor and
just set to zero and then we'll set
getters and setters for this so generate
video sitters and instead of a set we're
actually gonna do increment your pick
so if they swipe up we increment they
swipe down will decrement and this will
make more sense in a second when we
actually implement it so we decrement
here and increment the current picture
that's the only way we want to let them
basically touch this curve pick variable
so if we come back to our main activity
I also want to do the same thing so this
is our on create I want to create a an
integer I which will keep track of the
current restaurant being displayed so
first we'll just display the first one
which will be zero and then what I want
to do is we execute the code and then we
don't know when it's going to be done
this is an async call so we don't know
when to show on this screen when the
Yelp calls done and we have the
restaurant data to actually show stuff
on the screen so we want to do is create
a spinner or a loader so if we go to our
main activity and our main activity our
layout or activity layout we're gonna
create a progress bar get Matt we're
gonna wrap wrap and then we're just give
it an ID call it loading I
first brand create we're gonna make it
invisible so visibility invisible and
then we're just gonna Center in on the
screen horizontal true vertical true
okay so and then we can go back to enemy
activity and get rid of this Picasso and
our on create we don't need that anymore
so just and then also back to our
activity real quick sorry guys we're
just gonna make the text empty for both
our text views because we're gonna fill
those in okay back to our main activity
okay
now we just want to create a progress
bar mmm loading so I'm loading is equal
to progress bar find V of ID card ID
progress bar lookout loading alright so
down here we actually don't know when
this is done so we're gonna create a
function called wait wait for restaurant
we're gonna we're gonna give it a
boolean true which I'll explain how that
works in a second so we're gonna we're
gonna create a boolean up here called
waiting and basically what this is going
to do is if we're waiting and it's gonna
be false to start with so what's gonna
happen is if this is loading different
recipes or restaurants and we need a
restaurant
we're just want to sit there and wait
till this is done if it's not you know
they have a restaurant queued we just
show the restaurant this will make more
sense in a second so create our class
public
another class method we're gonna be void
wait for restaurant and basically what I
want I want to do is spot restaurant
right restaurant what I want to do is I
want to basically two things to call
wait for restaurant I would like to call
wait for restaurant from here and if
there is a restaurant I show the
restaurant if there's not a restaurant
then what I want to do is whenever fetch
pictures is done fetching pictures to
call wait restaurant and actually
display it on the screen and so this
boolean right here is gonna say whether
it's this thing right here the client
I'm gonna call it or whether it's the
server so after we add the restaurants
we're gonna call wait for restaurant and
we pass in false so both these guys are
calling wait for restaurant now if we
have two things calling wait for
restaurant we can get what's called
basically a condition or race condition
where both cloth the same time and
things can get hairy so to avoid that we
just add synchronized and then what only
one person can call wait for restaurant
at a time so the first thing we do is we
just check if it's client or not so we
do two different things whether it's
client or not so if it's a client the
first thing we're gonna check is if you
know we have enough if the size of the
if we have the data loaded or not so
we're gonna check in restaurants or
check the size or in check and I is our
current position checking if it's what
which restaurant we're on so loading
this it'll have a size of zero and I
will be zero so zero greater than zero
no so this would return false so we want
to do is check if it's available if it's
false
basically we wait and if we're waiting
so if
or if this is this is true if we don't
wait so else so if the restaurant size
is greater than I that means we have the
data so have data if we have the data
that's perfect we're just gonna create a
new function so called restaurant
callback to the public void restaurant
callback and this is basically a
function that we will call when we have
the data and it'll handle how we display
the current restaurant okay so a
restaurant callback if we don't have
data we want to wait we say waiting is
equal to true and that's it that's all
our client does and then once we're
waiting we want to show the loading set
visibility:visible so we what we do is
we check if we have data if we have data
we display the picture on the screen if
we don't we wait and we set the
visibility of the progress bar so the
progress bar starts now as the server
we're going to check if waiting then we
do restaurant callback because we now
have the data and we set waiting to
false is equal to false and we do am
loading dot set visibility is invisible
because we're done loading we're done
loading now um and then we don't care if
it's if we're not waiting the server
doesn't do anything we're not waiting on
data so the server doesn't matter okay
so that should be working nicely the
only other thing I want to check is
there's two conditions we need to make
sure we have the restaurant size and
restaurants dot pictures and restaurants
I get I get pictures so this is the
pictures dot size same thing is greater
than M restaurants that get I like get
current pic so this is checking the
current restaurant we know the current
restaurant is loaded we want to make
sure the current picture in that
restaurant is also loaded and that's the
same logic and we can put this on our
line a little easier to see okay next
thing we want to implement is our
restaurant callback so we're going to
just call we're gonna create our
function called display restaurant and
all we do is we pass in a restaurant in
restaurants that get I display a shot
public void takes a restaurant as
parameter okay
now how are you going to display the
restaurant so first thing we want to do
we want to update that we're going to
update that we're gonna update that so
we're gonna say leave it as M title yep
in restaurant title dot set text so say
our dot get name and M rate cat set text
our dot get rate and then also we're
gonna do Picasso dot with I see in this
dot load this load it's not load lookup
across a real quick Picasso Android
think it's loading maybe loading no just
wait its load and you pass in the URL
which is get so the picture that this is
the picture that we want to load so our
dot get pictures dot get in our dot get
current pic and then the next thing is
what image view so dot into a main image
okey-dokey
so this should be working now I'm just
gonna restart the emulator have it run
the code and see what happens
so if everything runs correctly we
should first see a little spinner that
starts loading the as it makes a Yelp
API call in the background so right here
makes a Yelp call in the background and
then we wait for that Yelp call to
finish when it's finished we in our on
progress update we call wait for
restaurant and that goes right here says
I call back
and that callback will then update that
and we turn the waiting off and we
should see on our screen the picture but
you bless me alright so well a great ol
finish building there and we'll watch
our app load up there the next thing we
want to set up in our next video is
swiping so this is just an error message
that's fine let's watch it so first we
get this little loading bar very nice up
and looks likely crash so let's just
take a look at what we're getting so we
get an invalid index size is 0 so it
looks like we just forgot to add to our
restaurant yep
so right here we created this
restaurants list but we just forgot to
add it so this is in the fetch pictures
async task we're going to do restaurants
dot add and we just need to add that new
restaurant that we're creating in this
for loop so let's rerun our application
so what I just forgot to do was add it
to the ArrayList so when we wrote down
here looking for it
it was then gone okay so let's okay
alright so the Yelp calls currently
happening we're loading up did we crush
again so what else is going on huh
that's weird doesn't look like anything
crashed I don't know why I just stopped
I'm just going to rerun it oops let's
see if it crashes that's very odd
okay looks like it's running we're
loading let's see it okay Yelp call
didn't go through again method call
should happen for main thread okay so
this is not happening in the main thread
should be this is what I was talking
about how you can only touch this stuff
so what's happening is we tried to
update the screen not in the main thread
so we're doing something in the async
task we shouldn't be so fetch pictures
fetch pictures should be calling on
progress update an on progress update
should be calling wait for a restaurant
and that should be going through yep so
it's coming from there just came from
okay so I directly called on progress
update that's a mistake
you call a different one it's a believe
it's published publish progress okay so
the air I was making is that was
directly calling this you know let's
build this wall I tell you what I did
wrong so what I did wrong was I was
calling this method directly but to run
on the main thread you have to call
publish progress and the async task
instead so okay let's watch it now we're
loading up a spinner
alright cool we see the burghers doesn't
look like it likes that so let's see if
we made a mistake there nothing in the
output so what I want to do next to
check it is we're just gonna print out
right here are
get pictures dot get our dot get current
picture so I think what's happening is
just a will reload this I think what's
happening is just a simple error on my
part when we're doing this thing right
here I think this might need to be an
and and that's messing things up so
we'll look at that when this thing loads
all right loaded correctly so I'm just
doing here's I'm looking at the current
picture and making sure the picture is a
legitimate link-up and looks like that's
my problem it's not a legit link I put a
zero instead of a OH
so if we go to restaurant they're not
restaurant this is in my restaurant
parser so right here and get original
restaurant parser this should be as oh
not as zero ok or you run that so as you
can see it's very easy to make little
mistakes it's important to debug your
code just going through running it and
making sure everything is running
properly all right so we're making the
Yelp call it's loading it our server
came back to us we got this dinosaurs
restaurant and it's giving us the
sandwich
very cool Vietnamese sandwiches down
here so we're actually showing a
restaurant now very cool that's looking
very nice in the next video I want to
show you guys either how to get the
coordinates or will be doing swiping
left right and getting new images for
our pictures so thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>