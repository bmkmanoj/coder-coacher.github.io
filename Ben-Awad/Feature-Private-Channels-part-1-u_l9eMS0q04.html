<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Feature: Private Channels part 1 | Coder Coacher - Coaching Coders</title><meta content="Feature: Private Channels part 1 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Feature: Private Channels part 1</b></h2><h5 class="post__date">2017-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/u_l9eMS0q04" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be adding private
channels now we're gonna be getting to
read descriptions after this and then a
few things and then we're gonna wrap
this up with docker and deploying but
how are we gonna add private channels
well the first step in doing this is
adding stuff to our form for creating a
channel first thing we need is a little
checkbox or something here that tells us
hey we want this channel to be private
so we're gonna come on over here to
semantic UI and grab the checkbox
component right here so grab that and
we're just going to have this to our add
Channel modal here so we're gonna create
a new form field and paste it in there
give it a save and our label here is
gonna be whether it's private and
private and we're also gonna come up
here and import it so check box and we
need to grab its value so value here
we're gonna be storing it as public
because we have schema we're storing it
as public so it matches up so I'm going
to just do values dot public so values
where is this coming from we're using
formic for this so it stores the values
and a prop called values and down here
we can say public is true so by default
this is gonna be the check box is going
to be false because public is true and
we're nodding it and then here we're
just going to say on change now we can't
just hand pass in the handle change here
because check box for whatever reason
there on change you have to get the data
parameter which handle change doesn't
know about so the way we have to use do
this is called the set field value
function from formic and it's made for
when on change is not standard where you
just have a so the data here and this
data has a check in it which is what we
want and here we're just going to set
the value of public so set field value
here you specify the name of the field
so for us it's public and then what you
want the value set to we would just pass
in check but really we want the opposite
of checked and just passing it that
looks good now let's check this out and
make sure it works
so private check it on and off perfect
now if we do make it private we want to
add members to this private Channel
the way we're going to do this is kind
of like how our direct messages where I
can see all the users of the channel so
the way we're doing that if we come on
over to our direct message modal and
that is right here so we're doing a
graph QL query we scroll down to the
bottom we can see the Skip members query
we want to run the same query and I want
to create a new component called multi
select users so this component is
similar to this one except we can select
multiple team members because you can
make a channel with tons of team members
if you want to now because this query I
want to use in both of them I'm going to
move it to our team graph QL over here
this is we're restoring basically common
graph QL queries and so I'm just gonna
move it over here that way they can both
access it and we don't duplicate code
and so I'm gonna just delete it from
here and import it up here and because
we're not you defining the query here we
don't need to QL and here I'm just gonna
import
team get team's query from up a file and
then graph
ql / team now i'm gonna copy this
because we're also gonna use this in our
multi select over here and we're gonna
import react from react so i didn't talk
about what we're gonna be what the
component actually is for this multi
select so there's a really nice one by
semantic UI
we're right here i can scroll down
select them but i can also search so
missouri and add it so this is a
component we're gonna be grabbing so
give this a copy and we're going to do a
const multi select users and this is
going to be a graph QL component or
we're gonna be passing this query in and
so we're gonna have data and loading so
they're gonna floating and we're gonna
get team member just need to verify get
team members yeah get team members and
we don't want to load anything if the
query is still loading so i'm gonna say
if loading is true we're going to show
null and wait for it to load now we need
to pass in a couple more props to this
so there is if we look at this we're
gonna handle the on change and the on
change function for this same as the
other one where it's a little bit weird
where is it on change we have to use
this data parameter they have pass in a
second one and then we also need to pass
in our options which look like this so
we're gonna create this state options
based on the users that we grabbed from
our query but here we should pass in the
value and the of the state options but
the handle change
so here we're just going to paste in our
drop-down so placeholder that can be a
parameter that we pass into or I prop I
mean placeholder so delete that
placeholder and then our options here
we're gonna create those in a second I'm
just gonna first say values equal value
and on change is equal to a handle will
change
okay give this is safe so drop down we
need to import import drop down and this
is coming from semantic UI react and we
also see import graph QL because we need
to pass in this component or do you use
the higher component for this and this
state options here so if you guys saw it
looks like so so for us we want the text
to be the user name of the user and our
value and key are going to be the ID for
that user so we're just gonna say get
team members oops
team members stop map and we're gonna
say team member and the way we're gonna
do this is the key is going to be equal
to team member to ID and so is the value
and then the text is gonna be team
member username all right so now we're
just going to export default our
component passing in the graph QL query
that we want to get run so team members
and then multi-select
cool so now I'm gonna come over here to
my ad channel modal and actually use
that component we created and I'm gonna
do this
underneath the check box and we're gonna
put this right here and I'm gonna import
import it here import multi select users
from multi select users and we'll render
it here now I just want to make sure
that users are rendering okay so we're
gonna just run it without passing in a
handle change value or placeholder I
guess we can pass that a placeholder
placeholder select members to invite and
let's just make sure we see the other
team members pop up here so channels and
we crashed so let's see it's expecting a
variable team ID oh okay so our query
over here we did not pass in a team ID
so let's do that so multi select users
so we're gonna say options and this is
gonna be our props and from the props
we're gonna grab a team ID and we're
gonna pass it and so will say variables
variables is equal to t mighty so what
I'm doing here oops that should be a
capital I so I'm doing here is grabbing
the team ID from the props that we pass
this component so we need to pass this
in now and setting that variable for our
query so now over here we need to pass
in the team ready team ID team ID and I
don't think we're getting this component
or this team ID being passed in so
that's something we need to do so the ad
channel modal so wherever we're using
that which I believe is just in channels
I don't know where we're using at
channel modal let's search for it so I'm
gonna look for source add channel global
so we're using it in the sidebar over
here so perfect we are passing in the
team ID to the add channel modal so
we're good we have that prop so let's
see if it works now cool and I do see
the members perfect and I can filter by
them but now it's gonna crash if I click
on one oh no it doesn't because it's
already controlled perfect I mean it's
cool that we would see it working but of
course it doesn't work because of
invalid prop value supplied value must
be an array when multiple is set I'm not
sure why it doesn't like the invalid
prop value supplied to checkbox so I
guess you don't set the value you say
checked weight checkbox takes a string
or a number for the value it doesn't do
a boolean that doesn't make any sense
this toggle is actually kind of nice can
that okay we just say the word toggle on
it I wonder if I can still add I like to
look at the toggle and I think that's
how slack originally does it we need to
fix our problems though so it's gonna be
and channel that's gonna be over here so
real quick I want to see if this toggle
looks nice and we still get to keep the
label if we get to keep the label I
think I'm gonna keep the toggle nice
that looks cool so I think by default
it's toggled on and they say public and
you can toggle it off so I can say pry
it you know what this is looks fine and
I say private all so what I want to do
is this cool little thing where we don't
have to select users unless it's public
so I'm gonna wrap this with a
conditional and say values that public
show null only show the multi select
form when we're not public so when were
private basically so you don't see it I
make it private now I can invite people
so sweet but not sure why it doesn't
like the value that we're passing in
here it's complaining but it's working
so I'm not gonna I'm just gonna ignore
this warning if you guys know why we're
getting this warning I'd love to know I
mean I guess I understand it cuz it's
expecting a number and a string but I
don't know what number I would supply to
a checkbox 1 &amp;amp; 0 maybe weird
okay let's fix this thingy - so I want
to make this controlled so I can keep
the values in our state here so it's in
our values so when we submit I can use
those to submit to our server so I'm
going to pass in the value is gonna be
equal to values dot I guess people what
we're going to call this field I'll call
it
members I suppose and we'll just default
it to an empty array so we'll say
members their values members and then on
change so remember over this should be
handled change so remember for this this
has a data prop so E and then data and
this data a parameter has something
called value which is exactly what we
want and we're just gonna call set field
value are members and now we'll set the
value so refresh this so as I click this
now I'm holding the state so I'll make
it private oh you know what because no
public true I thought for a second maybe
we were passing undefined when we first
rendered this but we're not and we're
even nodding it yeah I don't know
okay so values thought members oh yeah
so let's make sure so we're now we
should be storing the state of this so
react and if I just search here at team
modal or add channel modal I can see my
values so initially we have an empty
array of members I invite Bob so we now
have a user ID of one and we also have
three and we have four so we have these
three members that we are adding to our
channel perfect so this is actually what
I want to submit to the server now and
we can make it private public and I just
created a channel on accident and it's a
blank Channel now oh well so we need to
make or we need to fix our create
channel to now support a members array
that we pass in so and we also need to
support handling whether it's public or
private so let's do that so first I'm
gonna edit the scheme over here and our
back-end so I'm gonna come over here to
channel
and our create channel okay so we can
pass in public already so here we're
also gonna pass in members which is an
array events and you don't have to have
members so we'll keep it like so so now
in our front-end we can change this
right here I can pass in public as
public and this is going to be a
variable we pass in and also we'll pass
in our members members and then the
types of these so public is a boolean
and it can be null and then members oops
dollar sign that it's gonna be an
interest need to handle this on the
server side in our resolver so resolver
message my message Channel so I think
right now what we're just creating yep
we're just creating the channel so first
we're checking if they're an admin to be
able to make the channels perfect and
then they just we just create the
channel here so now we kind of need to
do an if statement here and we're gonna
say that's fine to create the channel
like so well you know what we need to
create this in a transaction cuz we need
to say if args dot public so if it's not
public and we're creating a private
channel then what we need to do is
create basically a table to know who we
invited to our team kind of like how we
have a member table which is all
diseases association between teams so
our team over here and our users so
we're gonna do the same thing with our
Channel
so here channel member we need to create
another table for private channel so
we'll create a new model here we'll say
PC member maybe for private channel
member this might be just a terrible
name we'll copy this and you know what
actually we don't even have to create
this table because we don't need any
fields actually yes we do I was gonna
say we don't need to create this field
or this table but we do need to because
we want to access it and create stuff
with it or what I mean is over here
where you want to do models dot PC
member so private channel member adopt
bulk create and then pass an array of
all the members that we're creating here
all right so to be able to do that we
need to have a PC model a physical model
that we actually do through for and
sorry we need to grab number copy this
again paste it in so this is gonna be
called PC member and I'm just gonna
lowercase it here PC member and we not
gonna have any fields so we don't have
to worry about that and then in our
channel on our channel and our user
model we're gonna copy this exact thing
except now we're gonna say models dot PC
member and keeping user ID is fine so
then in our channel just like this for
restoring the
the user here or we're making a
connection to the user we're gonna do
the same thing but this one is going to
be through our PC member so perfect and
now I can come over here and actually do
this so now it's expecting a channel ID
and a user ID as parameters bulk create
of course just creates multiple at once
so now I can do a argh stock member
members dot map so a member and my
members here so the user ID user ID
there's gonna be the value of M right
because M is just a list of user IDs and
then the channel ID here is just gonna
be the channel ID passed in with our
argh so argh stock channel ID that looks
good and now by default we really should
also add the person who creates the
channel to the member list so
we'll say argh stop members and first we
should really filter well so they could
have added their themselves to the
members list already so we should check
and make sure they're not or we should
filter them out dot filter will say
Const members is equal to M where m is
not equal to user to ID so here we're
gonna filter out the user ID of the
current user to make sure it's not in
members and then we're gonna say members
dot push to add it on and then here
we're gonna say members dot map to
create this now I want to wrap this all
in a transaction and I don't know why I
put our X dot channel ID
we're not grabbing a channel and we're
not passing in our arguments the channel
ID is gonna be whichever thing we just
created so that's gonna be channel and I
think we have to do dot data values die
ID which is annoying and then here I'm
just gonna wrap this in transaction so
models about sequel eyes dot transaction
is that how we did transactions before
let's double check get models that
sequel eyes that transaction will say
concert response and we're gonna wait
this response to that
and here's our transaction and we'll put
this in here and we're gonna make this
asynchronous and then we're gonna pass
in our transaction to both our Creed's
and that's our mapping transaction and
so our response here it's actually just
gonna be our channel so we can say
channel is response and the reason that
is is because we're gonna return it so
return return channel so this looks
pretty good
now we're gonna have to drop the
database and I'm gonna have to to test
this I'm have to drop the database to
recreate this Association this piece
even really create this new table well
maybe I don't because oh oh also we need
to grab it here since this is a totally
new table it actually might add it
already for me so let's just see if it
does work so come into peace equal
connect to slack select all from PC
members and it does look like it created
it okay so maybe I don't even have to
drop the database let's try creating
adding a user now we're creating a
channel I mean so my private channel and
we're gonna say private and I'm only
gonna invite Bob and you know you know
invite Bob to too so create my channel
and we have some areas let's see what
we're doing wrong so here is my server I
assume is something wrong there really
nothing wrong with our server
I mean I see an Arab edges that looks
like just because I was making changes
so it's only on the front end it says
response not successful if I come to the
network tab we're gonna see members of
type int used in position expecting type
ah so I just wrapped a debating sign so
coming that's gonna be where my team
know that's gonna be over here and add
channel modal yeah this should just be
an exclamation point so that's the thing
with graph QL it checks the types to
make sure they match up so let's run
this again so my private channel and
we're by Bob and Bob to say create
channel looks like it got created okay I
don't see it over here which is kind of
weird cuz I believe we are pushing it
yep see how we wrote we're pushing this
I'm guessing it was not okay okay is
false so we did get an air oops
all right we can check her see yep it he
didn't get added so what went wrong
cannot read property filter up undefined
so that's gonna be our resolver so I did
something silly I am an encourage Hannah
lot to good arguments members did I call
it something else this is gonna be what
channel now if I call it members which
is an array this is quite odd
why would members be understand console
dot log args so we can see what the
arguments is I'm assuming members is it
I mean apparently it is and probably pad
getting in as null we can set a default
value though and our schema so channel I
can set that oops equal to an empty
array I believe like that just in case
and I should be sending though and we
can see in our network tab here's this
what we sent to this server so requests
and up is just options here's the
request and yep sure enough we didn't
send our members variables so that's a
problem in the front end not the back
end so I had a channel over here for
whatever reason so we called it members
that looks good and our submit handle
submit variables well I'm just not even
passing them look at that
alright so public is gonna be values dot
public and then members is gonna be
values dot members oops
okay now let's try this one more time
all right my private channel to inviting
Bob one and Bob to create the channel
and let's see so our post request
response okay's false again
and we can check maybe it's our server
insert or update on PC violates
constraint answer okay so I'm guessing
basically someone's oh values undefined
oh ho that's just because our data
values is the problem all right so we
can close this and now we just need to
we don't need to do that the args we're
now gonna print channel instead of doing
data values I'm just gonna try the ID
this is something I'm always confused
about with sequel eyes when they have to
use dot data values and when I don't I
thought I would have to use happy use in
there so let's try requesting this again
and nice it saved our form so I don't
have to retype it out all right so so I
roll back here's our thing so I see dot
data values here and I would have to do
ID
and I'm just gonna say can't PC members
is equal to our map so I can just see
what the values of this is and I'm gonna
say console.log PC members and then here
I'm gonna say PC members and I actually
do think it's dot data values is what I
have to use dot data values there's a
data value because there's only one no I
think it was data values
yeah data values okay
save that did I forget something
there we go and we can just pop this up
create a failed to fetch that's because
this was still Rio nope I just have a
syntax error over here we need an extra
parenthesis try this again
and we need to reset this form when
we're done with it so channel name you
know what we'll just do whatever for now
my oops I clicked out of it too fast
there we go
create channel okay so our user ID okay
so for whatever reason this time it
worked it committed everything looks
good so I guess it didn't like that I
was mapping inside the bulk create
function for some reason that's super
odd because we were using data values
before so I see my private channel here
so this is my private channel we're not
locking down this private channel yet so
that's what we doing the next video
let's make sure cool I see the three
members myself and the two others that I
invited to my channel so next what I'm
going to be doing is locking down this
channel making sure no one else can
access it and then after that we're
actually gonna convert our direct
message is to private channels because
really that's what direct messages are
it's a private chat between people so
we're gonna refactor that code which
will be some nice code reuse so we don't
we only have one function for direct
messages and this so that's it for this
video guys thanks for watching and I'll
push this code up to github
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>