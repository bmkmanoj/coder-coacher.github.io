<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Jest Global Setup - Part 10 | Coder Coacher - Coaching Coders</title><meta content="Jest Global Setup - Part 10 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Jest Global Setup - Part 10</b></h2><h5 class="post__date">2018-05-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7XUFVQh6XAQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so I wanted to write a test for
the function we made in the last video
and the way I wanted to do it was to
create kind of a file here called creat
confirm email link dot spec typescript
and then test it and make sure it works
and in doing this I was like hey it
would be nice to have the server started
up so I can also check and make sure the
link works so then I was like all right
ideally I don't want to run a start
server every time I run a test I want to
run this for before all my tests so
globally so there is a way to do this
with jest and that's what we're gonna
get to work today so we're actually not
going to be testing the email link but
we're gonna be setting things up so we
can test it in the future and write
tests for pretty much everything and how
the server start up only once per each
test so let's go ahead and get started
with this so to help us out with this we
had to do a global setup and so this is
something that runs once before Jes
starts and here's how it's gonna work so
here is an example that just has with
puppeteer and the first thing is an our
config for gest we are gonna set up a
global setup and this is basically a
file that gets run before everything
else
so our just config is in package JSON so
right here and I'm just gonna say global
setup and I'm gonna have to create a
file here now you'll notice an example
they had over there they have a setup
j/s now for us we're using typescript so
I was like all right let's see if dot ts
works and it did not work and I found
actually an issue here where they talked
about it to be able to work with the
global set up with transforming cuz
people use typescript and it doesn't
look like they have quite a change yet
here's a dude talking 11 days ago about
it but luckily there is a workaround we
can use
right now so we're gonna create a file
that basically calls our typescript file
so we're gonna use this code right here
so before I do that I do want to create
kind of our a folder for this I'm gonna
create a folder called test setup and I
don't know with folder names is if it's
bad to do camel case like that but we'll
leave it for now and then I'm going to
create set up dot TS so in here what I
want to do is pretty much just copy the
register test at least this beginning
part here and we're gonna just put it
over here and we're going to grab that
and just import it so then in our
register over here we will not need any
of this and we'll come back and fix the
errors
okay so now that we have this set up
what's going to happen is we're gonna
copy this code here and I'll explain how
this works in just a second and we'll
say call set up a s so this is going to
be a JavaScript file so here I guess
we're registering TS node and I guess
that's what calls the typescript file
and then here is our module that we want
to import
so then module on import is set up and
this will be set up so really we want to
and I'm just going to
expand this or D structure so in setup
over here instead of before all
Renaissance setup is equal to this async
function and we're an exporter so now
we're gonna export this function here
and instead of setting get host what I'm
going to do is set this as an
environment variable so process that M
and dot test host so we don't need get
host anymore I don't have to change in
our other test I was using a function
but a string is just fine and the reason
why I'm doing processed and if not test
host is this is gonna run and this is
gonna be a global thing that we can
access and our test and that's what
we're gonna do so then in call setup or
importing that function and again this
function didn't really change we just
stir up the server grab the address and
set the test host that people can access
it from and then call set up over here
we have that and then we're just gonna
call that function oops
so call set up and that's it
so in our package of JSON we now call we
point it to the JavaScript file so
source dot slash source slash test setup
slash call set up a james so now that
function will run before all our tests
before if you just say before all on
this test right here it would only run
before all the tests here if I create
another file with tests in it and does
not affect it at all so each test file
is kind of isolated by creating this
this is gonna run before everything
which is important and I'm gonna just
find in replace right now so right now
we have a get host and we want to
replace it with and we want quotation or
parentheses around this so a very
Cicotte host we want to do process dot
dot test toast and I'm also going to say
as string and replace all these and the
reason why I do as string and just to
show you guys the air when using process
that if things can be undefined so I
know and I trust that I have this set so
trust it I just say as string and we're
good and now there's no more errors or
anything in this file we can go and run
the test and you're gonna see it we're
gonna get a few errors and I'll show you
guys how we can solve each one of those
so I think the first one is just has
trouble yes it just has trouble
compiling and it says link is declared
but value is never read and if we take a
look here's the call stack so source
modules register resolver TS so register
resolver and we can see this is on line
66 so I can go to line 66 and we can see
hey look our link has never read so I
can get rid of that and refresh and now
test again and it's gonna actually
should now actually run the tests but
one test will not pass and we'll see
that and it should be the duplicate one
cool so one past three there sorry three
past one failed so the one that failed
was check for duplicate emails pretty
weird right so let's see what's going on
there
and the reason for this is you'll notice
with this test we're doing one thing
different and that is actually accessing
the database directly let's see right
here I'm accessing the database directly
below here I am not accessing it
directly at all and that's why that one
fails and the reason for it is we're not
making a connection in this page anymore
and we can fix this by just saying for
all
and we had a function I'm gonna say
async and I'm gonna say oh wait
create type warm connection so now we're
gonna create a connection before all
these tests and it'll go ahead and work
now we could just create the connection
for this one since that's the only test
that needs it but I think this is fine
in case we add tests that need it so now
if I do yarn tests we'll go ahead and
all the tests will pass so perfect and
now this sets us up for being able to do
tests anywhere and be able to use that
same server so in the next video we'll
go ahead and test our new function that
we made
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>