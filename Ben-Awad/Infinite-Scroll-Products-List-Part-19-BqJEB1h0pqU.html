<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Infinite Scroll Products List - Part 19 | Coder Coacher - Coaching Coders</title><meta content="Infinite Scroll Products List - Part 19 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Infinite Scroll Products List - Part 19</b></h2><h5 class="post__date">2018-02-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BqJEB1h0pqU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be adding infinite
scrolling to our products list this is a
good idea because as we get more and
more products it's gonna be hard to load
them all at the same time which is what
we're currently doing because it's just
gonna take longer to load and it's not a
great user experience so instead of
looking all at once we're gonna chunk it
so we're gonna load like maybe 10 values
at once keep scrolling load more as we
aren't loading and this problem is
really split up into two things first
recognizing when we reach the bottom of
the list and then the second is actually
fetching more items and updating the
flat list so the first problem is
actually super easy because flat list
has a property for us called on and
reach and this is just a function you
can pass and we can just say console dot
log hey guys and this will be it printed
will reach the bottom of the list now
when I was doing this I noticed we had a
little bit of a styling issue
notice how we can't see the bottom item
in this list so notice how the scroll
bars at the bottom but if I scroll a
little bit more I could see Werner down
there but it doesn't let me get to him
and the reason for that is this outer
view is not flexing so I'm going to just
create a quick style for him Styles dot
outer container and we're gonna just add
it here so outer container and I'm going
to say display flex
and then flex one okay so now I see hey
guys and if I scroll down and nothing
happens right so it printed out twice
and it didn't even print out when I
reach the bottom of the list what's
going on there right why isn't this
working like you think it is well
there's another property called on and
reach threshold and this is where you
can set how close you have to be to the
bottom to actually trigger it so I'm
going to say you have to be exactly at
the bottom you have to be able to see it
zero pixels away from the bottom now for
whatever reason it does display this
first one I don't know why it does that
maybe I think I once tried wrapping it
like this and that seemed to help it but
we might just have to set a little flag
but notice as I scroll I hit the bottom
it says hey guys again so not sure why
it gets triggered the first time but at
least we can get it to trigger
afterwards which is important and we can
set a little flag to make sure we don't
trigger on the first one if it that
keeps happening
so we now can detect the bottom another
nice feature that a lot of applications
have is like a little loading indicator
when you reach the bottom and again this
is very easy with flat lists there's a
function called list footer component
now here we could put whatever we want I
could put a text that says loading I
could put a little graphic but what
that'll do is it'll display it at the
bottom so let's see if you guys can see
that see how it says loading down there
and we would fetch more items and then
push it down and you wouldn't see that
when it's finished now there's actually
a better component to use for this it's
called activity indicator so this is
something coming from react native and
we can actually just copy pick the color
you like pick the size I guess we'll
just do small
and paste him in so let's go ahead and
import this from react native so
activity in here so now at the bottom
we're gonna have that little scroll and
I guess that looks really small let's
make him large alright nice that looks
better so now when we reach the bottom
so I talked about the flag right how am
I gonna do this flag thing to make sure
this function doesn't get called twice
well I'm just gonna say if this thought
called once then do stuff
otherwise this stock called once is
equal to true so now hey guys should
hopefully be printed once so notice this
is the new console.log we don't see it
reach the bottom it says hey guys so now
we only trigger hey guys when we reach
the bottom of the list so perfect so now
we want to display more items so we want
to use and I have this running and npm
run dev so i can connect to the database
there's this really nice thing called
products connection and we can run it
and this is what it looks like so what
is this product connection thing so it
is right here and you pass it the same
things that you would pass if you're
trying to fetch products but the only
difference is this has some helpful
things for pagination now the ones we'll
be using we don't care about previous
and start cursor but we care about this
has next page an end cursor so when I
run this what's gonna happen is it's
gonna tell give me this string which is
the ID of the item of the cursor and
this is how we're going to use this to
fetch more
items and it even tells me if I have
more items in the list so those are the
two attributes that are added on now
edges is how we access our products so
notice how with our products up here is
the exact same but it actually just
returns products the product connection
gives us this product connection thing
back and so it has page info which is
these two things I was talking about
which we're gonna be using for
pagination to check if we need to fetch
more or if we reach the very end and
incur sir this is we're going to use to
fetch more items we'll talk about more
of that later
and then edges is actually where our
products are so edges and then node and
then that's a product so that's how we
access that okay so what I'm gonna do is
set this up in the backend so we can
have products connections being called
and then I'm gonna get it working on the
front end and just convert the stuff
over so let's add this to the back in
first and similar to how we did it here
where we just add a query and oops
yeah so cool little trick someone showed
me is you can actually just say query
dot and in the name of the query you'd
like to import so for us the query is
products connection now I don't know if
you can see how I had to do I added it
like this
now I can just import it because it's
already made for me on the database now
I don't know if that'll let me override
it over here so we're gonna have to see
but now I can do products connection
and here I'm checking to make sure the
user is logged in and then I'm
forwarding to the database so now my
front-end in products I am just going to
say and let's console dot log the
products that we get so instead of doing
products on the safe products connection
and because I'm doing products
connection I don't just get these guys
right here all right I have to go to
something like this so I'm going to copy
this over and let's make it pretty so
this is how it works right I have to
access my products through the node I
can't just get an outer layer so we're
gonna copy this and paste it and over
here so delete that and you guys save
and see what we get back now I'm
expecting this to crash right now
because we don't expect to have edges
and nodes and stuff but hopefully we
should be able to see the request and
I'll - it happened I'm guessing we
crashed on the server doesn't I don't
see any errors but also this is white so
I don't know what happened well let's
try to just refreshing again nothing
happened my guess was I wasn't sure if
we're able to actually have products
connection here I want to see if this is
being called so I'm going to say hello
and now I'm gonna pop over here to my
server refresh this and see if this does
indeed get called and it spits out all
these things it looks like it's working
from the database side so that's really
cool to see I'm guessing that my query
is just wrong
I'm guessing it doesn't like this so
what I'm gonna do is I'm gonna copy this
query and oops
and post it over here and make sure this
is set up good and I'm gonna pop over
here to my regular database so we have
products connection there make this
pretty and let's just see alright we get
not authorised that's fine but it didn't
crash so it looks like the correct
syntax I kind of want to get a header I
don't know if this is the right token
all right so let's get Google a mutation
I'm going to log in as I think I have a
guy named Q Q is the password and I want
to get the payload which is a token so
now I'm gonna just use that to run this
query so let's copy this and get that
out of my way and now we can actually
run this and see what there's
something's wrong with art what's wrong
with our client or our back-end so bear
paste run alright so it looks like we
get everything back that we would expect
to get back and I know exactly what's
happening now I'm just a noob it just
hit me huh I think this
I think it's just returning null is
what's happening because it wasn't
crashing or anything cool so it's just
undefined because this should be
products connection now so products
connection connection so now we can put
this below here I think it's gonna crash
because we're not using products below
all right now we're getting it perfect
all right so to get this rendering now
what I need to do is in my flat list all
right so we're doing products right so
this should be product connection and if
we look over here we have to access
edges which is going to be our array so
dot edges and then we're going to map
through the edges and for each edge I
guess it's gonna be called a node so for
each edge we're gonna have just this and
it's gonna have a node so I'm gonna go X
dot node so X dot node oops
and we're gonna say X dot node dot
seller and I think cool so now we fixed
it and we're rendering the exact same
but now we have that extra thing that I
wanted so now up here I can say console
dot log product connection dot and what
was the name of it page info
so now I can use this has next page and
this end cursor to get information about
this so it does not have a next page so
that's weird
I think you have to say we have to add
some more parameters to this so here
where you need to order by things and
we're actually gonna order on our
default query by created app and I'm
also gonna say first
so first so after we get like maybe five
items right or actually that doesn't
have any regards I was gonna say once
you get five items do you want to get
the next five items but that's not how
we're doing it we're actually using a
cursor which means we're grabbing the
exact after a certain item so let's say
this is the end of our list p3 we say
grab all the items after p3 first is
gonna tell us and we don't actually have
to put that here we can put it here
first is gonna say how many items we
want to fetch so this could also be
called limit so I'm gonna say five items
please so now I believe let's give out a
save and let rerun page info should tell
us we have another page cool so has next
page is true so that's how we know
whether and in our loading indicator we
should only show that if we have more
pages and we're and we are loading okay
so in cursor is what we use so there's
also going to be this thing called after
after and I believe it's a string let's
double check so we would find that in
our schema procs connection after it is
a string and then we just pass after in
here so how does after work well how do
you know where you know how what items
to fetch what we're gonna tell the
database is we're gonna order it by
created at so if we look at here we can
say order by one of the fields the order
by is created at ascending so let's grab
that and now we're gonna add this to our
options
so options variables and this is going
to be order by so by default I would
like to order this by the the date these
were created so now when I get my first
five items right I would like to fetch
the next five items and I'm gonna tell
the database to fetch the next five
items after a sure so I need a pass and
asher's ID so it can get the ones after
that and after's ID is gonna be the end
cursor alright so I think we have this
all set up good now
after it's gonna be null at first and
we're gonna just refetch they're not
refetch there's a handy thing from
apollo that says fetch more so this is
different that's more specifically for
pagination and how much more it works as
you change your variable and then you
update the query and this updates the
items and your that you get back so for
us we're gonna do it here so we're gonna
say fetch more
and this is something we get from right
here fetch more and we have variables so
the variable that's gonna change is
after right because now we need to tell
it what we want to get and the one we do
after is from this guy products page
info so box connection page info dot in
the cursor yep that was the name of it
the other thing is we have to tell it oh
and it looks like that should not be a
comma the other thing is we have to tell
it how to integrate with the rest of our
items with this update query and I'm
gonna console.log this so we can see
what this looks like but previous result
is gonna be what we had before it's
gonna be this thing right here this
monstrous object with all our products
and things and then fetch more result is
gonna be just what's gonna be the return
of our fetch more okay and we can say
previous results and after that we can
also do fetch more if you want to now
for us we don't need to do object out of
sign and I am actually just gonna get
rid of that because we don't need to
worry about it
okay so how I'm gonna do it is we have
two things right so we have this object
it actually helps I think if we look at
this so we have page info and edges so
the thing we need to update is this
edges and the page info so page info can
come directly and I can do dot previous
result and I don't know if there's going
to be data around this there might be a
dot data I have to
on it we'll see let's look over here do
they do dot data they don't so I think
we're good so I'm gonna keep the
previous result and then from fetch more
I'm gonna just set the page info equal
to fetch more result dot page info and
then we're also gonna have edges and how
the edges work that we're going to keep
the edges we had before so previous
result by edges and then we're going to
add the new edges we dispatch dot dot
fetch more result dot edges and give
that save reload and let's see what the
heck is going on now and okay just need
it's dangling comma so I have my console
open so you can see if there's any
problems needs an array got null so
let's take a look at what we got back
cuz we did not do it correctly so we get
edges which is an array that's good and
we should have from our fetch more edges
as well oh so I'm gonna just do a
separator cuz it's hard to see where
these are different so from one of these
items we're missing what we need because
we got requires an array like and I did
dot dot dot on it so I assumed something
so I'm just gonna rerun that and see
what we messed up on ok so it looks like
we got a function so fetch more result
is a function
I oh I was console longing console
logging the wrong thing I was so
confused why we got a function right
here so get the bottom result we lag out
so alright so this object oh it's called
products connection all right so we're
gonna keep the previous results and then
we're gonna say products connection and
I guess we want to keep the type name
for projects connection so underscore
underscore type name Apollo gets mad if
you don't have an exact same format so
let's copy that so we added our type
name and I don't think we need to even
do that so this needs to be products
connection and this needs to be products
connection to product connection oops
and there actually might be something
that array does this for us because this
is a relay style oops
products and let's take a look at that
oh it actually loaded more items it
actually worked and then looks like it
crashes after that which is fine so here
you want to just say this dot called
once and we're gonna say page info
products connection page info dot next
page I think was the name has next page
so we don't want to fetch more items if
they don't have a next page and I'm just
gonna format this guy get rid of the
constant logs
all right so scroll to B load them and
that's because I did the wrong thing I
need a not in front of it so if it does
not have a next page we don't want to
look all right and that didn't work
either
has next info has next page right yep I
don't know how that changed in between
the two but okay oh okay
it's I don't put a not sign I'm sorry I
just messed that up really bad so if we
do have a next page we want to fetch
more I was just using the wrong
am I still using the wrong thing I need
to just console.log view console dot log
products connection page info has next
page should be says that's what it's
called has next page
okay so true it should be alright good
now it's actually fetching them and here
cool doesn't fetch anymore but we're
still showing the loading indicator so
that's gonna be up here our list footer
I'm gonna say we can copy this has next
page so if it has a next page then we
showed that loading indicator so for
this first one we get more items what
the heck did we break it again it seemed
to work when I had the console.log
statement and then when I removed the
console.log statement it seems to break
not here right here products connection
dot page info see look now it loads I
don't know why that is that's very odd
alright so we don't see the loading
indicator I I think I'm happy with this
at least that part of it that looks good
so now I want to try this again with
just more items in my database right
because I have a very short list of
items and there's ways to see the
database and all that jazz but in my
opinion the easiest way to do this is if
we just come over here and spam create
some so I'm gonna copy the price and the
name
and we're gonna say mutation you why is
this read I'm just gonna refresh it
there we go
and we're gonna create product so and
let's just paste in that so here we're
gonna pass in a price or the name is new
Sally
the price is 11 and the picture URL oh
crap
I want to get oh I'm on this I want to
be on
oops so I don't want to be creating this
from the app because we have the picture
I want to create a just pass in the
picture URL oh it takes a data object
there we go and we're gonna copy this
feel free also to seed instead of doing
this so make it pretty and we're gonna
say we get the ID back and let's make
sure we it has what what else does it
need let's look at our schema this will
tell us great product data so name
picture ID price is seller mandatory
seller is mandatory seller connect and
we can give it a a mail okay so we're
going to say seller
we're going to say connect and we're in
passing an email we'll just queue and
you guys can't see this let's make this
pretty oh it won't drop it to a new line
alright this is what I did so to specify
the seller for this I connected it with
the email queue so create cool so now I
can just spam create a ton of these guys
right and this will just fill my
database with products to test
pagination now this is not like a great
way to do it because it's a bunch of
duplicate data but it's the fastest in
my opinion I actually looked into how
you like import data with Prisma it's
not it doesn't want the simplest at
least as simple as that
okay so let's give this a try now
instead of showing the name because the
name is gonna have tons of duplicates
right so let's we can fetch fetch we're
just gonna get a bunch of new sally's
right well interesting we seem to be
getting problems with the keys I wonder
if that's a problem with ours or if I
just did if I'm fetching the same guy
more than once I guess we could check
our database and see so we could fetch
all the products
and we products and we can get ID and we
could sort them by ID and then you can
see which IDs are the same now you would
think this would not have any duplicates
in it and it doesn't look like it let's
sort by ID order by and we can say idea
sending and this makes it easy to scan
you can see any duplicates and I don't
see any so that means there's something
wrong with our pagination so I have no
idea what's wrong with our pagination
right now we're very close to finishing
it though so this is where I'm at in
this video we can't handle it and we
kind of went off in tangents a lot which
is my fault but we got this working at
least semi ought to fix this key warning
but that's it for this video guys thanks
for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>