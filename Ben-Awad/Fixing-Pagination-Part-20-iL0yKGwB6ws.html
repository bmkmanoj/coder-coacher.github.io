<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Fixing Pagination - Part 20 | Coder Coacher - Coaching Coders</title><meta content="Fixing Pagination - Part 20 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Fixing Pagination - Part 20</b></h2><h5 class="post__date">2018-02-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iL0yKGwB6ws" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be finishing up our
infinitely loading list making sure it
works with sorting and adding products
deleting products and all that stuff so
when I opened up the app and rein it
today I noticed it was having trouble
loading and one of the things I had in
my if statement on whether the load more
was whether it's already been called
once so I'm gonna remove that and it
works so for whatever reason I no longer
need this I'm not sure why I need it
yesterday and not today but now it'll go
ahead and load items also we were having
a problem yesterday with the keys and
how we're getting duplicate items with
the paging but notice when I go really
slow we don't really have a problem with
that and I think what was happening is
we were loading twice so the reason for
that is we would fetch right what we've
already loaded so I want to just add a
just condition right here and say not
loading so I only want to fetch more
items when I'm not loading or else that
causes a problem as we saw in the last
video and that that solves the key
problem that we're having alright we
don't we don't need this console log
there next thing I want to get delete
working so scroll down for example I
want to be able to delete Sally and
right now delete does not work and the
reason for that is we changed our query
so instead of data dot products we now
have data products connection and we
have edges so we need to update the
edges list and all we have to say is the
same thing so products stock connection
by edges and when we filter we're now
gonna say X dot node okay but we can't
just stop there we have some variables
that we pass into the query so variables
variables
so these are the variables this guy
right here this variable called
variables is coming from up here from
our props right all the way and these
are the variables that we use to fetch
the data that's currently showing so we
need to we need to pass the variables
into our cash down here so we know what
query we want to update so make sure to
add that to wreak weary and write query
and now when we are over here we should
be able to now delete guys so new Sally
we should see Ralph pop up next and sure
enough we do cool so our deletes working
next up I want to get edit working as
well and to get edit working we're gonna
have to do a similar thing where we
update the query like this and we have
to pass in variables so it knows which
query so in our state
let's pass in an item oops
and also the variables variables
okay so then doesn't look like it's
adding my comment today we'll come back
and fix that in a second though so an
edit product now we're gonna have not
only item but we're gonna have variables
so now we're gonna say item dot picture
URL instead of using state and then down
here we're gonna pass in our variables
to both read and write the query and
then here we're gonna say Box connection
edges and we're gonna say connection and
oh wait now just connect the Flies
connection I spelled it wrong over here
there we go so products connection
products connection dot edges and then
when we map over this now we're gonna be
checking it's the node and now we
remember we're not just returning the
product now we're returning a node so in
the node there's two things there's the
note itself which is the actual product
and then there's the cursor which is
gonna be update product dot ID so the
cursor is just the ID and we also need
to pass a type name which is going to be
node and let me save this and show you
guys over here cuz it was looked like it
was going a little off the screen okay
so so now we're gonna loop through all
the edges until we find the node with
the ID that matches and we're gonna say
we're gonna return a new node and make
sure wrap that like that I guess we
don't need that I was thinking we need
to wrap that so it knows we're returning
object but we're passing the type name
is node the cursor which is idea of the
current product and then the node is the
actual product itself alright so let's
try I was gonna say try updating but
there's one other thing we need to fix
down here so
from state get the item item item and an
item all right so I think our edit
should be working now
and you've got some duplicate keys let's
refresh not sure why those just happened
I feel like it almost triggered twice
and now we're having trouble loading I
don't know if it's my server or what all
right it was just loading really really
slow all right so let's edit this guy so
new Sally and it's now gonna be Bob and
it's gonna cost $7 and let's pick a new
image
cool so we see Bob so our update works
well now all right so let's also get
create product working so similarly we
need to in our new product over here get
past the variables so that way when we
run this query right here we pass in the
variables so back over our products so
when we past when we push over right we
need to pass too and it wasn't - I think
it was path name let's double check what
we had down here
all right so path name is and state is
what we passed it and state is just
gonna be our variables we don't need to
pass anything else with that and I'm
just gonna format this and doesn't like
it and it didn't format for some reason
there we go okay now likes it alright
then over here new products I can just
get the state so similar to how an edit
product I got it from the location we
can do the same thing so in our submit
you can paste that here
and so I'm just gonna rename this state
two variables so we can just pass in the
variables here and here and now we can't
just push so we're sorting this by
created at so I believe the newest
product is at the top or actually is the
newest product at the bottom or the top
I guess we'll find out I'm gonna put it
on and I'm gonna delete these comments
I'm gonna try adding this product to the
beginning of our list and if it's not
supposed to be there we'll change it
okay so data dot products connection dot
edges and it's equal and I'm going to
say it's equal to itself so we're going
to keep all the edges that are currently
there and then we're just gonna add a
node to the beginning so this is gonna
be type name node and it's gonna have a
cursor that's equal to create product
dot ID and then the node is going to be
equal to a great product okay
and I forgot to put a comma area so I'm
just adding a node to the beginning of
the edges list and let's see if this
works so create a product
NU'EST it's gonna be $1 and let's pick
that image undefined is not oh I did
connect this should be connection I keep
doing that
so reload looks like NU'EST is not
supposed to go at the top looks like
NU'EST is at the very bottom so if we
scroll I think newest will be at the
bottom dang we're getting these key
issues I'm gonna dismiss all and I think
I'm guessing we're broken at this point
I thought the loading would fix it I
guess not I'm curious whether it's
because we just we have so many new
sally's in our list that it's having
trouble loading it what I want to do is
in our products since we're having
trouble with getting duplicates I'm just
gonna filter the duplicates out so in
our flat list over here we are mapping
where is that here I'm also gonna just
filter so I'm going to say dot filter X
and I'm gonna create an object up here
so this is how we're gonna remove
duplicates so I'm gonna say Const
products and we don't need a console.log
so I'm gonna check if XID
is already in products Matt if it is I'm
gonna return false which I think removes
the item otherwise I'm gonna return true
before I return true I'm gonna add the
current ID to the map so give that a
save so what I'm doing here is I'm
looping through all the items or all the
products and wherever and that's
interesting then scoot it over there we
go so I'm looping through all the
products and I'm checking whether the
product ID is in products map if it is
in it we know we ready have that product
added and it's a duplicate so we return
false otherwise we return the products
or we don't return we return true it
should keep it and then we tell we
already have this ID in her map so next
time we come across that item we no
longer add it to our map so I'm just
gonna try seeing if we can get to the
bottom of our list so we can see if
NU'EST is there
okay so we're not getting any problems
anymore
at least with keys so that doesn't seem
like it it solved it at least to the
extent it can and we have a lot of
Sally's alright there's law and we have
newest at the very bottom so in that
case if we wanted to there's really no
need to actually add to update this
because he's just gonna be at the bottom
of the list so we can see if this works
this is pretty much up to the programmer
preference so now when we add a new item
it's going to the bottom of the list cuz
that's just how we're sorting it hello
and I suppose we could sort of sort this
differently - actually I'm gonna choose
a different image because that's the
image we using for all the other ones
okay so it adds hello to the top so that
does our update does work now but now if
i refresh hello is gonna be gone right
and so there you're like wow or did it
just go if you reopen the app so one way
we could get around this is instead of
doing order by at the very bottom we're
doing ascending we could do descending
by default but I noticed with some of
the descending it didn't seem to curse
as well alright I think that does fine
now
okay well we keep it like that then okay
so now we have edit delete in creat
product working I want to fix name and
price so the thing that does not work
with for example price is we mean when I
click price and start sorting by price
we're no longer ordering by created at
descending so what we need to do is we
need to say after no because we want to
read we want to start at the very top of
our list again because the order is all
mixed up now so we don't know what page
were on so we need to start at the very
first page so we say after null and
we're gonna do the same thing oops with
our name and the same thing up here when
searching all right so save that and if
I say well that works but if I page down
a little bit it should clear the list
and it does cool and now at resource but
notice how I have to start loading them
again which I think is fine alright so I
think our search is good so now with
name all our A's and we can just scroll
through and page so we didn't break
paging at least with this and name at
the other and now I can scroll through
now something interesting I found with
named descending was notice how short
our list is now new Sally just got
truncated like duplicate new Sally's
just got truncated I don't know if
that's a reason I think it's just
because we have a ton of duplicates that
prison most pagination does not work
well when doing order by descending but
here we can do the price notice how it
doesn't kill all the new Sally's
when it's ascending right but now that's
descending no yeah new Sally's gone
they kept two new Sally's but all the
rest of them are gone so whenever you do
descending it seems to break it for some
reason the only other thing I wanted to
add was I don't want to fetch when we're
loading so I'm gonna say while not
loading cuz that can cause some problems
so I'm just gonna discard not loading
that way someone's not just like
spamming the button they can break
things but yeah so I'm glad this still
works cuz this is now descending order
for created at because he for whatever
reason name breaks what the heck
undefined is not an object
previous result okay I I don't know why
it just broke when I did that I think
what I did is I loaded and then I hit
name
okay is this is a consistent thing I
could break and then it says undefined
so that was what I wanted did not happen
so my guess is loading is not false when
it should be so I just wanna console.log
loading here
and we can see what the value is
okay this in my colon is not missing
okay loading is currently undefined okay
and I'm just guessing loading is
undefined because it should be inside of
data I think that could be a problem
yeah okay so scroll nope it still breaks
see how loading is false so loading
should become true there at least I
thought it would become true I think
that could be our problem I think all
the problems with duplicate cues and
things has to do with loading data when
we're already loading something this
should become true at some point oh you
know what I know it's happening where
we're saying if loading or so here's how
we can get around that
so products connection I'm gonna set a
default value for it so it's going to
default to page info
is going to be an empty object and
products connection is going to be an
empty object and we can just return
we're just never gonna return null and
we'll see what happens a syntax error
there so now the difference was I was
returning null whenever loading was true
so we would get blank screens so what I
want to do instead is have a default
values undefined is not an object so
product connection this should have
edges inside of it and edges should be
an empty array like that and now we
should see loading be true here
undefined is not an object product
connections they spell it wrong products
connection oh that's what this thing is
this should be edges
okay so we see some true nothing dinner
this is usually means okay so let's see
what's going on with our list footer
page info dot has next page alright so
we return null so inherent nothing has
returned from the render this is usually
means a return statement is missing I
think we need to return null explicitly
so if it has an ex page we return this
otherwise we return null because I think
what was happening was has Knicks page
was undefined so we were returning
undefined to the list footer component
which was causing it to crash all right
so now he's seeing nothing here it
should eventually load items okay
doesn't like that we have the
conditional okay that took forever to
load so it looks like we're just loading
slow now but now nice doesn't crash
anymore odd thing I spoke way too soon
but should I thought it would guard it
now that we have that conditional now
I'm getting an error message that
doesn't even show me anything I'm
curious if we no longer filter if that
gets rid of some of our problems so the
main problem was loading here was in the
wrong place so let's see if it shows the
error here all right it is not showing
any air here only in my emulator what if
I just dismiss it
maybe there's something on the server
that's wrong
Oh connection down alright so it looks
like my Prisma database just crashed so
I believe it's Prisma local start is
what I can run this started up okay so I
rebooted my Prisma and I was still
getting that problem and I figured it
out so it looks like for whatever reason
previous result is null or products
connection is null for whatever reason
when we try to fetch more it's messed up
when we try to update the query so what
I did was I added this if condition
right here so what I do is I just make
sure that previous result exists the
products connection exists and also the
edges exist and if one of those doesn't
exist I just returned the newly fetched
result because for whatever reason Peter
result got corrupted my guess is we're
like loading right and I pushed this and
then the fetch more doesn't get
triggered before this comes in or
something but now if I do that and I
press it really fast
doesn't seem to break for either of them
even when I still see like I still see
the loading indicator right and I can
spam it no problems so I think that was
it we just need to add a conditional
right here and I think we're good to go
so I think pagination is at a stable
place our list is a stable place now try
it out let me know what you guys think
if you guys had similar problems that I
am countering as well with this we do
definitely have a lot of things that
we're trying to do filtering or sorting
name price and searching all on this one
list that also is using pagination so it
is pretty complex but I think it's
working decently well now and so this is
where I'm going to leave it the next
video will get started with
subscriptions and some real time stuff
and see what that's like it in Prisma so
that's it for this video guys thanks for
watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>