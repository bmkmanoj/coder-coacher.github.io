<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Caching Images in React Native using Typescript | Coder Coacher - Coaching Coders</title><meta content="Caching Images in React Native using Typescript - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Caching Images in React Native using Typescript</b></h2><h5 class="post__date">2018-03-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ztpG43kuMIk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna take the react
native image caching component that I
made in yesterday's video and convert it
over typescript then we're going to fix
a small bug with it when you change the
URI on it doesn't update right now the
image now the reason why I'm comparing
this over to typescript is I just want
to practice it and get a feel what it
feels like and react cuz there's really
no reason to have typescript for this
it's a really small component but yeah I
just want to get some practice with it
and make sure it also just make sure you
don't have any type errors so okay so
let's get started with this the first
thing is I already set up the project
using this guy right here so this is a
little library for create react native
app it is a script that you can use so
notice right here I just did - - scripts
version and then point it to the
typescript version so when I create my
create react native app it's now using
typescript instead of regular JavaScript
okay so I'm just gonna copy this and
we're going to move it into here so here
is my typescript component you can see
because it has dot TSX over here and you
can notice we have a star as react and
we're using here the props for this
component okay so let's take this and
I'm going to move the import to the very
top and we are going to just copy the
cached image here get rid of the text
and then just add this style so the
image okay so that's good so now let's
add the cache image so cache image dot
TSX
and let's copy this over
okay so there's a few things we need to
do to convert this over first off I need
to install short hash so yarn a short
hash and also I want to get the types
for Expo so to do that I'm gonna do at
types slash Expo all right so that will
give us the types for this and now short
hash doesn't actually come with types so
we're gonna have to add the type ourself
first thing let's make this into a I'm
just going to say any any for now we're
gonna change that in a second someone
just change this into a typescript
component by adding this so here you
specify the types for your props and
here is for your state so yeah let's get
all this stuff working first so element
is in validation expected string so i
think we're just i just haven't saved it
I think yep there we go
so now we're good so the code works now
we just want to make sure we have no
errors with typescript so first thing
I'm going to do is get rid of this one
so right now it doesn't have declaration
so I have this little folder here called
at types then I'm gonna add a short hash
BTS so this is where I'm going to
declare a type so this is how I like to
do it I like to create a little folder
called app types and then just the name
of the module here and then dot d dot
type script and I believe this is if not
the same very similar to how other
people add types for libraries so the
only thing we have to do is a function
called unique so here I'm going to say
declare
module and maybe a short hash and here
we're just going to export a function
call it unique and it takes a string as
a parameter and it returns a string now
there are other things in short hash but
this is the only function we're using so
I'm just going to type that one all
right next thing is component did mount
it doesn't like us setting the function
like this so we're just gonna say async
here we can just do it like that now
something interesting I didn't know
about typescript until now is that it
looks like it auto binds it so normally
if I think I do this in JavaScript this
will be undefined in here but don't have
to bind it that's why I was setting it
equal to a lambda function before okay
so now our code is pretty good it
doesn't like what we have down here so
let's add some typing for our state and
props so for our interface I'm going to
create a props interface and now the
first thing is going to be a URI so
that's what we're expecting string from
the user so let's pass that in as our
crops and interface is kind of like a
way to add an object so we have an
object it's gonna be our props and then
URI is expected now for our state at
first this is what I was thinking for
this state right is to create my own
kind of interface here with the source
being optional
and then if it was if it was there it
would be an object with the year.i which
is a string okay so now we'll set the
stage but there's some problems with
these things so first off it didn't like
that Knoll being here so we could switch
it to undefined to try getting it to
work but then we still have problems
down here so first thing I noticed was
there's this thing and I wasn't quite
sure how to type this correctly because
notice how we have the style prop and
really what we want to allow the user is
to pass any prop in that an image what
except you can also pass to a cache
image so for us we want to be able to
allow that I just looked at this little
warning and I thought there's something
called image properties so I tried
importing that from react native image
properties and then what I basically
wanted to do was merge my props so I
wondered out loud my own custom props
and the image props so I can do that by
extending it extending image properties
and now you'll notice at least that air
goes away the next one is it doesn't
like this source so we have our image
properties but we also need to change
how our source works over here because
it doesn't like it and I want to see so
yeah so at the bottom here it says you
cannot set the type source it's not
incompatible it expects a type of
imagery resource so I was like okay I
can use that too
image your resource and I can set that
right here so image your resource so now
we have a state with the source and now
this thing doesn't like it so I changed
it to an object and it was good to go
and now all our warnings are gone and
typescript is no longer complaining so
awesome so we got there the only thing I
wanted to change was I want to add any
prop here so Const and I want to remove
the your eye from it so other props
we're gonna save dot dot dot is equal to
the stop props and so instead of
specifying the style here I now want to
accept any prop so we're gonna do and we
can just do it at the end
dot dot other props okay so now I'm
passing any prop that I get from our
over here so any prop that I specify
here it'll just go directly here now it
doesn't like it over here so let's see
what I did it's not signed by type
read-only no idea what's going on with
that I don't know if it didn't like it
cuz I changed it here worried about this
guy in a second this is really from the
user point of view okay so I want to
show you guys the little warning that
they're not worrying but bug that we
currently have so right now the image is
not never gonna change but it's possible
that the user has a state right where
they have the just like a string for the
URL sort or the URI if you will so let's
do that
so then for this I want to set equal to
this dot state dot here I and this thing
will get mad at me cuz I don't have my
state specified so I'd specify the state
here
we could create a little interface but
I'm just going to pass it like that okay
so we get the same cat but now I want to
add a little button from react native so
button and when I click this button so
button title is going to be changed
picture and it's gonna be a non press
and when we press we're gonna say this
dot set state and we're gonna change the
URI so I just went over to Google Images
and just randomly grab a new one and
copy the image address and we can just
paste it in there and that one doesn't
look like it's gonna work cuz it's not
actually a URL so copy image address are
all of these data I want just the image
address so let's click on him and let's
copy the address I want just like a JPEG
not the actual data
so let's click on him click on him there
you go
so this is what I want and we're gonna
paste it here okay so it doesn't like
things lambdas are forbidden and JSX
attributes due to their rendering that's
actually like a good TS lint warning to
have I'm an ignored for it well you know
we don't know we can add it up here
so what's saying it recommends doing
adding a function up here so we can say
on press and then we can move it up here
and then I'll say this dot on press ok
so I don't see a button showing up I
don't know if ok area it's a change
picture so this is not defined this dot
set state ok so this I'm just gonna make
it a sync because it doesn't look like
it bound it but it was bound over there
so I'm guessing if I make it
asynchronous it works undefined is not a
function for nope still doesn't like it
so we'll just do this the old-fashioned
way
so constructor those of you that are
better at type scripts of them me I'm
curious why I don't have to bind it this
guy here I have to bind oh maybe
component did mount is Auto binded
that's probably it
nevermind I think I was just being a
noob so this let's state let's put it
here
and then we're gonna say this dot on
press is equal to this dawn press stop
find this and we just need to specify a
type for this and we don't expect any
props all right so now when I click on
the change picture the your eye changes
but the picture the cat doesn't and the
reason for that is component did mount
this is only called when the component
first mounts really what we want to do
is component will receive props is use
this one and what this will allow us to
do is I believe it has and gets current
props its next props and current props I
forget the order we're gonna have to
double check this let's see that will
tell us yep next props and then props
and so this is going to be the types are
gonna be props and props and so we want
to do all this stuff in this function
but we want to conditionally do it we
only want to download a new uri
when the URI changes so how do we know
if it differs well and I'm surprised it
doesn't show up over here but that's
okay
we're gonna say next props dot your I is
not equal to props that you are a so if
they're not equal you know we're gonna
say at the top if they are equal we're
just gonna return out of this otherwise
we're gonna get it from the next props
so we're looking at the next props and
if the URI changes then we're gonna go
ahead and run this stuff and we're not
getting anything so I'm going to console
dialogue next props and props so maybe
it just doesn't get called on the first
mount yeah it looks like it doesn't get
called but if I call but if I click on
change picture okay so it does go ahead
and appear nice so it looks like we
still need the code here to do it when I
first mount we get our cat and now here
we're pretty much listening for updates
so now click on this we now get our Fox
so cool or I guess this is not a fox is
a wolf alright so I'm copying pasting
code let's abstract this into a function
so it's move this up here so
we'll say download image and with
download image I want to just copy all
this stuff now instead of from the props
we're gonna make this asynchronous and
we'll just get this from get it passed
in so here I'm gonna call this doc
download image passing in next prop your
eye and we'll just do the same thing
here but now we're gonna say this stop
props that your eye
alright so download image is now gonna
be called this is going to be a string
so again this is this guy right here
I would assume I have to bind but it
looks like it's working for some reason
I'm not sure when to bind to these
functions and whatnot to find them in a
typescript
it looks like I have access to this when
I shouldn't but maybe it's because I'm
calling it from this I'm not quite sure
but alright this is what I wanted to
change so now we have that we're working
nicely we still have this little type
arrow over here which I'm not sure
what's going on with that it is not
signed ball to type intrinsic cash image
read-only yeah I don't know what's gone
theis type soft investigate it further
if you guys know why it's getting red
lines here let me know but we'll do in
the next video is fix this type error
here and also
set this up so I can deploy it to NPM
because I want to set this up as an NPM
package so look into how I can set up an
NPM package and also how to like bundle
it with typescript and all that fun
stuff but this is actually one of the
reasons why I tried flow type which is
kind of an alternative to typescript and
was like man I don't even want to do it
anymore because you end up coding trying
to get the types to line up more then
you actually end up coding I found hey
that's just because I haven't spent
enough time with typescript but it can
get kind of complex adding all the
different things that you have to get
and getting them the wind up well that's
it for this video guys thanks for
watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>