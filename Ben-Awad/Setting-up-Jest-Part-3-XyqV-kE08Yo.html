<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Setting up Jest - Part 3 | Coder Coacher - Coaching Coders</title><meta content="Setting up Jest - Part 3 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Setting up Jest - Part 3</b></h2><h5 class="post__date">2018-04-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/XyqV-kE08Yo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so we're gonna be setting up
Jess today so we can start testing our
code now before I begin with this stuff
I just want to mention I am pretty new
when it comes to testing graph QL stuff
and testing in general I don't do a ton
of so I really want to get feedback from
you guys as I'm doing this what how you
would do it and what you think of this
approach and my goal with this is to
basically cover the most amount of code
with the least amount of tests so what I
was thinking is doing some kind of like
integration type test so we'll get into
like what those tests are in a second
let's first start to set up Jess so here
is the typescript just version and we're
gonna be using this because we're using
typescript so here is the installation
for it we just have to install just ts
just and then the types for just and
these are all dev dependencies so I'm
doing - B and then after that I'm going
to copy this bit right here and this is
just from their github page Proteus jest
this is just I guess specifying what in
our package JSON over here so underneath
scripts justifying that we want to use
TS chest and whatnot and that to look
for typescript files alright so we have
this set up nicely and so the first
thing I was thinking was creating a
folder and I wasn't sure if I should put
this inside of source or not I went
ahead and put it inside of source so I'm
gonna just say tests and okay I already
have a folder here cool
so I've folder called tests and I'm
gonna call this register
test doc TS the dot test is for jest so
it knows to basically that this is a
test and there's one other thing that
wanted to set up and package our JSON
real quick in scripts I'm gonna say test
and we're just gonna run just so now I
can just run yarn tests and it will run
just ingest will test our code I want to
just like basically get the hello world
running to make sure that's all good to
go so I'm in just copy this is from the
getting started from jest so I'm gonna
copy the sum and I'm gonna copy this
test okay
so here is just testing to make sure
that this sum function works so the way
we had run this is by saying yarn test
and it'll now run just for us and we
should see this little output and we
passed so work it so that means if that
worked for you you have just correctly
set up so next thing is I want to start
testing the code and what I was thinking
was using this library here called graph
QL request it's really handy what it
allows you to do is just have a query
like this and then I can send a request
to a server so I'm thinking I don't want
to just test the resolvers like this so
I could for example call this function
here but like I said earlier I want to
test as much code as possible and I
think in this case a better way to do
this would be to send a just graph QL
request and then check make sure
everything works so how I'm gonna do
this is I'm going to install this
library and this just makes it easy to
send basically graph QL requests to our
server so we're in copy that
yarn add and what I'm gonna do here is
we don't need this son function and what
I was thinking is I would start the
server and then basically just query it
with graph QL and then register user and
then after that check the database and
see if the user is there so to do this I
was like alright it'd be nice to be able
to start the server from when within my
test right so I was like all right why
don't we transform this stuff right here
into a function so I was like all right
why don't I do like Const start server
and then I just wrap all this like that
but the thing is we're now not and then
also start server like that so if I were
to run this with TS node for example
it's still run the same way as before
but now I can export this function and
call it within my test if I wanted to
and then I also want to make this
asynchronous one at it and that way I
don't have to use dot then here and I
can just use a wait so I'm gonna wait
that and my server dot start
and then at the end we'll say console
dot log everything started up okay so I
just kind of like flattened this all out
using turning into an asynchronous
function and using a wait here
so now I was like alright the first
thing I want to do in my tests is to
start the server so I'm like let's start
server and I need to make this
asynchronous so I see Chris and I was
like are able to call this register user
and I was gonna create an email up here
so maybe Bob at Bob calm and a password
you know something like that and then
I'm gonna write my mutation and we're
just going to do it like this I'm gonna
call register and have an email and the
email is gonna be like Bob at Bob calm
right so we're just gonna use the email
up there and I'm also gonna do the same
thing for the password okay so here's
the mutation that I want to run here I'm
starting the server and then what I'm
gonna do is I'm going to say kant's
response is equal to and what I'm going
to do is just call request from graph G
load request
and I'm going to say a weight and we're
gonna request and here I want to put the
basically URL of my server and this
could change and depending on the
environment so I was like alright why
don't I make a file called constants
thought TS and I'll just export the host
which for now is going to be localhost
and then maybe late here I'll change
this to be an environment variable or
something but now I can just import host
from constants here and then as my
second parameter is going to be the
mutation or the query that I want to run
and so now it's gonna go ahead and we
started the server we're now going to
make the graphic you'll request to our
server we're gonna call this mutation
and then after that the first thing I
wanted to just do was just to expect
response and to equal an object that
said register and true so basically
registering worked so I ran this so yarn
test and it kind of worked it kind of
didn't and we'll see what I mean by that
so first thing you can see it spits out
all this the logs right because we
started the server and the second is
this thing breaks so for whatever reason
I get this listening 4,000 and I guess
it's because we tried starting the
server with ingest and it didn't like
that so I was like alright that's fine
I guess it's best not to start the
server like this from within just or
maybe there's a way around this please
leave a comment below if you do know how
so my next thought was alright I don't I
won't use this like start server
function like I originally thought what
I'll do is I'll just like start it in
another tab so I'll open an tab
here and I'll just say yarn to start so
now I have my server started over here
and I can now in my other tab do yarn
test and we'll just query the server and
then we'll expect the response and that
seemed to work a lot better and here we
go cool we passed the test so then I was
like all right I want to make sure it
actually inserted the user in the
database so I was like are able to
create a connection and we're gonna
await that so this is gonna connect to
our database okay and after we connect
we're gonna say console users and we're
gonna use our user entity so I just
imported two things pretty quickly so I
imported create connection from type arm
and I imported the user for an entity
user and I'm gonna say user dot fine and
I'm gonna say we're email so I'm
basically finding all the users in the
database with this email and then first
off I'm going to expect users to have
length 1 right so we really how we want
it is this user to only only be one user
in the database with that name or with
that email and then the next thing is I
want to expect
so we'll say constant user will just
grab that user
and we're gonna say two equal at least
the email it should equal the email that
we passed in above here right here and
we also expect the password to be
different right so not so we're hashing
this password so it should not be equal
to the plaintext password that we have
here so those are like a few checks that
we can add in and now I can run yarn
tests and test this again and it's gonna
fail because I've run this a couple
times now so we've created Bob at Bob
calm a couple of times well actually a
lot of times so if right now I have 15
Bob at Barb's comms but maybe I've
changed this to Tom at Bob calm and
we'll see if that works out a little bit
better and cool we pass now I'm sure if
you've done testing before or if you
have worked with some of the stuff
before you know this is a very bad way
to do it at least I'm doing it right now
and here's what's currently what I think
is wrong first I'm testing on the same
database that I'm developing on which is
a no-no and I'm not dropping the
database before every single test run so
let me just let's write out like a
comment of things that I want to change
so first I should use a test database
secondly after I create this test
database whatever I do in the test I
should drop all data once the test is
over so we shouldn't have just like test
data sitting in our database after the
test is done and then the other thing
when I start the server
I shouldn't have to start the server
separately I just run when I run NPM
tests or
really I'm running a yarn test it also
starts to server so maybe I in my
package of JSON I set something up where
it automatically starts the server
because we also don't need no daemon to
be running while we're testing so that's
a thing so those are the things that I
want to work on next and that we'll be
doing in the next video is setting these
things up that way we're basically using
better practices while testing and then
the other thing also is I shouldn't have
to create a connection in every single
test
I should basically have like a hook
that's like before running tests create
the connection that's another thing
we'll set up but also again tell me what
you think of this I'm still gonna use
this type of kind of test where I'm
doing our request but then I'm
connecting to the database to check to
make sure it's in there let me know what
you guys think of that if that you think
if that's just like a bad idea and I
should do this a different way
altogether or I think this tests it
nicely the thing that I do like about
this is that I'm able to send an actual
request so it's going through the server
it's going through the graph QL engine
it's going through my resolver so it's
making sure all these things are working
nicely together and like when we start
adding cookies and authentication I can
make sure all that is playing nice
together but maybe that should be a
separate test let me know what you guys
think in the comments below but that's
it for this video
more will be soon
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>