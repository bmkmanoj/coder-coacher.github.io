<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Deleting Products - Part 15 | Coder Coacher - Coaching Coders</title><meta content="Deleting Products - Part 15 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Deleting Products - Part 15</b></h2><h5 class="post__date">2018-02-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yXUAqmWrEQA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys we're gonna be working on the
edit and delete button that way we can
delete products or edit them if we need
to change something about them now for
this what I really want to do is just
copy the mutation that's already in the
Prisma database so here I ran the server
with NPM run dev so I can now look at
the schema for the database and we see
there is an update 1 right here and we
can see we pretty much just want to do
exactly this
but the thing is we can't copy it like
we did the other mutation so over here
this guy right here not that one the
query that we made where we actually
were able to just copy identical we
can't for this for a similar reason why
we can copy it for create product is we
have a picture right and this has to be
an upload type so we're gonna have to do
it a little bit differently but that's
okay so we're gonna do that and then
we're gonna be copying delete product
exactly the same there's no really need
to change it unless you wanted to also
delete the image which in that case you
would want to alright so let's get into
this so first off let's go ahead and
changes or not change but add to this a
update product and we're gonna have an
ID which is the type ID so this is how
we're going to query the product with
the ID and then here we're gonna have an
optional string optional price that's
gonna be a float and a picture so all
these fields are optional cuz you may
only want to update a certain one of
them right and I think we want to return
a product from it let's make sure yep we
return a product and it's not always
there so let's not have the bank sign to
the end okay so I might just pass a name
I might just pass a price I might just
pass a picture into this
alright so update product is good let's
go ahead and add
the mutation for this so we're gonna hae
async update product and this is going
to take parent and then we can copy I'll
text you just copy what we have here and
say update product okay and we can put
our content in the middle so what do we
want to do first we do want to get the
user ID so let's grab that oh oops
and the reason we really want the user
ID is to make sure that the user of
that's currently trying to edit this is
actually the person who owns the product
so what we need to do is say Kant's
product we need to get the product so
I'm gonna say ID and we're gonna wait
and we're gonna say context that DB
query dot product and here we're just
gonna pass in where ARDS and we're and
we're just gonna pass and the ID okay so
what does this do this will go ahead and
get us and let's just add some spaces
this looks nice this will get us our
product and the thing the reason why we
want to grab this product is and do we
need to pass in if we need to pass in
info as well I I don't think we want to
pass info in this case yep looks like
infos optional info I think you pass in
if you want specific fields in this case
we want all the fields and I'm gonna
console.log this because I'm not sure if
it gets us the seller by default but I
want it to and I want to check right
here so I'm gonna say user ID is equal
to if it's not equal to we have a
problem right and that's the thing we
need to check for so not equal to
product dot seller dot ID
and maybe we actually look look this up
differently but we'll see then we're
gonna throw new air and then we can just
say not authorised so if I'm trying to
copy someone's product but I'm not the
seller or not copy what a product but
I'm not the seller then we're going to
throw an error otherwise what we can do
is we can first check if we have a
picture so I'm going to say if picture
and we're gonna say let picture URL
equal to null and if we have a picture
we know we want to process the upload so
we can put that there and then
underneath we're just gonna call the
function like this so I can copy you
but now for us we're gonna be calling
update product and now it doesn't like
it cuz we have data in here we're gonna
be passing the name the price picture
URL we don't have to pass the seller for
this but we do need to pass another
argument and that is where and here we
can just specify the ID of the product
and I think this is good so this is how
we're gonna update our product so first
we check and make sure that the user is
actually the user who sold the product
before they can change it and then we
upload the picture so save it to our
images folder here if we get a new
picture if not we ignore it and then we
pass all the data to our update product
and that's what we return so nice and
let's add the same thing to delete
product so hopefully product let's fill
that out and this one we can actually
just directly copy for a month
over here so direct or delete product is
this in the middle so let's copy you and
then it returns a product and so product
where unique input let's go ahead and
just doesn't look like we have it yet so
copy that and import it from up here
cool so this we can actually just
forward kind of how we did for our
queries over here so we can copy this
forward to and do the same thing because
there's not really a difference for our
this guy for forwarding the delete
alright so the product and we're just
going to say forward to DB alright I
think that's good we'll see if any
errors this is the thing I think we
might get errors on now we can on the
client side actually call these
mutations let's see no errors so we're
good to go
alright so on the front end let's head
over here to products so why don't we do
delete first because that one will be
pretty easy so we're just gonna call the
delete mutation so let's type it up over
here so what we need to pass in there is
the where clause which actually we don't
need to come over there we just need to
look at it here here's the product where
clause which we need to pass in an ID so
here as a parameter what it's gonna take
is this thing or we could just say you
pass in an ID here it just let's
actually take as a variable the ID so
dollar sign ID is equal to the type ID
and here's where we're gonna call this
function delete product
and we're gonna pass in aware and inside
the where we'll pass in our ID which is
gonna be equal to dollar sign ID and
let's make this pretty and we need to
get some subfields from our product the
one I really care about is just the ID I
suppose I don't really care to see much
alright and I think we're good so I'm
gonna add this to the bottom over here
of our products page on the state export
and delete product and this is a
mutation and we're gonna say consti QL
paste this end and then we need to again
we're gonna add a mutation here and with
two of them you've seen this before I
like to import compose makes it just a
little bit easier to read so compose and
then here we're going to say graph QL
and then just pass this in to leave
product mutation and then we can just
call it up here so call it when this
gets pressed and I'm gonna create a
function up here so delete product and
actually I was gonna make a function up
there so we don't have to keep making a
function in here but we're gonna have to
because we need to know the ID of the
product so I'm gonna say this top crop
stop mutate pass in as a parameter the
ID so variables
and inside of this variables array we're
gonna pass the ID which is just gonna be
item ID all right so give that a save
and let's run this now when I click
delete right here I don't think it
should disappear right away because we
haven't updated the cache here so we're
gonna have to refresh to see the change
and then if we want to see it why we're
gonna have to use the update query
function so let's hit delete and let's
look at our logs here and see if
everything went good
so no errors here and I was console
logging the product up that's only an
update so we don't even have to worry
about that so alright this looks like it
ran successfully so if i refresh we
should now not see it and perfect we
don't so it looks like our delete works
but we want to see delete delete right
away right so similar to how we did with
our new product we need to add an update
function like this so I'm gonna copy how
we did it here it's gonna be very
similar so the query that we're updating
is this products query and we're gonna
have to move it up here so we can access
it I'm gonna put it underneath the
Styles okay so here products query we
read it from the cache again how many
over the comments I don't really need
them so instead of adding on create
product and we don't actually need the
data because we narrating know what's
happening we're gonna say data dot
products dot filter I'm gonna say X X
dot ID is not equal to item ID and
that's it so what we're doing here is
we're reading the products which are
these items from the cache that's what
requir does and then we're removing the
item we just deleted right so that's
what item that ID does vary what this
filter command does is it looks through
all the IDS and it keeps the one that
are not equal to the one we're deleting
which is item ID right because that's
the one we're passing in here and then
we write it back to the cache so save
that
and watch it in action so now I'm gonna
delete my last item that I own and did
not work so let's see what happened
there nothing seems to have changed so
either this did not this just did not
work for some reason let's add some
console log statements to help us debug
now this is gonna be annoying to debug
because I just deleted all my items so
hopefully you can figure out this
quickly so I'm gonna say coughs about
log
oh I'll tell you right now what we did I
filtered this but I didn't return it or
I didn't do anything with the new list
so I need to say data dot products here
there we go so I wasn't a sight so
filter does not change it in place like
how push does filter creates a new array
so before we were creating a new array
and not doing anything with it and
creating a new array reassigning it and
then all right so let's create a product
just another one and then when I delete
it we should see it go away
automatically all right I have the
product area I'm going to open up my
console see if we see any errors with it
interesting I don't see it here and also
I don't see or maybe I just don't see
the edit and delete yeah notice how the
edit and delete didn't show up until I
refreshed that's kind of interesting and
I assume the reason for that is we're
asking for the seller ID and the seller
ID must be null or something so to test
this theory what I'm gonna do is I'm
just gonna console.log actually let's do
it and render items now we can do it at
the top I'm gonna console dot log
products and we can see it is
indeed null for now though what we can
do is test our delete so cool so when I
press the delete button it went away
automatically so that means our update
function here worked and if i refresh it
is gone so cool so this worked the next
thing I want to fix real quick or at
least investigate is whether the seller
ID is null so we're gonna add this
choose add product so now we can see
this so I called this thing a SDF and so
we can see the name here and I do indeed
see the seller ID is equal to this
number this ID so that looks like it's
not null that looks good so we should
see it updated here so I'm gonna refresh
and it looks like the same number we see
edit and delete show up here
not sure what causes the delay so what I
want to do is it's the last item right
so I'm just gonna say products dot
length minus 1 so we can look at that
say seller 2 ID and then I'm gonna
console dot log this dot state that user
ID so we can see what the values both
these are they should be the same in all
instances and this instance they are cuz
we do see it but something is not I
don't know if we're having a problem
with the update or what and it choose a
product alright so something is null so
I didn't do this well so I should have
said it's hard to tell which is which
but I seen this one I'm assuming the
null one is the state here or the user
ideas so I miss
in front put the state but I have no
idea why this state would be null there
I assume it just needs to load in which
it does and grab it from a sink storage
and then it should update and then they
match so I don't know well it's also
maybe print it here when it's doing the
query and the render items it's not rear
entering for some reason I don't know
what the problem with this is I think
we'll just break the video here I'll
investigate this further and see if I
can figure out why it goes null and then
we'll also get the edit button working
in the next video so thank you guys for
watching and I'll see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>