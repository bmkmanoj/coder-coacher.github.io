<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>I try to do associations in sequelize | Coder Coacher - Coaching Coders</title><meta content="I try to do associations in sequelize - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>I try to do associations in sequelize</b></h2><h5 class="post__date">2017-06-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SaVxJrTRkrI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys so in a previous video I
made a template that I like to use for
graph QL that uses node and sets at the
server it's a nice base that you can
expand on in this video we're going to
expand on it so we're going to create a
couple more models and then we're going
to be adding some more stuff to our
schema and showing you how do some more
advanced stuff with sequel eyes and show
you some nested types so our users and
have some stuff and if we're going to
show you how to do some database calls
that are kind of they're lazy you're
going to do a database call for user and
then you might do a database call to the
users whatever and you'll see this later
on and it's going to be really cool so
if you don't know what this is or you
haven't seen the previous video or you
didn't follow along and you want to get
the code for this it's going to be on
github and you can get this template
right now I'll put in the link
description below so you can copy it and
follow along if you'd like to okay so
let's get right into it so I have a user
model here and when I was thinking about
what I wanted to you know create to show
you guys how this works I was like let's
actually make something useful so what
I've been thinking about making for a
little bit and I'll probably make it in
the future is like a suggestion board
it's going to be more advanced than that
but the basis is you guys can add
suggestions to a board and we're going
to create the bare-bones of that today
so to do that there's going to be two
things there's going to be a board that
will be one model and there'll be a
suggestion you don't want to think of it
like it to do listen to do item there'll
be a bunch of suggestions on each board
and HEA users can create boards so to do
lists to do items pretty much same thing
we're going to use different names and
we're going to actually use this later
okay so what we'd like to do now is make
some associations so what we're going to
need to do because the user can have a
board right and so I'm going to show you
guys how that works we actually create
an associate Association
and then we do model so we create
association property and what is it get
to function and actually sheikah lies
calls us and passes in all the models
that we have for right here all the
other stabilized models it's not this
one in our index so that's what this
thing is doing feel that we run
associate ups fun association is to
associate okay so it calls this
associate function that's what this guy
is doing and just associating each model
with each other so we want to associate
the user model support and it's actually
going to be a one-to-many relationship
so let's do that so it's going to be one
too many with board what we want to set
up so I'm going to pop over here to the
documentation for sequel live and
there's a couple different choices we
have for making a one-to-many
relationship so if I click right here
scopes we can do a belongs to or a has
many I prefer doing has many because it
actually sets up a couple helper
functions for you like for example this
is doing post and you can comment if you
do has many I can do comments get post
or post get comments so I set up has
many so we're going to a have a
relationship so I'm just going to copy
this and then change it for our
information oops
have that over and actually if we tab
from the bottom that works better okay
so the model we're going to be using is
user user has many and then board to get
bored you'd use models soft board and
this model object is get these so we're
gonna have to name our board for which
we're going to now the foreign key will
say so the foreign key is going to be on
board and it's going to point a user so
we'll say
you just call it user ID will actually
say we'll call it owner that makes more
sense because the board owner will be
the user when off we're up constraints
and relatively about scope and this
looks good now so let's create our board
create our board I'm just going to copy
this hop over here paste it in and
change user to board change sign and
we're going to change that to okay so
our board here is going to just have a
name for now and that's it and then
we're going to associate it now the
Association for this we want to
associate two suggestions right so
suggestions are only going to have this
is again a one-to-many relationship
because the suggestion can't be on
multiple boards at least that's what I'm
giving a constriction for but a board
can contain many suggestions okay
so again it's just one too many so one
board has many suggestions like user any
boards so this will be has many here we
want to put suggestion and the foreign
key will be board ID
all right now let's copy this and we're
going to go to suggestion and do the
same thing except we don't need any
associations because we're a set up the
associations may be the only other thing
is we also kind of want to know who made
the suggestion so there should be an
association between these two so we're
going to put text here and this is going
to be suggestion and also I want this to
be lowercase so I'm going to go back to
board and lowercase that oops so it's
consistent alright
now coming back to user I said I told
you how I wanted to set up a one-to-many
with suggestion that way we can keep
track of the owner for the suggestion
yeah now what you I guess you own a
suggestion I don't like their name we'll
just put creator ID and then models dot
suggestion okay
so we added all our associations we need
to uncomment this right here so they're
actually added so now our associations
are going to be added to the database
when we're you create it you notice how
I changed this user guy so the one bad
thing about see equalise is it's really
not easy to migrate and I find it easier
you know if you were using a
professional product or something it's
probably better to keep migrations
especially if you're out in production
but we're not in production we're just
playing around here and it's a lot
faster and this is what I do
even if I'm developing a production
thing this is what I'll do is I'll just
go and I'll drop database and then was
the name of this I things like grass ql
i forgot the name of this database but
if we go to index here put the name of
it test graph QL database test graph QL
database drop it and then recreate it
base test graph QL see and you need to
drop it and recreate it because sequel
wise does not automatically update a
table as it exists already so we added
stuff here we're adding these fields and
stuff to user name or sorry to user so
we need to do that okay so let's just
run this to see if we have any errors
which I'm sure there is and actually I
have oops I have it running over here so
I'll just rerun this and we do have an
air so let's see what's going on oh
we're not importing
so coming back to index see how we
imported users
we're not importing bored and we're not
importing suggestion suggestion board ok
restart data right we saw an another low
- ok import I'm just going to read still
crashing I don't know why we're getting
a low - here this is very odd I actually
have no idea what like what could be
causing this we're getting something
maybe earth babble nobody doesn't like I
mean we can come over here and check our
code real quick little tip do do and
make sure it wasn't like I had the
server running when I dropped a database
and that messed things up so I'm going
to drop the database and recreate it and
now we're going to restore it to make
sure it wasn't just that ok it's not
it's actually just something ok so just
to confirm I'm going to get rid of these
so these are the things we just created
so now user has an associate thing in it
so what I like to do when I get an error
like this is just like take away
everything we just added make sure what
we previous hat we had there is working
so what I previously have there is not
working so now we know it's something in
the user it doesn't like this associate
object and to confirm this I'm going to
comment it out and look at that we're
working so for whatever reason it
doesn't like this associate clot and I
think that's because I don't think it
wants us to an error function I think
it's just like that it doesn't like it
for some reason let's confirm
it's not let's confirm it's just like an
es6 thing I put a function here does
that work
expected shorthand uh-huh
my islets oh that's how you do it I was
like trying to remember how that works
so now let's see if we're still getting
the air with this we are um I've gotta
get something with our babble because it
just doesn't like you
it doesn't like this function basically
let's confirm it
see if this I can't even actually save
my file see how it Auto changes it
because I have what's it called a plugin
so let's just create a function here we
can call it sure we can't even do it
this way actually let's just do that so
this is going to be picky with us we can
just do it this way oh we need this
thing okay we can comment this out for
now and just see if it compiles syntax
error on line
I'll see you syntax here can't associate
a sequel I space here oh and creating a
career so she ate object that's fine
okay so the problem is we still need to
get this user somehow so the only ways
to put the function here so we're going
to go back so we just need to somehow
get the function working here
and this confirm doesn't work grant yep
goes on and that's because I mean we
should just actually fix that problem
because I have this I need something
else let's debug that error
so I'll come to a point where like
either try getting it like I could just
do this right but I'd prefer I prefer
the syntax and I'd like to get to work
like this so I'm going to try and see if
I can okay so flow - we get a weird low
- err
this is more importing it's just an it
object require and I just want to
confirm it - nothing inside here before
I go exploring how to get this function
to work nope
okay I'm actually just doing something
super stupid you guys one of these is
not working one of these has many
relationships I wonder if it's because
our model oh my gosh could be our model
now I think it's because models stop
board doesn't exist I actually think
this is working fine okay we're going to
change this function on all of them
we're going to come back I'm just going
to uncomment all that come over here to
board we'll do this like that this is
better syntax anyway we're not even
associating there and okay so we're
still crashing getting the same air NPM
restart app crashed waiting for file
changes okay low - low - is just a jerk
I actually really like low - as a side
note
so let's console.log models and confirm
that we are getting the other models and
Oh are we not getting here so let's call
it this guy out okay we still get there
let's look let's look at what line this
is at equalize import which is onboard
okay models board it doesn't like so
let's double check our model board has
many foreign suggestions so we're going
to console dot log models
okay I thought I saw a printout but that
I don't see it pronounced well uncomment
that okay models is undefined that's why
let's come back in next make sure this
looks good
okay so we're passing DB and DB is
undefined console.log DB so DB is
somehow undefined
even though it's defined C okay so
notice how DB is undefined here
let's console.log that's not even being
run guys okay let's console dot log DB
here I should actually is call me
something is going wrong with these
equalizing ports I think I might have
some copy-paste ears
see this looks fine then we should be
doing objects that keys we should get
bored user bored suggestion and then I'm
going to do for each and then we get a
model here which okay so we get we get
an array user bored suggestion with your
keys and then we're looping for each
time and we're in the model name am i
stealing associate right yep let's see
so we're not even getting here oh we are
getting here arguing inside okay we're
not getting inside Oh this so she
supposed to be so she it's not supposed
to be out there is it fine oh my gosh
guys I know what the problem is I need a
very very bad mistake
okay we're supposed to put it here Kiki
class methods I totally forgot about
this I just hit me right now you're
supposed to put it here I think it's
called class methods well we might have
to double check it if this doesn't work
it's either class or class method some
junk like that now we should be getting
inside at least once or maybe not at all
if I spelled it wrong okay it's class
methods to equalize this is what we need
class all right I think I stole it right
yeah that's what we want
okay so we have an object of their
second priam class methods here okay so
we're going to go straight to the docs
because that will be the fastest guess
let's do model definition and let's go -
I don't even see associations see if we
see associate what about class we're
going to see class here let's just go to
sequel I express because they're
examples for the one doing the same
thing and they actually I should have
just copied and pasted from them because
we were doing I was following this
anyway tasks associate ok so just as
tasks associated sure you'll see that it
seems easiest comp user associated
equal to that and it'll pop this back
over oh okay I don't know why I put
Const here we don't need that come with
those back out put a space scare the
comma put an arrow and I I know for a
fact this will work for now okay let's
go over to board do the same thing board
for associate
all right I was making a super silly
mistake and cool so you saw a little
this junk just like shootout that was us
creating the database you can come over
here going to peek sequel confirm
everything was working to select all
from yes let's just go through each
table
so users Oh first we have to connect
slash connect test graph and I can do
select all from users all right
so notice how this will prove act like
it did before nothing has changed but we
go to board as its board okay actually
it would be boards
now notice how boards is an additional
fields called owner that told us we set
up the Association correctly owner
points to user and now if we go to
suggestions we should see a creator ID
and we do create our ID which points
there and we have a board ID to point to
the board so we added someone added
suggestion we know which user added it
and we know which for it came from okay
guys I was going to do way more in this
video but that took way longer than it
should of and I was being super dumb so
I'm just going to like throw this video
out there maybe you guys found this
interesting having me troubleshoot so
I'm like why not release it will do the
actual content of this video I'll
release tomorrow so if you guys made it
through this into this video thank you
guys for watching this was a crazy one
just debugging issues and me being dumb
and realizing at the end but hopefully
you can take my method for
troubleshooting going through finding
the bug and solving it that might be
helpful so I figure why not show
so I'll see you guys the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>