<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CRUD in Typeorm | Coder Coacher - Coaching Coders</title><meta content="CRUD in Typeorm - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CRUD in Typeorm</b></h2><h5 class="post__date">2018-03-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LAzwTlj83EI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I want to show you how to do
credit operation x' with type worm to do
this I set up a graphical schema already
with the queries and mutations that you
would expect I wanted to do a cretin on
a type so the type I have is user which
matches the entity that we created in
the last video now I'm going to be
querying a single user multiple users
and then creating updating and deleting
users so what we're gonna do is fill out
the resolvers for these and how to do it
with tie porn now before I begin I want
to do one quick thing with typescript
that'll make our life a little bit
easier so right now I have to specify
the types because of the way I setup
typescript of the parameters of the
function so if I were to say parent args
context info and let's just say I
returned the empty object it doesn't
like it didn't specify the type and I
can have any any and I could go through
and specify any for each one but I don't
want to do that for each mutation each
query right so one thing I could do is
if I was feeling lazy I could just say
the type of this is any and then we
don't even have to worry about this I
don't think and actually I was thinking
this would work but I didn't want to do
it and it doesn't work anyway so how I
usually do it which I like much better
is to just create a type for the result
so we're gonna create a folder called
types and I'm just going to gradually
add types to this so I'm going to create
a resolver type TS and I'm gonna say
export type resolver and so this is a
function that takes four parameters
parent which I'm going to say is any
args which is any context any and info
and it returns a promise and anything
back from that promise but it can also
return pretty much anything so if you
can't return anything or promise we
should just say it returns anything
now context is not going to change per
each resolver so we could actually
specify exactly what context we expect
right now we don't have a context so I'm
going to just keep it as any so next
thing what I want to do is create a type
for the resolver map and this is going
to be an interface so that's this thing
right here and notice how this thing
works it's an object and this object has
keys query subscription mutation and
pretty much anything else but the notice
they're all strings and they math to an
object and this object has string keys
and then resolvers so that's what we're
gonna do over here is create a type for
that so a key which is a string which
goes to an object which has string keys
and then resolver so now over here I can
set my type so now I told it was a
resolver map we didn't use the types but
now I don't have to explicitly specify
the types or each one okay cool
now let's get started with type arm so
how would I go ahead and fetch a single
user the way I like to do it is to just
reference the entity itself so I can
import the user entity and then say user
dot find all but to do that I have to
turn this guy and I turn it but extend
base entity so now that I have extended
this what I can do over here is say user
and go ahead and import it from the
entity and say find now I could find by
IDs find one by ID and when this is
exactly what we want right so I'm gonna
say
do you structure my args get an ID from
it say ID and I don't need that and I
don't need these two fields so cool now
how would we do users just like how we
did with this one we keep ax we we tell
it we want to look at the users table
right that's basically what we're doing
with looking at this entity and doing
dot on it so find and I can just say
find right and I don't have to specify
anything else because in this case I
just want to grab them all that's what
this is doing right here and actually we
don't need any parameters to that so
let's add mutations now now create is
actually kind of interesting with type
worm so create user we're gonna get args
which is gonna be all of our parameters
now usually you know you might expect it
might be user dot create and you just
pass in the args like that which you
would be correct but this does not work
how you would expect this doesn't
actually create the object in the
database all it does is create an object
so now we have an object called user to
actually create in the database you have
to say user dot safe so that's how you
would create a user right there now we
could chain these together right so I
could say get rid of that and create and
save it all in one step so now we're
taking the arguments that we get and
then just saving it
all right so let's update a user now I
didn't specify an ID but I really should
specify an ID from this so ID and this
is how we know which aidid updates so I
could say ID
args and I could say user dot update and
I'm expecting a boolean back from this
so I could just say try-catch and if I
get any airs we'll console.log the air
and then we'll just return false
otherwise return true and then inside
the try we'll just go ahead and update
so user dot update now for us we can
update it by any field but I want to
update by the ID and then here you
specify any kind of arguments that you
want to change you notice how fast and
easy this is to do each credence and
delete user is gonna be the same thing
and I'm just gonna copy this and
something I forgot to mention delete
user user create so real quick I'm just
gonna give it a different name when we
were doing this and I had Const
user this user right here does not have
an ID if we look we primary this is our
primary column that's automatically
generated and that's generated by the
database let's just comment that out for
now
so when I do user create I told you it
didn't actually create in the database
yet so it doesn't have an ID yet but
when I call
user dot save and by the way I actually
don't think what we have up here will
work because I don't know what user dot
save oh wait it does work I didn't know
if save returned an actual user and it
does that's good but when we actually
call save here it will insert the ID and
update the object for us so after this
so user ID would not exist here but it
exists here just after saving it okay
I just want to mention that all right so
delete user user dot i think it's called
remove by ID perfect and this we don't
actually need any arguments other than
that now one thing I'm bummed about is
the other one you saw user dot remove
just regular there's one thing I don't
really like about it but I'll talk about
that in a second I want to actually see
if what we just did works so I'm gonna
run NPM start and then I'll boot up our
server and now we can go ahead and
create some things in our database so
come over here locos 4000 we can boot up
graph QL playground and first thing I'm
gonna do is create a user first name is
gonna be Bob last name it's also gonna
person to be Bob to what else to meet
age five years old
just kidding he's gonna be 50 now email
Bob at Bob calm now I want to use her
back I want to see his ID his email you
know I want to see all his fields
so van we create a user and we can see
now if I were to do this again we should
get an air awesome tells us duplicate
key this is because we let's look at the
type we said unique on the email field
okay so let's query our user so I could
get the ID of one and I could say ID and
first name cool or I could get all the
users which is just 10 but you'll notice
it's now an array we could try updating
the user
so this first name is now gonna be Ralph
true it worked so now if I get users
first name I should see one with Ralph
we do and now let's delete him that
worked
this should be empty now and it is so
all our operations that's how you do
crowd operations and type ormm
now there's other ways to do these right
because it's not possible to do
everything with just these this is
basically a basic example of like taking
ID and updating but sometimes you might
want to update by other fields so that's
when you would use remove for example
and it's not user it's user but one
thing I was really disappointed about is
here's you specify how you want to
remove right so for example I might want
to remove by the email is equal to hello
and what doesn't it like object may
specify unknown property on base can I
not delete by the email I thought I was
able to alright let's look at the type
of this okay it's expecting remove okay
it's expecting a object type entity what
else is on the user
email first name I guess none of these
fields work that's weird
I thought I've done that this before
where you could remove I guess remove
like I guess I would have to use it up
here when I have a user and I actually
remove him but I was going to say is
let's say one of these things doesn't
work like for example you saw me
attempting to delete by an email but it
wouldn't let me with type arm they can
also have a query builder so let's take
a look at this so this is how I might
delete a user so get connection is not
currently and let's make this a sync
that's something I should have been
awaiting by the way all these return
promises so make sure you await them
like that okay so get connection I'm
gonna import that from type warm autumn
imported so here I specify I want to
delete you need to tell it from which
entity so I could say user from anywhere
else and you notice this is Bryce's if I
I want to delete by ID now I can do and
I might want to delete by the email
equal to email and I might want to look
for another field like email is equal to
Bob at Bob calm right or I might want to
do I like
and you you have a string here that can
do anything the database can write well
what's nice about this is you can
actually conditionally create this so
for example I could say can't delete
query is equal to this as long as they
don't call execute I can keep adding
things so I might want to say if some
condition like ID is equal to 5 then I
want to say dually query I can say and
where and what that does is it adds and
and on to this so I might want to say
and I'm just gonna comment this out
so we're deleting I'll silly by ID and
if the ID is 1 because that's the only
idea we have I want to look for email is
equal to email email Bob Bob calm ok and
if you open this up it'll actually show
you the queries that are getting run so
if I go here history I want to create a
user all right we got user and his ID is
3 so if I tried deleting a user with an
ID that is not 1 so delete user ID is 2
for example oh you don't have logging on
I want to show you guys logging so let's
turn it on restart its nicely
color-coded which I really like and
what's delete so here's us deleting a
user and I don't seem too late I'll turn
it again all that's sad for some reason
the deletes not showing up oh that's why
we never call execute so after you do
this here make sure you call execute at
the end
delete query execute and I'm gonna wait
that all right so now we should actually
execute a delete query BAM and now you
see delete but notice you don't see the
email part but if I do email one or
sorry ID one we now have an additional
ant so this query builder I liked when I
want to conditionally kind of make
queries or deleting things and this
works for not just delete but update
insert and select so take a look at the
query builder it's pretty nice for doing
these credit operations as well because
sometimes these functions will not work
just the user update by ID stuff but one
nice thing and you know we'll probably
get to that in a different video you can
actually add methods on to this user
class and call them so that's another
type of doing it but that's it for this
video guys that's some the crud
operations that you can do let's go
ahead and comment this out and keep what
we had before yeah I think next we'll
get into how to do relationships with
this so many to many and that sort of
thing that's it for this video guys
thanks for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>