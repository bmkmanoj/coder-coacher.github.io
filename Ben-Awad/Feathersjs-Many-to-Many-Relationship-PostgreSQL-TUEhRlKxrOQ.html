<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Feathersjs Many to Many Relationship PostgreSQL | Coder Coacher - Coaching Coders</title><meta content="Feathersjs Many to Many Relationship PostgreSQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Feathersjs Many to Many Relationship PostgreSQL</b></h2><h5 class="post__date">2017-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TUEhRlKxrOQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys welcome back in today's
video I want to show you how to set up a
many-to-many relationship and feathers
Jas so right now I'm in the index folder
of services so down here and I just have
basically a simple feathers GS server
and I created a few things right now I
have three services I have that I
created course student and student
course so of course in the student are
the relationship or the services I want
to relate so of course a student can
take many courses a course can have many
students so as a main to me relationship
so the first thing I want to do when I'm
setting up this relationship is it come
on to this index file and then set up
the associations now this part right
here is going to set up the associations
it's going to go through each object
model and run the associate method which
we're gonna add to our object models
coming up and then we just save it to
the database with this line right here
and it's important we have this below
our configure because our configure
needs to run first so next we just go
into our user model and we make sure we
get rid of the sync and you're gonna do
that for every single one of the models
just get rid of the sync here the sync
for a student model too so I'm gonna
start off with a student model and show
you what's going on here so I made two
attributes right here first name last
name for the student and then I set up a
class method associate and this is
what's going to be called when we saw
the associate method being called before
and what's gonna do is we're gonna be
setting up an intent in relationship
with student and courses so student
belongs to many courses now student is
coming from here and then belongs to
many is setting up a many-to-many
relationship and then we're getting
models from here and courses this is the
name it's plural that's important of our
other service that we want to relate it
to then we need to pass a through
basically property and what this is
saying is you when you set up a m2m
relationship you have to set up another
table in the database
and this will be the name of the
database table so I'm just calling mine
student course you can pretty much call
this whatever you want and it's not that
big of a deal um and then I said before
and key this is just the name the
attribute that's gonna be created in
this table so basically there's gonna be
a table created called student course
and it's gonna have a student ID in
there and this is gonna be referenced
later so this name is more important and
I'll tell you where we use student ID
okay so we set up this class method and
associate so we're good on this side and
we actually need to do the same thing
for course model so when we go into our
course service we need to set up the
exact same thing and it'll just see I
inversed it so now it's course belongs
to many models and students you know the
students plural and then notice I change
the foreign key to course ID because
this is going to be a course ID that
we're gonna be associating it to and
notice I use the same table name that's
important you know one make sure they're
doing the same table so this student
course table it's going to have a course
ID and a student ID and basically that's
what it's gonna map the relationship
okay so we have both of those things set
up and so if we were to run and create
our database you'd set up the schema
nicely but there's one other thing
that's very helpful is to create hooks
for both student and course and their do
the exact same thing you'll notice all I
do is I set up a sequel eyes attribute
and I include the courses model here's
the important part right here I'm saying
I want to grab the courses model and
just basically make this student aware
and as you can see if I go to my index I
set this up for all relationships or all
hooks and I did the exact same thing for
my course hook but I named it students
and I'm getting the model for that so
now when you basically create a course
or student you can also supply the core
source to it and I'll show you more of
this of how that works
a minute so let's start with that and
I'll show you what this looks like if we
run some JSON or some queries or
creating some as well
so here's one possible request that we
can make so I'm gonna be going to the
courses endpoint
I'm posts I'm gonna create this and as
you can see I can create a class I'm
gonna call my class databases and it's
gonna have these three students in it so
it's gonna do this is gonna do four
things it's gonna set up a actually five
things one it's gonna set up a a course
named databases then it's going to be
setting up these three it's going to be
creating these three users and then
finally it's gonna associate these three
users to this database class so we run
this as you can see now we have a
databases with an ID of one and then we
create these three students now we can
also do the inverse of this let's say we
want to create a student will call them
foo bar notice we're posting students
and we want to basically get tell them
create some courses and assign him to
these courses we can do that with this
request right here it's a go to body and
as you can see we have two three four
these are the new classes that we
created and we have a new student now
and notice I can also do get requests so
I can say get students for and this will
get the fourth student and that's the
guy we created just right here and you
can notice the classes he's taking
program one calc two physics just as we
created over here and I can do the same
one for courses so I can get the first
course and see what students are in this
course so in databases I can see Bob one
Bob - and Bob three if I good of course
- you can see what the course is program
one I can see just this one student is
in there okay now the last thing I want
to show you guys is what if
I created a student foo bar and I
created a course database and I want to
add foo bar to this databases class how
do I do it I've already created a
database I've already created a student
so I can't just like the the notice this
is not basically just associating two
entities it's actually creating them and
then associating them well if we already
have two that are made and then you want
to associate him so to actually do that
we're gonna set up a custom service that
I did so I made a generic service I
called it student course and the only
thing that's special about it is if we
go into this index route I created a
create function right here and you'll
notice I also change stuff stuff down
here so I'll show you that I called the
service student course and I just
changed the route to add student to
course so we didn't have an underscore
in the route and then I did the same
thing here
I made sure those are the same and then
I'm just passing in the student service
and the courses service because we're
gonna need this to associate them
together so I'm creating an object here
and I'm passing these and and what
that's gonna go is our constructor right
here and then it's just gonna basically
store that in an options dictionary okay
so basically when I call this route I'm
going to be passing in some data what I
want to pass is a student ID and a
course ID first thing I check is just to
make sure that their numbers I this is
just very basic error checking because
we're gonna be use this to get the
student and the course ID so the purpose
of this function is to relate student
with course or relate the course with
the student so what I want to do is I
want to basically add foo bar to the
course databases so when I call this I
do this get route here I should see
databases here that's what I would like
to do so to do that what I have set up
is this route
and this is how I accomplished it so I
do this two options I students so this
is the Student Service and I do dot get
and I'm getting the student with this ID
and now I basically have the student
that I want to add the class to and I do
dot then and then once we have the
student what we need to do is fetch the
course so I do this two options dot
courses this looking the course service
and I'm getting the course we want to
basically put the student in and then I
do dot then grabbing the course and I
say course dot add students and I'm
adding a student so what that's going to
do is it's going to add that student to
the course so now all we have to do is
post to this method to this route
passing in a student ID and a course ID
and it'll relate it for us so let's see
that in action so here I have this setup
so student ID with four is our fubar
student if I come here see fubar and
he's ID four and then course ID of one
is going to be our databases course that
we created already and we're going to
relate them so I'm just going to send
that and it just basically gives us back
saying it related it and now if I come
back over here and I run this I can see
databases is in the list of courses that
fubar is taken so that's how you set up
a one minute to many relationship and
you can start querying it posting to and
updating it this is a kind of a janky
method that I use sometimes to set up
because you notice we're doing two like
you you would think we could do this in
one basically call but you'll notice I'm
doing two calls I'm getting the student
ID and I'm getting the course ID and
then I'm adding it I'm getting the
student in in the course and then adding
it so there's kind of two three steps
involved may think you could do this all
in one
like sequel query I haven't found a way
to do it if you are aware of what way to
do it please let me know I'd love to
know how to do this in one query but
this is basically how I'm doing it right
now and projects just so I can get it to
work so I hope this helps I hope
you can now go set up your mage many
relationships and make sense and please
if you have any troubles with this leave
me a comment below and I'd be happy to
help you set something up see you guys
in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>