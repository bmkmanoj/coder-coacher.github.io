<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Nesting GraphQL | Coder Coacher - Coaching Coders</title><meta content="Nesting GraphQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Nesting GraphQL</b></h2><h5 class="post__date">2017-06-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Ffl1oWjSUF4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys welcome back in this
video we're going to be doing some graph
QL now I was going to make this video
yesterday and I tried to make this video
yesterday but I had a really hard time
stamp associations because I was just
doing flat-out the wrong way the whole
time so this is how you're doing
associations I did figure it out after
about I think they would you was like 24
minutes long I figured out how to do
associations but I don't expect you to
watch the whole video because that's way
too long for a couple lines of code so
I'm going to review right now what I did
to change the codes would be on github
if you want to get it now if you don't
know what this is or what I'm talking
about at all
this is a template I have for graph QL -
no js' server that opens up a graphical
endpoint allows you it's a graphic yo
server I'm setting up a node on it's a
template I like to use for setting up
and basically I'm expanding on that so I
have the basic set up and now I'm going
to show you how to do some things with
seek live with it and make some queries
and the what we're going to do in this
video is actually create a little like
suggestion board so we have a board
suggestion table and then we have a user
table so real quick I'm going to just
run through on the relations and how
they work so we have users who can
create boards so that is a one-to-many
relationship a user can create multiple
boards and that's what this is doing
right here user dot has mini and to
create the Association you do name of
your table and then dot associate and
then you have to do this function here
and inside of that you actually do all
your relation and we're also doing a has
made relationship with suggestion so
users can create suggestions that go on
boards you'll see another relationship
between boards and suggestions and a
user can create multiple sessions but
it's a one Tiffany as well now you see
how we have foreign keys right here this
is just the name of the foreign key so
if we look at the board object or the
board table
we'll be an owner field which points
back to user and I can just show you
guys that real quick they go into piece
equal I can then connect to the database
which is what it gets test if test
extract ul is what I called it and if I
do select all from and the table name is
board boards means you have an owner and
you would see the same thing if we did
it for the suggestion we'd have a
creator ID so that's what these names
are right here okay so now board we just
have to give it a name field and then
this has a has mini relationship with
board which is one too many
oh sorry with suggestion so a board
contains multiple suggestions a board
can have 10 or so suggestions are as
many as it wants really and then there's
just suggestion which is a plain just
text and that basically point that's
attached to a board and has an owner it
so those are all our objects we add
associations to them you'll notice that
Association the board the same weighted
with user and then once I do that once I
add multiple I guess models or tables we
import them all we do see flies import
kind of how like we are doing a user
before and we don't need these console
logs anymore and you should have a
commented out thing here and also I
forgot to mention if you don't have the
code for this templates in the
description below if you want it anyway
in the code I had this comp it out he
commented it and this is what creates
the Association okay so you guys are all
caught up and that's what I did
yesterday and I'll put the video in the
link description below if you want to
watch IPO too
okay so we have this setup what are we
doing next
well I'm just going to pop up over here
to terminal quit out of peace equal
we're not going to need that right now
and I'm just going to do an LS to show
you guys we're in the folder from
project and I'm just going to NPM start
we set up no demon so we're just going
to let that run and run our server okay
cool
so now we can actually set up our schema
so what I like to do is I like to first
set up the database like so I just
create all these tables then I like to
go to the schema create my types and
then I like to create resolvers so
that's what we're going to do so I'm
going to create two types here we
already have our user type and I guess
we should put these above makes more
sense type it's going to be board and
our board is going to have a name which
is a string that cannot be null that's
what the exclamation mark does and then
the board is going to have suggestions
and that's going to be an array of type
suggestion so we need to create a
suggestion type so let's do type
suggestion and suggestion is just going
to have text which is a non null string
okay and this is going to have a creator
ID which is string and actually what we
can do we're going to just get the
Creator and this is going to be a user
so we can get the creator of the
suggestion and that's going to be a user
and then board board has a lot of
suggestions and then our user and
actually for board we can get owner as
well which is a user and then for user
we can get a board or get boards so this
is an array of all the boards they own
board and they can get suggestions to
this will be a list of all suggestions
that they've ever added okay so I think
this is pretty good for our types here
I'm not going to worry about setting up
all these credits for each one you guys
kind of saw how I did the corroborations
for users if he didn't want to improve
this video I'll put a link in
description if you want to learn how to
do these credits
I'm just going to do them basically the
minimum I'm going to have to need to do
so for this
we can create we can keep all these
create user update to leave will do
create I'm not going to worry about
updating delete I'm just going to create
for each type so create board so to
create a board we're going to need to do
a user and for now we're going to get
more so I want to make a video in the
future that gets more sophisticated with
authentication stuff right now we'll
just pass in the username which is what
we'll so shall we associate the user to
the board so this is going to be a
string or and what we could do is
instead I guess this is better as user
ID and I guess we could do either let's
just do user username will be easier for
now and then the second part is going to
be the actual name of the board which is
a string and then I'll pops out a board
and then we can do the same thing for a
suggestion so user namely user that's
creating it and then the text book for
this suggestion and then we can have a
mutation for and suggestion are okay
when we create a suggestion we're
absolutely tying it to a board so we
need to also pass a board ID this needs
to be an ID because we can have two
boards at the same name I suppose or as
a user you're the user names going to be
unique okay
we're passing the board in and that's
pretty much all we need I think for
those two and now we're going to do all
queries for the rest of this we have
gate user here let's do it just get all
boards for a username actually big user
boards string and sleep board
and here we can do user suggestions
username string pass back and that
should be an array of boards and here we
should be an array of suggestions okay I
think this is pretty good I'll come back
if there's anything I'm missing I think
this is a decent start and this will all
be able to show the nested types how
this works because user is going to get
poured board has suggestions which you
can get suggestion which link can get a
creator and you can see they'll be like
a little loop actually that we're
creating alright so let's go to our
resolvers so there's two types that we
created they're going to need resolvers
will actually be those last because
it'll make more sense of view than last
so I'm just going to pull this side by
side so this will be easy to see and
we'll scoot you over so okay I don't
want resolvers over here I would like to
have the schema and well resolvers it
okay so let's do we can squish this over
because I really just need to see a
little bit of the schema so let's do
user boards so this is going to be a
query we can come copy this is going to
be a very similar user boards so it's
going to take two parameters oops I just
want primary username and we're going to
do this one we're not finding one we're
doing find all and the type as you can
see we're going to be returning board
you can't see it but that's where we are
so when we use the board model and we're
finding all boards where the username is
username and that's it and we do the
same thing for addition and actually
this will not work guys and I'll tell
you why in a second I'm just going to
fill out user suggestions because it's
basically you aren't doing the same
thing suggestion
so there's not actually a username field
for board right the only thing we have
on board is the owner ID right so if we
come back to we actually do need this
scheme of active board and user so the
board has an owner
and there's actually a foreign key back
so to make this easy for actually going
to change this back we'll pass in the
owner and we can just look it up by
owner and here we can pass an by creator
passing the creator ID we'll just do a
direct lookup creator ID so we're going
to want to come back and change this so
instead of user name I'm going to use
owner here and instead of this I'm going
to do creator ID through my schema okay
so these two queries should be working
now look through mutations so we can
actually see them delete user doesn't
matter okay and actually same thing guys
we're actually going to just like so
notice for create board we're taking in
a username and a name again owners
really what we want now that we're
looking at it and this is going to
create our ID and that we can actually
just do the exact same thing I believe
I'm not 100% sure on this but I'm
thinking this is going to work and
suggestion here as well and this is
going to be board and if there's going
to be suggestion okay let's close this
down now we're going to be done with
this page so we're getting the args
creator and sorry this is going to be
owner in name that's all we need to
create a board and then for this we're
getting whatever prams are there in the
schema these three and those are the
three parameters that we really need or
just passing them in to create okay
so I think we're pretty good and I'll
show you guys why there's one slight
problem with what we have right now
we're missing a couple of things so
let's start with some mutations so I'm
going to create a user first so we can
get this started
so I'm going to call this admin this is
going to be our main user here and we
filled the fetch see what we're doing I
think we Knight just have a schema
difference defined field map I was
wondering about that I have actually no
idea what this air is about let's just
double-check our schema
okay so we have create suggestion and
create board and this should just be
creates additional keyboard this is user
suggestions user board either boards
user suggestions judging user boards if
I did okay spelling looks right all of
these that's usually the biggest thing
that gets me keyboard okay this is odd
so I'm going to do the same thing as I
usually do when a bug like this comes up
I'm just going to go one by one comment
down so create suggestion you can't
really comment out what the heck
Oh username okay all the
went back to username all of a sudden I
wonder if that's causing a problem
I actually just clicked undo and because
I'm using a vin plug-in for this it
sometimes is a little wonky as we just
saw
I don't think owner is what's causing a
problem though should get a new problem
now okay I don't even think this
restarted is it not watching because we
definitely just saved stuff so if I get
rid of those two a new problem
definition field map what does field map
I want to just like get rid of all of
these I'm thinking that has to do has to
be a problem with one of our types so I
want to get rid of all of these and see
all right I'll do what's going on yeah
doesn't like that alright let's come
back uncomment or put back so there's a
problem with one of our types I'm
thinking it's because I'm trying to
reference the user type and the user
types down here and the user type hasn't
been made yet but I could be wrong but
then this user type uses a board so we
have basically circular references right
now so I think what we're going to do to
solve this is just get the get rid of
those two for now and see if we that
goes away no so what the heck is going
on
so the definition get filled I mean I
really think it's one of these types I'm
going to get rid of all these more
complicated types all those are more
complicated to referencing another type
and okay this makes so okay it doesn't
like one of the types put this back oh
okay good comes back I was afraid I
wasn't going to come back okay so I'm
going to put this back and we're just
going to again do the same thing okay so
we have these three we should be
crashing oh I haven't saved that's why I
was like we should be crashing because I
put the types back cool on gear devout
still crashing okay so we have two oh
wow
where did my user type view I actually
don't
justplease it okay so I'm going to get
rid of those now we should be working
right yep okay I'm going to put this one
back see if it's working it is I'm going
to put those two back and we expected
this not to work and I'm going to I'm
going to bring it down below here and we
have a problem again let's get rid of
both of them refresh it makes you're
going to put it back um let's I mean
both of them look like they're the same
thing
get rid of suggestions Oh interesting
its suggestions causing this to crash
okay no so there's your crash guys give
the suggestions here work is it because
there's a name oh my gosh
silly mistake always kills you always
kills you alright but pump this out back
out again peace should be inside know if
I have my since before they should be in
okay cool a build like I was saying
earlier guys so it looks created user
I'm going to show you there's a small
problem what we have right now
okay so user ID one that's we're going
to be using for things and you guys
remember I'm just at local hook three
thousand at graph iql that allows you to
do this so let's create a board let's
refresh not Auto completing okay owner
is going to be one and oh I guess it's
finite it to string oh no it's true
being a cool and was the other thing I
was supposed to do is there Auto can
guess there is oops
notice how this little sticker stays up
there name is going to be first board so
we're going to create that must have a
selection of subfield which oh yeah and
it will just ID and all of these should
have IDs ID which is an int okay cool
all right so you create this board
awesome so now I'm going to show you the
problem that we have it actually it will
create a suggestion on this so we have
creator ID is going to be one first
suggestion and then board ID is going to
be one all right unknown an argument for
create unknown argument name oh this
should be text cool created that so now
when we do a query and for example let's
get user user name it's going to be
admin notice what one of the types here
is board all right let's get all the
boards that admin admin has and of
course you have to select subfields so
let's get the ID I'm going to refresh to
get that to work the name and the
suggestions and the suggestions I'll use
the ID the text and yeah I'm going to
just copy that refresh so it
autocompletes better and let's run that
and oh look at that we get a null
caption let's look at why this could be
happening so how are we actually doing
get user well get user here we find a
user and we just return a user right
with this find one one or schema when we
find a user crew see right here they
have this board and the suggestion
attribute and we actually need to set
stuff up to actually be able to access
these because when we return a user it's
only going to have these fields so we
arm to have this field in this field
only sometimes though and that's where
it's
look at it's a nested type in there and
so you can do something like this so you
put your user type here similar to how
you have a query you know you've got
your query type in your query type right
here you can have a user type in this
outer section too and then you do boards
just like you have here and this
function is responsible for resolving
getting all the boards that a user has
will create a suggestions to so this
takes the same thing parent args and
then model and what we need to do is we
need to return the boards for that user
and suggestions parent args models now
the same thing with the board their
board we want to get I said we want to
get suggestions right so we're going to
do the same thing and we can also just
for the sake of this suggestion I can
get we can act here we can actually just
get the easy username easily create our
username will say sit down a resolver
over here you create you can have
suggestion here and we can get creator
username alright now we can just fill
these out so for this first one we want
to get boards so we're going to do board
here and then what we want to do is we
want to find all and here for do aware
and what are we looking for well we're
looking for all the boards where the ID
is equal to the user ID the owner is
equal to the user ID well how do we get
the user ID
well the through this parent
argument comes in parent dot ID is what
we can get it
oops and let's close that close that
close that where you format we're going
to reformat quite a few things
let's return here five five I'm just
getting rid of errors and I'll explain
what text going on okay I still have I
would expect this three format if we did
it correctly you don't AMA okay there
you okay so for a user
these fields are passed into the parent
so this parent has an ID username
created at updated field so we're going
to use that ID to fetch owner and we're
gonna do the same thing here models
thought possession dot find all and here
is going to be created I D cool those
two are good now here with board we're
going to do similar stuff so ending
models dot suggestions actually we can
copy this because basically that but
here rocking crear D we're getting it
from for ID which we get for ID um and
actually no it's not as anxious straight
ID I actually like breaking this out
let's do that here too because I'm going
to do another call
awesome and now for suggestion as well
so we're going to do models that user
dot find one now because we're not our
training array to remember we're so here
we want to get the username of the user
that as a suggestion so what we want to
do is actually this is cool I can show
you guys async/await like I told you in
so we're going to create this in
asynchronous function here so here we're
going to get a user and we're going to
do a wait and here this letter reformat
okay cool so model type user dot find
one we want to get it where the ID is
equal to creator ID pair actually let's
refactor this creator ID
all right so what tag is going on here I
put this async thing here put a wave
here what is going on
so async/await is a way to do this a new
javascript thing that makes it kind of
nice to do you know asynchronous calls
so this is an async all right here that
we are making to the database
when we put a weight right here that
means we wait for it to finish so we're
actually getting the return object of
user we're going to use your back we can
actually just grab the user name from
the user and then return username so
that's really nice right and so this is
equivalent to doing something like this
dot then X is equal to X dot username
but a single weight is so much more
beautiful it's also much nicer when you
have multiple of these that you need to
do which I actually want to show you
some cool things in the future where I
do like a double two calls at once I go
in parallel I mean some cool stuff is
going to be coming out soon with this
stuff but okay we're all done with this
and notice how this is kind of weird how
this is working but I'm going to show
you the beauty of this and why it's
actually nice because notice each one of
these is a database call and it's an
extra database call but what's really
important about it is we don't make that
database call if they don't call if they
don't ask for it like if I'm just
getting my user and I don't want to get
the board I just want to get to my
username as the user even though I have
the user here you know maybe they want
to create it or whatever whatever they
wanted they could just get that and
they're not doing the extra database
calls to get boards and to get
suggestions but when I do this we are
doing database calls so basically just
and you can notice look at this chain
down and now here I can even chain this
one more level you get the user and
create a username so copy refresh get
user name and you can see that's admin
right here and you could add more
suggestions and you can get more boards
and you can see it just stack and you
can see it chain all the way down so
that's really cool I'm going to do like
just a quick rework of this and show you
I'm kind of curious myself to see if
this can go like full circle so I'll
show you what I mean by that
so in suggestion here instead what if we
just put creator like pass back a user
see if that crashes that career use your
name define a resolver okay I will call
this user and I'll be lower case
suggestion not user oh I call it creator
there alright so it seems to work okay
now we don't need to make this async and
now I can just return that with a comma
here awesome and now here refresh and
the reason I'm refreshing because if you
notice with graph iql graphical it um
autocomplete and so when the server
restarts you also need to restart here
to get that new autocomplete so creator
and now it's a creator notice this is
the same object Mehan up here so I get
the boards which think it's ID the name
suggestions which then I could get the
ID and a text okay well I've never done
this before look at all this nested junk
that's happening we get first board
inside of board I don't know if you guys
are following this because this is
actually getting pretty deep well
you just try to explain what just
happened so we have an admin user right
the admin user I'm getting all the
board's admin has one of the properties
of boards the suggestions we're getting
the suggestions that's on each one of
the boards so one of the suggestions is
search suggestion and then I'm getting
the creator for suggestion which happens
to be admin and turn out to username
here which happens to be admin here an
admin here has some boards and we can
get the boards and actually what's cool
about this and that's why and then we
just repeating right because from the
script this creator guys and so now
we're getting its stuff again what if we
have a suggestion from a different user
then we could get the boards that that
user grabs so you can see it can chain
it can be really cool but that's it for
this video guys
this is might be a little bit confusing
if you've never seen it before I
recommend trying it out and once you
code it it's start to make a little bit
more sense and let me know if you have
any more questions you can leave a
comment below I'd be happy help you guys
out and I have a lot of cool stuff
that's going to be coming out in the
future with graph QL so stay tuned I'm
going to be doing some more a think a
wait I'm going to be doing some I really
want to do some parallel calls so you
can make your database calls faster and
happen parallel get faster response
times and then doing some data loader
things if you don't know a data loader
is stay tuned could be pretty sweet it's
going to save a huge amount of hits to
the database it's a cool library from
Facebook
lots of stuff coming out stay tuned guys
hit the subscribe button below
any lets us interest you so you can get
notifications and it's out and that's it
for this video thank you guys for
watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>