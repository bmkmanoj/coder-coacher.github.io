<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Upload Files to a GraphQL Server using Apollo Upload | Coder Coacher - Coaching Coders</title><meta content="Upload Files to a GraphQL Server using Apollo Upload - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Upload Files to a GraphQL Server using Apollo Upload</b></h2><h5 class="post__date">2018-04-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/KQ_ty4A6Nsc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I've been mean to this video
for quite a long time now and I'm
finally getting around to it and that is
a updated tutorial on how to use Apollo
upload client so they made a change a
little while ago on how they do it and I
quite like how you use it now and if you
haven't heard of this library what it
allows you to do is send or upload
images or files to your graph QL server
so now you don't have to create for
example another endpoint that is a
regular rest endpoint or now you don't
have to upload things to s3 you could
just use this instead so we're gonna
take a look at how to use this so let's
jump into what it looks like on the
front end and then we're going to look
at the back end so here is and I tried
to make this as minimal as possible so
you can check out just exactly how the
upload link or upload Apollo upload
works so you'll notice we are creating a
using this function called create upload
link and that is pretty much the only
thing we use from the Apollo upload
client library and then what we do is we
use this link instead of for example an
HTTP link which you would normally use
when setting up an apollo client now
there is apollo boost now but you cannot
use that with apollo boost anytime you
want to use like a custom link so this
is a custom link we're getting that
breathing from this place you're gonna
have to use the Apollo client like this
and when you're using the Apollo client
like this you also have to specify your
cache so here we're using a in memory
cache so this stuff right here is just
initializing Apollo so we can actually
send up a graph QL request and then this
allows us to also send files as well and
then we just have our Apollo provider
which is normal which we wrap our entire
app and pass the client in so this
should look super familiar if you've
used a pol before the only difference is
you how you create this link you're
using the create upload link and by the
way you can still can cat things if you
need middle
or after we're in your Paolo link all
right so let's take a look at what app
does so one of my favorite libraries for
handling files at least in react is
called react drop zone so that is this
guy right here and what allows you to do
is just very simply have a drag and drop
a little kind of like a little pop-up
that you can add and we'll see in a
second not necessarily pop-up but like a
little box thing here that I can drag
files into or I can just click and it'll
open up so this is what drop zone looks
like so that is what this component is
and I'm using it with react importing
that with react drop zone and that's how
we're able to get instance of a file
because whenever someone adds a file of
this on drop is called and now they can
upload more than one file so you'll
notice I'm just looking at the very
first file that's what that's doing I'm
D structuring the array getting the
first file in that array and then
calling mutate on it and now notice I am
using a different syntax the rendered
prop from react Apollo so this is the
newest way to do mutations and I wrapped
this whole thing in a mutation pass in
the mutation that I'd like to happen and
the mutation that I'd like to happen is
over here so this upload file and
mutation now this looks pretty normal if
you've done a graph QL stuff before the
only difference is you'll notice my
variable is of type upload so this is
what allows you to upload files and
we're just gonna pass that as a variable
so this is our file object we're gonna
mutate and as a variable we're gonna
pass in that file and the name should
match up with the variable that we have
in our graphical statement right here
and so we passed that and then the
mutation running is upload file and I'll
show you the schema and stuff in just a
second and then again here's us using
just a rendered prop and here we have
our function
which is mutate and that's where mutate
is coming from the call right there
alright and that's pretty much all
that's really happening on the front end
so whenever a person now adds a file
this function here is gonna be called
and we're gonna grab the first file then
we're going to mutate passing in the
file as a variable and then this is
gonna send a graph QL request to our
server and this is going to be a
mutation we're gonna be running the
upload file mutation and so what I'm
gonna look at I'll show you next is how
we set up the server to be able to
handle this mutation okay
so here it is and you'll notice that I
am using a graph QL yoga so nice thing
about this is that already comes setup
with Apollo upload server now let's say
you're not using graph kill yoga I'll
show you what you can do so here's a
Paulo upload server this is basically
the companion to the client and you can
add some middleware so they have looks
like they have nowhere for koa and also
Express so you can add that or here's
some custom middleware for other things
so you're gonna just add that and it's
very simple to add that you just do that
and I guess you pass any other any
options that you want but graph QL yoga
array does that for us so we don't need
to worry about it and you know your
notice we have our type deafs here's our
schema so the one interesting bit is you
need to make sure you add this scaler
called upload and this is something that
graph QL yoga ready handles for us and
under the hood that is what Paulo
uploads server does and then here's
where you'll notice that matches the
expected type over here and our mutation
okay so here's our mutation I'm
expecting to get a file as an argument
and then I'm just returning true or
false whether I was able to successfully
upload it um we'll talk about this guy
in a second at the very bottom we'll see
I'm just starting up my graph QL server
nothing special happening here but let's
take a look at what the resolve
looks like for upload file so the first
argument or really the only argument is
file and what is this file object thing
right well it's of the type upload and
basically it's an object that is we can
await it and get a streamable file from
it we can also get the file name of the
file and there's this lowly function
that comes from a graphical yoga one of
their examples the called store upload
where we can pass their pass in a stream
and a file name and here we're basically
just calling create write stream and
this is from the file system and this is
a node package that's built into node so
if we look at package JSON my only
dependency is graphical yoga so this is
built in with node but what this thing
does right here is actually just save
the file to my computer so we have a new
promise and we're going to resolve or
reject this this is so we can make this
asynchronous and that we can await it
and know when we're finished with it so
we take that stream that we get passed
in and we're piping all the data and
then we're just writing it to this file
so whatever we put this is gonna be a
string and whatever we call that that's
the name of the file we're gonna save to
our computer so we can use the file name
that we're given or if we wanted to we
could just append like maybe a random
code at the end and then dot PNG or
something just like that or you can do
pretty much whatever you want there and
then here we just wait for it to finish
or to air out if it errors we reject if
it finishes it resolves and we can
actually we probably want to have a
lambda like that we could just do it
like this but anyway that's how that's
working so we just store the upload
after we get it and that's pretty much
all there is handling files on the
server side so again just to recap we
get the file argument we get the
streamable and the file name we just
pass that to this little function that
we made called store upload and what
store upload does is it takes the stream
right sit to our computer and then it
uses that filename so let's see this in
action now so I'm about to upload a file
and before we start take note here are
the files over here I don't know if you
can see them right now I have no PNG s
or anything and I'm just gonna upload my
Teemo image and I didn't really add
anything like hey it worked so we're
just gonna come over to our server and
we can see there's now a Teemo that was
saved and I can click on it and sure
enough we see our image did upload to
our server so awesome so that's it for
this video guys I hope that gives you a
better idea of how to use Apollo upload
client and now you can handle any kind
of files being uploaded to your server
and again you don't have to just have
one argument of file you might take
other things also in your mutation and I
could take multiple files as well or you
can do a list of files there's lots of
cool stuff you can do with this it's
actually very handy and all the code for
this is on github and as you can see
it's very simple the back end so it
should be pretty easy to understand so
if you want to check it out the links
are in description below
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>