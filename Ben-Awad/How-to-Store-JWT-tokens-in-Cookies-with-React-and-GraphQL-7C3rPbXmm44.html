<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Store JWT tokens in Cookies with React and GraphQL | Coder Coacher - Coaching Coders</title><meta content="How to Store JWT tokens in Cookies with React and GraphQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Store JWT tokens in Cookies with React and GraphQL</b></h2><h5 class="post__date">2017-09-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7C3rPbXmm44" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys in this video I'm going to show
you how I switched over my application
that was using local storage to using
cookies for storing the JWT token so
right here I have the reactor plication
up and I basically and adding one little
option to my network interface for the
Apollo client so this is using graph QL
and I'm using Apollo to send graph QL
queries and in here I'm just saying
options credentials include and what
that I'll do is I'll actually
automatically send the cookie to the
server when it's making a requests and
notice how I got rid of after where and
before where for the network interface
because I no longer need it
cookies are automatically sent to the
server for me which is super nice so
this is the only thing I added to the
client is just this little options flag
now over here I have the server the
server I had to do a few more changes so
here the first thing I had to grab
another package called cookie parser
this allows me to parse the cookies and
read them in and use them in the Express
application and I have that down here
I'm saying app dot use cookie parser
then I have add user you also notice I
changed how the cores works I used to
have a star here and now I change that
to the origin view this is where the
star would be I changed that to the
actual localhost 3001 this is where my
client is running on and that's
important for sending the cookie and I
said credentials true that's so it can
read and send the cookie okay and then
in my add user I changed how that worked
now instead of reading from a header
reading from the cookies this cookies
object gets put there because we are
parsing the cookies thanks to our cookie
parser we have right here so we can
access it from rack cookies token and
we're doing the same kind of check if a
token was not passed in we say next
otherwise we come in here we can read
the token from the cookies we get a
refresh token and actually send a
cookie back to the user whenever we want
to refresh the cookie we say res doc
cookie and res is for response and we
set the token here now important I'm
using issue P only cookies that way on
the client side if I have some malicious
JavaScript running it cannot change my
cookie so we have that I'm also setting
max age the max age here is seven days
to match how long the Refresh token
should last and that is how I'm saying
the cookie and sending it back and if I
come in here to my resolvers you also
see I and my login I'm setting the
cookie here and I'm saying res doc
cookie token res doc cookie refresh
token I'm passing in the tokens and
saying HP only cookie as well so that is
how is working now I want to show you
this in action how this works
so right here I have the application
running so on locos 2001 here's the
cookies pull up you can notice it's all
blank but if I type in my login we go
ahead and run it you notice how the
cookies are automatically put here for
us this is we're not doing actually any
JavaScript to put this here javascript
actually can't act cuss six cuz we made
an HTTP only cookie when we have our
resolver that was getting run for login
this res doc cookie here we're sending a
cookie back and that's placed right here
in our cookies that's what's doing it
for us so that's really nice we don't
have to do that and then next thing is
if I want to go to now an authenticated
place and actually I can show you guys
the request itself and that'll make
sense as well so this is the request
it's a post request you can see in the
response headers
it says set-cookie set-cookie that's
coming from the express server and
that's why these things are probably it
okay so let's now try to hit and
authenticate in points of book slash one
I'm sending over the token which is then
used to authenticate this request and
then serve this page because you need to
be authentic
to be here and yeah so then these tokens
are used for authentication and they
will automatically refresh thanks to the
code we have over here with that so
that's it for this video guys that is
how I change it to use cookies of local
storage in the next video I will be
doing double submit cookies which uses
local storage as well as cookies to make
it more secure the code for this is up
on github and I'll have the link in the
description below thanks for watching
guys
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>