<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GraphQL Subscriptions with ReactQL | Coder Coacher - Coaching Coders</title><meta content="GraphQL Subscriptions with ReactQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GraphQL Subscriptions with ReactQL</b></h2><h5 class="post__date">2017-06-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wmmqdXWEb1E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what's up guys so I'm going to be
showing you how to set up graph QL
subscriptions on the client side I'm
just going to walk us through the setup
here for you can be a palo library now
this assumes you have a graphical server
setup now I have a previous video where
I show you how to set one up and get it
hooked up so it's ready to use
subscriptions so I'll put that in the
description below if you want to grab
that off of github you can follow along
I also put the video if you want to
watch and learn how to make it so this
assumes you have Apollo data set up on a
react project too for this I'm going to
be using react QL if you guys have been
following me you'll know you'll know
I've been working on a project that
looks similar to this let's not really
project it's very small that's looking
ascription below so you can get the
starter code so you can follow along and
you can do the subscriptions with me so
we're going to just go ahead and dive
right into this so the first thing we
want to do like it says is install so
I'm going to pop over here to my
terminal and I can just paste it in here
if I wanted to and I'm gonna do it
slightly differently I like to use yarn
some of the yarn add subscriptions
transport and of course you can just do
NPM install if you prefer okay we're
going to let that run and that's fine so
now we are going to copy this next line
and we're this is where we set up our
subscription so we need to do this
wherever we have Apollo set up if you're
following along standard kit lib and
then Apollo and then we're just going to
paste this at the top now we're gonna
have to change some things now if you
follow along with me you'll know you'll
know and you'll also have your server
your subscription server which is at a
different port number step 3000 and it's
port 3000 and is subscriptions that
these subscriptions are out so if you
remember when I was talking about the
route you create you want that same one
that you put in the server side here
you'll notice I'm using the same thing
we go to the projected me it 3000 slash
graph QL is my graph QL and point this
is a different location where my
subscriptions endpoint and you also
notice we put WS at the front because
it's going to use WebSockets
that's what ws stands for alright so we
have our client here now we need to just
add it into this so instead of creating
a just putting the network interface
here we need to also add in so use
subscriptions to so we just need to copy
this guy we can actually just copy this
whole thing but we're not going to use
most of it it allows to just take the
things we need sorry that did not copy
everything back alright so we already
have this imported we'll import this so
we're importing subscription client and
then the ad we have this this is the
thing we need to add so we'll put that
down here and then we don't need any of
this thing okay so I probably need to
paste all that stuff but basically the
things I added was do add graph QL
subscriptions and then what we're going
to do is we're going to say add graph
heal subscriptions patch their network
interface and our web socket client and
we get this new network interface with
subscriptions and instead of putting
network interface here we're in a center
network interface with subscription and
we're going to here so now we're all
good to handle subscriptions now now we
can subscribe to as many subscriptions
as we want to so now we actually need to
create our subscription I'm going to
create a new folder inside of source to
house all my subscriptions I'm going to
right so we'll create a new one called
user added
jql and then let's come over here to
graphical and actually create this
so like a query right we would type it
like this or a mutation we type it like
this subscription we're going to go like
this and we're going to type our
subscription user added and then we can
specify what we want back
so for me my user add subscription
returns a user so my user I could get
the ID get the email if I wanted to but
all I really care about is the username
and the ID as well because we're using
that so I'm going to copy this paste it
and my user added subscription and then
we're going to use this in our app over
here so I'm going to come up here to the
top you get make a little comment here
graph QL subscriptions and we can paste
it in user added and this is going to be
the subscriptions path and then user
added okay
so we're actually going to be doing
stuff over here and our graph QL message
which is poorly named I should read type
that but we're calling the all users
query all users query grabs all the
users so our subscription updates this
query so whenever we get a new user we
want to update this query and add a new
user to all users that way we can
display it right here you can see the
new users added so like it says right
here we're going to use the subscribe to
more to do this so we already created we
don't have to follow this part because
we added our subscription but down here
we're going to do something very similar
to this but not quite this so I'm going
to show you guys with reactive tools I
come over here and I come to react I can
actually see and we want to look at
graph QL message right here alright so
data
all users just data we want to call this
subscribe to more function so this is
going to be under this dot prop data dot
subscribe to more so we're going to do
component will mount so whenever this
component mounts we want to subscribe
and we're going to say to stuff prop
side data dot subscribe to more and then
you come back over here we're basically
going to do the same thing that's
happening here we can copy this whole
thing here we're going to change all
this stuff out with our user so they're
calling subscribe to more and you'll
notice our like you see I'm doing this
dot props the data that subscribe more
there example they do it like this
now you're passing the props and what
they're doing here is instead of calling
it like I am and calling the subscribe
to more directly you'll notice see
they're calling subscribe to more but
they're just giving it a new name so
then their props they're creating a
subscribe to new comments so it's easier
to call but personally I prefer this a
little simpler because this is kind of a
gross little just like combination of
objects inside functions so I prefer
just doing it like this alright so our
document this is our we can comment this
not comment I was going to have it over
but what tab it over in a second so the
document is the subscription itself so
this will be a user added for us so this
is what we created in over here and we
don't have any variables for our
subscription but you would add it here
if you had any and an update query what
we're updating is this query right here
all users so this is fine
we're checking if there was new data if
there was if there wasn't any new data
we returned previous previous is just
what basically what all users is equal
to so if we come back over to here Oh
no work so I'll show you in a second but
Creve is basically as an object so preb
is basing the object it looks like this
there might be some other graph QL
thingies in it and let's comment sound
like that is an object it has all users
which is our array of users right and it
might have another query in there that
might be an object or whatever all the
all your data that you're gridding from
this query is in previous so here you'll
have Bob 1 Bob 2 etc all the other users
that are ready in here
so previs will have all that stuff there
so this makes sense we're checking if we
get any data this is the subscription
data is actually the object so we're
going to do dot user added and what this
is going to return is the actual user so
this is a new user that was just added
and what we're going to do is none of
this object to sign garbage that's
really ugly we're going to use the nice
ESX re a sick / I don't know if this is
in five and comment that over nice and
we can tab over this
okay so what we want to return is the
previous value and then what we want to
add on is our new user right but we want
to add that on to our all users so we're
going to say all users is now equal to a
new array with the with preb dot all
users and we're going to expand it and
then at the end we're going to add a new
user and if you wanted to and I'll show
you as this you could add a new user to
the beginning if you wanted to as well
and just to show you that subscriptions
is working here I'm going to actually
just comment out / delete
I actually just going to delete the
optimistic response and the update that
we were doing to show you guys that this
mutation is getting updated because of
this subscription that we have here and
re-save let's see there's anything wrong
we'll find out in a second if we didn't
do anything wrong with this our
subscriptions should be working so now
if I add something from this page
another user and hit create user BAM
another user pops up there and just to
show you guys real quick we could have
added the new user to the beginning of
our list if we wanted to so first place
we'll call him oops first place and
you'll notice he pops at the front of
the list so you could put this wherever
you want it but now to show the real
power of subscriptions we're adding
users from our page here
what are adding users from you know this
page over here
my graphical interface right I want to
add sushi to the list so I just have
this user here and if I problem here BAM
sushi shows up and what's even cooler is
what I can do so I can open up in a new
tab will do incognito so it does where a
new user you can do these side by side
and this is really cool so any change I
do on either of these it reflects in the
other one so hey guys
and you'll see hey guys pops up here hey
guys pops up here and it doesn't matter
where I'm calling this from hey guys
again I can do this from graphical and
BAM shows up over here your back your
application here
you see it again so no matter who is
calling this who's creating a new user
we see it no matter what page we have up
and it all updates all at the same time
that's really cool and that's the power
of subscriptions all right so that is it
for this video guys I did it with react
QL I tomorrow I'm going to be doing it
with next J s depending on how hard it
is I'm going to give it a shot
next yes is slightly more complicated to
set up with graph QL I'm thinking and
setup and should be too bad we'll see
and I also want to try it with react
starter kit too and show you guys just
how to implement this and the other kits
because see how easy it was with react
ul it's actually gonna be very similar
with the other ones too I'm hoping so
yeah stay tuned for that and thank you
guys for watching let me know if you had
any trouble setting up subscriptions
love to help you guys get it working so
see you guys in the next video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>