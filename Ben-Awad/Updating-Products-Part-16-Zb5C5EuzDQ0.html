<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Updating Products - Part 16 | Coder Coacher - Coaching Coders</title><meta content="Updating Products - Part 16 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Updating Products - Part 16</b></h2><h5 class="post__date">2018-02-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Zb5C5EuzDQ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys in the last video we
experienced a little bit of a bug when
adding a product we'd come back to the
screen and the edit and delete buttons
would not show up and I figured out what
the problem was it's because we're using
flat lists and one of the optimizations
spotless does is whenever nothing
changes in the data it doesn't rerender
so our data wasn't changing what was
changing was the user ID so it wouldn't
update so instead of having the user ID
or the current user outside of the
products we're gonna map through the
data right here so what I'm going to do
is process that map and then I'm going
to create a new X so X and I'm gonna add
a new attribute to it called show button
or show buttons and we're just gonna say
this dot state user ID and we're gonna
do the same check we did below and then
we just say X dot seller ID so show
buttons will be true if the current user
is the seller and we don't need these
console logs anymore and now instead of
doing the check here you can just say
item dot show buttons so if we should
show buttons it'll go ahead and show it
which is gonna be a seller so we see
nothing change on our first render now
if we call this choose a image nice add
product BAM so we see it at the bottom
here we also see edit and delete still
there and let's try deleting one and
cool everything's working
all right so eliminates that bug what I
want to do next is actually get this
edit button working and so to do that we
want to go to a different screen kind of
like how create product works and just
fill out a form so the form is going to
be almost identical to new product the
form we have here so what I'm thinking
is creating a component called form
and putting the form elements here
components so I'm just gonna copy this
whole thing paste it in here now for
this the things that we need are non
graph QL related so we can get rid of
all this graph QL stuff and we don't
care about the products query it either
but we do care about is the default
state and now we can call this form and
I think we can just export default
perform don't think we need to graphic
you all at all all right so everything
looks good here change text is gonna be
the same the only difference is with the
submit we're not gonna put any logic for
the submit instead we're gonna just call
the props so we're going to say Const
Aires is equal to submit I'm gonna say
this stop props dot submit and so
whoever creates or calls this form
component it's gonna pass it a submit
function and we're just gonna pass in
the values so this let's state values
and they can do whatever they want with
the values here and then we're just
gonna listen for any kind of errors that
come back and we just say if airs and we
don't be get rid of this we can say this
let's set state airs so we update the
airs object if there's any errors here
now I think it's yeah we're just not
using airs currently there's no errors
we expect at least we're not checking
for errors right now so we can we could
just ignore this if we wanted to so also
here we could actually probably just
keep the whole thing as is I think
that's good too now new products we can
change up we don't care about
default state any of this
I don't care about onchange texts the
only thing we care about is a submit
function and what is it going to do it's
going to take some values here which
it's gonna get passed to it and so we
can say we can be structure the values
right here and it does a mutation and
then it pushes the products we don't
need pick image we don't need this and
we actually don't even really need to
have a component we could actually make
this just a function if we wanted to but
we can't have it like this and now we
want to keep the graph QL stuff down
there now we're just gonna have our form
component and this is gonna be upper
case doesn't look like you know I can
auto import this guy and we're just
gonna pass in a submit function which is
this dots in it and so he narrative all
these things here and then we can import
form and that's coming from dot dot dot
components slash all right so this looks
good so basically we just moved the
submit logic or kept the submit logic in
new products and move the form logic
inside a form so when we click Edit
we'll go to a new screen but when we
submit we want to edit new things and
also we might want to pass in some
initial values which we'll talk about in
a second so looks like we don't need
this either and leave that
let's give this a try and make sure it
still works so create product
all right and looks like it's added
correctly so it looks like it's still
good so now we can create a new route
called edit product J s and this is
going to be a route just like new
product we'll call it
edit product and we'll use the edit
product component so edit product let's
go ahead and import it so from our
products page so what really what we
want to pass to it is just initial value
when we go over their component Oh cuz
this thing has no content in it right
now
so we can copy a new product because
it's gonna be very similar to how edit
product works so we want to have the
form fields prefilled out so from our
products when we push this button so
edit here we're gonna say this stop drop
stock history dot push and now what we
want to push is two things
so the path to where we want to go which
is gonna be slash edit products and we
need to pass it some state which is
gonna be the item so react router Dom
lets you pass state and so now we know
which product that we're editing and
over here so how do we access it from
this guy so I'm gonna call this edit
product
and for now what I'm gonna do is just
can't find Oh call us today
I just wanna console.log the props for
you guys so we can take a look at where
the state is okay so scroll to the
bottom click Edit here and nothing
happened
my guess is am i using wrong syntax so
products
okay so path should be path name save
that and cool so now we pop over to a
different screen and ml product
component of type object I don't think
that's the air we're experiencing edit
form we want to push back all this looks
good I don't know why we're white screen
of death over here let's make sure we're
pushing to the right so edit product and
over here there there we go so I just
had an s wrong wrong we're out we were
going to cool alright so if you'll
notice the state is gonna be actually
passed to us in the props there is
location and state is right here and the
state we passed was an object of the
item so we have the ID the name and
picture URL so we can actually pre fill
the fields with that so let's do that
so again location and then state
so over here we're gonna pass initial
values to our form so initial values and
we don't actually use this prop
currently in our form so we're gonna
have to change that we're gonna say this
props dot location and state so that'll
give us the current item so now in our
form over here we can have a constructor
instead of setting the form or the state
like this so constructor drops and then
in the constructor you say oops super
passing in the props and when you get
rid of that there because it doesn't
like it and I just like because it's
useless so to make it not useless we
specify the state here but passed in as
our props is the default value now so
what we want to do is we can do dot
default state and then the only thing
that could possibly change is our values
so let's say values and we're just gonna
merge the arrays now you could just have
values equal to initial values or you
could merge them and we're gonna say
Const initial values and remember we're
not passing this prop in from our new
product so we can just set it to an
empty object as a default so game is
from the props so then I can say Dada
default state values
and then here we can say initial values
now the only thing I don't think it's
gonna work is art images so for that I
think what we need to do is in our edit
product put localhost in front of it so
here I'm going to pass in an object now
and why don't we just say on state is
equal to this dot problem so be easy to
work with so death up out state and then
the picture URL is gonna be what we had
before but now we need to put localhost
in front of it just like we do here so
grab that oops too much and so we're
gonna say state dot picture URL so now
we're just prepending localhost so it
actually looks like something alright so
now let's take a look at what this looks
like doesn't work at all so let's go
over to edit products we are supplying
the initial values and I'm just gonna
say console dot log this dot state so
either we're not getting initial values
correctly or something it is so the
object is ID okay so initial values okay
so notice how there's an object called
initial to how use inside of this so
it's it is not working correctly and
that's because I didn't do dot dot
thought right there we wanted to expand
this as well cool so a value of type
number supplied to text input expected
string so it looks like the price is
actually a float and it needs to be a
non float so over here we're gonna say
price is gonna be equal to state dot
price
and there's lots of different ways to
cast it to a string but here's one way
and we don't really need to console.log
there anymore so alright so this guy we
have all the fields already prefilled
out awesome so now we're going to keep
track of any changes that we make to it
and then really all we need to change is
our submit function now in this because
our form is good our edit products our
submit so instead of just calling a
create product we need to call it edit
product alright let's go ahead and write
out our mutation for edit product so a
mutation and here's where things can be
knowable and so the fields that can't be
null are the ID but after that our name
that might not have changed we're not
mean I even supply it so it's optional
so we're gonna say string and actually
we can just update product we can see
what we need here so price float and
it's also expecting a picture and again
we might not change the picture so
that's gonna be an upload and then we're
gonna just pass all these variables and
like we do any other mutation so name
name price price picture picture and
then from this we really just need to
I'm gonna go ahead and just get all the
fields back that way we can easily add
this back and the fields we care about
are the same ones here actually so let's
go ahead and just copy and I did not
copy
with there we go so I don't need that
and again the reason why we pick these
set of fields is because we want to
update our products over here and have
it match and that are those are the
fields that we're selecting not here but
for our products query at the top these
guys so you want to make sure those
match okay so this looks good so now
instead of create we're gonna have our
edit go ahead and delete the sky edit
product mutation alright then
up here we can pass in our variables the
only thing to check though is our
picture URL might not change so all I'm
gonna do is do like a little if
statement here so and I'm gonna say what
picture equal null by default and we can
redefine what picture is if we get a new
one so if this
then we know something has changed and
we can go ahead and set it to a react
native value otherwise setting these
look perfect this is not gonna be called
create product this is gonna be edit
product and we can just pass it directly
and I believe except for instead of push
we have to map so data dot products
because we're exchanging and on the
other of the comments so the way I like
to update an item in this is to map over
all of them
until we find the item we need to update
and the way we find it is by checking
the IDS it's equal to edit product ID
then we just put edit product in its
place otherwise we keep X so again what
this is doing is we're looking through
each item in the products until we find
the product we just edited which is this
is true we no longer want the old one so
we just replace it with the new one but
for all the rest of them all the old
ones are fine because we didn't change
anything all right the rest of this
looks good we push back to this let's
try this out and see if it works so I'm
just gonna edit one field at a time so
instead of this I'm gonna call this Bob
and we should put new text there
undefined is not an object all right so
this looks like it's coming from no idea
where this is coming from actually just
our props initial idea picture
undefined is not an object okay so
either this stop props initial values oh
I was thinking I was in the form right
now
and I'm not in the form right now to get
that it's location dot state all right
nothing seems to be happening error
occurred let's take a look at what
happens on the back end so this is where
if you guys remember I wanted to console
I like the product to see what that
value was ID required
oh we're not passing an ID in so let's
go ahead and do that that's something I
forgot so the idea is just gonna be this
stop crops that look and again let's go
ahead and just say grab the states so we
don't have to keep doing this this stop
Rob's dot location and then we're gonna
say it's just the state there and then
we could say state ID all right open
this up and also I'm just gonna say
product that way it's easy to find what
log statement that is will let this
restart and then we can go ahead and
make a change
all right so error cannot read property
ID of undefined so this is our product
coming from okay so this is exactly what
I anticipated so look how I have the
product like this right so what I wanted
to do was check whether the seller ID
was equal to the seller of the product
but we didn't get the seller from this
query by default so we need to query it
somehow and I'm not sure how right now
so I'm just gonna go ahead and console
or not consul pom at that out
and we'll go ahead and focus on that
next video can i press this again yes I
can
undefined is not an object evaluating
edit product ID looks like we
successfully come back from the server
okay but it doesn't look like the ID is
and that's in our update function so it
doesn't look like this is a thing for
whatever reason so the reason why is
probably because it's called update
product and not edit product update
product now the update should have still
happened though so we should see Bop and
we do see Bob here so very cool and
image did not get messed up perfect so
this is gonna be Bob too now
still can't find it even though we
updated this oh that would be my bad and
it's gonna be Bob 23 and ice we see Bob
23 show up here immediately cuz we're
updating the cache right here so perfect
so let's try doing some other stuff nice
let's also change the picture I want my
picture now to be this waterfall scene
and aren't cool I think we're good and I
don't care about this kid anymore so I'm
just gonna delete him I think we're good
with the edit like I said next video
what we'll do is we'll go ahead and get
the permission checking working so I'll
figure out how to actually fetch the
seller of a product and yeah so we got
edit working that's pretty cool and I
also want to get into filtering and also
eventually maybe some subscription stuff
so that's it for this video guys thanks
for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>