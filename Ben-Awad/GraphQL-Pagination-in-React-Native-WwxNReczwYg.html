<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GraphQL Pagination in React Native | Coder Coacher - Coaching Coders</title><meta content="GraphQL Pagination in React Native - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GraphQL Pagination in React Native</b></h2><h5 class="post__date">2017-07-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WwxNReczwYg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys so I showed you how to create a
list view and react native using file is
and you see it right here and we're
using infinite scrolling so you can
school for everywhere fetching data from
an API and I also showed you how to
create pagination and crack UL with
suggestions here so we set a limit and
offset and we can grab data results so
what I'm going to do is mix these
together today and show you how to use
your basically your own graph QL
back-end to power this react native
application now if you don't know what
these two projects are a hug links and
assertions below to get the code or
watch the videos to get up to speed on
them so I'm just going to hop over here
to terminal real quick and first I'm
going to start up my graph QL server
with NPM start I already have my react
native application up and running but I
do you want to do is go ahead into yarn
add react Apollo this is a library we're
going to be using to make crafts ul
requests from react native now I have my
project here
and I'm going to do is I must split this
up into two components so I'm going to
call that a pas and we create another
one called index yes and this one is
just going to export default and it's
going to actually import react from
react and then import from act so we're
just rendering the app here and the
reason why I want to create like this
separate index page is because we need
to set up a gradual provider or Apollo
provider and I want to do that here have
my app in like a different place so have
this here and now I'm going to go ahead
and import
some stuff from react Apollo
now here is the setup and options for
react Apollo we're just going to do the
basic one right here I'm going to copy
over and I'll paste and explain what
these stuff what this does okay so our
Apollo client here we're just basically
creating and then we're going to
actually put it in with our application
and we do that with Apollo provider so
Apollo providers should wrap your
application and you want to make sure to
call this you know any components that
need graph QL need to be in between the
Apollo provider tags all right and then
we also need to specify the client and
the client here is just we put this in
here so we can specify the URL to our
graph QL server so I'm going to go ahead
and just do create network interface we
can have this all online don't need this
and put the URI so right here what you
want to put is the place where you have
your graph QL server now my server is at
local post 3000 and I'm through HP now
this will be different depending on
whether your Android or iOS so important
to know iOS can access localhost Android
it's different I think it's like one
point nine one point nine two or
something I don't know I don't remember
exactly what it is but if you're on
Android you can try doing work with
hosts but it probably won't work for you
I'm gonna put a link in description
below of what there's like good Stack
Overflow about how you access will close
from Android emulator but since I'm on
iOS I locos will work for me and you to
slash their colon 2000 and in flash
crack ul okay so reformat everything we
got our correct thing here we got our
hollow provider wrapping our app so now
our app can actually make a graph QL
query
so let's go ahead and do that so I'm
going to get rid of those exporting it
here and go ahead and export default app
here and the reason for that is we're
actually going to need to wrap it with
some graph QL tags so we're going to
report graph QL and GTL go from react
Apollo and then I'm going to come back
down here and let's take rack ul and we
can call our app and now we need to
specify in here what our query is going
to be and I think our query is going to
be a little want to call it such a plug
it suggestions so now we need to go
ahead and actually create this get
suggestions query and you wrap it with
gql and right here in the middle is what
where we put our graph QL query we pass
it here and then we can access this
query from our application so good
suggestions here I'm going to go ahead
and copy this now I'm not going to copy
just that because we actually are
passing some variables say query there's
two variables we want to pass in right
so the first one is the limit so make a
dollar sign limit it's going to be a pin
and then the dollar sign offset it's
going to be an int as well and which is
cool and then we're going to pass in
these variables here dollar size limit
dollar sign offset and I'm going to grab
the ID and text so now I can copy this
query pasted here and now on my
component loads this query will get
executed now assuming I didn't do
anything wrong we should be able to come
back and reload our overhear application
and we should see no errors and nothing
should have changed right we're just now
making a call to graph QL too right we
haven't
the data or anything and okay we had
something wrong operation data wrapping
app is expecting variable when I select
routes past alignment so here we need to
get suggestions and then we need to pass
in the variables so the variables for
this are two so the limit the starting
limit is going to be zero or sorry the
limit is going to be what look how many
did we do up here results 15 so we'll
put 15 here and our offset isn't is the
one that's going to be zero so it stays
X and that looks good
now let's see if the air goes away and
accidentally clicked on so you saw that
just popped up actually clicked on one
of these reload wrapping is expecting
variable limit but it was not found in
props pass to Apollo
okay so it's expecting props which we
don't want to add right we're not
passing the props in we could actually
do that or not we could pass in limit
and over here in our index so limit
legal to 15 and offset is equal to 10 Oh
X or 0 I mean I thought we could pass it
just right here there might be a way to
do that this doesn't work we'll check
out the docs but I believe now we should
be passing you then okay I keep click on
on accident but okay we're making the
call and now we see this here so now
looks like everything's working we next
one actually render this in our list so
I'm going to stop fetching data
I'm not going to component will mount we
know long you're going to fetch data on
because we're going to automatically
fetch data with graph QL I'm here into
the page I'm going to say offset
loading we can keep that's fine and then
here are our fetch data is going to be
different instead of fetching data like
so and then setting the state with data
we're actually not going to get our data
from the state we're going to get it
from the props and then set state this
handle end looks okay we're not going to
be setting the state for data so we
don't need to pass in a function because
now we're just going to do loading here
and then this stuff is not going to
happen here okay so now we're going to
say this dot data dot our query name so
get suggestions or actually it's not
going to be this name it should be some
sessions some suggestions dot such I
think it's such more if such more looks
like it is and now we can pass in our
variable and the two variables is
expecting is B limit which we're going
to keep at fifteen in the offset which
is going to be this state the offset so
whatever the offset sat and then here
instead of handle n we're going to say
offset emerge a state offset is going to
be equal to itself plus state that limit
that way we're fetching you know we're
incrementing by the amount we're
limiting so we see new a new batch every
time and actually you there's one
problem with this I just thought of we
will not be able to scroll up I'll show
you guys the problem we're going to
incur in a second so let's just review
what our code looks like right now
so this fetch data function is now
first tugging and loading then we're
fetching more data and we're doing this
this data this should be coming from the
props you might be wondering how we're
getting this data some suggestions and
and that is coming from Apollo data when
we pass and graph qo here actually adds
that in for us it actually should be
like that I believe we're gonna remake
the mare's the first time we're going to
what I'll do is in the render function
we're just going to need a console dot
log this doc drops to make sure we're
calling all right stuff and then here
every time we get to the end we're
incrementing the offset and plussing the
one that which is good okay so i got my
flat list here now the data is going to
be coming from the props and it's going
to be dot data got some suggestions some
suggestions and this might be null so
when we are first loading some
suggestions might not be there so what
we're going to do is say const data is
equal to this dot props data dot some
suggestions or an empty list in case it
is null and then we'll pass in the data
here and then on reach we're past that
saying say all the same thing is going
to be put there but now we're going to
get rid of the image we don't have an
image with ours
and the only thing here is going to be
text item dot text and now text is
coming from this guy right here and now
we're also getting the ID what we could
do for the key extractor to actually say
get the ID and return that so could grab
the ID and return that that's a better
use of the key should be the index okay
i think we're going to get some errors
but with
so long we'll be able to fix them after
that and hey it's actually just working
we're actually going to be infinitely
loading which is not good because I
don't have enough items in my list so
let's go fix that real quick
we have graphical up here let's make a
mutation create suggestion creator ID
it gives five text I'm going to say
hello and then board ID I think was one
all right I'm just going to spam create
a ton of these things alright so we have
about 37 of them so now order your fresh
there should be more and now okay update
query option is required so we need to
implement update career for about that
but we're at least rendering more on the
initial that's good when I infinitely
column
okay let's implement update query so if
we come over here there's a section
called pagination or talks about using
such more and we're doing this offset
based so this is the exactly what we're
doing right now we're doing also base
and now we pass in our variables but we
also need to do an update query so I'm
gonna go ahead and copy this and we're
going to change it for what our data
looks like so coming up here this is
going to be passed into our fetch more
we're add a comma here so previous
results much more result looks like
you're just rude just returning this and
okay append the new feed ours should not
be called feed not sure what it's going
to be called so I'm going to do a
console dot log and previous result see
what the what that looks like
I think it should be previous results
and such more result much more I think
these are just going to be a raise I
think I could literally just do this and
then return that
but we're about to find out if this will
work okay so our update query for here
is there so this is if you don't
understand what the update query is
doing it's basically saying we're
fetching more data and it's saying what
do you want to do next how do you want
to change you got new data which we
they're going to give us here and you
have old data from a query you did
before how do you want to combine these
together and for us we just want to
Patrick wanna basically combine the two
arrays like so so let's see what that
looks like we're scrolling and nothing
is happening offset got invalid also got
a valid value null de business offset
should never be it oh limit here the
limit it should be hard-coded so at the
top here I'm going to say Const limit is
equal to 15 so down here when I said oh
I was going to say we're not doing it
okay yeah all the places we're using
limit we should just pass it and like
that that way we reuse it so then right
here and so this dot state dot limit or
a passion limit okay
now refresh it sing some suggestion
missing field some suggestion in this
okay so our update query didn't work but
when we console.log we should figure it
out and also I just thought of a better
way to do this instead of adding limit
to the top already passing limit from
the prop it's not going to change from
there so we should just be doing this
stop drop stop limit and same thing for
this guy okay now I'm going to come over
here to console and I can do react
native log iOS to see what is going on
so here we should see our two objects
getting
printed to the console and I'm going to
refresh because I don't think I need to
I need to have the console open before I
can do that all right so now we should
see them and we do so it looks like some
suggestion it's Center it's an object
with an array some suggestions so we're
going to go ahead and turn this off so
we'd be creating an object some
suggestions here which is an array so we
need to mirror what the data looks like
so this we're going to get some
suggestions and here we're do the same
thing and now we should be good so we
want our object that we're returning
here to mirror what we're getting from
previous result and if we refresh should
scroll and I think we're just running
out items but you'll notice how we're
able to see all the hellos I come back
over here and I'm going to add five a
bunch of times we can see scroll to by
now come back over here oh it's not
fetching more I thought it was maybe
because we already hit the end of the
list we need to just refresh but okay
notice how long this bar is over here
let's see if it gets longer yeah it does
now we're able to get to by see how it's
loading more thanks alright so those is
for this video guys we're all done we
can clean this up by getting rid of
these console logs but we got everything
working this is how you can do offset
based pagination and graph QL you'll
have your limit and your offset
variables and we'll use much more when
you fetch more you update with the limit
and offs that are going to be limits
stays the same the whole time but are
all set you'll notice we change in this
state here and just incrementing what
that value is and now that often I'm
incrementing by
limit you could you know you could
increase that as much as you want but to
the good one to do because then you
won't get any duplicates and then inner
update query we're just basically
appending whatever the results we get to
what we previously had that's it we keep
the loading the same but we have our own
you know paginate a list being displayed
this is our own we're calling our own
API to display this so now you can get
this to work with any data you want to
create it with display it there's one
last thing I want to do before I quit
with doing this video series on lists
and pagination I want to show you cursor
based pagination and this is very good
when your list gets big because right
now offset pagination is perfectly fine
but if you get into like the millions of
rows of data then it will not work a lot
scale to that very well it'll become
pretty slow I'll become super slow but a
cursor base will be faster for you so
that's what I'll be showing you guys
next and I'll see you guys in the next
video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>