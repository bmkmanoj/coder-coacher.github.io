<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Upload Images in GraphQL with React and Cloudinary | Coder Coacher - Coaching Coders</title><meta content="How to Upload Images in GraphQL with React and Cloudinary - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Upload Images in GraphQL with React and Cloudinary</b></h2><h5 class="post__date">2017-09-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6XI6nGGiSBw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I'm gonna be showing you how to
do image uploads with graph QL and react
now we're gonna be using a hosting
provider called cloud nari to host the
images now the reason why we want to use
something like this or a different cloud
provider like AWS and store it in an s3
bucket is because this allows us to
basically load images really fast like
it says and also transform them adjust
images so with cloud Neri that lets you
change the width crop the image make it
greyscale and many other things to
transform what your image actually looks
like so that's really powerful and
really nice service to use so I already
created an account and went ahead and
got my API key and all that stuff and
I'll show you what you can do with cloud
Neri so first I'll show you a little
example and I'll show you the code that
actually makes this work so here I have
a little form I want to create what I'm
calling a champion which has a name
which I'm gonna call this Teemo and I
can click on an image and upload it so
I'm gonna upload this picture I have
right here and then I'm gonna submit
this form and then it takes a second to
load and actually submit it and then I
see my name Teemo and I see the image
that we created now I can refresh this
or come to this and you'll see the same
image pops up so we are saving this
image somewhere and we are saving this
in the database as well so back to this
upload real quick how this works is what
we're first doing is when the user
uploads an image we're using what's
called a react drop zone that gives us
this little thing here right here and
when I click on it they have this little
pop-up come up and then when I hit
submit I take that file I upload it to
cloud in area and then I submit the form
with graph QL storing the ID that cloud
Neri gives me so let's look at the code
for that
so first I created two routes here this
is the upload route which you saw me
which has the form on it has the upload
component and I also have the champion a
route and this just takes an ID and it
goes and fetches the champion for the ID
so here's the upload component which is
a form and I'm basically just during the
state of my form a name and a file the
file being the image upload in the name
being just the string that they pass in
and they'll notice up here I'm using
graph QL to submit the form that's where
you see this and I'll show you that at
the bottom and I'm also using Axios
Axios I'm using to make a post request
to cloud Neri and then react drop zone
is this guy right here that creates this
little component okay let's come down to
the render component first and then I'll
show you what all these functions up
here doing so it's very simple of course
you're going to want to make a prettier
form this than this using CSS but we
just have an input form and then on
change whenever the person is typing
that's very basic I'm basically just
updating the state so the name's is and
the state here the name field is updated
as the users typing and then we have
this drop zone component and then we
have this on drop and all we're doing is
we're grabbing the file you can upload
multiple files we're just grabbing the
first one that they upload and you can
there's lots of different settings for
this that you can change only except
pictures and whatnot and so here we're
just saying update this file state with
the file that the person dropped in this
and then whenever the person clicks the
button to submit we're doing some
interesting stuff here so first we're
grabbing the name and the file from the
state and then we're creating form data
the reason I have to do form data like
this is because we're making a post
request to cloud an area what you see is
happening right here and to make the
post request to cloud nares API they
need it in the form data format so we're
doing form date form data and this is
basically the body of our post request
and we're appending the file and this
other thing called upload preset now
upload preset is a cloud Neri thing this
is something you want to want to create
when you go to and create a culinary
account you'll get what's called they'll
create for you a cloud name which is
what you see right here now I have mine
in environment variables so I'm not
revealing my basically my keys these are
basically you can use to upload and so
yeah these guys you're gonna want to put
it in with your own strings or Adam as
environment variables - I have a dot m
dot local file here that it's reading
and automatically for that but when you
create a colony recount you get a cloud
name so that's what you want to set is
your cloud name you'll see it in the
dashboard and then you have to go to the
settings and the upload settings and
create what's called an upload preset
this allows you to make unsigned
requests and then whatever code they
give you you set that as an environment
variable or you can just replace this
with a string if you'd like so that to
set that up and as you can see I'm doing
Axio stop post I have the URL here and
I'm just putting in my cloud name that's
part of the URL and then we're passing
in the form data passing in the file
that we want to upload and the presets
and then we're waiting for the response
and then after we get the response once
we we first upload the image right so
this is what that's doing once we upload
the image we actually get an ID back to
cloud an area an ID basically of that
image
so then what we're gonna do is we're
gonna store that ID in our database so
I'm making a graphic you'll request
right here that's what this stuff props
up mutates doing we're getting the name
which we got from up here in our state
and we're actually storing the public ID
so we're actually not storing the file
in our database but just the ID of the
file that's in cloud in area so that's
why we're getting the response that data
to a public ID and we're storing that so
we get that up here from the response
from cloud nari and then we go ahead and
make our graph QL request with that to
store it in the database then after
we're all done that's successful we will
just redirect to the champion page as
you can see I'm just grabbing the ID
here from the response that we just
created so I know which champion to go
grab and then here is the graph QL I'm
using to create a champion as you can
see I'm just using two variables name
and public ID and I'm just passing those
in I'm just asking for an ID back and
I'll show you the server of how this is
working in a second but as the server
doesn't see the file at all react
directly uploads it to cloud and airy
okay and then as you can see I'm just
doing create adding the mutation into
the upload component now this is the
cool part here this is the champion page
the champion page or component what it's
doing is it's doing a graph QL request
it's Duke calling this get champion
query and we're getting the ID from the
react router match parameters so come
back over here see how I have a four up
here I'm grabbing that with matched up
parameters dot ID but what i'm doing
here is i'm actually just setting the
variables in because this is already an
object called ID so the equivalent of
this would be that
I went like that that's equivalent to
doing this so all I'm doing is I'm
grabbing the ID from this params and
setting that as the variable and that ID
variable is what we use to grab the
champion and the database and then this
is the cool part with culinary that I
was talking about earlier where you can
actually we're getting the public ID so
we're loading in the data from our graph
QL server we're checking if we're
loading if we are we just do this little
loading dot dot and then if we're not
loading anymore we have the data for the
champion we got the name in the public
ID we're just gonna show you the name
and we're gonna go actually fetch the
image from cloud nari now the fetch the
image from culinary we say that cloud
name and the public ID of that image so
we're storing the public ID in the
database we just pass it here and I'll
grab the image for us now that's how
this is working right here and I I
recommend taking a look at a cloud meri
react that's that that's what we're
using up here to create that because as
you can see I can crop it I can change
the width the angle there's lots of
other things you can change about this
image to change up how it looks and what
you want to do with it so that's really
nice with cauda nari so I highly
recommend trying this out and playing
with image now let's talk about the
server real quick so the server is
actually really basic changes and
doesn't know anything about cloud Neri
and doesn't need to so this is my
database model for champion I have the
name and the public ID and I don't need
to store anything else
so my schema here I have the type
champion it's just an ID name and public
ID like you'd expect and here is get
champion I get past an ID and I pass
back a champion and then right here is
create champion all I'm doing is passing
a name and public ID and storing the
champion and here are the resolvers so
here's the get champion all I'm doing is
calling models that champion that find
one and I'm grabbing where the ID is
equal to the ID passed
and the same thing for creating a
champion very simple models that
champion not create just based on the
arguments passed and that's all the
servers doing right there servers not
doing much all the heavy lifting is
happening on react which is nice so as
you will see you're not actually
uploading the image with graph QL you
upload the image and then you pass the
ID to graph QL so that's what's
happening there so highly recommend you
give this a try culinary is nice as you
can see with the pricing they have some
free versions that's what I'm using
right now is this you can store a bunch
of images on this and do a bunch of
transformations which is pretty neat
so I recommend trying them out and
remember when you create you're gonna
get when you create an account to get
this set up
the cloud name they're gonna give you
and you should see in the dashboard you
just need to go ahead and go to the
settings and get create a upload preset
to pass this here so that's it for this
video guys this code is up on github and
the link is in the description below if
you want to check it out run it test it
out and let me know if you guys have any
problems with this or have any questions
about how this works and I'll see you in
the next video
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>