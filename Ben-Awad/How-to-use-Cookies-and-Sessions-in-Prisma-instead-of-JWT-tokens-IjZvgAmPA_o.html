<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to use Cookies and Sessions in Prisma instead of JWT tokens | Coder Coacher - Coaching Coders</title><meta content="How to use Cookies and Sessions in Prisma instead of JWT tokens - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Ben-Awad/">Ben Awad</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to use Cookies and Sessions in Prisma instead of JWT tokens</b></h2><h5 class="post__date">2018-04-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IjZvgAmPA_o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys I'm gonna be showing you how to
take prisoners authentication template
and instead of using JWT tokens and
storing it in local storage how to use
sessions and sending them and storing
them in cookies so I'm gonna be doing
this with the typescript template but
it's gonna be the exact same if you use
the JavaScript one so the first thing
that I did was I install a library
called Express session so this is what
I'm going to be using to create sessions
and I just imported it and then I'm
currently in the index file where the
server is getting set up so the first
change I make is by adding the session
middleware so right here here are all
basically the configuration for these
sessions but you'll knows I do server
dot Express this allows me to access the
middleware or add middleware for the
graph QL yoga server so I did Express
that use and here's me passing in the
middleware next a very important thing
to do is course so your cookie will not
be set if you don't add this there's two
things you need credentials and origin
origin is the location of your web app
or in this case I'm going to be testing
this with the graphical playground so
this is the location of that very
important you do not want for example a
star here because it will not work you
can also make this an array if you want
to pass multiple origin values but for
me I just want to access to the
graphical playground and then next
you'll notice I'm passing the cores in
when I start the server so this is
pretty much all the setup that is needed
for sessions next we can actually use
them so if I go over to off this is
where we sign up and we login so now
instead of sending a token back what I
do is after they have signed up I grab
the context object and if we come back
over here you'll notice we are actually
just adding it here so
here it is there so context dot request
dot session user ID so this is the
important part right here so this gives
us access to our session and then I can
put whatever key I want I called it user
ID and this is how I'm storing the
person's ID and I'm doing the same thing
on login and so the session middleware
will detect we made a change here and
we'll save a cookie for that user and
then I just changed the schema graph QL
so that way in the auth payload I'm no
longer passing back a token just a user
and then the other thing is in our post
you'll notice we're calling a function
called get user ID so we need to update
this this is looking for JWT tokens so
if we come to utils we can check out
this function called get user ID and you
notice you can actually simplify this a
ton all we do is we check whether this
session as a user ID if it does we
return it otherwise we've thrown off
here that's pretty much it that's how
you set up sessions in with Prisma so
first I want to now show you a example
of this working so here is a graph QL
yoga or not yoga playground I mean and
in my settings there's a very important
thing we need to add so for me it said
the word omit here you want to change
this to include that way that cookies
are sent back and forth so very
important there so first things first
here's me trying to create a draft now
notice in my cookies I do not have any
cookies set so this should say not
authenticated right if we look over here
it should check that the session and to
say hey man this guy doesn't have a
session created yet so it's shows mayor
so let's try adding this and we get not
authorized exactly as we expect so
perfect but if I were to say login first
so here's me logging in we should get a
user ID added so we notice an update
down here in the cookies we get this cue
ID which I added
and then over here on the right we can
see the normal response we get to use
her back so now if I try creating a
draft we're sending a cookie end so it
actually knows that we have a session
because I was able to get that ID which
we created over here so that's it so
that's an example of it working so it's
actually pretty simple to get swap over
your authentication to using cookies and
sessions and in my opinion I think this
is a lot more secure than storing it in
JWT tokens and local storage so that's
it for this video guys thanks for
watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>