<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Testing Metro Wifi | Coder Coacher - Coaching Coders</title><meta content="Testing Metro Wifi - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Testing Metro Wifi</b></h2><h5 class="post__date">2007-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/z--u-Bcbjl8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">they did a spin-off pyramid so today I'm
going to talk to you a little bit about
some of the techniques and tools that we
use to testing now a Wi-Fi network which
launched Alan said a couple weeks ago
and I think two pretty big reviews so
we'll go through to how automation
really helped a small team get this
network out onto the onto the airwaves
so first of all is is why did Google do
Wi-Fi alright that's actually a fairly
good question and part of it is
connected to our mission statement which
as you can see here is to make the
jacket for a world's information
universally accessible and useful so one
of the one of the motivations for Google
was to get other cities other areas to
implement Wi-Fi and so we wanted to be
sort of a test project to sort of go
through get some of the issues and
problems out there and maybe shoe help
people other cities who want to
implement this and so one of the things
we're doing is we're documenting all of
our process how we went through it how
we figured out where the issues where
the problems came up and we can help
them maybe make the city's more cities
do this the other big piece of it is is
we think that location based services
are going to get a very big thing and is
really until you have the network that
can give you a actor location and Wi-Fi
certainly can do that we you know you
can't get those started without that
kind of information so that's one of the
other other motivations for this just a
little bit of background so now you
the insula San Francisco is about 30
miles south of San Francisco home to
Google on seventeen thousand residents
thirty thousand homes a little bit about
Wi-Fi so the network is a 802 11 BG ab
work so any almost any device out there
will connect to it the range from the
access point Radio out to the client is
about 300 feet max give or take
depending on your line of sight with
obstacles there in the way and one of
the problems with Wi-Fi is that its food
for about one wall so if you're inside
of a house you know maybe in the front
room you can get it but simply probably
not in the bathroom
this is just sort of a general picture
of mountain view and as you can see to
the north of it is Palo Alto which is
another city on the pencil head south of
the descending down so it's basically
one sort of continuous urban area what
you're looking at here is the yellow
part is mountain view itself and we'll
all go a little bit more detailed but
they're the three red dots are their
base stations which are sort of central
location points for the network and then
the square box are gateways which are
sort of an injection layer and then the
round dots are actually the actual
wireless access nerds so here is a
network diagram started with the on the
left hand side is the base station the
base station is is three of those as i
said in the city they're connected with
fiber look inside the fiber loop and
then they also have their hands and back
up they have on to point wireless link
so we have a very case one of the fiber
goes down or the part of this link goes
down switch between us emanating from
the base stations is a
point-to-multipoint wireless link
basically the wimax technology that goes
out to a gateway the Gateway is a radio
which connects back obviously to the
base station but then connects up
actually to the mesh node and as you can
see the diagram the Gateway there is the
node with the info red and then it
meshes or connects wirelessly to the
other access points and then the clients
for pdas the laptops the Wi-Fi phones
connect up to the AV node
so this is what a wireless node looks
like it's a week we chose troppo cesare
vendor for the since notes it's a single
radio that two antenna so one water
transfer typical laptop is usually where
from 30 to 60 milliwatts you can get
some wipe out your peters which would
sometimes go up to 200 milliwatts you
can get some larger ones which may go up
to I'd say have to 500 milliwatts but
these are actually one block drinker
they're typically put on light poles
because you want the access points to be
high up able to have a coverage and
that's where power is to write very
important it beats power so not many if
you want something that's up in the air
they're not many other locations besides
light posts as a no they can survive on
a 22 caliber rifle in k so people like
to take potshots at this so this is a
picture of the injection layer so on the
left hand side is the panel antenna and
those on the base station and therefore
of those typically around each base
station and then the subscriber unit or
the gateway on the right hand side
consists of the Ventana that's their the
top is easily raised up like you see the
picture here and then at ruggles radio
which acts as a a gateway or router for
the nash cluster that's surrounded
so all this to sort of web of access
with this injection layer the base
stations injection layer and the AP
notes that covers the 12 square miles of
mountain we're done 380 nodes of those
out there covering the city with 1200
miles about 60 of those are these
gateways and then the other 320 roughly
our mesh radius the nice thing about the
net radius is they talk to each other
and so you can if you need another radio
you find the place that doesn't have
good coverage for the Wi-Fi signal for
whatever reason buildings trees he just
had another radio in and it will connect
up to the nearest neighbor that it has
and mesh back in the network so you
don't have to do any kind of network
planning as setting up Robbie tables or
making like that the traffic between the
mesh radios are is encrypted is actually
running a total mg between the radios
it's encrypted so for security purposes
so here's a picture of a gateway that's
on a light post you can see the triples
radio there closer towards the lamp end
and then be the intent of the connection
back to the basic the actual connection
from the best radio to your client it's
an open network so regional encryption
you just open up your notebook do PDA
deceiving SSID of Google Wi-Fi appear we
connect up to it and you're good to go
unfortunately we did pop our lawyers and
I was in state so they required that we
have have a logger for purposes of
tracking what users around
and I don't know exactly the reasons but
anyways we needed to have a login so
there's a captive portal when you
connect up to the network you open the
browser will show you a login page or
the google Wi-Fi login you use any kind
of google account activity gmail account
that's a Google login if you don't have
one you can create one on the fog and
use the net worth is there's no it's a
free network so there's no connectivity
problems just connected as I said if you
can then you can do on the floor so
we've now to have to wait or get an
approval DJ or anything like that you
can just start to need to know
so that we mentioned before one of the
problems with Wi-Fi is that it is fairly
high frequencies yes the frequency
spectrum so as you see compared to some
cell phones and some GPS devices and
this is one of the problems with why
doesn't go through all very well because
of the high frequencies so amen one sort
of the same pretty sea levels are you
have satellite problems so and you know
I know if you ever used one but they
also have problems you can't be inside
of a building so there so there's some
of the same act access issues so sort of
one of the interesting things is the
five dot for Wi-Fi grant which is
through a radiative actually scatter
better because better use the five back
for frivolously gigahertz and so they
didn't they scatter a little bit better
so they can sometimes a great deals
though around walls or free stuff much
more but that can also that the VA a
band also has less power greater power
dissipation so for the same amount of
power to be radios for partner but a
radius and scattered either sufficient
trade often and anyways we went with you
the beer it is forearmed client access
just a little bit about redundancy in
the network so as I mentioned for the
base stations the backhaul has a
wireless point-to-point link which we
used nicotine which comes in there you
can dear 1.2 gigabits per second link
through expensive but you know it's a
pretty nice link so
that's our I start back up for the for
the point point on our treasure of
bricks the mesh radio as i said before
our self healing so if a gateway it goes
down there lose connectivity Phil mesh
with other radios that they can hear
sometimes i will give longer hops so one
of the problems with the network is
beach time you go through a mess right
here physically you're cutting your you
bandwidth in half cause you have to
because these are single radio nodes
they listen listen to this and it three
times better so so we don't want too
many hops this is why we have as many
gateways as we have and then the
naturally goes connect up to
it's a little bit about the project team
inside Google they usually barely small
teams project manager of four or five
engineers and this is fairly typical for
Google and then you have their PR
marketing people come in I think one of
the things for the nice pieces about
that is it really gives the engineer
lots of say in a project you know you
really feel like you're contributing
there's not a huge team out there it's
basically pulling you in a couple of
colleagues and that really helps keep
the environment fresh ideas and
innovation and change projects depending
on whatever evil your gear moving less
per project so we sort of keep
everything over quite fresh so we
actually did install these notes onto
the mountain view going to the light
poles and on page we hired out a company
that specialized in wireless
installation and so they did that for us
and then we've also worked very closely
with tropos they've helped design a
network turns out it's actually fairly
tricky for a combination of where the
light posts are and where you want to
install these where the buildings are
you know all sorts of other kinds of
interference so you need to you need to
sort of have some professional help when
you do these insults and then the Google
engineering team we sort of manage that
whole process and then also there is
google software behind it the login page
is running on google servers and the
other pieces of the networker on google
software so that's
the engineers came in so testing so when
I came under this project I was told
well we're putting up a Wi-Fi citywide
Wi-Fi though tested so no important what
do you do so one of the problem first
thing you do is want to verify that the
network is operating correctly right
there's lots of different Wi-Fi devices
out there you want to make sure that
they help you connect to the network so
we have good coverage want to make sure
that the whole city the goal of the
project was to cover the entire city so
that was that was one of the pieces and
then also capacitor right so you know
you have a member of users and use the
downtown area beep that 10 15 20 people
in a cooperative radius need to be able
to connect it and they could get big
connection speeds so those were sort of
the two main things they wanted to focus
on one of the things that we were
initially concerned with was what's
called a wife are the hidden node
problem right so because the transmitter
was high up on a light post and is one
block you know really is broadcast and
listen to a lot of clients that are out
there but clients themselves may not be
able to hear each other right save that
on one side of a light post small PDA
client on the other side of the White
House maybe 200 reported feet between
them I've got a laptop and they may be
able to hear each other so they both
start talking at the same time this can
cause problems are because the
transmitter or the receiver getting all
the light post you know here's both
signal we'll get some time in a
conference interference so you want to
make so this was there's a well-known
problem is 15 we were you know worried
that because the transmitters were so
high up they would hear such a large
area that maybe they would be lots of an
affair
problem so that was that was one of the
issues that would certainly talked about
I first came under the project so solve
it to the test I design were to look at
that look at that problem so one of the
things I didn't worry too much about
what's they got coverage testing so
tropos is a fairly well-known outdoor
mesh radio builder and so they've got
several good tools to measure the
coverage and this crack here is actually
the latest coverage map so once again
you can sort of see the outlines of the
city the flu areas of where they get
what they're calling good coverage so
basically somebody took a radio in their
car and they drove all those students
basically thrown the whole city at about
20 to 30 miles an hour you can't go too
fast on those so so that was sort of
those additions as they were doing the
network installation they got stopped by
all sorts of policemen things like acted
or how people flip them off and stuff
with him driving too slowly yes anyway
so I think the coverage piece was pretty
well covered by the existing tools so I
really focused on the capacity piece
which was really there weren't very good
tools to do that and that's where I
thought I could really add to so as how
you saying my background is in
enterprise level Wi-Fi so inside of
buildings and stuff so the capacity
problem there is much easier you know
well we're not sure maybe there will be
20 people in this conference room so you
take 20 black ops and walk there to
conference room
it's not so hard you're trying to move
capacity on a citywide network a little
bit harder you know you can't just get a
bunch of Engineers a bunch of black
 walk around the city it's it's
just not practical so what I was
starting to thinking was that you needed
some test devices that would be able to
be sort of our economist testifies that
you'd be able to put out across the city
and have them help you do this ask you
test it so the test devices had sort of
the characteristics that i was out here
ready to be able to come up on their own
connecting logins on the network
registers something so that somebody
knows that they're actually there and
then be able to respond to some external
commands be able to run some kind of
true blood testing and generates enough
traffic to be interesting and it worth
you know all of never too expensive as
you can try and cover all silliness that
can be a lot of differences so what I
found after investigating things a
little there was that there's a big
trade-off between how the power or the
power came from a five devices which
would which would he put out across the
city just what about him out in the open
but those are those are a little bit
more expensive and that would those were
the PDA so they were built for running
on batteries doing extenders you can get
maybe 12 hours of battery time on them
look at cheaper we're taking some of
these from our home wireless routers and
converting them into test devices and
you know they've got a built-in wireless
nic you can run
linux distribution and they're cheap
available but there are certainly
obviously parts of the city that they
will be covered so so those are the
trade-offs that I found so we actually
went ahead and got some of each as you
can see the top two pictures there or
the linksys wireless routers wrtg 54g on
the left there just standard version and
then the the one on the right is a
little bit newer model that they had and
so weird look I was able to take those
devices running Linux distribution on
them and they then served us as test
points the temperature is on the bottom
inside of that for a box that you can
see the open picture is a PDA is a sharp
zaurus PDA the 5500 the number and able
to once again there's an open
distribution of opens ours which I which
I was able to load on those devices and
once again they were able to function as
a group of autonomous test devices for
me so then the next question was now
that I've got these devices out there
what kind of troop of testing that I do
on them and there are there are several
prizes are some commercial tools like
chariot and several other well-known
ones and then some open source once
things are I birth TT's CPD on that
it's like that so the problem with the
chariot which I really actually would've
liked to have run was that there was an
endpoint that were brought on the
Czarist but not for the police's open
donor t distribution area they didn't
have a compilation for the broadcom chip
the Knicks PL which releases runs so in
the end I see I chose to use iperf to
run my test just a little bit about
converting devices as i said before
example dude was actually fairly easy to
download the binary distribution to each
one of these and to flash it on to the
hundred devices and then grabbing these
modules i was able to build a really
pretty robust test Network test device
that could do a lot it had you know all
the powerful linux distribution with
perl using w get and sort of really
really satisfies all the conditions with
that when the important things to know
is each one of these distributions also
had an sdk some of the modules that i
wanted were could not find on the web so
i did go compiled with myself so we're
having an sdk available for each of
these fish edition books was important
to getting all the test tools on leave
spoil no dumpy on the PDA so the pjs
actually so there's a internal battery
on the PDA which gave you turn the
screen off you can get about five hours
of time on the internal battery I found
on the on the net battery extender which
is a little black box there which
there's four rechargeable raising and
able to get about five hours off the
back I also found a solar solar panels
which put on as you can see in the
picture there and you know as long as
there was light that was that was
available to run so when I found out his
food was I would take these devices out
in the morning put them out and spread
them around the section of the city that
I was going to test we're going to put
on the PDA side for the ones in the the
linksys once I would either try and find
some businesses goodbye there was around
me to put these in a window or something
so didn't go to too many walls but still
had arranged inside for the power source
and that was able to test the test that
network using these using these places
so once I had the test devices and all
the software awning that I needed I
needed to be able to make them
autonomous so I could just take these as
of the network put them in you know I
didn't have to they reboot it or
somebody unplugged them they would come
back out as they did so basically I took
these linux distributions and modify the
startup so that they will try and come
up and try and connect to a network and
then keep trying so you know its favor
plugin and they were in a location that
couldn't like connect to the network
than able to move them and and get them
to get them back to connect up cement I
would on each device set the time and
date because these devices don't have an
internal battery so he didn't get it
correct timing baby which is important
to testing open up the firewall setup a
net canvas in her on him so that I could
send commands remotely and then register
this is this is sort of one of the
things I think there was really worked
out in San work was as each device came
up it had a URL but it would go visit
with his internal name the IP address
have had the mac address &amp;amp; registered
that with a central server that was in
our wired network and that allows you to
why when I got back to my office I could
look at the server see all the devices
get the IP address because every time
this tomorrow if they had a different IP
address and and then start going to be
able to to use them
so I'm running the tests I would take
the test mode file check to see that the
node was still alive see if it would
accept it too man try and see if the
previous test was running if it was
another instance of I / make sure that
it was only when I purpose running out
of time and then start the piece over so
i'll be right back to me some more
details on that so to get the devices to
come up as i said before when for the
mountain view Wi-Fi there was a log in
that was required and to make it so that
was very divisive william log into the
network to sort of by themselves there
was a it was a two-stage login so i
needed to use force was a teasing https
i had a compiler version of w get latest
program w get which adds to the ssl
library and then i had to be able to use
from the command line to use a double
you get and then just ate cookies so
that if we got cookies back to the
server it would save those off the file
and then i was able two lumps and send
them back out for the second w
it was kind of one of the tools I use
part of it was this like HTTP HTTP
headers utility which is off firefox and
that records all the header information
that goes under everything you send to
the webpage everything that comes back
and so that's how I was able to get all
the all the information that I needed
for the w done you can see that's a good
post parlor
so after successfully log and wanting to
do this sort of a series of steps that I
needed to do here's where I registered
with central server from the top line
there it's does the W get ssl and as you
can see I give it a URL with with some
parameters that I put in my hand or by
the script or that actually been
creating a lot of all devices that were
all the test devices are on that one
well these devices all have IP cables
running on them so which was it bad
stuff doesn't happen so I had to open up
the firewall ports for all the net cat
sessions and you hyper session doing and
then I also started a heartbeat on each
device of and every 10 minutes or so
they would send back just a connection
to the server just let me know they were
still there because that's one of the
problems we had since these devices were
spread out across the city you know I
didn't really know who reasons somebody
can't just have a plug one and walk off
with it's a nice little divisor you know
you're driving along the road and
there's this nice PDA a city person I
wanted to sort of have some idea is that
make sure the devices were still on the
network and connection so I said of a
heartbeat to to do that
so that I did a day to run that is just
a typical data run so it initializes on
this server runs once all the servers
and been initialized being at the I
curve server was started on him then I
Randy I / piont which is his on the
network side of the network the wired
side of this Helen so I run a knife
client down to each device and this this
particular run is running UDP so I ran
both UDP and tcp tests on the network
there is one as you can see is length
1350 packet size so you know the tests
of course rant all sorts of very packet
sizes and different bandwidth this one
is running are just 50 k and what so
that was more this was to sort of
simulate maybe what is a small
connection like a PDA or phone my views
and then we also of course them did much
larger
so then the test would run you can see
sort of each instance there they would
report back their timings and how many
how many packets they saw and then I
post a nice at the end of the run it
will tell you so you know how much you
saw from the client how much action sent
at the end of the test run for my birth
it'll send back what did the server suit
so many people there those numbers and
see and then that's that being at the
bottom there shows some of the results
from what the server actually serves
back shows how many packets lost there's
how many I sentiment husband we've lost
it also shows an out of order so if any
of the packets came back you were out of
order rusev answers
so the testing showed was for the number
of tests nodes I have I had basically
well I think finally the end testing I
was ever able to pick it out but have
around the city but there was really no
performance degradation for this hidden
node problem and I think the reason for
that is these devices connected up they
would connect that bag you know if they
ran to school today we get about four
five six megabits per connection by
themselves so we put enough of the lawn
you know even doubling that the number
of nodes would not didn't seem to really
make a big difference the performance
numbers that I got back part of issue
there of course is that Wi-Fi in general
is quite variable correctly need to run
the same test and 15 times and you'll
get and 15 different answers you know at
some point though they'll sort of start
to keep urge remember but you know it's
really as I as I tell people it's a it's
Wi-Fi is not deterministic wreckage
probabilistic
so hopefully i hope that show that this
is I sort of was sort of a one person
team on this project with this piece of
it so the automation really sort of
healthy able to to do all the testing of
this network as i said be sort of the
single radio problem that we thought we
might get with being done with the
networking so was i really do the
anticipated bottleneck lilypad one of
the sort of things which I hadn't
anticipated when I first time at this
project blows the ongoing monitoring
capability of these test devices so one
of the problems that we have for
monitoring the network as it's running
now is that we can we can tell if the
servers are up we can tell if the actual
radios are out the gateways and all the
routers and stuff in between we have
really no way of knowing if somebody
tries to log on to the system but it
actually can work right there sort of
too many variables and just wanna turn
the individual devices themselves dozing
give you the little patient but because
there was really no substitute for
actually having device I can connect up
to their food network log on to the log
on to a networking and since I'm hundred
like so these devices are created for
doing this test are being used for
helping to monitor the network and make
sure the roads actually alive you know
the live network that people can get on
and we don't have any unknown problems
and cost-effective so when things are
you I got through the linksys routers
how to get on ebay the PDAs are also you
know I think they take a full they're
definitely not with newer version but
I'm not trying not sure that they're
still selling the view but they can get
them on ebay so these were you know
devices that pdas cost 150 to 200
dollars and the the linksys routers were
anywhere from fifty to sixty dollars
service or a fairly cost-effective
network as compared to some of the
initial designs we had we've had sort of
small computers running and those are
going to be thousand dollars apiece
laptop something on those lines so
so what next so Google Google's
networking mountain view as i said is
running it's been up for a couple links
now maybe two words google has announced
the that they want to bid with earthling
for putting in a Wi-Fi network san
francisco the contract were still under
negotiation with the city actually what
the range will be you know what although
the numbers are and stuff sensitive is
going to be a little bit more of a
challenging problem it's roughly 50
square miles compared living 12 square
miles for mountain view there's a big
dense downtown area lots of tall
buildings obviously sentences that
famous for its hills so I think you know
the actual network implementation is
going to be a little bit more difficult
in San Francisco the other thing we're
doing as we as I said initially is
circular the city's location based
services so you know the definite talk
to the game groups within Google before
getting input from the mobile mobile
data for Wi-Fi in from pets Eyed Peas so
we can start to get data available for
cities really cool location-based apps
people always talked about but we've
always said well wouldn't it be nice if
we could do this so hopefully we can
start to start to get clearing the
infrastructure there so that people can
do that obviously a lot of security
concerns with the location data so you
have to be even more careful than you
are with their search information right
so people are very touchy about that we
have to a secondary big deserve
make sure that we pay attention to so
that's in further our computer box</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>