<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Routing without tears; Bridging without danger | Coder Coacher - Coaching Coders</title><meta content="Routing without tears; Bridging without danger - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Routing without tears; Bridging without danger</b></h2><h5 class="post__date">2008-04-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/N-25NoCOnP4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">Perelman today our distinguished speaker
she's invented several protocols such as
spanning trees working on trill now I've
read this book in college I think a lot
of you guys have this really great book
and we had some security meetings really
this morning and on number this whoops a
number the people had read this book and
also really liked it so these are some
good books so we're also going to have a
roundtable after this meeting with the
cameras off if you guys have any more
confidential questions you want to ask
without the cameras I had a meeting
earlier scheduled 3:30 has to be
cancelled because Radia has to leave
before before 4:00
so hello so yes the the title is routing
without tears and bridging without
danger so you know like a obvious
question to ask is like well what are
what's routing and what's bridging and
so I'll talk about that and there's a
lot of people that think they know and
you sort of can't really know without
knowing that the question itself doesn't
make any sense but I will explain it all
so yeah the first thing is what our
bridges and routers and switches and so
there's a myth that people tell me often
that bridges were kind of simpler and
they were invented first and then
routers came along and then of course
when switches came along they were like
this revolutionary new kind of
technology that replaced bridges so
these are all like myths and but I'll
explain to you how they came about so
before we get to our bridges which is
like this trill stuff that I'm going to
be talking about let's sort out what
bridges routers and switches are so
basically you start with the definitions
from OSI reference model just sort of
helps you kind of understand it where
there's layers of networking now nothing
is ever you know really built with these
layers exactly but it's just a way of
kind of thinking about the problem so
layer one is the physical layer it's
sort of the hardware or what's on each
pin of the connector layer two is
datalink layer it's how you get a
message to somebody who's on the same
medium as you it's sort of how do you
signal that it's the beginning of a
message how do you put in check sums and
things so Ethernet is an example of a
layer 2 protocol because it's all on the
same shared medium layer 3 is the
network layer where it does routing and
it computes a whole path and forwards
the packet across many links layer 4 is
end-to-end like TCP and UDP which
numbers messages and recovers lost
messages and layers 5 and above are
boring
that's my view of networking so the
definitions a repeater is a layer one
relay it moves things around it layer
one which means it just sort of reads a
bit cleans it up and forwards it on a
bridge is a layer to relay and a router
is a layer three relay so now you know
so if you're taking a quiz you know what
to write down but if you kind of think
about it for a minute it's like I just
said that layer three was the thing that
computed paths and forwarded packets and
layer two was on the same medium why is
there a layer two relay so if I were
defining the world there would not be
any such thing as a layer two relay if
you're going to forward things that's
layer three and so this troubled me for
a long time until I finally sort of my
definition of layer 2 versus layer three
is that there wouldn't be any release
and layer two layer two is only
neighbor-to-neighbor and forwarding as
layer three but I figured out that the
true definition of a layer 2 protocol
versus a layer 3 protocol is that a
layer 2 protocol is anything designed by
a committee whose Charter is to design a
layer 2 protocol so anyway the history
of this I was decnet architect decnet
the one that designed layer 3 for decnet
routing and so forth so layer 3 is you
know like there were a whole bunch of
layer 3 protocols just like there's a
whole bunch of languages today English
French Chinese German and it could very
well be that English takes over the
world it certainly will not be because
English is the best language out there
it's just sort of that's what you know
the people you care about speaking to
because they have the most money at that
point or whatever speak so everyone has
to speak that but I know that historians
afterwards will say why did English win
out well Oh probably cuz and I don't
know enough about languages to do this
probably probably because German had too
many tenses you know it's like no it has
nothing to do that so a lot of people
ipv4 has one out but it's not because it
was the best as a matter of fact it's
was you know you'll as we'll see later
on in the talk it's actually was one of
the worst of the layer-3 protocols it
just so happened you know it was free
and but anyway so I was the one
what is layer three it's there's no
rocket science to it
you take your data you put it in an
envelope you say who the source is who
the destination is throw in a hop count
so you'll recognize packets that are
kind of lost while the algorithm settles
down and so I was happily doing this
when along came the ethernet and so I
said oh that's interesting there's now a
kind of link that you could have
hundreds or you know thousands of
neighbors and the overhead of a routing
algorithm grows proportionally with the
number of Link's so if you took an
Ethernet and did the straightforward
thing of saying that every pair of nodes
on the Ethernet were neighbors then it
would explode the routing algorithm
because you'd have N squared links so
you know what Ethernet meant to me was a
new kind of link that I had to do things
to the routing algorithm to make it
efficient in in the routing algorithm so
fine it's a link it's not a network so
but the world got confused and they
thought that Ethernet was a competitor
to decnet and so there were all these
like trade magazines of which one is
going to win Ethernet or decnet at that
point IP was just this silly little
research thing decnet was the big
commercial layer-3 protocol so I was
very frustrated by this and in
particular there was a group at digital
doing this protocol doesn't really
matter what it was for you historians it
was lat
that they were building it directly on
Ethernet so I went over to them and I
said no no no build it on top of deck
net you know don't build it on layer to
build on layer three and they said oh
you're just upset because your layer is
a dinosaur and we don't need it anymore
and I said oh but you may want to talk
from one Ethernet to another and they
said our customers would never want to
do that so they built directly on
Ethernet and indeed they made lots of
money because it was a good protocol
other than that decision they would have
made just as much money if they built it
on top of layer three but you know it's
hard to explain to management that they
had done the wrong thing so at any rate
at this point in time we had like a
whole bunch of protocols that were built
directly on Ethernet and you can't have
a router forward your packet unless you
implement the same layer three protocol
that the router has implemented so it's
very easy to get confused this is what a
layer three packet looks like and this
is what a layer two packet looks like
they both have a source in the
destination the layer three one happens
to have a hop count and it wasn't
because the ethernet people didn't think
of putting a hop count in there you
should have a hop count if you're going
to be forwarding it because you could
have loops but it never occurred to them
that anyone would be forwarding this I
mean it wasn't designed to be a layer
three protocol so also in layer three
the addresses have topological
significance it says where you are in
the network not just sort of a flat
address whereas in Ethernet addresses
are flat you have the same address no
matter where in the world you plug in so
it's easy to confuse an Ethernet with a
network instead of thinking of it as a
multi access link why can't a thern Etra
place IP they're both multi access
clouds that anyone can plug into but
Ethernet has flat addresses there's no
hop count and perhaps there are some
other missing features like
fragmentation if you have a
heterogeneous links and error messages
if someone intermediate has to drop it
or congestion feedback none of which
would be necessary if it's only neighbor
to neighbor so yeah so there were a
bunch of layer 3 protocols where you put
a source and destination and hop count
on the packet wait a minute I think I'm
going the wrong way
ok so anyway you can imagine I was sort
of in a bad mood about this whole thing
with the LAT people being such heroes
and when my manager said radio we need
to design a magic box that will sit
between two Ethernet and let some
one-on-one talk to someone on the other
and it's like that's called the router
but of course you know it won't work
unless you've implemented layer three
and these things so basically they
wanted to build this very simple-minded
device that would kind of listen
promiscuously and whenever it had the so
would listen promiscuously store all the
packets and when it got the token on the
other side or when the ether was free
whatever the technology was then you
would forward it on the other side and
in addition to that you can also learn
where the stations are by looking at the
source address of these packets so that
was the basic idea but the problem is
that you need a loop free topology you
can't learn the location of the source
if it can hit you from all sorts of
different directions and also loops are
a disaster now in IP layer 3 loops are
not so much of a disaster for two
reasons one is there there's a hop count
in the header and but the other thing is
that in IP if you have a loop one copy
of the packet is going around in circles
because a router doesn't forward to
multiple in multiple locations it picks
the next hop and says Fred you take the
packet now whereas with bridges you just
toss it onto a shared medium and say any
one that feels like forwarding it do it
so if you have ten bridges on a link and
you send the packet you can now have
nine copies of the packet so not only is
there no way to get rid of any one
packet but you can multiply every time
you transmit the number of copies of the
packet so this is incredibly scary and
when this was proposed to me I actually
said no this is a really bad idea don't
do it but they were going to do it
anyway but my manager said so you know
you do distributed algorithms why don't
you come up with something that does a
spanning tree that kind of breaks all of
the loops and comes up with a loop free
subset of the topology and for some
reason he thought he was being
it was going to be really difficult and
he also thought he was being really
witty he said oh and while I have given
you this impossible problem I'm going to
make it even more challenging make it
scale as a constant so no matter how
many links and bridges there are in the
world the amount of memory necessary to
run this thing should be a constant and
like that's ridiculous you know linear
maybe but probably like N squared or
something nothing's a constant so um
then he went away that was a Friday
afternoon and that evening I realized oh
my gosh it's trivial and furthermore
it's actually a constant now it's not
quite a constant well the reason it's a
constant is because on each link you
only have to remember the best spanning
tree message you ever saw a message is
about 50 bytes if you have five ports it
takes 250 bytes of memory to run the
thing so it really is a constant the
reason it's not quite a constant just so
that somebody doesn't you know say oh it
isn't quite is that one of the fields in
the message is the idea of a bridge and
it's 48 bits so if you ever had more
than two to the 48 bridges you'd have to
actually expand the size so it's really
log of the number of bridges how this
thing does so anyway so bridge loops are
a total disaster so anyway so I spent
like a day figuring out the algorithm
and it was like so simple it only took
me like a couple of days to write it out
so cleanly that the implementers were
able to get it working from that in just
like a week or two and then I had all
this energy my manager was gone for a
week and completely unreachable so I
couldn't concentrate on anything else so
I spent the rest of the week writing the
poem that goes along with the algorithm
so the poem is called Al Gore I'm
because every algorithm should have an
alga right so and this is the poem I
think that I shall never see a graph
more lovely than a tree a tree whose
crucial property is loop-free
connectivity a tree which must be sure
to span so packets can reach every land
first the route must be selected by ID
it is elected least-cost paths from
route are traced in the tree these paths
are placed a mesh is made by folks like
me
and bridges find a spanning tree so that
was the abstract of the paper in which I
published the algorithm so anyway so the
idea is that you have some sort of
network and the bridges decide basically
some of these links are not you know are
extraneous so it shuts them off and
they're there in case something goes
down you can start using those links
again so on this picture one of the
things I want you to notice is that
paths are not optimal from source to
destination if you just have one way of
getting from any place to any other
place they're not going to be optimal so
in a sense a packet and the destination
is X it has to go through this whole red
path which is really long so you might
think well that was a really silly
spanning tree if we had been smarter
about calculating the spanning tree we
could have gotten that path better but
no it's you have to break it somewhere
and if you're talking to somebody on the
other side of the break you're going to
have to go around a long way so now the
this was sort of just a funny story the
implementers wanted to didn't want to
put in the spanning tree it sounded
scary spanning tree algorithm and they
wanted to build this like really simple
thing and so on the one hand I felt
sympathetic with them on the other hand
you know my management kind of overruled
them and told them they had to do it and
so I still felt a little bad that maybe
they were right and building an even
simpler device and just telling the
customers don't put any loops in might
have been the right solution until they
full sold the first bridge now the first
bridge was sold to like the world's most
sophisticated customer and yeah and so
they had the world's simplest apology
which was to Ethernet syn one bridge and
when the salesman was trying to explain
it to them they were saying oh but we
have like all these seven protocol
stacks and we're doing all this and the
salesman said it doesn't matter what
you're doing it'll just work so the
world's most sophisticated customer took
the world's simplest apology plugged it
together and it didn't work and they
were really annoyed when field service
when to figure out what the problem was
this is what they found
so if the world's most sophisticated
customer could get this topology wrong
is like yes it was right to make them
put in the spinning chain but what's
wrong with bridges so I kind of assumed
they died out once everybody had agreed
on one layer three protocol everyone
does ipv4 now there's no stacks without
IP in there pretty much so why are there
still bridges and actually about I don't
know six or seven years ago somebody
showed me this Boston Globe article
about how you know this hospital network
had melted down and you know and it the
article is all about all the horrible
things that happen in a hospital if you
bring the network down for days or
whatever and so I'm right I'm reading
along and in the middle is it says
spanning tree algorithm it's like whoa
those words do not belong in a Boston
Globe article but indeed I tracked down
the people who were maintaining this
network and found out indeed it was a
huge bridge network now part of it
there's kind of a lot of folklore about
this my manager at deck always made me
put in numbers it's like how many hops
will its Gail - and it's like I don't
know you know and so it's like clearly
at one scale to a million hops ski
clearly it will scale to three pick a
number so we picked seven and so like
the people looking at this network said
oh I see the problem it was more than
seven hops it's like no but at any rate
I'll explain kind of why networks
meltdown but yeah I was really surprised
that people are really using bridges and
they're still very very popular and I
will explain to you why it is and so you
know what's wrong with just bridging
everything and you know if you have a
corporate network you don't have to
think about you know anything you just
plug it together what's wrong with it
well you get suboptimal routing as I
showed on the previous slide
traffic concentration because the links
that are chosen to be in the tree will
get over utilized and the other ones
won't get used at all temporary loops
are really dangerous
and it's very fragile for a very subtle
reason with routers the there will be a
link between a and B and will be used if
a and B can hear each other so a and B
keep saying hi I'm still here and if you
stop hearing from your neighbor you stop
using the link
whereas with bridges it's the opposite
the only reason I'm not forwarding on to
this link is that I hear some other
bridge whose sort of more qualified to
be the bridge on that link but if
there's too much congestion or whatever
and I start and I can't see his messages
anymore I will fail in the unsafe way I
will bring extra connectivity up why our
bridge is successful well they're simple
fast reliable they're plug-and-play you
know people should get that religion
right you know just do not you know
configuration is bad now routers have
gotten better will bridges go away and
no apparently for a very subtle reason
which is that IP is not a good layer 3
protocol the way IP works is every link
has to have its own prefix so if you
were to replace your bridges by by
routers that and you have a corporate
space of IP addresses you have to chop
up your address space you have to which
wastes addresses and also you have to
configure every port on every router to
be what the prefix is when somebody
moves from one link to another you have
to change the address this is this is
painful
now layer 3 doesn't have to work that
way deck net which was also the same as
ISOs connectionless network layer
protocol otherwise known as CL NP did
not work that way basically digital we
took the packet format from ISO so
decnet and CL NP decnet phase 5 + CL NP
were the same thing so the way that
worked was that it was a 20-byte address
space and the top 14 bytes were your you
know corporate prefix and within your
corporate prefix the bottom
Speights was kind of your MAC address
and that was all that you needed so it
was the routers where it was zero
configuration inside your own network
and you routed directly to the end notes
but yes so like the way that it would
work is that if you have one prefix per
link and you have a corporate block of
two-star then every every link has to be
have a distinct prefix whereas in decnet
you just had one prefix and you could
move around within this network and the
routers inside didn't have to know
anything just whoever was connected to
the rest of the world would tell you
what the 14 byte prefix was so if we
were doing this we would not need
bridges anymore but because we're doing
that people don't like the headache of
doing all this configuration so yeah so
that's the advantage of doing it that
way so now I will talk about the trill
working group trill stands for
transparent interconnection of lots of
links and so there's a working group in
IETF and it basically uses layer 3
routing but it still has the appearance
of just one Ethernet so we're going to
accomplish almost as well as decnet
would have but we're still going to use
IP so it looks like a bridge from the
outside in the sense that it still is
one IP subnet but anyway so it's
compatible with current bridges so if
you had a whole big corporate network
that was all bridged and you had these
smarter things called our bridges you
could one by one replace your bridges
with our bridges and at all times your
network will behave exactly as before
except your paths will start getting
better and it'll start becoming more
more reliable fewer meltdowns and stuff
but it still could be zero configuration
so the first thing is you run a link
state protocol what's the link state
protocol
well first which
say protocol so there's the two obvious
choices are is is which actually was
decnet phase by routing and got adopted
by ISO and they rewrote the spec and
they called it is is and then IETF said
oh we want one of them and kind of
copied it and it became OSPF now we
chose is is as the link state protocol
to use for trill because it's first of
all simpler you know kind of you look at
the specs it just is also it's encoded
with so that you can add extra fields in
it that TLV stands for type length value
so it was real easy to say oh you want
to report about eight byte destinations
sure just add a new assign a new type
value and so we can put those into the
headers whereas I SP F is kind of hard
coded for ipv4 for byte address for byte
mask also it works on top of layer two
whereas OSPF works on top of IP so all
of the routers need IP addresses so it's
not zero configuration so the idea
behind the link state protocol is you
figure out who your neighbors are you
construct a packet I call a link state
packet that says I'm Radia here are my
neighbors and you send that to everybody
and everyone has to store the most
recently generated link state packet
from each other node and if you know
what if you have everyone's link state
packets you know who all the nodes are
and what the neighbors of all the nodes
are so you know the complete graph and
there are algorithms for computing
computing paths given this database so
this is kind of what a network would
look like if the network looks like that
where B and C our neighbors at a cost of
two this is what the link state database
would look like D would say I have two
neighbors a at a cost of two and indeed
it does and E at a cost of two and
indeed it does so every all the nodes
would have this database and there's an
algorithm for computing shortest paths
from that
so inside the campus the the first our
bridge picks up the packet from an end
node and adds an extra header on it
addressing it to the last our bridge so
kind of tunnels it across the campus to
reach the last guy who removes the outer
header and sends it along and that way
you can look like it was just an
Ethernet but rather than like with
bridges where you're actually forwarding
with the Ethernet here you can add a hop
count and make it a safe header also
well you know there's still a problem
with unknown destinations so if you put
if the first guy picks it up and doesn't
know where it is then you have to send
it on a tree and I'll talk about how to
have that is and by the way in this talk
I'm not just going to say this is how
trill works I actually find it founded
very interesting going through the
process of the working group because
there's often been controversies where
there's you know people on both sides
saying oh no no I want it to be this way
and I want to be that way and so for the
most part we've come up with compromises
that are not ugly you know that in some
cases have actually much improved the
design I think so I'll talk about what
some of the controversies were and what
some of the thinking was so oh and so
for the unknown and unknown destinations
and for multicast you have to send it
along a tree but there's no reason to
run the spanning tree algorithm because
the link state database gives you enough
information so everyone can
deterministically you know calculate the
same tree so the idea here is the first
our bridge our two addresses it to our
seven and our seven removes the header
and sends it to see inside here the guys
here don't need to know about where C is
they just need to have a forwarding
table that reaches all of the our
bridges so it's smaller forwarding
tables so what does the encapsulated
packet look like my original proposal
was that all you needed was who the
egress our bridge was and a hop count
and then but for a unicast packet whoops
the our bridge in the header that you're
specifying is the last our bridge but
for multicast it would instead be the
first our bridge and so people were
saying this gives me a headache yeah you
know what do you call this field you
know you can't call it egress our bridge
because it's sometimes ingress our
bridge and then so some people were just
sort of annoyed about it because it gave
them a headache but then eventually
people came up with a really good reason
for having to our bridges in the header
so for unicast it's not obvious why we
need the ingress our bridge but there is
a good reason for it
you need the egress in order to specify
who to send it to but if you have the
ingress one then you can learn where the
where the source MAC address is from
looking at the data packet because you
you see a data packet you can see the
inner packet has the original source
address and you know who the ingress our
bridge is so you can make a
correspondence between that end node is
associated with this ingress guy now for
unknown destination and multicast it's
obvious that you ingress one is useful
to do reverse path forwarding when
you're doing multicast but egress or
bridge we wound up using in order to
select which tree to send it on and I'll
get to why we would want more than one
tree in a few slides another thing in
order to save room in the trill header
instead of having the our bridge names
be 6 by addresses which is kind of the
natural thing to do everything has a
unique 6 byte ID we have a dynamic
algorithm piggybacked on the link state
protocol where everyone chooses a 2-byte
nickname so the idea is you choose you
know a 2-byte nickname and if and you
look at everyone else's link state
protocols if somebody else says I want
to be 57 and you've chosen
seven you have some sort of tiebreaker
for who gets to keep 57 and the other
one chooses another one so it's sort of
a very deterministic kind of algorithm
and oh and then some people said well
suppose we want to configure a nickname
well if you actually bother configuring
a nickname then you will have higher
priority for that nickname than somebody
that chose it at random now we also need
an outer Ethernet header and the reason
that we decided we needed that was
because we were operating under the
notion that you had a network that was
full of bridges and you're replacing the
bridges with our bridges one at a time
so between two our bridges there might
be a bridge and it would freak out this
intermediate bridge if you were trying
to forward something that didn't have an
Ethernet header on it so we have the
inner packet which is like an Ethernet
packet then the trill header which is
the ingress and egress our bridge and a
hop count and an outer one that looks
like an Ethernet that is where the
source is whichever our bridge is
transmitting it and the destination is
the next hop and it's useful to have
next hop as well so you don't multiply
numbers of copies of the packet just
like with a regular router you specify
the next hop this enables an R Bridge to
specify who the next hop is so that's
what the header looks like there's this
is the trill header which has the hop
count and the first our bridge in the
last our bridge and then a regular
Ethernet header over here that you can
tell the difference between a packet
generated by an end node and one being
forwarded by an R bridge because the
protocol type here says that it's trill
so so you do routing just like you would
with any routing protocol but the
destination that you're looking up is
it's not an IP address
it's actually an R bridge so okay yeah
it would be bad to have to our bridges
on the same link in
slating and d capsule ating because then
you could have you know really horrible
loops because there's no hop count
anymore so if you have one guy that D
capsulate sit and another one picks it
up there was no hop count there and if
he sends it out you know if it's some
sort of multicast so you have to make
sure that there's only one guy on the
layer to cloud that's encapsulating and
D capsule ating so this is called the
designated our bridge so is is already
does some sort of election so that
there's only one guy on a cloud that's
known as the designated guy and so we'll
use that in order to pick one guy to be
the designated our bridge so learning
where the end nodes are my since I think
like a layer 3 person and I was you know
remembering decnet the way that I
assumed that it would work was that the
first or bridge learns who its local end
nodes are and sends that in link state
information to everyone else to say here
on my attach and knows but then there
were a bunch of people that think like
bridge people that think like layer to
people and they wanted to learn from
data packets because they didn't want to
learn about end nodes that nobody on
their link is talking to it seemed to
like clutter their database have a whole
extra unnecessary protocol and all that
so then there was like fighting for a
while and then people were saying make
them both optional and you can't make
them both optional because if it's
optional to advertise and it's optional
whether you're going to learn from data
packets then you can have some
destinations that will always get
flooded because you know someone is not
learning them from data packets so what
we decided was that we would make it
mandatory to learn from data packets but
optional to advertise attached guys and
optional to learn from them and I think
that actually as kludgy as it sounds I
think it's actually a great solution
because you would what you should do is
only advertise end nodes that you kind
of are pretty sure are really there as
opposed to anyone can transmit a packet
with any source address
if you have some sort of registration
protocol possibly even cryptographic and
you really know that that's the guy then
you would advertise those and anything
that gets advertised would supersede
anything that's just sort of learned
because someone happened to transmit a
packet with that source address so
flooded traffic some traffic needs to be
sent on all of the links like unknown
destinations so the original proposal I
assumed all of those would go on one
spanning tree and then some people said
oh you know that's not the optimal path
an optimal path doesn't really matter if
it's only if it's going to everybody but
I mean because you really have to send
it on all the links but if you're doing
something where you're filtering so for
instance you're only sending it on links
that are in a certain virtual land you
know like I will talk about VLANs later
you don't want to know but I will be
talking about it so yeah layer two has
this ability to kind of color the end
nodes with these things called virtual
lands and so our bridges will say this
link has VLAN a nodes and VLAN B nodes
so there's only some of the links on
which there might be a VLAN a and node
so if you have an unknown packet within
VLAN a you know it only needs to go to
that link and that link so if you just
did one spanning tree it could be like a
really horrible path between the two the
two links that have VLAN a whereas if
you have a the the tree that you use has
as the route the ingress are bridge it
will be an optimal distribution path so
also with the ingress or bridge as the
root of the tree there was another
concern that people had that packets
could get out of order so when the
source is sending to the destination and
at first your our bridge doesn't know
where the destination is it will send it
possibly on a long path once it finds
out where it is it will send it on the
optimal path and my you know my
inclination when someone says Oh packets
can get out of order is like so what
so you know people say oh but there's
all these important protocols that will
break if packets ever get out of water
and I say what are they and they say
well there's a lot of them and and
they're like really really important so
you know I
my feeling is any protocol that's that
fragile that it can't deal with an out
of order packet deserves to die anyway
but at any rate so then we were kind of
using per ingress trees and then some
people were saying oh that's too many
trees to compute and other people were
saying that's not enough trees so what
that means is that they were saying oh
yes this shows what a suboptimal tree is
suppose these two green links are the
only links that have VLAN G on it when a
transmits a packet and it's not known
where the destination is it would have
to go all the way around here to get
there
whereas if instead you had a tree
computed with that as the source it
would go the optimal path so yeah why do
you want to write so this is when it
matters to have a more optimal tree so
yeah too many trees and not enough trees
so what what does it mean not enough
trees some people were saying suppose
all of our traffic is multicast traffic
and it's all behind one our bridge we
don't want all of the traffic to use
only some of the links so what they
wanted to be able to do was have the
first guy specify a different tree so
that you could do multipathing of the
multicast so so the conclusion was that
the first guy gets to select what tree
it is by putting into the egress or
bridge on a multicast the root of the
tree and right so then it's like which
trees do you use and some people say oh
it doesn't matter it's just something
that the customers will configure which
you know kind of gives me a headache
right so I threw in an algorithm I mean
this was something I spent like maybe 20
minutes on so I'm sure there might be a
better thing but
well first we had a flag for each our
bridge saying I want to be the root of a
tree but that didn't really so you had
to calculate a tree from you know every
one of those and that didn't really make
a whole lot of sense why would they care
so instead what we decided to do I mean
as of whoops like a week ago this thing
is just little details are being worked
out at this point but it means that you
can still jump on the mailing list and
and have your voices heard if you care
about this stuff so the idea would be
that there'd be one parameter that would
be how many trees everybody should
compute and so every our bridge can be
configured with what what they think is
how many trees but the our bridge who
has highest priority gets to tell
everybody else you're all going to use
eight trees now which eight trees you
have like a priority and an ID for each
our bridge you yeah and what you do is
you rank all of the our bridges
according to priority and ID and the top
eight are going to be the eight tree
roots that you're going to use now if
you're going to multi path how do you
know which ones to use and so again you
could configure it but the trees might
change as well so that seemed kind of
hard and again you know something that I
spent you know like 15 minutes on so
again there might be a much better
algorithm this is the kind of thing that
people who love simulations or you know
students that want to generate papers
this is an opportunity for papers I
think if you observe this topology where
there's like a whole bunch of you know
end our bridges all attached to one blue
guy here the if you have one tree if you
calculate one tree would that is the
route it will be exactly the same tree
as if you calculated all of these trees
so it'd be wasteful to calculate all
these trees it would be better to
calculate those and if you want the
optimal tree you should use the one
rooted at that guy so what I suggest
did on the mailing list was if there are
eight trees total what you do is you
rank them according to your preference
to you by saying how close is the root
of that bridge to me and then priority
and ID and if you're going to multi path
on two of them you select the top two so
okay
any better ideas I don't know you know
it seemed so VLANs okay so now I will
talk about VLANs is there anyone here
who never heard of VLANs okay yeah I was
thinking I was going to end somebody's
innocence and take great delight in
doing it because it's like the more I
hear about these things is like oh no so
my model of VLANs what I kind of thought
it was was a way of coloring the
endnotes such that VLAN a nodes could
only talk to VLAN a nodes each you know
VLAN a would be one IP subnet VLAN B
would be another one in order to talk
from someone in one VLAN to another you
have to go through a router so that kind
of makes sense but bridges can be
configured so that internal links can
only pass certain VLANs so you could
have something where you say this link
between these two are bridges between
two bridges I'm willing to pass VLAN a
but not VLAN B and so now VLAN B can be
partitioned and it might not be
partitioned if you could use another
path but the spanning tree is going to
calculate an only one path so well I
Triple E said okay
calculate a tree per VLAN which will
give you kind of them will minimize the
probability well we'll make it so that
you won't ever unnecessarily partition
of VLAN though you still might have a
part you know something that's
partitioned because there's no way to
get through it and then some people said
oh but that's too many so there's some
sort of thing where you can have only 64
spanning trees and map the 4000 VLANs
onto all of them and whatever but this
is not terribly relevant to our bridges
what we
decided was that all the internal links
would carry all of the all of the
traffic and it would be kind of the
model that I understood of VLANs
originally but there's a problem which
is that it's very very important if
there's two are bridges on the same
layer two clad that they see each
other's hello messages because it's
really bad if they don't know about each
other because then you can have loops so
the way you do it is you send a hello
message but you have to put a VLAN tag
on the hello message
what VLAN tag do you put on the hello
message if you put VLAN a on there it
could be that VLAN a is partitioned and
the other our bridge won't see it even
though there are other VLANs that are
not partitioned and there is
connectivity so some people said well
that's easy
just send hellos 4,000 times as many
hellos tagged with every possible VLAN
and then a bunch of people said no and
so we have so I was saying well look how
about telling your customers that you
can that all the inter are bridge
traffic has sent on VLAN one and you
know pick one VLAN and that one is not
allowed to be partitioned they have to
configure it so that all bridges send
VLAN one and they were saying oh but
maybe they want to use VLAN one for
something else and I said okay pick a
number you know and let's do and so they
wanted that to be configurable and then
yeah so what we decided this is the
compromise and this is kind of one of
the most uneasy compromises in the sense
that it keeps coming up and people say
oh I didn't realize that was what you
decided I'm not so happy with that but I
didn't want to have to have hellos
tagged with every possible VLAN but some
people are really nervous about
accidentally forming loops so there's
all these other belt-and-suspenders
things for you know trying not to you
know noticing if there are loops and
being conservative about it but so the
the compromise was that whoever's the
designated our bridge sends hellos on
all the VLANs because it's important for
everyone to hear him but he'll tell
everybody else on this link I want
everyone to use VLAN three so everyone
else will then just send hellos with
VLAN three so and this everything is
configurable of course you know in this
wonderful zero configuration thing so
you can configure the designated or
bridge to have a set of VLANs that it
supports so it'll send hellos on all of
those but you could also configure it to
not send hellos on all of those so yeah
okay so another wrinkle oh yes so I
assumed that the designated our bridge
would be the one that would be
forwarding traffic to and from the link
but then some people were saying oh but
suppose we want to load split traffic
off of the link and so we want one our
bridge to carry VLAN a and another one
to carry VLAN be so so that isn't so bad
the designated our bridge selects guys
and says okay you forward VLAN a you
forward VLAN B off of the link so that's
now called the designated VLAN forwarder
for and you can have you know you can't
have more than one of them's for a link
ah but then you know any sort of
nightmare that you might have had about
VLANs apparently it's worse than that so
it's also the case that a VLAN a packet
can turn into a VLAN B packet so you
have to make sure that you don't have a
viele on a forwarder and a VLAN B
forwarder where VLAN a traffic can turn
into VLAN B so oh right oh wait so yes
so I was giving a talk about this and
then I was realizing hey not enough
jokes and so I called up my son it was
like 10 o'clock the night before I was
going to go off and give a talk about
this and my son who was very familiar
with Algren because he had set it to
music so that my daughter who sings
opera and I play piano we were doing a
recital together and so she was singing
all these Italian arias
and so he said it to music so one of the
arias was the spanning tree poem so he
knew the spanning tree poem and so I
said you know you have one hour before I
want to go to sleep but if you can come
up with a modification of the poem that
describes this new technology and I
explained it to him then I can put it
into my talk so I called him up an hour
later and indeed I think he did such a
great job that his poem will go into the
RFC and so I'm his poem is called Al
Gore I'm version two so it's I hope that
we shall one day see a graph more lovely
than a tree a graph to boost efficiency
while still configuration free a network
where our bridges can route packets to
their target land the paths they find to
our elation are least-cost paths to
destination with packet hop counts we
now see the network need not be loop
free our bridges work effectively
without a command spanning tree so yes
so that's my son raper owner
so that's basically it so thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>