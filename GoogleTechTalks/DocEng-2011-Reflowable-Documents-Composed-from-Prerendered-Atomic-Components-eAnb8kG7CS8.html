<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>DocEng 2011: Reflowable Documents Composed from Pre-rendered Atomic Components | Coder Coacher - Coaching Coders</title><meta content="DocEng 2011: Reflowable Documents Composed from Pre-rendered Atomic Components - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>DocEng 2011: Reflowable Documents Composed from Pre-rendered Atomic Components</b></h2><h5 class="post__date">2011-10-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/eAnb8kG7CS8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">we turn it over to Alex pinky now so to
introduce the next guest tisa from a
familiar group here at doc ends with the
University of Nottingham and just like
there's a steering committee in a
program committee for doc hinge this is
nice because with Alex here we have a
member of the program committee to join
Matthew and Steven Bagley myself on the
steering committee of the people who
bagged on David Brailsford behind his
back so it's a fan of analogous to the
conference in general this will be our
last car hmm right I'm like Steve okay
so um hopefully the title will become
apparent as I go into the talk is very
long but um ok as we all know I'm sure
electronic documents are essentially
effectively they're ubiquitous nowadays
there's loads of devices you can do them
on I've seen a few iPads around people
have got Kindles you can view things on
your mobile phone and many of these are
battery-powered oh sorry okay so many of
these devices are now a battery-powered
so and also unlike the 10 years ago
Microsoft brought out a tablet pc never
really caught on iPads really see them
everywhere nowadays um so we can really
broadly categorize documents into two
formats there's PDF like documents and
there's HTML like documents so HTML
documents tend to all their appearances
is very much dependent on the rendering
device whereas PDF documents essentially
render independent every any PDF
document will appear the same regardless
of what is rendered on an HTML document
can look vastly different depending on
what device you do on or what what
program you using to view it
consequently PDF documents have a very
fixed layout there's really no way of
making them global with the current
paradigm and actually my documents can
be fitted to any screen size and that's
fine but another consequence of this is
that HTML documents look bad it's it's
difficult to impart good typography on
them and PDF documents can look very
good so these two document paradigms
existed for the last 20 years or so and
as John Warnock was saying yesterday
it's time for a new format or something
something's got to change because HTML
is doesn't work very well it doesn't
look nice PDF although it looks nice
you're stuck with with one fixed size
document so why don't we just improve
HTML renderers well we could but
typesetting is complex the line breaking
algorithm developed by Knuth and PLAs
runs in runs in polynomial time and the
actual algorithm used by tech is even
more complex than that the generic class
one so this is very slow to run on the
fly so if you have your kindle and you
want to use the class algorithm to break
the lines it's going to it's gonna it's
going to be slow you may have used adobe
indesign and have edited some text and
quite it's quite noticeable how if it
has to recalculate hyphenation points
are so on that it's quite slow it's not
it's not a quick process um so currently
eBook readers will use a slate
processing so rather than the document
being pretty compiled all the hard works
done beforehand we've now moved the hard
work to the view time of a document so
we're basically
although all the work is now being done
at runtime and that's not ideal because
as I said before these devices are
battery-powered it's going to run your
battery out so what can we do instead of
this well we should probably take a
lesson from history so until around 30
years ago newspapers were still being
hand typeset and as fabio saying there's
a galleys so i'm using the term galley
slightly differently to Fabio he was
using it as the actual content area when
I use a term galley I'm specifically
referring to some text that's been set
into this area and it's fixed so in any
case newspaper text could be set into
into long gullies so essentially
effectively one long column and these
could be easily broken between lines to
fit into the final newspaper layout so
an article could be continued on another
page or another column on the same page
so it's it simple to to flow effectively
flow this text into into other places
without needing to expensively be
typeset it so if we if we do pre-render
the document text into galleys like this
and have each line independently render
ball it makes layout very simple we can
just lay the text out line by line and
if we run out of space or if the week we
can either move to another the text
imaginated to a new page or if the the
content space is wide enough we can lay
out the text in multiple columns um this
still doesn't quite work however it only
fits on a very limited subset of screen
sizes now as the page width increases
which is along the bottom here well
as the width gets to the width of one
galley we can then fit in one column now
this graph is showing the extra white
space needs to be inserted on the page
to fit two columns in so as we get to
the width as we get from so the width
we've got the pages the width of one
gully as we increase it the extra white
space goes up and then as we get the saw
tooth pattern as we increase the page
width so well we thought well why not
embed several gallery renderings into
the document so we can embed say five or
six different width galleys into the
document all of the same content and
readability studies are suggested that
around 30 to 80 characters per line is
as a central amount and I can still
follow it to that point so at layout
time we can choose the most appropriate
galley width which can be based on some
function of the screen width if we want
to change the point size where we can
just scale a small galley up to create a
larger point size or scale a large
galley down to reduce the point size and
layout a view time now is is linear and
that is based on the number of lines on
the page crucially it's not the number
of words on the number of letters so
it's very very simple and we've now
shifted all the heavy lifting for the
document back to compile time so it's
pretty much trivial to to render the
document on the device now so here's
just a visual example of how a very
short document could be rendered into
three different galley width so there's
a narrow one here slightly wider one an
even wider one so each of these gray
boxes can represent a line of reps it's
a line of text we can just lay these
lines out you'd only obvious ly you'd
choose the most appropriate one of the
32
to display depending on how wide your
your pages or how wide your screen is so
we need some some method of choosing
which galley width to render now we
decided that we would like to penalize
extra white space on the page but try to
favor fewer columns so if if five
columns five narrow columns and fit on
the page with the same amount of extra
white space asserted as three wider
columns we'd rather have a three wider
columns so our penalty is fairly simple
it's it's essentially the white space
that the extra white space required to
be inserted multiplied by the square
root of the number of columns this is
just an arbitrary choice it's a factor
which is smaller than linear so
hopefully if if the fact I was linear or
larger we'd this sawtooth pattern would
tend to wander off upwards now if we
well okay I'll explain what this well
this line is showing this particular
line is showing the penalty for a galley
which is 15 m's wide at the varying page
width so if we insert for more galleys
which is slightly wider well we can
overlay these penalties and the way we
choose the galley is to simply pick the
smallest penalty at any given point okay
so this graph is that is in the paper
it's hopefully this should explain how i
created this graph essentially we've
just picked the lowest point of the of
the upper graph and displayed on the
slow graph here and the color the color
matches up with the 15 18 21 and 24 n
column
it so as we increase the page size will
flip between the galley renderings and
the number of columns will change each
of these transition points so within
these color bars will just be adding
extra white space but the transitions
will flip to a new number of columns so
how do we implement this well currently
we are using PDF as a container and it
runs a side Acrobat with a custom plugin
the reason we're doing this is because
at Nottingham we've got pre existing
tools for creating modular PDF my
supervisor Steve Bagley has written a
suite of tools known as was called cog
PDF he's presented it at dock Inge
several times before which we just use
to encapsulate the document components
so the lines of the lines of the galleys
how to modify this to embed the
paragraph structure within the document
so that we can always keep track of
which line belongs to which paragraph so
we know where to insert extra space and
if the page size changes we know where
we know roughly where to to continue
displaying the document if we're on a
second page so that crap plugin just
lays out the lines according to the page
size and the the paragraph structure
which is embedded in the document so
here's a few examples now this is a
iphone size screen we can drag the
window slightly bigger into a kindle
size because it's chosen a wider column
this is how it might look at our iPad
it's put in two columns if you turn the
iPad landscape we've now got three
columns we can make the screen it bigger
so this is approaching a PC size screen
slightly bigger again well it's it's
chosen a wider column variant
bit bigger well it's decided these the
more narrow columns is more appropriate
here so yeah the the actual metric the
penalty we've created may not be the
best we can we can work on it but it's
just it's a proof of concept really so
to extend this we may be able to not
treat the galleys as totally concrete
you may be able to tweak the
justification slightly so we can include
hints which can we pass the renderer to
to to change the words basing the letter
spacing or even the glyph width to some
extent also currently the system doesn't
really allow typefaces to be altered but
then neither do PDFs and neither do
actual real books so but we could
potentially render it in multiple
typefaces obviously it had to be a
limited selection but if if it was need
accessibility for example it wouldn't be
a problem it also may turn out to be
wise for us to tailor documents to
specific device profiles so we could
provide images of different resolutions
or an appropriate range of gully width
renderings and obviously we could look
at more exotic layout options than just
laying out texting columns so we could
allow images or figures to be spanned of
multiple columns we can allow our
betrayal out with using something like
Adobe's CSS regent model or we could use
any of the examples we've seen yesterday
and today as long as they're not too
costly because then we lose the benefit
of pre-rendering our lines and obviously
we need to implement this on a really
big platform because at present well
it's very nice having it run in Acrobat
on a PC but it's not very practical
or useful so in summary well this system
allows us to shift all the hard work
from the viewing device back to the
document compilation time but we've
still got reflow bility and obviously
unlike an HTML based ebook the author
and publisher can see every rendering of
their document so there's high quality
control for them and really we're trying
to work towards a truly portable
document format thank you very much so
there's a really good review paper a
couple of years ago and it mentioned a
paper by hirshberg in lemoore which
gives a linear time algorithm
implementation of the tech line breaking
algorithm given that and the fact that
the CPUs on even the smallest cheapest
devices are getting much faster and
almost all the time is spent doing the
graphic layout rather than the the
computing of the positions I think you
need to keep going for your research so
I think you need to think a bit bigger
before you get settled down too much in
this area like I think you need to think
where you're poking this and the really
questionable yes I'm just gonna say I'm
havin actually read that paper I mean I
probably should now but i'll take your
feedback on board and thanks
so you compare the PDF model to the HTML
model but I think there's a model in
between it's called SVG with SVG you can
render line by line you can switch
between 22 so it looks like it were you
you can't even but if if you want to
work out good places for line breaks it
still as expensive as the HTML model I
understood that you do your line break
beforehand right yeah well I'm breaking
hyphenation you can insert ligatures
where required you can Kern things
properly yeah so you did that on the
server well yeah when they when the
documents compiled yes yes so you can do
that that processing on the server
produce SVG that's pre-rendered and then
just rendered yes well okay that's
that's another way of doing it but when
we've done it in PDF there's no
particular reason for that is just
because it was a practical real okay we
could do it in SVG but i don't think the
model the galley base model has really
been exploited before or not like not in
this way anyway far as I'm aware</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>