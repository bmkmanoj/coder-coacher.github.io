<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Steal a Botnet and What Can Happen When You Do | Coder Coacher - Coaching Coders</title><meta content="How to Steal a Botnet and What Can Happen When You Do - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Steal a Botnet and What Can Happen When You Do</b></h2><h5 class="post__date">2009-09-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2GdqoQJa6r4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay thank you for having me I love your
conference room it's just a really
state-of-the-art and I've expected
nothing better for Google if you want to
change the slide so I'm not at the slide
changer so I'm gonna you know regularly
be saying please change the slide so I
thought first just so we're all on the
same page I just go over some
terminology real quick I assume most of
you know all of this but at least we're
using the same names ibattz an
application that performs some action or
a set of actions on the behalf of a
remote controller it gets installed on a
victim's machine in the old days we used
to call these zombies so when once you
have a compromised machine that someone
that's working using remotely that's
what we refer to as a bot it's modular
in a sense that you can plug in
different kinds of malware for doing
different exploits and so forth and in
today we'll be talking about torpig
malware when you have a collection of
these infected machines that are
controlled by usually single individual
it's referred to as a botnet the way of
controlling it is by means of a control
channel which require is required to
send commands to the bot and also to
receive data back from the bot
originally most of these control
channels were IRC channels today we're
seeing more of them being HTTP and HTTP
s and some of them are actually
peer-to-peer of course in a peer-to-peer
then you don't have the central control
do any others the person in charge of
this is usually referred to as a bot
herder or the bot master or the
controller
he owns or controls the channel sends
the commands to each of the bots and
collects the data from the botnet army
usually the motivation is power or money
the motivation used to be put another
notch in your belt today it's very very
much money driven yes so here how about
if I put a red dot on you and I want you
to change it okay next please okay so
let's talk a little bit specifically
about tor Pig before right before I do
that I want to just say tor pig is
actually delivered by another malware
called mebroot but I'm only going to
tell you about those two lines right
there about mebroot so anyway the tour
Pig is distributed via mebroot routes
really a malware platform it provides
you kind of like with a middleware so
you can install different applications
and so forth for tor Pig it injects
itself into 29 different applications
what okay sorry
it injects itself into 29 different
applications these are all sorts of
applications like web browsers and Skype
and and so forth
it's steal sensitive information it's
one a supposedly called one of the most
dangerous botnets around it steals of
course passwords HTTP POST Bank
credentials logins to all different
kinds of accounts and so forth and we'll
give you some data on that a little bit
later it uses HTTP injection for
phishing which is actually web into
browser phishing so it's not detectable
by any of the current fishing detection
software and it uses something called
domain flux to locate the CNC server
which is is changing regularly and I'll
talk more about that specifically about
those last two reason more specifically
in a little bit just to say something
about mebroot mebroot has spread the
drive-by downloads and it's basically a
sophisticated
rootkit that overwrites the Master Boot
Record and then once you after it
overwrites the Master Boot Record it
waits a little while and then it reboots
the system and then it's doing
everything at boot time and again it's
not detected okay oh yeah this is gonna
be fun
one more time okay so basically this is
there's a pretty sophisticated group of
people what I don't know that they're
sophisticated or software's rather
sophisticated the architecture the
system is rather sophisticated the one
thing two things on this slide that are
not things that the that the Tor pig or
mebroot folks did is up here where we're
talking about hacked web servers so
these are just the normal legitimate
servers that are out there of course
they're vulnerable
and so the mebroot folks have hacked
into them and put software on them so
that we can get the whole process
started which I'll tell you about a
little while
I shouldn't say all of these are
innocent because a large number of them
are actually the porn sites and the
belief is that the porn sites are
probably getting paid to have this
software put on on there there's the
innocent victim here other than that
we've got we've got the drive-by
download server which initially puts the
mebroot software on your system to try
and see whether or not you're vulnerable
we've got the mebroot C&amp;amp;C which controls
the mebroot itself we have the torpig
command and control which controls Thor
pig and then a separate injection server
so let's see how this works we start off
with the innocent victim connecting to
one of these legitimate sites one more
please
when I want to connect to that site the
iframe that comes back down has a
detailed tag on it that causes the
innocent victim to go over to the
drive-by download server okay so he goes
over the drive-by download server the
drive-by download server goes in
downloads the mebroot software the
mebroot software looks for a number of
vulnerabilities in a system if it if any
of those vulnerabilities that are there
then the innocent victim now becomes a
bot I just love those devils huh
okay I should say this slide was
actually there's a figure we have in the
paper that you guys had a reference to
and this slide was done by an FBI guy
for us and then I changed it some cuz he
had UCSB looking like angels and we we
didn't feel like we wanted that that
knowledge but I want to acknowledge the
FBI for doing the animation here okay so
now that now that the that we have the
bot here the first thing it does is
connects to the Met note oh yeah go
ahead isn't much easier when I'm doing
the finger things and I know okay so it
basically connects as soon as it's
infected it connects to mebroot see and
see now that as I said mebroot is is can
be used for other malware in this case
it's being used for delivering the
torpig malware and it basically
downloads three tor pig modules onto
onto the innocent victims machine
these modules connect to the torpig
command and control every 20 minutes and
one of the other things that so once it
connects the tormak torpid command and
control first thing to work torpid
command and control does is download a
configuration file this configuration
file about eight slides ahead but it'll
all come back you know if you hear it
twice and you'll remember it okay the
configuration file has about three
hundred financial institutions on it
such that when you visit those financial
institutions it's going to do a phishing
attack on you the other thing that
happens is that every 20 minutes when
the victim connects the torpig it gives
it any new stolen data that it has okay
so I was talking about those financial
institutions whenever the victim goes in
one of those financial institutions
torpig connects to the injection server
oh okay I was at two I didn't know that
was a two-way arrow or one way arrow
connects the torpig injection server the
injection server through a process which
I'll detail later gives it a particular
customized phishing page for that for
that particular financial institution
and that's that it looks exactly like
all their other pay
just do like the one for PayPal looks
like a piece of crap I shouldn't say
that since you're gonna distribute this
but yes it does the other ones look kind
of nice like they were prepared by
professional people and I'll show you
examples of that so this is basically
how things are working when torpig is
owned by the criminals every 20 minutes
it's connecting here or giving it any
new stolen data if the center command
and control has any new commands at
downloads those every two hours it
connects to mebroot to see whether
mebroot has anything to do okay so what
did we do so we're the UCSB Gauchos
that's actually the the what do you call
it this mascot for UCSB which I thought
was kind of nice for us although it's a
black hat not a grey hat so what we did
is we put a vulnerable machine out on
the net it got infected by mebroot and
torpig and of course we're running it in
VMware and sampling everything it was
doing we reverse engineered the software
we broke the encryption that was going
on and again I'll give you all the
details of this later and basically we
took over so that what was happening is
the innocent victim was going to start
delivering to us and getting commands
from us and more importantly it was not
sending the stuff to the criminals and
so basically for ten days this is a
position we were in we had 100 over
180,000 unique machines connecting to us
from over 1.2 million unique IPS which
we'll talk about why is that different
in a little while too and and so we had
all the information remember I said that
there's a connection here every two
hours to mebroot command and control
when we fully expected that they would
download some new information that would
kick us off this didn't happen for 10
days anyway and I'll tell you why it did
happen after 10 days also we thought
they would maybe come at us some some
other ways I think that's the end of the
oh so that goes away and it goes back to
them and let's go to the next slide so
let me talk a little bit about how the
phishing page works so that when they
configure the configuration file that is
downloaded from tor Pig and can get
updated regularly if you want it turns
out it doesn't get updated that often
but it has domains of interest and in
our case are approximately 300 financial
institutions and you know you tell me
what financial institution you're with
it was probably on there it's out
countries all over the world not I don't
know if we had any in China but but we
had you know Australia New Zealand the
UK Europe and all over the US and so
forth okay so what happens when when one
of these domains of interest is is
visited the Tor Pig software issues a
request to the injection server the
injection server specifies a particular
trigger page on that domain and the idea
is that and it also gives a URL to the
Tor Pig software when the user of the of
that particular bot gets to that
particular trigger page the Tor Pig
sends the you invokes the URL what the
URL does is downloads a page yeah yeah
it's a problem form I'd like to step way
away from that Mike but I don't know if
that's okay with other people okay so so
basically when it gets in a trigger page
the you the Tor pig invokes the URL gets
a phishing page back from the injection
server and what it does through a man in
the browser attack it goes in and
displays that that page for the user to
look at okay let's see what I want to
say so that phishing page reproduces the
looking style of the target website so
here's an example page for Wells Fargo
part part of the pay
Jenny wait where you can see it's it it
looks just like Wells Fargo if you bank
at Wells Fargo that looks at like what
your bank pages normally looks like in
fact you know one of the things you're
told to do is look up here to see
whether or not whether or not it says
Wells Fargo at all at the end at the end
it says dot dot you know dot hacker at
bad domain or something but it has it
has the right domain there it's it's
doing SSL that all looks legitimate and
it's not caught by any of the any of the
phishing detectors of course it asks for
things like first name last name date of
birth social security number mother's
maiden name if you go to the next one
just so we don't this is one for Bank of
America
and it asks some more questions there
which I can't read from here and I'm
sure you can't either it says your
father's middle name and what city was
your mother born all those sorts of
things once you fill these out you
basically you know they're there right
you're right for identity theft okay and
and people would fill them out the
interesting thing was they would fill
them out some of them that we saw they
would fill them out and then they would
send a message to the PayPal security
guy and say why are you asking for this
stuff I thought I gave all this to you
before but they did it after they filled
it out so it's kind of interesting okay
next okay so let's talk about domain
flux domain flux is the way that you
find out what command and control server
to connect to so first let me give you a
little bit of history when if you're
looking to take down a botnet first
thing you want to do is either get one
of your bots one of your machines to be
infected like we did or you find
infected machines out there and if you
find the infected machines you can take
them off okay you can cleanse them and
and and and fix all the vulnerabilities
but if you take one machine out or ten
or fifteen or 200 out of one hundred and
eighty thousand you don't have much
effect so what you really want to do is
you want to go for the command and
control servers okay and so if you use
it if the command and control server
uses a static IP address then you can
block or remove that host so you can't
go to that domain or if you're law
enforcement you can go there and
physically capture the Machine and they
actually had done that
in the past or one of the torpig
machines where they actually captured
one and got a lot of a lot of data on it
from that and found out who was
compromised okay so but remember this is
an arms race you know it's the hackers
against the good guys and it's
constantly you you start warding a
common way that they're doing things and
they raise the bar okay and so the first
thing they did to raise the bar was
something called fast flux and with fast
flux you have the same domain name all
the time but where it goes to changes
okay and in this case you just blocked
the domain name right what they did in
tor Pig and they actually do this in
conflict or also and there were some
earlier BOTS that did this the idea is
that the bots periodically generate a
new command and control to go to so what
the software that's downloaded on the
bot has has a domain generation
algorithm downloaded on it in the case
of Tor Pig it changes once a week for
these four for these domains as they say
they change often they use a local date
system time as input and what you do is
a bot master then just needs to register
this domain when it changes all of the
information starts coming to to the bot
master as as it rolls over okay what
happens is if you want to defend against
this you have to go and figure out all
the possible domains that they could be
registering register them before them
before the bot master does and then you
can take it over and you'll see that
that's what we did but it's not as easy
as it sounds next please okay so let's
let's talk explicitly about domain flux
for tor Pig as I said each each bot has
a domain generation algorithm on it we
reverse engineered this domain
generation algorithm it also has three
fixed domains that it goes to if
everything else fails now for the domain
generation algorithm it does two things
one is it generates a weekly domain name
which I'll refer to as as WD it also had
a daily rate if it needs to it generates
a daily domain name and in every 20
minutes the bar
attempts to connect in tort in order to
the weekly domain name.com weekly and if
that fails and what I mean by if it
fails if that domains not available it's
not out there or if it connects to that
domain and that domain doesn't respond
in an appropriate way doesn't doesn't
have the right protocol then it'll go to
WD net if that fails it'll go to
rollover - WD is if all three of those
fail then what it does is it tries a
daily domain and it generates a daily
domain it tries DD dot-com if that fails
it goes to DD net if that fails it goes
with DD dot biz if all if all of those
fail then it tries three fixed domains
that are hard-coded in the in in the
software okay so in the past while we
were watching tor pig it turns out that
the criminals normally registered WD
comm and sometimes WD net okay so which
so they're they're interested in
efficiency first one it's going to they
get and so what if you go on so what we
did is is we wanted to get them to come
to us instead of going to the criminals
okay and so first thing we did is
reverse engineered the name generation
algorithm and and figured out what the
command and control protocol was and as
is always the case one of our grad
students noticed that the criminals
hadn't registered WD calm or WD net or
any of those for about three weeks out
from what the current date was so we
went registered those domain names okay
so we registered WD calm and WD net the
next it was either later that day or the
next and we registered them for the next
four four three weeks out from from
January 29th to the whatever whatever
three weeks out was a fifth 22nd or
something like that
Oh February 22nd oh here I can I can
read what some of my slide then I don't
know it okay so we register
these domains ourselves WD comm WD net
either the same day or the next day the
criminals registered WD is okay so we
figured what they were going to do was
going to do a denial of service on our
two names so it would roll over to WD
dot biz you know and then download new
software and we'd be out of business
ok as it turns out that didn't happen
for ten days anyway well what did happen
is on February 4th through mebroot which
it connects to every two hours they
pushed the new tor pig binary binary
which had a new domain generation
algorithm that domain generation
algorithm was also one that was dynamic
so you couldn't calculate it out weeks
ahead of time like we did the new domain
generation algorithm was based on the
highest hit Twitter for the particular
day and so you had a you know you had to
be kind of on top of it and you could
believe we were talking to the Twitter
folks to go and see if we couldn't get
the knowledge first and we actually did
later on but that's another talk ok so
basically we control the botnet for 10
days
we got about just short of 9 gigabits of
Apache logs we got 69 Giga bits of peak
app data and I'll tell you more about
those in a minute so let me just say a
little bit about how we did our sink
holing we we purchased hosting from two
different hosting providers and there's
hosting providers that are known to be
non-responsive out there I mean you
might ask hey if you know if you know
the command-and-control is here why
don't you just call a hosting provider
and say hey take that guy down he's a
bad guy well these guys get people to go
and let them host them and so forth
because they're because they are
unresponsive and and those are well
known so we went to two different ones
because we wanted redundancy here we
also registered WD comm and W
met with two different registrar's and
this was actually very beneficial
because the seventh day that we owned it
evidently on the on the sixth day some
Spanish bank reported to the to the
registrar that we we were doing bad
stuff and they tried to call us but of
course we had given him a bad phone
number I mean we were buried through
about four levels because we didn't want
to get her kneecap shot off or anything
you know when when this came down and
and and so we found out too late but
they suspended us on January 31st but we
had the backup one so we then lose any
date at all so that redundancy really
worked out we set up a patchy web
servers to receive the bots requests
recorded all of the network traffic and
and the other thing we did is we
automatically downloaded and remove the
data from our hosting providers we
encrypted it with AES downloaded it and
so that if anybody took over the
physical machines or actually broke into
the the machines that data wouldn't be
available for them next please
Oh interesting thing is that as I said
we were good we were set to take over on
on January 29th
well week earlier we enabled our
software on the host our command and
control stuff that to collect this a
week earlier and immediately 359
infected machines connected to us so
these guys had their clock set in at
least a week earlier and and thought
that they were already supposed to be
reporting to to that particular domain
now it was kind of nice because we knew
at least it would you know it would
probably work we didn't know how well it
would his work would work however next
please okay so before I talk more about
about the kinds of data we got and so
forth let me just say you know when
you're when you're collecting this kind
of information or you have the potential
to collect this information you've got
to be very careful about what you do
with it and so we basically had two
principles that we set for ourselves in
terms of the data collection and the
first one said the sinkhole botnet
should be operated so that any
and or damage to victims and targets of
attacks would be minimized so we didn't
you know we got somebody's compromised
already and we want to make things worse
for them
okay so what we did if you hit so what
we did is first remember I said when
they connect to the command and control
you have to do the right protocol back
to them and what we did was we did what
we called the okay end message the okay
end message is like a null message it
just basically says yep I'm the guy you
want to be talking to and I don't have
anything new for you we've had people
since our paper was released on the on
the web say well why didn't you put a
new blank configuration file because
remember the configuration file contains
the names of the of the financial
institutions that were they were going
to do the new phishing attack for okay
well we don't know what the side effects
of that would be okay and we wanted to
you know we didn't do this stuff just
because we want it to be good people we
also didn't want to go to jail you know
if you start if you start sending things
down to their machine telling you to do
different dude do things I mean we were
just collecting we were a passive
collector except for the okay end
message but we were really concerned of
supposed to the compromised machine is
something like a bank and when you send
down a blank configuration file it has a
side effect that you know turns off all
of the life support things or something
you know probably won't be that bad but
one never knows and and so we didn't do
that as I mentioned before we removed
the data from the servers regularly we
stored the data offline in encrypted
form in fact one of the things I did
that first Sunday after we took it over
was sent someone out to Costco to buy
the biggest offline data storage device
that we could and so we could you know
store the stuff in there and lock it in
a locking in a safe so we would be be
good citizens okay principle number two
says the sinkhole botnet should collect
enough information to enable
notification and remediation of affected
parties and so we worked with law
enforcement in particular with a with
the FBI and
Department of Defense cybercrime units
I'm gonna say more about that later
trying to get to do an initial contact
with law enforcement isn't as easy as
one might think it is you don't dial 911
okay and so I'll tell you more about
that later as a result of dealing with
the FBI in particular we put we're put
in contact with a bunch of bank security
officers I know the chief security
officers at banks that I never knew
existed before you know are how could
Scotland have that many different banks
you know and so it was kind of
interesting and we also worked with the
ISPs which also found their you know
trying to work with an ISP where your
cold calling I mean saying hey you know
you really should take this guy off or
you should leave us on or whatever isn't
always the easiest thing to do okay so
let's talk about the data as I mentioned
before the bot connects to the torpig
command and control every 20 minutes it
does this by an HTTP POST it sends a
header the header is encrypted the
header has in it a timestamp and that
timestamp is a time that it initially
got infected and it's little things like
this that the torpig folks did for us
that made it real easy to find out is
this a newly infected machine or has
this been around so you can see and get
an idea of you know because if you jump
in and take over on January 29th and
it's sending stuff to you well all those
machines have been infected one would
think for quite a while before that so
you should get a big spike in the
beginning which we did but you know what
you want to know is how many are getting
infected each day you know of the ten
days we owned it and that timestamp was
one way that that worked the IP address
this is interesting you'll see that we
had we had one we had one machine that
had 700 it was either just short of 700
just over 700 different IP addresses
over the 10-day period and if you see
how many 20 minute connections there are
in that it was almost like he had a
different IP every 20 minutes okay
and so this was this was something that
was interesting which I'll talk about
again is we believe that many of the
reports on the size of botnets that
you've seen before are inflated you know
probably an order of magnitude more than
what they what they really are and I'll
tell you why we believe that so there's
a timestamp the IP address proxy ports
the operating system version the locale
this is a unique ID which I'll tell you
more about and basically it was that
that we use to find out how many unique
machines we had as opposed to unique IP
addresses and then what was a tour Pig
build and what was a version number okay
so I said these guys were professional
software developers they did all the
good things you should do if you you
know if you're developing software so
let's talk about the network ID it's an
8 byte value it's used for encrypting
the header and the data and it's derived
from hard disk information or a volume
serial number and so as it turns out we
could also tell whether or not Oh a I'm
down here we could detect when there's a
VMware machine because then it always
has that same number on all of them ok
and so unless someone went to the effort
to go and change it and so this served
as a convenient unique identifier the
the body then the optional body if it
has any stolen information as send has
any newly compromised accounts anything
that was posted everything that was
posted was sent ok so if you're doing
either email you know your web email
through posting we got all of that ok ok
and so when it sends this the NID is in
the clear that's used to encrypt the
header and so once you know the
encryption algorithm it's fairly easy to
decrypt all the messages and and and I
should have mentioned it before for tor
Pig the encryption algorithm wasn't very
sophisticated at all for mebroot they
use it we we hope they use very
sophisticated encryption algorithm
because no one's been able to to break
it yet and obviously they're two
different ones ok
next please okay so I was talking about
size estimation this is a count of
number of infections normally when you
read about botnets it's usually based on
the unique IP addresses okay it turned
out this is problematic for a number of
reasons if you have DHCP dhcp
connections you know those in theory
could change every time that you log on
or more often you'll see if you're like
me I found that when I was on Verizon
getting DHCP I think I had the same IP
address for the four years or whatever I
was on Verizon you know and and so and I
and I jut the Machine down you know
pretty regularly so and so you know you
most people say well why is that a big
deal well for some place in places as it
is and in particular in Germany Germany
and Italy and BellSouth are people who
can't have a short time to live on it
and also change them almost every time
you're connecting okay for our account
we based it on the header information we
based it basically on that that mid that
I told you about we found because we
thought that should be unique okay since
it was what was based on a scuzzy drive
and if that wasn't there on some other
software there should be unique we found
that we had a few and when I say a few I
don't remember the exact number but was
like in the hundreds that had repeated
we repeated that value was repeated and
we could tell by from the location and
so forth that it shouldn't be and so we
used the NID we used the country of
origin locale and something else and
those we were convinced was always
unique so here it shows you new tor pig
IPS per hour you can see oh I don't know
if I mentioned this here lacy we saw a
1.2 million unique IPS and we saw
180,000 unique hosts so as I said I
order of magnitude difference there
here's the unique IP as you can see we
got this big spike this is Saturday it
was midnight on January 25th
took it over so he got a little
trickling of things beforehand remember
if we went back a week before we already
had three hundred and some almost four
hundred connected to us but we already
up here are above 14,000 something like
14,500 on the initial connection one
thing to note about this is is this is
every two days here but you'll see this
is died you're know in terms of people
connecting you know eight o'clock in the
morning there's there's a lot of these
that are commercially owned machines and
you know around eight o'clock you see a
big influx of people logging on it drops
down at night and it goes up and so this
is work that David Dagon at Georgia Tech
had noticed before - is this die or no
effect and that definitely was here over
on on on yes what's that oh you could
well you could see things going across
but if you take if you take Western
Europe in the US and sort of collapse
that in you know it's the effect that
there is is is close enough that you'll
still see it yeah this is going on these
were based on where we were collecting
the data okay but you're right I mean
you know was fun you know because we
didn't know how well this is gonna work
at midnight we're sitting there watching
this sucker and you could just see what
watch it coming across and the other
thing was that was remember that was
Saturday at midnight and then we had you
know another spike which is probably
maybe this one here was then on Monday
morning okay because there were people
who weren't connecting on Sunday you
know and then started in connected
Monday morning but yeah so it's so to
answer your question that's kind of
mixed in there but you still got it even
though you had a combination of okay
because it was basically you know a
nine-hour or worst case difference
between those men and it's smooth itself
out and you know not everybody gets
starts at 8:00 some start at 10:00 you
know the whole thing okay so here's the
using our host needs for it and again
you'll see there was a you know big
spike in the beginning but what you
notice here is that it you know
that it drops off and and we don't get
that many as many unique ones if you go
to the Minoan so so also the average
number of new IPs
/ yeah I'm sure I remember where that
was per hour
well this one's per hour so the average
number yeah yeah that would be four per
hour the average number of new IPs per
hour was 4690 whereas for the for the
new unique host was 705 okay let's go to
the next one other interesting thing
here if you look at the cumulative
number of infections its linear for
unique IP addresses so it can you know
it just keeps keeps going up linear like
this in the case of when we're using the
host it turns out that we had 75% of the
new IDs in the first 48 hours and then
it you know and then it kind of flattens
out it then doesn't completely flat now
because we there are new infections
going on all the time but you know not
not at this linear rate that you see
here okay next slide please
so let me talk a little bit about the
the different threats yeah the obvious
threat is the theft of financial data
but I also want to say a little bit of
denial service proxy servers and privacy
threats which I have to say are all
conjecture on our part but we back it up
with you know with real numbers whereas
the Fed of rough little theft of
financial data we have hard hard data
and that data actually happened next one
please
okay so there were eight thousand three
hundred ten unique accounts from 410
different financial institutions the top
five were PayPal posta Italiano Capital
One e Trade and Chase by thinking of
paper I might list some more the number
six with somebody who was doing me a
favor and I said I wouldn't put their
name in the paper so on the talk
slightly I cut it down from 10 to 5 but
you think of whatever bank you're at you
know what Co via Chase Bank
America all of those you're gonna see in
here and and the other thing which I
don't think I mentioned to you before
the other thing that Orpik does it goes
to the password manager and steals
passwords and from there okay and so 38%
of the credentials that were stolen were
stolen from them from the password
manager alright and and we know that
because again these guys that well men
and women that wrote torpig did a good
job they labeled it a specific way to
say this came from the password manager
so it makes it really nice to go and
analyze this data you know we're we're
kind of going like yay you know you know
and things we didn't even think that
they should put in there that they did
like the build number that I was telling
you about there's a different build
number I don't remember exactly how many
of them are are it's in our the numbers
in our latest paper but let's say about
twelve different ones but it turns out
that the software were the different
build numbers is exactly the same and so
the thing that we and other folks we've
been working with are conjecturing about
that is that they're actually selling
their services and they're selling it to
you know different ones with the
distinguished by the different build
numbers okay and and there's some you
know other work been done that that that
substantiates that that's a reasonable
thing to guess okay we also got sixteen
hundred and sixty credit cards top five
or Visa MasterCard American Express
maestro and discover forty-nine percent
of them were from the US twelve percent
from Italy and eight percent of Spain
and then you know dribbled off after
that typically we had one credit card
per person but there were exceptions oh
I thought I had the exception in there
somebody had 30 credit cards that were
compromised okay and so we looked a
little more into see bringing a little
more information about this particular
bot and it turns out that it was
somebody was providing a service for
other folks and holding their credit
cards for them so you know if you sleep
well at night to know you know you have
your wedding when there would be you
know people doing your flight
reservations or whatever beware
okay so one question is well what's the
value of the financial information well
semantics in 2008 estimated that credit
card value ranges from ten cents to
twenty five dollars okay oh and I should
mention that what how do we get in this
business you may be asking okay well we
have a we have an NSF grant to study the
underground economy okay and and so this
is what we're talking about today is
sort of the first step of that somebody
who's collecting this stuff and it turns
out the people that collect it they're
never gonna get caught using a credit
card because you know they're selling it
to someone else and when they're selling
them in bulk that's when you get this
$0.10 value if somebody's out there
selling an individual credit card
because they're a waiter at a restaurant
and don't have anything to do with cyber
security they you know copied it off or
use their cell phone you don't even have
to write anymore
and that's that's closer to 25
so anyway bank accounts range from ten
dollars to a thousand dollars and so
what we did is we looked at the new
accounts and the new credit cards that
we got so we didn't count anything twice
and this graph which I'm sure no one
other than the people sitting right
under it with the bad next I can see I
believe this one here is the count of
new credit cards and a new account and
this one is the max and this one is the
min and and the value if you if you look
at take those both those minimum values
the value over the 10-day period would
be 83,000 minimum and up to 8.3 million
at the maximum okay assuming you you
turn all of those over okay next okay so
another threat I just want to say a
little bit about is a denial of service
threat there were more than 60,000
active hosts at any given time and so
what we did is we use the IP to location
database to determine network speeds and
we found out that
cable and DSL modem make up about 65
percent of the infected hosts okay and
we used the cable modem and dsl speeds
in the US because they're well-known to
be the slowest in the world and and we
use that upstream bandwidth which is 435
kilobits per second and did the math on
this and this yields greater than 17
gigabits of information per second from
DSL and cable okay and with that you
could do a pretty good denial of service
attack on somebody you want to aim it at
the same person you want dude the other
thing is that the corporate networks
made up about 22% of the infected hosts
and they have even faster speeds and so
that's that number of seven is very
conservative there so the possibility of
using the bots for a denial of service
which used to be the original use for
botnets remember the attack on CNN back
in 2002 and so forth it was just to
bring it down factors attack recently on
was it couldn't have been Twitter it was
a Twitter yeah okay all right so let's
look at the next one oh I told you that
good just in case I forget you know
okay proxy servers when tor big when a
machine first gets compromised
tor pic opens both of socks and an HTTP
proxy 20% of the infected machines that
are on in the botnet are publicly
reachable and we went to spam to the
spam house blacklist and it turns out
that only two point four or five percent
of those are on the blacklist which
means that the other 97% are usable and
of the 20 percent that's publicly
reachable and so these could very easily
be used for spamming okay and you know
now I would venture a guess that most of
the spam that we all get a good portion
of it is is done by botnets you know
illegal botnets okay next
okay privacy remember we collect
everything that's posted gets
to the command-and-control so that means
if you're doing web mail web traffic
form message and so forth and so we
decided we just wanted to look at this a
little bit I'll tell you later when I
talk about ethics you know is this real
question of should you be looking at
people's mail and in fact when I
contacted the the DoD cipher guy
cyber crime guy he said yeah I'll talk
to you if DoD information I said we do
and then he wanted it but he said I
don't want any of the email I don't even
say I don't I don't want to be any
chance that I even have that on my stuff
and so you know there's a lot a lot of
problem about that so we try to do a
hands-off hands on I don't know approach
to getting some information about what
kind of people's machines are
compromised and so we focused on on
around six and a half thousand messages
that were in English because we didn't
want to have to bother trying to
translate them and that were 250
characters are longer and it turns out
that about fourteen percent of those
were about jobs and resumes looking for
jobs and resumes seven percent were
discussing money how do we know this we
took keywords that would be obvious
keywords to search for in doing this
sort of thing seven percent discuss
money six percent sport fans five
percent preparing for exams and four
percent doing partners sex blah blah
blah I should take that line out of
there I guess oh okay
interesting thing about it is that a lot
of them are concerned about online
security
you know we saw all these messages like
one of the interesting messages said
yeah I back online now I had some
malware but I'm cleaned up and
everything's fine now okay yeah sure you
are
10% of them specifically mentioned
security and malware and as I said some
of these folks right after filling out
the phishing page went to whatever the
financial institution is and you know
and had this irate message off to them
which we also got because they were you
know using web webmail for this and it
said why am I doing this you know but
they already did it
okay next okay so one of the things we
did since we had so many passwords that
were collected we had almost 300,000
unique credentials what we did is what
what can we what can we say about these
things and so we analyzed them we found
out that 28 percent of the victims reuse
their passwords on multiple domains
probably you know not such a such a big
surprise if you go to next one we say
well can we get more information about
this we know they're reusing them okay
and so we said well how strong are these
passwords you know if we weren't
capturing them this way you know if you
use usual password guessing how strong
how strong would they be okay so we use
John the Ripper and and we had to take
you know some of these passwords and put
them in a UNIX form and in order to do
that okay but we use John the Ripper to
assess the strength of the path of
passwords and it turned out when we did
that we had one hundred seventy three
thousand unique passwords getting rid of
all the duplicates in running running
John the Ripper in the default mode you
know no no dictionary or anything okay
can you hear did I turn it off
can you hear me hello should I sign Oh
blinks cuz it's bad and he never tells
the bling cuz it's good
no no am I supposed to be done by one
I thought we started seven minutes late
we go some okay so basically we use John
the Ripper on the unique password to 573
thousand of them and we found out that
and this was we ran it first just in a
default mode with no no special
dictionary or anything like that and we
got fifty six thousand of them in just
over an hour six sixty five minutes we
then used a large word list and we got
fourteen thousand in the next ten
minutes so we're talking about you know
an hour and a quarter
we got fourteen thousand so 40% 40% were
cracked in less than seventy five
minutes we then ran it for 24 hours and
got another thirty thousand if you go to
the slide which again you can't see this
just gives you that information we got
that forty percent of them and then the
next bump there and into 24 hours there
okay let's go to the next one okay so
what about let me say a little bit about
criminal retribution a little bit about
law enforcement kind of maybe this
should have been lessons learned instead
of what about but and repatriating the
data and ethics so if we go to criminal
retribution so the biggest big concern
on january 25th the first day it was
midnight when we took over this thing I
wasn't at the lab but I had a a grad
student reporting regularly sending out
emails now we have this many accounts we
had this much data you know it was like
the sky is falling okay
so Sunday afternoon we were in the lab
talking about what to do and my biggest
concern at the time was the criminals
because these guys were known to be bad
guys or gonna come to get us shoot off
our kneecaps as I said do the next one
the more real more realistically I mean
I did worry about that one in fact I
still worry about this a little bit
that's why when you say can we publicly
post this you know I'm going like okay
I've given a talk on this a couple times
already they probably know who
and more realistically we were concerned
that they were going to ddos us because
if you remember we only own the first
two domains if they DDoS our hosts it'll
roll over to dot biz and then they could
download their stuff okay
next so the biggest question I have and
I still don't have a definite answer of
this is is why did it take them ten days
to download a new domain generation
algorithm okay because that's that's
basically what they did you know some of
our thoughts one of my students said
well maybe the guy in charge of it was
on vacation okay that could be plausible
I think maybe a more plausible one was
they want to find out who it was that
took it from him you know was it was it
a another criminal group that the you
know that the competition you remember
the wars between the the Chinese and the
I don't remember those Russians I think
a few years ago and that hackers and so
why did it take ten days we know we know
why after ten days it was taken down and
I'll show you that on the next slide so
law enforcement the other thing you know
I don't know if I was more worried about
criminals or law enforcement but we're
law enforcement I said you know we
didn't we didn't get any permission to
do this you know we were Cowboys from
UCSB once you're called Gauchos right
which is Argentinian cowboy or something
and we didn't know who to notify more
importantly we didn't just want to
notify somebody who said would say oh
shut it down because if we shut it down
then WD comm wouldn't work WD dotnet
wouldn't work and then the Russian the
almost said their name the criminals
will you know own it again okay and so
we wanted to get somebody in law
enforcement who knew what they were
doing well I don't know how many people
in this room would know who to contact
one are you the security officer here
okay okay well once you once you've done
that like now I could give you all kinds
of names but you know Sunday afternoon
were there trying to figure out who to
contact and I you know I was blond drawn
a blank if you you go here so then I
said okay us-cert okay you know whether
you think us-cert really does a good job
or not I figured that might be a
reasonable person to contact so I went
through the u.s. search site and and and
I found it oh great it had a it had a
pointer to you know if you've got a
problem with you know yeah you discover
some security something or other go here
and then it gave me a form to fill out
okay and we'll get back to you like oh
yeah that's exactly what I want you know
very very disconcerting finally I
thought about was a guy named David
Dagon I don't know if any of you know
him he's from Georgia Tech and they had
been doing botnet research and I knew
that he had dealt with the FBI and like
an FBI Treasury whoever you want to get
a hold of before and so I asked does
anybody have his home phone number and
fortunately someone had his cell number
and call him at home Sunday afternoon
it's a David you won't you won't guess
what we've been doing you know and
basically he put us in touch with an FBI
contact and he not only not only gave us
the information he sent an introductory
letter about an introductory email about
us and so forth and and then I felt
better because I thought okay now I've
reached out the law enforcement I've got
a paper trail that says I'm trying to
connect somebody
well that was late Sunday afternoon
Monday morning we still hadn't heard
from them and so I sent a message
directly to the FBI guy and email and
and said you know you got the message
from David and we'd really like to hear
from you you know we have any guidance
about what we should do well Wednesday
we still in here back and so Wednesday I
knew
I had a friend at Citrix Online in town
who I know had dealt with Treasury for
something like this before and so I
called him and said do you have a name
of somebody and he said sorry the guy I
dealt with has his own consulting firm
now which tends to be the case with a
lot of these guys as you can well
imagine and so he checked with the
privacy officer who wound up putting me
in contact with this DoD defense
criminal investigative services guy who
I contacted and he immediately got back
to me and which was good because now I
felt even better and then Friday
afternoon we're talking we're talking
six days later Friday afternoon I get a
message from the FBI guy and said oh got
your email I'll get back to you
I'm calling are you kidding me and I
have to say when I talked to David Dagon
he said don't be surprised if they're
not as excited as you are about this
because they're you know a lot of
botnets out there you know I expected a
little more excitement than that well 15
minutes later we get another message
from that guy and says I just read the
content of your email this is great
we've been wanting to do the same thing
but we can't get permission okay and
when can we talk you know can we have a
conference call and and it turns out
they were really they were really good
and they did they knew about torpig you
know they had been had been studying it
and so forth they put us in contact with
a group which is a group of different
security officers around the world who
have been very helpful for us to
repatriate the data you know get it back
to the appropriate banks and so forth so
when we finally got a hold of it was
good and now if I have to get a hold of
law enforcement and it's really easy but
it's difficult it's you know there's not
there's not an easy URL to go to okay
okay so I said that already about the
FBI turned out to be very good and again
the next one please okay so as I said
before we had over 8,000 separate
accounts of 410 institutions
1,600 credit cards and to get this I
mean we had a mind of data we had to
figure out what their what their formats
were and so forth and to figure out all
of this and then once you know it like
you know if I know I've got how many
PayPal accounts that I say less than
2000 but close to 2000 what do I do
just pick up the phone and call PayPal
PayPal might be okay but Bank of America
I go what I do I go
yeah Bank America branch here you have a
phone number of column hi I'm dick
camera I've got a whole bunch of
compromised accounts for your bank and
you know they go by crazy or whatever so
it turns out that you know that's that's
really not that hard to do and in
particular when you then talk to a bank
if you say we may have some of your
credit cards too can you give us your
your bank identification numbers which
are unique for every bank and that's how
you can search on these things you know
which is the first X numbers of the
credit card and if you say can you send
me your bins well they don't want to do
that you know they're very very tight
with all of that so one of the nice
things that happened is these FBI guys
are actually in Pittsburgh and there's
this this is a place that's talking
about the national cyber forensics
training and Alliance which is a group
of a whole bunch of security officers
from financial institutions and he they
the FBI guy put me in contact with them
and basically I'd go to them and they'd
say okay here's here's who you contact
for this Bank here's who you contact for
that bank and was really nice in some
cases it we got the names of individuals
who could go and take care of everything
for the whole country you know like like
all of Italy or all of Switzerland and
so forth they had one guy that was
repatriating okay let's go to the next
one okay so if you recall principle one
said the sinkhole botnet should be
operated so that any harm an or damage
to victims and targets of attacks will
be minimized
we collected sensitive data that
potentially could threaten the privacy
of the victim and you know completely
random one question which I mentioned
before should emails be viewed at all I
mean there's people that feel very
strongly you you should not look at that
at all even even in a data mining way
like you know what you were using for
those things and then the next one a lot
of my academic colleagues after they saw
our paper asked this question did you
have - not familiar with IRP IRB
internal review board they're the ones
that and for us in academia whenever we
put in a grant proposal there's this
thing you check and it says are you
dealing with any human subjects or
anything like that we got now we're not
doing that no right and of course on
this stuff we put no because if you say
yes then they get out this whole stack
of paper they have to fill out well it
turns out we're not working with you
human subjects and we didn't plan on
getting this kind of data so we said no
but there's a solo catch in there any
data that can be used to identify an
individual needs IRB approval well I now
have IRB approval you know unfortunately
I got it after that after the fact on
this thing but it's something just you
know in particular for people that are
working on this thing of you know as a
legitimate one you have to do it I won't
ever put anything in again there's where
there's a chance of me getting this data
without getting IRB approval first okay
and I still don't know about the email
and stuff like that I mean we're kind of
backing off from that much as possible
let's say so conclusion we had a you
know other people have have have gotten
data on botnets generally one of them
there was one on one on Conficker which
a former student of mine was doing it
was up now at SSRI international with
Conficker collected a lot of data were
they were they posed as a
command-and-control but they didn't know
the protocol to respond with so these
places would connect once and so if you
do these passive sort of things you get
a partial view of it we were fortunate
we got everybody on torpig you know
during that 10 day period connected to
us oh I thought of something I forgot
can you go back it's fine
another slide
okay he's gonna take too long I wanted
to say something about the FBI one more
okay
FBI was very good to us okay I want to
tell you why it was ten days okay on on
Monday of the second week we were having
a conference call with the FBI guy
and he said is there anything we can do
for you you know because you know we're
doing the usual thing anything you want
and we said fact Giovanni Vania it was
my colleague said but we only own the
domains for the three weeks out you know
when a week and a half is almost gone
and the criminals own them for the three
weeks after that if you could you know
if we had a way of taking down their
host well you know or their domains
names then you know maybe we could you
know get in there because we already
yelling is after they signed up for
dot-com and dot and that we signed up
for dot biz for those three weeks so
would have roll over to us so anyway you
can knock them out and so we could
probably do that and we said well we you
know they're they're registered and you
know these people that are well-known
for not responding and he said
everything comes back to the US you know
very confidently he said that and so
Tuesday at about 11:30 we got an email
from him and he said their domains are
gone okay
and sure enough we checked and your
domains were gone and 45 minutes after
that they downloaded a new mebroot by
new topic binary on all of the machines
through mebroot so it was kind of the
FBI also had a bad side effect for us
you know on that but in and so in trying
to answer the question of why did they
wait ten days I think that sort of
answers you know if they thought hey
this is our competition and we wonder
who they are see what they do so you
know we can decide how to do it they
knew when it was taken down probably
that was done by law enforcement and
decided we're gonna you know we're done
with our learning curve we're gonna take
it back you know and so that was a ten
day okay so conclusions we had you know
we had lots of stuff to look at and we
still have I mean we obviously have in
mind all of this data yet the thing
about distinct IPS you know they're
they're probably overestimated by an
order of magnitude botnet victims are
used our users with poorly maintained
machines because they are the
vulnerabilities available they choose
easily guessable passwords to protect
sensitive data and then this last one
was just you know what I told you about
just interacting with registrar's
hosting facilities victim institutions
isn't always easy and you know obviously
I didn't do this alone
Chris crew and Giovanni vania or two
faculty members who were the security
lab I can advise errs and these were the
students that worked on it Brett was the
guy that noticed that it was not being
used you know three weeks out or
whatever and and then the rest of them
participated in their ways and questions
that's a place I have to live it's
really awful I hate you know I said I
wish we had traffic like I'd had coming
over it's appalling the past this
morning okay questions
they went to a new encryption algorithm
for the for the torpid command and
control and it's been broken so one of
the things that's happened okay I
shouldn't say what I was gonna say
anyway there's a good there there's as
you may believe there's a group of
researchers and and some some folks
working with particularly with financial
institutions and so forth that are
interested in what's going on here and
sharing data and so forth it turns out
that the torpig since we did this
they've changed their encryption
algorithm several times for torpig and
it's been it's been broken every time
you know fairly quickly okay mebroot
still hasn't now one might ask well if
mebroot hasn't been broken yet why you
know and if it's the same people
well this again may be part of the
underground cyber economy it may be the
mebroot guys are selling their services
to the torpig folks okay and mab routes
doing they're you know not ready to sell
their you know encryption that they used
you mean just to make him feel good
Oh could be yeah yeah
any other questions it's because those
weren't those weren't new ones they were
there were new new ones hitting us in
the ten day period so I think I think I
drop was if you looked at the date it
was February fourth which was when we
lost it so it just went down like that
it was a huge spike in the beginning is
because they weren't truly new they were
new to us okay you know that was a spike
so if you've got people that were
infected two weeks ago or a month ago or
whatever who are still come and
connecting and command and control every
every 20 set and that's us so that was
those and then the new ones were going
across but when you saw the drop like
when like even the finance the new
financial institutions I don't know if
you guys got the pointer to the paper on
this did you send that around her anyway
I knew or has had it because he told me
it was reading it but there's a paper
and I can give you the pointer to it if
you if you want it's all it's going to
be in if you go to our site you know
UCSB SEC lab it'll be there but but
those those slides are there but even on
the new accounts which was fairly flat
right to the thing but then you see the
drop because it was that was February
4th okay when we lost a botnet yeah yeah
and so it didn't drop off just like that
because not everybody got downloaded
this stuff you know immediately yeah
Seattle
not not not on my watch
I went to I'm looking at him and he
can't tell him look Anakin I I went
through that oh I mean the most I don't
want to be sending stuff down there
to them the most I would do would be
would be to notify them and say here you
can download this patch from here to
disinfect and the other thing that
happened I'm trying to see your action
but I see that it's not caught up by the
other thing is that most of the machine
our large portion of machines were also
infected with other malware you know
when when we had reports on stuff like
that so I think it would be good to
notify them I don't I don't want to get
in the game of actively downloading
stuff on your machine okay someone else
could do that though yes are there any
what
for torpig yeah I died there is some out
there but I could look up I don't have
the direct reference for you but yeah
well we've noted we we don't notify
notify individuals but we've notified
two banks okay I haven't notified them
all it's a time-consuming process you
know and I did it I was interested to do
it because as I said we're on we're
actually on the first year of a
four-year NSF grant to look at this
stuff and so I'd like for me it's an
advantage to head to know the bank
people and so forth and so I used that
as a quick quote quota to get to know
those folks but it gets old after a
while you know and like you know I think
my my grad students are tired I go
here's here's a new set of bin numbers
can you look them up or here's you know
here's the banks of interest you know
what domains you want and you think like
somebody like like the Bank of Scotland
we said you know they said do you have
anything we said oh yeah we have some
some it's it's obvious that it's a UBS
or something like that United Bank of
Scotland and so we shipped that to them
and then they said oh here's some more
domain names that we have from Scott
there's pile of these others that you're
looking for and it's you know it doesn't
take a lot of time but everything
anything you do takes time but it's not
and it hasn't all been repatriated but I
gave all of it to the FBI and said you
know you guys deal with it if you want
more so yes
yes yes we did some but I don't have
anything specific to tell you about it
what I remember are there's two days two
days that had a big spike and our
conjecture was that there was some new
very popular one or more very popular
website that had been recently
compromised yeah yeah well it turns out
that some other research it's not in
this paper that we did is we also you
know when when you go when you go to the
legitimate site it downloads the the
HTTP tag that goes and run some
JavaScript that connects you to the real
download tried so it turns out that that
site changes all the time somewhat like
torpig and we figured out that algorithm
we actually owned that site for awhile
so we knew which sites were infected you
know initially which legitimate sites
which is nice information that we tried
to get back to these folks with also
yeah but that was that's a game that was
very hard to play it was like everyday
daily anything else okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>