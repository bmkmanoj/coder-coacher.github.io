<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Malvertising &amp; Mobile Malware Madness (+ How to Cap The Mad Hatters) | Coder Coacher - Coaching Coders</title><meta content="Malvertising &amp; Mobile Malware Madness (+ How to Cap The Mad Hatters) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Malvertising &amp; Mobile Malware Madness (+ How to Cap The Mad Hatters)</b></h2><h5 class="post__date">2011-08-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Y2B3-5_6Elg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">owner and CTO of daisy and which
provides a web and time our technology
for online businesses and today we have
a really great talk on mal vertising a
mobile malware madness so so without
further ado let's welcome back Neil
great thank you very much David so I
think that the last time that I gave a
talk Harry Google was a good two years
ago or so and you know in that two years
I've seen google launched you know an
amazing number of great services I you
know recently in the social networking
space as well I've also been absolutely
thrilled to see Google pay a lot of
attention to online security online
privacy I've seen I've seen search
encrypted in beta that's that's been
great to see I've also seen a whole
variety of things get launched with
regards to you know keeping them you
know privacy online as well so I've been
glad to see continued focus on safe
browsing increased focus on android
security continued focus on on a you
know click fraud in areas like that and
so it just um you know kind of warms my
heart to see Google continue to do a lot
of great work in that area you know when
I had come here about two years ago they
see as a company had just closed its
seed round funding we were just a few
employees and we had just launched our
beta web anti-malware service which
helps businesses monitor their online
presence for web malware threats since
then we've not only taken that service
GA but we have launched an anti malvert
izing service we are working with many
large ad networks to help keep their
online advertising ecosystem safe we
have also been doing a lot more work in
the area of mobile as well and so in
addition I think one of things I want to
mention is that you know it's just great
to return to the mothership since this
past februari we formally announced that
Google Ventures led our series a round
of financing and I've had the pleasure
of working with
great folks at Google Ventures like
Kareem Faris and four and having
additional interactions with with folks
like Vint Cerf from time to time and I
look forward to continuing to help
create a online safe ecosystem for
advertising across both traditional web
and mobile environments and so in my
talk today I'm going to talk about
malvert izing I'm going to talk about
mobile applications from a from a
malware angle from a privacy angle from
a performance angle and I'm going to be
happy to take questions that come up
during the talk especially if there's
quick clarifications i'll also be here
for a few minutes afterwards to take
questions offline if you have any google
specific questions i would also
encourage you to ask those after in the
offline section but without further ado
I'll just kind of get underway in the
midst of my talk I may refer to a lot of
resources all those resources are up on
the deviant website oh and or my
personal website in all those fine calm
the work that I'll be talking about
today is joint work with a number of
members from our security team at de
cient including a too fond of me Jerry
Eisenhower and my canyon and look
forward to telling you more about it so
let me start by talking about malvert
izing my guess is that many of you here
at Google know and have heard of malvert
izing but for all of the folks out there
in YouTube land malvert izing is
malicious advertising basically you can
have cases where you go to a publisher a
very safe legitimate publisher site on
the Internet there will be ads display
ads and other types of ads that get
shown on the page those ads just when
they're loaded may end up doing bad
things to users like issuing a drive-by
download or like issuing a fake AV
that's some of the things that most
malicious ads do today but you know the
first malvert eyes mins were actually
found back in 2007 the first public
reference that I've been able to find on
the internet about them goes back to a
gentleman by the name of William saluki
who I think used to work at AOL may
still be working for AOL and he has an
interesting ISC diary entry up here so
the first
vert Iseman that he saw were actually
flash ads that would render in a user's
browser and they would make various
ActionScript calls to malicious domains
using you get URL functions and other
functions inside of inside of
ActionScript you know since then we have
seen a shift so you know a lot of when a
lot of people I speak with first hear
the term malvert izing they think oh it
must be a flash add well that's not the
case on ads of many different kinds can
be used spread malbert izing and of
course since 2007 there's also been a
lot of maturity and a lot of defenses
that have been put in place I'll be
talking about some of those malicious
ads today result in drive-by downloads
resultant fake AV in the case of a
drive-by download when a user loads of
page there may be new processes that
start up on the user's machine without
them knowing malware files can get sent
down by taking advantage of browser
and/or vulnerabilities and 3rd party
plugins and it happens very silently but
if you look at fake antivirus types of
attacks they are much more visually
noticeable in the sense that it'll pop
up a dialog box and I'll show an example
of that but it's it's affected many many
publishers many ad networks and I'll
chat about some of the types of defenses
that have been put in place I'll also
talk about some of the trends that have
occurred over time as well as both the
the you know the the bad as well as the
good so if you ever visit a website and
that website has ads on it and you see a
dialog box like this one pop up where it
looks like the windows explorer it tells
the user that there's all kinds of
trojans and whatnot on their computer
thing you should keep in mind is that
you may not necessarily want to trust
this because you know the computer
probably isn't infected even though the
attacker here is trying to get the user
to think that the computer is infected
and get them to click something to do to
do a download so this is an example of a
typical fake antivirus pop-up how do
these kinds of Melbourne izing attacks
happen i'll briefly review that there's
actually many many different ways i'm
going to talk about just one or two in
in one model and i've put up a uml like
it's diagram here where there's a couple
of actors there's the melvar kaisers
there's the novel Kaiser server there's
the ad network there's a publisher
there's the user so what the malbrough
keizer or most advertiser does is
uploads first a legitimate add onto some
server that they own they create a new
account with an ad network the ad
network may look at the ad and see that
the ad is good and approve the account
and you know that ad may then start
getting served on publisher sites users
may access that ad and things are a-ok
initially and the attacker may have
created this account with the ad network
on say wednesday but then by the time
that friday comes around the attacker
will replace the legitimate ad with a
malicious ad on their server and because
of the fact that many ad networks don't
actually host the content the advertiser
has the ability to change that content
at any time so once the attacker uploads
the malicious add that ad then starts
getting served on publisher sites in
place of the good ad and so users can
get infected some users may complain to
the publishers some of the publishers
may complain to the ad networks and it
sometimes takes awhile to get these
things locked down in fact one of the
things that I'll talk about a little bit
later is the average lifetime of a
malvert Iseman and how that lifetime has
has changed but this is one way that
malvert izing can happen one of the
things that makes malvert izing hard to
track down in addition to the attacker
is launching these things on Friday
nights when corporate IT teams are
slower to respond over the weekend is
the fact that a lot of ad networks and
ad exchanges syndicate that our
inventory to other ad networks so you
can have a case where a malvert Iser
uploads a malicious add to their own
server they create a new account on some
ad network ad network be and ad network
a has a relationship with ad network be
where some of the time if say ad network
be has a more profitable ad for flowers
or some other topic ad network a mayri
decide to redirect requests from
publisher sites to ad network be to
serve that more profitable ad now of
course what can what can occur is that
if
even if ad network a has good defenses
in place for checking ads for malvert
eyes mints and whatnot they you know ad
network be whom they have a partnership
with you know ad network be may not have
as good as good defenses so as a result
you know these these issues can can
occur now of course there's a lot of
things that ad network a can do there's
a lot of things that ad network be can
do we'll talk about some of those one
additional case that I'll mention is
that sometimes you also have malvert I
zehrs that pose as an ad network
themselves I'll show up an example of
that later on but this is the basic idea
and the reason this makes malbert izing
hard to catch is because when there is a
issue you know someone can go to ad
network a and say hey I think I serve I
saw malbert Heisman come from you but
they're like well it wasn't us it was
somebody else because they not only have
relationships with ad network be but ad
networks e ad network d etc and on top
of that ad network be maybe substantive
cating the ad inventory space to
somebody else so that's kind of a quick
review of malvert izing and and why it's
hard to catch now there's a number of
things that can be done to help lock
down these issues so when we detect
malvert eyes mints at asean we have
relationships in place with a number of
the large ad networks in the space as
well as medium sized ad networks and
when they work together with us they
give us access to their ad inventory and
when we find when our systems find a
malicious ad on the network they will
either send alerts via email or send
alerts via some more automated mechanism
this is an example of an alert and what
you see is that there is a URL that we
scanned at which they're add tags
resided we identify what is the time at
which the malbert Iseman was caught and
because of the fact that you have to
trace down exactly where the malicious
ad came from we provide you know not
only oh the alert and some forensics
around what was caught there but we
provide a full trace of the URLs so that
the full syndication and or sub
syndication chain can be identified so
you know exactly where to go and
ad network sub syndicated ad network to
go to to get the malicious ad off of
that network so over here you'll see
that there's a trace and that trace
continues on to this next screen but
basically at the end of this trace of
URLs that was loaded by by a browser
when the malbert Iseman got rendered is
a malicious domain in this case it has a
dot I n extension and it's served the
draw by download payload in this
particular case it gets identified and
so so that's that's all there in this
indication chain um one thing that I
want to mention is that because of the
fact that these things can be hard to
identify hard to pin down and because
there's many players in the space
forensics are really important and we
want to avoid games of he said she said
and so whenever we had basically an
provide such alerts in addition to
providing this indication chain we also
provide lots of forensics about what
happened when that malvert Iseman got
served so in this particular case there
was a drive-by download that occurred
there's unauthorized processes that get
started basically the malvert Iseman
fingerprinted the user's browser 3rd
party plugins determined which client
side pieces of software say may be
vulnerable to a buffer overflow and send
down the appropriate shellcode in real
time to you know to cause new processes
to start so we provide information about
what were the new processes that started
a lot of times attackers do fun things
like name them things like Adobe update
so that even if a user did happen to be
having a process list up it may not look
suspicious to them but of course it's
not really the adobe update process so
in any case new processes start we've
also seen malvert eyes mints make
changes to the users client machines for
instance they might change the users
registry their registry entries can be
changed to disable their personal
firewall which is what's happening in
this particular case so that their
machine can be less well defended
against other future attacks but in case
all these uh forensics are provided in
addition to information about the full
HTTP trace
network layer forensics and all the
files that were downloaded whatnot in in
this forensic zip file but I think that
forensics are really important because
the fact that when an ad network has to
take an ad tag or an ad off of their
network it has financial and business
implications for them so they may not
earn a particular revenue stream they
may have to flag a particular partner
and so it's important that the the proof
be there so that they can make an
appropriate decision so in any case
that's a that's a little bit about
forensic so the old adage of trust but
verify is absolutely right and
absolutely true we've also noticed that
attackers will do things like only serve
certain attacks to certain IPS or
certain sort of them only once and so
the forensics are important because you
know you need to you need to see what
was actually observed and when users
view malvert Huysmans you know sometimes
at best we've seen a user send in a
screenshot of something but they don't
really know what happened and it's
really hard to track down so when we do
our anti malvert eyes and monitoring of
ad networks we take all these things
into account we've done things like
deploy a worldwide distributed proxy
Network to scan from so that our IPS are
constantly rotating etc so in any case
that's a little bit about about you know
what happens when I'm Albert huysmans
are found I'm going to now talk about a
couple of trends in the area of malbert
izing the first trend that I'll mention
and talk a little bit about is something
that I alluded to earlier when the first
malvert Iseman swere identified back at
2007 they were flash ads but since then
we've actually seen that most malvert
Wiseman's have not been flash ads what
we have done is a survey of all the
different exploit kits that we see when
malvert izing and web malware attacks
occur and looked at which Valle nur
abilities those exploit kits used so
over here we found that the top
vulnerabilities that have been exploited
in the attackers exploit kits actually
target activex adobe reader and java
virtual machines
we have a graph here of how prevalent
and we've listed the different exploits
by their mitre common vulnerability
enumeration number you see the different
popularity's for the different exploits
but it's really important for us to have
a solid understanding of this if we're
indeed going to be able to produce solid
defenses one of the other things that
we've done at desi end is in addition to
scanning our ad network customers and
our media and our banking customers we
also run a set of telemetry which just
monitors millions of sites online where
we see not only the current tax but see
a whole bunch of gray area cases and we
use that intelligence that comes from
that to constantly identify what are all
the new exploits that are being used and
as you can imagine within our own
scanning infrastructure we make the
appropriate adjustments to track the
current threats and just keep up with
this on a regular basis so that's the
first friend you know the first malvert
wise ones are flat but now they're
pretty much drive-bys and fake antivirus
a second trend is that when the display
advertising game started way back in the
late 90s most advertisers would go
directly to a website and say I would
like to advertise on your website or
they would go to a ad network like a
double click or net gravity which had
existed at that time and you know have a
direct relationship than with the ad
network but since then over the past
dozen plus years there have been more
and more intermediaries that have been
introduced over time so there's a lot
more parties in between the advertiser
and the publisher and in addition to
traditional ad networks there's also add
exchanges there's DSP is there's
agencies media buying platforms and so
the syndication chains that we've seen
occurring with with all this activity
taking place have just been increased
very often before an ad is shown there
might be anywhere between five and
twenty redirects between all the
different inter marries before a given
ad is shown so that's why syndication
chains and forensics are really
important when you're looking at these
kinds of issues I should also mention
that malvert I zehrs can
temp to introduce themselves at any at
any point in the chain you know if they
can compromise any party in between so
we we have seen more intermediaries over
time one of the things that I should
mention with regards to these
syndication chains is that as they
become more complicated I think we as an
industry are going to have to continue
to think more carefully about how to
mitigate things on this graph of just a
very high role of representation you may
have a top tier ad network like ad
network a and they may be running an ad
exchange there may be a number of
different other ad networks that are
interacting with b c and d b c and d of
course may have relationships of their
own with other ad networks and so on and
kind of at the very lethal of this
syndication tree is all of the
advertising creatives so from a from a
security standpoint if you thought about
okay how should we make sure that online
advertising is safe and secure one might
one might hope and expect that well
every ad that's kind of ethyl 'if here
should be scanned and or regularly
monitored to make sure that it is it is
safe now of course as things have
morphed over time that has been hard to
hard to enforce simply because you know
advertisers ad networks they oh they
want a lot of flexibility and so the 11
model that can play out though is we
have seen top-level ad networks and
medium-sized ad networks deploy more and
more anti-malware tising defenses
because they're the bigger brands that
kind of have the most accountability and
we've started to see them doing scanning
but when they when they find something
when you find something then it
typically means that there's some
intermediaries that are closer to the
advertising creatives that perhaps are
not doing as much to to defend against
malicious ads being introduced into the
ecosystem so we've seen a couple models
and let me let me chat a little bit
now it's in these models and then I may
return to this diagram but how do we how
do we drive this ecosystem forward how
do we achieve more security on the
online advertising ecosystem and I
should mention that the you know the top
players have have been doing a lot but I
think there's a couple key
considerations one key consideration is
defense in depth if we look at if we
look at many of the top players they
very well understand that there is you
know just as in the in the pc based
antivirus industry it's unlikely that
there's going to be any one antivirus
product that's going to detect any and
all malware and that's that some you
know pretty well understood one of the
things in the PC world is that because
of the fact that a lot of antivirus
packages hook into the carnal level you
you typically can only run one on your
pc and that introduces issues with
regards to to detection but one of the
things that's true in the online ad
world that is not true in the PC world
is that because most of these ads are
being served from servers on the cloud
you know there isn't any reason that we
can't have multiple anti-malware and
multiple anti malvert izing services
deployed in order to look for malicious
ads and that allows us to have
defense-in-depth we don't have to rely
on anyone technology so for instance
even with many of the large ad networks
having some internal systems in place
we've seen that the largest players
realize that you know that that you know
there isn't gonna be one system that's
going to catch everything and so they
have frameworks in place where they work
with multiple parties like ourselves to
scan sub syndicated and syndicated ad
networks so I think that's 11 you know
good positive step that that I'm seeing
in the industry defense intent multiple
multiple technologies can be can be used
now in addition to the benefit of better
detection by using multiple services
there's also another consideration of
business consideration even if there was
one
technology that could be used to scan
you know for malicious ads in a in a
network the question is how much is it
going to cost and who should bear that
cost if we if we if we look at the this
previous diagram if ad network a large
ad network a has to expend lots of
dollars to scan not only bc and DS ads
but efg etc all the way down is going to
cost them a lot and they are helping all
of these folks down the chain make money
so to an extent if we want to move to a
world where there's more and more
defenses at the leaves right closer to
the ad creatives one could imagine a
scenario where ad network a tells ad
networks b c and d hey look if you're
going to participate as part of my
exchange you should come to us with a
clean and tag inventory and you should
you should perhaps do some scanning of
your own and one model is that you know
if they ask them to do that even before
they come to ad network a now of course
the you know the issue is that it might
be hard to do that on day one certainly
I've seen cases where when ad network a
finds that ad network be redirected to
somebody that started a malicious
advertisement ad network a tells ad
network be hey look you guys better do
something you better have some malware
protections in place because I don't
want you you know messing up my ad
network so we have we have seen cases
like that and I think that it will be
more and more of that going going
forward so in any case one of the things
that does is it allows ad network a to
not have to take on all of the cost when
they're in fact helping other ad
networks down the chain you know
generate revenue so so that's another
you know positive reason another
positive you know a trend that I've been
seeing with regards to more anti malvert
izing monitoring getting pushed down
into the intermediaries on on the
network my hope is that one day will be
at a point where all of the leaves will
be effectively monitoring their ad
inventory with regards to on
sentence and enforcement I you know I
mentioned that I've seen cases where one
ad network band another ad network from
participating in their exchange I've
seen other models where offending ad
networks have been given a warning and
inside hey look you have X many days or
weeks to make sure that you're you're
adamant or your ID tags are being served
cleanly on you know in terms of other
options they can they can require them
to do their own scanning or they could
require them to you know to use you know
one of a number of recommended parties
in order to have that scanning done who
they vetted so in any case there is a
number of different options here with
regards to the security issue of
authorization you know very often in the
security world there's this concept of
deny by default right you should not let
anything on to your network unless you
know it's secure of course due to
various business considerations we've
seen allow by default get used in the
online advertising world usually an ad
network will you know except almost you
know any partner after being some some
kind of vetting but perhaps not as
deeply as could be done and they pretty
much allow anybody onto their networks
and then they monitor and they see if
there might be any malbert aizen's being
served before they kind of take them out
of the loop but in a in a deny by
default setting one might say an ad
network a might tell ad network be look
I'm not going to accept you as a partner
unless you can show me that you are
keeping an eye on your network for
malvert huysmans so these are just some
considerations to think about with
regards to moving the ecosystem forward
and you know I I look at you know the
talk to here today here is part of a
continued dialogue you know with with
Google as well as the other ad networks
so in any case let me move on to the
next trend the next trend is the the
trend of zero-day malware we've seen
that attackers know that they are
dealing with the fact that a good
percentage of their user base might have
antivirus engines and so what they do is
they will when they come up with new
malware
they come up with new variants they will
run them through all the different
antivirus engines before they launch
them out on to one or more ad networks
they usually long term on multiple ad
networks concurrently and so over here I
have a graph of a study that we did
where we identified a whole bunch of
malvert eyes mints on the x-axis and
every time that we detected an
advertisement on the y-axis we measured
how many of the traditional antivirus
engines detected that malvert Iseman at
the time that we did and what we saw is
that in the best case only twenty-six
percent of the traditional antivirus
engines that the signature based
antivirus engines detected the malvert
Iseman over time over 24 hours over 48
hours because the model is one in which
a human malware researcher needs to look
at the piece of malware develop a
signature and then deploy it you know it
takes them time for for the defenses to
get out there when we do our anti
malvert izing scanning at day siient we
use we aggressively use behavioral
techniques where we identify well what
is the what is the malware doing as
opposed to what does the code would look
like so we identify things like well are
there new processes you can start on the
machine to an extent if the malvert Iser
is going to do that thing they are going
to have to do something observable of
that kind and so so so this is a example
but it basically is indication that as a
world we need to we need to move to a
model where more and more behavioral
defenses are being used and in fact you
know even with ad networks that have
deployed internal defenses when they say
attempt to use existing in a virus
engines this is one of the reasons that
a lot of things kind of get past some
initial initial filters but you know
this trend of zero-day malware I think
we'll just continue that the attackers
were able to generate new variants of
malware in a very automated way and we
need to we need to of course counter
that so so in any case we had seen that
in forty four percent of the cases the
Valor huysmans weren't detected by any
traditional antivirus engine and so this
is why having a good anti malifaux
tising
service as a complement to existing
defenses is a very good way to go so the
next trend that I'll mention is that the
malvert I zor's have been doing more and
more to just look as legitimate as
possible so in fact sometimes a malvert
Iser won't just create a new ad campaign
on an ad network they will start a ad
network of their own and they will
register a domain they will put up a
whole website this the screenshot here
is from a malvert Iser that has set up
an ad network of their own you could see
they make it look very legitimate they
talk about all the different benefits if
you click join today there's a contact
form of course it's not as built out as
a as a you know more legitimate ad
network might be but you could imagine
that for anyone that might be doing a
review at an ad network of a particular
ad you know this could look good enough
so so so they dress up they also squad
whenever they serve their malbert
huysmans they choose domains that are
very similar to legitimate ad network
domain so for instance just earlier this
year there was there were attacks where
the malvert kaiser use domains like
serving sis except serving has two eyes
serving sis of course a a more
well-known ad network except the
attackers through two eyes and there
they were able to get that domain
registered and then while there is a
legitimate ad network named adver nation
there is no legitimate ad network name
advert nation but the attackers were
able to use these to get pass defenses
of some medium-sized ad networks the
other thing that we've seen malvert I
zor's do is that you know when we when
we first started doing this we'd see
that the malbert I zor's once you know
the redirect got served to them they
would serve like the drive-by download
all the time or they was sort of the
fake AV all the time but in a in a world
where we're stepping up the fences we're
seeing that they're doing more and more
to not do the bad thing to not serve the
malicious code all the time and so then
there's a lot of other things that we've
had to do you know with regards to doing
predictive alerting and monitoring
across many different ad networks and
the first time that we see something bad
across any one of them we then send
alerts to all the different
networks to get that malicious ad off of
off of off of being deployed so that's a
another trend looking legitimate and
then the final trend that I'll talk
about I'll talk a little bit more about
good news here in this particular trend
is that over the past year and a half we
with our telemetry been monitoring
hundreds of ad networks and we've seen
that the average lifetime of a malvert
Iseman has been going down we hope and
expect that's because more defenses have
been getting deployed but but you know
back in q2 of 2010 when we started
assessing what was the average of
lifetime of a malbert aizen campaign it
came out at about eleven point eight
days and the reason for that is because
the malvert I zors would launch a attack
on a Friday over the weekend very few
people would respond to it by the time
that the next week came around you know
email started getting looked at and you
know actions started taking place but
because of the fact that there's a lot
of parties in between the user and
between the offending ad network tracing
it down take some time and so on average
it was taking until after the end of the
next weekend to take the malbert Iseman
off the network on the other hand over
time over the past year we've seen that
the average lifetime of am Albert Iseman
has come down to two point seven days
now I should mention that by the way in
our telemetry we do include some of our
customer ad network so this might be
biased and may show a state of the world
that's a little better than it really is
but you know the idea here is that we're
working data to bring these times down
by basically putting more and more
automation into place when malvert
huysmans are found so that's the the
fifth trend that I wanted to talk about
in the area of malbert izing with
regards to mitigating malvert izing I
think it's important to take a holistic
approach just as one does with many
other security problems on the internet
which the where the holistic approach
should take prevention detection as well
as containment and recovery into account
over here on this slide I've talked
about a number of steps that we've been
seeing more and more ad networks employ
so for instance on the prevention side
you know ad network should that the
advertisers they should net ad agencies
that they work with they should make
sure that their ad ops team has an
appropriate level of education about
malvert eyes and threats and what
malvert Iser signups look like they also
can scan ads before taking them live of
course because the fact that the malvert
Iser may initially deploy a legitimate
ad it's important to have ongoing
monitoring and ongoing detection so that
when the malware Kaiser puts up the
malicious ad on Friday night or Saturday
morning that can get identified from a
detection perspective the more we can do
to have more monitoring from Albert
Iseman SAT the leaves the better and
we've also been using techniques like
adaptive scanning where for instance
when one of our customers gives us an ad
tag we assess what is the amount of
inventory behind that ad type we
basically simple it enough so that we
build up the syndication tree we see you
know with every incremental load of it
how many additional edges get added to
the ad syndication tree when do we have
a good amount of coverage you know
eighty ninety percent across the
inventory and use that to figure out
what's the appropriate monitoring
frequency that should be used for any ad
tiger creative in the wild finally with
regard to containment and recovery one
of the very first things that any ad
network to do is of course have an
incident response plan malvert Iseman
swill happen it's important that when
they happen there's just a sequence of
steps that have already been thought
about and what course once the basic
incident response plan is in place
putting api's and first of all you know
getting monitoring of some sort on the
anti malvert eyes in front is important
you know a lot of times when we work
especially with medium sized ad networks
they're doing things like sending add
tags / and spreadsheets we're sending
alerts back out by email that's that's a
great next step but even better is when
we can put an API in place to have a
malvert Iseman taken down automatically
Oh or or picked up for a manner will
review or something like that so that's
what's been done on the containment in
recovery and I've also been glad to see
certain industry groups coming together
to put more into guidelines around how
to deal with Mal vertising problems so
for instance the online trust alliance
has put together a set of guidelines
that ad networks of all sizes can follow
in order to get malvert huysmans off off
the network but I think it's important
to take a holistic approach to this so
that's what I wanted to cover on mal
vertising I wanted to also now jump into
talking a little bit about what's going
on in the mobile malware space and in
the mobile application space and then
relate it back to malvert heisting so
let's see so actually any quick
questions if we save those to the end we
could save those to the end so one of
the friends that we've been tracking at
de st. is just the rise in mobile
application malware there it's affected
every major platform so this past March
there were about 50 applications on the
google android market that had gotten
downloaded had malware injected her into
them repackaged and uploaded back in the
market and 250 or thousand or so users
downloaded these infected versions of
android apps the the app one once and
you know when in fact it would send it
would make a connection to a bot master
it would send out the user's device ID
it would also try to take root on the
device so so it's you know affected the
Android platform but it's also affected
every other platform as well for
instance on the iOS platform there was a
piece of malware called I key and there
are a number of variants of it I key a I
key be it some affected mostly
jailbroken iPhones but what it did is
when it infected an iphone it would
rickroll the phone and change the users
wallpaper to a picture of Rick Astley
and then continue spreading to other
devices on the network the the attack
vector that it used is that the
jailbroken iPhones had a default ssh
password if the user had brought
jailbroken their iphone but not changed
that password then the malware would
would use that to infect the device you
know one could imagine that on a more
open platform this could happen just as
easily even now we've also seen
financially targeted mobile malware
launch so zit mo is a piece
mobile malware called well this is an
acronym for Zeus in the mobile so for
those of you that have been in the
security role for a while you may have
heard of the Zeus botnet it has wrecked
havoc for a lot of financial
institutions mostly by stealing login
credentials for bank and brokerage type
websites and so of course the financial
institutions would deploy more and more
defenses so that so that even if even if
a user name and password was stolen then
two-factor authentication could then
help the attackers very often that
two-factor authentication would come via
an SMS message to a user or via you know
some application on the mobile device
well what zimo did actually on all these
platforms is it would it would socially
end the engineer the user on the web to
enter their mobile phone number and then
once they attack or had the user's
mobile phone number it would send their
phone a quote unquote security
certificate which was really an
application that would start logging all
of the users SMS traffic and so that way
when the user went to log in to their
financial website they would provide the
username and password they would have
the two-factor authentication code sent
to their phone of course zippo would log
that SMS and also send that up to the
attacker and so the attacker then had
all the credentials necessary so we've
seen some increase in sophistication in
what what mobile malware does so at
ASEAN we've been using a you know a
variety of techniques to study mobile
malware actually I was just at black hat
about two weeks ago and gave a talk on
on mobile malware madness and we talked
about a study that we did just a fun
weekend project of scanning 10,000
Android applications from google's
android market with behavioral analysis
so behavioral analysis is interesting
because as compared to static analysis
and or signature based approaches which
are which are all good approaches and I
believe should all be used together
behavioral analysis has a couple
advantages so for instance while a
static analysis of a mobile application
might be able to tell you that the
application might try
access a user's imei number or because
it has a certain library linkedin might
do this or might do that it doesn't
necessarily about what the application
actually does at runtime and by doing a
by hit behavioral analysis also
sometimes called dynamic analysis where
you run the application you can get
answers to more detailed questions like
you know did it actually access the
users imei number did it you know what
domains and I piece it actually access
when it ran even though it may have a
whole bunch of things hard-coded into it
so you can answer questions like that it
can answer questions like how many
entries in the user's address book got
accessed not just does the app have the
capability to access the address book
but what did it actually do with it so
um so those are a bunch of pros of
Behavioral Analysis it helps answer some
of these kinds of questions and I'll
present some results from the study that
we did on 10 down on the 10,000 Android
applications but you know it does have
some cons it's of course more expensive
to run all these applications it takes
more CPU it takes more bandwidth so in
order to get around that in terms of
using this kind of analysis for actually
fighting malware on phones I mean we
believe that behavioral analysis should
especially heavyweight behavioral
analysis should be run on servers quote
unquote in the cloud as opposed to
actually on the device itself as opposed
to you know traditional AV packages on
PCs have been doing more and more
behavioral analysis but you know have
sometimes fell under scrutiny because
they slow users machines down but you
know doing Behavioral Analysis
contributes to that and so the more that
we can farm off to the server of the
betters in addition there's all kinds of
problems that you need to solve with
regards to anti reversing you need to
make sure that malware doesn't know that
it's being analyzed and an emulator on
one hand it's you know from a
theoretical perspective you know
completely impossible to solve problems
like that but there are a number of good
countermeasures that one can put in
place up to it including actually
running applications on highly
instrumented devices so we do see a
world where behavioral detections and
significance detection can work together
we see a model where behavioral scanning
of applications can be done in the cloud
and be used to automatically generate
signatures that can be pushed to
perhaps antivirus on the devices or two
network elements inside a telecom
network that can help use that kind of
information so in any case we do we do
view behavioral approaches signature
based analysis and static analysis as
all complimentary and I'll talk about
some of the the results that we found by
analyzing applications with behavioral
techniques so in our study we chose
10,000 applications as I mentioned we
chose them from over 30 different
categories and we did simulate some user
interaction with all of the applications
we could have actually done much more
but we found that you know even just
doing very basic interactions was very
often sufficient to reveal interesting
behavior so we studied privacy
violations we studied network access we
studied bandwidth utilization we started
a whole bunch of things I don't have the
time to discuss all those results today
but if you're interested in a but I'll
cover the imei leakage today but there's
a white paper at our website so feel
free to come download that information
and all the results so the one of the
merging results from the analysis that
we did is out of the 10,000 applications
we found that about eight hundred and
forty two of them were leaking users
personal imei information so to be clear
when you download an android application
it asks you for all kinds of permissions
most users will just click the SS yes
and so the question is what does it do
with all the capabilities that you gave
that application thereafter so we we saw
that you know just over twenty percent
of the applications made requests to
access the imei number on the device we
saw that you know a subset of those
though actually then not only access the
imei number but sent it out over the
network either in the clear or a hashed
version of it now when we sent it said
when we say that i sent it remotely it's
either sent it to the developers remote
server or it sent it to a analytics
package or it sent it to an ad network
so sometimes it was the case that the
application writer did it themselves
sometimes they were using a third-party
library that just go ahead and
and sent it off so so want to mention
that also want to mention that you know
even if you even if you hash an imei
number it's typically not sufficient
with regards to protecting privacy
because of the fact that if you look at
the structure of an IMEI number it's 15
digits one of the digits is dedicated to
a sanity check parity check the other 14
digits are comprised of eight that make
up a manufacturer code and six that make
up a device ID so the only real entropy
that you have is six digits which is not
a lot and so one of our researchers at
desi and he went around the office and
basically reverse the imei numbers of
all the iphone users in our in our
company pretty quickly by actually just
building look-up tables with the pre
images of all the imei numbers for for I
me I numbers for iPhones so in any case
we thought this was a pretty interesting
result that has some ensuring privacy
implications and let me also put out
some recommendations as to what Android
developers can can do about these sorts
of things so you know if the if you're
an Android application developer and you
find yourself being drawn to use the
imei because you need a user ID one of
the things I'll put forward is that the
imei number is very bad choice for a
user ID if the user switches phones then
you lose that you basically lose
continuity with that user so instead you
could just have your server generate a
random user ID it has the downside that
you need to keep track of state of all
the different numbers that you've used
but at least then you won't lose your
users across the phones in addition you
could assault the hash you could you I'm
sorry you know hashing imei number
itself isn't enough but you could salt
the hash and basically um you know throw
in more entropy and that will I'll you
know allow you to use the imei number
but in a in a privacy-preserving way so
in any case I would recommend those
approaches if you're using IMEI numbers
for your own applications and storing
these things on your servers if you are
using third-party libraries whether the
analytics package is whether they be ad
packages I
it's important to that those third party
packages and understand well what are
they doing I for instance at black hat I
met up with a mobile phone application
developer that actually had gotten sued
because a number of the applications
that they had developed for their
clients was leaking private information
because of what the third party
libraries were doing and not because of
what their own applications were doing
so that's a few recommendations in terms
of using behavioral analysis to detect
malware that's you know the the results
that we've seen there are pretty
promising one can imagine that a good
mobile malware detection system has
hundreds of signals but i'll present
just two so in one example we had
conducted behavioral analysis of joy
dream and found that because it used the
rage against the cage exploit which
starts a whole bunch of processes
because each of these processes start
off at a high privilege level and
they're supposed to come down there is a
corner case where if there's enough
processes running on the device it
doesn't it doesn't come back down to a
user level privilege properly so we had
seen that you know in our emulation
infrastructure and our highly
instrumented emulation for structure
while there might be on average 60 or so
processes running on the emulator with a
standard deviation of just less than
five when you run droid dream on average
660 processes started that's a very
clear indicator that something is going
wrong and in particular the rage against
the cage exploit also had a number of
other very observant another example of
a signal is undesired SMS activity so
there's a number of mobile malware
packages which would send premium SMS
messages out over the network that's
what the cyber criminals were doing to
monetize the applications and so you
know when these various fake movie
players started they would start off
sending you know these SMS messages with
no user interaction and that's also a
pretty interesting indication now of
course in order to have these things be
proper signals you have to do some
refinements because you want to avoid
false positives but just wanted to give
a flavor of
the kinds of behavioral detection
signals that one can use to identify
mobile malware let's see I'll also just
talk about a couple examples so here's
an example of a application that we
conducted to scan on which was doing a
privacy violation it was sending out a
md5 hash of the user's imei number and
we can see that in this get request HTTP
request that's made to a host in Japan
actually an ad network in Japan it would
send out the udid and use the md5 hash
of the imei as the udid so that was
definitely very observable we of course
saw that I'd had other network behavior
but that's an example of a privacy
violation that that we detected using
some fun infrastructure that we built
here's a couple results of scans that we
did of you know and on the malware front
so in in this particular case droid
dream set off smoking gun type of alarms
because it it tend to take root access
via the rage against the cage exploit
both from the number of processes as
well as you know the process of
attempting to take root it also made a
direct connection to a bomb master IP
and there were a number of other domains
that it accessed you know Admiral AdMob
to you know because what we did is
scanned bowling time which is a game
that was one of the 50 or 60
applications that was packaged with joy
dream this is another example of the
scan that we did yet another scan that
we did is for one of the movie players
that I mentioned which of course wasn't
really a movie player but just you know
started up and mobile user hey the
application has been installed and then
goes forward with sending out premium
SMS messages so that's another example
of a mobile malware alert I talked about
melber tising in the first part of the
talk and I talked about mobile
applications and mobile malware in the
second part of the talk and I think
we're going to see these kinds of things
more and more so come together so just
earlier this year courtesy of lookout
they identified a piece of mobile
malware called GG tracker
what GG tracker did is it would you know
you'd have an application that it would
be an ad inside that application if you
click on the add it would start up the
web browser on the phone and take the
user to a site here at this free app
settings domain that attempted to look
like the android market and encourage
the user to download an application of
course of course if the user downloads
the application it sent down malware and
you know with some of the types of
attacks I talked about earlier I talked
about malvert Iseman doing drive-by
downloads in this case we have a malvert
Iseman that didn't really do a drive-by
download it was socially engineered to
get the user to click on the thing but
we were interested in this question of
you know could it have spread via a
drive-by download on the android
platform you know when we have looked
around we had seen a number of
vulnerabilities and various software
packages and WebKit and above other
packages and we wanted to ask the
question of you know what's what it what
is between now and the cybercriminals
writing drive-by downloads on on android
and the answer was what was not much so
well you know one of the things that we
wanted to do was understand you know
could malvert Iseman start spreading via
drive-by downloads on the on the android
platform at the same time we didn't want
to do a set of work or publish a set of
work which would advance the
cybercriminals although given that we're
thinking about this we're pretty sure
that the cyber criminals are thinking
about this and or are you know maybe
even running ahead of us but but
basically we prototyped a drive-by
attack on Android that actually did a
drive-by upload in the sense that we we
had a you know a three-step attack where
the user visited a compromised web page
on that compromised web page we put a
set of JavaScript which tickled a WebKit
vulnerability and took advantage of some
deficiencies and how WebKit was
processing floating point numbers to
basically get a get backdoor access to
the phone and then we sent down some
code which took advantage of a
vulnerability in the Android version in
the skype version for Android in which
skype would log users IM conversations
and store them in a database and it
didn't encrypt them and it also did not
it didn't encrypt them ended it also you
know made the files world readable which
means that you know while android has a
nice structure in place where each
application has its own user ID and
that's supposed to help compartmentalize
things with this particular
vulnerability the second that you write
the file out as world readable you you
lose all those benefits so in this case
we have the user do a do a driveby
upload so i can actually demo what we
had done here and i should mention that
we used all existing vulnerabilities we
didn't come up with any zero days so
this is kind of all out there and you
know we didn't advance what the what the
attackers can do but simply show that it
is it is possible so in this in this
demo we have on the right hand side we
have the emulator we're going to go to a
website called infected sitecom which we
put some some code at which exploits the
WebKit villain and then gives the
backdoor access on the top left you'll
see the web server log which serves our
exploit page on the bottom left you'll
see basically the attackers window so so
this is more of a targeted attack we
didn't package this up into an exploit
kit we didn't release that exploit kit
out on the internet or anything like
that but it should give you an example
of what's possible so over here I'm
going to go ahead and click we're going
to and if quick time and whatnot gets
along with me then we'll see that will
go to infected site com home sort of a
page it'll just be a blank web page but
what will happen isn't that in the
attackers window it will give the
attacker the ability to connect in and
upload the main TB database that Skype
used to store to the users I am
conversations and then the attacker can
upload that to their own server and
basically run a SQL query which
so the IM conversation in this
particular is the I'm conversation is
this is a secret message because skype
uses the encryption so forgive the
grammar but the idea is that the
attacker was able to access the users I
am skype conversations you know just by
having lured the user to a infected web
page so that's um that's this draw by
attack of course I should mention that
the attacker could also upload you know
rage against the cage exploit a whole
number of root exploits and then take
root on the device as well so so so
complete ownership of the devices is
possible now with regards to mobile
malbert izing one could imagine that
that it could be a mobile ad which
basically loads a URL like infected site
com and actually does the same thing
just by loading an ad on you know it
within an application so i think the
time to start preparing for mobile
malbert eyes mints is now we know that
cybercriminals follow the money we know
that mobile devices are you getting used
more and more so for mobile banking
mobile payments i think it's important
to take a zero pollens zero-tolerance
policy towards this and start putting
counter measures in place so so what
what what what folks can do right now is
vet their syndication partners
proactively but i think we need to put
more and more automated defenses in to
fight mobile malvert izing just as we do
so for existing malvert izing so in any
case i wanted to give a shout out to a
number of team members at de cient who
helped make this work possible and just
wanted to summarize by by by saying that
you know there's a lot that we've
learned from malvert izing on the web
there's a lot that we've learned from
how malware has been used in pc based
platforms I i think that there's a lot
that could be done to fight looming
threats you know and i'd like to you
know i look forward to using this
opportunity and afterwards to be a part
of a continued discussion with regards
to how we can you know as a google
ventures portfolio company kind of
returning to her you know returning to
the mothership to give this tech talk
talk about how we can work together to
to address these kinds of issues I think
there's you know a lot of a lot of great
things that have been done to provide
more and more security over the Internet
and the mobile internet and I look
forward to helping continue to to to
make that happen you know I I would also
just point out a couple of other
resources if you're more interested in
learning more about security you know
there's a you can get a copy of my book
come today CNN com or my personal
website I'm glad that that book was
helpful here at carat Google in addition
you know at Stanford there's a lot of
courses that we have on security in
general but in actually where we're
going to be introducing a course at
Stanford around mobile security because
a lot of enterprises and organizations
are concerned about these sorts of
things but other than that I'd just like
to sum up and saying I look forward to
continuing to fight the cybercriminal
scatter thanks for your time and I'm
happy to take a question or two in the
back so it's actually the so actually I
answer your questions in so with the
right set to false positive and false
negative rates we've been able to what
we've found from behavioral analysis is
that it allows us to achieve a much
lower false negative rate as well as a
much lower false positive rate you know
then other approaches because of the
fact that you know you actually see the
bad thing happen so the false positives
are lower our false positive rate for
instance for web malvert izing is less
than one in ten million and on the on
the false negative case you know we have
I mentioned our telemetry systems we
basically identify you know
the actual bad behavior when it happens
but the key thing is then have a good
understanding of what are all the
classes of bad behavior and make sure to
have the model than built into our
system and that's why our telemetry
systems are used to monitor large parts
of the internet so that we can see the
scope of malicious activity that might
be occurring so that all addressed and
then with regards to operational you
know deploying this kind of stuff has
been made much more operationally
minimal over time so the overhead is
pretty minimal you know for us to get
started with an ad network we have a lot
of protocols in place it's a matter of
getting access to some add tags and and
you know an alert email address so so
it's pretty straightforward I'll take
maybe one more question okay so the
question is how did we simulate user
actor interactions in these 10k
applications for this particular study
that we did we took a pretty simple
approach where we threw a few random
actions at the EPI application but one
of the other things that's really nice
about Android applications is that the
applications in the bytecode they
declare what events what user events
they handle so we also have an
infrastructure that will generate events
as per what the application expects so
that's you know second class and then we
do have other classes of simulated user
behavior for instance when there is a
username or password field that very
often needs to get filled in so that's
another type of classf activity that we
can pursue so but basically for this
study we just did something really
simple of course in our infrastructure
we can do much more complicated things
great thanks once again for your time
today and I look forward to following up
and continuing the dialogue
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>