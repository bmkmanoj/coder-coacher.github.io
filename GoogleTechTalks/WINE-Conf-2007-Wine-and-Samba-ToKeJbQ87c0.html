<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>WINE Conf 2007 - Wine and Samba | Coder Coacher - Coaching Coders</title><meta content="WINE Conf 2007 - Wine and Samba - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>WINE Conf 2007 - Wine and Samba</b></h2><h5 class="post__date">2008-01-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ToKeJbQ87c0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I just wanted to give some updates on
wine and samba well roots of possible
interactions between wine and Sambo to
get us some things done probably Rob is
the person who should fill in on the
details but yeah send him an email and
he'll handle it like yeah so I'm just
short what I'm going to talk about is
I'm going to explain what this safes
workshop actually was about and the
stuff we were talking about so Robb is
the guy who who knows about the first
two points actually so remote named
pipes you spend time talking to lots of
people about that he probably knows more
about the endpoint mapper a discussion
than I do but I tried to get together
this stuff I still recalled about that
and ID mapping authentication and
testing is more my area of interest so
about the ship's workshop the safes
workshop is basically well it's it's not
different too much different to what we
did yesterday when we started the make
test hacking I mean it's like yeah you
have room full of engineers you have all
of them from different companies
bringing their sifts implementations and
testing the heck out of each other's
implementations and basically it looks
like a LAN party for grown-ups I mean
lots of tables lots of network cables
lots of guys in front of a computer but
nobody's playing a game um so why would
whine care about something at that I
mean this is not like we do lots of
service I mean we do have a sip server i
was told i think Rob tried to run SMB
torture against it which is the samba
based test tool and it crashed miserably
like
oh alright yeah he said we don't have we
like something that they tried to test
yeah well so but apart from this little
sip server wine has and nobody uses um
well the interesting thing about that is
we want to get some corporation with
samba done there's lots of summer
developers there who know about specific
parts of things I got robbed to be there
so we had somebody from wine there who
knew what we actually need because i can
do all the talking just fine but if it
goes down to real implementations I need
to ask him anyway so I decided I just
take him along say Rob see that's Steve
go talk to steam um yeah so that was
there was lots of brain chair going up
and I think that's a good thing so um
running off to the results yeah this is
I remember we were talking about maybe
getting some sort of a special network
protocol for remote named pipes we'd
have to do that in the colonel so we
have would have to do that via our own
driver or hooking in into the sifts
kernel module and Steve French didn't
like that idea very very much so um
unless we're going to do that ourselves
and try to get that accepted ourselves
it's not going to be a network protocol
but as a special file system it actually
would work so Steve I think suggested to
do this via I now pipe a slash pipe
subsystem like / proc or / sis or
something I a map I think that would
work we actually considered doing that
as if based on a fuse file system just
rapping assemble library because that
actually should work as well but Steve
seemed quite happy to get started on
that so Rob wrote some test cases for
him so he could get some Network traces
and always see if some something gets
out of that I think fuse is always an
option for us it runs on all the
platforms we care about so we might look
into that if for some reason the Chiefs
kernel module doesn't work out then
downside of the six kernel module is it
won't work for Mac so we'd have to like
go to apple and say well you see that
Linux has that we want that too and yeah
well fuse works on a mac but if we do
this via the sifts kernel module this
will be Linux only yeah for the endpoint
mapper I think the one of the ideas was
to do use D carpc um which was out who
did who did we talk to you about that I
know oh yeah Elmer suggested the DC or
pc interface then sharer actually is
kind of very much into fuse right now so
he suggested to use a fuse file system
for that this probably would work but I
think it's a really clumsy interface for
DC RPC but yeah well the only problem we
have right now with this is assuming we
have multiple users run multiple copies
of wine that all want to register some
classes with samba which will only be
one point where they can register how do
we handle different users registering
the same interface so we need to come up
with something to solve that I mean not
right away we can kind of just aim at
the single use user scenario first but
at some point we'll probably have to
handle that one yeah
okay let's see I don't have that in the
slides here but actually I have they
have and then
so basically that's what my nice little
easy to understand picture right now is
saying I I did those for a Linux
conference way didn't assume that
anybody had any clue about what wine was
about anyway apart from running solitary
but that was the feedback I got and now
we actually have Y in mind which is also
a really cool application so the
endpoint mapper is part of the part of
the sort service control manager of
whatever SCM is an abbreviation for
microsoft likes those observations but
they have like really long names
otherwise so nobody uses those anyway
that actually takes care of so assuming
this come object on the big computer
once to use some component that happens
to be on that one the endpoint mapper is
the thing that actually will know where
to look for that so this could be on the
same box but it could be on a network
and I think wine handles the it's on the
same box but okays okay yeah okay
welcome uses that but just yeah okay
good it's well I found it easier to
explain using come but I agree yeah um
anyway getting back to that one yes I I
don't know how many applications would
use that but I think oh I think wine is
interesting for companies that have sort
of the home-brewed applications that do
some more fancy
things and I know that at least in that
I in the hospital where I worked one of
the MDS was kind of building all the
software and that was using some of the
decom stuff so probably in order to
report that one for database so we had a
database server running some of the
objects and the clients would have other
objects so in order to make those things
talk to each other for wine we needed to
have some sort of a network-based
support for that so I think lots of
companies will have something similar
yeah
yeah so I think there's a fair number of
use cases that just nobody looks at a
wine right now because we don't do it I
we might be seeing something if we do if
we do that it's so um ID mapping with
something that came up yesterday as well
Rob started to implement some sort of
security descriptors and things like
that and basically ID mapping would be
interesting if we want to have users
running wine have the same s ID they
have in the windows corporate network
and somebody's that really well we don't
need to have any library for that even
though somebody's currently working on
an lgpl library that will take care of
that but we can use a binary for that
it's called WB info it's not harder to
use than the current approach we use for
sama binaries so it will work it does
depend on win bind being installed and
running and set up correctly but I mean
if you want to do some domain based
stuff you'll probably have that anyway
the question is if we want that because
lots of applications actually want to
have an administrator account for
installing stuff like this yeah that's
probably something we need to look into
I mean this will be easy to get just for
the ID mapping part of it yeah we just
need some more advanced setup for
testing but I'm getting into that
blighter authentication is pretty much
the same thing if you want to
authenticate users so we don't want
everybody to be administrator so who are
they we could also do that against the
an Active Directory server or NT server
sambas or whatever
authentication using wind by needs root
access or at least access to the wind
bind privileged pipe which is root by
default but you can set that to
something different but it's a
privileged pipe so far we're working on
something more a fine-grained for on the
samba side of things because it really
kind of sucks to only have two levels of
like unprivileged and privileged and
privileged is rude this works for the
stuff winbind is used for right now
which is NSS and Pam and Pam also always
runs as rude anyway so this is you know
fine right now but if some other people
like wine would like to start using it
somebody needs more fine-grained asst
access but we might I know there were
some discussions about some sort of a
wine master server so have one demon
running for wine that takes care of that
was talking about for locking I think to
have one central instance that yeah yeah
yeah so I mean this might be another
area that could hook into that it's just
that if you talk to win by directly you
get SIDS instead of UNIX IDs so if you
want to do this on user ID basis that's
fine but Windows programs can't handle
that yes assuming the Linux box can do
single sign-on yeah
yeah yeah so when one takes care of that
one for us we just need that to be
running but yeah if we want to do
something fancy like that we need to
expect the people to set up some more
advanced stuff then we want to have them
run right now um yeah we probably don't
need that in the new future but it's
also some sort of a long time project
yeah testing is the last thing we were
talking about yell Mervyn oi gave a
really nice talk about the sound before
test environment mostly because samba 3
is now starting to use that as well so
he was giving his talk for the benefit
of this number three developers but I
think it's nice to use it for some of
our more advanced tests like yeah all
the SSP I stuff will depend on it I
don't know if we have lots of
applications using that API I don't know
you probably see more of that at a
CodeWeavers because I don't think games
you use that are there any popular I
don't know office applications that use
that
yeah so that's yeah so probably net API
is one area where we should try to get
somebody to do the work for us as well
but this one's going to be a bit more
tricky because the only reasonable
interface will have for that is our PC
and there's the small issue of having
well there it'll work with our it'll
compiler or the other way around we need
to work that out that's probably going
to be bit interesting um but hmm
especially if we implement net API using
somber we need the Samba test
environment setup so we can actually
test this yeah as I was saying this
might be interesting to test ID mapping
authentication and well pretty much
everything I was talking about we'll
need to set up some a test environment
for that so yeah going with the
suggestion dan had yesterday I'll
probably look into just getting some
script that will run all the needed
initialization to get the Sun before
environment setup and dresser and wine
test in that and see how that works well
huh that's basically was it Dimitri
approached me with some questions
yesterday so if I got you right you were
asking why we didn't just get some bud
to relicense some of the library's files
right
oh you just like coat we would then just
pull into our own tree and yeah so i'm
i'm probably i'm not i currently don't
think that we can we will be able to
share much much code so if we want to
talk to Samba we're probably best off
using our pc for most of the stuff as
soon as we figured out how to do that so
basically the i think the best path to
go would be for most things we need um
just get our ideal compiler cope with
samba I dll files or the other way
around and set up some ideals I'm rather
sure they're not caring about using
Whittle so far because they really like
the extensions they have and they use it
like to create a Wireshark dissector for
the SMB protocol and whatever so I don't
think that anything is going to change
there but what we could do is kind of
just work out how to well either have
their it'll generate a decent code from
our IDL files we write for an interface
like that or make Whittle kind of ignore
all the extensions they have and just
create code I think that's just the
easiest way to to get that done I mean
RPC is pretty well designed for inter
process communication without linking
and I think that's the best we have
because that supports authentication so
we get around all this we need to be
rude to access certain functions because
we can just authenticate and then go on
with our life and i think that's that's
the easiest way to do but code sharing I
pretty much gave up on that last year
and I don't see any development there
that is going to change much also using
samba code will pull in a couple of
dependencies that I don't think al
example would like like a Samba is
currently switching to talak which is a
really nice tree based allocation
library that
they basically use to replace Malik
calls and stuff like that and it's
really nice but what yeah it is it's
really a good help to to stop leaking
lots of memory and have lots of well
complicated handling of your a freeing
memory because you can just well free
the whole tree in the rest after you're
done but I I talked to Alex and about
that once and he wasn't too happy about
having a dependency on a library like
that I understand that I mean this wine
has lots of dependencies already and we
don't have to add more especially if
they're not cheap in lots of
distributions I think there's a Debian
package for that but I don't think
there's a fedora as a package or
whatever so yeah would be some sort of a
tricky yeah but so far that's just part
of the Samba code it's not split off as
well in theory it can be but at samba
we've been pretty bad about kind of
making that more public I mean it's a
standalone library it's lgpl people
could use it but so far I think we're
more or less the only losers so yeah so
I'm aware this was really a short run
down but probably most of you won't be
too interested in that area anyway so um
any questions left anything
um well in theory we could if our net
API would do that yeah yep but the
problem is we can't do that right now
that would be something a few file
system would be good for unless Steve
gets around to fix mount sifts for a
user that used to work at some point but
I don't know it seems to be broken right
now as long as we can mount as a user we
can just mount remote chairs under dot
wine because you give you usually it's
it's no problem to mount something on
the directory you own so at least four
ships because Mountain sniffs doesn't
have to care about security locally
because it will do authentication anyway
so we can do that mounting the stuff
ourselves once we have some interface
for that so either fuse wrapper for lip
SMB client or it's just a kernel module
yeah if we want to do have this work on
a mac probably we don't need to do that
that via fuse
um yeah so see you get library you get a
binary for the fuse file system you
built and then you might you tell that
to mount so either the cut the core
works because it's installed it would be
an additional package we'd have to host
somewhere but it's not a dependency on
wine so either it's it's there and
people can use it or it's not there and
there's that so I don't think that's too
much of an issue dependency wise yeah
yeah probably yeah I I think well if if
we can if I can find some other project
that's interested in something like that
and I probably will be able to find
something like I i don't think the
genome and the KDE guys are too happy
about using lip SMB klein right now
because new the new lip SMB client will
be GPL version 3 both gtk as q te as
well r gplv2 only so they can't use near
samba code and a fuse file system would
kind of solve their problem as well so i
just need to talk to those people and i
think if there's more interested
interest than from one project I i can
probably post that on the Samba sighed
there was some implementation arm on
whatever was there before fuse so that
that was candy years ago and nobody
looks into that anymore so there's
currently in what now SMB mount is the
old kernel module but that's been
deprecated like four five or six years
now doesn't stop some distributions from
still shipping it and it's completely
broken but it's been deprecated for
quite a while
so I think yeah something to replace
that but in user space yeah but that
works and then we can just do this via
path so just like have a as well as dr
see we have a network and then workgroup
server whatever and that let's just work
we can translate that in something that
whip SMB client can cope with
probably i'm going to pass that one to
rob you're playing with the single
sign-on option for all the used caged
credentials option for a until emma does
that work there's a back open for a
Kerberos provider that also will kind of
get that stuff working yeah right now
it's no and I think rob has some sort of
a hack that if an application requests
negotiate which is like the popular
thing to request because it supposedly
negotiates Kerberos on Windows or falls
back to aunty LM if Kurus is not
available we'll just kind of forward to
aunty LM and so it probably works for
most use cases yeah okay wait what well
the the thing that wine currently does
isn't it just not register negotiate
because that broke for some user on the
wine users list
well that depends on how you do SSO on
unix you can do you ssl on unix using
ntlm yeah well we don't have a kerberos
provider implemented so far um I think
this is about like one month full time
work to get this tested and implemented
the Care Bears part yeah um well there
might be some some issues with that so I
I just don't use any application that
needs single saw that can use single
sign-on I do I have outlook somewhere
but I don't use it for anything because
I think it sucks but up yeah but well uh
I can see that but it's just I like
experience on running this stuff on
Windows to be able to tell if it works
on wine or if it doesn't so I mean
there's probably something because
people can tell as soon as is
implemented if it works or not I mean
ask channel no ok well that s been a go
yeah that's negotiate so the eunuchs of
the RFC name for that is Espen a go it's
called negotiate in the Microsoft world
and it's pretty much the same just that
negotiate also handles um ntlm and
kerberos pretending to be Espen a go so
um yeah it's pretty much the same but
not quite now basically Espen Engel is
just some functionality in gssapi which
is like the standard interface there is
a couple of rfcs defining this API to
work out what encryption algorithm
should actually be used and Microsoft
has the same thing but like all the
interface so sspi is microsoft version
of gssapi and it's slightly different
like always the api is different but
what goes of the network is slightly
different as well but most gssapi
implementations cope with that these
days so yeah I have this funny idea
implementing all this stuff based on it
gssapi but I don't think it's really
worth the whole thing it's probably
easier to do sparse the negotiated
packages ourselves once we have it
implemented I see Dan grinning because
that's what he said right away when i
went to start like let's not reinvent
the wheel just use an existing api
it yeah but but ie yes but like I'm
pretty sure that gssapi is a nice
example of designed by committee and SSP
I is is a nice example of Microsoft
implementing some pre draft version of
an RFC their own way but internet
explorer is able to do aunty LM when SP
nego is not there assuming the server
will do that squid can do that I IAS can
do that Apache can do that there's
modules for Apache and squid that will
use the same ntlm binary why news is to
do the whole thing
which is actually a good idea if you can
actually if you can run Kerberos instead
in a regular unix environment you'll
you'll have fun running playing Kerberos
and want to have windows clients kind of
really cope with that because Microsoft
Kerberos is not quite Kurvers um yeah
heimdal handle Cabrera's does just fine
arm but nobody ships I'm doll so yeah
everybody's going for MIT kerberos and
MIT doesn't seem to care about that
well that might be but unless they
drastically change the way they react to
patches that's just not going to happen
so Heimdall is really nice and
responsive for everything bug reports
patches whatever and MIT was just they
were doing their thing and that was it
so if MIT didn't need it it wasn't going
to get into the code base I I'm not sure
just getting a bigger committee of
people will help with that so yeah in
theory if you had timed out we could
just but lat time they'll take care of
all of that both for linux only also for
wine yeah yeah well we'll probably look
into that but from the samba side of
things seems to open more doors because
there's more money in that because
people are I reasonably people eat that
the stuff that doesn't provide it get
your place yeah we yes em before
actually has the handle code inside the
Sun before tree to work around the
problem of not having it available on
the distribution but that's kind of a
pain to maintain so just because one of
the Heimdall guys is also in the Samba
team this works out because we can count
on him just boating all changes over to
some before but yeah that's well it's a
pain to do that I mean it's just if you
can do that if you can use an external
library just do that okay so anything
else well I'll just give back to Jeremy
so he can announce the next nice topic
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>