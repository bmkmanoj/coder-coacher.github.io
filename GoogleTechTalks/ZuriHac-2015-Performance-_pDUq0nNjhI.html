<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ZuriHac 2015 - Performance | Coder Coacher - Coaching Coders</title><meta content="ZuriHac 2015 - Performance - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ZuriHac 2015 - Performance</b></h2><h5 class="post__date">2015-07-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_pDUq0nNjhI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay it's like a heap allocated in
dispensing though we have about one
version I'm Gigi / key pocket object so
it's one cooking instructor an account
the fields 1-4 to do three fields so
first example here takes two words one
of the constructor one from the field I
say one for the field I mean um it's
basically a pointer to the field and the
first girl could be like an hour vector
or ins obviously the vector V is not one
word like a pointer to that value so
busy you try this reason and recursively
okay talk to them did this didn't happen
say uno contain a good I'd miss fk1
without without the chapter 14 the point
of a they go down ok course they do
quick one for the instructor to do when
15 works as that's a wolf um um that's
the first thing you need to know the
second thing you need to know there are
a number of basic types in pasco word 16
or a before in char and some of these
basic types all of the basic types
basically take one work if you
exceptions a double will take two words
and a 32-bit machine because it's a
sport it done and there's some native
types like the bike droids and it hasn't
other fees costs i have a whole table of
that i can give you after look it up but
this place was one plus number of fields
um there's an example is that finger
yourself
can you see the boxes up there okay so
this is a list as you list 12 its amount
to our integers in this case they could
be overloaded littoral zone because they
look here is integer so we can use this
exact principle so the cons constructor
delish no to instruct a bit colon x1 we
regret to this at first cause first of
all one word the constructor then is the
first field and conservation area
console has appointed element and
appointed to the tail so the point is
where the element is 8.22 and in I would
have to be look like in EEP what the
itself has a constructor with musical I
hash hash it amounted the hash is all
about to go just in any conventions and
then in this key balcony box is the real
integer value one God honors machine
work and then the console has a point on
the tail points the next con sale
console and the same one thing to know
here is if you have a value which is
static all right to the nil nil empty
list it's all the same that's not pelo
is it in nulla reconstructor it can be
shared in the whole program it
statically allocated somewhere any
points to every list points to the same
because it's the beautiful test so
there's a concert in so you can count
how many or memories is one to be four
five and ten ten words to represent with
linked list of men to women
jumps that go down by one somehow also
are you supposed to share in theory me
integer one that's probably very common
yes it's not going to 2g she five like
many GC base language the Pythons
interpreted ss2 has a small pool of
small integers that are cached and
shared so when you allocate them at
first they not share but the GC comes
around walks the data structure might
replace some things at the point to
share x1 it's useful I don't think super
rely on but yeah I eat the flesh words
um so all standard values in Haskell are
our box valuable keep allocated values
so including the integers so integer 1
it's actually a heap allocated value and
we developed a value because this extra
garbage collector garbage collection
okay and this I hash with the
constructor with key bucket in so it
contains that's not what I it's working
you can think about it as you know if
you didn't have the box you couldn't
pretty late if you have a function of
two thousand in and yet Tom partner
because a pointer can be pump and not
necessarily be honest right so the
uniform can appoint their base
reputation louse you I find some set of
values so the first word could also use
it no rather think about in this list
it's not the first word in I hash would
be the time this whole pointer could
points in some completely different
structure which was not as evaluated in
a good point to a closure data type this
on my represents and then that would be
much bigger than maybe it captures a
bunch of variables
um so um where like if you is it turned
us all the way down if everything is
heap allocated you know that's a hash
thing point to another I hush like where
does it end so GG has a number of unbox
or predefined hype as I mentioned one
for keyword type you can think oh they
have different names from your standard
types that we hold an impasse or double
hash hash means nothing if there's a
convention center part they are the real
machine valleys they cannot appear on
the heat by themselves they only appear
in these boxes like I hypothesis they
cannot contain thumbs as we said if you
just have a single box that is just it
in they cannot also contain a pointer
sometimes because the garbage collected
wouldn't know what to do if interested
soccer structure and this is sometimes
winter Sun as a pointer does have any
extra information wouldn't on so these
are guaranteed can be the actual invalid
double value don't know in directional
point for top hats and and it's kind of
neat because once you have those basic
types you can find a house for each type
as something special like you could
write things just put the box around the
bacon hash value so i can write data by
n equals my in fashion i want to buy it
without the hash int and then actually
in faculty so the standard data types
are not magic we call an intent type of
oxide we call babe hashtag unbox time
because my sensors have a box so with
this it under our belts i would like to
pull so here i have a data type hold it
impairs my specialized care only we're
friends very useful um it has a
constructor right I short repair and two
fields of type games into the box the
question is how much space does
interference they have to each pair one
about think I wants you
so how much does this data space least
impact take on the heap including the
space within to themselves I'm just so I
would say hands up for three hands up
for five and seven but someone like to
defend the position for five my wife is
fine to preaching because he change his
reference and he actually was the fence
up the same thing but you have to point
to those in so you had one word or eight
point yes is it again this is such a set
of words right because it's true that
two inside our box later two inch but he
was not the point of those boxes so
that's not being seven um so that's good
Scott bad right you will have to win
surrounding a seven works for you to
work with the memory makes sense there's
some garbage collection overhead tank
happen so ji-sub language but seven
seems too much and so if I may the
better first um so we're actually pretty
well off in haskell that we have some
control over mm er layout which is not
true for most garbage collected
languages at least until recently with
every less that's about any about
anything up for example in Java
everything is deep object if you want to
say if you have class which is like and
line and that's like x1y1 x2y2 for the
two points of the line we've said oh
that's an ugly I'm going to wrap with
excess and wise in a classical point so
now i have my line class just to members
point 1 and point 2 that will not be put
the same our memory you would introduce
these extra boxes and you would pay its
cost and you cannot get away for that so
you have made it straight off I can
my nice representation but it costs more
for I can not have an expectation that
all getting better member leigh.m um
this is changing because that's not
great i guess the addicts in the pool
balance types the most most days
language that's called i'm dropping
value types which acts as can unpack so
but we have something in the hospital to
control this already there's a pragmatic
compact it is already ready maybe should
have seen decks for it but what it says
is please Oh ghe might be compiler if
you see some data type feel some type
and I said is unpack before it pretend
as if I brought the fields in line and
please no adjustable the code that uses
this data type such that dilution is
maintained it looks like I still have a
I feel in there but the representations
such that I've been unpacking those
fields structure content um it has some
kind of constraints and the type needs
to be known because I can't say unpack
on an a like a hike variable hanging
because we don't really know what the
structure a is because all scripts
entire pack so things need to be more
and more big um they need to be single
constructor because if some type here
has several truck your fields of
different size it's hard to know how to
unpack it so one thing that says let's
take the biggest one it's a union c dot
starting to be the one that's an
unsatisfactory and it might be from a
good garbage collector because then you
have to put some lines in the remaining
fields so anyway there's some
constraints knees before morphic give
these be strict right because it's
mentioned before if you can have it
possible to thump in a field then the
fields report either the money or the
real out once your unpack say int
constructor there's no space for the
point brain so let me kind of happened
therefore the feelings in strict
the plus button you would think like
increasing the size by one but like
random randomizing as mine so here is an
example so okay we want to do better
with are you pair so what do we do um so
first here we have visitors any
preference have before so before
actually it added sweetness on patients
from those fields they never undervalue
did but that's in fact effect they lay
out by itself it says it will never be
any monster about without using this
fact juvenile plantation but if you
added unpack pragmatics fields the
representation is the bottom which is it
a three-point representation one is
basically as good as you keep up in an
abusive language when you see what
happen here we basically got rid of the
boat pointer and the constructor of this
in time why just we should eat nuts
already will decide the question that
was my set out okay the same question
okay um so it does now since seven ten
for certain field so there's a trade-off
in John practically with a hundred
fields like i'm going to type 100 fields
and then a mutated into parent might
even have a copy those hundred details
to make a mutated our channel for the
new version so there's a trade-off but
if the field is basically point they're
sliced or smaller then there's no space
loss interview is unpacking there are
some caveats still right if GT might be
too reebok scholars but its seventh
annual do something added app do exactly
if you have a strict field and often one
more type up in the top case where the
field would unpack to something that is
pointer size or smaller it will do so
there's a very unhappy
yes in this case it would you provide
the first thing Edison and the goal is
basically to buy the call to the right
thing get rid of this car noise in fact
this one has been compared to this
forever not teaching there is not just
an analogy where you think about this if
you're familiar with see in high school
writing bang int strictly hope it's
basically like having a point today it's
except like having one Viking unpacking
not thinking about the GC 710 thing when
you do this anymore would I be like why
I mean they don't wait so if you can
think about the cease trucks like if you
can say and see I work with the memory
layout to be this way you can translate
from the bottom of the top I want to the
pointer and see well then I wanted to
help on the asshole I didn't want to
point ritzy but then you want to the
bottom line console if anything
unpacking a safe space and your movie
directions which is good for caching
because you give this impair I kind of
slide it looked like all the data was
close to each other somehow but when the
garbage collector run some heat it does
not preserve and locality always of of
different keep operates a point each
other because it could lead us a
depth-first traversal so you could move
things away which meaning reading the
impair constructor fun to pointers
flatulence and then going fine match
against my hip free cash lines so I'm
packing for Google the data in one
instructor vs can keep to be together so
we'll help cash this one's have it here
sometimes is pure performance because if
you have impair with unpacking you need
to take that in the past the lazy
function with expects a boxed in you
might have to allocating box pass it to
that next assumption in fact this
doesn't seem to be any problem by theory
it could I'm packing is very important
all right you control memory outnumber
the office more prevalent in on my cpu
so therefore i'm packing these people Oh
that's your question yes ght Gustus for
small fields and to be consistent in
fact with unpacked levels even there a
bigger and a pointer on it for it a bit
G okay so this was the first part about
the spacing shiftry pressures of that
before you is laziness so so far roughly
into the memory hey defensive data types
but every unpacked removes have two
words I constructor and then then you
have to do the math but they will know
who i kind of think like you got to take
your actual data type you guys use
computer which is not sure you like
paper and planning some cute actually
probably a little bit some tools to do
this for you but you can actually do
math it's like this still have will take
exactly this one family um okay so how
do you think about like if laces means
our program is have demand-driven I
someone needs to value over here they
will trigger some computation may be
that cheap small complications that's
that they need to wait reasonable AC
program we are think but the whole
program at once like well someone
pulling up here and perhaps on here that
would be difficult you don't want to be
somebody whole program at once and it
turns out many cases you don't need to
improve local reasoning and where you
get there is it's by the following
thinking in your native language we only
evaluate the functions body meaning that
actually call the function if you need a
result the definition I pin you do case
f of X and I'm an instructor world where
we have to call f of X so the Vice
paternalism song so put the definition
the only value function if we need the
return value before we sit every
function always strict in everybody I
will never return a punt on the right
hand side of the last air and that
neighbors must think about functions
this way so here we have function max
function maximum of integers so what
gets evaluated when what like it is this
function with a value of x is invalid
why when the way think what does it
start kind of a back-to-front analysis
we started at wife and science yes we
have two possible branches to return the
value from X or Y then if you ask
yourself ok to choose which branch to
take which values must evaluate what we
need to know something about integer
comparisons open but but assuming that
we know that you know greatly people in
literature requires if you look at both
ends you can say well clearly we need to
look at both x and y to make this
decision therefore this function is
strict it's a wire or another if you say
they must evaluate made someone so if
you want to ask yourself what does this
finite function always evaluate
something and when you can start from
the back of the function ask you this
question of what must happen to pick the
branch maybe there are many branches in
many cases you can you answer it all the
way up and then you say well innovative
till you get back to the punch arguments
it will always will always value X it
will maybe sometimes valid like to be
the case or we never evaluate center
that's very boring tasty should've never
retreats argument from theoretical
possibility I mean I guess it could
capture za returning closure when
evaluated with cyber something so use
this backwards analysis and so here's
here's an example you guess again so you
have a simple function for inserting a
value in an unbalanced binary tree the
mind if he works like has a leaf node
which is empty and he actually keeps the
values in the interior nodes the binary
node that's a value in that has to self
pastry a tree um dangerous functions is
balanced tree is pretty simple feels
kind of an empty tree we create a node
with the value and then
we create two leaves if you haven't no
will check if this value is larger or
smaller insert into the left or right
subtree and now the question is which
arguments is the insert function strict
in meaning that which argument would
always about it but sometimes always
value none of them per second of all
hands up for none and some food first
you mean always peppery and always the
matter what if it gets cold wet wet
cement and and some tree okay and not
always means it's not true yeah not
always be they sometimes means not
straight okay always been a source of
the first first argument what's right
person oh well it's only the second
argument which means Illinois I looks at
its value how did how deep what one that
was I both
ok so I'm going to argue for our both in
all the cases in the second branch of
the church you use the second document I
mean normally or rather even use why oh
I mean you have to extract its values of
its good and in the person we also
needed to use if it's need both of the
second function of X is always use some
of our are here for the second case so
in the first from where you partner much
for the leaf you don't need to evaluate
X because you just pass it down to
another constructor right if it's a
pointer you can just bite as a pointer
and not only in the second branch if
it's not only if you have to evaluate X
in order to decide where to insert that
I think knowing all your relatives so
that the answer is only the second with
this reasoning I met a tricky because it
looked like the max case max ranch hold
on a second right but it's true they
only able to the second one it has to do
with this first branch alright so again
remember we started at the right hand
side of all the possibilities we have
four possible right hand sides watch
things must be evaluated to decide which
of these branches as you said there is a
case when it's enough to only look at
the simple guy and then pick a case
therefore we don't need a little accents
bracket we didn't actually if they're
not construct have a strict in not
matter because that means from create a
constructor we've got a bit x but we
don't so again you're starting right
hand side and can go out in words and
there's a phone case you running from
minutes and will be has an implication
for performance tools in there
and in here you can test it right
botanical insert with something that
should diverge and you will notice that
in fact that doesn't match the first
life but it actually will do mix because
another case so yes it smells like it
just just to mix me later stripped means
always if it's at least as I sometimes
it means lady sometimes does not mean
none right never kept within any plasma
in your data structure lips were and
with the end 30 or like I temperatures
um right until it reaches the Trinity
the end it will be the second I've only
think with it completely empty tree you
start yes it's retaliatory ass but this
is like this is boring case the briskets
the void gate is only a social ills
example good which the second most of
the time it's a nice right because it
still more time certificate yeah other
than cherries with a polished and no
official way to evaluate its gonna die
that my way what we yeah okay yeah cuz
if you start guarantee then now you can
try this you can almost over and see
before it's an exception if you keep in
mind this but you said that the right
hand side of functions always evaluate
that's strictly like the only call a
function if you when actually evaluate
the last thing that implies that if the
return type of the function key in this
case F Buckley as an argument recipe
contains only strict fields and those
fields are types with those obtained
modules themselves we can tell for sure
that a function does not contain the
doesn't retain any thoughts I doesn't
retain any memory there's no way a
function that returns is t1 which is
what's in hold on to people out of
memory because there's no no point that
this gig of memory could be referred to
from the return value it could use a
gigabyte quality education possibly but
not
the way useful properties we know that
the return value is strict like we can
we don't need to look at the function
return unless report that it does
something stupid I used to think of our
memory but I'm from our space and
laziness reasoning you say it returns a
strict value they've have strict fields
it doesn't have any funds held leaking
space not between any member we didn't
want to retain there's this little star
here because if you have a strict field
like theta T people see and have a
feel-good function as a screen right
here you could return c with retained
some march variable that was defined for
some insider punches
you put you can capture something large
by that potion but if you don't have
closure you cannot retain it in this has
implication our first guideline for
production quality code can kind of not
cover the preliminaries like how does it
work and now instruct apply this to me
live design I argued that data types
field should be screwed by default these
reasons memory layout reasons and at
simplifies reason about species which we
know your attorney lazy district in time
you cannot have been comes to worry
about it i think but that's like to
think carefully whether some people leak
just by design a function cannot retain
memory day we don't want to retain and
so this is one if you count the number
of if has with strict feeling like
containers text by extreme but like i
said in this one's there was i think
three their world had lasik yields some
proper design it's like it's the lazy
text constructor it's a lazy
bike-sharing instructor was basically
list and it's lacing the second element
oh no said third one which was wrong it
didn't happen to matter so much about
bigger case that seems very locally in
some function but but it was in fact not
so this is not like this is apparently
what we high performance is like it
obvious doesn't mean i can write a
higher education you have it like a data
type is used twice and has like two
fields and maybe doesn't matter right
but if you want to make things work well
by design this is true for music at the
time so as visit data type so like
either or
maybe a good question will compass it is
life number three after this one I think
another note why why having strict
enough health to consider this visual
data map so this is a size Fallon spider
treat abused intimate data plan it has
no empty leave or binary node that has
some sites kyun kiya baat keeps a key of
the map stricka-- value that the value
not strictly valley in it and two
subtrees right and no there's there are
strictly sub trees so now think what
happens in the insert function if the
subtrees relates your strengths so
happens if the subjects were lazy mood
an insert let's say we've got the binary
now we'll compare the new key low key
and see you run to put something on the
left or the right and if we create a new
sub to you left or the right which won't
have decided if you relate to hear we
would insert a subtree that venue
evaluated would continue to the insert
but i wouldn't do in that right be the
in circle just take one step and we'll
just put and thanked if it says when
everyone looks at this branch continue
do the insert first before they do
something else so basically the next
look up with an xquery function will
encourage positive which is bad also for
reasoning about as some topics because
then there's little tricky when they
cost the course is possible basement
review um but but for this slide more
importantly if we created tree right now
we might have things in cash it helps us
for example can get key in the value of
our inserting these are in cash right
now so dude if you've got a good work
among those keys and values it's good to
do it now when we have the cash rather
than later and look up and made out of
cash infection each other they might be
in ventures even so there has a small
benefit some cases on on cashing rich
group and creating the instructions um
here's the other one so there's visit to
drive us be strictly rated Hatfields and
both give the accumulators in recursion
this is a common its fall this visit the
fold l without the Prime in hospital
right if you have an accumulator and you
accumulate stuff into it letting this
mean function use the mean of Alyssa
levels you will put things in your
cumulated it's is the the laser sir
percival only captured by the
straightness of a binding so lazy to
make I do let x equals the lasons
another test but but it can be control
most developments data types which is I
guess one of the messages you don't have
to see there too much body should just
be let bang x equals or shouldn't be
like so bang on the third argument
dysfunction it happens once a yr think
mostly not so if you have a cumulative
in the recursion this case read
cumulative music's top opens begin to
keep the sum and the number of elements
little couple so we can take the sum
divided a village development and I mean
this is probably not that's what they do
you mean by the way this might not be
American stable but side um so if you
have it an accumulator you have to make
sure two things positive a cumulative
value if it's strictly hotel does this
for us make sure they accumulate
evaluated every time run loop and that
that cubic itself doesn't hide harvest
so this is one way of avoiding the lazy
PR actually has to like the fields even
in the pair itself is evaluated strictly
to a pair at the person point of months
good point monthly it would like the sum
would be like chain of pluses and
service so one way to do it just to use
my accumulated since I like a throwaway
they're not affect it's also possible to
do this you're buying items by the way
you can put the bank pattern I think
here here and here and you will I think
they're type approach is more
think i'm sure that data type of have
any hunts that they function it
accumulates strictly this applies if you
vote this recursive punch on my hand
it's a writing prevail time you do tend
to do that sometimes we write explicitly
freshman and easily communicate about
evaluation order so this is almost the
only one other place where you want the
strip bang that doesn't have to do with
their hands but not looking at in
theaters so if you both fold l manually
or Calpine i know you actually have to
have a bank on the accumulator you can
only put it down there you're using Paul
Dales so it has the bag on a few later
it's we just need to get another place
and other application of the same rule
it's but it would be tricky so if you
have a monadic code let's say in the
state monad is called return X you do
some permutation intern x you might try
to apply my room before like what we're
turning acts right x is a strict data
type you cannot contain any funds right
if I design xtube you not thumbs but in
fact the monadic code might embed your
value in some other box let's take Mona
keeps the state around in some box so
when you do return at X the first case
yeah I basis i take my competition for
your mind at a time alright and then put
that data type in the box but since the
box is latency
they're not as much cool aggregated
maleate it there for you hold on to
these are all from iOS honest and I
don't think about it more and you can do
this you can apply the normal recently
move as if you return your own Street
keep go back to this tree again with the
lazy base case as we saw before it was a
degenerate case where we had a MTG just
happen to Hoffman what happens and
because this happens we have base case
for real lazy and parameters I'm very
brainy you should simply make these
strict it doesn't hurt a lot if you
don't but if you do the whole function
is strictly automatic GG will do better
job optimizing particularly in this case
insert it will unbox the key and pass
around and register for example every
time that's this insert name sort of a
personal puncture so you want to do this
innovative and and we do this in the
container for example i think in
containers this particular optimization
is like ten fifteen percent insert
performance so it's not like huge
and here we come back to your question
about existing data so obviously we
eliminated in a language in a ecosystem
with lots of folk dip that we use which
are not streaming in their values and
then you have to be a little more
careful this is one of the cases like if
you had to be careful what is you have
to get used to spotting these because if
you look at stack overflow when people
have problems or performance often they
do something like honey do the
computation very nicely maybe put some
bands there and then they put the
resolve in a hair or in a justice
instructor or left or right each other
which was lazies been fighting the
ending in that older bank hunters work
for nothing because thought up anything
didn't force devil so if you return
something in its I use parentheses that
equal to normal
so typically I put something you know
what is it have to use force before
Justin dollar bank you also use your
left bank pattern X equal your
computation in just X it's before hi so
that was it unlacing that's any more
questions before we get into chicken
like yeah the of comparisons we'll talk
for example integers this max example
you have nice smaller than life you
could imagine that if Y is the minimum
engine and that they don't have to
forage the act or if you have a double
where one argument is not you know the
comparison can be false yeah equality is
going to be false okay have any create
ripples and unique or or instances where
it's like the comparison operators are
lazy in one of the way yeah it's not
guaranteed in type class to be strict no
jeje if it sees the actual concrete pipe
he knows that this is there less than
equals in everything would be fine if
you write the generic function e num
doesn't ensure know that you might have
telex to value each other we saw this
cell aqui what does happen and I need
you started instances I I don't know
instant incidents which are not true I
mean you can imagine something surface
you can return it in doesn't pass stream
of digits right I don't know when your
symptoms is actually useful properly a
tree consumer yeah
so this is really performance
orientation is but you know a new insert
function you're doing so you have three
branches sorry I things in max or
whatever each of you are comparing you
know X smaller design then you were
doing another comparison and I'm just
wondering yes you gain relation compare
and get an ordering in June it should
compile the same thing I read less than
guards or you've got it all compared in
the future low-level jÃ¶rgen a
competitor case stick in double check
another level but it shouldn't matter
and you should collapse branches a bit
too yeah okay your example certain inner
it is comparatively small and very easy
to find the most strict arguments but
for great anecdote how do probably do me
fine to not strict regulations do we
have any tools absa GG South computes
the strictness it thinks the function
has so you can actually dumped in
sonipat let's go to the core language
was a simple person passport they will
actually say what I thought this trip
this was and then you can look at the
signature so I strictest replacing super
strict lacy look at more complicated you
can say no that doesn't sound like to me
this argument only nine minutes you can
dig down to that argument as I know
after that some people actually use for
thank our internal arguments I I know
this would be strict
I I think that occupies quite a bit too
much I'd rather much more school of
think about what values you are to
return get their strictness there so in
the map example and actually the best
solution is to well there's two maps
it's about to the key value we used to
make the key strength in the resultant
tree and which means the base gives boa
constrictors has a key as an argument by
the first function of course parameter
and it's going to take the key input in
the node which is but yeah did you can't
compute it for you the to leave them it
looked nice and I went to the high level
thing which your colors you're like a
new editor colors your arguments it some
colors or spying 450g thought about it
remember hearing about Stewart's each
you should be straight by default and I
remember him saying the spine should be
lazy you say I think it's wrong at least
four trees so that because it's not
useful it's very little useful screaming
than happen you can list different story
pepper trees I think it's wrong and if I
all our journeys are in our base library
parts they could post by am Edward young
about lake city streets fights that's a
lotta mostest
every time I stop so it may be very
similar but what was the original in
boxing such things as seats and stuff
like your first guideline is always
something yeah so what was the reason
because it seems kind of wrong in the
first place consistency made by Haskell
box is like why I suppose my house the
boxes man why were you they decide a
couple so if you're lazy by default you
must be box by default because see a lot
of lazy time at any place you need to
have the field reps and as a pointer
which either pointed box or the Sun so
once you have that position you'll be
basically happy you guys but I am sorry
cochin so just gotta type is more
insidious but the function arguments you
can still make them straight Oh save me
sing at least lazy by default language
so I mean the organization is over all
is there are more as you write a
function in length away they're more
functions you can write I think you can
write function it only includes
collecting and lacy language but not
constrict I'm sorry baby deers did you
just kick laziness or where you have a
lace by default language ladies implies
very quick response got no pubes doesn't
look like yeah it isn't i think this on
a data type level I think the script is
my business default it matters less on
the code inside the codes but this has
been five years of hindsight
maybe better compiler analysis might be
a future this is basically I'm not
trying to take a moral stand up and say
this is what we actually do this is what
we actually are successful missions
taken linings I know you've read some
core library sometimes it seems like
you're in line pragmas everywhere many
of them were are not me thong is part of
the plane we'd be line a bit too much
jay-z such a great good aligning small
foxes by itself it has a pretty good
calculation it looks at like what the
game is eleni something in terms of
what's to use static information we get
to the cold side so usually a lead in
Miami alone there are some cases if used
the rule we bike system ught to be home
is rewrite cool then you might be doing
my to manually more rippling but for the
code you don't really need to learn so
much there are there are cases if you
write application code about it so much
this but there are some cases you cannot
in line because it has no what to do so
if you have a recursive function are you
a compiler have you in mind that like
every time you see Matthew light again I
think it's in line you would never end
so so we're crucified she says I in my
dysfunction it won't you can make it in
line the body of the recursive function
by fracking technology person functions
of the case bottom and this is my career
I philosophy small simple recursive
function we have a non-recursive wrapper
and there's compressor body and do you
see really like the body once in in the
call sign you know one thing like go
like a cursive again this again plus and
b6 impressive but it will in line the
body of go once and if that might be
and show the compiler for opportunity
for optimization expose more opportunity
to optimization so you will see this law
PPP invite this provided cursive
punching the support for a purse time it
is no position that could be
automatically and it is Chris some
experimentation doing alphabetically but
there are some generate cases with my
brother house so it's not and why why is
this useful well if you have a cheap
function like mad but not does very
little work you just basically listen
element it calls a function if you don't
in line matter the function to call it
here is unknown right as we passed as an
argument which means this is from an
indirect function pointer look up and
find it occasionally someone who jumped
you with it after that that's less
efficient to jump to really intercompany
redirect job which is a go to do some
maple by making something happen or
recursive rapper the body of map will be
in line somewhere and then the unknown
call can be resolvers we in like the
body of map in the cold side where we
passed like plus one that's the harvard
argument that geez you can discover
several things but first it could hold
plus one directly by jumping two plus
one is indirect jump to +1 and they may
be discover i live in such as oh it's
indians and I know my arguments are ins
and i'm going to unbox it specializes
function pinion and balances specialized
if you need to get specialized an
unboxing and master to do loop who just
has an evening bag mr. part of things
marriage so that's the benefit of
reviving something that's working at
this time it depends on the nature of
your function to need is a map right we
did little work except calling it if you
have function like they don't matter
insert with so integral takes an
argument after that says what if there's
already value in the map what do you do
the combined value
use our gift with us and there's a lot
of work of unrelated the cooling act it
traverses a tree you know in several
levels and then it goes up just once so
in line that it's less that's not that's
going to rule of thumb and my conscience
simple of course after you so many times
maybe way to do this recursive work
about versatile otherwise it's about
that once in a while like let me check
the lower level completion results we
might find it in line exactly what we
wanted mi chris has some size threshold
of this is the functional in line is
this big and yes it's this week that no
maybe what's the way you get unlucky
interest wrote the wrong side of this
boundary because my mother I suggest by
the kokino um another pack by I think we
should use is in line about it's poorly
named I argue it sounds like new line
but what it actually does it says this
functions body is defined a function
defined in some module and one make it
available to other modules I felt in
line it doesn't it doesn't make it look
cheap like in line up enlightened mix
mainland high ground makes the quality
of function looks smaller than its if we
teach you in mine it more often in
language says make the body available on
the function John modules and in fact is
then DHEA the cold side can decide
whether in line and a big lip is an in
light of apartment what it will do is
say if I could specialize in type class
arguments at the concept I will generate
a copy of the function that was more in
liable at the call sign so in this case
they were function f which has some at
hug for morphism some type a sponsoring
a and had some body and at the course ID
n is not be in it and enter smooth since
a stone there since the arguments not to
be int and then punches Mike reclinable
gives you 0 generates like f1 for
specialized to eat function which is
specialized in removed overhead of
it's type class dictionary in direct
calls to the positive + method or
whatever equity we use this by
previously replaces the cache of all and
none already on order two containers for
example in the hashmap type have every
insert function marketing liable because
it's quite valuable to specialize that
function its key types of the hashmap
pequin peppers hashable hashable k equal
k to the key should be hashable and then
insert Kasich a and B and a hashmap
inclusive attachment and specializing
that k to an end and figuring out with a
half the actual hash functions we use is
statically the call site would remove
amount of interaction so I would use a
lot on your book if I have a function
which has a higher class than exactly
there's some benefit to it sometimes not
independently how big f is as if does
tons of work and and like I have show a
once upon a time or show but if if you
think that the specialization of this
argument and concrete type and concrete
type class of useful than using life
those are some optimizations unlike in
line where it will create a copy of the
inline function every time and there's
no in line on earth every time you see
at even in the same module in light of
our mind upon it in light of what we do
is more clever will generate a new
special address on earth and then we use
it and every time so it basically like a
rewrite rule so I created a specialized
body and I create a V by cool that says
if I see f I can't use the sky so it did
question later when they this
specialized will it still try to in line
at it yes and GG has a limited number of
iterations of its optimizer barbarian
that you didn't run out of those
watching try to inline into its normal
things what's the cost of doing this
mineral rights it doesn't use it so
there's a there's a flag you passive
because everything is it's in my avoid I
think we just have hash out if it's
always a win and we should just always
with every time class function for small
function which other high class vehicle
did you already exports that by default
we don't really line was very small but
something like faded of hash map and
inserts the big function provided photo
log exports its body into the H I pile
where it keeps things in so maybe the
boy
I was in learnable related to the
specialized program you can basically
give its light and say hey generate this
I'm you put in so the difference between
inline able and specialized about is
liable is called cyclic driven
specialized what you can say in depth in
the model defines f I want these three
specializations GG will generate these
three specialization there and if the
user side happens to fall on these three
ones you explicitly enumerated you get a
kick off their civilization line of all
says I can't knew my goal weight f you
can be used please bring that with you
and inside and call psych driven mad or
decide what to a specialization to do so
it's a much better specializing it's
good school sector that's imported in
blue Babel the cases so it does provide
some of your specialized version or the
existent no it's really be exported so
amazed if you have in liable in mortal
fear that gets triggered the module over
here infestation and rewrite rule that
we write will be exported all people who
depend on this module to get some better
cook reviews nike the leaves have a
specialization everyone who uses of
leaves will get the specialization you
can still an ugly too because you got
too much don't think that kind of each
other in any way right by dust does give
them use which is nice because i did an
analysis once or what part of I think
our purpose here I come so if you don't
have that something like hash map he is
amazed how many combinations of those
you have to seem to be a program
specific cases specific bees and it
turns out if you look at the larger
lorded co-pays it kind of tapers off
right the possible combinations are you
in it but the actual combinations are
150,000 so what would maybe hope that
the specialization will be brought back
eventually you'll generate all the
normal stress lectures in your program
and every time you use this function
again you can generate naughty photo
so with that a couple minutes we'll see
how far we get so I would like to talk a
bit about core the core is gypsies
interviewed language it's a low level
high school it is its language EG uses
to gloat vexatious and it takes you have
the program provides a simple high
school then try to optimize simple
answer why would you be interested
knowing bike or because at the core
level you can answer some questions for
sure I first value a shin is more
explicit at the core level and you can
see if things got unboxed or not you can
see things got in line door not like
it's the final after the compiler was
done with your program representation
you can even sue actually happy and I'm
going to report through quickly a
smaller example so it's a very point for
program it sums numbers answer loose
events and returns in it and it's a not
particularly good implementation of some
but you know it's lengthy a 0 otherwise
it's x plus the sum of the tail so to
get the core of course we achieve and
compile with this command line at the
core network amendment that the more
importantly like is the first one dump
simple which means dump the output of
the simplifier and simplifier worked in
court so that means that the court
there's a bunch of these d suppress foo
flags which allows you to get the less
proposed for the course by the proposed
language because it has old age compiler
provide information about everything in
that intermediate language but sometimes
useful we can see things like what was
the strictness the compiler thought this
one should have but often usefulness
evening on it the main things I mean
these are two flags age we use module
super smart of prefixes means that image
in line the function if you quote like
David maybe the food is a cesspool in
the castle which means sometimes get a
few singers
my main question usually in sports so if
you do this ah yep it specifically
request facts and one thing to notice
situated on optimization it has created
new variables and leave it all variables
so some of the names you had an original
program or something for your arguments
your function like a disappear be
renamed its around so you have to do a
little bit of detective work and say all
WS g j actually probably my argument
ends i actually look about the
functional stuck there are some some
ways to read it there's a MX mode I used
to open it in edit or sometimes like a
dilute notes because it's over folks
like to all this this is cork here this
part so here's the core for the Sun
function what what has happened but
first in this case it has actually been
work your record not for the inline
AMOLED reason the word proper but but it
had done it says well some take some
some internet pants that some of the
bottom that's our real son function but
let's see if we can unbox on this
arguments and what it says it all out
the in the return values those values
I'm going to be strip center that's
their unboxing and I'm gonna call this
help or whether they help it gets back
to me I'm going to take their the inside
gaming here and I got to put in the box
pack so much that's for talking this
case not very useful optimization it
tries to do these work your back where
things to see if we can on Fox things
because the hope would be that well some
of you hope is if the call cited son
uses in the right away again gives equal
Sami some list of our amended this plus
plus seven if we in line this wrapper
the call site we can maybe get rid of
this me rapping of intensive box again
if you use the result of some right away
that's why does this work a rapper
package imagine if some was in line this
on call site that was using eight so the
course I book you might it will pull
some get a box and open the bar do
something with the box and do something
else but if in line is worker at the
intermediate box in salman butt
and Sutton and this infant probably
Patrick register so use medication and
interest it's already very useful here
because we actually have this case
there's no support we are using the
result and run unbox to go to every time
I step in insulation that's should we
tell them to do because yeah it's a very
good point just by oh it's not very good
some punch we will see the next fighter
that I should not good there's somebody
a you're right yeah you would wait when
I this what happens maybe I should slide
when actually okay um yes good so you
can see here so here is for me the
mentalist head x let's call X and some
things with make it unique and we have
to say okay unwrap your veins which was
the boxes per element close in get the
real in cash which is this guy and then
call some recursively to get dressed
some and then use the native plus on the
salt of this son to this little unboxing
actually summer through their native
plus on rivers so yeah this is saving
here too um we're might say okay just
just to familiarize with the code looks
like again you have this hash is done
box types see those are usually good it
won't hashes you see the better
basically means the compiler has removed
boxes so ideally which is not giving
this some function may be right one is
nearly the Sun wanted to be an
accumulator person some function right
we don't want to before break recur
singer in an on-air position of the Sun
function now you'll need to have
something that's accumulator and asked
evaluation later not really that
cumulative would have type in cash I
mean an accumulator is just like it
actually value which is going to get
past the register or whatever where
every time we go around the Sun so you
would like to see you functions at least
that that the worker parts of your
functions to hot tired couch like blah
blah blah blah blah blah
and that's going to miss their duties
removing interactions and boxes some
things cannot be mbox there's no
unboxing no packing list it's definitely
data structure will be live some heated
leather be unboxing but he liked to see
hashes we always said the dead fetus
plus this function yeah and it has these
primitive operations that you did to
apply it so plus plus in a salon in is
defined as take the i hash you don't
take out the value take the second I
hashtag out the value apply the native
you know plus hash native one machine
instruction edition of the to a wrap him
in the UI hat box and since it has
unboxed some things that remove all
these boxes will actually use you see me
use of the unbox last operation was just
a machine structure and yeah this is
unfortunate back right it should be with
the nest accumulating recursion or using
world a little things and there is no
that I can see off its not in this
version of the core so sometimes I think
I got what rid of it but you will be
notes in this course saying something
like up in line me it's it's a something
GG astoria is internal representation of
the work and function say I try to even
like me really hard because it's
specific for if you like this rack or we
might get rid of indirection so if you
compile this code without suppress ID or
anything else when I put them in here
without this guy you will get more data
but you also know things like that
gation thought that this function is a
living in line or it will say things
like I think this function is
how does the GC differentiate hospital
record I can the detector this one and
it is it soon it can coconut in put the
TV up here Susie has to come sit up here
in this sugar stage yellow or can it
compile corn no can you won't know
that's a 42 I think we can actually have
4,000 on the side no because then you
can kind of have your own yeah yeah
there was I think no not now there was
an article external of course on time
fact no so you cannot feedback this core
file yeah but you have her me yeah yeah
there's some plugins that you in the
middle of could this my knots I
depending almost such that after the
main reason some expired can be seen
here is it's not tail-recursive there's
obviously something's bad which means it
would basically create more stack every
time if awesome and people get the way
the other some food from before doing
this edition so what it should be is
happy some in list of in twins and the
first parameter will be na the
accumulator and the core we would get
presentan let's not worry about
something up but yeah we should add
accumulate aversion quiet and see what
the core looks like and you will see
that will be more impassioned are good
and you will see that this we boxing up
there are you misread that's some
moments that were so this speedy then
was like you don't need to worry too
much about tail recursion is tht dolphin
oyster are you saying that you should
make your functions that we perceive as
much as possible if it carries a
teachable not what we write I think non
tail recursive function a failure person
function on everything backwards so if
it's something that should be tell the
person s art is just should be if it
should be a cumulatively person you have
to write accumulate recursion and not
magically make it a community person or
if it should be killed oppressive could
be another person you have divided in
such a way you should belong to these
and introduced to be tailored personally
if it's for example if it's late level
accumulator plus the other person in
this case or if you've a lace eventually
crates of lazy list so if you learn to
the argument of persons
you can always make any non generic
resolution killed I just representing
the psychics with samples but then do
that you're not going to get any
performance game because you're
essentially allocated not probably a
little more than Jason if you out get
right in cases like some where the
emulators not a full sack it's just an
integer payment and probably end up
doing last other patients here no this
is in the chamber yeah the key
accumulated one person that gets
collapse if you keep accumulating a list
that might not be helpful if your
accumulator always grows and don't your
community reduces intercept is that a
good real gas
so there's histology say is it
profession something as it doesn't keep
more sort of discipline if something's
bad because performers are two people
cannot talk the presenter might say it's
simplifications that because a person
you spoke yeah okay as I have both words
he has a boat elmwood like explicit tail
recursive son and the full Russian they
saw some wood about the same court it's
made some explicit here because each of
us to see how the summaries language
disappear so I'll try to remember when
summary you strictly appears by default
do you try to be back with an envelope
calculations on your data types
especially people between lots of them
in the map or something you got how much
memory memory which is actually kick
your accumulator should be in strict
there's a couple rules of farm like
return dropping on returning dollar
bangs and I can use those reading Korea
and we're saying its management right
good high school it is a useful tool
I've had pretty interesting lightning
see was it your father talk to my lower
level it's not necessary but it can be
useful in some cases this is a question
for it it's it was great talk because
that's not the kind of stuff
we start like to enter this competition
stick a scope I performance we really
need a book and effective Haskell I just
practice even less effective Java which
is like what do people actually need to
know when you you actually like and it's
lots of kind of the Java one is you know
structure that's like 20 lessons it's
very specifically these cases dude is
not the case is just data type right
don't fret working on concurrency
because it will fail look there you go
beginnings of what my morticians I was
thinking if I started programming and
software and I start by not thinking so
much about optimization and then and
when I'm done with functionality and
start measuring performance and start to
find these techniques with but I have to
me right I would if I wanted to be but
love but i would say no it's not a great
strategy because the first i've been
trying to get good performance by the
science that you don't have to talk
about it particularly safe you stick to
the script data feels right just stick
to that and hopefully you don't have to
run this step in the end it says you
something is wrong now we have to think
about it there's also something pretty
good strictness laziness let's say so I
applications blinky memory i'm going to
add a bang here so I still leaking
memory as bad for the mood is buying
another back here honestly remember
doesn't work it could be these two bands
together would be enough to force the
value and I mean we want to avoid this
kind of guessing scramble demands
sinkings we're trying i try to plug this
sign you program reasonably well i'm not
saying like do everything like the ten
percent you get for making the base case
free
maybe if you don't quite lead instructor
level doesn't matter but I really would
say do the string data type kids I don't
have to go the stack overflow up to two
weeks before going to shipment in my own
applications in eight gigs around have
no idea why I know but I think you
possible to use top-down approach so to
optimize after you as you guys have
included optimization in your design
okay it really is impossible to TV so is
it does that make me don't like so when
I fights evil past for the google I
don't do it there either I don't do that
I think this is this dog tooth both
whispering abuses endlessly right he's
talking about small inefficiencies and
see and people think it's an advice to
to not think about education when
devices coated us consultation on beach
we are in the business of finding
programs we do computations you think
about how the confrontation but the
shape of this computation is now of
course sometimes doesn't matter right if
you're writing think the clothes the
databases staff destination your patient
that's all excuse you could probably do
all kinds of things and this is totally
fine and the same to judgment by life as
an approach why production quality
software it's very hard 550,000 lines
for first and enter the passion with
maybe maybe you're you approach for
style right you have chosen data
structure representation which will take
the 64 gigs of ram and now it's okay
then you have to be back because you can
do this pattern envelope a patient so or
you've got the meeting its this leaky
mode it's like a lot a small better to
just let me to correct this by
construction in fact to say why i can
write this data type is there an African
I'll gr8 their type which have these
constructors 2000 forces that this kind
of happened I would have been saying the
performance I'm going to construct my
program I didn't have such that this
cannot happen
likely to happen and then I could have
to worry about I can do my happy coding
mode right now I think so like I'm of a
good thinking part so I re-advertise by
design approach my understanding is a
ninja media presentation i miss my
receiver there anyway yeah it's part of
the dee dum up to see mmm and it's
already done assam i think unless you're
working on very core data structure
libraries nope ice-cream hacks you will
not want to do it I mean it's very
educational life is really fun but you
don't need to do this I do it for for
the hashmap the attack breakfast I care
about exactly how the instructions like
coffee one material which is laid out
when the pop count instruction happens
yeah I know it's funny you do it's it
you know that's a damn often see it's
quite beautiful oh this will not a part
of the talk what we were talking about
the performance and a hat rack there is
a topic of the stream fusion and Sasha
and I get confused about it I don't have
some guidelines for making sure that
this code new gets used in this world
well yes um let's see what I don't
remember them so they basically easy
guide line is I think if you speak you
should you need to in line harder you
need to compile the code to because they
realize an optimization whole construct
your special education which i think is
only on about you I think those tomorrow
it
remember just as an olympus of small
package called list you can grow for
this judgments diffusion which is a
function that that's nothing of type
list of a tu lista face you put it in
your code and if it still there at the
end of the computation through narrow so
something that you expect if username
and you can make you a surgeon's about
what you expect to be infused sometimes
it helps to ensure that whatever you
think is a nice huge know it stays like
that there's also applied like dee dum
simplifier simple stats will tell you
how many types of things fuse it's not
super helpful because it's alive i
didn't fuse 12 times but you don't know
how many houses was supposed to be you
so maybe it's not very useful but he
isn't it's a hint a very small
programming to look at it and says I'll
add a map map here and there's no map
map few school triggered at all that was
the guideline I think originating from
this same thought that keep the data
that trick but keep the functions lazy
and the last part is a bit contradictory
finding the banks for fixing the HBS
case and stuff all right how do I know
when to stop not just looking back over
my arguments so I think my advice would
be KKK dos equis trick there is a finite
not inoperable cases with that is not
enough like accumulated expression and
the rest doesn't matter stone that is so
you have to do that accumulate very
person like if you don't you will take 0
n spaces in all aspects that plus the
big data height and maybe different all
about this like us for cases in your
magnetic those those at least reals you
should probably do a month you may be
optionally base cases come out and the
best if
doesn't matter so much just structure
first always validation yeah I will
always do just dollar bank but is there
a problem No so no it's what there is
some things we could do there at beacons
try to add a feature of GHGs you can
make little more fields strictly texting
girls I brought just Fanny times maybe
you could do that and how to track your
work together Petra that will work up we
can try to add a version of the just may
be hyper district that's because of work
papers it's not really has really
happened so the climatic thing to do
today is you added all right general
question block the separation function
because that's simply very good
regression function and sense that it's
naive and kind of very religious and so
it doesn't mean that you see it doesn't
actually know know about this variable
type where there's than one operation
before yes so it was not telling her to
go through what plus you have one boss
she doesn't matter it's not possible
talk to mind like its kind of beachy you
could have like a rule-based obviously
the station engine but just know if I
see this particular pattern of in
advance did she doesn't really generally
reflect that as generalization rules and
I don't think there's a general rule
inhabit this well enough except with
simple cases so just buy it right the
right way to do here is useful for their
find some example bus for practical
purposes but really use the highway from
the neighbors and they embody divided
hi thank you lunchtime</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>