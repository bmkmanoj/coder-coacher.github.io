<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Seattle Conference on Scalability: Scaling Google Maps from the big screen do... | Coder Coacher - Coaching Coders</title><meta content="Seattle Conference on Scalability: Scaling Google Maps from the big screen do... - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Seattle Conference on Scalability: Scaling Google Maps from the big screen do...</b></h2><h5 class="post__date">2008-08-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/302g_q8Frjk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello we talked about Google Maps for
Mobile and people might not realize this
but usage growth on mobile devices is
going is growing faster than usage on
desktops and furthermore there are
countries like India where there are
more people accessing devices asking the
network and other network services from
mobile device than from desktops a lot
of people don't have access to desktops
or laptops or whatever the mobile device
is there access to data services so
here's a screen snapshot I took a web
google maps a snapshot at 800 x 600 so
this these days we think of this as a
small laptop and you can see that the
web version of maps is already not tuned
for this small of a screen a fairly only
maybe a third of the screen here is
showing a map which is kind of the main
point is to see the map so and if you
have say a trio and you run the browser
you can you know the trio has 320 x 320
screen which is fairly large for current
mobile device actually and the web
browser gives you you know version like
this you got a small image of the map
it's static can't pan it you have to
scroll this you know the screen quite a
bit just to see any of the information
you got at all so right up to bat you
know making this information available
from local to mobile devices is a this
UI scaling question that's why I think
of it and furthermore you say well why
does it matter and the answer is
actually maps and local search is
something that's really good for when
you're moving when you're on the go we
are traveling okay a lot of the
questions you ask are about to here and
now or the nearby in space-time so on
the Left we have some a basically a
simulation of a more or less typical
phone and not only is it a fairly small
screen but you're
whole user input is is sort of boiled
down to a dial pad and two soft keys and
something you know arrow keys which is
not a lot there's not even the letter
keys so you have to multi tap in a name
or address but you can see at least that
we have scaled up the we have you know
changed the UI so that almost the entire
screen is map and a small number of
overlays and since labels for the two
soft keys and then some information the
yellow tooltip gives you some
instructions about what to do since you
know how do you know which button to
push is has six will go on to the next
search result on the right we have
actually this is a windows mobile
touchscreen device it's a fairly large
screen for for current devices and if
you want a keyboard you have to tap the
button it pops up a keyboard to tap on
if you want to see you know driving
instructions we switch to another screen
where you can scroll through the
instructions so you can see the main
adaptation we do here is changing the
web Ajax application into a
client-server application where you
write the client application it does the
best job it can on the local device you
have and sends a request to the server
to get the information this oh I carry
an iphone it has a very large screen and
another thing we do that's really
important here is most phones these days
can actually the application can access
the cell tower ID information and by
sending that to the to our servers we
can find out approximately where you are
and that means that you don't have to
type an address just to get the map to
about the right page and then start
searching for starbucks or whatever you
want to find and on the right is
actually what it looks like in two point
O version of iphone if you have gps ok
so i'm going to talk about in general
here at the top level outline is first
of all just background on mobile
networks mobile networks are a lot
different than wired networks secondly
how do we
cope with that and the third I'm gonna
talk about some other things that have
something to do with scaling and mobile
maps so i took this data from 3g
america's which is an industry
association for 3g cellular technologies
and yellow line shows the latency that
it takes to get a pack through the
wireless network the blue line shows the
bandwidth you're getting through the
wireless network as a function of these
increasing gsm technologies i'm not sure
to what degree these are you know really
optimistic cases versus realistic
measurements but there's there's this
really typical pattern with technologies
that the latency gets better at about
the square root of the rate that the
bandwidth gets better Peter Denning has
a talk where he explains why believes
that this case but i'm just going to
cite him and move on interesting thing
to note here is I mean you look at these
these Layton sees this is just to get
one packet through and you know 350
milliseconds is actually quite a bit of
time the users perspective and that's
one direction one packet so if you're
actually making an HTTP request from a
web application you single request is
going to take you know least a couple of
round trips and and then both those
round trips go you know through the
wireless network and sometimes there's
more and so on and then if you're
talking about a typical web page then
you make some more round trips to get
images and stuff like that if you talk
about an AJAX application you're
continually making these round trips and
what we're measuring from a mobile
application is like four and a quarter
seconds of average latency is it's a lot
of variability in this number but from
the user point of view that's just
totally different than a wired network
and furthermore in the in the TCP scheme
there's this exponential back-off to
deal with congestion in wired networks
and it's just
totally the wrong thing to deal with
packet loss in a wireless network so you
lose a packet you wait and you wait
longer and is other interesting about
blackberries is that they're always on a
VPN to Waterloo where rims offices our
rims data centers are and that means not
only wherever you are in the world does
the packet have to go all the way to
Waterloo and then to local google data
center or whatever but the data is
always encrypted and it seems to get
delivered to the application pretty much
all at once so where's the other phones
can get the data piecemeal and start
displaying map tiles or whatever on that
on the blackberry you pretty much get
the screen all at once when it finally
comes in all right so how do we cope
with this stuff this is architecture of
what we've built is a client application
running in the phone and it sends its
packages requests through the wireless
network the carrier's network through
the internet and on our servers comes in
through load balancer and then to our
main server that Google Maps for Mobile
server which does some of the processing
but it passes other requests on to other
backends we have map search local search
that goes to one server and many other
servers behind it they diagram for all
these servers if I were to show you it
wouldn't even fit on this page map tiles
go to another server those requests
traffic goes into the server location so
on so there's there's two really
interesting things about this first of
all all the servers are stateless so the
question how do we handle more and more
you know load more more usage is well we
just were all out more servers and the
Google Data Center handles all the hard
part's for us does the load balancing we
got logging and monitoring all that
stuff we just have to push more servers
out the second thing is we avoid round
trips as much as possible we reduce them
in a single trip so the client sends one
request is said you know what I need
this in this in this map tile and I need
these these traffic tiles and all I
guess multiplexing to one network
goes the server get one answer and as
the tiles come in it puts them up on the
screen so we try and reduce the users
perceived latency they use actual
experience latency as much as possible
there are some phones it can you know
pipeline requests and some phones extend
parallel requests but not all of them so
we had this big question up friends what
size map tile should we build should we
use in this thing web Maps uses 128 128
tiles I'm sorry they're used to 56
biophysics pixel tiles and so we said
okay look if you you know do a search
and you jump to some new place and you
have let's we start with a fairly small
phone at the time I wanted to say what
it would be you know if you have a 130 x
180 screen and now you need to fetch
that all the tiles to fill that screen
and wherever the tile boundary is
there's going to be some amount pixels
around the edge so the larger the tile
size the better the compression ratio is
in the lower overhead there is per tile
but the more excess pixels you fetch and
the smaller tile the better the users
perceive actual kind of latency is
because you start getting images on
screen right away ok the end result
comes in at the same time but you start
being able to read the center of the map
right away if you have small tiles so it
turns out that in the measurements we
did in the assumptions we made which
which have evolved over time 22 x 22
pixel tile will be optimal and what we
did was you move up one decimal and said
look let's make a 64 x 64 tiles looking
forward to larger screens of time and
figuring people do some amount of
panning around who's kind of various to
hear but I do think that the notion of
using you know one decibel as a kind of
general purpose measure of a noticeable
improvement a useful level and what what
you know where to draw the line is
a good one and I wonder what PowerPoint
isn't doing my animations anyway we also
adapted the map tiles so the first thing
is you have a small screen you need to
have the road names more frequently
because otherwise they're going to be
you know off-screen furthermore the
pixels on mobile phones are smaller and
getting smaller all the time so we have
to be at least somewhat larger in fact
nowadays we have two sizes of text in
the tiles and then we reduce the number
of colors in order to compress this
thing better so there you know we took
out the border lines along the streets
we use fewer base colors can't quite see
too well on this projection but there's
fewer base colors and fewer
anti-aliasing colors and so on in order
to compress them and then if you ask for
a satellite image some people say well
why would you have satellite images a
mobile phone you know what you can do
with that and it's fun and that's one
reason and the second reason is it's
actually useful certain cases I mean
you're going to go to this place you say
well where I'm going to park and the map
doesn't show you anything like that but
the satellite image gives you a pretty
good idea so now the thing about
satellite images is this is really much
better use for jpeg than then ping type
decoding jpeg has the standard jpeg
format has like a 600 bite more than
scunner byte header and as a user when
you you know compressing a JPEG you pick
one slider you say i want 75%
compression and that generates the
entire 600 byte header all these
quantization tables and stuff like that
so we compact that back down to a tiny
header and just send that and out of it
like a 1700 bite satellite image tile
that makes a significant difference
alright so let me talk briefly about
some other dimensions so as you saw
scaling up and capacity actually isn't
our problem and some of these other
factors aren't a problem but now say
what is a problem so this is
but this is a snapshot of a piece of our
mobile testing lab okay you got to keep
a lot of phones they got to be charged
up so you can test them they got have
data plans and they have different
screen sizes yes they do a lot of these
things have tiny you know keyboards some
of them have bigger keyboards this lab
is growing maybe ten percent a quarter
the point where we actually don't keep
them all powered up anymore and you need
that first of all for testing but these
things are running different operating
systems so these are our hard problems
actually is first of all we have three
different client code bases for three
categories of operating system so
there's a Java code base that runs a
whole bunch of java phones java micro
addition on most of them with the
exception being android doja is some
variation on java micro addition and
then there's a c++ version that runs on
palm OS symbian windows mobile and so on
and objective-c version runs on iphone
that means we have three code bases to
maintain in parallel and put new
features in and so on and that's
something I wish we didn't have second
thing is there are lots of models and
make some variations of handsets and
carriers even take a standard handset
from one of the makers like Nokia and
they ask for specific changes they may
take out the root certificates they may
modify the way the Java permissions work
they may you know and just take out
features or whatever and so the way we
step back into second explain how it
works when you download an application
to a Java phone there's a file called a
jad file which is basically an
application descriptor as a properties
file and the phone fetches this thing
and it says okay this is the URL for the
main binary the jar file and you need
this version of mid p and this version
of the Java VM and you need this much
memory for able to use and
some other properties in there and we
have to throw in other properties to say
things like you know what the left
softkey has this key code on this phone
because there's no way to ask the phone
that which is silly but it was the
oversight someplace so we have a bunch
of those properties in there we have to
generate for each phone and the phone
says okay if I have those versions those
things I can I can handle an application
this big then it goes back to the server
and fetches the the jar file and
downloads app and at one point we had
quite a few different jar files for each
new release as well as hundreds and
hundreds of these jad files for each
phone model that we supported and now
what we do is we we've made some trade
off so the jar files are larger they
have more variations in it for phones
that might not be yours and the jad
files we generate on the fly instead of
storing hundreds of these things we just
compose it on the fly from various
pieces information I'd say that our
biggest challenge is country support
there's a lot of weirdness as a lot of
unique things about different countries
so to name a few examples there are
specific laws you know China we cannot
export precise lat lon of a location so
think about a mapping application we
can't talk and lat loans from the client
server and then a few countries like
China and India have have their own
rules as a here's where the borders must
look like when you're inside our country
so they disagree with rest the world
maybe we have to have a different you
know well anyway we're working on that
one and then addresses are different in
see Japan and Russia the addresses start
at the top level and work down instead
of the other way around so this has
implication on when the user types and
address when we send an address to the
phone when you format it when you put it
into the address book there's kind of
extra complexities phone numbers are
interesting even when we send a phone
number in the search results so that you
can push a button and dial this business
you know you just found some local
business you want to dial it there are
people that live you know on the borders
between countries and they want to be
able to you know call at restaurant on
the other side of the border and go
there for dinner so they definitely need
a international plus type phone number
and I would love to be able to just send
the standard plus type phone over to
every phone but actually that doesn't
necessarily work on sprint for instance
and we want to you know to work for the
local case Elise so then we have this
whole heuristic it says well I think a
better send local number for this phone
I'll send you know the other number for
another phone terrain is interesting if
you are in Italy and you ask for some
route along the coast dumped into the
Alps or whatever it is it's a really
really long route with lots of little
short steps in it and that is you know
doesn't really shut our current you I
where you look at one step at a time and
so that you know that kind of thing
needs extra attention and these phones
have limited capacity for how big of a
download they're willing accept and they
vary from model to model so when we you
know have localizations we can't put 20
plus localizations in a single download
so we have to do there is we now
basically have this as a minimal set of
strings in there and then once the app
fires up it contacts the server and says
okay give me English or give me Italian
whatever it is and then it gets the
strings for that language which is some
delay and when you can actually do much
of anything with the first time but it
means you could run the app in lots of
languages
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>