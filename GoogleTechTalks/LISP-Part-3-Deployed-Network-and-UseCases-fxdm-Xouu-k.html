<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>LISP Part 3 - Deployed Network and Use-Cases | Coder Coacher - Coaching Coders</title><meta content="LISP Part 3 - Deployed Network and Use-Cases - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>LISP Part 3 - Deployed Network and Use-Cases</b></h2><h5 class="post__date">2010-03-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fxdm-Xouu-k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so once again playing to a packed house
the man who needs no introduction
do you know apparently I do if you need
more people ok welcome to part 3 where
we're gonna talk about is the deployed
list network as well as probably half a
dozen use cases on how you can use it so
this will be pretty applicable to you
know IT people people that want to
deploy features that sort of thing so
we'll give you a summary of the part 1
and part 2 talk about the test
list test network will describe some
network debugging tools that we're using
and then we'll talk about a pro bono use
case to enterprise use cases a service
provider use case 3 datacenter use cases
and then conclude with lists mobile node
so summary of the first presentation we
gave part 1 we were talking about
routing table growth you know yeah
you're not expected to read all this
this is just here to say that these were
some of the high points slides from the
first part it's a yes ok ok so I'm reap
yuqing this is what you're saying
ok so we talked about routing table
growth and how this can help but we
talked about how polluting the internet
with more specific routes and p.i
prefixes is making the routing tables
get larger and how this can help with
that we talked about how you separate ID
from location and the d mark point is
where the Lisp encapsulator is in D
capital D capsule aiders are the level
of indirection that list provides you is
that you can keep the CID ID addresses
fixed while you are able to change the
locators and so you don't have to
renumber sites you don't have to
renumber systems or virtual machines and
you just changed locators and therefore
we have this mapping between an e ID and
a set of our looks which is part of the
mapping database that we talked about in
part 2 we gave an example of unicast
packet forwarding and multicast packet
forwarding talked about how to solve the
MTU issues associated with encapsulation
and then we talked about locator
liveness how do you when you decide you
want to use a little
cater to encapsulate to how do you know
if it's up and you should use it versus
another locator in the locator set and
then we talked about standardization of
lists and an open policy where Lisp is
completely open even though people from
engineer's from Cisco are working on
Lisp there's no Cisco IP are on it it's
completely open so when we showed the
unicast packet example in part one we
showed that the encapsulator had a cache
entry and knew where to encapsulate -
well if the packet comes to that
encapsulator and it doesn't have a map
cache entry how does it go get it and so
we described the mapping database system
and we described what the scaling
parameters and requirements were we
talked about some various algorithms we
said that we decided to use something
called alt which is in the middle of
this is in the middle of this cloud here
we talked about a mapping service
interface by using map resolvers and map
servers which are boxes you add into the
infrastructure don't have to change
existing boxes to realize the mapping
database then we moved on to how to
interwork non-lisp sites with list sites
and we talked about a NAT solution
briefly and we talked about these things
called proxy ITRs and proxy ETRS or
proxy encapsulator x' or proxy d capsule
eaters we put it all together in this
one diagram down here where how it all
fits together and how we can change the
mapping database if we need to without
changing the sites and we talked a bit
about security indicating the perfect as
the enemy of the good
and so we have to be careful that we
don't have too much security mechanism
and not realizing enough security but
just enough talked about Lisp and
traceroute how traceroute gives you the
entire path regardless of it's an eID
part of the segment or the locator part
of the segment and how we have a tool
called leg that queries the mapping
database just like Digg would do for the
domain name system
okay so let me go okay so let's talk
about the list we call it the list pilot
Network to list test network it's quite
real we're doing a lot of experiments on
it the point being is that we're trying
to build it out not get terribly large
but just enough so we show some kind of
internet structure on top of the
existing Internet we have about 60 boxes
deployed now in 10 different countries
you could see the platform's range from
is our nexus 7 kc 200 ASR 1k those are
the number of boxes per platform right
here we're running the two operating
systems at the moment later we'll add
iOS XR as we see fit what we try to do
is build we call these boxes in these
various regions after the registry names
so we actually have this box sitting in
Amsterdam and there's actually somebody
at riped is actually running it and
being part of our test and of course we
have a couple boxes in Virginia we have
some one in South America and Uruguay
and the apnic box is sitting in Sydney
and we're baby there's sub-sites sitting
off in it these are the names of the
sites that are connected there are a lot
of individuals some companies you'll see
Facebook MSN Savas is part of it I can
those sorts of sorts of people these MS
SPS are map service providers and
they're actually trying to model
multiple MSPs at this level of alts so
they can aggregate up but yet provide
options for somebody who wants to
purchase mapping services from different
mapping service providers this is a
blow-up of this region right here we'll
show you that in a little bit more
detail so what we do is the two Aaron
routers are dual homed the red addresses
are locators of course we it's all dual
stack we show that this region here is
msp1 which is basically most of the west
coast sites connect to it and this is
MSB to where the East Coast sites are
connected to it right now they're doing
ibgp over GRE tunnels to each other this
is all a tunnel topology because
as a control plane technology control
plane technology for sending map
requests that's the sole purpose of this
you want to send a map request from the
source site to the destination site you
want to talk to you
you want the ETRS or the d caps leaders
at that site to give you the locator set
so non-uk so then you can encapsulate
and send packets to them underneath so
this is the hierarchy that we have and
you could see that these stub sites will
register to these map servers these are
map servers map resolvers and they'll
register and we call it slash 24 slash
28 routing because they're getting
prefixes out of the Eid space and these
guys are storing them and when they go
up bound in the hierarchy they have they
allocate 2/20 ones and then these guys
allocate to slash 19's so if I get
something that's if I get a slash 24
from Arin because I'm in the US region
and I want to use MSP one because they
have better service I could use them if
I'm no longer satisfied with their
service
I can go to MSP two but still the same
aggregation northbound is the same it
still aggregates up this this is
supposed to have a connection to the alt
directly I don't know why that's not
there I think it's just a typo or
something so the idea here is that I can
switch service providers as a sub-site
and be able to go to either one if I
want different service so this could be
a Verisign
this can be an Equinix it could be a
Google or MSN if they want to provide
mapping services it could be an is see
or add in DNS those sort of companies
could provide these services if they're
going to be third-party service provider
could also provide these services and
package it with their link cells that
they sent to you you know you could say
if you buy bandwidth from me you can
also get mapping services for free or or
whatever that's the idea this region
here are the actual proxy boxes that
will actually provide non-lisp sites
connectivity into the Lisp world and you
can see we have one at ISC University
Oregon Andrew Parton has one up and
Equinix has one up as well in Ashburn
yes yeah the question was Andrew this
ASP pitter box it's a proxy ITR yes so
he's actually taking packets and from
mountainous sites going to list sites
and the list sites that want to return
packets we'll just send them natively if
their service providers don't you RPF
fail because the source address is
coming from the list sites will be e IDs
and you have to make sure that they're
they don't you RPF so the PX TRS mean
that they support both functions yes
sure
so the question was is there any FreeBSD
or Linux implementations running in this
network it turns out there is we have a
freebsd implementation of lists called
open list that's being done by Luigi in
Germany and Belgium and there and so
this is supposed to be used to to
support multiple implementations as well
so as more implement implementations
come up we I didn't add a slide about
implementations but there are five
distinct implementations of lists right
now and at the last ITF we did a little
interoperability thing so there's
there's the open list of implementation
by Luigi there's a Linux implementation
by two IETF errs there's iOS there's
nx-os and there's a click implementation
that runs on Mac OS that I get all those
right Darrell ok so the goals of the
network is obviously to do experiments
to learn about if the protocols will
actually work in practice rather than on
paper we are changing the standard or
the the internet drafts as we learn
things on the network and we're trying
to not to get into the same problem we
had over the last 20 years with BGP
where BGP the spec and BGP the
implementation are completely different
we're trying to keep things in sync so
somebody who wants to implement Lisp can
actually look at the spec and it could
actually interoperate with previous
implementations we really want the
multi-vendor part of this
to work quite well so as we learn things
from experiments we want to adjust the
protocol in the architecture if
necessary we're trying to be careful
about feature creep because a lot of
people want to jump in and say can you
add this can you add that so we're a
little bit careful with that we do want
to test multiple implementations as I
brought up and we're starting to do that
on that test network as well we want to
prove that this all topology Maps yeah I
do the ID allocation delegation maps to
the topology rather than the other way
around and using the slash 24th slash 28
at green the slash 29 to slash 19 is
supposed to emulate that sort of
behavior and we're hoping that that will
be able to be enforced when a real
mapping system gets put in place and
that we can control the backdoors and
you know the the triangle sort of thing
the horizontal links need to be at the
same level of aggregation and as you
send advertisements up you aggregate and
we're hoping we can do that and since
the since they're these boxes are easy
to ploy because they're separate boxes
that run on PCs perhaps and I have GRE
tunnels it's easy to rehome these things
you don't have to provision links and
you know do all this layer one stuff
it's all over the top type stuff and of
course we want to emulate - MSP business
models because that's kind of new we'd
like to model it off of DNS type
services it's just working at the
network layer rather than kind of the
application layer so we believe that
people will have a dependency or a
contract with their iid prefixes don't
buy their eid-prefixes from the registry
but they'll have a contract with a
mapping service provider to get them
advertised this is completely decoupled
from the underlying connectivity that
you have so you don't have to depend on
the person or the organisation that's
giving you links link connectivity for
the addresses therefore you can change
service mapping service providers or
change underlying service providers
without having to change the other one
and that that's the decoupling that in
the level of indirection that you get
with less protocol learning tool for
users we can when people want to see the
stuff live we can log in and say look
here's the traceroute this
how things work it's a great learning
tool to show it in action and show how
real it is so that's a that's a big
advantage too and it's a testbed for
building management tools to see if we
need more more tools to test less this
is a webpage which basically does a lid
to all the devices that are on the
network that basically tells you you
know what site they're at what box is
being pulled what their registration is
what eid-prefixes they're registering
that sort of thing and then we have
somebody that has built a list Mon thing
that basically tells you where all the
list boxes are and you can click in and
find out what their status is and just
to do some you know network management
sort of things customers well I
shouldn't say customers because I don't
think they're buying Lisp yet but these
are people that are interested these are
people that we've talked to the list
group these are either people that have
received a list presentation or are on
the network or a proactively helping us
design it and you can see they're from
kind of all walks of many different
sectors and you know a lot I mean we
went to the financials like a few times
they're very interested just because
they don't I P address management and
moving virtual machines around is a big
problem they want to solve
of course the cloud providers I mean I
should have put Google in there as well
but they're interested because they want
to move topologies quite a bit and the
handset vendors as well Google maybe
should be in there as well so so when
people hear of Lisp what do they
actually say what are the sort of
comments when they when they hear the
presentation and they see the level of
indirection what are the sort of
comments they say and you know they say
things like oh I want to I would like to
make my enterprise core network simple
or and I can do that by removing rouse
having less churn less flux in my core
is a good thing so removing routes in my
enterprise core my datacenter core or my
internet core even is a good thing I
cannot allow my client machines to roam
and I can track them since E I DS never
changed so that's kind of good we're now
a device is associated with an IP
address which is called an e ID
and that eid never changes so it's
always associated with one system
process virtual machine no matter where
it's currently located i can use either
global or private addressing and not
have to change them I own my address as
I have controlled so yeah you could
actually build VPNs and duplicate your
addressing because as you as it goes
over the Lisp
it's just encapsulation and consenting
sites can run whatever they want they
can run IP version 10 if they want to
right I would like to multi home and use
private addresses but it's so hard to do
with Nats I can do that now with lists
multihoming is very difficult with that
multihoming without Nats is difficult
because you have to run BGP at the sites
so we're gonna make a simpler way of
doing multihoming I think I can use
lists of on my PE routers and use BGP
next hops as locators now my core can
stay clean of external routes and I
don't have to use MPLS ok right now you
can get all your external BGP routes out
of the core because from PD PE use MPLS
labels but now what you can do is you
don't have to use MPLS and you can get
your external routes out of out of the
core and still have p2p and you could
actually go from PE to a PE and another
service provider because the tunnel
encapsulation could go across service
provider boundaries where that's never
done with MPLS if I come out if I list
priority and weights I can use list for
load balancing traffic to servers well
that's just dynamically changing the
priority and weights and we believe that
those two policy attributes the priority
value and the weight can be used and
dynamically changed based on using the
traditional things you do in load
balancers to find out what's loaded and
what's not I can get ipv6 at my remote
offices without creating my core we
talked about that last week you can run
anything on the edges and you can use
any kind of address as an e ID and what
you encapsulate over is what is
supported in the core so you can run IP
v10 or ipv6 over ipv4 and it works
because we're mapping one type of
address of any format could be a MAC
address it could be a name to something
that's runs in the core
I care about leaving a robust and
scalable internet when I retire I want
the internet to be green okay that was
Dave Meyer okay he wanted to leave he
wanted to leave a clean Internet to his
grandchild his grandchild now be
grandchildren soon but he basically
wants to have the core clean and
scalable so we can keep the internet
cheap or there'll be something else that
will be the internet that we have to
might we might worry about so that kind
of is a segue into the pro bono use case
is we would like people to pull their
prefixes from the core
it's either the Internet core the
enterprise core doesn't matter if
there's less resources being used in the
core we have a greener core we use less
resources less memory maybe you can get
devices that are cheaper maybe router
vendors could deliver things faster
because they're just not memory upgrades
but they're feature upgrades and of
course you lose let use less power and
the core will be cheaper to operate
these are all good things
it'll be greener to deploy a PA based
ipv6 most prefix allocations for ipv6
are going to BPI if we continue this
we're gonna have flat routing in the
core will that actually scale so we can
keep ipv6 eid-prefixes out of the core
and guess what if we don't have any ipv6
routers moving packets we're gonna have
to keep those prefixes out of the core
okay so let's look at the first low op
ex multihoming use case enterprise use
case so the use case is basically
multihoming that we've been talking
about multihoming is on increased people
want more bandwidth I the Internet is
just as important as water it can't go
down you need multiple links for
redundancy so people are gonna they may
have multiple links to the same service
provider but there's a good chance that
they'll have multiple links to different
service providers and they want to do it
active active they want to use both
links so when one link goes down they
use 100% of the other link then and they
want to use it quick they want to switch
over quick so we want low affects switch
over and we don't want to have this
conditional advertisement stuff that we
typically run in BGP on s1 and s2 so we
want it to be low op X we want to use
more efficient bandwidth use for the
site
the bandwidth is used for because you
pay for it the site should be able to
decide how it uses the link of it 70/30
depending on the bandwidth the the
speeds of the link should be 50/50 and
there'll be new link revenue for a nice
piece so a nice piece should like this
because this is more multihoming and
easier to multi-home they can attract
more customers sooner and so they'll
they'll be able to track more link
benefit at the benefit of keeping those
sites routes out of their core so they
can sell new bandwidth and they don't
have to pay for it in terms of routing
table entries in their Court and we
decouple the addressing from the ISP so
the site is the flexibility to change
providers this is really powerful now a
lot of people say hello service
providers aren't gonna like that well if
you want his customer and he's your
competitor it is a good thing yes you
better keep good service because you
don't want to lose your customers but
the class can be half full it raises the
bars fries peas they have better
consumer sites ok question on this
you probably heard this in the previous
parts the next use case is dynamic and
roaming VPNs ok so we have this
situation where you have these five
physical locations firstly in a company
that has 5 offices and let's say
engineering is in San Francisco in New
York and marketing is in Boston in Los
Angeles and you see that they're all
multi-home to the enterprise core you
see all the red addresses which mean
their locators and you see the green
addresses I hope I hope that's showing
up but the green addresses are the e IDs
and you'll see that that the engineering
is using global PI addresses because it
wants global connectivity so they're
using prefixes out of 1.1 16 and 1 dot 2
dot 16 and you see that a mapping entry
for this site would say this 1.2 slash
16 has these two locators 64 1 1 1 and
65 or 65.4 dai 1 1 &amp;amp; 65 that 4.2 to 2.2
and you know that the core is using
global PA addresses right so we're able
to keep those green addresses out of the
core that's good and let's say marketing
wants to use private
dresses well they're addressing won't
clash with anybody else is addressing
because it's all encapsulated in the
course just routing to read addresses so
you can actually use 192 addresses or
any any type of private addressing to
talk to each other and that works of
course the addressing has to be unique
inside of the ID prefix or you can't
make TCP connection to you if you try to
make a TCP connection to somebody else
that has the same address as you do
you're gonna make it to yourself right
can't get the packet out of the host but
what we can also do is we can take this
engineering site here in New York and we
can have it move to Dallas and of course
the prefix in all the routes and all the
devices just move here and then all that
happens is the locators change so this
is a way of a site actually moving and
then just not one machine but it's an
entire topology that can move and by
doing that if you can move a site you
could dynamically create a create a site
as well because the site just comes on
with a new Eid prefix with new locators
it registers itself to the mapping
database and that's how people find it
and you know when you have these server
systems that are sitting here you go
ahead and put in DNS you put the name to
address mapping out of the Eid space
they never have to change if you move or
or stay still or create something new it
the addresses always stay the same the
mapping the DNS the address mapping
always stays the same let's go to the
service provider use case let's say a
service provider wants to support
multiple address families well the
internet core is not dual-stack we tried
for the last 13 years it's not gonna
happen
so we have to figure out a way to deal
with it now I hope we don't have to do
translation because that's going to be
very painful
I hope ipv4 hosts don't have to talk to
I P v6 only hosts but let's just look at
a few combinations well like I said if
you have an ipv6 only host he only site
here an ipv6 only in the running Lisp on
both sides it's really easy this is an
ipv4 path that encapsulates from this
point to this point the inner header has
the night is an ipv6 header the outer
header is an ipv4 header ok if that ipv6
only site wants to talk to a dual stack
it's just running list this is Lisp and
that's not unless it doesn't matter what
protocol family it does but obviously
it's gonna encapsulate two addi caps
later which is a proxy box and that path
right there is ipv4 it will then forward
natively to this path which is on ipv6
okay oops go back okay
this case is a list site that's that's
dual-stack that's also talking to this
dual stack not as you can see here what
we're showing you is that all these
possible combinations can work because
we always encapsulate in what's
homogenious from this path to this path
and what's homogenious to this path to
that path this is an example this bottom
two clouds are an example what I did
with ipv6 google.com is that I'm a lisp
site with ipv6 ie I DS connecting to
Google which is an ipv6 site with
routable ipv6 addresses and what I would
do is encapsulate my packets to a proxy
ETR and the reason I do that is because
when my ITR here said I wanted to talk
to this 2001 address it wasn't in the
mapping database so that tells me it's a
negative cache entry that if I either
try to forward it natively or I
encapsulate to a proxy D capsulate ur
the reason I don't want to forward
native leaves because I don't have ipv6
path between these two points so what I
do is I encapsulated to a proxy box
which D capsulated and has negative it
has ipv6 connectivity to Google and then
that that goes directly so this is a
tunnel path and this is a native path
this is all the ipv4 all the purple here
is a tunnel path in the yellow is a
native path what if it's the other way
around this could be a possible cable
company that has an ipv6 core and can't
upgrade the residential sites because
they're running set-top boxes with ipv4
and the truck rolls are just too
expensive for them to convert all the
residential sites to to ipv6 so what do
they do well it
this is me today an ipv4 only site
residential running private addresses if
I'm running Lisp I can encapsulate the
ipv4 packet in ipv6 because that's the
only thing that the core network
supports and then it gets D capsulated
by an ipv4 only site that has a server
using a global address ok likewise if
I'm a list site that wants to talk to
anonymous site of course this address
here is a globally routable address so I
ain't capsulate from my ipv4 packet over
ipv6 to the proxy ETR and d-cap sleights
it and fords it natively on this path
which is probably going to be a few hops
through the head end to the to the data
center or whatever questions on service
provider use cases or enterprise use
cases
let's go to the data center go ahead oh
okay yes so the question was is a lot of
the examples we showed are showing
multihoming with a couple dual home
basically but what if you let's say we
have hundreds of connections that go
outside how would you use Lisp to give
you the level of indirection because
you're gonna have a hundred locators
basically so what we're so the real
limit here is most of the protocols
designed to deal with thirty-two
locators pari ID prefix because we have
a bit field in the data header that's
advertising locator status bits but what
it means is is that you get 32 locators
for a given Eid prefix of any length you
decide and if you have a hundred type
connection points you're probably going
to regionalize the Eid prefix and you
get 32 times each one of those or 32 for
each one of those huh yeah it's a pretty
hard limit you don't have to use the
locator status bits you can use probing
between the ITR and ETR to find reach
ability so you don't even have you could
turn that l bit the locator status bit
off in the data packets and not have to
use them at all and therefore the
map-reply then just gets larger larger
we can fragment and reassemble it
because it's a control protocol so you
could actually run with more but if you
want all the features that have all been
dug right it won't let it I mean a map
request to sent a map reply comes back
if you can receive a 9k MTU sized map
reply then life is good if not it gets
broken up into multiple so it's 1 times
n RTT or whatever you know that's all
let's talk about data center the one the
first use case is going to be a virtual
machine mobility this is an example
where these two boxes are first hop
routers a and a prime their layer three
boxes they're running Lisp and they're
directly connected to these four servers
s1 through s4 okay let's just say I know
I'm wasting address space big time here
but let's just say these are on
point-to-point links and that these are
the addresses of each of the servers
well it turns out that all these ports
that are off of this l3 box can register
an aggregate say 2/2 16 to the mapping
database saying that the locator is a
which means me anything that's going to
go to any of these servers please
encapsulate the packets to me these two
boxes are just a legacy IP router so
they could be you know cat6 k's juniper
boxes doesn't matter okay same thing
over here this red this guy registers
the 2.2 / 16 with a prime so what we're
going to show now is what if s1 moves or
a virtual machine on s1 that comes out
of that address 1 101 moves to s3 what
happens
well a prime can tell when this guy
sources packets that it's not coming
from this subnet and when it's not
coming from that subnet that triggers a
mobility event saying somebody just
moved onto my subnet and so what I'm
gonna do now is I'm gonna register the
host route saying that the locators me a
prime no longer this guy this is right
here is a route that goes this is a
mapping that goes into the mapping
system not the underlying network it
doesn't even get advertised throughout
the alt either so it's actually going
back to the same map server that's
covering one 1/32 I will show you that
in more detail when we talk about lists
mobile node which has a much harder
scaling problem to solve than virtual
machines so that's the fundamental idea
now what happens is is that's one
sending packets out now in this new path
it has to update the cashiers the new
guys that want to talk to it will go to
the mapping database and get a prime as
the locator versus a is the locator but
existing cashiers have this a so you
update them and say you solicited we
call them SM our solicit map requests to
the cashiers so they can update their
ashes now encapsulated to a prime that's
basically how we will get via mobility
to occur notice across subnets you don't
need a layer to domain anymore to be
able to get V motion to work or hyper-v
or whatever questions yeah good yeah
okay so there's good question the
question is is there's an update here
and do you have to flood it to all the
people that might care about it and the
answer is no there's no flooding it's
not we don't classify it as a mapping
update because the slash 16 is a
completely different mapping entry in
the database than the slash 32 so look
at it as we're adding this new entry to
the table and it turns out to be a
longer prefix so when people want to
send to one 1/32 they use a prime
anybody else didn't 1.1 they use a as
encapsulation now the only the only site
the the only place that has to carry
this slash 32 is the map server for one
1/16 that's the only one s2 stored and
the current ITRs that are encapsulating
to you those things are done dynamically
and they're done dynamically by saying
if I'm going to send packets back to the
guy it's only active flows that are
going to be updated and the guys that
have gone silent even though there's
something as a math cache entry pointing
to a if they're silent and not sending
data we won't update them so everything
in list is pretty much on the middle
minutes and we try to do it fast when we
think we need it
the reason the cashiers know that the
1/1 1/32 is no longer is associated with
a is that when data packets start
flowing egress from a prime it knows who
he's talking to so he knows who the
locators are for those destinations and
what he does is he tells them that send
a map request to me and then there's an
RTT time where he gets updated this yeah
that's what I'm talking about as live
folks the live flow is talking to
somebody on the other side that's Lisp
aware either it's the l3 box that's
talking that's there's an ITR on the
other side or a proxy ITR that thing has
to get updated to know to send packets
back it comes to a prime and we do that
with this thing called an S mark so let
me give you an example so one one one
1/32 is sitting there on s3 it sends a
packet to some things called 10.1.1.1
this guy may already have a cache entry
for it but if doesn't he sends a map
request okay that map request will go to
the site that has ten now I don't forget
that site that has ten does have a map
cache entry for us but has the wrong
locator that's what we're trying to fix
right so what happens is that map
request gets sent over to the ten site
and what's in the map request is
actually this guy's new mapping so here
it's piggybacked in the map request the
guy can that guy at ten can actually
just cache it if he wants to do it on an
honor system or he actually can verify
by sending a map request back with the
same nonce and then the map reply
happens so what I do is I send a map
request you but I'm I set this bit that
says I'm soliciting a map request from
you I want you to ask me what my mapping
is and you're gonna send it with a non
so 64-bit nonce then I'm gonna send a
map reply back and then I'm gonna give
you this new information it takes three
halves Artie T to do that but you don't
have to do it it could take a half hour
TT if I just say here's a SM hour but it
is a map request packet and the source
this information is in it you can
believe it if you want and we see in a
data center that that's
probably going to be trusted because
it's managed by all one you know
administrative control good right if
there's no so you're saying if if most
of the traffic is unidirectional coming
from the remote site here you know he's
gonna be sending to the old place what
can he do well one thing that a can do
is he could first tell the mapping
system that he's no longer the locator
and he could find out by doing a
database mapping lookup that a prime is
the new locator he could just go he
could query the mapping database to find
out where he moved to he's not gonna be
I'll do anything until he lands when he
lands it gets registered only after at
that point he can find out and when he
finds out he can either proxy nap reply
or he can actually tunnel the packets we
don't propose him the tunnel the packets
horizontally because we don't want the
hairpin okay so there's all kinds of
options those are all various options we
can do but you know when you're running
something like vmware they give us so
much warning that they're gonna move
we're gonna be all ready to go and the
guys are running tcp and they're doing
heartbeats before they do any before
they say okay now let's do real data the
network state will be all created by
that point in time you should ask that
question again when we bring up mobile
node because that's where it's harder
much harder yes good seven
Oh
so I I think the question is if somebody
has one 1/16 cashed and now they want to
send packets to the one-one 1/32 what
will cause them to send a map-request
because they'll just Matt they'll have a
map cache hit and won't oh yeah yes that
map request will go to the mapping
system that will return what that will
this guy just returned / 30 - he doesn't
have to return the one 1/16 yeah yes yes
correct the right so so I think I
understand the question now you're
saying should the old guy a return back
the mapping 1 1/16 and all the more
specifics because the guy who's doing
the request may want to talk to the
moved machine and we want them to use
locator a prime and not a that's the
question right yeah so in the
multihoming case we call this nested
prefixes the multihoming case you have
to return all the more specifics in this
case you may not have to because this
guy's always going to talk to if
somebody's going to initiate a sin pack
of a completely new place and he doesn't
have it cash he's he's okay if if if
somebody already has 1 1 1/16 cast
because he's talking to ask - now on the
sudden he wants to start talking to s1
the ITR says oh I know where s1 is it
matches the slash 16 he's at a but
really s1 has moved right that's the
case so that
that's exactly like what I thought you
set up first and you said no but it is
the same case okay it is the same case
so what you have to do is this a has to
know that I mean in this case we want a
to return one 1/16 and this guy to
return just last 32 if this guy if
there's anybody new that's talking yes
he will go to the old place and it'll
actually degrade to the same cases what
this gentleman said what the problem is
he has to know he has to know that and
you'll either do a lookup to tell that
guy to go to a prime or he'll Rhian
capsulate the packets and go that way
it's the exact same case so yeah I mean
what's hard about this handoff problem
is not only do you have to know where
the new place the new locator is you
also have to know that the guys no
longer at the old place and you have to
make sure that the state is kind of
insane in the same phase or out of phase
right and the problem with most mobility
problems is especially with mobile
phones is that the VM that's moving may
not be at the old place or the new place
yet even though the network's trying to
set it up saying where it's going to go
and everybody says what do you do when
it's off the air well you can't
communicate when it's off the air
there's nothing you can do here right so
you either drop packets if you start
encapsulating here before he arrives
you're dropping packets here if he gets
here and you start sending packets in
the old place you're dropping packets
there so what's the clean switchover
what we're trying to do here in these
boxes does not depend on any signaling
from the house we're trying to solve it
all in the network so it's transparent
to the host but if the host can give us
a signal that I'm leaving now don't tell
anybody about anything until I land and
then when you land you do it then life
works pretty good and there's I mean
like right now VMware is an example
we'll send a reverse arc in announced
when he's here and that's when this
mapping registration and updating the
caches can work vmware could actually
tell us the flows that it's talking to
and we can say oh i'll do a database
mapping lookup for all the current flows
that it's talking to and then if i see
some that are in the same slash 24 i
said
one request get the prefix back and the
map-reply scan all the flows and say oh
these three map to the same prefix so
you could actually do some clever
scaling things where you don't have to
send and map request for n flows because
they may aggregate to the same region of
the network which is typically the case
moving from one data center to the other
because of the the prefixes are much
more controlled than on the capital I
Internet yes yes same ole same will
happen here and this is the example you
have a machine at your house that's
talking to this IP address and there's
somebody either at your house there's an
ITR there's a proxy ITR that is
encapsulating to its current locator
when that VM moves you are still sending
packets to the same IP address because
it's the Eid and the ITR will find out
its new lake locator and now encapsulate
it there that's an example over the
capital I internet the mapping service
is there because when new people want to
talk to the VM where ITRs don't have a
cache they have to look up and find the
locator just like they would have found
it when it was sitting in its home area
if you've been talking to the VM it's a
change of a locator in this case and you
are your cache will be updated by this
guy because this guy has a TCP
connection with you at your house and we
know packets are going to be sent back
to Stephens house and what that means is
his ITR needs to be updated to find out
the new locator and that's what we do
with this SM our exchange send map
request the moves
yes
but you'll see how we can make it scale
that's that's the sugar at the end of
the presentation
oh go back okay so you okay you guys are
really interested in this slide that's
very telling
yeah the a could ping the IP address and
find out if it's there
it could probe there's all kinds of
implementation techniques it can look at
data of activity and decide that it's
been quiet and therefore maybe it moved
if it's quiet it could actually check
the database and say let me look up one
one one one if it looks up one one one
because it didn't get registered in a
new place okay let me finish there's a
lot more there's more to it now the
other thing is the host could actually
send packets and say I'm moving and and
you know hyper-v and VMware and Zen and
the Red Hat one KVM they all have their
ways of signaling to the network that we
could use and those are all
implementation techniques that we can
enhance the convergence of the move okay
so we don't but we don't want to have to
depend on a day one because we just see
if we could do without signaling from
the hosts okay so so we we know a will
know when it moves okay and if it's
getting packets it has to make a
decision to say the some policy decision
that's just like mobile IP right it's
the triangle routing problem we could do
that as well we don't want to because we
want to be better than mobile IP we want
point-to-point tunnels because I want
this stretch between you and me to be
one I want the stretch between the the
client at Steven's house to the VM to be
stretch equals one its encapsulating
from his ITR and BD encapsulated by
a prime which is an EGR yes ipv6 mobile
IT does that okay eventually yeah yeah
but you need ipv6 forwarding in the core
that's the minor detail let's go to the
next use case the datacenter use case so
we need 40 gig and 100 gig yesterday
everybody's been telling vendors that
yeah I'm asking the same question and so
most with the way people are dealing
with upstream bandwidth today is they
get 160 gig by 10 times 16 where 16 is
usually what the ASIC support on the
number of ecmp paths well if you add a
little diameter to the network and you
put Lisp in here you can get 256 path
wide so what we're showing here is that
this is an encapsulator a list by TR
these packets come in these packets
these these packets will match to one of
sixteen different locators that you
encapsulate to those will be looked up
into the FIB each one of those locators
will match a fib route that maps to 16
different next hops and if you do that
with hashing you get 256 wide going to
the same 16 different ETRS that decap
slate and then deliver to the
destination okay so 256 why because we
got 16 times 16 because of the level of
indirection questions you know what I
put in more routers that's what Scott's
thinking huh yeah yeah right oh ok ok
you want that random number in there yes
yes so here's the final use case for a
datacenter is load balancing the load
balancers so what people are having
problems that they're having today is
that packets are being addressed to VIPs
and these servers are being used up but
the VIPs aren't getting enough spread
because of the way packets are coming in
so what you can do is you can treat the
virtual IP addresses which are the IP
addresses of the load balancers as a IDs
and when packets come in
- these ITRs they can decide which ETR
they D kept that D capsulate sit and
then we can spread the load across these
load balancers
so each locator maps to a set of load
balancers that have the same VIP and
then they could load balance here so
it's hierarchical load balancing that
can be used the final use case what if
two mobile handsets could roam and keep
a TCP connection established what if two
mobile handsets Lisp encapsulated to
each other and had a path stretch of one
that they didn't have to go through a
home agent the home agent is a data
plane calf where packets that return to
the mobile node have to go through the
home site because it's address is
topologically from that home site well
now that we have a locator ID separation
the ID can roam anywhere and the
location is done part of the separation
and doesn't have to be topologically
restricted so we always have stretch of
one for all Lisp encapsulation what if
we can put up server functionality on a
mobile handset well you can certainly do
that now because WWDC comm always maps
to the ones the same Eid when it moves
you don't have to change that entry you
don't need dynamic DNS static is
sometimes good especially if it never
changes what if your handset could use
all radios at the same time is this a
good thing is this a bad thing so we're
gonna say this thing or an Android is a
single Lisp site it's going to have any
ID prefix could be ipv4 ipv6 but this is
a prefix that's burned into the sim
perhaps and it's going to be configured
with a map server that you know is
aggregating this is a map server that
you're buying service from that's
topologically aggregating this Eid
prefix into the alt here are the two
locators one for each of the radios and
this guy now could say if he wants
active active on these two interfaces or
active backup it's just like a
multihomed Lisp site
so how do we do this well we can run a
very lightweight variant of Lisp on the
mobile node it just does basic
encapsulation really simple much simpler
than what an ITR does okay and that's
documented in the internet draft there
the IDS burned into a SIM card it can be
either ipv4 ipv6 address that never
changes that will be your network name
this is cell phone number portability
brought to IP we're doing IP number
portability now okay they'll be yours
forever
that's your network name you're not when
you land on if you go out of signal and
you come back in to a Wi-Fi WiMAX 3G 4G
whatever you will get a dhcp address
that is your locator because you're
tapping into the topology of the network
so you have your binding there's the e
ID there's a locator and if you're
getting a DHCP leases from both all your
interfaces that your locator set that
you register with the e ID now the
mobile node carries along the map server
because it always wants to register to
the place in the all topology that's
going to aggregate for you because we
don't want host routes to be in the alt
it's not on the underlying network but
we also don't want it on the alt ok so
when you get a new DHCP address you
register your our looks with the map
server and you update the cashiers just
like we talked about in the mobile in
the virtual machine case ok can this
scale well we leave our looks alone they
map to the underlying physical topology
that's why the DHCP lease has told us
where we are and that routing is already
routing to that subnet or whatever so
there's absolutely no more specific
routes in the core for the list mobile
nodes or any other list site for that
matter the more specific state is only
in the map server the map server has to
track 2/32 because the site that's
advertising that eid-prefixes is
pointing to locators at the home site
not where the lists mobile node is moved
ok so the map server is kind of like a
home agent but it's a home agent in the
control plane not the data plane that's
what makes it different than mobile IP
the map server already has a covering
route so no more
specifics are injected into the alt very
important we will keep that all pristine
as long as we can okay the only other
place where the more specific state has
to be put is in the people that are
current currently talking you the
cashiers and that was the point that you
guys are homing on so how can a bad can
that be let's have a look back in the
envelope calculation what if we a map
cache entry say in our implementation a
map cache entry cost you a thousand
bytes of memory okay violet means it's
memory cost red means it's our low cost
in green means trekky ids and map cache
entries that's the scaling parameters we
have for this calculation what if we
said we wanted to support 1 million
entries in an ITR that would cost you 1
gigabyte okay that's not terribly a
large amount of memory so let's look at
a Google ITR a lot of cell phones are
coming up the Roman all over the place
and they're doing searches so the ITRs
at Google will have to support a
gigabyte in their ITR and that means
that single ITR could talk to only a
million cell phones
let's keep scaling up let's deploy
deploy a hundred Google ITRs now we're
up to 100 million mobile nodes that's
not too bad let's throw more memory at
it just by a factor of 10 and now we're
up to a billion mobile phones a billion
mobile phones you know a hundred Google
devices it's gonna turn out to be that
way anyways a hundred ITRs is not
unreasonable since good user experience
forces shortest exit so we know that
those ITRs are going to be regionalised
anyways so an ITR doesn't have to
support a hundred million or 1 billion
it only has to support one or ten
billion and then we just cluster or we
array it out this way to get to a total
of 100 1 billion cell phones oh by the
way a thousand bytes per entry is fairly
fat we can optimize that maybe not by an
order of magnitude but maybe by 2 or 3 X
so we just added some more factor to it
that can help this is probably
achievable since
our state has only kept where it is
needed comments from you guys what's
your reaction so the question was is
this is this dependent on the default
TTL the map cache enter you have 24
hours
no it's shorter yeah but the churn in
map requesting as a minimum TTL for the
entry is that what you're asking so we
think it should be okay it depends on a
lot of things and there's trade-offs all
over it depends on how fast you want to
roam and if we could we think we could
do it at minute granularity but it turns
out when a mobile phone moves it could
maybe clear its cache and when it clears
its cache you could send map requests
and then tell places where it's
currently talking to at the application
layer what the new stuff is just like
the SMR example that I used you okay
before we go to that when you go home
and you haven't connected that in yet
people can still get to your web server
at your mobile phone at home first and
foremost okay okay right
so you so what you would do in that case
is that the Eid would move to the
physical server at home.the yeah well
yeah because yeah well I'm the EA ID is
associate okay so you want the Eid to be
mobile what we're saying is
right so you want the w w scott comm to
actually go to a different physical
server but you didn't say if the dress
should be the same or not is the eid the
same or not are you you're asking let's
write mapping at the dns name yeah yeah
yeah right so that's kind of outside a
scope of what we're doing because we're
doing it the key into the database is
the eid and anything that happens above
it happens independently from it go
ahead
Darryl so that's a quick fix right right
let me repeat that so that people on the
video can hear is so Darryl said the
best way to do that it's make your TTL
lower for the DNS name and higher for
the map cache so you keep reira questing
for a new dns name and if you get the
same e idea or a different one either
one could roam independently of that but
this is just connecting to a different
physical server at that granularity sure
right
yeah yeah yeah good point
well yeah I mean that's exactly the via
Mobility case but the only difference
here is the list functionality is on the
mobile node and you're moving the server
functionality into a host that's not
running less but the xtr that's running
at your site is the new locator so what
could happen is just by changing the
locator when the new locator decap
sleights and finds out where this new
Eid is it can now send it to a
completely different machine because of
layer 2 it certainly could just like the
a and a prime example where we said it
could rien capsulate to the new place
yeah I mean but it wouldn't work that
way would work the opposite way cuz
everybody's still sending to the mobile
node it would have to tell you to now
start sending packets to the mobile node
to the stationary node right that yours
yes right right ok so I think that's I
mean we should go think about what's a
scalable way of doing that but the note
to take Darryl here is that they want a
IDs to actually move on different
physical devices because it's more of a
a service address than a physical
address ah
ok yes it's just saying it's a
non-problem but but it's that it's a
it's a it's the mobility yet at another
level right
yeah yeah yeah do it
you're Darryl saying do it at the DNS
level because that's where the level of
indirection now is at yeah well I could
argue that maybe another I could argue
that you can use any caste addressing
and make both systems the same ipv4 32
bits and you can use an instance ID
which is prepended to tell you is it an
instance ID that's a high order part of
that address is actually the mobile
phone versus a stationary phone and that
could be used as a lookup into the
database mapping to find out really
where the place to go but that's just
another level of indirection that
happens inside of the Eid space so I
mean there's some interesting things we
could think about there do you think
this is going to be popular Scott this
feature of moving server functionality
from one device the other and you want
it on you want the notification to be on
your home devices now right or more
things not ringing yes right right right
okay cool very cool so this is following
the last slide just want to let you know
that we've run this idea over the last
three years through people that have
gone through these sort of evolutionary
technology attempts we did talk to Vint
we we had a Dave Meyer put together and
workshop I think it's been about two
years ago and Vint came and we gave a
presentation
he liked lists more for the mobility
reason than anything else
Dave Clark liked list because he said oh
now I can build IP version 20 between
these consenting adult sites and we can
encapsulate an ipv4 locators and we can
build this new we can build new internet
because we could do whatever we want and
I think I've talked about this a little
bit with Steven and Vijay at times Noah
works with us on a daily basis he kind
of I'm gonna give him credit as the
locator ID separation visionary because
he talked about this 15 years ago and
was part of his Nimrod architecture that
was a candidate for IP mg where sip was
the winner of the IP ng Wars and it
became ipv6 Paul maca Petrus if Dave was
here he would coin the phrase that Paul
said that Lisp works in theory
Arlis works in practice but not in
theory and I thought that was a
compliment actually so he went is going
through the same he went through the
same struggles that we are about dynamic
updates and he said we're not going to
do dynamic updates to DNS and he went 15
to 20 years without dynamic updates
until that was added later so he could
understand that that's going to be the
hardest part of the design to get work
and scaling and you guys have already
brought that up we went up to Seattle to
talk to Len Bozak founders Cisco and
said led Len what do you think of all
this he goes oh it's boring it's just
another encapsulation and I said thank
you that's what I wanted to hear so
that's it here's the references that's
pretty much all I have we're going to
take questions which use cases do you
think are compelling or throw out the
ones that you think are not compelling
that I brought up
yeah I think the mobile node case will
really help guy pp six deployed as well
because if you really want global
addresses on your mobile phone and you
want to mobile phones the roam with
stretch one and keep the TCP connection
up there are no solutions today that can
do that and you know mobile ipv6 can't
do that mobile IP has the stretch of
greater than one because of the home
agent so I think this this part what
list brings the table is new and more
efficient way of moving packets we
really have to make the implementation
lightweight the the mobile node
implementation lightweight and that's
the key and that's why you know thanks
to Steve and he gave us half a dozen
Android phones and we're doing an
implementation now and we're gonna find
out in the incoming months if we can
make it really simple the difficult part
is it's part of the IP layer it's inside
IP so it has to be put into the kernel I
mean this is going to be hard to do it
on iPhone because we can't do it in
userspace right so that's why we're
playing with Android since it's open
right
yep agree hundred percent you have to
control your own maps are you the site
that has a ID addresses should control
your own maps or is that what you're
saying okay right up / 32 right the to
not abuse that right
yeah I would I would argue that the
sites that want to control the
advertisements in would run their alt
BGP connections directly into their et
arse and if you wanted to support mobile
nodes that the map servers run on those
boxes but they're only to support the
prefix that you're injecting into it and
that's an example I think what you're
yeah yeah cuz we just don't want any
slash 32 to show up anywhere cuz it
doesn't work well for scalability but it
may have all these policy and security
issues that you have to worry about as
well so you know hopefully a map server
address that's programmed in a phone
cannot be changed by the user at all
that it has to be somewhat hard-coded or
it's like a serial number or you know
its factory installer you can't change
your IMEI address exact or number right
exactly
so it's something like that yes yes I
don't know if that's a feature a bug but
you know
right power users yeah so that's it
thanks for coming guys I hope you
enjoyed the three-part series we had
some continuity with a few people so I
appreciate the people that came to all
three of them hope you got something out
of it and we look forward to working
with you input is really really
appreciated Thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>