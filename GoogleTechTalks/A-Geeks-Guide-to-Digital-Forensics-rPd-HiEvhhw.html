<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>A Geek's Guide to Digital Forensics | Coder Coacher - Coaching Coders</title><meta content="A Geek's Guide to Digital Forensics - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>A Geek's Guide to Digital Forensics</b></h2><h5 class="post__date">2011-07-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rPd-HiEvhhw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">today we've got anger who's hoping hope
from here forensics right that's great
all right and I'm just going to give us
a brief chat on digital forensics
digital forensics well first of all I
want to thank Google for the invite
today most of the companies that we end
up working with would like us to go out
of business and instead I met Fitz a
little while ago and he said he wanted
to come out and give and talk about
digital forensics and I said I'd love to
do that
I said I'll let you know there's a lot
of people at Google that may not like
some of the things that we've uncovered
some of the chats is like doesn't matter
come on all we want to hear about it so
I want to thank you guys with the chance
to be here we're going to talk today
about digital forensics and obviously
with the crowd that's here today it's
going to be a very technical talk but if
you have any questions in the middle of
it go ahead and interrupt me let me know
if you've got questions in the middle
otherwise we will cover some at the end
via forensics has been around since
about 2008 my background is a computer
scientist I've helped various management
roles at different companies and then in
about 2008 we started via forensics
we've got a couple books they literally
came out this week one of them is on
Android for instance which is my
particular specialty the other ones on
iphone forensics which I'm sure will be
a big hit here so those just came out
and we focus on both forensics and data
security we've got a couple patents
pending in this space and I also do
quite a bit of expert witness work so in
the forensics space geotiff
certifications and then you can be an
expert in state and federal courts I'm
also trying to true geek like most of
you have been using Linux for quite some
time and I remember the first time I
ever learned Linux q special edition
came out with an 800-page book and I
literally opened it up started at page
one and went through the whole thing
I was cooked from there and haven't
looked back since we did quite a bit of
work in the mobile space I'm going to
just tell you a quick story this
gentleman approached that's it needed
his phone exam and so we said you know
okay but what kind of phone is it is it
an Android device you know those guys
are going out 400,000 devices a day said
no it's not an Android device we said
how about iOS is it an iPhone you've got
200 million iPhones out there he's like
oh no no no he said I don't have a
smartphone I have a blackberry so we did
quite a bit of work at the mobile space
and again iPhone and Android is really
where we we connect quite a bit of time
today's talk is really meant to be in
overview of digital forensics it's going
to be a quick run through we're going to
skip over some of the details and boring
stuff we're going to jump right into
examples and give you if you're
interested in tinkering in this space it
will give you some things that you can
go back and install on your workstation
and start playing around with it but
briefly digital forensics is a science
it's recognized as a science which is
why I can be an expert in federal court
and we're interested in the preservation
and then analysis and reporting of
digital artifacts and so that was
typically would cover computers laptops
obviously things like thumb drives USB
storage mobile phones have become a very
very big deal that's where we chose to
specialize electronic documents that are
using court cases what we'll talk about
near the very end is is that forensics
is typically a reactive science so we
get called in when there's been a
problem there's been a civil lawsuit of
criminal case and intrusion incident
response the big thing that we're
interested in is kind of a tech startup
companies we do all the forensics cases
and that's kind of fun and interesting
you learn a bunch of stuff what gets
really exciting is when you move
forensics out of the reactive you move
it into the proactive space and so near
the end we'll cover a couple of topics
in mobile app security and enterprise
security that kind of can think outside
the typical forensics box of being a
reactive after the after the scene and
come in and do things proactively so
real quickly the three types of storage
devices that we typically deal with the
traditional hard drives spinning
spinning magnetic media that's pretty
simple we can physically disconnect
these things hook up right blockers and
deal with them on the solid-state drives
that come out every time a new
technology comes up there's a bunch of
naysayers in the industry that say ah
this is going to change you have to
recover any data it's forensics is over
and that never happened so obviously we
deal with solid-state drives and they
have their own kind of host of issues
and challenges that they come with where
we really play in quite a bit and it's
similar to the to the solid-state drives
but basically in the wrong name flash
memory and so this is the type of memory
that you'll find on a smart phone on a
USB thumb drive of other types of
portable devices they're obviously not
easy to remove we have some techniques
where you can hook up J type clips and
take over the CPU and basically pull
data out in a debug mode you can do some
chip off work where you basically take
hot air blast the chip off of the PCB
put it into a special reader and you can
pull the data off that way but for the
most part um you're not pulling data off
of these devices with a physical
technique so you have to come up with
other ways to image them
the other big thing about NAND flash and
the reason why I spend a lot of time on
this is the NAND flash is really changed
the forensics and I'm going to write the
security space so there's some unique
characteristics average NAND flash can
only have about 10,000 writes it won't
sustain a charge after that and for that
reason the Android team here at Google
and the folks at Apple on a number of
other companies developer chose special
file systems that are optimized for and
storage and it will come into that in a
little while when we talk about the
types of data that you can recover off
of them the other thing too is that in
the forensic space were very interested
in preserving a piece of evidence and
proving to the court or whomever it may
be if we have an exact copy in
traditional hard drives that was very
simple for us to do we pull the plug
hook up a write blocker if you don't
plug that thing back in
you image it ten times we'll always be
able to verify that we have a bit 4-bit
copy NAND flash memory thumb drive
solid-state drives it's impossible to do
the reason is that there's a lot of
drive management and things going on
behind the scenes and it prevents you
from getting an exact copy so we'll talk
about some strategies to get around that
but the NAND flash memory is the other
big type of storage that we deal with
considerably so in the forensic space we
have to talk about how are we going to
acquire data there's three primary
things that we do in the most simple
approach is essentially doing backup
files we'll get these in court cases
that are involving ediscovery but we
don't have to come in and look for
deleted data they really just need to
get a bunch of files out take a look at
them and then and then analyze it we
also do this quite a bit on iPhones
where we'll do a backup of an iPhone and
then we'll basically logically analyze
that the backup files that came off
you'll see if an email files were Doc's
all different types of documents it's
the least forensically sound it's the
most uninteresting from a technical
perspective and it's probably the
largest thing that people do because
most cases simply don't warrant the
other techniques a second approach and
kind of emphasizing this in the mobile
space is the logical acquisition so on
an iPhone or an Android device we can
pull out data through content providers
we can pull out data from the Apple
backup protocol but what if we can get
into the phone and basically do a tar
gzip of the entire file system now I'm
not going to get deleted data but I can
get anything in slash mobile or slash
data and everything underneath there so
there's the type of acquisition that we
do and you can do these on Windows
computers too where you're not pulling
on all the unallocated space but you are
going in there and preserving a date
time stamps and everything of that sort
on the actual file system so we consider
that a logical acquisition of a device
and then kind of the gold standard and
what we really strive for in the
forensic space is a physical acquisition
physical acquisition is a bit forbid
copy of the storage medium when we did
our acquisition
in the traditional hard drive space we
can repeat verify that but again in a
NAND flash memory the solid-state drives
your getting a point in time copy to
device whenever it's powered on even if
it's connected to a write blocker will
always be changing behind the scenes the
nice thing about a physical acquisition
is that we can easily recover deleted
data out of those and there are some
specialized tools some specialized
software hard drives or that we use in
order to do the physical acquisition but
in terms of just kind of tinkering
anybody can hook up a drive and do a
physical acquisition with basically a
save in a USB adapter you hook it up to
a Linux box we'll go through some of the
tools that you can use to do that
so physical acquisition is really the
kind of the gold standard of what we're
looking for now how do we do the in the
verification of the data that we have an
exact copy well it's very simple we
simply do hash values it's accepted in
court
everybody essentially knows how they
work for those that may not be familiar
it's just a a hex value that's
calculated with some sort of input of
data the nice thing about the the hash
values of course is that a single byte
change in your source data will have an
avalanche effect and will have a
radically different hash value so we use
hash values they're admissible in court
and it allows us to say that these two
data sets are identical I have an exact
copy of the original I did all my
investigation on the copy now we're
going to go we don't have to reproduce
so we don't have to produce that
physical media every single time we
would reference it and again this is the
challenge in the NAND flash and mobile
spaces that we just can't get a hash
signature to stay the same if you image
that same device multiple times so you
kind of do a point in time hash
signature and basically say this is what
it was data hasn't changed since then
and we're going to operate off of off of
that data set the two common ones md5 is
what most people use the forensics
cultures start moved to shout 256
because there's a possibility of some
collisions now that the number of files
has increased
and again for anybody that hasn't seen
like an md5 if you took my name and ran
it through md5 here's the hex signature
at the bottom of this slide
that you would get out for that
particular dataset how we do this on
entire drives yes sorry so I apologize
attention so I know that if you got and
flash it up and there's something we're
11th layer there a few additional rights
that was like
exactly but turn off the punch you did
the problem is is behind the scenes even
if you're not writing the disk is still
managing and actively and so there are
there's we're leveling and it's very
difficult for forensics folks to come in
because most of the information in that
topic is intellectual property so when
we grab a solid-state drives from
Toshiba or Intel the don'ts are you go
there they don't tell you what they're
doing the we're leveling on the bad
block management on the Riva nip you a
ting of moving data around to optimize
it all that happens behind the scenes
we're not aware of it and we'll talk
about how Android is a little bit
different we have some more access in
the Android space it's still problematic
and you don't even have to write
anything you can literally hook up a
write blocker nothing is being written
and it'll still call it two different
hash value so let's talk for a minute
about how to acquire a hash forensic
image so just conceptually if possible
if you're dealing with a solid-state
drive that you can pull out or if you're
dealing with a traditional hard drive
you hook it up to a physical write
blocker
these are little black boxes you can
find from Kaplow and a number of other
companies and that physically prevents
any rights from ever going back to the
driving essentially intercepts them and
that doesn't pass them through there are
software techniques you can use Linux
you can flip some some flags windows
it's got a USB driver if you're really
doing something for court or maybe used
somewhere else you know don't don't go
to opera that's a couple hundred dollars
in them in a write blocker physical
write blocker and again this is
essentially impossible to do at the NAND
flash space unless you do a physical
chip removal and put it on a chip reader
where you're circumventing you know
essentially all of that
flash translation layer and things of
that sort then you physically acquire
this the this is the device with
software we don't do a lot of commercial
stuff in fact I don't think we do any
commercial tools in-house for this so we
primarily focus on an open source and
the presentation will just give you
examples all in open source there's a
whole bunch of different tools out there
they're maintained sometimes by
different federal agencies by different
forensics companies there's a couple
examples up here the Department of
Defense dc3dd is the one that we use the
most and we'll go through an example
there's also some free tools out there
for instance ftk puts out an immature
ftk is a commercial company X company
but they have a free imager up there
that you can use to acquire in in so you
can download that and run it command
line or GUI in Windows and I think a
couple other environments and then
there's the full-blown commercial tools
that will also do this so a lot of
forensic shops go down to commercial
they can't drink that kool-aid and then
they'll do all of their acquisition and
analysis in a particular commercial tool
after you do the forensic analysis you
then want to do the verification where
you essentially reread this source
device and you compare the hash
signature and make sure that you have
that identical copy so here's an example
you guys can refer back to this we're
going to post this out on via forensics
comm on our website anybody can take a
look at it I know the Google folks are
going to put this up on on YouTube but
the Department of Defense has a
cybercrime Center they have a vested
interest and making sure there's
validated software that works and allows
them do their job and so they put that
out there as open-source
it's a patched version of DD that you've
seen on many UNIX systems but they build
in a number of features that are helpful
in the forensics space and so I put an
example up here where essentially you
passing that the dc3dd command you give
it your source device which would
typically be /dev SDA or SBB whatever
essentially devices get assigned by the
operating system we always put the verb
you put up equals so this is the output
file that you get right into so you give
it some some name like drive over one
Deenie turn on verbose do a hash
signature on the fly track that in a log
file and then the very last thing is rec
equals off and that basically determines
how do you handle when the drive has
errands so we were actually shipped to
drive yesterday it was going to be a
one-day turnaround we can get it back
and overnight a loop to that same day
which you know if both drives were
throwing out three dams so we're unable
to acquire the driving in a hash
signature so this tells the program what
to do when you encounter an error and so
we basically say if you see in air do
you want to keep going with the recovery
or do you want to stop and then go
figure out what to do next
comply with this from source if you're
going to use this on a workstation it
takes like 10 seconds you can just
download it from SourceForge
and I just gave an example here on the
second line you can see write protect is
on this was a 5 500 gig hard drive when
you do a physical write blocker and you
connect it up if you look into the
system messages or D message on a Linux
Parker box or whatever you'll actually
see write protectors on so that the
operating system has detected that it's
unable to write to the device and so
this is the type of logs we capture to
show the process that we use about 10%
of our cases involve failing hard drives
so what do you do with those you don't
want to throw in the talents and we
can't get anything off this device so
you have that that little flag that says
hey what do you want to do you either
stop when you have an error and then
decide hey I'm going to go down a
totally different path and try to figure
out what I'm going to do a lot of times
people will continue on air and simply
add the the sectors that you can't read
and pattern with nulls
that way you maintain the same size of
the DD image as the actual hard drive
you ripped past the bad blocks and you
padded with zeros and then you decide
what do you do you go back and explain
that later or how do you want to deal
with it the other option that exists is
that you skip the bad blocks and that's
probably a really bad idea if you image
a 500 gig hard drive hard driving 499
come through you've got a problem
explaining haywire why are these
differences so this is an example here
of what you'll see or what you don't
want to see we were imaging a hard drive
who's connected to s de we start getting
a board command you can't sense the
information and that is to say I can't
read this sector I've got to find that
buffer err I can't do anything the trick
that we found in its great software is
again this is an open source under the
GNU project is DD rescue it's an
extremely powerful program you go out
there you compile it what it does is it
begins to read the drive as fast as it
can as soon as it starts hitting bad
blocks it essentially skips over them
and it keeps going and the idea is if
your hard drive is going to fail let's
rip every piece of data we can off of it
as quick as possible as soon as we get
to the end of the drive it maintains a
list of which blocks are bad and then it
goes back and it takes that the size of
the sector that it reads and it makes it
smaller and smaller and smaller now it
takes a long time but we typically get
very very good recovery by skipping over
the bad blocks it has the ability to
read things backwards to read them
direct or indirect and has a whole bunch
of different options so if you ever have
a hard drive for a family member which
is sure you guys have got these requests
before the hard drive is partially
failed all is not lost take a look at
needy rescue it's a great program and
again you can just download that and
compile it so I want to spend up just a
quick overview on what does a typical
forensic investigation look like and I
say typical because there really isn't
the typical one but there are a number
of steps that you ought to consider we
believe very very strongly in building a
timeline of events the first thing that
we want to do when we get a computer we
want to figure out the entire what we
call MACV the modified access changed
and created timestamps on the entire
file system we want to rip through the
metadata inside the files themselves and
we want to build an entire timeline of
anything that happened on that device
and then we can zero in say this file is
modified at this time we saw a registry
change here somebody connected an USB
Drive and we can find out everything
that was
so the first thing that we do is you
create a time line and I'm going to step
you through these in some examples um
you don't have to mount the DD image to
do that so we've got some special
software open-source software that allow
you to do it
we then mount the DD image is it
read-only so we're doing we're only
working on the copy but we mount that V
don't Lee we list off every file that's
on there and every file that the file
system is awareness deleted so we list
off every single file deleted and are
deleted and then we begin to analyze key
files if you're in the window space
you're going to be looking at registry
files link files user profile web
history whatever it happens to be if
you're running any Bunty or Linux here
look at the bash history you're looking
to recently run programs you're gonna
look at the G VF v FS metadata about the
file systems that have been connected
you're going to try to basically piece
together all of the information on the
system at that point we typically remove
a move into recovery deleted files on
the baby that may be important to the
case now deleted files are typically
still referenced inside the database if
you will of the file system so in an
NTFS file system you have the master
file table of the MFT you've got the fat
file system has their own fat table it
is essentially a list of all of the
different files that's aware of where
they're inodes where they point when you
delete a file the entries can still
exist in that master database so we'll
go into the NTFS database the MFT it
will parse out and then decide can we
recover some of these deleted files
we'll show you an example that minute if
you're unable to recover them there's
still the possibility that the data
exists in what we call unallocated space
space that was perhaps allocated at some
point the operating system says I'm not
using this anymore but maybe their files
or file fragments in there so we'll use
a technique called file carving to go in
and see if we can extract out or carve
out unallocated files and unallocated
then we may do something like a full
indexed search of the DD image and pull
in that search of all of the logical
files so that we can come
and search don't look for keywords and
things of that sort and then from there
it really goes in a million directions
people hide sensitive data in other
files that's called stenography you can
go in and try to figure these things out
so there's a million different
specialties that happen in the forensic
space but these first six or seven steps
are really what you're going to do in
many many investigations to get them
started so this kind of part of the
talks I'm going to go into specific
examples these are all open sourcing
tools that again you can download and
install there's a excellent tool we use
it all the time it's called the sleuth
kit it's written by Brian carrier you
still actively maintains it
he also wrote a fantastic book called we
call it FSMA it's a file system forensic
analysis it's 400 pages of everything
you wanted or didn't want to know about
file systems and if you have insomnia
and with all respect to Brian pick up
that book late in the evening you'll be
set or pick up our book it's pretty much
the same thing but when you need to go
in there and understand why did
Microsoft update this time in
milliseconds this one in an hour
and then here it's every two seconds
Brian's got all the details in this book
it's kind of the Bible for for forensics
people when it comes to file systems so
she's got the book and then he has the
sleuth kit that's out there you can
install it with different Bungie
packages and whatnot but again if you're
going to be playing around with this
just downloaded from source it's very
very simple to compile he pushed out an
update two or three days ago it supports
a lot of file systems that you may run
into and TFS pad different UNIX file
system CD ROMs and it's just sitting out
there smooth kit that'll work so we're
going to spend a few slides going
through some examples one of the first
programs you'll find out there is called
M MLS media management LS if you will
and that basically gives you partition
info so if you look at the screen here
you can see that I'm doing an M MLS on
dev s DB
so that's on physically connected discs
you can just as well do these on DD
images and you can see each one of the
different pieces of the file system it's
probably quite obvious here that we're
dealing with a Linux file system you can
see that this is very very common on the
DOS partition cable is typically 63
bytes long the first byte tells us
everything that we need to know about
the filesystem and then you've got 62
bytes and essentially on you unallocated
so that's why you see the primary
allocation table and then unallocated
and then you can see that we've got a
Linux partition ext3 and you go down the
table and you can see all the different
data so this would tell us on a physical
device or a DD image what is the
filesystem look like where should we be
looking for data in a lot of cases we're
going to jump right into the ext3 or the
NTFS if we've got somebody that's very
good technically we might start looking
at unallocated space and say you know
what somebody could hide data physically
on the drive and move it into an
unallocated partition that's easy enough
for us to see here to tab to kind of
focus the investigation so M MLS will
give you that background information the
next thing that you can do is you can
run a program in this boot kit called FS
fat filesystem statistics it'll give you
a lot of information on this particular
one you see I switch to a different file
this time I'm looking at a DD image on a
web off take it from a palm tree so this
is a DD where we went out we got a
physical image of a palm free of running
web boss we have done a secure erase on
it we wanted to see how effective is
secure erase on harm on the web box and
so by doing that best ad you can see it
live is didn't fit on the screen so I
just kind of cut it off after the first
couple lines but you can see information
about the filesystem
what filesystem what was the volume ID
when it was last written or updated
mounted a whole bunch of information and
it gets into all the metadata and then
we'll individually list out each of the
files and the I knows what files are
connected to and essentially allow you
to traverse that tree and recover
information so that's at best stat now
the one that's really interesting we
spent we use quite often is something
called forensics list or forensic LS
this is utility where we can come in and
we can query things like the master file
table the NFT it's part of NTFS and we
can say rip through that whole database
and tell me everything that you see on
the system you can provide different
offsets so you can take a DD image and
you can just examine that third
partition on that fourth partition so
FLS will basically rip through and pull
out everything about the allocated about
the file system that it can find again I
refer back to this MACV this is going to
give us anytime that if I was modified
access changed or deleted and we use
this to build our time line analysis and
here's an example of a command running
FLS putting it in central time otherwise
it would be in GMT we track what the
skew is in terms of the real time versus
what the BIOS is reporting so when we do
investigation we boot up the computer
where we look at the atomic clock so we
have we look at the BIOS we figure out
there's a three-second skew and that's
probably important in it like an
incident response where we have to come
in and try to decide whether or not
something happened three seconds ago and
it matters for matching up wallet so you
can tell what the skew offset is you
give it a label a file system some
offsets and then you basically pointed
at the file so in this particular
example we're actually looking at down
here the command I did it against a NTFS
file system and you can begin to see and
it's difficult to read the next slide
will address that the different files if
you notice there is about halfway down
there's one that says dollar sign MFT
and then down the sign MFT meter
those are the two NTFS databases that
track your entire file system it
actually stores a primary MFT and then
it nears the ffft so if somebody tries
to wipe out their entire system we have
the ability potentially can come back
and grab the mirror MFT and essentially
recover what had been mirrored by the
operating
system so by looking at it from a
forensics perspective we're actually
looking at the dollar sign special files
if you don't have access to to normal
operating system that we can then parse
that information out now looking at it
in this format it's a little challenging
so the file that you create there is
called a body file it's just the
terminology that the forensics or
community came up with and so what you
what you do is you then take a program
called math time and you point it at a
body file and you say hey I need to make
this human readable so give me something
that's better to use and so for instance
well we'll typically do this book we'll
put it on to CSV and then we can hand
this off to attorneys who can go in and
filter it and say hey show me everything
that was modified at this time show me
anything that was deleted or whatnot in
this particular example I'm going to go
back one page well in this figure
example I may be recovered later you can
actually see the files that have been
deleted and the files that have been
deleted and reallocated if they've been
reallocated that space has been reused
by another file we don't have people
recovering if it simply shows up as
deleted we have tools that jump in and
recover that deleted information off of
the drive in the image
so once you have the DD image you've got
the forensics copy you got your hash
signature now what you want to do you
need to mount that DD image you need to
be able to open that single file up and
in do step on it so just learning in
what circumstances there's a record of
the file actually saying on the disk
here is just deleted or Ezreal so if
somebody deletes it and I actually had a
different example and I think I changed
it out at the last minute but if
somebody comes in and deletes pollen on
NTFS filesystem and we'll talk about the
aptitude next which is a log structured
file system it's totally different in
how they handle it but essentially that
record stays in the MFT database until
they gets reallocated to the file system
says hey I need to reuse that space and
so what we end up having is the file
system market is deleted but it's still
sitting there it's still allocated on
the disk it's still referenced as
deleted but it's never shown up in the
actual file system so when you come in
with like FLS you'll find tons of
references to deleted files that are
sitting there and recoverable
now there's another case where it's
still sitting in the MFT but some of the
sectors on the disk that we're prizing
that file get reallocated for another
file and then we have a situation where
we're aware that the file existed but
part where all of it has been reused on
the on the disk so then we get a status
backup deleted slash we allocated for
most empty about systems files that you
needed years ago so it's kind of a mixed
the file of the system level files tend
to get reallocated quite a bit but we
find a lot of user space files that we
do end up recovering and it depends if
somebody had two or 50 gig hard drive
they only use 30 gigs let's say they
came in there and deleted all the files
or went in to internet explorer or try
to do a clear cache because you know
they wanted to hide what they were doing
what will essentially recover all of
that now that was five years ago it kind
of depends but remember a lot of times
about the record unless the MFT itself
does some cleanup and basically you know
completely gets rid of that but in
general we should we see all that
information
so in this particular example we need to
mount the DD image so we come in with M
MLS and we take a look at an IDI image
that we have out there just like you saw
with the physical disc you can see the
partition table this actually was pulled
out of an Android device in was the SD
card we pulled out the SD card be imaged
it and we can see that unlike most hard
drives we actually have the primary
partition table in the first of
basically one sector and then we have
129 bytes that are on allocated are 28
and then on 129 5 we jump into the fat16
file system so we basically use that
information that 129 to then go out and
mount the file system so we go out we
create a directory and with sudo access
you basically say hey I want you to
mount the vfat file system I want you to
mount it on the loopback so we're
setting a loopback device because we
don't have a physical device that we're
using I wanted read-only and here's my
offset the offset number is basically
the start of the fat 16 times the size
of the sectors so 129 time is 512 will
lead you to 66 0 48 so it tells mom to
seek out to that part of the file to
mount this feed only as a fat file
system and then here's my DB file and
where to mount it if you then go out and
take a look at the at your mount tables
you'll see that on that loop 0 we have a
V fat file system and then you can see
that the V fat file system here at the
very bottom is has got 1.9 gigs 242 4
Meg's of use so you can basically mount
that DD image on your workstation at
that point in time you jump in and you
do any analysis that you want because if
you're working on read-only copy of the
original source media
so a couple more slides and I want to
just kind of give you some ideas um
there's a gentleman I've been speaking
with her for probably over a year now
Christian jordison he's out of Iceland
he developed logged a timeline which I
slightly misspelled in the header here
but logging timeline was Kristen's
attempt to basically say there's a lot
of valuable metadata in individual files
sitting in registry files I can pull out
timing info from registry files from the
vent walked from the MFT prefetch
browser history flash cookies done by by
the flashes oh so he's got 46 different
file types and he can extract timeline
data out and so if you download his
software and essentially compile that
he'll export it out to ten different
formats it's just sitting out there
called timeline it's great software and
so what we do is we run a piece of his
software is called time scanner so we
basically tell time scanner to go in to
look at the mount SD card directory that
we mounted the file system had to put
everything in central time zone and to
rip out any piece of forensic metadata
file timeline that Davian can of all the
files that it finds and so it will find
dll
what time dll's were created what sort
of cookies are found in any kind of
information and it will put that in a
body file we take that same body file
that this Luth get helped us build put
those two things together and then we
run a map time against it and create
basically called a super timeline so
we've got every piece of information we
could want whether we could possibly
extract out of that device and now we've
done time
a couple other tools dimension Harlan
Carvey he's also published quite a few
books with sinkers he focuses really
only in the window space and he
developed a tool called reg Ripper a lot
of people use this to get written in
Perl I tried to convince Christian to
move to Krista to move to Python and I
think he's considering it
Harlan does all his stuff in Perl and he
actually wrote it for the Windows
platform but there is a Linux port to it
which is the one that we use in the goal
of wrench Ripper is essentially to parse
out the Windows registry files and pull
out every piece of information that
could possibly get out of the registry
and it's pretty amazing what you can
find buried in the registry so you can
go out to reg Ripper press calm and
essentially download that tool compile
it and you specify the registry file and
then what sort of Devi went extract from
it this is open source software and it
will rip out tons of data on a Windows
system the last tool that I want to talk
about is scalpel scalpel is a file of
parking utility again this is open
source for years and years and years it
was sitting at 1.6 oh and about a month
ago they put these 2 2.0 version so you
can go out to to the website download
scalpel compile it and download it they
don't actually have a make install and
you can basically copy it out and use
your local bin and what you do is
scalpel is that many files have cinches
a magic number at the very top we can
identify a sequel Lite bug we can
identify JPEG and so what scalpel does
is it rips through the through the DD
image and it says hey I'm looking for
any of these known file headers they
specify a bunch from ahead of time for
you you can basically put your own ones
in there and any time it finds it it
then will parse through the system and
look through the footer if you has a
defined footer it will go through and do
10k or 800k or whatever they tell to do
it will look for a separate type of
identifier and then reverse and go
backwards so some PDF files you need to
find the start find a bottom marker and
then go back up a couple spots and so it
will find the last one so there's a lot
of functionality built in the scalpel
that will allow you to to carve files
out
of the file system so there's kind of a
standard scalpel comp that comes with it
we've developed their own scalpel
configuration files for both Android and
iPhone because they are different types
of file system and we're pulling out
different information all that goes into
scalpel output directory that you can go
in and see all the recovered files so
I'm going to shift gears here and I'm
going to talk a little bit about the
Android space Android obviously uses
NAND flash memory this is again we have
a specialty that as we've got our books
are out we've got some commercial
software
unlike iPhone and other platforms the
Android folks decided to not have NAND
flash memory where the manufacturer had
to use a certain one so it allows them
to use any NAND flash that they want and
they provide this this layer that sits
between the developer the NAND flash
called the flash translation layer that
basically exposes the flash as a block
device so that is implemented in
software and the Android space in the
flash translation handles the we're
leveling bad block management some of
the stuff we're talking about in in
Android and in Linux the flash
translation layer that most people use
is called MTD memory technology devices
again it's another open source device
the newer Android devices Samsung
started doing this first they're
actually beginning to move away from MTV
and they're coming out with their own
NAND flash chips that have the flash
translation later built into the
firmware it's already baked in so we
don't have the same kind of access we
have in the earlier Android devices but
so those are built into the firmware but
on a lot of the other phones we still
have the dev MTV devices where we can do
our physical energy now MTD divides the
memory essentially in two different
blocks the set up is a little different
than a traditional hard drive you're
normally looking at 128k block and
there's a 64 bytes of out-of-band data
that's stored inside the block for each
chunk or each particular page and inside
that is where for instance yes to stores
a bunch of metadata bad block error
correction
things of that sort so this is kind of
what it looks like in the Android space
if you have an Android device using the
MTD memory technology devices to access
your and memory
you basically have 132 kg or block size
because you have 64 - kilobyte chunks
and after each one of these qk chunks
you have 64 bytes 5 and 8 the great
thing about doing forensics on Android
with MTV is that when you're able to get
your hands on the o lb data you can do a
lot more with the devices because we're
actually seeing how the NAND flash is
being managed by the flash translation
layer so we can see where a bad box bit
mark what is the we're leveling
technique can we reassemble the blocks
back in black order allocation even
though they're scattered all out over
the physical image so that is a big
change for us and something that in the
interest is we're now able to do and
this is kind of what it looks like as we
talked about earlier there's a couple
different forensic techniques that you
use you've got the physical techniques
but the first thing you start out with
is a logical recovery most cases it's
sufficient to start there it's the least
complex in the Android space you do
logical recoveries using content
providers
that's an interface that the Android
team built in to allow apps to share
data so we essentially come in we say
hey we want to share something take some
of that information is being shared we
have a free tool that we developed we
give it away the law enforcement in
different government agencies it's
called AF logical and it basically goes
out and it takes the content providers
it reads that information logically so
it won't get any deleted data and then
it stores it and analyzes it we actually
come out 10 days ago over these two
commercial tool based on a
methodological that takes all of the
manual stuff that had to be done does
different analysis on it and puts it
into a virtual machine if it's in point
click kind of easy
so logical recoveries are the primary
thing that people do on Android devices
but we're interested in moving beyond
those content providers those the C pros
because we're only getting the
information that the Android developer
chose to share with us so we can pull
out SM as you can pull out right now we
pull out about 40 40 45 content
providers we're working on a new version
that may pull out a couple hundred but
it's still limited amount of data so to
give beyond the content providers you
basically need to escalate privileges
you need to get some sort of access to
device now if you had the original
Google dev phones you just have su
access that is great no problem this
talk is not about how to how to get
group on Android if you want to do that
you know get Google dev phone go out to
XDA
go buy our book so we're not really
going to cover how to do that but
basically if you escalate privileges on
the device you can then take the next
step forward which says all right I want
to tarji Xia for the entire file system
it's not the same as having unallocated
but it is going to get us everything
under slash data / dat a-- if you're
familiar the Android space you can get
that directory you've got a lot of what
you need so that would be all of the
sequel like databases preferences files
pictures images that app developers are
storing inside their protected space
that they get when they spin up an apk
so will if we can escalate privileges
that will go for a logical acquisition
on you can push tar up to the phone as
long as you recompile it for the arm
platform you can't are gzip it and send
it out like over netcat or you could
just do something like an ATV ATV has a
recursive pole we have some issues when
you do large recursive poles that you
can run into some issues on so in
general for doing it for a case we'll do
a tar gzip and send it out over memcache
but the real goal in the forensics face
of course is this physical acquisition
and so in the Android space once you've
escalated privileges and quite frankly
it's the same deal in the iPhone space
you get escalated privileges and then
you've got two options and the Android
space DD comes built-in I love it
there's no copy command there's no CP
command in Android if you want to copy a
file you've got shell Answer shifted
deviate from one spot to the next and I
like that it makes me smiling it mostly
confuses everybody else if you do the DD
DD does not have access to the
out-of-band data so if you go on you do
a DD on one of the MTD devices you're
actually not going to get all the
information that you would want for
forensic analysis now it gives you quite
a bit of data into in v2 on allocated
data but it's not going to get you all
the pieces of the puzzle so what you
really need to do and this took us to
some folks to other people so some time
to figure out but you need to go in
there and do a full band um that's going
to include all that out-of-band data
that we talked about we have a custom
version of NAND um that we developed it
allows us to get the full dump of the
MTD partition and then on top of that
gift deal with things like bad blocks
and things of that sort so we basically
built their own you could go out and
compile some of the nan dump out there
that are available and do it for armed
and essentially use that as well and
once you do that now you can take
advantages of all of the special stuff
that you get with us to on Gasque is the
file system that rigidly google shows
it's basically being moved away from and
some people running ext3 some people now
the Google came in our Android community
X before but you have to is great it was
open source it's a log structured file
system so the best way to think about
that and I had to look it up when I
first read about it is that it's
essentially like source control on your
file system because it doesn't go back
and ever rewrite a block it can only
erase a block and then and then write
the data there it just says it's more
efficient for me to write at the front
of the law so if you have a file and you
change a couple bites in it it just says
go ignore that previous fight and
rewrite that entire block and Department
of all so what
when we analyze the ask to file system
if garbage collection hasn't occurred is
basically an entirely version file
system we can recreate every single
stick the file is ever in now of course
a practice you have to reclaim space on
the device and so garbage collection
occurs and so we may end up having
fragments of different files but in fact
we get a very very dramatic recovery
from a askew file system I don't think
we've been geeky enough so I want to
pick it up one more notch here and say
that let's take a look at - - from from
a hex editor standpoint so if we're you
have access on a device you can get into
the MDM TV so here we do an and dumped
of the dev MTD and I wanted to get rid
of a bunch of zeros and apps to go
flying by this it's important to the
file system but it's not that
interesting when we're looking at it on
screen so what you essentially have here
is we're looking at the raw flash nan
dump of a particular file at the very
top you can see that file 1 dot txt is
the name on the ash Q file system has
basically two types of data it either
has an object header where it has object
data what we're looking at here is an
object header so this is giving us the
file name and then most people would say
well there's no other information over
here there's nothing else I can do so
look there's just a bunch of binary data
and couple characters let's move on but
honestly there's quite a bit more
information here you just have to look
at the s2 source code figure out what it
is
so Android stores integers in
little-endian so right-to-left and if
you look in here I've highlighted a
couple different things you'll see a
repeating pattern of 63 90 95 d4 in the
end this ends up being a timestamp so
what you've got is you've got a little
endian number and at the at the pileup
so you actually have to completely
reverse these guys so you take that
$63.99 and you flip it around completely
so you end up with four five d9
six you take that number that hex number
and you convert it to a base ten number
you come out with a timestamp and
actually Android does timestamps in
milliseconds for the most part and so
you end up getting the number of
milliseconds since 1970 as soon as you
recognize that date format you can pass
it into a number of tools convert that
date format to date time stamp so 501
txt I was written on Thursday February
17th and 355 p.m. which means and I was
working on my book in the middle of a
workday in mid-february so this is
actually an example that we've taken out
of the book but it's very interesting
with the gas cube file system you can
essentially come back in rip out all of
the object header files and recreate
every single time that a file was
accessed modify or change on the entire
file system and so what you have to do
is you got to get into the source code
you have to look at this stuff and hence
you have to try to figure out what the
data looks like and then essentially
write programs the type of stuff that
we're doing here is not supported in the
commercial forensics tools for the most
part on so what we tend to do is you
spend a couple years ahead of where the
big forensics tools are going to be and
we write our own Python scripts to
essentially rip through DVD image pull
Apio OB stuff and do some data carving
go back in where you put the file system
back and block allocation order start
ripping out the object headers build a
timeline let's figure out what what
happened on this device so by starting
with the basic tool of the solute kit dd
hex editor you can basically get
physical images of these devices work
your way all the way up into the hex
dumps and then begin to figure out the
file system structure
yeah skew is interesting they actually
don't track the access time because
every time a file is access they didn't
want to rewrite a new object header
which would be a new right to the to the
NAND flash which would ultimately wear
the device out so there's an eight-time
that's in there it's actually the first
time that it was created and then they
never update the access time after that
but they do also try to modify time in
the change time of a file you can pull
out the object ID that's out in the
outer band you can do different props or
cross referencing and basically figure
out you know what file is just what I
know you know what are the different
blocks that are using the allocated so
we can build that entire timeline and
then you can also go in to begin carve
out files and other pieces of binary
data it might be of importance to your
investigation or your analysis so the
last slide to kind of wrap this up
this is all kind of interesting stuff
it's it's Android it's it's iPhone it's
whatever the different positive you can
do this on anything that's out there but
the forensics space is a kind of in the
corner of security so you've got
security that sometimes sit to the side
and then inside of that we're all the
way off in the corner so we're the guys
in that don't get out of the lab that
often and for a commercial forensics
company the traditional technique was do
more investigations how do I get bigger
I do 10 times investigations and then 10
times that maybe someday we could have a
cup on or employees doing investigations
there's there's a change it's happening
and we like to think that we're kind of
at the forefront of them while we find
the forensic investigation in the hex
analysis fascinating what's far more
interesting is if you take this reactive
science of forensics and say let's not
call the forensics guys in after there's
an incident let's kind of invite them to
the party ahead of time you know we want
to be in the nice offices and have the
nice balloon ball tails and hang out
with you guys so let's get us out of the
corner and move us into the proactive
space and when you apply forensics
through the proactive space amazing
things happen and I want to just give
you a couple quick examples you can
check this stuff out online and take a
look at it the first thing that we do is
we do some basic of mobile app security
testing
it's low-hanging stuff I mean it's kind
of the easiest of the easiest so you go
on there you take a device you may have
privileges on it you may not need
privileges depending on what share
through the content providers or what
Apple comes in the backup utilities and
you go out there and you look for data
that sense essentially stored on the
device in an insecure fashion now we've
been doing this for a little while we've
got about a hundred of mobile app
reviews out on our website you can take
a look and filter it you can see what
applications are storing data in an
insecure fashion so what's interesting
about this well by using forensics we
can spot different issues that we may
say the developments in hey there's a
better way to store this information now
we can have lots of debates about well
if you're storing information on the
device that you encrypt it and the user
not going to type in a 32 character you
know a key file every time they want to
access their SMS have you really secured
the information and in the space and in
the mobile space especially you look at
the threat to consume because the main
threat to consumers are cyber criminals
people that want to steal their identity
they want to get financial information
so what they go for is the easiest stuff
the lowest hanging fruit if they have to
come in compromised the device perhaps
or hopefully get in there find out what
programs are running try to pull the
encryption keys out get that data off
and then maybe get a username or
password it's way easier for them to
just take all of the different apps that
store your username and password in
plain text and just copy them all so
there's kind of this yes you can't
necessarily fully secure a device if
somebody gets rude on it but you can
make it far more difficult for them so
that's one space where you pipe
forensics to mobile app security and you
take a look at what sort of data exists
on these device um I actually did a
presentation on an American Banker
conference so I think there's a week or
so ago so there's a lot more information
about this and if you hit that second
link you can kind of go through the
presentation and get some more details
okay how do you apply forensics in this
space what kind of information can be
recovered we have a very simple rating
of past warn fail something around 17
percent of the apps pass
somewhere around 30 or so percent get a
warning and almost 50% of the apps
failed in most basic tests and that
would be information that you would
typically considered private that would
be protected by your username and the
password
it's basically trivial to pull off your
device so that's going to be an
interesting space applying forensics
proactively security space and saying
what can we find out about these devices
so it could change some of our
development techniques and only store
the information that really needs to be
stored there if my Android device or my
iPhone where I happen to have is always
online then why do you have to cache
certain pieces of info now there are
applications and require data into cache
and in those particular cases you do a
balance between security and usability
and number of other things but a lot of
times will simply find information that
has no business being on the device and
it's just sitting there so that's kind
of an interesting application in the
mobile space the you know the other
space I'm going to talk about is that
when forensics guys get called in
Incident Response guys get called in
will come in will look at a computer or
will look at a server and something
happened he may have been an hour ago
most likely it was a day or a week or a
month ago and we basically are said told
hey something happened can you help
piece together the puzzle and we're
actually really good at that
but it's a really tough job so we'll
come in in about 70 or 80% of what we
need to tell you what happened is going
network connections Ram link file
somebody think up after itself it's gone
we can't ever get it back windows does a
great thing windows will only track the
last time you plugged in a USB Drive and
that's also only what it feels like
sometimes it just doesn't track it at
all so we come back and somebody said
well we know this USB Drive had had
sensitive info on it how many times they
connected we can't tell you when goes
doesn't track it so instead of coming in
after the the milk is been spilled and
trying to put Humpty Dumpty back
together again there's a totally
different way to approach this problem
forensic metadata is actually pretty
tiny if you look at a registry file it's
a couple minutes so if you have a key
server that has potential information
that may be taken off of it don't wait
until you get compromised just pull
those three Meg's off every day every
hour every 15 minutes you guys know
something about storing data and putting
it in a database and analyze
making sense of it right so why not just
store that information somewhere and so
that's what we do one of the other
interesting thing we call it continuous
forensics monitoring but the idea is
let's not wait until something happens
let's simply get ahead of that and now
you have an exact copy of everything
that you need to know and if something
happened today or we could go guess what
we'll just pull it up oh yeah all those
USB drives were connected you guys
missed it we missed it we weren't
monitoring it but I can tell you who
what when I can tell you the network
connection I can tell you what happened
so there's a really interesting space
and I just wanted to share with you guys
to think about if you kind of get into
the forensic stuff and you start
tinkering it's interesting to find out
what's sitting on your device it's far
more interesting to think about how can
you take the forensic science and apply
proactively to security or to improving
development techniques so that we can
come up with more efficient ways to work
effective or more secure ways to store
information so you know our big goal is
to get the forensic guys out of the
corner and we appreciate the the
opportunity to be with you here today
we share tons of information on our
website we update our blogs we have lots
of how to's out there so if anybody
wants to talk to us about it here's how
you get ahold of us and you know by all
means buy our books give us a call and
now thanks so much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>