<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Browserscope &amp; SpriteMe | Coder Coacher - Coaching Coders</title><meta content="Browserscope &amp; SpriteMe - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Browserscope &amp; SpriteMe</b></h2><h5 class="post__date">2009-09-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/pNfRL-TwzZY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is Steve Souders I work here
at Google on web performance and today I
am excited to have this talk about two
open source projects that I was involved
in getting out this week I announced
them at the Ajax experience earlier this
week in Boston so this is going to be
one of the tech talks that's part of the
web exponents speaker series and I'll
blog about it on Google code after we're
done but if you want to check out that
WebEx ponents playlist and we've got
people like John Resig and Doug
Crockford and aza Raskin and Ben and
Deon from Ajax Ian and other people like
that so it's a good set of tech talks so
this tech talk is going to cover these
two projects browser scope and sprite me
spritely is a spriting tool that I kind
of did on the side out of a source of
frustration that I'll talk about in the
second half but in the first half I
wanted to cover what I think is the
largely you know vastly a much more
important project browser scope and I'm
totally totally extremely excited
because my office mate Lindsey Simon a
few months ago agreed to take over this
project and Shepherd it to launch and
and keep it going and so he's going to
talk about browser scope in the first
half of this talk so with have any
further ado please help me welcome
Lindsey Simon
Hey
so I'm Lindsey Simon I'm a web developer
on the user experience team and I
started work a lot on the front end so I
spend a lot of my time in browsers and
one of the things that that means is you
have to learn about how they operate in
the wild and usually that's testing your
own sites or going to sites like quirks
mode or Ajax ian and seeing what the
state of the art is in text that can be
a problem because the browser's change
very quickly you know new builds of
Firefox come out you know every other
day or there's Knightley's and chrome is
in WebKit are coming out much more
swiftly than we're used to dealing with
in the web development world but we're
also very excited about that
so browser scope is a project to try to
capture historically this the
capabilities of browsers at given
releases and also to publish that data
so this is this is the website itself
this is browser scope you can see we've
got some categories here to click on and
you can also see that these are people
running the tests on their computers at
home or at work and you can see sort of
the flow of test times here so you know
they're happening pretty frequently
people are participating all right
sorry about my nubbin skills alright so
what is it browser scope we're talking
about this is an open source project
that lives on Google code it's saying
it's a community driven project for two
reasons one because users participate in
this not in controlled environments but
on their machines and in their plate
wherever they are on the Internet
also it's community driven because the
tests are open to the public so you can
go read the code for the tests if you
have an issue with how they work you can
suggest new ones you can write new tests
and that's something we're actively
encouraging and hope happens so these
are our goals we want to foster browser
innovation by publishing and publicizing
these metrics hopefully we'll see
browsers vendors try to improve on their
scores and solve problems that were
identifying we also like I said want to
be a resource for web developers to see
how browsers do and don't operate in the
wild and given the current version
numbers not on a site like you know
quirks modes say where it requires
somebody to manually update this is an
automated updated site so we're trying
to provide that resource as well and I'm
gonna say this is not to be in
competition with sites like works where
we can't do what quirks mode does in an
automated way PPK is a master of this
but also he you know as a human it has
limited time to be able to update every
page on his side at once so that is a
challenge the key characteristics here
is that browser scopes more of a matrix
than it is a benchmark we're not really
trying to just give you a final score
all the time we're trying to show you
capabilities across different tests and
give you a sense of what browsers do
well and what they don't do well like I
said before reproducible results are
really key here we're testing for
capabilities and not performance and
this comes back sort of to where we
started talking me and C we're talking
about what browser scope would be good
for and this is around the time that IE
8 had released a performance video going
through you know the hundred most
popular websites and
showing with their test lab how much
better ie8 was than other browsers at
this of course you know that's very
difficult to reproduce you need the
machine you need the conditions you need
the software and if those aren't readily
available you just have to take the
video on its word and of course we're
scientists we want to test things we
want to poke at things so that doesn't
cut it for us
so browser scope again you can all you
should always be able to go to reproduce
results on these tests and they
shouldn't be based on your process or
how you know good your internet
connection is so the scope itself really
is a framework underneath for just
capturing and storing this data at a
high rate and spreading out what's
basically a complicated median tree and
handling that for our developers mainly
people writing tests we want to be able
to capture these historical trends one
because they're just cool to look at and
I'll show you an example and also to try
to uncover regressions maybe one test
passes today in WebKit and tomorrow's
nightly it doesn't well we can capture
that if we store that information and
present it browser scope has close to
zero operating costs it takes right now
it's running on Google App Engine and
I'll talk a little more about that later
but it's running in the cloud it can you
know it doesn't we're not having to pay
for hosting conveniently since Google's
sponsoring that and so nobody it's not
tied to any one individual developer
participating this can go on if I get
hit by a train tomorrow somebody can
just take up the Google Code project and
do another push to App Engine so and
again the results are crowd-sourced and
so let's talk about crowdsourcing a
little bit by getting the users running
tests as a you know just from the
website for one thing it's really easy
to participate and it's really easy to
collect data another is that this gives
us a way to be super current you know
and nightly comes out you know maybe
people are even automating testing their
Knightley's with selenium who knows
what's going to happen once this has
been up for a while but as we can see
from the list of browsers which I'll
show you it's habit happens very quickly
we're able to cover he
spread of tests on a huge numbers of
platforms really quickly much more
quickly than you could do that yourself
and because that's really hard
so aggregating results here by taking
medians over you know a large data set
this helps to reduce selection bias and
like I said the new browsers will show
up immediately so this is our big
call-to-action on the front page saying
how does your browser compare and so far
people have shown this too and they
instantly understand what this means
they you know can come to it they maybe
don't understand the nuances of the
tests themselves but they get it and
they've participating so this is an
example of a trend analysis there kind
of stuff that we want to do on the site
but this was done actually out of Google
Spreadsheets so we just took all the
Firefox minor versions and put them on
the x-axis here and this is the network
test this is Steve's original you a
profiler test suite and of course
browser scope is and pretty much based
on the idea of you a profiler all the
crowdsourcing and most of the logic
behind how to do that it's based on that
project so this is Steve's data and you
can see immediately up until the right
which is good that means that means two
things one probably Firefox is paying
attention to this stuff on the web I
mean they're doing a lot of things but
they're also fixing these issues that
Steve's identified so that tells you
that having these things visible you
know results in them being changed which
is kind of what we want we want to be
able to highlight things that we think
browsers should be fixing and of course
like every large organization you know
they have a thousand things to do and
we're just trying to give them another
input in terms of priorities you know
working in buggin Iser I mean I know I
have a huge list of bugs
so sometimes priorities are a little
it's it's good to get feedback from the
outside world about priorities so here
you see you know come you know Firefox 3
they're up to 8 and by 3:05 all the way
up to 313 they had a regression in one
of the tests and do you know which test
it is Steve caching redirects so you
know interesting that you can kind of
see I don't know why that happened
it is interesting maybe Steve it was a
bug okay so you know this is something
where you know Steve's has really picked
up on that and it lingered for you know
several versions and then gets fixed
again and of course you know you can see
this trend they're fixing a couple
things at a time and come Firefox three
six I think now maraca is the codename
they're passing all 11 out of 11 Network
tests and I think Steve is telling you
they blogged about that and you know
they're proud of this fact and that's
what we want is to find tests where the
browser vendors are proud to pass them
so what are the tests what are we
testing today so we have Steve's you a
profiler tests which we've put under a
category of network performance and
hopefully we'll be adding to this test
suite like we have 11 tests now but
there's nothing to say that number
shouldn't go up and we shouldn't try new
tests and but again the points to pick
important ones that we really think
browsers should fix and put them in the
test suite Annie Sullivan here at Google
wrote a test for rich text edit mode
based on a pain that she deals with
working on the WYSIWYG editor that's in
most of our products essentially if you
cut and paste bold from one browser to
your email client and then you cut and
paste back into your browser the results
can be very different and I'm sure
you've all felt the pain of cutting and
pasting into browser text editors and
seeing oh why doesn't it do this why
can't I unmold something so anyone and
to really highlight the problems there
and rid a whole test suite to test that
and that's new with browser scope acid3
was written by Ian Hickson for w3c and
this test suite is a very complicated
test but trying to test even you know
future capabilities and it's sort of
bleeding edge in some regards but now
browsers are hitting the hundred out of
a hundred mark WebKit's hit it and so I
know that this is a big deal and you
know he has a long list of sort of
detail around why asset what asset three
is good for on his site and it's worth
reading but essentially it's it's
popular enough and people know it so it
makes a good thing to have on browser
scope
but again it's testing javascript CSS
rendering quite a lot of things the last
one here is the selectors API test suite
written by John Resig at Mozilla and the
author jQuery John wrote a whole test
suite for testing the new upcoming query
selector all syntax that will be in
browsers essentially which looks like
CSS selectors as a way to get at nodes
so you know there's a syntax a lexical
syntax for what you can put in that
selector and what should be what should
come back so he's actually written a
test suite and now we have data about
how browsers are doing against that test
suite in the future obviously we want
more categories here we've listed reflow
browser scope for me came along because
I spent a lot of time trying to profile
reflow in browsers it turns out that's
very much a performance metric though
and so until we've come up with a way to
solve with probably some kind of linear
regression or something the selection
bias issue we're not going to publish
that data just yet but I spend a lot of
time analyzing reflow cookies and how
browsers handle cookies security is an
issue that we could probably do some
automated testing for I spoke with Raman
this morning downstairs about adding
some accessibility tests so I think that
you know there's a lot of categories
here that people will get excited about
as this gets gained popularity and gets
visibility into the browser vendors so I
wanted to talk a little bit about some
of the architecture and challenges just
because it might be interesting to you
all as engineers of doing a project like
this one of them is just scaling you
know we want to be able to handle a
whole lot of input at once and not go
down and so you know we running on
Google App Engine today and that's
conveniently very good for scaling but
it is a challenge because you'd have to
set up your models and a certain way to
make that work so we're making these of
the parent-child entity groups in App
Engine because with those you can have a
relationship with one-to-many say and
then bring that down into a transaction
so that you can add things and make sure
you're not losing data or you know and
in the backend of Google App Engine when
you do a transaction it's trying again
until it gets it done so this ensures
their data integrity is
in tact we're making a lot of use of the
new task queue that's in labs for App
Engine and task queue pretty much does
everything for us because our system is
a median system so we're taking all this
data and coalescing it down into a
median well if you're in a sequel
database you could just call the median
function App Engine doesn't have a
median function so we're maintaining a
median tree in the datastore and in
memcache and that takes a lot of task
queue operations to do correctly another
I was just talking to Jacob here who Oh
actually I wanted to mention since we're
there Jacob moon had ported the ASA
acid3 tests in the browser scope and
we've been talking about some of the
challenges there one of them was that
acid3 is a really particular test you
know when we when Jacob started to ask
Ian about how to port it he was like oh
man you're gonna have a hard time it's
very dependent on a bunch of different
variables and of course Jacob went away
and did it and you know I think an hour
just because he's that good but you know
other things that we hadn't thought of
our thing like we were running acid3 in
an iframe and it turns out in Opera 1010
and some versions of opera doing that
tested an iframe actually yields a
different result than just running it in
the window object so I'm just going
straight to the page and you know a
bunch of googling and torturing myself
led to the conclusion that how maybe I
approaches doesn't handle iframes very
well sure enough running it in a frame
set works perfectly so now all the tests
run in frame sets but this is you know
just one of probably many challenges
we'll come up with it's trying to run
these tests user-agent string parsing
obviously that's a big part of this
project because we're grouping and
sorting and ordering things by user
agent string and parsing user agent
strings today there's not really any
single source of truth for how you
should do that and so we're actively
seeking out somebody to take on this
project sort of take it outside of
browser scope work on it and make
browsers go up a consumer of this so
we're working on that and if you're
interested please let us know and
probably the last and certainly big
challenge with this project is how to
display all this data because we want
people to come and instantly run the
tests but we also want to appeal the
browser vendors so that they can go and
run individual tests and fix things
but so this is a very different user
group and it is a lot of data so just
how to display it and I think that's
something we'll be experimenting with a
lot over the next six months just sort
of a roadmap of where we're heading we
want to put something like a wall of
fame or people you know trending where
some browser is quickly improving and
try and give them some visibility for
that obviously getting more contributors
and test categories is big for us being
able to tag or personalize your test
results
so say you do want to you know run all
your tests on a particular piece of
hardware and be able to analyze how
those happen we want to enable that
normalizing time-based results across
platforms as I talked about before if
you do have millisecond data you have
there's an inherent selection bias
around where that you know how that data
looks so for instance you know Safari on
a Mac is always going to look faster
than you know ie 7 because of the
hardware variants so you know I say
always it most likely will apples and
Mac's are really nice pieces of hardware
so those millisecond times aren't really
absolutely comparable but we can solve
this with some linear regression and
we're going to work on that and trends
so these are some links to different
parts of the project and I want to go
back to one other bit that's on our
project homepage and highlight that for
you
so last night I decided I'd stay up
really late because I had this great new
feature to demo for today's presentation
and you know I woke up this morning
after sleeping for 5 hours and thought
wow that was phenomenal so anyhow and in
an effort to sort of play along with the
Google data Liberation that's going on
where basically we're putting data out
there we now offer downloads of the data
in both CSV and Python pickle format
obviously Jason and other sorts of
dictionaries make good candidates for
future downloads but you know so and
also adding some roll-up statistics here
so I just wanted to go do look at the
roll-up statistics with you for the all
versions pages and you can kind of see
how browser scope works in the back end
we're caching
all of browser scopes data at a row by
row level so when new user agents come
in it only breaks the memcache for that
row so that's how we're able to actually
even deliver this page so just some
other highs you can sort by score here
and go down and see oh there's ie for I
mean who'd have thought somebody would
have run this test the night before but
that's kind of fun
so we go to the bottom we can see the
network tests we have 30,000 test
results in the network category with 441
browsers that's a lot that's pretty hard
to cover in your test lab you know so
the numbers are pretty good now granted
we did import this data from Steve's you
a profiler project so let's look at UM
the rich text tests and let's look at
what the spread is of this because this
has only been up since browser scope
launched oh come on my cron job will
have demo fail well okay let's look at
the selectors tests or acid3 okay let's
look at the all versions tab here and we
can look at how many tests have come in
just since we launched and how many
browsers the launch was on Monday so
three and a half days ago so we've had
6500 tests and 139 browsers and just a
couple of days so that's a pretty wide
spread and that's just you know a lot of
conference attendees when Steve
announced it and people just seeing it
on the Internet so that's a pretty good
metric for early part of a week I'd say
and so you know this is the numbers here
what's going to make this powerful so
anyway thank you very much and I'd love
to take your questions
yeah that that's definitely an issue the
question was have we found flaky tests
and how do we deal with that data I
think you know that's one of the one of
the designs for the system was to be
able to accommodate that problem because
let's say you know tomorrow you know
Annie's got 170 tests or something you
know or 200 tests that now you know what
happens when she wants to add a test
what do we do or what happens when test
number 160 is bogus all of a sudden so
every test has a function that can
calculate the median the score for the
row and so it's as simple as just making
this one function in every test set be
able to go okay actually we're going to
ignore test 175 and not counted in the
median scores or if a new test comes up
and we don't have data we won't penalize
the score for that row and as far as
flaky tests you know that's that I mean
I think we're trying to avoid that as
much as possible if we have flaky tests
I think we should take them out yeah
yeah I know I I hear ya I you know most
of these medians solve a lot of that
problem I mean what we really care you
know it depends on how far that what the
variance is like there but since we get
so many test results medians should give
us something closer to the truth and
would be a good reason why reading one
person's single browser test for that
wouldn't be so great yep
so the question is if we have a branded
browser that performed that reports
itself differently in the user agent
string and are you how do we deal with
that in the row and are you talking
about an example of completely changing
it like say you're in Opera and you go
to the configuration you set it to look
like ie6 or something more nuance no it
was a trend for a while for ISPs to
here's your specific contest
Yahoo browser exactly and it's just a
very lightly skinned version of some
other browser would it show up each of
those show up as a row in the table or
do you try to collapse them and figure
out what it is I think we would try to
collapse them and figure out what they
are but also it depends I mean right now
I don't think we have a great answer for
that question because it's you know I
think we want to defer that to once we
really parse out every bit we can if we
can distinguish it I think we should
distinguish it once you get to this all
versions page we might roll it up into
the major version of a you know of a row
but once you get to the all versions
page we really want to show as much
detail as possible and also we want to
be able to split this out by platform
and that's something that's coming soon
too to be able to see Wow is you know
Firefox on Linux does it do something
differently in one of these cases so I
think we want to provide as much detail
as we can possibly get out of that data
especially if it's useful to someone
okay Josh am i coming through from the
hi thanks I was wondering is there any
possibility of of recording what
extensions are in the browser because
that can affect some of these test
results yeah I think well again I think
one of the things by not doing
performance stuff we're less likely to
get affected by that but when it does
matter I mean there are you can get we
know anything you could get we could try
to get you know we could add a
JavaScript test down at the base before
we send data to send back as even more
info than is in the user age
string and are gladly accepting
contributions to that end intent wink
wink
okay I'm gonna pass this off to Steve to
talk about sprite me I wanted to relay
to other anecdotes about browser scope
one was I think we were kind of
fortuitous in the selection of the four
test categories that we launched with
two of them are are pretty well
recognized acid3 and residents electors
API tests and so when people look at
browser scope you know they immediately
you know no have an idea of what it's
trying to do and in the two other
categories you know my network test from
you a profiler and you might be a little
recognized but you know they were
totally homegrown and then Annie
Sullivan's test for rich text edit
controls are brand new but and and so I
think that kind of shows how we can look
at tests that are established and well
understood and and still have a benefit
of weaving those into browser scope but
then there's also this big opportunity
for things that aren't touched up on it
all out there to code that up and it's
not that much work and and start
tracking it and sharing that with the
rest of the development community that's
a segue into the second anecdote about
Jacob adding the acid three tests we
went to one of the regular I went to one
of the regular browser scope meetings
and that was the first time I met Jacob
and he like demoed he had like found the
project without really talking to
Lindsay or I or anyone else or working
with us and found the project downloaded
it he had some App Engine experience
which helped him that was one of my
stumbling blocks and he had just added
the acid3 test and like it didn't take
him that long and he comes to this
meeting first time I meet him he demos
it and it was like wow that's cool and
that was one yeah he added v8 and
SunSpider too and so you know that was
our goal from the outset was to make it
really easy for other people to add test
Suites
and so you know that was kind of a
positive test case that that we had
achieved that someone you know added
three test categories in that case
without really talking to us at all and
asking any questions so I think it is
pretty easy certainly contact the Google
group for browser scope if you have some
ideas or questions but you know I
encourage everyone to just dive in whole
hog
okay so shifting gears now I'm going to
talk about sprite me so let's see here
I'll just go to the website so in May I
at the end of May I spoke at WordCamp
the word press conference that NAT mule
and what runs and I had this idea for a
really awesome talk because I do the
same kind of talks you know 10 or 20
times a year at conferences and wanted
to vary it up a little bit and so I
decided I was going to optimize a
wordpress theme live on stage because
we've gotten to the point where a lot of
the tooling is readily available and and
has a high degree of automation in it
and so like you can run the Yui
compressor from the command line as part
of a build process for example so you
know I you know of course waited till
the night before the conference to go
through this you know it wasn't until
that afternoon that kind of gelled on
the idea so that night I sat down and
ran yslow and PageSpeed then came up
with the six or seven optimizations that
would make the most sense and pretended
like I was live on stage and did these
code changes and all of the changes took
me about that I had to make took about
thirty minutes and then I got to the
last one which was writing and at 3:00
a.m. five hours later I finally gave up
and it was just too hard and so it was
just amazing to me at you know and and
like you know I don't do a lot of
spriting and I had no familiarity with
this page but I was doing stuff like
combining images that repeat with images
that don't or combining
you know images where the the background
image itself was much smaller than the
containing block and so when I went to
one of the spriting tools out there like
sprite gen and it gave me a zero zero
background position offset I really
couldn't use that because it was making
the rest of the sprites background and
other sprite at images bleed through so
you know I just kind of gave up and but
I logged that away because to me it was
another place where we needed some more
automation and and codification of
knowledge in a developer tool and so for
the last two or three months on the side
I've been working on this thing called
sprite me so I've got a slide deck I'll
mostly do demo but I've got a slide deck
so I'll go ahead and jump into that so
here's EBA eBay's my canonical example
you can see I've run sprite me here and
I'll actually demo this more but I just
wanted to throw this up to highlight the
five main features of sprite me it finds
all the background images and elements
that use them in the page so you can
survey the current state of a page very
easily it has the logic of knowing what
to group together so you can avoid all
of those dead ends that I went through
when I was trying to optimize that
WordPress theme it actually generates
this sprite I you know there are other
tools out there that do this once you
know the image is that you want to
combine together and with and how to
group them well then you can use some of
those sprite generation tools but you
know that's actually one of the easier
parts of spriting it's all this arcane
knowledge about what you can and can't
group together and how to arrange it
vertically or horizontally etc and then
the really cool thing it does is those
other tools give you updated background
positions for the sprite but they assume
everything has a zero zero offset and
like in my case when I was doing this
WordPress theme almost nothing had a
zero zero offset so I did a quick survey
of the alexa top 10 and out of like over
you know it's about seven hundred Dom
elements that have background position
less than six percent of them have a
zero zero background position and so
these tools that just tell you the
background position assuming the zero
zero offset don't really have helped in
over ninety percent of the cases you
have to do math it's scary and then the
other thing that sprite me does is it
generates this new sprite with these new
background positions and actually
updates the page while you're looking at
it so you can visually verify that
that's right in the background positions
are going to work and not calls it cause
any visual change in the page and for
anyone who's started in a new
development environment you know that
your number one goal when you're just
getting started is to figure out what
you have to do two minute to reduce the
you know edit save compile
test cycle to minimize that to be as
quick and as short as possible and so
with sprites
you know we didn't have that situation
you had to figure out what - sprite
together you had to run it through some
spriting tool you had to download that
image to your server change the URL for
the background integrate these
background positions and reload the page
and if you got it wrong like repeating
that whole cycle would take you know 15
to 45 minutes whereas in sprite me like
you know I found I ran it on the Alexa
top 100 and for about 80 percent of the
pages I could take sprite based
recommendations out of the box and it
produced an optimal experience and for
the other 20% I could see that like it
was making the sprite image too big like
egregiously like 50k larger than the
background images had been before and
I'll talk about that in a minute but I
was able to easily and I'll just dive
into the demo easily like rearrange the
sprite me recommendations to produce a
better result so let me go ahead and run
sprite me again I'll actually here I'll
start on this page so you can go to the
front page if you it's a bookmarklet so
it's really easy to install you just
drag and drop this up here if you're an
IE have to right-click on it and say add
to favorites and now you can run it on
any page you go to
and so here's sprite me last night I
added making the window draggable and
and collapsible so that was cool I was
up til 2:00 I think Lindsay was up too
late later than that and it's got these
recommendations right so you can hover
over any of the background images in the
page and you can actually see what that
background image looks like like here's
the background image that's repeated
horizontally for this little header and
if I expand any of the images I can see
the Dom element or elements that use
that background image I can hover over
it and it actually highlights it in the
page and if I click on it it will run
Firebug Lite also a bookmarklet so it
runs in all browsers and will show me
that element and it will show me the CSS
so sure enough this one is using this
background image called logos 64 64
right so now let's see let's close that
alright so now what I can do so like
here's a sprite that was recommended by
sprite me it didn't include this one
because it's quite a bit larger than the
other ones and it and sprite me is
trying to avoid increasing the memory
footprint of the sprite but it's only 64
pixels wide so you know I can just drag
and drop it up there and modify the
sprite me recommendations and now to
actually create the sprite I just click
on make sprite so it's going off to a
web service and I'll talk about in a
second and now I have this new sprite at
image called sprite me one dot PNG you
can see it's got all the combined
rounded corners along with this
background image here and shows me the
resultant size in this case the file
size is still pretty small and the
memory footprint of such a small image
is going to be minimal and now if like I
expand this and look at the Dom elements
I can see all of the Dom elements using
this one if I click on the site header
again and look at it now what we see is
the background position has actually
been updated and if we look at the
background image URL it's using this new
one so sprite me has actually updated
the page in real time and so you can
you can like minimize sprite me and you
can visually check that the page is
looking the way that you want that
you've preserved the visual look and
feel I wanted to show another feature
here that occurred to me and I think
it's it's really cool so sprite we
decided to combine these horizontally
repeating repeat X background images
together and normally if you're
combining repeating images if they
repeat horizontally they have to be the
same width if they're repeating if they
repeat vertically they have to be the
same height and you can sprite them
together but in this case we see these
these horizontally repeating ones are
not the same width one is ten pixels
wide and one is five pixels wide so why
has Fright me actually suggested to
combine these together so Spri me just
has this simple concept of wiggle room
and at least common multiple capability
again it's that math rearing its ugly
head and it's decided that it can
without too much increase in the size of
the sprite image it can just double the
width of this smaller background image
and it will make the overall sprite 10
pixels wide so I can do that so like if
I look at this this gray one is 10
pixels wide this purple one is a reddish
one is 5 it's a little narrower but when
I make the sprite the result is the
purple area has been doubled in width so
now these can be spreaded together so
with you know a little image
manipulation there I can save another
HTTP request or a couple of them so now
let's go to eBay and look at that
I've got to email these guys and let
them know about sprite me so we see we
have a lot of opportunities for sprite a
and three different sprites were
suggested and so I can just go ahead and
so like you know here's this one I know
this one it's the background for the buy
button up there
I didn't say make sprite this one's
gonna take a little longer because
what's happening is the image request is
being sent to this web servers called
Cool Runnings and it's downloaded in all
of those background images from eBay
spraying them together and returning the
image just right me and so we can see we
cut 14 requests the size of the images
has increased by 7k that's certainly a
good trade-off but we actually hope to
start seeing with a few other changes
I'll talk about in a minute start seeing
reductions in overall image file size
and again you know we can see the
resulting sprite and if I expand the
list of dom elements there's that bye
and now it's using the new sprite add
background image and we can look at we
can look at the page and it hasn't
changed at all the visual look and feel
it's remained the same we can make some
other sprite so we can see that we
actually did reduce the size with some
of those other sprite at images so we
eliminated 18 HTTP requests and only had
a 2k increase in size so that's an
awesome trade-off that would make this
page a lot faster there's this little
button sherrier saving so I want to
issue two warnings that I didn't think
would come up but people have emailed me
about it so one is when you create the
sprite like I said it's using this web
service this off-site web service and
it's sending the URLs of your images and
that web service is trying to fetch them
so if for some reason the URL of your
image is something secret that you don't
want anyone else to know about it
then what you can do is you can download
and install a local version of the cool
servus it's open source and and get
around that issue that way and the other
thing is there's this share your savings
button and when you do that now if we go
and click on that there's this savings
page and so this is a place where I
wanted to gather some stats and have
people you know elevate the impact that
Sprite me is having on pages or
potentially issues that Sprite me is
having and so here you can see it took
my results and sent it up here with the
URL so if you're running this again on
some like secret website and you don't
want anyone to know the URL then don't
share your savings and publish it to the
rest of the world okay so let me go back
to the slides and wrap up so that's a
quick demo of Sprite me oh wait I want
to do one more thing
so you know when I start when I build
these you know browser plugins I always
start with the same progression path I
start building it as a bookmarklet
because that means it's go run in all
browsers and then if I run into
restrictions I might run it or something
that I want to automate to some degree
that a bookmarklet won't let me then I
go Firefox and I do a grease monkey
script and if I need to get past some
security restrictions then I build a
Firefox extension or add-on so in this
case I've been able to do all of this
with just about a thousand lines of
JavaScript code and it runs in all
browsers so I just left it as a
bookmarklet you know later I could
definitely see like integrating this
with some browser plugins but having it
as a bookmarklet means it runs in pretty
much all major browsers so here's Chrome
I can run sprite me sprite
ie
and safari there's a little it pretty
much works in not further a couple cases
like the eBay case where the background
positions aren't being computed quite
right so I still got work on that ok so
it works in all browsers that's cool
okay so what else so here's the savings
so we can see across this is the ran on
the Alexa top 100 and it's actually kind
of cool on average across these 100
sites or about 90 sites after I remove
all those porn sites there's about two
sprites so people are already using
sprites to a fair degree but even though
sprites are being used on average across
these sites there are nine HTTP requests
that could still be eliminated if the
background images were spriting sprite
of the way sprite me suggests now right
now
the overall result in terms of file size
is a 6k increase but I'll talk on the
next slide about some ideas for how to
make the overall file size and footprint
size smaller so one is you know we're
running this on just our personal web
hosted servers myself and Jared and so
for the launch you know that was just a
few days ago we had a little concern
about you know getting overloaded so
we're using Jared's using ping crush on
the sprite service image spriting
service and it has an optimal image
compression level but he actually backed
off on that and took a less optimal one
so you know once the you know Slashdot
effect is over we can crank that back up
and get some savings there but there's
also some other things we can do like
the biggest one jumping to the third
bullet is crossing the 255 color
boundary so right now sprite me doesn't
have any knowledge of the colors that
are being used how many and how they
overlap or disjoint from other images in
the page and so that's something right
now like I said about 80% of the time
sprite new suggestions are fine well
that's a case where
if you create a sprite that sprightly
suggests and it like really jumps in
sighs reload the page and go back and
look at and try to create a new sprite I
didn't show that but you can create a
new sprite and then you know start
grouping things any way you want into
that new sprite and so that's what I did
with some of these top 100 sites as I
found like there was a big jump in size
and by grouping just visually without
knowing anything about their images I
could just tell visually oh these are
mostly blue these are mostly orange let
me separate them into separate sprites
and try to avoid crossing that 255 color
boundary once you go across that the
image size is going to get bigger and
then there's a memory footprint issue
even though the size might be small if
you create an image that has a lot of
white space that's you know got large
dimensions the overall dimensions are
large but it has a lot of white space
the white space will be compressed
nicely with the image formats especially
PNG but when you read it into memory the
browser's at least ie and Firefox I
think convert it to like a bitmap format
so every pixel of the background image
is actually taking up memory and right
now there isn't any logic in the sprite
image creation service for how to
arrange or pack those images to reduce
the overall dimensions so that's
something to work on there's a lot of
logic behind you know this arcane
knowledge of how to create sprites
there's a lot of logic embedded but
there's still more to be added and if
you go to the project's website you'll
see bugs for all of these but for
example if you have an image that
repeats and you have another sprite
right now repeated images are never
combined with non repeating images but
if the repeating image for example if
your non repeating images are in a
vertical sprite and you have something
that repeats horizontally and the width
of that horizontally repeating sprite is
bigger than is wider than the vertical
sprite you could actually add it and
combine repeating images with non
repeating images in a single sprite
there's a couple other test cases here
I want it right now there are a lot of
options that are hard-coded into the
JavaScript like what the background
color should be these wiggle room
settings you might want to be more
aggressive or less aggressive the issue
is it's really hard to set options and
save those in a bookmarklet so I've got
a couple ideas of how to do that and
hope to add that soon and another
request is you might want to sprite some
background images from page one with
some background images from page two
because those pages users frequently go
to in the same session and right now
there's no concept of like running
sprite me across multiple pages so that
would be a nice feature that people have
asked for there are a couple of big ones
right now subscribe me only looks at CSS
background images and although we see
that you know on average we can get
about you know almost 10 HTTP requests
savings by far regular content or IMG
images are much more prevalent in
webpages today and there is a way that
you can sprite these IMG images but it
requires more changes to your markup so
I'm going to try to investigate how to
automate that and make it as easy as
possible for developers to adopt this
technique and it actually is a preferred
technique over CSS background images
because CSS background images aren't
displayed progressively so if you have a
large background image nothing is
displayed until the whole thing is
downloaded
whereas IMG images in the page browsers
do draw progressively there's a really
cool idea so like one of the real pain
points of sprites is maintenance and so
once you create the sprite if you like
want to replace one of the 32 icons in
there that's going to be difficult so
one idea Jared and I have is when you
create the sprite in the comments of the
PNG actually put the original background
images offsets upper left lower right so
that then and then we could write a
special sprite image editor that would
put boundaries on each of those separate
sub-images that were combined together
so you could easily swap one out without
affecting the layout and background
position and CSS of any of the other
images so we'll be thinking about that
another one is I really like this this
metaphor of updating pages in real time
and giving developers real-time feedback
and cutting down on that edit test edit
save test cycle and so another idea I
had we can do this with something like
image me where Google PageSpeed gives
you suggestions about how you could
optimize images and actually produces
those but it doesn't put them into the
page and those recommendations could
actually be swapped out with the images
in the page so you could see that you
know all of these optimizations that
page B does are lossless
but you could actually test it out and
visually confirm that the optimized
images were to your liking so I
mentioned Jared's name a couple times
this is a test a testimony to open
source like I found them on I think the
Yahoo exceptional performance mailing
list he had this writing service I
needed a web service I asked him to make
some changes he did it and we got this
whole thing working you know over email
and a couple Kahn calls so I want to
thank him for running this cool running
spriting service and Brian McQuaid who
works here at Google on PageSpeed he and
I had a couple conversations about this
way of spriting foreground images so I
want to thank him and they are the usual
URLs so that's it I've got time for a
few questions if anyone has any so eBay
and WordPress for that matter the images
that displays are very dynamic do you
think this sort of work that Sprite me
is doing is suitable as like a pipeline
stage at the end of their content
management or is that just the wrong way
to approach it for them yeah so the
question is kind of around web sites
where the images change a lot so you
think about like the front page of
YouTube why are there a lot of video
thumbnails that aren't sprite 'add and
actually maybe they are supported but
like that would be a case or like a new
site
like seeing that where the images are
you know a lot of the images are
changing every you know five minutes for
15 minutes so the first thing I would
say there is they're probably having a
lot of images change but they're
probably not background images typically
the background images have to do with
the adornment or you know wrapping
around the page the buttons and things
like that so those don't change that
much but if you did have cases where you
were using these very kind of dynamic
images as background images or if and
when spritely gets to the point where it
can sprite foreground images you know I
do think that we're going to see you
know back in plugins where people can
create sprites people that own websites
can create sprites on the fly so if
YouTube doesn't do it already they could
you know build some back-end that would
say on you know at this second of the
day we want to show these 12 video
thumbnails and it would actually rather
than put 12 separate HTTP image requests
to the page it would sprite those in
real time and just serve one image to
the page and I know sites were they've
already built that and it works really
well it's not easy and certainly I think
you know a year or two from now will
start seeing capabilities for that and
more popular frameworks so I think it
does make sense
any other questions all right thank you
very much look for it on web exponents
see you later
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>