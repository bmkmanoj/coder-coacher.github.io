<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How Cybercriminals Steal Money | Coder Coacher - Coaching Coders</title><meta content="How Cybercriminals Steal Money - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How Cybercriminals Steal Money</b></h2><h5 class="post__date">2008-06-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jC6Q1uCnbMo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Neil de swanee I'm a security
engineer here at Google and today I'm
going to be talking about how cyber
criminals steal money I'm going to be
talking specifically about how cyber
criminals use various types of web
application vulnerabilities to steal
money and I'm going to start with simple
examples and then I'll go to more
complicated examples in the course my
talk I may refer to many resources
presentations reports a book
certification courses etc links to those
are all going to be available at my site
at Neal de soie a calm and at the end of
the talk I'll also be giving out a
couple free copies of a security book
that I published but you'll have to
answer some trivia questions to get
those at the end of the talk before I go
ahead and get started the one additional
thing that I want to mention is that
given that this is a security talk if
you have any google specific questions
I'm going to ask you to hold them until
the end of the talk until we stop taping
and then you can ask those but if you
have general questions about the
presentation or some of the techniques
then I'd be happy to take those either
at the middle of in the middle of the
talk or at the end of the talk before or
before we start videotaping so let me go
ahead and get started
one of the major shifts that occurred
over the past three or four years is
that the profile of the attackers has
changed so up until about three or four
years ago when people used to write
worms and viruses they would typically
want to just make names for themselves
they would release their worms out there
it would cause lots of traffic some
servers would come down some patch would
get deployed and the game would be over
but the big shift that's occurred of the
past three or four years is that as more
and more commerce that started taking
place on the internet and as more
businesses have started making more
money from that commerce activity the
bad guys want to get their share and so
their end goal is money actual money and
so in many of the attacks that I'll talk
about in the examples that I'll present
I'll tell you how these bad guys are
working to get at money now the bad guys
may have a set of intermediate goals
that may help them get to that money and
so some of the
immediate goals for instance our data
theft they'll steal identity information
they'll steal credit card information
they may decide to conduct extortion so
they will launch a denial of service
attack against a website at say 8:30
a.m. to the point that it will take down
all that bank servers they will send in
a ransom note to the bank they will say
please pay us X thousands of dollars or
we're going to shut down your servers by
the way if you check your web server
logs at 8:30 you'll notice that all your
web servers were down so I'm not kidding
and so exertion is another goal another
goal to make money is to distribute
malware once the bad guys distribute
malware they can then do all kinds of
things with the compromised machines
assemble them into botnets and/or do
what they would pleased with those
botnets so there's a number of
intermediate goals to give you a
concrete example of such a organized
crime Network so I mentioned that the
attacker profile has shifted from
amateurs to professionals that want to
make money and in many cases those
professionals are very organized it is
their full-time job to attack sites the
the bad guys in some cases will hire
other people as mules to transfer money
from one place to the other
so it's an extensive organized network
we're not fighting against amateurs
anymore one example of such an organized
crime network is the Russian business
Network if you've heard of botnets like
storm which have compromised anywhere
from a million to five million machines
depending upon who you want to believe
the real number is probably closer to a
million million and a half they're
responsible for for these types of
botnets storm for instance is a
peer-to-peer base botnets that can be
used for denial of service key logging
pretty much whatever whatever one would
like the bad guys will rent out the
machines on those botnets they'll say
hey I have a botnet I have this many
machines I'll rent them to you for X
cents per day and you give me a binary
output whatever binary you give me on
those machines and farm them out another
thing that the Russian business Network
is alleged for is a piece of software
called malware alarm so malware alarm is
the
a piece of software which will pop up a
dialog box on your on your PC and it'll
say we think your computer is infected
by malware please click here to
disinfect of course if you click here to
disinfect it will infect your computer
as opposed to disinfected and so the
Russian business Network is a fairly
organized group for those of you that
are interested in learning more about
the Russian business Network come up to
me after the talk I can tell you some
fun stories so the goals of cyber
criminals have changed over the years to
give you a little bit of data about
various pseudo goals and intermediate
goals that the bad guys have this is a
graph that I pulled out from a web
hacking incidents database report that
was done by breach security they
basically looked at a whole bunch of
organizations over the course of 2007
and what types of attacks were reported
for all of 2007 and so you can see that
what the bad guys were mainly trying to
do is steal sensitive information like
credit card numbers identity information
once they steal that information they
can do various things with it they could
decide to use that sensitive information
for their own gains for instance if
they've stolen credit card numbers they
can then burn those credit card numbers
on to blank mag stripes of their own and
hand those out to mules
who they then tell to go to ATMs and try
to do cash advances and whatnot or use
the cards at various points of sale so
that's one thing that can do with
stealing sensitive information the other
thing that they could decide to do is to
just sell the information on the black
market
so the bad guys have a whole bunch of
IRC channels as well as other ways of
communicating with each other and
there's an underground economy there's a
market so on
the underground market a credit card
number might be worth say 10 dollars per
credit card number and they can get
bought and sold in in bulk so stealing
sensitive information is one thing that
the bad guys do the next highest
category of intermediate goals for the
bad guys that's listed on this slide is
defacement so that's simply somebody
changes what's on the front page of the
website to get their own say political
message across now I should mention that
this particular
this particular report queried a lot of
government agencies and so because the
number of government agencies quoted in
this report tends to be a little bit on
the high side we said defacement is
probably a little bit on the high side
with regards to other databases that
I've seen describing incidents the
next-highest
is planting malware so once the bad guys
say break into a website they will put
some JavaScript and/or ActiveX object
tags onto pages such that when good
users visit those pages visit these
legitimate sites they have a binary
download to the machine and they get
infected without even knowing it so
that's the next biggest category you can
imagine that as we if we were to look at
more commercial websites as opposed to
government websites the amount of
planting malware would increase in the
amount of defacement would decrease
simply because if a website is highly
trafficked and there's lots of users
going there the bad guy simply want to
take advantage of that traffic to deploy
their malware and then decide what to do
with the users after that point there's
one final point I want to make about
this graph and this graph is based on
incidents as a post of ulnar abilities
so for those of you that are familiar
with web application vulnerabilities you
may be aware that cross-site scripting
happens to be a major problem on the
Internet a lot of the vulnerabilities
reported are typically cross-site
scripting vulnerabilities and I'll chat
a little bit about some types of
cross-site types of attacks later in the
talk but the thing to keep in mind is
that those are vulnerabilities as
opposed to the actual incidents
this graph shows incident so what the
attackers are actually trying versus
what's a security researchers are trying
so this is the this slide summarizes
some things about the intermediate goals
on the part of the attacker so I've
given you some high-level information
about trends in this space I'll talk a
little bit more about trends but what
I'm going to do is start with a simple
concrete attack show you how it works
and then I'm going to show you some more
complicated attacks as well so I'm going
to talk about sequel injection first
actually let me just get a quick show of
hands how many of you are familiar with
sequel injection
okay good more than half the room which
is great so I'm going to go through this
example relatively quickly
basic idea is that a good user might
access website in a following way they
have a web browser they need to
authenticate themselves to a web server
they typically supply a username and
password the web server then uses that
username and password to allow the user
to log in of course but before allowing
the user to log in they need to figure
out if this user is indeed authentic so
the web server might make a query to a
database the database command that gets
constructed may get constructed based on
the user input so the user supplied a
username the web server needs to select
the corresponding password from the
database and see what the corresponding
password is for the username that was
entered of course the bad guy is not
going to enter your regular
run-of-the-mill username the bad guy is
instead going to enter a username like
quote semicolon drop table users
semicolon - - and enter something for
the password it really doesn't matter
what but the idea is that after this
input is entered and is substituted into
the query the quote will close off the
string literal the semicolon will close
off the first database command the rest
of the input will make up a second
database command these hyphens will
comment out the apostrophe that the web
application put in and in in old
databases this actually used to execute
just fine and would end up deleting all
the information about all the users in
the database in one shot so this would
be an example of a denial of service
attack that occurs based on sequel
injection now these types of attacks
have become so prevalent and so popular
and they're so well-known
there's even cute cartoons about them
I'll go ahead and let you read the
cartoon
so even high schools are vulnerable to
this and if you guys have ever seen the
movie war games in which Ferris P or
Matthew Broderick had to open up the and
get the password for the computer for
the high schools database he doesn't
even do that anymore he just needs to
have his name be quote Robert a Robert
quote drop table students etc so there's
all kinds of other innovative sequel
injection attacks that can be done so
I'll just give you one example for
instance when you board an airplane
right and I've been to a couple security
conferences where some of these attacks
have been demoed so when you go to the
gate and you give them your boarding
pass what do what do they do with your
boarding pass these days the boarding
pass is typically just a barcode and
they scan that barcode now that barcode
is getting translated into a set of
numbers and letters and most likely
getting fed to a SQL database so there's
no reason that you couldn't enter a
couple you know come up with a Borg bar
cord of your own come up with a boarding
pass of your own put in a quote
semicolon whatever put in all these
characters and construct a sequel
injected command to upgrade yourself
into a first-class or do worse so sequel
injection just isn't relevant to the web
it's relevant to many other types of
applications pretty much anything that
uses a database on the back end so you
might think oh this this should be
pretty easy right the the problem
occurred because there was a quote and a
semicolon and I should just fill
throughout those characters right that
seems like the easy way to deal with
this problem unfortunately that's not
enough so let me go ahead and give you
an example in which putting in a or
filtering out quotes and semicolons will
not solve your problem this is an
example of a imagine there's a web site
that allows you to buy pizzas online and
that web application may have a page
which allows you to view your order
history so that you could see all the
pizzas that you've ordered in the past
month or so and in this screen you might
imagine that there's a pulldown where I
could select the month so that I can
view all my pizzas for that month and
the HTML form corresponding to this form
my
as follows it it has basically a select
block in which there's a couple
different options each of the options
have a month and a corresponding value
from 1 to 12 and when the user hit
submit that value will get transmitted
to the server and will become say part
of a simple command that will retrieve
all of the pizzas that were ordered in
that month now of course the bad guy is
not going to enter a number from 1 to 12
what the bad guy is going to do is enter
something else the bad guy is going to
enter something like say 0 or 1 equals 1
so at the top this is what a normal SQL
query for getting the order history
might look like it might get the pizza
the toppings the quantities in the order
day from the orders table for the
particular user that's logged in and the
order month is the order month that
comes from the form on the other hand if
the bad guy types in 0 or 1 equals 1 for
the input what's going to happen is they
the order month equals 0 we'll evaluate
to nothing but the or 1 equals 1 will
evaluate to true for every single row
that the database evaluates this for and
so what will get returned is all of the
pizzas that were ordered by anybody and
so what the attacker is going to get is
a screen that will look like this where
it will contain the pizzas the toppings
etc for all of the pizzas that were ever
ordered from that website now for pizzas
this might not be such a big deal right
but imagine if this was a medical
database well now you have everybody's
medical records so that's pretty darn
bad now at the same time this is a talk
about how do bad guys steal money so
stealing information about pizzas may
not be that interesting but stealing
information about money might be much
more serious so you could imagine that
the attacker could instead type in a
query such as or type in input such as 0
+ 1 equals 0 Union select cardholder
number expiration month expiration year
from credit cards so what this does the
0 + 1 equals 0
will basically evaluate to nothing right
1 never equals 0 none of the order month
should be equal to 0 so that part of the
sequel
statement gives me nothing on the other
hand what happens is this the results
the nothing results get unioned with a
whole bunch of results that come from
the credit cards table now the key thing
here is that the columns cardholder
number expiration month
expiration year were chosen such that
they exactly match the data types of the
columns in the preceding order history
tables and that's why the sequel query
will work once the bad guy is able to do
this what the bad guy will get is a
result page that looks like this there
is a pizza order table that contains
people's names credit card numbers etc
and this is how the bad guy got all the
credit card numbers so this is pretty
darn bad note that in that query there
were no quotes there were no semicolons
there were no meta characters yet the
attack worked and so how do you solve
this kind of problem well you need to
use an approach based on whitelisting as
opposed to blacklisting when you try to
fill throughout certain characters like
quotes and semicolons it typically
doesn't work because you might forget
about some characters every database has
their own meta characters who knows the
next version of the database might
introduce some new meta characters and
so it it becomes a very hard game to
fight on top of that you might have some
users that might enter want to enter
valid data like Oh quote Brian
why shouldn't I allow O'Brien have a
quote in his name I want the user to
have a more personal connection with my
website why because of whatever
technology I used to build the website
should the person not be able to use
that quote and so the right way to deal
with these problems is to use an
approach based on whitelisting anytime
that you're taking input from user from
users on a website you want to constrain
and specify what is the exact set of
safe valid values that should be allowed
and so you can imagine that if I'm
accepting some kind of alphanumeric
string I might use a regular expression
like this or if I'm accepting a month I
might use a regular expression like 0-1
to 0-9 you could of course write much
much better regular expressions but the
idea here is not to you know show you
the regular sessions in particular but
to
to just basically make the point that
you should use regular expressions to
constrain the correct set of input to
what you would expect it to be and
basically give the user an error some
kind of error which doesn't reveal a lot
of information to the user if the input
doesn't match what you might expect once
you've come up with a set of regular
expressions that properly specify the
set of safe inputs you can in addition
to checking for them in your application
you could implement them in what's
called the Web Application Firewall so
for those of you that might be familiar
with apache you can write a whole bunch
of modules or use a whole bunch of
apache modules to extend the
functionality of the web server one of
the modules that you can use is a module
called
mod underscore security and it will let
you specify a whole bunch of rules for
all the arguments in your web
application so that is a tool that i'd
encourage you to take up take advantage
of finally I mentioned that we want to
allow user names like O'Brien and so the
way that you do that properly is you
take advantage of escaping functions
that your database provides you with so
the name of the escaping function will
differ depending upon what database
you're using but in this particular
example you just call escape with the
user input and in some databases like my
sequel it'll take the single quote turn
it into a double quote and the double
quote when the database receives that in
a sequel statement will will basically
mean to the database interpret this
double quote as a piece of data and not
as a piece of control and that will help
deal with the issue now there's a number
of other things that you can do as well
to prevent sequel injection
one thing that I would strongly
recommend is taking advantage of
prepared statements and bind variables
so in this approach what you do is for
all the queries that your application
might want to do you can come up with a
query template and prepare a statement
with that query template so in this
particular case we've taken the pizza
order query and we have provided that
information and what we've done is we've
put in question marks for the places in
the query where I expect data and only
data to be filled in
once the query template is specified you
can then have separate statements that
will fill in these placeholders
placeholder number 1 with the user ID
placeholder number 2 with the parameter
corresponding to the month and the idea
here is that when the database driver
executes this when the database looks at
this it will always interpret this
information as data it will not allow
the structure of the query to change and
so you could imagine that what you could
also do is create just one file in your
application or keep all of your queries
in separate places such that in your
regular code you should never really
have SQL and that will help you from a
code or dota village standpoint to make
sure that you don't have these types of
sequel injection errors so I highly
encourage the use of prepared statements
and bind variables to deal with sequel
injection so I talked a little bit about
mod security mod security is a type of a
web application firewall and so the idea
here is that without a wife when the
user makes a connection to your web
server the the connection is pretty much
directly to the web server there's
nothing that can really inter mediate
the users requests if you do use a web
that's why they're linked into the web
server or that sitting in front of the
web server the idea is that when the
user input comes in it can look for it
get basically run all the user input
through various regular expressions and
check for invalid types of input so
that's how how modsecurity works except
modsecurity is actually linked in the
web server as opposed to a separate box
there are also web application firewalls
that sit in front of a box but you know
the last thing you need is another
security appliance to manage and so so
while that is that is one option there
are others as well but can based on
software to give you an example another
example for how to use web application
firewalls to prevent some types of
attacks like sequel injection you can
imagine that there's going to be a whole
bunch of rules and there's a whole bunch
of public rules available so especially
if you're using Apache or you're using a
public
you know that the type of a website what
you could do is take advantage of rules
that are available and this particular
rule is optimized it's a whole bunch of
regular expressions compiled into one
but you can get the idea that it looks
for various parameters in the HTTP
request and looks for certain scary
train strings like table like like
objects like the word password etc and
so the Web Application Firewall can be
used to provide you defense-in-depth so
the idea is that you should absolutely
try to write your code as perfectly as
possible so that it doesn't have
volatize but you just never know and so
the Web Application Firewall can provide
defense-in-depth if there's some class
of attack that you didn't have in mind
when you build your application the web
app firewall might be able to help
protect you so what else can you do to
mitigate sequel injection well one thing
you can do is you can limit privileges
if your database doesn't need to change
data then there's no reason that the
user account that the web server is
logged into the database with or the web
app server should belong to the database
with there's no reason it should have
those right pelipper religions but as
you can imagine you know just reading
data can also be pretty bad
you can harden your database server
harden your host OS you know some some
databases like Microsoft sequel server
ship by default with a whole bunch of
functionality turned on so that I could
write sequel commands that could be used
to initiate outbound network connections
or emails and you definitely want to
shut all of that functionality off there
is a lot more to learn about sequel
injection for instance there's attacks
like second-order sequel injection where
the bad guy takes advantage of data
that's already been sanitized and is in
the database and you does a command to
re-inject that into a query and use it
to their advantage it's another type of
attack is a blind sequel injection you
notice than some of the attacks that I
demoed the bad guy needs to know a
little something about the structure of
the database and so blind sequel
injection can be is a technique that can
be used to reverse-engineer information
about the schema of the database if
you're interested more in that I suggest
chapter write in my book or the web
there's a lot of good information out
there so that is attack type number one
sequel injection that's one of the
you know simpler attacks I can sir any
questions about sequel injection before
I move on to the second type of attack
that I'm going to talk about cross-site
request forgery no question that sequel
injection okay
I'm gonna move on to talk about
cross-site request forgery so this is
another attack which can be leveraged by
the bad guys to steal dough and how is
the bad guy going to do that well I'm
going to show you by way of example
let's assume that we have two sites one
site called Bank comm which is a
legitimate site that has a online
banking application and let's assume
that a user logs in to that online
banking application and is authenticated
with a cookie so the idea is that the
user goes to the front page of Bank comm
provides a username and password once
the user is logged in with that username
and password
the the browser users browser is given a
cookie and on subsequent HTTP requests
the users browser supplies that cookie
to the work to the bank's web server
that's what's authenticates the user so
let's assume that's how bank comm works
now let's say that the user is bet
logged into bank comm and the user
happens to get lured to some evil site
called evil org the idea here is that a
user might receive an email and there
might be a link in it they might end up
clicking on it there's many many
different ways to lure the bad guy -
evil org but let's say that there is
this site called evil org and it has
some malicious web pages let's let's
look at how evil or it can effectively
steal money right out of the users bank
account so how this attack is going to
work is Alice our good guy or a good
girl in this case is going to go to bank
comm and request the login form the
login form is going to have a form for a
username and password the the user Alice
is going to fill out that form and
provide bank comm with the username and
password the user name and password gets
transmitted to bank comm let's say that
particular script is called
auth the user name happens to be victim
the password happens to be whatever and
bank comm checks that information in
their back-end database it checks out
and so bank comm sends Alice a cookie
here's your session ID you can give me
back this identifier too
authenticate yourself now you can
imagine that in a normal world in a good
world Alice might then once she's logged
into the bank's web server if you might
click on a link saying I want to view my
balance so what happens when Alice
clicks on the view balance link well a a
view balance script might get cold and
of course because this cookie came from
bank comm and Alice is making another
request to to bank comm the browser
provides Bank comm the cookie and so
bank comm says oh okay I know this is
Alice she just logged in let me go ahead
and give her her bank balance because
she's an authentic user so it says your
balance is $25,000 now of course let's
look at what happens when alice gets
lured to a evil org site in the middle
of this interaction so as before alice
makes a connection to bank comm she
requests the login script she
authenticates herself with a username
and password she's given a cookie now
what's going to happen at this point is
let's say that while she's logged into
bank comm in one window she opens up
another window and is reading her email
and happens to click on some link or
comes up on some drive-by download page
or whatever and is served a page by evil
org well what evil.org can do is serve
her a web page that has some HTML on it
so let's say that alice requests evil
dot HTML and on evil dot HTML is the
following tag and I've simplified this
from a technical standpoint just to make
the clarity of the explanation a little
bit better but you can use JavaScript or
whatever else but the idea is that
there's this image source tag that has a
URL that says go make a request to bank
comm and so it specifically says hey go
ahead and make this request to this pay
bill script at Bank comm to go ahead and
get this quote unquote image and by the
way supply these parameters the
parameters are the attackers address and
the amount in this case
$10,000 and so what
is Alice's trusty browser do well
Alice's browser wants to do a good job
for Alice and so it makes a request to
bank.com and it calls the pay bill
script as was requested it passes the
parameters as we requested and oh by the
way since the browser was already logged
into bank comm it sends the bank comm
cookie to Bank comm so bank comm gets
this request saying from Alice saying
that she should pay a bill - one two
three evil Street in the amount of
$10,000 and looks at the cookie the
cookie is completely legitimate so what
does bank comm do bank comm goes ahead
and issues the payment right now of
course if you're the attacker you want
to do a bunch of things to make sure
that Alice didn't see that so you open
up the way you do this is you send back
this kind of script in a zero size
iframe so that Alice didn't really see
anything the other thing is that from an
attacker standpoint this would generate
lots of forensic information right the
evil bad the evil guy doesn't want to go
ahead and give exactly his address to
the bank because at some point alice is
going to complain it's going to go back
to the bank say I didn't withdraw this
ten thousand dollars so this is where
hiring mules comes in so if you've ever
seen these websites where what the bad
guys do is they they'll put up a website
that looks like it's a legitimate
company the legitimate company will have
a bunch of job descriptions on it one of
the job descriptions will say oh we're
looking for an assistant or a work from
home job at some point and that will
have a whole bunch of qualifications
listed for this person like you know
they should know how to type at a
certain speed they should know how to
use the Internet and one of the
interesting job qualifications is that
they should have access to an internet
bank account or a mail address and so
what the bad guy does is hires a bunch
of mules and puts the Mules address here
and it gets the $10,000 sent to the mule
and then the mule is instructed as part
of their job to you know keep 10% of it
and then transfer the rest of it to the
attackers bank account so that's how the
bad guys turn cross-site request forgery
attacks web-based Ostara crunch forward
rate vulnerabilities into ways to steal
money did that make sense any questions
okay so that's how to use cross-site
request forgery to steal money how many
of you have heard of a tack called heard
of an attack called drive-by farming
okay very few of you okay how many of
you when you got your home router
changed your default username and
password why isn't it everybody so so
the issue here is that because of this
cross-site request forgery vulnerability
it's possible for the attackers to
completely take over all of the users
internet browsing simply because of the
fact that they didn't change that
password so most most home routers will
have a web-based interface which lets
you administer the router and what the
bad guys do is they know that
approximately 50% of home users use a
broadband router and they don't change
the default username and password so
what the bad guy can do is take
advantage of cross-site request forgery
to mount an attack against the home
router where what they do is they change
the user's DNS settings right so
basically I include this image source
and other type of JavaScript that will
make a request to the router at
192.168.0.1 or whatever predictable
addresses the attacker can try a whole
bunch of them and it will basically send
a message to the users router saying
please change the users DNS settings to
use the attackers DNS server once that's
done even if the user types in WW site
name com it will get resolved to the
attackers IP address and the attacker
can put up a website that looks exactly
the same once the user enters their
login credentials he just fishes those
out and so this slide has a whole bunch
of details about how you actually do
this but you could imagine that there's
other applications here as well so
farming is an application where I change
the users dns settings but there's other
applications I couldn't for instance
build a port scanner using this kind of
technique where if I'm trying to if I'm
trying to get at people behind corporate
corporate intranet sites I know they may
have say a whole bunch of ten dot
addresses so what I do is I have a whole
bunch of these tags I have a whole bunch
of ten dot or 192.168 internal IP
addresses and I I can basically you know
using handles like on error figure out
exactly when my successful requests did
get sent and did not get sent and so
there's a lot of applications here for
cross-site request forgery drive-by
farming is one it's some good work that
was done by SIDS damn a PhD student who
interned with me last year Markus
Jacobson and Zoo Ramzan we're also on
this paper so I've told you about
cross-site request forgery I've told you
how you can use it to steal bank
accounts how you can use it to take over
the users DNS I you can use it to to do
corporate espionage how do you stop it
well there's a variety of techniques
right earlier I said that the request
looks completely authentic to bank comm
and it does but for those of you that
are familiar with HTTP you know that
there is a refer header that gets sent
along with the browser and so one
question that you may have in your mind
is that kind of look at what the refer
is you can imagine that when I try to
view balance or pay bill and the user is
only on the bank's website the refer
will also be the bank's website but if
it's evil.org site that's sending back
evil on HTML and making a request to
bank comm the refer should in fact be
evil orgs evil dot HTML file so so it's
a good idea the problem is that lots of
users may use HTTP proxies for whatever
reason they may use anonymizing proxy so
you might want to browse the web
remotely and so refers don't always
necessarily get sent so if you're
looking at using refers to be a
completely fail-safe mechanism to deal
with the cross-site request forgery
you're not going to get very far on the
other hand there's some good work that's
come out of Professor John Mitchell's
research group at Stanford and I believe
there's similar research reports
elsewhere where what you could do is
look at all of your aggregate traffic on
a site and look at what percentage of
that traffic doesn't have the refer
fields is that normal is that not for
those requests that I am getting am I
getting lots of requests
to the pay bill script without with you
know without a refer field well that's a
bad sign and by the way if I do see some
pages that I don't expect well that
might be a sign that there is some kind
of cross that requests for degree going
on
so inspecting refer headers won't give
you a fail-safe defense but it may give
you some indication it may allow you to
detect that the problem is happening
even if it doesn't allow you to prevent
it you can attempt to use a web
application firewall but the request
pretty much looked legitimate to Bank
comm so it's going to look legitimate to
the Web Application Firewall now at the
same time I mentioned that you could
look at distributions of traffic and the
Web Application Firewall may help you do
that except for the fact that most
firewalls Web Application Firewall for
instance mod security doesn't support
that level of functionality so that's
another potential defense even better
defenses are validation via a user
provided secret so the idea here is that
whenever the user is going to do some
sensitive operation like paying a bill
what you want them to do is you might
want them to enter their password again
right the reason that the cross-site
request forgery attack worked was
because the bad guy was able to make a
write request and didn't have to know
any information about the user because
of the fact that the cookie
automatically got sent and automatically
authenticated the user on the other hand
if in the HTTP requests to pay the bill
you require that the user provides that
a password again then of course the hope
is that the attacker does not know the
users password and will not be able to
specify that secret in order to do the
transaction and of course if the
attacker does have the users password
they can do a whole bunch of other bad
things anyhow so asking the user to type
in their password or some other user
provided secret again a pin or whatever
is a good way to mitigate cross-site
request forgery attacks a fourth way
that you can deal with cross-site
request forgery is validation via an
action token so what you can do is take
some secret that should only be known to
the server combine it together with
things like the user's session ID and
use a cryptographic primitive like an H
Mac to generate some new piece of data
some new sig
that gets sent out with every page that
you serve the user and basically put
that in all forms and so the idea is
that the bad guy won't know what action
token to provide when doing the
sensitive operation and I've kind of
glossed through the details of how to do
that here but if you're inserting all
the details christoph curtin my
co-author wrote up great section on how
to do this in the cross site cross
domain attacks section of my book
chapter 10 and I'll be getting out some
free copies and for those of you at
Google we actually have that book
available internally if you're
interested in a copy so that's how you
can prevent and detect cross-site
request forgery attacks can take any
questions that process request forgery
before I move on to cross-site script
inclusion no clear good so the next
attack that I'm going to talk about is
cross-site script inclusion it's similar
to cross-site scripting except it takes
advantage of the fact that lots of web
applications are now using web 2.0 Ajax
type technology and so I'll tell you a
little bit about some of the downsides
and some of the new attacks that can
happen if you're not careful about how
you use Ajax objects like XML HTTP
requests and or if you use a framework
some kind of framework to automate the
development of your web 2.0 application
like X Ajax source Ajax or whatnot you
should have an idea of what the
limitations of that framework are so let
me go ahead and talk about cross-site
script inclusion as you all know when
you're building a web application you
can have script tags and you may put the
JavaScript directly in the HTML file but
you may also decide to factor out your
JavaScript into a separate file and then
you can use a script tag
follow followed by a source attribute to
include that tag and so this is called
static script inclusion and it allows
you to share code right between various
pages on your website it also allows you
to source JavaScript from other websites
so there's a lot of advantages that come
with that but it could be it could be
dangerous for instance if you decide to
source in a third-party JavaScript file
then they could do lots of bad things
show a page without you even knowing it
so that's static script inclusion
there's also a dynamic script inclusion
and maybe what I think I should do is
just go into to an example but you can
imagine that when I make a request to an
HTTP server that HTTP server in addition
to sending back HTML can also send back
JavaScript and it can send back
different JavaScript depending upon
what's in the request and that's an
example of dynamic script inclusion so
let me let me make things a bit more
concrete and then show you what can go
wrong so in an example where we have
static script inclusion you can have a
web page and I might be showing the user
their mail and I might like their page
within a mail to have a cool menu on it
and so I can go ahead and source in a
menu jeaious javascript file which will
go ahead and do all the right things and
render that menu and so static script
inclusion itself is not a bad thing so
long as you trust menu site com now
there's also dynamic script inclusion so
you can imagine I might be building a
banking website and I want the user
interface to have very low latency and I
don't want have to rerender the whole
page to say just show the user their
balance and so I might build a page like
this where there's some JavaScript on
view balance so what it can do is make a
request to the server to get the users
balance and then call a render data
function to render that in place without
having to reload the entire web page so
in this script the first line will go
ahead and create a new xmlhttprequest
object I'm assuming everyone here is
familiar with xhr and what you can do
then is you can set a handler so that
when this XML HP request is complete
this handler will get called what this
particular handler does is it just takes
the response that it gets from the
server the server will basically give
back a JavaScript function call and
it'll go ahead and call eval on it so
it'll go ahead and execute that function
call once the
state change handler is set this code
then makes a opens up a HTTP POST
request to this particular URL it says
go to Bank comm call this get data
script it gets back the data in JSON
format which is a popular way of giving
back attribute value pairs and it says
that oh when you're finished with with
getting this data bank back from Bank
comm you should go ahead and call render
data it's basically telling the server
that give me a render data call as your
as your result and then it'll go ahead
and send the HTTP request and of course
also in this code will probably be the
code of the function for render data
which will find the appropriate Dom
object in the web page in which to stick
the balance once it arrives back from
the server so this is what things look
like in this particular application and
in a normal world we wouldn't have
problems but of course we live in the
real world so we're going to have
problems so let me let me demonstrate
exactly what happens with regards to how
this code works and then show you what
can go wrong so Alice may decide to log
into Bank comm she goes and gets the
regular login script she gets back a
cookie
she might click view balance and when
she get you click view balance Bank comm
gives back the balance write HTML and
when Alice's browser gets that code back
it starts evaluating the javascript in
it so it goes ahead and makes the post
request that was in the JavaScript it
passes the appropriate callback
parameter and so bank comm gets the
request Bank comm gets the cookie this
is alice i'm going to go ahead and send
back her bank balance information except
that bank comm is a cool web 2.0
application now and so it sends back
this data in the form of a JavaScript
callback with some json that has a
activate value pair for the account
number and it actually be a value pair
for the balance and that data goes back
to the to the browser the browser says
oh okay i'm just going to go ahead and
evaluate ax with these json parameters
to render the data on the web page and
so things should work just fine i'm
yes we have an attacker in the loop what
the attacker is going to do is similar
to what happened with the cross-site
request forgery attack what's going to
happen here is the user might get lured
to evil org while logged into the bank
com website and the evil dot html' that
the attacker is going to send back is
going to be a little bit different in
this case in this case as in the
previous case the bank khamseh or
evil.org has studied bank coms website
and so it sends back some some
JavaScript which takes advantage of this
render data function so evil.org knows
that there's a render data function
being used and the evil site provides
its own implementation of a render data
function so this render data function
instead of renting the data on any kind
of web page will call another JavaScript
function which will send the arguments
passed to this function off to evil org
of course because this page comes from
evil.org domain it can go ahead and send
data back to that domain as per the same
origin policy so that's one part of the
script the other part of the script that
is an evil vanished email that gets sent
back is a basically a tag which says go
ahead and call that get data script on
the bank comm website and of course call
back the render data function so the
user's browser gets evil about HTML and
wants to faithfully render eval on HTML
for the user and makes the post request
to the website passes the appropriate
parameter of course because the user is
logged in to bank comm provides the
session ID in the cookie bank comm
successfully authenticates Alice bank
comm sends back the the render data
script and the JSON parameters
containing the account number and the
balance just as before except now what
happens is that because this is being
rendered on evil about HTML it goes
ahead and calls the render data function
in evil dot HTML which basically says
these parameters off to evil org and so
the attacker gets the account number and
gets the balance bad news and then the
attacker can do whatever the attacker
would like with this information so this
is a yet another example of cross domain
security problem and how the attacker
can in this case steal the account
number as well as find out what's in the
balance and then sell that information
or do whatever we would like so what
happened in cross-ice script inclusion
is the malicious website requested dhama
dynamic javascript the browser
authentication cookies would be sent
because the user is already logged into
bank comm the json fragment returned by
the server is accessible and it's going
to be sent back to the malicious site
and the bad guy simply read to find a
callback method to make this happen
so that's cross-site script inclusion so
at this point I hope I've this scared
everyone a little bit with all the
technical details of how things can go
wrong let me talk about a couple trends
so I'm going to cite a couple research
reports one is by Symantec and in
semantics latest internet security
threat report reported that fifty-eight
of all vulnerabilities in 2000 second
half of 2007 affected web applications
so the bad guys are shifting more and
more to attacking web applications as
opposed to say attacking open decom
vulnerabilities on your PC one other
interesting thing that was mentioned in
this semantic report is that the bad
guys can go ahead and look at large
popular sites that have vulnerabilities
and it sometimes makes sense for them to
put a lot of effort exploiting those
vulnerabilities on large traffic sites
instead of going for smaller sites so
that that's that's a particular trend
that was highlighted in the Symantec
report now about two weeks ago there
were also attacks for what the bad guys
did is they took advantage of of kind of
the opposite they attacked a whole bunch
of small websites so what they did is
they used various search engines to look
for a is servers Microsoft's internet
information servers
and look for sequel injection
vulnerabilities and applications that
would use that database so basically
they would get back a whole bunch of
search results and they know exactly
what servers to exploit so this can also
go the other way around where the bad
guys can attack lots of small sites very
quickly so on one hand large sites are
this is an if for large sites on the
other hand it's an issue for small sites
it's basically initial for every site
another statistic is that so Faust
noticed that 80% of sites hosting
malware are legitimate sites that have
been hacked so many of the small web
sites that I just mentioned would all
render content to their users that came
from the database so what the bad guys
did is they use technique like sequel
injection to inject malicious JavaScript
and/or ActiveX type objects that once
users would end up on those web pages
they would get infected by malware so
that speaks to this statistic so users
are not safe necessarily browsing
legitimate sites we basically need a lot
more AV technology on this front we need
web sites to get better about their
server-side security and statistics from
Symantec and so folks are good I'm
sometimes skeptical about statistics
that come from market research firms but
even Gartner says that today over 70% of
attacks are against a company's web site
or web applications on their site so
things are things could be a heck of a
lot better and given this knowledge and
how to prevent these kinds of attacks we
can all help make things a lot better to
show you one more graph let me show you
another graph that came from this web
mapping hacking incidence report it
basically shows that with regards to
actual incidents 12% of the attacks or
due to cross-site scripting 20% or due
to sequel injection
etc so actually I should mention one
more thing about this pie chart there's
an organization called the wasp open web
application security project and they
basically every year publish a top 10
web vulnerabilities so what breach
security did in this case was they took
those top 10 web web vulnerabilities
plotted them against
the incident and found that number one
the number one web vulnerability
cross-site scripting actually was only
12% of the attacks
whereas sequel injection while it was
number two actually accounted for more
incidents so there's more cross-site
scripting vulnerabilities but there's
more sequel injection incidents so let's
see I'm going to summarize by telling
you where you can learn more I'm going
to tell you about some courses
certification programs etc this list is
not comprehensive by any means you can
learn more about security pretty much at
every University a lot of the the good
universities in addition to having
things like cryptography courses are now
introducing system security courses so
CS 155 at Stanford w41 87 at Columbia
cs161 at Berkley there is a much more
comprehensive list I'll be at all via
rubens website so you can check that out
there's also for those of you that have
full time jobs and can't necessarily
afford to take things over the course of
a semester there's a advanced security
certification program at Stanford that
can be taken either online or on campus
over the course of a week where there's
three core courses three electives and
one of the interesting about it is in
addition to just providing lectures
about all these attacks and telling you
how to abstractly prevent them what what
we do and I have to end the interesting
full disclaimer mentioned that I helped
Stanford with this program basically
what we do is we put people in labs and
we have them actually construct the
attacks under some test websites that we
constructed and then write the actual
defenses so that is useful and we do
that on campus of course you can do that
in a lab where you're kind of isolated
for the real from the real internet and
you make sure that you don't end up
impacting real sites we also took all of
that all the software that we're running
in the lab and we put them on VMware
images so even if you need to take the
courses online you can go ahead and you
know benefit from those labs even if you
take courses online this is the URL so
let's see so there's a lot more
information this is the URL to go to
actually this should be
SCPD dot stanford.edu / advance security
the next course is coming up in July so
keep an eye out for it there's other
security certification programs
available there's a certification called
the CISSP the certified information
security professional it's much more
broad it focuses on various aspects of
security beyond just software security
focuses on physical security telecom
security etc there's also a new
certification that's come out from a
group called sands called the secure
software programmer assessment it's
basically both of these are actual
multiple-choice tests so you'll learn a
lot by preparing for them from there's
also lots of books there's my book
foundations of security what every
programmer needs to know I'll give out
some copies I'll do some trivia
questions in just a second there's also
a lot of other good books I'd recommend
Ross Anderson security engineering it's
actually available for free online just
enter this into Google or your favorite
search engine I also highly recommend
Gary macros building secure software
book and Vega and masters secure
programming cookbook books let's see
there's also a website that we helped
make available called
code.google.com/speed EU if you need to
teach security course you can just
download materials off of this site and
you know there are slides of programming
assignments so if you're responsible for
teaching security to other folks this is
a resource that you could take away for
free there's also free slides
corresponding to every chapter in my
book at learning security comm / ntk and
let's see so I think that concludes all
the information that I wanted to tell
you that the key point here is that
software security is every engineers
problem it's not as if there's some
group of magical security engineers that
are going to take care of securing your
application after it gets developed it
really needs to be every engineers every
engineers job and I mentioned a various
set of resources in addition to my
website my eldest my comm you can also
go to learn security comm my contact
information is there so I hope that you
guys have learned at least one thing
knew I'd be happy to take any questions
at this point
okay thanks for timing
Oh</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>