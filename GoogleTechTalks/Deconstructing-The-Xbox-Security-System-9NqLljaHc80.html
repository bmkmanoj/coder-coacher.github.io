<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Deconstructing The Xbox Security System | Coder Coacher - Coaching Coders</title><meta content="Deconstructing The Xbox Security System - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Deconstructing The Xbox Security System</b></h2><h5 class="post__date">2007-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9NqLljaHc80" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you yeah I'm Michael style I found
it and I'm maintaining the x-box linux
project and in this function I
participated in lots of the hacking that
was going on not in all of it because we
started a bit late but I know quite a
bit of what has been done on that as you
know 24 slides a second that will be a
flicker free picture so I will have many
many slides and I'm going to talk really
fast because I have lots of information
because personally there's nothing more
I hate than talks that don't have enough
information let's start whoa okay just
kidding
anyway anyways let's start with a
quotation of Bruce Schneier he read a
paper I wrote about the Xbox security
system and his comment on it was lots of
kindergarten security mistakes so a
question is is the Xbox security really
that bad is it that uninteresting is it
that badly badly done or well I I can
tell you it is interesting but does it
really includes so many mistakes so many
obvious mistakes therefore we are going
to look at it from Microsoft's point of
view we will be constructing the
security system now and then you can ask
yourselves whether these mistakes that
have been made by Microsoft and have
they been obvious would you have noticed
if they are obvious then Shania is right
and yeah lots of kindergarten security
mistakes and if they are not obvious
then maybe it's not that trivial to
construct a security system so let's
start
now we are Microsoft we want to create a
gaming console a video game console how
do we do that now imagine it's 1999 and
within 2 years of time we have to
release a gaming console so what do we
do if we want it cheap and we want it
fast
we take PC hardware we take Windows 2000
software we all have this already we
take the DirectX libraries and put it in
a small enclosure so that it looks nicer
this is fast this is cheap the problem
is that marketing has to make sure that
the press doesn't see it as a small PC
but sees it as a real gaming console
because people associate all bad things
with PCs like long startup times or
instability so what came out of this was
some selaron processor well not too much
ram a geforce it even has a hard disk
DVD drive fast ethernet USB and as an
operating system it's based on the
Windows 2000 count so it really is a PC
or in other words today you could say
the Xbox is also a Mac because a Mac is
a PC but what actually makes a PC is it
if you have an Intel CPU even have an
x86 compatible CPU is it already a PC if
you have VGA style Hardware not
necessarily what about all these
technologies that do they define what is
a PC certainly not because some hardware
SGI hardware also has all these
technologies but the point is the Xbox
also has the old 1992 interrupt
controller the old 1982 timer and even
IBM's a20 gate hack all these legacy
components can be found in the Xbox so
if it is a PC
shouldn't it be trivial to run anything
on it like Linux we want to prevent that
we as in we are Microsoft because with a
security system we we don't want people
to run Linux on it because the Xbox's
are sold at last and money is made with
the game so people shouldn't buy them
and run Linux on it and use them in a
cluster or something
homebrew software is a bad thing
trademark wise copied games are a very
bad thing and also unlicensed games
because money is made with the games and
Microsoft gets a fair share of these so
we can address all these four threats
against our strategy with the Xbox with
a single security system this the idea
of the security system is obviously to
run only authentic code on this so we
have to choose which code runs on it and
every code that is not authorized by us
may not run on the Xbox so execution may
only be passed from one part of trusted
code to the next part of trusted code
this is called the chain of trust
which reminds us of what the industry
has been after for quite a while and
what which is still interesting right
now which is trusted computing so the
Xbox in a way implements these trusted
computing principles and takes away
control from the user and leaves all
control to actually Microsoft because
they only they have the keys to
authorise software to run on it so how
this this chain of trust work at system
startup we must make sure that the
Windows kernel which is stored in ROM
for faster boot up times will is
authentic it must be checked whether
this is the authentic kernel and then
the Windows kernel in turn must make
sure that the game is authentic and
there is another check game can be from
hard disk or from deep from DVD how can
we implement this first one from startup
right on startup only authentic code may
run let us look at the Xbox Hardware now
I have I happen to have one year
we want to have a closer look at it I'll
pass it around this one is a bit broke
and all the chips are missing I turn it
in for warranty but they wouldn't accept
it
anyway that's for those who can see it
right now you have it on the slide that
this is a standard PC you have a CPU
there which is the Intel Celeron 7 33
megahertz you have an nvidia Northbridge
with integrated GPU that's exactly what
they sold us the nforce 1 chipset as
well they have a South Bridge there
there's RAM 64 Meg's of it and there is
flash because computers tend to boot off
some rom which is typically flash this
is how x86 systems start at the bottom
of memory there's RAM and at the top
there is flash memory and an x86 start
from this address this is the uppermost
address of RAM - 16 bytes and this must
reside in flash or somewhere to make the
Machine go
typically this looks a little like this
sets up the CPU and jumps to some other
location to the beginning of flash for
example but a hacker could easily just
modify the flash or put their own codes
there and then just do anything with the
system what they want for example run a
hacked version of the original Windows
kernel that will allow copied games for
example so how would a hacker do this
let's look at this
the main board again one thing is they
could just replace the flash chip it's
it shipped there people could just put a
socket in and have their own flash chip
there they could also override the flash
chip because this is a an interesting
thing it is better to put empty flash
chips onto the board then put them once
in the factory from an external flash
chip and flash the internal chip that's
a lot cheaper than having them
pre-programmed and put them in therefore
we must have some override functionality
so that it can boot
another bus so we need this bus for
manufacturing purposes and of course we
must make sure later that nobody else
could use this functionality and the
third possibility is of course to over
write to reprogram the flash chip
because it is writable so flash might
not be such a good idea we just cannot
start directly from flash what
possibilities do we have the possibility
one is we don't start from flash we put
a wrong chip in there ROM is expensive
but yeah it's it buys us that it cannot
be reprogrammed but it can still be
replaced that overwrite functionality is
also not necessary because it is
pre-programmed we don't need that
functionality but it can still be
replaced so not a good idea either
another possibility is to put the ROM
chip inside some other chip or flash or
well it's let's say it's wrong put it in
some other chip and then this is very
effective because nobody can replace it
anymore unless they want to replace the
whole CPU but there's no point in that
in a cheap gaming console that will be
more expensive than the whole gaming
console but also it will be expensive
for us in manufacturing because we
cannot use off-the-shelf intel celeron
processors but have what we need custom
processors also not a good idea but
there is a compromise between these two
ideas which is put a small ROM chip
somewhere
we'll talk later where maybe not into
the CPU but in a lot cheaper chip this
small ROM chip is it's quite cheap to
put in something if it's just like a K
or so of memory and this ROM chip will
done then verify the contents of flash
and past execution to flash if
everything is ok this is a fact both
effective and cheap now this is what
this looks like we have some secret rom
integrated into some component which is
half a K of memory at the very top of
the address space it overlays the flash
region so when the CPU starts it will
start in in our secret ROM in north
it can then integrate in verify the
integrity of Flash and if it's okay past
execution to there now the question is
where to put it the CPU is expensive
because the CPU is the most expensive
part in system and custom ones that's
not a good idea
Southbridge would be great the
Southbridge is the cheapest chip but
it's still fast data will travel over
bus because the CPU has through to read
the instructions from the ROM in the
Southbridge but this bus is really
really fast it's hypertransport and
we're talking about 2001 nobody is able
to sniff data this fast
well almost nobody and let we just put
other other ideas in there so that even
if it gets sniffed nobody can do
anything with it just let's be on the
safe side okay but the problem with
flash verification is checking and
having a signature in RSA signature with
public key cryptography just doesn't
work in 512 bytes you cannot fit RSA in
there just checking a hash that would
fit in there but if we just had a hash
then the kernel could never change so as
long as we manufacture the same South
bridges with the same secret ROM we
would never be able to update the kernel
and later revisions of the Xbox so what
we do is we introduce yet another link
in the chain of trust we have a second
stage bootloader the 2bl which gets
hashed by the secret ROM the secret ROM
only needs a hash so that su BL can not
change but the two BL does nothing more
than verify the kernel with an RSA
signature okay
so what does the secret ROM have to do
it has to verify the to be alpha
integrity and it has to pass control to
the to be LF it's okay what also would
be a good idea to decrypt to be L so if
to be allistic encrypted and also the
kernel is encrypted then any attacker
would see nothing but cipher text in the
flesh so they have no place to start
hacking but for decrypting we have to
initialize RAM because the decrypted
contents have to be stored somewhere and
we really have to initialize RAM it
doesn't work when we start because
Microsoft to chose to ship even bad RAM
chips which couldn't do the spec and
which just couldn't do the 200 megahertz
so they get clocked down to up to ithe
down to I think 118 megahertz so some
games don't run that well on every Xbox
but these chips are cheap so we have to
do a stress test and see how fast Ram
goes but then again it won't fit into
512 bytes if we have to do this ramen is
Asian what we can do is put all
non-security critical code outside of
the secret ROM and put it in flash but
of course this cannot be x86 code
because if we call some x86 code in
flash an attacker could just overwrite
that with their own code and never
return them therefore if we cannot put
x86 code there that's one of Microsoft's
greatest ideas was use a virtual machine
and I actually think that is a really
good idea on the right you can see how
this interpreter looks it's not all of
it
it has instructions like memory like
memory accesses Hardware accesses and
some control flow instructions so you
cannot exit this virtual machine so an
attacker could English initialize the
hardware differently but that's all a
hacker could do if we do our job right
the bytecode is called the X codes I
refer to them as the X codes in the
future so memory initialization could
look like this in X codes we set the
memory speed to 200 megahertz then write
something to memory read it back from
memory if it's okay then go to end
otherwise try 5 megahertz less and so on
that's what that can do
now if a hacker has access to the
virtual machine or understands the
virtual machine but maybe doesn't have
the whole secret code and the decryption
and the keys yet an attacker might still
already benefit from that there for me
we must make sure that an attacker
cannot exploit the virtual machine
somehow if they write X codes because
they are not verified for integrity
there's just no space in these 512 bytes
to verify them as well and of course
they have to be flexible for future
versions of the X Box
so when people hack the X Box
interpreter there are several possible
attacks that we have to think about and
that we have to prevent actively when
writing the virtual machine that's one
of the attacks the virtual and the
secret ROM is at the very top of memory
so that's this address we could just use
the X codes to read the secret drum all
of the secret ROM including the keys and
send them to some low speed bus like the
LPC bus or even the I Square C bus which
is on the Xbox we must prevent that and
that is easy by just masking the high
addresses and this is the assembly code
that does that it just clears the upper
four bits if we do a memory region which
is okay for hard we initialize a ssin we
don't have to read from there a second
attack would be to turn off the secret
ROM there is a functionality in the Xbox
to turn off the secret ROM because as
soon as the Windows kernel is running
the secret ROM must be turned off
because if there's some vulnerability in
a game then the code exploited the shell
code that would run could read all of
the secret ROM and there there go our
keys but the X codes may not turn off
the secret ROM otherwise secret ROM will
just disappear and execution would fall
down into flash
so we have to check for this cow as well
we compared just this simple poker
command and we just do nothing in this
case okay that was the virtual machine
now let's talk about the encryption we
don't have that much much space we just
have half a K of instructions so there
is a possibility to combine hashing and
and decryption let's look at stream
ciphers we have a secret key this secret
key gets expanded to a seed this seed
will will generate a sequence of
pseudo-random numbers and these get XOR
with the stream of ciphertext so that we
have the resulting plaintext again now
one great thing you can do about this is
you can feed back the decrypted data
into the seed so every time so in case
one of these bytes or one of the
ciphertext bytes changes also the result
in plaintext changes the feedback makes
the seed change and all the future
pseudo-random numbers will also change
so that we decrypted the text will
change as well so all we have to do to
get a hash is look at the last few bytes
as soon as something has changed in
there the last few bytes will also have
changed so we can decrypt and hash in
one by just having that feedback
functionality okay so with just perhaps
100 bytes of code we can do these two
things there's one more thing that we
really have to do which is the panic
code what happens if the flash check
fails we have to panic we cannot just
turn off the Xbox which boot would be
the safest thing we have to keep it
turned on and blink some LEDs to tell
the user that something is wrong the CPU
has to be off but also the secret ROM
has to be off otherwise if the CPU is
off but power is on someone could attach
some sniffer device and pretend they are
as a CPU and read the secret ROM so we
have to disable
from and hold the CPU but that is a big
problem that's the same problem as
crashing a car while the motor is off
because if you turn off the CPU and then
turn off the secret drum well who would
do that if you first turn off the secret
drum and then the CPU where would that
code come from so there is a possibility
and that was a really really great idea
of Microsoft I live I love I really love
this idea
we drive against the top of memory this
is the very top of memory these are the
last few instructions of the secret ROM
they prepare turning off the secret ROM
and the last instruction this out
instruction actually does the turn off
and after this instruction it will drive
against the upper limit of memory and
this will leads to an exception a double
fault and the CPU will be halted I found
that a really really great hack now this
is the summary of how the whole security
system in this first step of
verification works the interpreter
interprets the initialization ex codes
which are in flash then the to be L gets
decrypted and hashed it gets jumped to
and to BL and decrypts and checks with
the curl and jumps there this is what
the code looks like you're not supposed
to be able to read that but you should
have an impression how much code it is
and it's not all that much code it would
fit on one piece of on one sheet of
paper and there it should be too hard to
eliminate all box of that so the X code
interpreter is pretty large we have some
CPU setup code this is the crypt
decryption code and of course at the end
of this there's the panic code in some
more panic support code in the middle
okay this is what Microsoft ought now we
are hackers
speaking of hackers I don't know whether
you're familiar with that whole hacker
culture maybe that's not what hacker
culture really is but many people think
let me show you a few pictures of
typical hackers that was at the meeting
in Berlin as you can see most of them
have degrees in computer science or so
it's the pretty fine people three more
people that I don't have a picture of
his special advisor I have no idea who
he is but he David great contributions
okay so let's start with bonnie bonnie
is the great xbox hacker because he
started it all he did the first
extracting of the secret code so first
he looked at the Xbox he saw there was
flash ROM so he dumped the flash ROM he
put it on his website we got a call from
Microsoft he put it down in act 2 he did
an analysis on the flash that he had of
course he knew that the Xbox or any x86
CPU would start at the top of memory -
16 bytes he looked there and what was
there there should be nothing because
the upper 512 bytes of flesh are unused
because secret ROM that he cannot see
will be mapped there but what he saw was
this
someone made a mistake there well it
wasn't that bad because it turned out
that this is not the actual code this
was an old version of the code but
somehow they linked it there bunny found
out that this was not the real code he
put his own code there and the Xbox just
behaved the same so it was an old
version of the secret ROM it had
different decryption it had different
keys the xov interpreter was slightly
different and it cannot be used to
decrypt anything so he moved along and
tried to find where that secret code was
because he was sure that there must be
some secret code somewhere and he built
this small device himself and sniffed
hypertransport bunny can do that yeah
and he had the secret ROM so he had the
actual virtual machine the actual office
see for decryption the panty code he had
all of that but how does this help us
because the second-stage boot loader is
hash so we cannot just change the second
second-stage boot loader what can we do
so let's look again how this decryption
and hashing works maybe there is some
attack there this is how it's supposed
to work with the rc5 cipher now the
problem is Microsoft used the rc4 cipher
without the feedback so without the
feedback if you change one byte of
cipher text the resulting plaintext bite
will change yes but there is no feedback
because so there the key stream will not
change from there on and the last few
bytes will just remain the same rc4 can
not be used as a hash but they try to
they check for the last few bytes
whether they are authentic the reason
why they did it was as I think they used
rc4 in the beginning rc4 behaves like
this a RC v RC file does behave like
this and the old version of the secret
ROM that we had from flash worked like
this and did it correctly but they
updated it to RC for for some reason and
yeah they broke it
so there was no hash we had the rc4 key
it isn't the secret ROM we had no hash
so we can just encrypt our own stuff put
it in there let it decrypt the to be a
check will not fail it will just succeed
and our code will run so great people
did that that was before the expert
Linux project actually started and made
more chips much apps with just
replacement ROM chips which had
different software on them hack software
that could run copies of games the first
generation of mod chips disabled the
onboard ROM by shortening something and
added just a rom parallel to the onboard
flash chip then people found out that
when disabling the onboard ROM the Xbox
would default to booting of an external
wrong on the LPC bus so everything they
did was pretending that the onboard room
is empty by grounding a single data line
it's an equal boot of these nine wires
and you can easily attach a mothership
there so after half a year when the Xbox
came on the markets there were already
more chips with nine wires which were
really really easy to fit but for Linux
that wasn't that great for Linux we had
to find something else because we just
cannot ship the rc4 key with our build
tools we would have to re-encrypt our
bootloader and that's just not a good
idea to ship that key with our tools so
we had to find a better way and if we
look at the secret ROM again perhaps
there are some other attacks possible
let's look at the panic code again I
told you I love this but the question is
does it really work does it really
double fault at that location there's
also what vice are wondered well the
earth is a sphere
yeah memory is also a sphere
so what happens if you go over the upper
boundary of memory you might start at
the beginning of memory again it's just
the thirty second address line that is
unconnected so what if memory really
starts at zero again there vizor that
hacker that I know nothing about thought
that it might roll over to zero so he
wanted to put code at zero and let that
check fail to make the system panic how
do we put code at zero that's that's RAM
we cannot put Koda we can put code in
flash we cannot put code in RAM yes we
can
the X codes can write into memory and
the X codes are not verified we can just
add two extra X codes which right is
this jump instruction at zero so it
would look like this we have these two
extra instructions which definitely
reside in memory so does it work yes it
works it does not crash it just executes
that that's a big big backdoor but why
why did this happen and that's the
greatest story a short history lesson on
why this happened let's look at old
ancient processors let's look at x 2 x
x86 style processes they start from the
top of memory as I've said and there are
other processes which start from the
bottom of memory ROM must be at zero but
the x86 the original x86 had a great
feature so that it could boot both off
the top or off the bottom depending on
how you wanted to configure your system
because if you had a memory setup like
this on an x86 system then the
unconnected region there would read back
ffff
which is not so it would roll around to
zero and execute your ROM residing at
zero and this is something that's still
a Pentium 3 does in the Pentium 3
selarÃ³n but why did Microsoft not know
about this there are data sheets that
say that
the point is Xbox prototypes had AMD
CPUs and they switched until the very
last minute and AMD CPUs don't have this
behavior and they did not check again so
MDC puce do halt on this transition well
there might be another hack
it's just 512 bytes of code but there
are several vulnerabilities in there we
looked at this instruction which is
supposed to turn off the secret ROM so
code would fall down into flash the
interpreter would be shut off and
execution would go on a flash this is
the code again it compares this single
value but if we look at the data sheet
again we see that there are several
reserved bits and these bits don't do
anything so we can just poke any value
up there these 8 bits we can use
anything and they get do not get caught
by this compare so yeah we can do that
in order to exploit this we have to
prepare landing zone underneath the
secret ROM with lots of knobs and a jump
at the end and thus will it mean
yeah okay so if this code gets executed
and hits that single instruction that
turns off the secret ROM the secret ROM
goes away execution falls down lands in
the knobs and execute our own code and
that's not the only attack this is
another way to put it
they didn't catch it okay now Microsoft
has to react these hacks have been
published and Microsoft solved our c4 is
now hashes they finally understood it so
they reacted now the question is how did
they react
how did Microsoft react to finding out
that our c4 cannot be used as a hash a
complete code audit B fix the hash C
wait for more attacks or D do nothing
now I'm going to ask you I'll ask the
audience who who would do a oh that's
what many people perhaps a third the fix
the hash that's more people almost half
C wait for more attacks one do-nothing
one okay so they fix the hash and I'm
not saying that this was a good idea
I'll tell you later what would have been
the right thing to do okay Microsoft saw
that rc4 is no hash rc5 is not an option
I don't know for what reason maybe
licensing maybe some other reason so
they added another hash but they didn't
have any memory left just a few bytes
they needed a tiny hash they needed
while many encryption algorithms can be
used as hashes so what they needed was a
tiny encryption algorithm and what do
you do if you are looking for a tiny
encryption algorithm
into helps you'll get tea tea the tiny
encryption algorithms I have no proof
that it really happened like this but it
seems somewhat obvious they fix the
secret rom they kept our c4 for
decryption they added a T hash British
which is really really tiny they updated
the rc4 key because it's trivial to
update it while they knew that bonnie
could just dump everything again but if
there's a hash they are secure they
trashed thousands of Southbridge tips
that's why nvidia had a really really
bad quarter - of 2002 they had to throw
away lots of these chips with the
integrated rom and make new ones
obviously it was Microsoft blames that
on NVIDIA and they had to throw them
away it was their loss not nitrous to us
ok let's hack them again yeah
yeah that was in the South Bridge chip
that nvidia did nvidia did the South
Bridge in the North Bridge actually it
was AMD technology Nvidia licensed that
so why was it my group sorry why was it
invidious I don't get it either I don't
know why Nvidia had to had to trash the
chips it was video we have two losses
so that's hacking it hack it again it
should be trivial to extract that ROM
again and find out whether there are
some other attacks possible we could
have let Bonnie do it but we prefer to
do it ourselves now now that's the Xbox
Linux project that's where we started
there is an easier way to hack all this
and there is some legacy functionality
and x86 based CPUs that you might have
heard of that's really really old and
bad legacy stuff that nobody would need
anymore today but it breaks lots of
things
it broke many boot loaders the Intel max
also have it and into a boot loaders a20
the a20 gate I'm not sure whether you're
familiar with it there for a short
history lesson parts to the idat that's
mid-1970s the idat had 64 kilobytes of
RAM the ID 86 had to be somewhat
compatible to that it also has 16-bit
registers for addresses of pointers
could also only be 16 bits although it
had a whole Meg of RAM so they had
segments of 64 kilobytes each they could
have done it this way by just having 16
segments but they chose to have a
segment register which was 16 bits wide
so segments could actually overlap so at
the beginning of memory if you are at
segment 0 you'd have this segment and 16
bits 16 every 16 bytes a new segment
starts there's a one interesting side
effect about this that at the top of
memory this is actually the last segment
that you can use but is not the
uppermost segment number that there is
if you go once
beyond that then memory well that
segment we'll go into nothing and let's
even look at the last one yeah but it
doesn't go into nothing of course it
wraps around as always we've learned
that already so if you have this segment
then you will get 16 bytes of the top of
memory and 64 K minus 16 bytes of the
bottom of memory again because if you
add this and you leave away the 20th
address bit you'll just have zero again
but when the 286 came out on the right
you can see the same calculation with
the 286 that is different the 286 is
incompatible because the coup 286 could
address 16 megabytes of memory so that
didn't have the wherefore wraparound you
could really address that memory and
micros use that with a high memory in
ms-dos the 286 was incompatible it
doesn't wrap around so IBM added a hack
because there was a software that relied
on this there was software who wanted to
have a segment that was half way up and
half way down Intel did not implement
this hack IBM did because Intel didn't
notice it but IBM did when they
constructed the IBM 80 they add an
option to their systems to have the xx
address but always be 0 and that looks
like this the 286 is connected to Ram
with its address bits and the 286
keyboard controller happened to be
happen to have a spare pin left so they
connected that spare pin with a xx
address line to pull it down to 0 if
Cole wanted to do that so the pvat
booted off with with that hack enabled
and software which wanted to use more
than 1 megabyte had to disable I had to
enable the a20 gate yeah this emulates
the wraparound effectively all addresses
are ended with this value
ah someone is seeing where this is going
all x86 CPUs still have this
functionality including the Pentium 3
seller and even the Itanium hazard so
what we did was connect that line which
is now a pin of the CPU to ground all
addresses get ended with this value so
the CPU does not start anymore at this
address but at this address but where is
this address where would it start from
normally it starts from the top minus 16
now it's just intense particular on and
now it starts from somewhere there but
what is there in address space mirrors
are flash
it is mirrored over 16 megabytes so
that's exactly the same spot where
originally and x86 would put off that's
exactly that spot in flash that we can
now boot off so all we have to do is put
around out there we connected a standard
old much it for an old Xbox before the
fix put our code in there and wrote code
that dumped it to some slower bus and we
had the new secret ROM ok we saw there
was a new T hash there was a new key ok
but there was also the T hash digging
around in some scientific publications
this means that each T key has three
other equivalent keys in particular it
is easy to construct collisions for T
when used in davidsmeier hashing mode so
T cannot be used as a hash either it is
insecure and look at who wrote that who
co-authored that and it was in 1996 that
was there was six years before Microsoft
used T so they should have read the
documentation or should have read
something so we could change some jump
to jump to our code let's look at the
other hacks we verified whether they
still work them missed hack when the
secret ROM went away then flash would be
there on the old Xbox they fix that now
if secret ROM goes away there is nothing
below
nothing will be mapped there and how
whatever way we use to turn off the
secret ROM we will never be running
again the system will just crash
so they fix that they didn't know about
our hacks they fixed that themselves
they found that themselves and there is
still a visor vulnerability the visor
backdoor with the wraparound we also
checked that and it turned out that
Mycroft acted too quickly they didn't
know about the visor heck they didn't
know that there was a problem if they
had waited for two months or they had
checked their security system once again
they would have found out yeah so just
fixing it wasn't the solution waiting or
a code audit that would have been the
solution so we had no needs to hack T we
just could use the old visor web
wraparound tricks so that wraparound
trick would run on all X boxes and we
could have a single wrong that ran on
all machines so Microsoft never trashed
Southbridge chips again and video was
happy about that and even the latest
revision well the latest written the
revision now has a real ROM chip but
yeah it's integrated into some chip they
did some things right now but the LPC
override is still there because the
Southbridge is still the same and the
Southbridge has this override
functionality in it they never try South
bridges again so we can still connect
more chips even on the latest Xbox yeah
that was the hardware tax now I'm
continuing with the non Hardware attacks
there were also some for those people
who didn't want to open their Xboxes
there is another check from Windows to
the game where you have hacked the first
part in there now let's look at the
second check yeah it looks pretty secure
it's RSA public key cryptography there's
nothing to do there but games have data
and data data might not be so secure
there may be some vulnerabilities there
and it is not checked and sometimes it
cannot check so we checked standard
buffer exploring methods so what do
games load typically from DVD they load
graphics audio video all that stuff but
we can attack that because we cannot
alter them we cannot cannot burn a DVD
again that will be accepted by the xbox
so that's not a possibility save games
is a good idea because safe games cannot
be after assigned or anything because
they are written by that very software
and they are stored on hard disk or even
USB storage all the memory costs on the
Xbox are USB USB devices USB storage
devices so GG lead from Switzerland
tried all the games he had or all the
games he could get for rent
alphabetically and what's the first game
on the alphabet double-oh-seven and whoa
ss7 had a vulnerability in the safe game
handler so everything that someone had
to do was DD a hacked game on a USB
stick copying is not enough you had to
it's it's its own file system yeah so as
she was
I was from that game and I know you guys
are oh oh oh and the Oni was run losing
a function called st. st. string oh you
have to introduce me too bad I know some
people who would like to meet him
okay so so everything that had to be
done was too bad we didn't have the
source code or else we would also have
the puzzle have had the possibility to
now yeah someone has just has to load
the sacrum of some use B stick and
that's it and that's not the only game
there are lots of games and there are
several more that we haven't published
lots of vulnerabilities so you can just
run Linux yeah
yes double-oh-seven is your food disc
you can run Linux off double-oh-seven by
just loading a safe game site you can
call the safe game run Linux this
double-oh-seven is a nice boot loader
but how and the game is of no use other
words no offense to your friend but the
game sucks but how is that possible we
should be in user mode it's just just a
date a user mode of data exploit but all
games are in kernel mode and we have
full control but why did they do column
mode that makes little sense to me
possibly speed or something but there is
a problem using double-oh-seven as a
bootloader so you need the game you have
to buy it you cannot rent it you have to
run the game every time you have to walk
you have to look at that video at the
beginning but there is application on
the hard disk this is the Xbox dashboard
you can manage your safe games you can
listen to music change your settings
this thing is always stored in the hard
disk and it also loads some data and we
could change the data by connecting the
hottest to a PC or something so what it
does it loads all your files there are
3d meshes there are funds that it loads
but it's checksums
of course audio 3d meshes
it does not check fonts and there is a
vulnerability in the Fontainebleau
naturally so what Stefan esse was the
guy who found that German security
expert and Jeff Peters actually
implemented this hack then so when the
dashboard loads its loads our hacked
fonts the dashboard crashes our code
runs our code can then load the
dashboard again and patch it in memory
so that some keys are replaced that our
public keys and there's a weekend sign
and some menu entries are perhaps
changed and we can run the dashboard
again I have a video here that shows or
not too loud this is next box moving up
with the mechazords game in the DVD tray
the games starting off right now showing
small video showing some animations
games loading right now we have already
attached a USB stick and copied the safe
game onto the hard disk
getting to loading you'll see the title
screen now we say you know the safe game
install Linux is the name of the safe
game and now the exploit insight that
may connect us all safe game has has
started and that is now our code running
actually it's Microsoft update code with
that game the ships an update
application which updates the dashboard
on hard disk and we we are in charge of
the system we load that this update
application patched it to copy our data
on it and now we're getting an update
with Linux takes a minute
it's finished it will you check the DVD
and reboot now that's the rule of
animation of the Xbox again now we'll
start off hard disk we have how disk is
now spinning up when Michael when you
see Microsoft this means the RSA check
was ok
now the despot has just crashed is
reloaded again and now you have if you
have 20 more seconds when the music
stops then you can see and how to boot
Linux
here here was there was another menu
entry that said xbox live which is their
online service and replace we replaced
that one because using linux and xbox
live at the same time makes no sense
because if you're on Xbox Live they can
verify what you have on your hard disk
anyway so xbox live in limits will never
match yeah so we just installed Linux
yeah so it's like you obviously had to
have
that embattled that Apache installer
also copied a small Linux image a really
tiny Linux image it was just some I
think five megabytes Linux image or
something after the sea it was stored
inside the safety Xbox a things are
actually just a folder with anything you
could put anything there and we just use
the NT kernel to file copy the data on
that and are also can use the NT kernel
to the other day at all but people can
of course install are really an
experiment if there's another Linux it
will prefer the full installation so
here's a better screenshot of that again
so what people had to do was just do to
use statistics love the safe game the
hack Falls will be installed and every
time you turn on the Xbox the heck
dashboard will run and Linux will work
the interesting thing about that is that
there was a chain of many many mistakes
and any point of these could have made
it impossible or at or at least very
very hard for us to hack it they used
USB storage for memory cards that's that
was easy that made everything so easy
games running kernel mode if I hadn't
done that it would have been not so easy
maybe even impossible to do that there
was a game exploit yeah you can never
avoid that other than I don't know there
was no fun checksum there was also a
font exploit all these contributed to
that this work so so many bugs and of
course if there hadn't been the
dashboard bug there would have been
another one in the dashboard with a
music playlists not just the font one
then Microsoft fixed it if it fixed it
again and Microsoft did it the same way
as they always fix things or si had
fixed things in the past they ship a
fixed version of the dashboard they even
shipped it over Xbox Live and new Xbox
versions had that dashboard but what we
could do was just downgrade to the old
dashboard which would still work if you
have a copy of that then Mitra's plaque
listed that our dashboard in their new
xbox kernels with newer hardware
but there was another executable on hard
disk that had the same exploit we just
copied that one back that wasn't
blacklisted
then they blacklisted it then we used
yet another executable - update dot XP
which comes with every xbox live game
DVD because the first Xbox is shipped
without Xbox Live and then then they had
this this update and so that was the
same executable with the same font bug
and there were plenty of games out there
and it wasn't blacklisted and they
cannot like this this one because all
games have to work on all X boxes so the
hackers have one so still today on any
Xbox you can find you can permanently
mark them to run anything and still dual
boot into games and you don't have to
open it if you open it that's also fine
then you can replace the hard disk this
this it looks like this when you modify
more than one Xbox at a time this is
something we I did for a hotel in Munich
they have one Xbox for every room with
Linux on it to show video content
they're cheap 150 bucks ok let me
summarize let me look at the clock okay
I don't have too much time I'll run
through this and the 17 classes of
mistakes they have made 8 design
mistakes 6 implementation mistakes and 3
policy mistakes let me just summarize
them again and I want to remind you that
these are classes or mistakes not
individual mistakes several mistakes
have been made more than once and other
mistakes are a combination or what they
did have was a combination of multiple
mistakes design mistakes there's no such
thing as more secure or less secure
either secure is effective or it isn't
and there is no sensible compromise you
do want to spend money on security to
avoid losses if you don't have an
effective security system in system
programming of flash that was because of
money made the system insecure cheap and
faulty ROM chips made the system
insecure because of the extra in its
virtual machine that they have the
secret ROM in Southbridge
if they had put it into the cpu we
wouldn't have been
able to sniff it they didn't ever never
did a second Southbridge update that
would have made it secure afterwards
also don't trade securely for speed
because something like 10% faster
doesn't make much sense if it is less
secure because there is no such thing as
less secure it's just insecure and 10%
that's not worth it if it's 200% yes but
in this case that all games run in
kernel mode it's it's not worth it
also be aware of a combination of
weaknesses don't think of one single
weakness whether it can be exploited
think of combinations that's what they
didn't do any extra barriers might not
make sense better fix each individual
component as well for example who would
have thought that with a double-oh-seven
game and the dashboard exploit or some
other game in the Deaf world exploit you
could effectively end with user mode and
all that effectively run Linux also
never underestimate the resources of
hackers there are commercial hackers and
they have money they want to spend money
on making more chips but they are not
that good
those people are hobbyists that have
access to hardware from work or from
university are they even better for
example Bunny at MIT he had lots of
resources there and never think that it
would be too expensive or too much work
to hack something I know someone who
knows someone who did that who had the
idea of putting it in the Southbridge so
it went over the hyper transport bus and
I know that Mike really thought nobody
would be able to sniff that that's just
too expensive to sniff so think about
barriers and obstacles never make
something harder for hackers you must
make it impossible for hackers because
time is not an issue or there are just
so many monkeys typing Shakespeare
obstacles never slow down anything and
if you have many many obstacles there
you might think that's a psychological
thing that your security system is
stronger but it isn't
instead use this
use these resources into real barriers
safe games must be signed it made no
sense because anyone can sign safe games
with the games can the hard disk is
password protected but you can hot-swap
it into a PC while both systems are
running so it didn't make a difference
the secret ROM was hidden but hiding it
wasn't the point the hash would have
been the point and the games are not
readable in a PC drive also made little
sense because you also could hot-swap
the DVD drive then don't use one
security system against all attackers
because hackers with different goals
world unite there were four different
hacker groups with four different
interests the Linux people the hacking
the the piracy people the homebrew
people and you must find out who your
enemies are
and you have to handle them separately
otherwise either directly or indirectly
they will work together in our case the
Linux the homebrew and the copy guys
worked together indirectly by just
publishing their results and working on
what others had already done security
but security does not work that's
obvious but Microsoft did it and of
course something like RSA or sha works
if used correctly hiding the secret ROM
was obscurity encrypting flash contents
hide DVD contents that's all obscurity
and it didn't have any effect and but
they thought it would make it more
secure it didn't when you are dealing
with hardware with software you can roll
out fixes every day but not with
hardware with hardware it's expensive to
roll our fixes so you don't want to do
quick fixes those fixes may be flawed
more holes tend to be found soon after
one hole is found so either wait or over
the complete system because you have new
knowledge maybe you find more and look
what the others do with a secret ROM
hash function they should have waited
and also with the dashboard they should
have thought a bit before fixing then
there were several implementation
mistakes do read data sheets Microsoft
didn't do that they didn't want to do
that don't hug around assume anything
and especially be careful with
components with legacy functionality
like a 20 gate that is documented it
isn't the data sheets and it's legacy
stuff and also the wraparound if it's
also legacy stuff but it is well
documented now this sounds also obvious
but that's mistakes they have made who
do it standard literature for crypto
that Shanaya for operating system that's
Tannenbaum Wikipedia is a good start not
the article but the references that you
have there okay Wikipedia wasn't
available back then marci for the hash
was a bad idea they should have read all
the data that is out there just as well
with T get experienced professionals
they must have a background in security
systems I know that some people from the
vet web TV TV web TV team of Microsoft
worked on the Xbox and they had no
security background they did a set-top
box it didn't have a security system and
also don't get students there are maybe
good students but you want to get pros
with men with lots of experience and the
implementation of a secret ROM was just
so bad this one not throw people also
make sure that your code catches all
cases because if it doesn't then it will
have the exact opposite effect by giving
hints to attackers and this happens
twice the secret ROM turn off check
which was just too specific which gave
us the hint where to look we didn't know
what this this instruction meant we
understood it by by seeing that code and
hashing everything but the fonz
gives us a clue where to look also look
for leftovers look we have to look at
the final product from the perspective
of a hacker and hex dump and disassemble
the final system if you look at the old
version of the secret ROM which is still
linked into the flash image and also
have a final test on your hardware when
final components are in place because
even every small change can break
everything including security the AMD 2
Intel's which was once such thing and
the switch from our C 5 to our C 4 they
couldn't just leave everything else in
place they should have changed
everything significantly there's three
more policy mistakes one thing is you
have to keep your source code
or safe so that nobody can see it
because the source code leaked of the
xbox it leaked after the hex had been
done but still you want to make sure
that the source code doesn't leak so you
have to find engineers that you can
trust but this does not mean that you
don't want as many people as possible
have a look at your source code it's
important that many people have a look
at the source code because obviously it
wasn't many people that looked at the
security code of the xbox you just have
to find people you can trust
yeah we QA are many many more parts and
you have to talk to your enemy because
there's no such thing as an enemy then
not talking to terrorists is stupid
these enemies the Xbox people or the
homebrew people they want they have
their goals you have their you have your
goals and compromises are a good thing
there would have been the possibility
for Microsoft enter hackers to find good
compromises but Microsoft was unwilling
to talk so the worst case happened they
didn't talk about dollars-seven it
didn't talk about the font exploit ok so
this was a show summer of the the Xbox
security system there's lots of more to
talk about and there is one paper that
has more details in there which is
available on the internet on Xbox
- Linux org or well do your way thank
you
I don't know whether we have time for
questions but anyway start answering I
use an invoice of Microsoft and he tried
to convince the managers to invite me
there but he had no luck but I have been
a similar talk before and it's on Ruby
video already so much soft has the
chance to look at that yeah so what
about the Xbox 360
I can only refer you to a talk that will
be given between December 27th and 30th
I don't know the exact date at the Chaos
Communication Congress in Berlin by a
friend of mine and I guess there are
some new things about that the current
official state is that there is nothing
to do there yet because the 360 security
isn't very very good it's out for a year
now and there hasn't been a major hack
yet you can run coffee games okay that
was one flaw in the security system but
you cannot have kind of run Linux or
anything they implemented a hypervisor
encrypted memory encrypted per box
encrypted flash chips that's a pretty
good architecture</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>