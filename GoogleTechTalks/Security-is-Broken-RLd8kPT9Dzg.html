<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Security is Broken | Coder Coacher - Coaching Coders</title><meta content="Security is Broken - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Security is Broken</b></h2><h5 class="post__date">2007-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RLd8kPT9Dzg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so you already know I'm Rick Pharaoh
all the security 1984 and really after
all these years it's been getting rather
depressing because you keep seeing the
same problems over and over again also I
kept writing about this stuff and
finally I said well I should do more
than just right people don't seem to be
paying enough attention so I came up
with this talk hey I've given this talk
for Bay Lisa at Hughes annex in Boston
at Apple last Friday they really need it
and I thought that this would be a good
audience now I originally plan on this
being two hours of lots of audience
participation then I was told this is
supposed to be a one-hour talk all right
so we have leveraged 90 minutes so there
can be some print some audience for
participation especially after i get
about past the halfway point you'll
notice that there's places for you to
intervene and share your experience and
that's important because i want to get
something out of this talk as well so
obviously security is broken right this
is not a mystery we really know this is
true the really bad thing is that we
have accepted that security is broken
and that's what's unacceptable to me we
just hope so well so what two-thirds of
all desktops are owned right there you
have some kind of malware installed on
it hundreds of thousands of bots out
their monthly security patches are just
the norm it's not anything special at
all right you expect that on a certain
Tuesday in the month Microsoft is
putting out security patches no surprise
applications rely on level on layers of
software now I'm going to get into this
much more deeply deeply in the next
couple of slides but i think the
scariest thing of all is that web
browsers by design expect to execute
remote code right so you browse the web
you visit some site and what do you get
who knows who looks and that's by design
and that's really scary we have
insecurities and death take a current OS
nice examples freebsd about three
million lines of code just in the kernel
linux over five million lines of code
just
the colonel okay so those are nice
examples there have also third-party
device drivers so that the people who
are writing the code don't have
necessarily total control over what goes
in their OS not so much of linux in vs
DS but with other vendors like Apple and
Microsoft multiple api's as well krunal
privilege is the kernel can do
everything it all talk about right
probably everyone here knows this but I
want to really pound this point home
that Hardware can be our friend and it
doesn't necessarily work as our friend
Colonel privileges get extended via
services that realm of privileges
anything that rises local system under
windows things that run as root under
linux this is an extension of colonel
privileges so now we have taken our
kernel which is already way too big and
we've made it even bigger many times
bigger than the 325 million lines of
code if all we have is 325 million lines
of code and Colonel at three to six
defects per thousand lines of code which
is a reasonable amount we're talking
tens of thousands of defects do you
think we'll ever find them all ha
so perhaps things will get better over
time much work has been done to improve
security over the over the last several
years we have Microsoft's trusted
computing initiative right launched I
think in February of 2000 very exciting
I think the the way they celebrated that
is I got denial-of-service their name
servers are all on the same subnet and
so they are knocked off the internet for
about 30 hours nice way to start code
reviews for buffer overflows have become
very very popular now has code gotten
better there's a paper that was
presented at using its security just
last month excuse me two months ago now
time flies by Andy Osmond and scheckter
that show that openbsd has gotten better
over time that they actually have been
able to remove a fair number of flies
from the system and they're seeing a
slight decline and the number of new
vulnerabilities failed so yeah it's
possible let's pick something that's
really popular something that we've been
looking at for many many years buffer
overflows how many years of buffer
overflow has been around first discussed
inside the NSA in 1974 first practical
example 1988 the internet worm woke up a
lot of people so it wasn't until
nineteen ninety-six this became really
popular when Aleph one better known
today's Elias levy of bug track wrote a
very nice paper called AB smashing the
stack for fun and profit really explain
this in details that a freshman student
in college could understand how could he
do this he was teaching freshman
computer science at Berkeley at the time
okay there have been other explanations
of this just hadn't worked he succeeded
then we started seeing the buffer
overflows so how do you get rid of this
well first thing you can do is very very
simple tools tools like grip
right look for string copy look forget s
and will you find those things remove
them so that's the first thing you do I
don't know how much microsoft paid for
their tool and you can be sure it wasn't
grep next software that checks for stat
corruption this was invented well more
or less invented by crisp inchoate in
his friends in 1998 and it was called
stat card stack art is we use a canary
you put a canary on the stack canary is
just a secret value it's known by the
when you run the cysts when you run a
program the function call preamble as
part of its work to set up a function
call puts the canary below the return
address on the stack so anything that
tries a buffer overflow replace the
return address will theoretically
overwrite the canary now from that
Microsoft came up with some similar but
not the same scheme of course see they
have to you know it's hard to license
open source so other people can't use it
so they had to come up with a different
scheme but that's been broken as well
then there's the use of no execs tax
let's do it in hardware now this has
been a problem for Intel and AMD until
recently because their designs didn't
allow you to make a stack both writable
and not executable if it was writable is
executable as well so that's an issue
okay but the idea of a no exec stack is
if you're not executing code off the
stack why do you need execute
permissions there so people can't just
load in code executes on the stack
because now you have hardware protection
that's going to prevent you from
executing it that sounds pretty good
right newer Intel processors and E
processors spark processors since the
early 90s have been able to do this
so have things gotten better well at
first glance maybe CDE how many people
know what CVE is okay this is like
defense contractor based in Virginia
miter and they've had a vulnerability
database for a number of years and it's
like if you go to but if you go to say
security focus if you use snort they'll
have a reference to see ve for the very
vulnerable ax t they're checking for
that's one way of thinking of it so they
keep track of vulnerabilities in the
last five years the first four of those
five years buffer overflows are number
one they have fallen to number four top
three are web scripting errors
cross-site scripting well maybe that's
more of a browser error SQL injection in
PHP include here's what it looks like so
you course you can't see the legends
back here or probably on TV this is
cross-site scripting here is SQL
injection here's our buffer overflows
and here's PHP file include which seems
to be the lamest thing I've ever seen in
my life but it's look at its creeped
crept up there quite a bit now what you
I really want you to pay attention to is
look at this line I mean if he sort of
drew like oh my god if I drew like a
line to a year this sort of looks like
this doesn't it keep in mind that they
ended 2006 which is what it says here in
September so we not even finished a year
yet the reality no improvement despite
all the work that's been done to get rid
of buffer overflows in very common
software we're still seeing the same
number of vulnerabilities approximately
in the last five years now the top new
vulnerabilities are all related to web
scripts and programmer we have scripting
and programming errors right misleading
as there's many more web scripts and of
course cross-site scripting is
that's really not a web scripting error
but it that it applies to web browsers
so has had things gotten any better in
the last five years I would say not
people are certainly more aware of
security but things not have not gotten
better so maybe we should blame dennis
ritchie after all he invented the C
programming language that had things
like stream copy and unbounded a raise I
I guess I don't see anyone saying yeah
yeah let's let's hang him from the
nearest oak tree no we don't want to do
that dennis is really a nice guy it's
just that he's a genius he happened to
write a programming language so he and
his buddies could make their operating
system which they'd written in a few
days portable ok how many people do this
not many so why do we give everybody see
it's my favorite macro assembler ok it's
very handy it's very fast and it's
really much more easy to sublime dennis
ritchie because look there's other
problems all these languages have had
problems including Java which is
designed with a security in mind ok has
it worked maybe we should go back to the
beginning mainframes it's not an amazing
some people in this room probably
weren't even born and the problems we're
dealing with today were being created
how sad is that ok mainframes there are
these amazing machines filled up whole
rooms you know you could probably put
about 20 megabytes on a dishwasher size
dis pack very exciting great ericeira
candling system so i love them now in
the early days mainframes were single
user machines when I got to college in
1968 that's how the mainframes there
worked they didn't have these new
attachments as it were you submitted
your jobs as a punch card deck it got
written to mag tape and submit it as a
batch job to the computer my god it was
amazing now about this time people
started inventing
I'm sharing systems that's what CTS S
stands for computer time sharing system
whoo Wow multics 1965 okay what were
they trying to do they had this huge
resource and rather than run one program
at a time they wanted to hell out
multiple youth people to use these
multi-million dollar machines more with
the appearance of simultaneous sanity so
the big issue here became users still an
issue of computers today right we didn't
have users who wouldn't have security
problems okay so the idea here is if
we're going to share computers we have
to protect these users from one
another's we can't have a user's process
crashing the entire machine or affecting
other people's processes we also want to
give some kind of protection between
online storage if I can't read your
files unless you let me so those are the
two main goals they were looking at in
the 60s when they are inventing time
sharing now to due process protection
they're going to use hardware and two
different schemes showed up one segments
in the GE 635 okay now segments were
more like memory map files than segments
that you might be familiar with in Intel
processors right it wasn't just a file
offset it was like a set of what we
consider pages today in the IBM 7090 far
they used what we're more familiar with
which is if you know about virtual
memory systems you know that they work
on a page base that is whatever the page
sizes say it's 4k or could be four
megabytes when you run your process a
certain number of pages are allocated to
your process there are processes allowed
to read memory only in those pages if it
tries to read memory outside of those
pages what happens what's that famous
Hermes just actually two of them
segfault segmentation violation okay and
that's hardware hardware actually says
oh look at that
try to access memory outside of one of
its pages end of program stops running
okay this is done in hardware there is
one exception to who gets page faults
the way our computers are design or CPAs
are designed they have something called
rings Intel chips have four rings there
anything that has any kind of security
has at least two rings now we do have
some embedded systems that don't have
rings right ring 0 means you are like
it's like Lord of the Rings you have
total control One Ring that wools them
all so ring 0 can read or write anywhere
memory no restrictions remember where I
talked about that insecurity in depth if
you can get inside a ring 0 you can do
anything now what about the users the
users needed file protection and what
we've got today really descends from
multics the idea of access control list
now you might say multics whoo multics
where do we see multics well for multics
who came unix came linux and a very sort
of lame form of an access control list
is user group other read write execute
pretty much what you see everywhere
right windows actually uses access
control lists now the idea behind an
access control list is that every object
is represented by a file so we can treat
everything like a fight there's one of
the big things that multics came up with
it's a device now it's it we can see it
as a file and it's a network soxhlet
well doesn't quite work does it ok users
or groups may be granted or denied
various types of access so this is
really the model in acls we're going to
protect users from one another you can
say I like John he can write my files I
don't like Bob he can't even read my
files access control lists give you nice
granularity this later became
multi-level secure systems a child of
the department of defense which will
have more to say about later also
mandatory
access controls search for truly secure
computer and you'll find tens of
thousands of hits and they all refer to
some quote I wasn't able to establish
about a computer being buried in
concrete okay unplugged is good too so
this is really the goal we're going to
have a computer that we don't have to
worry about it at all security is going
to be absolute and so far the only way
we've managed to do this is to take the
computer and very under concrete with no
power it's certainly no wireless you
don't see a network cable coming out of
that cement block either so let's look
at some solutions MLS capabilities micro
micro kernels VMs reference monitors and
finally separation of privileges now the
point of this up to now I've just been
talking about why we have sort of the
pickle we're in how time sharing is
really not a model for computing today
think about it they were trying to share
a mainframe that field though half this
room i'm standing in required the kind
of air corps air handling systems that
you require now for a room this size
full of racks so that's changed but
these machines were used by multiple
people how many people use most
computers today one okay computers have
become single user machines how about a
web server how many users use that
machine now in the sensors many requests
coming in but from the point of view of
the process model there is one owner of
that process so that's also a single
user machine so how does Matt how to
access control lists help us there okay
we now are using single user ships
machines we are not doing time sharing
anymore so these are supposed solutions
to get us away from doing time sharing
like opera
Systems multi-level secure systems like
AT&amp;amp;T mls son hbm IBM HP IBM all have mls
based systems who do they sell them to
defense contractors Department of
Defense people will have secure secure
clock secure in classified systems what
does that mean multiple levels of
security from secure but unclassified up
to top secret there's also categories it
sliced through here right how many you
how many of us actually use a model
that's anywhere like that we don't if
it's a model that's based on paper
security classification systems by the
military and the government we don't use
systems like this this is a very poor
match selinux this is a very popular
solution in some ways for dork or five
Red Hat Enterprise sent Oso I'll have
this built-in it comes with it very
complex how many people here have looked
at a policy inside of selinux got a few
hands yeah well that's how I feel like
to I don't want to put my hand up like
this because somebody might ask me a
question okay is just amazing if you can
use the cam policy say you could say
okay control my web server and it will
control your web server using an access
control list type of system okay it
doesn't really solve the problem I would
like to solve and what the problem
trying to solve will become clear as it
go along with this how about a farmer
this is Crispin Collins in munich's was
purchased by novell now it's part of
Susa and it's much easier to use I've
watched the hem debating with the NSA
guys about as he linux no app armor a
farmers has usability features which
selinux severely lacks ok which of
course yes he let his guy say well we're
much more secure they're using the same
hooks into the kernel if you can't use
it is it more secure well maybe it's
that cement block we were talking about
so these are strong solutions that do
not protect a user from her own
web browser it is not going to protect
the web server from attacks within the
data that's known but known to that web
server anything the web server has a
memory that access control list is he
Linux is not going to protect you how
about capabilities capabilities were
invented just about the same time that
people are coming up of access control
lists now the difference between and
access control lists in a capability is
basically that rather than we're going
to take an object and put a list of who
can see it who can't or who can write to
it who can we're going to say that the
program itself has capabilities like the
program can read files in a cert
directory right to one file and say open
a network socket and a good example of
this is eros there's a I'll have a
there's a list of references there's the
arrows operating system this is a
capabilities based operating system done
by jonathan shapiro his graduate work
graduate studies work and it's a good
nice example of capabilities unusable
because they never added networking
makes it more secure though then we have
micro kernels micro kernels are supposed
to be minimalist operating systems that
just perform in the kernel a very
minimal set of operations in fact what
are these operations these are those
operations that you have to do in ring 0
memory management thread management
inter-process communication everything
else gets farmed out into user space so
we've managed to move all the cruft out
of ring 0 your file server crashes
reboot it I mean just restart the file
server you don't have to reboot the
system gets a kernel still running that
means you get Ashley to be developing a
new file server file system excuse me
not file server this is a great example
what's called Lee's privilege right what
runs of all privileges right the ring
that rules them all ring 0 is just the
microkernel
it's really small okay you have a file
system you have user management you have
networking they all run in their own
memory spaces they all run as an
individual task a great example of least
privilege oh well so let's look at some
existing examples most popular one is
apple mac OS x oh boy first you take
mach 3 which is pretty big then you
blend in the bsd interface and apple
core services oops it's not very micro
anymore it's been on a diet the wrong
kind of diet I've gained weight let me
tell off share with you how I did it
okay some device drivers may run outside
of ring 0 it's possible to do that in
mac OS x i asked when i was there friday
they wouldn't tell me if anything they
actually do this or not probably if they
told me I'd be under NDA and couldn't
tell you then how about l4l for is a
real microkernel project and it's a real
microkernel it's just four thousand
lines mostly see some assembler so it's
a great example in order to make it
useful they added the Linux API on top
of it so now we have about 400 system
calls networking stack how many file
systems it's not small anymore oh well
minix 3 comes the closest it's a real
microkernel runs device drivers as
services and includes capabilities so i
can write a device drivers a service
there's sort of a problem there because
device drivers need access to memory
lane phenix three handle says it says
okay this device driver has the
capabilities of reading via these things
in memory writing these bytes of memory
and so on so it has these privileges has
fine granularity in the epi is outside
of the colonel it runs x it has
networking so if you want to look at a
nice microkernel model this is the one
I'd recommend taking a look at today
oh by the way you can run it into vm if
you like and it's small now there's a
hybrid approach I meant to I didn't
mention this in my Apple tokio and in my
kernel approached me so I was working on
a sphere for the early 90s and I was
fortunate to talk somebody I understood
operators design an explanation i got
was that micro kernel performance sucks
because you keep crossing boundary
permissions and it's very expensive to
do so for every call you make that's
right we service there is a real problem
with micro kernels or let's say a real
perceived problem with micro kernels and
the problem is yeah essentially what you
said is you were working system 5
release for in the early 90s and you
were exposed to micro kernels in and
they essentially died and the reason
they died was there their performance
issues and it really our performance
issues and can i write somewhere maybe
well it doesn't matter i can't find a
pen it's you're going to have to do i
got to just to err drawings user process
user process my head is the microkernel
okay so you go from user process a IPC
contact switch into the microkernel
microkernel then contact switches back
out to use a process be user process p
say the file system so now we have a
block we're going to return it contact
switch IPC context which I pc for
context switches now how many people
here now in a context switches yay oh
boy you guys are so much better than
Apple oops okay for contact switches
that's pretty painful context which has
cost a lot because you gotta shave you
got to change stacks you got to change
every you've got to save everything
that's all in all your registers how
many registers you've got right and all
we want to do is talk between these two
processes and we've got to do that four
times now there's a way around this I
believe and I'm going to save that for
later but thanks for the question well I
got this in my hand so I don't have to
hold my hands up again a be m k4
microkernel or mopped call it MK instead
of right in here out here in here out
here one two three four context switches
that's the pain okay looks like it's a
great concept I like the concept but so
far it hasn't worked for really two
reasons one people consider the context
switching to painful and eat a nabob
who's in charge of minix three doesn't
think so and I think there's actually a
solution to this
so the other thing about the microkernel
is how do you use it ok this is the
layering on of system call api's device
drivers file systems networking that's
what skilled say you know let's say that
Mac OS X has a microkernel it's more
like saying it has a microkernel
embedded in kernel that's the reality
that's the sad reality
did I miss something there the hybrid
approach yeah okay now there's an
experimental operating system it's
really funny I was looking at the names
on the papers and one of the names on
the papers is Robert Morris I see a few
smiles in room Robert Morris wrote the
internet worm to show us how insecure we
were in 1988 boy we've come a long ways
huh so he is where he's working with
people on asbestos and the idea here is
this is also sounds a little bit like a
microkernel so I had a hard time fitting
it in it does data labeling which makes
it sound like MLS right right because
it's also mandatory and or discretionary
access control but what the data level
that I label labeling really means is
that say you have a web server someone
connects to the web server and their
data as it passes through the web server
has a label associated with it somebody
else connects to the multi-threaded web
server in the same memory space in their
connection and their input gets a
different label labels can only get more
restrictive over time so if we have some
malicious input that causes a buffer
overflow and then tries to get the web
server to misbehave that code has been
labeled with a very restrictive label
that's going to protect protect the rest
of memory that's the three now I don't
really know a whole lot about this but
how they do the labeling it's done in
pages in memory pages and memory or like
4k so if you have a get request that's a
lot of memory but any memories cheaper
these days so looks interesting I don't
really haven't really got to look very
deeply into this one yet how about
virtual machines this often gets touted
as a way of doing security but is it
really not really because where do you
run inside of a virtual machine a copy
of an operating system of all its flaws
and weaknesses and insecurity in depth
what we get out of virtual machines is
the ability to read
I sit if it gets compromised you just
put in a new image to start over again
you have isolation between VMs that's
nice that's actually getting better
because intel and AMD are actually
giving you hardware hypervisor support
so we have strong or isolation between
virtual machines the mill you know
department defense actually likes it
because theoretically now they can run
multiple levels of security on the same
box in different VMs and rely on the VMS
to do compartmentalization but that
doesn't solve our problem it really
doesn't you still can't run a web
browser and not expect someone to steal
your secrets the reference monitor the
reference monitor forest applications to
match execution profile systrace is our
best current example so we have the
author assist tray sitting in the front
row here yeah niels you want to take a
bow no no I didn't think so okay I
didn't just put this in here because I
know Neil should be here by the way I
like the idea behind sisters essentially
you can use a tool to create your
profile boy that beats the pants off
selinux right which you can put in
logging load and then you have a mess
which you may be able to convert into
some kind of a pulp a policy after a
while essentially what systrace does is
it captures system calls when it
captures the system calls it canonical
eyeses pathnames so people can't play
games of path names and we're trying to
access objects the profile that it
creates is simple enough that you can
actually hand it it you know it falls
into the category of stuff that I like
say python vs pearl where if you start
reading Python and you've seen the
programming language before you
understand it if you start reading pearl
if you don't know how pearl works you
won't understand it because it's not all
there same thing with the profiles here
the profiles are easy enough to read if
you understand what a system call is
what a path name is what a network
socket is it's going to work for you so
that's very nice ok but it doesn't
really have the granularity that I'm
looking for right
because i still can't protect a web
browser user from herself oh one other
thing i should mention about reference
monitor exceptions may be handled
without killing the process now it's
only if you're using it interactively
but most of our other solutions we
talked about like things like stat guard
right there's a violation or it kills
the process that's how it handles it oh
I'm sorry you did the wrong thing Oh bad
yes sorry glad to speak up in defense
yes you're really close could you use
this so I don't try to repeat what
you're saying I turn it on okay just to
you know quick sentence and defensive
situations just because I'm sitting here
so the way that you would like to run a
web browser and assist race is to put a
very restrictive policy on it and then
because the web browsers interactive
anyway you get this trace of policy
notifications out of band of the reel
web server web browser process and that
way if you do something that you would
expect to lead the file being written
somewhere or a file being read somewhere
or network connection being open
somewhere you sort of get the
certification out of that of the web
browser and you can okay it and when you
get notification that you didn't expect
them that usually means that something
went wrong and you can just to deny it
out of band from the web browser again
and that sort of gets you a little bit
closer to where you want to be thank you
so I don't have to repeat that now what
I think of the problems with that are
number one have you ever known of a user
who got a dialog box that said cancel or
continue what do they do continue I want
my poor oak support yeah whatever okay
so there's a there's an issue with that
you can't trust users to do the right
thing you have to do it for them so for
you running systrace I think that's
going to work fine for most of the
people writing systrace that's going to
work fine people in this room I mean not
just anyone behind people who are also
the video conferenced in it sure but
this is not our target audience of our
target audience are people who are not
computer experts and what about we have
a web browser we're watching assist
calls we haven't you yeah you don't have
any data protection so somebody has a
buffer overflow what the buffer overflow
is going to do is this it's going to run
a little program it's going to search
the memory space of the web browser
looking for at signs at signs why at
sides because lots of usernames are
username at and then you capture that
information whatever follows it memory
and that's probably a username password
okay you also search for 16 digits why
16 digits credit card number right it
even has a built-in checks on these
collect all that up and then it's a web
browser you visit a website and systrace
is going to allow that as well so it
doesn't it's good and I like what the
reference monitor does and I Ron you
know this is a good example of how you
take a program and you you monitor its
behavior so you're going to keep it from
misbehaving but only up to a certain
level
now separation of privileges is a
something that we've danced around a bit
already the idea behind separation of
privilege is to do divide and conquer we
are going to separate a service into
smaller programs run most of these
programs with minimal privilege
privileges granted only to programs that
require privileges postfix has a nice
example right post fix is written from
scratch because that's even and I got
tired of dealing with send mail bugs
mean send mail think about it 2,000 in
33 buffer overflows discovered two in
April one in September exploit by LSD
very cool exploit by LSD for taking
advantage of the buffer overflow how
long did that buffer overflow been in
this open source code and nobody saw it
I'm guessing a little over 20 years okay
when it came out I got the patch looked
at the you know what's a patch right two
diff file so you could see exactly
what's being modified and what looked
really interesting was the checkout or
function and indeed that's where the
buffer overflow was well then I started
hand stepping through checkout oh my god
sorry sorry eric eric ahlman wrote send
mail as a this is one of those things
you know you do as a student project
because you're you're just not satisfied
with your email server solution in
nineteen eighty 81 or 82 it was never
designed to be shared with tens of
millions of people and some of the code
looks like that including check out ER
check out ER is designed to parse an
email address right and what do you see
if you look at the from line from colon
lied in your email you'll see name angle
bracket email address close angle
bracket okay that's supposed to fit in
256 bytes according to RFC
the 28th I'm forgetting it 28-21 i
believe it is and i don't see the 21 or
22 the idea is this girl is supposed to
fit in 28 256 bytes and exactly 256
bytes are allocated for this on the heat
not on the stack so Canaries not going
to help you okay so what was wrong is
every time they saw a right angle
bracket they would let's see a left
angle bracket excuse me but I use my
right hand for you they would then
decrement a counter and when they see
the right angle bracket they would
increment the counter except they forgot
to increment the counter again that's
what was missing it was very subtle
error and he really had a single step
through it to find it so you just had
pairs of angle brackets like this and
that would increase Lee length that you
could you could then fill into the heap
you could overwrite part of the heap and
take control of the program now the
actual exploit was sent as a very long
data line and so then you would have you
would find a file structure open file
structures inside of a program actually
have callback pointers they overwrite
one of the callback pointers so when I
went to read the file it would actually
jump into the routine that was stored on
the heat that was part of the email data
and what do they do with this they
opened a connection to port 25 at the IP
address of the attackers choosing 425
that's what a mail server uses oh my god
what firewall okay and then they exact a
shell as root because say mail runs his
route okay all of a sudden post pics is
starting to look really good okay simple
enough to verify everything is simple
and very little red's is root you don't
parse your email addresses while you're
running as root that's the point of that
long story then there are other things
like DJ Bernstein's dns and other things
he's such an annoying person to deal
with you know it's sort of hard but he
does deserve
at least so my personal favorite is
separation of privileges this is
something we can do today you know
instead of writing large convoluted
applications you actually build this
into your design right you build modules
that do limited things that require
privileges and everything else runs
without privileges and you keep
everything as simple as possible this is
almost like capabilities right because
you write something that's all it's
designed to do say using post fixes as
an example you write something that
listens to port 25 something connects to
port 25 it does RFC 822 right hello mail
from receipt to data and it saves that
all into a blob of a file okay then
something else comes along and says oh
look there's something in the incoming
directory and it starts processing and
then there's an yet another step in
processing it before it ever gets for it
anyone but only thing that's happening
at the root level is that initial I'm
opening a socket port 25 that's it
everything else has done is a non
privileged user now how is it like
capabilities each little program is
doing something very very simple we're
taking advantage of that this is a
process it's only allowed to reason so
memory you can treat anybody else's
mentally it's still running as one
single user but what's happening here is
we're actually spawning yet another
process so it's not perfect but it's
sort of like capabilities I consider
this best practice with today's
technology well when I say anybody can
do this we're not all Betsy venema
unfortunately
so here we get to the blue sky portion
and then we're going to we're going to
finish on the original time schedule
looks like none of these solutions
prevent over full buffer overflows right
I haven't really solved the problem of
running somebody else's code within my
web browser without a buffer overflow or
with some kind of an exploit that's
going to ride my attackers code of
choice the separation of privilege makes
things easier because we've reduced the
number of lines of code right now we
have simpler smaller more easily
understood programs reduce the chance of
a root compromise right not as much as
going on at ring 0 but it does not solve
the web browser problem if we could
start over here's what I would like to
do programs have you broken into small
tasks each task runs within its own
threat so I'm talking really not
lightweight threads that run within the
context of one process I'm talking about
treating a thread as a true independent
entity of its own memory space so now i
can use rings i can use memory
management to prevent it from looking at
memory within other processes other
threats as i'm calling each task is
actually restricted by something by
reference monitor my capabilities I
don't really care since you wrote the
task it's really simple you can say this
task is supposed to do this now as an
example not so long ago there is a
exploitable condition in JPEG rendering
how often do you look at j pics what do
you use to look at JPEGs your web
browser so somebody could send you a
picture or you could visit some site
that had a picture on it that would then
do a buffer overflow within the context
of your web browser it onew you could do
anything you could do now suppose that
JPEG reddit renderer which actually is
one function one functional unit was its
own task
that read from an input stream and had
an output stream stream that would only
write fits to your display now can no
longer read your passwords or credit
card numbers it can't make network
connections they can't spawn processes
all I can do is do what it's supposed to
do it's a JPEG renderer it's nothing
more now let's go back to our
microkernel here's our microkernel
here's our problem with the microkernel
right we got these for context which is
going on one two three four now what's
changing today is instead of having a
microkernel that runs on one cpu we now
have multi-core chips this is becoming
common you know from the simple of
having two core chips we're going to
have true for core chips by next spring
you know intel is going to fake it
they're going to put 22 core chips on
one package and call it for course right
that's not really four cores in my book
this is not closely coupled right we're
going to see multi-core by the way spark
already has in a courtship called the t1
so this is where things are going we've
miniaturize things to the point that we
can have multiple complete CPUs on a
single chip so if we have a single chip
on a high hypothesize a just because
it's convenient a five core processor so
I don't have to worry about any ever
having to claim that I invented this
idea because no one's going to do a 5-4
processor well we'll see and then I'm
going to take my micro kernel and I'm
going to always run it on one of these
processors hmm now associated at this we
also have level one cache level one
cache designed to run at processor speed
the big problem of level one cache is of
course having to do address translation
but since it's only going to be doing
this one task we don't even have to do
address translation this doesn't have to
be very big
you could probably run it and say 16k
not a whole lot of level one cache very
doable today's technology so what do I
win with this what do I get out of this
I now have a kernel that does not ever
do context switches somebody calls in I
don't have to change my context right i
have my own register set no contacts
which I can do I pc with other running
threads with no context switch so now
I've solved the problem that we used to
have of micro kernels I didn't really
solve it technology has solved this
problem right now we have the ability to
have multiple cpu cores all reading why
not find the microkernel which this is
little piece that just talks two things
it has to run with privilege to one of
these cores yes looking at this is kind
of a client-server model where a is the
client asking a service of B then let's
say you tied a to one of them the
colonel to another and be to another
only one of those three CPUs would ever
be doing anything you'd have the
potential for 3x the amount of work you
actually get what actually okay so the
question was if I tie a and B two scores
as well I'm going to run into problems
I'm not going to tie a and B the course
yeah no I'm going to be contact
switching all the other cores except the
one running the microkernel so I can
still do time slicing just the way we do
from just way our operating systems run
to
all I'm doing is is removing the floor
context which is that micro kernels
involved
the scheduler the scheduler runs as its
own task and what happens is that
whenever a process goes to exit we have
our C runtime saying I'm calling
underbar underscore exit I'm done right
any worse a process fee goes I want to
read the hard drive so it communicates
of a a says oops I'm sorry you're going
to have to wait about 10 milliseconds
for the disk in which case we're gonna
have to talk to the scheduler and saying
this is going to wait too long he's
actually going to have to say to the
microkernel put this guy to sleep yeah
what exactly does cause the state do
when it was to talk to my girl
essentially it's going to do what we've
always done there's going to be a system
call library the system call library is
going to convert this into yeah the same
have the same family I don't know what
to do thanks REEP good point and
actually I shouldn't say there is a
system call ivory the last thing I want
to do is take my little tiny task and
ad-lib see to it okay now this is what I
call this blue sky because we'd actually
have to be writing that we actually have
to have a new programming language to
make this feasible because we'd have to
say okay I'm running a module it has
these capabilities and here's how it's
going to communicate it has to be done
in some way that ordinary people can use
it if ordinary people can't use this
it's going to be useless so what I'm
saying is they process be wants to talk
to the file system if it looks like see
it's really going to look like see to
the user the user is going to say open
file and it's going to get back a
filehandle object right just like we do
today under the covers though what's
going to happen is there's going to be a
little magic going on and the magic will
be that it's actually going to make an
IPC to the colonel say to the colonel
hello I want to open a file and then the
colonel goes off and talks to the file
system
and you have a design for
I think that some of what I'm talking
about is a new farmer designed to be
really honest I'm throwing this out or
the slide says blue Scott I don't have
all the answers part of what i wanted to
do is I've been thinking about this for
a long time I wanted the opportunity to
come in front of a bunch of really
bright people and say look I would like
you to think about this I'd like you to
shoot holes in it I'd like you to feed
back to me what you think might work and
what wouldn't work about it maybe this
is totally useless okay and maybe not a
lot of times the way I pc could be done
is we don't copy the data back and forth
what we actually do is you say okay I
read the block from the hard drive it's
here in memory the microkernel which
manages memory then maps that page of
memory to process B now process b0
copying now has the data that it wanted
oh that's sort of nice all that is is
page management software of course all I
saying all it is is virtual memory
management boy isn't that simple stuff
right it's not simple but I think this
could be done yes
essentially allowing a user to write in
code
and what are the thoughts about
something good so like your example life
suck at marketing project
Michael Parkinson glaring particularly
maybe I there where you run I'm sorry
wrong hey it's a private percentage
device records run express folk and all
the other programs are written in some
like an interpreted language Anjali
bytecode and so you can get
and destructive life code can't do
anything
that doesn't fulfill whatever you know
whatever restrictions you want their
capabilities or hola
have a safe system by virtue of
restricting the code and then you can
add hardware acceleration to accelerate
by good long but that's another step you
can still write on a generic across so
that's so other than you're talking
about is building completely new API
completely new program here
Halak Java Java C sharp do these heavy
things had any bugs in security well yes
they do not do the second part which is
also driven in the red really ready Joe
because
so figured
yeah okay just to repeat the question he
said you were talking about a Microsoft
Project it may be called harmony which
essentially has runs device drivers
without privilege which is one of the
things I'm talking about all user
applications run as byte code rather
than its assembler and we're going to
rely on the features of the language in
the hardware the byte code runs on to
limit next to control and provide
security sounds reasonable Mike as long
as you say the word hardware and there I
feel a little better but I still have
some problems with this part of the
problem i have is java as an example
Java an example has worked very poorly
okay it's by code interpret hurts
supposed to have security really doesn't
it's not just the static variables that
are a problem with Java how about
reflection or is it called reflection
introspection we can look say you have a
private method inside of Java how
private is it you can actually use
reflection to find out what methods are
private and then you can call it oops
that violates the security model right
there there's a pot there's a project
called Joey where someone is actually
trying to make Java more secure actually
actually follow its own security model
better some guys have Berkeley working
at this so I don't really trust that I
mean another project i don't really like
its singularity which is everything
right this is another microsoft project
experimental microkernel design
everything runs in ring 0 so you have no
context switching Wow now we're going to
rely on the features of the language for
security yeah it could be the same thing
I don't know that much about it but it
just scares so
neil griffin mr. yes seal of confession
over here a higher level where you have
applications directly
we never saw five right
okay Neil's just asked me about what
about things like SQL injection where
where we really have is to pick up
common example you have a web server
that's talking to an Oracle database or
am I sequel database someone is going to
send militias SQL code as part of a
regular allowed query and then do things
are not allowed and my answer is no my
solution what I'm talking about out here
doesn't really have any impact on that
at all and it's I really to be honest I
wasn't thinking about that problem when
I was looking at this that's one reason
why I'm not really looking at that the
other is that it just seems to me
somehow that we could manage to build
input filters that would be good enough
so we couldn't do this SQL injection
maybe this was like saying I write
programs with us yes it is like saying
writing programs of nail buffer
overflows and I don't really have a good
answer to this I mean really part of
what I'm trying to get around is that
programmers are generally not geniuses
okay there are some programmers that are
geniuses but not all programmers are
geniuses even programmers that are
geniuses make mistakes there have been
security flaws and postfix has a nice
example I know genius programmers I mean
I found bugs in their code and I'm not a
genius okay so i would like to have a
solution that made it programming like
driving a car right you can have a
sub-sub average IQ and still know how to
drive a car but i don't think we're
going to get there I don't think I don't
have a solution to SQL injection or PHP
file include and I don't really know
what to do about that it's a good
question because I think that's another
large topic it's just not really what I
was focused on this talk well okay so
you're
so repeat the question hi pcs fail
because it's not a very efficient
mechanism in general and I'm arguing
that we may be able to make this it may
be now in effect an effective mechanism
Andy Tannenbaum has been arguing that he
believes it is that it is as fast you
know he if you go visit his website
which I'll have a link for it's easy
it's minix 3 to search for medics
through you'll find it that he's doing
IPC as fast and what part of how he does
IPC is he has fixed length message box
and he's doing tricks with virtual
memory like I was talking about to pass
the data back and forth so is this
really possible I don't know the other
idea I guess part of what got me on this
thread as well was when I be talking to
people like John jonathan shapiro who
did arrows or antenna vomited minix and
other folks is if you could have your
own CPU design what features what you
put in it and they just could I don't
want to do that I'm going why not why
not we're still building the same cpu
that was based on a calculator the 4004
which later became the 8080 okay that's
our design oh my god this is awful why
are we still doing we're going down the
same road that we've been going down all
this time just can create new processors
and most of them in a commercial sense
have failed unless you look at it
embedded applications where people don't
try to put new applications on them or
use generic applications portability I
mean I've worked on a lot of RISC
architectures that
you know I 860 pa-risc recently I 64 and
a few others in between that all of them
have unique features that make them very
interesting some of them have better
security but you're talking about
executable stack remark not X cubed
product and those features don't make or
break the commercial viability of the
processor and those volumes and those
abilities to create us that's why Andy
canon mount and a lot of these people
have real hard time sort of visualizing
what they can do with a processor
because in order to get the volume up
somebody has to use it and already get
people use it that has to be software
and you have this vicious cycle of
trying to get one of those things off
the ground thanks for every sort of like
you have this wonderful piece of Harbor
I mean I used to review hardware in the
ladies early 90s I would get it it was
sort of a cool time for me I was a tech
technical editor of UNIX world magazine
as one of my consulting gigs so I got
paid to read the magazine I got paid to
write Hardware reviews I would get the
new hot workstation does your and when I
was finished using it I would copy my
files over to the next new hot
workstation deserve okay and the problem
they all faced was applications if you
don't have that application base you do
nothing I don't know how we're doing on
time okay well I'm going to go ahead and
not in this but I'm going to like do a
couple more slides we can keep talking
as we have another 10 minutes or so 20
minutes think of that truly secure
computer that I showed you earlier right
it was buried in concrete controls the
access really well I me now is the idea
behind this old saying you know the only
truly secure computer is buried and
cement or concrete each task will be
buried that was a concept we're going to
take a task we're going to buried in
concrete and give it to little windows
or as many little windows it needs but
as few as possible so that's the
capabilities that's a reference monitor
its isolated from other data prevented
from causing harm outside its own threat
that's what I'm suggesting now you can
take that and you can use that
day when you write your code think of
least privilege right try to avoid
writing huge things especially if they
have a large attack service what has a
large attack service anything that
listens to a network software socket is
a nice example of that anything that
receives requests from anywhere web
servers great example another great
example it really scares me is mdns
responder now if any of you have looked
at that bonjour very exciting stuff I
want to see this stuff compartmentalize
I don't want to see one giant sea module
that listens to the network and says oh
I've got one of those here you want it
and it's going to interpret things
that's reading off the network ok so you
to try to repeat what you said one of
the issues is how do I break up a
program you know XYZ ser into the
smaller pieces and then how do i assign
the capabilities to them and then if I
do assign the capabilities how do I keep
saying process a from exceeding its
authorization perhaps because processes
been hacked well who determines the
capabilities in the mall on envisioning
the programmer who's writing the program
where the designer who's designing this
would actually say here's this module it
needs to convert jpg streams into fit
maps that are going to be displayed on
the screen so that's a I mean that's
just so easy unfortunately that's why I
pick it as an example if they valid
example but it's nice and clean because
I get an input stream that's supposed to
be jpg formatted and when I put out or
just bits okay and that's all I'm going
to be is putting out bits yes a web
browser I've already been told what size
I want screen real estate I get so it's
really somebody in Apple made the
comment which I'd like to repeat here
and i think i can easily repeat because
it bears on your question one of the
problems of a capability style system as
i mentioned
here is really a lot of times what it's
doing is just moving the problem
somewhere else okay we can't really
eliminate the problem so that's a flaw
in my reasoning yes sir
yourself
this moment can be the same estate
from the future you
you're not trying to
no in this case I'm just saying I'm
expecting a stream of this that I got to
write out into this rectangular area of
the screen now that's pretty safe now
suppose what I'm saying is I'm going to
be passing a stream of bits in here and
what this is is a file converter so I'm
going to take PDF and convert it into
HTML ok so now I'm taking data in and
I'm putting data out how can I prove
that the data out I'm going to create is
not going to be harmful because it's
going to be interpreted somewhere else
down the line by yet another module
that's expecting real HTML so that's I
does that sort of what you're sitting
the nice thing about converting PDF to
hidden Idol said different for the
different formats is so simple yes
okay gotcha excuse me yeah within
metformin is really simple that's why I
say let's do PDF and HTML which is
something that Google search does right
you find a PDF file and there's a button
you can click and says oh read is HTML
so that means that you're running a
converter right you're running a
converter well now we've created is
we're not creating a bitmap we're
actually creating HTML you can HTML be
harmful yeah definitely so somebody
figures out how to exploit your PDF
converter on the right PDF file analogy
it's got to be an interesting in a file
yes porn the answer to everything yes
yeah I'm sorry that doesn't seem to be
the case today and actually we need to
wrap things up now so I'm going to have
to leave you with those thoughts also
going to mention that i put a page up on
my home site oh oh let me leave you with
these thoughts if security was easy we
would have done it already if it could
be bought Microsoft would have paid for
it right Oh google could buy it too
right no problem solution will take
thinking outside the box of history and
look outside cement block of the past
that's what I want to leave you with I
have two pages of references and how you
find the reference i forgot to put in
this who isn't that clever my website is
spirit com so if you can remember the
word spirit then you can remember the
name google you put in spirit calm /
google HTML it'll get you these
references and a link to the
presentation so you can read it at your
leisure my email address is right hey
it's pure calm it's on the slides send
me email if you have more thoughts about
this I mean if you know if you say that
was really stupid I want to hear it if
you say I think I have a solution here I
really want to hear I want to hear both
things because I really would like to be
part of creating a solution at least a
part of this problem maybe this goes
nowhere but what I've seen so far is
that what we've done so far has it
worked so we've got to do something
different thanks very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>