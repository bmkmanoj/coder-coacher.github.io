<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angular: Designed for Testability | Coder Coacher - Coaching Coders</title><meta content="Angular: Designed for Testability - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angular: Designed for Testability</b></h2><h5 class="post__date">2011-01-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gqzeuCXlJMk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the next speaker here is Brad green and
he's going to be talking about angular
i'll let him describe what angular is
but dominantly there's some interesting
facts about Brad he not only manages our
engineering teams in apps and enterprise
but he also has various efforts in
Google feedback and and accessibility
across Google products the interesting
fact about him that he does not prefer
to wear shoes even though we remind him
that it's hygienic and otherwise but he
has other data so maybe afterwards you
can reach out to him and understand why
he prefers to buy anyway welcome Brad
and kind of story wise thanks so how
many of you are testing web apps your
jobs okay and how many of you and you
put your hands down how many of you
develop in JavaScript only a couple of
us okay so I'd actually like to see many
more of us developing in JavaScript and
I'm hoping maybe that's going to change
after this talk I think it's a really
cool language you can totally shoot
yourself in the foot but um I'm going to
talk about something that's really near
and dear to my heart I called angular
and I'll start with a question which is
what would happen if instead of
designing the tools and libraries and
frameworks we build designing them to be
hard to test what if we did the opposite
what if we thought about testing first
and made it a first class citizen so I'm
going to talk a little bit about that in
the context of a application framework
called angular so a little bit about
what it is and sometimes we have we have
a hard time defining what this is to
everybody but it is it's an application
framework and it tries to promote a
standard structure for building web apps
this is unlike some of the great
libraries out there like jQuery and
closure and other ones that provide
excellent library functions they don't
really tell you where to put your code
they don't tell you how to structure the
app and then give you conventions for
the flow of
application so we in that context we
provide a bunch of application default
behavior with the goal of dramatically
reducing the complexity of building your
web app so a little bit more about some
of the conventions that we've chosen one
of the weird things that we've done this
is very different than most environments
is that instead of having the rendering
happen on the server everything happens
in the browser and I'll show you some
examples we'll see this happening live
and instead of inventing a new
templating language we looked around for
what could we possibly use this may be a
lot of people knew including web
designers and developers ah that was
already understood by tools and editors
and we found this thing called HTML it's
crazy um but but we've decided that we
could actually get a lot of mileage out
of something the browser already
understand with some minor modifications
um we decided to standardize on a
pattern called model-view-controller
who's heard of this couple of us okay
who can tell me where
model-view-controller started except for
James who's old small talk yes what
company invented small talk
park place James um so uh so we picked
something kind of kind of old but still
good we'll talk about why that's cool
something you may not have heard of we
use in the model-view-controller context
we make it even cooler with uh with a
pattern called data binding and who's
sort of David data binding couple of us
okay so i'm going to show you an example
rather than talk about it too much ah so
I've got the very basic simplest angular
app where I've got a text field here and
it says world and down below here you
notice it says hello world kind of
simple right so I'll type someone else's
names in here like James you notice as I
type the words update ah whoopty-doo
right Brad great great ah how much code
did I have to write to do this well
turns out none I'm showing you right now
the templates that we use and let me
blow this up a little bit for you in
angular where to start off an angular
app I have to do two things 1i define a
xml namespace and i import the
javascript that i'm going to be using
the app if you could call it an app does
two things we create this text field
where we name it name really name and
then I have this funny little thing in
here that we called markup we use the
syntax of curly braces and what this
says is that I want to bind the name
variable to a piece of text here so that
as I type it updates the name that we
have here we'll talk more about why
that's good and and and what that does
for us but so in most systems that have
data binding what happens is on the
server will merge our model of the Model
View controller with a template and
we'll shove it into the view in HTML now
you as a developer than you
left with the task of if the user
changes the view by typing you have to
go update the model you have to go
squirrel it away and if the model
changes from some some mechanism like
maybe some data comes back from the
server now I have to go update the view
now an angular we do all that for you
there's nothing for you to do so what
happens in the Model View controller is
in you end up specifying the view in
some nice declarative HTML you the model
is just a set of variables will see that
in a minute and your end up writing just
the pieces of business logic that our
core of your application that actually
describe what your application does so
we're trying to help you focus on what
the app does rather than how to get a
browser to do what you want had a
crowbar this funny set of things web
browsers and servers into your app um on
so I said all of the app happens in the
the client in the web browser so how
does what do we do with servers so
servers we still need them but we need
them just serve the data and to manage
our our access to do our security for us
and we've standardized on a another
pattern called rest you don't have to
use rest but we make it dead easy so one
example of a restful data source that
already exists is the google buzz client
i'll show you another app that we wrote
with angular that uses the buzz client
so these examples are all in the angular
site you can bet angularjs org and what
this does is if i type in the name of
some user and click fetch it'll go out
to my set of buzzes and fetch them for
me like that's pretty cool i could
expand the replies see who replied to it
all that good stuff people's faces cool
now here's the cool thing about this the
whole source for this app is 50 lines
nobody's saying whoa this is whoa okay
so let me just walk through a couple
things in this um and I won't go into
deep deep description here but in the
top we're setting up a declaration of
how the restful data sources configure
it basically says that when a URL comes
back how do i parse it ah and we named
this activity I then creates my
controller again from the
model-view-controller paradigm where I
say that I've got a function called
fetch and if fetch happens I should go
ask the activity to get a particular
user and if somebody wants to expand
replies i should say go get the replies
the HTML then is just a user ID and we
default at the google buzz but you could
put in my name we'll go look at that in
a minute a button where I say that when
you click it call the controller's fetch
function and then for for the expanding
expanding if I click expand replies then
I should invoke expand replies on the
item that I clicked ok back to the
slides um just to make it even a little
cooler uh one thing that most
application frameworks do this is one of
the kind of key differentiators that let
you know do I have an application
framework versus a library frameworks
tend to do something called inversion of
control or dependency injection they
actually give you all the data you need
to perform they with this is what I was
talking about when I said they show you
where your code goes it gives you a
framework for your app to sit in so you
might say that's awesome Brad but what
does this have to do with testing I
think actually all of this has something
to do a testing I'm going to talk a
little bit about why so the
model-view-controller paradigm that we
have the HTML view as we saw we can
actually get a lot of stuff done
with out writing code we can do you know
copying data back and forth we have
things that will filter the text that
I'm typing things that will transform it
I reformat it as a currency as arose a
date or or things like that and so the
view I actually only have to do scenario
based tests or end-to-end tests on
there's no real unit testing to do there
so I simplified my life all ready for
testing the controller though this is
code that I right we saw the controller
for the buzz client there I still have
to test that however because we have
dependency injection it's very loosely
coupled the controller actually doesn't
even know about the view because of the
bi-directional data binding it just
looks at the data in the model and if I
type something in the view it
automatically updates the model and I
get updated in the controller the
controller's not only have to worry
about the view but they also have to
talk to servers now servers and and
other things that we call services like
the browser itself we manage again
through a dependency injected set of
objects that can easily be mocked out
and some examples of these are the
browser itself the windows document
object exceptions the location in the
browser logs bunch of good stuff so
already by just using this design
principle and coupling it with things
like dependency injection and data
binding we've dramatically simplified
the amount and reduce the number of
tests that you have to write let's take
a look at how we might mock out a
service just to get down into the code a
bit so in angular if I want to create a
service maybe I want to make a really
simple one that just pops up a little
alert window to the user that's my
service and I'll define one called
notify that that returns a function that
takes at the window object and says hey
window pop up the alert message when you
get called and here's the special little
magic that allows objects to be injected
we provide a variable
or a memory called window that tells
that I want to have the window object
injected by the runtime system for me so
if I were to use this in my application
I could then just call it I could say
hey my controller needs to get past the
notify object when I save I'll call
notifying say page tape to inject it
i'll ask my controller to inject notify
for me now to test this however we can
mock it out we can I for example create
an array to hold results of calling
notify called notifications will create
something called a scope now an angular
scope is a you can think of it as the
namespace that controllers operate
against this is the set of variables
that are in the model and what we can do
is say hey notify instead of what you
normally do I just take whatever text
gets past you and it'll store it in the
notifications variable so I can then
create a controller and call its save
method if we remember from the previous
slide save just calls notify with the
text page saved and in our test will say
we want to and this is some syntax we
stole from a behavior driven framework
called jasmine we say we expected that
notifications is equal to page safe as
simple as that okay ah yeah okay so I'm
a little jet-lagged so if i if i get off
course i want somebody in the audience
to shout out what you think i should
have said but
let's see so um what's the best kind of
test you can write what is the best kind
of test and I'll maybe I'll describe
some characteristics of a best test it
runs infinitely fast I don't have to
maintain it I it never breaks how would
you define this kind of test what's that
no test yeah it's it's the test I don't
have to write out the way I could not
write a test is if i can write somehow
write less code and angular does this
for us in a lot of different ways so we
looked at some of the things that it
does for us but we didn't really
describe all of it but if you noticed in
my buzz client some of the things i
wasn't doing i wasn't doing any event
handling the on click behavior in the
controller has no idea that events are
happening like it just gets called this
is uh this is the bi-directional data
binding working for us it angular
handles formatting text for us updating
the view via the data binding for
talking the server we have services that
know how to parse and Marshall JSON
object this is what was happening with
talking to the bus plant I didn't write
any code to do it it just happens for me
escaping strings there's a bunch of
security work we do for you so less code
means less to test we wrote a nap in
which Google web toolkit I don't mean to
sell against Google's own products but
seventeen thousand lines of code became
two thousand lines of code in angular
man that's a lot less to test the lot
left to maintain ah feels like a good
thing to me ok I'm going to show you
something that nobody outside of my
little office in Mountain View has seen
before so in addition to our good sort
of unit and integration testing story we
also wanted to have a pretty good
scenario test story so we built a
scenario test runner and by the way this
this isn't a everything you might need
it doesn't stimulate
browser clicks or drag and drop or any
of that but it does a lot of what a
developer needs to do to test code in
scenarios but with intimate knowledge of
the way that angular works we built a
scenario test runner that lets me build
really clean an obvious tests we see
some examples below I'll walk you
through some of these again we we stole
Jasmine's ah behavior-driven syntax and
one real cool thing we're going to that
I want to show you is we take the
asynchronous nature of browser tests and
for for your purposes of writing tests
they look synchronous meaning I when I
went out to talk to the buzz client I
said revenge now javaScript doesn't have
threads so what happened was the browser
made a request for me saying hey go to
the server and get something and then
tell me when you got have some data for
me this is a big problem in web app
testing now that you those of you who
test web apps probably have seen this
where I will ask my app to perform
action X and then I will somehow have to
know when it's okay to verify that it
performed action X so I will wait for a
while or I will go pull until something
is available in the UI and this is
really fragile like I might have gotten
the thing wrong or the thing I'm
supposed to wait for changes or the time
I wait for it is variable depending on
how the service is running so we wanted
to fix that let's go uh let's go take a
look at a slightly more complex version
of google buzz now that has some nice
CSS and I think we're at about 100 lines
of code for additional functionality
like validation oh hey I mouse over this
and it says this user is required so
i'll type in my buzz client unless not
me
that's me and so now we get pictures and
we get my enormously chubby baby we get
the ability to expand replies with all
kinds of on animations we also get this
filled cool filter thing I can type in
palm or I could type in bees see all
that stuff about bees fun stuff hundred
lines of code pretty snazzy okay but I
want to run some tests against this so I
actually built a test runner for this
and I've run them but i'll just click
reload you can notice it's pausing here
at saying this thing waiting for xhr is
to finish i goin a little quick to see
but but here's that step so angular
actually knows when all of its requests
the server have completed when everybody
in the UI has consumed the data and
rendered it appropriately and stored it
in the model and the test can continue
if i go look at the code for the test
itself here's my tests ah again we're
using this kind of nice can easy-to-read
english-like syntax where i can say okay
i'm testing the buzz client and before
each test I want to navigate to buzz
that HTML this just loads my client um
and I define a test like it should start
up empty and i can write things like i
want to expect that the elements
identified by this selector is equal to
blank so user ID and the filter we both
want to start up equal to black so
there's no loading that we're not
waiting for anything let me let me
scroll down to kind of an interesting
test here's the one that says you should
expand replies meaning if i go back here
and I see some replies that if I click
the replies it should expand and
contract that's a good thing I want to
test
so we actually enter something we say
input help filter Jack's enter bees and
then I want to make sure that the
element contains 3 replies grape and
then if it does i'm going to click on it
and i call this thing called drain xhr
the xml httprequest i wait for that can
to be empty now I think the the guys
back in the garage have eliminated the
need to say this so in the future you
actually won't have to type anything
like that I then go look for my replies
and look for something an angular called
a repeater maybe just just a list of
items and you know I'm going to say I
expect the count to be equal to 3 i'm
going to expect that a particular row
has some particular text in it now if
you notice like there's not much code
written here like this is super easy
this is a suti stuff um it's also going
to be super not flaky because I'm not
waiting I don't have to update when
maybe the UI changes I'm not waiting on
a particular element I don't have to
guess there's no selectors to find out
what to what to wait for we're pretty
enthusiastic about this okay all right
so I think that's the main context of my
talk although i did want to send out a
big shout out to another tool that we
use to build angular which was called
jstestdriver it's our test runner for
small tests medium tests and we're
actually running the scenario tests in
it as well it runs tests on every save
it's got integration support for Eclipse
and IntelliJ runs hundreds or maybe even
thousands of tests and under a second
depending on your browser um its runs in
parallel across multiple browsers it's
gives you the ability to declaratively
specify the HTML dependencies you have
for a test matter of fact there's even a
book somebody wrote doesn't even work
for Google I don't know this guy I think
Cory knows them on how to do test-driven
development using jstestdriver pick it
up ah it's good stuff
I got references for the talk including
the slides I've got a nice short URL if
you want to go look review them tonight
in your hotel I know you will um a
couple questions before we move on to
the next speaker maybe one from
Bangalore to start with ok I won't you
might well oh hi I'm Bharatiya from
National Instruments I I understood that
this angular supports javascript but I
want to know whether you support other
platforms like especially cellulite
cellulite type applications are so no so
this is an applique this is an
environment written in JavaScript you
can only write the code in JavaScript
you could pour it it to silver lights I
would think it's an open source platform
so that would be interesting I'd be
interested to see what you could come up
with oh yeah thanks enough yeah sure
maybe a question here we passed the
microphones to the man in the green
shirt oh god speak i'll repeat your
question
yeah so the question was using angular
can I determine when an xhr is completed
and when the response has reached the
browser and is completed yes that's so
we the question was how do we do that
and we wrap the xhr object in our own
angular object that monitors its
completeness I and let me I know I i
said i was going to talk about this i
totally forgot this is where you guys
were supposed to stop me and ask me
something um how does this test do what
it does uh and let me let me call it out
a little uh if you notice drain xhr
actually uh it actually weights and
there's there's no threads in JavaScript
and so I can't be pulling normally this
should just continue the this is this is
similar magic to what we do in for
waiting for the ex hrs but what what's
actually happening is this test does not
run the test what happens is what I call
input it puts a request on a stack and
then what I call element it puts a
second request on a stack drain xhr is
another request on a stack and so what
we do is we just we roll through the
stack in our tests and the xhr that
we're waiting for the way we know it's
completed is we get a callback that
tells us it's complete and that we can
move to the next step so in the same way
we move to the next step in each piece
of our test that's how the application
framework knows that everything is
loaded and I can tell for example I can
tell the data binding to go populate the
UI or anyone else that wants to consume
the data that came back from the server
say it louder for a fee it's still not a
synchronous request but we've we've made
the programming simpler with some
syntactic sugar so that you don't have
to think about callbacks and and
handling that in the test itself behind
the scenes that's all callbacks uh with
closures okay thank you so much yeah
Anna do we have another question in
bangalore or should we go to one raise
your hand if you have one in bangalore
okay let's go here to the man with the
microphone oh this is wetter I would
like to know how old is this framework
ah how old is the framework it's been in
development for about two years and
although we're still feeling like
there's a lot we want to do but yeah
it's it's been around for quite a while
and so what raleigh google products
which are currently using this framework
so we don't have external google
products using it currently we have some
internal ones and and several other
folks in the open source community are
using okay okay thanks all right do I
have another question or or should we
move to the next speaker that one in
here in front do you wanna bring the mic
up okay I'll now go ahead take the mic
if you would please yeah in which area
of internal point of using this angular
language okay so is the quote was the
question what kind of apps is this good
for building exactly yeah okay so this
is good for building uh things that
don't require a rich editing surface
meaning if I was building a spreadsheet
or a word processor I might not use
angular for that part I might use it
however to build the menu system and
everything that holds that component so
it's great for credits it's great for
things like if I was building expense
reporting tool if I was building
uh you know general workflow HR apps
like I could see building gmail calendar
like several of Google's kind of rich
you I products in it but for things that
have custom UI editing i would i would
build those using some lower-level
libraries okay thank you yeah good
question thanks everybody</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>