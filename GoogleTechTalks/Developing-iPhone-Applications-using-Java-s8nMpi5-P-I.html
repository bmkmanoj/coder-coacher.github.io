<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing iPhone Applications using Java | Coder Coacher - Coaching Coders</title><meta content="Developing iPhone Applications using Java - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing iPhone Applications using Java</b></h2><h5 class="post__date">2008-10-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/s8nMpi5-P-I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey there guys thanks for joining us
today we have Arno pooter here he is a
professor at SFSU today is going to talk
about cross compiling bytecode he is the
creator of a language called xmlvm and
today is going to talk about cross
compiling code for the iPhone so here
yes things been for the introduction and
well thank you very much for inviting me
out here to this google Tech Talk it's
actually my second google Tech Talk here
so it's nice to be back again in
building 42 and today I wanted to talk
about has been already mentioned about
my latest project cross compiling Java
applications for the iPhone and it's
kind of a project that is part of a
bigger project that we that I call xmlvm
and I will talk about a bit more about
that during my presentation but you know
when you and the iPhone is it's very hip
device nowadays and you see many people
having an iPhone now unfortunately Apple
is very restrictive when it comes to
opening up their the hardware that
creates such beautiful tools and
products but then they're very
restrictive when it comes to opening up
as a matter of fact I'm not even quite
sure if I had used the official SDK for
doing my work I probably wouldn't even
be allowed to stand here in front of you
to give this presentation so fortunately
I've only used open source tools of
course also using a jailbroken device so
I can talk in public about what I have
done for today I the agenda is I will
tell you a little bit about Objective C
Objective C is the language of choice
from Apple not much used outside of
Apple but since not many people have
seen it before I have a few slides to
give you at least a quick introduction
on objective-c
and then basically I talk about how we
cross compiled Java to objective-c
to create native iPhone applications and
I have a bunch of demos throughout so so
I hope that you can also see some of the
code that we've been working on in
action in in fact okay the quick rundown
of history of objective-c so it was
designed in the early eighties by a guy
called Brad Cox
and objective-c is just like C++ and
objected optic oriented extension to see
just like C++ except that I've taken
more inspiration from small talk so it's
the dynamic language and you will see
shortly on how that works and the late
80s there was a company called next
software that was that licensed
Objective C and they used that language
to develop a user interface called next
step and around that time also I believe
Steve Jobs while he left Apple for some
time and he joined this company next
software and also got exposed to
objective-c during that time and when he
returned to Apple I think it was the
reason that he brought then next step
and and also Objective C over to Apple
but anyway so in my little timeline
slide here you can see that then in 92
the free software foundation edit
Objective C support to their GCC
compiler suite then in 94 it's being
sanitized by by Sun Microsystems and
next to something called open step I do
know that you also has an implementation
of next step they called new step well
and then in 96 Apple acquires next
software and from since it's on
objective-c is heavily used inside of
apples so Mac OS 10 is based on
objective-c and open step is now called
cocoa so it's is the the GUI library
used for developing Mac applications and
also used develop iPhone applications ok
let me give you another quick rundown
here let me show you some some code
objective-c codes have a better idea on
what it feels like actually to write an
objective-c application so now I'd like
to see you have a strict separation
between interface and implementation and
on this slide here you see an interface
definition in in of Objective C and you
see there is a Clow interface called
fraction and it inherits from a base
class or base interface called NS
checked now NS you can already tell by
by this prefix stands for next step so
even though we're now talking about
modern iPhone applications here or
Objective C the the base class libraries
still has these classes that came from
the original next computer company but
you see there are two members for for a
fraction numerator and denominator and
there are some some instant methods here
and you can see instant methods are
prefixed by a minus sign so whenever you
see this minus sign that tells you that
you actually have an instant method the
return type is in brown brackets and
while the the signature is a little bit
different from what you're used to in
from C++ and and in Java
basically they call it a selector so if
you take something like set numerator
that is actually called a selector and
then the actual parameters are the the
formal parameters are mentioned again
after the selector so you can see kind
of its if you have done any kind of
programming I'm sure that you can really
understand how to read this okay once
you have this interface definition you
have to implement it you have to provide
an implementation so on this slide here
you see how to implement that so there's
a new keyword now called in percent
implementation and here's how we
implement class fraction and well you
you provide the implementation in curly
brackets no big surprise here and you
can also see by the implementation of
method print that you have full access
to the C runtime library so we just use
printf to print out the fraction and the
other methods here for accessing and and
reading the the members are just as you
would expect it from from any language
so then once you have created this class
called fraction and here's how you can
use it so the the main entry point of an
objective-c program is again the the
main function just as it is as for for C
and in C++ and I guess the first thing
that looks
a bit strange now is the square bracket
here and on the first line of code and
what happens here is basically you have
fraction as the name of the class and
you send it the method called a lock so
basically those square brackets denote
sending a message to an object so what
happens here is in this first line that
you send fraction the the unlock method
and that would correspond to allocating
memory for class fraction and then what
you get returned is is a pointer to this
new object and then in it would be the
constructor so you do a lock to allocate
memory and then in it to actually
initialize the object and then you can
see how to how to use the selectors that
I've defined for for class fraction by
setting numerator and denominator and I
can I can print it so basically that
kind of is a little bit different syntax
but I think you can immediately see how
this works on the bottom you see how to
release an object so there is a method
called or a message called release you
can send to an object they will
basically deallocate the object if you
have multiple parameters and here is a
bit of a departure from from other
languages I mentioned already before
they don't really call it a method name
they call it a selector and it selected
determines method dispatch so that
determines which implementation you are
invoking and if you have multiple
parameters so for example if in my in my
class fraction I wanted to have a method
that sets numerator and denominator at
the same time then here's how you would
do an objective-c and I think the
intention objective-c was that they were
trying to create some kind of readable
interfaces so if you just look at the at
the bottom of this slide here so I have
this object frac and I send it I say set
numerator 1 and denominator 5 so even
like in choosing this selector you kind
of you can almost read it like an
English sentence so you say I have a
fraction here and I set the numerator
and denominator and so that basically is
a little bit of a departure from just
the method name and the list of formal
argument types that that you have in
other languages
now I should also mention here that
overloading is not allowed of four
selectors so if you have two selectors
and entacle selectors that only differ
in the formal argument type that is not
permitted in objective-c so which of
course has some repercussion when you
try to cross compile from Java to
objective-c because you do have
overloading based on formal argument
types and I'll talk about that a little
bit later let me talk a bit about
garbage collection because just like C++
objective-c does not have a garbage
collector it relies on on reference
counting so if you implement your own
class from if you derive from your own
class from nsobject you inherit some
basic message reference counting
functionality so what you can see here
is again I initialize or I create a new
object I initialize it and then there
are three message that three messages
you can send this object there is one
method called retain count and that just
returns the current reference count for
that object so after you immediately
create the object the reference count
would be one then you can send an object
the retain message and that would just
simply increase the reference count by
one so you can see how the reference
count will just be bumped up twice here
by sending the retain message twice and
then release just decreases the the
reference count and once the reference
count returned drops down to zero then
of course the object is going to be
de-allocated so now it's your
responsibility as a programmer to call
these retain and and release messages
now I heard that that Apple is planning
on doing a new version of objective-c
where they actually integrate a garbage
collector into objective-c but that is
still on their on their roadmap so as
for now if you want to write an
objective-c application you will have to
do your own clean up after yourself
there is one thing that they have added
to the runtime library that makes a
little bit easier for garbage collection
so on this slide here I explained to you
a thing called the order release poor
so the order release pool is just a
class that can do a little bit of while
managing a bulk of objects so basically
what what happens is if you create an
order release pool any object that is
being sent the order release message
will be added to that order release pool
so if you look at the code on the bottom
here so first of all in the first line
of code I do create a new order release
pool and you can see just like an
instance of a class called NS
autorelease pool now then here the next
thing is I again create an instance of
class fraction now notice that I not
only call alloc and init but also I send
it yet another message called order
release that's a message that is also
inherited from the base class NS object
but by invoking order release what will
happen is that this fraction is going to
be added to the order release pool now
when the when the release pool itself is
released on the last line of this code
sample here you see that that I'm
actually releasing the order release
pool then the order release pool as part
of its cleaning up process will release
all the objects that it has accumulated
over its lifetime so basically by
releasing the order release pool as I'm
indicated on this comment here you will
also automatically delete that that frac
instance more precisely what happens is
here that the order release pool is
decrementing the the reference count by
one so of course the order released put
on that example only deletes the the
frac instance because the retained count
is equal to one and for this example
here now a cocoa as the GUI library for
Apple is making heavy use of the order
release pool so if you create like
widgets in in the cocoa library then
they're automatically added to the
current order release pool you can also
nest order release post you can have
like an order release pull inside an
order release pause there's also also
possible so one more thing that you have
an objective-c and that's kind of
radical
Parcher from from C++ and Java and and
is more in tune with what what you had
in small talk the dynamic invocations so
basically you can send any object any
method and the compiler will just simply
take it so here I have an object like
variable OBG object and I send it some
method and the compiler may say well you
know what I don't really see that method
in your inheritance hierarchy but I just
trust that you know what you're doing
here so if the object should not
implement this method some method and it
would cause a runtime exception but the
nice thing is that you don't have to
have like a strict inheritance
relationship so the bad thing is you
have no strong static runtime compile
time type checking but the good thing is
that you have a very flexible dynamic
invocation scheme here and there's also
heavily used for the cocoa library for
example there is a widget called UI
table that into implements a little
table widget for the iPhone and the way
they connect to a data source so a data
source just has to implement a few
methods but you do not have to derive
your your data source from an interface
okay so so so much for objective-c so
now I want to jump into how to actually
develop a little hi phone application
and here on this slide you see the
infamous hello world application for the
for the iPhone and of course since it's
for the iPhone what you see on this
slide is of course objective-c code
making use of the cocoa library and if I
just quickly walk through this piece of
code here so of course you first have to
define an interface and the your
interface if you won't want to write for
the iPhone you have to derive it from
something called UI application and you
have to overload a method called
application did finish launching so of
course it's not nothing that I came up
with that that's a method that came from
the coca-cola comes from the coca-cola
so it's basically a main entry point so
once the application has finished
loading
well that is then what the iPhone will
call in order to launch your application
now in the implementation you see what
the application is doing here so so
basically you what happens in the first
line here is you use class UI hardware
to retrieve the full screen coordinates
of the iPhone so that basically would
give you something called a CG erect
that gives you the full screen
resolution of the iphone and then the
next line you instantiate something
called a UI window basically giving you
the full size of your of your screen so
UI window if you have done any any swing
coding what somewhat correspond to a to
a J frame so here you basically just
create the basic container for adding
your own widgets then you you do some
things like you put it to the front and
and you set it to visible the next big
thing that happens in this code here you
instantiate a class called UI view and
that would correspond roughly to to a J
panel if you're familiar with swing
programming and and again you give the
the UI view the complete resolution
screen resolution of the iphone and then
you use GCC than one line saying window
is set content view it's where you add
the view to a window so that that's the
same thing what you do also in swing you
just say J frame add J panel the next
thing that happens here is do you
instantiate UI text labor and and well
that roughly very roughly corresponds to
a jlabel it's just basically a text
label although you can do much much more
in the cocoa library and you can see
that you said that you set the text one
by by saying hello world and then you
you add the the text label over to to
the UI view and that's it and that would
just pop pop open a window and
horizontally aligned say hello world on
the
phone okay so what is on this slide
again is the objective-c version of that
now remember what we're trying to do
we're trying to allow developers to
write an iPhone application using Java
so the first thing that we have to do is
we have to kind of map the API that is
defined put by cocoa over to Java so
which means all these base classes that
you see on the slide here UI application
UI view UI window we have to create some
kind of corresponding classes in the
Java world the first thing that we did
is actually to do that
and what I wanna show you on the next
slide here is now HelloWorld in Java and
you see it it follows exactly the flow
that you saw for the objective-c version
except now we're using Java and of
course now I have to create some some
Java classes that implement UI
application and and UI hardware so so
actually what for the first demo and
that's kind of like like the little
teaser but but I have a bit more fun
demo at the end of this presentation I
want to show you how actually this hello
world runs on the iPhone it's not not a
big show-off but again there's something
more impressive is coming up shortly and
basically what what I'm going to show
you here is why we have this hello world
application and I have not yet told you
how we do cross compilation but just
believe me for now that we can cross
compile this hello world over to
objective-c now if we use the
objective-c compiler and you just link
it with the native cocoa library to
create a native iPhone application you
can run that on on the iPhone and what
you can also do is of course now you've
seen this java class called UI
application so how about now actually
creating a java implementation of the UI
application for example based on swing
which means now that i could run my java
based iphone application as a pure java
application on my desktop okay and
that's what it's going to be the first
demo i'm going to show you so I switch
over to to eclipse and here in this
window you see
you see this HelloWorld application I've
had on the slide
and you can see I have this UI text
label here and if I click on that and if
I open this class you can actually see
there's an implementation that goes
along with it here and if you go a
little bit down here there's there's a
method called draw rect and that is just
using Java 2d to actually do the
rendering of this UI labor so what I can
do is I can actually run this
application here as a pure java
application and when I when I do that
well it added a little bit of eye candy
here so you have put a little chassis
snapshot in the background but basically
that's how it would look like it's a
pure java application running on on a
desktop now i have an ipod touch up here
so i can now run the cross-compiled
version and of course that just does the
same thing here so it looks exactly the
same as the Java version so that's not
much of a show-off and like I said I I
promise you a somewhat more interesting
demo and you can already see there's
some scroll bars here called
accelerometer so that will give you some
indication on what what's coming up here
but let me go back to my presentation
here and as the next thing explained to
you how we actually do the cross
compilation and that basically comes
closer to the xmlvm project that where
we got this name from before I do that I
just want to point out some of the
challenges when cross compiling
objective-c 2 to Java already mentioned
a few things but just kind of traitor
right and also to to refine some of
these points
well Objective C has no namespace
support so you have everything in the
global namespace and then of course
there's a namespace introduced by class
definitions but there but there's no
package thing there there is no way of
defining modules in objective-c also I
mentioned there is no method overloading
so you cannot have like two methods have
the same selector but only differ in
their formal argument types not possible
in
in an objective-c now if you have a Java
program that is doing that then while I
guess at least how we do it we use name
mangling so we just append the signature
to the method name and then we will
avoid these problems there is no garbage
collection so Java has garbage collector
Objective C does not so of course we
have to deal with that somehow we do
make use of reference counting but that
also means of course we cannot do
certain things in in we cannot reclaim
certain kinds of data structure if you
have if you have a cyclic data structure
we would not be able to clean it up also
very interesting Objective C has no
static member variables so we have no
choice but to create global variables
kind of like a very awkward thing but
that's just the way things are in
Objective C so again you have to be very
careful by using name mangling of not
any collisions these are the challenges
that you have on the language side when
you talk about cross compilation we also
have some telogen from from the cocoa
aside from from the from the GUI library
and if you look a little because at
Apple's API they make use of C functions
so they are like there's a function for
example called TG color create as a C
function it's not like what you should
have if you do a proper design
opportunity of design it's not like
ascetic member of a class no it's
actually a C function no so of course
you have to think of how can you map
that API over to the Java world where
there is no function there is best
aesthetic member aesthetic method but
not another function Objective C has
value types so in in C++ struct and
Clause are almost identical except for
the default visibility of of its members
in Objective C as truck is actually a
value type so when you pass a struct
around it actually does a deep copy of
all its numbers and is also being used
in in in in cocoa for example the cg
rekt I mentioned before I had on the
hello world program that actually is a
struct so with me which means it does
not do copying of references to pass it
around
but it actually is copying that whole
struct so you have to be very careful
when you pass these values around
because then we have different semantics
with call-by-value code by reference it
also uses like this old old C
programming trick of using pointers to
add additional output parameters so
basically you know what if you ever done
any systems programming you have a
pointer to something and you use that to
point it to a pointer to add additional
output parameters so they also do that
in in in cocoa and you know since we
don't have that in Java of course we
have to be little bit creative on on
that and last but not least they're
using delegation here making use of this
dynamic invocation already pointed out
this UI table where a datasource as
simply has to implement certain methods
but does not have to be derived from
from from an interface so that again we
can only vary with big problems mimic in
in Java so let me start talking about
the cross compilation because that's I
think the most interesting part of this
project and like already mentioned
there's a an umbrella project called
xmlvm that's we use for for doing very
flexible manipulations of on a bytecode
level and just to mention it upfront we
do not cross compile on a source code
level so we do not take Java source code
but actually what we do is we take a
class file as the first input to our
tool chain so in the next few slides I
give you some I give a little little
demo here and basically walking you
through that so I'm going to make use of
this class here so take a very close
look at this class because I'm going to
kind of single step on bytecode level
through this class here so just like a
quick look at this here so you have a
java class called calc it has one member
called X of type int and you have one
methods add with one formal parameter Y
and all that happens in the
implementation we add the parameter two
to X so X plus equals y not a very
exciting class but
it's just enough to just explain to you
how we do with the cross-compilation now
our tour chain the first thing it does
is it takes the class file of of this
class here so first you run it through a
regular Java compiler so take Eclipse
Java Eclipse compiler take the Suns JDK
compiler and you end up with a class
file now that is the thing that we feed
into our tool chain and the first thing
we do is we create an XML document out
of it it may it's a little bit awkward
but you will see shortly then what we do
with that XML document and it also is
where the this product at its name from
so xmlvm XML well that's obvious and VM
virtual machine so on the next slide I'm
going to show you what this XML document
looks like for this class calc and
that's a lot of ugly XML code now once
again as a reminder this XML that you
see here has the same information as the
binary class file so there is a be
directional mapping between a class file
and this XML document so I can also
exact in my document and map it back to
a binary classifier so all the
information you find in a class file
credit by Java compiler you will find in
this XML document it always begins with
the root node xmlvm that's the name of
the project and then on the next level
you have a class tag that defines a new
class and you can see well there's then
the name of the class and the children
of class define this class so you have
an XML tag called field that defines the
the member X of type int and then you
have this method add you see you see
mentioning of stack and local so
basically how much stack space does this
method need how many local variables
does this method need the method has a
signature so it has a return type void
it has one formal parameter of type int
and then I guess the meat of this XML
document would then be the code tag
and that contains actually the bytecode
instructions that you would find in a
class file and that is what the java
virtual machine would execute step by
step in in running this class here so
what I want to do on the next few slides
actually since that's something that
most people have not really seen like
what really happens inside a Java
Virtual Machine I want to a single step
for this piece of code here so actually
I'm going to zoom in to this code
segment here and I'm going just going to
a single step through each of these by
constructs you have a better idea
actually on what happens inside the java
virtual machine so the setup for this
example is here that that I have an
object that that has member X and I
assume that it's initialized with 11 so
there's one object instance I'm looking
at its member X is initialized with 11
and these two local variables you can
access them through an array so locals
index 0 is always do this pointer so
pointing to the object itself and then
starting from locals index 1 to locals
index n are the the arguments are being
passed the method now sends my little @
example he has only one input argument
there is only locals index one that
corresponds to the actual parameter
that's the initial setup so the first
bike on instruction that will be
executed of this method is the is the
load instruction and what load is doing
it is pushing the locals index 0 onto
the stack so at this point I should
mention that the Java Virtual Machine is
a stack based machine so everything is
done over a stack and that's similar to
the way also dotnet has defined it's
it's virtual machine so by by actually
the first bike or instruction what would
happen is that locals index 0 will be
pushed onto the stack now I'm an
old-fashioned guy you know I stood at a
lot of assembly so my stack grows from
top to bottom just to mention that
sometimes my students get a little bit
confused because they're kind of things
that should grow from bottom up but I do
the other way around so the next install
it's called dope which is a short form
for duplicate while there're simply
duplicates the top of the stack so we
have now won this on the stack and now
after executing that we have known this
twice on the stack
pushed in a second time the next
instruction is called get filled and you
can just look at by the XML that we're
trying to read a member from an object
and you can see while we're trying to
read member X of a class calc well that
is that that tells the virtual machine
what member to to read but of course
what get fields needs to know from which
object it's supposed to read this member
X since of course we can have multiple
instances of class calc and so get field
gets that information from the stack so
what get field is going to do it is
going to pop off the top of the stack is
going to use that pointer to address the
object is going to read the content of
variable X remember X and you will push
that content of variable X on to the
stack so with the next instruction get
field it will pop up this one this and
it will push 11 which is the current
value of x then we have another load
instruction so load index 1 well they
will push locals index 1 onto the stack
and that is now the actual parameter so
that is what we are passing to the
methods and so now we will just push 31
onto the stack so now we actually have
the next mome stack size that we need
for this particular method here the next
instruction is called I ate while I
integer edge well that just adds two
integers and since we're talking about a
stack based machine what does it do well
it just pops off the last two integers
computes the sum and then pushes the sum
back onto the stack so 11 + 31 is 42 so
you can see a big fan of well okay you
guys know what I'm talking about right
42 so the next instruction put Fiat is
then the reverse of get filled so it
actually have rights now a value back to
to a member so again you can see put
field again says while I'm I want to
write back
- member X of class calc now what does
put field need in terms of parameters
well it needs first of all just like get
field it needs to know to which object
so it needs a pointer it needs a
reference to the object and of course
needs to know the value that's supposed
to be written back when I guess what
exactly those two things are right now
on the top of the stack so put field is
going to pop off two elements of the
stack and it will then use this point to
access the object and it will write 42
back to X so now in the next instruction
you will see that X now will become 42
and that of course return is then going
to leave the scope of this method but
that basically shows you gives you a
rough idea on what happens inside the
java virtual machine but just again to
point out that the java virtual machine
is a stack based machine so everything
happens over a stack that makes
instructions very very simple so just a
matter of pushing and popping some some
data off the stack okay so that's all
good and fine so I've explained to you
in great detail on and what this xmlvm
looks like now but how do we go from
here to - objective-c and well actually
what we do is and that may look a little
bit awkward we're making use of XSL
style sheets so since now we have this
bytecode program represented through an
XML document we actually have written a
style sheet that now cross compiles or
generates based on this XML document
objective-c source code and we do that
by just simply mimicking the stack
machine in the target language which in
our case now is objective-c now if you
look on this little code sample on the
bottom here and let me first direct your
attention to this excel template on the
bottom so you see there's an excel
template match I add so this style sheet
this particular template is going to
fire whenever it comes across the I add
instruction in my xmlvm document now
whenever I see the I add instruction it
is going just simply to spit out the
code that you see in black here now the
code
in black is objective-c source code and
if you take close look at what this code
is doing it actually just implements the
behavior the semantics of the ayat'
instruction so you see I have some
helper variables I have a variable
called underscore stack that just
represents my runtime stack I have a
variable called underscore SP for a
stack pointer I'm using a pre-decrement
to mimic a pop I use a post increment to
mimic a push so what what these three
lines of objective-c code are doing is
just exactly what would happen in the
Java Virtual Machine it pops off two
integers and pushes the sum back onto
the stack now those variables up one up
two and stack are based on on on a type
def that you can see a little bit above
this code segment here so it's it's a
union basically that is a union of all
the the primitive types that are
supported by objective-c so I can I have
type safe access to whatever data type I
have on the top of the stack now of
course I am relying on the fact that
Java C the Java compiler is producing
correct code so when I know that when I
execute the I at instruction I know they
are two integers on the stack so I know
that I can access the top of the stack
using the dot I member of this unit here
now what I show you on the following
slide I show you actually what this
class color looks like completely cross
compiled to Objective C so well that's a
lot more code than my original one-liner
here X plus equals y but basically that
the code is here on the slide here first
of all is objective-c code and you can
see on the right-hand side I have these
curly brackets here that show you the
respective code what kind of bike or
instruction they implement so some some
on the bottom you see I add so you can
see those three lines of code that I
just explained to you on the previous
slide but you can see those are the this
handful of by code instructions that
that I just single step through and you
can see like how every of these bike
rode instructions just results in very
very simple a piece of code that just
does a little bit of stack manipulation
so you can see how the dope thing is
just simply taking the top of the stack
and just pushing it one more time now of
course as a bit of boilerplate code that
we have to create for example these
helper variables stack and stack pointer
and up one up to so those are created by
the style sheet for the method tag if
you remember from xmlvm there is an XML
tag called called method so the style
sheet for that XML tag would emit the
boilerplate code to initialize these
helper variables a few more things I
want to point out here so you can see
the method ad we use name mangling here
so we we name mangle the the formal
argument types into the method name in
order to avoid this method overloading
problem that we don't have in Objective
C and one more thing I also want to
point out here is you can see that the
way we do garbage collection is that
every at the entrance of every method we
create an order release pool that we
release upon exiting the method now of
course it's just a crude crude approach
here so if you have like a very
lightweight little method of course
creating an order of release pool is
kind of overweight it's kind of
overshooting likewise if you have like a
big for loop that just simply creates
objects before you exit the object of
course it would also accumulate a lot of
garbage that would take a long time to
clean up but that at least at the first
approach to to garbage collection we use
reference counting and and every method
gets its own order release pool so
whatever objects are created inside that
that method as long as they retain count
is larger than one the moment you exit
the method that is the time when the
objects would would be reclaimed
okay I think it's time for some somewhat
more cool art a little bit more cooler
demo here so let me show you a little
bit more complicated application and in
the xmlvm project has become kind of
customary to do a little application we
call fireworks and this application is
just implementing a little fireworks
thing here and you can see what it does
it just simply lets these sparks fly now
that is of course a little bit more
complicated than than hello world so
that is using a lot more of the cocoa
library reloading images here there we
do animation we have timers we move
things around on the screen but what you
see right now is again the 100% Java
applications for all these cocoa cocoa
classes that I'm using here I've
actually implemented a Java version so I
can run this as a pure java application
so we're making use of Java 2d to do all
this animation so that is the
application that we have now this
application can be cross compiled and if
I run it now on my ipod touch here of
course you see the same thing here so
it's exactly the same application I did
not have to change one line of source
code to make it run here on on the iPod
touch
now the iPod Touch has special hardware
just like the iPhone it has a thing
called the accelerometer which means
that you can sense change of orientation
so the way the application is written is
that the sparks always follow gravity so
if I turn if I turn my iPod Touch around
you will see that that the the sparks
follow gravity and always go to the
bottom and well how can i how can i make
that in my little Java ME emulator well
you know I can use that's what I have
the scroll bars for so if I use my mouse
here to to use these scroll bars I can
also change the orientation so by
pushing Y down here I can make the
sparks fly up here if I go with X here I
can make them could go to the to the
northeast corner of the display so
that's kind of like with the
accelerometer you can just do three
squares
all bars for the three axis so it's kind
of like like it's like a little trick
now the iPhone also has more advanced
things it has a multi-touch interface so
you're probably all I've seen this
famous pinch for zooming in so you take
two fingers and you push them apart to
zoom into for example Google Maps that
is running on on the iPhone now my
laptop here I only have one Mouse so how
can i how can i simulate that piece of
hardware there's this multi-touch
interface if I only have one mouse well
what we have decided to do is you know
we realized that we actually why don't
we use the the iPod Touch here as a
remote control I mean I have a
multi-touch interface on the on the iPod
touch here so what what we have done is
we have created a little application
that runs on the iPod touch that just
simply transmits the information of the
accelerometer over to my simulator so
let me let me call this application now
typing in the IP address turn on okay so
actually what happens now is I run this
application there's nothing you can see
on the application on the iPod touch but
observe the the scroll bars of my of my
simulator when I turn my ipod touch here
it's it's kind of by magic almost it's
changing the orientation of the of the
scroll bars okay so and also then of
course as a consequence is changing the
the orientation of where the sparks fly
okay that's what I wanted to show you so
sorry for the little glitch here now
this application I just showed you that
that I used as a remote control we have
also created soothing the same
technology so this application I just
showed you we have written as a java
application and cross-compiled it over
to to the iphone so what I can do now is
I can actually launch this application
in a second simulator so let me do that
now so this is the application I was
just using to
in the IP address so now I have two
simulators open let me just oops sorry
let me move this down here and what I'll
do now is I just type in the IP address
which of course is localhost here on my
laptop I turn on the the on switch and
now if I use the the scroll bars here in
the second simulator of course is going
to control then the the first simulator
so you can see that we already have
actually pushed the our little Java Coco
library to to some extent here so you
can see there are some user and
interface elements that that we already
implemented here you know that that
makes the the the iPhone so famous like
all these little cool sliders and and
and tables and preferences settings and
so forth so you know we even spend some
time to do it like the same color
gradient in order to make it a little
bit look like you actually would you
would expect it from from the iPhone but
basically that's a little bit more
complicated application because also is
using remote communication so it also is
actually doing HTTP request to upload
the the sensor data to to the second
simulator so that's actually a lot more
complicated than than the than the
fireworks application here well that's
that's the the demo let me run through a
couple more slides to wrap up here so
xmlvm is is an umbrella project as I
mentioned for for backup manipulation
and on this slide here I just show you
some of the other things that we have
done as part of this project and what
you see on the top here are the
different byte codes we can feed into
xmlvm so I I've shown you here Java
bytecode instructions that was the whole
demo I was showing you here but we can
actually also feed dotnet byte code into
xmlvm so you can take it out net
executable and you can also create this
XML file all of it and as of recently we
also support the Aruba virtual machine
ruby 1.9 has its own virtual machine
that this funny name yarv
I don't know ruby was done by Japanese
guys so they have like these interesting
acronyms but yaar F is the the name of
the Ruby bytecode and we can also feed
it into xmlvm now on the on the kota
narration side we can create different
different different languages so first
of all we can we can map it back to to a
java bytecode we can make it back to net
bytecode we can map it to JavaScript to
to Python and we can map it to Objective
C and C++ let me just make a few points
here so one thing we can do is we can
take net bytecode and we can write out a
Java class file so we have a also a
bytecode level cross compilation from
dotnet bytecode to Java bytecode based
at with the back end for objective-c I
have just shown you it would also be
possible to ride an iPhone application
in c-sharp so if we had the cocoa
library based on on a dotnet API you
would be able to also write iPhone
applications using c-sharp
we can cross compile from from from all
these byte codes down to JavaScript so
actually the the earlier google talk I
mentioned that I gave here two years ago
was actually just focusing on how to
cross compile Java bytecode to to
JavaScript so that you know we use
actually fir'd for doing Ajax
applications so it's similar to the
Google web toolkit so we take Java
source code we compile it to two by con
instructions and we can create Java
Script out of it so actually if we go to
our home page you will see some demos
and on what we can do there we actually
have that reminds me
this fireworks now in in JavaScript so
hoops tears so here you can see like
here's an index.html file if I double
click on that it will fire up Firefox
here and what you can see now is
actually fireworks running as native
JavaScript code inside of inside of a
Firefox now I've used an animated gif
for for the sparks here because it looks
a little bit nicer on a big screen
not use the colored sparks of use for
the iPhone version but that's the same
algorithm that is not has now been
cross-compiled over to JavaScript to run
as a JavaScript application inside of
Firefox so we use that to develop Ajax
applications by the way this when they
don't don't be fooled we're using an
ajax library called cook stew and they
give you like like a desktop look and
feel inside the browser here so this
windows actually just add if they just
do you know I can move it around if I
close the tap here in Firefox you can
see that it actually then also close to
the application so they're also a good
moment to introduce some other members
of my team here so I have one student
who joined me today Joshua Joshua Mel
Cohen he's done a lot of work on the
dotnet to to Java bytecode cross
compilation and as another student
jessica leaf who also has done some work
on that part joshua is also going to
spend some time for his master thesis
trying to cross compile android
applications to the iphone since Android
is Java base we think it's quite
possible that you should also be able to
cross compile an Android application
over to to the iPhone and there's one
colleague of yours actually a former
student of mine sasha highballing he's
based in zurich switzerland and he did a
lot of work in the early days of xmlvm
for this ajax framework so he worked a
lot on cross compiling java to
javascript so before I wrap up my
presentation I wanted to just kind of
pitch you one more idea you know I'm
gonna make it I'm an academic so I don't
do really like products I do some some
some prototypes and demonstrators but I
try to push the envelope in terms of
developing new ideas and and one idea
I'm kind of toying with right now is
xmlvm at the moment as you've seen on
the previous slide has various flavors
so we have xmlvm for java bytecode
instructions we have one flavor of xmlvm
for dotnet bytecode instructions and yet
as of lately a third version that has
Ruby bytecode instructions but at this
point in time
XML Vianne xmlvm document only contains
bytecode instructions of one virtual
machine so either you have an XML vm
document only with by AB Java bytecode
or only dotnet bytecode or only Ruby
bytecode so the the use case that I'm
working on right now is how about if you
take if you take into programming
IOP in in aspect oriented programming
what you do is you have an aspect you
weave into an application or you're all
smart Google guys so I'm sure you very
familiar with that aspect J is like the
big a or P framework in Java now how
about if you have a c-sharp application
and you weave in a java aspect so
basically you achieve reuse on four
aspects on a source code level by by
being able to leverage your your your
aspects written in Java and weaving them
into a c-sharp application now what
would happen in that case is that you
end up with a version of xmlvm that has
not by core instructions from one
machine but kind of like the interleaf
so you basically have by code
instructions from two different virtual
machines well the question is what you
do in that case I mean you what would
you do for example if you if you have an
eye at instruction from Java that I've
explained to you earlier and you let it
lose on an unsigned datatype that is
available in dotnet but you don't have
in Java Java doesn't doesn't have
unsigned int I call this the abstract
virtual machine is kind of like a super
virtual machine and what we would have
to do for that it would have to define
the semantics of this virtual machine in
order to define these cases you know
what happens if you mix if you mix by
cohn instructions from two different
virtual machines but again the benefit
would be then for AOP I think that it
would be a very interesting project so
that is the latest thing that that we're
working on
so to wrap up here as an Outlook of
course you know like I mentioned before
we don't do products we just do
prototypes now everything we have done
here is available under an open-source
license so I mentioned put the the
homepage xmlvm org easy to remember it's
hosted on SourceForge and everything is
available on an open-source license
now there are still lots to do I mean
just for the iPhone part I mean we have
implemented some of the cocoa classes
for the user interface elements for Java
but they're still of course a lot more I
mean the iPhone is famous for its user
interface elements and and of course if
you want to write Java compatibility
classes you would have to do a lot more
work on that it has all we also
mentioned one thing that Java has just
begun to work on on the Android - iPhone
cross compilation well guys that that
wraps up my presentation I would thank
you for your attention for coming here
today and if any questions I guess I
would be happy to answer them now yeah
this stuff's pretty awesome thanks for
for bringing it in
I'm thinking I was thinking about the
Android - iPhone cross compilation
during the talk and it seems like the
the UI would be somewhat different
between the two phones but it doesn't
make a lot of sense if you were coding
an app and he wanted to be able to have
an iPhone version of an Android version
to share some code would be really cool
how close is the how close is the
library for for sort of non UI elements
would you be able to share some some
some Java classes that have less
dependencies between an iPhone app that
you that you wrote in the using xmlvm
and an android app yes like for the for
the fireworks application for example
you know that one one classic example is
we have a random number generator right
to place these parks by random on the
screen I mean there is a class in the
Java Runtime that implements a random
number generator and of course in
possible we try to let we do leverage
functionality we already have in the
Java Runtime library now when it comes
to mobile devices of course the it does
not make any sense to cross-compile
swing application in swing is meant for
desktop applications it would not make
any sense to write any compatibility
classes for swing for the iPhone now
when it comes to Android again we're
just beginning with that project so I
cannot talk too much about it and I'm
also waiting for you guys to open source
it properly or I don't know exactly what
the status is of that now but the thing
is that Android you know the very least
I do know it's also targeting mobile
devices so I'm fairly confident whatever
the the abstraction is we have a better
leverage on cross compiling that to the
iPhone and then for example you know
swing to to the iPhone so to answer your
question yes we try to leverage as much
of the native library if we can to make
it easier for the Java developer so they
can use what they are used to you know
data structures for example hash maps
and so forth but but for the UI elements
we stick with the native API
yeah can you talk a little bit about the
performance metrics especially I'm
interested in Java to JavaScript
compiler and also compare or contrast it
with the hand coded Java to JavaScript
compiler in compared with what compared
it with like the hand coded Java to
JavaScript compiler in wit Google web
toolkit yes ok so so so the question was
about the performance of our cross
compilation I mean if you look if you
remember this piece of code let me just
go back to this one slide here that I
mean this like is a lot of overhead
right I mean I mean that is by no means
as efficient as long as one line X plus
equals y of my original Java program now
this here is objective-c and we're using
do you see an objective-c compiler to
compile it down to to machine code
actually we have observed that the GCC
compiler is very smart it can actually
optimize a way a lot of this boilerplate
code so if you look at the generated
machine code you wouldn't you wouldn't
see the stack anymore this that goes
away it still not quite as efficient
as the original Java program but the the
native objective-c compiler can optimize
away a lot of this boilerplate code here
so for the Objective C side I'm not
concerned at all
now you also asked about JavaScript
that's a different thing because
javascript is an interpreted language
and of course you know there we cannot
do any kind of optimizations I mean
JavaScript would look like just as ugly
you know if I ran this through our
JavaScript back-end it would look
something similar like this here of
course then using JavaScript as the
target language now that of course is a
lot more inefficient than then a native
word natively written in JavaScript and
implement application and of course I
also have to admit that Google's web
toolkit since they'd begin on source
code level they have a source code level
cross compiler they can do a lot more
optimizations so their code yes of
course will be a lot more efficient than
our generated code you know ok yes the
thing is you know I'm an academic I have
only very little resources you know I
have not Google you know like you guys
have like a whole team of programmers
you can tackle all the Java source code
level but doing that what what GWT
people have done is very complicated a
lot of work know by code level is is a
little bit more simplistic now I've also
given you the fireworks demo for
JavaScript for a purpose to show you
that actually you know it runs pretty
cool you know I mean that application is
a few thousand thousand lines of
JavaScript code and very bloated
compared to a natively written
application if I would do it in native
JavaScript but it still before performs
quite ok no no when you specifically ask
for Ajax application you know my
response view would be well for Ajax you
would not want to do any number
crunching applications anyways
inside a browser right I mean you do UI
applications and for those performance
is not that big of an issue so even
though I completely agree that the way
we create JavaScript code is not as
efficient as for example Google's web
toolkit I think for for the kind of
application that you would do you will
do for Ajax it's perfectly ok and
actually if you go to the xmlvm homepage
you
you will see also a little bit more
complex application we have done for
Ajax and it works like like a charm
I think I was a question the front here
anymore okay any other questions
well then again thank you again for your
for your attention
now just to come back to my little thing
here that as an academic I have only
very few resources to my disposal I know
you guys have your your your 20% project
you know so maybe you might want to
consider using one of those ideas I
reached you today as as your 20% project
so you know talk to me if you if you're
interested in that anyways thanks for
coming today</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>