<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Core Patterns for Web Permissions | Coder Coacher - Coaching Coders</title><meta content="Core Patterns for Web Permissions - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Core Patterns for Web Permissions</b></h2><h5 class="post__date">2007-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8S_gUdZ1TOk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thanks for coming this is our third in
the series of talks on authorization
based access control today we have Tyler
clothes from HP Labs and he's here to
talk about a system that he's designed
and worked on called the wet keys and
with that thank you very much thanks
alright so previously in in the talks
we've taken a look at capabilities
primarily within the setting of a local
computer today I'm going to switch
things up a little bit on you and I'm
gonna look at capabilities primarily in
a distributed setting and so we might
find some uses of capabilities here
which might be directly applicable to to
work that you're doing right now so Alan
Kay once set a very high design standard
for four languages and other systems
simple things should be simple and
complex things should be possible it's a
pretty high bar to meet it sets the bar
pretty high but once you find something
that meets that that criteria you've
really got something and the reason that
we've been here giving these this series
of talks at Google is because we think
capabilities are something that that
meets this very high standard earlier in
the in the Tech Talk series Allen and
mark presented some some areas where
capabilities achieve some fairly
sophisticated features that fairly
feasibly and so we've seen the using
capabilities the complexes is actually
fairly feasible today I'm going to back
away from that a bit and I'm going to
concentrate just on the simple things
that you can do using capabilities it's
surprising how many simple problems we
have to solve in our day to day work
that can be made complex by the wrong
tool and we're gonna see how to solve
some of those problems using
capabilities and a relatively
straightforward way today so here's the
talk overview I'm going to begin with a
anatomy of a capability and so this will
be a little bit of review for people who
are just joining the the Tech Talk
series on capabilities and it will also
this reserved review will also serve to
set up the needs
the requirements that we need to meet in
order to get the properties we've been
talking about capabilities in the local
context to get those same properties in
a distributed context where the the
collie and the collar are potentially on
separate computers so once I've set up
and laid out exactly what a distributed
capability is I'm going to show you some
interesting ways of using it and I'm
just going to show you a couple of
patterns that you can use on the client
side of the program so just purely
you're the client of a capability-based
application what sort of neat things can
you do because the server application
happens to be capability based and then
on the server side what sort of
interesting implementation tricks do you
have at your disposal to make your
implementation life easier I'm actually
only going to show you a couple patterns
of each we're gonna spend the whole talk
going over those four patterns but I'm
gonna show them to you from a variety of
different perspectives I've got some
actual running code here today and so
we're going to be able to see how these
patterns affect the graphical user
interface that a user sees and when
interacting with the application I'm
going to pull up some view source
screenshots that you can see what act is
actually going across the wire with the
network interface to your application is
and then finally I'm going to show you
some source code of how this stuff
actually or can actually be implemented
on the server side so let's start with a
little bit of review here so this
diagram is familiar from Alan marks
talks it's we call it the grant a better
diagram it's you'll see us go back to it
quite frequently because actually what
it is is it's it encapsulates very well
all the properties that you need to
implement in a capability system this
this diagram it's it's sort of the
atomic unit of collaboration so it's
expressed twice up there we've got the
graphical picture of it and then we've
got what it might look like in an
object-oriented language implementing
what's described in in the diagram there
so each of the spheres you can think of
them as being one way of looking at this
diagram is to think of each of the
spheres as being an object and the red
lines as being object references
the fat purple arrow as being a message
or a method invocation and so what this
diagram is depicting when you're looking
at it as a collection of objects is the
implementation of Alice contains a
reference that refers to the Bob object
and Alice is invoking the Foo method on
that passing as an argument her
reference to Carol now let's think about
what the language runtime needs to
guarantee in order for this to be a
useful statement to write in the
language what we're trying to do here is
set up a collaboration Alice has
pointers to the Bob and Carol objects
and she wishes to get them to
collaborate for some purpose of
computation so let's imagine that Carol
is a callback function and Alice is
registering her callback function with
Bob with the expectation that Bob will
then dalire deliver a series of events
to that callback that alice is
interested in receiving and they'll set
up the collaboration between these these
objects well the first thing we need to
guarantee in order for that to work is
that when Bob sends messages along the
reference he received in the few message
that his messages get delivered to the
object designated by Alice so when Alice
passed a reference in in that foo
message we want to make sure the object
that's at the end of that reference is
the one that will receive the messages
the callback messages the Bob is sending
where some other object able to insert
itself in there and receive those
callback messages then we will fail to
set up a collaboration right because
alice is expecting to get some callbacks
and she'll never get them some other
object will be getting them if Bob's
messages aren't delivered to the Carol
that Alice designated so let's imagine
further that maybe Carol is a special
kind of callback Carol is a callback
that writes our callback arguments to a
log file and so every time this callback
gets invoked it's going to write out a
line in the log file and so Alice has
authority over this log file and Alice
can write as it has been authorized and
given the permission to write out to
this log file but she now wants to
delegate that access to Bob in order for
the collaboration that we're trying to
set up to work
that means that the log file has to
write out the the log statement
regardless of who is sending the
invocation Alice or Bob
so when Alice passes that reference to
Bob he ought Elsa's authorization to use
that file has to travel along with it if
this weren't the case let's say that
we're using an identity based access
control system then it might be the case
that when Bob invoked the callback which
caused the log line to be output that he
would get an access denied error and we
would have failed to set up a useful
collaboration so in order to get these
objects to collaborate there are these
two main features that we need to
implement on the object reference that's
traveling here on this message this is
Jung this red line here it needs to
provide Bob with a way to know that he's
talking to the Carol that's or that's
they're referred to by this reference
and it needs to and we need to carry
with it Alice's authorization to use
Carol if we can guarantee those things
then we can set up a useful
collaboration scenario and so now we're
going to look at isn't in a normal
language runtime environment just your
language your virtual machine or your
programming language provides these
guarantees for you
objects can't jump in and intercept in
method in vacations that were intended
for you and when you pass a pointer it
doesn't matter you know you can you can
use that pointer from anywhere in your
program but now we want to get these
properties in a distributed context and
so that's what we're gonna look at how
to do next and we've got two slides
coming up the first one will be on
setting up this authentication property
question
well where does that bottomed out if no
one can ever do a direct delegation
where do any of the the calls bottomed
out
you've gotta forward everything all the
way back to the origin every time and so
she wants to delegate that authority to
Bob so that Bob can then write to the
log file and so Alice's is stepping
aside and moving herself out of the
invocation chain by doing that
delegation and that's that's a key step
for managing complexity where alice
required to remain in the delegation
chain every time she passed a pointer
you get spaghetti code so we've talked
about that have been the previous
presentations but yeah Bob's Authority
is essentially the reference to Carol
and so all the authority represented by
that reference is all the authority
that's being delegated that and nothing
more and so that's how you limit the
scope of the authority that's being
passed so I was going to stop at this
point and and point out how bizarre
these two requirements actually are if
you sit back and and think about how
authentication and authorization are
typically thought of but I'm already
getting questions but I'll uh I'll put
my head in the lion's mouth anyways it's
kind of odd when you think about it that
Bob doesn't care who Carol is all Bob
wants to do is make sure that the
messages he's sending are being
delivered to the object that Alice
designated if you think about what we
normally think about when we're doing
authentication so for instance you
connect to a website and you get back an
x.509 certificate it's got all this
information coming from the site that
you connected to giving you metadata
about who it is and and you know where
where it is who it belongs to and most
of the time that's actually pretty
relevant to you all you want to make
sure of then and actually all the
cryptography is actually guaranteeing
you of at runtime is that you're
connecting to the site that's referred
to in the URL you clicked on and so it's
strange that
well it strange that there all these
extra properties there that are thought
to be needed but when we look at it
purely in terms of what authentication
do we need to enable collaboration
between objects we get a much simpler
scenario alright so we had the two
properties that we needed to provide in
this reference that we're passing from
Alice to Bob the first was we need to
make sure that when Bob goes to use the
reference
he knows his messages are being
delivered to the target that Alice
intended so we need to make sure that
you've correctly authenticated Carol so
the way that normally happens on the web
today is by leveraging the DNS and so in
the authority component of the URI
string you've got a DNS domain name and
there's a complicated story that
explains how that domain name gets
mapped into a public key which your
computer can actually authenticate at
runtime and that's that's kind of
annoying because really we have this
rather simple property we just want to
connect to the site that this string
says we could connect to and so a way of
getting an implementation more closely
reflects those semantics would be to do
something like this and so I'm going to
extend the domain name here with a
prefix it is the hash of the public key
that you should connect to and so now
when Bob's computer receives this URL he
knows okay well I'm supposed to send
messages to the target designated by
this URL
all right I'll set up an SSL connection
and I'll make sure that the remote side
is signing at this this SSL session with
a public key that matches this hash and
if so I know I'm sending my my my
messages to the target I was told to so
there's some interesting implementation
bits also on this slide one thing that
may jump out at you and that seems a
little odd is that public key hashes
tend to be rather noisy things they've
got a lot of bits in them and so I've
our domain name from what was
conceivably something that was human
memorable to something which you
probably have to write down and it would
be sort of awkward to do that as well
well the first point is is that the vast
majority of URLs that you use especially
URLs that are being used for
communication between programs are never
going to be seen by human eyes they will
either be slowly manipulated by programs
or they'll be hidden in href attributes
in HTML and so the fact that it looks
ugly most of the time is pretty much
beside the point however there is the
odd case where you've you've created a
new company you've got a rather
important page it's going to be
meaningful to a lot of humans and you
want to write the address of that on the
side of a bus well this obviously isn't
something you're going to write on the
side of the bus but really was it all
ever the the domain name that we
actually wanted to write on the side of
the bus would it make more sense that if
I've got a business I want to attract
attention to it that I would put my
trademark on the side of the bus and if
that's the case then all we really need
is for those few cases where we need to
map from the world of trademarks to the
world of secure references we need some
sort of service that can can take
keywords like that like trademarks and
somehow map them into a URL a service
that could take keywords and figure out
which URL was the best match for that
keyword I know I've heard of something
sort of like this somewhere before you
guys are pretty smart
do you guys at Google know anything
about such a service so I'm gonna take a
little break from from the presentation
here and push on this this one little
point a little bit more because I think
it's it's an interesting opportunity
that I very much wish Google would
pursue and that is if you look at the
reality of how Google is used today
Google is a trademark repository if I
find a company that I want to know more
about I look up its trademark on Google
and Google returned to me as the top hit
a pointer to its home page Google is the
one mapping trademarks into website
addresses they're already fulfilling a
role very similar to that that CA is
performed and so what would happen if
you put a CA like user interface on
Google search
what would happen if let's say you
extend the Google toolbar such that it
had a little field in it that when I
connected to an SSL site it got the key
the public key from the site went back
to Google and said so who's using this
public key
what trademark is it associated with and
the Google search end will come back and
say as far as I can tell this isn't
associated with any clear trademark or
hey you know PayPal has been using that
key for the last five years and that's
it's a really different scenario for
using cryptography on the web basically
what you do is you know you've got a new
business you just make yourself a public
key and start using it and once you've
established enough PageRank cred that
you've got the Google whack for your
trademark then you start plastering your
trademark on the sides of buses and
there was never any real need to to pay
someone else to recognize the fact that
you've actually been using this
trademark you guys have a search engine
that is exceptionally good at
determining what's the canonical
resource for consulting for a given
trademark and it might be interesting to
see what would happen in the CA industry
if you just change the user interface
that you're putting on that all right
back to the presentation the second part
the second feature that we need to
provide in this reference to Carol is we
needed to transfer Alice's authority to
have messages processed by Carol we
needed to transfer that authority to
ball well in a distributed computing
scenario basically the only way of
having authority is to possess a secret
that others don't some secret bits and
there are various ways of transferring
it but because of the way the web works
I suspect the most feasible way of
transferring that authority from Alice
to Bob in this case is just going to be
to embed the secret in the URL and so
Alice has a URL that has the hash of
Carol's public key and a secret in it
that's possessed only by Alice a lonely
Alice knows this URL
she was this URL was delivered to her
securely and she can use it to send
invitations to Carol now and she wants
to delegate that authority to Bob all
she does is trance
for that URL to Bob using a secure
medium so for instance that might be
over another in this case in the diagram
we drew it would be over another SSL
session between Alice and Bob but you
could also use secure email or other
other options there's a question at the
back
that's an excellent question so the
question was so Alice has a bunch of
authorities and she only wants to
transfer a subset of them to Bob and
further what if carol represents a
rather complex service and alice doesn't
want to give all of carol to bob only
wants to give part of carol to bob how
would she go about doing that and we're
going to see some patterns coming up in
the next couple slides showing you
exactly how to do that so let's keep
moving right along them so this slide
here just puts together what we saw in
the last two slides this is the full URL
that alice possesses reparo the one that
she's going to transfer to bob and so
notice that it's actually fairly fairly
usable string it's this one here is 53
characters long it's not going to suffer
from line breaks if you send it to
someone in an email the other important
thing to note here is that I put both
the authentication for Carol and Alice's
authority within a single URL string now
this is crucial if what we want to do is
enable collaboration using web
technologies we have HTML and HTTP and
other tools for passing around URLs if
we want to use these tools to also
enable collaboration when there's some
authority involved then we need to make
sure that our representation of
authority fits within the slot that our
existing tools have for references and
so we can put this URL because it's a
URL anywhere we're currently putting
normal URLs there's one caveat to that
though sometimes we're pretty sloppy
with URLs when we put them in places
where they'll be discovered by by people
we didn't intend and so when we're
making use of our existing tool set with
these URLs we have to put some thought
into how the tool is going to be
transferring the URLs and make sure that
it's going to reflect our wishes so for
example if I have a browser with an
end-to-end SSL connection to a server
then that's a pretty safe scenario to be
using these URLs because they're being
delivered to pip
they're only visible on the server and
on the client and in between the there
are under end end encryption and one
caveat that too though might be well
what if you've installed a plug-in
I don't know there I know some some
companies are distributing plugins that
go and snip through and watch the URLs
at your visitor and transmit them off to
third-party and so you'd want to third
parties and so you want to make sure
that that sort of spyware isn't
installed on your computer it would
certainly not be good if just as a
general principle it'd just be a bad
idea to have software sitting on your
computer plucking data out of an
end-to-end encrypted session and
transmitting that off to third parties
that's it's obviously defeating the
intended purpose of the the end end
encryption and so you'd want to make
sure that you didn't have anything like
that running on on your computer so
let's get to the patterns the fun stuff
we know another question at the back
yeah so keep in mind that the start of
this presentation I said we're going to
be talking about capabilities in the
distributed context the star property
doesn't make any sense in a distributed
context the only way to implement the
star property is if all parties are
using the same computer and that
computer can therefore put checks on how
those parties can communicate if you're
in a distributed context I have my own
computer you have your own computer I've
been given some authority by a third
party
there's nothing anything he can do to
prevent me from transferring my
authority to you okay and so the part
the star property is just irrelevant
when you're talking about distributed
computation all right so I've got the
two client-side patterns so the first
one we're going to look at is actually
the one we had a question about so what
happens if the thing that I want to
delegate actually represents more
authority than I want to delegate how do
I cope with that and so I've got an
interesting story here one of the
members of our group was recently at at
a conference and one of the the
principals at one of the major
e-commerce companies was giving a speech
and in that speech bragged about the
fact that their services were so
sophisticated that some of their
implementations were testing the limits
on the number
methods their compiler will it would
allow per class so that's that's the
world we have to live in we have people
out there that are going to design
services like that okay and so what we
need is a communication a collaboration
paradigm that's going to allow us to
cope with the existence of those designs
keep in mind this was a major e-commerce
company that was doing it and so I might
have very good business reasons for
wanting to interoperate with this very
poorly designed service I just I need to
do it and so I need a tool it's going to
make that as easy as possible for me so
the question that was asked earlier how
can I decompose this huge chunk of the
thing I've been given into something
that's smaller and usable for me how do
I get at the part of it that I want so
the answer to that is that it must be
possible for the client to decompose the
authority and watch the words that I'm
using here it must not be just possible
for the authority to be decomposed it
must be possible for the client to
decompose the authority so as an
engineer of questionable skill you've
designed a web service that represents a
whole lot of authority and pass to me
that authority as an engineer of
somewhat greater skill I need to find I
need to be able to decompose that
Authority without any help from you
because if I require your help I'm not
going to get it and so how do we how do
we cope with that well this is actually
a fairly familiar problem for you guys
here at Google so we've encountered this
problem in the past so Google has this
wonderful thing where I can ask it for a
particular kind of information and it
can give me back a page of search
results that are only related to that
information giving me direct links to
those pieces of information of the whole
web and it doesn't matter how bizarre
and convoluted the site's navigation
system is Google can make that site's
content accessible to me even though the
site doesn't make it accessible that's
amazing how does Google do that well the
answer is deep linking Google's search
engine goes through and Trevor
the labyrinth goes through all the
Byzantine navigation systems that the
site is hidden its content behind and
pulls out a direct reference to the
content of interest and then just
hands-off that direct link to me and so
me is the consumer of that content I
didn't have to traverse that bad
navigation system I didn't even have to
know it existed Google just traversed it
for me and gave me the direct link so to
solve this problem here we need
something similar we need an access
control mechanism that supports deep
linking and that's what capabilities are
so the way you build up your application
with what you make a network interface
to to a capability application is you
construct a reference graph and a client
interacts with the server by traversing
that reference graph sometimes invoking
methods sometimes just doing a get and
finally coming out with the thing that's
of interest and then we can do the
Google trick we can take back the
capability for the thing that we found
the thing of interest and just pass that
off directly to the person we want to
delegate to so now I'm going to actually
show you some code we're gonna we're
going to see an example of doing this
I've designed some bad code for you so
here we have a rather simple web service
this web service just provides me with a
single editable text blob and so I can
go in here and
right some text and it'll save it to
inform me and I can connect to this from
any computer and you know save some more
notes here I mean all that's sort of a
useful thing to have to have someplace
where you can write some notes but it's
not it's not as useful as I'd like
because when I connect to this thing
I've got read and write access on it and
so what if I want to make my notes
accessible for other people to read but
I still want to be the only one who's
modifying my notes how would I do that
well if this were designed under a
classic i-back style I would have a
password for this service right and my
password would give me access to all the
things I'm allowed to do at this service
and so the only way for me to delegate
to someone else is for me to give them
my password but then they've got my
right authoritative them that much so I
need some way to decompose the authority
I've been giving to split out just the
authority to read this text and then
delegate that to someone else well let's
take a look this one actually is a
capability based application so I'm
going to do a view source on it come
down come down I think we can see enough
of that Firefox has decided to put the
window way up and away the important
parts though are you can see the throw
there the text that I was editing isn't
actually displayed in this view source
it's not there the thing that I was
looking at was the top of a hierarchy of
authorities that I have over this
resource and so one of the authorities I
have is the authority to assign so you
see I've got this this other key here
and so when I hit save text on that form
it did a post to this URL here
overriding the previous text with the
text that I had just written but then
how did how did the form get initially
populated with the text that I wrote
earlier before coming here well it
fetched that text using this authority
here the value and so what it did it get
on this URL here and the server returned
to it
the
text that's being stored for this for
this editor and so to delegate to
someone else let's say just to delegate
that read only Authority I'm going to
decompose the top-level authorities so I
was giving I was given a capability that
referred to this editor object I did a
view source on that and that returned to
me a list of all the smaller authorities
that it's composed of so now I'm going
to grab one of them I'm going to grab
the authority to do a read
and I do a little URL concatenation here
which under normal circumstances is done
for you by your browser and so I just
took that authority that I plucked out
of the hierarchy there and I did it get
on that and you can see that all I've
got here is is the source so let's do a
view source on this one and Firefox has
put it off the screen again yeah it's
not in full-screen mode actually I know
what I might be able to do yeah anyways
the only thing that's in this view
source is the text there are no moral
authorities in this source yes
lovable capability that time can have
resource each before that depends so if
you want other people to write software
that's going to interact with yours then
it's useful to tell them what sort of
things you have to interact with and so
you might publish a schema that says
when I give you this top-level Authority
if you do a get aren't these are the
following you know smaller authorities
that you will get and so then people can
use that information to write clients
which will interact with with your
server and so it's a useful thing to do
but I wouldn't go as far as saying
required another question
uh-huh
yes and so that was the other property
that we wanted in these in these base
references we wanted to make sure that
if I have the authority to do something
I can pass it to you and then you can do
it in exactly the same way that I could
and so that's a good thing
exactly and that's where we use these
poor patterns here too to avoid to build
up abstractions that do those more
sophisticated things using these simpler
units and so what I've been showing here
is a direct delegation in Mark's talk he
talked about a pattern called the
caretaker and the way that works is I've
got an authority that I want to delegate
to you but I may want to take it back at
some later time
and so what I do is I construct a new
reference that all it's going to do is
forward any messages you send to it to
the underlying reference okay and I pass
that newly constructed reference to you
and so now you can use that reference
exactly the same as the original in fact
you can tell the difference between it
and the original but then when I decide
hey you know I'm tired of collaborating
with you I'm going to cut your access
off I kill off the reference that I said
that I sent to you so that it it no
longer has a pointer to the underlying
one and so when it tries to forward
messages now it's for them forwarding
them into null and nothing happens and
so I've actually got the caretaker
pattern implemented in this simple web
service that we've been implement
playing with here and so I'll take a
little break again from the presentation
just to show you that so the way that
works is if you can see a key up here in
the or and this key starts with the
number three and so where I - we're good
were you guys to connect to this URL you
would have the same authority over this
object that I do let's say I want to
give you temporary access I wanted to
construct a caretaker for this
capability what I can do is click this
deputize button and what that does is it
constructs the caretaker and returns all
of the proxy references that will
forward to the underlying ones and so if
we look up there in the URL bar now
we've got a new key this one starts with
the letter M and so we're right to give
you this capability
you would be able to come down here and
say uh-huh okay well you know haha isn't
really a very useful comment to make I'm
gonna revoke your access
I click the refresh button on there and
so this authority that we have the one
with the M when I do a get on it now and
says all these permissions have been
revoked I'm not able to forward anymore
and we get the submit button we would
have gotten the same message but I can
still go back to the original one here
and if i refresh on it it's still good
your comment that you entered is still
there I can delete it now if I choose
but my authority is unaffected by the
fact that I created and then revoked
your access to this object and that's
that's a very simple and accurate
demonstration of how the caretaker
pattern that we were talking about last
week works so I'm burning through time
here so I'm going to move on in in the
presentation and through the next
pattern
oh so another useful thing to do on the
client-side what I just showed you was
well I've got access conceptually here
it's all these invocation points on the
server there's different places where I
can send invitations different parts of
the graph I can navigate to and I can
pluck out my access to one of those and
so you can think of that as plucking out
the entry point to an operation
sometimes another useful thing to do is
after I've sent a request to the server
I want to pluck out my authority to
receive the response to that request and
give that to someone else and I might
want to do that because I want to
protect my authority to issue the
request but I'm going to let someone
else handle their small handling the
response I want someone else to do that
for me and so one of the things you get
when you've got a capability protocol
for interacting with a server is you've
got the ability to reify a promise for
the response to a request and there are
different ways of implementing that in
the system that I use the way it works
is the client when it sends in a request
can associate that request with a nun
guessable secret when the server
receives that request it will hash that
secret and associate the response with
the hash and so essentially the hash of
the requests secret becomes the response
secret and now anyone who knows the
response secret can fetch the response
and so it was a client one of the things
I could do is I could issue a request
and since I generated the request secret
I know it is so I can hash it right away
as soon as I've generated the request
and I can pass that hash off that the
person that I want to delegate the
response to and right away I've stepped
out of the picture I'm no longer in the
run time chain the person I delegated to
can go and directly fetch the response
from the server so it's useful in
scenarios like that when you want to
delegate access it's actually even quite
useful when you're just delegating to
yourself if you've noticed you're one of
the things you can do is since I've
already got the reference for the
response if I've got another request
that I want to respond send to the
response of my first request I can just
send it down the line right away because
I've already got the reference for the
response and so you can pipeline out
your requests in this way and you get
some substantial
run time savings doing that it makes a
noticeable improvement in a distributed
application because in a distributed
application latency is your biggest
enemy another question at the back yeah
so the person who has the hash gets a
404 when they try it so not not found
and yeah yeah and so you might have lost
the connection before the request got
there you might have sent the hash to
the other guy faster then the request
got to the server and he'd beat you to
the server with with the hash all kinds
of things like that might happen and so
in that case if the other guy wins he
receives a not found from the server
because it doesn't know about that that
reference yet and so then there's a
recovery protocol where the person who
receives the hash remembers who he got
it from and so he goes back and says hey
you know the hash that you gave me
didn't work out give me the value that
give me the response that the server
sent to you there are some variations
you can do on that too all right so now
we've got our two client-side patterns
you'll notice that they're all
delegation patterns when you're trying
to get pieces of software to collaborate
that's all about delegation right me
collaborating with you means me giving
you some of my stuff and you give me
some of your stuff and that's delegation
and so all of this is about easy ways of
doing delegation using capabilities yeah
all right server-side patterns
so a common problem you have whenever
you're doing any kind of software
engineering is part of your server might
be sort of like a state machine where
there's a certain event that has to
occur before a subsequent event makes
any sense
and so you've got a race condition in
there where if that second event somehow
occurs before the first you've got a bug
in your server and you know I can tell
you that chasing down bugs and server
software these kinds of bugs represent a
substantial portion of the bugs that you
it that you're chasing down and trying
to fix and so how do we go about solving
this problem and we're using capability
software well the easy thing to do is to
say well if I don't want that second
event to occur before the first then I
don't produce the reference for the
second event until the first one has
happened and so event a when it gets
processed it returns a reference that
can be used to cause event B and so what
I've done there is I've taken this
causal relationship this this timing
problem that has to be solved in terms
of when things are happening in the
system and represented that constraint
in the way the reference graph is being
constructed I've taken a timing problem
and turned it into a reference graph
problem and so that's one of the common
patterns you'll see when you're doing
capability based design it's
representing everything in terms of the
reference graph earlier we saw how to
solve an access control problem by the
shape of the reference graph that was
constructed and now I'm just gonna solve
a timing issue using the way in which
that reference graph is constructed it's
a the common recurring theme here that
you'll find is that a reference graph is
a very powerful tool for representing
constraints a very flexible tool and an
easy one to use and so I've also got I'm
a Charlotte 15 minutes I've got an
example of of this this code here as
well and so I'll show that to you real
quick
so this this web service that I've been
showing you it actually can do a bunch
of interesting things it's it's actually
an access controlled wiki and so I'm
going to create a new entry in this wiki
here and the wiki is actually sort of it
has a fair number of features and one of
the features of this wiki is that when
you create an entry it can have multiple
kinds of entries you can create not just
pages in this wiki but you can create
redirects to other pages and so after
you've created a new entry the system
wants to know okay well are you
expecting to put some text in here or do
you want me to redirect when people
connect to the read-only authority on
this what exactly do you want me to do
and it's going to present to the user a
different style of editor depending on
the type of content that they want to
store in this slot and so after you've
created a new slot before you get access
to the editor you have to tell the
system well what kind of entry am i
creating here so the last one I showed
you was a code page I guess we'll make
create a different one this time I'm
going to create a redirect and so I get
an editor here that looks a lot
different than the one we saw a last
time and so what's happening there is
I'm forcing the user to initialize the
state of the editor before they start
editing and the way I'm doing that is
just by the shape of the reference graph
and so what I did is when I hit through
the initial create button to create this
slot the thing that was returned to the
user was that I saw a sign Authority I
was showing to you earlier remember when
I showed you the view source there were
there were two interesting authorities
in there or the there was the authority
to overwrite the text that was currently
in the slot and there was the authority
to fetch the slot there the text that's
currently in the slot
well after they created this new slot I
didn't return to them that full package
of authorities right away instead I just
gave them that assign Authority and so
the only thing they could do with this
newly created slot is assign something
into it and by doing some introspection
on what they assigned I figure out what
kind of editor they want and then
exposed to them in the return of the
assign operation point you to full
editing authorities over this slot and
so consequently in my code for it for
this I don't have an
sort of state variables so I say you
know have I been initialized yet if not
do the following checks
it's just that logic doesn't even appear
because it's implicit in the way the
references are being exposed to the user
and so why don't I actually skip and
show you the code for that right away so
it can you can see exactly what I'm
talking about yeah so when I clicked on
that create button and resulted in a
call to this define thing where the
topic was the empty string is we're just
creating an unnamed slot and the return
of this define thing is a pointer to the
assign method on this author object that
I'm going to construct and so as a
result of this define I construct a new
slot on the server here for holding on
to user content and then I'm not gonna
return this pointer to the user I'm just
going to give them a pointer to the
assign method on this object and so by
constructing my my return in this way I
don't need sort of a boolean variable in
here saying you know have I been
initialized yet and if not act this way
otherwise actor the other way
basically all the code in there can
assume that the object has already been
initialized because the access control
mechanism guarantees that by the time
any of these other methods have been
invoked everything's already been
initialized all right I'm going to go
back and do our final pattern here
yes
all right simplification all right so
one of the things you may have noticed
when I showed you that graph of
authorities that you get from the
editable text blob is that there was
sort of a hierarchy to these these
authorities I started out with a very
powerful authority the ability to read
and write this blob of text and then
when I decomposed that I got less
powerful authors I got the ability to
read and the ability to write and and
some other some other property
authorities for creating caretakers well
that's that's useful so long as it's
okay with in the sense of the
application to always be deriving less
powerful authorities from the powerful
ones and and having that structure of
authority but sometimes for application
reasons it's interesting to be able to
do the opposite you've got a less
powerful Authority but you'd look to
provide the user with a convenience link
to a more powerful Authority so I'll
give you an example of this right away
so I had the readwrite authority over
this this blob of text and I have full
read/write authority then I split out
the read authority and delegated that to
someone else and so were I to come upon
that let's say they passed that read all
authority back to me somewhere I found
it somewhere else we're to come upon I
could see that all well this is a read
authoritative thority for this text but
I don't know how to find it right now
how do I go about editing this page that
in front of me right now is purely
read-only how do I go about doing that
and so I'll show you how to do that
we're gonna we're gonna solve it using
rights amplification basically I'm gonna
take the more powerful authority the
ability to read and write I'm gonna
stick that inside of a box a box that
can only be opened by someone who has a
corresponding unsealer for that box and
so when I give you readwrite authority
over something I'm also going to give
you a nun sealer and now if ever you
come across the read authoritative edit
authority for you just unseal the box
that's attached to it and that gets you
to your editor and so I'll show you that
in action in the browser here
let's go back to our edit page and let's
go down to the read only Authority and
I'm just going to bookmark this
I got this reference here for the read
only Authority and and you know I'd like
to like to be able to edit this because
I want to change the content but I don't
have my editor accessible to me right
now
so since I'm the creator of this wiki I
was when I first created this wiki I got
the special special unsealer Authority
and so since this is my wiki even if I
delegate right access to certain pages
to other people at the end of the day I
get to decide what what goes in here
because it's mine and so I when I
created the wiki I got this edit
Authority and so what I'm gonna do is
take is read-only authority here and
send it to my own sealer and it's gonna
unseal the box it's associated with that
read only Authority and put me in the
editor for it and so this is what's
called rights amplification and so
whenever you get yourself into a
scenario in your application where
you've you've got the user in a very
low-power situation where they've got
you know a very very small amount of
authority but there's some other more
powerful Authority that's relevant or
applicable to it you can put a nice user
interface on that by just sticking those
powerful authorities inside of a box on
that less powerful Authority and then
you've got fairly fairly convenient user
interface that you see there for
forgetting not those authorities
question at the back again
yes to both the answers both questions
rather so the way this is implemented
here is the box is just an opaque object
that has the powerful Authority
encapsulated inside of it and there's
another object the unsealer which is the
only object which is able to break
encapsulation and pluck the powerful
authority out of the box that's the way
it's implemented right here as you very
quickly figured out though you could
also implement this using cryptography
and so I could serialize the powerful
law authority encrypt it using a private
a public key and the unsealer is that is
the private key and so you could you
could do these unsealing operations
without any network round-trips
so I promised you a small number of
patterns seen in a few number of ways
and we've come almost to the end of the
talk so it's time for the conclusion and
so the basic point that I want to make
here is that when we're designing
software that uses Authority and we've
got we've got two major problems that we
need to solve the first one is we need
to find an abstraction for representing
the state of the application that
closely corresponds to what the user
wants to do if the abstraction that we
create doesn't closely correspond to
what the user wants to do the user ends
up making decisions that we don't expect
in the user interface we end up calling
them stupid users and that's that's not
the end result that we want we need to
find an abstraction that closely matches
what the user wants to do that's the
first and most difficult problem once
we've done that we then have to create
an implementation that as faithfully as
possible implements that abstraction and
if we fail there crackers will let us
know about it
so those are the two hard problems we
face and the point I want to leave you
with is that reference graphs are a very
powerful language for thinking about
both of those problems
in time trying to come up with an
abstraction that meets what the user
wants to do you've got a very flexible
language when you're thinking in terms
of reference
graphs and then when you're implementing
that there's a straightforward as we've
seen here straightforward way of
implementing the precise semantics of
what references mean and so we can get
ourselves some some fairly strong and
fairly strong auditing guarantees that
we've implemented what we thought we
implemented and select the point I want
to leave you with and thinking back over
the patterns that I showed you I showed
you how to structure information using a
reference graph I showed you how to
implement an access control policy using
a reference graph I showed you how to
solve a causality problem using a
reference graph and if you think about
it you know solving now you know what
actions are you allowed or does this
application support and then in what
order are these actions allowed to
happen now that covers a fair amount of
what's involved in designing an
application and so I think we've gotten
a little taste of just how powerful it
is to think in terms of these reference
graphs and implement them with
capabilities and the other neat thing
about capabilities is that you guys very
obviously like whiteboards and drawing
graphs on whiteboards is very easy and
it's a wonderful thing to have a design
review when you can go and draw your
your design on the whiteboard and
criticizing it is a matter of erasing
certain lines and repositioning them in
another place and you can be very
specific with other designers about you
know how you're intending to change the
system and have very productive meetings
at least we found that to be the case
all right so I've got four minutes left
and I'll open it up to any remaining
questions yes another question in the
back
and you get without security
so that's that's one possibility is that
right sorry so the question was I
understand the caretaker pattern I can
see how that lets me create revocable
delegations but what are the
implementation implications of that
where does the caretaker object live
where do I have to host that what does
that do to the network traffic that's a
very good question
and so the first answer that the
questioner suggested was that
well if alice is going to send a
revocable delegation to Bob then one
place to host the caretaker would be on
Alice's host and so that means that when
bob wants to message Carol all that
traffic is going to end up going through
Alice's machine and that very well may
be not what you want however in the
example that I just showed you here the
server that the a loved it the the
equivalent of Carol the the text editor
that I showed you it had built into it
the ability to create caretakers on the
same host that was hosting the text blog
okay and though that was those
functionality that was sitting on the
Carol server and so in that case Alice
instructs Carol to create a caretaker
and then Alice delegates the caretaker
that resides on Carol's machine to Bob
and now all the network traffic is just
going between Bob and Carols machine the
same as it would have otherwise
all right lost two minutes for questions
another question
oh all of the above so I've been working
on systems of this kind since 1998
the latest incarnation of the tool is
available on SourceForge if you go to
water Ken watr ke n so two words water
and then Ken ke n sourceforge.net you'll
find a fairly large body of source code
there it's a server implemented in Java
that provides you with a server that can
host code and that looks like like this
it looks like this and so this code that
I showed you earlier it looks like just
normal Java code but I was interacting
with it over the web and so there was
some magic somewhere and the answer to
that question is the waterken server it
knows how to connect to Java objects
like this using introspection and create
the capability based web interface to
them and that's all open-source code
under the MIT license that you can
download and use as you see fit
I am
any more questions okay then thanks for
your time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>