<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ruby And Google Maps | Coder Coacher - Coaching Coders</title><meta content="Ruby And Google Maps - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ruby And Google Maps</b></h2><h5 class="post__date">2007-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wB-o6cCgcw0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so thanks everyone for coming to this
month Ruby sig talk the topic for
tonight is ruby and google maps which of
course is a special interests here at
Google and of course to the Ruby and
rails community I'm also pleased to have
andre-louis as our guest speaker for the
night just as a quick introduction to
Andre he's actually been involved in the
technology industry for the last nine
years his experience range from working
on some large-scale systems consulting
while Accenture also has been involved
in several startups and contributed to
open source projects most notably and I
guess the what 1 point 0 era we can call
it that he worked he was one of the
early hires and one of the key
contributors to cool boards calm which
was one of the top 50 internet traffic
sites of its time currently Andre spends
much as time as an independent
consultant developing Ruby and rails
applications in addition to consulting
on web two point O technologies in
particular if none of you have seen this
I yet i recommend you go see hot spot or
calm one of the projects he's created
which is essentially a community-driven
website for people to recommend Wi-Fi
locations and hotspots in various cities
throughout the world in addition these
days he's spending a majority of his
time on his new book Google Maps
applications with rails and Ajax for
those of you I think who takes special
interest in this topic definitely check
out the book when it comes out in early
2007 and for further musings and
thoughts I recommend you check out his
blog / khou.com so with that I will hand
it over to Andre thank you very much so
it's cool to be here I gotta say it's a
little bit strange coming into the place
where they actually make google maps for
me to talk about Google Maps
so I got a question for you guys so is
there anyone here who actually works for
google okay and is there anybody who
works on google maps I'm off the hook
yeah it's good to know no it really is
it's honored to be here and so let me
just tell you so here's the deal so I'm
writing this book for a press it's a
beginning Google Maps applications for
ruby on rails in actually been writing
this book and there's just like a ton of
cool things in the book and I've
actually been learning eyes as I've been
doing it and when essay form inviting to
talk here actually couldn't decide which
of the things to talk on so I popped it
on the decision and I've got three
different things i'm going to kind of
give you an overview on and then
depending upon what looks interesting to
you i'll go into that a little bit more
this seemed like a brilliant idea to me
at first that i realized i'm actually on
the hook for presenting potentially more
things so be nice to me okay yes in with
a respective you know reduction in depth
cool so actually so i got a really good
introduction but up so working on
technology for a while my background
academically i had i have a degree in
both computer science and philosophy i
was good to have that philosophy i
currently work for myself my book is
coming out first quarter from a press
probably in February March here's just a
fun fact is a I escaped from Alcatraz
not the breaking out of prison part you
might think but actually the swimming
from the island park and that is true I
didn't do that
so here is the so here's the three
topics that I'm prepared at kind of
various depths to to go into tonight the
first one is a imagemagick I guess more
accurately are magic and geographic data
so the motivation for this one is that
as so as anyone knows who's worked with
Google Maps you get to put you know push
pins on the map however you want there's
some real there's some real limits to
what you can do with that you obviously
you can draw a polyline just up to but
if you want to show things that are
really intricate on the map there's a
good chance you're actually going to
come up against the limits of what you
can do by putting push pins and poly
lines on the map what you can do which
is very very cool is I do dynamically
generated graphics on the server side
and throw those up as overlays on top of
the map and this really lets you break
through really any any limits you can
think of for putting things graphically
on the map so so that's one thing the
second thing is Google Maps custom
controls if you work with the Google
Maps API much you know that addition to
the regular controls the input on the
map the the the map type controls the
zoom controls the what are the controls
can you put on their navigation left and
right you can also implement your own
google maps controls in javascript so
I've been implemented one which i think
is cool of course I implemented it so
I'm sure that one to you and then if you
want we can dig into that code and kind
of see what goes into making a custom
google maps in control finally I'm going
to call it demystifying the Geo coder
I'm absolutely fascinated by this this
process of geocoding let's do this so
who who knows what you
coding is cool okay so geocoding is the
process of taking an address a physical
address and turning that into a latitude
and longitude you can then go and
reference on the map so if you're doing
anything at all with a map basically the
latitude and longitude is the the
language of the map itself when you go
and type and address into if you go to
maps I google.com you type in a dress
and imagine the kind of put two there it
locates that address you typed in it's
actually going through a process of
geocoding that address turning into a
lat latitude and longitude and then
taking it to you taking taking you to
that point on the map so that process it
was it when i say demystifying it's very
mystifying to me in the beginning like
how this works because streets and towns
all that stuff is something that grows
organically over time and latitude and
longitude is obviously a very in a
precise numeric representation of
location so going through that I'll
actually show you some examples actually
have a small geocoding database on my on
my computer I can show you kind of what
goes into making ogio coder
so with that I'm going to give you a
little bit of an over a little bit just
kind of show you a little bit of each
one of those things and then we can all
collectively decide what we want to look
at more so the first thing custom tiles
here is or yeah our magic great custom
tiles here is an example of a whole lot
of data displayed on a map so what this
actually is is we went out and grabbed
the FCC has a database of all their
communications towers and you can go out
and grab this data for free and then in
my book I talk about actually going
where to get the data how to parse it
and what to do with it and there's I
think there's like a hundred twenty
thousand of them in the United States so
what this map is is actually each and
every one of those FCC towers plotted on
a map and there's a lot of overlap but
there's actually I said there's over
100,000 points plotted there now okay
you can imagine if you what do you think
would happen if you tried to use the
Google Maps little like you know red eye
drop things to the plot 120,000 of them
any guesses
I think you probably hit the memory
memory let us see your browser about at
about well a thousand I think for sure
so what this is so this is a
demonstration of actually generating
graphics server side and then overlaying
them on top of the map yeah absolutely
okay and if I were if I were to zoom in
then it that would also it would you
know it would take it would zoom in with
you to the thing is on a laptop actually
so these these tiles are cached on my
computer right now i zoom in it's going
to have to turn for a while generate
each new tiles so so the tile is
actually generated and I'm going to get
like it in the end of the topic itself
excuse me so what happened the
relationship is that the map displays
each map tile is 256 by 206 256 square
pixel and you can see each one of these
actually represents one tile it's got a
little kind of annotation at the bottom
of it so how kind of goes up around
there the google maps api since you've
told it you're going to use a custom
tile yeah it and you give it a URL for
that tile it goes back to the server and
it asks for the graphic which should go
in that space now the google maps api
doesn't know this but will you what
you've actually done is that that that
URL then it asks for is actually going
to a dynamic server-side a generation
script that's that's which is written in
Ruby obviously now that script it takes
the the corner points of this tile it
queries the database for all the points
that are inside that tile
and calculates you know what your zoom
is what where your pan too and all that
stuff and then generates this tile with
all of that all those points on it that
comes back as an image and then the
google maps api overlays that image on
top of the map so the actual graphics
are generated by by Ruby show you just
another example of this up zoomed in a
little bit you can see that the image is
kind of coming in there so this is a
zoomed-in view and again you cannot you
see as you so if I pan off to the side
there then basically what's going on
right now and we can see this if we go
over here is that requests are coming in
to to my rails application for each
image that it has to display you can see
they actually filled in now so it so
scroll over to a new tile it says wait i
have i have an area here that point up
here i have an area here that is not
populated yet it goes back and
dynamically generates the image and then
the image gets a put on top of the map
make sense
so I get so that's kind of the overview
so if that's something you want to hear
more about I keep that in mind I will
what I have next here for so my comment
on this was basically to me this is
pretty cool because really the
convergence of two pretty fun
technologies one is dynamically
generated images on the server side
which obviously before I had never
actually done that before before I
approach this topic for the book and
when you start to do that it opens up
just a whole new world of things that
you can do you realize you can create
gradients you can create you can
basically anything you want to do in
Photoshop you can do on the server side
and when you start thinking in those
terms you think there's just there's so
many things that you can do so very very
cool i'll show you another example if we
talk about this more i'll show you
another example where i actually take
the the rails logo and put it on the map
instead of instead of the other thoughts
where else is everywhere
so see the second second topic with
which we can talk more about if we want
to is a custom zoom controls custom
controls in general actually
cool so this is a map that has the
control which i call Jeezy and applied
to it and you can see it looks pretty
much like a standard google map instead
of the zoom slider it's got the little
magnifying glass up there and that is I
guess that's the interface part of the g
ZM custom control so what I really
wanted to do is I wanted to provide an
interface where you could just kind of
outline the area that you wanted to zoom
into on the map so that's what this does
so if you go if you if you activate the
G zoom control you can see it kind of
shades out the map a little bit and then
you can go and just outline the area
that you want to zoom in on and you see
it's almost kind of like you know
opening up its taking the veil off that
that pic the area when you release your
button mouse button that it zooms in
that on the area it has kind of the
vestigial outline which disappears there
to show you where you just zoomed in to
zoom in on on Denmark since we're doing
rounds so yeah so that's Jeezy now this
is the code for this is purely
JavaScript it's all browser side code
but so again this is something that we
can if you want to go in and look at
that at that code we can do that any
questions so far right I have one
question on on the previous map that
you'd shown like the image that you
create the tile image it um can you do a
mouse over on any one of those points
that that's a great question so let me
actually come back to that we're going
to talk about that I will make sure I
answer that question good
as possible program you put up using yes
as simple as possible Google Maps
application is you can actually copy the
code right off of the the google maps
api site and they have it's basically
like i don't know it's like 20 lines of
JavaScript and a little bit of HTML and
you literally just copy that into your
browser and make sure that you copy that
into your into your page make sure that
you have a valid Google Maps API key and
you just hit the page and you've got a
google map so it's really it's really
very easy to get started so conceptually
that code does walk though it
conceptually you know you set up like a
rectangle you start off with or that
semester I think what is it down sir so
first the first thing the JavaScript
code does is well it reaches out to the
Google servers and pulls down all the
job all the Maps API code and then what
you give that is you instantiate a map
object you tell it what div on the page
the map is going to live in and then you
give it a center latitude and longitude
and you give it a zoom and that's that's
enough for it to display them out that
that it did the display map on the page
and then it gets more complex from there
how do you now that you've got this map
way to the page essentially somehow or
other your rating from that hit I mean
that get 26 points of the towers how did
you make that relationship how do you
know it came down for that that
rectangle swear let me so let me get
that's probably a little more involved
question to make it into that a little
bit later we look at the database I'll
show you like the database of points and
the latitude and longitude so that it
there so I'll go into that a little bit
more
so a third thing show here the geocoding
process okay so sighing to show you this
probably isn't going to look really that
impressive because all hidden behind
this beautiful interface that I have
here so what I have here is I have all
of the I have all the geocoding data for
San Francisco and I've got running my
laptop it's in a database I can show you
the schema if you want and I'm just
going to show you the actual geocoding
process so I'm gonna take a risk here is
anybody is there any address that
somebody wants me to geocode here we
yeah
Clark Clark way oh this is San Francisco
good San Francisco San Diego San
Francisco address well 45 California
1245
how do we do is it in between
leavenworth and Jones awesome it so so
what's going on here is so again all of
this usually if you do any kind of map
space project you use the fine folks
here at Google have provided the
geocoding service for free so you can
use their geo coder so what I've got
what I've got is a geocoding database
chest from San Francisco here I guess
the motivation for you why you want this
I can go into that a little bit more too
but basically we've got here is a
there's the point the correspondence
address and the polyline that's up there
is actually has to do with the way the
data is stored internally which is two
endpoints and an address and address
range for the two endpoints and then it
does an interpolation in between that to
see what where your address probably
falls on that line and the idea is that
you can imagine if you're trying to have
if you try to store the latitude and
longitude on each and every address your
database would be ridiculously large you
just couldn't do that so the way the
data is stored is again it has street
names and address ranges along those
streets and then there's a whole lot of
interpolation that goes into actually
establishing where a specific address is
yeah they don't always correspond a
corner so too I sure you like a yes I
so you can see the actual path itself
when you get into you know roads that
are there twisty yeah what gives you
actually is a series of vertices along
that path and here like it in urban
areas the paths are actually all pretty
short you can imagine in rural areas the
paths might be a lot longer and have you
know fewer fewer midpoints in them yes
it does so the question was does it
doesn't know the sides of the street and
in the underlying data that you at the
reload end of the system it actually
does have been information the geocode
or that I built actually does not
distinguish me and left and right
because well it just doesn't
cool okay so Zeus so that's kind of like
the high level overview now I'm willing
to so I'm going to take the risk i'll
put whatever code we want to look at go
into any details any of these things
what what sounds most interesting to you
guys to talk about put one two three got
13 13 13 13 word okay let's talk about
one who wants talk about two and let's
talk about three all right okay we're
going to talk about one first and it'll
talk about three and then if we if we
have some time we'll we'll talk about to
know there's my place I want to talk
about tuna ok ok so our mention sir who
who is used who has used imagemagick in
some form or another cool and who's used
to actually imagemagick for Ruby which
is the are magic ok so so for everyone
who hasn't used it i'm just going to
give kind of like the really kind of
brief overview guess I kind of did
already so basically our magic gives you
the capability to programmatically
manipulate images on your server and it
gives you a number of ways to do this
you can start out with a completely
blank canvas and start plotting things
on that canvas whether their points
lines geometric shapes it also lets you
start with an image and do kind of like
the things you think about doing with
Photoshop on those images so you know
scaling the image adding noise fuzziness
if you know flipping around doing
overlays basically anything you can
think of with
shop you can do with our magic allow you
get scale it so that okay yes it does
absolutely you have to you have to do
kind of a lot of jockeying around with
your knowing what what what zoom level
your map is at what your what your the
bounds of your map is and all that stuff
but yes I you know once you have kind of
all that all of that information then
our magic will do whatever you need to
do with the images so let me show you a
couple a couple I guess stepping stones
up to the the image that I showed you of
you know the entire United States so the
first thing is just and so image is
generated dynamically this is literally
the hello world of our magic and so
there's just an image properties it's
looks like I rendered it as a well I
don't know it's 500 x 100 but if i
refresh my page you can see that it's
actually rendered on demand so this
alone like this is pretty cool because
now you've got gradient image you got
something well what else could I do with
this the answer is you can do almost
anything with it you want now in the we
see on the code for which you should
absolutely
it's it's remarkably it's remarkably
easy to code let me see what this was
checked seven kids read this
alright so here's the assyrians the
controller for that so it's a english
test by the way so our magic is it's not
specific to rails at all it's actually
you know kind of natively a command-line
library so anything that anything you're
doing with it in rails you know you
could you can script from the command
line as well so so other steps up to the
coders a little bit in order to get the
gradient we declare the the fill up
there this is the zeros are the anchor
point of the gradient and then the from
and two colors when I said earlier that
you could you can start with a blank
canvas that's exactly what this does and
in fact the i'm calling a canvas it's a
type type image and you can see the 500
by one hundreds of dimensions and ben
specifying the fill is a third parameter
takes the fill that we applies to fill
to that candice the format's a gif it
could just easily be pain this is where
the let's see okay so this is just
setting up the properties of a of the
the text that we're going to put on that
the point size gravity is what our magic
calls kind of the location where the
where this object is going to basically
be anchored on the canvas and then
finally to actually apply that text the
canvas its text annotate and you pass in
the canvas and then here's the there's a
stranger passing in so
so cool so actual server generated
images so then the next step in that is
so remember what when I quite talked
when I said earlier that when you're
rendering those tiles that they actually
take kind of a long time to render
especially on my laptop so it is render
an image that you want to put on to a
map usually really cash it so the
pattern that's important to know about
here is so basically so this would I
showed you the image chat image test
every single time you hit that URL it's
going to generate a new image and that's
specifically what you don't want when
you're overlaying stuff on a map just
question if self dot film it takes
annotate can you uh can you elaborate
little bit this is that work for all the
methods or anything bodies there the
properties yes yeah that's right and I
think on that one let me see so it takes
a block see how it's like a very nice
so you're only filling for the text
right that that's right so yeah there's
kind of basically two forms that you'll
see in this this one actually mixes both
of them one is to kind of set all of
your things up up front and the other
one is to actually you know fill in the
some of the properties of it inside that
inside that block I guess I kind of
mixed and matched here yeah that's right
so the next
the next pattern that you're going to
want is called is image generating cash
so here's an example of that so if this
is just another simple images generated
server side but it looks like I ran this
a couple days ago and actually cash that
image and where I where I put that cash
is just pull this up
so it's test that pain so it's really
just a file like this so if i delete
that right now and hit the page again
then you can see it's updated to to our
current time but if I you know if i
refresh it now then it's not
regenerating because it is hitting that
cashed that cached image in my folder
and this is really key if you're doing
anything dynamic you're going to overlay
on a map most likely you're going to
want to to catch the images we just show
you
so the code code for this is it's really
pretty straightforward the only thing
we're doing is so we're declaring a file
up there but declared the directory path
to the file and then it really just
saying oh well that part's actually
making sure that the directory exists
and then here we're just saying if the
file doesn't exist then we're going to
go through the actual generation process
but if it does exist then we're just
going to jump right down here to the
send file and we're gonna we're going to
send out the image that are that that
already exists so you know very kind of
just your straight forward check of its
cash if it is send out the cash if it's
not then generate it does that make
sense so by the way it took me a little
while to kind of get all this stuff
straightened out but the step sent if
you want to send any binary stuff from
your controller then send file is the
way to do it this is this is what
actually this is this is magic line that
says okay what we're going to send from
this controller is not text to be
rendered by the browser to be
interpreted as HTML but it's actually
the type is it is image and the
disposition is uh is in line
yes so it's so in the case of image of
image tests they're actually it's kind
of transient right that it never gets
written out to a file so in that case
then you can just you send data you
could also write the disk then use in
use send file but again since this one
is you know this an image was transient
then there wouldn't really be that it
wouldn't really be too much point to
doing that by the way do you know does
anybody know what the disposition does
and what the other option is besides in
line
what's that good luck you think in CSS
great actually it's funny so I think
that Fiat what the default is actually
can't remember what it is but so so
basically if it's not if it's not in
line what it will do is the browser
instead of displaying it in the page
it'll download it and it'll ask you to
save it but I forget what the actual
would you actually put in there instead
of in line where you look at I would i
look it up on the via the rails API but
we probably don't want to lock it up now
okay
so okay so so so far we've looked at
generating a generating graphics
server-side so what was that to do with
maps let's get these let's put something
on a map so
take this into the mapping world
so this is an example of a math with an
overlay although a very boring overlay
this overlay is action so it's just it's
just the gray box but this overlay
actually doesn't even have any it's not
even an image it's just a div with the
border but i'm just showing this because
it's basically what we're doing is we're
taking two things and putting them
together we're taking the google maps
api and its its capability to put
overlays on a map on the one hand and
then we're taking this the server
generated graphics on the other hand
what kind of put them together so this
is approaching it from the google maps
api standpoint let me just show you kind
of it's literally just a div
so the code to do that if you want the
code the boring overlay code is this
basically what we're doing here is we
are to find the real salient yeah so
what we're looking at right now is
trapped okay right there front and
center so what we're doing is we're
creating a new object which are calling
a rectangle and we're inheriting from
the class that the google maps api
provides called g overlay so how many
people like to program in Java Script
man no JavaScript fans what was it so so
ok I like coding in java script so what
we've got going on here is basically so
you have there a lot programming Java
Script the inheritance mechanism for
javascript is you've got your you've got
your object or your class which you you
actually declare it as a function that's
what this is here and then in order to
actually inherit you've set that
functions prototype and what we're
setting the prototype 2 is this G
overlay class which is provided by the
google maps api now where this this this
overlay gets its look and feel is is
right here all we're doing is we're
saying we're creating an element which
is a div and we're giving it a border
which is it has a color and a weight and
really that that's all we're doing we
take in the actual size of it when we
instantiate this thing so I don't know
how much more how have to really want to
go through this code I get a sense that
it's more interesting to look at ruby
code then a JavaScript code ok so but if
you're going to create
these kind of custom overlays eight you
will see code that looks remarkably like
this question where's the dip getting it
sighs so
okay so
right here is where that overlay gets
added to the map so we're saying hey map
at and overlay to yourself would overlay
we're going to instantiate a new
rectangle and this the rectangle bounds
is the the I guess the size of that now
what we're doing here for the sake of
this demo is we're really just just
taking the the map view and I think
we're what are we doing exactly oh here
we go yeah I think we're just like
taking like I don't know like one
quarter of the map view or something
like that just just so the just so it
always shows up on the visible portion
of the map but you can see that this
thing is actually it is anchored to the
map so if i zoom in a thigh zoom out
then it actually stays you know it stays
true to the coordinates that it was
actually placed with on the map so you
know it does do a little bit more than
just you know plopping a transparent
devil into the map that way that boring
and so I was the other question by rjs
so my experience with RJ ass is that I I
found I very quickly hit the limits of
what rjs could do for you know for
coding against maps and as a result of
that I actually you know I guess I guess
you can say abandon rjs because I didn't
wanna it's actually a really good
question because what would happened at
least to me was I it's it's it's it's
more difficult to kind of live in both
worlds do both rjs and the JavaScript
coding so what I found is that when you
do this kind of stuff with maps you kind
of revert least I reverted you're doing
a lot more stuff in JavaScript and
really you know putting at rjs to the
side so any other questions yeah yeah if
I'm the only one who needs this over
here Tony I could use it 30 second
introduction kind of expanding on what
Dave here is asking about I'm just the
mechanism of how the map appears at all
do all of you know that are you know if
you don't when I sent the book thing
okay with every already yeah quick
overview of how that would absolutely
and how that map got there ok so for the
map to get there you've really got so if
all you want is your programming rails
and you want to throw a map up on the
screen you do have an option to do that
without any JavaScript whatsoever and
there's two options one is called
cartographer and one is called why m4r
which stands for yellow maps for rails
and they're both they're both plugins
that give you helpers a you know the
same way you've got your linked helper
and your form helper and all that stuff
these libraries will give you Ruby based
helpers to output the code you need to
get a map up on the screen so that's one
option you can go with one of those
libraries the other option is to
instantiates to you know start mucking
around in the JavaScript and act
getting the map up there which kind of
as as I was just saying is you know you
kind of hit the limits with those other
things kind of quickly if you want to do
sophisticated things then you kind of
end up reverting to JavaScript anyway so
let me show you the axial javascript
code
ok
all the distractions out of the way so
this code here this JavaScript code is
really all you need to actually put a
map up on the screen now it's basically
so once once you've loaded the
JavaScript API in I'll show you that
I'll show you that in a separate page
too then what we're really doing is it's
very simple there's a there's a quick
compatibility check to make sure that
the browser we've got is compatible with
google maps and it is not then your user
is really out of luck there just is not
going to say anything although if you
wanted to you know I guess you could put
like an alert down here and say get a
modern browser then what we're doing is
the gmaps to class is this comes from
the google maps api and you just
instantiate one of those it takes a
single argument and the argument that it
takes is the element on the Dom element
on your page that it's going to put the
map into it's a div so let's actually
i'll flip over to let me to show okay
unless you want does anybody want to see
the the HTML that goes along with this
I just don't want anybody mad at me if
any of you that's fine yeah that's fine
okay here's the HTML that goes along
with this really really straightforward
stuff oh so the the first script line up
atop this is basically just pulling the
the google maps api it under your page
the key which kind of goes off the end
there is your side that's like your own
unique key you signed up for that it
identifies you google knows if you're
doing anything wrong and then you can
kind of ignore that are the stuff the
the other script stuff so the other
important thing is is this this div
right here with an ID of map what we did
here is we actually gave an inline style
that said what the dimensions of the map
will be you wouldn't have you don't have
to put the style in line there it could
be you could specify the style and thus
the dimensions of the map in a CSS file
or you could programmatically set the
size and JavaScript once once you kind
of initialize things on the page doesn't
does that help that's great yeah so you
were you were halfway down through that
really the JavaScript when you switch
there before this so okay sure so I so
that bit there it just it gets the gets
the div that the map is going to be put
into and then honestly these next two
are really pretty optional because all
they're doing is say saying hey map go
out of control first we're going to add
a small map control then we add a tight
control the small map control is like
those little directional arrows let you
slide around the map type control is you
know map and satellite and combination
those three things so you know depending
upon what controls you want you going to
have have these or not have these and
then finally this is the this tells the
map where it's actually going what's
actually going to display right so it's
saying this is the this is the latitude
this is the longitude and this is the
zoom
but it's going to begin displaying at
and that's just the starting point of
the map from there you know it's up to
the user the user can navigate around
wherever they want so the zoom it's
arbitrary but it starts at so the
highest up zoom if you go all the way up
and you see the entire tyrell earth then
that zoom level one and the more you
zoom in i think the high esteem level
right now is 20 interesting a little bit
of trivia when google went from api
version 12 APR version 2 they actually
flipped the scale so it used to be that
that one was the highest zoom and the
reason they flipped it would be is
because they actually added a closer
zone level and in the envisioned adding
more closer zoom levels as time went on
and so they made so now that absolutely
and go up to infinity right you know how
we're close you want to get the map from
working what you say what you do I don't
think there's very many applications
around now we're still use version one
they're kind of deprecating it it is it
is gmaps to now right um yeah some there
was some rewrite that had to happen when
people went from one to two
so ya know I don't my latitude here's a
trick I'll show you show your trick to
getting the gang latitude so first of
all there's like some site out there
that will like let you do you can click
anywhere in the map and it will give you
it'll give you like ten Lana to I can
never remember where that site is so
here's what i do to go to Google Maps
you zoom in on wherever it is you want
your your latitude and longitude to be
so this is a little bit rough but for
you know for purposes of centering a map
it works so so you've got you've got
your thing kind of roughly in the center
there that you want and you can click on
a link to this page and right up here
just copy that bad boy right out and
paste it in your code can you see that
it's uh yeah so that's how I do it Zog
there with GPS another option two
cool okay so um alright so could you
could you could you guys code this it's
like you know if you wanted a map you
could code this right I don't know when
I first thought do you do you know where
to so let me show you if that's a good
idea what it is yet it's cute if you
want to do the the hello world of Google
Maps aside from waiting for my book to
come out that's very nice of you to say
search for Google Maps API what you got
here is so the very first page you get
you can sign up for a google maps api
key and let me see
Ariel yeah so as far as like kind of
getting yourself off the off the ground
I mean this is this is this is this is a
place to start until my book comes out
how do you usually i usually do we do a
time for questions too okay and what it
what do you what kind of time frame do
you want to usually the lucky okay okay
HTML for a second yeah ok so in the
script there the bottom archers in
doing at towers to JSON yep so you were
cashing on the client side / caption a
client side lobby is coming over and you
so hard wiring needs to the JavaScript
recently yes all the data in this
particular example yes okay so the
question is what's up with with towers
to Jason so the answer is in this
particular page I'm taking the data
structure all the points so I'm going to
plot on the map and just spinning it out
in JavaScript there on the page there
are other options this too not really
okay so let's think what well yes if it
is large enough then it is gonna have a
problem so other other options here are
you could put the the JSON data
structure in another javascript file and
just you know include that as a
JavaScript include tag but it's going to
have to parse it anyway so you've got a
thousand points it's going to have
trouble whether it's in lie on the
document or if it's in the other one
your other option two is to actually
load that data structure that data
structure up via Ajax after the fact so
first you initialize your page you do a
little Ajax request grab the JSON
structure from your server do an eval on
it so you translate that data structure
into or that that text that I gets back
from the server into a JavaScript data
structure and then do your thing to JSON
that that standards that's one of the
awesome things about about rails is that
it's got the the the Jason stuff like
really baked into an every active record
object has got to Jason just on it so
you're set so how are we doing I get
again I get the feeling where I get to
get to all three topics tonight yes let
me do little do Kenny okay let me show
you really quickly the the custom
overlay here's to kind of finish out the
topic that we're on
okay so what this is is so it's just a
map that centered on a on the Hawaiian
Islands and this is so there's not that
many points here actually can you know
zoom into it so what's happening now is
it is turning away plots had two points
in an overlay on the map so you can see
this kind of you know this dynamic
generation happening in real time the
the this border here is the that's also
part of the image it's being overlaid on
the map and it's basically just taking
the balance of the map and it sends that
back to my rails controller rails
controller kicks off our magic plots out
all the points and then spits the image
back so it can be plopped on top of the
map how did you decide where the points
are so that is a
yeah so so basically the factors so
obviously so in our database and I'm
gonna pull up the database right now but
the database has got a whole bunch of
latitudes and longitudes right so the
factors that you need to take into
consideration is first of all what's
what's the rectangle tangle that you're
plotting within so basically a latitude
and longitude it's usually done see it's
usually done northeast to southwest or
some reason I seem to be the convention
you need to know the zoom level the map
and you need to know the the actual
physical size of the map so you know you
eat so you can translate degrees of
latitude and longitude to actually a
pixel span so you can just imagine if
you know those three things then it's
really just a matter of kind of you know
crunching the numbers and in getting the
dimensions of your image right now
that's real question so the the formulas
that you actually use to plot these
things on the map actually take into
account the Mercator projection the
Google Maps uses you can even define
Google with google maps you can even
define custom projections if you want to
like build your whole thing then you
have to adjust your formulas in your no
no you're on your own with the map I'm
sorry good how you structure the
database so they look
this sort of information in reasonable
amount of time yeah let's let's blow up
the database really quick so so when I'm
using their the table i'm using is
towers
it slipped up and reverted to my
Microsoft sequel server syntax there
hope nobody caught that alright so in
the case of the ex et towers can you
guys see that at all ya know all right
the case the FCC towers I mean it's
really straightforward we've really just
got a latitude and the longitude column
and really all you for practical
purposes all you really need to do is
throw an index on both of those columns
and you're really pretty much set from
there if you've just got a database of
points that's really all you need to do
if you know if you want to do if you
want to do some you wanna do some other
selections then so here's the the state
that the tower is in you know you can
throw an index on there but it is this
any databases are graded this the fear
and stuff out through numerical
comparisons is really is really very
fast I'll show you the selection code
for that quickly this is ultimately
replace can I think know so the the data
source is actually a text file that you
download and actually building this
database and building the Geo coder is
so it actually so the book actually
steps to that stuff in detail so you'll
do you actually do all of this if you
step through the book basic overview is
that you download this text file I've
got some some command line Ruby stuff
that goes through and parses that out
cleans it up and in you know throws it
into the database and then from there
you know you just said you can use
active record and everything too
is this the database I'm sorry can I
give you a location-based service
oh you mean relative to FCC towers in
particular attention a question I maybe
you could I'm not sure
yes if you're doing that if you're doing
the image-side the server side image
generation you want to make sure that
it's up to date then yeah you would you
would want to you'd want to clear your
cache
so the question is how do you know which
which tiles to regenerate you could do
that I think the the math would be
tricky but yeah you could do that all
the information is there okay so Long's
1 seconds how we doing so we're eight
o'clock right now I think we're kind of
transitioned into question time what do
you what's the okay okay let's go over a
little bit and then once before man mr.
over to keep the question answered
afterwards of course long as you want
okay
No
so when you get the when you get the raw
data to build your geo coder your raw
data looks like this there's your raw
data for your geo coder now basically
what this is is so they decided not to
not to delimit anything in the data they
decide to make it every field fixed with
so you have to go through and of course
every field type has a different fixed
with so basically with this particular
file is there's about there's five files
you need to deal with each one looks a
little bit like this I you parse it all
through this this particular file
represents if each line is a chain of
points which you would then associate
with to address</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>