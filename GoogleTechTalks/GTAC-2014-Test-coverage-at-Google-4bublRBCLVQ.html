<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GTAC 2014: Test coverage at Google | Coder Coacher - Coaching Coders</title><meta content="GTAC 2014: Test coverage at Google - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GTAC 2014: Test coverage at Google</b></h2><h5 class="post__date">2014-11-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4bublRBCLVQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you so much
well my time where it's already off so
I'm an regula I'm software engineer and
in test at Google in Zurich and we work
with coverage for more than one and a
half years and now we're ready to share
some of the numbers we have so I'm going
to go a bit through the code review and
Google because it's important to
understand and given that both current
and an int mentioned code reviews I'm
going to cover it a bit define what test
coverage we're meaning it because we
have multiple times and that get the
numbers out and maybe start a discussion
with you I intend to use ten minutes and
five minutes for Q&amp;amp;A so good core
repository you know that we open search
the fact that yeah we have only one big
repository accept chrome and Android
that are separate and development
happens only at head and we develop in
multiple languages
and yeah with such a repository and a
commit every three seconds and it's at
this one we have changes that go
throughout the code so you can have UI
and in the morning you've had something
and in the meantime all the components
underneath have been changed so with
this in mind you might be asking
yourself okay so that means that the
built for Google free it's always broken
well funnily enough no and this is it
nothing small part due to the trade
review process oh this is the wrong
button so code review happens in Google
before check in this really make sure
that we don't break stuff it's web-based
streamlines so you can use it on your
commute home early in the morning it
doesn't matter it's very cool for small
incremental changes because it shows
exactly the two lines that have changed
and you can go in and it's mandatory so
there's no code change that goes in
without code review and
I see a couple of you nodding yeah and
it's helped a lot by automatic analysis
so the analysis what does it do well
from the very small simple stuff like
step wide compliance just to make sure
that all the code looks the same you
don't go in another team and you don't
you're not able to read the code anymore
until doing the test and running the
test for data path again one single
poster if there is a system that figures
out the dependencies behind to run the
minimum amount of tests that would
ensure that your change doesn't break
the stuff so it also has to be kind of
fast so in Google first response for
review comes after four hours so that's
the average if you're working with
someone your cube yeah that's half an
hour or so but otherwise that's the
average in Google so how do we fit test
coverage into this well we don't fit it
yet we set about reviewers and we have
two types of reviewers one is for
ownership that is person that owns that
code and has most knowledge of that code
and readability that this type gave
compliance and the reviewers will see
the results of this automated tools and
this is pretty cool because we are able
to see as reviewers okay the test but
failed for this you can send back a CL
and say sorry I'm not going to review
until you fix the test and that also
speeds up the process and then you end
up with the question okay how many tests
should I write in order to get something
done how much does the reviewer have to
see in order to say yeah okay this is
fine enough go and here we have tools
that help us and also for code coverage
so for code coverage we're speaking
mostly about statement coverage in this
presentation function coverage it's
pretty easy to get no matter the
language support because you can
heck into the language and get the
function numbers statement it's
something that has worked both in native
and also with some tools like for Java
with LP aspect-oriented programming
branch we haven't sorted that out yet so
we're we're getting results for some
languages but some languages we've done
and there are other ways of measuring
coverage for example UI to code mapping
that's there are some teams that are
working with research in that direction
but they're not yet there so based on
statement coverage we have two options
in Google both are obtained one it's per
project so we're running code coverage
on the whole project once a day for
example and the results are looked at by
the project team and the interesting
part is that people seeing this results
set objectives for the next quarter okay
we have to reach this number or this
number but the question is okay was that
number and how does that work and per
commit that is every change that goes
has also coverage results and we've done
this for more than one and a half years
within Google so projects that opted in
and we have more than 1,000 active
projects monthly Google achieves of we
didn't manage to get everyone in but we
saturated at least the users that use
the continuous test systems and this is
our conclusion so basically what we did
is we looked at the numbers and we say
guys the number to be reached is 85% and
why are we able to say this well we have
a lot of data but if we look at any one
month in the data for the active project
we see that the median it's at 78% the
75th purse
so these are the projects that have the
coverage enabled solution in Google so
the 75 percentile for coverage reach
there it's 85 percent and 90 percentile
is 90 percent that means people really
care about coverage but they also need a
drive there are a couple of projects
that really need to be pushed from I'm
not able to say how many sir and based
on this we also did a bit of correlation
okay how does coverage relates to
language strong tightness and it's
interesting because C++ for example has
lower coverage than Python for example
the numbers are a 53% 63 percent 70
percent and for JavaScript inviting
their shooting rating so and how did we
get there so we made coverage available
exactly at code review time this is a
snippet how it would look for a reviewer
to look at a change and you can see the
green lines where the code is covered by
tests and the red lines and based on
this the reviewer can say sorry your
change is not covered good enough please
go and write this for this in this case
because you're not there yet and this
worked pretty well so we observed a 10%
increase in the coverage computed okay
the first time you send the review and
the moment that change has been sent
into the repository so people are really
acting on this and we're trying to make
this even broader available so that's
what we kind of had to share with you
but internally we're aiming for 85
percent code coverage and that's
absolute code coverage there's a
difference between absolute and
incremental incremental it's per change
and they're very mean 99%
so legacy code okay we understand you
haven't written tests that's the code
that you work with for new code you
should relay in high of course this
depends on the language and the support
that you have and there are cases which
you just can't cover you'll have to live
with it also the tools that we have
really helped us push the numbers up and
the better we develop the tools the
better code coverage will have and okay
we're not saying code coverage is the
ultimate metric to code health now by no
means but it's a good signal it's
something that helps and improves code
health yeah and also keep in mind the
language differences there are some
languages for which if you don't execute
a line that line can do anything
think peyten yeah thank you if you have
questions Thank You Andrea great talk so
85 is the magic number
well good to know it's a six in the
internal memo but it helps to be rounded
down for presentation okay
two quick easy questions our first one
in your code retool
how do reviewer since you mentioned it's
a quick and efficient how do they ensure
they have context for what this change
causes since that API could be called by
any number of places in the stack that's
not does it tie back to them so they can
make sure that all the different
scenarios there is possible to for
example click on let's assume asking was
a function somewhere click on it and go
to the code but by default now it's
expected that if you're testing the
stuff and that bar it's green like you
covered it it kind of works so you can
jump to the symbols you can get the full
context by seeing the file but there are
small changes like one or two line
configuration changes or let's turn a
knob here and there
and for those you're sending the changes
to review to people that are familiar
with the code
so usually code review we think will you
do it with your team most of the time
and then you have cross team which takes
a while and those are longer reviews
over the ocean again time zone takes the
time but people treat code review as
part of the process so this is part of
our job it's not below code writing for
example okay so then the second question
is you mentioned that shows code
coverage the coverage number 85% how do
you know that 85% is covering the code
that actually matters like does it tie
back to scenario so that you can ensure
the story is covered 85 percent or 100
percent versus a numbers magic right
yeah okay the question is very good and
the trick is the following we're
speaking directly about code coverage so
what you're speaking scenario or case
that's slightly different we assume or
we assume that we are working directly
with unit tests so we are not
considering integration tests here and
we also assume that you have the proper
setup for this and we're helping the
teams that want to get there to get the
right setup for example code that is
added new should get directly coverage
because it's in certain locations and
certain configuration but what we're
working towards is making this available
no matter what your configuration is so
figuring out of the fly okay what
happens how this works which code is
relevant for this and was the number
that we have to deliver Jim yeah is the
code coverage to or is the code review
to code review tool that you're talking
about here is it open source by chance
that other companies could use as far as
I know I know that they're working on
something but I'm not able to give
any definite answer on that sorry no
problem</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>