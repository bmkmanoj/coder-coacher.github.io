<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GTAC 2015: Event Generators | Coder Coacher - Coaching Coders</title><meta content="GTAC 2015: Event Generators - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GTAC 2015: Event Generators</b></h2><h5 class="post__date">2015-11-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oDaQ8hvnPzM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">&amp;gt;&amp;gt;Yvette Nameth So next up, we have Roussi,
whose name I hope I'm not totally killing,
talking about event generators, from Splunk.
[ Applause ]
&amp;gt;&amp;gt;Roussi Roussev So Splunk is a search engine,
a log search engine. Like every other search
engine, it's useless without data. And as
you can see that blank page over there, it's
pretty boring.
There is no &quot;I'm feeling lucky&quot; button to
save you.
So engineers create what we call add-ons that
connect to the target system and pull the
logs. We also have what we call apps that
encapsulate the necessary information to present
useful information about those logs to the
user in terms of dashboards, visualizations,
charts, such as this heat wave, which shows
the amount of CPU use per host. It comes up
from our Hadoop app, which internally uses
a Unix (indiscernible) to get the resource
usage. Yeah, more useful than the blank page.
We have thousands of freely available apps
and add-ons that pull data from the software
that's all around us, from cloud platforms
to network firewalls. Someone even wrote an
add-on for (indiscernible) auto pilot in the
Nest thermostat.
There is a Web site called Splunkbase that
organizes that content, and people can download
it.
Unfortunately for us, there is a lot of software
out there that we don't have the specification
for or the source code or the execution history.
And we also have limited access to real production
environments, often on the order of a few
days or weeks when somebody is on site.
So how do we test?
Luckily for us, we have several physics Ph.D.s
on our team. And they all scream with excitement,
&quot;Hey, in particle physics, we had a similar
problem, and we got this right.&quot;
They use a big machine to collide particles
at high energies and see if something interesting
comes up.
Well, during the course of their research,
they have to deal with many practical problems.
The big machine is very expensive, in fact,
very few entities in the world can affect
it. Maybe Bill Gates can afford it. But not,
certainly, the poor graduate student.
It takes years to plan and build. When it's
finally finished, a lot of the time, it's
down for repair and maintenance. In the little
time that it's up, it's available to somebody
else, somebody else's experiment.
So physicists, they had to create event generators
to unblock their work and to allow them to
move faster.
Turns out event generators have been pretty
successful. It helps them validate theories,
estimate mass so that to see where to look
for theorized particles.
The code and the traits for the generators
are a form of specification that is passed
between the domain experts, the theoretical
and experimental physicists. And engineers
also use them to predictive &quot;N&quot; traits so
that they can properly test their detectors
and the rest of their infrastructure.
This is a part of the physics eventgen ecosystem.
It's pretty vibrant, as you can see. For every
particle class, there is an event generator.
And there are multiple event generators per
class, as people try to do better than the
guy before.
FORTRAN and C++ are kings, because things
need to be fast. And due to the nature of
the quantum mechanics, most of those -- and
the number of interactions that happen from
the initial collision until the final set
of particles are produced, Monte Carlo methods,
probabilistic methods are suitable to those
problems.
There is a public repository that organizes
traces from simulators called HepSim. It's
run by the ANL, the Argonne National Laboratory.
You can check it out. But warning, it's a
little -- those traces are a little big.
And due to the number of event generators
that are out there, and if somebody in the
audience has written one, excuse me, you should
excuse me if it's not on the list. Physicists,
they had to reach an accord for a common interface
and later a data exchange format so that they
can reuse their code. It's called Les Houches
Accords, named after the town in France where
that conference was held.
Well, it turns out, at Splunk, we have similar
issues. A lot of our very first and most successful
add-ons were developed on systems that we
don't have regular access to. To test, we
need to build expensive environments that
are also hard to replicate. And we try to
do that as much as we can. For example, over
time, we've set up those rogue test VPNs that
did get us some real logs, but also the angry
look of the Security team. Honestly, the engineers,
they loved it that they had extra choice that
they could connect with their latest version
of Mac OS or Linux when our primary VPN did
not support them. But, then, you can't argue
with security.
So another problem that we had is that a lot
of the software that we connect to is not
open source or free. So how do we test?
How do we set it up?
Trial licenses. It turns out it was a big
pain for -- to update trial licenses for every
30 to 60 days over many, many machines, over
many, many add-ons. Some of our test engineers
just wanted to quit. But I'm glad they didn't.
So we needed event generators. We needed them
badly. Our eventgens at Splunk, they produce
either key value pairs or full text logs.
We make sure that -- We use them to test our
apps to make sure that searches run correctly
and the dashboards are properly populated.
We also use them to test our core Splunk infrastructure.
And we found numerous bugs, especially related
to performance and scalability.
This is a diagram of our setup. Events happen.
They are detected, forwarded, processed, indexed.
Then smart people perform searches, ad hoc
searches, design algorithms for analysis,
reach conclusions, write papers, troubleshoot,
file bugs, all the interesting stuff.
In the simulated case, events are produced
based on previous knowledge and go through
the same exact pipeline.
And for the impatient -- and we engineers
are impatient -- there is a way to bypass
all that indexing cost and go to the -- straight
to the search, to mock search results.
Over the years, different teams at Splunk
have produced many different eventgens, again,
for their own purposes. And the next guy is
smarter than the guy before and does it better.
But this -- this is the one that we have posted
on GIT. It's written in Python. Comments are
welcome. Honestly, it's a little dirty code.
But it serves us well.
Feel free to write or contribute.
We require all the add-ons that we or third
party ship to contain event generation knowledge
so that they can produce sample data out of
the box.
We also require those add-ons to include transforms
into a common interface so that we can layer
add-ons and apps on top of each other and,
of course, their event generators.
Record-replay was probably one of the most
-- the oldest method of testing and probably
one of the most useful feature of our eventgen.
It's essentially a fancy way of saying, &quot;I
want to retrace all the parts that somebody
has observed in the past.&quot;
As the system is being used, traces are recorded.
Then they're replayed at the same rate at
which they were observed.
We also have a mode called backfill which
replaces a different trait, which we found
it useful for when engineers want to quickly
fill this in with data or when we're missing
data for a particular index or part of the
index such as between midnight and 4:00 a.m.
for whoever knows what reason.
There is also basic token replacement functionality,
which is just a regular expression substitutes
one token for another.
We found it the most useful for timestamps
so that we can test searches like show me
events between the last half an hour or replace
with the current timestamp for testing realtime
search.
Performance and scalability. I don't have
much to say. I probably can't teach Google
or Twitter people how to make things fast
or scale well. But here are some of the issues
that we've encountered. We play with a single
thread to make sure that events are ordered
correctly.
When our engineers don't care about the correct
ordering, we have something that we called
sample mod; and that can be parallelized.
With single-process multiple threads we are
bound by the speed of light in Python, the
global interpreter lock.
We get it around with distributed workers
in the message bus. Pretty standard stuff.
Honestly, the scalability of our event generator
hasn't been that much of an issue as it exceed's
Splunk's limits.
And the final slide that I have is on realism.
It's mostly work in progress. Our eventgen
supports modeling basic transactions when
there are common feuds between different sources,
between different logs.
It is also smart enough to recognize that
fields can have different formats but still
have the same value.
For everything else, there are extensions.
We use extensions for when events can contain
complex XML -- complex data such as XML or
JSON; when there are complex relationships
between feuds, I mean, and event such as internal
and external I.P. addresses; or when we want
to invoke fancy things like Python might have
changed libraries, the pymc.
Privacy is another big issue when it comes
to realism. Unlike the particle physics where
no electron is going to sue you for revealing
its path -- well, if something terribly goes
wrong, the government might want to know.
But in our software world, sharing logs generates
liability. It has to be approved by legal.
And we all know how strict they are. So companies
are reluctant to share logs.
Most of you smart engineers, you already know
that it's far easier to get proper access
to source code than it is to execution logs
unless you take a job at the company whose
data is of research interest to you or convince
an internal collaborator to clean them up,
zip them, and send them.
We've been exploring some -- we've been exploring
some privacy-preserving protocols, electronic
vaulting (indiscernible) encryption. But those
will take time to get practical.
So given those challenges, there is a lot
more to be done. Our engineers are not domain
experts in every software stack out there.
And we don't expect them to be. We are still
scratching the surface of quickly understanding
a system that we don't have a good knowledge
of. It's internal to the amount of logs that
we have.
And the other talks yesterday, they talk about
completeness and hard-to-reproduce bugs. We
also from time to time encounter them. And
we get bugs where the logs are simply not
sufficient to figure out what went wrong,
even at their most robust levels.
The good news is that new hardware, new processors,
they support tracing and hardware. When those
features are run, the reproducible bugs are
reduced to practically zero.
For those of you who have implemented tracers
in software, you already know how painful
it is to have a constant back and forth with
the chip manufacturers. (indiscernible) on
the new instruction break your tracer. If
you are lucky that it does, you have to figure
out how it works. You have to emulate it or
just throw the towel in and drop support.
Tracing at least at the lowest level, it belongs
in hardware. It's where it should be.
We don't quite yet support some of those lower-level
hardware features in our eventgen. But we
are working on it, and soon we might open
source those.
And the last point I wanted to make, I think
the industry and academia should share more
when it comes to machine logs. We are good
at sharing source code for those who tried
to understand it. We are good at sharing research.
But machine data still ends up being in the
wrong silos. Butler Lampson, one of the pioneers
computing and living here in Cambridge, used
to say, &quot;Why don't computers keep a history
of their execution?&quot;
I want to add to that, &quot;and might make part
of that history available.&quot; It works for the
physicists. I think it will work for computing,
and it will make quality better. Thank you.
[ Applause ]
&amp;gt;&amp;gt;Yvette Nameth: Thank you. So the first question
is: What is event generation?
&amp;gt;&amp;gt;Roussi Roussev: So it's -- so events essentially
represent a state that is essentially an output
of a system. And every event is an intermediate
state of that system.
&amp;gt;&amp;gt;Yvette Nameth: What are the most popular
eventgens available?
&amp;gt;&amp;gt;Roussi Roussev: Well, in the physics world
probably PTA is one of the most popular one.
In our machine world, I don't think there
are -- we have to write around.
&amp;gt;&amp;gt;Yvette Nameth: Can I define event in, say,
a Web-based software system and use it with
Splunk eventgen for testing purposes?
&amp;gt;&amp;gt;Roussi Roussev: Yes, we can do that.
&amp;gt;&amp;gt;Yvette Nameth: What is the API for event
generation?
Does it work with protocol buffers?
&amp;gt;&amp;gt;Roussi Roussev: No, it doesn't work with
protocol buffers. It just -- so there is no
need for Splunk anywhere in the stack. It
can just take a regular log file and then
output a file. But we have a lot of plumbing
that essentially talks to the Splunk instances
the same way.
At some point, we might support protocol buffers.
But it's not yet on the -- something that
our developers have gotten their hands to.
&amp;gt;&amp;gt;Yvette Nameth: How does one create an event
generator in Splunk?
Is that only set up by Splunk internal team,
or can any Splunk user set up event generators?
&amp;gt;&amp;gt;Roussi Roussev: So any developer can set
up their own. Essentially you need the configuration
file to say how the event generator should
behave. And then it also needs a sample trace
which we need to either replay or to sample
from.
&amp;gt;&amp;gt;Yvette Nameth: How do you evaluate the events
eventgen generated from a testing perspective?
&amp;gt;&amp;gt;Roussi Roussev: That's a good question.
Sometimes there is a big gap between what
we -- what we generate and what actually the
behavior of our software.
So for our own software, we virtually have
given the problems to interns.
[ Laughter ]
And actually Sira from Berkeley, she actually
created several make of models for our searches.log
about how Splunk users navigate through the
searches.
We also have created other models -- simple
models for replication, for network firewalls
when we have pick-ups and deny and accept
events.
&amp;gt;&amp;gt;Yvette Nameth: If events are caught in logs,
how often or quickly does Splunk index those
events?
Realtime?
And how are those events -- how is the data
kept?
&amp;gt;&amp;gt;Roussi Roussev: Yeah. It can index it in
realtime. And the length of time that it's
kept, it depends on the retention policy.
Some users want longer retention policies.
Sometimes it can just be kept into the hot
buckets for a few hours.
&amp;gt;&amp;gt;Yvette Nameth: Can used event generators
be used for sampling data?
&amp;gt;&amp;gt;Roussi Roussev: Yeah, well, our sampling
mod is what we are using. Essentially we sample
from the subset of the logs that the user
has provided. And we either output them to
log file or send them to Splunk.
&amp;gt;&amp;gt;Yvette Nameth: How do you determine if an
event generator is creating a representative
sample of what users might expect versus random
noise?
&amp;gt;&amp;gt;Roussi Roussev: I think I answered that
question earlier regarding interns to actually
build some of those models, those make of
models. Then we can actually use those models
to generate sample data.
&amp;gt;&amp;gt;Yvette Nameth: And one last question is:
How long do searches take to return results?
&amp;gt;&amp;gt;Roussi Roussev: Well, it depends -- it depends
on the type of the search that we have. Some
searches are more complex. Others, they are
just lookups.
&amp;gt;&amp;gt;Yvette Nameth: What's the sort of long and
short?
Like, what would be a long search and what
would be a short search generally?
&amp;gt;&amp;gt;Roussi Roussev: We have to scan, do a sequential
scan if you don't have an index for it.
&amp;gt;&amp;gt;Yvette Nameth: Thank you very much.
&amp;gt;&amp;gt;Roussi Roussev: Thank you.
[ Applause ]</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>