<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GTAC 2011: WebDriver | Coder Coacher - Coaching Coders</title><meta content="GTAC 2011: WebDriver - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>GTAC 2011: WebDriver</b></h2><h5 class="post__date">2011-11-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OsNkcUq0veI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright I don't know how to introduce
this next guy when you look at his bio
and you see him being the first hit on
steel cage knife fight search on Google
that's not actually true you're the
entire first page or steel cage knife
fight so I'm not details are probably
going to be pretty interesting Simon and
I share a reputation for liver issues I
think would be the way an affection for
beer a really really deep affection for
beer and technology and I don't know if
the beer was probably all consumed last
night but the technology we have today
Simon Stuart great so building a test
grid for the cloud greetings everybody
I'm Simon Stewart I work at Google as
nset and in particular I work on the
browser automation team where I am one
of the tech leads I think Ted is also
here he's sitting over there he's one of
the other ones as well what do we what
does a browser automation team do well
it's a team that automates web browsers
um
in particular we contribute quite a lot
to the selenium project i'm the creator
of webdriver as well and that forms a
sort of key part of our infrastructure
and what I'm going to be doing is
telling you how we've built out
infrastructure from the individual user
running on their machine to the
massively parallel system we have right
now how you can do that yourself and why
you might not want to so um the
important thing to bear in mind as I go
through all of this is that although
some of the ideas and some of the
concepts might seem very odd or like hey
there's no way we could ever do that
like we're not Google we don't have the
infrastructure we can't do this actually
you can it's it's not that bad and well
I say it's not like that it's been
horrific getting here but there are some
sort of fundamental steps at a really
high level that you could imagine taking
now the first step is you need to be
able to write tests the second step is
once you've got those tests written you
need to be able to to make sure they're
isolated from each other and then once
you've done that you can head to the
cloud and achieve complete to victory in
your testing so um why in the name of
all that's holy do we want to head to
the cloud oh by the way you may have
noticed there's lots of snails on the
slides the reason why I think we should
head to the cloud it's for speed and
when I was looking for a picture to to
using this slide I found a picture of a
snail and I thought okay that's fine so
I think that's a very handsome snail and
so like one of the problems we have in
this industry is that everyone makes up
their own definition for different
phrases like I reckon if I asked like a
dozen people in the audience what their
definition of the word cloud was you'd
come up with some fairly different
definitions I'm going to cheat and I'm
going to come up with my own definition
and the cheat the cloud is there to help
you achieve scale and what we want to do
we care about scale because if we can
scale out big enough we can we can
tighten the feedback loops we can
provide information to our development
teams and our test teams and we can
release products faster so as far as I'm
concerned the reason why you want to
head to the cloud is that you can take
your application you can deliver it
quickly and you can delight your
customers sooner with fewer defects
sounds pretty cool sounds pretty nice
that's why you want to do it so you know
in that little recap the very first
thing was right the tests who's
responsible for writing test cases who
here works on the team where the
developers just crank out code and the
testers the QA team are responsible for
ensuring that everything works properly
okay got some news for you I'm sorry
how many of you work in the company
where the testers outnumber the
developers as if that's over going to
happen
so let me get this straight there are
people in this room where who are
outnumbered by the developers and yet
they're expected to test everything that
these developers cranked out and writing
code is a fairly quick operation you
know especially if I don't have to prove
that it works like the math just doesn't
work the people who need to write tests
are developers or they need to be
empowered to write tests and that brings
some really interesting constraints in
to what your test system can be
developers that tend to be hordes of
them right you know they swarm all over
the place like like some sort of insect
plague given this we can't really afford
expensive licenses tools for all of them
particularly if we want them to own
their own testing right so those those
expensive commercial tools with the
license which are like 10,000 pounds a
seat that's not a good fit for a world
where we want developers to be writing
tests now the other thing as well is
that developers are a very picky bunch
and they don't like changing tools very
often unless they've picked it
themselves in which case i'll change
tools at the drop of a hat and and and
they're wedded to their ideas you know
it might be why might be Emacs poor
souls it might be IntelliJ Eclipse
visual studio might be slick edit might
be text Mike whatever it is but they
love their text editors with the fantasy
IDE stuff around it and that means that
any testing tool that we use has to be
able to integrate with that text based
environment that they have it needs to
be have an API an application
programming interface that they can use
so you want a test tool that writes in
code and that means that you can store
it under source control which means that
you can do all these things um I'm a big
fan of webdriver for exactly this reason
like I want my developers to be
empowered and able to write tests
themselves because they outnumber me
Google I think the ratio of sui software
engineer ESET software engineering test
which is what i am 72 one and that ratio
is getting worse at the moment we need
the developers to pull their weight and
you know since they're doing that they
can build the abstractions and once
developers developers are really good at
building abstractions all right and once
they've done that what they should be if
they're not find some new developers or
find a new company um once they've built
these abstractions there's no reason why
you can't repurpose those those
particular abstractions they've built
for your tests as well so maybe they'll
do TDD maybe they'll do this thing and
then you can come along and go by the
way here I'm a tester I I understand how
app should work and I found a bunch of
bugs i'm going to write some regression
tests will fix it build on top of their
regret of their infrastructure so um
back in the day quite a lot of people
are here now when they're building their
test grid out that's running tests on
their local developer workstation how
many of you do that almost no one wow so
what tends to happen here is you fire up
selenium the selenium server and you
fire up webdriver you use whatever
browser happens to be on your local
machine and you write your tests and
it's kind of fun and then you run into a
problem and you go hey Jim because
presumably one of your developers is
called Jim and what you just point at
someone Jim test is failing and sokka's
hang on let me check out the code
because it's all under source control
any checks out the code and he runs out
any guys it works fine on my machine
and this is one of the problems you get
right you've got these tests running on
your machine and your environment may be
slightly different from theirs you want
to be using a Mac they may be using
Windows you may both be on Windows you
may both be on a Mac we might have
different versions of Firefox maybe he's
got that whiz-bang extension installed
that prevents any tool from working on
his machine and maybe you do um that's
kind of sucky the other problem that you
have is that your machine even if it's a
pretty pokey one is underpowered an
end-to-end test takes a long time to run
yeah I mean you know a unit tests around
a single piece of code that may take as
many as 10 milliseconds to run has
anyone got an end-to-end test that runs
in 10 milliseconds if you do come and
see me afterwards we may have a job for
you so given that we can't make the test
themselves go faster if we run 50 tests
that each takes like 30 seconds we're
going to have to wait a really long time
for the test complete and no one's going
to do that I know I'm not the way to
avoid that is you need to be able to
start running a test in parallel maybe
you're still on your own machine at this
point but if you could run say four
tests at the same time then you can you
know / that the length of time if your
test suite down to a quarter of what it
used to be and that's actually quite a
substantial saving and that's really
really cool but it introduces problems
you may tend to drink as you solve these
problems it's deeply frustrating we
still don't get this right all the time
at Google but there are things you can
do to help reduce the pain of running
tests in parallel running tests in
serial you can modify the state of the
system and maybe one test here modifies
the state in one way five minutes later
and other test comes along and you think
it's running against clean system but
it's running against the system that was
modified over here
damn it when you run those tests in a
different order or maybe like because
you're now running them in parallel
things start failing and you'll get
really weird errors out of the system
and you'll run the tests and psych well
right now but I ran out on its own it's
fine when I run it is part of the grid
ran it in a parallel run I failed I like
one time in 10 there are a few things
you can do to reduce this we're talking
about data isolation here right so if
you can generate the data that your test
depends on in the test itself or do it
as close as you can to that test don't
rely on like being able to nuke the
database before every single test run
because that's a surefire way of making
your life really quite uncomfortable so
you've got test Iser data isolation and
you're setting things up and randomize
the order of your tests you know you
don't even need to be running in
parallel to start doing this and you'll
start finding all the places where
you're starting to break test isolation
that's kind of fun the other thing that
happens is there are limited resources
of certain kinds like user accounts or a
classic example and what happens is if
you have 50 tests running and four of
them have logged in as the same user
they're all going to see changes that
the other tests are making to to the
screens right and that's going to
introduce new sources of instability and
what I like to refer to as fun you can
you can avoid this in one of two ways
one way just create more of the shared
resource and you know make enough for
the one per test the other way of doing
it is to lock these shared resources and
hand them out so if you've only got four
accounts then you can probably only run
for tests at the same time the other
thing you can do is you can test the
change in the application state rather
than absolutes so when if you're writing
an email system for example and you go
when I delete an email there should be
and I've got one email in it in the
account and I delete an email i should
have no emails in the account that seems
like a reasonable thing to do but when
you're running in parallel maybe you've
got
the tests creating and sending emails to
the same account you've got these shared
resources the test itself should
probably read something like given I
have an email with this subject and it
looks like this and I delete it I can no
longer find that email in the system
that's a more robust test in the face of
changing changing state in the system
and that's the sort of thing you need to
be able to do test the Delta in the
application rather than the absolutes
that are hold when you're on your local
machine so you've now managed to achieve
parallel test running on your local
workstation it's time to scale out at
Google we built a system called the
selenium farm Jennifer Bevan gave a talk
about this at altech the very first
chetek back in the day and Phillip
herring go from thought works rotor
system called selenium grid which does
basically the same thing the selenium
farm was was various rooms stuck around
the campus of shared shared computers
running all east eric manner of of
browsers so suddenly like we develop on
linux most of the time at Google and
suddenly we were able to say to people
hey if you want to test with Internet
Explorer that's now a possibility if you
want to test with Safari on a Mac that's
now a possibility so we started being
able to offer more more types of
browsers to people and that court new
and interesting problems because it
turns out unbelievably that different
browsers do things in different ways I
know it's hard to believe um and that's
kind of fun yeah you know you can
suddenly start doing this you've got
this shared resource and and and it's
all tickety-boo um but there are
problems there are always problems it's
a shared resource right it's possible
for some greedy soul to use up all of
that shared resource on their own you
know suddenly being able to run 50 tests
in parallel you've got 20 teams running
50 tests in parallel your your
infrastructures and set up for that
worse it's a shared resource that you
need to maintain right you know with
selenium one if an alert popped up at
the wrong time
that would lock that particular session
and so what would happen is you'd have
denial of services and so you need to do
sort of clever tricks like reboot the
machines every n minutes and you know if
a test if a machine doesn't do a
heartbeat every five minutes then maybe
you tear it down and you pull it back up
and that will cause test to fail in a
sort of slightly inexplicable way
because it's being used by everyone um
that's not good the other thing as well
is that maintaining this pool of
machines that's actually quite an
intensive process you need an admin to
look after all this kit yeah you know
you need to pay someone to make sure the
images are kept up to date that you know
the machines are happy it's all good if
you're anything like like like I would
do I would probably just start building
this thing out in a cupboard somewhere
we actually had had a test recently to
see what would happen they powered down
the machine one of the one of the rooms
and it didn't come up again crap ah
that's not good yeah you hear stories of
like cleaners coming in and pulling out
the power cables so they can Hoover in
the room and that brings down your test
infrastructure you probably don't want
that to happen but there are ways to
address these problems it's spinal tap
um it's it's really really faint but if
you look the rating goes all the way up
to 11 I love IMDb and but you can
address these problems one way that we
addressed the machines locking was to
reboot them periodically well how many
times should we reboot them should it be
once every 20 minutes once every 10
minutes once every five minutes what
about after every single test so anytime
anyone wants a browser we give them a
new machine with a clean browser in a
known state and when they finish using
that browser we just nuke the machine
and that kind of implies virtual
machines right but virtual machines take
a really long time to start up has
anyone like got a vm on their on their
laptop and have they tried doing work in
that vm yeah exactly but their thing
there are things you can do to make that
less
painful you can take snapshots and a vm
image that would take two or three
minutes to start up would take about 30
seconds 20 seconds maybe if you've got
an SSD it might appear to be almost
instant but that's hey almost instant um
so you can crank that dial up and it's a
shared resource right but at Google
we've got this fantastic build system
you may have been reading about it on
our on a Google testing blog and we can
we can spread out to a vast build grid
effectively we treat it as being
infinite in size it's actually five
machines under my desk so you've got a
bill grid of infinite size why don't we
just start virtual machines on that bill
grid of infinite size and that means
that rather than having a shared
resource you run the vm wherever the
test is and that's super fast yeah so
you can parallelize your test you can
shove them onto this grid of infinite
size and you start a vm whenever the
test neet request a browser and you're
done right that's easy we've already
solved the test isolation problems sorry
we've already solved the test isolation
problems we've already figured out how
to lock shared resources our tests now
run in parallel and the longest they
take is the length of the longest test
it's kind of fun now Google we do this
we run over a million web test today
this way it's quite a few now I said
that you could build your own and I
wasn't lying selenium too now comes with
selenium grid 2 again written by a
Frenchman France are a nut who works at
ebay selenium grid 2 has the ability to
start up a virtual machine on demand
like we don't ship it with that but it's
a it's a plug-in and the reason why we
don't ship it with that is because there
are so many virtualization systems you
know there's the kvm modules for linux a
virtual box there we go that saw when I
was looking for vmware and you know
little solutions that everyone's working
on qm you box things like that
so you can take the selenium great idea
you can take selenium grid and then all
you need is a grid of infinite size has
anyone got one of those well it turns
out you all do amazon have been very
very patient and built ec2 the Elastic
Compute cloud so you can go out onto ec2
you can bring up the machines on demand
you can install the browsers that you
want on there and away you go you know
particularly if you're testing on Linux
so if you're willing to accept the
startup time of easy to which is 15
minutes a machine sometimes you end up
with quite a healthy period of of
sitting around then you can scale out to
an infinite amount of size and if your
test runs take more than half an hour
actually that's probably a really really
good choice so there you are you're an
ec2 it's all good except actually that
15-minute start time is really tedious
and you'd like to test on more versions
of windows internet explorer then you've
got available on whatever it is i think
it's server 2008 they've got running on
ec2 isn't it someone correct me if I'm
wrong no one's correcting me I'm right
Kevin will correct me now a bigger pun
2003 or 2008 okay so you can't do IE 9
for example you can do all you know wow
I should use this stuff more often yeah
so but there are these browsers that you
know you want to be able to test maybe
you want to test like ie10 beta that's
not that right good or you want to try a
really antiquated browser like IE 6 or
firefox 3.6 so you know you got this
damn it now we heard earlier about like
platforms as a service and testing as a
service and stuff like that there are
companies out there who have figured out
that it would be really nice to be able
to run your tests in parallel on the
cloud and so that's what they do has
anyone heard of sauce labs yeah a few
people so source labs are a company that
offers selenium testing in the cloud
they offer webdriver support selenium
too since the next version of water is
based on selenium to you can test your
water apps in the cloud you can test
your your selenium tests in the cloud
you know you can do this and they give
really fast provisioning time because
that's all they do and because that's
all they do they can achieve
efficiencies of scale it can actually
work out to be cheaper and going on to
ec to yourself because you know you've
got to start up the instances by the way
micro instance is an easy to probably
too small for doing proper web testing
you introduce some new and interesting
problems with that because you put the
internet in the way of your tests so in
fact you put more than one internet in
the way of your tests so you test here
and that's cool and you're testing on
the local in local host so that's nice
and fine and then you you test to the
app server that's running inside your
corporate land and that's nice and fast
and then you move out to the cloud and
suddenly you go test here with a
remarkably chasity protocol you go I'm
going to connect over the Internet to a
machine in the cloud the cloud goes haha
excellent connect back over the internet
over a VPN to the server on the land
goes brilliant gets a page filters it
all the way back because a I've got it
sends a response back to to the to the
test you put for internets in the way
can you imagine what that does to
latency I can tell you murders it really
not fun at all the other problem that
people have is like and we get this in
bug reports and selenium all the time
you go people go I've got a problem and
you go brilliant I'll help you fix it
show me what your problem is and I go I
can't do that and you go why not it's my
super secret application and it only
runs internally as like what is it it's
like time and expenses app are you sure
that's a super secret whatever it's fine
when we when we were testing wave
internally a google like they didn't
want to make use of the selenium farm
because you can take snapshots of the
selenium farm and we were trying to keep
it secret from various people and if
because it was a shared resource you
know if you took a snapshot at the right
time you might actually find out what
wave was so they had to build up some of
their own infrastructure there are
people who are nervous about these
things if you're one of those people
who's nervous about those machines those
things you need to find a room filled
with machines set up the virtual
machines and use selenium grid to
yourself but you're probably not it's
okay to go out into the cloud it's there
so to recap right tests I mean I'm in
the right place to say this but get your
developers to write the test as well
there are trade-offs that need to be
made here um you're going to need to
relinquish total control but they're
going to write all the abstractions for
you so you're going to have a whale of a
time just piecing the feelings together
like lego you can do that using selenium
webdriver I'm I could say this I'm
enormously biased ensure test isolation
so there are strategies to do that
randomize the test ordering lock shared
resources user accounts important pieces
of data things like that and parcel them
out and block tests from running until
those shared resources become available
if
access to the shared resources multiple
access to shared results is going to
cause trouble test the Delta for God's
sake stop testing absolute things yeah
but that's a recipe for disaster and the
worst thing is developers do this all
the time because I only run the tests
and the rain machine I of course like
there's one email there Dilys it's gone
of course there's thousand pounds on
that account and now there's nothing and
I've got a third account where I've got
all the spare change once you've done
that you're in a position to take your
existing test and head to the cloud if
you want to you could set up selenium to
the grid on a local network Kevin menard
at the back there he's one of the
maintainence of it as well you know it's
a fantastic piece of software is used by
a lot of people and it's really good if
you want to have low latency and go fast
it's not really good if you don't want
to have to maintain stuff use virtual
machines like pulling up a real machine
is is is a pain in the backside it takes
a long time and people leave things like
cookies around and the state of the
machine is is not necessarily known if
you're using a virtual machine you can
always start from a known clean state
and the nice thing is that you can take
that virtual machine image you can copy
it onto your local workstation and you
could run it there if you have any
problems that's kind of thumb if you're
comfortable with running things out in
the open and your time and expenses app
isn't super secret and you're okay with
the latency and actually it may not
matter it may not be that bad for you
like try it first heading out to some
night ec2 and maintaining your own
infrastructure or finding a company that
already maintains that infrastructure
can offer you a really nice way of
scaling out onto the cloud and doing
interesting things and finally the
reason why we're doing all this all this
work is so that we can tighten the
feedback loops we want a bit know at the
the shortest period of time from making
a change in our code base to verifying
that we haven't totally destroyed the
application yeah use continuous
integration all these pieces fit really
nicely into a continuous build
environment like Jenkins bamboo team
sissy whatever it is that that floats
okay make sense thank you very much
is that really the time it is we're
early is it Wow I run through that lots
of I can answer questions I think we
have a world record here of you're
always the first person with a panda I'm
just close to the scene you know Simon
thanks a lot very interesting topic
amazing talk so when talking about
starting virtual machines on demand yeah
so it takes like quite a quite a bit of
time so like style picking a snapshot
starts in the Machine setting it up in
the way you need to set it like for
windows it takes usually more time like
to it to domain and stuff like that have
you ever tried solving this by planing
what machines you might need and
starting them up in front before you
actually need them for to run your tests
like have you tried any strategies to
make it work oh so the early versions of
the selenium farm worked in exactly that
way sort of there'd be this pool of
machine sitting there and we'd fire up a
VN and then it would be ready and
waiting when someone came along and
that's financially hit bottlenecks like
the minute you write you run more tests
and you have virtual machines your back
to that state where you need to you know
wait for a new virtual machine to sort
itself out or you're in a world where
you're going to have to reuse those
things right and that's where you need a
grid of infinite size you know I I jest
about it but actually so that the
bottleneck is really how do we provide
these machines fast enough there are
things you can do to make provisioning a
virtual machine a lot faster one of them
is if you're still on rotating media if
you're not on an SSD then a virtual
machine / spindle is a really good idea
yeah and the reason for that is because
starting one of these things is
basically an exercise in I oh you know
if you've got a nice fast I oh and those
talk of sans earlier like if you can
pull if you've got if you're
fantastically wealthy you can store a
virtual machine on the sand and it will
be there in it in a second other things
you can do like it's one of the problems
is the amount
to data the needs to be read off the
desk here so you can do things like
compress the machine image before you
start so it loads faster and then you
turn it from an i/o problem to a cpu
problem and CPUs tend to be faster than
disks as a rule of thumb I mean it is
not always true you know if you can trim
the amount in memory that these virtual
machine images have down to the minimum
that you need then that's cool if you
remove all the other extraneous software
that you don't need then that will also
reduce the size of the machine image and
yeah so and that's what you want to do
you want to try and load the minimum
amount of data as quickly as possible
xochitl so you you're basically trying
to solve this by minimizing the time
machine takes to start rather than
planning up in front because that
probably doesn't work in in like
conditions where your resources are
limited and your eyes are usually
limited even if with Amazon you like if
you've got like 50 types of virtual
machines you might use like having 10
times 50 running just in case you need
them is very expensive in it yet and and
so you're making the trade-off here with
the initial cost of bringing getting a
virtual machine image and then you know
being able to minimize the cost to inter
in terms of dollar spend in doing that
and the other thing is well that's kind
of interesting is that you want to have
a roughly consistent period of time for
the bill that the build takes because
you know one of the really really early
warning signs that you see you in a test
but on a failing test is that suddenly
the build is taking three times as long
as it should have you guys seen that
yeah so if your test run time is wildly
variable because you know most the time
you can supply an image but sometimes
you need to spend 15 minutes pulling up
a machine then it makes it quite hard to
do that sort of seat of the pants are
like I know this test is failing its
exhibiting all the problems that these
things do so i think i would prefer to
take the hit on machine startup time
because it provides a more consistent
environment and i'm a sucker for
consistency does that make sense yeah so
just one thing guy that's on my mind
like for if you got continued
integration and you've got like specific
set of tests
that requires some specific set of
machines if you've got daily bills you
can launch the machines like 10 minutes
before the daily Bild if you've got like
build on demand not i mean built on push
like you can actually just start the
machines as push push takes place so
it's money when when the environment is
built you've got the machine is ready
yeah there are optimizations that you
can make mm-hmm yeah education is
important yeah I'm not opposing it just
thinking about like approaching the
problem from like several ways but like
you know premature optimization is the
root of all evil I'd wait until I'd
actually measured a problem before I
started like starting up virtual
machines it seems like a really good
idea I can't see why why it would be a
problem and that's exactly why it would
be a problem because you know anytime
you go hey look there's never going to
be any problems with this that is the
femtosecond that that thing becomes the
problem fair enough cool thank you hey
Simon just wondering if you can talk a
little bit more about how Google
actually runs the test and do you guys
run a million tests in parallel what
kind of test runner do you use how do
you break that down and also test
reporting how do you report the results
screenshots logs video stuff like that
okay um not not counting to five
machines under your desk yeah okay
excluding those damn it well then we
don't run any tests
so that that's a little bit about like
the google code base and the
infrastructure infrastructure that we've
got the google code bases on the whole a
single tree with all the projects tucked
away under that tree and we use four
main languages those languages c and c++
for sort of the low-level systems
programming python for scripting
javascript on the client and java for
everything else so you've got these
things obviously we've got end
developers banging away on this code
base we see about fifty percent of the
lines of code lines of code change every
month and at peak times we're getting
about twenty check-ins per minute that's
globally obviously a bulk of the
developers are sort of here in Mountain
View and there's also a group in Zurich
so you see daily spikes of activity we
tend to use whatever the the test
framework is that's most common to run
the tests themselves so Java J units
very popular and David saph is one of
the contributors who's managing the
releases works at Google you know on
Python I think we use PI test I'm not
sure off the top of my head we open
sourced the testing framework that we
use for c and c++ and if you look up g
unit that's where we use and then
javascript it's a little bit more open
to debate Jess units pretty common we
also open sourced a JavaScript library
called closure with an s not a J for you
java people the library called closure
and that's got its own test runner and
that runs in the browser so i mean
that's the basic stuff in terms of
presenting the results I think it's
pretty common that a a continuous build
system can pick up the results and
display them in a way that people can
read them I can't remember whether or
not we've made our particular thing open
available and people that are aware of
it so I'm just going to do a really hand
wavy answer
but yes we've got a central resource
hooked into our into our testing
infrastructure which allows us to view
the results of tests obviously we can
keep artifacts from those tests and I'll
just do the handle everything I know
that sauce labs for example do a really
good job of presenting logs and videos
and snapshots you know on their
commercial sort of infrastructure not an
advert but sort of I know that there are
systems out there that that provide that
as well and I guess if you're hooking
into some like Jenkins or a continuous
build server if you store snapshots in a
well known location that's cool and I
know that it's possible to record video
from ex fiancée so you can save a flash
video like VNC to swf or whatever
followed after it can be used for taking
videos there's an answer the question
wait wait yeah it's like we run into any
limitation so basically parallel
parallel oh sorry just like mass like if
you're trying to massively parallel lies
test runs yeah you hit like okay so you
have the grid running that's awesome but
do you hit other like bottlenecks as far
as the actual test runner like running
these or do you break them up into
logical areas or kind of how you get
around that I'll do a hand wavy answer
again or you could do a sales pitch for
how Google test software because that's
explained it in detail in the book my
friends and your is your choice totally
your choice okay my friend and colleague
the Octomom of test book publishing
James Whitaker has a book that will be
out at some point in the distant future
that describes all this assuming you
haven't got your time machine with you
um yes there are problems that you run
into you know if you take a look at the
open-source developed a mailing list of
selenium you'll see that Christine Rose
involved has spent his he seems to have
a hobby right he's got the biggest
machine known to man with like a
gajillion cause and more ran than he
knows what to do with and he just seems
to find threading issues and fixed them
and make applications provably correct
like he's a genius but those threading
issues only seem to occur when you're
running at high load yeah so one of the
problems is when you're running at high
load you're going to see new and
interesting performance things that
happen one of the other things is that a
high load you know if you're running 1
test at a time your serve is probably
going to be okay if you're running 50
tests at a time and you're hitting a
central server that's not only doing an
end-to-end test that's also a stress
test at that particular piece of
infrastructure and so it's pretty easy
to imagine sort of just flaking out the
server under test because it's not very
good by the way one of the common
problems that I see and it happens on
the mailing list you'll set people go
the Firefox driver hangs and you go it
doesn't work and as I'm pretty sure it
does like I've got an extensive suite of
tests to verify the listing functions
and what tends to happen is
for some inexplicable reason people
during tests will leave the analytics
bugs in an analytic service take a long
time to respond sometimes I'm you see it
without service as well sometimes ad
servers sort of take a long time and
we're pretty conservative with how we
detected their page is loaded if it's
possible and you really want a fast test
run then either hide your ads and your
analytics stuff behind a test flag so
that you don't see it when you're doing
the tests or put in a proxy or something
like that to make sure that that those
aren't the things that are constrained
in speed of your tests because you do
see that quite often hello hello and
this is Maria from yourself thanks for
the presentation and I would like to
know how do you handle test clean up
when running in the cloud for example I
have a some tests that runs sequently
and they clean up after the finish so
how how can we handle these when going
into the cloud okay um so there's a
number of ways you can do that I always
like to think of like testing at
different scales right so there's
testing that you do against the
localhost and you know in that case
you're going to start up a local
database you'll start up a local server
if you need a message queue local
message queue you'll start up the
browser locally and everything will be
running on the same box right and when
that happens test cleanup is like okay
well if I want to clarify that the
virtual machine is back in the clean
state i'll just dispose of the virtual
machine and start a new one and that's
cool and detail with the databases the
second level of testing though is where
you sort of putting the application
under test into an integration
environment or onto your production
environment and at that point test data
brittleness starts hurting like when
you're testing against your local
machine if you want to have a piece of
data or you just created and shove it in
the database right that's not a problem
but the time you get out of production
if you're creating data and shoving it
into the database you've probably got a
security risk there if you're working
for a bank you probably can just stop
work
now because you'll have creamed off that
the profit so one of the things that I'd
like to talk about and that to be honest
I never do because I'm a lazy soul is in
a local environment assert asserting the
shape of data in a local environment
creates that data and then by the time
you hit production you can assert the
shape of the data that you need for your
test and then that assertion will go and
find you the matching accounts that are
the matching stuff that hits what you
need and then you can reuse that stuff
but you never really see people
asserting the shape of data they're just
either assume it's there or that it's
not that I don't know if that helps
there was a question at the back no
we're in the front now oh we're in the
front Simon so question on generation of
page objects using the page factory have
any selenium-webdriver users
successfully created like a scraping
tool where you can point to a URL it
will scrape all the UI elements create
page objects using the factory you guys
provide does anybody or do you know of
anyone who's created that so we can
leverage that I'm by leveraging me news
yeah there you go yeah it's just
technically correct word leverage or use
yes yeah ok so it's selenium conference
last year there was someone who
presented a reboot tool that did this
you know you pointed at at page and when
a and generated like a gajillion things
for you I don't like that so one of the
things is sort of people look at a page
objects and they go that represents the
entire page right and then they probably
use inheritance to go this page is like
the base page and then this page just
like the base page but it's got this on
and and this page is like that page but
it's a little bit different and you end
up with these really deep inheritance
trees and then they go this page down at
the bottom is just like that page all
the way up except it doesn't have the
left-hand nav
this isn't good so how do you avoid that
problem and the way you avoid that
problem is you stop thinking of the page
as a cohesive whole how many of you have
heard of a browser called Internet
Explorer yeah most of you and so
Internet Explorer isn't actually a
browser it's a collection of calm
objects that are sort of bolted together
that give the appearance of a web
browser right your pages on your website
okay okay guys I'm sorry
unexpected that was that planned</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>