<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GTAC 2014: Going Green: Cleaning up the Toxic Mobile Environment | Coder Coacher - Coaching Coders</title><meta content="GTAC 2014: Going Green: Cleaning up the Toxic Mobile Environment - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GTAC 2014: Going Green: Cleaning up the Toxic Mobile Environment</b></h2><h5 class="post__date">2014-11-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/aHcmsK9jfGU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">October 28th 2012 and undisclosed Google
testing lab
until one day to see the world
ah geez
this one's battery was leaking
everywhere it's all over the entire tray
God am I gonna have to dispose of this
what in the world are you people doing
here without hazmat suits on don't you
know that this is a mobile testing
environment you guys could get
yourselves killed it's seriously toxic
here oh okay
iris we're going to need a
decontamination team deployed to section
three one four one five we have multiple
human infections with mobile devices
jeez you guys think this is a joke the
mobile development environment is toxic
we do things on devices that are not
reliable our tests are not reproducible
to run these reproducible tests takes
forever when they're running geez they
have no control over the device that
they're running on how are we going to
simulate what we need simulate scaling
G's takes a developer one or two days to
set up his desktop workstation with
devices to work if you're going to set
up some sort of cloud testing lab what a
quarter to T's and debugging that how
many things are going to go wrong in
this setup you're going to spend your
life debugging test failures who wants
to do that I can't believe you guys
walked in here on me look we're gonna
get you cleaned up
don't worry don't tell anyone okay I
want you to focus on all the areas that
we're talking about here we're going to
make your environment consistent stable
reliable fast totally under your control
and debuggable the decontamination team
has kind of identified four areas where
there's contamination the devices you're
running your tests on ADB your
applications and the test harness that
orchestrates the whole thing so pay
attention oh thank god Stephan you're
here our first decontamination team
member Hey
what are all those people doing here
there is really nothing to see keep
moving keep moving I have to focus on my
work I have to clean up devices look
they're not consistent
we cannot scale they are not reliable
and they're really slow so oh my god a
physical device lab oh my god cables
cables everywhere corroded connectors
look a leaking battery this device is
hanging in a boot loop that device even
does not boot man we are in 2012 the
mobile revolution just started and we
won't use this to scale this will never
work if we really want to solve the
problem we have to switch to virtual
devices hmm what about this Android
emulator thingy I found this picture on
the internet it must be true so let's
try it out okay let's start the Android
emulator so to configure so that our
idea is to get as close as possible to a
real device to do so we create a a VD
configuration we pass in some command
line flags some underlying qmo flags we
have some environment variable so it
looks something like this for Galaxy
Nexus and if you mess up one parameter
guess what the emulator will not put and
it's really hard to remember all those
flags in the right way so our solution
is we have a simple Python script with a
clear interface and it's really really
simple
we have bash completion tab completion
so you type something like virtual
device PAP PAP Nexus 6 pad tap 21 and
you get a device so let's go ahead and
launch the thing and run a test Oh what
happened my tests failed wait the thing
is booting but when is it ready it's a
little bit like baking a cake the first
time you better check several times so
let's do the same and block until
emulator is fully launched so we extend
our script and check several states like
this system server running or network
configured etc so now we have a nice
configuration Nexus 5 let's start it and
start installing our IP case what we ran
out of disk space on a virtual device
seriously I mean this should be easy to
fix there must be a command line flag oh
yeah I found it
Oh doesn't work across all API levels
what a bummer
ok that's the next solution hmm let's go
ahead and buy a new hard disk on the
emulator side we have two partitions
system and data they are represented by
two files and I just go ahead and
increase the size to 2 gigabyte each now
we should have enough space to even
install Google Play services ok so we
are launching the device installing our
apk is maybe we have the wire mark or
something so we have enough space and
now we are starting to launch our
espresso test UI test is working and
bama android what have had done you let
you treat me like that if you guys seen
this in a UI test ok I give you guys a
little bit of background so we run a lot
of tests and once in a while the system
decides to pop up a system dialog which
has nothing to do with our pests so if
we were a manual tester we could easily
dismiss the dialog and keep going but we
run in the cloud who is pressing the
thing so we invested a little bit and it
turned out there is a really nifty
service it's called activity controller
inside of Android unfortunately it's
hidden but has this ever stopped us I
mean we control the device so let's
write our own activity controller extend
our script launch it install the thing
and keep going
let's do contamination check so we have
a consistent device it's scalable it's
reliable I think
save to remove the shield oh my god I
totally forgot about speed it's still
super toxic it's red but I mean you are
guys if you have seen GTECH last year
you know there are known solutions for
it use KTM and use snapshots oh hey what
what happened over there reloading of a
snapshot file failed
oh let's investigate this outage oh it
turned out that my grading snapshot
falls across different machines does not
work and at Google we have a lot of
machines so say goodbye to snapshot and
let's think of alternative solution
let's step back and question why we were
using snapshots in the first place they
helped us to boot faster so let's play a
little bit with this Android device and
see what we can do so I turned out the
second boot it's always faster than the
first book maybe the system is
configuring some stuff so let's go ahead
and cache the first boot and use it
every time we start a device and the
second thing let's just go a little bit
deeper I mean we had some feelings that
the emulator is doing something by
reviewing the source code with mythic
Arab it's doing a lot of i/o operations
I mean a lot it's copying system images
two times and just by removing those
unnecessary i/o operations you're saving
five to five to ten seconds per stop and
in our environment this means we are
saving ten thousand CPU hours a day okay
now I think it's time for a little demo
okay let's start a Galaxy Nexus API 16
the molecular is running now it's
falling and the molecular started and
right in seconds its to contamination
check again we cleaned up
consistency scalability reliability and
speed let's check if I can hold off the
helmet okay easy to breathe oh man thank
you Stefan it's like seriously hot in
here I can appreciate being able to
breathe now we got all those devices man
where we can do with them what are we
gonna do what are we gonna do you want
to control them right you want to get
over who's gonna cross the bridge come
on it's only mostly lethal for those of
you that don't know the Android debug
bridge it's pretty much the only way you
get to do anything with Android okay
fine except it's extremely not reliable
if anyone's written a script with ADB
here's what you do you execute your
command you wait 60 seconds to see if it
comes back if it doesn't come back you
kill the command you kill ADB you
reconnect everything and you should
again and you do that three four or five
times and hopefully it worked on top of
that it's not consistent you can do adb
shell LS sometimes 50 milliseconds
sometimes two seconds totally random
distribution and speed man I have one
process another process I want transfer
30 Meg's of data on my computer 90
seconds
why how am I going to build anything if
I have to cross this bridge every time I
want to interact with my device
alright let's dig down what's going on
here when you type adb shell LS opens a
network connection to the adb server
running on your machine which opens a
network connection to the emulator which
take its packets and routes all its
packets through slurp which is this user
level network
tool thing from the 90s that was
invented so UNIX could do dial-up
networking it lives in the emulator
today pretty much magically those
packets appear on port 503 or seven in
the emulator ad BD picks it up
execute the command and shoves
everything back so yeah let's see is
fine jeez
well alright it's not fun let's get rid
of slurp let's bypass the virtual
networking stack now a couple of years
ago someone I think it was as noogler
project I'm not sure you know basically
replaced or edit an option to the
emulator um to bypass the networking
stack using this thing a DB D over Q mu
D so it's great we're not on the network
maybe that made things faster no pretty
much the same um also it was pretty
untested and unreliable and really hard
to use so like every version of Android
we would have issues with this and we'd
have to fix it up so oh and snapshots in
this man they were not friends so didn't
really do much here why are we having
all this trouble well it's the ADB
protocol itself right um the ADB server
kind of speaks in four kilobyte packets
to the a DVD so if we're thinking like
30 megabyte apk that's seven thousand
four kilobyte packets about oh and each
one of those packets needs to be act so
that's fourteen thousand packets and
that's crossing so many you know
boundaries what are we going to do with
this man let's put those lovebirds
together if they're both running on the
emulator together at least they're not
crossing so many boundaries and they can
exchange their little messages to each
other and we can deal in slightly bigger
packets and this was great we did this
using the Q mu pipe which is kind of the
same technology that lets the Android
emulator do its opengl graphics so it's
much more tested they make sure this
works we get you know 30 mega megabits
per second over this yeah but wait when
we're pushing data and we do top on the
emulator we see a DB server and a DVD
using 80% the CPU what come on this is
an i/o operation why are you using CPU
what are you guys doing and it's still
freezing we didn't fix that we just kind
of rejiggered things a little bit let's
get rid of it come on I just need to
execute a command and push some bytes
back and forth and maybe tunnel a
network connection that's a perfect job
for go
we kind of rewrote ADB and go and
optimize it for the emulator and we use
the nice cue pipe interface it was
awesome it was a drop-in replacement for
80 because we have lots of scripts that
fork out to it and we didn't want to go
fix them so this is great um with this
we have a brand new bridge look at it
and want taxpayer dollar money alright
and it just works it's very consistent
we got 20 millisecond overhead and it's
fast man I can get data onto the device
in like three seconds unbelievable can
we roll the video don't take my word for
all this like let's actually see you
done so let's do a TV show less a few
times to see this slowness and
inconsistency I'm talking about it's all
over the place how about we try it with
ADB chill out shell OS very fast and
very consistent let's install a 20
megabyte a PK relay DB is going to take
quite a while to do this and they will
peg the CPU wells transferring the data
now it has insulted it took about 15
seconds let's try it again with adb
turbo the data is on disk and aged 7
milliseconds and it's involved in seven
seconds
let's try something else let's pull the
data partition of the simulator it's
done in a second I'm not going to try
that with real lady because it takes
about five minutes
Oh ma'am I'm going to take these off
because I think we really cleaned up the
consistency area we're green here and
we've done our part to improve
reliability and speed we made things
kind of faster with ADB turbo but we
have a lot to go and I see Vishal
our next decontamination team member
please help us out here man all right
thanks Tom
I think they seem to be making good
progress in making our environment toxic
free so as application developers of
test is you want to make sure that you
know you are able to control your device
from the application itself like
consider you know one of these device
settings you know let's just take an
example here of entering or exiting
airplane mode now that seems like a
simple device setting right so all
they'd probably do is make an API call
and call it a day right that should just
work well wait you're going to get a
permission denied error
everybody knows the reason why no okay
that's probably because the way the
Android system is designed for any API
that you call you need to make sure that
you know your Android manifest or XML
has permissions for it all right so that
seems simple let's just go and add that
permission to our Android manifest XML
and found the test and then everything
you know just works fine now why is that
a problem this would happen with one of
the developers that I know for testing
they added a permission to the apps
manifest XML and launched it to
production right and be really what
don't want to do that so what are the
problems with this particular approach
the test apk runs in the same process as
that of your app under test it inherits
all the permissions that the app under
test manifest or XML has and every time
you you know you want to make a new
device setting change you had a new
permission and that's just going to
convolute your manifest or XML and your
users are just going to get confused as
to why these permissions are required
even though the app does not even need
it so how do we solve this at Google at
Google we get help from
good guy crack does anybody know who
good guy Greg is now go back leg as a
person whose access to all who has
access to all the resources that is
legally entitled to access what your app
may not have access to does anybody get
the drift here for I'm talking Bob
truffle you have all right kidding aside
you know our solution is very simple all
we do is create a body apk that
encompasses all the permissions that it
needs in its own manifest XML now that
it has permissions it can make those
device settings and it exposes all of
these things as services then we clear a
test shuttle class that sends up intense
to these particular services so that it
could make those device setting changes
you then all the tests then has to do is
make these static method calls to the
statue library let's take a look at the
sample test code you have a UI test that
extends from activity instrumentation
test case to all the test needs to do is
import the test util library and that's
about it it does not need to you know
convolute the app under test manifest or
xml the users are never going to get
confused as to you know why additional
permissions are required and your test
code is really clean with that I think
you know it's safe to take out our
gloves just because you know we have
good control over the application good
control over the device itself from the
application and I see another member
from the decontamination team you know
to make our environment completely toxic
free thanks for sure oh yeah that will
work
yeah man good guy Greg he's he's a
pretty useful resource we're actually
going to be hanging out later today but
let's do it you know a quick overview
here let's see we're consistent we've
got that going for us
but we're consistently unreliable still
we still have issues with scaling and
speed and control and debug ability I
mean this is just a toxic wasteland but
before we dive into the cleanup stage
let's see what we're dealing with what
exactly is a test harness so I explained
this with a story
I'm walking to work you know I work in
San Francisco and everyday I commute and
as I walk to work often I get stopped on
the streets of San Francisco by somebody
who says hey man run all these test
cases for me like if that happens to you
guys what are you gonna tell this guy I
mean I tell him to get lost and do it
himself but people in Seattle are much
nicer so you guys are probably going to
accommodate them right well the first
thing you're going to ask for is well if
you're going to ask me to do all this
work why don't you give me some test
devices I really like those Nexus 6 this
man they fit so well into the palm of
your hand okay the guy says here you go
man have a hundred Nexus sixes they're
all going to be virtual by the way but
you know that will do we know it works
so you have all these devices and the
next stage you you may want to install
your apks and maybe push some data onto
the device that you may be useful for
your testing now you're finally ready to
execute all your test scripts you do
that and at the end you report the
results right and the guy says thank you
so that's pretty straightforward you
know we all know about this process
right but man all along this path here
we have toxic wastes you know I don't
know we can't work like this
let's begin the cleanup so what are we
dealing with we have this huge Python
script at least it's Python that's not
too bad we can deal with that and this
Python script bundles everything
together by actually making sure that it
can launch a device it has a bunch of
code for that and running your tests and
why is that a problem well what happens
if launching a device fails all of a
sudden your test gets blamed that's not
fair I mean I wrote a good test the
device fails to launch that's not my
problem
and the second part is oh what do you do
if you want to run the test locally
versus in the cloud where it runs by
default huh looks like I have to comment
out some code here I have to find the
ADB port of the device paste it into
here
and like no developer is ever going to
have patience to do that they're just
going to give up so what's the solution
like every problem in computer science
we solve it with another layer of
indirection the device broker interface
is super simple you can have a device
but when you're done with it you give it
back and so what this gives us is if
launching a device fails from the test
harness the test harness you know can
actually mark it as an infrastructure
failure and it can even retry it and
because this is an interface guess what
we can implement a cloud data device
broker and we can implement the local
one so we have now better reliability
and better control all right moving on
so the next stage of staging test
fixtures and in the Java world in a
standard Java world we don't even think
about this we're running on the same
machine as where the data lives you know
like for example you may have a build
script with some test arguments it's all
in one machine so not a problem but this
is Android and on Android we run our
tests on devices not on the host machine
ok the solution here is pretty simple we
now have this awesome adb turbo let's
use it to push the data onto the device
consistently reliably and quickly and
good guy Greg lives on that device - man
so we're going to get help from good guy
Greg and access all of that data for
thou polluting our manifests with toxic
permissions it's all beginning to come
together right oh my goodness but what
is this looks like somebody was trying
to run Android instrumentation tests I
don't know well what's the problem here
if you do simple google search on how to
run android tests and actually michael
showed this today inevitably you're
going to be led to the instrumentation
test run or documentation page and the
very first option and that documentation
page is going to be how to launch all of
your tests in one grand sweeping
invocation
and I believe Michael mentioned that
actually spoon does this now why is this
an issue
oh there's many issues here first of all
because it doesn't know exactly what
kind of test cases it has to run it has
to do a cloth basket that's pretty
reasonable right well on Android this
takes forever and that's the first
problem speed and a very you know kind
of convoluted problem even more
important as a reliability the class the
class path scan will actually initialize
all of the static code not only in your
test apk but also in your app under test
so you may find this bug and you're
going to get all excited and run to the
developer who created the code and said
hey man I found the bug in your code and
the developer is going to say okay let
me try to reproach on my device no no
repro sorry why is that well we have
just mutated the app under test and
behaves differently under test than a
dozen the real world that is a really
bad problem and it's actually really
hard to debug and fix but let's say that
our test actually finds a legitimate
issue that's great let's say our test
finds a crash in the app and what
happens then well you know that test ran
that's great oh but all of these other
tests they're not going to get to run
remember we're running in one process as
the app if we crash the app everything
goes down we don't get that extra test
coverage that's really bad and finally
shared state our test engineering
favored friend right again we're running
all in the same process and as we're
running and hopefully we have lots of
tests we're kind of going to be likely
creating some shared state we're going
to be building it up as we run and
Android actually makes this problem even
worse Android is kind of stateful in
different ways for example if one of
your test launches an activity that
fails to shutdown cleanly your
subsequent tests may very well fail
because of that so all three of these
are huge reliability and speed problems
so how do we solve this there's anything
that you take away from my part of the
presentation today it's that you should
run one test per instrumentation call
and in order to do that you first need
to
tract all of the test methods from your
test apk and we do that by using a
utility called Dex dump we do that on
the host machine so it's much faster and
it doesn't affect the what's happening
on the device and that solves you know
like 90% of our problems or even more
sometimes there's shared state that's
persistent and we have to use a bigger
hammer so we also give an API to our
tests to be able to clear package data
between test runs it's not always
necessary but sometimes it is so with
that we've cleaned up probably what's
the biggest nest in the test harness and
that is the instrumentation and running
tests finally result reporting so let's
see what our huge Python script gives us
here
oh it's log cat that's wonderful and one
of my test failed let me go and debug
that let me search this log cat I mean
it has like info from maybe a hundred
other tests so I kind of have to
navigate this huge string buffer here oh
but I can't find the info for my test
what happened well Lochhead is a
circular buffer so sorry if you have a
lot of tests that data may be gone
already and not only that what our
device is also gone our device has gone
to a better place
it lives in the cloud so that's not
going to work and we've already seen
some solutions for that you know we just
collect all the things so let's see how
that actually looks like at Google
please roll video
and people we have a system called
Spanish capable of absorbing vast
amounts of data from tests and
presenting it in a web frontend here's
what the experience looks like for an
Android test we see here that in this
particular test target two of the tests
failed the history of the target shows
that it's unlikely to be tested
leakiness it's pretty stable
clicking back we were presented with the
exception of the test and we can see
that the test is expecting the string
12:36 to appear on the screen scrolling
down we can look at the screenshot and
confirm that indeed the string 1236 is
not on the screen but what happened
let's look at the video that goes by
really quickly so we can actually drag
it here and go frame by frame by
dragging it looks like there were some
clicks we try to pick a date and we're
expecting the date to be presented to
the user but it's not showing up you can
also look at odd cap and here I would
just like to note that it's pretty short
that's because only the walls from this
particular test run show up let's go and
chase down the person that introduced
the regression who is that person by the
way you guys know him it's a trick
question I was me so with that are we
green I think we're super green them so
we have devices while virtual devices
that are consistent and reliable and
fast and most importantly they help us
scale and I'm going to spend a little
bit of time here because I think it's
important to note that at Google we ran
some numbers a couple months ago we run
200 million tests per month that
averages out to be about 70 tests per
second so in the time that it just took
me to say that we just ran about a
thousand tests oh and here's another
thousand tests so scalability is
absolutely
for us and we have it with the emulator
with ADB we are again you know we've
rebuilt ADB and our bridge is now both
earthquake proof and it has wider lanes
and you guys saw a demo for that our
applications are free of toxic waste
from toxic permissions and our test
harness just orchestrates everything
together and make sure that it plays
beautifully and it doesn't affect the
reliability again and consistency and
gives our developers good control
so with that iris I report the contempt
the contamination of the mobile test
environment has been cleaned up
decontamination team please report the
staging area but wait so we kind of
finished with our act now we wanted to
make sure that you know it's 5 p.m. we
did something exciting for you guys and
we also wanted to sort of follow up on
our presentation from last year last
year at G Tech we presented this grand
vision of a battle against the manual
testing matrix and at Google we have won
this battle but let me do a little poll
here who here wants to take the slide
deck and is really excited if you know
6:00 p.m. on a Wednesday night to go
back to their desk and start
reimplemented all of this anyone ok I
see a hand there please send us your
resume you're crazy but we need people
like you on our team
yeah I mean obviously in reality guys I
think it's you you've seen here you know
we wanted to give you the technical
details you know just to prove that it
exists and developers at Google have an
environment that's green that allows
them to actually start you know writing
test cases and actually this is also a
very important point somebody mentioned
I don't remember which talk that
frameworks don't really matter
frameworks do matter I mean even if you
have this green environment you still
can have flaky tests and play
test has been the theme of this
conference right they're really bad
so frameworks do matter and at Google we
pretty much use espresso for you know if
you're doing Android development you're
going to be using espresso so with that
you know I think that we've proven that
this environment does exist we've
already released espresso and all we can
say at this point is that we would
really like to give this environment to
all of you so please stay tuned wait
hold on like we just like got this
brand-new clean world can't we do
something more fun with it I don't know
which way
wait are you you're don't say anything
man that's like a Google X project no no
the other thing
you mean like you mean like self-flying
cars no no no no no no no the other
thing the other thing ok yeah a video
let's roll the video okay I don't know
imagine if getting to a new device was
as easy as opening a new tab in from
Android in a tab makes that imagination
a reality simply select a device that's
running in one of our data centers and
connect to it over chrome remote desktop
these devices have been optimized and
are fully under your control
now maybe I want to change the network
so the device behaves as if it's on the
edge network well that's just a few
clicks away I can also do things like
playing with the battery levels of the
device so I can simulate a low power
situation and make sure that my app
responds properly the top is yours thank
you man that made me cry that's gonna
cheer up man
thank you mobile ninjas team that was
the best presentation thank you and by
the way Ashwin is picking up the tab you
know when we said the tab is yours we
really meant yeah the bar tab thank you
any questions any questions well it's
really fast at Google to just you know
do everything so you know it's really
fast to do things it's very hard to get
it out the door right ah this
presentation was pretty hard to do um
for multiple reasons and yeah but we're
working on it
yeah so related question from the
moderator I Can Has ADB turbo yes
yeah totally uh that's just another open
source release away in the night one to
the other I think the nice oh yeah man
it's so the nice thing about ADB turbo
and Tom can speak to it more because he
actually developed the whole thing as a
his go readability project that you
believe working on that but I believe
that it's fairly standalone right and
doesn't have a lot of dependencies so I
mean you can talk more to that so I mean
like it's purposely pretty Santa Mon
yeah kind of sits on top of like our
other launching infrastructure because
you know you need to set up a little
environment like Stefan was referring to
but yeah for the emulator we can we can
make that happen
yeah so once you're using Linux okay
another one from the moderator
what about espresso in any progress
moving to AOSP and during an open source
project we hope that somebody would ask
that question well since we were
preparing for this presentation we
weren't working on espresso but now
actually I was even doing some coding
today on it I think we're kind of
putting on the last engineering touches
on this project for example just today I
was trying to enable webview support on
API level 18 and higher so that is all
coming there's a lot of good stuff in
there I'm really sorry for the wait it's
just you know it's been kind of hard to
work on it but now the whole team is
working on it and I think it's just
weeks away so
and once it finally lands in AOSP you
guys are going to see kind of like a
release version of espresso and it's
bleeding head that we've always been
using um so we're going to do a lot more
work in the open for that yeah we really
hope that this is our last big release
and we just want to have a regular
release cadence where we just push it
out very frequently so you made a
strategic decision to automatically boot
the device to ensure reliability and
consistency in your chart do you guys
have data to back up that that has given
more quality to the test that run since
you're no longer simulating a user
environment by always booting clean and
double booting no actually we do do a
full boot so like the emulator has these
like disk image files right we push it
through a boot cycle we shut it down
nicely we preserve its disk images so
it's like you were turning off your
phone and then we make that like a
little bundle that when some test
finally needs to run that emulator in
that bundle I think what you're getting
at is that you're losing some test
coverage maybe because you're not
polluting enough and it's too clean
right I you know I think that it's
really important to layer your testing
so I think that you know Google we have
this thirty twenty ten rule so seventy
percent of your test should be very very
small tests we actually recommend now
using robolectric for that and a lot of
developers love it 20% of your test
should be probably UI tests that run on
espresso and maybe isolated from the
network you know the last ten would be
these like very big end-to-end tests and
even after that I think when all of that
is green you can do alpha testing and I
think that that may be a better place to
catch those bugs you know we kind of at
our last presentation in G Tech we
alluded to the fact that the majority of
the bugs you're going to find they're
going to be things like off-by-one
errors you know and you can find those
either with standard robolectric tests
or with your UI tests so I think that
that's the approach that I would
recommend for that
and then are you able to take a dog food
or image and put it in an emulator
someone wants to try to reproduce that
specific environment that exposed a bug
yes like all these tests when they're
running internally you know Stefan can
do something and say hey Tom I'm having
a problem
I can totally reproduce his whole setup
an environment so last call all right
thank you very much mobile ninjas</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>