<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Inside VMware Fusion | Coder Coacher - Coaching Coders</title><meta content="Inside VMware Fusion - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Inside VMware Fusion</b></h2><h5 class="post__date">2007-10-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QJPq_8ULpRg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the real gist though is that with any
computer what you want is applications
you know you might want your Safari for
web browsing or your iTunes or maybe you
want your your web services application
you know on the server side and the
problem is until today outside of the
web all of your applications are tied
physically to an OS you know by API is a
be eyes other things you know it's not
true for the web of course and your OS
until today has been tied to your
hardware so Windows runs on Intel
machines from Dell compact whatever Mac
OS runs on the shiny silver laptops that
we see picking out here and there I 123
okay I think we've met quorum of laptop
of mac laptops um this is you know
quickly becoming yes thank you we've got
the mating the mating call of the of the
macbook pro it's quickly becoming a way
of the past and virtualization and
Google are as well are trying to break
these chains and that's kind of the
point of my talk here is virtualization
freeze your apps from silicon chains
before you know you wanted to run your
favorite Windows app you know heaven
forbid outlook or ie when you have to do
some web testing you had to have a
physical install of Windows that was
tied to that box the the aim of VMware
in Google is to just break that chain
wherever you are your apps go with you
from Google's point of view it's
basically your apps are hosted for you
you go use your picasa you go use your
word editing your your presentation
editor it's all hosted for you VMware
takes kind of an inverse look where you
just take your entire computer in a
little bundle stick it on your iPod or
your external hard drive and just plug
it in wherever you go it runs on your
Mac your PC Windows Linux it doesn't
matter you've got the same platform
underneath so I wanted to decide to tell
you a little bit about how we got to
this stage application development has
gone through a lot of different eras you
know back in the 80s application
development was really centered around
source level api's we got the birth of
POSIX for the first time and people were
able to say hey
I can distribute my application just by
giving you the source code and it
doesn't matter what a West you're
running you can recompile it and it'll
basically work more or less you know the
good example is fork you know entire
operating systems were designed around
this one API to really no fork you
really have to know UNIX and vice versa
to have fork you have to have UNIX and
you know in the 90s when business
computing got a lot more popular people
kind of seized on the notion that okay
I've got these applications I want the
same application to work as I upgrade my
hardware I want binary compatibility for
my applications and Microsoft really
seized on this they made a lot of money
but as we're finding out you know in the
current ERA this is changing really
really fast people don't want their
applications to be tied to a physical
computer or a location at all so in the
current decade what we're moving more
towards is a virtualized infrastructure
where applications can actually go with
you anywhere specifically what
virtualization does is it brings the
Intel sorry VMware virtualization brings
the Intel binary layer the ISA to any
platform anywhere it gives you a whole
set of virtual hardware it perfectly
emulates the Intel instruction set
without people having to recompile or
change a single bite of their existing
programs so they can change they can
take their ancient you know windows
three dot one development environment
and just copy it import it into a vm and
bring it around on their shiny new
macbooks or good example is you know
there's all sorts of people in Japan
they've run power plants off windows 98
and that's all that they have their
software runs on Windows 98 and think
you can't even buy hardware for it but
the Intel is a actually stays the same
so you can actually install these you
know you could you could run a power
plant Network off of your Mac if you
wanted now an important thing to note is
that there's a lot of other people who
have tried and failed at this Java
really promised to provide another
virtual you know I so that people could
code to that would give the promise of
being able to be portable everywhere
we're on the same apps no matter where
you go we pretty sure that java's
promised to do that has failed at this
point two main reasons one is they
didn't really have a stable is a to work
from you know the Intel is a has been
around for a long time
I'm it's cruddy the current processors
don't even really implement that they
just they just emulated on a virtual
processor inside but with Java you know
everybody had to rewrite their programs
you know end times once for every
version of the Java Virtual Machine when
they broke the backwards compatibility
the vm gives you perfect backwards
compatibility at the machine instruction
layer and because it virtualizes out
there were restrictions of the hardware
you don't actually need to depend on you
know the version requirements that that
Java introduced but VMware didn't
introduce this like VMware did not
invent this notion virtualization any
people people have been doing this for
40 years now IBM introduced it way back
when with system/360 67 you know we're
time sharing again you know we've got
server loads that are completely spread
out all over the place and you know
we're just we're just visiting the past
like everything goes in cycles
virtualization really isn't just about
you know installing monster machines and
partitioning though because it gives you
an individual container that has
identical hardware wherever you go
identical machine compatibility you can
just lift it up and move it from your PC
or Mac to your Linux box or you could
have a cluster of server farms and maybe
the hardware isn't exactly identical but
I'm sure anybody who's worked in IT
knows you spent all your time installing
operating systems and you know your
applications are tied to that particular
install unless you have really clever
folks like the Google people who know
how to write massively parallel
applications the most system
administrators and IT organizations
aren't quite up to snuff with right a
huge you know massively parallel
architectures just yet so VMware gives
those people a way to make fault
tolerance distributed systems from
another aspect you know you you
basically take the computer out of the
respect of the picture and movie ends
into their own little compartments that
you can take around so what I wanted to
what I wanted to get is what VMware
brings to the table is specifically x86
virtualization so this was a really hard
this is it was only really hard a lot of
people said this couldn't be done
there's a really seminal paper by Popick
and Goldberg that a lot of people
latched on to and said you
you can't actually virtualize the Intel
is a it's not possible there's all sorts
of instructions that actually mess with
the internals of the processor that you
can't trap you know simple things like
call and return push f and pop f I mean
you can't actually trap and emulate
those at any time so you know what
VMware innovated in is actually being
able to rewrite these on the fly so that
they are safe to virtualize and that
lets us do it on Linux Windows Mac
whatever the reason I bring up the Intel
point is for the Mac market there was a
really momentous occasion in summer of
05 when Steve Jobs got up with intel on
stage and basically said okay we were
wrong all along powerpc wasn't the light
and it's time to actually jump ship I
know it's hard it's hard to believe for
the Mac heads who who heard all the
altivec and g5 promises and what was
three gigahertz by 2005 wasn't it or to
those before yeah it never happened they
jumped onto the until I say bandwagon
again which basically says it's another
platform that the intel is a is
supported on that can become another way
to have virtual machines on so the
engineers at vm were really new you know
this is gonna be something momentous
this is really huge so you know a couple
of us just started hacking around for
fun and eventually came up with what
became vmware fusion I hear that happens
a lot of Google people just messing
around this part there's their spare
time and coming up with something that
gets productized funny how that works
the difference on the Apple platform is
Apple builds products specifically for
one purpose their products are meant to
run apple applications they give you all
the api's you need to run itunes I photo
safari but they're not actually going to
give you the kind of robust tools to
develop a huge client server network or
a massively scalable you know database
infrastructure I mean that's just not
what they do if you're coding to make a
really cool image browser or multimedia
editor it's totally the way to go it's
really easy it's fast you know it's well
understood but if you're going out of
the box it's tough of course there's one
product that people want to run non
apple app
is that that is the iphone i wrote this
slide before this morning so i missed
this morning's announcement of the eight
of the new Apple API but it was true
when I wrote this slide that the iphone
did not run apple apps but if you didn't
hear this morning steve and now it's
from on high that we will get an api to
run to write our own iphone application
so that's actually pretty exciting even
for vmware virtual machines on an iphone
mmm too bad they're not intel so what we
did with Fusion is we focused on one end
use and use case which was totally new
for VMware which was consumers want
their max to run pc eps they really want
to run their outlook they want to run
their IE for web testing there's a
million little pc apps I use it to
update the firmware on my phone you know
there's just all these crazy little apps
that require windows support and
hardware and software and it these I
don't expect Sony to go out and write
drivers for mac for my phone it's not
very likely but they will support and
right drivers for windows and now I can
use a virtual machine to flash my home
the whole point of virtualization knows
that unlike things like boot camp you
don't have to stop all the applications
you've been using shut everything down
and reboot your PC apps and your Mac
apps are both first-class citizens with
virtualization so you can actually drag
and drop between your pc and your mac
you can copy and paste text share your
files and you know more and more the
lines get blurred there's even something
called unity that we worked on that
completely gets rid of the mac desktop
and you just got your your Windows
applications just floating there on your
Mac I'll show you guys a little bit
later it's pretty exciting it makes you
want to jump out and go you know grab a
Mac like this lady okay so she's really
excited about leopard and this is the
new OS 10.5 that's coming out that sent
all the Mac developers into a usual met
Steve Jobs Beatles style hysteria a lot
of things are really nice on the mac
platform but it's not perfect and what i
wanted to tell you guys about was
some of the lessons we've learned from
developing vmware fusion and some of the
internals of how we brought vmware
fusion to the mac so the mac platform
it's a kind of a bipolar situation and I
kind of like to give an analogy for my
favorite 60s TV show called the prisoner
the prisoner was a 60 TV show about a
super spy who came to this he was
shipped off to this idyllic island and
everything was perfect and planned for
you there was this beautiful scenery
everywhere and you could never leave the
village you were never allowed to escape
every every day he tried to escape and
there was a new face of the number two
who ran the village and it's pretty
similar to the Mac development world you
know you're kind of enticed into it by
saying oh what a cool platform we're
going to make exciting new apps for it
and then you kind of dive into the
inside you see that inside it's actually
four or five different operating systems
kind of jumbled together in different
pieces and as Apple needed different
pieces to build iTunes safari iPhoto
iWeb they use each of these pieces
develop them but there's really no
cohesive whole to learn these different
pieces you've kind of got to learn
through trial by fire and I kind of call
it the Mac club and there's the first
rule of mat klub and everybody knows the
first rule of mat klub is and you don't
talk about the mat klub so what I mean
by that is you know the api's there's
documentation but they're not telling
you what's going on under the hood and
they're not telling you about all the
side effects the scary you know
callbacks that are being registered for
you under the hood you know you really
have to dig deep with good books like
Mac os10 internals a systems approach by
mr. Hamid sing you can actually start to
learn some of the internals under the
hood but seriously before that existed
there was nothing and it was all this
handed down over the years really
interestingly you know how many people
here have done like windows development
professionally so I mean you've
interacted with Microsoft with msdn it's
kind of frightening but it's thorough
right and if you have a problem you can
right to somebody Apple's equivalent is
a once-a-year conference called WWDC and
you can sign up for wwc pay a couple
thousand and get direct access to the
engineers but other than that you know
there's no way to get information about
the actual innards of the operating
system you can submit support requests
but they're more intended to shield the
developers from the hordes of hungry
third party application vendors than
anything else so here's some of the real
rules of the mat klub so I wanted to
share these for anybody who's doing Mac
application development because I could
travel back in time and give myself a
couple tips before I started down this
road of developing vmware fusion with my
team I wish that we would have told me
the first big rule no in fear carbon
carbon is scary so before OS 10 came out
there was a huge legacy of api's all
jumbled together based on C and a little
bit of C++ called carbon carbon is
intended basically to support older
applications to get them ported with a
minimum of fuss if you start using them
in OS 10 though you have to be really
careful some of the stories that we
actually learned when we started using a
little bit of carbon vmware fusion is
basically based on our linux application
vmware workstation and as such we use a
lot of linux api's you know pull select
fork and we kind of assumed that mac OS
10 being unix or unix underpinnings as
Steve Steve put it was a true UNIX the
truth is that it's really split among
the UNIX side and the carbon side and
they really don't interact a good
example is when you there's there's a
library in mac OS called disk
arbitration and he'll tell you when
disks are plugged or on plugs you can
know in an iPod connector to
disconnected if you don't actually
respond in time so the disc arbitration
a function will secretly behind the
scenes register a bunch of callbacks and
ass and Matt goes we'll just assume that
you will write you'll receive those
callbacks by processing something called
the CF run loop which every thread has
one of these well if your app isn't
based around that concept of a CF run
loop you can just hang the entire system
for 15 to 30 seconds while mac OS tries
to repeatedly send messages to your run
loop saying hello there's a new disk
are you there hello there's a new disc
even if you didn't know the API that you
called had the side effect of
registering with CF wrong loop so be
very careful and know that your side
effects sometimes you have to go down to
the disassembly level as we know to
figure out what these api's we're really
doing a next rule about mat klub you
have to be really careful of angering
the universal buffer cache so on Mac OS
virtual memory is kind of a virtual
notion again where it's cached by the
same buffers that hold your disk cache
so if your photoshop or vmware fusion
and you reading a gigantic you know 1.5
gigabyte file OS 10 is going to cash all
of that in memory maybe even in priority
over other programs forcing them to
maybe even swap out to disk you have to
be really careful and very explicit
about you know when you do and don't
anger the buffer cache they do provide
api's to do that but again there's no
document that says PS you know if you
read a file if you read a large file you
better you know disable cashing on this
file or you're going to make every
single program on the system swap to
disk so be very careful about the buffer
cache the last real rule that I wanted
to share whenever you're doing dynamic
2d you have to go straight to OpenGL in
mac OS if you're doing things like
static layout of curves and text and
buttons it's great to use quartz and
cocoa and these hot very high-level
abstractions but if you need to render
you know video or a fast 2d drawing
stream you need to use other
technologies one of them is OpenGL and
normally I mean people don't think of
OpenGL as a 2d technology right you
think of it for video games doom and
quake and that kind of stuff on the mac
open jail is really the closest thing
you're going to get to bit blit on on
windows you don't get direct access to
the video around on the hardware but you
got the next best thing which is access
to video ram that will be composited
later by the window manager meditate
heavily upon OpenGL because it will
reward you once you learn that there's
lots of fast path so slow paths you have
to make very very sure that you can
recognize when you're being kicked off
to the slow path in open jail good
candidates are if you're using the wrong
texture type has to be be GRA you know
make sure that
you know you're not using anything but
15 or 24 bit color or you're going to be
booted off to the slow path so be very
very careful as I mentioned before OS 10
is kind of bipolar as we learned through
developing vmware fusion it's got a
chunk called mock so you know the Mach 5
is not a very good logo for mock but
there was the best I could find they
don't have a cute penguin or it or or a
demon or anything so the mac OS came
from CMU is everything good seems to
come from just kidding and it's a really
simple operating it's a really simple
operating system that just manages
memory management message passing
scheduling and a little bit of threading
you know really really basic stuff and
this was a reason the foundation of OS
10 but that didn't give them any actual
functionality it just gave them a really
cool abstraction so in a hurry back in
the next step days they dumped a huge
monolithic guy called bsd right on top
and the reason they did this is because
they needed file systems they need a
tcp/ip they needed you know unix
interoperability most of all so they
said we kind of shem a bsd layer on top
of mock and see what happens so kind of
got this top-heavy two-headed demon that
has half mock and half PSD and they call
it Darwin so maybe this one does have a
cool little mascot I kind of like the
platypus with the devil's head I don't
know it's kind of its kind of sinister
but we have to remember is that even
inside Apple their own kernels called X
nu which stands for X nu is not unix
this is really true I mean it's UNIX ish
sort of but if you really depend on unix
semantics for things like just as simple
as you know when you call a when you
flush right if you want to flush if you
want to em sync all your pages to disk
em sync does everything except for EM
mapped pages they don't tell you that
every other UNIX in the world if you if
um sink any page that RM map will also
be written to disk excuse me F sink I'm
sink is the one that does work right
excuse me f sink so you know if there
are all these little little Nidalee
things that aren't documented anywhere
that you just kind of have to just
discover through trial by fire but just
might keep in mind that if you're
porting unix code expect the unexpected
because it's going to
keep happening and so what we did for
fusion was we took the viewer platform
that was you know VMware Workstation
server player and we moved it all to the
Mac there's several components of this
that we ended up porting using a nice
sprinkling of different programming
languages and let in libraries along the
way the first chunk is I like to portray
here is like bit from Tron it's our
faithful you I it says yes it says no it
does whatever the virtual machine tells
it to do it's you know it's job is
basically to look pretty and connect to
one or more virtual machines running
behind the scenes one of the neat things
about our our infrastructure though is
that it's actually completely client
server based in that you eyes can talk
to separate virtual machines running
behind the scenes so any number of you
eyes can connect to any number of
virtual machines and manage them locally
or remotely so the the vmx is this a
separate process that runs that manages
a single virtual machine this is like
hard working Tron with his you know with
his faithful data disk he does the heavy
lifting of actually binding a virtual
machine emulating disks network cards
graphics he does he does all the stuff
of making the bits actually show up on
the screen of the Mac so he'll do all
the OpenGL drawing all the all the core
audio for sound and the mouse and
keyboard input so the UI and the vmx
kind of work together those are you have
seen tron probably know where i'm going
with the third member of the triumvirate
and this is this is the most interesting
part of vmware it's called the monitor
it's kind of like the master control
program in Tron is this giant spinning
we actually have a giant spinning top it
just kind of stares at us all day long
while we're coding tells us what to do
the monitors job is basically it's a bit
of Intel code you know that's it
identical on all VMware platforms you
know linux windows mac and all specific
releases of software can use the exact
same monitor its job is basically to
manage the physical physical resources
that a virtual machine actually needs
virtual machines basically depend on
processor resources and memory resources
and the monitors job is to make sure
that these are these are available when
we switch a thousand times a second or
more to and from of virtual machine back
to the host virtual machine back to the
host the monitor actually makes sure
that every all the registers are set
correctly the month the memory is all
available for the virtual machine that
needs it and that the advice versa that
the virtual machine doesn't overstep its
bounds so we talked back earlier about
the Intel I say until I say is really
hard because you have to trap all these
exceptions that aren't rapa Bowl so what
the monitor actually does is he'll
actually rewrite offending instructions
on the fly into a completely equivalent
but safe version such that the virtual
machine has no idea they were rewritten
but it gets the same effect on when it
comes back the the reason for that is if
the virtual machine could say do any raw
interrupt call that it wanted what would
stop a virtual machine from rebooting
your physical machine or taking all the
memory or scribbling over all over your
disks so it provides that boundary
between the virtual machine and the
actual hardware so um I'm crap just
kidding so what we learned in fusion
development is that you know you want to
stay out of the kernel of OS 10 as
absolutely as much as possible you know
there's sometimes that you can't avoid
it but by and large the vast majority of
the work that you need to do in OS 10
can be done in user space and if you
need some raw Colonel access the best
thing to do is actually to set up a
communication channel whether it's a bsd
socket or a mach port to communicate
back and forth between user space in the
kernel and so a good example is like
user space can actually do pretty much
every mock operation you know open ports
create tasks it can do everything a lot
of these I really aren't publicly
available inside the kernel itself so if
you're right in a kernel extension you
can't actually do these things but user
space can vice versa we just found we
needed to to work around a bug in one of
the colonel drivers know as 10 we had to
check what version of the kernel
extensions was loaded on the machine you
can't actually do that from inside the
colonel but you can ask user space to do
it for you do a little processing and
send you a message back up over
socket or a mach port so lesson the
lesson to be learned there is stay out
of the colonel if you can and I'm going
about I'll talk about the technology
that you can use instead again I don't
mean to pitch on its book again but if
you do need to go into the kernel the
only the only resource out there is
basically on its book so read it really
good so if you have to go inside the
colonel there's two main interfaces for
you to use when you're right when you're
writing your kernel extensions and the
immersion uses both of these which is
why I kind of want to talk about them so
I oak it came from some research from
the next days it's kind of scary
actually it's a big C++ framework for
use inside of a colonel I'll say that
again it's C++ inside the colonel if
that doesn't scare you I don't know what
will it is it is a restricted subset of
C++ so there's no exceptions no multiple
inheritance no templates but what it
does give you is transparent access to
things like buses so if you need to
interact with USB devices PCI devices
scuzzy any of that kind of stuff you
want to notify when the Machine goes to
sleep or wakes up you know synchronously
you have to do with Rio kick on the
other side of the jekyll-and-hyde
personality inside OS x colonel is bsd
so bsd you need to interact with it in
your kernel extensions if you need to do
any file system work any networking so
if you want one big thing that vmware
fusion does a ton of is transparently
bridging the networking inside a virtual
machine to networking outside and maybe
that's not too hard for like physical
ethernet but think about that for a
second for things like wireless right a
wireless card has one IP and one mac
address and you can't just put it into
promiscuous mode and start blasting
packets on the network like he could
with ethernet so there's a lot of work
that fusion has to do under the scenes
to make sure that things like networking
are just you know they just work for the
end user so if you need to do any of
that you know go to the bsd layer and
like i said if you must you must Fusion
has three main colonel components that
actually use use iokit and bsd we have
only called vm x 86 for the vm on his
job is actually it's mostly an
optimization task he's the one who
that's responsible for getting the
monitor that
huge master control program well it's
actually pretty small kind of cute
getting him inside the physical memory
of the Machine and locking those pages
down so that we can reliably jump to and
from it and makes it make it actually
run a virtual machine vm net is the one
that i just mentioned you know this is
what actually to talk to the bsd layer
makes virtual machines network
interfaces bridge if you want them to be
bridged or bean added if you want them
to beam added to be protected from
viruses or you know you don't want it or
maybe you don't have a DHCP server on
your local land you know it'll it'll
handle transparently setting up virtual
networks what's interesting about vm
that is it can be as simple or as
complicated as you want you know by
default fusion comes out of the box with
one bridged network one NAT network and
one host only network which means your
vm can only talk to the physical machine
for like researching viruses or honey
pots that kind of stuff but you can make
it as complicated as simple as you want
just by editing some shell scripts in
the library application support in
vmware fusion directory so if you need
to have you know a network that you know
specifically binds to specific net demon
that has specific behavior or only
allows two machines at a time or what's
another good example regis right so what
we just just said is you know you could
develop an entire network of virtual
machines that have layers of firewalls
between them and you could have you know
three virtual networks you can set all
of this up with vm net and they're there
as separate as physical Swit they're
really just like physical switches or
hubs from the virtual machines point of
view and the last kernel component that
fusion use is called v mio plug so v mio
plug is a necessity born on the mac one
big thing that fusion does that i
mentioned earlier is you can take any
random USB device like a cell phone an
iphone or a printer scan or whatever
even if mac OS doesn't have drivers for
it you plug it in while a virtual
machine is running and vm IL plugs job
is to seize that and connect it
virtually to one of the open ports in
the virtual machine so windows will just
pop up say hey I detected a new a new
scanner and even though OS 10 doesn't
have drivers for it it all it knows is
vm i'll plug is
the USB traffic for that guy and just
because it goes to Windows Mac OS 10
doesn't have to know know any better so
that's actually really handy that's
written completely using I oak it as a
must but so far I've just talked about
how virtual machines interact on the
outside with you know Mac OS and the
colonel components but what's inside
virtual machines is actually really
important to this is the other story of
the application is so important to the
virtual machine there's full
interoperability and integration between
windows solaris linux bsd even netware
believe it or not we we found out
network because we just broke the
network build less than I am really
embarrassed the the tools basically
handle full integration for drag and
drop so you can drag files in and out of
your Windows virtual machine to mac or
linux or solaris or freebsd you can
literally dragon files in and out of the
window copy paste to synchronize so you
just go into your text editor in Linux
and you can paste it into your web
browser around them on the Mac and it
also do more advanced things like you
know if the host needs more has pressure
on its memory we can ask the virtual
machine to swap some of its memory out
so that we can get that back for the
physical machine that's called
ballooning it's pretty cool technique so
you know it's really important to note
that you know integration with the
applications is really what we're aiming
for so another really interesting story
I wanted to share about fusion
development is we learned this you don't
actually need a mac to build Mac
software traditionally people who
develop you know apps for for Mac like
the picasa uploader you know you just
start hacking on it in xcode and you
know eventually you know it becomes a
full-fledged product but you need to
have automated builds you need to have
you know the your your build team needs
to have a way to generate builds on
demand and you may need you know your
friend may be modifying some shared code
and he might need to build it what we
did with vmware fusion is we actually do
the entire build on linux so the
entirety of vmware fusion is cross
compiled on linux a cluster of linux
virtual machines at
VMware the real big advantage here is
you know you don't need a physical Mac
to run the Mac build so I don't know if
anybody here has any way here worked on
cross platform software development okay
a lot of people have I mean it's really
common for somebody to edit something in
shared code the string library or the
formatting library and you know they
break some obscure platform because
they've had no way of testing the build
well you know when you when you
concentrate on cross compiling they can
just pop open a virtual machine
cross-compile inside that virtual
machine if they're running windows or if
they're running Linux they can just cost
nigga just compile across compilat
directly and test the build before they
check in that was a real big boon for us
but you have to be kind of careful there
are a couple things even though the GCC
is completely open source Apple's
moribund open darwin tools are there
they're kind of only mostly dead the
linker and whatnot are still available
but there are a couple things that
aren't yet available actually packaging
up a max offer for distribution people
probably seen PKG and dmg bundles um the
disk images and whatnot are still
completely proprietary and you do need a
mac for that final packaging step unless
you're clever enough to reverse engineer
it we're not that clever so you do need
a mac for a couple things but actually
for the building for the actual
development intend and making sure that
you know things compile and compile okay
you can actually do it all complete
outside of mac and in the future you
know if Steve Jobs gives the okay
there's no reason why Mac virtual
machines can't run on physical windows
or physical linux boxes you know so far
it's basically been mostly a licensing
issue but there's no telling what will
happen in the future I mean if you can
run you know Mac OS in a site a virtual
machine you know the possibilities are
pretty pretty limitless there but you
have to be careful right because Apple
is a hardware vendor they sell hardware
they sell shiny metal beautiful shiny
metal boxes that I see oh one two three
all right there's like 12 of them now
they're multiplying um apple sells
hardware and they don't want OS 10
running on average Dell and compact
boxes so you know the virtual machine
world an apple kind of collide they want
to sell more boxes you know we want
everybody to kind of consolidate
everything
to one box and save power and energy and
maintenance costs so you know we got it
got to find a way to cut the Gordian
knot as it were to make sure os10 can
run as a virtual machine so what I
wanted to finish up with is to talk a
little bit and demonstrate some of
fusions features we really thought
outside the box with Fusion this is a
demonstration this is a screenshot of
one of our features called unity this
was kind of born of necessity anybody
who's used parallels has heard of their
feature coherence this is a similar idea
where virtual machines can be running
windows and the host OS Mac can actually
display them as floating standalone
applications from the users point of
view right under mac desktop so even
things like expose work great you know
each of your individual Windows
applications shrink down and display on
your desktop just as if they were Mac
apps I mean it totally breaks down the
walls and again kind of focus on the
point that the application is king
whether you need to you know contact it
over a web interface to a server ring
somewhere or run it natively on your Mac
because you need you know the speed to D
or even 3d right one of the big the big
sticking points for a lot of people i
know with mac users is they still need
to play those pc games you know
everybody wants to play bioshock or halo
3 or whatever comes out is halo 3 out
for pc probably not we will in a year or
two so there's always there's always
those but virtualization is getting to
the point where you can start to play 3d
games and fully interact interact with
your your virtual machines they're right
on your virtual machine zaps right on
the desktop so I wanted to give a quick
demo of some of some of fusion here so
all right see if I can actually get to
my window here
you got to do it okay cool so we have
windows running here this is all inside
a virtual machine in full screen mode
here so you know I have very very
important work to do on my my windows
desktop you know I often have to play
solitaire it's very very important to me
and the very huge a short coming and the
mac that we don't have things like
solitaire but you know why stop there I
mean why not go for things like full 3d
games so this one I have a pretty old 3d
demo here but i'll show you guys some of
the stuff that fusion can do now so this
is just a you know passmark test I can
do 3d 3d graphics so this is just in a
window here so you can actually you know
you can actually do this is actually
using hardware acceleration so it's
actually translating everything to
opengl on the fly you know it's it's
pretty cool um you can do things like 2d
games so you know I can run my very very
important bookworm adventures you mean
you have to have book more adventures
you know you can run your IE for testing
your google desktop you know very very
important on Windows and if I don't want
to interact with the full screen you
know I can just leave and go to go to a
window so I can interact with it you
know anyway I want you know whether
whether I want it to just be a window
you know floating around no I don't want
that yeah so this this is also a very
key feature for me it's playing bookworm
adventure between builds so uh I got a
good word here squishy squishy yes whoo
very exciting nice get him hahaha okay
cool
but let's say I don't want to have to
deal with you know the Windows desktop I
can actually escape from the confines of
the Windows desktop and go into unity
mode so now my windows applications are
just kind of floating here on my mac
desktop so you know I can have my mac
apps and my windows apps kind of side by
side I don't know why my desktop showed
up there you can you can do a lot of
interesting things because your Mac apps
become kind of fully integrated with
with windows and vice versa so it's
pretty exciting there um let's get outta
gonna do what oh actually that was my
that's why that wasn't my windows back
top that was my mac desktop I was
forgetting cuz I didn't see my uh my
icons there that wasn't very exciting
actually let's get let's get the mac
dock over there here we go okay so you
can see we're actually in mac OS here so
if i need to open up you know i don't
know IE or something because you have to
do you know a lot of things that that
fusion is all about is getting access to
those apps that don't exist otherwise so
i can go into unity mode and there you
go so now we have IE and my mac
applications kind of side by side so i
can open up you know finder and let's
see where's my Finder window here it is
so I have my Finder windows my IE
windows and they're all kind of they're
all kind of interacting so you know if I
minimize them they go into the dock I
own minimize them they come back it's a
pretty cool way of interacting with
virtual machines so that's basically
that's basically my chest is you know
virtual machines are really coming along
there we're looking at it from an
application development and distribution
standpoint we really want people to
think about if they have to interact
with the hardware and they don't have
the resources or the know how to make a
widely distributed fault tolerance
client server system like you guys at
Google do you know they can take it from
the other direction and take their
existing Intel apps as crummy as they
are maybe they were written 20 years ago
and package them up on a virtual
that'll run on any Intel box mac windows
linux whatever they have lying around
and run perfectly like there's there's
no java vm that might be different on
Mac or Windows or Linux it's literally
identical and the same virtual hardware
is available wherever you go so um yeah
so that's basically my presentation I
wanted to take any questions I have so
is it first internal and then external I
mean first first external and internal
internal than external the Q&amp;amp;A session
okay so okay guys so come on up and ask
any questions you can come up to the the
microphone or come on or coming up I'd
love to answer anything about Mac
developments fusion and specific how we
did what we did how we got here and what
we learned along the way right there I
was a wondering about you use VT the
beach instruction set do you need steal
the monitor if you use VG so the
question is do we still need VT dou
stantly the monitor if we use VT so VT
is an extension developed by Intel at
VMware actually worked pretty closely
with Intel and the other hardware
vendors to provide a hardware-assisted
virtualization the big thing that was
really hard with virtualization until to
begin with was like I said trapping
these naughty instructions like return
and end and and mu and you know push f
and pop f VT extensions basically gave a
made the task of writing a virtual
machine monitor a lot easier what we
found with VT was the performance with
VT is much better for certain tasks and
much worse for others so things that
require a lot of context switches like
system calls perform way better under VT
so we provide it as an option in vmware
fusion certain things you have to have
VT for like segmentation protection was
actually removed from the original
64-bit intel i-64 instruction set that's
re 9 is 54 the the amd64 instruction set
so we actually had to use VT to emulate
segmentation to remove the need for
segmentation we offer the ability for VT
but we don't
depend on it because VT basically it
boils down to making writing a virtual
machine monitor a lot easier that's why
you see a lot of new products coming out
that require VT it's just much much
easier than writing a binary translation
monitored of it performs really well so
we just John repeat yourself yeah thanks
we're actually using three different
kinds of virtualization technologies one
of them is BTW binary translation that
been described earlier which is
effectively a just-in-time compiler we
compile we take x86 code and we write it
to x86 code that is safe to run on the
host that's one technique the other one
is is VT or it's called also SVM on AMD
processors which is not relevant for max
but just mentioning for complete s and
the third one is pal virtualization
which is the approach that the Zen folks
have taken where you effectively rewrite
your OS so that it doesn't use the non
get reliable instructions of the x86 the
difference between VMware and the
competition in that space is that VMware
has the free technologies we did we do
not focus on just one and we can also
switch dynamically while we are
executing the vm between these
rotational technologies so we always get
the one that's the best for the the
workload that we are running depending
on what we are running we adapt and that
gives us a lot of flexibility and we
usually don't mention that a lot in our
documents because to us it's a it's an
implementation detail what we are trying
to do is run the vm as fast as possible
that's what the customer care care about
um I was just wondering in a situation
like this for example what do you do
with files that you want to share
between the different virtual machines
so the question is what do you do with
files that you don't share between well
that you do want to show you all oh I
mean how do you control them there's a
couple different technologies so we
explicitly have the user opt-in if they
want to share for example their home
directory or their documents directory
you can create shared folders one by one
and specifically share them so a good
example is um so let's see if I can do
it here
so here's the virtual machine here's the
vmware window and i can actually pull up
the settings for this guy and you can
actually add shared folders on the fly
so right now i have a shared folder that
maps my home directory then read only
but i can actually make more shared
folders on the floor you know on the fly
or manually that actually share
explicitly more stuff you can also
there's nothing stopping you from doing
what you would do with a physical
machine and using technologies like SMB
NFS or AFP to actually share your files
back and forth and you know each the
nice thing about shared folders is they
don't require any network set up the
nice thing about things like SMB and NFS
is there really tuned and they you know
windows does SMB really really well and
so if you want to do things like you
know really heavy workloads you know you
can use network file systems as well
best case what kind of overhead is
introduced by virtualizing so what kind
of overhead is introduced by
virtualizing it depends very heavily in
the workload with today's technologies
what you're going to find is CPU
intensive workloads very very fast
you're not going to have very much
overhead at all so things like compiling
or a number-crunching work really well
when you start getting into io heavy
workloads you know lots of disk network
those kind of things the there's more
overhead because the cost of those is
often you know all the context switching
copies that you have to do to make them
happen so until they get and that's an
interesting point because we're actually
starting to see virtualized io hardware
support so you starting to see more and
more things like fibre channel on the
server side start to be aware of
virtualization so that we can actually
start offloading some of the work of i/o
to the hardware cuz today you know disks
network and whatnot that's all emulated
in user space we try to accelerate it by
putting some of the work into the kernel
but there's only so much you can do it's
not as fast as talking to the hard work
so but overall I mean you know things
like you know I can I can go into my
virtual machine right here open up a
folder and the performance is really
good I think yeah it's pretty close to
native well i guess i was asking more
from a server perspective
not necessarily from a desktop because
from a certain perspective it's pretty
ideal unless you're doing really heavy
io bound workloads so if you're doing
things like you know wet you know web
services you know lots of things that
stay in cash it's not that bad but if
you're doing you know heavy disk you
know like a file server or something you
may not see as much game Thanks what's
the plan on multiple snapshots multiple
snapshots so you're saying where are
they coming you have another coming so
multiple snapshots so the vmware
platform support something called
snapshots when you have virtualized
hardware you don't actually you can do
some things you can't do with physical
hardware you can just link called
snapshots where the entire state of the
machine devices memory CPU is frozen in
time and you can keep going forward from
that point on at any point you can
decide you know what I'm going to go
back to that point in my snapshot it's
kind of like TiVo for virtual machines
so actually sure Alex I'll show you I
don't know how long it'll take here I
actually read Justin might it might take
a little while snapshots basically let
you you know just go back to the exact
state so if you if you want to test out
some new service pack for windows I know
service pack 3 is about to come out for
XP for example you can take a snapshot
install it if it totally trashed your
software you just go back to the
previous snapshot the the question was
asking you know what about multiple
snapshots so in vmware workstation
there's a feature called multiple
snapshots that gives you an entire
history in a tree form where you can
have you know one snapshot that branches
out into three possible different
scenarios maybe install application
version 1 2 and 3 all separately in
separate snapshots you want to kind of
toggle between them the ability is in
the platform of vmware fusion today and
the and we just didn't have time to
write the user interface for it so we
just have we haven't announced when the
actual user interface for that is coming
out but it's pretty it's a pretty
logical next step the one thing that we
want to do with virtual snapshots on the
Mac specifically though on Linux you
have this giant tree and anybody who's
ever used a tree interface in consumer
software knows that consumers are
completely
bewildered by it they don't want to have
to navigate through branches and you
know figure out parent-child
relationship I mean computer science
geeks we know trees we eat breathe and
sleep trees but consumers don't think in
terms of trees they don't know pointers
are or you know red black trees or move
in fix so we want to come up with a
better metaphor some of the ones we've
been talking about you know are pretty
pretty pretty novel so I think you guys
will like what we're coming up with so
I'd love to answer any more questions
it's about fusion mech go ahead from a
virtualizing hot where I don't
understand how you need to you or kiss
how would you tell something is a window
which is something that's just an
artifact I'll screen so the question is
you know how it is unity actually tell
at the hardware level what is a window
what isn't and that's the trick it's not
done at the hardware level so I don't
know how much I can talk about the
internals but it's basically all done
inside the guest so inside windows we
actually have a process that knows when
when windows are placed shaped or moved
and we echo that on screen with physical
well physical Coco windows that you know
refresh themselves with the content of
the virtual machine so you know if I run
things like windows media player is a
good example is a perfect example for
unity because it's really it's a funky
funky window so here I am in my single
window I'll go into unity and here's
media player slowly trying to connect to
the internet and failing there it goes
all right so you can see this is like a
crazy shaped window here check out the
edges here so we actually have I don't
know this will work on the projector
we'll see oh my god it does
you can actually see we went to the
trouble of making the shadow actually
curve as the window curves there's a lot
of love here I have to tell you so even
funky shaped windows like this work and
the speed is actually really good so I
can do things like play some Beethoven
and you know the video speed is actually
pretty good so we've we've done we've
done a lot of work to you know really
transparently integrate the applications
with the host I mean you know that's
that's that's pretty it that's pretty
much this obviously I'd like wait let's
get some light Beethoven so it's pretty
cool there was one there's another
question uh at book talks they typically
hand out a few copies of the book at the
end are you gonna be handing out vmware
fusion copies cuz i really miss bioshock
oh come talk to me later um so i got my
copy the other day make but I have a
question I haven't figured out
everything so if I'm running multiple
multiple os's multiple guests it's a way
to strata as 21 guess more CPU and you
know resources from the from the mac OS
sources theaters because so from a
resource point of view are you talking
about CPU memory disk there's also two
different resources that you would want
to write just just cpu you know if you
want to ask one guest takes up like you
know have my you know cpus and I'm
thinking well you know I just want to
sort it down completely and you know by
fifteen percent or something so then I'm
the server products we do have that
capability we can partition you know you
could have a physical machine that has
four or eight or whatever prot as many
processors you want and you can
partition off the amount of CPU we
didn't put that in fusion because it's
not really a consumer-oriented feature
but from a server perspective it makes a
lot of sense and we do to that we just
this regis by the way duchesne is our
original vmware head he's awesome there
is another reason why we don't do
cpu partitioning on the mac is because
again you know apple provides api's to
sweet apple applications and they don't
provide what they don't need and there
is absolutely no way to do CPU affinity
on mac OS we're from New Zealand or from
the counter from a criminal extension
thanks the question is can we set the
vmx priority we can set the priority of
the threads inside the vmx we didn't
expose that to the user um it might know
more about what effect that might have
and we can push the thread priority up
and down programmatically so we mean
from that point of view you know we
could come up with some sort of
interface but we haven't done that yet
sorry right so yeah so i'm it i'm it
saying basically you know setting thread
priority isn't a knob that really makes
sense for the end user because the gain
or the gain or the with the opposite of
gain the gain to the user the
performance characteristics aren't gonna
change that much i changed just the
thread priority any more questions on
vmware fusion for mac the development
cycle or so one thing i wanted to bring
up was one of the really cool features
of vmware fusion that i haven't
demonstrated here is something on the
inside we support for even OSS that are
still 32 bit you can run 64-bit
operating systems as a guest so if you
need to do testing of XP 64-bit or Linux
64-bit you can actually run them on your
macbook pro with core 2 duo or your mac
pro with xeon processors and even though
the OS itself is pretty much strictly
32-bit and the colonel is strictly
32-bit even in Leopard that's not an NDA
anymore right that's public it's out now
so I don't have to pretend the 64-bit
guest operating system will run really
well and on top of that we also support
virtual SMP so if the host has multiple
processors you can actually give the
guest multiple virtual processors and it
will actually inside you know you know
you can react a activity monitoring
windows and see the multiple processors
you know the actual load graphs on each
it's actually pretty cool and that's
really good for cpu-bound things like
compiling and number crunching that's a
really cool feature that we put in there
any more questions on fusion can you
hear me there I can hear you yes okay I
was wondering what the story was with
them a mac OS as a guest operating
system Matt Joyce has a guest so about
15 minutes ago we talked about a little
bit technically it's very doable um
VMware you know doesn't sanction piracy
at all and one of the big the big hooks
has beng ups has been licensing mac OS
10 is not licensed to run on anything
but physical apple hardware we hope the
situation will change and but
technologically there's not a lot of
barriers here's we just a shame there
are a few differences between a mac
between the mac hardware and the pc
hardware one of them is the mac uses a
high performance timer device called
hpet and that is not usually stand out
on normal pcs so we have to virtualize
new hardware another piece of hardware
that might be useful is the security
called the securing device which emit
told us is not a is not a TPM but so in
essentially it means more work right we
have to emulate a different kind of
virtual machine one with different
virtual hardware but it's a it's a
matter of of time and implementing that
there is no nothing there is no
technical thing that prevents it from
being done it's mostly illegal this
thing and and and putting resources on
it but I will mention one thing and that
is initially we met with some resistance
talking about this because there are not
created by VMware but hackers have
actually used vmware's disk format as a
popular way of distributing hacked
copies of OS 10 and you know while
that's you know that's a pity that they
chose VMware because you know we don't
condone piracy or anything but people
have started doing this thing called
hackintosh where they distribute copies
of VMware running OS 10 running in
VMware virtual machines for Dell or
compact that have been hacked to
smithereens to remove all of apples how
protection another difference is also
that most most pcs today boot with
what's called a bios and and max boot
with something called efi and there are
ways to reconcile both but again it's
more more things to implement right hope
that answers your question that's kind
of cool is like magic voice on mystery
science theater you have any other
questions from the other cameras i see a
bunch over there that's kind of cool
i've never seen in hville all right well
it's two o'clock thank you guys very
much pretending my talk I appreciate it
very much
Oh</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>