<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Spam, Phishing, and Online Scams: A View from the Network-Level | Coder Coacher - Coaching Coders</title><meta content="Spam, Phishing, and Online Scams: A View from the Network-Level - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Spam, Phishing, and Online Scams: A View from the Network-Level</b></h2><h5 class="post__date">2008-06-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IBPg9Lyta3A" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">we have Nick Teamster he's a professor
at Georgia Tech and my adviser he is
he's done a lot of work in network
management and most recently in network
security as well the spam is something
that is close to his heart and you're
talking about that today so without
further ado thank you thank you thanks
for for joining me today
today I will as mcaren mentioned I will
be talking about a spam and more
specifically I'll be talking about
filtering spam and what we think is sort
of a new complementary approach of
course we all know about spam you guys
probably have more of it than than me or
even all of us at Georgia Tech of course
various reports depending on what you
read indicate that this constitutes
anywhere from three-quarters to as much
as 95% of all email traffic more
troubling than the increasing trends are
also that the the medium by which spam
is sent itself is also becoming
increasingly diverse spammers are
getting more creative in terms of how
they send spam and we've seen images PDF
spam starting to see mp3 spam XL spam
it's also becoming more targeted content
filters in I guess Vanilla's content
filters can't catch these things of
course there have been various types of
plugins that you know try to do things
like OCR on images etc but this is this
is quite tough it's more than just a
nuisance as well seeing more and more
beyond just things that you know cause
you to want to hit the Delete key there
are other things that may trick you into
you know revealing personal information
banking information what-have-you in the
form of phishing attacks so I won't talk
too much about phishing today but some
of our research also looks at
similar techniques to what I've going to
describe today for countering various
types of phishing attacks so as I
mentioned also these attacks are
becoming becoming more targeted so now
of course there are wide variety of
things that we can actually do about
about spam I'm gonna talk about
specifically one type of approach right
there are other things that have been
proposed of course from ranging from you
know charging to sender domain keys to
all sorts of other things that I'm not
going to talk about today just going to
focus on this one type of approach and
in that line I'm going to describe a new
or fairly complementary approach to what
people have done in the past so let me
just give you a brief overview filtering
of course is basically just exactly what
it sounds like right just stop the
unwanted traffic from getting to me
right keep it from keep it out of my
inbox there are many ways of course that
you can actually do that all right so
can start to ask what types of features
best differentiate things that users
don't want from things that they really
want to read right so you can do this in
a number of ways the first two are our
fairly can conventional approaches that
have been in use for quite some time
right so content-based filtering
something we already talked about a
little bit right this is just what's in
the mail right can I tell based on
what's in the message itself whether or
not this is something a user is likely
to want to see another approach is
essentially reputation of sorts right
what is the IP address of the email
sender right and if I have previous
information about that IP address I can
say something about whether or not the
message to being sent from that that
sender is likely to be spam or not both
of these approaches as I mentioned are
not new they have various
advantages and well as well as some
shortcomings that I'll talk about the
third is actually what I'm going to
spend most of the time talking about
which is another type of thing that we
can filter on which is behavioral
features right can we look at how mail
is being sent and in particular can we
look at features about how it's being
sent that we can see from the network
traffic that is without actually looking
into the messages themselves just by
looking at traffic patterns can we can
we develop some ways to infer whether or
not a message that's being sent is
likely to be legitimate or not so before
I get into the details of what we've
done let me just sort of briefly
summarize some of the shortcomings of
some of these other approaches right so
contact based filtering and and let me
be clear here
with this work we're certainly not
advocating replacing these other
techniques right what I'm what I'm
talking what I'm basically advocating
our new techniques that are
complementary to these so content-based
filtering of course has its place but
there are some problems right so for one
spammers can alter the features of you
know what's actually in the contents of
the mail customize it for recipient etc
make it very difficult for a specific
type of content rule to you know to be
able to differentiate between spam and
legitimate mail on the flipside
anyone who's maintaining a spam filter
has to continually update you know the
capabilities of that content filter so
that it can you know for example when a
spammer decides that you know he's going
to send a message in mp3s today and PDFs
tomorrow then you know the whoever is
maintaining those filters basically has
to keep up continually with you know
being able to parse various types of
content okay I'll get into some more
details later about send a reputation or
you know what if you know you know
should we just use the IP address of the
sender to try to differentiate between
legitimates senders and spammers
well that actually has has seen some
success and it's fairly wide used in a
fairly widespread manner you know in the
form of things like spam house but also
their commercial sender reputation
systems as well put out by secure
computing and IronPort and some of those
folks are actually working with in terms
of improving some of these these
reputation systems but one of the one of
the drawbacks is that if you've never
seen an IP address before and you may
not actually know what to do with it
right there's no reputation good or bad
about that sender there are other
problems as well
they're very end but but from our data
alone we do see you know on any given
day we see about 10% of the spam hit you
know hitting our spam traps or 10% of
the sender sending that spam are coming
from IP addresses that we have never
seen before so even if you had the you
know perfect reputation on IP addresses
that you'd seen before there's still a
fair number of senders that you know
that are cropping up new every day so
their various causes to that and
actually I don't have a definitive
answer for why we're seeing that you
know possible explanations could include
you know that these are botnets that are
on dynamically addressable subnets
others might be you know that there are
newly infected machines I don't know why
this is happening but bottom line is
that you know it is so that if you just
had a static list of bad senders well
that's that's maybe not going to work as
well as you would hope either okay so
here's sort of just a brief summary of
this third way that I'm going to spend
most of the time talking about this
third way of actually filtering so what
if instead we just talked about or tried
to filter email messages based on how
they were sent right what do I mean well
let's look at sort of network level
properties right so where is that email
coming from in terms of
you know it's hosting upstream ISP can
we tell if we have additional
information or if we can make a guess is
this part of a coordinated group of
senders right does this sender sending
behavior look much like other senders
sending behaviors thereby indicating
that it might be part of a botnet for
example other things that we'll look at
how far has the message traveled so we
can take IP addresses and map them to
geographical locations and say okay
what's the distance that this message is
traveled turns out actually as we'll see
that's actually fairly good property
that you can you can use to
differentiate as well another one would
be who has this particular sender talk
to in terms of recipient domains right
so is this IP address just talking to
Google or is it talking to you know some
set of domains that looks you know
unusual or weird or you know unlike a
set of recipients that a legitimate mail
server might actually be talking to so
those are the types of things that we're
going to be looking at and I'll describe
later in the talk how we how we are
building those into a classifier these
are just a very small set of examples
and this is kind of an ongoing challenge
actually maybe you also have some
answers to this as well but this is
something that we're continually digging
for is like which which of these
features are most useful for
distinguishing his spam from legitimate
senders okay
so here's kind of what I want to do for
the for the rest of the talk I want to
give a brief overview of a study that we
did several years back now on just
basically characterization study of the
network level behavior of spammers so
I'll briefly describe what we did and
I'll talk about some of the highlights
there I'll skip a lot of the sort of
mundane statistics which you know you
probably also have and you can you can
grab out of out of our sitcom paper if
you're particularly interested in those
but I'll stick to some of the more
surprising findings then I'll talk a
little bit about sender reputation
systems in particular
IP blacklists or dns-based blacklist as
their also known and just to look at
sort of how well are those sort of
sender based reputation systems doing
today or from what we can see in our
data then I'll talk about specifically a
little more about this behavioral based
network filtering that that that we're
working on and I'll describe what we
will our current results and where we
are okay so let me first just briefly
describe some of the results in some of
the studies that we did just to study
the the network level behavior of the
spammers so what we did in this study
which which actually was quite some time
ago now it was for almost a year and a
half what we did is we set up a spam
trap by that basically what I mean is we
set up a machine that was the mail
exchange for a couple of domains for
which there were no legitimate email
addresses right so we knew that anything
coming to you know trying to send mail
to those domains was essentially a
spammer because there was no one there
that you know anyone would actually want
to talk to
so typically standard mail server would
basically just reject this right or drop
it silently what we did then was
actually just to accept an e so if any
spammer was trying to talk to us we
would accept the mail for delivery and
say yeah okay that user exists sure
we'll happily take that we also did a
bunch of other things in terms of active
measurement which I'll describe on the
next and the next slide that mail server
was was a little bit special but the
other thing that we did or the other
thing that we collected at the same time
was routing information so here at the
border actually we we and we set up a
what's I won't get into routing details
in this talk but it's basically an
internal BGP session which allows us
bottom line is down here what we can see
is here's what the internet routing
table looks like at the time we got this
particular piece of spam so we can now
start to ask questions about reach
ability network level reach ability in
regard to the spammers who are
we're hitting the trap that actually
turned up some pretty interesting
findings which I'll get to in just a
minute so the the that server itself
that we use to the MTA was something
called male Avenger which came out of
Stanford actually what it allows you to
do is actually gather a whole bunch of
other additional information it's it's
it's fairly configurable so you can
write scripts on various things that
perform various operations on the header
as the mail comes in gather additional
information so other things that we
grabbed or things like the syn
fingerprint of the sender so that
allowed us to do things like gather
statistics on likely operating systems
of of the people who were spamming us
the other thing that we gathered was at
the time the mail came in we performed
blacklist lookups into about seven
different real-time DNS space black
lists so we could see okay at the time
this particular IP address hit us with
spam was it listed in any of these black
lists and how many of the black lists
was it listed in so then we can ask
questions about you know how well are
these black lists doing at blocking
these centers okay so we have all this
information and then we had all the the
routing information so then we could
actually do you know some joins on that
and and we found some pretty interesting
things so there's a bit hard to see but
I'll just I'll draw it out for you so
basically what I have here is a time
line this is about 15 minutes and what
we see here is actually a new IP address
space being announced okay so this is a
you know BGP route advertisement that we
saw at our monitor for some portion of
IP address space okay then a little bit
later we start to see spam trickling in
from IP addresses that are in that space
that just previously was not even in the
routing table so this space recently you
know recently became reachable and then
all of a sudden we're seeing spammers
hit us from that IP address space and
then a bit later in
this case about ten minutes later we see
that route go away okay so that address
space is no longer reachable if you go
look at the paper and at the end of the
talk has some references there are other
other patterns of announcements and
withdrawals and spamming but this is a
this is this is one interesting well so
there's several interesting features to
this particular behavior one is that
it's fairly short and for most of the
time the prefix that's being announced
is is nowhere to be found in the table
so that actually if you imagine your
network operator that's trying to
actually trace back to some of these IP
addresses that are sending the spam that
actually makes it a little bit more
difficult to trace particularly if
you're if you're not looking at the BGP
route announcements themselves we
actually tried testing a reach ability
for some of these IP addresses and they
they were in fact they were in fact gone
when we looked later the other thing
actually that's that's actually quite
interesting is what prefixes are being
announced in this in this manner so I
should mention before we go on that this
is not something that we saw there's you
know predominant in terms of the volume
of spam so this was not something that
say you know lots of spammers were using
but we saw a small group of spammers
continually using this over the course
of you know many many months so getting
to the question of these prefixes
actually so just to go back we saw a lot
of these prefixes advertised in this way
that were as big as slash eighths right
so one 256 of all the Internet's IP
address space being announced by spammer
in this way it seems a little strange
until you think about exactly what's
going on right so imagine you're a
spammer
and you need new IP addresses well you
know one way to do it is or one way to
get these IP addresses is to steal them
in this way but if you didn't want to
disrupt other traffic right so the the
the point of this route hijack is
to you know cause havoc but to silently
suck up unused IP addresses then using
big prefixes is actually going to work
pretty well right so for one reason
actually if you use a shorter prefix
like this or something that's more more
IP address space typically not going to
be filtered right you know if you try to
steal a smaller chunk of IP address
space like longer than a / 24 for
example that route may be filtered the
other is you get this really nice
flexibility right so you can actually
take if your spammer you could actually
take a fairly large space and it doesn't
matter if there are other ISPs that are
actually routing some subset of the IP
addresses within that space right you
can actually go around them and take up
at other dark space that's not being
routed because those pieces of address
space that other ISPs are routing within
there will still continue you know those
routes will still continue to work right
longest prefix match will still ensure
that any any other more specific routes
that are already being announced inside
that slash eight will still operate as
normal but any any IP addresses that are
not being used are now happily snapped
up by the spammer what we saw actually
in terms of the actual IP addresses
within that space are fairly consistent
with this sort of agility right sort of
taking up a big amount of space and then
hopping through dark areas that are not
used so we saw within that space this
the IP addresses that's that we're
hitting the spam trap were fairly
distributed across the space they
weren't being routed by anyone else in
many cases they weren't actually
allocated to a specific ISP they may
have been allocated to a registry but
they were you know for all intents and
purposes not being used the other thing
we saw was for each not for this
particular
mechanism the IP addresses that were
hitting the spam sinkhole typically only
hit it once right so we'd see many IP
addresses from that space hit the trap
but never the same IP address twice so
that's also consistent with this this
hypothesis that the spammers are hopping
through the space also sort of
consistent with the untraceable 'ti
goals that we think that the the
spammers may be trying to achieve with
this mechanism we actually tried to
trace her out to many of these IP
addresses later just to see if we could
get there and sure enough we couldn't
the other thing so I briefly mentioned
this but this is actually worth noting
as well right so you might think okay
well why not just take a slash eight
that's that's not allocated well in
those cases actually a those routes
might in fact be filtered so bytes by
hijacking a route or taking announcing a
route that's actually I've been
allocated to a registry it's much less
likely that the route will be filtered
there are other there other things that
we that we saw as well that are that are
more detailed in the paper and then the
paper also includes various statistics
which these days are probably not super
surprising but for example you know
Lawton almost 90% of this spam that we
saw the drop was coming from windows Oh
according to those same fingerprints
that I was mentioning not not
particularly surprising in light of the
fact that we know that a lot of spam is
coming from botnets okay so next
question that that I want to look at is
well how well are these IP based
blacklists were actually working you
know we know that you know there are
many of them out there spam house being
a predominant one how well do these
things actually work right in terms of
sender reputation so when asking that we
can sort of ask that question in terms
of two metrics one is completeness right
so that's essentially are these IP
addresses actually listed in the
blacklist
at any time I do they show do they show
up ever
right the second is responsiveness right
that's well okay this IP address
eventually gets listed in the blacklist
the spammer but how long does it
actually take right so this is important
because if it is in fact the case that
these spammers are hopping through IP
address space then it doesn't really
matter if you eventually list that IP
address if it takes you a month and the
spammer has you know subsequently moved
on to new parts of the IP address space
then this isn't going to do much good
okay so here's what we did actually for
this we did a small study we looked at
our spam tramp for about actually two
traps for about a month
in March of last year and then we looked
at spam house at the same time and we
said okay well at the time these IP
addresses sent spam to these traps
how many of those you know where was the
IP address actually listed and we looked
at the fraction of spam that was coming
from unlisted IP addresses at the time
of receipt at the time it actually came
to the trap so in the case in the first
strap it was something like 35% of the
spam that was hitting the trap was not
listed in spam house in the other case
it was only about 10 still a fairly
significant amount on you I'm considered
that you'd like none of this to be
hitting your inbox in terms of
responsiveness right we can look at you
know how many you know how many of these
IP addresses are what fraction of the
corresponding spam was still unlisted
from 'unless IPS that were unlisted
after a month right so still actually a
month later you know about 20% or about
20% of the total about two-thirds of the
spam that we saw at the time of the
receipt was coming from IP addresses
that were actually essentially never
listed right then you know after a month
they were still unlisted okay so work to
do there's actually another way that we
can look at this because that was just
spam house right so you can actually ask
well what does this look like for other
black lists right so I mentioned that we
queried something like
eight black lists for that for that
longer study and what we did here was to
look at how many of these black lists
was this IP address listed in at the
time the spam was received right so
keeping in mind actually that some of
these black lists actually list very
aggressively right we know some of these
like spam cop will Willa list you for
you know doing just about anything that
that looks you know that looks like
spammer behavior okay so the interesting
point here so the way to read this
actually is this is the fraction of all
spam that was received it was listed in
n or more blacklist right so a hundred
percent of it of course is listed in
zero or more right and then zero or
server fewer right so here we can say
okay well how what fraction of the spam
was listed in one or more black lists
right so if we look at the red line
that's all the spam that we're seeing at
the trap so there you can say about 80
percent of the spam that we received was
coming from IP addresses that were
listed in one or more black lists right
at about fifty percent a little more
than 50 percent of the spam was coming
from my P addresses that were listed in
two or more black lists okay so
interesting thing to note there is
there's basically still significant room
for improvement that's 20 percent of the
spam is coming from IP addresses that
was that were not listed in any of these
eight black lists even the super
aggressive one okay so the other things
that are interesting to note about this
graph are the Green Line which is a
little tough to see but let me trace it
for you
that is basically we're asking the same
question but just for the IP addresses
that were part of this sort of BGP
madness thing that I showed you before
right so therefore those IP address only
about half of them were listed in any
blacklist right so half of those IP
addresses that were jumping around and
in those
you know this highjacked slash eights
were not listed in any blacklist at all
so clearly still some room for
improvement
well what's going on so as I mentioned
you know and as this sort of the the BGP
related results with regard to the
blacklist effectiveness indicate is that
there's some amount of you know
ephemeral nature to the IP addresses of
the senders right and that actually
creates problems for maintainer zat
blacklist right if your list is just
based on you know IP addresses that you
know to be bad but you're continually
seeing new ones we've got a lot of
catching up to do so to speak right the
other thing and this is actually
something that perhaps some people here
have things to offer as well but
something that we're quite interested in
is these black lists actually also often
require human to notice or validate that
this you know that a sender is in fact
sending spam right so many of these
things do many of these lists do operate
on you know some level of automated
alarms but still require some amount of
validation so another thing that we're
that we're quite interested in is with
regard to the behavioral techniques is
how much of this can actually be
automated I'm gonna skip that because
that basically just shows this this 10
percent figure here's another thing
another reason why these black lists may
have a hard time keeping up right if we
look at the amount of spam that each one
of these IP address is sent to this
particular domain so this is basically
one spam trap domain so on the y-axis we
have volume that's that's a mount of
spam we saw it on the x-axis we have
essentially how long
that's this time span over which we saw
that IP address active in the trap right
so this is basically
you know a little more than a year and a
half out here or I'm sorry almost a year
and a half out here and this is zero and
that's log scale so you can see that
actually even the IP addresses that have
been active for a fairly long time most
of them are not sending more than you
know fifty or a hundred pieces of mail
to the to the trap and it's it's fairly
independent of how long the IP address
has been active so if you are you know
an operator trying to actually decide
whether you know whether or not you know
this particular IP address is a spammer
and warrants an alarm then if the IP
address is you know one of these fairly
low volume IP address is down here then
it may not even you know be sending at a
volume that warrants any kind of alarm
or report right so there may be that
leads to some of the things that I'm
going to talk about in just a minute
which is that you know some of these
techniques may benefit quite a lot more
from you know coordinated monitoring or
observation than they are today okay so
what do we do about this right I've been
spending the first half of the talk
essentially complaining right
we know content-based filters have a way
to go and now we know these IP
blacklists also have a way to go so what
do we do well one option is we could
sort of you know rip out the plumbing of
the internet we could think about how we
you know how we could get better notions
of sender identity right so instead of
just using this IP address as the handle
for my reputation system could we come
up with some stronger notion of identity
and I guess you could put like senator
domain keys and things like that in in
this category but there are also
proposals like hip and various things in
the ITF going on that look at you know
how do we actually make us you know come
up with a stronger identifier for the
sender itself so that's an interesting
direction but as I mentioned you know
perhaps this requires a you know in many
cases significant changes to hosts
routers
and everything we know so instead what I
want to talk about today are some sort
of more immediate types of things that
we can think about which is what about
filtering based on sender behavior right
we can do this today the challenge then
remains in sort of identifying what
features best distinguish spam from from
legitimate mail ok so the first thing I
want to talk about is in this in this
regard is a system or algorithm I should
say that we've come up with called spam
tracker
this was joint with my student on with
Ramachandran who did a lot of the work
on characterizing the sender's as well
this is also with another professor at
Georgia Tech Santosh from Paulo so the
idea here was basically you know
starting off with this high level idea
about well let's come up with some kind
of behavioral features that would allow
us to put senders into buckets if you
will or clusters that would identify
them as groups of you know bad gangs if
you will right so the idea being that
well the intuition that we went looking
for was that may be lots of spammers
behave in similar ways
because maybe they're using the same
software or they're part of a botnet or
you know for whatever reason we're gonna
go look for coordinated behavior ok so
here's the idea right so let's construct
some kind of fingerprint for the sender
and I'll describe what that is in just a
minute and then then that's cluster
those senders that have similar
fingerprints right so now I'm taking IP
addresses things I've seen before and
putting them into groups and then when
if I can identify a group of those as
being bad then if I see a new sender say
you know it's a completely new IP
address well that doesn't matter like if
that if it's somehow behaviorally is
similar to something I've seen before in
one of these you know bad gangs then I
can just say ok this is probably about
it I don't have to wait for reports of
you know this particular IP address
being being up to no good
so the key question then is well what's
the two key questions one is what's the
fingerprint and the other is how do we
actually do the clustering okay so this
is essentially a first crack it works
pretty well it's not without some
drawbacks and I'll talk about some of
those later but let me just sort of
describe the scheme first the feature
that we start with is let's look at the
email sending volumes of each IP address
to across a set of recipient domains so
by domains here I mean you know a name
like you know gotta edu or
google.com right so what this assumes is
the ability to observe an IP address or
the sending behavior of an IP address
across many many domains that sounds
really hard but in fact it's not right
because if you think about put yourself
in the position of a blacklist operator
that blacklist operator is getting
queries from mail servers essentially
all over the world right
thousands of domains and those queries
actually can you can use those as an
indicator of that IP address or that
domain that's querying me got email from
this IP address that it's querying right
so you don't have to have mail servers
everywhere to actually be able to
assemble this feature so that's the
feature that we start with and then what
we do is basically start building
clusters around IP addresses that it
exhibit these features so we start with
some seed list of bad IP addresses say
things that IP addresses that we've
already known to be bad either because
you know they're part of a botnet or
because they're listed in spam house or
something right so for each of those
then we construct this feature across
time right and then or for a particular
time window then what we do is collapse
those features into a single matrix
right so now each row in the matrix is
an IP address some sender and each
column is domain
and then the each entry in the matrix is
the volume of mail that that IP address
has sent to that domain over whatever
time interval was chosen then we throw
some magic spectral clustering at this
matrix which I want described in this
talk but it's a it's a pca based
clustering and here's essentially what
we get out so what we get out actually
these these pretty white squares which
actually represent clusters so what this
is is an IP so what we get out is an IP
by IP matrix right so this is pairwise
and the intensity of each pixel
basically represents how similar in
terms of that distance in terms of
similarity of those feature vectors that
I described before that is volume to
each domain how similar each one of
those each pair of those IP addresses is
to each other right so for example we
can look at you know some row here and
some column here and the fact that you
know this pixel is white indicates that
you know those two IP addresses
exhibited very similar sending behavior
with regard to this feature of course
the diagonal is going to be white the
striking thing about what we see in this
particular example and there are many
examples in look quite the same as this
is that many of these clusters are
fairly large right so that basically
indicates that there are large groups of
IP addresses that for this particular
metric are behaving in very similar ways
so that's promising because what that
suggests is that even as new IP
addresses are continually coming along
chances are they that they bad sender
may fit into one of these clusters okay
so what do I mean by fit in well
basically what we do is for each one of
these clusters now we compute a single
fingerprint which is essentially if you
remember that feature I'm using is
volume of messages sent to each
recipient domain we compute an average
vector for the whole cluster that is
you know that particular each cluster
essentially has an average vector that
represents sort of the average behavior
for that cluster and then we compute for
a new sender how similar it is to that
average vector it's similar we drop it
into that cluster okay so that's
actually what I just described so
evaluation is actually tricky because
you know if we had perfectly labeled
data on which to train and on which to
test then we would already have the
perfect spam classifier or we would have
you know maybe I guess the other thing
that that would imply is lots and lots
of humans that are disposal which we
don't have but so what we can do is
actually train based on imperfect labels
that is you know what some other spam
classifier decided was you know spam or
legitimate mail and then compare what
this classifier got relative to relative
to what that that other that other
classifier said was spam or legitimate
mail okay so so right so we basically
did this evaluation relative to some
logs that were labeled and the way that
they were labeled was excuse me they
were postfix logs that said you know for
each line
they of course provided all the
information we needed as far as
timestamp and sender and recipient
domain but they also said whether or not
the mail was accepted for delivery or
rejected right so if we know that it's
rejected immediately then we can be
pretty confident that those are spammers
if it's accepted that could actually be
either legitimate male or a mistake
right on something that or something
that was later caught by say a
content-based filter so the spam label
is not entirely clean but we do it we
make do with what we can
something about 15% of that accepted
mail is also
there's also spam okay so the other so
that's one thing that we can do to
evaluate this the other well so the the
last thing we can do is of course to
deploy it and I'll describe that in a
little bit where we are there the other
thing we can do is compare against what
other blacklists are saying so that the
other thing that we did is to look at
pieces of senders actually for which
mail was for which the IP address of the
sender was not listed in spam house at
the time we gave it a high score but was
later listed in spam house and there was
there was some of those cases also which
I'll describe okay so here is basically
where we are with this particular
feature and with this clustering method
so what I'm showing here is actually the
score that we gave to a particular piece
of spam based on the sender
classification for things that were
labeled as spam that is things that were
immediately rejected and things that I
don't know maybe this is spammy ham
right there's there's a little bit of
spam of there as well as I mentioned so
the thing to note here is that we are
giving consistently higher scores to
things that were labeled spam as opposed
to those that were labeled to ham
there's still quite a bit of room for
improvement here because we'd like to be
able to do is draw some kind of
threshold right we'd like to say well
Annie any you know sender for which we
give a score higher than 0.5 you know we
just want to toss away that's clearly
not possible here
because if we did something like that
we'd you know we'd be throwing away you
know 20% of legitimate mail so we can't
solely rely on this but that that does
go back to what I said towards the
beginning is that this is probably just
another mechanism that's complementary
to other things that can be that are
that are being used as well so there's
certainly room for
there and I'll talk a little bit about
other features as well that we're
looking at that that made that will
probably do a little better as well the
other thing we looked at as I mentioned
was how often can we detect things
before sadies manual blacklists right a
key advantage to some of the things that
I'm describing is that they're automated
right we don't actually have to wait for
any user to say anything about the fact
that you know a piece of spam arrives so
what we did was look at some of that
stuff up here in the pieces of mail that
were accepted for delivery but we gave
really high scores right so up here we
either have wrong answers or we have
things that nobody else seems to you
know have as reported as spam but might
actually be spam so when we looked up in
you know in that fifteen percent up here
what we saw was about I think it was
about 10 percent of those were later
listed in spam house right so it's hard
to say exactly how many wrong answers we
have up here versus just things that we
got ahead of someone else or that no one
else ever bothered to report but it is
it is somewhat apparent that we're
catching things that other black lists
are not catching as well so false
positives still still kind of a tricky
question something that we that we don't
have a you know the last word on yet but
I think ultimately it's hard to do that
without it without a deployment and I'll
get to that at the very end there are
other problems of course with just you
know throwing aside the accuracy
question for just a minute the feature I
mentioned you're probably already
thinking well couldn't senders if they
knew we were using this evade it and I
think that's certainly true right so
there are various things they could do
right they could inject noise they could
actually change their behavior so that
they didn't fit into one of these
clusters for
it so well maybe we should look for a
more robust set of features right so
that's actually what we're working on
now and I'll describe some of the things
that we've done there right so in the
hunt for a better set of features
actually we're interested in several
things right of course one is accuracy
right the other is robustness right as I
was just mentioning these should be
features that are hard to evade or that
in the process of evading them the
spammer becomes less effective in terms
of the you know volume of mail that they
can send or their ability to evade the
the filters in addition to that we'd
like to be fast right we don't that that
feature that I mentioned actually
requires a few pieces of mail to arrive
before we can construct the feature
vector so can we do better than that
turns out actually we probably can the
other is like you know we'd like to keep
the overhead as low as possible right we
don't want to have to look at messages
right still as I mentioned at the very
beginning you know even better would be
we don't even have to accept the smtp
connection we could just tell from you
know from one packet maybe even that you
know that this is a likely spammer
that sounds perhaps tricky but it's in
fact possible so so I'll describe some
features that actually allow us to do
that okay so here's one feature that we
started looking at that actually looks
quite promising and the heartening thing
about this is that it's simple and you
don't actually have to look even at the
smtp connection to to extract this
feature so what we did is looked at the
we took IP addresses of senders and
receivers and mapped them geographically
and then we asked how far is this piece
of mail traveling right and then we
separated those by you know spam versus
ham so this was a this is a different
data set I should this should just
briefly mention the way this data this
was data set from secure computing and
the scores were such that you know range
ranges of these scores suggested okay
these are definitely spam these are
things that are gray things that you
know there they are particularly sure
green was basically we're definitely
sure that this is legitimate so what we
see actually is that about so this is
for this data set too so let me just you
know briefly mentions something there
are two but for this data set ninety
percent of the legitimate messages
traveled you know about twenty two
hundred miles or less whereas if you
look at the spam messages you know it's
almost like seventy percent of them
traveled more than that and this line
also almost you know it's not quite
uniform at random but it's it's
certainly certainly quite a bit less
skewed than then the legitimate mail so
should mention mcaren points out that
this might actually look different for
datasets that are not enterprises right
so for something like Google this might
look quite a bit different so the data
set we were looking at here was for
things like yeah as I mentioned it's
from secure computing which deploys spam
filtering appliances at enterprises
where you know maybe multi-site
communication you know or email that
travels within a company may be much
less likely to you know you know to
travel very far distances so in any case
operating with the data that we had this
this actually worked very very well I'll
show what it what it does when we throw
it into a classifier just a minute okay
so here's another thing that actually
looked very promising and actually is
pretty intuitive as well and also
heartening because we don't have to look
at message contents and we don't have to
have even seen anything from this
sending IP address before we before we
make a decision we can do it you know
that the first packet that we see from
that IP address the intuition behind
this is well from looking at the data
what we see is you know spammers tend to
huddle together in IP address space it's
not uncommon to
see you know a / 24 we're 200 of the IP
addresses have sent spam in a short
period of time right so the feature that
you know whereas you know if you compare
that to say legitimate sending behavior
you know you might expect to see you
know maybe two or three mail servers for
an organization but it's unlikely that
you're gonna see hundreds you know in a
very small network block so the
intuition was let's ask where our
feature is going to be what is the size
of the IP range in which I see my K
closest neighbors right so I can say
okay well how far are the twenty closest
neighbors so let's just look out here at
the edge right and four if you look at
legitimate you know senders of
legitimate mail that's actually quite a
bit further I guess you know seven or
eight times further or bigger a bigger
range I should say than the senders of
spam so that's another feature that we
that we threw in right so and it follows
intuitively from from what you would
expect in terms of senders of legitimate
mail and spam we throw this and a couple
other features into a classifier just
off the shelf the results I'm showing
here from decision tree but we also
throw them into an SVM and got similar
results basically there's about a 92%
detection rate for about a shall I say
seven percent false positive rate
now that sounds actually high but I
guess I should mention a couple of
things so what we're comparing against
here is actually the secure computing
scores right so again we don't know
ground truth in terms of what's really
spam and what's really ham what we're
trying to do here is to say well suppose
we could take like the the lightest
weight features possible right like I
showed you things that we could get from
a single packet having not seen anything
before from that sender if we just look
at those we can come within you know
well I should say we come reasonably
close to what they're able to do
with you know who knows what I was still
looking at that we know they're also
looking at content but they're also
looking up in black lists and they're
doing a whole host of things so for you
know fairly lightweight features were
able to do quite well we started to take
sort of a you know multi-layered
approach to this and said well what if
you could look at a little more right
like what if we still didn't want to
look at the message but we could watch
the sender for a little bit of time and
there are other features that look
potentially promising so one of the
things we looked at is you know what is
the variance in message size for a
sender across a day or across a longer
period of time so I think this was this
was just across a day and sorry these
are a little hard to read but this is
like between one and 10 K this is
between 10 and 100 K and this is between
100 K and a Meg for the sides of the
message and if you look at spammers and
I haven't shown the actual variance
numbers here but the variance of the
message size that any particular sender
sends that's interesting
hi welcome the variance of the message
size of any that any particular sender
is sending is quite a bit smaller in the
case of spammers than in the case of
legitimate senders which which actually
makes sense when you think about it
right because people like you and me may
send anything from a one-line email to
something with you know a you know
PowerPoint attachment or or
what-have-you
whereas if you're a spammer a part of a
spam campaign then you know those
messages may vary for evasion purposes
but you know the overall size of the
message may not be you know quite as
variable okay so surprising thing
actually and we're still looking into
this but including this feature and and
some of these others that require more
history actually decrease the accuracy
of the classifier that I was showing
before which suggests that the data set
may be biased and that where the
that you know some of these things may
be resulting in some overfitting but
that's something that we're still
looking into okay so I just want to take
the last few minutes to say what do we
do next right as I mentioned the true
way to figure out how well these things
are actually doing is to deploy them
right in the nice thing about a lot of
the the algorithms that I've discussed
is that we can run them based on just
simple Network level features we don't
actually have to see the contents of the
message which means we can actually
deploy them for example as just yet
another DNS based blacklist right so a
query to a blacklist that we're running
could give us information for example
about the domain that received the
message the IP address of the sender
other things that we have looked at
include time of day etc and some of
these companies that build spam
filtering appliances have come up with
very clever ways of jamming other kinds
of metadata into DNS queries so all the
things that I mentioned could could
could pretty easily be jammed into those
queries the other thing for some of
these features you might imagine doing
something on the wire but so just
briefly how this might look right as
mail arrives at mail servers those mail
servers are going to generate lookups or
the spam filters much like spam assassin
would look up something in spam house
right except now it would be us right so
there's queries then provide some proxy
for you know what email behavior is
actually existing and then we can use
information about you know or you know
that inference about those mails being
sent to form a clusters that I was
describing and also run the classifiers
that I was describing and then you
return a score much like you know spam
house would give you a score as I
mentioned so so work in progress is
actually to deploy this system and throw
the algorithms that I've that I've that
I've described to you as a back-end to
that to see how well some of these
things would actually work in practice
there are lots of questions that we hope
to answer as we do that right so are we
going to run into problems with you know
can we actually construct these
signatures and scores quickly enough
how much data are we going to get in
terms of lookups and how much do you
know how much do we actually need to you
know come up with legitimate classifiers
as well you know we'll see if we get
attacked other things are you know how
many domains do we need to actually see
before we can actually come up with some
reasonable classifier okay
so I've covered quite a bit but just to
remind you some of the things we talked
about the very beginning which is a
study of some of the network level
behaviors of the spammers in the hopes
that we could come up with with you know
a different kind of filtering approach
right so based on our better
understanding of those Network level
features I've talked about a new sort of
hopefully complementary type of approach
to filtering which is black listing
these senders based on how the messages
are sent as opposed to what's in the
messages themselves are you know what
the IP address of the sender is they've
described two separate algorithms for
doing this kind of behavioral based
clustering also based on different types
of features and the next step as I
mentioned is to build them into this
system that I that I described see how
well those things actually work in
practice so thank you for coming thanks
for your time and maybe there's a little
time for questions
that's true yeah I guess the the the
clustering approach might be more
susceptible to that kind of mistake
right because you'd see one sender
sending to a wide variety of perhaps
odd-looking domains so I don't know
actually maybe in those cases you might
have to do some white listing as well so
one of the things we did to that helped
that approach was to seed the clusters
with known bad bad senders so in those
cases that would at least give us a
start on clusters that you know or
senders that we're sending to
odd-looking domains and hopefully a mail
list would not you know exhibit some
similar set of targets but yeah you
might actually have to resort to the
white listing in some cases you
mentioned that you could not trace route
to n number of addresses I remember
sixty to eighty percent right but it is
fairly common on the Internet in fact if
you take an address at random you will
probably be able to reserve it to trace
route to even less percent of addresses
that's true although in this case we
weren't trace running to to just
arbitrary IP addresses we retraced
starting two IP addresses that we knew
at one point had actually completed a
TCP three-way handshake with us right so
one would expect that my previous
experience I know that the percentage
may be lower well so one reason it might
be lower is because like the host that
connected to us is behind a firewall
right so and that's why I actually I
didn't give a precise number because in
many cases is hard to tell okay is this
actually unreachable or is it is it just
at the hostess firewalls network is
dropping ACP yeah although so to what we
did there is to
like okay well if it got at least to the
subnet we would say okay it's it's
probably still reachable it's in some
sense right because what's being
announced and withdrawn in these cases
are slash eighths so right if that slash
aid is you know but the phenomenon of
announcing and withdrawing or cirshades
was around since at least 10 years Geoff
Huston is by the way also and shown it
in his and lots of available the routed
address space you know it's not today's
phenomenon right it's I mean so you're
right this has been going on for some
time actually I don't know in his study
did he do any correlation with traffic
because I don't know no shown that
is silly can you sense right I'd be
curious to see actually why this those
others I mean if they relate to this at
all because the same reason X right then
it might have been the same reason back
because I saw very large adjust blocks
that obviously don't belong to small
aces right announce them right yeah so
it might've been going on for quite some
time before before this it's probably
likely in fact
that's a good question in fact I don't
have a and I don't have a good answer to
that I mean obviously they're there a
number of things that you could do right
you could drop the connection you could
grey list you could you know you know
accept the mail for delivery but give it
a higher score for you know later a
later filter and I think actually some
of those questions I don't have good
answers to yet because that ultimately
boils down to it's a strategy question
in terms of like well what is the cost
of you know dropping a connection and
forcing someone to resend maybe you
don't want to ever do that that's true
in fact I mean in in the in the
cat-and-mouse game the sender the
spammer may detect this and then and
then do something different however I
mean at least today I wouldn't expect
them to do that just based on I mean the
only evidence we have so far on that
front is gray listing right and this
tends to work because if you ask the
sender if you ask the spammer to come
back at a later point they typically
don't right so you're right if they're
if they start to use more sophisticated
approaches then they may catch up to
that as well on the other hand even if
they could detect that you're doing that
there's the next question of like how
would they respond and hopefully we
could come up with some features that
you know
even if they knew we were doing this
they couldn't do much right yes
I've wondered if you've thought about
using this technique to automatically
generate sort of a global whitelist
it seems to me that the total number of
MTA's although it's a very large number
in many organizations now within these
easy access for a database and you could
find things that look like it's not
looked like it's ham and mark those as
being legitimate from TAS and then
everything else is suspect okay so
actually I think some of the approaches
could be used for for you know auto
white listing for example the clustering
approach might work very well because
you know if it's a set of nails like MTA
is being used by a company you know
similar set of users then chances are
they're going to exhibit similar
behavior so I think that's that could
work pretty well I haven't haven't
actually tried that but I think that
that could be quite promising so I guess
my question is sort of the the inverse
of that which is you you mentioned it a
few times in your talk about the
concerns about figuring out in advance
how to deal with how to deal with
dynamic addresses and I can point out
that Sorbs which is one of these popular
black lists actually listens for all
sorts of traffic just indicating a
compromised machine they don't wait they
don't wait to hear spam they just look
for evidence of compromise and if they
see compromise not only do they
blacklist host IP addresses but they
also are very willing to expand to a
cider prefix that's larger than that IP
address like a slash 24 a slash 16 etc
in the hopes of putting the pressure on
ISPs to take some responsibility for
their content so in light of that my
question is how can we how can we
respond to the spam problem without
without pressuring ISPs to take too much
responsibility for what traffic flows
through their network and if and you
alluded to Dee Kim as well before I mean
we can see that that discourages people
from running mail servers and these
kinds of white lists also discourage
people from running mail sir
so how can we respond how can we respond
without without saying look only a
privileged elite can run mail servers I
see so the question is how do you make
it possible for just like you know
arbitrary people to to be running to run
mail servers without just leaving things
wide open is that is that the question
that's part of the question yes another
part of the question is how do we not
caused by SPS to be on the hook for all
the traffic that transfers that transit
the transits their network I don't know
how to answer the second one but this is
the first one certainly I think some of
it I mean so that's actually a big
motivation for like doing this kind of
behavioral approach right because the
disadvantage to you know saying you know
white you know the white lists as we
know them and DCAM and things like this
is that you have to go through an
administrator an operator to actually
get these things set up as you know even
SPF is a bit of a pain I can't even get
it set up for the server that I run mail
that I send mail from often so if you
have to rely on those things then yeah
there is there is a bit there can be a
bit of a barrier if on the other hand
you're doing this type of thing then
sure you can just fire up your mail
server and then rely on you know you
know hopefully you're doing things that
don't look like you know something that
a spammer might do the disadvantage of
course being that it's not rock-solid
perfect right I mean with you know with
the Kim or SPF or one of these things
like you have a higher level of
confidence that you're not going to you
know have false positives or is here you
know the chances of miss classification
are really higher but you gain
flexibility so you're saying that that
this work does fit into that patchwork
of empowering I think it's a different
point in the design space yeah it fits
it definitely fits into that patchwork
of empowering
you know the you know arbitrary user I
guess I guess you could say thank you
yeah thank you thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>