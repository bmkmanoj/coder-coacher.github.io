<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ruby Meet Up 8/13/09: Ruby Files on Google App Engine | Coder Coacher - Coaching Coders</title><meta content="Ruby Meet Up 8/13/09: Ruby Files on Google App Engine - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ruby Meet Up 8/13/09: Ruby Files on Google App Engine</b></h2><h5 class="post__date">2009-08-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/pHMpf6hx8Ek" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">greetings I'm John would L I'm a web
developer Google I do Ruby stuff Rails
stuff internally at Google this is Ryan
Brown he works on the App Engine team
and I guess Google does Google stuff in
San Francisco as far as yeah as far as I
know well I work on App Engine which is
one of the team's that's here in San
Francisco
there's a few others so we're gonna talk
about running JRuby on App Engine so
show of hands how many people here have
put a JRuby application on App Engine
okay like a couple people so how many
people have used App Engine Python
people I imagine in Java okay
well if you had looked at doing JRuby on
App Engine before these tools that we
just launched recently it was actually a
lot more complicated and we're going to
talk about what we were trying to do
there so would you want to talk about
that well sure so so in the past to run
a ruby app on App Engine you had to do a
lot about JRuby at least and possibly
Java you have to get JRuby installed you
have to bundle up your application as a
servlet write some XML files things like
that it's all very ugly very not Ruby
ish so we've been working on trying to
make it as simple as possible as natural
for a normal ruby developer to get
started so we created set of tools
so we created some tools for setting
everything up one of the things we tried
to do is take away the fact that you
have to know anything about JRuby so
when you install the Google App Engine
gem it downloads the App Engine SDK for
Java it downloads JRuby downloads JRuby
rack installs it all for you and then
I'm just gonna quickly oops
walk through getting started
everything's based on rack so to start
up you create a config dot R you rack up
file so here's just a simple example
hello world maybe
can you see that okay so there's your
normal rack stuff right here just simple
hello worlds and then additionally you
have to specify your configuration for
App Engine at a minimum you have to
specify your app ID and the version
number or version string actually you
can specify all sorts of other things in
here without writing any of the XML
files required for Java and then run dev
appserver
there's a dot SH for Java it's dot py
for Python and so if ruby you just run
dev appserver dot RB this runs under MRI
and starts up automatically switch oh I
did not give it a director thank you so
as you can see here the first time you
run it it installs JRuby into your
application installs the SDK copies
everything into your application sets up
the servlet directory structure for you
this is different it used to be used
Warbler which had a separate step where
you package your directory or your
application into this structure but it
would copy files around so you couldn't
run in an interactive development mode
we don't have that problem anymore so
see that's running you can well yeah I
think that's probably good enough yeah
so the nice thing about this is that as
it copied all of those jars into the
directory it's actually copying
everything you need is copying in each
we don't have any gems here it's copying
your gems
it's got from JRuby jb RAC and then
basically freezing it into the
application there so you don't ever have
to worry about anything on the local
machine or up on the development
production environment it's all packaged
up for you so do you want to show some
more well you can show the real stuff
okay so that's good so yeah I mean this
will work with pretty much any rails
framework if you go to our wiki page
we've got to get a getting started guide
shows how to set up a basic guestbook
app using Sinatra Whitney's going to
show some rails stuff okay so I'm gonna
kind of take over here from where we
left off one of the things that Ryan was
starting with was the page right here
getting started the getting started
guide shows you that's not what I wanted
I guess I'm waiting the getting started
guide shows the hello world app that he
just ran it also shows a very simple
guestbook app that configures data
mapper and has a template and lets you
create a guestbook as I imagine many of
you have seen on YouTube in this case
with App Engine okay so I'm gonna
basically kind of poke around here and
let you guys see what it looks like to
deploy a rails application because
actually it's pretty straightforward and
you can see me okay okay so I'm going to
throw this out
I'm going to go again to that same
sample page that I was on I published
this page it's called Rails - primer
appspot.com and it basically shows the
steps that need to follow to generate a
rails application and push on App Engine
and I'll just do that real quick so
basically I'll follow these steps now I
I already have these apps but you can
see them again here you'd basically hold
and get this much bigger so you
basically install the App Engine apps
and I don't need to do that actually and
if they stall and MRI I want to go
create account on appspot comm so I'll
do that real quick I've got a let's go
to app spot calm
but it is really ministry okay so I'm
slow saga didn't vlog in here as a new
user
and I want to create an application I'm
going to have to agree to this agreement
here and I'm going to create it
I'm going to call it Ruby tests I'm
gonna call it my JRuby test check the
availability it's available
oops
and then I will save it okay and then it
says I got a dashboard from application
and if I go back out one level I have
one application it's called my JRuby
test so if I go back to my instructions
here I basically say that you want to
type rails my JRuby test and I'm going
to basically CD into it also
and hopefully you can just going to come
up here later and show us how fantastic
rails 3 is going to be and it's going to
help us work a little bit better with
data mapper so there I've created my
application I have the most recent
version here ok so now I'm going to make
sure that I have the sources I need to
watch I need to create a configure are
you ok so on the page I basically give
you the config are you need again you
can just copy it and what i'm doing here
is again i've gotten my configuration
instead of my app ID it's going to be my
JRuby test oops oops VI here
okay my good oh no I care we're speaking
a new language here okay so I'm
basically doing the same thing around in
the previous demo I'm also telling App
Engine to strip out a bunch of files
that I don't want to stick into
production I'm telling it that I want
App Engine rack to tell me whether I'm
in production development mode so I can
work on the development server and
develop mode I'm going to publish it it
will be in production mode and then I
require this config environment which
basically runs the rails initializer and
then I dispatch it so now I should be
able to actually run the dev app server
and that's really all I need to just at
least start it now again it's I guess
you guys can see that there
it's basically copying in the things
that I need
and then when you come up here
so there's the app that I just published
running on my local server and it
doesn't really do anything yet but
obviously it is a rails application if I
want to publish it the controls seat
here
there we go I'm going to type app config
update it's going to figure out who is
updating it I'm gonna give it my
username
and as long as I did that properly
they'll upload it so I just generated
rails application I uploaded it now I'm
gonna need to do some other work there
to view it but basically that go back to
that console here no
I gonna log in again if I view my
application I see it running in
production now the next step of course
is well what about actually configuring
some data with it and the instructions I
have there on this rails primer will
show you how to check your gem sources
and I'm going to I can basically do that
right now we want to get the most
current version of data mapper and I see
that I have it then I would type and
actually my app isn't really doing much
here now if I look in the web and flip I
don't have any gems or anything if I
basically tell it I want to install
these applications what I've told it is
run app config and gem install rails DM
app engine which is the wrapper that
ryan wrote for data mapper and to data
store and then I'm also installing the
rails data mapper gem that's going to
help me generate models that are data
mapper models not active record models
now how many people show of hands have
used data mapper before alright so if
you've go on the web and do little
research you'll find that there's some
efficiency the PM you achieve by using
data mapper so that's what we want to
use here and I'm going to let this run
here the script to actually let me just
let this finish here those those gems
are actually then going to install into
my application and there they are
let me let it finish up here
and hold on second and I should be able
to type appconfig
gem list and it's actually going to do
that command on the gems installed in
the application for anyone who's
familiar with doing JD redevelopment you
install separates of JRE gems and in our
case we wanted to make sure that we
didn't confuse people where you have
JRuby and there's some gems installed
there and then each application that you
create may have some other combination
so when you run the app config command
you're basically working with the gems
and all the jars installed into your
directory and then of course I have this
migration here that I put on the site
that I hope will work there it is and
there's my data mapper model my
scaffolding command isn't going to work
with active record removed so I need to
do a little bit of work creating those
by hand and then the last piece that I
mentioned here oops is that you need to
modify the rails initializer so I again
copy the little piece here if I edit
that oops that's not what I wanted
I think I want to go a little bit bigger
here okay so any point in here I should
be able just insert the stuff so I've
told it
I want to require DM core and I'm going
to configure it to point to the App
Engine connector I want to also use the
App Engine logger because if I try to
run anything that actually logs on
production it will fail App Engine will
not allow me to write files so just
adding those two lines will now
configure rails to use the logger for
App Engine and everything will work
great I also told it that I do not want
to have active record in there anymore
and again I could just update it like
that it remembers that I logged in
recently and I have a cookie there
somewhere and it's going to basically
update it again so now I added a model
to my rails application and I'm
uploading it I don't have a view to show
it off yet but if I want to I could open
up the console and play with that model
and I show you how to do that here
there's a command we're gonna fire up
IRB through app config like this and
then I'm going to also tell it that I
want to bring in the rails environment
like that and if you noticed I created
something called book
I'm going to require a pee-pee so I can
see I'm doing I'm gonna say B equals
book new so I have a new book
so I now have a book I'm going to be
save oops I can't save yet I think
that's the end of that well anyway so
but you can see I can create
applications I should be able to do this
yeah so it saved so you should be able
to generate your models with that gem
that I installed you should be able to
go into an IRB load the rails
environment create the models work
through them figure out what you want to
do then go create your your views and
your controllers and build a rails
application that does not have active
record in it you will find that when you
remove active record some of the
generators don't seem to work very well
and you'll just have to work around that
when the next version of rails is out
that should be all taken care of
so do you have any questions at this
point anything other that you guys want
us to talk about yeah
well so there's no way for automatically
deploying from github or anything like
that but I mean whoever whoever in your
project has permission to deploy can
just check it out and run the app config
update command yeah in the the dashboard
he showed there's a section there where
you can add developers to the projects
and then they can all upload so
they're right well so the biggest
difference with App Engine so I'm not
familiar with Heroku but like compared
with easy to where you're buying
machines on App Engine you you upload
your code we handle scaling it up for
you creating new instances of your
application as as you need on-demand
it's we have a free limit which is
designed to be about five million
pageviews
a month is free and then you can set a
budget if you want to serve more than
that
yeah so I guess that's one that's one
thing right so that the App Engine data
store is completely different it's
non-relational you can't use SQL so you
can't use active record that's why we're
using data mapper it's not it doesn't
rely on SQL so it it's able to work just
fine
on the data store the reason the data
store is not relational is so it can
scale automatically any query you have
execute seen the same like constant
amount of time based on the number of
results not the number of things you're
searching over so whether you have one
item in your database or a million
billion it's going to be just fast
yeah yeah so App Engine has the memcache
API I hear some other api's that did App
Engine provides so I think it's very
close to what happened are very close
except for the complete differences the
datastore
because they're pretty common in transit
turnkey
in AWS completely different easy to say
that answer your question yeah in the
back
so the question was about JRuby support
if that limits you you well you
obviously can't run any native
extensions a lot of the most popular
gems that rely on native extensions are
being ported to Java some of those like
the you can't use our magic or image
science for example on App Engine but we
have the Java image API is available for
doing things like thumbnailing provides
a lot of the same stuff you also have
the advantage that you can access really
easily any Java libraries that you want
to use in addition to Ruby libraries
I've found that incredibly useful in
some cases having access to even just
javis built in collections api's can be
immensely more efficient than rubies in
some cases and they they do have mostly
complete Ruby 1-9
and they're working on improving it so
so and I just did it I just did a sample
where I ran JRuby - gem install Twitter
and it brought down a bunch of things it
brought down hoe and I could bring down
mechanize and lots of things that you
might imagine didn't work not so long
ago but I I I haven't really found that
that's a problem a lot of the things you
might want to use i've been ported and
people are working on that right now
so actually i was actually gonna take a
sidebar here show real quick that if i
look at this other configure you I have
I have this section in here that says
that I want to require administration
requires a cell and then I fire off
rails and when that happens we we
evaluate that and we generate the XML
for you and the XML for that is actually
is actually well actually this is one of
the HTML files so this is what gets
generated to strip out those files that
I don't want and then the other file is
over here in web.xml and it's created a
lot of XML that you're glad you didn't
have to figure out how to create by hand
the job of folks basically are going to
go in there and read the docs and figure
it out now
you'd have to read our Doc's as well to
figure out what to do but really you're
just adding these one-liners into your
rack up file it's a lot simpler
so I actually I'll show you real quick
what that page does if I go to my rails
primer I set the wrong one
I have this source directory and again I
can list on this application what's
going on there
oops
it's been idle here for a while now one
thing you will notice is that your apps
can take a few seconds to come back to
life and what have I done here oops
there you go
so I built a little controller and some
view that lets me browse and I see that
in fact I have stripped out all those
other files if you'll look at what
happens when you generate rails it
generates all kinds of extraneous things
they've all been stripped out and I can
browse around here and see what's
actually going on on the server and see
that it has in fact done what I expected
it to so even though you can't really
technically log in to the production
environment you can build some sort of
code in your application that you deploy
that gives you a view of what's going on
or possibly and some sort of JSON API
that lets you interact with the data
store and so it's really up to you to
build that however you want and I just
again my application I've modified it
here to display that it is in fact in
production I currently do have active
record enabled but I have an OLE DB
adapter that's a something I just added
in order to configure it without trying
to ask to do too much so any other
questions about that
that's right right well so with Java
your static files are by default
uploaded with your code and as static
files in Python they're completely
separate but for Java and Ruby apps if
you
it's upload uploaded to both places
automatically so if you if you didn't
want upload your static files as code
files you would have to exclude them
well it would count against your like
limit of number of files you can upload
there's no quota for code size and so
I'm just showing this is my local dev
app server running I've got a whole
bunch of files in there over here I have
very few files inside of web in flip I
have the jars that I need to run the
environment plus all the gems that I've
added to my app get jarred up into this
jar file so every gem I ever add ends up
just showing up in this one one jar so
things can be deployed much faster that
way
and you actually don't really worry
about a file in it right over here
what do you mean by testing
Logan so much
right well so there's different things
you can do you can run like the Ruby
profiler locally I think it might even
be possible to run the Ruby profiler on
your requests like in production you can
you know run a lot of tests if you just
want to see how well you're doing people
are working on some tools to analyze
things like how many Jack calls you're
making so you can optimize things like
that
there's new features the latest app
engine release we had added a header so
that I've been administrators of the app
can see how much they're charged for
each request so you can debug that way
too
there's
basically when I hooked up some kind of
basically yeah
there's
there's there's no threads we you can do
concurrent requests we will spawn up
multiple instances of your app to handle
the load the when we start up a new
instance is one thing I it's you have to
wait until your app starts which can be
pretty slow for JRuby applications
hopefully rails 3 will be much faster
but right now the first request for an
instance and rails can take 20 to 30
seconds after that it's much faster like
300 200 milliseconds for additional
pages but the first request for an
instance can be pretty slow yeah I think
the current timeout is 30 seconds
certain amount of time oh yeah
so yeah hey you will over time there's
no set time limit it's based on load
across all applications so and if you're
not getting traffic though it will spin
down and you'll have to start up a new
one eventually
and since you don't you don't really
know how many instances of your app may
need to be spun up in order to serve the
traffic there's really no point in
setting up a heartbeat monitor thing to
try to hit it because at some point a
new instance will come up and do
something but if you build your app in
such a way that it is you know maybe
using Ajax efficiently it should be able
to deal with certain requests taking a
longer and so it's every so often you
will hit that
there
yes so I mean you can well we have a
users API where you can use Google's
authentication for your app as far as
interacting with other Google properties
we have API for just fetching the URLs
over HTTP and so you can use the
standard Google Data API is for using
calendar logging in there whatever yeah
it's not here
if you go do want to go to the project
page yeah good API reference we have
Docs for all of the App Engine so well I
guess that had a list of api's that go
back so yeah right these are the api's
that are currently available here
there's more coming soon if you look at
the App Engine roadmap we're gonna have
things like XMPP large file uploads our
new features we're working on now you
can also so the one thing that I showed
in that configure you was it required
that was administrator I could also just
say require login and I can tell my app
to be part of some Google Apps domain
that I've created and so then my
application is only available to the
users in my Google Apps domain I can
also go into the app and I can say it
actually is called some host dot my
domain calm and I can join it into my
Google Apps domain and have it be this
first-class service
alongside calendar and mail and Google
Sites
yeah
okay well so that the data store the
question was just describing the data
store how it compares to other systems
so it's non-relational it it's basically
a key value store with querying each
each entity is what we call where your
store is basically a hash map you can
send save different name properties in
it you can use either an automatically
assigned numeric ID or you can use a
string key for finding things quickly
it's it has some interesting features
compared with other databases for
instance you can store a list of
properties directly in an entity which
is sometimes quite useful instead of
doing like joins you can store your
extra data right right in your entity
instead of having to do like two queries
or something like that or a join would
there's no joints supported it
we have support for transactions it is
consistent that best or whenever you but
when a right is finished your your dad
has been updated to or has been saved to
like at least three hard disks so it
rights are a little bit slower than
you're used to in a relational database
because of that but you're getting a lot
of extra safety that way and like I was
saying before it automatically creates
indexes for you and the indexes are used
they're required for every query you run
and because we have those indexes we can
answer any query and basically constant
time essentially it's based on the
number of results and how long it takes
to send those results over the network
not based on how many items you're
searching over not really I mean it it's
similar to the data mapper API we don't
we haven't exactly implemented the the
standard data mapper transaction API
because it it depends on like locking
whereas data stores transactions are
optimistic and so if the way it works is
you you call like you on an on your
model object you would call transaction
do and then give it a block of code and
it'll run run that block and if it fails
because there was concurrent right
it'll retry running the code up to like
three times until it succeeds
there's also you have to be there's this
notion of entity groups which is sort of
like automatic sharding for you you can
only work on a single entity group
within a transaction there's a bug that
right now there's no way to control
entity groups in from the data mapper
API so that's something one of the first
things we need to get fixed there but so
well know just that the App Engine
adapter for data mapper so as it stands
right now with data mapper you can only
run a transaction on a single entity but
hopefully it'll be fixed something else
that's I think a useful illustration of
how this works is since rights can be
slow and you sometimes have to lock
these transactions together the idea is
you focus on trying to denormalize your
data when you have the right and then
make reads really fast so this shows how
this bestfriends field is a multi value
field so instead of having a join table
that has this you know array of data you
can basically stuff as many keys into
that one record as you want to show the
best friends and so when you get that
one record where that one entity returns
you have everything you need to know you
know how many best friends that person
has and you actually have the keys to
those best friends you don't have to go
do any other queries so your reads are
very fast you've got an entity back and
you have everything you need it's a
little bit like serializing yeah mole
into a field like used to be able to do
with active record but it actually is
appropriate to do it this way
you know what do you mean yeah so well
so the queries you can do we don't have
full-text search you can search for like
equality less than greater than there's
a hack you can use to get like string
prefixes we don't we don't have
full-text search there's there's things
you can do user land building your own
index so for a single entity well so
there's a eat each API call you make
anywhere in App Engine is limited to one
megabyte so if you're storing one entity
in an API call it would be
one megabyte if you're storing five then
you'd have the total would have to be
one megabyte
any more questions in the back
um well so I mean there's lots of
reasons one of the biggest I mean
getting new languages implementing all
the security and stuff for them is very
difficult so building on top of Java was
able to make a skit Ruby launched a lot
faster
we also after looking into MRI a lot
we found some problems with scalability
that made us kind of worried and JRuby
seems like it's a lot better in that
area it's got better memory management
it's a lot faster in a lot of cases so
it looks looks like that's all the
questions alright well thank you thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>