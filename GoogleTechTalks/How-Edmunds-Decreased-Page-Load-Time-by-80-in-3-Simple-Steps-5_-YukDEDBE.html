<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How Edmunds Decreased Page Load Time by 80% in 3 Simple Steps | Coder Coacher - Coaching Coders</title><meta content="How Edmunds Decreased Page Load Time by 80% in 3 Simple Steps - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How Edmunds Decreased Page Load Time by 80% in 3 Simple Steps</b></h2><h5 class="post__date">2011-01-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5_-YukDEDBE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Steve Souders I
at Google on making the internet faster
and periodically we invite speakers who
are well known in this field to come and
give presentations I met this male like
a year and a half ago down in LA at a
performance meetup that we did down
there kind of a predecessor to the many
Metro meetups that our performance
meetups that are happening now and he
worked at Emmons calm was doing some
really awesome stuff they did a talk
there and then he made a proposal for
velocity last year and spoke there so
we've crossed paths a few times and he's
been working with Ryan Hickman here at
Google on some treat to efforts and so
Ryan invited him up here to give a talk
on what edmunds.com has been doing
around improving performance and one of
the things that you know the reason I
invited is being able to speak at
velocity last year was they've done a
lot of work on ads and you know I think
the performance of ads is really
important I've been excited to see
announcements here at Google about
improvements we're doing with our ad
snippets and if there's ad snippets and
there's also add content and it's really
hard to wrangle both of those especially
for a publisher who doesn't own any of
those pieces and so I think the work
that Ishmael and his team have done at
Edmonds comm is really important so I'm
excited to have them here it's been al
al-sharif from Edmonds calm please help
me welcome them thank you Steve Thank
You Ryan
can you guys hear me okay okay perfect
well I'm really excited to be here I
mean this weather what a crowd weather
turnout I'm kind of intimidated now but
I'm really excited to be here and to
share with you the Edmonds experience in
terms of performance and I wanted this
to be an interactive session so please
if you have a question just you know
raise your hand and ask it and I do
realize this is an after-lunch session
so I'm gonna try not to bore you too
much to you know
I know a lot of a lot of you are gonna
go into a food induced coma so hopefully
I want I won't be contributing to that
so a little bit about me my name is
Ishmael Sharif I've been with Edmonds
for three years now I came on board to
work on the front end department we
architect the front end with reusability
and modularity in mind and now I'm
spearheading the Edmonds platform or
open platform initiative so let's get
right into it today we're gonna be
talking about how we were able to
achieve these results we were able to
get our onload to fire from from 8.4
seconds to actually 1.9 seconds which is
77% on average 80% reduction and unload
and our page view is increased by 20%
our bounce rate decreased by 4% and our
ad impression variance decreased by 3%
so how we were able to do that that's
what we're gonna be talking about today
so by show of hands how many of you know
edmunds.com wow this is impressive I'm
really this is great so I'm really happy
about that so let me tell you a little
bit more about Edmonds comm we are an
automotive research company we've been
online since 1995 we have three
properties the first property is Edmonds
calm which is our main which is our
bread and butter basically that's our
automotive research company the second
property we have is inside line.com
and that's our automotive enthusiasts
site and actually all the car photos
that you're seeing in this presentation
come from inside line comm so if you're
into cars and into photography go there
our third property is Auto observer comm
which is basically automotive news and
research and it's a blog that we that we
own on average on Edmonds comm proper we
get between 200 between 150 to 200
million page views a month which
corresponds to 15 to 20 million unique
visitors a month so we pretty high
volume site our revenue model is based
on ad impressions and leads which is
converting users to talk to dealers and
and get the transaction going that way
so before I delve into what we did and
the three amazing steps that we took to
achieve performance on the front end and
and and yield all these results I talked
about in the previous slide let's go a
little bit back in history to talk about
what the site looked like this is what
our homepage on edmunds.com
looked like since 2006 that was a big
redesign that we did back then
you know aesthetically it's you know
let's just face it it's not the most
attractive site that we had but it
worked really well our servers were able
to handle the load that we got pretty
well our pages did not time out for our
users so we thought at the time that we
were doing really well revenue was up so
that it was it was cool we loved it
nothing was going on when I came on
board we did work on creating reusable
components so we can use the same page
component on different pages without
recreating recreating the wheel if you
will but that was about it you know
combining JavaScript simple stuff but
whenever we had a problem with a page
slowing down we always looked at the
backend we always looked at Apache our
servlets our JSP s but then while we
were doing that stuff Steve Souders came
up with or came out with the 14 rules
for page performance and he actually
connected the dots between performance
and the front-end architecture and he
made the statement that 95 percent of
performance is really a front-end job or
a front-end responsibility so that kind
of resonated with us and we were like
okay we were familiar with Firebug and
and the waterfall and the resources you
know we kind of knew that HTTP requests
you need as little of those as possible
on your page but it wasn't until those
14 rules came out that the the picture
was really clear for us and then
organizations like Amazon like Facebook
like you guys here at Google you are
you're lucky to have the ability and the
capacity to do these controlled
Berman's where you can actually could
relate performance to the bottom line
which is a luxury that we even have as a
publisher so we looked at the results
and we started thinking really seriously
about how does our site fare when it
comes to performance so instead of
looking out at our site and back-end and
seeing the load on all of that stuff we
looked this is a real picture now this
is how we're looking at our site which
is not really the best picture in the
world our waterfall doesn't look really
good like if you look at the blue line
that's the onload event it's firing an
8.4 seconds really not that great and
our score here is is really bad so the
site condition was really abysmal in
terms of things that needed to be
optimized we had way too many HTTP
requests and most of those requests were
blocking requests the pages were
perceived to be slow to the end user
because the unload event would fire in
8.4 seconds which which still was an
ideal and to top it off we had a lot of
components on the page that were that
were triggered by the onload event
firing so we had all of these critical
components that would only be rendered
when the unload event fired so if the
onload event fires in 8.4 seconds that
means that those components are not
going to be seen for 8.4 seconds which
was really really bad of course domain
sharding and external factors like ads
videos analytics and all of these other
resources that were serving from other
other domains we're contributing to that
problem as well so we were really
excited about what we heard Steve talk
about the industry the community at
large stock and talk about and we felt
that there's so much that could be done
here so what are we going to do started
tinkering a little bit and I remember
two engineers from from Edmonds at the
time reality president Elon romanovitch
they got together because at the time
you have to remember we were
evangelizing all the best practices for
patience talking about it
ride boarding the whole nine yards we
were doing it all but without real
results like we were
doing anything because you know it's
legacy we couldn't really do much but
these two engineers got together and
they said you know what let's take a
look at our CDN and the resources that
we're providing that the CDN is serving
on our pages and they looked at caching
so they did in I swear in the day I may
be a day and a half they got together
and looked at the configuration of
Akamai tweaked it a little bit added the
expires header and removed etags and we
served it for a week the results were
astounding why we just could not could
not believe the results to be honest and
I don't think they had in mind the
results when they were playing around
with with the Akamai configuration they
just wanted to do something they wanted
to apply one of the the rules and the
best practices to what we have and that
was kind of like a quick win for us but
the results were just amazing third of
the traffic that we had coming from
Akamai completely disappeared gone and
they add by the way they added that only
two images CSS files and J's files and
the expires header was only for 24 hours
so third of the traffic was gone
completely gone it was actually it was
so good that we were able to negotiate a
two-year free video streaming with
Akamai at no additional cost I mean
that's just incredible for us I thought
that was oh my god this is this is it we
need to apply those rules to our legacy
site but this is one of the things like
if you're a publisher and you are stuck
with a proprietary CMS and you don't
have a whole lot of leeway in terms of
what you can do and your infrastructure
there are ways to there are ways to to
make big gains in your in your
performance and on your pages - and that
will get you a lot of a lot of bang for
your buck so we started looking at all
the other rules but we couldn't do much
because legacy was was complicated we're
stuck with the CMS that we bought a
couple of years back and the way put
components and rendered the page was it
was a little
it was unfriendly to just put it that
way so we had a lot of we couldn't do
much with that but fortunately and in
the end of 2008 I remembered September
2008 we had an initiative at Edmonds to
re-architect and redesign one of our
properties in sideline comm the
automotive enthusiasts property and
that's when the engineering team thought
okay you know what this is it this is
our opportunity to do something real to
apply all of these learnings that we
everybody's talking about that we know
are important for our site into this
redesign and into the Surrey
architecture and the executives really
were all behind us because in a way into
the inside line redesign was a low-risk
opportunity for us so if we failed
completely it would not impact our
breadth it wasn't our bread and butter
so it would not impact our revenue as
much as edmunds.com would for example
but at the same time this RER Kotecha
and redesigned that we're going to come
up with it had to apply to edmunds.com
and all our other properties
so this basically where was our lad like
Edmunds labs if you will to experiment
around with that sand and we took it for
us in the roads some of the main
objectives for the redesign we're
performance rich content and high
revenues rich content is basically
specific to the inside line redesign
because of the the photography that we
had the videos that we had on all of
that stuff but performance for sure we
wanted our pages to be as fast as
possible how we we kind of had an idea
how to do it learning from the community
from you guys and but we we didn't know
how we're going to do it for us for our
specific use cases and of course we
could not impact revenue for the inside
line redesign revving the inside line
site revenue but but but at that time we
had a mindset already established from
everything that we learned at everything
that we've read we know now that faster
pages yield better users
and a better user experience invariably
lead to higher revenue so that's that's
where we're at but as you could was as I
showed you from the admins calm side
condition
we're plagued by a lot of HTTP requests
that we had so we have to kind of
reconcile that how we're going to
achieve performance when we have like a
bajillion resources called on a page
when we looked at the kinds of HTTP
requests that we're being made on a page
on edmunds.com and inside line comm and
auto observer don't forget this
architecture had to apply to all our
assets right so we took a look and we
notice that of course I mean with just a
no-brainer but we needed to validate
that the kinds of requests were request
made to edmunds.com or admins calm
controlled domains and requests that are
made to third-party domains like
double-click net-like Omniture net or
calm like Brightcove comm all of these
third-party domains that are part of our
page but we have no control over so for
our own requests we know pretty much
what to do
combine requests use sprites for images
use data URIs for images when
appropriate call the HTTP our code the
JavaScript requests at the bottom of the
page we knew what to do with that but
for third party we had we had the
limited ability of what to do so we
looked at the third-party requests and
how they existed on our pages they
existed in two forms JavaScript and
iframe and from our own experience with
each form we listed the pros and cons to
each there's an anecdote that I always
like to share which is you know in
hindsight it's funny but at the time it
was not really in summer of 2008 we had
a page one of our main very important
critical pages actually would not render
in IE it would just half the page would
render and the rest would just not show
up and actually the browser with crash
and we had no idea what was going on we
spent two weeks trying to disable
components and you know is it a backhand
looked at our servlets and nothing was
going you know those were flying we just
had no idea what was going on it we
ended up learning obviously after two
weeks of constant research and and
playing around with the page that we had
an ad the second ad on the page that was
creating a memory leak in IE and the
whole browser was just freezing and that
was like okay that's great no because we
didn't have an operator we didn't have a
way of disabling the ads to see how the
page would would behave with with the
ads and without the ads so it took us
two weeks actually to get to that point
where we removed that specific ad and
reload the page and oh the page worked
well and then we we found out that that
specific asset that the ad is serving
was defective and we you know we went
through that channel and solved it but
it took us two weeks to do that which
was not good of two weeks of my time and
my team's time go ahead so the question
is was the the asset flash I will I
believe it was I believe I think it was
one of those expandable ads you know I
tried blocking it out of my memory at
this point but but yeah it was bad and
we decided that you know we cannot have
this happen with the redesign and if
that which should happen we need to find
that out pretty quickly we cannot afford
to spend two two weeks of everyone's
time on this problem so part of the part
of that problem was access to Dom right
that that JavaScript ad completely hosed
the JavaScript engine on our page and as
a result of that you know the page died
maybe it would have been different if it
was in an iframe you know a completely
sandbox experience maybe I don't know
but the fact that JavaScript ads have
access to Dom use document.write and all
of these things that we've had us at
Edmunds I'm not saying that the world at
large but us at Edmunds we had a problem
with we needed to avoid that so that was
a con the pros of course is you know
you have richer content so we looked at
the two forms and how they exist on our
site we found that most of the
third-party requests that we had on the
site fall into the JavaScript world and
not a whole lot in the iframe world even
though we would have loved them to be in
the iframe world because you know very
very little cons and a lot of pros to it
but we noticed that the ads and the
widgets that we use kind of use both
formats and since we have a problem with
ads to begin with we focus kind of focus
on the ads in particular to solve the
outside main so our particular challenge
wasn't page performance versus HTTP
requests it was really paper form ensues
third party requests and that's when
when we started thinking of third-party
as these two guys that we needed to
conquer right so we have this iframe the
guy and this javascript dude that we
needed to kind of like put online but
the the the iframe guy was agreeable you
know you could lazy load him you can you
can you can play around with you know he
can be plays nice with with our site
with our pages but the JavaScript guy
was kind of like problematic and there
was not a whole lot that we could do
with that so we tried to break him to
try to control him for us the main
problems that we had with JavaScript ads
or Java Script third party requests was
the document dot write that was at that
time so we try to override the document
dot write which worked great you know we
spent a couple of days working on that
and was great until we ran into some ads
that had nested document dot writes and
then we were like okay for caching that
string that's supposed to be cut
spitting out and spit out by the
document dot right we really don't want
another document that right in there so
we thought okay maybe we can substitute
that and inject you know get the result
for that second document that right and
and grab the result of that and injected
in the string in the cache string it
turned it to be this nightmare for us
that we couldn't really we couldn't
really solve so we said you know what
we're just going to skip that we have no
time to override
at this point so the second one which
really was the attempt that I was really
excited about was to create an iframe on
our page that exists within our own
domain and then load the JavaScript
JavaScript add-in the iframe and then
when when it's done loading communicate
back with the pairing page and have us
you know grab it and put it on the on
the page where it's supposed to be that
was great in Firefox in in Chrome in
Safari and all of these browsers but in
IE was a little problematic it works
most of the time but not all the time
and we couldn't really risk for the you
know putting out a solution there wasn't
100% working for some reason in IE and
please correct me if i'm wrong and i
would love to hear if you guys worked
with this in IE the the iframe onload
then sometime is buggy for some reason
or doesn't always fire but almost xx to
30% of the time when we experiment when
we load tested it it would just not fire
and we know that the ad works properly
so I'm not really sure what's going I
was really excited about this attempt
but we decided to ignore it for that so
that basically you know we tried to
break the JavaScript the third-party
JavaScript calls and we failed miserably
that's when we decided you know what
let's take a step back and take a look
at what we're trying to do here we're
trying to make our pages faster right so
let's control let's let's focus on the
stuff that we have control over and make
that as fast as possible and find a way
to mitigate the impact of the other
stuff that we have no control over
without without controlling it per se
you know just find a way around it to
make it work with the page but without
controlling it control its internals so
that brings me to our first amazing step
that we came up with which is that you
cannot control everything and it's okay
you don't have to control everything but
that was an amazing revelation if you
will because the moment we understood
that it made us really focus on the
stuff that we have control over without
worrying too much about the other stuff
and when you look at the
Sanna jour the ratio of third parties
requests in relation to requests that we
have control over actually from the old
sites to the new sites the ratio
increased because we reduce the number
of requests that are being made from our
own domain so the ratio of the of the
third party requests increased and can
you imagine trying to control 40
different ways of 40% of different ways
of handling requests on your page we
would just we didn't have the capacity
or the resources to do that because if
we came up with a solution for a
particular third party request that did
not work with the other and you know and
and if the third party changed the way
they're doing things that we had to kind
of change our way of doing it we just we
didn't want to do that the second
amazing thing that we learned was that
make what you control faster and that's
when we came up with our JavaScript
loader and that's really what gave us a
whole lot of bang for our buck that's
when we created something that from
everything that we've learned and all
the problems that we ran into a couple
of years back we put it all into this
JavaScript loader object or class so how
this is how it works the moment the user
comes to a page you serve over the wire
a very simple skeleton page that has all
the markup that the user needs to see
something going on on the page and the
the CSS that the user needs to that the
markup needs to look nice to the user
basically but just the bare minimums if
you will just a bare minimum so and and
then as the browser so I'm the browser
and I'm parsing this page I'm running
into all of these components that in the
past would we would render right away or
we would subscribe to a non Dom ready or
unload to to render it but now I'm the
browser and as I'm coming across all of
these components these components are
registering themselves with me
the browser all those all they're doing
is telling me what they need
and what could that I should be running
for them later and the priority that
they have and at the bottom of the page
when I'm done parsing the whole page
then I go back and render all of these
registered components so this is how it
works really we have like X amount of
components on the page each time the
when the browser approaches approaches
those components each component will say
hey I need Yui carousel model a module
to work and here's my code and by the
way I need to be rendered right away
because you know I'm above the fold or
whatever and you know I'm an important
component so you're declaring your
dependency there when you say when the
component says hey I need Yui or I need
flash Jas or I need X Y &amp;amp; Z what the
what the component is doing is its
declaring the dependency dependencies it
needs to the browser and once it does
that it goes ahead and submits its own
functionality you know which is
basically the code it needs to run and
also it sets its own priority and the
reason we came up with the priority is
that we're very SEO centric and some of
the some of the mechanisms we use to to
enhance our SEO ranking is for example
our header sometimes we put the head or
mark up at the bottom of the page but we
need to render it as fast as possible at
the top of the page so because of things
like that you wanted to you wanted to
set a priority for that specific markup
snippet so regardless of where it exists
in the flow of the markup you want the
browser to act to execute it in a
particular order so in code basically
works something like that so our page
setup object is is a very small
javascript object that lives at the top
of the page and acts like the registrar
office if you will so every component
pushes all their dependencies to that
object and then they add a control which
is the functionality that they need
rendered and they said that to a
specific priority so once the browser is
done with all of that stuff at the
bottom of the page it goes in
it goes to include all of these
dependencies that all of these
components requested one of the things
that we had in the old site which was
really really really bad was that we had
multiple requests for the same resource
so for example Yui the yahoo core Jas we
sometimes on some pages it was included
nine times so which was you know a
nightmare because of the way the CMS
worked it had all of these separate
components and each developer would say
oh for my component I need Yui and the
other guy is saying I need Yui and
sometimes these components exist on the
same page but because they don't know
what they're doing you know each
component doesn't know what the other is
doing they request the same resource
which was really really bad after that
on top of that we didn't have caching so
each request would be a real request
that would go out so we decided that
regardless of how many resources or
dependencies each component is asking
for we need to eliminate all the
duplicates so that's the first first
thing that we do or the browser does it
eliminates the the duplicate and then
you lo we load all the dependencies in
serial serially in all browsers except
for firefox 3.6 i leave an earlier
because now with the new Firefox the
Firefox 4 it actually loads when you
inject several dependencies or Java
scripts when you request them in in the
Dom it executes them without paying
attention to the order in which they
were injected into that which was really
a bummer for us because we counted on
that for in Firefox at least because in
our code base we have a lot of
dependencies between the JavaScript
files and we really wanted the browsers
to download them in parallel but execute
them in the order that we injected them
in the Dom for god sakes so and that was
not the case but anyway I digress but
for our new JavaScript loader though we
are going to we're eliminating this
dependency completely so once you
download all the dependencies that all
of these objects request
you execute the functionalities there
you know the rendering portion of things
and that's when we go ahead and merge
all these functionalities based from
high to normal below all in one array
and then we go ahead and get one execute
one array one one function at a time and
this actually if you guys are not
familiar with this set timeout function
it's actually a function that Nicholas
Zakas blogged about thing in the early
2009 or something like that and that was
his way of executing long-running
scripts without timing out in browsers
and because we had a ton of components
on the page we did not want to use a for
loop otherwise you will get this timeout
message in IE and and firefox and all of
that so this was a way of kind of giving
the browser a breather for 425
millisecond and then you get the then
you pop you pop out the next function
and you execute and you pop out the next
function you execute it every 25
milliseconds and the reason we chose the
25 milliseconds was because it was the
safest interval that did not choke ie
when we tried when we tried 15
milliseconds ie still hung you know it
froze when when we round that code so 25
milliseconds seemed to be the sweet
sweet spot that worked for us so now
what's going on is the JavaScript loader
goes to your the functionality function
the function array and pops a function
executes 25 waits for 25 milliseconds
pops another function executes sit and
so forth but that doesn't that is not
dependent on the previous function
finishing so some functions could be
working in in parallel if you will which
was really exciting because we didn't
you know that's kind of like a byproduct
of the of that function I'm not going to
take any credit for that when Nicolas
talked about it I thought man this would
apply beautifully to what we're trying
to do so we applied it
the third amazing thing that we learned
is to treat everything else as a block
go ahead sir sorry sorry can you repeat
the question
Oh none of our capabilities I came back
in da rights
No yes well the question is what if one
of the components uses document that
right the thing is because we do this in
in you know independently from the on
load and the on Dom ready event we could
not have anything in our component code
that uses document dot right but for
adds week this is where we treat it as a
black box because most of our components
actually render or start rendering after
the unload event is fired and the page
fields respond feels like it's done to
the user so treating everything as a
black box we looked at these guys in
these we said you know what forget it
black box them we're not going to worry
about them so this is basically the way
it works with third party the browser
runs across parses the page and runs
across a component it checks to see
that's the JavaScript load or logic
right there it checks to see if that
component is an admins component or
something that we have control over if
yes then make it register itself you
know based on the three-step process I
just talked about if not if this third
if this component is a third party
component then let's check to see if
it's an iframe if the users iframe
create a placeholder and make it work
through the through the JavaScript
loader it's through the regular process
because with iframes all we need is to
create a iframe tag without the source
attribute set and then pass to the
loader or register a function that would
set that that attribute later on through
the JavaScript loader with this priority
low or priority normal or whatever you
want it to be so that's fine but that's
why we love iframes but for the
JavaScript guy we have a different
approach we create the placeholder we
register the we register that component
with it with with with our JavaScript
loader but as a completely different
component not as an admins component but
as a third party component and that that
means that when our JavaScript goes when
our JavaScript loader goes through it it
doesn't really touch it because it's not
it's not part of this pool of components
that we we're handling but the way it
handles it the the you know the way the
way it's different the way it handles it
is that once it encounters a third party
or a JavaScript component at the bottom
it includes it at the very bottom of the
page it calls it in a hidden div and
then when that specific resource is
loaded it removes the original request
from the Dom and then copies the node
within the hidden div and puts it where
it's supposed to be where it puts it
where the placeholder is and I'll show
you how that's done so that's that's
where you get your placeholder I'm not
going to talk about the iframe because
it's simple you know just it's handled
the way we I just talked about in
previous slides but for the JavaScript
part of it is is different and that's
how it works you create your place
folder and you register the details and
the details I need from that component
is what is the placeholder ID that you
just created and I want to know what is
the URL what is that JavaScript URL that
you're trying to request and that's it
at the bottom of the page I go ahead and
grab that so at that time at the bottom
of the page I might have like four of
these JavaScript objects registered with
with the browser so what I do right now
is I go through that object and I embed
I create a hidden div and inside that
hidden div I request the resource that
JavaScript resource and what's not here
that you will see if you look at our
source code we have also an on load and
unload a function defined so when that
resource is loaded it takes it and puts
the resource back where it's supposed to
be I'm just gonna stop here for a sec
there's a lot of questions people with a
lot of questions I'm gonna stop here for
a sec you guys have any questions so far
I'm sorry go ahead
yeah
you're saying that we're the document
dot rights still gonna be executed yes
because we're injecting that in the
markup before the HTML tag is closed so
we yeah it will take it will take its
time so is that what you're asking
I'm sorry will if you can come to the
mic echo I would really appreciate it
I'm trying to compensate for
I don't care when it's done that with
its right I'm not really sure so he's
he's asking the question is that when
that document diorite comes back with
other document that writes and it keeps
doing that that would kill the page
automatically for me so what we have
done is we include all of that stuff
after the JavaScript loader started
rendering the register components that
we talked about so we have not run into
situations where an ad was was bad
enough in a hidden div that was hanging
the the page is that what your concern
is that's a good question we have not
run into that we've run into situations
where the ad never came back and the
unload would never never fired but the
rest of the page rendered fine right
would like everything right right so
Steve was saying that because we have
all of this stuff at the very very
bottom of the page below all the visible
elements or the elements that we're
interested in rendering it if if it
would block anything it would block
everything that's below it which is
really not not a lot or the requests
that are being made in the background
but to be honest with you we've never
never had a problem with this so lucky
else I guess so what we learned in this
whole process was you cannot control
everything which is really you know it's
okay and you know you just live with
that it's fine I know we tried to always
over engineer things and certain things
it's better to leave alone make what you
can control fast and that was really
good for us because the 25 millisecond
interval for just going at it and
rendering these these objects or these
components regardless of the on Dom
ready regardless of the unload event was
extremely helpful for us and it it
proved to be very very made the page
very responsive to the user and that's
our main goal and also treat everything
else as a block box treat everything you
have no control over as a black box and
in a separate process like what we're
doing with the JavaScript requests and
that because we don't forget we're
trying to mitigate the impact of that
component that we have no control over
we're not trying to eliminate the impact
completely because when we try to do
that we failed so for the inside line
comm which is a very rich site with a
lot of flash a lot of photography and a
lot of videos this is what we yield and
by the way these images that you're
seeing being requested between the and
dom ready and the unload are those those
are visible images because we wanted to
send as much as possible to the user and
have things
to them right away but if the images
existed below the fold we would not
render them we'd not request them until
the user started scrolling down and then
we would request them so we tried to
include some intelligence some sort of
intelligence there to handle that and
that was huge good that and these
screenshots are from webpagetest.org
which is which is an amazing tool by the
way if you don't know this tool you need
to check it out it's it's great both of
both of these screenshots are from there
thank you so as far as we're concerned
the inside line redesign objective you
know was met we were we were able to
create faster pages at least much faster
than with the pages we had in the past
we were able to deliver richer content
and the revenue hasn't been impacted at
all actually what we noticed over time
is that the ad impression variance which
is the difference between the numbers we
we report on and the numbers that the ad
agency tells us that we serve has
decreased by 3% which is not a lot but
it's still a positive you know it's a
move in the right direction and then
after all of that living with the inside
line for a year and a half and seeing
really really positive results from it
then came the you know the real test if
you will we had another vision which is
to redesign the edna's comm site which
is really our bread and butter so that
was the real test for everything that
we've built so we said you know what are
we confident with everything that we
built we you know I think we I think we
are now in hindsight but this is this
was a real test for everything that
we've built we put it on on the site
that is our bread and butter that if
something breaks we're basically all
won't get paid and a whole lot of people
on contains so we did that's what we got
that's the difference between legacy and
redesign by applying the same principles
that we did and the same infrastructure
that we had built with with the inside
line redesign everything that we did
applied it to Edmund stock
and as you can see it's a huge huge
difference and they're comparable
because we didn't really introduce new
data sets we didn't make the new site
fancy or anything it's the same we're
serving the same day that was we're
providing the same functionality if you
will in the same value to the end-user
but in the difference in a smarter way
so as you can see from the admins legacy
it took 8.4 seconds the new site is on
average takes 1.9 seconds and the reason
I say on average is because we're doing
we're doing a lot of a be testing on the
new site and I need to reiterate that
we're mitigating the impact of ads we're
not eliminating the impact so by
mitigation we cannot really control how
you know how they're going to be
responding so sometimes they respond
really well and sometimes they don't and
if they don't we get the 1.9 seconds go
ahead
sure
so a lot of this will show charts like
this with the before and after right
they've done things between the before
and after other than performance
improvements like they cut the number of
images by 50% or something like that
right and you said something like the
contents about the same we can obviously
see the content looks very different
right other thing to me that makes me a
little although I just want to you know
believe your numbers right that makes me
a little skeptical is the number of
bytes I don't quite know this bytes in
but I'm guessing that's like the total
number of bytes downloaded is like a
third in the redesign right can you
explain how it's basically the same
content but a third bytes right that's
that's a great question did everybody
hear the question I don't I hope I don't
need to repeat so okay so that's a great
question in legacy we have a lot don't
forget we built legacy or it was
redesigned redesigned in 2006 and at the
time we've had a lot of markup going on
we it was everything was in the markup
served right from the server we didn't
have anything that was done in
JavaScript and done intelligently so
what we're doing and even though you're
saying that the content looks different
it maybe it looks different but the the
value or the data that we're providing
the user is basically the same we're
actually having more a little bit more
functionality on the new site but not
that not by much you still can get to
the used cars and used car new and used
cars from the oil from the new site but
in its in a different it's in a
different way so the the reason we did
it as you mentioned as you mentioned by
combining the images in legacy even the
smallest icons were their own files you
have no idea I mean we had we were
serving like a bajillion images that
were so tiny and small that all went
away some of them went were converted in
data URIs some of them were put in
sprites
there was a lot of compression and
elimination of needless markup and
needless code that we did for the
redesign that was not thought of in the
new site so and that's maybe where you
see the difference in the kilobytes does
that explain that little answer is it
answers your question okay
any more question before I continue so
the question is when we did it for
third-party ads when we put them at the
bottom of the page to include them why
did we use document dot write right
don't forget those that call let me go
back to where it was this is it right
okay
that call that we're making that call
almost invariably has a document dot
right in it right we wanted to make sure
because the document dot right gets
executed right away once you once it's
requested we do not want to be fancy in
terms of like oh let's inject it in the
DOM and let it see let's see how it does
let's see let's use the same you know
statement that that code that's coming
back is using let's just document that
write it in there and let it let it you
know go to the town let it do what it
wants we did not want to interfere here
at all so we use the same logic and
actually if you notice we have two
separate script tags here and we have to
do that because we're closing the the
hidden div if you put that statement
within the first script tag
sometimes the ads if you have nested
document that right it would spill over
and outside the hidden div if you put if
you write it in the same script tag so
this the first script tag had to kind of
have to be executed and finish executing
before the second script tag is is
executed don't forget these script tags
are kind of like blocking requests so
when the second script tag is executed
we are guaranteed that every
think that the ad needs is on the page
that no further requests are being made
at least not no further requests are
being are going to be injected into them
so to answer your question it probably
is might be a better solution but we did
not want we did not want to interfere
with the ads black box it use whatever
they use you know to speak the language
if you will go ahead does answer your
question I'm sorry
right so so what's happening here is we
have two lives right we have the ID cash
and the ID fruit so what we do here you
see the two divs so the ID cash is just
the the hidden div that encapsulates
everything the ID root div is what we
copy that's the node that's the kind of
like the route that we copy and inject
it
we don't do inner HTML we actually copy
the route itself and append it to the
placeholder that we had before we do
that and I need to stress on that we
remove the original call because if you
don't remove the original call that you
made you will end up with double
impressions in IE it will call it again
because you're injecting into the
browser does that make sense and I'll be
around
obviously afterwards I can walk you I
can show you in the in the in the code
itself I would all of this is done all
right so we applied it to Edmonds and we
got amazing results and we have 20%
increase in page views per session which
is huge I mean that really proves that
engagement increase and we cannot take
as far as engineers all the credit for
that because the site was redesigned a
little bit I mean the look and feel is
completely different but we know from
everything that we've played around with
from our a/b testing that performance
makes a huge difference in user
engagement for us and from everything
that we've learned from the community
that it is I mean there's a direct
correlation to it
and again as I mentioned the discrepancy
between ad impressions from why we
report than the ad agency reports is
decreased bounce rate which is another
one of our metrics for 2011 is to really
reduced dramatically reduced the bounce
rate and it's been - reduced by 4% I'm
happy with the hats so in the works in
the future what we're working on right
now that we're really excited about is a
completely different JavaScript loader
you know we've we've created the
JavaScript loader it served us really
really well but it still has its
shortcomings right like the series
serially downloading the dependencies
was something that we I was really not
happy with so what we're working on
right now is separating the downloading
and of the dependencies from the
execution of the dependencies so we want
to download them still in parallel but
we want to control when to execute them
and we want to execute them on demand
and they know Steve is it's worked on
control Jas and we looked at that we're
probably going to build on that but I
know that's the community-at-large is
working towards that and we also want to
we're working on creating component
level metrics because we believe the
onload event is is great as a metric to
know like how responsive your page looks
or it feels to users but we also want to
know when a specific component is render
to the user for example if the component
is the header the navigation header if
that is rendered we want it to be
rendered right away and we don't know
that right now we don't know if it's if
it is rendered right away or its
rendered after another component is
rendered and so forth so we need those
timing mark marks if you will
markers and also many other enhancements
that I don't want to talk about just
because to be secretive and also we're
going to open-source I know I promised
Ryan I'm gonna unveil the JavaScript
loader when I talk to you guys but for
reasons outside of my control I could I
could not get it to get hub in time I'm
sure I'm sure you guys know that we're
familiar with that concept but very soon
it's going to be up the old JavaScript
loader is going to be up and we're going
to be introducing changes
the enhancements in the github project
so this all great for what we've done in
the past but what I'm really excited
about to talk a lot to talk a little bit
about today is the future and where
we're going in the future
and one of it is how we're going to take
all these three amazing things that we
just talked about and apply it to mobile
we are creating mobile mobile presence
web mobile experiences at edmonds and we
know like for example using data URIs
and all of that stuff we know what to do
in a way and how to apply what we did
for the wired site to mobile but I'm
pretty sure there are different rules
that apply to mobile then then those
that apply to the wired and what are
those rules and that's what I'm looking
to to work with you guys and the
community at large to kind of figure
that out as we go we don't have the
answers yet where we're trying to figure
them out and we also turning into we're
I'm spearheading this Edmonds platform
initiative which is a really interesting
place to be in because we're moving from
third-party consumers and that mindset
to becoming actually a third-party
provider as you can see here we're going
to be creating syndication syndicated
widgets that are going to be working on
they're going to be plug and play some
of them and some of them are going to be
managed we're gonna be working on
providing api's through the rest to to
in-car computing to mobile devices and
all of that stuff so so this full circle
that we're in is really interesting
interesting because we've been
complaining all that all the time about
third party and the third parties are
not doing the right thing and all of
that stuff and now we're going to be in
that hot seat so what are we going to do
in order to be good Samaritans out there
and not interfere with other people's
sites and their performance so a lot of
stuff went on here and there's there's
more exciting things that we're doing at
Edmonds so please let's continue the
conversation and work together to make
the web and all its forms a faster place
so thank you very much it's been such a
treat I appreciate it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>