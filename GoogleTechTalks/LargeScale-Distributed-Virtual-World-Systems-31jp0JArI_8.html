<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Large-Scale Distributed Virtual World Systems | Coder Coacher - Coaching Coders</title><meta content="Large-Scale Distributed Virtual World Systems - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/GoogleTechTalks/">GoogleTechTalks</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Large-Scale Distributed Virtual World Systems</b></h2><h5 class="post__date">2017-04-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/31jp0JArI_8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm solo so I'm a professor at Stanford
computer science Michael engineering and
I thought some people in this audience
who going to introduce me but then they
realize they completely forgot the class
that I talked to just exercise it from
the memory because was so terrible
especially maybe hopefully set a low bar
for this talk um so I was asked to come
talk about virtual worlds and this is
interesting topic to me because about
this play almost a decade ago a group of
us at Stanford did about a five year
project on how would you build
large-scale distributed world platforms
platform to be able to build
applications for virtual worlds when the
major question we asked was in virtual
worlds became like the next dominant
platform so think like post web now
we're like logging these virtual worlds
how would you actually design software
systems in a network to support that it
turns out that modern approaches there's
all kinds of issues and I'll walk
through this in the talk and so we
researched built develop deployed a
virtual systems using a bunch of
sociology research could run on about 20
servers yeah it's recording there's a
big red button remember 20 servers and
we actually had to invent a whole bunch
of technologies to make this happen and
i think i'm sort of it in but one
thing's if you'd law if you use any kind
of virtual world ish thing today whether
timing and second like this big but
you're like world of warcraft you guys
are all of these weird technological
limitations in those systems that you
sort of take for granted give you a
simple example i remember this is like
when Star Wars was a agency Republic
there with MMO at star wars MMO came out
and you'd be wandering around in a town
everybody telling you'd walk in every
town you're in New then there's like a
big room that's a cantina cantina room
as a building and you go to it and
there's a door there's a really big door
or sucking them coming it out and right
in front of the door there's a wall and
so to go into the cantina you kind of
like walk in and then walk around this
wall and this is omnipresent any
where you went any big place people
might go there's a wall in front of the
door and the reason is that they
couldn't quite handle figure out how to
do like visibility within that room or
and within that building from outside
like a number of objects have to handle
so what they do is they just make it
that there's no line of sight within
this large space that can partition it
more easily on sees gonna lose weird
visual artifacts or like instead of
content artifacts based on some
underlying systems problems and so yeah
let's run back 2008 you got stuff like
second life or this was this PlayStation
Home thing which died out there lots of
virtual assailed did stuff like World of
Warcraft you know is still very very big
at the time where he's got tens of
millions of people playing these virtual
worlds lots of fun immersive
environments you know anyone see those
videos about Asheron's Call when I went
down to the last rounds call is actual
house calls one of the first MMOs around
the time we have requests I'm actually
built by some people went to college
with amex was technically very advanced
could do all kinds of crazy load
balancing and they shut down the servers
for real i think there's about our month
or two about people in playing this for
nearly 20 years and there's all these
videos of like as everyone like starts
to die like disappear at the server
shuts down and like people crying but
with community and they imagined it
would show this their kids okay so you
look inside one of these systems is like
and you've got some client that's
controlled by the provider you know
whoever sells you this game where the
system and for the most part even
they've got some side servers for things
like chat or email with the system and
then there's just some kind of cluster
of servers that are running the world's
weird sort of thing doing the hard part
of the interesting part of this
application if you take inside there
it's actually it was used to me when we
started to do this door scratching this
is a little terrifying as to what was
being done not to be fair things like
second life its architecture as set out
in the late 90s right and distributed
systems have come a long way since then
and they were basically stuck with this
approach and talked to them a couple of
times in point of there are lots of ways
they would have loved to do things
better but you're just the actually
transitioning to some new system was not
within their financial or time frame
possibilities
so this means they have second leg work
the whole world was divided into tiles
called Sims and Sims had a static limit
how many people could be on one so for
example normally was 40 if you are like
really awesome then you could do
something where like you would add when
people would do is they want an event
with more than 40 people if they do is
they get for Sims there were all met on
the corner and then the homely event
right in the middle and they could get
about a hundred and forty people not 160
because there's some communication
across the sim so basically statically
partitioned skins are bound to servers
Sims don't migrate and you can get about
40 people in his own world of warcraft
and this is the direction that games
went post you know a strong skol or
shadow bait or something like that
essentially there is a server for each
continent in this fantastical and
awesome game world and their login cused
again with the confidence that the
predominant all the content of the
system with the dungeon stuff to go to
RM instances so basically little you
know think fragments of the world that
nobody can interact with there's this
private little space and they can just
scale those upper skills now they're
most once the same thing but essentially
it's either everybody's in this
continent and then there's all kinds of
bandwidth limitations all kinds of
rehearsal notation so log in queues or
they actually just partially I'm going
to share nothing little instances across
the world this is very different than
stuff for example even some early
systems differ you had like a single
cohesive world with no boundaries
between you guys run from one side of
the world to the other it's dynamically
load balance and what's on servers but
people moved way through these really
static partitions which have issues of
logins and load balancing etc but also
this approach in some ways at least was
in our opinion really went against kind
of a whole point whole point of these
virtual worlds these environments was to
interact with people but the idea that
your cement you should putting ever in
their own little bin meant that here
you've got your friends those the people
you play with but it's no longer
actually that sort of say interactive or
densely interacting socialist space plus
I mean it's the 21st century if I should
scale with stuff
server rather than having these systems
is controlled saved by by blizzard or by
linden labs where they run the servers
you can learn code on the servers into a
second life but it's very limited on
anybody should be able to extend one of
these stewart systems for these virtual
worlds i should be able like bring up my
own server and extend the world in some
way like it can run objects on it could
use whatever you want and then also
society of creation right focusing on
interaction rather than consumption so
think minecraft right but an enormous
continuous virtual world where there are
tens of millions of people in the world
at once so how do you build it that's
where you try to figure out first step
you break it apart so like any computer
system is just a large distributed
computer you've got three things you
need to do we communicate you need to
compute and you need to read and write
data so communication competition and
storage what's a distributed system so
in the architecture we called the system
suricata for variety of straw reasons
first day of competition this is like
the script the actual behavior and the
activity in the world so think I've got
so cool submarine or I've got a volcano
or anything where you have some kind of
code or some kind of logic or some kind
of behavior and these run on kind of
stuff we called object coasts these are
servers that are running the virtual
machines or the protective environments
and you write some script for some
object and it runs on object oh so you
can run your own object coast in fact
your avatars off and any things you
might do for own local communication
your local data management would be
running say on your laptop and a little
object host that connects to the world
now objects need to communicate like I
need to interact with that tree you know
I need to turn on this light we need to
make the volcano explode and so the way
the communication between objects
learning objects house mediated through
what you really think of as the world
the space service these are the servers
that describe what are the objects that
are in the world where their positions
they do things like physics and they
also mediate all communication sort of
walk through later why they have to
because they're all kinds of constraints
you need to make sure the system doesn't
just collapse and fall apart
finally for storage there's a content
distribution number which ends up having
to do a lot of things relating to
graphical data graphical bit is
different than traditional documents for
a variety of reasons and levels of
detail aggregation again I'll go into
some of the details of how this works
any questions feel free to interrupt me
it has this to me this is like this is
some totally kooky research we did this
point almost five years ago and so I
thought it was lots of fun but so the
same is unclear I'm in this weird space
where we did this for five years and
make assumptions which you might not
might not agree with or might not be
certain well explained so to try to draw
a picture as to what that looks like so
you have here like some object coast you
can many object Coast talking to all
kinds of different servers right they're
all running different objects for
whatever for a particular person your
provider and then there's a space
servers that actually manage the world
and the world in some ways geometrically
partition different space servers being
responsible for different parts i'll
talk a bit about how you do that based
on load etc you know you can have a
single object coast that connects to
multiple space server so it connects
even multiple different worlds if you
want to that's totally fine i could be
present in world a and will be or if you
have things which are on one side of the
world and things that are on the other
side of the world this turns out to be
really this last point that you can have
a single object coast or even a single
object that talks to different parts of
the world turns out to be really
important for when you start scripting
these things i'll get a little bit of
that at the end so you break oh but i
miss been most today talking about the
spacer because it's where a lot of
systems e thing came from i can object
ptosis running scripts and sending
messages there is a necessary big
scalability or distribute issues there
stay server though has to be distributed
in has to scale so if you break it up
and look what's inside there were five
major components on the first is what
was called we had our little acronyms
there's locations this business physics
is this a table of saying all the
objects that are here on me that I'm
responsible for what's their position I
run physics see if they collide you know
this is the definitive
authoritative statement is the physical
location of an object in the world so
that's loke then there's a service
called coordinates of mutations you say
this is basically a server sir you say I
have a bounding box in the world some
geometric you should I care about what
servers are responsible for it if I
don't want to send a message to an
object to that position the world or I
want to ask something about that world
which server should I talk to I simplest
thing is when you log in and you have a
position you want to start in your home
you need to ask the system what server
is currently handling my home this is
based solely responsible for you ask
CSEC now if you think we're trying to do
a planetary scale virtual world think
you've got six billion avatars say
spread over something that has the
surface area of the earth this
coordinate segmentation service is
actually pretty big it's not just a
server because of things are moving and
the load is being balanced and things
are changing this actually is
distributed system in or if you can
answer that query the third component is
something called Pinto for potentially
interesting objects this is the way that
an object if it wants to say ask a
question what other objects are in the
world what do I see over there this is a
service that does those little cups sea
bass we asked a query of what do I see
or some other team up your query and it
tells you what objects answer that query
the the fourth part is something called
object segmentation so coordinate
segmentation tells you what server is
responsible for a geometric region and
Pinto can tell you where objects what
objects let me at Magic query and then
look and tell me where those objects are
object segmentation is basically a cash
that's that if I want to send a message
to an object which space server did i
send it to what's the authoritative
space server for that objects I want to
send a message you know an email to my
friend who's across the world in the
virtual world then I need to have to
figure out what space are responsible
for you to deliver the message and
that's an object object segmentation
does and that's objects to servers the
last
the four is the thing actually manages
all the messages you can see the object
hosts send messages that the ohs they
send message in the folder then
dispatches to other space servers as
necessary etc so I'm going to walk
through some of the technical sort of
meat behind at least start the
coordinates pigmentation Pinto on the
floor because it turns out there's some
pretty interesting systems problems that
arose and trying to design this is
architecture all make sense if it
doesn't you know walk during example so
here's just here's an example to try and
feel like how these pieces come together
so this is an example of I just log into
some virtual world and I want to
interact with it well the first step
labeled here one is I need to find where
my home is so my odds of coast connects
you know to any space server whatever is
and then basically says hey space server
which space server is responsible for
this geometric position where I want to
be that space Ark remember space server
can then respond and say oh then this is
probably the space server actually want
to connect to you can then connect to
that one great now you know which
spacers are also for you etc so you
login there's authentication and all
that kind of stuff and then the first
question you want to ask is so I'm going
to show up in this world what do I see
what's around me and that's when you ask
there's a step to a question to the
space server which is forwarded to Pinto
potentially interesting log and it's
going to basically give you this or
based additional is the properties the
world what do you see on the limbs
starts cooling things in from the CDN if
necessary etc then the next thing I'm
going to do say is one of the objects
that I saw I want to interact with it
like I want to turn on the light my home
or I want to turn on you know the
fountain or do something fun whatever it
is uh so what I do is I send a message
I've gotten the names of these objects
from Pinto I then send a message to that
object if this first object is local
this is arrow 3 goes up into the forward
and forward ago this object is local to
me i'll just forward it down to the
resulting object o spell because we'll
dispatch it all good um if
terms of the object isn't on the space
server like maybe you want to do
something that hill over there or that
house over there like ask something
about it then it might get forwarded to
a distance based server if the entry is
cached then it can just go to the
foreigner its entry is not cached like
maybe you know some dragon just flew
over the horizon you want to do
something about it then you'll go
through the object segmentation service
to cash in entry as to what the mapping
of object identifier to surfers yeah
between the caption 0 so that you can't
ensure consistent read because right
like it could be that I have a mapping
saying that dragon is on serving 43 and
then the dragon is flown to server 42 so
will happen is they'll send a message to
the dragon and server 43 and 43 will say
I'm sorry I don't have it and it will
forward along it's basically going to
wreak weary because it has more
up-to-date data it has also been send a
message back T like a redirect saying
yeah don't talk to me your cache entry
is invalid
it has to be on one like it exists
otherwise it does not exist in the world
right so there is so much there is some
atomic transition that occurs right we
say like oh I'm handing over the dragon
from 43 to 42 those two servers will do
that transition now I think is that
ultimately you're trying to deliver it
to the object coast and so if during
that transition both of them could
forward it to the Dragons object toast
that would be okay right yeah but
ultimately you don't want to be sitting
there holding the bag for objects that
have long left you right because of the
live n from us scalability standpoint if
it gets tricky because wait there's a
reason why maybe they left you please or
some lowdown things are partitioned
space again that's indicated you realize
like if you're talking about a virtual
world at least if you take it from a
human centric rather than a machine in a
few perspective like you know the time
scale of a trend of hand / etc and
affording the messages is tiny compared
to a person clicking right like the
degree the rate in which people are
interacting with things and so you can
you can kind of get away with this
little bit if we started getting you
know scripts that are doing sir
technically machine a machine tough
within then it might get a little
trickier we didn't get that far oh yeah
traders yeah yeah yeah that's it because
I get what do you do like so like some
of the world disappears right you have
to bring them new server things up to
reconnect etc so usually the way that we
handled crash shields either it gets
hard to get really tricky to the way the
primary space partitioning works because
essentially if one server crashed it's
very very hard to distribute the load of
the server that crashed on too many
servers because there's no callate them
like it can't be that the 5,000 object
that are on that server are now put on
500 different servers because they're
next to each other so what you do is you
kind of fall over to one of the servers
that was adjacent but then takes over
that region but this has more balancing
the other thing is you could spin
something up but yeah crashing because
of just the intense locality right you
can't sort of spray things and get you
know independent colors is really is
pretty rough
away from server side yeah it does you
know no redundancy you could if you want
to do you know their server care if
they're of like resources vs yeah I mean
you can't do you can't do like coding
style redundancy first of all or so you
can t likes impartial Guardian should
like just based in replication
replication does get a little tricky
especially when you start talking about
flooding point computations that said
are like we real concerns of things with
diverged especially when it comes to
physics right so you do kind of need an
authoritative copy you know the other
hand there's kind of fun like wait like
if it crashes you know maybe the person
is like booted to a nearby server or
they get where this is something
actually people are quite used to in
virtual worlds to go back to again
ashrams college or a congressional
impressed I was actually technically
working small no sophisticated ones what
they would do is if they would be
dynamically scaling the partitioning
until finally got to there's like unit
which you can't get smaller than and if
there are more people or not because the
circle like 1999-2000 more people are on
that one little tile than they could
support then the evil sorcerer who ruled
the land would cause a huge storm grew
up here people violating both will be
teleported so they don't do that right
well it's like let me do this question
that I can get back to you yeah so
around the world time so much sodium
precision I'm good critical in physic
Iran wall time the buddy on their own ah
well so you mean part of something
without a server it's not difficult
right because that thing is just during
local physics as we're doing physics
cross-server boundaries basically you're
talking to it most and in the most
extreme case you're talking to 26 other
servers right and you can imagine as
longer synchronized with them like I
don't need to do physics is something
that's five miles away to physics with
things that are on my surface and
juniors time synchronized with those
local servers again also in this your
first particular saying we're initially
concerned with ultra realistic physics
right athens like oh you know maybe like
the ball moves a little too far left for
the spin is wrong or something
physics engine themselves it felt like
graphics have super accurate physics
lecture scales in real time cool on
Dragon object over a couple of both its
own notion of time and animate itself
and the space Surfer what is this wings
look like right now or I no space server
knows nothing about that that's
basically a statement now this gets done
to what the geometric models are and
this is all between object host so
things like when the Jagan said I'm
breathing fire effectively that's doing
it's sending a message to all the other
things like I have transitioned to this
different sub part of my model because
often those models have animations and
coders and etc and yeah you could have
some weird thing we're like you see the
dragon breathe you know whatever you're
like half a second before I see it not
like often for the then we're talking we
have to be very distant in the world
because again adjacent servers have good
time civilization the other thing is no
place that really attempt to matter is
site because you think about the speed
of sound right so for example let's say
that dragon bellows right roars the
actually the propagation of sound across
the virtual world is such that time
synchronization is trivial right like
sound is slow it's only light that's
fast so you also sort of helped by the
fact that like people actually are not
very good observers right if like the
dragon breathes and then the night races
sort or something like that like you
know whether or not you like the night
has a greater implication on how you
remember that then what actually
happened yeah you still let you still
have a question okay sure yeah yeah
that's what they do yeah and then except
when you're like 14 hours into your make
a raid to get like the helm of
awesomeness and then people really upset
I was okay great so well okay yeah let's
leave this up because talk about forever
you mean something everybody jumps on
uh yeah so one part of it is that I'll
talk about like how you can partition
the role at some point you're right like
there's a really soon as people going to
be handled by a single server there's
only so much you can do even the context
of this time like you could get a lot of
people like the server itself could
actually handle the order several
thousand objects per core so in that way
like the bottleneck was not the server
often those kind of cases the bottle
like the graphic side of things right I
have all these individual models and
I'll talk a little bit of how we dealt
with that yeah yeah your drunken dragon
your drunken dragons good for a joyride
on a server boundary yes these are the
kinds of problems you have to kill it so
well so will the chair summers are like
you'd actually fairly far inside the
cell right so let's start with that
assumption so the case you're thinking
of is the thing is weaving and it's
actually moving very quickly because it
actually enter back in now those cells
very quickly like so what do you think
of the history since value i should use
for oh this thing was in that cell or in
this region and it's moved over to that
region but maybe I should move it just
yet because I want to wait for a little
bit yeah it's going to be hated
goodbye server that is adjacent to
geometric Lee which you already have
like yes there's a way there's basically
way when that in the physics system
right we're like you can communicate
like you're going to do physics with
some objects that are not actually
hosted on you or you do some kind of
interaction again right so let's talk
about what's the scales time
synchronization that matters so like my
dragon is roaring or like doing its
thing over there and it crashes into an
airplane right for like those kinds of
physics interactions like probably like
20 to 40 milliseconds is fine like human
perception versus if I wanted to do some
very precise like balls clacking
together in some you know pool table
right then you need much more precise
perhaps basically actually when you get
to the realm of human perception
suddenly time becomes very stretched out
such a things we think from the system
step we're like oh I need like
sub-millisecond synchronization or
microseconds organization that's way
beyond which you read your compute or
different frames a second set cool right
yeah yeah physical worlds slow okay
great so let's meet us up i'm going to
start unpacking these some the one by
one so seasick this is question of I the
geometric bounding box what server do I
talk to asus eee seg was essentially is
a large distributed access to line
binary space partitioning trait so with
even bisector so this basically here i'm
showing in 2d but it's in 3d as well
where although we often we would handle
the 3d case differently because often
it's not like you really want to
partition all the different levels of
air would be the case for example in a
city or somebody that the whole air
space is one region versus a little sub
parts nidia so there's this large upper
tree with a partitioning of the world
and that's something which is highly
replicates replicated across all of the
servers it
back the Emerald calculations like you
look at population growth can properly
population migration for 25 years on the
earth you know if you had 40 avatar for
sure Merlin see we're limited to
something like second life then you have
about 29 million nodes in terms of your
29 leaf tiles in the world of different
sizes if you can strain the upper two
Jet's to be 16 it's like it's about 30
deeper so so each of them the lower
trees is depth 14 what does it mean
based on the population movement and
growth in the world of the birth of our
toward those 25 years the upper treat
generally changed about a thousand times
now you can say like gosh is a virtual
world going to be as static as a
physical world people if you move more
we're not sure that's part of the issue
we had no idea what would be a reason
how do you test whether this per tree
will work well enough and this is the
best sort of rule of thumb again come up
with so it is that this upper treat is
highly replicated across all with all
the servers and then the servers
themselves determine the space
partitioning for their sub part of the
world and so when load is too high they
might break one tile at the multiple
tiles etc etc so chose an access line
BSP trees even bisectors just because it
makes the whole process maintain that
treats so much simpler right the edge
cases in one of the issues if you use an
uneven bisector what happens if you pick
in the wrong spot than just some people
move over a little bit better just
partition twice or three times okay so
that's that's see seg which was you know
isn't like a basically a two-quarter
project or what quarter project this
student did I'd like to talk about next
up two tokes and this is one of the most
interesting pieces of work that came out
so remember Pinto is the server so you
say essentially i'm going to ask some
kind of geometric query about the world
and tell me the objects that satisfy
that query so in question or else is
like what query do you want to ask what
can I see okay that's good so that query
itself is I think that's the basic one
you want to ask it's still a tricky
because you don't want to do a clusion
actually highly dynamic um so let's
suppose we're living in a flat world
what can I see is also a little tricky
because in theory you can see it
infinitely far actually let me flip this
another way what can I see but how do
you prioritize the results to come back
who is some objects you should return
first or some objects maybe you should
return second they last how would you
prioritize the results I query can you
rather be able to ask the query then
have things stream in have the world
come in rather than I sit there and I
wait for five minutes or all million
objects I can all see really how good
exactly right so let me first exactly so
solid angle so first I want to talk
about what people did before this this
is second life it's essentially all
systems what they do is you know it's a
couple caveats where they do some hand
done aggregation etc essentially have
distance queries I feel like what are
the objects that are within say a
hundred feet of you 120 feet of you and
so here's a picture of second life and
you can see this results in all kinds of
weird artifacts where you can be part of
the house right because those objects
are within your your distance query but
then you don't see other parts of this
is like floating roof and in fact if you
just take a couple steps forward take a
couple steps forward suddenly there's a
wall because again there's a pure
distance query and this let's just
extremely bizarre behavior so instead
what Pinta does is Pinto answers queries
based on solid angle and so you ask it
you like solid angle right Sirhan Sirhan
intent but it turns out answering these
queries is hard and all its surf explain
why and so if you can say you know here
is my direction that I'm looking into my
position you often want to start off
with a single direction and then go
towards three degrees he attacked three
degrees we actually need to focus to
prioritize what's directly in front of
you
and so question is how do you
efficiently and quickly answer a query
like that how bigger like give me the
biggest objects or what are the objects
that are big enough for me to see or
give me the ten thousand biggest object
set and so we built a new data structure
fits an Augmented bounding volume
hierarchies who take all the objects in
the world saying here not familiar with
bounding volume hierarchies ok so Bundy
volume power creep just look at this
picture on the left so that four objects
ABC and D and they are placed in the
world by that right side picture of the
circles and so ad are kind of close to
each other and so what you do with any
build up a tree where there is some
aggregate object bounding volume X which
is just a circle around them that
encompasses them you say oh that's like
the next level up on the tree and the
same with C and D then there's this
thing why what this allows issue is very
quickly called because if you go down
some part of the trees say oh this thing
is too small for you see or this thing
is smaller than the other things and you
know not to traverse any further sorry
really good on the tree until you find
things that are the right size so the
one augmentation you have to do is
basically those the AAC little things in
yellow on the left if you have your
bounding volume but you also want to
tell the query what's the largest object
leaf that's actually in that bounding
volume so for example it could be that
as an example let's look at this query q
that's carrying the bounding volume for
Z and it's going to ask z hey like I see
you're this big diamond volume I know
it's your work your position is etc
what's the biggest objects inside you
and it's a and say okay let's I'm just
going to make a conservative assumption
that a is closest to me it's at the
point on that bombing volume right as
closest to me would that be big enough
for me to care about and if the answer
is no then you don't need to traverse
see if it is big enough and then you
might need to go ask about X like oh
where is it actually because it might be
an actual position is not big enough for
you to care about and so this picture on
the bottom shows you the scene that had
10 million objects this procedure
generated city that we had
let's say you order return twenty
thousand objects out of that city if you
just return the 20,000 closest objects
you get a picture that looks like the
left of the distance metric if you
choose the 20,000 biggest objects we get
the picture that's on the right so it's
visually much much better gosh I'm in a
world I'm not in some weird disc lands
insanity what's funny though this I
absolutely love this picture because it
also emphasizes a technical problem
which I'll get into in a second so
what's the big visual feature that's
missing in the picture on the right for
the forest yeah like literally in with
the nation here is the trees each of
them is very very small but in aggregate
they form a large visual audits you're
literally losing the forest for the
trees so we hold the forest problem is
yeah so what 86 yep all right and it
looks like me yep except let's assume if
I turn sideways I don't look quite as
big yeah we compute the bounding volume
of a sphere on your largest actress
right so like if you have like a mine
what if the line is here just looking at
it counts as the size of the line array
so for simplification and so the way
this ends about ends up working is that
you have standing careers in the world
like this is this all angled I care
about this is my position in each viewer
basically an avatar I'm essentially this
entire aggregate enormous dvh for the
entire world right where each space
server responsible for the objects on it
but then there's a higher level sort of
aggregate server for across the servers
can answer questions like what if I want
to see a mountain that three servers
away what's another um and what a query
is it standing query because objects
come and go as you move on which is a
cut through this tree and so then
processing this query and updating it
essentially a process of maintaining and
updating was cut from the tree
that make sense no okay great so um I
need to see the entire world theory like
I can see the entire world to see the
entire world it's the entire world
described as this bounding volume
hierarchy right at the top there's like
one here that is the world right and
then as you go down smaller and smaller
pieces I can see the entire world then I
have a cut through this tree right so we
think of it as that in some sort of
getting at is that these like x y&amp;amp;z she
would actually say each of those things
is like a safe for us like so let's say
X was the higher level node for a
thousand trees you actually make that
like a forest object then it might be i
cants the individual trees cuz they're
individually too small but I see the
forest object and so this means that my
view of the worlds are cut to this tonya
hierarchy and its underlying geometric
objects if anyone's worked in graphics
realize i just did a bench bunch of hand
waving because you don't have these
aggregates objects and so what does that
mean it's all get to that okay so it's a
cut so conceptual a ship is cut through
the state of the world and that's what
it means that to see objects and so I
wonder this there's also details about
like how you do a gregarious because it
can be that that adjacent server there
well there are 50 people here who are
looking at stuff over there rather than
sent 50 queries me as the server will
aggregate all of their careers to
certain with general one and just get
only those results and then filter
that's the individual courage for the
objects you have aggregation between
servers there's all kinds of ways or
your retain your hash table the cuts are
maintained the Cubs today they are a
little short on top so what about too
much ok so again getting back to that
distance query versus a solid angle the
top here's a little village that we
built the top left is if you have a
distance Korea the top right is the
ideal seen the original scene is like if
you are not limited if you use cuts that
you just do a cut through one of the
biggest things that I can see it i only
can show you leads you'll
see the bottom what's actually really
important is that if you have your cut
which you can see goes through a
non-leaf node you know an internal node
in the tree you'd like to actually be
able to represent those things if you
don't want to lose the forest just cook
the individual trees are small but you
need to be able to do is to somehow take
like collective trees that are on that
hill and make them rather than being 50
objects they can be one object with one
lop that makes sense this turns out to
be hard so I'm going to talk now about
the content distribution network that we
vote for this until the point here is
you have these aggregate BBH elements
like that X which is the aggregate of a
be y which is the aggregate of CMD + Z
which is the aggregate of x and y right
the ideas that you want to do is they
take those two trees of those four trees
those four thousand trees put them into
a single geometric single graphical
model and then also simplify it because
we just have a seg number of triangles
right it's not going to work but you're
just kind of katidis and files together
that doesn't help need to actually do
geometric simplification which on one
hand is extremely well studied very very
deep topic in graphics on the other hand
doesn't work in the circumstance and so
one of the outcomes the project was
something called IAS instance aware of
simplification so way to simplify
graphical models that is aware the fact
that they're capable and I'll explain
what that means in a second just to give
you an idea here is a city that we build
this is half a million objects it
consists consisting about 150 million
triangles raw data this is twenty four
gigabytes just to see this actually
multiple cities let's go through space
but I talk about instances if you
actually look at how these graphical
models work or how they're built what
they are is there a tree of objects and
often when you feel that though then
what you do is rather than say look at
this you look at this house and we see
if there are four windows rather
describe each window individually what
you do is you have one window
some sub model and then it's reference
multiple times within the larger model
with different transformations you know
rotations and placements so you actually
have you know one sub mesh for the
window and just place the different
geometric offsets right let's see i
won't house model i know it also about
the door are probably in the chimney and
then one window that's instance there
multiple instances so the problem with
instant message that you want to do
simplification is that usually the first
thing that you do when you need to run
any instance any simplification
algorithms you need to convert it
actually two triangles to actually get
the geometric model that you're talking
about you and then start doing it
collapsing vertices etc so effectively
you'd expand these four sub base for
windows from being just sub measures
into four separate windows because you
might simplify them differently if you
want if you need to and so essentially
when you do this transformation the
actual number of triangles in the model
doesn't change in both cases you have
1100 triangles but the storage space its
actual layout on the disk consider it
does change right but effective i'm the
graphics are going to render it it's no
different perspective of ina CDN i ate
two delivered over network it's now
bigger and so we built a simplification
pipeline that takes this in the fact
that these are virtual worlds into
consideration so first of all the
question of how you construct this BBH
well what you want to do is you kind of
want to cluster objects that are not
only closed but also preferentially look
a little bit similar so for example you
might cluster these two houses that look
very similar rather than the house in
the tree or is it some point you'll need
to call from the trees too but you try
and actually keep sort of some visual
similarity as a metric when you
construct your vh then if two models
look very very similar there's a mech
there's a mechanism to deduplicate them
so often you know so we built the force
the only have three or four trees and
they actually there's sprinkle down
hundreds of each great let's actually
just be duplicate that we only have
three or four models and now in the
aggregate rather than 100
separate trees we have four sub meshes
with 25 instances reach next step is you
actually simplify the individual models
being aware of the fact they're instant
smell show some visual examples of that
the last thing you do is some stuff for
text area saying basically rather than
have millions of tiny textures you make
one big texture and do some add listing
on its of the indexing just simplify the
process you can shrink that to uh and so
here's just one simple model to show you
what happens when you do this so in the
center if the original train is a model
on disk was 400 546 kilobytes if you
standard standard soup location on
growth and looks a quadric
simplification Houston area of triangles
by eighty percent the model actually
grows by a factor of approximately
thirty guess what happens is announcer
this is that when you the quadric
simplification shows that all those
leaves are instances one leaf model in
context application starts simplifying
each of the little leaves you end up
with hundreds of different leaves in the
model grills the contrast of use
instance for simplification it strictly
gets smaller according with a number of
triangles and basically it doesn't
extend out that reason into hundreds of
several models in person you look at it
this way it doesn't actually look that
different I'm part of the trick with
graphics often is that you know you know
it's hard to tell us let me zoom in and
show you so this is what the tree looks
like with quadric simplification this is
my where it gets bigger if you look at
all those we have these weird bumps on
them and I'll just serve there quick
flip back and forth so you can see so
this is the original model it is what
happens in your own quadric
simplification or you can see visually
significantly different all these trees
have these weird aren't all the leaves
and these weird artifacts on so it got
bigger and a lot worse in contrast this
is what happens when you use instance
aware simplification actually it's aware
that that least you know as infants many
many many times and so on one hand
simplifying it it's only going to
simplify that one sub mash but it'll
have tremendous visual impact on the
overall on tree so it doesn't simplify
the leaves instead it ends up simply
simplifying the trunk a lot so you can
see like the differences that do exist a
lot of them are on these branches
scoffs at the heart of the tree it's a
using into our simplification we took
this scene which was you know 24
petabytes of raw data 350 million
triangles basically using that you could
reduce it to about 1.4 gigabytes of data
which is enough for you I'll client to
keep in memory and you could run with it
30 frames per second this enormous
virtual world we see these distant
cities cetera and then as you get closer
and they start becoming you know
partitioning 20 that whole city is a
single object to then oh it's this to
downtown the uptown and they said these
goes it all starts breaking apart until
eventually these close up buildings are
individual objects yeah yeah so we built
on source existing graphical techniques
for this I think of these Zaraki
descriptors which are essentially if
you're looking at things like the color
palette and some of geometric properties
of the object which is just an
approximation I mean essentially what is
an object visually similar to another
something which the graphics community
is studying it a big deal and we just
took some existing approaches off the
table but there is one any one critical
review is like and there's like a
parameter here's the thing we said like
how much do you weight eye color versus
shape right like it's not explained it
works very well write a nice it works
pretty well yeah so short answer is
there anything scriptures yeah yes yes
this is done offline and so yeah so one
thing you're here is like hold on wait
like we've got like dragons flying
around how do we aggregate stuff how you
agreeing to find out you go right on so
we did some studies of the movement of
objects in the behavior of things in
second life I could pulp the popular you
know ninety-six percent of objects
cannot move or row space of a month the
world is static like you know things
here don't move that much that often and
essentially so it turns that you end up
having two parallel data structures
there's
eh 40 static objects and we've basically
a bag of moving objects that if you
don't try to construct aggregates for
because it's not worth your time to try
to do so and you have a heuristic for
when you transition things from the not
move from the moving to the knob work
because it's so around the dragon flew
in that landed and set their turn to
stone the one thing that's tricky is if
you have something which has not been
moving and then suddenly it moves like I
have my end Ryan River like it's sitting
there it's sitting there sitting there
for three centuries and then suddenly it
moves like uh-oh aggregates wrong need
so there is there's absolutely like some
points purchased yeah system does not
behave as you expect you see latency and
like why is there tree there shouldn't
be moving we didn't get that parks
within heavens well so the question is
whether or not you can like you could
certainly pencil me into like hey this
building's discoidal right and then like
I don't want to aggregate it or
something like that but yeah in a sense
is there if the world is entirely
dynamic than a lot of these techniques
go out the window so it's like somebody
talking like a superhero things like I
can smash the building right what do you
do yeah you can't you can't handle that
well so the way i think that is that so
like let's say so you know ah the dragon
crashes into the Empire State Building
right in New York or sometimes I'll
carry my transamerica pyramid well
that's part of an aggregate like until
me some really big aggregates orbiting
all of San Francisco and so suddenly
there's the thin CD and this geometric
model which probably took you several
minutes to compute right which is now
invalidated and that needs to be said to
everybody so they could see it and you
could just sort of step one level down
sits but like there's just like a large
uh you know very large scale potentially
rapid change the graphical content it
turns out the thing that really kills
your all this like the space servers and
stuff they are not the problem the
problem is just downloading the
graphical content stuff like World of
Warcraft can get away with this because
of your cell pre-loaded on your machine
things like second leg through is
actually forcing your very very simple
objects like your Sims and crimson
subway but actually the tricky thing is
like Wade that building broke how do I
get everybody to see that quickly it
could be for example if if that was part
of its original model this notion of
like oh here's what happens and it
fractures or something like that then it
might not be that big a deal but even
like graphics research on how things
fracturing so it's all dynamic and their
generate thousands of tiny objects so I
can look great yeah
five right so thank you know San
Francisco like I'm going to like 150
miles away at the world lip that's okay
I get close enough so the things now the
subjects or big enough in terms of my
solid angle worried that those are not
visually distinct okay I'm going to go
one step down and then show you four
objects right I'll show you a top 6 or
16 options living is like I have this
cut through the whole tree which is show
me the thousand or some however whatever
your your criteria is for your client
like let's say five thousand biggest
things I can see right and at some point
that I urgent it gets bigger and bigger
and bigger until its sub elements are
bigger than some of the other things in
your trade that phone with your area
you're going to pop down lower level and
then some other things going to pop up
right so like as I get closer to the
forest then maybe like the cars behind
me and electric down the road become an
aggregate but the trees start dis
externship for the last thing was this
message forwarding we had a bunch of
constraints as whole issue of like wait
you know we can arbitrary message across
the world but totally crazy you could
have there's huge broadcast storms Waste
Systems did it before is you can
basically broadcast around you is
totally unscalable you had no way to do
long distance communication let's go
through some side service like your SEO
IQ we have p.m. service and World of
Warcraft and so actually a built a model
of communication that used weighted fair
queuing between all the objects ah and
this wait for the your queue entry
between the parallel objects is this new
model dome light the way to think of
this is that the amount of data none of
bits are bits per second that an object
Monroe can send imagine that it's you
know some object emitting light late to
its evolving like volume in the world
real estate is what lets you send data
absolutely then the amount which you can
receive correspondence types are too you
know Godzilla and Mothra can send a lot
of data to each other even if they're
not that close
but at the same time you know two mites
that are right next to each other can
also send a lot of dating to each other
and so send to a comedians need this
function which decays a distance such
that if you compute the integral over
the entire world it will convert to
finite value and this is basically a
function very close to that bound and so
you did all those measurements like
object cars etc based on sort of by
their weight and so here is there's the
fall of function you can see there's
that dashed line as to what the ideal
capacity between a pair of objects would
be based on this fall off function and
then we measured it you can see it's
pretty close and if you look compute
based on that weight boards they
actually do the GFI of the objects and
you know fer basically until you get to
the end of the curve um it's at about
point nine eight so it's quite good it
drops down at the end of the curve
because what happens is the fair queuing
system is or any circuitous to
essentially always allows you to send
your first packet make sure we have zero
we've had your utilizations you always
get to send a first packet but you know
if you're only allowed to send one
packet a day under saturation because
you're a mouse and they're a mouse from
your other side other side of the world
if you measure fairness over less than a
day it will appear like you're getting
more than fiction that's why there's
that dip down because of this discord
ization I'm infared so some point you're
saying packets not fit analytically
right fairness is just stays a lot yeah
yeah so let me touch them it so
fundamentally from a messaging
standpoint you know the system would say
you can't do that like you can't just be
emitting like in some ways you don't
have frequency division never hear like
oh you're sending on it or mega its own
carrot um so actually this is actin
lurkers like how do you communicate at a
high rate across the world this is
always this is great like my mouse could
talk more notes right there what do you
do if you want to send something to
somebody it's very far across the pool
so I'm going to talk very briefly about
back selling out two minutes essentially
the way you
that is everybody's television is
actually an instance of the TV stations
object and surprised by that I mean that
like rather than here's the simple
example we were a scripting language to
do this stuff so one approach is like
I'm writing a chess game in every piece
is a different object and has its own
logic and has to interact with a board
object etc instead we took the position
that aha a single software objects and
kind of many presences physical
manifestations or virtual manifestations
in the world and then it gives basically
centralized control to manipulate all
these different things so if you want to
send messages to a friend halfway across
the world what you do is you give them
you know some virtual object and you
have another project and they're
attached to the same piece of code and
now they can just internally by going
through your object OS communicate but
it'll need to send messages across the
world right there the same namespace is
the same objects same way like you want
to turn on the TV well there's a TV
station right that like it's responsible
to print stuff on your TV and it's not
going to send messages across the world
to do that because I do it internally in
code so it can be object toast to object
toast communication Santa too yeah so
this is like the focus is totally cool
the stupidest idea multi presents
objects how do you script that like how
you described it there are a couple
little tricks for an object or model um
yes this is this blankie project within
a couple years ago there's lots of fun
summarize some high-level conclusions
basically what kind of came out of this
is that leave for full of systems um you
know and also got systems are based on
3d geometry which is really different
than what we think of Norway distribute
systems like key value stores or
relations there's kinds of locality
those kinds of principles that you can
apply things like integration over this
one's an integral over the world all
those sorts of things in order to if you
leverage physical properties you can
actually get without a great deal of
complexity systems that can generically
scale put another way the physical world
scales and therefore you by making the
virtual behave more like it you can get
it to scale as well but to do that you
really had to build some low-level
systems things like you know looking up
positions in the world or rowdy
objects or fair queuing based on
luminosity in order to actually get the
system just go I wrote some papers yeah
I can take any questions thanks that's a
good question I mean it at some point I
think you do want to actually reduce
like a more geometric approach but
things for example what the aggregates
would be like and your content
description error could be very very
different right because again your
object representations are very very
different yeah I usually think of voxels
literally is like the graphical
representation somewhat you're going to
talk about that with the geometry of
that is because if you don't have that
then you're just kind of in trouble
right like if I can't tell you how big
something is rags I just think of it as
a collection of things in oldham compute
the bounding volume around the Met
cetera it gets really tricky yeah I
would have to think more about dying
that's a good question i think the first
thing they were just completely changed
the CDN right I'd like to think that the
messaging look up and stuff would still
be most to be the same but it could be
that if you have not since they might be
some other twist that you do which is
much much better education across the
rivers I mean to aggregate objects
across a large amount of maybe Larson
has bad service very yeah so that that
happens absolutely anyway to think of
that is that at some point the bounding
volume across those two servers the
center with some one of them right but
you sort of walk back also yeah there's
oh I thought anyway so I'm sorry uh-uh
yeah yeah so there's this for like that
super high level objects like oh the
mountain range there's a centralized
system that we're not sent for like
there's a system sitting aside next to
the space servers for like large world
features like the Rockies right
so talk about Adam cuts through your
trees displayed some pics right yep that
tells you how high level you'll
reconsider have it i'll add a parent
both I know it's not weird it means an
object exists twice so like we beamed it
for example that I have ah the house and
then i have the mountain with the house
right or it means that i have you know
the Empire State Building and then the
entire building when I have like just
the window to write so in some ways
there isn't like then implies you have
two instances of the same graphical
objects in the world right so if you're
what the show for us let's say you
haven't I my fiance is the biggest
reinforce blue and then although the
trees are also in this apparent right
you need clicking on the CA where it
would be part of an aggregate a would
need be then the other one the new ones
get spread out to right so now you're
going with the branching factor at the
bdh like is it that to have to make this
individual tree and individual object I
have to like also give you like five
little firms or not to give you 5000 or
firms and usually I think they're
branching factor was setting six or
eight and so you know you get a couple
extra objects that you want to show that
tree
cool great thanks so much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>