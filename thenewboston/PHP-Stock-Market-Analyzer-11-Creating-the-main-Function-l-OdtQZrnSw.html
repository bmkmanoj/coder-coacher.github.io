<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Stock Market Analyzer - 11 - Creating the main Function | Coder Coacher - Coaching Coders</title><meta content="PHP Stock Market Analyzer - 11 - Creating the main Function - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/thenewboston/">thenewboston</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Stock Market Analyzer - 11 - Creating the main Function</b></h2><h5 class="post__date">2012-01-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/l-OdtQZrnSw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright guys welcome to your left and
tutorial and now that we created all of
the kind of the hard work that dirty
functions all we need to do now is
pretty much just call them all so let me
just go ahead and create a function and
I'm just gonna call this main and it's
not even gonna take any parameters the
main job of this is pretty much to call
every other function that we created so
again like I said what this is gonna do
is it's gonna open up a file and it's
gonna loop through every line of the
file and every line is basically a
company now for each of these companies
it's going to download the data and
store into a database so let me go ahead
and the very first thing we need to do
is we need to open up this main ticker
master text so in order to do that
remember just go ahead and create a
variable I'm just gonna name on main
ticker
file and set this equal to F open
because that is the function that opens
files allows you to work with files now
the name of the file is freaking phlegm
in my throat ticker master dot txt it's
a text file it's going to be stored in
the same directory as this stock
downloader dot PHP now the permissions
is read we only want to read the stuff
from the file nothing else so now what
we need to do is just like we did in
this file to database we're gonna read
each of these lines one by one because
each line is a different company each
company deserves its own little work so
remember how to do this we put while and
a file in this is f gof and as a
parameter you just write what is the
file that you're working with the file
object main ticker file so this is
basically going to search this is
basically going to loop through until
you get to the end of this main ticker
file right here and what do we want to
do well just like before we want to get
each one of these the line by line by
line and we want to save it as a string
so we just want to put
company ticker and rumor this is gonna
be either Yahoo or Google or something
like that and how do we get a string of
text does anyone remember F gets now
four F gets just go ahead and put main
to your file and why do we need to put
this right here because this is going to
move the pointer in this file object so
that's why we need to do that so now the
company ticker is going to be equal to
Yahoo the first time it loops through
Google the second time the Netflix and
it's going to keep looping through and
eventually end with Adobe however I just
want to add one little check before I
continue sometimes whenever you're
inserting you accidentally hit space at
the end or you know maybe even at the
beginning whenever you get a line I just
want to make sure that it trims any
whitespace away so let me just go ahead
and do that real quick and you do that
trim just takes the string as a
parameter and this is you know you
shouldn't need to call this but just in
case someone makes a mistake whenever
they're inserting companies and let's
check the half so now what I need to do
is remember in order to download the
data you first need to create that URL
and we did that using the create URL
function so let's go ahead and copy this
in the next line for each company what
we want to do is we want to create the
URL from where our script is going to
download the data from and let's just go
ahead and save this in a variable called
file URL and set this equal to
great URL for the company ticker so let
me just go ahead and copy this real
quick so what this is gonna do is at
first it's gonna create a URL and
remember this was the URL that we can
download data from it's gonna create one
for Yahoo and then it's gonna create one
for Google and Netflix and so on and so
forth so all we did in this line is
we're just getting a string a URL so now
this file URL is equal to some file some
URL just a string of text
so now what we want to do is we want to
download and save the file from this URL
right here so the first thing we need is
a location to where we can save it as
now I didn't show you guys this but this
is a real easy thing you don't need to
see me do this what I did is already
created a folder on my server called txt
files now I'm gonna go ahead and put
company company yeah I think so company
txt file
and I'm gonna set this equal to the
directory in what this is is I'm
basically gonna set this equal to a file
name now each of these file names have
to be unique because whenever I save
this data is a txt file it needs to save
it somewhere so that's what I'm creating
right now so where do I want to save
each of these companies text files well
like I said I already created a folder
on my server called txt files you'll see
later on whenever I upload them and
remember whenever you're working with
files you need to hit slash and here's
another thing I'm gonna name each of
these files
Yahoo dot txt goog text and Flex dot txt
and there's a space right at the end of
there and flex text so in order to do
that whenever you're writing the file
name you just don't write it like this
because that's gonna name everything
Yahoo just go ahead and append a
variable which is the company's ticker
and you'll see what's going on in just
about five seconds and then what you
want to do right after this is just
append the ending text now what this is
going to do is basically gonna loop
through each of these lines of text and
it's gonna save each of those files as
that name
Yahoo text Google text and that's where
we're going to be doing so right here we
created the URL of where we can download
the data from and right here we're
saying okay this is what we want to save
the file as we want to save it is
whatever name it was dot txt and we want
to save it in a file called txt files
he's
so now what we need to do is we actually
need to download and save those files
because like I said we just created a
bunch of strings right here we didn't do
anything now remember in order to
download and save the files we created
kind of stutter there we created a
function called get CSV files and what
it does is basically you pass it in a
URL and it downloads you know pretty
much whatever is at that URL so just go
ahead and hit get CSV file and instead
of these parameters the first one is the
URL where is the location of the file
that you want to download well it's at
that file URL and now this output file
is basically asking ok now that we have
this where do you want to save it
basically what do you want to name your
file what do you want to save your file
as we want to save it as whatever this
thing was right here Yahoo text Google
that text so on and so forth so now what
we did pretty much is we have this file
and it is saved on our server is a text
file as a text file we can't work with a
text file so now what we need to do is
we need to convert that text file to a
database Oh what do we have right here a
nice function that converts text files
to databases how freakin convenient who
would have known to build that so now
let's just go ahead and do that and the
first parameter is what is the text file
that you're going to be using well the
text file is company text file right
like that
and remember this is populated with um
information now it's populated with data
now thanks to get CSV file and the
second parameter is the name of the
table basically what is the name of the
table that you're gonna insert what's
the name of the table that you want to
insert this data into and remember I
just named it the exact same thing is my
company ticker so that's the cool things
I have a file like I'm gonna have a file
named YH ooo text
in my table name is named YH oh oh and I
have a file name goog text in my table
his name goog they all reference the
ticker so it's really easy whenever
you're inserting stuff into your
database or looking through it on your
server or anything like that so now
check it out you may think we're done
but we're not we have I'm just kidding
we only have one line of code to go we
have four functions right here create
URL get CSV file file a database and
main so now all we need to do is call
main so just go ahead and write main and
check it out so it's basically gonna say
include this these are my functions and
now I'm calling main and whenever it
calls main it's gonna kick off and call
all these other functions so now what I
want to do is upload this to my server
test it out and I'm sure I have plenty
bugs and you guys are gonna stick with
me until I you know do plug this thing
so sorry you got to watch that but hey
it's part of the program and so thank
you guys for watching don't forget to
subscribe and I'll see you guys in the
next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>