<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>AJAX Chat Tutorial - 8 - Getting New Messages | Coder Coacher - Coaching Coders</title><meta content="AJAX Chat Tutorial - 8 - Getting New Messages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/thenewboston/">thenewboston</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>AJAX Chat Tutorial - 8 - Getting New Messages</b></h2><h5 class="post__date">2013-05-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tAKc-TyyKg0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">what up mother effers y'all better
listen up because in this video I'm
gonna show you guys how to get new
messages from the server so let me just
go ahead and make a little prompt so
this function is gonna get new messages
and let me capitalize that get new
messages so it's going to be a public
function and let's go ahead and name
this something creative get new messages
and the first piece of information that
we have to pass in is the ID number so
by default we're gonna set this to 0 now
what the heck is the ID number well
whenever we store messages in your table
each message has an ID number now every
user that joins your chat room is gonna
pretty much tell where what messages do
you want to read that's what they're
basically going to say so whenever
you're chatting with a friend you don't
want to retrieve all the messages each
time so if you guys have sent 100
messages to each other you don't want to
run a query that retrieves all hundred
messages
you only want to read or you basically
only want to check your server for any
new messages
however if someone comes into the chat
room for the first time they are gonna
want to read those previous messages or
like the last 50 or something so those
are the two different types of user the
users who are going to run a query and
check for new messages the ones who have
been chatting for a while
or the ones who have just come into your
chat room and for them we're gonna show
them you know like the last 50 messages
or something and this is where you can
kind of customize your chatroom to you
know however you want to develop it but
I'm gonna show you guys a very cool way
to do this so basically by default ID
equals 0 which basically means to start
from the very beginning you know go way
back and get all of the messages now we
can go ahead and override this and set
this equal to this
my SQL I real good copy this don't feel
like typing in laziness that is okay
just my something else though real
escape string ID so basically what we're
gonna do is whenever we want to read new
messages we're gonna set the default at
zero so by default you're gonna query
the database and read all messages ever
in history for that chatroom however you
can go ahead and override this so this
ID number is going to come from the user
or the clients computer now if they have
been in the chatroom and they've been
chatting for a while then they're gonna
have a number other than zero so for
example if me and you were chatting and
we sent each other a hundred messages
then my ID number is going to be 100 so
that way I can tell the database only
get the new messages that come that are
greater than 100 in that way it helps
out us our server a little bit because
that way he doesn't have to return all
the messages it only returns the new
ones so the first thing we have to check
is alright is the user's ID number
greater than 0 let me go ahead and give
myself a little bit more space so
basically if the user only wants the
messages that are greater than 0 then
let's go ahead and give them the new
messages only so of course for this we
need to build a query and I guess I can
do it like I'll do it like this so the
query for this is just select and what
we need is basically saying okay give
the give us information or give us the
messages so the first thing is message
ID which is in fact the ID number and
the other thing we need is the user name
message itself the color and date format
which is posted on and now as a second
parameter we actually have to build the
format itself so I'm just gonna put the
hours I'm just gonna print the time the
minutes which is percent I and the
second which is percent s and if you
guys don't know what I'm doing right now
this is like my SQL language so alright
so what we want to do whenever we read a
new message or whenever we want to
display a message to the user what we
need is the message ID the username the
message itself the color and what time
the message was posted and my frickin
dog is barking right now so sorry if you
hear that now we return this but we
actually have to say return this as we
have to name it something
so as posted on from of course chat
where the message ID is greater than
the ID number
so what we did right now is we basically
said for example me and you are chatting
and we have a hundred messages that we
send back and forth to each other so I'm
gonna say okay give me the messages that
are greater than 100 because I'm already
looking at 0 300 so I don't care if
they're I don't care about those ones
I'm seeing them already only return any
new messages that you may type 100 and
above now whenever you return them order
make sure that this is in my proper all
right order by message ID ascending
because you want them to go low to high
so send me 101 102 103 so what this is
gonna do is it's gonna be constantly
updating showing you any new messages
now this query is perfect if we've been
chatting for a while but what if someone
new comes into the chat room and they
don't have an ID yet they don't they
weren't chatting with you previously
well by default we're just gonna display
to them the 50 the last 50 messages that
were on the server so they can kind of
see what we've been chatting about so
this is how you do that go ahead and run
another query and I guess I can go ahead
and build it like the last one now this
query is gonna be a little bit different
so select and let's see I guess I can
copy this message ID username message
color select message ID username message
color and also post it on</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>