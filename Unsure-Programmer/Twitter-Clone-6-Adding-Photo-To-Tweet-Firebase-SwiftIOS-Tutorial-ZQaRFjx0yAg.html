<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Twitter Clone 6 - Adding Photo To Tweet - Firebase + Swift(IOS) Tutorial | Coder Coacher - Coaching Coders</title><meta content="Twitter Clone 6 - Adding Photo To Tweet - Firebase + Swift(IOS) Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Unsure-Programmer/">Unsure Programmer</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Twitter Clone 6 - Adding Photo To Tweet - Firebase + Swift(IOS) Tutorial</b></h2><h5 class="post__date">2016-09-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZQaRFjx0yAg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so by the end of this tutorial what
we'll have is we'll have this sweet
controller that we had set up the user
will be able to select an image once the
image is put in the user will be able to
tweet the image and that image should
get saved in our database as a URL and
into our storage as the actual image in
the next video we'll go ahead and
display that image in our tweets as of
now if we tweet we can see that we get
the tweet on top without the image so
let's begin the starter project for this
particular video can be found on github
the link is given in the description
once you download the project you need
to create a project in your firebase
console as well on fire-based or
google.com and call it Twitter clone
download the Google service in port or
pls file created by firebase and drag it
in to your project in Xcode once we have
the file downloaded we open it in Xcode
you've added the Google service info dot
fielitz file here and we're good to go
starting with a new tweet viewcontroller
we need to do two things we need to
allow the user to be able to click this
camera icon here select a photograph and
display the photograph in the tweet and
when the user presses the tweet button
you need to make sure that in the dip
tab tweet function the image is sent
along with the tweet to a firebase
database and also the image is stored in
our firebase storage so let's start by
first importing five a storage next to
allow the user to be able to pick images
we need to implement the controller
delegates of the UI MHP ticker c UI
image picker controller delegate and
also the UI navigation controller
delegate will create a variable here
called image picker and we off type the
UI image picker controller
now let's come down here control drag
from the camera icon and create an
action and let's call it select image
from photos it will have to be an action
and we connect it so let's just make
this a little bigger here so what we
check here is if UI image picker
controller dot is source type available
the source type you're looking for is
saved photos album then what we do is we
say self dot image picker dot delegate
you cool yourself to set the delegate
and we say self dot image picker dot
source type is equal to saved photos
album and self dot image picker dot
allows editing equal to true and now we
need to just present it so we say
present view controller self dot image
picker animated equal to true and
completion equal to nil let's open up
this bottom thing so that you guys can
see the code clearly and it's not
getting hidden in the corner now we need
to set up the image picker controller
function called did finish picking image
so let's do that function did finish
picking image you want this one so here
what we're going to use is something
known as an NS mutable attributed string
basically an attribute is string allows
you to change the attributes of the
string add media to the string and a lot
of other things for this video we're
going to be adding an image using the
attributed string so let's see how we
can do that we create a variable called
attributed string it's going to be of
type NS mutable
attributed string next what we'll do is
we gotta check if the user has entered
any texts before trying to select an
image so we say if self dot new tweet
text view dot text dot characters dot
count greater than 0 that is the users
entered some text and is then selecting
an image we will say attributed string
is equal to NS mutable attributed string
and the string is going to be self dot
new tweet view dot text else what we say
is attributed string is equal to NS
mutable attributed string and we'll
again put in the default value of what's
happening like we had earlier also
new line here so that there's some
spacing between the text in the image
next what we'll do here is we'll create
a variable called text attachment it'll
be of type NS text attachment basically
this is what will allow us to attach the
image to the text and then put it in the
attributed string so let's say let text
attachment dot image equal to image and
we get the width of the original image
so it's a let old width of type CD float
equal to text attachment dot image dot
size dot width and before we put the
image into the text view what we have to
do is we have to ensure that it's scaled
down to a size which fits in nicely
below the text view so let's say I will
do that we'll say let's scale factor of
type CD float equal to old width of the
image divided by the new tweet text view
dot frame dot size dot width and
subtract the padding from that to get a
nice scale factor next we'll just set
the image of the text attachment so
we'll say text attachment dot image is
equal to a UI image inside that will
select cg image so we will say text
attachment dot image force unwrap that
of type CD image force unwrap that as
well set the scale to the scale factor
and set the orientation as up now let's
create a variable called let attributed
string with image and we'll say NS
attributed string and in that we'll put
in the attachment which we just created
which is text attachment so now we have
an attributed string with a text
attachment which inside that has an
image now all we need to do is we need
to append this attributed string with
image to add tribute a string that we
created here so let's say attributed
string dot
a band attributed string and inside that
let's put in our attributed string with
image and let's replace the new tweet
text view with the attributed text which
is equal to the absolute eight string
also lets us dismiss the view controller
that allows the user to select the image
and say true to animation and callback
will be nil
let's try this out quickly so let's go
to the new tweet view there let's select
the camera brings us to our photos let's
select a photo as you can see the image
is getting nicely placed in the center
right now we cannot press the tweet
button to tweet the image we need to
change that code up so let's finish that
up now so let's come to our did tap
tweet action we never change this code
up over here to accept images as well so
let's start by creating an array called
images array of type any object that
means what we'll have to do is we'll
have to go over the attributed text and
extract the image from that so let's see
I will do that with a self-taught new
tweet text view dot attributed text dot
enumerate attribute and the attribute
name will say NS attachment attribute
name in the range will basically say NS
make range and the starting would be 0
and the length will be the length of the
tweet so new tweet text view dot text or
characters dot count and the options
will give no options and in the block
will have the value the range and will
say true to the boolean to stop that is
once the image is found don't do any
further processing on it now we check if
the value returned is of type NS text
attachment
if it is then we say let attachment
equal to value as NS text attachment
force down cast it and create a variable
called image of type UI image and
initially set it to nil now what we're
interested in is to check if the
attachment is of type image the
attachment is not equal to equal to nail
set the image variable equal to
attachment dot image and also add the
image to the images array we desire it
or append image else if you don't if it
is not an image just for up debugging
purpose we'll print a message saying no
image found now that once we is
determined if now once you've determined
if we've got an image or not there are
three cases that can be there the user
where either have entered only text or a
text and an image or only an image so
you have to check those three cases and
accordingly upload data to our database
let's let's create a variable called
tweet length to store the length of the
text so Inlet tweet length equal to new
tweet text to you dot text dot
characters dot count
and also let us create a variable called
let num images equal to images array dot
count to store the number of images now
in the code that we have previously we
can extract out this key line here and
place it outside so that we have the key
we can also create a storage ref where
we're going to store our image so let's
create that fi a storage not storage dot
reference and what we can do is we can
also create a reference for the exact
location where we will store the picture
so let's call that let
picture storage ref equal to storage ref
dot child will go under the user
profiles inside that will go under the
logged in user as always under that will
create a node called media and inside
that under this particular key will
store the image also what we do is we
don't know all the images to be uploaded
at their maximum size is going to take
very long eat up a lot of our data and
memory so let just for this
let's do low resolution image data equal
to UI image JPEG representation and what
we will do is will compress the image to
a smaller size by giving it a compress
quality of 0.5 this is your up to you if
you want to do this or not and we're
gonna have to force down cast this as a
UI image so now the first thing we'll do
is first case that we have is will check
if tweet length greater than zero and
and number of images greater than zero
that is if the tweet and an image was
put then let's first upload the image by
saying let upload task equal to picture
storage ref dot put data pass it the low
resolution image data force unwrap it
and we don't want to pass any metadata
so we'll call it nil
now return metadata and error in if
error is equal equal to nil that is the
emitters uploaded successfully let's get
the download URL of the image from
metadata dot download
well this has to be capital and this has
to be metadata and now like we had done
earlier we need to update this child
updates variable that just copy this in
here and we need to add in another line
right now this is only putting in the
text and the date let's just copy this
path till here till the key and put this
in here below this and instead of key
and instead of text we'll put it on the
picture and say download URL dot
absolute string and just for some Raptor
download URL and here this should be
self dot new tweet text view dot text
and let's run the update so they say
self dot database ref dot update child
views and again pass in child updates
next condition we'll check is if the
user only puts in text and no image so
we'll say L safe to eat length greater
than zero so in this we basically need
this code over here which we had earlier
without the update for the image you can
just put that in it's passing in the
tweet it's passing in the time and it's
also updating the values and dismissing
the controller the last condition we'll
check is else if num images which is if
the user only puts in an image and no
text in that let's copy this one from
here the first one and we'll just edit
it once that's there we just need to get
rid of this text line over here the rest
the core remains the same and we need to
just dismiss the controller so it's a
dismiss view controller animated through
completion new so we have a dismissive U
controller here as well which we had
forgotten so let's put one here as well
I made it equal true and completion
equal nil and we'll just put in an else
block here for the images just to check
that if there's an error we'll just say
print error dot localize the localized
description and let's get rid of this
code that we had earlier set up so we
check if there's an image and text we
upload the image and then upload the
tweet with the image URL second we check
if there there's only text we only
update the text and the time and the
third one if there's only image we only
put in the time and the URL and upload
the image so we're good to go let's try
this out so let's go to the new tweet
click here we get the camera icon let's
select it select an image click Choose
the image comes up with what's happening
as a default text let's click here and
let's tweet this and let's hope it works
and there we have it the tweet is
updated but as you can see we're only
getting the text the pictures not being
updated over here let's confirm that the
picture has been stored in our database
so here in our database you can see that
we've got the picture of URL updated
we've got the text and we've got the
timestamp let's go into our storage
go into the user profiles go into a user
ID and there we see a media folder has
come up and inside that with that
particular key we have the image
uploaded which is already compressed so
basically in this tutorial we learnt how
to add the image updated in our database
but right now it cannot show it so the
next tutorial we will see how it can
display the image over here and then
build on the app thank you once again
for watching please like and subscribe
and try this out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>