<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 3 - New Firebase Storage/Database + IOS(swift) + Store Profile Picture + FB Login | Coder Coacher - Coaching Coders</title><meta content="Part 3 - New Firebase Storage/Database + IOS(swift) + Store Profile Picture + FB Login - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Unsure-Programmer/">Unsure Programmer</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 3 - New Firebase Storage/Database + IOS(swift) + Store Profile Picture + FB Login</b></h2><h5 class="post__date">2016-06-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ItdtUN2VcrE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">can you aim from where we left off last
what we had was we caught the users
profile picture and we got the user's
name but the profile picture like we saw
was a low resolution profile picture
what we need is the high resolution
profile picture secondly the profile
picture directly being taken from
Facebook right now it is not stored in
our database what we'd like to do is
we'd like to have the profile picture
stored in our own firebase database so
that is not always referenced from
Facebook so what we're going to start
with is firebase storage so for that
lets go into the documentation of five
is under the storage section here we
have get started add firebase storage to
your app first thing we need to do is
add the pod for that and open item in
your project folder open the pod file
and here we just add this pod which is
pod file based storage and save it and
run pod install like we did earlier and
there we have firebase tore it installed
coming here will import firebase storage
here and we'll start with the tutorial
let's see so the first thing we need to
do is import firebase which is done this
is already done we need a reference to
our storage service so let's get that
let's just put it here for now the
reference to the storage service and now
let's go to create a reference here the
important thing is you need to create a
reference from a storage service so copy
this line in I'll show you how to do
that put that in here refer your
particular storage service
you see this line of code over here is
the bucket that it's referring to we
need to get to that four that will go
into firebase console and go into
storage and you get this line from here
this is the reference to our storage
service and we'll paste that in here so
there we have a reference to our storage
service okay so we leave our storage
part there for now and start with
getting a profile picture from Facebook
to do that we'll go and see the
documentation on how to make the graph
request wait here if you go into user
and you go to picture this is where it
says to make the request to get the
user's profile picture we need to
convert this into Swift so we've come
here paste this in yeah I had already
pasted it and we convert it to just get
the data and it didn't work okay there
we have it so this is the code we need
and we need to make slight modifications
of this we don't need the connection
type we don't need to declare result
type either or the error type okay
and it's gonna be let's call it profile
pic equal to
and we need to also remove user ID and
put in me instead of that because we're
getting it for the user that's logged in
update this to profile pic as well and
for the parameters we can put in height
we want is equal to sorry we need a
suite 300 width 300 and this is very
important we need to make sure that we
put redirect to false and did we miss
where we miss : there no punctuation so
redirect has to be false why is that I
am sure to you here it says here at the
bottom the default value redirect is
true by default the picture edge will
return a picture instead of a JSON
response if you want to the picture has
to return JSON that that describes the
image that redirect equal to zero or
false so when you make the request we
wanted to return the JSON that's how
we're going to set it to false now we
leave the request to get and in check if
the error is equal equal to nail we'll
print the result that we received will
see let's let's have a look at the JSON
that we're getting
there you can have a look at it at the
bottom here that that the result is
getting printed and it's showing us that
the width is 320 height is 320 and it's
printing the data here
so what we need to do is we need to
convert this JSON into dictionary so
that we can access it so if the error is
equal to nil because we can't directly
access JSON in Swift so for that we're
gonna do if error is equal to nail what
we need to do is let let's get it let's
dictionary equal to result dot result as
additional NS dictionary and is it okay
let data equal to dictionary object for
key and we we you already know that it's
called data here so we're gonna put it
as data and let URL pick equal to the
data okay we're gonna need data dot
object for key and we have to get the
URL and we're gonna force unwrap that
and also false convert it into a string
because we need to have it as a string
when we later converted so now we say if
let data equal to NS data and contents
of URL and s URL and we put in string of
type URL pick
okay so if you get image let's just make
this a meditated about confusion
basically if you get an image what we
want to do is okay we're gonna have to
force unwrap this you want to upload
this image to our storage so you say let
profile pic reference now this is the
exact reference where you want to store
this image in dot child and we'll use
the user dot you ID as the folder so
that each user has a separate folder
first profile pic and each user's
profile pic is called profile pic let me
just clarify that once - if we go here
and we go into firebase and we look at
storage we basically have a folder here
with the users user ID and inside that
folder we'll have an image fault profile
thick so that's what we've done here and
this is gonna be storage ref this is the
same storage back that we created here
but we're just creating a child of that
to store it here okay now we need the
next thing we need to do is we need to
upload the image so for that will do
what put data profile pic dot put data
and we're going to use data metadata nil
and here we need metadata comma error in
if our not equal to e sorry equal equal
to nil I'm going to say let the download
URL equal to metadata dot download URL
else print we've had an error error in
downloading image okay and I'm just
gonna clarify this to you how we managed
to get here and this is gonna be instead
of data this is gonna be image data
sorry
so if you have a look at the
documentation of five is here this is
where it shows us to upload a file you
created the child the reference and then
to upload it we're uploading from data
in memory because it's in our memory of
the application let upload task equal to
the reference which is storage reference
in our case dot put data and then we
have the same code here so if we come
back here that's what we have done in
flat image it a if if an image is
downloaded now for the folder that we
want to update int into and upload the
image now basically we need to display
the image that we're downloading this
download URL I just showed you because
the metadata has a lot of things that
you can see either you can get the size
a content type or the download URL is
available it's not necessary that you
need to use it I'm just showed it to you
so now if the image exists and is
uploaded successfully what we'll do is
we'll update the image
and we'll set it to image data and that
should show us the profile picture let's
try this out now
there you have it now we have a bigger
much more clear a high-resolution
photograph that's there now the
important thing to note is that every
time the user will log in this will try
and download the image and upload the
image again and again which is pointless
we want to be able to check if the image
already exists and only if it doesn't
exist
should we download this image from
Facebook now we can confirm if this
image has been uploaded by going here
and going into our console and checking
let's just refresh this and see if their
images have been uploaded or not and as
we have seen this is the UID of the user
you go inside you have the image of the
user which will come here which is
profile so now we need to see if the
user already has a profile picture
before we start to download and upload
that picture so for that we're going to
go into the documentation again
see how to download files and it says
download in memory so we don't want to
you can if you want to try and download
it the device of the user but we only
want it to be downloaded into memory
before we check it so let's see what we
need is we need this code over here
let's copy this and it says downloaded
memory with the maximum allowed size of
1 MB so let's come back here into Xcode
let's paste this here change Island ref
to store it ref no sorry it's gonna be
half it we'll have to change that to
this reference because we want to
download the exact file in fact we can
just bring this outside of the brackets
and put it here to get the exact
reference and this will be profile pic
reference dot earrin exercise this is so
if error is not equal to nil that means
something has some problem as a
the file doesn't exist or the the user
is not authorized so for now we'll just
say that unable to download image will
dig into the errors later and if error
is equal equal to nil that means that
the data for the image is returned so it
will just check it again if data not
equal equal to nil the action of data
not equal to nil served our UI image
profile fake image is equal to UI image
data and with both data set that in next
we just need to do what we need to do is
we just need to check that if self the
UI image view collection image view
profile pic dot image Nadi is equal
equal to nil only then should we try and
download the image
okay so this is done there's one more
thing that I realized I was going
through my cord is this line will be
uncommented in your cord we forgot to
remove this so we just have to remove
this from here in fact right now
otherwise this will not come nil and we
will not be able to download the image
again so now let's stop this and let's
run and it should work there we have the
image and that's the bigger image let's
go here and let's check it out here
square the storage image and we try and
do it again if it works properly so here
if you go inside we do have the image
here so let's go back to storage and
let's just get rid of this
there is now we come back here stop this
run this again
okay then it's got the image for us
again and the image should be visible
here again off once we okay there it is
it's back again and also we can just
confirm that it only downloads the image
if it is empty so you can just put like
a print here sorry we can just put a
print here who's already has an image no
need to download from Facebook let's run
this and check it out you as you can see
user already has an image known you to
download on Facebook and this is taking
it from the firebase database storage so
that's it for now in the future videos
we'll dive deeper into the features that
firebase has to offer and try and build
a complete application with firebase as
the backend thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>