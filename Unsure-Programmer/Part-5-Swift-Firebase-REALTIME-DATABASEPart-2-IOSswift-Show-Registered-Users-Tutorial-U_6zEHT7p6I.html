<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 5 - Swift + Firebase REALTIME DATABASE(Part 2)  IOS(swift) + Show Registered Users Tutorial | Coder Coacher - Coaching Coders</title><meta content="Part 5 - Swift + Firebase REALTIME DATABASE(Part 2)  IOS(swift) + Show Registered Users Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Unsure-Programmer/">Unsure Programmer</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 5 - Swift + Firebase REALTIME DATABASE(Part 2)  IOS(swift) + Show Registered Users Tutorial</b></h2><h5 class="post__date">2016-07-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/U_6zEHT7p6I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in part four of the video we had learned
how to create a profile for the user and
and the details of the user in the real
time database in part 5 of this video
series what we do is we create a user's
tab in which we will show all the users
that are available on our on our app so
to do that basically we will also be
introducing ourselves so the UI
collection view controller so let's
start
let's start by adding a collection view
controller so come in to the main
storyboard and selecting collection view
controller restrict its size to four
decimal 7 inches like always and connect
the connection controller tab bar
controller what we'd also do is we'll
embed the collection view controller
into a navigation bar controller
next we'll change the name of the tab by
coming here taking on the item in the
attributes inspector will name this
users and give the image of user so
there we have the image next we come to
the collection view controller go to the
attributes select the collection you
first set the cell size to 100 Hyden
with port to 100 come in to the section
in sets set all four of them to ten each
once that's done we have to add a new
collection view controller class so
let's do that let's go to my app file
new new file I will select iOS and
select cocoa touch class it's going to
be a subclass of the UI collection view
controller and the class we name it is
users collection view controller save
the file first thing we'll do is change
the name of the reuse identifier to
collection view cell this is just for
come for our own ease you can name it
whatever you want come to the main story
board select the collection view
controller and set its class to the
class that we just created which is
users collection view controller next
what we do is we'll add an image view
inside the collection itself
this is basically the profile picture of
the user and let's go here to the image
and let's set the height note to 80 each
and add the constraints which is a top
constrain and we'll limit the height
would to 80 and what we'll also do is
we'll Center it horizontally in the
Catena
that should take care of it what we'd
also do is going to add a UI label below
the image which will basically display
the name of the user coming out just
quickly set the size of the text to a
smaller size which is about 13 should be
fine and again what we'll do is we'll
add the two constraints required for
this which is basically really centered
into the container
and we'd also limit the height and width
one more thing that we'll need to do is
give it the vertical spacing from the
image next we'll create a class which
defines how this particular cell looks
let's call a file new new file this
one's a file cocoa touch class and it's
going to be that's called a collection
yourself I already named it here and
it's going to be a subclass of UI
collection of yourself click on next and
click clear so basically this collection
you sell is going to define how that
cell looks so let's go to the main
storyboard and first assign the new
class that we created to the collection
view cell so let's click on the
collection Rachelle let's set this to
collection view cell now let's open up
the assistant editor and select the
collection Roussel class that we created
here let's create an outlet for image
and call it use the image and an outlet
for the label and call it user name
let's also create a function which will
basically make the image round so let's
call it function make it round and so
it's going to called func and what's it
going to do is basically it's going to
just change the border in the corner it
is
that should do it but since this is
inside a collection what we'll have to
do it we'll have to override the layout
subviews for it to work and here is
where we call this which is self-taught
make it now and obviously before that we
have to call super door layout sub views
and override is paired with a double R
so there we have it and you'll also have
another line of code which is self dot
user image dot earlier dot masks two
bounds equal to true this ensures that
the corner radius that we've set is
maintained and everything around it is
masked now before we started the
collection view controller what we'll do
is we'll go to the view controller or
Swift and we'll add some code here what
this code will do is when the foot when
when the user logs in for the first time
we'll store the user's name and the
users through and the user's email on
their profile page and what we'll also
do is we'll also store also store the
small version of the profile picture the
reason we will do this is the smaller
version of profile picture can easily be
download link to and is there multiple
pictures that we left we want to show
multiple users so it'll be easier and
quicker to load the images when we when
we actually work it out you will
understand why we did this and we'll
store the profile picture in the
database and in the storage so let's get
started with this so we'd say after the
user is logged in say if error is equal
equal to Navy let storage equal to
I'm sure that you imported fi5 a storage
in five is database'
I've already done that that storage II
could do if I our storage not storage
let storage ref equal to and will refer
a particular URL here
and we'll also set the node where we
want to actually store the small profile
picture let's call it profile pic small
dodgy VD this for ease let's also store
the user ID into a variable and also get
a reference to our database
now what we'll do is we need to read
from the database and retrieve the data
so we go to the database ref dot child
under the node User Profile under that
we need to go into the node which is the
user ID and under that we'll go and
check for the profile pic small and what
we'll do here is observe single event of
type because we don't want it to be
continuously reading so we just use the
observe single event of type just to
read it once and dot value with block
snapshot in what we can do is we can
just get rid of this other editor and
why are we getting this error but it has
before fi our database fully then what
we'll do is we'll just store this
profile picture into a variable let's
call it let profile be equal to snapshot
dot value as a string the reason we're
using it as an optional is because if
the user login for the first time it's
going to return null because user will
have no data so we have to take it as an
optional value to ensure that we get an
ale when we test this out so now we can
what we can do is we can do if profile
pic equal equal to nil which we wouldn't
be able to do if we hadn't save it as an
optional now we need to basically get
the user small profile picture and
upload it to the database and the
storage so that is named this as profile
pic and if let image data equal to NS
data
contents of URL user dot photo URL which
is stored by five is automatically you
ought to do is start an upload task
profile pic ref dot code data this is
code directly from the firebase Doc's
metadata nil in that ahead we have
metadata and error in so if error equal
equal to nail that means if the upload
task is successful let's store the
download URL into a variable
and it'll force unwrap the photo you
arrived as well and also let's save this
into let's save the URL into our
database so under the User Profile node
under that we going to the child which
would be user dot UID
and that would go to profile pic small
and we set value download URL and
convert that to an absolute string
this is meta data you want to store it
as a string so we didn't show that we
converted to absolute string and it's a
else rent error in downloading image
just a small area now that the image is
uploaded will also upload like we said
they update the users data in the on the
profile change so that would basically
do database ref not child I will show
you one and then I'll just copy paste
the rest the code because it's going to
be repetitive there's going to be under
the user dot UID node under there we go
into name set value user dot display
name which firebase calls for us so I'm
just going to pause this and copy the
rest of the code
since you can see the first time the
user logs in he'll get a display name
and he got an email there as the values
will be empty it will just create the
fields for the user will also just add
an else block here which basically just
prints the message saying the user has
logged in earlier and before we go into
the collection new controller we just
make another change which is going to
the profile table view controller and
adding the name column so here we add
name so here we'll also after add it
basically it's gonna be the same server
we just copy this paste this on top and
just edit it it's gonna be named name
and one more chain that we'd have to do
over here is we'd have to also add when
the user updates it overnight also add
it here same thing this will be name and
name and inside of the place where
that's gonna be name the last thing we
need to do is we need to go to the users
collection on your controller and set
that up so coming into the users
collection new controller we need to
read the data from the database that is
the user all the users the name and the
profile picture and display it in the
clear format which uses available on our
application so let's see let's create a
variable called database trap and as
always I have this database talk
database dot reference for this we'll
have to import firebase database then
here we'll create a variable called
users dictionary which will be of type -
dictionary
because the data will be written as a
JSON and we convert it into a dictionary
to be able to access it will also create
two areas called let's call them user
let's call me not call it a bar because
we're going to be changing the value
user names array which will be a of type
string and I user images array which
will also be of type string coming to
the viewdidload method here we'll
retrieve the data from the database and
display it so let's do that
get the node that we want you're
familiar with this code which were you
just used in the view controller observe
event type dot value with block and
that's called the data returned at
snapshot in and let's save the return
JSON into a dictionary
yes and this dictionary now we loop
through the users dictionary now you can
understand this that the data returned
is in the format of user ID followed by
the details of the user so there's gonna
be user ID and insight that is going to
be the details of the user then there'll
be another user ID and the other user
details inside that so let's filter it
in this way we go for user ID and the
details for that user in the users
dictionary what we want is you want to
save the image as details dot object for
key and it's gonna be called remember we
store it as profile pic 50 and we have
to make sure that it's a string and not
nsurl though it is already stored as a
string and let name equal to details dot
object for key name because username
store under name and as string also we
don't really want to show the full name
of the user on the user's page so let's
split the name up and only show the
first name so let's say let let first
name equal to name and we do component
separated by string space and we select
the first part component separated by a
string we'll basically split the name up
into an array now what we need to do is
you just need to in we need to append
the image and the name into the arrays
that we have created on top which is a
user name user names array and the user
images are so self dot user images array
is dot append
image and self-taught usernames array
dot append and after we append the names
and this and the image we need to also
reload the collection with for it to
actually update connection view dot
reload data now we've caught the data
we've stored in two arrays now let's
configure the collection view itself
number of sections in collection view
we're going to give the number of
sections as 1 number of items in
collection view is going to be basically
you could either do a count of the
number of images or the number of users
in the array so let's just do it'll self
dot user images array dot count and we
do configure the self if you remember in
the beginning we had created this class
called collection view cell which tells
us how to how the cells can be
configured that we're going to use over
here so let's configure gather so let's
L equal to collection view dot DQ
reusable cell with views identify the we
use identifier here is collection of
yourself for index path index path and
we're going to force down cost this as
as collection view cell now we have to
do is what we have to do is let's get
the image URL from the array since you
want to display the image look at the
image URL
user images array and that will go index
path dot row and let image data equal to
NS data contents of URL image URL cell
dot user and we need the name of the
user as well
l dot user image dot image equal to UI
image data image data let's force on
wrap that and send dot user name dot
text is equal to user names array index
path dot row you just look at this what
we're basically doing is in the
collection view we're setting up the
user's image and the user's name so
that's all that we're doing here and
then we just need to return the cells
there's already been done okay so
there's one more thing in the collection
view controller which are different from
the table view controller and that is if
we're using a prototype cell like we've
created here the collection yourself
what we need to do is in the collection
view controller there's this line which
registers the cell just a class UI
collection view self dot self this we do
not require if we are using a prototype
cell so let's test this out now so we
see over here is on the profile page we
go to the profile page we won't see the
user's name because this user is already
signed in also going on to users is
going to give us an error because the
user's profile pic doesn't really exist
the small one so instead of getting the
error we'll just lock the use out and we
lock the user back in
what that will do is the code that
proponent with viewcontroller will add
the name of the user and also will you
get the profile pic the small profile
type which we can confirm by going here
and we can see that we've got the name
and we've got profile pic small store
over here now similarly right now it's
only showing us our own name and our own
profile we can see other users by
logging in other users with their
Facebook accounts so I'm just gonna
pause the video login a few more users
and show you okay so I've logged in with
two more other accounts and currently
I'm logged in with my personal account
so as you can see we have three users
over here now
and all and if you go to profile this is
my personal profile and if we're going
to use us we will see three users come
up over as you can see there was a lag
between the images loading up and the
time when we went on this page so let us
quickly correct that what we can do is
we can show a loading icon once the time
the page is loading little bro the main
storyboard and the collection who
controller I just add an activity
indicator view change its size a
correction is style tour large white
change its color red and let's also
select hides when stopped camera split
editor open up the users collection view
controller you have to create an outlet
for this
so let's control drag this let's call it
e IV loading view or just called a
reloading and when the view loads
that's called a IV loading knowing that
start animating and once the
collection.you is reloaded will stop
animating it so we call a IV loading dot
stop animating to be explicit let us
turn itself to both of them let's
quickly just run this again so now if
you go to the users we see a activity
view loading and then it shows us the
users so this tutorial did take some
time in the building blocks to get this
together so now we can see that the
users that are there on application I
think it'll be more useful if we know
which of these is actually online and
probably create like a chat in the
future so let's see how we're gonna
build on this in the future but for now
I'd like
you guys try this out and I hope you
like this Thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>