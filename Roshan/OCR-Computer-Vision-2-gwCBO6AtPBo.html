<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>OCR - Computer Vision #2 | Coder Coacher - Coaching Coders</title><meta content="OCR - Computer Vision #2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Roshan/">Roshan</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>OCR - Computer Vision #2</b></h2><h5 class="post__date">2015-02-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gwCBO6AtPBo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome to the story
about computer vision this is part 2 of
building a flooring system for Sabre
fencing
so let's see what we have to do today
we'll be building an OCR four digits
this is inspired by this answer on stack
flow I will link it in the description
below importing the same things like
last time but I'm adding some machine
learning a classifier and a great search
object mmm this is all from the I'm
opening the video in here it's all
explained in the previous part so let me
execute that you will notice this time
I'm using the 180 version of the video
at 720p so I'm going for higher
resolution basically this is on also
from the previous part we're using
MATLAB to display frames from the video
and we can slide and we can see the
images changing as we slide through the
video
because I did not from the frame
basically sorry I was sliding and it
wasn't moving because I restarted the
kernel and I did not run the frame so if
we slide now it should yeah
there and the players are moving sorry
for that little glitch
instead of using get this interface
that's really limited some degree I'll
be using open CV which is a much
interesting interface to do that first I
will be reading one frame from the video
then instead of showing it in Matlock
Lib I'm using open CV that I am show and
this function takes a window named
animate object which is an image so I'm
naming the window Sabre fencing and I'm
passing the image that we just straight
from the video then I'm waiting for a
keyboard input and the parameter here is
the delay in milliseconds but if we use
0 it will just wait wait for a keystroke
forever then after we hit anything on
the keyboard this will close all window
windows using the destroy windows method
so if we if we run this so we will get
this nice window where we can zoom and
zoom out but the thing about this window
we cannot resize it and the image is
much bigger than our screen and if we
cannot zoom out a little bit that would
be a problem so to deal with that we
will be using normal window too
to tell Python that are still open CV
that you want a normal and you will have
to define your window first using named
window method named your window and pass
CV to that window normal which will tell
open CV that you want a normal window
instead of an auto sized window then I'm
showing the image in the same window
name that I used here I'm waiting for a
kid and close and if we check it now we
have this nice resizable screen that we
can zoom in zoom out and that's you can
make the screen you can maximize the
screen and one of the most interesting
thing about the opencv inter interface
is you can zoom in and actually see the
red-green-blue values of each pixel that
will that would be one of my favorite
features of their interface the other
option is to use fullscreen and to do
that you have to define your window then
set property set window property of your
window and you will pass property for
screen and CV fullscreen window full
screen then you can display our image
normally and wait for our key and
destroy all windows and that's how
fullscreen works then we'll be a
building work interface it's a very long
code it does a lot of things that you
will need during any work with computer
vision or most work with the person but
it's a very helpful interface that I I
would modify for each very specific
project but usually the main idea
remains the same so let's run that and
see how it looks I will be minimizing my
window to see that and that's our main
preview window and we have HSV Pesta
Graham and BG our histogram these are
the two color schemes that we care about
we can slide in here to see different
frames of the video we have a BTR and
HSV so we can switch between the two
color schemes and HSV maps to the same
colors so blue for edge green for s and
red for V the last one in here we'll
explain it in a minute I just have to
explain to you what are these limits
first and on the histogram since we're
looking at HSV image we can change our
limits on the value we we care about
reading these numbers in here and the
one thing you'll notice about this area
the value which is the red one as 255
and it's almost consistent throughout
the number so we can filter out
everything in the image except areas
with high value so if I switch from
image to threshold I can see that I'm
only getting the text around here and as
I slide this filter more and more I will
get a cleaner image of the score
I'm getting here to 244 and I'm getting
a really clean image you can do the same
thing you can filter with red grew red
green blue or HSV hue saturation and
value and you can just switch between
them basically and that's the first
thing we need to do yeah I will run that
interface one more once more actually
before I do that I will just rerun this
region of interest list so I'll reset my
region of interest list and I will be
one of the things the screen does it can
store where did you click your mouse
basically so I will be clicking the top
left on the area where the score might
show up basically so I'm telling I'm
storing this point and this point the
top left and the right bottom for the
left player score and for the right
player score I will be doing the same
top left bottom right and I think the
score will go outside this area so if we
go out now I know our regions of
interests are start so let's start
building the OCR I built this Cetaphil
training set and GIMP it's like a
Photoshop think software
I basically wrote some numbers I sized
them up and down to different levels to
get different quality of the image some
pre-processing of the image I'm changing
the image from BGR to grayscale first so
this is the grayscale version of the
image then I'm using comparing the fixed
threshold to the adaptive threshold so
this is what I get with the fixed one
and this is what I get with the actually
I have to run these cells so this is the
fixed one then this is the adaptive
Thresh hold then I wanted to find the
digits
I could have manually put their
locations but that will be really hard
to do once you are dealing with multiple
digits on a video that when things might
move around so you cannot do do it this
way and you might cut them a little
differently
and that will ruin detection accuracy so
I'm finding contour for this image and
I'm filtering out all the smaller
contours so for example I'm sure it
detected the area inside six as the
contour I'm not interested in that it
detected two in here one more in here
one inside the zero and a bunch of other
things I'm not interested in these so I
felt heard all the smaller hunters and I
made sure that it only detected 60 boxes
and they cover all 16 am
we have in our training set
I'm checking here a single digits just
to make sure I get the digit correctly
and I'm changing the interpolation in
here to nearest this helps with
visualizing each specific pixel to its
value if I remove this it will just look
really bad basically so this is why we
use nearest when we're really looking at
each pixel value
after that I labeled all the digits to
some level manually so I went through by
row so this row had nine eight seven six
five four three two zero one so and I
wrote that and I did that for all the
other rows and this is my training set
results basically or the y and the
training set what we're predicting so
the area that we're capturing is a
little big it might be like 48 pixels by
24 or sorry 38 by 24 so practice and
it's really large
so I'm resizing my image to 10 by 14 and
this will help create less features to
make detection basically work better so
let's do that and this is our image now
then I'm preparing all features
basically so we have 60 rows and each
one of them has
forty features which is ten by fourteen
basically training a classifier I'm you
I'm training K&amp;amp;N classifier in here
music great search to find the best
parameter for a number of neighbors and
it tells me the one neighbor is the best
value for a number of neighbors
parameter in here and I I'm just testing
again on the same training set I know
this is a big know once you're dealing
with machine learning but it's just an
indication to tell me if a classifier is
at least working so if I get to another
present in here I know it works at least
I'm also timing the prediction and
predicting sixty values takes one point
four nine milliseconds which is really
good but not super cool but it's good
enough for this application and after
that I'm doing the same with the support
vector machine classifier and you can
notice the performance is faster in here
I'm getting the same 100% accuracy and
in here I'm training a random forest
classifier which I did not really get
good results from I'm getting eighty
percent from that so I will not be
retraining it right now running the
classifier on video so I will be
retrieving my region of interest list
the one we clicked on the screen if you
remember earlier so I'm just retrieving
my list and
you can see that I'm splitting these
points and to lift player score ROI and
right player score RI I'm just
displaying that just to visualize my
selection they're not the same size but
it doesn't matter because we can still
get good results out of that and it will
automatically detect where our digits
are so let's do that we will be doing
some pre-processing so I'm converting
that into grayscale using the HSV color
schema and getting only the V out of the
HSV so I'm just returning the value the
which is the third channel of this color
schema and this is how it looks for the
this is how it looks for the left player
and this is how it looks for the right
player then I'm doing some threshold in
basically at two hundred and thirty just
to clean out anything else and I'm
finding the contour for this little
image and then I'm trying to draw a box
around it just to make sure I get the
right digit in here so let's work on the
prediction if we just run the script
it's basically doing everything that we
did before but it's making it into
functions basically and it
reading rescue the score so I'm getting
the score for the left player and the
right player and at the current screen
at the current frame they're both 0 if
we go up and change the frame if we go
up and change the frame actually let's
not do that right now but basically if
you change the frame and run this again
you will get in fact let's do it
that's okay figure on here and scroll
down for example to here it's 2 - no
let's do something more interesting yeah
for for head rose okay 2 3 3 4 and we
close that and go back to our prediction
and run it again it will tell us the
score is for the left pears 3 oh this is
right player because I'm getting the
right player
all right and you can see that it's
reading of the the score of the screen
using this OCR that we just built to do
it for the complete video I built this I
wrote this little code in here but it
takes fairly a long amount of time I
cannot 3d do that during the video
because it will be just too long and the
producers already running too long but
I'm visualized that before and this is
how it looks
you can't see the left player is red and
right player is green and you can see
how did the left player basically when
and when did he score each of his points
so we can split the video later and we
can analyze what happened before that so
the judge called a point for that player
and here I did the same but I divided by
frame per second so it's in time and in
seconds instead of frame and you will
just basically see the same image I put
everything in a data frame and I saved
my work to a comma-separated value file
so we can't continue that in the next
part of this tutorial
the sets are available open source and
github and it's viewable on MB viewer
feel free to use this or any part of it
for any computer vision work you're
doing I hope if you like this you will
subscribe to this channel and you can
watch the previous part of the series by
clicking here or the next part by
clicking here thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>