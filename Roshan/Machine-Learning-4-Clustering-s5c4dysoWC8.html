<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Machine Learning 4 - Clustering | Coder Coacher - Coaching Coders</title><meta content="Machine Learning 4 - Clustering - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Roshan/">Roshan</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Machine Learning 4 - Clustering</b></h2><h5 class="post__date">2014-09-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/s5c4dysoWC8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone and welcome to the series
about machine learning this is part 4
and it's about clustering in the
previous lessons we've talked about
setting up your environment which covers
setting up your development environment
on Amazon Web Services second part we
talked about an introduction to machine
learning and we covered classification
using Canaan function and the third part
we talked about regression where we
covered linear regression SVM regression
measuring correlation RBF kernel tuning
and finally testing accuracy so why do
we use clustering is one of the topics
that we'll be covering another is
clustering examples when do we use it
retrieving stocks price for Google so
we'll be working with the stocks we also
talked about visualizing the prices
working with many stocks and find
finally the clustering part which is
finding similar stocks within within the
stock data
so first we'll generate this text that
takes us to the identity administration
interface these are at a username
password make sure you change them on
your instance because you don't want
anyone to access your agent interface so
why do we use clustering unlike
classification and regression clustering
is unsupervised
that means the algorithm the algorithm
will classify your data not based on
predefined categories the algorithm
would look for similar data points in
your data set and cluster them together
different algorithms can solve specific
problems but k-means is general use
algorithm and that what we will be
covering in this tutorial
a clustering can be used for a very
large number of purposes but I will be
talking about three main things finding
similarities between items with no
categories so if an example would be
categorizing text documents if you have
a large number of text documents you can
categorize them based on common words or
things like that you can count objects
in an image that's useful in biology
where they're where they are counting
sometimes cells or things in in hundreds
or thousands of images grouping images
based on content that's used to find
similar images to the one you're looking
at based on the colors of the image
basically finding new patterns and
categorize data so sometimes we want to
understand some features that we don't
we can cluster them and see what we get
or finding correlated stocks and
commodities this is what we will be
doing in this tutorial finally it's the
recommendation systems finding related
news articles actually Google uses that
to show related news articles to the one
you're looking at once you're searching
and finally finding get products or
information according to our users a
taste so an example would be YouTube you
you will get a list of videos on your
homepage that YouTube thinks you like
based on your watch history and other
people with similar watch history so
let's start by importing our libraries
I'm importing Pan
speedy and an umpire's MP Matt lot like
that by PI plot as PRT then I'm
importing some other things in here I'm
importing candlestick codes historically
Yahoo and date to number from matplotlib
that finance these are we'll be using
these to do some functions for stocks
you I'm importing k-means from a scalar
and dead cluster and importing normalize
from SK learn that pre-processing find
it I am importing that time and time
Delta from that time so let me execute
that I will be configuring pandas to
display a maximum of 50 columns because
we are working with a large data set in
here
I'll start by retrieving stock prices
for Google so I will be defining a
function in here called download data it
takes a symbol and a number of days as a
delta and it will calculate your finish
date as today and your starting date it
will subtract the number of days in here
so by default it's 30 days I'm reading
from Yahoo Finance using this function
codes historical Yahoo I'm passing the
symbol that I want to read start date
and end date then I'm storing this data
inside the panda's data frame and in
here I'm passing the raw data as it came
from this function to the data frame and
giving it the name of the columns as I
want them as I want them one in my dad
frame finally it returns your data frame
and here I'm calling this function with
the symbol goog which is Google's symbol
and NASDAQ and here I have the first
column an underscore date which is a
numerical a representation of dates I
have open which is the opening price of
the day close closing prices of the day
high which is the highest price for a
deal during that day and low which is
the lowest price of the deal during that
day volume is the number of shares
traded during that day and here we have
19 rows so we have 19 days within the
last 30 days which were trading days
I'll start by processing the date just
to make it humanly readable instead of
this I think so I'm defining a function
here called process date it takes data
set and its first it converts in date
column to an integer column because we
need it to be an integer by default it's
a float then it applies that time that
from ordinal which takes this number a
converts it to a date and I'm calling
this function so we have the result of
that in here and we can see it generated
our dates then I'm calculating daily
average they will change and range there
are a lot of things you can calculate
you can calculate moving averages and
other things if you want but I will be
just working with the basic things in
here I'm calculating average as close
plus high plus low divided by 3 this is
one way to calculate the daily average
some people work on
with clothes as a representation for
that day but I find this to represent
the day in a much better way
it doesn't include open which is the
first price of the day but it
encapsulate how much did the market went
up and down so if it closed closer to
high or low it will still show that it
moved through the day between high and
low and a clause will influence the
price of a little bit more it's just one
way to calculate it you can use whatever
you want or you can use clothes and
stuff that anyway I'll be calculating
the change amount which is closest a -
open so how much did change during the
day change percentage which is change
amount divided by average then I have
range which is high minus low divided by
average then I have changed from one of
n so if I want to change
calculate the change from one which is
the change from previous of a record it
equals the average of that record minus
the average of the previous record
change one percentage of n is change one
amount divided divided by average I'm
defining a function here that does
exactly this and this is the code to do
it
it's just simple pandas and mathematics
in here replicating this these formulas
and I can see my results in here I have
the average so the average of this day
is this change amount and change
percentage range change from one amount
and change from one percentage putting
the first one to zero because I don't
have the previous record
so that's just one way to do it
visualizing the price I will be plotting
the price and I'm using plot date
function from matplotlib and the I'm
formatting the x-axis to show dates on
the x-axis like that so that's the
average price of Google during the past
30 days you can see it went a little
down up down then again up but that's
that's one way to look at it sometimes
we want to add more data than just a
single line we can plot different things
on a twin access x-axis so it will
maintain the x-axis and generate a
secondary y-axis and here I'm plotting
the average price and the change from
one and percentage using secondary
access with the 20x function so I have
in here two lines the blue line is the
average and the red line is changed from
one from one day and I can see this is
the percentage for the red line this is
zero and this is the price this is the
y-axis for the price the blue line you
might prefer to use candlestick charts
actually most traders don't like lines
like this they like candlestick charts
so to use candlestick chart you pass an
axis then you pass a variable called
code
which is a sequence of time or date
open/close high-low you can have more
things there but it will not look at
your other variables then you can have
an up color down color and then alpha
I'm using green and red for up and down
and modifying the width to 0.6 to give
it a little volume and we can see now
Google is in a candlestick care chart so
it shows more information than a single
line we can see that some days to move
more than others that you cannot see
that in a single line chart we can also
use twin x function to generate a
secondary axis and plot another chart
with our candlestick on secondary y-axis
with the twin x axis working with many
stocks in here I have a list of 50
stocks they're mostly tech stocks Google
Facebook Apple Microsoft I have some
media I have some other things in here
like GE ExxonMobil
caterpillar and I want to download their
data now
so I defined a dictionary in here with
the symbol and name of each company I'm
storing symbols and variable name
symbols and names in a variable named
names starting a new data frame in here
named stocks data and it just has the
symbol basically and I'm adding a second
column in here with the name so we have
an easy reference to
our symbol and name I think it didn't
show the results so that's normal
whenever you have this save your
notebook once you get checkpoint created
just go to the address and reload your
notebook and that will get you back to
where you were so I'll go down to the
same one and I'll execute it again and
you can see it's working now
I have symbol and name for each of the
50 companies that I'm working with so I
have 50 rows two columns I'll be
downloading this data so I'll be looping
in here I'm first downloading data using
our function to download data then I'm
processing date calculating stats then
adding the symbol to this data and I'm
appending all of that in a list and
concatenating this a list using pandas
concatenate so if we execute that that
was first and it returned in here a list
of it's a data frame with all our daily
prices and here I have Netflix then
Apple
I think that's New York Times Facebook
so I have all of different all of these
different stocks now in the same data
frame and this is exactly what I want I
will be visualizing multiple stocks so
I'll be visualizing I'm using X as date
and Y as the average price and I'm
plotting all of that using just a simple
loop and I have some stocks in here
between 500 and 600 dollars have a
second one here and have a bunch of
stocks around
100 between 0 and 100 basically that's
if I wanted to find information about
which which stocks are similar it will
be really hard to do it just by looking
at them so will be this is where
clustering comes in it will help us find
similar stocks within this data set of
50 stocks
so first I'm defining a function that
will pivot our data so it will take this
data set with all all of these readings
and pivot it in a way that dates our
columns now and the symbol of stock is
the index of each column so I have rows
a sort of rows index of each row so I
have one row for Apple and it has
columns for each of these days and the
numerical interpretation of the date
normalizing the data I don't want to
talk too much about normalizing data
because I will be covering that in
details in the next tutorial but assume
that we you have your data in here which
is your data set it has two dimensions
so I and J this is the mathematics of
this I don't want to confuse you with
the mathematics but basically it will
normalize your data between any two
numbers in here if I look at this my
data goes from around 600 that tells 0 I
can normalize all of this data and make
it run between for example 0 and 1 or
minus
and one that's really useful to find
similar stocks so this is how our data
looks and normally and this is our data
looks if we normalize it on the on the x
axis basically it moved all of the
stocks in single range to show how that
they move relatively to each other and
here it's useful if I want to look for
stocks with similar prices but in here
it would be very useful if I want to
look into stocks that are moving
together but it's really hard to still
find any stocks in here I have 50 lines
tangling with each other it's really
hard to do this manually
so this is where clustering comes in I
will be defining a new function cluster
data it takes a data set it takes number
of clusters and it asks if you want to
normalize your data or not so in here I
will be doing that and the same thing
again save
wait for it to give you checkpoint
created and just reload it's a little
annoying but you learn to live with it
anyway perform my clustering I have
eight clusters because I told it to
create eight clusters and in here I can
see that it added a new column to my
data set named cluster so I can see the
first second stalks are in the same
cluster and the fourth one also this is
in a separate cluster cluster number
three cluster number four five three
three one I can see that different
stocks were grouped into different
clusters so let's visualize these
clusters and here I'm defining a new
function called visualizes clusters it
will take data frame the value that you
want to cluster with the number of
clusters and whether to normalize your
data or not it's calling pivot cluster
data it's taking your data back and
generating a new data frame for it and
it's putting the prediction back as a
new column in your data named cluster
then it's just plotting the cluster
centers which are called centroids then
plotting the actual stocks let's execute
that it will make more sense once you
see the actual charts so in here I'm
clustering using to the average I told
it to create three clusters and I told
it to normalize our data so these are
basically the three more
genera of things that happened to these
50 stocks in the past 30 days
this one just went flat the green one
the red one went a little high the green
one the blue one went higher than flat
and or went a little down near the end
so let's see what it has for us
the first group has Blackberry
Salesforce HP Rackspace and they are the
group that went really high the blue
group and this line represents the
centroid of this group the second group
has really a lot of stocks Autodesk BP
and bunch of other stocks
it just went think a little down and
these went a little higher but not like
the blue one Apple Adobe and Bosh of
other companies to have more control
over that and to test different ideas we
need to see what works and what doesn't
again the same problem save so I'm
defining a new function in here that
measures how successful the clustering
is it major is the distance between all
of these points and the center and takes
the average of that let me and the
second thing it does it counts how many
failed clusters so any cluster with a
single stock want to be counted let me
just draw this again
just give it a second to load it's
getting heavier and heavier as a notepad
okay and finally let's measuring how
many failed clusters so basically any
cluster with a single stock any cluster
with the one stock it doesn't tell us
anything it just tells us it doesn't
match anything in our current model but
it doesn't tell us anything beyond that
so we call that failed cluster so let's
test I have an average air of 0.007 and
I have zero failed clusters and this one
tuning using widgets this is really
useful sometimes you want to have a
simple slider where you can just move it
around and get different results and
this is exactly what we are doing here
you can't change which feature your
clustering with how many clusters you
want and whether to normalize data and
here I can see I have some failed
clusters one two I have few have two
failed clusters and have an average of
3.2 I can test something else I can
change it to for example if you're
working with clothes not average you can
say well I want to cluster by closing
prices and in here it's clustering your
data and to several things that's not
really good clustering but you can
normalize your data and get better
results you can lower the number of
clusters to four and you can't see that
we get much better results in here we
have one failed cluster so anyway so how
do you search for the best number of
clusters in here I have just a simple
loop it's looping over whether to
normalize your data or not and
it tastes different number of clusters
and here that I told it to cluster and
to try up to 30 clusters and then it's
plotting the results of this let's let's
run that and see what we get it's just
taking a second to run and this is
exactly what we're looking at what we
want you want to see the average are
going lower and lower as you increase
the number of clusters so this is a
normalized model looking at feature of
average the error goes lower and lower
as we increase the number of clusters
which is the x-axis this is the average
or and this is the number of failed
clusters so failed clusters are the blue
line usually want to use look at the
intersection and look around it and find
a good point around the intersection so
if I would train a model to cluster
these I will be looking at 15 clusters
that gives me less than somewhere around
7 or something like that 7 failed
clusters after 50 stocks that's a good
one but if I was doing that for if I
didn't normal as my data so I'm just
talking at different price ranges I can
see that the error goes really down goes
down really fast in here and it
stabilizes after that so I would go with
somewhere around here somewhere around
20 clusters to show how many price
ranges I had for my stocks if you have
any questions leave them on this video
or contact me on Twitter or Google+
and this lesson is available open source
on github and it's viewable on mb viewer
the link to this is in the description
box below feel free to use this for any
purpose you want or as a reference
whenever you're working with k-means or
clustering i hope you enjoyed this
tutorial and if you'd like to see more
of this please subscribe to this channel
and watch the next part of this series
and it's a and it will be about pre
processing your data thank you for
watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>