<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>13. Build a Web App - MySQL/PHP Part 4 | Coder Coacher - Coaching Coders</title><meta content="13. Build a Web App - MySQL/PHP Part 4 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DesignCourse/">DesignCourse</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>13. Build a Web App - MySQL/PHP Part 4</b></h2><h5 class="post__date">2014-03-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8FjdtXFeqMg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello Gary Simon design course calm
today we're going to work with the main
logged-in area where it shows people's
matches at Bartle comm so if you need
access to the project files they're
available at design course comm and as
always subscribe here on youtube if you
haven't yet all rights get started
alright so where we basically left off
yesterday was the portion where we
directed the user to the main dot PHP
page after verifying an email I so
basically now I've went ahead and I
emptied the offers and the one stable
and I did that because I'm going to add
two more rows to this just to make
things a little bit easier so those two
rows are this two fields basically are
going to be the state and the city and
the reason I'm doing that is just to
make it a little bit easier on us when
it comes to the queries and finding the
the potential matches now you can't do
more advanced my SQL queries where you
can look up information from the users
table like where they're from but just
to keep things easy for this tutorial
we're gonna include with each offer and
want the location information so
basically to add those two rows I'm
going to add them right after the offer
field and the first field name will be
state actually I'll make it city I have
no clue how whatever the longest city
name is and then oh I didn't add two of
those yeah and another one after City
and that will be state and that is just
two letters I believe and save alright
so what we need to do now is go back and
edit the Athiya believe it's step two
dot PHP right here where enters that
information in
I so we have insert new users we have
the city in the state also I added this
right here this kind of cleans the data
so you know it prevents you from being
hacked basically these MySQL escape
string fields so let me find in the city
right here and then right after the want
will go ahead and put in let's see here
the city state I forgot that I didn't
add it to the to both tables which ought
to do and just come over here and pull
it post city Post state and I'll just
copy this stuff go back to the PHP my
admin and we were on the offers table so
we have to do the same thing for the
once table so add two fields this time
after want city state 102 save alright
okay so now we know that when the new
offers and once are added it's going to
include the city and state along with
each one of those all right so now we'll
progress to the next step and that's
going to be over at main dot PHP so the
way I'm going to go back this is no we
have to get rid of this echo we don't
need that anymore is I'm going to do two
queries where we get the once and the
offers from the person who's currently
logged in to the session use your user
ID so what we'll do is query equals
select want from once table
we're user ID equals I'll just copy this
and paste it in real quick and do the
once ARR for array equals DV fetch query
and then we'll take this and just paste
that in there change these names around
a little bit
offer from offers and then this is going
to be changed to offers arr
all right so one cerrar and offers arr
basically we'll hold all of the person's
wants and offers that they entered from
that step one all right so now this is
where we're going to come down and we
are going to get rid of some of these
right here so call them for when we want
to keep everything inside of column four
so right there so we're going to delete
the other two beneath it basically right
to about there so we're keeping row so
we're going to give ourselves some space
here this is what's going to be
basically replicated based on if there's
matches so what we'll do here is open up
a PHP and I'm going to put in when they
close it down here real quick we're
going to put in 5 for each we're going
to take our once arr as once alright
so that takes that array and it's going
to open it up and basically loop through
them and let me come down here alright
so I am making a slight change to the
idea just to make things more simple on
us I it still makes the app useful
though so it doesn't really detract from
you know the the original idea that we
had so the original idea of course was
that we were going to show hundred
percent matches where a person's wants
equal your offers and their offers equal
your wants I then beneath that we would
show just
fifty percent what I'm gonna do is just
make it only fifty percent and so the
top portion of the view let me I well
I'm not gonna mess around with that
yet the top portion where it was a
hundred percent is just going to show
the fifty percent that matched there
once and then beneath that it will show
offers in that same way so you'll see
what I mean once we get going here so
basically you have to do another query
inside of here because remember what
we're doing is we're getting all of the
person who's currently using the site
logged in the their sessions are getting
their ought there once in their offers
here and what we're doing down here is
we're going to go through each of those
once I at the top and then what we're
doing we're gonna do is just basically
copy this and paste it for the offers
beneath here so once we have this done
that's what we'll do so what we're doing
is going through each of these wants and
now what we're gonna do is do another
query from the opposite table so we're
focusing on two things a person once so
we're gonna look if anybody is offering
that one basically so query equals
select all from offers where and I'm
gonna make sure that I the user ID
doesn't equal that person's current
currently logged-in user ID because you
don't want to be potentially matched up
with yourself obviously so we're gonna
put doesn't equal and we're going to put
in session user ID and offer eight goals
once want and then we're gonna do once
match ar-are for array equals DB fetch
query alright so basically this is
looking for any type of offers that
match the once of the person so it's
looking through the offers table to see
if someone's offering what you want
basically and it also doesn't equal your
user ID and the reason is like if I say
for example you're looking your your
you're looking for a
guitar and somebody's offering but
you're also wanting a you're looking for
a Fender guitar but you're offering a
Gibson guitar so we have that guitar
keyword in there twice so that's why you
don't want to use your you normally
matched up with yourself so basically I
now what we want to do after this is if
it finds a match here and we'll specify
that by if count and you can count
basically how many matches are by doing
by using the count function once match
dot RR doesn't equal zero alright so
basically if I found a match it's gonna
do everything inside this portion and
then we're gonna do a couple other
queries so that's going to be one second
here yeah we're going to do first a for
each of the once let me make sure I'm
gonna adjust this real quick yeah
want match okay so it's gonna be a one
match arr as want match alright so
basically it's saying if the count you
know if it basically if I've found a
match here and then it says for each
what we're gonna do is we're going to
loop through however many whether it be
one or two or however many matches there
were that it found so this is going to
look through those and what it needs to
do is find either user information of
the person that matched who's basically
offering what you want so the way we'll
do that is query equals select all from
user
from users where ID equals want match
user ID and limit one where we just
limbs it limits it to one row user info
equals DB fetch row since you use fetch
row just I if it's one row and it is
because we're limiting it to one and
then I what we also need is to get that
users who ever have found a match for
their wants and their offers because
we're also listening blistering
listening what they want an offer and
what they're offering so what we'll do
is I do a query equals select want from
once where user ID equals user info ID
and that's going to be there once a are
R equals DB fetch query and then what we
need to do in order for this to work
correctly is remember each person's one
is on its own row basically in the table
so we need to add those to a single line
where they're or a single string rather
whether separated by a comma because
that's how we designed the the interface
so basically what we have to do is do
for each there once air are as there
once and then once they are are this is
a new variable and we're making it an
array so we add those brackets right
there equals there once once which there
once is right here's is from that array
from this query right here so then what
we can do is another new field there
once equals implode now implode remember
we used explode which separated
imploding does the opposite thing it'll
take everything
basically we specify inside here what
it's going to add or separate between
the individual parts of that array and
then we'll actually punt put the actual
array right here which is want a RR all
right
I know it's a little bit more complexed
and I didn't really think about this is
a little bit more complex than uh I
probably should have chose for a project
but anyhow no problem I so now what we
want to do is duplicate basically
everything from here down because we
have to do it to find their offers as
well so query equals offer from offers
their offers ARR and then change that
right here
and finally right here
okay so basically now what we need to do
I'm going to get rid of one of these
brackets right here and let me come down
here going to add another one right here
it doesn't really matter the location
specifically and what we want to do also
is when it comes to these two variables
that we created since it's going to be
potentially looping through these it
will add to that variable every time and
it will duplicate or replicate rather
the information so what we want to do is
just before that first bracket closes is
put unset offer arr and then unset want
arr and that basically just kind of
wipes the variable out clean so it
starts over each time all right so then
down here what we'll do is for there
once this is where we're gonna actually
echo the information so I PHP echo now
we want to make sure that the the actual
string is uppercase so you can do that
with SDR to upper there once
and then same thing for their offers
save that all right and I also have a
function I found that allows you to take
a date/time column and I or a timestamp
rather and it'll basically echo how
however many long it like whether its
seconds or minutes you know i hours days
months years excetera so what I'm going
to do is include that at the top here
just as a function the function is a go
and the time is a timestamp save that on
real quickly I made an error here on
line 39 with the two queries that we
added get rid of those right there and
then also real quickly I added an I
screwed up one of the what do you call
right there it's one not once all right
so basically now we want to do is upload
the these files so far and let's go
ahead and run through everything real
quickly just to see what works so far
hopefully something
all right so refreshing this I I need
how about I'll just put children games
and then I can offer
I'll put newborn clothes something like
that alright and I'll put in my email
here real quick or in Ohio all right so
I'm gonna check my email and I'm just
gonna click the verify link off screen
alright so basically there are no
matches down here because remember I
basically got rid of everything so if I
click on once we have the city's date
and I
basically it all separated out as it
should be and then the offers as well
alright so basically what I need to do
to kind of simulate this is create
another user and go through this where
we can kind of match one of these fields
up so basically let me come down here
all right so I need okay so let's offer
something that that fictional person
wanted so they there once our children
I want a children that's that messed up
and then game so I'll just put games
over here and then I can offer um I
don't know I'll just put a Nintendo or
something all right find that I put
another email here Warren Ohio all right
so now if we come over here since we're
still logged into this account the first
one if we refresh this Wow it doesn't
work alright oh because I just realized
I should have put games over here so you
know what that's what I'll do find
matches and do this again real quick
there we go now it works okay so
basically I found a person who's
offering games and this is based on what
a person you know what this person who's
currently logged in specified they want
games okay so now what we can do is put
in get this information working down
here because that's still just static
HTML so let me come over here focus on
the state portion first so we have just
the state and a calm our city in a
common than the state so we can do is
PHP echo and that will be or we get that
information from is select all from
offers want match arr
as one match okay so and put the comma
right here and then put another period
to specify the want match state also we
want these to be uppercase so what we
can do is the STR to upper and I think
by default it already is the state
capitals already capitalized so that's
not anything to worry about
all right and looks good I'm going to
upload this and a refreshed and that
works correctly I so now we need to get
the actual this part down here and we
have to make an adjustment to a query or
real quickly because right now we saved
the dates as a date/time field right
here but we need to convert that into a
UNIX timestamp in order for it to work
for that aggo function that we added to
the top so what we'll do is I guess we
can just come right here actually no we
can do it directly from the query and
MySQL so let's see where we can do that
real quickly yeah select all right there
and we'll put in UNIX timestamp date
added as date added and then come down
here and we'll get rid of this portion
and just put PHP echo ago which is the
function name want match date added and
close it up like that
all right so now we'll go ahead and
upload this let me find that and then
come over here we're looking at this
portion refresh it posted eight minutes
ago
all right so fairly simple I now what we
want to do basically is take all this
stuff yeah we should also reword this
and probably be worth you know changing
the icon based on how we're changing
this because what we're doing like I
mentioned before we're showing what
people are offering what this person
wants this person up here so let me go
ahead and go back here oh also I kind of
forgot about something we're not i we
didn't do this query but we didn't
specify in it the city and the state and
so right now it's just kind of searching
everywhere regardless of the location so
what we can do is add a couple more ands
I which we're also gonna have to change
to based on to the search criteria so
basically we're gonna want to look for
you know if a person specified you know
a new city and state or a new city or
whatever or if they clicked on ignore
location because right now it's treating
it as as if a person ignored the
location so but just for now just for
this because we're already at 23 minutes
just for now I'm going to put in and
state equals and we have to get the
variable name I think I will just do
yeah once
once and this is going to be state oops
I forgot that a single quote their state
and I'll just copy that real quick city
equals city alright so now it's only
going to search our show result based on
people who match the city in the state
and it's not because I forgot we're only
selecting over here they want so we just
need to come over here and put city
state and let me upload that and hope
the stupid thing works this time
there we go alright so I yeah what we'll
do now yeah instead of just replicating
this and making it work for you know
showing what people are wanting what
this person is offering you know the
flip side of this I I think we're just
going to end it here right now because
we're still going to want to work with
the coding that we're gonna be that
eventually what we're that we're going
to be replicating down here we still
need to work with this over here so that
it works for them ignoring the location
or specifying an int or an entirely
different city or state all right so all
right we'll focus on that tomorrow all
right so check out Gary's eyes not carry
something
Ziggy my my own personal domain I check
out design course comm if you haven't
and subscribe here on YouTube alright
see you tomorrow
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>