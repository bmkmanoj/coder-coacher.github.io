<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>13.8 Multithreading InterThread Communication | Producer Consumer | Coder Coacher - Coaching Coders</title><meta content="13.8 Multithreading InterThread Communication | Producer Consumer - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Telusko-Learnings/">Telusko Learnings</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>13.8 Multithreading InterThread Communication | Producer Consumer</b></h2><h5 class="post__date">2016-11-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/A1tnVMpWHh8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now in this video we'll talk about inter
3d communication now let's imagine we
have two threads and so they want to
communicate so based on first thread
process the second thread will execute
let's say if the first one is doing
something after that second thread two
should do something and then after
second fit has done its work it time for
this first read about it once again so
that means these two threads are
communicating so that they can work
properly now how can you how can you
achieve two threads interacting for that
let me just write an example here and
then and then what we'll we'll try to
understand how that will be done so
let's start with an example here so what
I will do now is I would read a class
here let me get let me name this class
as a okay we can have any class name for
that matter doesn't matter you so we
have that class a here I in this class
or I already have a class a let's go for
class Q so we have a class Q here in in
this let's have a number which is numb
okay so we have a in Twitter which is
numb and we need two variables for one
who will set the value and I mean two
methods one who will set the value one
who will get the value for that I will
create a method which will set the value
so I will say let's say name less
sympathize put again we can use any name
let me use put and let's say this is
numb itself okay
and now how we'll assign the value will
say numb I will say this dot numb equal
to numb right that's how you assign the
value and we also need to fetch the
value is say public ain't get and it
will return numb okay start simple which
is we just need two methods here one who
will return the value one who will set
the value now once we have done with
this let's go for two more classes now
since we are talking about threads let's
also create some threads here so with
rid of first thread will name this
thread as producer because normally this
prop this intertweet communication to
understand this one of the best example
we we all use is
so consumer so let's take this we have a
producer here and we'll this producer
will implement the Nabal okay that's how
you create a thread right and inside
this producer unfortunately I guess I
already have oh there's no issue with
that let me create a constructor here
for this I will say this constructor as
okay maybe so let's make a constructor
so we say new right leg before that I
also need an object of cue will say cue
cue itself and let's use a constructor
with right leg and we'll go for a Souls
constructor with fields and we will say
okay we got a constructor there okay I
don't need to call super method here
okay and I also need a abalone method
right so I will say public void run and
now what it will have is it will it will
have a number it will have a count of
received is zero and I need a infinite
loop so when you want infinite loop you
always write while true because it will
go for an infinite loop and every time
this loop runs I want to set the value I
want to put the value of num as num plus
plus or not num plus plus but I plus
plus so every time it runs it will
change the value of n okay it will
change the value of num okay and after
that I need I need to see the value
right so I will also use a weight I will
I will also make it hold for some time
so I will reuse a try-catch in which I
will say thread dot sleep and I have to
ask him for weight 4,000 milliseconds
that's enough for I guess and then I
will say catch I would say exception e
right now once we got that we have done
with producer the same thing can be done
with consumer so this is our producer
which is producing the value so every
time it runs it produces a new value now
what I will do is I will go for consumer
so I will copy this code
and I will create a new thing in fact I
should I think I should type it so I
will say class contains consumer
implements variable and here also let me
create object of queue and so I am
creating the difference of Q okay the
object is string object is getting
passed from somewhere so I also need a
constructor here we'll say constructor a
there is something missing here if you
can see producer we need to call one
right how do we call one so to call one
first of all we have to call we have to
create object of thread and so let's
create object of thread will say thread
of this one we say T 1 or T equal to new
thread and we say this is we can also
have a thread name but before that we
have to say this we have to pass the
same object and we'll pass this is
producer so we are specifying the object
and they are specifying the name for it
and we'll say this dot dot dot that's or
not not not here but we'll say T dot
start that's how you start it right the
same thing we need in consumer we also
need a thread for that since we want to
achieve two threads one will be producer
thread and one will be consumer thread
will say sauce constructor with Q and
here also we need a thread so we'll use
the same line of code which is done here
let's reuse the code right so let's do
that here and this should be consumer
okay and it gives you an error okay yeah
because we are missing something we are
missing our main method I mean the run
method and inside this one what am I do
is now producer is fun producer is
producing the values right so what
consumer should do is consumer should
consume the value and how to do that
will say well again a run will run
alight while loop which is true and
every time you run your I mean every
time it looked
we'll simply say get okay and we'll also
need to okay in fact what I should do is
it should give me the value but there
should be a there should be as a time
limit let me just copy this code and
paste it here in fact what I feel is
instead of get returns a value I will
say get you also guys get so get will
also we say void and shafting return
what we'll do is we'll print the value
of num here so we'll print the value of
num just to make it simple okay and so
we have done with get okay everything
seems good and every time you set the
value let's also print the value of num
which you are sending so we'll say put
plus and here we'll say get plus so we
are putting the value and we are getting
the value okay that seems good right
and now I also applied the time let's
run this code but before running this
there should be something because we got
two threads right we got producer we got
consumer both are accepting the object
of queue and one is assigning the value
and one is printing the value now if I
if I create if I first of all we have to
create the object of queue we have to do
that let's do that we got the object of
queue and we need to object one is
producer one is consumer I will simply
create anonymous object so that our work
will be there so we'll say new producer
queue new consumer queue
okay and I guess that's it let's run
this code let's see what happens as you
can see it is saying 0 0 that perfect
then which say 0 Oh hold on that is some
there is something wrong here what I was
expecting is when you put 0 it should
get 0 that makes sense but we got get 2
times that is weird and
okay that is there is really weird and
now if you look at this we got put we
got one we got put we got two four three
get three everything seems good but here
we got put five and six it is getting
five that is weird right so what I want
is once you set the value you should get
the value so set value get value so it
value get value so by the time you are
not getting the value this should not
run ok example we are getting put two
times here it should not be done right
so we should get the second put only
when you got the gate so first a
producer will produce then the consumer
will consume so that the producer will
consume the next value are various the
next value so when producer is running
for the for the phone for the what one
time can you sub consumer will also run
for the one for one only ones now how to
achieve that so what we'll do for that
is we'll do we'll use a boolean variable
here just to keep the track and we'll
name this boolean variable as value set
and by default we'll keep it false
okay and let's start with put if if the
value so in this wild condition so we'll
apply a while condition here we'll say
while your value one your value is set
that means it if it returns a true that
means if your value is true that means
you have we have already set the value
so we see when you say value set that
means you have all these set the value
right then you should not set it now so
when you have all they set at the value
you should always wait so we can we can
ask our thread to wait so for that we
just have to use wait okay
and it made to an exception will use a
try block here and with that we also
need a exception in okay so what we are
doing is if you have set the value that
means you should not I mean once once
you put the value you should not put it
once again so if you put the value it
will be false it will wait for some time
it will wait for
the consumer to consume the value okay
once you are waiting for it your
consumer so once it once you say wait it
will go into wait state so once it goes
into wait state there is then it then it
to be someone who will notify it so
there is a difference between threads or
sleep and wait thread or sleep is
something where you are asking it to
sleep for some time right so when you
say once again two seconds after one or
two seconds it will come back
automatically but when you say wait you
are not specifying the time right so we
need some other thread who will notify
hey wait
I mean hole a thread one I'm done with
my work come back we can do that with
the help of notify now who will notify
the other thread be notified so if
producer is waiting consumer will notify
if consumer is waiting producer will
notify okay so we'll see how to how to
notify later but let's say if this is
not true if your value set is false then
here
once you have set the value we'll say
the value of see here we are setting the
value right so after setting the value
we'll say value set equal to true okay
because if it is false
we'll set it true and then once it is
done let's go for let's go for get now
before fetching the value in get also
we'll see we'll do the same thing here
we are checking for true condition here
we'll check in the gate we'll check for
the false condition if it is if it is
not set then if it is not set then wait
so we'll wait otherwise we'll print the
message and we'll set the value as false
so basically we are achieving we are two
we have two threads who is who is
talking now but hold on are they talking
not exactly because this one producer
when producer goes on wait it is
consumers responsibility to notify it so
here we'll say notify so whom it is
notifying it is notifying the producer
thread and after this we have to ratify
which will notify the consumer thread
so this notify notifies the producer
thread and this notified notifies the
consumer thread okay and if you try to
underscored we got and exception okay
that is weird now why we got this
exception maybe because whenever you use
wait wait to make sure that our method
is synchronized that is one thing
because I don't want any conflict so we
have to make sure that our method is
synchronized we'll do it for this one
also let's see if it solves the problem
and you can see the problem is solved
that means whenever you use a weight
method which is compositing for us to
use synchronized and you can see when
produces for you saying consumers
consuming very producers producing
consumer is consuming there is no
conflict even if you miss mass a time
example producer is producing after
every second but let's say consumers
consuming it after 2 seconds in this
scenario even if your producer has done
its work it will wait for the consumer
you can see it will wait it is waiting
for the consumer then it is executing
let me do that let me just reduce the
time a bit let me say this is 500 and
this is 5 seconds so this is 500
milliseconds this is five thousand
seconds so producer is very fast but
consumer is very slow so as you can see
that is weird now what is happening here
is showing the old output I guess it is
showing the old output let me on this
once again so you can see we got 0 0
producers produce but consumer is
waiting right so it is waiting so
producers produced it is waiting for the
consumer once consumed producers
producing waiting for the consumer once
consumed it is producing the next one so
that means this two are interacting so
we can use wait two to make a thread
wait and this notify I mean the notify
so one thread will
eight the other thread we notify that's
how it works okay there is one thing you
have to observe when you say wait we are
not using any any class to call that
method right because when you sleep
method we use thread class what about
this wait
if you click if you talk about the sleep
method which we have used here
it belongs to thread class can you see
that with Gloucester thread class but
when it comes to wake method when it
comes to weight method let me stop the
execution first okay so when you talk
about the weight method it belongs to
object class because wait and notify
they want an object to work with so they
work with any object okay now this is
many one of the one of the famous
interview question where does this wait
but I belongs to it belongs to object
because wait on the thread is done with
the help of object so train is waiting
for that particular object so wait
notify they are threads they are objects
methods what about sleep there that is
us that is a thread method so that's how
you achieve inter thread communication
pause remember is you can achieve into
thread communication with the help of
wait and notifies where one thread is
asking the other thread to wait I mean
one thread will wait the other 12 is
notified that is enter third
communication we have so with this
example we have also talked about
producer-consumer problem so that's it
from this video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>