<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lean and Fast: Putting Your App on a Diet - Google I/O 2016 | Coder Coacher - Coaching Coders</title><meta content="Lean and Fast: Putting Your App on a Diet - Google I/O 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lean and Fast: Putting Your App on a Diet - Google I/O 2016</b></h2><h5 class="post__date">2016-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xctGIB81D2w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay hi everyone
please settle down nice to see a full
room I wonder if it's because of the
heat outside or are you do you care
about application sizes who cares about
application sizes ran Android lots of
people is there anyone who doesn't care
yeah okay great well I hope I'm gonna
convince you that it's really important
to do that and I also hope that you
especially will go to a session tomorrow
that I encourage you to all go and see
anchor and others talk about building
for billions and they're gonna tell you
all about building apps that will work
great on all kinds of devices for you
know all kinds of markets but today
we're gonna we're gonna concentrate on
app sizes and you know if you think you
know why is it important anyway why
should I care about app size and what is
app size anyway the first of all think
about this we're here in the US where
there's a what there's Wi-Fi on every
corner in every coffee shop we have all
those all-you-can-eat data plans you
know we can download as much as we want
well I just want to remember you to
remember there are parts of the world
where people actually pay for every
megabyte they download and it's not
always easy for them to install apps to
keep the apps updated and it should
matter to you as developers that people
you know install your apps for one and
keep them updated and the other
important thing is that people's phones
not always have like you know 16 gigs 32
gigs of memory so they just can't keep
all the apps installed that they would
want and again if you want users to
actually use your apps maybe you'll help
them a little bit by keeping your app
just a little bit smaller so they maybe
will be encouraged to leave your app
alone and just not uninstall it so when
I was beginning to create this
presentation I was talking with lots of
developers at events and you know asked
them I had asked them a simple question
you know how big is your app and I
wonder if if I asked you just thinking
ahead now you know how big is your app
can you answer that in the five seconds
and if you thought a number
I'm pretty sure you thought of the raw
apk apk sighs so this is the file that
is produced by Android studio how many
people thought about that yeah lots of
people and that's that's correct that's
a correct answer it's technically
technically correct the best kind of
correct but you know application size is
not about the you know the file on your
computer their user doesn't really
interact with the file on your hard
drive that Android studio produces
so the important the other important
sizes we can talk about is the download
size so again if I'm on a you know not a
very good network connection if I have
to pay for the data that I use before
downloading an app I have to actually
look and think can I afford download
leda's app can I afford you know
spending this much money on this many
megabytes to download it and it's not
always the same as ROI pick a size which
we'll find out a moment then there's
install size so like I mentioned the
other important metric is how much space
users actually have on their devices and
how much space your app will actually
take up and again it's not that easy so
it's not always the same as through ipk
size nor is it the download size and
I'll tell you about why in a sec and
third of all the update size again you
might think people download an apk if
they want a new version they get a new
apk right so it must be the same as the
download size only with a new apk well
that's also not true and then there's
other metrics which are really really
important like you know RAM footprint
how much memory your app uses you know
how many methods are in your net in your
app that's really important for like for
if you have to use multi decks or not
and probably lots and lots of other
metrics for app size but we're not
really going to talk about those we're
concentrating more on apk size and the
four metrics that I mentioned in the
beginning
so before we start before we start
talking about how to optimize for all
those four scenarios you know four apk
size download size and so on just a
quick primer and
look at the internals what's actually in
an ATK so that we can talk about you
know what we can what we can do with it
and we what we cannot do and an apk it's
really just a zip archive you probably
all know that if you unpack it to a
folder or just inspect it in a you know
archive viewer first of all you will
find the application code so there's
bytecode there's the Dex the Dex files
or maybe one classes.dex there may be
more if you're using multi Dex that's
pretty much all your code that you wrote
or your libraries that you imported and
so on and so on
there's also native code so native
libraries compiled for a specific CPU
architecture or ABI that resides in the
lips folder and under libs you have all
these architectures so if you have an
arm device it needs arm iso files and so
on and so on then resources a pretty big
part of your app usually and resources
are really divided into two categories
so in the rest folder we have all kinds
of resources like drawables you know PNG
jpeg files layouts and so and so on and
there's also another file resources dot
arsc which contains mostly styles
identifiers and strings and also this
file can get pretty big so we'll talk
about how to reduce that size as well
and then there's all kind of kinds of
miscellaneous stuff like you know other
assets like you put any file that you
use as a you know binary stream anything
that's not an Android resource so if you
want to have like a font bundle with
your app or some game data or some
textures you just put it in the in
assets and you can open it later in your
app then there's the meta in folder this
contains the apps apk signature and I'm
gonna talk about that in the next slide
and then there's the Android manifest so
when you work on Android studio when you
actually compile your app Android studio
gets all pieces of information from all
the libraries you use from your own app
and it creates this you know combined
merge androidmanifest.xml that finally
puts in the apk and one important thing
is if you actually do what I said and
extract the apk and try to inspect
file you will find that it's it's in a
dollar format it's actually in a binary
compressed format so you will not be
able to inspect it easily and I will
talk about how to do that in a sec so
apk signing like I said there's a whole
folder that contains the cryptographic
signature for your apk we all know
that's important so that Android can
verify that the app was produced by you
it comes from you it's you know it can
install it securely and how apk signing
a v1 works the important part to know
here is that Android actually when
verifying the signature it goes file by
file but on every file in your archive
and see and actually decompresses the
file then goes over the full file
contents check simply against the
signature and if it matches then the
signature it verifies its correct
so one thing that one one cool thing
that we can do about that this is
changing compression levels on files is
actually allowed so if you have an IP k
if it's a cryptographically sign you can
actually change compression on a file
inside the archive and that that will
not invalidate the signature another
thing that's useful to know is that
removing any files is not allowed so if
you remove a file you will have to
resign your app and after making any
changes to the archive to the apk
remember that you have to you you have
to run zipper line and after any changes
so even if you like change something
then sign the image sign the apk then
you always have to run the per line so
just a few rules but we have this new
apk signing scheme version 2 and Android
M which changes things a little bit so
it makes it a little bit different
difficult or let's say impossible to
actually change anything inside the
archive it's more secure there's the the
signature is computed over all the bytes
in the apk or so all the content in the
apk and as then it's a panda towards the
end of the zip archive not exactly at
the end of the file but just before the
zip archive central directory and like I
said no changes are allowed and what's
more a zip line has to be run before the
v2 signing so that complicates things a
little bit
fortunately Android studio has made some
improvements and I'm gonna tell you why
but what am I talking about all this why
why did I not go straight to the point
and tell you you know what you can do to
make your 80k smaller I think it's very
important to understand those things to
understand the role of every file in
this archive for example I said that
resources adult AARC can get pretty big
and so lots of developers notice that
they noticed that this file in their app
takes you know even 10 megabytes 15
megabytes and they also notice that it's
uncompressed so if you create an apk in
Android studio and you look at the
compression level of the of all the
files you will see that this file is
actually uncompressed so why doesn't
waste all this space I just said that it
mostly contains strings right so text is
compressible so many developers using
this knowledge of apk signing v1 they go
and compress this file and you know
problem fixed a PK is smaller but you
know what I want you to understand from
this talk and bring us take away from
this talk is some optimizations are
actually counterintuitive and not always
actually reducing apk size will happen
helping the wrong long run so for
example in this case compressing
resources AARC is actually a very bad
idea you should leave it leave it as is
it's optimized for runtime for running
your app so the framework could actually
memory map the file doesn't have to
decompress it where you when you launch
your app even worse think about that if
if the launcher the launcher has has to
read something from this file from your
app and the launcher has to read your
application name if this file were
compressed then just to show your app
name next to your icon this file will
have to be decompressed into memory so
that's one thing you just shouldn't do
even though you can and we're gonna talk
about all these stages and what what you
know magic things happen that make it so
that download size is not always the
same as raw apk size and so and so on so
for example Playstore serves a
compressed version of your apk so in
case for example of this resources file
even though we keep it uncompressed when
it's actually sent to users devices
Playstore will compress the apk
beforehand so we don't lose any
bandwidth we don't use any you know
bytes over the network so that's good
the only thing is when installed on the
device the file will take up more more
space on the drive but like I said
that's actually working as intended some
cool stuff is also happening around
install time so first of all remember
how I was talking about these signatures
and so on you can't change anything
inside the archive and so because of
that whatever you install an app the
first and you know the most important
part of what's taking up space on the
device will be the raw apk itself we
cannot change it even if it contains
resources for other devices for you know
devices with different screen densities
with different CPU architectures there's
nothing we can do it about it on the
device because we have to keep the
signature intact so a little bit of
space wasted we can remedy that later
then there was a thing that we
introduced an lollipop and that was the
new runtime called art which introduced
ahead of time compilation so whenever
you install the NAIC a the ahead of time
compiler will take all your Dex bytecode
and actually compile it down into native
code and store that on your you know on
your user partition so again this this
takes up space this is a divert
derivative of how big your code is at
the bigger your code is the beginning
the compiled code will be so another
thing to be mindful about OneNote with
em we're again getting rid of the ahead
of time compilation we're using a JIT
compiler so this is not let's say not a
concern as much on
and devices and going forward and
finally one curious thing if you have
any native libraries in your apk they
will actually get uncompressed again on
the user partition and will take up
space on the user partition so so that
Android can actually load them access
them with you know better performance
again we cannot touch the apk even
though we uncompressed the native
libraries they take up more space but we
cannot remove them from the apk so
that's space wasted and fortunately
starting with marshmallow and above we
can remedy that and that will be one of
the techniques I will talk about later
and then there's things that happen at
runtime so you know if a user looks up
the application size and settings and
looks at the at the whole app size it's
not just the things that I mentioned
it's also everything you create during
runtime so databases cached images
anything you pretty much download from
the internet or generate locally we're
not going to cover that as much but
remember this is a very important part
to think about too and finally update
size so why is the update size different
than the download size and well I don't
know if you're aware about it for many
years now Play Store has supported Delta
updates or in other word downloading
patches how that works is first of all
when a when a developer uploads a new
apk on the Play Store Play Store will
compute the difference or the Delta
between the old apk and the new apk it's
just basically a binary difference that
you know uses an algorithm to figure out
which bytes are similar and how you know
it can send only certain bytes over the
network then the Delta can be
additionally compressed and finally the
client only downloads that the
difference the delta file and
reconstructs the new apk on device so
the final result is as if the user had
the whole new apk you know the new
signature and everything but it's just
reconstructed on the device from this
patch file and one thing we've been a
little bit vague about like I said uses
some algorithm can be compressed and so
on and we were really
what kind of algorithms play uses for
that and there was a reason for it so
the Playstore team always wants to
improve on that and you know they've
been experimenting a lot and it wouldn't
make any sense to you know give out this
information and then it would change the
next day but actually let me talk a
little bit about the most recent play
improvements on that field and we have a
new Delphi algorithms we were using B as
diff now for computing the deltas and
we've seen some major major improvements
for you know reducing these this Delta
size so for example a major update to
Chrome's are like a big change from 180
K to the second apk from a certain
version - to a newer one used to take 22
Meg's or almost twenty three Meg's on
the previous other rooms with the new
one it's down to 13 Meg's with a minor
update you know the difference a little
bit different from 15 Meg's to three
Meg's
so imagine instead of downloading you
know whole tens of megabytes a whole
package of Chrome you download only
three Meg's and have a new version
installed on your device from other news
we've also introduced patching and
compression for the apk expansion files
that's mostly used for it used for games
but it's super important that's because
games usually have lots of textures huge
level files apk expansion files can be
like a gigabyte in size
imagine if from version to version you
have to download and over and over at
gig and the gig and again a gig lots of
lots of bandwidth wasted and we're
saving that and we're now signing up
over a petabyte petabyte of data per day
for our users thanks to that and but you
know I can talk to you developers about
that you will be happy that you have
smaller update sizes and so on but
what's really important is to show the
benefits to users so starting now Play
Store will show download size instead of
you know apk size on the Play Store and
in case of an update users will only see
the update size so users will be more
happy they will see the benefits of all
your hard work of all the work of the
Play Store
people do it's great but Playstore is
just one component right they can only
do so much on the on the server side
especially with with the signing that
has to be left intact so we also have
some cool improvements in Android studio
2.2 which is in creating out in preview
now so they've been working on the whole
packaging subsystem and optimizing it to
create apk file apk files that are
actually better for for computing the
Delta updates so first of all they
started sorting files in the archive so
that things don't move around a bit
because then the other is you know the
Delta algorithms get confused and can't
figure out the most optimal solution
they zero out time stamps zero out any
empty empty space like you know useless
comments and so on and finally they're
introducing the the option to store
uncompressed native code so ASO files
and I already told you about that I will
get to that later in the presentation so
what you can do if you want to actually
you know measure if your efforts if what
Android studio is doing is doing any
good for for your update size and I'm
happy to say we finally released a tool
that will help you estimate and let me
stress that estimate the update size
again there's there may be new argument
algorithms there may be experiments that
are going on but this will give you a
good estimate on the current algorithms
and how they work for your apk so
basically you're running it against an
old 80k a new apk you see the size
difference and you can see if any
changes you make make sense for that so
now I'm moving on to the second section
which is kind of like a tips recipes on
how to actually actually make your apk
smaller and let's go through some of
those things and first of all how many
of you had read my articles on medium on
keeping apk size low some of you okay so
let me first explain one one point of
contention about using something
compression compression for apk so in
the Articles I
actually wrote that you can reduce the
size of our apk just by using better
compression method that's called softly
it's an algorithm that was created by
Google engineers and yes it did make
your ATK smaller by a couple of percent
nothing much change for for like users
where they were decompressed just as
fast and so on and so on
but currently we advise against using
selfie for your apk so first of all some
users did write to me saying that
certain devices and certain versions of
Android might have had a kind of problem
with the optic impressed apk like they
just threw an exception so that's one
thing another thing is they take an
awful lot of time to compress on your
computer which well you don't make a
release you know every five minutes so
it's not that of a big deal but the next
thing is really really important so like
I said the Play Store team likes
experimenting with stuff and actually
using zopfli because it's so resource
intensive and it needs you know so much
as so much CPU and memory to compress it
might actually in the future it might
actually make new kinds of differential
updates impossible so if you read my
articles if you're thinking of you using
zap see forget about it just don't
especially since the new packaging
system and Android studio actually
experiments when compressing files in
your archives and it actually figures
out the best gzip compression for the
files so that's that's also something
new in Android studio 2.2 next images
how many of you have been to call
session just just before yep so I'm just
gonna do a quick recap remember that you
can always pre optimize your images the
the tools that we currently have in
Android studio in the in the in our
build tools don't always do the best job
of figuring out the best compression for
images you know the best optimizations
they can make so you can you are free to
use external tools to pre-process images
and your drawable folders they might be
a lot smaller from that just remember
that
you used to have to add these lines to
your build.gradle that's simply because
the again the packaging system had its
own optimizer and it wasn't let's say
smart enough to figure out that if you
pre process an image then our built
tools processes again they could
actually make it a little bit bigger so
this actually disables crunching of of
images so that your pre-processing is
left intact I'm happy to say I've talked
to the people at an Android studio and
they promise me this will be fixed for
Android 2.2 so you will the build tools
will be smart enough to figure that out
one very easy when you can have with
your PNG images is actually suppli fie
them so again there's this better
compression algorithm called zopfli
turns out it's it's okay for images you
can use it for PNG files there's tools
that do that for you it's completely
lossless it doesn't change anything the
images look the same they worked as fast
and it's an easy win for a file size
Wepa it's another image format that the
developer at Google gives about 30%
smaller image sizes that then JPEGs for
example and you can use them use web for
your images again just remember one
thing
support for WebP II was added in Android
4.0 but only to replace JPEGs or PNG
images with no transparency that's
because only Android 4.2.1 added support
for new epoch for maps including
lossless and transparent something you
can replace re all your p.m. G's and
also remember to use its server-side
this is really the biggest wins because
you know if your abdominals a lot of
images if you know it's on Android your
server can just generate web piece
instead of JPEG so you'll some areas
there's a lot of bandwidth and you will
save a lot of space on the device if you
catch those images
if you can on Android 5.0 of course use
vector drawables it's a great text-based
format it compresses very well it's just
amazing for icons if you're targeting
still Android previous versions of
Android before 5.0 there's two ways you
can actually use vector drawables so for
some time in Android studio we've had
support for generating pngs from your
vector drawables so if you put vector
drawables in your enjoyable folder and
add these lines to android studio it
will during compile during building your
apk it will actually generate those pngs
for you for those older devices who
cannot use vector drawables and after
that we finally got vector drawable
compact so that's a more programmatic
way of using it from the support library
where you can actually use vector
drawables on your image views in code it
just works of course that there's a
little bit more to it but for that I
suggest you go to Chris Bane's session
where he will probably talk about that
and finally shape drawables this has
been in Android since 1.0 and I think
it's really underappreciated so you know
vector drawables are great they can you
can do lots of complex shapes in vector
drawables but they're you know they're
not always available like I just said
shape durables however have been there
forever and they're great for simple
shapes like you know button backgrounds
borders gradients there's super super
optimized super performance so if you
can't use the shape drawable please do
and like I said this was a great quick
recap of what cold was talking about an
hour ago here on this stage but since
you know everything is recorded I
encourage you those of you who haven't
been able to attend the session or an
hour those of you watching online to go
and check out this session on image
compression so that's that's what we can
do to resources right but what about
code
and really with with your coat with the
size of your coat that's there's one
thing I want to tell you use ProGuard
you will hate it but use ProGuard please
do it's very easy now really it's very
easy to add to your build.gradle file
and then things will break
so yeah just add this line there's also
a new a new way of using the built-in
shrinker and our tools so you can if you
do minify enable true that enables
ProGuard but you can then go and
actually say use ProGuard false and this
will use our built-in shrinker it's a
little bit faster but it doesn't do all
the things that ProGuard does so it just
removes classes the classes it doesn't
obfuscate but it works better with
instant run for example but anyway
whichever option you decide to use you
don't have this notion of ProGuard
configuration files and by default we
have one and the SDK which has some
likes and the same defaults for any
Android app so for example the built-in
ProGuard file already has rules that
keep all the setters and getters on your
view so that animations work and so on
because otherwise they would be
optimized away and you know your app
will break but then if you're not
familiar with ProGuard rules it's a
really complex topic I will not teach
you that here but you can go and look
and in your build folders in the Android
studio there's actually an organic
generated file that's generated by a apt
and it looks that basically as your
Android manifest it looks at your
layouts and it generates rules for your
activities for you views that you use in
your layouts and again by looking at
those and by looking at the default
program file you can learn a lot and
start writing your own and there's also
another way easy way if you know that
you're doing something in your code that
will be optimized the way because you
access it by a reflection for example
there's the new way just add an
annotation keep use the new built tools
pro-gard we'll just leave it as is it
will not be like removed from your code
if you're writing libraries for other
users or just libraries that are
components in your app sometimes those
those libraries just need their own
ProGuard rules so that when someone uses
them they don't break their app and just
remember be a good citizen if you're
writing a library if it needs ProGuard
you can put your own ProGuard
configuration inside your library and
then anyone who imports it will it will
just work but you know not always you
can always remove code because you don't
need it so sometimes you actually need
the things you're attached you're adding
to your project but it's not easy to
keep track of all the libraries that
bring in other libraries and other
libraries and so on so we call these you
know transitive transitive dependencies
and if you add just one one dependency
to your build.gradle file it might bring
in lots and lots of those transitive
dependencies so if you weren't aware
there's a whole command line command for
Gradle well let you see a tree of all
those dependencies that you bring in
with your libraries and here the only
advice is just be aware of what you're
using and what kind of libraries you're
pulling in and make the right decisions
by looking at this and if you're still
not sure if what's inside your apk what
kind of classes you know finally make it
through the ProGuard through the
optimizations through pulling in other
libraries there's a tool that we open
sourced recently called classy shark and
it's it's basically an apk Explorer so
it'll let you go into your Dex files it
will show you all the packages and
they're great for debugging ProGuard and
you will do that a lot if you enable it
for your app let me tell you and I
really encourage you to try it so we
have ProGuard for byte code but if you
if you go through this you know this
pain of enabling ProGuard you actually
get one more very important thing and
that's the resource shrinker and once
you have program enabled you can get
another option called shrink resources
true and that will go and figure out
which resources in
in your app are actually referenced from
the code from the code that is left
after ProGuard doesn't runs its course
and it can remove any resource that is
unused in your code which is pretty
awesome and again it has a configuration
so you can add this really on any
resource file on any XML resource and
your in your resource folder just at
this tools keep or tools discard
attributes and you can make sure that if
there are resources that you want to
want to have in your apk or if you are
if you explicitly you want to remove
something for you from your apk that's
where you configure it so a little bit
like ProGuard rules only for resources
and then sometimes it happens that if
you pull in a library even like Google
Play services or the support library we
offer translations for you know many
languages in those libraries but what if
you're making an app just for one one
market just for one language or you know
just for two languages if you know that
there will be no users of your app or
that you don't manage translations for
other languages then you don't really
need all those resources from those
other libraries like the support library
for all those other languages that you
do not support so just use rest
conflicts just put the number of the
names of the configurations or the
languages in this example that you want
to make it to your apk and the rest will
be simply removed and one side note here
there's a lot of tips on Stack Overflow
in other places about using this for
street paint stripping resources for
other densities that was supported a
long time ago and ancient versions of
our Gradle plugin you can't really
specify many densities here so don't use
it for densities unless you specify only
one but that's kind of a very advanced
usage so we have breast configs for
resources we have shrink resources
ProGuard
but there is there's one very very
advanced technique that probably not
many people are aware of and that's the
problem of sparse resource conflicts and
so if you if you notice that your
resources dot a RC file is bloated it's
it's very big but you don't know why
it's worth trying to figure out if maybe
that is your problem and let me try to
explain that it's not a very simple so
I'm not gonna teach you how the
resources file format works let me tell
you this is a big oversimplification but
hopefully it'll get the point across so
imagine you have a you have an app that
has five strings the strings are
somewhere in the string pool they take
up some memory and then we have your
default config you have your string my
app hello exit and so on just labels for
things in your app but then you decide
well I'm adding a new feature to my app
it's gonna be named new feature instead
of feature so you get a new string right
but this new feature only works for a
version 21 and above so you have a
config you create a new you know you a
new folder under your resources with V
21 and you're just switching this
feature to new feature in that config
well it should take up only space for
one string right but it actually has to
keep no entries on all the positions for
other strings that you're not using in
this config so you lose a lot of space
it still takes up a lot of space even
though you're just using this to
override this one string and I know
these kind of bytes
who cares about bytes but if you think
about that if you have an app that has
3,000 strings if you have 50
translations and there's a lot of apps
like you know among the top hundred apps
on the Play Store I'm sure lots of them
have even more than that the cost of
adding a single string for V 21 for
example that's translated for 50
languages will give you a 600 kilobytes
overhead and that's something we can
work with especially if we can have lots
of other dimensions than just V 21 you
can actually shrink your file a lot but
how do you know that you're doing that
it's not very easy to guess like which
string do I remove and we just recently
open sourced a tool called called a IRC
blamer it's on github I'm gonna post
those links later don't worry
on the spaces application on our space
for this talk and basically it's a
command-line tool you run your apk
through it and you get a CSV file you
upload the CSV to sheets or use some
other program for that and gives you
this kind of nice overview of where the
resources are in your application and if
you sort that by no entry by the no
entries column then you can find which
configs are the most sparse in your app
so which configs wastes the most space
so in this example if you look at the
rightmost column I can identify that the
string that's called apps list you know
it's wasting almost 200 kilobytes in my
app Oh 200 kilobytes is not a lot right
but the next one if I remove descriptive
text one I'm saving one megabyte from
this file and you can do this over and
over and you know remove a lot of really
unneeded data from from your resources
and some of our apps I want to say
remove two and a half Meg's by removing
just three strings so that's pretty big
savings so that's that let me just say
that it really works for only big apps
if your app is not really huge with lots
of configurations and so on then
probably what you won't get anything
from that and finally getting to the
native libraries that I mentioned so
many times already so since Android 6.0
marshmallow
we have this attribute that you can add
on on the application tag in your
manifest extract native lips false and
basically what it does and instructs
this the package installer
the system to not copy out those iso
files the native libraries at
installation from your APK and the other
thing is things just work so if you're
using system log library you just don't
have to think about it the AP case will
just be sorry the iso files will just
stay inside the APK they will just work
you don't waste this space that's used
for decompressing them somewhere on the
user partition but there are conditions
for this to work the Esso files have to
be uncompressed in your idk and the
other thing is they must be correctly
paged aligned using zip line so they're
up until now there was no easy way to do
that using Android studio and our tools
it was just not supported you have to go
and manually decompress those files and
store them and so on I'm happy to say
that Android studio 2.2 finally does
that for you automatically so you can
enable this option and the Android
manifest and see big gains if you're
worried that having an uncompressed
uncompressed iso files will just float
your APK will make it really big that's
true raw apk size will go up a bit but
remember that Play Store compresses data
anyway so the normal size will not
suffer and the Delta sizes will actually
be smaller that's because the BSD
algorithm will be able to figure out
smaller deltas for uncompressed assal
files so win win win just a little bit
bigger file but we can live with that
and then I mentioned before that there's
not much we can do on the device with
resources that are not targeted at your
devices let's say screen density and if
if you produce and fat idk if the
resources are all there there's not
really much we can do about that
unless you actually split your apk into
many smaller apks targeted at those
devices and Android studio supports two
kinds of producing two kinds of split
ATK's one of them is density base so you
can actually drink your compilation you
get smaller files with resources
targeted at specific screen densities
then you can then upload to Play Store
and use the multi apk feature to serve
them only to certain devices and then
there's the ABI based multi apk so again
if you have native libraries for all
kinds of
CPU architectures that will be usually
be really big a really big portion of
your apk second you can split those you
can have multiple apks that you can
upload to Play Store and you know the
users with devices with a certain CPU
architecture will get only this file
that's suited for their device the only
thing you have to remember is every apk
has to have a different version code so
there's some scripts that you need to
add to your build apk to make that work
I really encourage you to go and see my
articles on medium when I where I have
the necessary snippets there's really no
time today on this session to go through
all the code variants for that and
example density split savings I just
took our topic a sample app it's really
image heavy so again results may vary
but the original fat idk was three and a
half Meg's and then if I split that for
different densities it's you know almost
two and a half Meg's saving for everyone
and then you know you can do a lot more
you can do custom multi apk you can
split things Biman SDK version so we
have if you have some features that only
work for you know 21 and above maybe
it's better to start thinking about
splitting and splitting those up this
pretty advanced stuff really so not
everyone wants to do that then for games
you split by texture formats you don't
have to strip all textures to every
device you can recreate density and avi
splits using product for a sorry
variance in Android studio and customize
it even more and then for games mostly
you will use apk expansion files to put
all this stuff that you can't fit into
the apk to a separate file that will be
downloaded from Android studio and
here's an example of this file of a bill
Gradle file that kind of recreates the
splits using multi apk again I encourage
you to look at my medium articles and
this will be explained there better so
what's next go through my articles go
through the tools that we have and since
we have only three minutes left
let me just mention that some of the
tools that I mentioned during this talk
we are actually building those into
Android studio so you might have cared
at the keynote that there's a new apk
analyzer in Android studio so I'm happy
to say you will be able to download that
now and play with it and what this
actually does it shows you the
compressed size of your apk it shows you
the compressed sizes of every resource
inside your apk you can browse classes
in your Dex files you can browse
resources a little bit like a RC blamer
and then you can also look at
androidmanifest.xml as it is in this
form that is compressed in the apk so
and I encourage you to try it it's still
under development that's an early
preview if you have any feedback if you
all find a you think you'd find some
feature that's missing useful please
contact us and I'm happy to hear your
feedback so thank you very much and I
will be open to questions</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>