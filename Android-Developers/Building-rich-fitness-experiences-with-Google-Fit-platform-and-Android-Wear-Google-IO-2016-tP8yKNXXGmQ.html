<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building rich fitness experiences with Google Fit platform and Android Wear - Google I/O 2016 | Coder Coacher - Coaching Coders</title><meta content="Building rich fitness experiences with Google Fit platform and Android Wear - Google I/O 2016 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building rich fitness experiences with Google Fit platform and Android Wear - Google I/O 2016</b></h2><h5 class="post__date">2016-05-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tP8yKNXXGmQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone hey thanks for coming
my name is Dannemann body I'm a software
engineer at Google and I'm also a
dedicated triathlete so on a good week
I'll run 50 miles I'll biked 100 miles
and I'll maybe write 3,000 lines of code
so maybe it's no surprise that I work on
the Google fit app for Android wear
which makes really extensive use of the
Google fit platform ap is that we're
going to be highlighting for you today
hi everyone I'm muslimah Sophie I'm
product manager on the Google fit
platform and I'm a keen quantified self
err I enjoy weightlifting running yoga
and occasionally experimenting with
different diets today we're going to
talk about building rich experiences
with the Google fit platform and Android
wear I'll start out by talking about why
we created the fit platform what
problems we set up to solve and then
down we'll go over its API s and its
data types next we'll look at some
specific examples of what you can build
with a fit platform first basic fitness
tracking and then a more advanced real
time fitness use case finally we'll
finish up with some really cool demos
coming soon
really let's start out by introducing
the fit platform we'll explain why we
created fit what problems we set out to
solve and why we believe fitness is such
a great use case for wearables before
the Google fit platform existed life for
a fitness application developer was not
easy was integration hell first issue
was that of siloed data users health and
fitness related sensor data was siloed
across multiple apps and companion
devices second there was no easy access
and storage of sensor data no easy way
for developers to read interpret and
record data from health and fitness
related devices sensors on connected
companion devices such as Android wear
devices the third problem was poor
interoperability there was no simple
standard way fitness devices to
interoperate so in order to integrate
with the existing app device ecosystem
app developers would have to build their
own platform of write an API some of
these would be poorly implemented
leaving leading to user frustration with
the google fit platform we solve that
problem by giving Apps one single set of
API to access record and stored bone
sensor data wearable data and other app
data so by using my phone and my wear
devices my fitness hub I can connect my
fitness wearable to my favorite
nutrition app and my sleep tracking out
to my favorite meditation app we don't
just consolidate data though with user
consent we provide low-level sensor
recording and we perform hard
computations for things like distance
and calories
whether it's resting heart rate from
heart rate timestamps distances views
from your height steps and GPS or
calories from heart rate the fit
platform makes it easier for health and
fitness application developers and
fitness and wearables truly go hand in
hand this is for a few reasons
first the sensors your app can get
access to all of these ways of measuring
fitness activities many Watchers have a
GPS sensor a heart rate monitor and
potentially even a barometer and because
the watch is worn on the wrist it allows
us to detect activities that we couldn't
do with a phone being in a pocket or a
purse so that's the first reason sensors
second you can leave the phone I love my
Nexus 6p but running with the device is
a bit cumbersome I have to rely on
infrequent audio cues to find out my
current pace because I can't see the
screen when it's in an armband or in my
pocket third it's faster input when
you're on the go you can have quick
interactions with a watch to control
music or activity recording that would
take much longer if you had to rely on
pulling out your phone and opening up
the right app now let's talk about what
the Google fit platform provides that
enables you to build rich experiences in
line with what we just discussed
first let's talk about the google fit
app so here we have the google fit app
on both phone and on Android wear if
you're not familiar with the app you can
see that it tracks walking running and
biking using the Google fit platform
xavier api's that detect activity
associated steps calories and distances
the app also shows data from connected
third-party devices and apps such as
exercise sessions weight heartrate
nutrition data and sleep our platform
automatically synchronizes between your
Android phone your Android wear device
and the web the fit platform exists in
all three of these so you can write in
data by our REST API on the web via our
Android SDKs on the phone or the Android
SDK on where the platform handles
merging and deduplication of this data
intelligently and we even support
takeout integration if the user wants to
export their data thanks Mazz so now
that you've gotten an overview of the
Google fit platform and maybe some
motivation for why it might be a good
fit for your fitness app let me go into
a little more detail about the different
API is that it provides so basically it
breaks down into four api's first
there's the sensors API which gives you
access to raw sensor data streams from
Android devices and wearable devices
sensors so things like heart rate then
there's a recording API recording atria
does automated storage of fitness data
for you using subscriptions you can
subscribe to a data type and Google fit
will store fitness data for that data
type in the background and it will
persist to the subscription for you next
there's the history API which gives you
access to the fitness history and lets
you perform bulk operations like reading
and inserting and deleting data from the
fitness history and then finally there's
the sessions API sessions are basically
a metadata layer on top of raw fitness
data that let you store whole fitness
activities so a session is the time
interval during which the user was doing
say a bike ride or run or a
weightlifting session as far as what you
can record we support really all the
standard data types for diet nutrition
body activity sleep we're also adding
this new hydration data type
I think this is a pretty exhaustive list
of Fitness macbitch metrics but you know
if there's one that's not in here that
you'd like to log in your app you should
let us know so let's start by talking
just about basic fitness tracking you
can't measure what you don't track so
tracking measuring is really I think the
first step toward motivating people
towards better fitness I actually first
started tracking my workouts 10 years
ago back in 2006 when I was training for
my first marathon and I bought my very
first wrist mount of GPS and it was this
massive ugly uncomfortable thing like
the size of a chinchilla on my wrist but
it did the job and I could plug it into
the serial port on my PC and I could
download XML data of my run and back
then there weren't any nice portals or
kind of fitness platforms so to
visualize my runs I built this website
with Google Maps API 1.0 and I could put
my runs up there and you know there's
something really thrilling for a data
geek like me to come back from a workout
and analyze all my stats on pace and
heart rate and elevation and I could
really track my progress from week to
week and workout to workout so these
days obviously there are much more
elegant and full-featured alternatives
where I can analyze my workouts and
share them with friends and track my
progress toward fitness goals and also I
don't have to wear a big giant ugly
thing on my wrist I can wear this really
you know these beautiful timepieces from
tag you or Michael Kors and I can still
track and visualize my progress right on
my wrist throughout the day with the
watch face now this is actually my
favorite watch face here the fit cat
yeah pickups or food cat it tries to
encourage you to be more active so
basically if haven't seen this before
the more active that you are the more
steps you take the more active to cute
little cat becomes I love I love how
he's wearing the i/o badge against the
backpack there and wearing an Android
wear watch also but actually so this
seems kind of like a simple concept
right the more steps you take the more
active the cat becomes but actually
trying to build something like this on
your own is not easy there's a lot of
stuff you'd have to do if you wanted to
do it on your own you'd have to build a
datastore the track steps you'd have to
turn on sensors get permission from the
user to do that
then you'd have to be able to record
step counts in kind of a way that won't
kill the watch battery if you get that
part working then when the user first
installs your watch face
you won't it'll record zero it'll show
zero because you haven't been recording
yet and then there's all these edge
cases like the user takes off their
watch and goes for a walk with just
their phone in their pocket then you
have to write the logic for merging in
that that data and then even if you
solve all these problems your step count
still is probably not going to be
consistent with other watch bases and
other apps so fortunately we solve all
these problems for you with the Google
fit platform we store steps in the
background in a nice low power battery
friendly way and they're ready to be
read anytime you like and you can get
consistent step counts on Android wear
with just one method call so let me just
show you how to do that typically when
you want to connect to the Google fit
platform you create a Google API client
right and normally you create an
authenticated one where you specify the
account that you want to read data for
so here's how I'd build the client I say
that I'm interested in reading Fitness
history data so I add the fitness
history API I add scopes for the
particular types of data I want to read
so in this case activity type location
and body sensor data like heart rate and
then next I add an account so this is
the account I want to read the data from
and then finally add my callbacks and
now I have this authenticated client
that I can use to make queries to the
fitness platform but wait you're saying
Android wear watches don't have accounts
and this is true
Android wear 2.0 will actually add
account support but for now we don't
have accounts on watches fortunately
there is a solution now you could sync
account information from the phone but
this would require your watch face to
have a companion phone app which is a
lot more complicated so here's an easier
way to do it without a phone app you can
create a no account client so you create
a Google API client as before we're
going to add the history API and now we
just call set default account we don't
specify an account finish building it
and now we have a no account client that
we can still use to query step counts
and the way you do that is with the read
daily totals method so you're going to
call the history API is read daily total
method and this is basically going to
give you a simple way to get step counts
for watchface that's going to be
consistent with other apps and other
watch faces you can set a callback so
that when the result returns you can
process it so here in the on result I'm
basically just extracting out the step
count putting it into a steps total
variable and
you go it's a pretty simple way to track
steps with your watch face and it's not
just steps that you can that you can get
from a google fit platform right you can
also read and write other data like
calories consumed so here's an example
of how the life some app displays that
data here I'm looking at the amount of
calories I have left in my budget for
the day 911 so I guess I could eat like
two avocados and drink two glasses of
wine tonight
Android wear 2.0 is going to have a new
way to show data on watch faces using
complications maybe you've seen some
some of this earlier in the keynote but
basically on the right there's a watch
face that has three complications and
the watch face lets you select which
complications you want and then any app
can provide data for those complications
so here's an example where life's um is
exporting data on calories burned as a
complication so that the ranger watch
place which is on the right can display
it in one of those three user
configurable slots and if you want more
information on building complications in
Android wear 2.0 highly recommend you
check out the talk there's a dedicated
talk at 4:00 p.m. on this topic another
challenge that fitness app fitness
developers face is how to perform
difficult computations for example to
derive distance traveled from multiple
sensor inputs the users height stride
length GPS data activity type active
time and step counts all have to be
fused in together potentially across
multiple sensor inputs the fit platform
makes this easy for third-party
developers through its advanced
transformations for both distance and
calories the basis app takes advantage
of this instead of computing distance
themselves they write in steps and
activity data into the google fit
platform and read back our computed
values for distance
cool so let's take a look at how we
might do something like this with the
Google fit platform so there's really
there are two ways of writing data to
the platform you can use the recording
API to do live recording and then you
can use the history API to insert
activity history so let's actually start
by looking at live recording all we have
to do to start live recording is to
subscribe to the data type we care about
so here I'm calling subscribe and I'm
saying I'm interested in activity
samples activity type and then I
actually at that point I am essentially
done google fit will start storing that
data that I care about in the background
so I don't need my own database or my
back-end to store it there's no listener
needed here basically the Google fit
platform is going to start recording
data and syncing it to the cloud in the
background and when I want it later I
can just read it with the history API so
once I subscribe I'm done all I really
need to do is just check the status code
in the on result and that's just to make
sure that the subscription succeeded now
let's look at another way of getting
data into the fitness history suppose
I've gotten my data from some external
source like another device so in the
example of basis right they wanted to
write in some steps that they had gotten
from another device so first you create
this data source object and you specify
the type of data you want to write here
I'm saying I want to write straw step
count data and then you create a data
set from the data source and you add one
or more data points to the data set each
of these points has a start and an end
time so here I'm adding 950 steps with a
start and an end time and then finally
you just call insert data to put the
data into the fitness history and that's
about it all you really have to do after
that is just basically verify that the
operation succeeded before you start
querying the data with a history API and
one nice thing is that the fit platform
will actually validate the data that the
data points that you insert so for
example if I put in an invalid time
range or I put in a really
unrealistically high calorie burn or
cadence or something like that I'll get
an error back in the client instead of
the user's fitness history getting all
messed up so here's how this actually
looks in the basis app they put in steps
and then you can see they are able to
derive from that or through the Google
fit platform they get this accurate
distance travel
we've been working hard over the past
year to improve the quality of these
transformations first area would with
which we've improved them is relation to
distance distance computed from steps
now is it been improved with stride
length calibration from actively trucked
walks and runs to improve the quality of
passively tracked alternates secondly
for calories we will soon be leveraging
gender age and heart rate as part of our
computations to improve the accuracy
thirdly for merging previously leaving
your phone at your desk and going for a
walk with your Android wear device would
result in your step counts dipping back
down and then rubber banding back up
that will no longer be the case through
by direction of syncing we've also made
merging of our GPS data better with by
prioritizing the highest fidelity GPS
sources finally with regards to
activities this is our most complex task
to infer the activity being performed by
analyzed analyzing multiple sensor
inputs in real-time it's really
important as users get frustrated when
their fitness data has false positive
and false negative activities and they
don't get their proper calories and step
counts as a result fortunately Google is
good and trusted at collecting and
understanding complex data through our
advanced machine learning capabilities
we've added dynamic sampling of sensor
inputs to improve quality and have made
improvements to our algorithms by fusing
steps position speed and user
Corrections together the result of this
hard work over the past year is a
reduction in our biking precision error
rates from 11 percent error in early
2015 down to four percent error as of
now and these changes will be rolling
out now finally we've added stride
length calibration to the fit platform
which we hope will greatly benefit non
GPS Android wear devices so now if a
user goes running initially with their
phone and their watch which has GP at
the phone which has GPS and the watch
the two will calibrate together by and
generate a stride model and then they'll
get accurate distance and pace estimates
running without their phone just with
their non GPS Android wear device now
that we've looked at some basic fitness
tracking examples I want to talk about
I'll push this year into real-time
fitness tracking but why is real-time so
important when building a motivating
fitness experience well when I look at
fitness apps out there and I look at a
lot of fitness apps out there I see that
they adopt this framework they start
with a goal of the user for example I'd
like to lose 10 pounds I'd like to sleep
better or I'd like to finish a half
marathon they recognize that in order to
accomplish this goal they need to
encourage a pattern of motivating
actions so the user achieves the result
that they desire let's drill into these
motivating actions there are three
pillars of wellness exercise nutrition
and recovery recovery we mean to mean
sleep and meditation but these pillars
do not operate independently and
behavior in one needs to be balanced
against the other by getting a holistic
view of what's going on in each of these
areas your app can more intelligently
and insightfully present suggestions and
nudges based on a changing fitness
context in real time for example a sleep
app might observe that you sleep better
when you exercise or when you eat less
sugar in the evening an exercise app may
suggest exercise based on your log
nutrition data so that you meet your
weight loss goals note that in all these
cases timeliness is important the best
time to coach and motivate a user is
immediately in response to an action
that they have taken in relation to
their fitness so good apps have an
inbuilt awareness of the user's overall
fitness context one of our partners life
some makes heavy use of these principles
through in their application and they
integrate deeply with the fit platform
api's and as a result they've seen
double the
generate for their users connected to
fit versus their users who aren't
connected to fit and here are the api's
that we've added to let you respond in
real-time to a changing Fitness context
for your user first its real-time data
update notifications allows you to be
notified for certain data types in the
fitness store when they change the
second is real-time session
notifications it's actually been in the
fitt platform for a while
but we'd like to talk about it today it
allows you to be notified that the user
has started or finished a workout
tracked in a third-party application
finally there's real-time activity
recognition coming soon to Android wear
devices to detect the onset of activity
to launch into your activity active
tracking experience let's dive into the
first API real-time data update
notifications this allows us to build
the following experience say I just had
an impromptu pizza and I've exceeded my
calorie intake goal for the day I can
get a notification from my weight scale
app telling me listen more exercises
needed to keep you on track to meet your
weight loss goal I do admit I have a
weakness for pizza and that one look
pretty delicious so let's see how we
could build something like that example
that was just described what we want to
do is subscribe to updates to the
nutrition data type so first thing we do
is create a pending intent
this is typically a pending intent for
an intent service that's going to call
into your app whenever an update to one
of these data types occurs what you then
do is you call you create a data update
listener registration request which is a
lot of camelcase but it is a pretty
descriptive name and we're going to pass
in the the type of the type of data that
we'd like to subscribe to updates for so
in this case nutrition we're interested
in meals that are being logged and then
we pass in that pending intent we
created and then finally we just call
this register data update listener
method and we pass in our client in our
request and then voila
we'll get an update with the next log
meal and of course you can register for
updates to all different kinds of data
types for example if I want to be
notified every time the user steps on
their scale and logs a new weight I can
do that with type wait
and here are actually all of the data
types that support real-time updates
pretty much anything that isn't updated
super frequently the second API
real-time session update notifications
allows for example a nutrition app to be
notified the user just finished a
workout session so say you just finished
a weightlifting session your nutrition
app can tell you it's time to get a
high-protein meal in to maximize your
muscle growth or say a hydration logging
out it can suggest rehydrating
immediately after finishing a 21 minute
run outdoors it's been so hot here I
don't think I think we can all use
hydration reminders even we haven't been
running just walking around outside so
let's build that one similar API to the
one that we just looked at with the
history API but here we're going to use
the sessions API because we're
interested in registering for updates
when a session starts or ends so again
we create a pending intent that we'd
like to fire when a new session begins
or ends and then we call this register
for sessions method in the sessions API
and now whenever the user starts or ends
a workout the pending intent will fire
and an intent will be delivered to our
app and if you want to get more
information on that session you can
actually extract it from out of the
intent so here I'm pulling out the start
and end time and then also the type of
workout so whether it was a run or a
bike ride or a weightlifting session and
I could put that into the notification
like the one that must just showed one
exciting new development that's coming
to the Google fit platform this year is
that we're actually going to allow your
app to register not only for these
explicit sessions that the user
initiates but also for implicit sessions
these are ones that are automatically
detected by our platform so what it
means is that your app can respond in
real-time to a user's fitness activity
so if I just lace-up my shoes and I
start running my favorite run tracking
app can just start up automatically on
my watch so I'm going to try to show you
a demo of how that works I'm not really
properly dressed for running but I'm
going to do a little run around here
okay I just felt my wrist vibrate which
means that Strava should have started up
on my watch so let's go over here and
take a look and there we go so you can
see that Strava is now recording my run
and I will I'll post that on Strava
later so I hope you can give me some
kudos for you gonna Wilson so we got a
couple of really exciting or three
actually really exciting new features
going on Android wet was the end of the
year we've added a beat to beat API in
Android M what this allows you to do is
get the heart rate timestamps in
addition to the BPM and compute heart
rate variability which is a proxy for
stress levels for the user
second we're adding a profile API this
allows you to easily onboard your new
users by reading age gender height and
weight from the fit platform and finally
goals API allowing you not only to show
for example just the step count but also
the progress against that step goal
we're also active time distance and
calorie goals as well from Google fit
there's another exciting feature some of
you guys might have seen at the sandbox
already so when I go to the gym I
noticed that a lot of people are still
using an old-school pen and paper to
load their exercise their reps their
weight seems a bit crazy in 2016 well
google fit on android wear did count
reps for you for three specific
exercises
push-ups sit-ups and squats but only if
you told the app in advance what you
were doing this is still somewhat
limited and cumbersome now I've got
something better so I'm going to show
you a demo
well come on miles okay maybe give me a
break okay so I'm going to the Google
fit strength training section and I
haven't told it the exercise I'm about
to do come on he's working hard for you
guys as you can see it detected bicep
curls with 100% and counts at the reps
it was 15 pounds so I just love that
let's do another exercise one which
involves the legs note that I can take
some time just kind of setting up very
good form it's not
but he's down you can see he got
deadlift for rep is missed or an
exercise isn't correct for whatever
reason we will learn from that mistake
and become trained to the users exercise
motion we aim to seamlessly track whole
workout with minimal user input we're
planning an API towards the end of this
year and we're looking for partners all
right so that's our overview of the
google fit platform before we wrap up we
just want to thank all of our partners
who are already using the google fit
platform to inspire and motivate people
around the world to lead more healthy
and active lifestyles you know at the
end of the day this talk isn't really
about pending intents and broadcast
receivers it's about improving lives and
extending lifespans and so we really
hope that you'll be inspired to get out
there and build the next generation of
awesome amazing Fitness experiences on
Android so thanks so much for your time
and attention
feel free to contact us with any
questions thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>