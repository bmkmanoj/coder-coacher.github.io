<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CyanogenMod SDK (Big Android BBQ 2015) | Coder Coacher - Coaching Coders</title><meta content="CyanogenMod SDK (Big Android BBQ 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CyanogenMod SDK (Big Android BBQ 2015)</b></h2><h5 class="post__date">2015-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RLpDLIIVpRs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">for those that don't know here's a brief
old Wikipedia entry we're essentially a
derivative operating system based off of
Android we add other features but were
mostly free and open stores and we
support a hundred and sixty plus devices
versus like Nexus AOSP program which is
about five devices our contributor base
is massive as you can see the sit head
over here every single line in there is
a name of contributor over the past five
years in total we have about twelve
hundred fifty-three contributors that's
as of august with about 47,000 commits
that's not an AOSP so it's quite a large
Delta but essentially what we do is
crowdsource android development we get
community changes that are incoming we
rolled them into our nightly release
builds and those actually ship on
devices every single night today however
when we talking about how this Delta
grew a little too large and became a
little bit unmanageable first we were
you talking about our tree hags
hackathon learnings we went to a
Stanford hackathon we learned a lot of
things that we were a little bit
ignorant about we realized that OS and
framework development is really
intimidating there's a lot of work fewer
awards and essentially we came up with a
solution that can help us get through it
you
so hello hope us you me know all right
so a tree hex was a weekend-long
hackathon back in February and that was
at Stanford so there was like six
hundred and seventy kids who attended
and you can imagine there was some smart
guys there there's applications from all
over the United States so we had two
guys submit an entry using the signage
mop platform and you know we went there
and that's what we tried to do we I mean
we wanted to get people to hack on it
and so we had two entries here's the
winner sian translate and these guys
built like they went from sinking the
source to building it to adding a whole
new feature in three days and we learned
that that's that's very that's a lot to
do and a lot to kind of absorb in just a
short amount of time so these guys had
basically just one day they spent trying
to get the source we bought some hard
drives to make it go by faster but I
mean signage and my source is you know
twenty five gigabytes it's going to take
some time and then you know they spent
the next day kind of getting familiar
with it with the build system trying to
figure out the different quirks and I
mean they didn't have that much time
left to code they maybe they didn't need
it to be honest and that that said
something to us so overall I mean we had
a great time helping the kids getting it
set up but we noticed that most of the
time we we weren't helping them with
like very Android specific things that
we were there for we're helping them set
up with the build system and just you
know weird little quirks and things like
that so this is their project I hope it
plays
there
so what these guys did was they came up
with an honor fly translator they hooked
into cyanogenmod and they hooked up to
google translate and so they they work
sperm like the mms app and they're going
to show you how it works from the web
browser and they did this in like a span
of one day so next slide so we got a la
lot of feedback from these guys and it
was great um they love the open platform
they love that you know they could just
go and contribute to our Garrett and see
all the submissions and you know
everything is on github they can go sync
they can go look at the code do we even
have some you know documentation that
helped them get started but it wasn't
enough but some of the some of the
downsides that we saw was that I mean is
it took them way too long to get started
um and and that's something we took the
heart we want to fix this it's a huge
codebase that's 25 gigs of source then
you have another 50 when you're building
and then there's you know hundred plus
just you know packages you just have to
look at and this it's a ton of code and
the thing is this the barrier of entry
is just it doesn't have to be that high
and we really tried like we took this
feedback to heart and we went and we
asked her so we came up with these
questions on how do we improve this
experience we wanted to decrease the
barrier to entry to allow these kids to
not have to have all this tribal
knowledge of how the platform works to
submit a feature we wanted to help
streamline the process and formalize it
on how people contribute to us and also
we wanted to kind of stabilize our own
interfaces inside like if we wanted to
use our own features we could but you
know what if it kind of the versioning
is changed and what if we change
something on a device we shipped and our
code didn't you know we didn't have
these things figured out quite properly
so I mean this is the moral of story OS
development is intimidating I mean if if
you've ever managed to include a fully
functional interface you
one of the few people who understood the
process and from like a full spec stack
perspective and that's that's kind of a
hard thing to do so one of these biggest
features in cyanogenmod was the profiles
contribution so profiles was added by
Martin long in 2014 and profiles it you
could essentially register for specific
events in the system and then you could
configure your device to react to them
right so for example here's an example
of a user creating an action to be
triggered by an event so specifically
the event being a Wi-Fi SSID connect
event so from the Settings app the user
is setting up on the Wi-Fi connect of
their choice when the SSID connects they
hit the profile service the professor is
still the system hey when this wife
Esther said you connects send it back to
the profile system and profile will
trigger the actions back that the user
has selected so could may have have used
this profile system no not without weird
crafty java reflection which we try to
avoid as much as we can for the Android
compatibility documents they say that
any public method in the android
namespace that is not part of the public
android APK p excuse me must be marked
with the at haight annotation yeah so
the dreaded at hide add height
essentially is just a javadoc annotation
specific to Android build 10 the way it
works is any methods you don't want the
public API you annotate them with at
hide and then during pile they get
stripped from the method stubs from the
API subs you get stripped from the
javadocs and essentially it's only
accessible via a reflection during
runtime if you're creating interfaces
that way which is bad practice I guess
for us what implications that had for us
something like profiles if we wanted to
extend that to let's say applications we
were working in separate teams or with
someone externally we couldn't actually
do that because there would be no stable
interfaces I can tell you that hey
you know make this API call you'll get
this result back because we didn't have
any explosive burgeoning at that time it
also made Q a really horrible experience
because we couldn't set any testing
expectations based off versioning
releases and then honestly just horrible
rebased conflicts every single time a
new version of Android came out we'd
have to go and pretty much replay all
the commits that created the service and
everything that came on top of it just
became way too much so with that we kind
of sat down and said how do we get
around this so we came about with a
Santa mount platform so it's a new more
approachable infrastructure and the way
it works is we kind of duplicate the
android framework so we essentially have
three components here the platform
library a secondary resource package and
then it's statically linked OBO sdk the
platform library essentially you know
hosts all the system services that we
get spun up by the system server within
Android so pretty much anything that
does state management like the profile
service or anything that we need to rely
on being there and interacting with is
hosted and loads here but yeah we're
just leveraging androids powerful IPC
framework for that secondly that we also
have a resource package so if ever we
want to you know just even have like a
system label that we're going to reuse
across applications we now have a very
specific identifiers we can query those
resources with or drawables or anything
in between we can also declare our own
permissions that we carry on forward
without platform releases Oh yep but the
biggest point here is the platform SDK
so this is essentially you know Jar you
can just toss into your project these
are the stable interfaces that can
invoke the system binder calls and
you'll actually have access to these
features and this actually goes on a
rolling release schedule so we take this
new platform we go back to the
hackathons recently we actually did
another event that's done by idea it's
called code rush and then we went down
to Mountain View for hack the planet
which really smart kids there came up a
lot of cool projects and our feedback
was a lot different to sun
it's consumable you know ease of use
gets tossed around our bottlenecks ended
up just being logistics so we didn't
have enough cm devices there and we
didn't have an emulator images which
we're working on currently oh yeah one
such contribution we had from one of the
interfaces readded is we allowed the
user or the developer now to create
tiles programmatically and one team who
was creating a QR code application
essentially a Bitcoin wallet they said
it would be great if I didn't have to go
access my app and go all my account
settings and go find this QR code so
essentially they just publish their QR
code to a quick settings panel go in the
expanded mode and anyone can scan it so
it's things like this that we can allow
now Romans going to cover how to
actually utilize the SDK in your app so
utilizing it is that is actually I had a
good experience trying it the first time
after everything was in place like it
was is just as easy as I'd hoped so all
you need to do is fire up android studio
start up a new project and you're ready
to go you add so we have our version 2
point 0 is our stable release right now
the SDK and to compile against that
version you would include the compile or
exercise wrong platform you hit version
20 we are on a rolling release the next
version will be 3 so if you want to work
against our development branches we can
do you can set that up in your
build.gradle and now you can use the SDK
all you have to do is define the
dependency in your build.gradle and
maven will pull it down sink it and you
can hit our SDKs so I'm going to jump
right into the code here of how to add a
custom tile so this works very similarly
how you would post a notification so
when you think when you click a
notification and intent gets fired and
so the first thing we do is we need a
pending intent to wrap it and you can
see I'm creating a new intent there with
a custom action that I'll be listening
for later on and I can respond to then I
use the custom tile builder to create
the tile I give it
label the icon I tell it i want it to
collapse after i click it for my
specific use case and then the last
thing is i can just tell the same status
bar manager to go hey published this
tile i give it a unique identifier with
within my app and it will show up on the
other end responding to a click of the
tile you define that listener that in
the android manifest that listens to the
action which i defined in the intent in
the previous slide and then in the code
all it's doing is it just removes itself
you can come up with whatever you want
use your imagination there's so many
things you can do now i kind of want to
bring this back to the profiles so
cyanogenmod ships with three profiles by
default there's an automobile one a
default one and silent profile I usually
set my car up to automatically switch
the automobile one when it hooks up to
my car bluetooth but I kind of wanted it
to do something more like sometimes in
the car I want to you know I want an
icon to show up so I don't have to go
digging through all my apps like you
know maybe I want to open google maps or
something so to do that I added you can
listen for profile state changes and you
get sent this intent which is in our SDK
you listen for the profile selected
intent and then when i receive that i
know the profile has changed and i'm
going to act upon it and in the code
don't notice how similar this looks to
the other slide and i want i wanted it
to be just that simple so I'm all we do
is we check if the car profile is active
if it is then published my tech cart
custom shortcut tile if it's not then it
gets removed it's just as simple as that
but yeah I'm coming back to then how did
we deal with creating a versioning
system so we kind of decided a mirror
the entire build class from Android if
you're familiar of checking API levels
programmatically this is one to one from
that essentially what we're hearing is
in the SDK integer that's exported as
assistant property from the file system
in your current environment or
whatever device you're running on and
you can query against a you know hard
coded API level to see if it features
available so this way we can actually
check like hey are we running on a
signage of my device at all and if we're
running on a sand in my device is an API
level that's greater than when this was
introduced and that essentially allows
us to interact with like the profile
service they are currently we're on API
level 2 as their stable release which is
called boysenberry we have a lot of
features actually included in there and
we continuously add a lot more every
single quarter we will publish
documentation on this and currently we
also host full javadocs on github babe
contributing is still very much similar
to how it's always been the signage mud
and it's very core and fundamental to
how AOSP has worked you're essentially
repo in it the main manifest you pull it
down repo sync it and you start your
local changes you can never contribute
it back to us and we actually put this
in a little bit more scrutiny than we do
other code mostly because we want to
retain the compatibility mostly in terms
of cts for those unfamiliar CTS is a
certification testing suite that Google
has you run to make sure that you can
actually get GMS services and things
like that so we make sure that all those
interfaces are stable before we even
look at your code will actually ask you
to write unit tests will pretty much but
in have you put in all the legwork to
make sure they contribution is stable
then if it does get included in you
become part of the rolling release and
then at the end of the corridor usually
your future gets included we actually
had a guy from Portugal he was very big
into multi-sim at this time marshmallows
not released so he wanted to have
multisim api's so he probably wrote his
entire interface so this application can
talk to his own interface that he
created in that operating system and he
actually released his app on the Play
Store recently and he contribute that
for interface to us so yep
yep but for now I'm going to open up the
floor for questions if anyone's got some
dude one day we'll support what a rich
content so you know more the people in
its working on so on a staging branch
right now we have a pretty cool feature
essentially lets you render an external
processes or external process the
surface within the view container and
your hierarchy so lets you actually get
like rich continent if you wanted to
render like a map view from another app
or get that bound into your view our key
what's actually something we're actively
working on good so i have i put up some
samples for my code that i have it'll
actually run and it'll actually publish
your tile that you can play with here
the link is down there the bitly link
and the CMS DK it's got a wiki encourage
you to go there wiki api links it's got
great documentation yeah highly
encourage you guys to go check it out
thank you guys growing up thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>