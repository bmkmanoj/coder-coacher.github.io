<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>All about Messaging (Big Android BBQ 2015) | Coder Coacher - Coaching Coders</title><meta content="All about Messaging (Big Android BBQ 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>All about Messaging (Big Android BBQ 2015)</b></h2><h5 class="post__date">2015-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/StsyCuNGkTo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so first of all welcome to the big
Android BBQ this is my first big Android
BBQ how about you guys have you been
before are you guys so first-timers too
how is it so far you know it sounds like
it was fun right so and I'm looking
forward to the food later too sir my
name is Laurence Moroney I work for
Google as a developer advocate I
specialized in a technology called
Google Play services and my role is
generally speaking writing working with
developers around using Google Play
services and some of the related
technologies around Google Play services
in your application and one of the
related technologies is our Google Cloud
messaging and today I just wanted to
talk a lot talk a bit about messaging
talk about the type of things that you
can do a Google Cloud messaging and most
of the session I'm actually going to be
building a very simple Google Cloud
messaging based app on stage with you
guys and it's actually going to have a
live server where messages can be sent
to my phone and the URL will be exposed
and people tell me it's a mistake to do
that but I assume you're all going to
behave so so without further ado Google
Cloud messaging is what I said and I
always whenever I talk about messaging I
always like to begin with a story of
what messaging used to be like about 10
years ago I was working in Wall Street
as a as an enterprise architect
and there was one project that was given
to my company to deliver for a major
international bank and this project was
that they wanted to have instant
messaging chat style messaging for all
of their terminals they had 30,000
terminals and they wanted instant direct
messaging every terminal receives every
message within a certain time frame and
an average each terminal would issue
about a hundred messages a day so can
anybody do the math say for 30,000
terminals around the globe how many
messages would that be it's a lot right
so if you think about you've 30,000
terminals each issuing 100 messages and
each receiving a hundred messages from
each of 29,999 other terminals you're
talking about what was it was like nine
by ten to the nine number of messages
floating around in this
them every day that's a lot of messages
that's a lot of scale now of course when
we brought it to the customers who were
saying that they wanted to build a
system this way we're saying you can't
just flood your network with messages
like that you got to design your system
in particular ways you keep closely
related messages close to each other so
take for example this customer had
branches in Singapore in London and in
New York and we were saying well you
know 99% of the messages in Singapore
the people in London don't care about
them in 99 percent of the messages in
London the people in Singapore don't
care about them so we started carefully
designing the network for these messages
so that you wouldn't completely flood
your network with messages an order of
ten to the nine every single day and so
we ended up we spent about six months
designing what this thing would look
like and then we brought it back to the
company and we brought it to their ops
people and there are people to look at
it and said nope not gonna happen you
know because even with all the design
work that was put into this the amount
of infrastructure that would be
necessary to be able to handle something
like this was just obscenely expensive
for them to build it was way ahead of
its time it was pre cloud and it just
the project got canned and it ended up
being replaced by a bulletin board
system which effectively gave them the
same functionality where anybody could
go and take a look at a bulletin board
of the messages that have been posted by
anywhere anybody else sorry anybody else
anywhere else in the world and as a
result you know they got the same kind
of functionality but without that
instantaneous communication now when I
look at something like Google Cloud
messaging I'm not going to tell you that
you know you can quickly and easily and
cheaply scale to ten to the nine
messages every day but you don't have to
think about all this back-end
infrastructure and that's what Google
message Google Cloud messaging to me is
all about I like to look at it as a
black box and in that black box I can
send messages and that black box route
map routes messages to all of the
clients that are registered for my
application it does it for free it does
it instantly and it does with lots of
other types of functionality I can go
upstream messages downstream messages
peer-to-peer messages all that kind of
stuff and that I say it was free it is
actually free and because it's based
it's cloud technology it scales really
nicely so what we're going to do today
is going to take a little bit of a look
at
what an application built on Google
Cloud messaging looks like in action how
it will perform the type of performance
that you're getting for free the type of
scalability that you're getting for free
and we'll take a look at what does it
look like to build a simple application
in Android that uses this and then an
app server that also uses this built in
PHP in my sequel and hosted on a free
web host so as I mentioned what is
Google Cloud messaging well first of all
it's a hosted service Google hosts the
service on our infrastructure on your
behalf it manages the queuing and
delivery of your messages your messages
can be upstream to servers and may be
stored in servers like a bulletin board
style system that I mentioned they can
be downstream which is much more
interesting where your users can receive
instant notifications of messages in the
system or they can be peer-to-peer right
so my people in Singapore and my people
in New York in my earlier example could
communicate with each other over
something like Google Cloud messaging
you can target single devices with
messages or you can target groups of
devices with messages and what I'm gonna
build a little bit later on you'll see
where I have two devices number one is
the emulator on my machine and number
two is this phone beside me and I'll
show how I can target messages to either
of those or to both of those at the same
time
it supports topics so again thinking of
my bank example I could have a set of
topics that are relevant for Singapore
and a set of topics that are relevant
for London and people can subscribe to
what they're interested in and the
infrastructure this black box
infrastructure will handle the rest and
it's relatively easy to build first of
all that back-end infrastructure
nightmare is taken out of your hands and
while there's a few hoops you have to
jump through in order to for example get
things like an API key we're working on
making it easier and easier all the time
to do that all right so what does it
look like so this is what a basic system
will look like as we're building it so
the first thing is remember I've been
talking about GCM as a black box
so this GCM black box on the right is
something that your apps will register
with and when they register with Google
Cloud messaging using an API key that
you set up you'll get a token back that
identifies your app in the Google Cloud
messaging infrastructure so that black
box on the Left is provided by Google
you build nothing you call api's on that
you get your registration tokens back
from it
step2 then in a server-based system like
I'm talking about as you build your own
app server that then stores these
registration tokens in order to identify
the people who are using your app and in
order to be able to send messages to the
people who are using your app and that's
what I'm going to be building in PHP in
just a moment
so your apps will then pass registration
details that they have achieved from GCM
to your server where your server can
store them and you can store them with
whatever identifiers as you feel are
appropriate for your customers for your
clients within an enterprise that may be
different than if you're working with
the public and in step 3 if my slide
will cooperate there we go
so then step 3 is your app server in
this case we'll tell Google Cloud
messaging what to send in to whom it
calls API is in that black box and it
says send this message to the person
who's identified by this token or send
this message to everybody identified by
this token or send this message to this
topic and then people who subscribe to
that topic will receive it and then
Google Cloud messaging will deliver
those messages on your behalf for you
already so how do you build it the first
part of doing this is going to the
Google Cloud Cult or the Google
developers console and getting an API
key and a sender ID so your API key is
what identifies you as the it's a unique
thing for you as a developer on the
Google cloud console that will allow us
to understand who's using it how they're
using it there are no throttles there
are no rates or anything like that on
the system so it's not going to be used
to say you can only have this many
messages but it just allows us to
prevent people from being naughty by
maybe having you know trying to do a
denial of service using us using Google
Cloud messaging or something along those
lines and then the sender ID is
something that's unique to your
application so maybe you have multiple
applications that you're building and
that sender ID would like in my banking
scenario you might have one message
that's used by the buy side and sorry
one application that's used by the buy
side and another one that's used by the
sell side and you were different sender
IDs for these just so that you can
separate them there's two ways for doing
this you can go to Google Cloud console
and step through everything yourself or
there's this new thing that's only just
come out in a few last few days and it's
the URL at the bottom here it's a quick
start developers.google.com slash mobile
slash ad and there's a wizard on there
that will you register your application
get your API key get your sender key
turn on the api's for you to use and all
that good stuff
then step two is to build the Android
application itself so how do you build
the Android application well first of
all you need to use Google Play services
actually who's familiar with Google Play
services ok most of you cool so Google
Play services is it's a set of API so
that we ship that get updated roughly
every six weeks and it allows you to
access a lot of Google back-end services
things like location maps fit etc etc
and Google Cloud messaging API sarcasm
some permissions in your Android
application to allow Google Cloud
messaging to work typical things that
you need to turn on like internet access
that type of stuff in your manifest
you're gonna do two things you're gonna
add a receiver and you're gonna add a
service if this isn't clear don't worry
I have code in a moment that shows it
I'm I don't know if you're like me I
tend to think in code rather than in
slide wear but I just want to list the
things here so you're gonna need a
receiver and you're gonna need a service
and your manifest and then finally
you're gonna need a class in order to
receive messages in your app you're
gonna need a class that extends the GCM
listener service so earlier on I had
that black box sending messages down to
your application if your application
extends GCM listener service and your
application is registered with Google
Cloud messaging then that's the part of
your application that will receive those
messages and know what to do with them
so what does this code look like okay
first of all including Google Play
services in your app is as simple as
adding something to your Gradle file can
anybody spot the mistake in this slide
or spot something that's outdated in
this slide yep I'm using the plus rather
than a particular version number which
is naughty you're right and but there's
one other eighth one thank you I've
actually put seven eight in this slide
for a very specific reason and that is
if you try doing eight one with the
emulator right now it doesn't actually
work so well I downgraded my code to use
Google Play services seven eight
just so that I could use it in the
emulator here so well spotted both you
now secondly is just defining the
permissions that you need in your
application in order to for example
access the internet the wakelock
allows
a message coming in to be received by
your application so that it can generate
a notification and then this last one is
again it's it's the received permission
for Google so for Google almost like
Google Play services
it's the received permission for a
Google Cloud messaging next up you're
going to define a receiver in your
application and it's pretty
straightforward XML in your application
like this by the way if anybody wants
the source code for this app I'm happy
to share it my contact details will be
at the end of the presentation instead
of trying to scribble down code off a
slide and then finally you need the
service of course for your applications
this service you're just going to define
it you know my application was called
comm Google Debra L Maroney GCM Talk and
I put a class in there called my GCM
listener and I just had to set that up
as a service with an intent filter an
intent filter specifying that it's gonna
be receive and here's what the listener
class would look like so once we've set
up all the metadata that we need this is
what a listener class would look like
something that would receive messages on
your behalf it's pretty straightforward
it extends the GCM listener service and
it overrides on message received an on
message received you get two things than
one you get a string with the from and
that's the person that's sending you an
idea of what's sending you the message
it's usually the server and then you get
a bundle with the data and the bundle
with the data it's gonna be a JSON
message with a lot of details about the
data but the the actual message that I'm
sending through my server the text
message you know gets prefixed with an M
and that's why I have here string
message equals data don't get string N
and then out of that I'm just going to
generate a notification you can do
whatever you like of course when you
receive an incoming message you can
render it in one of your activities but
for this demo I'm just generating a
notification in a notification tray with
the actual message okay so let's take a
look at what this would look like in
Android studio okay well that's what the
application looks like with my beautiful
design and not known for my design
skills okay
so first of all I mentioned build out
Gradle so here if I go into them I build
up Gradle on my app you can just see
I've defined I'm using condo gold or
Android or GMS play services
I started this application just by doing
in Android studio a file new empty
activity application and I've added a
few things to it instead of going
through all those steps I'm boring you
here I'm just going to show you the
completed one so here I've just was
where I've added Play services 7.8 in my
Android manifest it's this font too big
or as 10 people at the back read it
because I know there's not a lot of code
visible on the screen I just made it
nice and big so again in my android
manifest I've set up the permissions
that I want to use so there's the users
permission you can see the three entries
here
then there's the receiver that I want
and it's gonna be a comm google android
GMS GCM GCM receiver and then under my
activity you will see the service and
that's it
so the three things that I had set up
the in the permissions the receiver and
the service are all added to your
Android manifest now in my main activity
let me show you what my main activity
would look like it's pretty boring so I
just wanted to create a very simple one
a couple of text boxes one way you enter
your name one way you're into your
emails or it's hard to see on here and
then a button that you used to register
this application with Google Cloud
messaging so if I go to my main activity
and in my main activity you'll see
there's a text box for a name or an edit
text field for name there's an edit text
field for the email and then there's a
button on that button what I'm going to
do is register the application with
Google Cloud messaging and that's done
in here where I'm just setting up I'm
doing it as a background task which is
why you see the asynchronous stuff there
and on Google Cloud messaging this
number here was the the sender ID that I
spoke about earlier on so I get my API
key which is associated with my Google
account and I get a sender ID which is
associated with my application so this
is the sender ID for this specific
application and I just get that back as
a reg ID and then the rest of it that's
the only thing that I'm doing to
register with Google Cloud messaging and
then the rest of this is now posting to
my back-end server you can see here on
the client I post
I just went to one of these free web
hosting companies that will give you PHP
and my sequel and they gave me this URL
GCM talks 840 net I put a PHP file on
there which I'll be showing in a few
moments and I'm just posting the name
that the user has entered the email that
the user has entered and the
registration ID that the user has
entered sorry that the registration ID
that the users gotten back from GCM and
then I'm posting that up to my server so
my server will get that registration ID
so then whenever I want to try and send
messages to any of my clients it has
that registration ID and it will send it
down to the client that I'm executing
here clear okay so you know if I'm going
too fast or if there's any confusing
just feel free to interrupt we're all
very informal here just yell out if you
have any questions and that's pretty
much it for registering my application
with Google Cloud messaging in order for
my server to be able to send messages
via Google Cloud messaging to my
application and in a quick look at the
listener
earlier I mentioned and I show down in a
slide it's just something that extends
GCM listener service and then I override
the on message receives method in that
and there I'm getting my from and
getting my bundle of data I'm taking a
message out of that as a string and I'm
sending a notification and then this
code here if you've ever built a
notification in Android will look very
familiar
I'm just using a notification compat
builder this you know this send
notification is nothing to do with
Google Cloud messaging this is just
taking that string that was received
from the Google Cloud messaging server
and turning it into a notification it's
straightforward it's pretty standard
code all right so when I run this I will
get something that looks like this all
right so it's the two text fields that I
mentioned that I'm going to enter you
know I can put whatever I want in there
and I read and it was a name and an
email so I'm just saying my name is
phone demo name the email was hello at
room and there was a register button now
I had done this earlier so I will show
you what the server looks like so who's
familiar with my who's familiar with PHP
here first of all okay
and then you've probably heard of a tool
called my PHP admin all right so my PHP
admin is a tool that's a web-based tool
that allows you to inspect and play with
and my sequel back-end database so I
know the font is really small here in my
browser but what is that what I had done
here was I earlier just while you guys
were in the keynote I ran this
application in the emulator around this
application on my phone and I did I hit
that register button in order to
generate its open and register it and as
a result I got these two records in my
database and you can see the GCM Reggie
ID is that that long string is the
actual token and that's the unique
identifier for the device that's running
the cloud messaging sorry for the device
that's running the app that will consume
the cloud messaging but what I'm going
to do now just to show that this is
reals I'm going to delete them so I'll
come in here and in PHP admin I can
delete them and that'll take a moment
alright so now I have nothing registered
and if I go back to my site and I'll
talk about how to build a site like this
in a moment we should see after a
refresh okay there are no devices
registered yet so now if I come in to
Miami
and I'll just say hello workroom again
something like that so we see it's
something different
I'll hit register it's a really poorly
designed application I don't have a you
know spinning status or anything like
that in the register so it'll take a
moment to register I'll come back and
I'll refresh the site and we should see
in a moment like I said this is a free
public site hopefully my Wi-Fi is
working and he hasn't registered ah I'll
try and I'll try and rerun it again in a
moment just let that refresh everybody's
hitting Wi-Fi at the same time so it's
still waiting nope okay isn't it always
like that when you try to run a demo
live on stage that never works you run
it beforehand while I ran it beforehand
while all you guys are in the keynote
and they work great and they're running
now and if they move so that's another
try call it something like that let me
register
and refresh prey to the demo gods pray
to the Wi-Fi gods and nothing's
happening I'll come back to that in a
moment
alrighty so we can talk a little bit
about the app server and then I'll see
if the demo is behaving after that so
earlier we saw this was how I built the
Android app which isn't working right
now but how I built the Android app was
just very straightforward it was a
single activity there were a couple of
text fields there was a register button
on that when I registered I called GCMs
black box in order to get that
registration token back I had a couple
of them that which I deleted before the
demo fail and those registration tokens
would then be captured by my back-end
server and stored by my back-end server
and then used by my back-end server if I
want to talk to individual devices or I
could take all of them if I want to talk
to all of my devices so how do we build
an app server what does this thing look
like well first of all there's a
database in it and I gave a sneak peek
of that a moment ago on us using the my
PHP admin so in this case very simple my
sequel back-end database it's storing
the registration tokens and it's storing
just the name and ID that I had I have a
UI for sending messages you saw that
basic UI is just a simple HTML UI and
then there's the interface to Google
Cloud messaging itself that requests the
messages to be routed either to one
device or multiple devices based on
those registration IDs that had come out
of the devices and this is were like
pretty much what it would look like in
this this application that I was showing
a moment ago would look like this so my
Android would call register dot PHP pass
it the three things the name the the
email address and the registration token
and register dot PHP would then just
store them in the database then the user
interface for this what I was using in
my browser I'm just calling index dot
PHP and what index that PHP was doing
was do query of everybody in the
database get their registration tokens
and just generate that UI that will
allow me to send to individual ones or
will allow me to send them all in one
shot and then ultimately and then the
main part was the GCM send our PHP and
this file what it does is just using
curl to talk to the Google Cloud
messaging back-end picking the IDS that
it wants to based on the tokens
wants to send the messages to sticking
them into headers taking the string of
the message passing that's a Google
Cloud messaging and then fire-and-forget
it's done at that point the messages
would be routed back to my two made
various devices so here's a quick
example of this is where the
registration would look like so if
you've ever seen PHP this is PHP zero
zero one right it's I'm taking a look at
the posts for the name I'm taking up the
post of the email and I'm taking a look
at the post for the register ID I'm
taking them and I'm using a just my
sequel query to store them in the
database I have a couple of things here
that DB functions and it which is just a
class that wraps the the my sequel what
they call the my sequel admin stuff so
that I can actually just call DB store
user and pass those parameters to and
they in a in an insert query will be
generated for me that will push them
into the database sending messages with
curl this is how easy it is first of all
the URL is android google api is calm /
GCM /sand on that i passed a couple of
headers the first of these is my API key
if you remember way back at the
beginning I was saying you use the
Google developers console with the
wizard that was at that URL and that
will give you the sender ID and your API
key this is your API key you put it in
the authorization header and the content
type then I'm gonna post to this is JSON
that also goes in the header and then
finally the how I send the data to it I
have a string that I call data which you
can see here towards the bottom so I
have a data field and I put that string
into that and then I have an array of
registration IDs so if I'm picking one
registration ID one based on its token
to Center just to target one device I'd
put one in there if I want to send it to
everybody I just send it to everybody in
there and then I just curl it out so
there's a you know set the headers set
the URL tell it that I'm posting it
encoding in JSON and then called Karl
exec to actually just do the curl and
send the message so very very
straightforward very much 101 type PHP
and it's just about getting those
registration IDs and if you know what
those registration IDs are that you want
to send to and GCM provides them for you
you stick them into the array you
encoded in JSON and then you Carly
like that alrighty so let's look at the
code for the app server and then I'll
come back and try and get the demo to
work
oops my power saver kicked in
all righty anybody familiar with coda
anybody use coda it's a great editor I
love it so I'm just showing the code
here in coda let me see if I can make
the font a little bigger
all right does that look clearer all
right cool
so again the files that I have in this
if I just take a look at a few of them
so first of all for registering I got
caught on my scroll there where they're
a little bit let me see if I can get rid
of that corruption no weird okay so
again for registering PHP 101 I'm taking
a look at the post and pulling in the
data from the post and then I'm storing
the user in the database using these
database functions that I created and we
can see what they look like you know to
store a user I'm sure you're all
familiar with an insert query okay I'm
not doing any kind of sensible
programming here by doing a parameter
validation or anything like that I'm
sure you could issue a denial of service
attack on this because I'm not you know
filtering my parameters but you know
you'll you'll forgive me for that
hopefully because this is just a rough
demo but again it's just it's my sequel
query I'm inserting into this GCM users
table the name the email and the
registration ID for that user and then
if I ever want to get them back it's
just the same kind of thing in my sequel
query to get them out the user interface
for for the for the app itself is
indexed up PHP if I come down to the
index that PHP for seconds and you'll
just see I'm querying that database so
yeah I'm just clearing my database I
have a DB do get all users and then I'm
going to loop through and just generate
HTML forms one for each user and then
one for all of these users and then
those HTML forms as we can see here
they're gonna when I submit them they're
just gonna call the send PHP that I
spoke about earlier on where I put the
message into it and I put the list of
all the registration IDs that I want to
have in there in it and if I go back to
my browser for a second what that looks
like was this one so let's see if that
user got registered yet no oh there it
is okay so it finally came up so that
when I was running on my emulator you
see now this box that appeared was for
that user if I I'll rerun it on my phone
in a moment so we can see what it would
look like but
now I have one user in the database so I
have one GCM token in the database which
is for this user and if I type a message
in here say like hello room and send it
hopefully it'll show up in the emulator
there it goes and you see the
notification just appeared in the
emulator and when I drag it down we can
see that you see a message hello room so
if anybody wants to send a message to me
keep it clean
you can actually see the URL there this
is running like this app server is
running live on the Internet and like
right now I also have here just say you
know please keep it clean on this one
and this is just the center all
registered devices and I don't if you
can actually hear it and there's the
message actually appearing and you can
see how quick that was as soon as I had
typed it and that's going to my emulator
right so the emulator is receiving that
message from GCM and actually rendering
it in there okay
so any questions on the PHP part is it
clear clear as mud all right so that's
what a very very simple app server would
look like this really there's several
things that it needs to do first of all
you need to camp and it just I heard the
sounds did somebody just send something
I just heard the sound of a notification
yep we got a smiley face up there
so there's several things that it needs
to do so first of all when your Android
application has I need to turn off my
sound messages are all popping in there
and it's like so when your Android
application registers with Google Cloud
messaging you will get a token you need
to if from Google Cloud messaging
doesn't have any intelligence about
sending the messages for you it's just a
black box and you call that black box
and tell it to send messages to devices
on your behalf that token is the
identifier for it so when your app
server you need to store that token now
there's many there's a million different
ways you could have done it I just
decided to use this free public PHP
server to do it store the token in my
sequel database you could add a lot more
intelligence to that you get
for example people from Singapore have a
column in the database to identify that
from Singapore and people from London if
you came in late I was talking about an
example of an application that ran in
Singapore in New York and London that's
why I'm picking those two and there's
like it's obviously it's up to you how
you would build it it's up to you how
you would design it it's up to you how
you would filter out your messages and
how you would have users work in peer
groups or whatever but don't forget
there's also the concept of topics and
Google Cloud messaging which I'll talk
about in a moment but that's the most
important thing is that your application
server needs to be able to send the
messages or needs to be able to tell
Google Cloud messaging to send the
messages and as a result you need to
track the users tokens so my
demonstration that was just to take them
and stick them into a my sequel PHP and
then your application server the other
thing that it has to do is then just
simply call the Google Cloud messaging
API is pass it's if you're using the the
the HTTP POST methodology you pass it a
JSON encoded string that has the list of
the registration IDs plus the message
that you want to send and then it
handles the rest and it does it pretty
quickly as you saw is it safe to look at
the other messages you guys have sent
how does this work on iOS oh that's a
great we should actually have this other
way for doing questions it does work on
iOS we don't have Google Play services
but there are a set of GCM libraries for
iOS I don't know that much about them to
be honest but GCM works across we have a
web client for it so you can actually
send messages to you know HTML
Javascript based sites there is an iOS
client for it there are a number of
libraries that you can use in iOS then
not in Google Play services and then of
course on Android this Google Play
service another question over here
I'm sorry
yeah
right that's a lot of good questions
there so first of all it's like it's not
always on it's on when your application
is running if your application is built
for using GCM that wakelock permission
that I spoke about earlier on is the key
to it so the idea behind that is that
like that's what you know you're giving
your app permission to wake the phone up
on an incoming message I don't know the
specifics about how much battery it's
using but one of the things is that
we've actually built this to optimize
for battery use in these connected
messaging scenarios so you're always
listening for messages but it's
extremely low battery usage I don't have
the stats on how much it is but that's
one of the core tenets of how we've
actually built it was to keep the
battery usage as low as possible just to
repeat the question sorry for the folks
who didn't hear it it was you know if
Google Cloud messaging if an app builds
using it is always connected in order to
listen to messages what's the impact
going to be on the battery and is there
any way to turn it off right
right so you can build your app to sniff
for when a connection fails and then you
would generate a notification to your
user if that happened so yes and if you
are actually disconnected for a period
of time like you go off the grid when
you come back on the grid GCM actually
has your messages for you and we'll we
send them to you the messages don't get
lost yes something like that yeah
ready so just moving on so step four is
just enjoy the awesomeness as I like to
call it so as you saw her there I ran it
in the emulator I can also run it on my
phone it's registering and sending
messages to any or all devices right
it's totally free of charge we don't
charge anything and answering your
question earlier there is a guaranteed
message delivery so that if you do get
disconnected the messages will actually
be resent for you next steps upstream
messages are also possible so you know
in this case I had a server that I had
built that was sending a message down to
my device but I can also send from my
device up to the server and have that
route my message to other devices so I
could have liked that type of I can
either have upstream messages for
something like a bulletin board or
upstream messages to have them routed so
I can do a peer-to-peer type thing this
topic so that you don't get flooded with
too many messages you can actually
subscribe or send to particular topics
so again using my scenario of the the
bank that I was talking about with
Singapore London and New York branches
you know the the buy side and the sell
side in each of these could have a topic
and as a result not everybody reads
every message if I'm only interested in
the buy-side and Singapore then I could
just receive messages for the back side
in Singapore that type of thing
priorities there are messages priorities
too so that you can set different levels
of priority of a message that's
something that's actually evolving in
Google Play services so watch out for
with some new stuff coming in Google
Play services very very soon and there's
some changes in priorities there but
just in managing priorities so you can
have like high level messages and low
level messages so that if you've built
an application that for example receives
messages as notifications like the one
that I built here further you don't get
keep getting pinged by notifications you
can change priority of messages may be
some generated notification may be some
get routed to an intent for later
viewing to learn more we have this sites
it's developers.google.com slash Cloud
messaging slash GCM there's also this
new thing I think it has been released
by now if not it's releasing imminently
called the GCM playground the guys told
me I could talk about it today so it's
alright so it's if you go to github.com
slash google samples the GCM playground
and they have a similar type of
application to what I've built here
except they've built it and go
because they thought go is much nicer
than PHP no flame worse place and
there's also some great dev bytes out
there so dev bytes if you're familiar
with Google developers these short
videos that we produce three to five
minutes long just talking about a
technology and there's one great one
here from my colleague Eric I don't know
why they put the about the speaker slide
at the end of the deck I don't know that
was a template so about the speaker
that's I mentioned I'm developer
advocate at Google I've authored like
about 20 programming books and I've
changed into writing children's novels
now this is my latest one it's it's the
cover reveal was just yesterday so as
I'm so happy that I was able to put it
into my slides and it's coming out next
month and I'm the host at Google of a
show called coffee with the Google or
anybody watch it thank you you know and
by the way if you have any requests for
people for me to talk to a coffee with a
Googler please let me know and contact
details so on twitter at Elle Maroney on
plus and plus Laurence Moroney and
facebook.com Laurence Moroney and if you
want to email me it's the same al
Maroney at google.com and so we have a
few minutes if anybody has any questions
around what sorry ok
whoo so the question for everybody else
was that in the past have been issues
around token and validations so do we
need to you know double check our tokens
to see I'm not familiar with any token
and validation problems first of all but
I would argue that it's always a good
idea to double check and so we have this
new instance ID API which is part of
Google Cloud messaging and I believe you
can use that to check your token so
maybe you know every few days or
something like that of running an
application excuse me that you could
just do a recheck and validate your
token it would be a good idea so over
here again is there a round-trip
facility where a server can receive
I'm sorry it's hard to
yep
good question I've never tried it so I
don't know I'm only gonna guess my
recommend them up through the regular
channel so that way you get the
guaranteed delivery if you have that
open connection I have no idea what's on
the other end and how it would respond
to it I would always just recommend you
know go by the go through door number
one but I don't know for sure over here
okay so the question is when I got the
registration token for a device is a
device specific I have a funny story
about that question because I knew
somebody was going to ask it today so I
decided to go and look up the code that
I had used in my demo just just check
that for sure and it turned out I was
using deprecated code and so it's like
then it was like 20 minutes before my
talk and so it's like we are we made a
note upstairs that we're saying before
you do a talk make sure you don't do
deprecated code so anyway but I'd see
her question if you're using the
instance ID api's you can have a single
registration token across multiple
devices so that if you receive a
notification on one of your devices you
want to receive it on all of them right
rather than you know it being routed to
multiple ones as then being identified
differently it can be so if you can have
it so that you have a registration token
that's unique pair device or you can
have a registration token that's shared
across ones based on your Google ID all
right in the back here
what communications protocol does GCM
use so what when you're coming
downstream from GCM to the server I
actually don't know I've never looked at
it if I'm going upstream from my app
server to GCM it's just an HTTP POST
so if you've built an application for
Android TV how do you receive the
notification I believe it's just the
same it's you extend the same class the
service is not available can you know
can I get your details and I'll check in
on that when I've I've never tried it so
I don't really know time for maybe two
more questions in the front here what
are the word sorry payload size for
messages oh boy
yeah it's it's on the site sigh what was
it 256 kilobytes okay thank you all
right well thank you everybody and enjoy
the rest of your Android BBQ</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>