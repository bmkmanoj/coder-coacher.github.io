<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Adapting to Latency (Android Performance Patterns Season 4 ep4) | Coder Coacher - Coaching Coders</title><meta content="Adapting to Latency (Android Performance Patterns Season 4 ep4) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Adapting to Latency (Android Performance Patterns Season 4 ep4)</b></h2><h5 class="post__date">2015-11-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uzboHWX3Kvc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">one of the most frequent performance
problems your users will notice is how
your app reacts when moving from a great
network connection to a bad one my name
is Colt McAnlis and if your app isn't
properly adapting to network latency
during the day your users will blame
your app rather than their connection
the truth is that the Internet is made
of a bunch of crazy moving parts or a
series of tubes if you're a senator
anyhow basically requests made from your
phone have to hit a local cell tower
which then gets routed to the service
provider server and then it may hit a
local data proxy for that provider
before going out onto the Internet and
connecting the main data server which
then needs to decode the response fetch
the data and then send that back only to
return the data back to your caches ISP
server and then finally to the phone
itself basically it's a lot of moving
parts and a bottleneck can be anywhere
and since you don't control all those
stages the best you can do is make sure
that your application properly adjust to
how it works based on the connectivity
of device this involves two things
number one getting information about the
speed and performance of the network and
number two designing your app to respond
to changes in bad latency environments
now the first is easier to do than you
might think simply grab the connection
manager and determine if you're on a
mobile network from there a quick call
to grab the network subtype gives you an
enumeration for what type of network
you're connected to a handy lookup table
then lets you know what kind of network
you're dealing with and what to expect
as the best possible bandwidth and
latency but in truth that value gives
you the best case scenario see in the
wild you're gonna get much worse results
even though your user might be on an LTE
network there may be a problem with a
slow data server resulting in maybe
double the time it would normally take
on that network for that request so a
more accurate although more complex
solution is to evaluate the time it
takes to grab responses from your
network for example if you know that all
of your thumbnails in your ListView are
128 by 128 pixels then you have a
general sense that should be about 1k
inside which should on the given network
only take a certain amount of time to
download you can then average the true
cost of these fetches over time to give
you a better sense of what the real
where conditions are and how they are
changing as the user moves through their
day once you get this information you
then need to decide how to design your
app to handle it as a simple approach
you can define two thresholds and three
buckets of classification if your
latency is less than say a lower
threshold of 60 milliseconds to fetch an
asset then your user is on a great
connection you may be able to be more
aggressive about the amount of data that
you prefetch and less of aggressive
about things like caching however if it
takes less than the upper threshold then
you may not be in the best spot so you
need to become more aggressive about
batching and caching and take advantage
of how often you request data and if
they're above the max threshold well
then you should find ways to defer a
request until later when there might be
a better network connection or change
the UI so that not fetching all the
thumbnail images isn't such a huge
jarring problem but the truth is that
these thresholds won't work for every
user in fact you're going to need to put
a bit of elbow grease in and define the
correct thresholds for the 50th
percentile 90th percentile and 99th
percentile of the connections that your
users are actually on which is actually
a pretty large engineering project but
critically important for your app to
remain responsive and magical in high
latency environments now rather than
waiting for the users to focus on slow
connections to complain it's better to
start designing and testing bad
bandwidth on your app early you can test
how high latency impacts your
applications by throttling the bandwidth
when you're running the Android emulator
or you can check out third-party apps
like a TTS network attenuator in both
cases you can see how your app responds
when latency goes sky-high
which you should be doing with
everything honestly testing performance
on the slowest Hardware worst networks
and most insane conditions is the best
way to ensure stable consistent
performance for your users of course
you'll need to watch the rest of our
Android performance patterns videos to
see what to fix and join our Google+
community to get advice from other
developers in the same boat trust me
your users will thank you so keep calm
profile your code and always remember
perf matters</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>