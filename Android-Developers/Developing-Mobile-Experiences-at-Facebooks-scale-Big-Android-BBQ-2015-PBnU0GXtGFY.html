<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing Mobile Experiences at Facebook's scale (Big Android BBQ 2015) | Coder Coacher - Coaching Coders</title><meta content="Developing Mobile Experiences at Facebook's scale (Big Android BBQ 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing Mobile Experiences at Facebook's scale (Big Android BBQ 2015)</b></h2><h5 class="post__date">2015-10-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PBnU0GXtGFY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I've been doing Android for about four
years so I'll tell you a little bit
about the story of how Facebook as a
company transition from having a small
mobile team to a company that focuses on
mobile as a first priority so let me
start with a story here back around
2010-2011 like Facebook had a very very
small mobile team for some context if
you guys don't know about this Facebook
started in 2004 it started as a web
application and then with transition
with large number of devices appearing
in the market and mobile being a very
important thing
Facebook started a mobile team around
2010-2011 which is when when I joined
Facebook we still had a mobile team and
we realized well it doesn't really make
much sense on how to scale our app if we
have a mobile team and the rest of the
company is focusing on our desktop
application we had a product developer
of prog developers product managers and
product designers each for each feature
in our inner in our website focusing
only on the dub dub and we had a I mean
a team that had probably like a dozen of
developers focusing on everything on
mobile well so what do we do we realized
that this was not going to scale and we
started building a bunch of this
experiences on mobile and as we finished
building them we transition the
ownership to each of the product teams
we continue doing so and as of today we
do not know we no longer have mobile
teams so if you guys come and ask us hey
what's the size of your mobile team at
Facebook we just say the whole company
is focusing on mobile and we really want
to emphasize this so what happens here
when we transition our company into
focusing fully on mobile
we're injecting hundreds of developers
into each of our mobile code business
now
a lot of interesting challenges that
arise from this so I'll tell you a
couple stories around this so that's on
the context of our our engineering or
engineering or engineering science and
culture but let's look at it from the
other point of view our users as of
today we have 1.3 billion mobile monthly
actives and they are using rap all over
the world use in under different Network
conditions you guys know about the
Android fragmentation problem it's a
benefit but also it's an interesting
challenge that means that there are lots
of people in the world that our Cape are
able to have internet connected devices
now and because of this we're building
the applicator haven't we're in a really
really good position where we're both
building the application that allows
them to connect to with the world and
the friends and family so this is a
graph of the projector the projection of
Internet connected devices in the next
couple years it's made by this
third-party company called ABC and they
are here I'm separating in the yellow
section they're developed markets and
the blue ones emerging markets now
that's sharp sharp red book the sharp
graph indicates that in the next couple
of years we will have a ton of users
coming injected into the Android
ecosystem and they're not gonna have
phones like the ones we have in our
pockets they're gonna have phones that
we're probably have have them the
hardware set that back in probably like
three years ago where the newest phone
so we have so we have a lot of
interesting engineering challenges to
handle here and because of this we need
as many developers in facebook to be
tackling this not just a mobile team
obviously so today I'm gonna tell you
about broadly mobile at Facebook where
and I could keep talking over and over
for hours about this I've picked a
couple selective topics here first
I guess the context is we have 1.3
billion mobile monthly act
and this number is growing every single
day what do we do about this how to
handle where the interesting problems
that arise we also want to make sure
that we ship really really fast just
because we have a ton of devices and a
ton of users doesn't does not mean that
we should be slowing ourselves down
worship I'm a PK every week now so many
of you guys as you guys are Android
developers here you'll realize it's
actually really really tough to do this
in addition to that we have a ton of
features in one single app we have a ton
of developers we have our app our app is
feature packed how do we do it so that I
would do this in a very reliable manner
an Android native clients in particular
we have a very low tolerance for error
we're dealing with state memory
networking a lot of these things that
are very very tricky to deal with in a
very very constrained environment and
once we actually ship something out we
can't we can't assume that with the next
release no one will be seeing this
version we have a very low tolerance for
error so I'm gonna tell you a couple
stories about how Facebook handle a
bunch of these problems while scaling in
in size and speed so two ways first I'm
going to talk about coding at scale and
the second part is how we release to the
world in a very fast and speedy and
reliable manner so let's talk about
let's talk about coding at scale so I
guess like story time around 2011 when I
started at Facebook this was also quite
simply at a time when we were
transitioning from having just some
small small core mobile teams and having
them having the whole company jump in
and do Android and iOS development okay
so was it as easy as it sounds obviously
not it was actually really scary I
remember almost like in my mind almost
overnight the codebase had transitioned
from probably a dozen engineers to
hundreds like probably a hundred
engineers I'm probably overreacting it
was probably like so many but still a
lot so how did this affect my life
you could never build everything was
crashing when you thought your feature
when you finish writing your code
nothing worked so obviously we realized
developer efficiency was gonna be
affected by having a lot of people
writing writing a lot of code so we
realized that we had to make some
infrastructure changes and cultural
changes for this to work out
you can't just transition from having 12
engineers to a hundred in one day and
not expect hiccups here so we realized
well first we need to create an
environment that enforces testing and
also makes it easy to to read more tests
just to avoid brittle code and the
second part is we need to break
dependencies amongst the different teams
what does that mean if I'm working on
news feed and something on the photo
upload flow breaks I should or is using
a lot of memory then me me as a news
feed engineer I should not be blocked by
that and I should be able to build my
code and you should be able to deploy it
okay so what do we do so we started
using dependency injection so many of
you guys are familiar with this for but
for those who are not dependency
injection is a design pattern for
externally setting object dependencies
and separating the creation versus the
behavior what this does naturally is
that it encourages modularity modularity
and testability now you guys are
probably familiar with dependency jiton
frameworks like data references and
Guice back in 2011 dagger was now
available as an open source framework
and Guice was giving us performance
problems so we developed our own
internal one but the inspiration and the
same principles are still applied now
let me give an example for those who are
not familiar with this the idea is let's
say I'm creating a method that fetches
data for my news feed let's call it news
feed fetcher and it requires a lot of
different objects say something an HTTP
request helper so that you can fetch
something some sort of JSON parser and
some sort of image downloader all of
this are modular classes that perform
separate objectives so one way to
construct this dependencies
the knife manner is just within your
constructor or within your main method
and within your class initialize them
call new HTTP request helper new parser
downloader etc are you so what happens
here so the problem in that case is that
we you have to be like you tangle a lot
of the dependency creation together with
the objects and it's really really hard
to test it so with dependency injection
the idea is that rather than creating
your dependencies
you're gonna assume that they get passed
to you by some god-like injector class
or just get passed to you by the
constructor and you got this and inject
annotation what this add inject
annotation does is it goes through all
of the methods that were annotated like
this and creates an injector global
object a singleton that when we're
asking for a particular object fetching
sweet method will pass all of these
objects during instantiation time and it
will also if you you want just one
instance of it it will hold that
instance and we won't recreate it what
is the nice thing about this if you're
writing tests you can pass fake versions
of it
you keep a very clean interface and the
other part is that you can build your
own module and then connect it to the
other ones as part of the final version
when deploying and compiling the app so
this encourages testability code
modularity and also helps of scalar a
code base now and this is obviously
really really important when you have
tons of developers writing code at the
same time so what is one of the problems
here is performance let me illustrate
why performance is a problem it lies on
the area of dependency resolution so at
runtime because you don't really know
who are the objects that you're gonna be
depending on we realize okay you hook
the news feed fetcher to this HTTP
request helper this parser in this
downloader it's not until you initialize
the app during coaster that you are
doing all of this stuff
this takes us to a different problem in
order to have all this flexibility our
coaster time is just going through the
roof so what do we do here
so we're gonna actually switch all of
this to compile time but if we
hard-coded everything we will go back
into the old method where everything
feels wired and like static and we
wouldn't be able to write tests in an
easy manner so one of the engineers a
facebook I thought okay
instead we should look at the Java
bytecode and modify it at compile time
to substitute the creators of this
providers into static methods and
actually wire them to the final versions
and when you're doing tests you still
get the flexibility and we at the end of
the day we reduce startup time by 20%
and you do all these operations at
compile time which happen offline okay
so that's just one example of how we
actually broke down a lot of our
development process what type of
structure that we actually put in place
so that we could move really fast in an
independent manner here's another
example of here's an example of the dip
that we send up for review a lot of the
internal details are blurred here for
confidentiality purposes but what I want
you to pay attention to is kind of like
the green and red blocks here every time
we send out a different view we run a
lot of tests both unit and to end and
screenshot tests this help us prevent
brittle code and if we create the right
framework for the different teams to
start being able to write code we will
be able to identify a bunch of these
failures before we even land the code so
that our trunk is like it's in a
healthcare manner
so the other part another like another
trick that we found that that was very
very useful when scaling our mobile or
organization is identifying common api's
let me talk tell you one example of a
case study so if you're working on a
feature at Facebook
there's chances that you'll be needing
to download some data from the from the
from the cloud cache it somehow locally
and show it in some sort of UI ok so
this obviously involves writing some
sort of code and well the reality is
that we have a lot of features and a lot
of engineers and each of them writes
their own version now why can't this
that abstract well you may be wondering
why can't this be abstracted into a
common library well let's think about
the case of say fetching your newsfeed
versus fetching photos fetching events
at Sarah this the structure of your of
your of your query changes drastically
depending on what you're trying to do so
there is some sort of custom code that
has to be written so you can't just you
can call a general HTTP library but you
still have to construct the parameters
that you are asking like they they pay a
call with the parameters that you want
okay so this happened across the board
and at some point one of our engineers
decided hey this underlying API method
call
I'd like to optimize it but then he
realized oh in order to make an
optimization to the fetching mechanism
you have to change every single line of
code in many many different products and
when you do that it doesn't come for
free this is not that simple you could
be breaking some other product code and
people get pissed and it's actually
really really tedious so one of the
ideas that we came up with is instead
write a small snippet of what you're
trying to in a small snippet of a text
file specify what you're gonna try to
download from the server and have a
library order generate the actual API
method calls from that template version
what this does
this allows for making changes in the
particular underlying architecture to be
much easier and not affect that much of
the like product internals so then your
nears the work on this type of
optimizations and developer ap is a
Facebook are called product
infrastructure engineers and their
objective is to make it easier for
product teams to develop faster so I
guess that's kind of like my high-level
overview of how Facebook as an
organization has scaled from having a
small group of engineers working on
mobile to the whole company touching it
now I'm going to switch gears and talk a
little bit about how we release our app
into the world so if you guys were at
the talk yesterday on emerging markets
for Facebook we talked about how we have
over 10,000 different Android devices
out there over 10,000 different devices
are running Facebook which is kind of
scary we need to make sure that our app
works in all of these cases and it's not
creating a terrible experience so how do
we do that well with we have a ton of
different layers of support here the
first one is employee dogfooding let's
say I'm building my particular feature
and I'm pretty sure that it works but I
don't know there's 10,000 different
devices there's a lot of different
connections connectivity types and to be
honest a lot of different use cases so
we trust we rely on our employee
dogfooding program we have thousands of
Engineers of Facebook and we really
encourage a lot of them to use Android
and we have this rich shake feature
support again if you provide the right
tools for people to report a lot of this
information it makes it easier so if you
find something that doesn't feel right
or an experience that is really
bothering you you rich you reach in your
phone and then you get to write an
employee report so it
enough well the answer is no so we take
advantage of the alpha the Google place
alpha beta channels we have over a
hundred thousand of users and we have a
little over a million beta testers right
now so we release our app into alpha
every day new version of master into
that and every every couple days into
beta this allows us to turn on our
features early so if you guys are
interested in staying up to date with
the newest Facebook features we turn
them on much more often in the alpha
beta channels and we turn them down in
production so check out these channels
by looking at this we're able to
identify crash rates mostly and see some
of our obvious booting problems now this
is not perfect because most of the users
in the alpha beta channels have really
really high end phones most of the
phones are Nexus phones so it's a little
skew towards a very tech oriented
audience nonetheless that is very
helpful well so everything passes here
everything looks good we're released to
a small percentage of the world now I
mentioned this is a release like we have
multiple releases of different products
all the time but we're very very careful
sometimes if we're looking at product
changes that affect a lot of users and
are pretty obvious we run tests in
countries in particular to see what are
the longer-term network effects there
and sometimes if it's something smaller
we will run on 1% tests look at
engagement metrics and keep rolling to a
larger audience that way but is this
enough the answer is no let me tell you
a story about something that we didn't
catch in employee dog food program the
alpha or beta releases or even like when
we like rolled it out slowly so this was
in the context of a photo uploader
so yes disco
familiar if you we are trying to show a
progress bar for uploading photos your
code might look something like this
obviously I don't like simplify it a lot
here here it's saying hey you're
uploading photos at 70% of the total so
we go through a face of
internationalization of strings so so
obviously when you want to put a number
in Android you will do a placeholder
percent D and it will actually
substitute to a number so it's probably
pretty clear for this crowd when we
translate stuff we since we send our
strings uploading photos whatever into
our internationalization console and we
have a lot of volunteers translators so
in the case of Finnish Danish and polish
I have a single translator doing this
they thought oh this % was a probably a
mistake so they removed it in the
translation okay so what happens here
there's no crash no crash happens here
well no come up there's a crash but
there's no compilation mistake here so
everything still still builds depending
on how you write your code it could be a
software or it could be a cancellation
of uploads or it could be a crash so
regardless this means that our users in
the Nordics are not getting a photo
uploads now the reason why this was even
more subtle is because we have separate
experiences for low-end phones and
high-end phones so this was just
happening for gingerbread users in
Finnish polish and Danish so there we
did not have anyone in the alpha or beta
really like channels that used any of
these particular cases so okay how do we
catch it we immediately saw a drop on an
increase in upload failures in
particular in this particular scenario
we drilled more into this and when I
identified this so this is so we have
very very targeted instrumentation tools
so we can identify
large changes in engagement and
sometimes like many of these are related
to releases and then we can actually
like by step and identify what the
particular problem is so I guess is this
enough well so I touched a little bit
into the analytics how do we understand
their app is doing well once we released
it to the world so we have a lot of
dependencies and a lot of tools that we
can use examples are crash logs bug
reports and Google Play Store reviews
know everything in this form comes like
a snippet of text even a crash report if
you look at your ADB stack you're
waiting for the particular pattern and
you're catching it and you're storing it
none of this is structured right
especially like rate shake reports
people say oh my feet is not loading or
I can't comment these are examples so
but we get thousands of thousands of day
reports of this kind mostly because of
our magnitude so one of the things that
we do is we use machine learning and
natural language processing to cluster a
lot of this reports using keywords and
we identify which are the main
categories this allows us to focus on
the most on the on the most pressing
bugs and be able to cut by different
device classes features etc and this is
how we identify some of our most
alarming bugs and we have task forces to
focus on them in particular examples are
like hey if people can't like what's
happening here or if your news feed is
not loading like we drilled out and I
don't understand at more logging and cut
back and forth so this is an example of
a screen shot there are engineers look
at when they get a crash I have again
blurred a bunch of our internal data
here but the structure here is that to
the left you get your stack trace after
all the clustering that happen and to
the right we got aggregated crash
summaries for instance how often is this
happening what device classes is this
happening since which version are we
seeing a lot of this stuff
how can we like this are all the tools
that we can give our engineers so they
can reproduce this and address a lot of
this crashes in a much more promptly
manner so ever since we started having
these tools this helped reduce crashes
by 75 percent which is a lot what does
it say if we build a right
infrastructure but build the right tools
we will be able to target the problems
in a more in a much clearer manner so
that's all I have here today
looks like we have a much larger slot
and I have a 30-minute talk repaired but
I'll start taking questions yeah and
there are a bunch of us from Facebook
here if you guys like have broad
questions as well yeah okay so the
question I'll repeat that is how do you
priority you identify the severity of
the bug and how do you prioritize it
well so remember that slide that I
talked about where we have like we have
a lot of input of reports crashes at
Sarah so we can also we have information
like how often is this being reported so
if people are pressing the report a bug
button the more they reported it's
indicates a lot more severity and like a
brother use case
so we have we have a program at Facebook
hold account though the countdown kind
of like program where we look at all of
the bugs that are being reported the
ones that are reported the most and we
we have specific task forces to handle
each of them some of them are easier
than others some of them are because we
release something by mistake and we can
do immediate targeted fixes some of them
are versatile let me give you an example
we had a like reliability problem at
some point people couldn't like but if
this was really mainstream like of this
problem we would have realized system
will craft targeted it was not it was
not the case
it was pretty subtle and we we broke it
we broke down a bunch of the different
cases by adding a bunch of logging and
looking
what are the reports are in some cases
in low connectivity scenarios people
were hitting like but this was not
propagating and they hit like a like a
lot like I'm like like Mike and our site
integrity or like our spam filter
detection mechanisms realized okay you
can't be liking I'm liking this story a
ton we think we're gonna block you we're
gonna sentry block you so but this was
happening because people were pressing
this back and forth
it was queuing up on the client side and
when the connectivity came back up all
that queue of like someone likes a
request was coming on a server okay so
we were able to identify that and we
were able to remove all those likes and
likes and fix that so that's one example
of a problem but this is affecting some
of our core functionality having signals
of how often is being reported like
where like helps us identify the
severity of them those are how bouncer
question yeah
okay so the question was what type of
testing processes do you have in place
to that allow you to release in a weekly
basis okay so we just started switching
or really like transitioning from a
two-week release cycle to a one-week
really ii recently um did so let me give
you a little more historical context we
used to release once a month but you
still not have a release schedule we
were waiting like we were ready to
release and then we like we released
this this is back in the days when we
had probably a small mobile team okay we
had like a bakery right we released it
then we swish to release once a month
when we started having a lot of people
developing in the codebase we used to
have a month soaked period and a month
like you cut your branch cut and you
have a must soak period and only only
bug fixes go in there it was really
tough because certainly if you couldn't
get your feature for the month you had
to actually wait for another month and
reliability was super important so we
started by having a lot of unit tests
like setting a lot of the the dependency
injection framework integration was
mostly so that we could even write unit
tests so that started first and then the
what time we realized that hey now that
we're releasing every week is really
hard to have manual testing in place we
used to have a QA testing team that
looked at a bunch of the core
interactions to make sure say you could
load your news feed you could post a
photo you could like a story like a lot
of our current actions before we they
would manually test a lot of our core
interactions before we shipped now with
a week one week release cycle that's
impossible
so we are pushed so we so we have a
really good and to end testing framework
screenshot testing framework that we use
now a screenshot testing framework is
operates a lot like a unit test it
allows you to separate a lot of the
components and it takes a screenshot of
the of a lot of the UI that you have so
that it can come
hurried with the old version and you can
you can tell and you can ask you hey do
you mean for this to be a difference so
if we have on this art like changes we
can actually identify them early our
entrance tests are meant to substitute
some of our manual testing and we're
where as a principal we're asking all of
the product teams to search incision to
this so how do we enforce it is we have
this concept of a test storm happening
at Facebook we have a lot of kind of
like trials of what will happen if we if
our data center if X data center went
down so we want to understand our
witnesses there so what will happen if
our QA testing team just was not
available so we're having that test or
plan where our objective is to
transition a lot of our manual testing
in 21 tests so the answer is there's a
mix of stuff we have a lot of tools now
that allow us to write from all the way
from unit tests you end to end test and
the idea is to prevent regression so
that we don't have to be fixing stuff
after launch
so the question is how do we find the
balance between a spatial rollout and a
consistent experience amongst different
people well so we release or app once a
week and that is a staged rollout on its
on its own we want to make sure that we
murder a lot of things like crash rates
bug reports so we want to be very very
careful about not introducing a release
that is bad for our users so in that
sense we will we'll have a growl rollout
that thing said we we do a lot of
experimentation on our features because
we want to make sure that whatever we
will roll out 100% is the best
experience for our users
let me give you an example when we redid
the way we navigate to to open comments
we had a new very like fancy design that
like that when you tapped on comments it
opened a popover it was bouncy it was
very friendly but we found out that hey
if you actually looked at low-end device
users they were actually having a
terrible experience they were commenting
less so we dug in a little bit more we
actually opened this in low-end phone
and we realized that the animation is so
choppy there's really no point in having
it so if we had released the one version
to everybody we would have heard our low
end users and seen better engagement and
I have a better more delightful
experience for how a high end users but
because we had all the way to look at
all this analytics we were able to
pinpoint that for some users this is bad
and so for some more users is better so
what we did in that case is we turned
off animation for our low end users and
they actually like got to experience the
fullscreen behavior that we had which
was better than the older one but they
didn't either animation that was gonna
be choppy anyway so I guess those are
your question one of the things we learn
is that there's no one-size-fits-all for
everybody there's a lot of diversity in
device models and screen sizes and
usages in general usage
not just from your device but also
culturally speaking for instance people
in different countries have different
ratios of friends versus page content
and people use Facebook in a slightly
different manner so the important thing
for us is to be able to understand their
users in the best manner and provide
them what it's what will make them use
like have a better experience yeah what
do you mean the question is if we let
version a like and here's where we turn
on the feature then turn off and turn it
on I can't think of a particular one but
do you have an example in mine
oh yeah yeah yeah we did all the time in
fact we have a lot of experiments
running simultaneously we have a very
good experimentation framework it was
built internally literally probably
every single product change and any
large infrastructure change will go
through experimentation here the context
being get for instance if you have a
refactor you want to have make sure that
all your metrics are neutral and if
they're not you want to understand why
because it's probably a bug otherwise
for our products we we constantly roll
out like this in terms of tests the
setup of the test probably matters like
it varies a lot depending on what the
test is in particular but is there
something in particular you have in mind
server control it's also ever controlled
so the way it works is that we have the
system we call is a quick
experimentation system it's like
internally we call it a guide and also
we have a gating system for that and a
lot of the signals every six hours we
download some small snippet information
which is like imagine a table it's like
a name of experiments map to the group
that you're assigned to and depending on
which group you are assigned to your
code actually decides to turn this on or
off and kind of like log a lot of your
engagement information like your
behavior like the behavior behavior of
the user depending on the flow the
question is what type of tools and
processes we have around code reviews um
I guess so it really depends for the
team so we are a very bottom sub company
in the sense that we try not to build
things that are not necessary but that
being said the common things that come
up is automatically running the test
it's something that has been found very
useful across all the teams so by the
time your review comes back we are able
to run a bunch of unit tests or
end-to-end tests in that case I guess
like we have general like linters and
and a bunch of like to like agreed-upon
patterns that we like to enforce so
there are kotas consistent and coherent
across everything what else yeah I think
all the high level that's why I'm
thinking of with two and we do like to
kind of like in principle say hey if you
are done building a feature because
end-to-end tests are heavy and expensive
we we start once your ship well let's
say we ship this and we kind of gelled
like we agreed on this as being the the
feature that we want to actually release
and in this form we go back and start
looking at what are the core into tests
that we would like to build
and from the point of view of a user
yeah
so there were a lot of the question is
what happen when you switch from 1200
years to like hundreds of engineers how
your code changed
remember memory the biggest thing that
changed was we started using dependency
injection because we were enabled
because everything was tangled together
and stuff was breaking and if you could
build a particular module and just not
have to depend on it it's actually
really helpful the second one that we
built was that we developed because we
didn't find a tool that could handle a
bunch of our scale was back our build
system so the way buck works is that it
builds particular modules and it doesn't
rebuild them if they haven't changed so
it's buck is a general build system it's
actually open source it's not specific
to Android it's as part of our iOS build
system as well now but the advantage of
that was we used to have a single
repository we still have a single
repository but each of our modules have
to be like when building the whole thing
it would take forever with time what we
developed was different ways of
distributing the builds across different
machines so that not everything lies on
your laptop and your laptop doesn't look
like it's like starting up a rocket like
doesn't sound like a rocket ship the
buck was pretty impactful what are
things do we change I think we started
oh look the stuff I'm mentioning I was
mentioning here how we fetch data from
our servers it's a framework or graph QL
it's open source now it allows us to
effectively download it's it's a it's an
API that allows us to effectively
download data from our servers but it's
also version in the it's tolerant to
versioning what I mean with this so we
all know that our diversion apk that we
probably release probably like a couple
months ago
it's still out in a wild and and so we
can't deprecated certain methods so
rather than saying hey this is the vert
this is the API and we're switching it
like this in the next release which
doesn't really work will we we came up
with a method an API construction that
allows us to ask for specific parts for
instance if we're a rendering news feed
is passed me all the stories pass me the
message of it ask me the link for it
pass me the photo and what if in the in
the next version of newsfeed we are
first we were not rendering photos and
we're just rendering everything like a
text piece and in the next version we
want to have a rich media format right
so how do we like repurpose this API so
that the the old version still keep
working and we don't have to change our
our signature a lot and in the new ones
we can support a bunch of this stuff we
use the concept of a stylist the idea is
in Jason as part of your Jason you have
a stylist that says I want to render us
a photo unless a photo if it's as a
photo format you can you need to make
sure that your image URL is there and
the title is there and if you can't
render a photo there's a fallback
mechanism which is just text for
instance and this is how we grow so that
that has been very helpful so check it
out a lot of this is part of like a
framework or graph QL but also a lot of
this was custom within our team
so the question is the way design for
the loan first I'm progressing my hands
or the other way so we have someone from
the emerging my Christine here like I
don't want to put you in your spot I can
answer it but it seems like you're
available to that's color okay so I'll
take a stab and then Alex can probably
adhere more to be honest we try we try
to build empathy that's the most
important thing one of the things we we
realize is that first if you don't use
an Android phone if an Android phone you
it's if you need to use an Android phone
every day to so that you can understand
how navigation works what what type of
limitations of heart we have so we have
we make sure that we really really push
everyone that the companies to start
using Android there are thing a couple
things that we also tried is low end
phone versus high end phone like we push
but like our this started way one of our
PM's who Kris Mara who started like
raising a lot of awareness about the
different types of phones out there so
he asked and everyone carry a low end
phone and a high end phone and the other
part is we build a lot of api's so that
people can understand the data and be
able to cut it across different device
models and different connectivity models
what does that mean well so if you guys
have tended the talk yesterday we talked
about how we have 10,000 different
devices and when we have 10,000
different devices are you supposed to
carry 10,000 different phones test all
of them it's literally impossible to do
that so but what we do know is that
there are certain characteristics that
not differentiate them the number of
course like the screen size how
basically their speed so rather than
thinking about each of the devices we
think about if you took this phone the
specifications of this phone
how will you map it to when it was when
was it the newest flagship phone in the
US so we think about the same way you
think about car models it's like I
I don't really know about the models
ever in the world but I can think of
okay this is a car that would have like
released in 2010 for instance so we
created this year class model so that
instead of thinking about ten thousand
different phones do you think about four
or five or six we're really just fast
and slow so probably the ones in your
pockets are the fast ones and think
about something that was flagship in
2011 so we put so when we think when we
have this type of framework we can cut
our data across the board there so
that's one part be able to understand
your data and the second part is also
try to use this phone phone in this
model the emerging markets team started
what we call what 2g Tuesday's the idea
is on Tuesday you will have a an ad on
top of your facebook that says a
megaphone we call it that says can you
can we Ripken can you start using
Facebook as if we slowed down everything
and you were in a 2g network examples
like this so all of this was it the
objective of building empathy so that
our designers or product product
developers and our product managers can
think about where the problems that are
happening over world initiative that we
also have a lot of research field trips
going to different emerging markets are
yes oh I know we go to India Southeast
Asia we go to Mexico and we interview a
bunch of people and ask them about their
usage parents this helps us to
understand emerging markets as well as
core cultural differences - do you want
to add something Alex ok
exponential upgrade paths with me oh
yeah oh okay let me let me try I'll try
to repeat it for everybody so when you
switch to a one with a release cycle and
people haven't really upgraded in two
weeks and this person hasn't really in
one week suddenly you have the news
version that you had out but really have
a bunch of people in the prior one the
one before and just like it blows up a
lot more than if you were like releasing
twice a week
like like twice a month for instance is
that the context yeah the problem is ax
is not simple we've been dealing with
this problem ever since we were even
releasing once a month Android in
particular
iOS users actually upgrade much faster
than IO Android users it's it's probably
pretty obvious why because of the
different network connections it's error
as well so on Android I guess to
contrast a little bit with iOS iOS
doesn't have an alpha beta channel we
have one which is nice it's not enough
fully but we'll take what we can get
we still have versions that exist out
there I remember we were seeing like a
bug of version like a server-side change
that we made by mistake from that was
breaking releases that a release that
came out a year ago so we are still
handling use we're still handling
binaries we're released a year ago and
the answer for that is we have to be
very very flexible and we really need to
like we can never assume that that an
apk that is released will disappear so
what do we do we I mean we need to make
sure that our like but before we release
everything we have tested everything
this is why testing is really important
instrumentation is super important and
we need to design ours the most the most
thing is that we need to design our
survey ap is in a flexible manner
because you cannot assume that you can
separate a time a function so rather
than saying this is the version version
1 version 2 of the API of the of the API
call we need to invert it we need to
think about we need we need to think
about how do you expose things where the
where the client is saying give me this
information rather than giving for
instance in the case of newsfeed is give
me the last 10 stories with this
particular field as opposed to saying
just give me fee because that will
change right so if you tell you tell the
server give me the last 10 stories with
a message with the image with with the
with an image URL is very different from
just give me feed and I change the
signature so that's like by design an
API that we have to do so question is so
the question is if our infrastructure
what like what I guess like I'll
rephrase it a little bit it's like lemon
earth is appropriate accurate is what
what which internal tools are open
source that are available so not
everything to be honest so what we do is
we we want to make sure that a lot of
the stuff that we open source is
packaged correctly and it works well in
this generic enough for people to use we
do open source a lot of stuff the
screenshots the screenshot test work the
author is our tomorrow haha he is an
engineer in New York and the
infrastructure team he just released
that so if you are making a lot of UI
changes and you want to make sure that
stuff is consistent check that out it's
called Android screenshot test framework
unit test we just use like standard J
unit stuff and the end-to-end test
framer we're actually taking open so
like we're pulling from the open source
framework we use cylindric so we kind of
repurpose it to use our internal tooling
but it comes from open source the
dependency injection framework is not
open
it's very similar to dagger so I
encourage you to check out one out check
out our so we have a page for a bunch of
our like our Facebook open source tools
page that will have information about
the different projects another cool one
is rebound
it's a UI library that allows you to
make bouncy animations so that you can
use spring physics to to create like
elements mm-hm
head back that comes from rebound so I
know a lot of companies have used that
one
so let me see if I heard the question
correctly when you said that would
transition from mobile to like a mobile
like to everyone like writing code did
they all have mobile experience how do
we handle a bunch of that the answer is
we need a lot of mobile engineers okay
we actually we we've been we're hiring a
lot for Android and iOS engineers so if
anyone is looking for for a job come
talk to us as well with my plug for
hiring but the point is at some point we
because Android and iOS like mobile
technologies are fairly new compared to
say web web technologies or systems in
general we could not hire enough people
to work on Android we're gonna hire
enough people to like satisfy the rate
at which we needed people so a couple
things we did the first thing is we
hired an in-house company to come teach
us how to do Android big nut wrench so I
was part of the first class during their
I was not an Android developer before
are you on Facebook I was actually doing
machine learning and computer vision so
with transition there we like one of the
things we found out is that well you
know it's a language it's a different
framework but it's still programming
you're still dealing with you're dealing
with building a system that is gonna be
having a lot of uptime in a very
constrained environment so a lot of the
people that have worked on systems and
web can apply a lot of those of those
that knowledge into Android itself and
they have to learn about a bunch of like
kind of like the general like framework
details so we have found that a lot of
our web and systems engineers at
Facebook have been very very have
contributed a lot to how our internals
and how architecture parents have been
divine the second part is we realized ok
since we can't hire enough Android
people how about we train them so a
facebook we have our bootcamp program
which is we don't when when we hire you
into Facebook we don't out pre-allocate
you into a team we have some custom
pipelines that do but most people are
generalists
and they go through six weeks of classes
where they learn how to use our full
systems and back in the day it was only
the web and the C++ layer and then we
realized okay we need to add something
for mobile Android and iOS so if you
join Facebook
now after three weeks of learning how to
use the general like web stack and the
system stack we introduce you we give
you the option to join the iOS track or
the Android track or stay in the systems
track and at that point we would teach
classes the classes have are all
internal now we develop our internal
curriculum we for one week you learn how
to use to write Android from scratch
without the Facebook libraries will you
build an Instagram app like a baby
Instagram app and after that first week
so it's a very very intense week and
after that way you learn a lot about how
to use the Android specific tools right
your specific tools and you start
talking to different teams you and then
by two weeks and you're already
contributing to our mobile code basis so
this is how we have handled the fact
that there's not enough Android
developers out there so we train them
and that has worked out well and we're
still looking for people so here are
questions okay I guess if there are no
questions I'll stick around here feel
free to stop by chad thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>