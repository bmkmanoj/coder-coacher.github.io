<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building an Android Instant App (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Building an Android Instant App (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building an Android Instant App (Google I/O '17)</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9Jg1D07NgeI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi good afternoon welcome to our session
on building an Android in synapse I'm
Sharona I'm the engineering lead for
developer experience of business I've
been on the team since the very
beginning I'm very excited to be here
today to bring all of you our intern
apps development experience so today I'm
going to talk to you about what intern
apps are give you a quick overview of
the user experiences that they enable
I'll then talk about a few key
principles to keep in mind as you build
your intern app I'll walk you through
the developer experience that we built
that you can expect when you start and
then finally we'll work through a
specific example of building an internet
from an existing app samhsa's let's get
started so what are internet internet
our Android apps that run without
installation to provide users the
ability to have rich native experiences
at the top of the URL in this example
our colleague Joyce sent us a URL for
the New York Times crossword puzzle
it's happily URL and it directly brings
it up inside the New York Times
crossword up no installation needed now
as a result of this my product manager
John sends me a URL every morning with
his timings unfortunate consequence
anyway so now it's not the launch from
URLs they are discoverable from anywhere
that you can put a euro whether that's
the chat session with a friend or link
in your search results did you know that
the White House was actually listed on
Zillow now with install that you're
probably used to users coming in through
your front door your larger activity or
your main activities but with infinite
users can launch into
any experience that you have within your
app so that improves the surface area
for discovery infographs are a mode of
your existing app not something separate
they allow you to provide the exact same
product experience that you provide in
your current installable app they share
the same package name they have the same
icon and they have the same codebase so
now that you know what Internet's are
and what user experiences they enable
let's talk about a few key principles to
keep in mind as you start building your
infinite you'll see examples of these
principles throughout the rest of this
talk and when you do it yourself so I'll
cover discoverability security and
privacy and performance in finesse are
launched from URLs so the first step is
to consider the experiences within your
app and make them your L addressable you
can do this very easily with Android
applicants allows you to associate a
domain with your app and support
specific paths against that domain
within activities in your app the more
of these paths you support the more
discoverable your app is let's talk
about security and privacy with
installable apps apps get access to the
user's device when they go through and
explicit when the user goes through an
explicit installation flow at that point
the user is granting your app access to
your device you also have the ability to
ask the user for permissions to access
private data like locations now within
turn a switch is launched from a URL so
there's no exclusive installation flow
and hence no upfront consent
for infinite's to maintain the same
capabilities as installable as they use
the runtime permissions API that allows
them to get private data like location
or on device resources like the camera
we also provide user resettable
identifiers for our IDs and Android IDs
but we limit International Grains
unique device identifiers like IMEI and
MAC address
we also limit in turn as requiring what
apps are installed on a user's device
and listening to system broadcast
finally let's talk about performance in
synapse are loaded and run on demand so
the size of the binary has a huge impact
to the user visible startup latency the
smaller the minor is the faster it goes
the better the user experience so it is
very important to have small light
refineries to have a great internet
experience we recommend starting your
apps on a very strict diet zero fat
takeout dead code unused resources look
in your manifest for unused permissions
and your Gradle file for unnecessary
libraries many of our partners saw a
huge improvement in their binary size
with just this step you can then build
your application into modules remember
internet support multiple entry points
so having modules that support each of
these entry points allows us to only
load the module that's needed for a
given entry point with the ability to
load more as the user goes through
different flows within your app so
quickly summarize the key principles to
keep in mind while you build your
internet discoverability to the Android
app link privacy and security with a
runtime permissions API
and performance with small modular
binary now we work with over 50 early
access partners who really helped us
define our developer experience their
level of engagement and they're
extremely valuable input is reflected in
the quality of all components of our
developer experience I'll walk you
through a few of these I cover
development tools the new constructs
that we've introduced the project
structure as well as the publishing
interface many of you develop apps in
Android studio Android studio 3 doll
comes with infinite support out of the
box you can install the infinite as the
case your educator and then you can
build run tests and debug infinite
directly from the IDE you can also
easily add URL entry points with the app
links assistant that's built directly in
Android studio
apart from on device support we've also
enabled emulator support for you to do
fast and easy local development we've
introduced a new construct called the
feature module the freezer module is
very similar to a library module in that
it contains code resources and a
manifest but feature modules
billed as apk for your internet our
Gradle plugin will automatically build
them as libraries for your installable
app so you can use the exact same code
base now infinite are built across
multiple features so we've also
introduced a instant app module that
builds the container to hold your
feature apk this is a zip file
now installable apps are built as a
single binary the apk so the project
structure can be done in a variety of
ways many of us have worked on apps that
started small and that ended up being
large monolithic code bases under a
single module I've always dreamed of the
perfect modular structure and sometimes
I've done the work but they deliberate
benefits the actual binary size now with
infinite we need to load binaries on
demand this is where our future module
comes in it allows you to extract those
specific features into their own module
so you can set up your project to take
the common code from your existing
application module and put it in a base
feature module the base module is always
loaded then you can extract out specific
features into their own modules that way
for a given entry point we only load the
base module and the corresponding
feature module as the user goes through
different flows within your app we just
load more of the feature modules within
the same application context so now you
can have a project structure that builds
both your instant apps and your
installable apps directly from within a
single studio project finally when your
intern app is ready you can use the
Google Play console for publishing we've
enabled three publishing tracks
development pre-release and production
for you to roll out your internet in a
phased manner so to quickly summarize
our developer experience we can you can
set up under Studio 3.0 with the
Internet at the K you can then introduce
feature modules and refactor your app
into these feature modules such that we
have the feature module for each entry
point you can create a project structure
that allows you to build both your
internet and your
install the lab of the same studio
project and finally when your app is
ready you can publish through the Google
Play console so let's get our hands
dirty and try this out at this time I'd
like to invite on stage
Anita's Diwani I know is our DS
developer advocate for Internet and has
worked with many of our partners to
enable their Internet experience
welcome any girl Thank You sugar next
slide please
still with the slide still with this
list can we switch back to this life sir
so I don't have an app called Banjara
but Java is a Hindi word for nomads the
Banjara app is a true such actions app
it gives you a list of attractions
around you and for any given attraction
it gives you details now the Madera app
is structured this way
it has a top-level application module
with two activities one for the
attractions live and runs for the
details each of these activities has
their own fragment there's some common
code that is integration with slide map
some utilities the app also uses the
runtime permissions API for located now
well today we'll work on making Banjara
in tips so the first thing to consider
is what are the URL entry points into
Banjara that make sense we have two
entry points one the list and one the
details we want to make both of them
discoverable so we add through URL and
two points one for the attractions list
and one for the details will then
refactor the existing application code
into to feature modules the base feature
module would contain the attractions
list
the common cause and the details feature
module would then have the details
experience remember the base module is
always loaded and so the details feature
module only needs to have the additional
code so this is our target project
structure who get through it in three
steps step one will introduce URL entry
point into our application we'll do this
with the uplink assistance step two
we'll take our existing application
module and make it a single based
feature module all the code is
encapsulated within the future module we
can then introduce an Internet module
and an application module to build off
this base feature module at this point
we'll have our first functional internet
then step three we'll extract out the
details experience from the base feature
module and make it its own module so
we've reached our target project
structure in three steps let's try this
out step one I knew if we're ready can
you show us our project structure and
the markets through this step absolutely
so before we begin let's make sure we
have the internet development SDK
installed so I have the SDK manager open
and here you see the develop and SDKs
installed just going to click OK alright
so now let's just set up URL and three
points for our app this is done by
adding intent filters to your manifest
to help us with the process we're going
to use the Android app links assistant
to and there it opens has a panel on the
right and will guide us through the
process of creating our entry points the
first thing we want to do is map some
URLs to our activities so let's set up
some mappings
so I'm going to use Banjara opcom as my
host and then set up main part for my
attractions list activity
I'll repeat the step for HTTP all right
now that we have the main part set up we
also will now set up the part for our
details activity again the same host and
use details and choose details activity
from the drop down box and then again
repeat the same step for HTTP
and there we have our mapping set now
there's a preview window here which
shows you your manifest and the changes
that we just did using the mapping
editor alright so the next step is then
to add logic to handle our intent this
is already done because we're using
existing code the next step is to create
a digital access link file and then
associate our website with our app
package so I'm going to bring up the
tool a couple of details here you enter
your site domain you enter your
application ID and then you choose your
sign-in key I'm going to use the debug
key but when you productionize your app
you'll choose your vinny skill here I'll
now click on digital to generate my
digital access link file now this file
basically tells us that our app is now
mapped to our domain this is very
important to claim ownership of your
urls this file now needs to be uploaded
to a specific location on your server
the location is here
once you're done uploading the file
we'll click link and verify and this
will make the association between your
app and the domain right back you should
ok so we're done with step 1 and we now
have few experiences with another app
discoverable through your logs let's
move on to step 2 we'll now take our
existing application module and then put
it in a base feature module we'd have to
rename our application to be a feature
will also change the Gradle file should
not be com Android from that Android
application and make it Condor Android
feature now since all the code will be
within the feature module we can now
introduce an application module and an
infinite module to build off the same
feature module each of them don't need
any cost because they'll be building off
the existing module let's try that sure
since you can see on the left side my
project currently has one module that's
the Banjara - pace and this is an
application module so what we are not
trying to do is convert this into a
feature module so all our code and
resources are in this feature and then
create two new top-level modules
an application module and an instant add
module and then we'll include the
feature as a dependency from those
modules so I have my bill Gradle file
for my Banjara base module open
currently safecom dot and by that
application I'm going to change this to
combat and write that feature this is
the new plugin now all modular apps
using the feature plug-in organized
around the single base module now since
this is our only module we will tell the
Gradle build tools that this is our base
module we're going to do this by setting
the base feature property
all right now that we have our base
module we'll create let's first create
the application module so I'll select
new module choose phone and tablet and
let's call this Banjara app
just going to choose a package name
that's consistent with my other modules
and I'll select add no activity because
for now all our activities and all our
code is in the feature module
alright the module is now created I'll
remove the test sources and resources
for now
and then in my application manifest file
I'll remove the application tag because
this is going to get merged from our
future module
all right
so now let's look at the Gradle file for
our newly created application volume the
first thing I will do is use the same
compiled SDK and built origin that I'm
using in my future module
then remove the test dependencies and
now we want to include our future module
in our application module
so right now we have the feature model
included there's one final thing we need
to do so let's head over to our base
bill Gradle file again now the base and
the base module is a very important
module the Gradle build tools look into
the base module to figure out all the
features and the application in your
project so we need to make our base
module aware of our application module
this will help with the manifest merging
process and we'll pull up the
application ID to package the instead of
so this is done by using the application
configuration
all right this is think now
let's try to compile
I already have an emulator running and
let's see we got a little error here
I'll clean the project
all right the build is not successful so
I have a emulator here running n so
let's try to run our app which is now
using a feature module which produces a
feature apk of new produces of library
file for our app so I'll select the app
configuration and then one
there our app is now running it uses
runtime permissions for location and
this is our list activity for a list of
attractions or bring up one of the
details for one of the attractions here
right so now this is an installed app
because we use convert and by dot
application so I'll uninstall this app
and will now build an incident
so to do that I will create a new module
and choose Internet let's call this
Banjara - Internet
the body was created as you can see on
the left from the project structure this
is a very lightweight module there is no
source there are there is not there are
no resources it just has a build up data
file and it's going to build just a
container zip for our feature etiquette
so using the same compiled and build
tools as version and now just as we did
for our application module I will
include the feature module as a
dependency
right now let's try to build our instant
app
all right the compliation is successful
now before we run this app let's take a
look at our run configuration for the
instant app I have it here as you can
see in the launch options here instead
of using an activity this is now using a
URL so let's switch it to the main which
maps to our list of attractions apply ok
and now in the let's run our first
incident
so this may take some time for the first
time when you try to run this because
it's not setting up our device or
setting up our emulator for running in
synapse now in sign app is running it
uses the same runtime permission model
we didn't make any changes to the code
yet we have a list of attractions and
then I bring up an attraction from the
details activity so before I give it
back to write thank you
before I hand it over back to shobhna
let's quickly look at our build artifact
from the instant app project so here as
you can see this is a zip file I'm going
to use the apk analyzer to inspect the
zip file and the zip file you can see I
have one feature apk it's our base apk I
can look down and then drill down and
look at my resource usage using the apk
analyzer right like the issue great so
we have our first functional infinite
ten-minute so now let's move on to step
3 we're going to extract out the details
experience into its own feature module
we're doing this by introducing a new
feature module and just refactoring code
our existing base module into that
feature module well then have to update
the application module and the internal
modules will now go from to feature
module so and it'll can show us how to
do that
okay let's review our project structure
right now we have three modules which is
one is a feature module Banjara base and
then one application module and an
internet module to wrap the feature
module so let's create a new feature
module and refactor some code from our
base module so now use the new feature
module template and call this Banjara
details
following the same project structure and
the package naming scheme
now remember future modules are built
just like libraries so they need to have
a different package name cannot be the
same as your application type again no
activity to add the refactor existing
activities
all right our details module is now
ready let's look at the bill Gradle file
so it automatically applied the plug-in
convert and write that feature let's
switch to the build tools alright
now when we created this module Android
studio automatically added a dependency
to save a dependencies to Banjara base
remember what we said about Mario's
there the base module is all the feature
modules are organized around a single
base module and they need to extend the
base module so because you already have
a base module studio automatically
applied the dependency to our base
module and let's take a look at our
Gradle file for our base module
now you remember we added the
application configuration here to tell
our base module about our app so it
needs to pull down the package ID when
we created the new details module
Android studio also added a feature
configuration which tells our base
module about the other feature modules
in our project structure this is very
important for manifest merging and the
build process
right so now we have two feature modules
created but we need to go back to our
application and instant app and include
the new details module in the bill
I'm in my application right now I'll add
the details Mario here and then the same
for my insta nap
alright now that all the dependencies
have been set up let's actually refactor
some code into the details module
so before we begin I'll create a package
where I need to place the new classes
I'll use the package name UI this is
where our classes are in the base module
okay I'm going to remove the patch
sources again
alright now let's actually go and get
our classes that we need to refactor so
we'll move the details activity and the
details fragment into the new module
all right the new classes the details
classes are now on our details module we
also need to move the activity
declaration from the manifest file of
the base module where the classes were
previously and bring that the activity
was previously and then bring that
through our future module so this is my
details activity
let's add it to our manifest file for
our details module
or just create an application tag to put
the activities under it and there let's
now compile the project
all right project compiled now before we
run this let's quickly inspect the
container file again in my Panchala
inside our module head over to build
outputs and my zip I this year now when
I inspect this using a PG analyzer I see
now two feature apks my base feature apk
and my details which are applique
now let's use our internet one
configuration to Randall
and my app with to feature Atticus is
running
thank you I'll bring up an attraction
now this attraction details were loaded
from a different apk and before I hand
it over to shop now I just want to show
you in the launcher here we don't have
the Banjara app installed anymore
because we were running it as an
Internet but if we head over to the
reasons we can see as Angela app running
right like you should thank you thank
you so just to quickly summarize how did
we make the Java instance we enable ull
entry points into our app we then
created a base feature module to the
existing code and we extracted features
out of the base module into their own
feature module at the end we have a
single studio project that you could
build both the instant ups and the
install Villa now this was a simple
sample app it's likely that you'll take
a little longer than 15 minutes to make
your own instant apps or a real-world
application we've heard from many of our
partners as to how long it took and we
found that it's typical to take 4 to 6
weeks to build your internet you'll
spend the first part of that thinking
through the product experience that you
want to build in your internet then
identify the target project structure
that's perfect for your application and
then there's a refactoring effort to put
code inside your base feature module as
well as into other feature modules and
then you'll spend some time trimming
down each of these modules to be light
and a small size so they can be
downloaded and run on the fly
we have 50 in synapse live today I see a
few of our early access partners over
here thank you and congratulation but we
believe this is just the beginning we're
very excited to see what in synapse
experiences you will build but we're not
done yet in the coming weeks and months
you see huge improvements to the
developer experience we're focused on
features that can enable additional
binary size reduction that includes
allowing your app to be sliced along
device configurations
display densities allowing commonly used
libraries like app compat to be shared
between instances and on the compression
techniques to reduce over-the-air binary
transmission on the tooling side we're
introducing a refactoring tool that will
make it really easy for you to modular
design your code into features
additionally we're expanding and synapse
to more devices in more countries to
make sure your reach reaches all of
Android
here are some resources for you to get
started our intern apps website has a
lot of information around product but
especially it has a getting started
guide for you to walk through the
developer experience by yourself we're
also in the infant app sandbox under
don't see where you can come by and see
some demos of our early access partners
and their and synapse experience
immediately after this talk we're going
to have a fireside chat with some of our
early access partners so you can hear
from them what their experiences were
developing into knots
and what benefit is brought to their
applications we hope the talk was useful
in jump-starting your intern app
development thank you so much for being
here
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>