<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Android Emerging Markets (Big Android BBQ 2015) | Coder Coacher - Coaching Coders</title><meta content="Android Emerging Markets (Big Android BBQ 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Android Emerging Markets (Big Android BBQ 2015)</b></h2><h5 class="post__date">2015-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CZmJ284qv5Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">also good afternoon everyone so we are
facebook we are the two of us up from
the Android emerging markets team in
facebook I'm Alex Seraph the manager or
the emerging market team and here is my
name is Alex petrescu and I'm a software
engineer on the emerging markets team
and I focus on new seed and today we're
going to talk about what we do to make
Android apps look work better on less
powerful devices and less powerful
networks so first of all why we care
about emerging markets so we have almost
150 million users using the app on the
daily basis and this users everywhere
and we want to connect users are all
over the world as a matter of fact
Android our your Android users in
particular located all over the world
nine out of ten of our users located
outside of the United States and most of
the new users could come online are also
coming online in places which are
emerging markets we have a lot of people
who for the first time I'm actually
getting internet connections and of
course facebook wants to connect
everybody and there is an ongoing effort
to do that our job is to make sure this
users work very well with facebook for
android app where they are you know and
where they are typically you know with
no offense for is users are android
devices usually cheap android devices
and network which are not very powerful
so we're going to talk about devices
first does anybody here care to guess
how many different android devices are
out there in the market number five
hundred a thousand ten thousand the
right answer is 10,000 you got that so
there are about 10,000 devices and
actually the number keeps increasing so
that that is about go see you know six
months ago it was about ten thousand i'm
not sure what the what it is right now
and of course the challenge is how do we
actually test and how do we reason about
10,000 devices they're all very
different well the way we reason about
them is that we come up with this
approach called device here class so
what's device year class quite simply
it's no matter what the device was
produced it's the year at which this
device with those characteristics would
have been the flagship device on the
market so here's how it works
here is the recent device pretty popular
device from other all of course came out
in 2014 but it has those characteristics
it has two cpu cores 1.2 g hurts clock
speed and one gigabyte of ram and let's
compare it with galaxy s2 which is a
very popular device from 2011 has very
similar characteristics as far as these
three characteristics go and in a
thousand eleven that was the flagship
device so as a result we're going to say
hey both of those devices are you a
class 2011 devices and again there are
many different characteristics we could
have looked at we looked at and we
looked at all them and we thought that
these three characteristics are the ones
that makes the most difference in terms
of the performance of the app and how
users are able to interface with the app
so these are the actual settings that
set up that we'll look at for these
three parameters and to Cuzco we
determine where the device is in one
year class or another on some devices
you know you are not going to get the
exact match we go for two out of three
if two out of three actually match the
year class we call call those devices
you know from that year class and that's
been a really useful metric for us it's
been useful for us because all of a
sudden we can classify this cold world
of ten thousand devices into smaller
groups and we can reason about them more
easily so once we actually got this data
we started seeing some interesting
trends and I'll let Alex talk about that
so we developed the concept of year
class a couple years ago it's mostly
just a simple library that we've even
open source for other developers to be
able to introduce in this into their
apps and once we looked at the data we
gathered a few months of data somewhere
around last year we saw that about a
third of all devices well we consider
2010 devices these are mostly
gingerbread devices you only have one
core less than a gigahertz a clock and
then usually also other slow
characteristics like a small cache size
and things like that another third our
2011 devices and these are better
devices they have two cores but still
not allow clock speed not a lot of a ram
but it seemed
that was the majority of users so we
call 2010 and 2011 typical Android
devices because they were the majority
of the market and then the ones that we
have in our pockets those are the the
modern phones the high-end phones the
the 2012 you have more than a couple of
Coors more than a gig of ram things like
that now good news is that this year
2010 that shrunk so there's a lot LEDs
gingerbread devices there's a lot less
single core devices however the 2011
class is now the most popular one and
continues to grow most of the devices
sold in emerging markets where they're
selling millions and millions they're
mostly on the 2011 side so still only
two cores which is a challenge a little
bit better for the United States very
few or fewer gingerbread users and
single cord devices but still more than
a third of users on 2011 devices so if
you're building an app you still need to
care and you care about any sort of
adoption outside of major markets you do
you should care about these type of
devices so as engineers instead of oh
shoot sorry I mad at this one second how
do i go back
okay BAM got it alright so as engineers
instead of worrying about 10,000
different devices now you really only
need to worry about eight and honestly
you only need to worry about two or
three you need to have a 2011 device you
need to have a 2010 device like a pocket
neo and then you need to have the device
that's in your pocket which is usually
four cores or more and a decent speed so
now that we talked about the diversity
of devices I mean the next sort of place
where there's a lot of diversity in
terms of usage is diversity of natural
conditions it's in some ways it's even
more complicated that diversity of
devices this is kind of the basic graph
here that shows you very basic breakdown
on network conditions and this is just
by Wi-Fi and cellular you know worldwide
you know most of the connections of
course this is this is from facebook
data and you know a sessions of Facebook
up most of the connections out there on
the Wi-Fi I know that quite a few cetera
and then about two percent worldwide
actually connect where there is no
connection whatsoever I mean there might
be different reasons for that users
might have turn of the mobile data or
the area where there is no mobile data
or they in the area which is very
congested and they can get to the tower
all of these are reasons for not having
any connections at all so that's simple
enough but when you break it down by
countries you'll see that you know
there's a wide variety of different
conditions even if you look just at
those free you know why 50 and no
connection whatsoever you know these
profiles vary a lot but it actually is
even more complicated with that than
that I think probably everybody notice
is that no Wi-Fi 1 by Phi is not like
another Wi-Fi and you know one sailor
connection is not like another sailor
connection and so we took the page out
of device year classwork and without
Hague could we actually do something
similar for network connections could we
actually a break it down and too easy to
understand classifications that you know
we can then use to reason about them and
to make improvements for different
network connections in the idea we came
up with is a network connection class
and again this is something we open
source and others can use as well but in
general this is fairly straightforward
we are doing a passive measurements or
the bandwidth like as the app sends the
packets and receives them we keep track
of how long it takes
and we measure bandwidth we throw out
small packets because the overhead is
actually you know starts dominating and
we only look for something which is more
than a certain sort of certain size and
then we get this data points we get
those data points all over the place you
know the mobile connections are you know
sort of notoriously you know unreliable
and then you given time you can be you
can have a really good connection on a
really bad connection especially if
you're moving around so we're average so
we looked at different methods of
averaging and we'll end it with a
geometric averaging so essentially we
break the space of all the bandwidth
into two categories they were all about
4x from each other moderate and poor
connections at the lowest ones and then
good and excellent and then you know we
label them again we do to label them and
understand those boundaries we look at
the data again we wanted to find the
boundaries which are actually meaningful
so the user moves from one connection
class to another it results in a
meaningful change to you know
performance or meaningful change and how
the user can actually interact with the
apps so this is the one we came up with
you know for the open source library we
just you know label them with warm water
good and excellent because in the future
we might actually change what the
boundaries are but we found that this
for I could just great groups for
engineers to think about and target
their up towards okay so like Alex
mentioned we found this technology does
not imply speed and this is pretty
apparent to anyone that's actually
traveled and try to use hotel Wi-Fi or
try to go into an internet cafe or
something like that just because you're
on Wi-Fi does not mean that you're on a
good fast connection so when you're
thinking about gaining very expensive
features like I don't know autoplay
videos or HD videos or things like that
you can't just use that you're on Wi-Fi
or not on Wi-Fi because that doesn't
really tell you anything again it
doesn't if you're on LTE connection or a
3g connection you might have one bar or
something like it sits you're still not
getting a good amount of speed so for
example in India and in the United
States the same download can take four
times longer or be four times faster in
the United States on average than in
India for the same connection type so
this is what
android gives you android tells you
you're on Wi-Fi you are mobile you're on
edge you're on LTE but doesn't really
tell you what the quality is or how fast
you're getting packets to and from your
server so as developers we need to build
one amp usually that has to work on both
six Meg's a second and essentially 56k
modem speeds so it's a quite a challenge
for developers and connection classes
something we've developed to help us
tackle these types of issues and you
know this is talk about tales and some
things that we find out which might not
be obvious and this is one of those
things in general if you were to have a
conditional in your in your app and say
hey if I think about Japan do I think
about bad connections that I think about
good connections I think just everybody
would agree that you are thinking about
good connections really good connections
for most years in Japan but when we
graph with this data instead of looking
at this data we found this so at the end
of every month about ten percent of
users in Japan switch from excellent
connections to not so great connections
poor and moderate connections so what
are wondering why the title kind of
gives it away as to why this happens the
title of the slide what we think is
happening is that basically users are
there when prepaid plans or they
basically throttle by the carrier when
they used too much data and so again if
you are just looking at the country or
the type of the connection Wi-Fi or
cellular you're probably missing out on
some group of the population which
actually doesn't quite fit the profile
so you guys have seen this slide a few
slides ago and we talked about the
different breakdowns and what I'd like
to point out is now the intermittency
issue is that there's a certain time no
matter what country you're in the matter
what network you're on where you turn on
your app and for some reason you don't
have a network right now this is
obviously a much bigger problems in
places like India and Nigeria where
something like twenty percent of all app
startups do not have any network at all
but still even the United States we've
all been on the subway on the bus or
something like that where there's no
connection right now and even though you
have a
network connection or Android will tell
you you have a network connection we
found is packets will go out and then
they'll just essentially just go into a
black hole somewhere and then never come
back nothing comes back so about what we
found is like twenty percent of all
network requests fail and this is why
the app is in the foreground so we know
that the user is trying to use the app
while the app is in the background it
could be fifty sixty percent if you're
trying to make a network request while
it's in the background so in addition to
that I've been we believe that the
improvements especially in the
networking side are going to take some
time so 2g is being phased out on us
which is great news but it's going to be
around in the developing in the emerging
market places for a while you know at
least for a few years but that's not
even the whole problem the bigger
problem is the congestion because if you
go to the merge marketplace and you're
and you try the free G over there what
about you often find that 3g is not like
a 3g here and the reason is it's it's
really congested and it's not reliable
and you know congestion comes from a lot
of people using the networks and you
know more and more people are getting
online more and more people are using
internet for the first time and this
fantastic news unfortunately the
infrastructure is not catching up with
that so we expect that the congestion
issues are going to continue and then
that was not going to get any more
reliable anytime soon and here's our
tail of the connectivity in the facebook
hyderabad office so as an emerging
market teams will make trip to emerging
market countries pretty regularly and
this year we really focused on the india
because we wanted to solve to understand
and solve a lot of problems in that
market so we went there twice so far we
went there in january we went in july
and when we went there in january
january but we disappointed you know the
connection was too good you got 3g
speeds you know the office happens to be
in a high-tech part of the town and you
know they got a lot of cell towers over
there a lot of high-tech companies so
generally connection was excellent it
was like oh that's too bad we can really
get a representative sample right there
so we had to fan out of the office and
go to like more remote areas and stay in
the cafes and coffee shops and just
basically see what the connectivity is
like try to analyze the patterns I've
analyzed what apps works and what don't
so when we came in July things reversed
all of a sudden in the office the
conditions were not that great or
actually for us they were great we got
the juice
you know intermittency and bed latencies
and everything and so we asked we asked
Airtel you know which is one of the
biggest sub providers over there what's
going on and they said well is there any
more construction in the area that
happened between January in July and
sure enough there are two new office
buildings right next door said well
that's probably between two and six
thousand people there so that's what
happens you know all of a sudden new
network is congested and we're like well
what are guys going to do about this I
said well put a new cell tower in the
area but it takes about six to nine
months to put a new cell tower in the
area and so in the meantime that's what
you're going to get so that was actually
pretty eye-opening like we tend to think
about progress as linear you know things
are just improving and you know in
reality goes kind of like that right I
mean the sometimes things have to get
worse than you know before they get
better and Hyderabad is particularly
interesting in that because if you look
at this chart over there about
population growth in Hyderabad the
city's been growing really fast so not
only a lot of people coming online for
the first time adding to this congestion
I mean people moving around and you know
when that happens you know more and more
people come to one place they were well
the infrastructure point about that one
so the last data point is 2011 they've
added another three million people in
the last four years so this year or last
year they had 9 million people so they
added as many people in the last three
years or four years as they added to the
previous 10 years before that another
interesting anecdote about this if you
if you go to rural area in J as long as
you stay to a major highway when you
leave a large CD your connection
improves because you know along the
major highways your connectivity is
actually pretty decent and congestion
start getting less and less so like just
outside of the cities as long as you
stick to the major highway you actually
have really good connectivity so this is
everyday life for most people in the
emerging problem emerging markets
however the more we looked at this the
more we realize this is not really just
an emerging markets problem this is
really a subway problem this is a
crowded Stadium problem it's a crowded
conference problem this is a road trip
problem this is an airplane problem or
if you're in new york city or somewhere
around it's your bad reception in your
house so all of these
it's is it s injury issues boil down to
like when you're building mobile apps
the network is your enemy it doesn't
really matter how good your phone is if
you're on a bad network or you happen to
be in a situation Rio and a bad network
right now your experience your users
experience r is going to be pretty
terrible so when we think about how we
address this issue especially for the
network issue we kind of break it down
into different classes what are the
strategies for modern phones you know
phone is it's not a limitation it's not
a constraint but network is like how do
we deal with that and the other one is a
situation where your phone is actually a
limitation so we're going to start
talking about the strategist for modern
phone first so phones that actually have
storage for sat have pretty good cpu
influence it generally look like you
know this computers you know the desktop
computers or five years ago even better
than that so the easiest thing you can
do is cache the data that you download
so this is very important when you're
trying to especially for images and a
lot of things that take a lot of bites
over the wire but it's also important
for just simple responses like from your
servers for like metadata and things
like that and the reason this is because
you the user might wake up the app and
they might have a network connection
right now or you might have downloaded
data yesterday for a view that they're
clicking today so try to catch as much
data as possible you have the hardware
on the device you have the storage your
users will generally thank you for it
also since you have CPUs and you have
cores and threads that are available try
to pre-process your media before
uploading if you're going to use iphoto
on a site and it's going to be like I
don't know a thousand pixels don't
upload a 5-megapixel or 10 megapixel
image from the device doesn't make any
sense then throw ninety-nine percent of
the bytes away once they get to the
server pre-process it first on the
client and then upload it do it in the
background obviously tell the user that
you're doing stuff so he knows why his
phone is hot but let's do it on the
device and then make sure essentially
any time you're posting you sirrah
izing you cuties up in the background so
never require network to post data so if
I'm uploading a bunch of photos allow me
to essentially cue those up right now
because that's what I want to do it
right now and then you do it in the
background whenever you have a
connection don't make me essentially
wait look for a spinner and then use the
threads especially like for example
things like view inflation is very
expensive right it takes a while
especially on all their phones if you
need data for that view start the
network fetch literally as early as
possible maybe sometimes even on the
screen beforehand so by the time that
the U is loaded they don't have to wait
those extra 500 milliseconds a second to
do that so next use the network cleverly
so we talked about caching if you have a
good cash one thing you could do is pre
fetch data so prefetching is comes in
different shapes and sizes it could mean
like prefetch for the next 30 seconds of
interactions or three minutes of
interactions or prefetch for later on
today or if it's like a notification or
something like that so and then maximize
the usage of the network when it's
available if you have a connection right
now you know you need to get a bunch of
data for a list view or something like
that try to get it all at once there's
many different reasons for this mostly
mobile networks are bursty so once you
get a connection it's great you have
data stuff are going to come like over
the network very quickly and also once
it's done then the radio can go to see
so that will use less battery usage and
your users will be happy to but when
you're prefetching you're doing all this
extra stuff you need to make sure you
prioritize council requests if the user
switches and does something else if you
predicted that they're going to scroll
in the list and they decide to click on
something cancel all the requests that
you've currently are doing for the list
trunk responses especially this is I
talked a lot about list because i work
on you speed lists are my life so I you
know like if you need the data for ten
stories and you're on a fast connection
that's great wait till you get those ten
store
because it's only going to take you a
few hundred milliseconds however if
you're on a slow connection you only
need like two stories or maybe five rows
of data in order to show to the user so
just tell the server give me the first
five let me process it and then give me
a rest in the background so you can
return those first few responses to the
UI very very quickly these type of
things are great optimizations for just
user experience keep your request small
especially when you're sending packet
size matters usually I think it's like
one and a half kilobytes or something
like that try to fit your request inside
of that so that has the highest
likelihood of actually getting to your
server quickly and then this is a hyper
optimization but something that's
actually quite important DNS is quite
unreliable for some reason so even
though the user has an active connection
and if you connect via IP it works fine
often DNS servers will fail and its
really really lame I think like one of
the optimizations I think whatsapp or
something is done but it's like a great
way to essentially just have a fallback
if you can't do a dns resolution try to
fall back to something else it might
work and it'll be a great for your user
and you know prefetching doesn't come
without its challenges I think anybody
who actually tried that knows you know
the challenges are fairly obvious I've
been server CPU beta costs better usage
storage and it can get in the way of
your interactive interactions with the
user right even if you're trying to
prefetch when the user is not doing
anything they can start at any moment
and you know sometimes canceling those
fetches a is not cheap so you know
prefetching is inherently probabilistic
right because you're basically guessing
that the user is going to use the data
and that's where most of the challenges
are going to come from because you know
if you guess wrong you just you incur
alyss costs without any benefits so to
deal with that you know we'll talk a
little bit about that what smart
prefetching looks like so smart
refreshing because there's lots of
challenges use the cash out of
creatively it's in our app for example
when you wake up the app initially will
show you stories you've already
downloaded we're starting to ascend
she show you stories that we have in
your cash but you've never seen before
so there's no reason show you something
that we already have and wait for the
network and then this is great because
in offline mode you can still open up
our app you can scroll through your news
feed you can like and comment there
won't be any fresh stories obviously you
still need a network for that but
there'll be stories relatively recently
and then if you can normalize the data
you might have different endpoints that
return different pieces of the story
right you might have a listview that
returns like part of the data and then a
detail view that has more data so
essentially take the data from the list
view and put it on top of your detail
view while you're loading the rest of
the data so and it's if the user
essentially doesn't have to wait for
this view to load he sees something
there's not just a big spinner on screen
and google has given us job scheduler
which is made and the GCM network
manager for a pre lollipop devices which
makes all of this much much easier and
much more efficient we can optimize for
battery usage make sure these type of
pre fetches especially in the background
will happen at the same time with other
stuff they will happen on the types of
networks we want the network will be
available like I mentioned before you
can start the app in the background but
there's a very high likelihood that the
actual your request will fail because
they have mobile off or for various
reasons and then you can do things like
not proof fetch on certain connection
types so we have connection class and
what we found is that on really fast
networks prefetching is useless don't do
it it's not worth the cost because
you're you're paying the amount of time
users are waiting a so small that it's
not worth you guessing and missing and
then using resources in the background
and opt and trying to process stuff
while the user is doing something so
just don't do it doesn't matter which
type of device it is if you're on a fast
connection there's no point in
prefetching you're not going to get a
lot of benefit unless it's intermittent
as you have to do it without fine sure
there's lots of challenges and then one
of the hardest problems in computer
science is like cache invalidation so
making sure when
it's keeping your cash fresh this might
mean like periodically doing Delta sings
and be like hey has anything changed and
the server can just say like yes or no
as opposed to just redownloading
everything all the time and I the story
we're going to tell you here is the
story of comment prefetching and how we
sort of thought about this if you use
the Facebook app you know that you you
generally get the stories and then to
get to the comments you click on the
button you get the comment counts but
you need to click on the button to go to
them and for a variety of reasons you
know fetching comments is a pretty
expensive operation that may take some
time so it's it seemed like an ideal
candidate for prefetching and it does
help a lot with performance but there is
a problem even of users who use the app
a lot don't necessarily click on every
single comment count for every single
story to see their comments as a matter
of fact you know the majority of the
stories user's name don't click on the
comments I don't look at them and so the
problem is like how do you make it
efficient that's a great scenario for
like a more probabilistic approach so
it's right we're going to try to guess
whether you can actually going to read
this commented out in some cases is
fairly easy because occasionally we show
you story you've seen before but it's
got more comments and more likes in
which case we're already showing you the
story because it's got more comments so
it's good one to prefetch in other case
a little bit trickier I mean there are
different parameters that we take into
consideration and we actually have a
system on the server that does machine
learning and tries to figure out like
how likely are you to actually look at
the comment and not and then the server
sends this probability back to the
client and the client can look at that
and say well do I want to prefetch or
not depending on what kind of device you
were writing and you know what kind of
conditions you're under so that's an
example of cal probabilistic prefetching
works very well that also means that
sometimes when you're offline or in a
bad connection you know occasionally you
know you click on the comment will take
some time but you know we are generally
pretty good about this and so most of
the time when you actually look want to
look at the comment it's going to be
there for you so now strategies below
and for low-end phones is a completely
different situation here because in the
low influence you actually have
limitations of the device and you have
to worry about those constraints and you
know the biggest constraints you have to
deal with is space so it's a challenge
but if
you're targeting low-end phones one of
the biggest hardship users have is that
very low disk space so often upgrading
your app or downloading a new app is
very challenging for user have to delete
one of the other four amps that they can
have on the phone at the same time so
developing an app that has a lightweight
app footprint is paramount for these
type of phones I next caching is a
premium again very low disk storage on
the device so if you're taking up
another hundred bags the store images
that they may or may not see that's not
going to be a good trade-off for the
user and honestly in for most of these
users the mobile website is their fall
back and it's like oh I can't install
this app I really want to use this
feature the service this this website
I've heard about i dont have space to
download or I don't have a good enough
connection so make sure you have a good
mobile website and by good i mean not a
desktop web applications to fit inside
of the window you really need to have
one that is specifically focused for
these type of users in these type of
devices they're the ones most likely to
use this website so to take a term from
web development you should essentially
build progressively enhance site
essentially make sure your site has the
features necessary without JavaScript
without CSS because these users might
have turned that off because it's slow
for them and then a new thing that as
come out in last year is that you can
essentially have many of the benefits of
native applications using push
notifications on mobile websites so
we're going to talk about the push
notifications a little bit later so you
won't have to deal with these type of
phones our networks these are a little
bit older than what we're targeting but
it's still best to send as little data
as possible over the wire we're talking
about no meta data at all if you're not
rendering on this screen at this exact
point in time do not send it over the
wire focus on like essentially formats
jason is a great format for developers
it's kind of verbose when it comes to
devices so other essentially binary
protocols such as like proto buffs or we
use flatbuffers that allow you
essentially to send bytes over the wire
and data over the wire without having
the paidhi serialization costs and so
that goes back to pre processing data on
the server don't some metadata if you're
concatenated a bunch of strings don't do
it on the client do it on the server
minimize background work and I 0 because
you only have one core so it's going to
interfere with things that are happening
on the UI it's going to be pretty crappy
and then minimize the number of
simultaneous requests often on 2g
networks and low in networks you don't
have the available upstream bandwidth to
send multiple requests at the same time
so essentially throttle yourself to one
request at a time yeah you know some
things you just can't do like a low-end
devices or at least we have to figure
out a way to do that for example how
would you deal with intermittency like
if you don't have the cash space and you
can really pretty catch ahead of time
pretty hard but you can you can do you
know fairly well with in situations
where the network is just is just slow
so the tail here is the mobile web and
push notifications you know the one
thing I want to mention about mobile web
is there is a misconception that you
know on Android you know mobile web is
going down in terms of numbers and the
native applications are going up and
actually what what's true is both are
going up like it's a lot of users are
switching from future phones I mean a
lot of them are switching to devices
which is just you know not powerful
enough to around some of the some of the
functionality we have in the main app
and you know they opted for using the
mobile web instead and you know we think
we think with for some devices is a
perfectly great solution to do that so
the usage is growing for both of us and
I think for most other apps that that's
true as well and push notifications is
just really exciting topic because up
until this year you know what push
notification the browser you know what
did that come from right and so this
year we actually were originally
partnered with the UC mini and UC
browser which is a very popular browser
in China and India to to provide push
notifications and you know we did that
for with you see mini and then we
the Opera and in both cases we saw just
a tremendous response from from the
users I mean they just you know very
active push notifications the great
functionality and so they visit the app
more often and then we work with google
google is very interested in building is
a platform feature and they did that i
mean in chrome right now you actually
can help different apps do the same
thing that we did and provide push
notifications for them so they have a
platform and apps can actually do that
now in this seeing similar response for
all of them i mean they're just been
great for users who you know can't have
a native app installed on the on the
device or prefer to use a mobile web
instead firefox is the last major mobile
browser and I mean they announced
recently that they support for push
notifications also coming sometime this
year so everybody is moving in the
direction that's pretty great yeah I
mean I think we've had a lot of
materials we have about 15 minutes more
or over sort of more material to cover
but we wanted to stop and see if people
have any questions before we go on about
the material we just presented if you go
have general questions they can also
come out afterwards anybody oh there's a
question
right right right so the question the
question is like a lot of stuff here is
pretty high-end you know like a mere
visualizes the 0 power and require a lot
of development work for companies were
just starting to think about the mobile
market the emerging markets like what
are they what are they you know the
first few things they could do to make
things better oh come on they could sure
I think a lot of the things that we're
talking about things like caching data
and and optimizing for your app not
being online at this very second are
kind of just user experience and those
are just you just have to be in those
have those assumptions when you're
building your product it's really hard
to go back afterwards and being like oh
I'm gonna redesign it to work in these
things it's quite challenges I
challenging I know we're doing it but
for its when you're building a for a
small company you can move much faster
and you can do a lot but things like
caching data it's not hard like images
and things like that that's no brainer
type stuff prefetching and lists and
things like that are also not
understanding your users and their flow
understanding who your users are so
implementing connection class in your
class just purely for your analytics
first that's actually most important
what we found just implement it as part
of the analytics try to understand
what's going on and then optimize for
scenarios that you see like you you
might see a login flow is like broken
and has a huge drop off on your class
2010 devices so you can grab a your
class 2010 device and then optimize for
that as opposed to trying to do
everything up front which is challenging
so data first analytics first and then
like find the big problems in your app
yeah and there's no way open source
things like here class a network
connection classes too because like a
lot of engineers were you know in other
companies were asking hey what can we do
and we thought that would be useful for
them as well but I mean there are some
you know basic Pfizer's Alex at no just
so just cashing and we're going to talk
about a few things or like right now
some tools and some ideas that we've
essentially built into our apps to
essentially solve this issue because it
is a very difficult problem any more
questions before my one
alright so moving on to testing like you
know where you know most of us are here
we have the connections that we have and
they're pretty good how do we test for
bad networks how do we test for how the
apps work our apps work on bad networks
so one of the things we built last year
is called augmented traffic control and
it's a tool we've open sourced it's a
server you run on one of the computers
in your office and then it provides
essentially you connect to it via Wi-Fi
on your phone so essentially all the
traffic from your app or other apps on
your phone could go through augmented
traffic control and then there's presets
on there so you can for example see what
is my appt feel like on 2g in rural
India or when there's a black hole and
I'm sending packets out and everything
is telling me I have a connection but
nothing is coming back how does my app
behave in these type of scenarios so
it's it's all open sourcing you guys can
look it up but essentially it's just the
server somewhere with some simple
software that will both handle like
latency bandwidth and also things like
intermittency so like you know some
requests will be faster than others
they'll be bursting things like that
some more complex modeling I'm next
genymotion is out here and there a great
tool and a great emulator so they've
built on the ability to throttle your
network and they have presets like 3G
and 4G edge so you can easily see what
it's like I actually got stuck on one of
these modes the other day and I was like
why is my apps so slow everything is
loading and I was like oh I'm actually
on edge I was like this is what people
are feeling every single day it is
terrible I'm sorry and then there's also
the android emulator and it it provides
essentially parameters you can pass in
to tell it i want to be on edge i want
to be on gps ought to be a Wi-Fi and
then like what the actual delay and
speed is for those networks
so I mean to a lot of this technologists
I mean the I mean they sort of Wi-Fi
throttling technologists or you know
some variations or that and Wi-Fi
problem is used by other companies well
HTC is not the only solution for that
the tricky thing about Wi-Fi throttling
is it can really dog food you can test
but you can really doc but you can't
just take that on on a bus and try doing
things right or like things you do in a
daily live and you know doc pudding is
very important like when we develop our
apps we rely on Doug putting a lot to
sort of understand how the features feel
and how they work and so that's a
challenge because you know with Wi-Fi
throttling in atc we don't actually get
that so we have a couple of ideas and
like think to cut a solid and one of
them is VPN prattling I mean just
building a VPN app which can just
throttle you as well and compel you all
the time and all the apps on your phone
all the time and you know it can work
with a cartoon network and then just
rattle it so that's one doc quitting
solution but another one and just do the
question about how do you do simple
things is a you know don't underestimate
the power of a sleep statement right in
your app if you just you know if you
just have it forward for the dog food or
so for the engineers where you just slow
down your network calls all of them I
mean that's actually a great way to
model latency you know just grab a
permit risible so you can change this
you know but that's that's one way to do
that and another way another way simple
way to do things like to for example to
demonstrate what intermittency might
look like I just fail it ever calls you
know you're not going to get the entire
you know like richness of how the
network's work and how many ways they
can pale but it'll give you basic idea
what happens our network all starts
failing randomly and how they up can
handle is and the story I want to tell
tell here is a story of 2g to use this
which is something we started doing
internally and we basically use those
techniques just you know a simple sleep
statement to get the latency and they
you know just have a randomly return
network failures even if the network is
perfectly fine and then we being
employees every Tuesday if you are on
Android device and we ask you if you
want to come in and and you know
participate in the 2g to use this and
when you do you get those licenses and
you get those intermittence again not
I original's but you get enough to
actually generate a lot of interesting
bugs so obviously users are encouraged
to use and doc put the app here as long
as they can as long as they want to and
that's been a great source of bug
reports things which we were otherwise
would not have found until they up and
into the production and it's also a
great way to build them with the like
Alex was what was talking about like I
know nothing like just seeing a view
like that you know for 5-10 seconds to
sort of understand what the problem is
and really really feel the empathy with
the people who could have to go for this
every day so next my favorite thing
because it's actually the solution to
all these problems is configuration so
we build our apps and we usually
optimized for a certain scenario usually
our scenario I open the app and I click
these buttons and it works and I close
it and I'm like it's done it's works I
guarantee it then we ship it and someone
clicks and then it breaks and you're
like why did you click it that way so
yes we're terrible at this however
constants are bad that's what we found
is that I like the quote the only thing
that is constant is change so we
essentially have allowed most if not all
of our features of our app to have
parameters for everything that could be
configured so things that would normally
be a static final const in your class is
now a parameter it's still a const but
it could be overridden on the server and
so what we do is then we allows us to
optimize all sorts of different
interactions and feelings inside of our
app for your current device like we
showed less images on screen depending
on like you're not only device size but
you're your class that's there's some
devices that have big screens in very
little ram it is really annoying some or
if these devices don't have a lot of
disk space we reduce the cash if an
animation we think is really cool does
not perform well we can just turn it off
on certain devices it's like Oh your
class 2010 there's no point in making
the user sit and
watch a stuttering animation we just
turn it off and show the screen and then
we can optimize for the current Network
which is some of the most powerful stuff
that we've been able to do so what
examples being like having fewer or more
concurrent connections when you're on
Wi-Fi make all the requests at the same
time it doesn't matter if you're on 2g
make one request at a time if you're on
2g download an image resolution that
will load an appropriate amount of time
even though it should be 500 x 400
pixels if that's going to take you 30
seconds to download no one's going to
wait there 30 seconds for this image to
download download a lower res version to
at least show the user in 5-10 seconds
and then you can I i mentioned chunking
before you can change the chunk sizes
and then when to prefetch don't prefetch
on fast networks prefetch more on low
networks etc so experimentation is good
once you have all these parameters step
number two and it's one of the more is
it's harder for smaller companies but
you can start out small essentially
start running a B test with different
parameters don't assume you know as
developer I know this is how our user
should use your not Steve Jobs like you
need to like to make sure your app works
for the scenarios that your users are
actually using so when you're looking at
this data don't settle for the average
make sure you use the analytics
available to you your class connection
class country to really make sure that
you're not hurting a certain segment of
the population it might be on average
good but it might hurt a small segment
of the population really bad we found
for example out of memory errors for one
feature was really bad on one thing even
though for overall it increased
engagement and things like that for
other people and then once your you've
done that you're not done like you're
never done especially if you have an app
that has a long life cycle and is living
over several years the people who are
using your app will change over time you
know there'll be early adopters first
and then they'll be like grandma's later
they use their app different ways that
they
have different patterns you have to make
sure that what was true a year ago is
still true now and I'll tell here is a
tale of mobileconfig which is basically
our configuration system for doing these
things the key part of the system is we
actually want to push a lot of those
parameters from the server so we can
quickly adjust them or use the power of
the server to do analysis and decide hey
for this type of users this is the best
value and so that's precisely what we do
so different users can get different
parameters in different values so the
behavior the app especially
infrastructure side adjusts to what we
think is best for them based on
experimentation that that system allows
us to experiment on things in anytime so
even if we are you know pretty sure that
this is the best configuration parameter
it might not be the best configuration
parameter six months later so we can
repeat this and do it again in the
meantime I mean sir we'll just feed your
constants rises from the client
perspective it's just something comes
from from the sky and they just use that
right what how it's actually said is not
it's not relevant and you know one
tricky thing about this you know mobile
world especially in android people don't
upgrade very quickly I mean you still
have a lot of old versions out there and
you know you have to sort of honor that
so if you ever build a system like that
you have to worry about versioning and
making sure that you can deal with that
there are many different ways to deal
with that you know and but that's that's
one of the problems we have to solve and
then sort of going beyond a/b testing I
won't talk about Facebook better it
subtly on the high under what you can do
but it's pretty exciting for us so we
wanted to mention that it's a it's built
by Facebook research so a lot of the
stuff is you know pretty complex so we
just want to talk about so the basic
things involved in the system it's an
advanced experimentation framework it's
common in the industry it's called
multi-armed bandit that happens to be
the facebook version of that the
facebook bandit what allows you to do is
to experiment with a large number of
configurations and it's very quickly
decides how to narrow down to just the
configurations which are likely to
produce the best results it's also very
quickly decides how to fraud
configurations which are producing
results which lasts which are worst in
the status quo which is important
because you don't want to you know have
experiments out there which actually
degrade user experience so that system
helps
to get get there quickly and it allows
us to optimize for competing variables
you know quite often for these
configurations you're not just thinking
about one variable a great example here
is data usage I mean you you do data
usage so your performance improves and
users spend more time working with the
app than they do look in the spinner but
data usage itself is of course at one of
the parameters and you don't want to
drive that value too high and the the
story here is the story of how we did
the prefetching while scrolling so as we
scroll through the newsfeed we prefetch
stories ahead of time because we don't
want you to hit that moment where you're
sort of visibly looking at the at the
spinner while we're trying to get the
next set of stories and originally when
we did this we just said well you know
we'll just a bit test look at a few
values and we find out that generally
worldwide 10 is a fantastic number it
needs to be and it could be the best
number and we just will prefetch 10
stories ahead when you have when you're
10 stories from the moment where we
don't have any more stories we will go
ahead and prefetch and then when the
Bandit came onto the scene we decided
that we're going to run this for the
Bandit and so we can figure out know the
best configurations for different
networks in particular because we had
this crunch that from the different
networks we might get something
different and bend it actually went for
27 different configurations a
configuration something like that like
little matrix over here different number
of stories that you prefetch ahead for
on different connections and 1st they
sort of random and look at what their
usage would look like from different
configurations but the real interesting
thing here is optimization for multiple
parameters because yeah you can reduce
data usage by doing fewer than 10 but
you want to do that in such a way that
users don't end up you know looking at
that spinner because they coat the
entire work is there to make sure that
you can actually get to do the stories
before user gets to them and so they are
the engagement continues to be Kai
because engaging with the app instead of
waiting for the for the stories to load
and so when you when you actually map
this 27 different cases you see this
pattern which you know peretta frontier
is just a fancy word of saying like for
all the other configurations here there
is a better configuration where you can
improve on one axis without sacrificing
anything on there
right and so the tool helps us to figure
this out and actually turns out that the
relatives for different values of the 27
that are like that which cannot be
improving your father and one of the
other access to them I extreme you know
you can obviously run with no data usage
but then you're not going to get much
out of this or you can just say you know
you're going to get a lot but data usage
is you know is still a concern and you
have to worry about and then you just
down to two values and then then you can
I be test on these two values and figure
out what the best value is and I let
Alex finish on that because that was one
of his projects yes so we started off
with 10 that seemed like a good number
we tested out 27 different configuration
and what we found is that 10 was
actually a pretty good number we did a
pretty decent job for certain types of
users and it didn't hurt anyone else but
we could actually optimize when you're
on good and excellent networks to
prefetch less aggressively so this
actually reduce data usage for these
people dramatically because now they
didn't essentially download things that
didn't need and also decrease server CPU
we saw like what is that fifty-seven
percent of users we're on Wi-Fi so
fifty-seven percent of users used to or
some percentage of their 57% used to
prefetch relatively aggressively when
they didn't need to so we were able to
drastically reduce server CPU which
costs money without actually hurting
engagement no one saw any more spinners
probably no one noticed so then we just
now have one set of values but we do it
based instead of 10 we now do a based on
connection class so you can see we
actually have a JSON configuration
option object that looks exactly like
that we say when you're an excellent use
free when you're on good use 5 and these
will change right you might be on an
excellent connection now and you turn
off Wi-Fi and you go walk out the door
and now you need to do another fetch now
you get the value 10 so it's these
values can change over the life
of the the app and that's it that was a
lot that's that's our presentation so
thanks very much for coming and</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>