<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What are you doing on the tiny mobile Network? (Big Android BBQ 2015) | Coder Coacher - Coaching Coders</title><meta content="What are you doing on the tiny mobile Network? (Big Android BBQ 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>What are you doing on the tiny mobile Network? (Big Android BBQ 2015)</b></h2><h5 class="post__date">2015-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PxQl56aJ09A" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm gonna tell you a little bit about
myself
senior Android innovator at Home Depot I
work on a lot of different stuff the
women techmakers lead for Dallas Six
Sigma Black Belt Intel innovator a bunch
of other stuff that you don't really
care about because you're here to learn
you don't care who I am but there's some
contact information and things like that
in case you want to ask me further
questions or throw me extra tips and
tricks I'm always up for hearing like
what kind of creative solutions worked
for you so here's some of the biggest
issues that we face with mobile networks
on applications large unfiltered images
your API is servicing new stuff that's
meant for desktops it's not meant for
tiny screens but you have tiny networks
so you need a way to make those things
tiny right so we also have issues with
on track data usage do we really need to
be constantly hitting our are like
usability API when the users not
actually using the application do we
need to constantly be tracking what
they're doing while that it's not even
active probably not you can have not
optimize network handling so are you
putting your batches of bundled data
together or are you just constantly
hitting it whenever you want to and just
bad API designs not using the Android
tools and one that's pretty pretty awful
that I see fairly often double the API
calls why do you need to try it twice
and it's one of those things that's can
be hard to figure out if it's happening
or if it's not so I'm gonna show you how
so how do you track your application
data you can use the Android tools which
Google has been really great about
giving you instructions on how to do
that but there's more stuff out there if
you're watching for your API in
responses I'd strongly suggest that you
use something called Charles proxy it's
not free
but it's worth it especially if you need
to check are you sending the correct API
data and are you getting the right
return data is your stuff formatted like
you supposed to be or is it kind of
jumbled T now I'm not gonna cover that
in this discussion I'm just giving it a
props so that you guys can actually go
and look there's a ton of great
information already out there for
Charles proxy so we're gonna be talking
a little bit more about detailed
tracking of network data now we've all
probably heard about Wireshark but you
probably haven't heard of something
called the application resource
optimizer which is commonly known as a
ro by 18 T and it's the easiest thing
for you guys to use who are not used to
tracking stuff down by looking at oh
this packet had X Y Z let's let's kind
of go into that a little bit so we're
just going to say this is how you
capture a pcap which is the file that's
actually used to insert into the tool
and this is where I kind of say having a
rooted phone for development at least
one of them around is always super
helpful because it's a lot more of a
pain in the butt to get the same
information from a non rooted device but
you can see it's pretty easy what you do
is you basically stop all your other
applications from running that are not
part of the core services and just run
your application while you do that you
make sure that you have this this file
being generated by TCP dump and then
from there you just copy it off the
device after you've done what you need
to do and we also you got to specify
which kind of interface you're using so
you're using Wi-Fi or using cellular
networks so you'll actually see that if
you do like an IP addr that way you can
see you know what network interface is
actually active and what are you
actually using so download and install
think you guys can figure this out but
this is more just for reference material
again these slides will be available
after this discussion so what do you get
once you put your file into this magical
tool well the first page gives you this
lovely summary
of exactly what is good and what is bad
and what we can see here is hey I've got
green checkmarks across the board
everything looks pretty good there's no
major flaws there's no major issues
popping up that's this is kind of a
dream situation now granted we could do
a little bit better on that tree score
because 663 out of a thousand isn't
amazing but it's giving us hey we have
no major flaws no major issues and if
you are just making sure quick glance
you maybe added a new feature you can
pop it into here
go Oh everything looks cool all right
that's my smoke test all right so let's
just say there's a blue competitor that
wanted to track our stuff against to
make sure that we were kind of ahead of
them in the retail industry I think it's
kind of implied who that might be
but just as you can track your own data
you can track your competitors data too
and you can track exactly how good
they're performing and where you're
actually going to be able to either even
learn from their mistakes and be able to
figure out what they're doing right if
they're beating you out in certain areas
so what's something that we see kind of
going wrong right here now I understand
the the actual text is pretty small but
we can see that oh there's not good
cache control that means there's not
cache headers on some of those assets
that are being pulled in we also see
that hey maybe these images are pretty
big that really shouldn't be happening
now for both for both as a comparison I
performed the exact same search on their
app as it was performed online and then
also tapped on an item after the search
fully loaded the page and made sure that
before doing so we loaded about a
hundred search results so this is the
exact same data in terms of user
interaction on both sides so we also see
oh my gosh there's they're not many
fiying any of their json CSS nothing
like that some not not just like any but
you know there might be an issue with
one or two things so ooh this this is
what it looks like if you scroll down on
that summary and you have an issue it'll
be a nice big red box that tells you
what is wrong and maybe even how to fix
it
so here we're saying that we just tested
it doesn't look like you have the
presence of cache headers now that could
be an issue down the road because what
if somebody needs to go back to that
resource or you have another thing that
uses that same resource that has to be
redownload 'add and that can be a pretty
big thing so why would you do that to
your user when you're within the same
session
I can understand getting rid of it after
the session is over but you're you're
still there so why why not hold onto it
so here's the other issues that we saw
and this is where it kind of gives you
that information and you can see I've
blurred out any of the people that might
be involved so you can see that the
images are a little too big these were
the images that it pulled up these
actually looked to be desktop quality
when I actually went to those links and
looked at them which can be really nice
if you have a very high quality device
but I was testing on a couple of
different devices and some of them were
not high quality devices so it ended up
taking up a lot more space with actually
no no positive outcome from it right and
again the minify of of all of that you
could have saved 7% just by getting rid
of empty spaces seven percent of that
whole string could have been saved
so what's another thing cool thing that
you can do with this tool is you can
actually dictate your own profile so if
you wanted to track something that was
maybe a really small network you have a
certain set of parameters that you're
exactly trying to meet in a certain set
of conditions
you can actually tell it exactly what
you want to have happen is your target
okay I only want to use like 95
millijoules of energy to perform this
transaction am I good or am I not so
this can actually give some of that
information inferred based off of
knowing how much power is used by the
radio and you can actually set that so
it makes it really easy for you to test
this in the future so here's kind of an
overview of what our data looked like so
it's showing a lot of unknown now
normally it would show a lot of like
images JPEG or images PNG but we're
doing some things to kind of obfuscate
some of that and do some actual data
batching to make that a little more
efficient so it's not going to be
immediately recognizable that hey that's
a jpg file but you can see you know
doing a lot of search results we got a
lot of JSON requests and we can see hey
you know it moved pretty fast we weren't
using a crazy amount of data and that it
generally looked pretty good right now
if you're familiar with Network Monitor
the Diagnostics are going to look very
very similar so we're looking at this
from a forensic point of view and you
can see exactly what happened when I was
going through various points so when I
first load it that's the gray then we
have the first burst of the big red
which is me performing the search then
there's some little dots for loading
extra search result data when going down
and scrolling more and fetching and
getting that stuff in and then you can
actually see up when do I actually tap
on tap on an item and then I tap on an
image of the item so I like got to the
image page and then I tapped on like the
big images right so you can see exactly
what that was and you know what was the
amount of time that I was actually using
what they call RRC basically it's how
much radio time were you using was it a
lot was it at the whole thing of the
bandwidth at once and it really wasn't
you can see it was kind of yellow and
kind of green and when you're dealing
with a immediate user
interaction well you are the forefront
application that's actually pretty
awesome it's quite a few of them will
run very very read to do the same same
kind of thing and you can also see at
the bottom that you actually get you
know what ports were what were your
endpoints what traffic was going where
and how much of it so we have a
statistics page it as well so we
actually get to see how big were the
packets that I was sending how long did
it go how fast was I running and what's
kind of my score what what did I do
really well it and what can I improve it
so in this case I really could improve a
lot on my tightly grouped connections so
holding one connection and then not
maybe having a whole bunch of different
server requests of a bunch of different
endpoints would probably increase some
of my efficiency right I know it's hard
with external libraries and things like
that to kind of make that work but it's
it does give you some niceties down the
road now also signaling overhead that
means I had a lot of headers I had a lot
of other stuff and things like JSON
certain API requests that then I could
improve on right so now we get down to
something that I am super passionate
about all right compression is your
friend it is always your friend it is
never not your friend unless you're
unless you're doing encryption too but
that's a whole different thing
filter your images people filter them I
am so sick of seeing 40 megabyte PNG big
photo downloads that have no reason to
exist on a mobile phone even if you're
doing mobile editing of the actual
pictures there's no reason for it so why
not use something that's going to be
giving you the exact same experience for
the customer but it's so much more
efficient in real life you can actually
take a 42 megabyte PNG image and bring
it down to about a hundred and eighty
five kilobytes and that's at something
that is quad HD that's a quad HD image
so that's the nicest devices you can
pretty much buy now not counting the 4k
ones because that's ridiculous
nobody can see it it's using a lot of
battery it doesn't make any sense
right am I going well apparently 7-inch
phones are a thing now but but in this
case you can actually get what is
considered 85% quality that means you
have a 15% compression applied that
basically gives you almost all of the
exact same quality is what you had is
for the PNG file now there's some
downsides that right so JPEG doesn't
support transparency so when we're
looking at something that does support
transparent to see what are we also
looking at now you're down to PNG or web
P what P is awesome
I just wish web P was supported on more
stuff because most of us who live in the
real world have a situation where those
mobile assets have to work not only for
you Android team but maybe also for your
mobile web team and for your iPhone team
and you have to be able to design
effectively especially if you have
limited resources to make sure that
that's that's an actual thing I know we
all are going oh we've you know praise
praise web P and I understand it's great
but the real world sucks sometimes and
this is one of those scenarios right so
it combines the best features of JPEG
and PNG into web P so you get the
compression and you also get the
transparency but you know if you have
stuff that needs to go to somebody else
good look but let's also look at this so
there's different types of color space
that you have to work with so when we
look at regular images that are stored
into memory on Android they're going to
be Arg
be 888 that's just the way that they
load it always takes up the same amount
of space you save nothing on memory
loading by using these smaller
compressed images they will always take
up pretty much the same exact amount of
memory doesn't matter which of these you
pick this is just helping you on
transport you need to use something
bitmap options when you do loading of an
image to make sure that you're using
only a certain amount of memory but I'm
sure most you guys know that because the
out of memory error sucks and it really
sucks to see it on your log reports
right and images are one of the biggest
things that will cause those things to
happen especially full-page images right
and you know somebody who's got a $50
phone they don't really think about the
fact that well maybe it might have some
issues cuz it was $50 phone and stuff so
let's think about this if you need
transparency you basically need to look
at a RGB either four four four four or
eight eight eight eight eight eight
eight eight is full everything right but
what would a RGB four four four four be
good at it's really awesome at
simplified iconography something like a
lot of the material design pictures
photographs things like that do amazing
and look exactly the same if you look at
the a RGB eight eight eight eight versus
the four four four four and you've just
saved a ton of bits by doing so you've
essentially cut your package in half
it's awesome but okay well I don't need
transparency but I would really
appreciate having all that nice little
compression you thing going on without
losing anything right so we're not
reducing the color space we just take
away transparency and that gives you the
RGB five six five so you get full color
get all the nice gradients that you
don't get in a RGB four four four four
but it gives you all the same things
that you would expect in a JPEG image
just you haven't even gone to the loss
loss loss
compression at this point so if I asked
you what to use on a certain thing you
now have a table that you can take to
your ui/ux guys and say hey look at this
which one is it
so here's the too long didn't read for
image filtering basically JPEG whenever
possible or web P if you're so lucky
that you get your own api's if you have
iconography 4 4 4 4 it right compress
all your images I need to say this once
twice three times compress them ok
everybody as a group compress your
images oh that was really lame come on
everybody I want you to believe this
mantra compress your images alright and
don't be afraid to use lossy formats I
know it can be a little bit daunting and
you know if you have a UI guy who's just
going oh this pixel looks looks ever so
slightly little little messed up or
whatever well you know he's probably the
only guy who's holding his phone right
up to his eye so hey it's it's ok you
can get virtually the same effect by
just cutting out some of the extra that
you just don't need for rendering
purposes if you're doing a photo editing
app different problem this is not the
session for you Google photos people do
really good work on that I don't know
how well they how they get that to load
so nice but I'm sure they have a lot of
people doing it and compression on the
network is not compression in your Heat
right so it's gonna load the same size
no matter what and you know what else
should probably design your API is to
handle multiple screen sizes so now we
need to go to how do I make that so I
can track for all those different screen
sizes and networks kind of at the same
time right so you need to adjust it
based off of your network type this is
code use it it's a broadcast receiver
tells you when stuff changes different
networks and it gives you a little speed
value either 0 1 2 or 3 3 is fast 1 is
not very fast 0 is nothing and it tells
you and it gives you the ability to make
just a simple call hey what's my network
currently look like so if you're looking
at this I mean it sounds really cool
right but how do you actually take this
and make it look like real things right
so if you look at that giant image on
the left those are all of the popular
screen sizes in Android and their
resolutions we're not even talking about
stuff that's old this is stuff within
the last two years so that's a lot of
different resolutions and a lot of
different scales that that you have to
account for as a developer now when you
think about full-page images ads
proportions making the user experience
feel the same between all of them it's
kind of a big deal right so how do I
take that and condense it down to
something that I can handle give into a
UI guy and not having to explain a lot
really what you can do is only worry
about three main sizes and this even
includes your iPhone and Android and
mobile web rendering pieces it can all
be convergent you really only need to
have them make it in three sizes those
three sizes are 1536 by 1904 which is
essentially your 4 by 3 which also works
on iPad whoo-hoo okay well especially
some of the older ones it's nice and
then 1440 by 20 to 68 and that's
accounting for the navbar so what we
have here is basically 4k with navbar
and 4k with hardware buttons and those
are just different different scales now
what's cool is that basically most of
your iPhone stuff will fit into the 16
by 9 4 quad Kay
quad-hd scaling and you don't have to
worry about that as much so basically
your images for Samsung's you can
basically make them work on your
iPhone's too so here is wonderful
predetermined high high medium and low
settings for these different ratios and
what devices they might be on right so
you can actually take these values and
directly integrate them into your own
system now this was based off of what we
considered in scope as far as devices go
so this is stuff that we wanted to
target we want to target really high end
when we target really low end to because
we know that not every guy who works in
construction wants to have a $500 phone
that's gonna break you know you drop it
once it shatters so having something
that's a little more durable but maybe
not as high performance we still need to
take care of that customer so these
values super useful those are the three
main scales and that way you can just
have it resize you can actually script
this all in something like image magic
so that you get all of that stuff
already coming out and your UI UX guide
never even knew that he did it so here's
another technique that we need to talk
about it's called data batching we need
to put our data together when we're
using mobile networks or when our users
are moving around so we can bundle it
ourself so you wait to offload bigger
data sets till the user is on Wi-Fi or
some sort of bigger network especially
if you're not the main app at the time
JSON is not very efficient XML is
terrible they've basically made these
human readable formats which means that
they have a whole bunch of extra stuff
that the user doesn't care about and
that honestly in a lot of cases you
probably don't need but I know it's hard
to get away from this because a lot of
API is use JSON it's really easy to use
yeah it's really easy to use but even
CSV is more efficient and there's
already tools within Android that allow
you to take advantage of some of these
batch data files and binary
now you can also do bundle together and
you can best thing to do is to do both
at the same time so you can use the GCM
network manager and just look at their
API for that and Android and that way it
will automatically bundle your pre
bundled data in with other things so
that it uses up less radio time and it
better tracks against like faster
networks especially when the user isn't
actively using your application so too
long didn't read API structure use lower
quality images and lower quality
networks time to the user matters you
only have a few hundred milliseconds
before they notice your app is slow and
they don't think about the fact when
they look at it they think your app is
slow they don't think hey
oh my network sucks or my phone is low
that's not what the first thing in their
mind is so even if you need to get a
lower quality image because you're on a
lower quality network and then be able
to move it to a higher quality network
when they get there and reload that
image that's fine it's actually going to
end up creating a better experience for
them in the long run now it's also kind
of nice if you allow your users to
dictate if they want this behavior so
somebody who's like an interior designer
with something like the Home Depot app
would maybe really care about getting
really high quality images all the time
maybe they don't want this network
optimization giving them the ability to
do that and say well maybe I have a
really really small data plan maybe I
always want low quality images right so
there's different ways that you can help
get more users to continually use your
app so you need to batch your data
especially when your application is not
the main application up and use the GCM
network manager it's really easy and
even for your regular data having it
batched like that it works pretty darn
fast
there's very few issues that I've
encountered with that so thank you
everybody
so just special thanks to Google
developers Android performance patterns
and big Android BBQ team and Home Depot
that I work for and they let me be here
so that was pretty great I'm not at work
today it's awesome okay but yeah so I
have a question for you and it involves
prizes so what's the name of the tool
that I was talking about that makes it
really easy for people who don't
understand networks to understand
networks all right you were the first
guy what a ro can you actually name the
full what was the full name of it not
just aro what was the full name okay
you'll get one but here you guys both
get one it's okay come on up you can
have and then I'm gonna ask some more
questions yes it is all right so if you
were paying attention fairly recently
how many aspect ratios do you actually
need to care about for your images three
well somebody's don't just see it okay
you three okay there you go okay so if
I'm looking at this correctly hmm
what's my TL DR okay what image format
should you be using for a majority of
your images that don't require
transparency so you gentlemen we're
right yes you are the first to raise
your hand or well you're you're correct
either way so our jpg or web P
so I would accept all three but this
one's got your name on it buddy
and everybody gets a Home Depot like
football foam football over here so
everybody wins this is America
apparently we're all winner all right
sir
so what's the name of certain API within
Android that makes it really easy for
you to bundle all your data be I in the
far back you win sir the final one is
for you so does anybody have any
questions
oh wow okay lots of questions you sir
you're gonna have to repeat that so I
have looked at that a little bit really
so yes I have
it's just that having that implemented
I'm unaware of anybody who's actually
like moving towards that at this point
so I mean it'd be nice but it's just not
not happened at this at this stage I
don't think all right any other
questions
yes it's defined by that because it's
because it's hard to pull data from as
to what your exact speed on that network
is at that point there's some tools that
allow you to do that and I've also done
direct tracking so for those those
numbers those are based off of me
basically using nu T TCP to test against
my own servers to see ok what does this
look like what does that look like where
possible but it's very unless you have
something that's constantly pinging
you're never gonna know exactly what
time responses and how quickly
something's moving without actually this
this you get for free this is
information that's broadcast by the
system and that you can just plop it in
and you can immediately make the best
inference that you can as far as the
network quality goes and you know also
be pretty smart when it comes to how
you're actually putting stuff together
so my average speed when we were using
the application was only like 43
kilobytes per second that's pretty small
right so that means that that could
actually I've made it so that I'm not
constantly hitting big numbers and I'm
using as little network as I can even
though I was on a super high quality
network right by condensing things I'm
able to make that happen
see you can you can do both this is
basically just a and if you have
something that's critical like that it's
probably best to do both but it's extra
computational overhead and that
something like this allows you to
especially when you're not the primary
network sorry they're not the primary
application up maybe you're just making
sure that that user session stays active
or you're passing back just some metrics
that you collected while they were
actually using the application but maybe
you didn't want to interfere with the
application being used at the time so by
kind of understanding that hey I'm not
on a great quality network I'm gonna
wait until I see this number pop up then
I'm gonna try and shoot it right and you
can also use job scheduler to kind of
help with some of that too this is just
kind of there's a whole bunch of
sessions that Google is done on job
scheduler that you might find really
really nice and actually I really want
to go to do it Joanna's doze thing at
some point but I know it's like
happening at the same time but does that
kinda under answer your question a
little bit all right cool any other
questions so I found that WebP equality
is a little bit higher than regular JPEG
but I think it also depends on what
compressor you use on your JPEG I'm not
super great at knowing like everything
I'm not so I'm a little bit of a pixel
fiend so I'm definitely like we have to
have quiet quality assets but at the
same point in time you have to determine
what is worth the quality and what isn't
so maybe a maybe a square that's just
like a background square maybe that
doesn't need to be like a high quality
square you know okay but maybe something
where it's like a picture of a product
or a picture of somebody
that needs to be high quality so you
need to kind of determine what that
needs to be based off of how it's being
contextually used and it's always
different in different organizations too
so retail I always make the product look
good signage look pretty good but it
doesn't have to look nearly as good as
the product does the product has to look
like oh man I want it so bad you know so
so there's just different ways you have
to handle it based off of that any other
questions
yeh all right what is the mantra
compress your images everybody compress
them so thank you so much for coming and
I super appreciate it you can feel free
to come up and ask me anything else if
you wanted to privately</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>