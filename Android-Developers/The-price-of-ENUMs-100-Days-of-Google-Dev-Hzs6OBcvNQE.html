<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The price of ENUMs (100 Days of Google Dev) | Coder Coacher - Coaching Coders</title><meta content="The price of ENUMs (100 Days of Google Dev) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The price of ENUMs (100 Days of Google Dev)</b></h2><h5 class="post__date">2015-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Hzs6OBcvNQE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">one of the most common questions we get
about Android performance is about using
enums in your code I mean this question
pops up literally everywhere on Stack
Overflow Q&amp;amp;A after our talks and even
during casual lunches at the local food
court
anyhow my name is Colt McAnlis and enums
in your android apps are both tricky and
not so tricky which is why there's some
confusion but a little history here so
back in 2009 there was a webpage on
developer.android.com that said to avoid
using enums for performance reasons but
then it mysteriously disappeared for a
while without really much explanation
and then of course it came back later
but in a much smaller state so what's
the story here
well the truth is a little bit nuanced
and has everything to do with the
difference between performance and
memory bloat see when your app is loaded
android will set aside a section of
system memory just for your app and in
order for your app to run all of the Dex
code for it is loaded into that subspace
but of course this is ultimately shared
with the rest of the heap for any
runtime allocations that your app will
make thankfully though this doesn't
contend with your runtime allocations
however it does put more pressure on the
system memory which of course when
memory gets low could cause your app to
get terminated to free up space so with
that in mind let's take a look at the
effect of enums on your application
let's say we have a small base app here
whose entire Dex footprint is a 25 50 6
bytes to this we add some integers that
represent states that can be used and
returned for our system after
recompilation the final deck size is 26
80 bytes
meaning that these integers in terms of
code size have added an extra hundred
and twenty four bytes to our basic
secure well now for comparison let's
take the same base application but
implement it with enums instead of
integers the result here is a Dex file
of 40 188 bytes so adding a single enum
to this code has added an extra 16 32
bytes to the final deck size or for
those of you who are super fancy with
math about 13 X more memory than the
intrusion this of course bloats your
deck
file which eats away at your heap space
if this isn't bad enough though there's
also the runtime memory overhead to be
concerned with as well in general each
enum value declaration will cost you
about 20 plus bytes of course plus
there's the object array needed to keep
track of the enum values so that's
another 12 bytes for that header as well
well it's 16 on dalvik by the way anyhow
this extra overhead is taken by each
enum declared in your code meaning that
the more enums used by your app the more
space that's going to be eaten up and
this whole thing can get out of hand
easier than you might think for example
if a gnomes are widely used across your
application or if they're inside of a
library that's used by many applications
on the device all of those small pieces
of overhead quickly add up to a
substantial amount and the worst part is
that you don't really know that enums
are causing a problem and so they're
already infecting your codebase and by
that point trying to fix it is really a
horrible process I think of it this way
imams are kind of like gremlins right I
mean now one or two by themselves not
really a big deal I mean you can take
him out with like a rolled-up newspaper
or a baseball bat or I mean like a flame
thrower if you got one of those laying
around right but when you get a whole
bunch of them together trouble really
happens there and you really wish you
had the flame thrower that's why the
core platform team the folks who
actually write the Android code have a
strong recommendation to avoid using
enums in any part of the code they write
this allows them to be proactive about
the potential problems here rather than
being reactive so with that in mind
here's a couple things that you should
consider to address the problem firstly
if you're using inch for values instead
of enums you can add the app int def
annotation to them which will give your
code built time safety when lint errors
are enabled while still retaining the
size and performance benefits of using
into variables basically this allows you
to get the best of both worlds and
secondly if your code is set up the
right way pro-gard can in many
situations optimize enums to int values
on your behalf so you really don't need
to think about it or do any work which
is one of the few places that you might
get performance wins for free see most
of the time you really have to fight for
it which is why you should check out the
rest of the Android performance patterns
videos and stop by to ask some questions
at our Google+ community as well because
you're not alone so
keep calm profile your</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>