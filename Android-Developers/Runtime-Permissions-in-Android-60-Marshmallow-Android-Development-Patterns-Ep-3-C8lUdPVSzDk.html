<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Runtime Permissions in Android 6.0 Marshmallow (Android Development Patterns Ep 3) | Coder Coacher - Coaching Coders</title><meta content="Runtime Permissions in Android 6.0 Marshmallow (Android Development Patterns Ep 3) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Runtime Permissions in Android 6.0 Marshmallow (Android Development Patterns Ep 3)</b></h2><h5 class="post__date">2015-10-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/C8lUdPVSzDk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">JOANNA SMITH: Hey everybody.
I'm Joanna Smith, and I'm
here with Android Development
Patterns to walk you through our
new runtime permissions model
with Android Marshmallow.
So let's take a look.
It's pretty frightening
to install an app
that requests 14
different permissions.
But if your app targets
Android Marshmallow,
it can now prompt users to
grant permissions at runtime
instead of install time.
Now hopefully, this will help
you avoid a terrifying install
dialog like this one.
Because runtime permissions
are actually required for all
apps targeting
Marshmallow, so there
are a few extra steps that will
help you avoid those dreaded
runtime exceptions.
Because hey, it
happens to all of us.
So first, check the platform.
Runtime permissions are backward
compatible with older SDKs
by reverting to the original
install time request.
So if your user is
on an older SDK,
then you know the
permission was granted
when the app was installed.
However, if your
user's on Marshmallow,
then you can't be so certain.
Which brings us to
the second step,
checking the permission status.
A simple call to
checkSelfPermission
with the permission
that you care about
will let you know whether the
permission has been granted.
If it has, you're good to go.
But if not, you're going
to want to request it.
Note that you want to make this
check every time, because users
can also revoke permissions now.
And this is ultimately a very
good thing for developers,
even if it requires
a bit of extra work.
Because users will get
your request for permission
in a context that provides a
clear justification and benefit
to them.
And that builds user trust.
And letting them say no
thanks to a specific feature
might actually make them
like you a little bit more.
So moving on in our flow.
If you don't already
have permission,
you can take a
moment to explain why
that permission is necessary.
Paint your user a clear picture
of how great this feature will
be if they grant you
access to that resource.
To help you do this, there
is the shouldShowReques
tPermissionRationale method.
This will help you figure
out whether you have some
&quot;'splaining&quot; to do.
The method returns
false if the user asked
not to be asked anymore
or if the permission
is disabled on the device.
But the method will return true
if the user previously rejected
the permission and is now trying
to access the feature again.
Because this is a
signal that your user
might be confused
about the app behavior.
So make it clear for them.
And with that, you're ready
to request the permission.
The requestPermissions
method needs
the permission list that you
care about, and a request code.
This asynchronous call will
then pop a dialog to the user,
and their response will
trigger your callback,
which is why the request
code that you specify
is so important.
It'll help you identify
where in your app the user is
and how to pick up
the app behavior.
Which brings us around
to the final step,
handling that
permissions result.
In onRequestPermissionsResult,
you can
check the result of this call.
So if the permission
was granted,
you can use your
request code to get back
to making that API
call and creating
magic moments for your user.
But if the permission
wasn't granted,
you're going to need
to fail gracefully.
The easiest solution is
to disable the feature
with some sort of
clear visual signal
that this is because of
the permission thing.
So you could present a
dialog or update the UI text.
But you probably
want to keep the UI
layout functional in case
they change their mind.
So don't disable that button.
Let them get back into the
flow when they care about it.
And that's how you
update your app
to handle runtime
permissions in Marshmallow.
One final piece of
advice I have is actually
about testing these changes,
because it isn't super fun
to keep bouncing between your
app and the Settings app.
So check out the
PackageManager's grant command
to programmatically grant
and revoke permissions
on the device.
And as always, check the
documentation to get started.
And keep in mind
that these changes
are intended to help your users
understand your app's behavior.
So don't overwhelm users by
asking for several permissions
all at once.
Put these requests into
context and build better apps.
[MUSIC PLAYING]</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>