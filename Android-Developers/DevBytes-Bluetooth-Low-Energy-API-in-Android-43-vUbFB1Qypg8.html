<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>DevBytes: Bluetooth Low Energy API in Android 4.3 | Coder Coacher - Coaching Coders</title><meta content="DevBytes: Bluetooth Low Energy API in Android 4.3 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>DevBytes: Bluetooth Low Energy API in Android 4.3</b></h2><h5 class="post__date">2013-07-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/vUbFB1Qypg8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is Fred Chung part of Android
developer relations today we're going to
talk about Bluetooth Low Energy
in Android 4.3 we are adding built-in
platform support for Bluetooth le the
new Nexus 7 and the Nexus 4 are the
first two Nexus devices that are going
to be polluted smart ready making them
capable of communicating with the many
Bluetooth smart peripherals on the
market today I'm going to do a sample
app walkthrough today but before doing
that I'd like to walk you through some
technical concept of Bluetooth Low
Energy so that you can make sense out of
the API objects as this name implies
Bluetooth Low Energy uses less energy as
compared with Bluetooth classic it is
not uncommon to have Bluetooth Low
Energy devices that last for weeks if
not years before needing to recharge or
replacing the battery the protocol
itself is optimized for a small burst of
data exchange which is ideal for
applications such as sensors remote
control as so on and so forth in
contrast Bluetooth classic quite often
is involved in high bandwidth
applications such as audio streaming now
let's have a look at how information is
structured in ble applications ble is
based on a specification called general
attribute profile or get it governs
sending and receiving of short pieces of
data known as attributes the Android app
can be either a get client or a get
server depending on the application the
get server can support a collection of
services you can think of services as
different features offered by the device
each service is uniquely identified by a
you are ever ansible by your application
under each service there could be a
collection of characteristics which you
can perform read or write operations
depending on the btle profile you're
working with to put things in
perspective let's have a look at the
heart rate measurement profile which is
one of the standard profiles
the heart rate sensor is the get server
the Android app in this diagram is the
get client the get server hosted on the
heart rate sensor device offer a number
of services under the service there's a
collection of get characteristics
there's one for providing heart rate
measurement which you can receive
notification on when that indicates the
location of the sensor which you can
read from now that we have some basic
understanding on Bluetooth technology
technology let's have a look at some
code let's first take a look at the
Android manifest there's a new feature
called Android Hardware Bluetooth le you
declare it if your application is would
only work on devices that has that
feature you can omit it if your
application would work on a device
without that feature so that you can
optionally make disable the Bluetooth
Low Energy features within your app now
the debugging session is up I'm going to
go ahead and click scan so I've put some
breakpoints here what is trying to do is
to call it a start le scan method call
and as you can see in the API
documentation a lot of a lot of the ble
operation methods are asynchronous in
nature you have to specify a callback
such that when interesting events happen
in this case when devices are discover
the callback methods are invoked so I'm
going to let this breakpoint go as you
can see in the app it's able to find a
couple of devices let's go ahead and
click on heart rate sensor which
corresponds to the test kit that I'm
trying to test with so let's go ahead
and click on it now it brings you to
another activity which is bound to a
background service and I've put a
breakpoint in a service what it's trying
to do is to connect to the get server
that's hosted on this device by invoking
this method called connect get just like
the previous example since all api's
that have
with vlds are asynchronous in nature you
have to pass in another callback here
now that we've connected to the GATT
server is trying to invoke this call
this method called discover services by
trying to discover the available guest
services hosted on this device let's go
ahead and release the breakpoint and now
the callback on services discovered is
invoked meaning I have found the app has
found the services that are available on
the device the app is going to iterate
through the collection of services found
and display on the UI as seen here since
this is a heart rate sensor we're going
to do some heart rate measurement let's
go ahead and locate the heart rate
service expand it and you'll see heart
rate measurement characteristic let's go
ahead and click on it what happens is
that since it knows that the
characteristic supports notification it
tries to enable the notification so
let's go ahead and release this
breakpoint now as soon as it begins
getting heart rate updates reading
you'll get this call back on
characteristic change indicating that
indicating that you are receiving a
notification so we're going to go ahead
and release the breakpoint as you can
see on the screen here we are receiving
heart rate measurement readings in this
in this very very tiny text I don't know
if you can see it but it's updating with
heart rate measurement notifications
receiving from the peripherals now I
want to illustrate a very important
point and that is whenever you are done
with the particular Bluetooth le
connection with the peripheral you
should really call this closed method so
that the stack can do its cleanup
properly that's it for the walkthrough
if you want to learn more do check out
the Bluetooth Low Energy developer guide
on the Android comm thank you for
watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>