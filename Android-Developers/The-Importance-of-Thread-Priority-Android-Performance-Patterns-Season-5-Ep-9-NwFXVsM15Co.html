<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The Importance of Thread Priority (Android Performance Patterns Season 5, Ep. 9) | Coder Coacher - Coaching Coders</title><meta content="The Importance of Thread Priority (Android Performance Patterns Season 5, Ep. 9) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The Importance of Thread Priority (Android Performance Patterns Season 5, Ep. 9)</b></h2><h5 class="post__date">2016-04-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NwFXVsM15Co" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">dear bald guy I watched your threading
videos I spawned a hundred threads to do
my work and my app got slower you're a
horrible person and you should feel bad
hashtag enums matter my name is Colt
McAnlis and yes technically you can
spawn hundreds of threads for your app
but as you guessed it that might not be
the best idea for performance see
cramming too many threads into not
enough CPUs is an old problem and for
decades now thread scheduling has solved
this by using various metrics to
determine which thread gets the next
slice of CPU time basically every thread
is assigned a priority
the scheduler then gives preference to
threads that are more important
balancing that with the need to
eventually get all of its work done now
priorities are assigned in a couple of
ways firstly Android assigns thread
priority based on the lifecycle activity
state of your app active and visible
apps are assigned to the foreground
group where the rest are assigned to the
background group and threads in the
foreground group get about 90 to 95
percent of total execution time for the
device where the background group only
gets about five to ten percent which of
course makes sense right I mean visible
applications on the screen should get
more processor allocation than apps
which aren't visible secondly it's
important to note that when a thread is
created by default it's given the same
priority and group memberships as the
spawning thread as such it competes on
equal terms for processor time
allocation so for your UI thread spawns
20 other high priority work threads they
will all compete equally for CPU
resources which pretty much ruins your
chance of getting all of your UI work
done in 16 milliseconds to fix this you
should explicitly set thread priority
for any threads you create in your
application this helps the system to
schedule competing threads in the same
control group on Android this is
accomplished using the Handy process set
thread priority API now just to be
confusing this function takes an integer
value between negative 20 and 20 where a
lower value indicates a higher priority
technically speaking this number is
actually supposed to represent how
friendly
this thread is was sharing its time so
negative numbers means it's more hostile
to sharing its time but whatever to make
us a little clearer Android has provided
some named values for you to work with
these values are defined by Android OS
process and can be used as base States
to work against a default of course is
what your threads are generally given in
addition to that there's a couple
quantized values to help you increment
or decrement the priority to get a
little bit more fine-grained control for
example the UI thread is always assigned
priority default and any threads it
spawned will also be given that same
value but in reality worker threads
should be lower priority which you can
set by adding priority default and
priority less favorable this way you can
control which of your spawn threads
might be more or less important than
others
and in truth setting these priorities
yourself can be cumbersome and that's
why classes like async task or intense
services do this on your behalf so you
don't have to deal with it but if you're
using threading and not using one of
these fancy primitives then of course
you'll have to set prior to yourself so
keep an eye out on that which is always
the weird thing about performance
there's many ways to do one thing which
is why you should check out the rest of
the Android performance patterns videos
to get a better sense of all the options
you have and don't forget to join the
Google+ community to ask questions to
other great developers so keep calm
profile your code and always remember
perf matters</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>