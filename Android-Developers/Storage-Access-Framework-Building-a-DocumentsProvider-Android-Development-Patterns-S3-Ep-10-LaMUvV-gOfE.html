<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Storage Access Framework: Building a DocumentsProvider (Android Development Patterns S3 Ep 10) | Coder Coacher - Coaching Coders</title><meta content="Storage Access Framework: Building a DocumentsProvider (Android Development Patterns S3 Ep 10) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Storage Access Framework: Building a DocumentsProvider (Android Development Patterns S3 Ep 10)</b></h2><h5 class="post__date">2016-09-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/LaMUvV-gOfE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">if you've implemented a get content
activity so other apps could access
files or photos from your app your life
got a lot easier in KitKat rather than
having to implement your own activity
build a whole UI and deal with options
like multi select you can rely on the
storage access framework and build a
documents provider a quick refresher on
the storage access framework and keep
getting higher devices when apps start a
get content intent they'll first get a
system provided UI courtesy of the
storage access framework this UI
automatically connects to each app that
provides a documents provider and gives
users a consistent look and feel and
functionality across all those apps
think of it as the open dialog from a
traditional operating system only at the
end of that list of apps is any apps
that use a get content activity these
document providers are like the data
backends figure out with no UI component
it's completely focused on returning a
list of files and some metadata to make
available to the user to select right
there in the system provided UI even
allowing users to select files from
multiple documents providers at the same
time there's only four required methods
for implementing and documents provider
query routes query child documents query
document and open document a root is the
entry point to your documents provider
so query routes is where you'd return
metadata like a unique route ID the
title and icon for your route for
display to the user an optional summary
for maybe an account name as well as
flags for enabling optional
functionalities such as returning recent
item searching or creating new files it
also includes a document ID for the
topmost directory turns out when we say
document it can mean two different
things a traditional file something the
user can open and a directory a folder
which can contain other documents query
child documents is where you're given a
directories document ID
and you returned metadata about all of
its direct children of that directory
this metadata would include document IDs
a display name what gets shown to the
user a mime type and flags indicating
whether it could be written deleted
renamed and more you might already be
guessing what query document does that
it provides the same metadata just about
a single document it's important to note
that while each document ID must be
unique the same document can appear in
different directories say if you
categorize pictures by both tags and
date then of course you do actually need
to provide the documents contents and
that's what open document does now it
seems easy enough yet when you look at
the actual API you note that many of
these methods return a cursor and many
of our projection as a parameter
if those not working on databases all
day a cursor is just an interface for
iterating over rows of data with each
row having a set of columns the
projection that's passed in indicates
what columns are being requested by the
storage access framework and your
resulting cursor should have a row for
each root or document if you don't have
a database that's totally fine you can
construct a cursor manually using a
matrix cursor you create one by passing
in the projection you want to use you'll
note that a null projection parameter
means you decide what fields to return
although there are some required ones
for documents providers so look through
the links in the description for the
details then for each row you want you
first create it using new row then call
at for Kray routes use the constants in
the documents contract route class as
the keys for each piece of data and
create child documents and query
documents aren't much different although
in that case you'd use the documents
contract document class for the concepts
now for open document your task to
return a parcel file descriptor
thankfully if you already have a local
file this is really straightforward
thanks to parcel file descriptors open
method you can also create a parcel file
descriptor directly from a socket though
so having the full local file locally
isn't a hard requirement of course the
best implementation won't do any good
unless you add your documents writer to
your Android manifest a couple things of
note here you need a unique Authority
for your documents provider generally
something prefaced with your application
ID your package name that you'll need to
make sure that it's exported so the
storage access framework can access it
grant your eye permissions mean the
system can grant permissions on your
behalf
and the permission ensures only the
storage access framework can connect to
your document provider that's it for the
basics you should be able to see your
route and documents when apps invoke the
standard documents UI via get content or
the action open document intent no more
need to build your own UI and a
consistent experience whether users are
operating on local files or files you
provide or files from some other app but
this is really only the beginning of the
storage access framework there are
optimizations for loading huge lists of
document with extra loading action open
document tree for letting users select
whole directories to share action create
document for saving a file not just
locally but to any documents provider
providing thumbnails document management
features like deleting renaming copying
moving and removing alternate file
formats and virtual files you'll find
all the details in the links in the
description and how you can use the
storage access framework to build a
great documents provider to build better
apps</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>