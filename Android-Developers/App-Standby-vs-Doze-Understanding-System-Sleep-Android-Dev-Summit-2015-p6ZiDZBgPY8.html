<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>App Standby vs. Doze: Understanding System Sleep (Android Dev Summit 2015) | Coder Coacher - Coaching Coders</title><meta content="App Standby vs. Doze: Understanding System Sleep (Android Dev Summit 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>App Standby vs. Doze: Understanding System Sleep (Android Dev Summit 2015)</b></h2><h5 class="post__date">2015-11-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/p6ZiDZBgPY8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay hi good morning everybody I'm
Joanna Smith and here we're gonna talk
about Idol modes I know you're all
really excited and you definitely don't
hate these and you're definitely not
frustrated so this is going to be a very
pleasant experience for all of us right
right okay great
so the greatest thing about the next
like half hour 45 minutes of your life
is you're gonna sit here and listen to
me talk and not get to say anything and
then you're gonna walk out of the room
thinking great I don't have to do
anything I'm exactly at my status quo
from before the talk
so definitely productive use of your
time and the reason you're gonna want to
listen to me you could read my online
bio if you want I don't really care but
specifically I'm a developer advocate
for Android and I've been working a lot
on trying to educate people about best
practices we have a lot of resources out
there for you to learn how to use an API
when it's launched or how it works but
nobody's really trying to teach people
when to choose an API or how to like use
multiple pieces together and so that's
why myself and Ian Lake who's speaking
right after me launched Android
development patterns so we have a series
of videos and pro tips online so that
you can learn how to bust bad behavior
and how to make your app better we also
created the advanced Android app
development Udacity course so if you're
trying to tweak your skills or work with
something a little more complicated or
you want to have a whole lesson on how
widgets work where your people and then
the other thing I want to say about me
personally is I started learning Android
in February of 2014 so I'm not even
quiet at two years and yet I'm up here
you know representing our engineering
team trying to teach other people about
best behavior and I say that because a
lot of people get really intimidated
learning a new language or a new skill
set or you know if you come from a Java
background Androids you know life cycle
doesn't make a lot of sense and it can
be overwhelming especially when we
change everything every year and so I
just wanna let you know like you know
don't give up hope or don't get
frustrated like there's a lot out there
but you can be really exceptional with
not a whole without understanding
everything back to a froyo basically
okay so let's get started
the reason that I'm here today
specifically is because battery is one
of the most important things that we
need to talk about both from our side as
providing an operating system and from
your site as developers right this is
the biggest problem in will
people get most so frustrated about this
they're constantly trying to measure
their battery as a consumer or figure
out what's eating all of their battery
or why their phone has to be charged
twice in a day users hate this and then
they hate you because they don't
understand what you're doing or why
you're coming up on top all the time and
then they hate us and they want to get a
whole new phone right so there's a lot
of press about battery tons of studies
that you can find just from any kind of
search on your favorite web engine and
it's a problem that everybody wants to
solve but the problem is like when
somebody tries to give you a blanket
advice they'll tell you things like just
don't have lingering services and don't
do background services and don't use
memory and basically don't be an app
when the truth is you want all of those
things a device naturally will launch an
activity and that activity should be
using background services one of the
most important things to keep in mind
when building an app is that we call our
main thread the UI thread for a reason
everything that you do there affects
what the users see and if you hang if
you miss your framerate they're going to
uninstall you because they think you're
janky they don't realize that you missed
your framework because you're working
really hard and we can't educate users
so you just have to like fake it till
you make it right so my point here is
that background services aren't bad
what's bad is when every app has their
own background service over time
triggering willy-nilly
we need to coalesce these together so we
can create a good experience for the
battery because if you only use the
radio twice in a day but you use it
separate from everybody else the radio
never gets a break and that's not good
for network that's not good for the
device and so because we can't really
teach people how to do this working with
other apps because you don't have
insight into other apps we're gonna
force you into my favorite mental model
and that's what does this for so get
comfortable with this image I know it's
really complicated and hard to remember
and you're not gonna see it again so you
know you really have to work hard but
the idea here is over time I want every
apps background job in sync to line up
in batches because then we can turn the
radio on once it doesn't particularly
matter for most apps if they're sync
happens at 6:00 p.m. or 8:00 p.m. so
let's take advantage of that flexibility
and that's what does this for so we'll
go over that first does was introduced
in marshmallow but it doesn't really
matter what API you're targeting because
doze is going to affect every
marshmallow device even if you're still
rocking that lollipop okay so you have
to get understanding over this because
you
no control over what device your users
have right so you would think that was
something as big as does weed have a lot
of goals for it but the truth is we only
have one we want to preserve the users
battery life that's our one goal here we
want to create a better user experience
by making sure that when the user puts
their tablet down and let goes off to
Cabo for a week they come back pick
their tablet up and it's still alive
they weren't using it so why did it die
like that doesn't make any sense and so
we're here for that but the truth is
like I said we can't really like get you
to work kindly with other apps because
that's not really like a possible
situation here so we forced you and
people don't really like that and that's
why there's a lot of you know very kind
comments on Twitter that definitely
aren't frustrating at all and so before
we can really get into like more of the
why here I need to explain my goal for
you which is this you aren't as
important as you probably think your app
is because as a developer your mind is
in the zone of thinking about your app
all day long you kind of go to sleep
thinking about that problem you want to
fix and you wake up thinking oh gosh no
at this bug to like it never leaves your
head whereas with your user they're not
going to use it all day every day right
and you need to come to terms with that
as a developer so my best example of
this is a success metric so our fearless
leader is Larry Page he's pretty great
and he defined success inside of Google
by a tooth-brush metric so if your
product is used twice a day for about a
minute each time you are insanely
successful and worth investing like a
quarter of Google's resources in like
that is something that's going to hit
home and be great and change the world
so that's two minutes a day right which
means that there are 23 hours and 58
minutes that the user isn't using your
app or your product and you're still a
grand success that alphabet' would
invest in right like that's perspective
right and it's hard to keep that in mind
when all you do is create your app so 23
hours and 58 minutes you have to be
willing to recognize that like users
exist outside of you for all of that
time and you can be a little bit more
flexible about when exactly your
background sync is happening that being
said let's go into exactly what does is
does is when your device is fully idle
but like not really sure what that means
so what happens in doze mode first now
access is suspended the whole point here
is we don't want the radio going off we
don't want her going off every five
minutes we don't want it going off every
15 minutes we want to do this in a
controlled setting when we can so
network is off like you're just gonna
have to deal with that the second is we
don't care about your way clocks the
device isn't being used therefore you
really shouldn't be doing anything like
this isn't I'm gonna send a notification
so you get the users attention this is
they're not even in the room like it's
not happening they don't care about the
device you shouldn't care either that
being so in long that same vein all your
alarms are delayed and we understand
that our alarms are a great way for you
to control the flow of your apps so
we're not deleting your alarms we're not
dropping your alarms we're just gonna
hold them off until the doze mode is
over and then they'll all trigger and
you can react to each one the way you
normally would in a nice batch and then
the most important part sinks and jobs
are not going to run but this is the
same deal we aren't deleting your
background jobs and sinks we're not
making sure your app doesn't ever get a
chance to exist we're just controlling
when they're going to happen which is
when the device is active we also have
to mention have these periodic
maintenance windows that are going to
for the detail so that prolonged doze
periods still get a chance for you to
run periodic updates at least once a day
okay so then now that you're all worried
and you're like wow they hate us and my
apps gonna die let me tell you how we
even get into doze mode and why it still
doesn't matter for your app does is
gonna be triggered when the device is
not charging right because we care about
battery so if we're plugged in we don't
care about any of this we're not at risk
we're not worried we're not concerned
there's power coming from somewhere so
the device isn't is not charging it's
out there draining the battery and the
screen has been turned off so probably
they're not interacting but most
importantly it's not moving there's a
difference between having your phone in
your pocket and it going idle which
would be awful when you need to navigate
somewhere and having it down on the
counter as you come up here to give an
hour-long presentation right one of them
I'm going to respond to a text message
and the other one probably not okay so
these three states there we've really
thought a lot of thought into this and
you'll see why as I continue to talk to
you so let's take a look at this
beautiful image that you probably
recognize from our documentation about
doze because you totally read all of our
docs and you're really excited about it
this is an estimation of like a timeline
of how doze works we have this nice long
period over idle right at the end and
these nice orange bars which represent
those main
knows that you'll start to understand
later on and then we have these crazy
spikes at the beginning and all those
crazy spikes represent normal usage of
the device and that's the period when
the user is using it and we're trying to
determine if we have reached idle mode
and if we're there yet and like whether
how confident we are that we really
should be idle right now so normal usage
which if it happened all day would join
the battery and like what hours okay so
the reason we have this nice long period
of mobile usage even after we might have
started thinking about does is because
we want to hit that confidence level and
to do that we have States so we don't
just jump straight from active to idle
we walk ourselves into it and we do that
with a device idle controller class so
this class was introduced in the
marshmallow code it's pretty fantastic
and that's part of the AOSP so you can
read about it and figure out what's
going on and understand everything on
your own or you can trust me or you can
find someone else who wrote a blog on it
and read their blog ok so there's
several states the first and easiest is
active right because before active then
we know that everything is working
properly and like they're using their
device and your app is gonna run exactly
as expected and that's just great then
we hit inactive and this is when we've
noticed that the screen is off and the
device isn't moving and all those
conditions for those have been met but
like we don't really know why yet we're
just like ok great we're not active
we're just chill with this then comes an
idle pending state which is okay we
weren't active it's been a period of
time we're still not active let's one
real abode of confidence like we're
getting close to there and we have to go
through this before we can ever even get
to our idle state right and the
beautiful thing about this is you can
read the class and the AOSP and you can
see how we get there and it's really
easy because device idle controller has
an alarm manager that triggers its own
alarm so that it can track its own
progress and so we wait about thirty
minutes between each alarm to see have
we gotten out of this like are we good
like it is something happen are we
moving like is there some new foreground
service like what's going on and then we
use those half-hour periods to see like
do we need to back up or do we move
forward so there's a very long time to
be comfortable if the users really not
interested before we get to idle and
that way you can trust our comfort level
so you can know if they're comfortable
at the users not coming I can be comfort
all the users not coming and I don't
have to panic and think my app is going
to be ignored because we care about our
developers even when you're upset with
us
okay there's also a state called idle
maintenance and this one's really cool
because this is that maintenance window
that we get to so if we have a really
long doze period we understand that you
probably want to like have updated
information for whenever the user comes
back so we let you run your jobs and
syncs all in a batch take it to our
beautiful timeline of her mental model
that you definitely memorized even
though it was so complicated and we're
gonna be able to batch run all these
jobs so that you're up-to-date when we
finally get out of idle mode okay so
those batch windows that's what that
idle maintenance means these nice orange
thick spikes later on and your mental
model because I forgot it right you all
forgot it the super complicated mental
model of what we're trying to get over
time as these batch sinks and jobs from
different activities so this is our
ideal world and you definitely won't see
this again so memorize it this time now
all of these things that you want to
know how these states work right like
you want to see for sure that you can
trust us and we've made the super cool
ABB service that you can step your app
into them and see what's going on and
it's super easy to run you just need a
marshmallow device or emulator your app
needs to be running and then you need to
tell them you know a to be like unplugs
we're outside of the charging mode and
then dumps this you've probably seen
before it's a binary that lets you call
it their services by name and then
device idle
that's your new service and you can step
through each step state see what's going
on where you can ask for help with any
others like command line service it's so
easy super easy to use and you can test
your code to be like okay great they
weren't lying and you can also you know
look for surprises to see whether or not
we really did mess you up and then you
can go on Twitter and you owe me some
more okay so how do you get out of doze
mode well it exits when pretty much the
reverse of everything else that caused
us to enter happens we plug it in so
everything gets released from doze mode
because battery is totally safe now or
we pick the device up because the user
has come back and they want to see
what's going on or and this is the cool
one an alarm is gonna go off and I don't
mean an alarm like alarm manager because
now you're wondering I lied before and
you're like wait you said you don't
listen to those I'm in like an alarm
like I set my alarm clock and I need to
like remember to get back to work by
like the time for my meeting and others
I'm getting in trouble I'm gonna miss my
doctor's appointment like users need
alarms so we do is when we have an alarm
clock pending by our app or one of your
apps like something it's registered as
an alarm then we wake up from doze mode
a little bit before everybody runs their
sync then the alarm goes off the user
wakes up from there now
and can see all of their updated news
weather and traffic right look how smart
we were see we hear you guys you just
you know or it's still that upsets okay
so how do you not do anything well you
know your app should work like I told
you nothing gets dropped
nothing gets delayed nothing gets lead
it's it's all like maybe a couple of
hours off but the user didn't notice and
you won't notice right like everything's
good but if you have something special
you can adapt right couple of simple
things that you probably don't need to
do but I'm going to tell you how to do
them anyway so the first is you need to
think about your apps architecture you
need to understand what it's doing and
what it's expecting because if you have
something kind of weird like your server
relies on your client to check in every
day at 6 p.m. for an update then
probably that's not going to be great
because if you miss that because you're
in doze mode at 6 p.m. then your servers
gonna panic but then again you shouldn't
be doing that anyway so that's on you
and you should use downstream messaging
it's just a general best practice that
way your client is always the one
reacting instead of in the server but if
you're using downstream messaging and
specifically Google Cloud messaging
which you should be using anyway and I
can tell you about that later then you
can add a high priority tag and this is
great because anything with a high
priority the system will receive and
then they'll be able to say okay great
temporary wake up for the app they can
react to this high priority message and
be able to respond appropriately in case
it actually is something important like
you know a text message if you're like a
messaging out because you know something
from your mom you might actually want to
work out here now people are gonna
probably gonna think this is great I'll
add high priority to every message I
send and I say you suck and you're
ruining the whole process so please
don't do that great anecdote for you to
keep in mind if it's a high priority
then it's worth getting the users
attention right which means stop being a
developer for a minute and think about
your user selves are you going to get up
out of that chair cross to that side of
the room pick your phone up off a table
and look at it and groan or be like okay
good nice to know because if you have to
walk all the way over there to look at a
notification and it's just something
like you've got a hundred new points in
your game you're gonna be really
frustrated with that app and probably
uninstall it right but if you walk over
there cuz your mom wants know what kind
of pie you want for Thanksgiving and
she's baking it tonight then that's
important but super important right so
there's your method to tell is it high
priority do I walk across the room and
I'm upset and you as developers you
really don't want to get it from your
compute
and stop coding right that's your metric
and if you can keep that in mind you're
gonna be super successful okay so the
other thing you can do is I kind of lied
when I said we ignore all of the alarm
manager alarms we actually have these
these exceptions you're set in your set
exact methods have a new counterpart
called set and allow idle or set exactly
and allow while idle which
surprise-surprise
allows the alarm to go off while we're
in an idle mode right super super-great
naming okay so these are really great
with you actually do have something time
critical like maybe you want your
calendar app or you like you're gonna
trigger a notification in advance of
some motivate of some event that is
really important to the user and they
can't miss that so we give you this
opportunity wake up your app a little
you still don't have network access and
you still can't run your background
services but you can wake up react to
produce a notification trigger or a
sound everything that the user would
care about so as far as the user can
tell and as far as you can tell there's
no change in app behavior but you're
still able to do an complement and we're
still able to preserve our battery so
the other thing to know about these is
you can't just go willy-nilly changing
every alarm you have because if you're
one of those apps that has like an alarm
going off every two minutes this isn't
gonna help you because we've throttled
these sorry I'm gonna have to live with
it we care about battery so one alarm
will go off in a fifteen minute period
so if you trigger two right after each
other or like in a five minute window
there's gonna be a fifteen minute delay
before the second one triggers which it
actually is fine most apps will affect
this like a calendar event notification
15 minutes before and like at the moment
that's about right two minutes before
and one minute before that's a little
spammy so again you really shouldn't
have to change much but maybe add a
couple of characters and these methods
aren't any different the only thing that
changes in creating the whole alarm
getting in the instance actually setting
it is these extra and allow while idle
letters that's the only difference all
of the parameters are exactly the same
all of your wakeup and timing everything
is exactly the same the method behaves
exactly the same but our system will
acknowledge that you have something
important and will give you the chance
to act on that because believe it or not
we don't hate you right like we're
trying to do the best thing for the user
and since nobody can really listen to us
we're going to force you to do it with
us but in a really kind way okay and
then the other thing you might want to
do to adapt is to test your app but
seriously you should have been doing
this anyway
so this isn't actually adding to your
to-do list so at most you've got like
two halves of a step to do like a high
priority in an analogue Idol that's not
really that much work and you could have
done it while you were listening to me
and already be done so you can still
leave the room not having change
anything right everybody's calm
everybody's good okay I'm also supposed
to mention that we technically have a
whitelist but I'm supposed to remind you
that you probably don't qualify for it
and you need to be really careful about
trying to use it because we have a very
very few special use cases that are spot
on in our documentation and are
subjected to a Play Store developer
policy and it's really probably not
applicable to you because we want to get
to this beautiful mental model that I
told you to memorize right and we can't
do that if we have one or two apps
exempted from that that are constantly
using the radio it undermines the entire
process so they're being really kind of
mean about the whitelist
but you don't need it anyway because I
already convinced you that your app
isn't going to be destroyed by doze mode
right like nobody's scared anymore right
right you might still be angry but you
can tweet at me and that's fine I'll
take it so let's shift gears and we'll
talk about app standby it's kind of
dozes cousin it was also introduced in
marshmallow and it's also going to
affect you no matter what you're
targeting because it affects every
marshmallow device now the cool thing
about app standby is it has the exact
same goals as dothis does it's really
easy to remember we just care about the
battery we care about a beautiful user
user experience and making sure that we
can get that at all times because this
is that mental model that you totally
forgot by now right because it's so
complicated over time we want every
background thing to be happening in
batches and if the user is still using
their device actively we never get into
doze mode we still want to be able to
optimize for them so we've done is we've
made a slight comparison which stands
out in the sense that it affects apps it
doesn't affect the whole device the
device is still functional but if an app
hasn't been used in a while that we're
going to kind of decrease when that app
has access the current try to optimize
all of the quiet ones okay so other
things you want to know about the
difference before we go into this is
that we're definitely restricting
network access because we care about
that except now we're doing it on the
app level instead of on the device level
we're still still laying all your jobs
and syncs they'll get their chance I
promise look at their chance but it's
going to be in a controlled way we're
gonna honor wakelocks though we're going
to like
- your way clocks to respect your way
clocks and we're gonna respect your
alarms from alarm manager and this these
two things at the end that's what's
going to have made all of the difference
because app standby is triggered
differently than dozes so it's triggered
when again the users not using your app
so this is similar idea to the device
except they just aren't opening your app
they haven't opened it all month they're
not really that interested in it and I'm
sorry like it's not every app is used
every day remember at the toothbrush
test okay then the other thing is that
maybe you don't have any active
activities or foreground services like
nothing in the foreground is running if
you're streaming music like we get that
that that's kind of important and like
they're not interacting with your app
but they're listening to it for the
whole course of the party it shouldn't
cut out in the middle so foreground
services and activities those are
respected and even more than that we
respect your foreground services and
activities if they were launched by
another app it doesn't have to be
launched by the user but if you're you
know app behaves in response to another
app but we respect that to anything in
the foreground is safe but this is where
our differences matter there are no
pending notifications in the lock tray
or on the lock screen sorry the
notification tray or the lock screen
which means that you actually have this
really cool way of getting yourself out
of that standby when it matters to your
app so let's talk about how to get do
that so apps to anybody's gonna end when
you know the user wants to use your app
that's a very clear signal to us they
want to interact with you you're gonna
interact with them or the device is
plugged in because again we're doing all
of this for battery so if we're plugged
into the wall everything's free
everything is released from us and by
doze it ends like everything is for you
to behave as they want as long as we
have power coming but the most important
is that maybe your alarm manager set an
alarm and that alarm is gonna go off and
then because the alarm went off you're
gonna do some sort of work in response
to that and you're gonna create a
notification to the user that
something's up-to-date maybe at 6:00
p.m. there are new levels for their game
available or maybe you know like there's
new information that you want to present
so anything that would be worthy of
creating a notification that's fine like
you can behave as you normally would in
response to a time or like maybe new
information or some sort of trigger or
like you just have some ads you want to
display so you bring your user back into
your app like we get it you have to
monetize but all of that means you can
create a notification present to the
user which again you're getting their
attention so remember the lock across
the rim test but as soon as you do that
you're released from app standby because
if you have a pending notification the
user is probably going to come
you're way pretty soon right like
they're gonna look at that duck oh yeah
I need to interact with you so we
respect that that means that you don't
need to be idle right now and you
probably need to have access to like
your background services or your sinks
or them Network so you can be ready when
they open your app see we get yeah you
don't think we get you but we thought
really hard about our developers I
promise okay so see this this beautiful
mental model that you definitely forgot
because I've only showed it to you like
four times already we want to get to
this ideal world of batching and so what
we did is we created app standby like we
bothered with this whole effort of like
making you upset with us you tweet at us
in your mad and then we have to explain
to you like why it's okay we went
through all of this because we can
achieve this mental model with app
standby by offering periodic maintenance
windows so maybe your app isn't used
everyday maybe you're like oh once a
month kind of app that's fine but you
still need to be ready when they open
your app because they're going to come
back to you at some point right so we
guarantee you a maintenance window at
least once a day if not more often so
that even if it's been 20 days since
you've been used you're ready and you're
up-to-date and you're at most just a
couple hours behind in information right
so a guaranteed periodic mean and oh for
every app and app standby means they all
run together with one use of their radio
that is a huge achievement for battery
and so sorry if you don't like it but
it's gonna work really well for your app
I promise and it's great for our users
which means it's gonna be great for you
and with the 18 different phones and
tablets you have in your house right
okay so the manicured about why we did
this like let's consider a successful
app that you might not use every day
like a movie streaming app or like a
movie purchase like in ticketing app
these kinds of things you don't use
every day you probably wait until you're
in the car like stuck like you're still
seven-year-old in the backseat while
your parents drive to your grandparents
house for Thanksgiving which probably
happened what tomorrow like that's the
situation nobody wants to be in
especially as an adult so you can't pull
out your phone while everybody else is
arguing and start like watching you know
whatever streaming you're in the middle
of and you probably haven't used it
since like what October and so the
difference is when you're doing
something like digital content you need
to make sure that everything is
up-to-date like new information new
shows new movies are all there and
available in the list or more
importantly that like the licenses for
any digital content that was purchased
have been refreshed because otherwise
the app has to legally delete it right
so those won't like once a day
guaranteed maintenance windows means
that you're always
ready in any kind of situation no matter
what your apps use cases right so we
thought long and hard I really promise
and if you don't believe me you can
throw it any use case out you want at me
and I'll try to come up with a good
answer
okay but this is our goal everyone
agrees that were like we're getting to
our goal so you're starting to see why
we had a good reason and you only hate
me like 20% now okay so how do you adapt
for app standby because you have no
control over this and you don't know
when you're in app standby and that's
kind of scary I get that right so again
you should didn't have to do anything
right your alarms are honored go away
clocks are honored and your jobs and
thinks will run at least once a day
which means you'll have network access
at least once a day so like you're good
until you're being used but if something
does come up we get that so hello GCM
it's your best friend right like you're
totally convinced that you love
downstream messaging with our super
great service and the high priority
stands any message that comes through to
the system with a high priority tag will
mean that your app is given a temporary
reprieve from idle mode to react to that
and so if that reaction includes a
notification that you create great
you're out of idle mode but if it's just
something that you need to do to like
speak with your server then great you're
still in idle mode but at least you're
informed your client can rely on all
your communication from your server
that's time sensitive and anything
that's not time sensitive is just held
for you until your maintenance window so
no matter what you're not missing
anything important like you're good you
guys are good to go you're going to be
great it's gonna be awesome okay so now
you've been listening to me for a while
and you're hardly confused like wait
what do I do because my app use case has
totally not been talked about and like
you'd really you shouldn't have done
this idle mode the first place you guys
like battery was totally fine okay well
that's not true this is and this is
happening it's done it's mandatory
anything any device on marshmallow so
time to live in our new world I know
you're really excited you're not
frustrated at all but what you actually
need to do here is believe us this
mental model see you totally forgot it
so I put it back up here because it's so
complicated over time we want everything
done in a batch we want to turn the
radio on only maybe like a couple of
times a day if the device isn't used or
only like once a day if it's being used
but like everyone else is like doing
their job sync it we just want to do one
batch for all of that like let the user
have some control here
and remember understand when you are
important and when you're not as far as
a life a day and a life goes so one app
trying to be an exception to this
undermines the whole process which is
why this is now mandatory and forced on
all of you because it's the only way we
can achieve success and you're totally
gonna forgive us because I'm really
great and you like me okay but again
your to-do list here basically includes
rethinking some stuff you need to
understand what has changed wake locks
and alarms their behavior may or may not
be trustworthy depending whether you're
in doze mode your alarms will trigger
but maybe not exactly right on the
moment right a knob stand by you can
still count on these but again the
behavior has shifted so that changes the
way you think about some of the
assumptions you made in your
architecture and then your jobs and your
sinks or might happen a couple hours
late and that has to be okay with you
like you need to make sure that your
system is able to react to that so this
is what's changed but at the same time
nothing has actually changed because
like I said we're not deleting your jobs
and sinks they're just a couple hours
late which for most apps is not a
noticeable difference because most apps
use downstream messaging and they rely
on the client to speak to the server to
get updates and then the server is
probably not expecting like a one
specific moment of the day checking so
you're probably okay I guarantee you're
probably okay but let's really look
let's revisit our to-do list
think about your app architecture right
update time critical alarms that
actually matter with the and allow while
idle that's the only change it's like
what forty characters in your whole
codebase probably your great totally
easy you might not even have to add
high-priority flags to any downstream
messages through GCM which technically
isn't an Android change so you can still
kind of chalk that up so like a server
level change so again your to-do list is
basically nothing but then the most
important thing is you just need to test
your app you need to walk through what's
going on in your application step
through with our ADB service see what
the behavior is getting into and out of
vehicle modes and most importantly make
sure that you aren't surprised because
if you're surprised by some sort of
behavior something that doesn't happen
when it shirt or something that happens
when it shouldn't the new user is gonna
be surprised and surprised users
uninstall apps because they don't
understand what's happening and then
they think that you're stealing their
information or draining their battery
you don't to be that up okay and then
when you've done all this and you found
something that you don't like you just
repeat C test your app you don't as how
this is kind of just your development
flow normally so there really isn't a
change which is why I'm convincing you
you can walk out of the room being like
okay good it's a disco no difference
right right you don't seem about like
you're got convinced but here's the
again how to test your app once you've
got here are two super super sweet adv
services that we created with
marshmallow that I told you step through
doze mode or super even easier than that
is the set in active service for app
standby you just set true or false set
inactive let's see what goes on I'm
setting active false okay great we're
out of it let's see what happens now you
want to test your reactions and look for
surprises and if you're not surprised
then you can just call it a week on
Tuesday and go home
I'd be like turkey time and if you are
surprised you like crap I'm gonna go on
Twitter and yell at that girl but
hopefully your apps are going to be
survive and they're gonna be fine and if
they don't that's okay you can you know
like I said come and yell at me
this is how you find me on G+ or on
Twitter and if you have a use case that
actually does kind of stand out I will
go and I'll fight for you to rpm to see
like what his expected reaction was but
for the most part every app has the
solution here and it's not that
difficult so this is my whole 30 minute
talk that's 15 minutes where I'll be
standing right here and you can come say
your main things are asking your really
good questions but I hope you guys have
a great day and thanks for listening
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>