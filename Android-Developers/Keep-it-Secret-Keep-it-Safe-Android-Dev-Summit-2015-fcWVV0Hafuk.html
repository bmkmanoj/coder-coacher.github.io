<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Keep it Secret, Keep it Safe (Android Dev Summit 2015) | Coder Coacher - Coaching Coders</title><meta content="Keep it Secret, Keep it Safe (Android Dev Summit 2015) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Keep it Secret, Keep it Safe (Android Dev Summit 2015)</b></h2><h5 class="post__date">2015-11-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fcWVV0Hafuk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's get started hi everybody welcome
to keep it secret keep it safe where I'm
going to talk to you about protecting
the network traffic in your application
so first of all basic introductions I'm
Chad Brubaker I'm a software engineer on
the Android security team for about two
years now full-time and I was an intern
before that there's a picture of me if
you want I'll never show that again
okay so what am I going to talk to you
about so first of all the very very high
level like what is TLS and why you
should use it for all your traffic
period everywhere men talk about what it
actually would you actually have to do
to use it on the client and the harder
part of actually checking at work making
sure that you're using it and then
finally we're gonna get to my personal
favorite part about various mistakes and
misconfigurations we've seen why they
happen why you shouldn't do them what
you should do instead and finally some
time for questions and answers so all
right the TLS first of all why so why
should you even care about making sure
your network traffic is secure well
simple answer is the network is not to
be trusted and this has always been true
in computing like this is not new in any
way but for mobile devices it's actually
especially true because think of your
smart phone how many different networks
does it connect to in a given day
different Wi-Fi networks different
cellular networks and setting up a Wi-Fi
network takes basically zero effort all
right I can go down to a coffee shop
make an open Wi-Fi called you know super
awesome fast coffee shop Wi-Fi and
people will probably connect to it so
it's very easy for this to happen to
smart phones to be on a network that may
be hostile to you and finally like smart
phones are very personal devices for all
of us right they contain a lot of your
personal information you use them to
transmit a lot of personal information
you know you do banking you do all these
kinds of things so it's important now
when you think of like sensitive traffic
that needs to be protected there's a
couple sort of canonical examples that
come to your mind that kind of get
talked about in articles and stuff about
like obviously sensitive traffic that
you think oh yeah I definitely don't
want a random person messing with it
seeing it it's like very basic examples
right like I shouldn't be able to see
the login for your bank
account right you probably don't want
that mike weis I shouldn't be able to
see your credit cards if you're sending
private photos shouldn't be able to see
that and not only just kind of
eavesdropping but also modifications so
you wouldn't want someone to say replace
the email to your boss saying like yeah
I can totally do that thing you asked me
to do and you know just modify that to
be like no I hate you I quit
right don't want that that obviously bad
you know sensitive web traffic health
these are sort of all of the examples
that kind of come to mind and you think
like what is traffic off my device that
needs to be secure okay but what if you
don't do that so thought experiment that
I always hear is a food blog so I run
you know Chad's stupid food food blog
full of really bad advice about food
should I still secure my traffic you
know it's about food no one cares it's
not sensitive yes you should still
secure your traffic oops for two reasons
I mean first of all it's 2015 just do it
and second it's 2015 right I'm done
secondly even if the content isn't
directly sensitive that doesn't mean you
can't do any bad things with it as an
attacker so the first and sort of most I
guess nuclear approach is even like
completely harmless content say I have
an exploit for your browser and I'm a
bad guy even if the only HTTP page you
go to is my crappy food blog I can go
you know modify the traffic inject that
exploit and that's my route to get on
your device sort of more in general kind
of modifying content in subtle ways you
know for the food blog this probably
doesn't matter you know change my really
awful recipe to maybe less awful but you
know like say your Wikipedia you know
like slight tweaks to history these
kinds of things and sort of on that
front what actually impacts developers a
lot is replacing things like ads so you
you know you have all these costs for
running your servers your backends
bandwidth and you offset that through
ads ok sounds good that's how the
internet works but if I go in and I
replace those ads with ads that pay me
right that's bad you're now eating all
the costs and someone else is actually
getting the money that kind of thing
and finally tracking and snooping right
the if I'm the only person in the world
that goes to my food blog which is
likely true then simply seeing that oh
this phone connected
to this food blog means like I know that
phone is chat so that's not good and
sort of the overall goal in general is
that the network cannot affect the
security of your device your data in any
way the network can always block traffic
and always refuse to do things for you
but it shouldn't be able to hurt your
security in any reasonable way and this
is what TLS is for so TLS is transport
layer security is previously known as
SSL so if you hear these two they're
sort of inner there they're use kind of
interchangeably so the way it worked was
you had SSL v1 v2 v3 TLS 1-0 TLS one one
TLS one two so it's used interchangeably
all I'll probably even say SSL a bunch
yeah same thing and it's used with any
protocol it wraps whatever you want so
HTTP is HTTP over TLS you know SMTP and
IMAP have start TLS all these kinds of
things it's completely generic to the
protocol you can use it for whatever you
want and it gives you an end-to-end
secure channel between two pairs and you
get two very important things from that
channel you get integrity so you know if
anyone goes and messes with the data in
that connection you know about it so you
can basically you know throw your hands
in the air and say I'm out and
confidentiality so only those two peers
actually see the data that's being
transmitted now the hard part is often
making sure that the peer that you're
connecting to is the peer you meant to
connect to and we'll actually talk about
that later in more detail when I get to
the pitfalls of mistakes but the good
news there is that generally on all
modern platforms it's safe by default so
you just use it you know that whole peer
complexity is kind of handled for you
life is pretty good so using TLS this is
actually the shortest part this whole
talk so if you're using HTTP it is
actually just as simple as rewriting the
URL to HTTPS and it just works the same
standard libraries you use just keep
working if you're using URL connection
it's just a simple letter replace and
generally for most HTTP clients it's the
same it's just completely transparent
now if you're implementing your own
custom protocol it's still easy but a
little harder so you can use if you just
use Java sockets you can basically just
wrap it with just use an ssl socket
instead there is one very very big
pitfall
you need to keep in mind is that unlike
what the HTTP clients do SSL socket does
not check that the host that you're
connecting to is the host you expected
to connect to and this is something
really important if you don't do it your
connections are completely insecure and
I'll talk about more when I get to the
mistakes so here's some sample code the
important bit is this hostname verifier
dot verify to check that you know we
actually connect to android calm and not
say evil comm so on the server now this
is probably the hard part for a lot of
you and unfortunately I'm gonna
basically skip over it because I have 45
minutes and this is a really big subject
so if you're setting it up on your own
server SSL Labs has a really good best
practice for deployment document however
can you read it and generally if you're
just using some cloud service for your
back-end everybody has pretty good TLS
support nowadays so use it so okay so
let's say you decide okay I really want
to use it I've gone through and I think
I've replaced all of those HTTP URLs of
HTTPS but how do I know that everything
that I'm sending is over a TLS
connection like how how can you be sure
it's always important to test especially
with security code you want to make sure
you're actually doing it right and so
why do you have to do this so let's
consider the most obvious case of source
code right I open just a static you know
htps example.com and I go there is this
over HTTPS yes
but it's actually more complicated than
you'd think because what if that page
immediately says actually the content is
over here on HTTP example.com so for the
HTTP URL connection in Android it
actually explicitly does not follow the
redirects but if you're using a custom
client that might not be the case and
it's actually a little tricky but that's
not how you usually use URLs what you'll
often have is that you'll get them from
your server back-end so consider you
have you know a bunch of contacts that
your server pushes down and one of those
things is a profile picture your data is
basically gonna be like you know name
chad profile picture you know here's a
PNG on the internet somewhere and you're
just going to blindly open that URL and
this works great on android like whether
it's HTTP or HTTP your code just works
but what happens if you know today when
you ship your app it's a she
yes but then six months down the line
you're doing some tweaks on the back end
and you accidentally set those to http
and you don't realize like suddenly all
those security guarantees you were
trying to get are kind of out the window
and finally what about the third party
code in your application right you don't
want any of your traffic to go out over
non secure connections but what about
that ad or analytics library are you
downloaded do they do they respect that
how do you know I don't know so what do
you do
so in marshmallow we added a couple of
features to help you both in development
time and actually released on devices so
the first thing we have is some new
strict mode detection for clear text
traffic so while you're developing you
can detect stuff and also a manifest
flag that lets you specify whether or
not you plan to use clear text and these
are not just for HTTP HTTP this is for
anything so first of all the strict mode
support so the goal of this is you know
while you're developing and use your
standard strict mode stuff to detect
clear text traffic notify you crash the
app whatever that way as you're
developing you can find these issues and
the way the strict mode detection works
is it actually does packet inspection of
every single connection that leaves your
UID for your application and it checks
to make sure that the very first thing
it sends is a TLS client below basically
the start of that secure handshake and
that's good because it means that no
matter what your code is you know it's
native it's some it's doing some weird
custom written stuff it will detect
absolutely all of it the downside though
is that there are some false positive
issues because not everything that uses
TLS starts immediately with that client
hello even the most basic example if you
use an HTTP proxy to send HTTP still
secure but the very first thing you'll
send is actually sort of a connect
message and likewise if you have like
protocols like XMPP or IMAP those
actually I do a little bit of
handshaking before they say ok now let's
switch to TLS and those will all get
unfortunately detected by this but this
will let you at least if you're doing
just HTTP HTTP this will let you check
at development time pretty easily and
that's great so the next side of things
is oK you've shipped your app but how do
you protect against kind of accidental
regressions right
like the example I had where your back
end six months down the line starts
pushing HTTP URLs instead of HTTP I'm
sorry so for that we added an manifest
flag called users clear text traffic and
what this is for is for you to basically
say to the system I do not intend to do
any clear text traffic so if I do please
stop me
and this is completely best-effort so
it's up to libraries to support this as
far as libraries that support it right
now all of your HTTP URL connection okay
to be the apache HTTP client all of you
support it download manager media player
things you do through that unfortunately
not supported is webview but if you're
using those standards so if you're using
those standard libraries you set that
flag and if you know six months down the
line you accidentally do that URL change
those apps like those connections will
fail they'll throw an exception hard
fail you don't send any traffic out over
the network and the clear where someone
could do bad things with it so the
question I get quite a lot is why do you
block traffic instead of doing sort of
transparent upgrading and there's a
couple reasons for this
so first of all if you do transparent
upgrading all of your older devices are
basically just kind of left out like
they're completely out of luck if you
only develop on a newer device you might
not even know that you're actually doing
these connections over HTTP like you
just see them ending up going out
securely and finally upgrade logic is
actually not it's it's a big pain so
first of all for non HTTP it might not
be obvious what the sort of upgrade path
is it might actually require like this
protocol is just completely not allowed
and also like just doing the standard
rewriting of HTTP HTTP might break your
connections like there's still a lot of
websites out there right now where if
you connect them over HTTP the
connection works but like this
certificate you get is for some random
CDN they're just some like complete
noise so instead by blocking you'll know
immediately and you'll actually be able
to say oh okay I'm like you you know
you'll get the crash notification you'll
see oh crap this you know is now over
HTTP you can fix it and you can fix all
the devices not just the devices running
em and newer but absolutely every device
and that's a lot better
so it's water real quick so now my
favorite part because I'm a security
person are the various mistakes and
misconfigurations that people make so
how do you know that using TLS correctly
well the good news is is secure by
default on basically all modern
platforms so if you don't try and do
anything custom you are good to go
life is great you don't need to do
anything unfortunately it's possible to
override a lot of these defaults and
you'd like to hope that no one overrides
these with you know insecure code that
it's always secure code that's well
thought out but that's really not often
the case and so throughout this whole
thing I'm gonna be referencing a lot of
information that's also available on the
security SSL training article it has
code samples for all this it has a lot
more words that I'm gonna go into and I
highly recommend you read that if you're
ever doing TLS stuff please look at that
first because it's a better source than
most of the Internet so why do people
put in secure TLS code into their app
well the simple answer is that what
happens is someone has an issue they go
on a forum they post hey I have this
issue someone hands them a code sample
that says like yeah I just take this
this will fix your problem you know copy
and paste it into the app or run it you
know good ship it the problem is is that
most the code samples provided are bad
they fix the problem by basically
removing all the security so you'll
never see that security exception again
because you'll never see a security
exception and that's not what you want
so before I kind of go into these I'm
gonna go into slightly more detail about
what checking trust and TLS actually is
I'm gonna skip over most of it because
it's really in-depth and I don't think
you need to know most of it for the
context of this if you want to you can
go read an RFC have fun with that so
there's there's two big parts about TLS
trust checking at a very high level
first of all that the person you're
talking to is the person you intended to
talk to and that they they have a
trusted certificate saying they're that
person and these are slightly different
so for example like I can go and I
register evil calm I can go by a
certificate for that because I own it
and that's all fine but that doesn't
mean that my certificate for evil calm
makes
be trusted for Android comm right I'm
only trusted for that and likewise like
anyone can make a certificate for
Android comm and say yes hello I am
Android comm please trust me but you
should you actually do make sure that it
is trusted and both of these two high
level things there's a lot of bad code
out there on the internet it breaks
these so the first one I'm going to talk
about is making sure you're talking to
the person you expect to talk to so
because obviously if you make a secure
connection to evil comm that's probably
not what you wanted when you wanted to
make a secure connection to Android comm
to send you know whatever user secrets
are magic you wanted to send and now
this is done for you by standard and all
the HTTP libraries again if you're using
ssl socket it's not have to do this
yourself if you're not you have a very
big problem so the problem that gets a
lot of people to take code off the
Internet is dealing with legacy clients
or legacy servers can be kind of tricky
so say you have a server and on that
server you host a bunch of different
domains like most servers do you have
example comm example.org and save and
Android comm and each of these has a
completely different certificate and
when you connect so you connect the
client says hi I'm talk to us please
give me your certificate which one do
you provide right you've got three
possibilities you need to provide one
which do you do so the good news is that
this problem was solved a while ago and
TLS was with what's called the server
name identifier which basically says in
the client hello hi I want to talk to
you LS and by the way I want to talk to
example.com
but you might not always have that so
for example if you're dealing for really
old clients you might not get that or
also if you're using an older protocol
like SSL v3 which doesn't support such
things so how do you make sure that
those connections still work so the
right way to do this is a little
complicated but you basically need to
check that okay I know that the default
for this server is actually gonna give
me example com so when I connect to
example org I'll actually explicitly
check that I got a certificate for
example com now it's important to say
that you probably don't need to do this
s and I has been supported on Android
since 2.3 so if you don't support back
that far don't worry about it there is
an asterisk around that which is that
the way that a lot of HTTP clients work
is they'll try to connect with sort of
like the most modern TLS settings and
that may fail because unfortunately on
the internet there's just a lot of old
kind of bad networking hardware that
chokes on TLS and so they'll do sort of
a protocol downgrade and that can lead
to you decorating to SSL v3 on some
libraries and then at that point you no
longer have the subject name field so
you might get the wrong certificate but
usually if that happens SSL v3 will fail
as well because you're just on a bad
network so the wrong way to do this is
very common advice out there is you
replace the default hostname verifier
with this hostname verifier that always
returns true so is evil comm trusted for
this connection to Android yes this is
kind of like obviously bad code please
don't ever use this like it's very easy
to man the middle I go by a certificate
for equal calm in your connection to
Android comm I just hand you that
certificate you say oh yeah this is
trusted so it was issued for evil comm
connect so this means that you will
connect to basically any valid
certificate and anyone out there can go
buy a valid certificate for their own
domain it's 20 bucks nowadays you can
probably also just get them for free so
even if you have a valid certificate
it's not just valid everywhere it's
valid for one specific thing and you
really need to make sure that's the case
so the the next thing is actually how do
you make sure that there's the
certificate that you got is trusted like
what does that mean so again this is
gonna be very high level I'm not gonna
go into it a whole lot of detail because
it's very complicated there's rfcs the
size of my arm you can read if you wanna
know the full detail but this is gonna
be just a very high level overview so
when I say like how do you verify the
peer so what is the peer in TLS it's
usually represented by sort of their
certificate that they provide so you
have some options for like how do you
trust this you could always hard code it
but that doesn't really work because
certificates change and they change very
often for example google.com certificate
it rotates every three months so you
can't just say like in your application
you know I expect this to get to be this
because in three months it's gonna be
completely different and generally that
doesn't scale like what if you're an
application that
you're like an RSS feed reader and you
just kind of got to the Internet you
obviously can't hard-code the
certificate of every webpage on the
Internet in your application
I hope don't try so what is the
certificate it includes the name so who
is this for
includes the public key for the
asymmetric crypto should I have to worry
about for this talk but crypto keys are
in there and it contains an issuer and
this is someone that's basically said I
am stating that you know that
cryptographic key up there is tied to
google.com so this would be like
Verisign or GeoTrust or you know
certificate authorities you've heard
about and it contains a bunch of other
things yeah expiration day it's key
usage etc but we'll skip over those so
the issuer itself is also a certificate
so school.com certificate is issued by
Verisign that very science certificates
probably by another Verisign and you get
this chain so you have this nice chain
but like how do I know if I trust this
chain sort of like you keep building
this but it's kind of Turtles all the
way down if you've heard the expression
hopefully you have in the end you still
need to say like do I trust this long
chain of certificates and the way you
handle it is you know your operating
system or your application ships with a
set of trusted certificates and so these
are sort of your very top level routes
and then you get a chain from your
server and your server says I'm Google
comm and I'm like I don't know that
certificate but I was issued by Verisign
and so you know you do the lookup and
you say oh okay I actually do trust that
Verisign certificate it shipped with my
application it shipped with the phone so
another question that comes up pretty
often so I'm going to kind of detour
into that for a second is how can you
trust the sea-ice on the device you know
like you look and there's a hundred or
so and yeah you don't know who most of
them are like how do you how do you
trust them it's sort of a hot topic so
there's sort of two things to keep in
mind when you're asking yourself you
know how do I trust these guys why can I
trust these guys first of all they do
have a lot of strict requirements
there's audits etc just to get in sort
of general certificate authority lists
not just for Android but sort of this is
the standard in the world and finally
like not only is it hard to get in but
there's actually a lot of work to verify
that you know is doing anything bad so
you have things like certificate
transparency where you actually note
down like what certificates have you
issued or things like
so that you can actually detect if
anywhere in the world someone misses a
certificate even if it's you know only
used once and that lets you know detect
misuse and then from there you know
there's risks to business you know all
that fun stuff so
okay back to trust checking so the
problem is is what if you want to trust
your own certificate that the system
doesn't normally trust then this can be
for a couple of reasons maybe you want
to use your own certificate just for
local debugging right you don't want to
take the certificate for your actual
back-end and put it on your random
developer workstation that's probably
not a good idea that just doesn't feel
right and secondly you might actually
just not trust certificate authorities
like sure I made a very quick argument
about why they're a pretty reasonable
source of trust but maybe you don't want
to and that's fine so maybe you want to
run your own certificate authority and
ship that with your app and only trust
that or maybe you have you know some
internal network and you issue
certificates for internal webpages using
that and that's obviously not trusted by
the device by default so you need to
sort of ship it with your app and make
sure that your stuff and connect so I'm
not even going to include the code for
the right way to do this because it
would take four slides when I tried it's
it's pretty braavos but you can go get
it off that security ssl training
article i told you about it's not
complicated it's just it's very verbose
java so I'm going to save you from that
but the real gist of it is you basically
take the certificates you want to use
and you tell the system okay these are
the trusted routes for this connection
connect as normal and that all works but
unfortunately the code that you usually
find on the internet when you search for
that exact problem is this and this code
this code isn't the clearest so it's
gonna require a little bit of
explanation because it's it's very
verbose so we make an SSL context not
important we make a new exponent trust
manager and it has these three methods
check client trusted check server
trusted and get accepted issuers and
then we set this as the default socket
factory so it's used for all connections
so what does this actually do so we have
this blank check server trusted method
what does that mean
well if you go and you actually look at
the real documentation and you read
check sorry trusted throws a certificate
exception if the certificate chain can't
be validated there isn't trusted
okay so that lime is completely empty
so it will never throw that certificate
exception it will always be trusted no
matter what garbage you give it and
that's bad because that means that
absolutely any certificate in the world
is trusted and it's completely trivial
to make a certificate right it's just a
bag of bytes run it through open SSL
done again do not ever use this code now
I have seen this in actual production
apps but also a lot of apps tend to use
this code for debugging sort of you have
this if debug install that check and
that's okay so long as you're you never
actually ship it and unfortunately that
happens sometimes so the better safe
thing to do is don't ever just don't use
code that disables the verification
completely that is way too big of a
hammer and way too dangerous for local
debugging what you should do is again
back to this code that I actually
skipped is have a CA that you use only
for debugging you know on your debug
build put that in your app trust and
trust that certificate do not turn off
trust checking all right
if you accidentally ship that suddenly
all your users are now you know easy to
attack and that's not what you want to
do okay so sort of lessons for you if
you're not overwriting the secure
defaults there's nothing for you to
worry about right you're good to go
life is great but if you are some
important takeaways first of all make
sure you actually need to write so the
host no verification example is start
I've actually met with some developers
who said they needed to do it before you
know making sure they had s and I
working on devices that didn't support
it which was odd because the earliest
version they supported was jelly bean
which already had this right so before
you even go customizing it like please
be sure that you actually need to
because this is sort of like the most
dangerous way to do things
secondly once you decide that yes okay I
need to do something custom chat I'm
gonna do it
please don't bind we take code samples
off random pages on the internet without
understanding them right like especially
for security sensitive code
unfortunately like there's a lot of
really bad code out there for this
because what happens is someone says
yeah hey
connect to my server I get the
certificate exception and the advice is
straight up just oh use this code and
you won't get this to be an exception
anymore which is technically correct
because you can never get the
certificate exception if you use that
code but that's probably not what you
really wanted you wanted to fix the
issue with that single connection you
probably are using TLS because you care
right so please like don't copy and
paste that code without understanding it
and for most of your common SSL issues
that you run into there's actually
better documentation on that security
and SSL training page on
developer.android.com so really like go
there first not second or last before
you know a random forums random people
give me a code on the Internet so okay
so that's what you should do so what are
we doing about this because those bugs
are kind of embarrassing and yeah
they're sad so there's a couple
different things that's sort of we're
doing on the Android side so first of
all along with many other things for
doing detection of vulnerable
applications in play and actually
notifying developers and being and
telling the fix it not just for these
bugs but for actually a whole slew of
security issues next up this is what I
spend a lot of time doing is actually
tools to find these issues and
applications and in generic devices
there's unfortunately a complete lack of
tools to do this when I started so I
built one and you know finally
investigating api's that make it harder
to do things wrong a general rule for
security api's and if you ever design
anything security to keep this in mind
it should always be easy to do the
secure thing and really hard or
impossible to do the insecure thing
right like over customization is
actually your enemy here so looking at
things on that it's a move away from
these api's that are really easy to get
wrong like the trust managing code is
way too easy to break so some notes on
that vulnerability alert and blocking so
if we detect a vulnerability in your
application for SSL old libraries those
kinds of things you'll get a
vulnerability alert via the email on
your console and you'll get a
notification on that page make sure you
actually go and check these and fix them
because if you don't fix them your
application may be blocked right like
don't ship things with security issues
and if you once you go you fix it you
upload it to play you'll basically
answer back pretty quickly and already
like a lot of vulnerable applications a
lot of installs have been fixed so for
all of you that have fixed things thank
you please keep doing it we really
appreciate it
so finally on the tool side of things
actually a year ago now I released a
tool called no go to fail which is a
network testing tool for finding these
classes bugs and a whole lot of ones I
didn't mention this talk basically all
of your SSL issues not using it using it
wrong in many many ways it's on github
google comment like github Google and I
go to fail and it runs on the network
level so it actually supports absolutely
any device it's not an Android specific
thing I've used it to test random
off-the-shelf things just for fun and it
means that you don't have to change the
device in any way you just plug it in
and it actually works without making
your device unusable so my tablet at
home has been on no go to fail for well
over a year my personal phone probably
spends about half the time on a network
running it and completely usable like I
can still read random messages and get
cat pictures at 2:00 in the morning like
it all still just works what a nice
thing it does support is if you do kind
of have the ability to run code on the
client there's actually this extra thing
of client attribution notification
because what happens when you're looking
at network traffic is you say ok I saw
this vulnerable connection to
example.com I have no idea what on the
phone made that right because you don't
want to just be stuck with someone on
the phone made that connection you want
to say like this app at this time made
this one what connection so we have
support for that and what you can
actually see up here is an example of
those notifications where so the test
app I basically hit the button to like
connect and you merely get this
notification minimum via SSL certificate
for another host name which was the
first miss configuration I talked about
in a connection from the no go to fail
test or app to you know IP port blah
blah blah blah blah so it is an awesome
tool I recommend you play with it but it
does require some advanced setup because
it does do things that network level so
it's more targeted toward a sort of
people interested in security but if
you're interested highly recommend it
then probably I'm gonna I wrote it but
I'm gonna say it's the best tool out
there for this kind of thing and I'm
pretty sure I'm right
famous last words on on camera there so
play with it if you'd like and with that
I've got some time for questions and for
me to drink some water so there's people
running around microphones so if you
have questions I guess stand-up is what
they told me to tell you hi I um I was
curious if a user decides to add to the
devices cost trust store with a custom
root or custom certificate yeah
does that make my app more vulnerable um
it depends the certificate right I mean
I suppose if they added a certificate
that anyone in the world knew yes yeah
generally I would say no cuz what that
tends to be used for is sort of like I
have a corporate internal cert so I add
that or I have I'm doing some local
testing I add a mid MCA to the device
wide so generally no I mean it's
technically possible but generally no is
there a way for my app to decline all
like custom and only use the trusted
store that that comes with the device
yeah so already like you can specify the
like custom set of trusted certificates
like I mentioned earlier you can easily
just only trust the ones from the system
if that's what you'd like to do you
should be very careful doing that though
because if you do that there's a good
chance that your device might not
connect again say for example they added
that you know testing cert that they're
made among all the connections with
chance to do debugging and similar if
you don't trust that CA that basically
means that device you're never your apps
never gonna succeed in the connection
again so it's a trade off you have to
keep in mind some people have made that
trade-off for security reasons but just
keep that in mind yes
alright so through the years the webview
has been made as a component that can
update independently of the framework
and I'm wondering if there's any plans
of doing the same thing possibly with
the boring SSL or essentially whatever
SSL libraries being used so actually
that already exists through Play
services there's what's called a
provider installer which actually does
install the most up-to-date version of
con script which is the library that
does all the
a cell on Android so it's actually
already there it's called provider
installer I believe it's linked on the
SSL training document as well and it's
exactly what you asked for
well my question was a little related to
the question he has two bit ago about
the user installed certificates and I
was wondering if Android is doing
anything to really warn users more about
that like so um you know one place i
think i've is lenovo they shipped with
you know these bad root certificates and
then i also think about like you go to a
coffee shop where somebody's created an
open network and they've got like
charles running on their laptop and they
force you to install their ticket to
connect so okay so a couple things so
there is already notification if you
install certificate in fact there's a
very scary warning that says like we
like your network traffic may be
monitored we basically have no
guarantees for you at this point because
that's true for the lenovo case that's a
little different because it wasn't user
at it it shipped with sort of the
trusted set for that we have CTS or we
have CTS tests to sort of make sure we
don't have somewhere issues like that on
Android for the final thing of you
connect to a network yes if you trick
the user or you kind of conned them into
installing a cert that would be bad
there is a lot of scary wording already
around that so I don't know how
realistic that is of actually convincing
someone like please install my charles
CA but that would be bad
we have one here and then back as well
hi I just had a question about a
certificate pinning what is your opinion
about it
as with the other examples that you show
there's a lot of bad examples about
certificate pinning and there's also a
couple of libraries that are actually
doing it and in the official Docs of
these there's nothing specific about it
so so yes so there is there's no current
any public API to do it as far as
certificate pinning it's useful in
general what certificate pinning is for
those of you who don't know is you
basically say I expected this
certificate to show up somewhere in the
chain so that it's not just that it was
trusted by any say on the device but you
can actually say like you know it had to
come from Verisign or had to come from
whoever now there is some danger there
that you need to be careful of is if
your app has pinning code and you you
know suddenly need to change your
certificate you may break pinning and if
that happens you're kind of out of luck
but something to keep in mind pinning in
general is a good thing I know
okay CP has like AP is for it yeah it is
a good thing and it's something that I'm
I support there are less bad examples of
code for it just because there's
honestly just a lot less examples of
code for it it's sort of the same
overriding the trust manager code just
there's not a lot of code out there for
it I I think in lollipop a lot of cyber
suites were dropped per default I had a
dad once
so my traffic to the server was not
accepted and people were looking at me
because Android the Android app was not
working and I was still working howdy
how can you help get the message across
that well a lot of web servers might
support still old cyber suites
and to upgrade the server because I'm
not the security expert with when I
connect to an old server so to speak
right so people get mean so yeah so
dealing with old servers so what you'd
hopefully see right is you had you'll
get some SSL exception back saying like
basically no agreed ciphers or something
there is actually some information on
the develop age about kind of what to do
the unfortunate thing there is it ends
up just being like upgrade the ciphers
on your server and that's really
dependent on your like what
infrastructure are you hosting online I
probably couldn't give you like specific
advice unless you're doing the exact
same flavor of weird Gentoo Linux
shenanigans that I like to do don't do
that so I don't know the best thing to
do for good advice on that unfortunately
I know people are working on it people
much better at that kind of thing than I
am but I don't have any super great
advice for you unfortunately
anybody else have questions otherwise
you can get yeah so you talked about
basically how to trust a server mm-hm
is there any way to accomplish the
opposite direction how would a server
you want the server to trust the client
client you're in a very dangerous game
if you're trying to do that so I guess
the first question is why do you want
for instance if your web services aren't
intended to be public so for that client
certificates so you actually do have
this two-way thing so the server gives
you certificate and the client can as
well present itself a certificate so for
that sort of case a common example serve
the corporate case right so you your
your IT department issues clients if
they get to all your devices and then
when those devices connect to your
internal servers they present that so
that you know you can do that mutual
authentication yeah so that that is
supported by TLS and it's just a case of
getting those on the devices and that
kind of thing question over here in the
corner there's no one on this side I
can't actually see over here cuz the
lights are all right in my eyes none of
your questions sweet hi so you mentioned
about strictmode
so I just wanted to get a little bit
more context on strictmode versus a TLS
dependability that you're talking about
because it deals a lot with 2vm policies
and the thread policies right so it's
sort of the main difference between the
two is kind of accuracy and when you
should probably use them so the strict
mode detection is actually much more
heavy-handed it does IP level stuff but
it also has this issue of being false
positives and generally with strict mode
stuff you probably don't want to ship
with it on on like shipping out to users
because it does it breaks on things like
HTTP proxies the purpose of that
manifest flag on the other hand is
something that you can sort of safely
ship in your actual production builds to
users so it sort of just differs on that
front as far as the policy between like
thread and VM policy you would have to
ask Jeff Sharkey on the exact
implementation and he's talking later so
you should go ask him but I believe it
actually I don't know and on the
interplay between those two between the
VM and thread policy yeah ask him any
other questions
all right I think there's food and I'll
be hanging out around like the office
hours and stuff if you have more
questions so thank you all for coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>