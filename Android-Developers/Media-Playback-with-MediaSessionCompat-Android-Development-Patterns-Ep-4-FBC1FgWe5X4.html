<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Media Playback with MediaSessionCompat (Android Development Patterns Ep 4) | Coder Coacher - Coaching Coders</title><meta content="Media Playback with MediaSessionCompat (Android Development Patterns Ep 4) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Media Playback with MediaSessionCompat (Android Development Patterns Ep 4)</b></h2><h5 class="post__date">2015-10-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FBC1FgWe5X4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">[MUSIC PLAYING]
IAN LAKE: Oh.
Actions like pausing
your music should never
be too far away, just in case.
Android has offered
a lot of ways
to do that-- lock
screen controls,
media controls for
notifications, Android Wear,
and even Android
Auto, to name a few.
How does your audio app get
started with all this goodness?
It's simple with
MediaSessionCompat,
a single API available via the
Android Support Library that
does much of the
work of integrating
with Android for you.
I'm Ian Lake, and I'll go over
what MediaSessionCompat is,
and how you can get started
on getting your media metadata
and controls everywhere.
Think of a media session as
the public face of your media
playback.
No matter if you're playing
audio, video, or even remotely
via Google Cast, unless you tell
the system what you're doing,
it can't help you.
And it gives you a lot
of ways to help you,
if you publish metadata-- such
as album art and artist name--
and tell it what media
controls-- such as play
and pause-- you support.
But I'm getting ahead of myself.
Let's just create a
MediaSessionCompat
object to start.
Alas, on Android versions
prior to Lollipop,
this requires one
preliminary step,
creating what we call a
media button receiver.
This is what captures
media controls
from things like Bluetooth
headsets and Android Wear,
and delivers them to your app
on devices below Android 5.0.
It's a simple
broadcast receiver,
you register in your
manifest like this,
and translates the
key event you receive
into actions for your app.
Generally, just delegating the
actual pause and play commands
to the service actually
controlling your media
playback.
Check out our training
docs for an example.
OK, finally, a
MediaSessionCompat.
You'll need a context-- any
string to serve as a debugging
tag-- and the component name
of your media button receiver.
The last null is
a pending intent
you can use instead of the
component name on Android 4.3.
It is created for
us if we pass null,
and it's usually the
right thing to do.
Now you probably want
to do three things
before going any farther.
Set the appropriate flags to say
we actually have media button
controls, and want those media
button events sent to our app.
Next, we'll want
to set a callback.
This is where Lollipop
and higher devices
will get callbacks on
play, on pause, and others
when a button is pressed.
Finally, set the
session to active
when you're ready
to play something.
This is the cue to the
system to route media buttons
and other controls to your app.
OK, so the plumbing
is set up and ready,
but we never actually tell
our media session anything
about our media playback.
How will it know what is playing
or what controls we support?
First part is handled
by MediaMetadataCompat.
It uses a builder
pattern, where you just
add all the
information you have,
then call setMetadata
on your media session.
But still no media controls.
Ah, it's because we haven't
done the other part,
publishing a playback state.
PlaybackStateCompat
actually has two purposes,
the current state-- such
as playing or paused
or buffering, set via
its setState method--
and the current actions-- such
as stop or pause or play-pause,
set via its setActions method.
It contains both because
usually the actions change
at the same time as the state.
A stop state probably
doesn't have a pause action,
for example.
That's enough to get
MediaSessionCompat working.
You'll find integrated media
and Bluetooth buttons for all
API 8 and higher devices,
and lock screen controls
for Ice Cream Sandwich, Jelly
Bean, and KitKat devices.
You'll also find that
MediaSessionCompat
works great with
NotificationCompat
and MediaStyle, part of the
AppCompat support library,
giving you great looking
media notifications on all API
levels, even including
inline media controls on API
14 and higher devices.
Just remember to
call SetMediaSession
with the special
unique media session
token from your media session.
This is what connects your
media session to Android Wear,
and you gives you media
controls on Wear for Android 5.0
and higher.
Oh, don't forget to call
release when you're all
done with your media session.
Really, don't forget.
We've only touched on the
basics of MediaSessionCompat.
We haven't talked about
media browsers or media
controllers or a
whole host of things
built on top of media session.
But this should get you started,
and make your media playback
information and playback
controls available
everywhere it can be.
I'm looking forward to
seeing your awesome media
using MediaSessionCompat,
and I hope
it helps you build better apps.
And, release.</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>