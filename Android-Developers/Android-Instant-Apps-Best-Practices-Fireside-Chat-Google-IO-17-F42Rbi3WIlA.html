<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Android Instant Apps Best Practices Fireside Chat (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Android Instant Apps Best Practices Fireside Chat (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Android Instant Apps Best Practices Fireside Chat (Google I/O '17)</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/F42Rbi3WIlA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Maru
I'm a developer advocate working on
instant Maps and we're here today to do
an Android instant up best practices
fireside chat flat forwards as you know
we announced instant apps last year at
Google i/o to LA to developer excitement
and we're so happy that we're able to
open it today to all developers and in
the process of getting here we worked
with a large group of developers to get
all those nice outfits on the previous
sessions some part of that group is here
sitting with me today so we have our
panel from cash box Twitter Vimeo
delivery and Zillow so let's go start
with some intros first Allen along is
the product manager forecast box and he
loves listening to podcasts he works on
trying to optimize the listening
experience and podcast for his users
Allen tell me which ones are your
favorite podcast serial This American
Life
especially 99% invisible oh because me
right here
Oakland California oh nice Oakland
anyone from Oakland here okay next we
have Leanne from Twitter and yeah Leanne
is the senior staff software engineer
for Twitter and she works on periscope
she was a tech lead for the fabric team
as well and she worked on the mobile
Twitter app she likes to hike
she likes action craft and she also
likes to work in the garden
liyan let's see
any favorite spots that you like to hike
in yeah so I have a spot down on the
peninsula called hidden Villa and it has
a lot of beautiful trails my favorite
runs alongside this Creek it's got lots
of shade and gently sloping trails so
it's a perfect hike for me and my son
who's four Oh
good hello hidden be nice
next we have Kyle Kyle from Vimeo
Kyle's style came here from New York
City and he is the Android lead for the
Vimeo app he worked both in the creation
of the mobile and the TV apps which are
both great and he loves to travel and he
told me this story that I think he
should share with you guys some his last
trip yeah actually my last trip I got to
bungee jump off of a bridge in the bob
way which is a ton of fun how was that a
blast exhilarating and it was right over
a river so kind of horrifying scary yeah
great um now we go to Emma Anna is from
deliver Russia came from London long way
here thank you Anna Anna works from the
consumer application for delivery she's
an Android engineer and she loves sweets
so she has a funny story about her order
history in the liver yes so if you look
at my older history you will see that I
mainly order sweets but I also have a
throne yes I was at one front because I
was showing my sister what I was working
on and I just told her no matter what
you do don't press this button and as I
was pointing to that button I just
touched it and they place an order
someone got free prawns
they were Protestant right now we go to
I know your name Lucas Lucas from villo
Lucas is the software engineer in the
Zillo team and he worked from their
mobile app he's been a pillow for three
years and Lucas likes to play games and
also to watch random documentaries in
Netflix on YouTube tell me one just one
random document so one documentary I
watched recently on YouTube was about
harpy eagle it's one of the largest
Eagles in the world and it's in South
America and it's really fun to be able
to fall around a baby heart harpy eagle
for four months and a one hour
okay so what we were trying to do here
is that you guys get to know us a little
bit before we start and now we're going
to go through some questions I'm going
to ask you serious questions now about
the work that this panel data on insta
naps most of it is going to be very
technical some of its going to be
product questions as well and after that
we're going to open the floor for Q&amp;amp;A so
we're going to have two mics that you
can come up and ask questions and that
will be for the last 15 minutes so don't
run off when we're done okay so we're
going to start with the questions first
is the Y so that's the first question we
get right why would you do this so why
why would you invest your resources and
time in building this so Alan white what
made you decide to build an instant up
forecast box so we took a risk to try an
app out because we believe use an app as
a it's useful for people who don't
currently use caps lock you have a first
impression with our platform for example
if you listen to episode on this
American life or Planet Money and using
cat falls and blew your mind and you
can't wait to share it with your friends
Guero
who happens not have the app involved so
you click the share button to know the
link within snap um where you can click
the link and capsules will load right
away and start playing the episode that
you think Carol would like we get a
little bit we get some traffic from
search engine as well if you search for
episode they want to listen and click
link from the search results page that
triggers the instance app experience as
well we have we actually have a website
with the full functionality and with
over half a million on podcast channels
we use the website for internal testing
operations team to validate traffic or
take down some bad traffic it's already
mobile to mine so initially we use the
webview wrapper
Oh - try - up out so that brings a good
topic should you take a website and put
away three wrapper around it and build
an East enough we when we were working
with cashbox we gave him a
recommendation to move away from that
and go a full native experience and I
think we gave him this feedback on a
Friday afternoon and then they said sure
we'll have it ready by Monday I know how
it's like now tell us a little bit about
what you guys did for them right so if
we take a step back um first of all we
could see the difference
so obviously web view is slower the
scrolling is less smooth we we care
about our user experience so we actually
don't want our users to much time now
our using a face protect we actually
want them to come in and listen to the
episode they like so internally we track
two metrics one is polish and time which
is about one to two hours per user per
day typically two time users spend on
using the user interface itself which we
try to minimize some extent um that's
the main reason we wanted to move from
web view experience to the full native
experience so over the holiday weekend
the cheering themes it's a refactoring
and put in the native code detecting and
got a lot of useful feedback from Adams
from the operations team which always
responsive and helpful we added a few
features such as the we added a dialog
to pop up the install to install the
regular app for instance if you listen
to our episode you want to subscribe and
the dialog will pop up say that you can
subscribe to the channel by downloading
the regular app because we haven't built
the full user profile system yet we
haven't used
the full features yes the team initially
thought would be too much work right
turns out to be easy because the app is
already bought your eyes that speed up
the development process we use data to
framework as dependency injection to
build the UI we use the Excel player
kind of the playback the into library
together with many other libraries are
well supported by the internet and seek'
so that made the development process
fast and straightforward as we move on
to iterate internet we can add other
features as well such as in-app billing
for users who want to share premium
content they to someone who doesn't have
to really wrap in salt so that person
can use you snap and not willing to
purchase that content for example
blackboard is not lead on the journey
from web view to so native if that
cannot be completed by our hard-working
cheering team some of the in the
audience so team and the fantastic
support by the several team and PD team
of Google so on a very big thank you and
we're really excited about internet and
as we add more features in the future to
make the experience even better for
users awesome thank you yeah Alan now
the next question we get is how long how
long does this take
is this really difficult or is it easy
he said it was easy
are you believe him sonali and this is
your question this process takes from
the premise that we worked with we saw
that it could take as little as three
days to six weeks so we're saying it
average we think it can take from four
to six weeks it really depends on how
modular is our app is or where you are
so how long did it take you to build it
periscoping set up and where were the
easiest or hardest things you did
for periscope I say it took us about
three weeks total over course of several
months to build a production ready
instant app periscope was in the first
wave of partners and we started
development back in September being in
the first wave of in synapse meant we
were getting very early versions of the
SDK and we get these drops every week
whenever we got it we would test it
build it see what issues there were and
verified bug fixes so it was a really
iterative process between Google and us
a lot of rinse and repeats but by the
end of October we had a fully functional
instant app to the point that it was
even demoed at the Google Play time
event in SF in November and that was
really exciting for us to see because it
was just validation of all the work that
we were putting into the unsnap and the
progress we were making in terms of
easiest I'd say there were two reasons
why I felt like the periscope instant
app developer was relatively
straightforward the first was the
periscope Internet sorry the periscope
app at that time was already modulized
so in March of last year we had spent a
lot of time pulling out poor playback
functionality from the app into a
library and what we were doing with this
library was bringing this library into
the Twitter for Android app because we
wanted to have a native viewing
experience within the Twitter for
Android app so what that meant was we
had a head start here when we started
the announce project we didn't have to
focus on modernizing our app we could
hit the ground running and really focus
on just integrating with it and snaps
SDK the second reason I felt like the
whole process was enjoyable for us was
we just had a great working relationship
with Google and this was super important
because we were in that first wave of
internet development there was very
little documentation we were learning as
we are going both sides and our
developer advocate Arun
really did a great job partnering with
us to make sure we were set up for
success so we were getting quick
turnaround times on bug issues
status updates on issues and how they
were tracking google also vetted all the
third-party libraries that we were using
so we didn't have to worry about
compatibility issues they also gave us
tips on what we can do to reduce our apk
size and they shared a lot of their tips
at another iOS session today and we got
a lot of testing supports again being in
the first wave we had access or limited
access to devices so we couldn't do a
lot of testing in-house and we were also
under NDA so not a lot of people knew
what we were doing so then I would say
made it easy for us in terms of what was
hardest I say the hardest thing for
periscope was just being aware of the
subtle differences between a regular app
and an instant app so instant ABS run in
this sandboxed environment and what that
means is there's not a one-to-one
mapping of the API behavior between the
regular app and instant app and we saw
this right away when we were looking at
how periscope parts were being rendered
periscope parts are like a core
experience in the periscope community
they're what viewers use to show their
supports and appreciation for what the
broadcaster is shown so getting this
experience right the periscope parts was
really critical for us it needed to be
exactly the same between the instant app
and the regular app and the fix for this
was actually easy what we were doing is
we were calling create bitmap and we are
using this three parameter version to
create a fit map it took Indah with the
heights and the bitmap configuration but
in the internet world you need to give
it a little bit more information so the
fix here was we had to switch to using a
four parameter version and that fourth
parameter was one that took in the
display metrics and that gave us the
density a compatibility mode in order to
render those bitmaps correctly in the
internet world so the key takeaway here
is just to really take a lot of time to
test your app thoroughly because there
may be a subtle difference in how the
API behaves
in its naps because they are running in
this sandbox environment they have
restrictions and platform limitations in
order to make it secure for these
instant apps to run on the device and
Google has come a long way since we
started again we were first wave and the
tooling and the support is really there
there's a lot of lint support in there
that will help developers with this yep
thank you so we move now to tiles we're
going to talk about refactoring
refactoring is or can be the scariest
thing when you read the docs and you
think am I going to be able to do that
so we wanted to talk about what it means
to refactor water
recommendations that Kyle can give the
audience in terms of how to make this
process easier so Kyle would you give
the audience some recommendations on how
refactor the app but also how to reduce
the educate size yeah absolutely
so the VA was app itself the full app
actually started 16 megabytes and to get
down to an instant app you need to have
each feature be four megabytes so for us
we were going to build a player instant
app that we needed to chop down a lot of
megabytes on um so with that we found a
lot of different tools we could use and
different things we could do to
accommodate that and get there as fast
as possible one of the we kind of
started with a low-hanging fruit of the
easy things so of that you have a tool
that's built actually right into Android
studio which is for removing unused
resources so you extras going to
refactor on Android studio removed on
these resources and that'll kill things
like layout files that aren't being
referenced anymore and then because of
that it will remove any pngs and are
being used anymore
so that's a really good place to start
that's kind of where we began the next
piece is actually little bit meteor and
more technical and I guess that advice
is basically trying to look and draw out
a dependency tree for whatever feature
you're trying to turn into an instant
app so for look what would that end up
looking like is basically taking the
activity or fragment and then look at
all the imports
the file and then see what those
importance what those point2 and what
their dependencies are and it actually
helps us to draw this out just you can
see exactly what classes this feature
will depend on so in our case we
actually started by you know we thought
all along that we had then modular izing
our code making it super easy to just
pull out all like our player activity
was inside of our player package so we
started out by just trying to cut that
and paste it into a module so in doing
so we were like oh hopefully this is
going to work but sure enough ended up
having a whole bunch of those red
squiggly lines on all of our import
statements which was of course daunting
but from there we kind of started
figuring out well what are the things
that we can cut down on what are the
dependencies we can remove from our
player activity so what that ended up
looking like I guess a concrete example
we ran into was we use fresco for our
image caching which if you're unfamiliar
is actually a pretty large library it's
great because it's super performing but
it's around two megabytes which in the
world of instant apps is absolutely
massive
I mean it's half of your requirement for
a feature so we basically had to find a
way to pull out fresco and then swap in
some other form of image caching so what
that end up looking like was we created
this interface which handles all of our
image caching for us which you then can
basically stub in and inject which
different implementations like to use so
the way that we use so basically for our
full app we use fresco because we like
the performance but then for the instant
app we use Picasso which is only a
couple hundred kilobytes which of course
we still get image caching may not be as
fast but it still works so that was a
big piece for us the last thing is
something we actually I think kind of
did relatively well which was relying
pretty heavily on composition so for the
player activity we of course have this
player component that we rely very
heavily on for all of our playback now
our player has to be able to accommodate
360 video playback it has to be able to
do chrome casting we have offline
playback of encrypted files first so you
can download to watch later and because
of that we we knew we had to build our
player in such a way that we could
easily add in these pieces or inject
them in so because we have
the same codebase really for both our
mobile apps and our TV Android out we
started this process because we didn't
need things like that it ended up
benefiting us in the long run using
dependency injection at that level
because then for our instant app we
actually don't need to have 360 we don't
need chromecast
we don't need offline playback because
it's not currently supported by in
synapse so it's actually really easy
just to remove these large dependencies
so with 360 you get things like the
cardboard SDK which is pretty large or
with chromecast you have Play services
which is also pretty large offline
playback cut a whole bunch of like
encrypt your files
so basically we're able to remove those
right off the bat and that saves us a
ton of space so I guess basically just
to sum up all that stuff it's it's
really a matter of just looking your
dependencies seeing exactly what depends
on what what our things are absolutely
necessary and if there's something with
relatively large think about wrapping it
in an interface try to compose your
different pieces with that interface you
can either potentially omit it entirely
or swap it for something smaller like we
did with fresco and then also for people
that are going to be building new
features going forward something that
we've started doing and has helped us a
ton it's actually just we built a new
feature into your app build it as a
module build its own totally a library
module that your main app depends on and
then keep an eye on that build.gradle
file because that'll tell you exactly
all the things that are consuming all
the space and those are the things that
are gonna get you in the end and of
course if anyone has any questions about
our particular implementation you can
feel free to ask me after thank you
of course
so I think that that's a good segue into
the next question
doing some of this work that you do for
your instant app may result in benefits
for your installed up or you installable
up so that's like free a free wing that
you're getting when you're doing this
work so Anna what was was there any
benefit or did the work that you did on
your instant knob have any benefits on
your installable up yes yes it had so
when we started to work on our instance
up we knew that we are going to change
the structure of our projects this
because within sometimes you give users
the opportunity to after the feature
from your application and this means it
has to be in a separated module so this
was one of the biggest challenges that
we faced because we didn't have modules
and we brainstormed a lot in order to
find a way to split all projects in
meaningful units that could be used in
both insult up and doing sums up because
we we took this approaches we didn't
want to have the feeling in the future
that we are going to maintain two
different applications so because it was
such a big change we decided to do it
gradually and as we release often we
didn't want to have any impact on on our
customers so now having more modules it
increased our build time but the Indians
we learn so much during this process we
have a better project structure and I
think with the new tools that were
announced today we are going to see some
improvements some other improvements
that we did with our in our application
were to reduce the size of the apk and
the number of methods and how we we did
it we started by looking our Prague our
files just to make sure we haven't
missed anything and then we looked at
the libraries that we used and we
decided to remove some of them for
others we looked for a lighter version
as we replace them and
then we actually noticed something
interesting so while we are
investigating why our resources are so
big we found out that some libraries has
lots of strings that were localized in
so many languages that we didn't used in
our application so we change the Gradle
script so that we can include only the
seven languages that we support and this
also decreased the size of already case
so after all these changes we notice a
decrease in our application size by
about 20% and other changes that with
this but not necessarily related to
refactoring but they were related to the
fact that we were building an instant up
so one example was adding smart lock for
passwords this was recommended to having
any thumbs up and it was very easy to
integrate and we felt that it was a very
good feature and we decided to have it
in our installed app as well as we
simplify the sign-in experience for our
customers and in the end we have a great
team available they are hearing me in
the audience we are constantly improving
our application and during this program
we learn so many things we have we have
now a better project structure we remove
some of the libraries we kept only the
ones that work truly helpful for us and
I will say that the fact that we
decrease the apk size gave us a big
bonus that's good 20% even but awesome
and this is on this collab now being set
up so that's good also yeah we hear all
the time how much text app you have on
your apps and you never have the time
and and you know it's not a priority for
the product team to fit to give you time
to work on this but now that you if you
work on instant apps and you have that
time to you know work on some of that
cleanup and things that you always
wanted to do or maybe didn't but it's
good for your app thank you
now we're going to go to Lucas and this
is our last question before Q&amp;amp;A
so Lucas now that you've gone through
the process of building an instant out
for Zillow what are some recommendations
or what what are the things that you
wish it known before you started this
process yeah so I think one of the big
recommendations I would have is to
definitely sit down and read through all
the requirements for Internet's and make
sure that everything you think you have
implemented you actually test to make
sure you have implemented so for the
longest time we thought we had a
plinking and blended correctly in our
regular app the problem was we went to
test it to make sure that it was working
it didn't so we had the kind of whole
development on our instant app and make
sure that we got app linking actually
working in our main app and so you know
just make sure that you look all that
over and pet for sure test it before you
just start working on this and app
another thing to keep in mind is that
network calls and in synapse all have to
be secured network hauled so we had to
go through and audit our network library
to make sure that everything we had was
using secure network called and we also
had audit all the third-party libraries
who are using it turns out one of our
analytics libraries was using unsecured
Network calls and then they were just
basically not working all in instant
apps to go through and make sure that
you can either work around those Network
calls in your instant app or you know
reimplemented in a secure way another
big thing that I would recommend is to
get very familiar with build tools like
Kyle Record recommended the apk analyzer
I think probably around 70% of our work
was to cut our app size down and these
tools are definitely a lifesaver another
tool that we ended up using a lot was
actual gradle dependencies which would
print out a whole dependency tree for
you and it will not only show you the
libraries that you depend on but the
libraries that those libraries depend on
so you can see all your transitive
dependencies and you can actually
through Gradle you can exclude some of
those transitive dependencies so we were
able to exclude like third-party
Analytics libraries and that was able to
help cut down the size of our app quite
a bit and then another thing to look at
for size lies is your assets make sure
you're not using really detailed assets
when they can't really tell the
difference I think we ended up just
totally removing our two most detailed
folders of assets and that ended up
helping to get us actually down below 4
Meg's so that we could actually get her
instant app up and running that was
working and last thing we found out was
we had a crasher on startup of our
instant app and one way that we were
able to debug it was I
since instant apps are just a zip file
with feature module apks you can
actually side load those apks onto your
phone like you would a regular app and
that way when you start it up it would
start up just like the regular app would
and you wouldn't lose some of these
exceptions in the Indus factories and I
think the last thing I'd like to say is
that you know it kind of it sounds like
this might be a difficult thing to do
but trust me it's worth it I think it
provides a great experience for our
audience that's really what we're all
here to do is provide very experiences
for our customers awesome thank you if
you're interested please go that jesus
vo slash Ustinov 4 at the sandbox office
hours and you already probably watched
the last session so thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>