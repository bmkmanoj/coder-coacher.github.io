<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Game On!: Turn-Based Multiplayer | Coder Coacher - Coaching Coders</title><meta content="Game On!: Turn-Based Multiplayer - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Game On!: Turn-Based Multiplayer</b></h2><h5 class="post__date">2014-02-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rbYweTLvD-s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello game developers and welcome to yet
another episode of game on I'm your host
Todd Kerpelman and I am here today with
Wolff Dobson who is not going to be
talking about physics but is going to be
talking about something just as exciting
and that's the turn-based multiplayer
features that we just released a few
days ago well wait you tell us about
this stuff I love to awesome so first
question is what is turn-based
multiplayer turn-based multiplayer means
a single shared state passed between
multiple players only one player has
permission to edit the shared state at a
time once you've entered it as much as
you want you pass it on to somebody else
we support two to eight players
including automatch and you can actually
mix and match your automatch you can
have some invited players some automatch
players you can see all the
documentation and stuff at this URL that
our producer is added here oh look at
that magic of post-processing so who can
use this this is all part of Google Play
services so anything you want
going back to Gingerbread it should be
on your phone right now or a Play Store
update very near you
we're also publishing rest bindings for
web or desktop apps but be warned we
don't really have a notification system
the notifications only appear on Android
and now let's do a little demo all right
so this is a game that I wrote called
8-bit artists and it uses the
multiplayer turn-based multiplayer all
right well I'm going to start a game
here all right oh this is this is
basically a guess what I'm drawing game
but you you've added a fun twist to it
which is the grid is basically ten by
ten so all of our art is equally crappy
and as a crappy artist I appreciate
being put in the same level playing
field as everybody else so I'm going to
start a match with this account and it
looks like I have some opponents that I
can choose from these are basically
populated from my G+ circles and this is
using the built-in
an invitation UI that we provide awesome
shy invite Vic Gundotra on you know I'll
just invite you that's cool
alright okay and then on my score there
you now you have to draw so it's going
to give you a word to draw here reading
mmm-hmm
I don't that's actually a tough one I'm
gonna try and draw a book and that looks
sort of like a heart you know what
because this is a dental or not going to
spend a lot of time making this look
good I'm just going to assume it's all
hard this leading very clearly an
awesome picture of a book with words on
it I think I'm just gonna press done for
your right there there we go okay
alright so this gets sent and on my
screen you see that I got it I got a
little pop-up that tells me that the
game was updated so now I can check my
available games and sure enough there's
a an invitation from Todd Kerpelman so
I'll accept his invitation and then it's
my turn to guess his amazing amazing
drawing let me see here basically the
state that gets moans it's lungs it's
definitely long it kind of looks like
lungs
okay I have a couple of choices here I
have reading the victim spring drink
super whale hard yeah alright you know
you do happen to know that it was
reading so I'm just gonna click reading
here
oh that's correct so I can keep going so
now maybe it was a coffee fact so now
when I sent you that first game you saw
that little notification right there on
your screen because I guess you were in
the middle of an 8-bit artists game what
would happen if you were like you know
reading your Gmail or something and I
sent you a gaming but if the game is not
running then what's going to happen is
you'll get a regular Android
notification with the game logo at the
top okay and it's going to say hey you
read the game if you click on that
notification it takes you to that inbox
you can choose to either play the game
or skip it or whatever you want to do
okay so this is pretty pretty standard
kind of notifications or what if I don't
have the game installed if you don't
have the game installed you'll still get
the notification ooh but when you try to
play it it'll take you to the Play Store
okay I guess that makes sense you kind
of need the game installed exactly so I
could really I could I could invite
anybody whether they have the game or
not
and hopefully they will they will see
the the notification and I guess if I
were a game developer this might be a
good way to get word out about my game
because you gotta start inviting their
friends to play and blah blah blah if
you have a good game
I guess our recommendation here would be
unlike a real-time game you know go
ahead and encourage people to invite
their friends because you're not
dependent on that other person to be on
their phone at that moment with the game
open ready to play these these types of
turn-based games are generally sort of
assumed that it might take you know 24
hours or so for the other person to
notice that in their turn and to take
their turn exactly and in this case it
is much more fun playing with people you
know all right well let's keep going so
how do you set all this cool turn
baseness up first you got to do all the
regular Google Play services stuff it's
covered in a lot of our other videos so
create an application link an Android
application to it put that idea in your
application we have lots and lots of
sample code and instructions for this
and you should check it out is 8-bit
artist available as a sample game it
will be soon ok so what do people have
right now to look at right now they have
turn-based multiplayer skeleton which is
just like 8-bit artist but we've removed
all the game so you're just passing this
string back and forth to it ok so it's
like a string that I can modify Cindy
Beck exactly perfect um one really
important difference though is when you
go to your application in the console
you need to flip this switch um it's
right there and the game services tab on
the Play Developer console if you don't
you'll get weird errors so how do you
invite people to a game this is our
default invitation screen you can write
your own invitation screens we have
methods in the game planet for that but
you're welcome to use ours and we
actually recommend it because it's going
to be familiar between applications
other applications that use turn-based
multiplayer and it will stay up to date
if we learn something and change it so
really only write your own game plan if
you're if you're willing to kind of
spend the time to continually up
the thing and you're maybe a large
company that's got a very strong brand
that you're concerned with keeping
exactly if you're a three-person startup
maybe just use our or you I it'll save
you lots of time in the long run putting
up this that screen we just show is
really easy it takes this much code um
just create an intent and start it then
you'll need a listener on the other side
to check to see what result you got and
whether or not they hit cancel that's
what the check if result is not equal to
okay so to gather your invitees off the
list
just grab the data extras and look for
extra players and then you can add that
to your turn-based match configuration
I'm not quite sure can you go back sure
so I'm sorry this get string array list
extra extra players what does this mean
is grabbing from the UI that I just
dismissed the players I want to invite
exactly gotcha okay and then you create
a tournament match config using a
builder add that list of invitees and
then call create turn-based match gotcha
it's a little bit more complicated if
you want to use Auto matching which we
absolutely recommend you try that is
still important yes
so all yours might not have friends so
as you saw when we were when we were
showing the demo there's always add Auto
pick player and anybody can choose that
and then in that case you'll get a
minimum and maximum number of automatch
players this is a lot like our real time
multiplayer code in terms of managing
automatch players so you can look at
that as a reference as well but
basically grab the min and Max numbers
and create a automatch criteria object
and pass that to the Builder for the
turn-based match so I know in real time
we are encouraging developers to you
know also kind of have a quick match
button that sets up Auto matching
without going to that UI is that what
this code does uh this code actually
will grab the information from the
invitation screen that's when you pop in
the invitation can you have an auto
match button thing if you want to skip
that you just want to have an auto match
button all you have to do is follow the
second step there where it says it
if min automatch players is greater than
zero just say automatch criteria create
automatic criteria number of automatic
slots you want there might be one in the
case of 8-bit artists gotcha okay
after that pass set auto much criteria
for your turn-based match config and
then call create turn-based match now
Ottoman doing Auto match I think is
really neat we're doing what's called
rolling automatch where you can start a
game take your first turn and pass it on
somebody else so let's make that
concrete here so uh let's say I'm player
one I've decided I want to play against
an automatch player what happens is I
take my first turn so if I were playing
it that artists I draw my first picture
and I hit Send by this point the system
doesn't know who I'm playing yet it has
no idea it just knows you're going to
play against an automatch player and at
that point it sort of goes up into the
cloud and waits around to be automatch
now say Todd is playing Todd wants to
play and he hits I want to play against
an automatch person at that point the
system actually knows well okay there's
this open auto match slot so let's just
put those guys together and make have
them play each other so when Todd gets
his game I will have already taken my
turn and you'll be able to guess and
then draw your own so rolling automatch
gets people going in the game right away
even in situations in situations where
that your game sort of rules support
that so what the advantage here is
basically we don't have to kind of take
that additional step of like I'm looking
for someone to play Oh wolf is decides
not going to play with me okay now I
take my turn it basically kind of gets
me right into the game a lot faster yeah
I mean if you if your game supports
people taking their turns before they
know who they're playing against you
should totally use rolling Auto matching
it's very neat that sounds good um no
matter how your turn starts you're going
to get a or your game starts you're
going to get a turn-based match
initiated call back from the game's
client you can register a listener as
with all these callbacks you should
check that your status codes are right
sometimes things go wrong like Network
errors
every callback comes with status codes
and you should use them we have sample
code showing how to interpret them yeah
you may already have a game going so
when the game gets started you should
actually
look to see if your match data is not
null if your match dated is null it
means a you just got a fresh game and
you should take the first turn and you
should call whatever your turn your game
initialization steps are but you might
have one of these rolling automatch
games at which point you're like oh
we're already playing never mind just go
straight to the turn dating interface so
that's what this this code is
demonstrating so speaking of taking
turns let's talk about actually taking
playing games yeah for us playing games
is taking turns when you're playing a
game you'll be passing around this match
data so what's inside the mat shader
first you just get game data which is a
byte array it's a 128k it's whatever you
want it's opaque to us we don't even
know whatever you store here gets
propagated to everybody on all their
signed-in devices so if I'm multiple
signed in getting it that's going to get
sent out to everything you also get a
list of participants each comes with the
unique part Ismet ID for games that have
not finished Auto matching you'll only
get the participants and then you'll get
a number of unused automatch slots
lastly you're going to get some status
bits on the on the game itself
there's turn and match status bits
status bits like is it my turn and is
this game over are we Auto matching
what's going on so and even when you're
not taking even when it's not your turn
you'll still get these updates every
time somebody takes their turn so people
can monitor their game as it's going by
so we're playing a four player game I'm
player one mmm I passed my state data my
game CD and player two player 2 takes a
turn I will still get a notification of
hagun or notification so your data will
get updated ah and when you open in
check you'll say oh yeah look player 2
took his turn ok so I can see player
two's turn I will see somewhere in the
in the turn status that it's still not
my turn the match data so that the games
still going on exactly ok
speaking of participants you should this
should feel pretty familiar if you've
used real-time multiplayer participant
comes with a participant ID and a
display name and if they weren't Auto
matched then they come with a person
data structure which has a way you can
get their profile picture and things
like that so actually playing a game is
create some kind of shared state and
then call take turn with somebody else's
participant ID so if I'm you know if I
finish drawing I'm going to say take
turn and put your participant ID not
your person ID participant ID if you
want to pass it off to Auto matching you
just pass null in and it'll go off to
the cloud and assuming that you have
Auto match slots left and lastly this
gets to turn order turner is entirely
client dependent each time you take a
turn the client decides who's going to
go next round robin does analogical
choice and but it's up to your game to
the side and as we were talking about
earlier sometimes you're going to call
yourself as the next player and that's
okay and what that'll do is sort of
checkpoint the data and have that
uploaded to the cloud here's the code as
we're talking about for taking turns so
on my when you click the done button
find out who the next bridge is emit is
increase I just have a turn counter
thing so I increase the turn counter so
it's better because it's going to take a
take some asynchronous process to do
this and then you call take turn with
your match ID the data that you want to
persist and whose turn it is next it's
very easy after that null out your turn
data because it's going to be invalid at
this point um one last note on a turn
order
remember turn order is in any order of
your client you can go around robbing
that's really common but in a game like
bridge where the winner is who's bidding
start we give you that flexibility okay
what happens when the game is finished
when the game over when a game is over
like you know I've made my last move in
a like a risk like game then I'm going
to call finish turn-based match once
this happened you can't continue
modifying the state each player gets an
alert immediately that says they can
they can all look and see what the final
state was and then they call finish
themselves and finally after everybody
calls finish themselves the game moves
to a complete state where everyone is
called finished next you can leave
leaving is akin to just getting up and
walking out but that's saying I no
longer want to participate the game can
continue going on so if we're all
playing poker and I say I gotta go pick
up my kid get up walk away that's
leaving you can leave on your turn and
there's actually a separate call for
leaving not on your turn once you give
up your your seat the game keeps going
but no one can take your place so you
can't just have like a continuously
rolling game where like you know
thousands of people have all joined the
number of people who join at one Auto
matches all the automatch lots are full
that's the last person you can join the
game but any number of people can leave
so this might be useful if there was a
like an elimination type game and I get
eliminated from the map and I'm like
well I guess I don't want to participate
in this game anymore because I'm out or
they may just automatic the client may
automatically call leave yeah because
you're not going to make any more moves
and we no longer want to pass you in
East we don't want to pass you the turn
check if you cancel a game it just
spontaneously ceases to be we don't
recommend calling cancel unless you're
doing debugging or administration kills
this is like a marriage annulment it's
just the game never was it ceased to
happen
lastly is expiration people do drop out
of games it's very sad we have a
built-in expiration that happens after
two weeks if no somebody just doesn't
take their tune for two weeks it just
ends
if automatch does not find a taker
within 24 hours it also expires and if a
game expires can never come back it's
over okay
so take your turn at least once every
two weeks yes exactly you got a figure
if you're waiting that long it's
probably not a very so I have a Q&amp;amp;A
section where I've I've given you some
cues so you won't stump me oh here you
go all right
say well what happens if most of my
gameplay is server-side actually this is
a very common case like I've seen a lot
of a lot of game developers that already
kind of run most of their logic on the
server you know because they want to
make sure it's it's fair and they don't
always trust the clients and that sort
of thing so can i still take advantage
of this stuff absolutely at this point
the player matching is going to be
really valuable to you and also the
notification system it's going to be
pretty valuable to you because it's
going to be integrated into the rest of
their sort of play games experience you
we will and we can also do rolling
automatch for you so at that point the
turn that you're passing back and forth
to each other is probably just the ID of
the turn on your server gotcha okay and
then the game has to sync to the - you
have to do all of your own singing
basically at the game state and I'll
probably have to be connected to the to
the internet when your game is being
played makes sense but yeah absolutely
usually even if you all of your stuff is
happening server-side you should look
into this because a server-side a little
more of an investment if maybe I'm a
small company trying out my game for the
first time maybe I want to do it
client-side at first then it becomes
very successful lots of people are
playing I then might sort of shift to a
more server-side model if that's
appropriate sure okay or really you're
just a established game that already
kind of has some server-side stuff we
have lots of sample code you're welcome
to ask questions to us on Google+ or
Stack Overflow and
uh drop us a line yeah we'd love to hear
from you thanks everybody
bye-bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>