<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Things Every Android Game Developer Should Know 2.0 | Coder Coacher - Coaching Coders</title><meta content="Things Every Android Game Developer Should Know 2.0 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Things Every Android Game Developer Should Know 2.0</b></h2><h5 class="post__date">2013-03-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rnsgAvFUEUo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm Wolff Dobson I'm Dan Galpin and
I'm Bruno Rivera
so money true there are many people who
make games just for fun but of course
too many developers making money from
games is a crucial part of their
business but they still have to have
some fun right oh of course so one of
the questions we often get from
developers is how do I make money on
android games I mean if you're a
developer you probably wish there was an
easy command to do that but the truth is
it's not that simple same of the same
thing with many other questions we get
like how do I get discovered how do I
get featured how do I get that 5-star
rating how do I get rid of those pesky
bad reviews how do I make users play my
game and how do I actually make them buy
stuff this it's a whole bunch of
questions sometimes these questions miss
a fundamental point and that point is at
the center of everything there's a user
we like users they are fascinating
baffling creatures so instead of
actually trying to answer those
questions up there we'll focus on what's
really important and it's that guy
successful games are the ones that have
many users and whether those users are
happy if you do that the odds that
you'll make tons of money or even be
featured on Google Play goes up a lot
which is why we're going to focus on
driving game installs and making a great
user experience along with the mechanics
of actually collecting money from your
players so let's talk about sign-in with
Google one thing you can do to grow your
game is to use social features we did a
user survey recently and found that
users overwhelmingly trusted Google to
sign-in across the web this is because
users trust Google not to spam their
stream you can share only what you want
to share to the right people last year
we added api's to enable who enable
users to log in with their Google+
identity and this year we added access
to the social graph so quick update from
Google Plus 500 million users based
Google Plus one of the fastest growing
networks and social history
fastest growing network social networks
in history we've grown from just 150
million users between last June and last
December more than half of our users are
mobile we have a hundred and thirty five
million active
monthly users in the stream and they
spend about 12 minutes there daily
that's a lot of people it's a lot of
people who can be playing your game if
you think about it Google+ is truly at
the heart of our efforts to create a
simpler and more intuitive experience
for all our users it's our social spine
that binds all of Google's products
together we have 120 Google+
integrations to date that makes the user
experience better on Google when you see
your friends recommendations in Google
Play you don't think about that as
Google+ but it comes from that
infrastructure we're seeing a positive
impact across all our products but what
does sign-in do for developers well
first and foremost it will help drive
Android installs there's a huge cliff
getting users to install your app before
they can play it and we can help with
that I'll show how in a minute secondly
is giving user growth through targeted
social sharing Google+ allows you to
share the right information with the
right people
so that means gamers sharing information
with gamers you also have access to
Google+ profiles and social graph which
would give you a lot of information
about your users and finally users
obviously trust Google as a login
provider so what does this look like in
a game here's my game nostalgic racer
with Google+ sign-in and it's got a
Google+ login button you can fit it in
your interface any way you want if you
click on that I get a Google provided
permissions dialog there are two halves
to it
the first indicates that I'm sharing my
social graph with this app from this
dialog you can even edit which subset of
the graph you wanted to see I might not
want to share friends and family with
this app but I want to share all my
gamer friends second half controls who
might see that I'm playing this game so
if you want your high school friends to
see that you're playing but not your mom
you can make that happen so after I
click OK I'm back to the game and you
can see that I am completely logged in
well technically Bruno is completely
logged in if your users have signed in
to Google Plus on their phone and this
is very very likely using G+ signing
gets them signed in with one dialogue
very efficiently as with as little as
two clicks if they like the default
settings so you the game developer now
I've access to their profile information
and you have a better idea of who's
playing your game you can see there's
social graph so you can see if they have
friends who also play this game or
friends who might want to play this game
now let's say I play this game a whole
lot and get an awesome time on one of
the tracks in this algebra sure I want
to post about it and I want to make an
interactive post about this track in
particular
so let's see an interactive post here's
one that I'm doing to Todd and Bruno
I've mentioned them I've mentioned them
by name and I'm giving them a button to
click to challenge me on a that Speedway
the two big things here first with the
social graph date available you can see
which of my friends are playing the
Seljuk racer and prefilled the dialogue
with their names and secondly by
mentioning todd bruno by name they're
really going to see this since I've
mentioned them explicitly depending on
their settings they're gonna see a
notification on their G+ stream their
email the web even a notification on
their phone it's a really high
visibility share so here's the post in
the stream you've got a challenge button
and people will come to play on the web
if you clicked on the challenge button
you might take you to a web site your
developer website that'll show them how
to install the game on your phone if you
click on this link you will go straight
to the app itself there dozens of
actions you can choose challenges is one
of them that button can go to the exact
level in your game or provide some kind
of help in a social game anything you
want and this is huge if you click on
one of these links but you haven't
installed the Android app it will take
you directly to the Play Store that's
awesome that's a great way to drive
installs there's tons more on go with
Google+
we have over-the-air installs off your
website we have analytics we have +1
button sharing and we even have the
hangouts API for the web so check it out
on developers.google.com slash plus so
Simon with Google Plus can help bring
audience and installs to your game but
your game has to be awesome for those
players to have fun Dan's going to talk
about that my name is Dan and I'm an
Android gamer really one of the great
things that happened between last year
at GDC and this year's that we published
quality guidelines to get to these
quality guidelines go to
developer.android.com click distribute
and click app quality so here they are
core app quality guidelines there's a
lot of stuff here that games often get
wrong we've been telling game developers
for years to make sure their game
navigates the Android way with the back
button being used to close their game
and we're gratified that users seem to
agree bad back button support leads to
bad movie
use remember that this also applies to
the volume buttons let the system handle
them and show the default volume
controls one thing that our featuring QA
team cares lots about is making sure
that your game doesn't have a vestige of
Menu key to remove it target the latest
SDK that you can test on which of course
should be 17 targeting the most recent
SDK version also turns off compatibility
hacks it can impact game performance so
it's a good thing don't spam your users
with notifications also offer your users
precise control over which notifications
they are shown and when you'll not only
get better ratings but you'll also
encourage users with newer devices to
not use the Android method of blocking
all notifications don't use permissions
you don't need it's really unlikely that
you'll need to get access to sensitive
user data from last year here stuff not
to require really feel free to pause and
look more closely at this list but don't
consider this an exhaustive list and
sending receiving SMS is particularly
bad but using any of these permissions
will make it difficult to get a game
featured we've also talked quite a bit
about audio because no one likes random
audio coming from their pants especially
your boss do time consuming tasks in the
background develop with strict mode
enabled make sure that you don't get red
flashes our testers will do it also make
sure that you support graphics for lots
of form factors it turns out that our
quality team mostly has access to our
Nexus devices and if your game can work
well with reasonable text size and touch
targets on all of our Nexus devices
there's a good chance the game will work
well on other devices we also test on
some other extremely popular and
problematic devices if your text isn't
legible or if the game requires smaller
fingers we have a problem and of course
if you want to get featured
you better have a great feature graphic
remember that many users will see your
graphic on a phone phones are small and
the same 1024
finds 500 bitmap that you see on the web
Google Play Store is scaled down by
Google Play to fit the smaller form
factor of a phone you'll need to have
large text with excellent
if it will be readable this title is
legible but on the device the subtitle
is pretty much gone and since I can't
necessarily recognize that stylized ball
as a soccer ball on the device I might
miss the reference to the game I love
but the best part about our core app
quality guidelines is they come with
tests you can hand your QA team so
remember to find out more about this go
to developer.android.com and under the
distributed tab select app quality we've
also talked about game controllers in
the past we've added support for
standard hid game controllers in
honeycomb and it's been gratifying to
see so many games having some form of
limited support for them so one of my
favorite games is nostalgic racer and I
was really excited to see that they have
support for nostalgic controller I spent
lots for my nostalgic controller so I'm
the kind of gamer that sees the cost of
your game as being incremental and then
I find the menus don't navigate there
isn't a good set of default controls and
I can't use nostalgia controller with
the game when my Nexus 10 is connected
to my TV so make gamers like me happy
ship games that really support
controllers in menus and in the game if
you're going to have elaborate
configuration screens great but also
have great defaults almost every
controller will work well in menus with
these settings and if your game only
needs digital controls or buttons this
will be a great set of defaults one
thing to note is that I suggest
supporting both d-pad Center and a and
the reason for this is that well you
know most hid controllers will have
these buttons and we do a great job of
mapping these two reasonable defaults
for d-pad d-pad Center but for some
reason we decided to map both a and B to
the back button and this doesn't really
make sense to most users as they are
typically used to having the a button
perform an affirmative action so make
sure to actually map the button that way
within your UI here's some other buttons
you might want to consider but you
shouldn't rely on these buttons being
there some more buttons to standard
controllers will have one other note you
get generic motion events for analog
joysticks you also get them for D pads
that are set up as hat switches which is
very common a single motion event
however can
both a hat switch and analog motion and
if you handle the analog event you must
handle the hats which event as well if
you wish to use the d-pad in your game
because otherwise the system will think
you've handled the analog event and you
won't get the generated d-pad event so
here are some common axes of controllers
will have so in appealing in everything
is actually pretty cool every time you
talk about in-app billing to someone we
sort of expect them to go something like
this but then to our surprise in
previous versions of the API some people
went more like that we didn't really
understand why that happened because in
Epling is actually pretty simple I mean
you just do that and the items purchased
right it's no problem
wait don't you have to do more than that
more than that okay I'm actually
oversimplifying just a little bit oh you
actually have to have the code that
handles the approaches state changes but
then that's still not that complicated
but what if the app is sleeping okay if
the app is sleeping when that happens
then you should probably just add a
broadcast receiver just to make sure you
don't miss that mastered but but that's
super a symptom but broadcast receivers
can't run for a long time so what do you
have to do lots of database worker
networking mmm that's sure real
applications have to do that right so
it's you should probably just add a very
simple and straightforward service
something kind of like that and that's
gonna take care of hemming that for you
as you can see the code is very
straightforward and simple to understand
but what if you're using managed items
don't you need to make sure that you
persist those because you can't call
Google Play very often to check for them
that's true so you should I mean
everybody loves databases right so I
think I think you can just add some
database code to your app just to make
sure that you store the purchases and
then you don't have to make the calls
all the time
oh and and they should also obfuscate
that some way because otherwise user
users can can just hack into that and
alter so it's but it's still pretty
simple right mm-hmm
you don't believe me so why does it get
so complicated let's start with with the
simplest possible case so the user just
wants to buy something and they buy
something and it gets delivered to the
app so so far no problem right thanks
bro
exactly so not a problem so far but
suppose that instead the app is sleeping
what happens in that case in that
case if the app is not running sleeping
or something else a different guy has to
pick up the package that guy is a
broadcast receiver and then that guy has
to take care of delivering the package
to the app when it makes when it wakes
up thanks bro exactly and that's when
problems can happen because suppose that
that guy is not as reliable as you think
and he drops the package or loses the
package so in v2 there actually many
components I have to work together to
ensure that the users purchase is
handled correctly and it can get a
little complicated in comparison here is
what the version 3 diagram looks like no
actually let's let's use more of the
slide for that that's not gonna fit
let's use a full slide yeah that's
better so the diagram for a v3 is very
simple but it has seven sub components
and we're gonna spend the next several
minutes discussing each of the
components separate components and also
the sub sub components and they're
pastels
exactly actually just kidding this is
the diagram for an ability 3 it's much
simpler right so the main improvement a
v3 is that API calls are now synchronous
so this means that your application can
get a response right away and it's much
more straightforward to think about -
for instance if you want to buy
something like 50 gold coins all they
have to do is make a request that looks
something like buy 50 gold coins and
guess what if the purchase is okay the
API is going to return something that's
pretty simple like say ok and if you
have if you're used to v2 you probably
remember that listing the items that are
owned by a particular user is a very
expensive operation so you couldn't call
it all the time so you had to do that
very sparingly so you your whole code
had to be had to be structured around
that limitation in contrast in v3 Google
Play actually implements a client-side
cache and takes care of keeping that in
sync with the server for you this means
that calling restore purchases is
actually very cheap and you can do that
as often as you need for example you
could just do that every time the
application starts so you know what they
offer items the other user owns so I am
I probably sound like I'm trying to sell
you something so if you're a developer
then over the years you've probably
grown a healthy mistrust of people that
don't show you any code so let's start
with the sales and move on to something
that's entirely different all right so
let's talk about selling stuff before it
can make any v3 API calls we have to
check that it's actually supported you
can do that by using the
is being supported API call the good
Neos is set the in-app billing version 3
API is supported on all devices running
Froyo and above and a recent version of
the Play Store and that corresponds to
over 90% of the currently active devices
now how do you get a list of the items
of the user owns you just call
getpurchases remember that this call is
actually pre cheap and also notice that
you get the results right away without
having to implement any funny callbacks
now this is the moment your application
has been waiting for
it's that profound unique magical moment
of modern technology where the user
realizes that your virtual item is so
cool and so awesome that they actually
we need to give you real money for it
most important of all at that moment you
have the users trust so imagine what
happens if you take the users money and
then lose the purchase that's a pretty
bad experience right so again they've
paid for something and they didn't get
it the least you can expect after that
is a bad review and you're probably
gonna have to refund that money and the
user is probably not going to be a user
anymore so that's something to be
avoided so this is why version 3
actually makes it easier not to lose
purchases by making all items managed
which means Google Play keeps track of
those purchases for you so how do you
launch this the sport is flow you can
call get by intent to get any intent
that's going to launch the the purchase
window and then you launch that intent
using start intent Center for result the
results of the purchase are going to
come back through your activities on
activity result call back at that point
you get the purchase response code the
purchase data and the signature and
that's pretty much other is for a simple
app so on startup you call get purchase
to see what the user owns when the user
wants to purchase something you call get
buy intent and then launch that intent
and on your activities on a on activity
result callback you handle that purchase
and notice that it's actually pretty
hard to lose a purchase this way you
actually have to make an effort to lose
a purchase because even if your
application crashed right after you are
you started the purchase flow and you
never got the purchase result it's
alright because next time your
application executes
you're gonna call getpurchases and
you're going to realize that the user
has bought that item so that purchase is
not lost now let's talk about
consumption so consumable items are a
new feature
in v3 so to understand how it works
let's let's do like like that somewhere
inside Google Play there is a box with
my name on it I know I've seen it and
inside are all my virtual items so what
happens when Bruno buys cool item when I
buy cool item an item called cool item
appears inside that box if you then ask
Google Play what items are gonna own
it's gonna return
Bruno own school item if I consume that
item what happens the atom goes away in
flames just like that I've seen I've
seen it happen in that case I don't own
that item anymore and if I ask Google
Play what item says we're gonna own
it's gonna return the empty set so
consuming an item just means that it's
no longer there so how do you do that in
code you just call the consume purchases
method and you just pass it the purchase
token that you got from the kept
purchases call
one question that naturally arises is
when should I consume something that's
actually up to you to decide how to use
the consumption API but we're going to
talk about two of the most used methods
you can either consume the item when
it's actually used or you can consume it
immediately when when it's purchased
both of them have advantages and
disadvantages to explain method one I'm
gonna give a quick example so um that's
me anyway that's the stick figure me and
those are the items that I own in google
play like everybody else I walk around
with a hit put bar on top of my head and
as you know it's a pretty dangerous
world out there for a stick figure
characters so I'm probably thinking
before I venture out there are battling
bugs I am better off buying a potion so
I buy this potion and then I own this
potion correct and then I go I go out
and venture into the into the wild world
of pro of programming and in the course
of my adventures I battle several bugs
and I end up losing a whole bunch of hit
points then I decide to use that potion
at that point your application is going
to consume the potion and then give me a
full hit my bar so that's how it works
um that's a perfectly good method but it
has a significant limitation so it has
to do with how Google Play actually
thinks about things so Google Play only
really knows to numbers 0 &amp;amp; 1 if your
game actually requires that I should be
able to buy more than one potion then
this method doesn't work
you because if it's if it's a really
dangerous world out there and I'm gonna
need more than one healing potion with
me then I can do that using this method
because as soon as you try to buy a
second potion what's gonna happen
instead cuckoo players gonna notice that
I already have a potion so it's gonna
see there's a potion right there why are
you asking for a second one that makes
no sense
Google Play can only count to one so you
need a better method if you can
implement that and that method is
consumption is immediate consumption in
this case your application is
responsible for managing the user's
inventory notice my excellent rendering
of a plastic bag there so when I buy
something you immediately consume it and
then you put it into my plastic bag or
inventory or wallets or anything else in
your application and from that point on
you are the one responsible for managing
that item so if I buy a second one
that's all right with Google Play
because it doesn't know that I have
another and another one so I consume
that one and add it to my inventory and
everything works if you're using this
method too it's very important to also
check on star up if there are any
outstanding items that you need to
consume for example suppose that your
application crashed right before
consuming an item you purchase something
and then you crashed what happens is
that next time you start up you should
check the user's inventory and make sure
that there's nothing consumable there if
there is something consumable that
should have been consumed this is a time
when you consume it and credit it to the
users inventory to make sure that they
didn't lose that purchase so summarizing
on startup you call getpurchases if you
find a portion there you consume it when
the user wants to purchase something you
call get buy intent and then launch that
buy intent to get the other purchase
flow on your activity is on activity
result callback if the purchase was
successful it's right to consume it when
you get the result from the consumption
you add it to the inventory if it was
successful of course now let's move on
to two very important subject which is
security so believe it or not in the
interwebs there are some shady
characters out there shocking I know
that may be trying to take your stuff
without paying I don't really know what
the technical term is but I'll say
they're pirates mostly because we spent
a really long time drawing this
character and I had to use it somewhere
so every time you see a purchase in your
application you should ask yourself is
that purchase legitimate
and a pilot's job is going to be to try
to convince you that it is and your job
is to detect that they're lying no one
can actually stop piracy all together I
would be lying to you if I said as much
but you can actually make life pretty
hard for pirates so here are some
defenses you can employ developer
payload signature verification and
server-side validation let's talk about
developer payload developer payload is
actually something really simple it's
just a tag that gets attached to every
purchase and whenever you query for that
purchase it comes back with it so you
should use it to identify the owner of
the purchase and the reason why you want
to identify the owner of the purchase is
to prevent a replay attack so how how
does that kind of attack work ok so
again that's me a stick figure again
like everyone else
not only I have a hit point bar but I
also have an evil twin says that guy
over there that guy apart from having a
goatee isn't very honest and last week
he actually picked up my phone and did a
database dump on the items I had and
then tried to replay them on his device
hoping to get items from free so when
owner my evil twin runs your application
you'll check what items he owns and
you'll see this purchase now all they
have to do is check the developer
payload and you know that it's a fake
because it says belong to Bruno and its
owner that's trying to use it and it's
it's hard for owner to fake that
developer payload because every purchase
is signed with a private key that we
only we have so it's very difficult for
for him to alter that signature so
speaking about signatures so what is
signature verification well every
application has a private key and a
public key the private key is known only
to Google and the private the public key
is known to you every time we send a
partial response we sign that purchase
with the private key and then you can
verify that signature with the public
key so this means that nobody else
outside of Google can actually send you
a purchase a correctly signed purchase
so if you check that you can be
reasonably sure that the purchase is
legitimate now signature verification is
not actually very difficult but I mean
you can implement it just using the
other standard Java framework but it
comes with our sample so if you're just
basing your code on our sample we don't
even have to implement that even though
our signature verification is pretty
cool
thinking that client-side security alone
is enough would be a big mistake because
regardless of how secure you make things
phones can be hacked so it should
definitely add server-side security to
your application on the server side it
should check the signature again just in
case the client has been compromised a
cool thing you can do the server that
you can't do on the client is to check
order numbers because since you're
receiving every order from every user
you can check if if a given order number
is a duplicate from an other other
number that you actually delivered to
someone else and it's very important
that you secure the handshake because
it's not gonna do you any good if you
have a perfectly good signature
verification order number of
verification method and then the
handshake is very insecure so make sure
that the the handshake is that is also
very secure so just giving you a summary
of the security methods so that we
presented if you don't do if you don't
do anything you were essentially a
sitting duck and you can be and anything
can be used to exploit your application
if you do only client-side signature
verification you are protected against a
man-in-the-middle attacks so it's going
to be hard to replay purchases if in
addition to that use the unique
developer payload then you can you're
also going to be relatively protected
against purchase replay attacks if you
add server-side verification to that
you're also going to be safe against
against a rare form of attack which is
framework compromised the actual
combination of methods that's
appropriate for your application is
largely your decision we just wanted to
outline to use some of these security
methods that are the most popular and
one more thing one of the things that
you as game developers have been asking
for ever since the launch of in-app
billing and Google Play is the ability
to gate to get real-time pricing
information so that you can actually
display the actual price at Google Play
we'll be charging your users and it
turns out that's one of the main things
we've added in IBB 3 imagine if that was
even localized so you can actually do
quite a lot with that so that's pretty
much all we have on on in-app billing
and on game quality we hope you enjoyed</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>