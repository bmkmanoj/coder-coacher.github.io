<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Securing and Optimizing Your App with Google Play App Signing (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="Securing and Optimizing Your App with Google Play App Signing (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Android-Developers/">Android Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Securing and Optimizing Your App with Google Play App Signing (Google I/O '17)</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5tdGAP927dk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to this talk about Google Play
app signing this is a really exciting
moment for us we've been we've been
working on this product for nearly a
year so it's great to be able to talk to
you about it I'm James I'm the product
manager for up signing and this is hi
I'm Anthony I'm the engineering lead for
Google Play app signing so let's start
by outlining the problem that we're
trying to solve Android requires that
all apks be digitally signed with an app
signing key and a certificate before
they can be installed when you sign an
apk the signing tool attaches a
certificate to the apk the certificate
serves as a fingerprint
we should knee CLE associate your apk
with you and your corresponding private
app signing key this helps Android
ensure that any future updates to your
apk are authentic and come from the
original author you must use the same
app signing key and certificate
throughout the lifetime of your app in
order for users to bills install new
versions of your app maintaining the
security of your key is therefore of
critical importance both to you and your
users if a third party should be able to
take your key without your knowledge or
permission that person could sign in
distribute apps maliciously that replace
your authentic apps or corrupt them such
a person could also sign and distribute
apps under your identity your private
key is required for signing all future
versions of your app if you lose or
misplace your key you will not be able
to publish updates to an existing app
you cannot generate a previously
generated key your only options then
would be to publish a new app under a
new package name and ask all of your
users to move across this would
obviously be a terrible experience
developers who take such care in
grafting great apps and wonderful
experiences for users shouldn't need
the experts and security you shouldn't
ever be in this situation that the
president of our be AB Studios had to
face when they were getting started so
that's why we've been working on a
solution you may have heard that we
launched this product app signing is an
optional program for developers that
provides a secure means of handling your
apk signing key previously the burden
for signing and protecting keys with
entirely on each individual app
developer and we've seen instances of
key being lost or compromised and in
those situations there is nothing that
we could do to help with Google Play out
signing developers keys are stored on
infrastructure the Google's
infrastructure and developers benefit
from Google's ongoing investment in
technical security so let me run through
how this works today a developer signs
their apk with an app signing key this
signature gets attached to the apk and
the app is uploaded to Google Play play
sends an exact copy of the apk signature
and all to the user and the user gets
the app signed by the original key all
subsequent updates follow the same path
with Google Play app signing things look
a little different now the developer
signs their apk with an upload key the
upload key signature is attached to the
apk and the developer uploads that apk
to play the upload key is used by Google
to authenticate the developer and that
is only purpose the upload key can
therefore be reset play resize the apk
with the original app signing key and
the user gets an apk signed with the
original key just like in the scenario
that is today so how does this solve
your problem
well we lent several partners using
Google Play app signing for awhile now
and the feedback has been really
positive here Robyn who there speaks to
the layer of safety that we've added
while at the same time all but
eliminating the worry of having lost or
stolen keys and it's really easy to get
started you just uploaded your key
create a new one and then you're done in
fact it's so easy I'm going to walk you
through the entire process right now so
log into the new loop play console you
seen the material designer right find
the app signing page it's under release
management in our new material design
menu you need to read and agree to the
terms the change to go into app signing
is for the lifetime of your app so
please be sure that you want to continue
before you begin we don't intend to a
low withdrawal from the program if you
wanted to change the app signing key or
go back to signing yourself you would
need to create a new package name and
release a new app and migrate all your
users across similar to losing your key
today so please be sure that you want to
continue before you begin next you've
got to find your current keystore file
here are some of the common places that
developers have told us that they keep
their key your local development machine
your CI server your code repository or
maybe even a secure server then you're
going to download our tool to encrypt
your app signing key this tool uses
Google's public key to encrypt your key
prior to network transfer if you want to
inspect the source code for this key
this tool you can now select your
encrypted app signing key and upload it
to play through the form now you're
going to generate the new upload key
this will be used to authenticate your
APK uploads with Google we remove this
signature Andry sign with the original
key before distributing the app you
generate a new key really simply using
the key tool
finally you're registered you're ready
to register the upload key with Google
and then enroll your app once you click
enroll your app is enrolled permanently
and play concert will only accept
uploads signed with the upload key so
please be sure that you're ready to
transfer over and that's it you're done
hopefully the transition is seamless and
smooth just like it was for roblox
for new apps it's even simpler we'll
create and use a new add signing key to
sign your your app before it's deployed
to users the key that you use to sign
your apk before uploading to play
console becomes your upload key and
that's it now Anthony is going to talk
about the security aspects of this
product thanks James
so when we were designing this product
security was our number one priority
Google has a long history of strong and
ongoing investment in security
we have over 750 engineers at Google
working on our security systems and so
we have built upon that investment in
building this product so let me go into
some more detail on some of the security
features of Google Play app signing so I
want to first talk about the security
considerations involved with importing
your private keys in designing this
process we wanted to make sure it was as
secure as possible
so James has explained that in order to
encrypt your app signing private key for
transfer we provide you with a simple
command-line tool called the PEP a PEP
cattle I like to call it pet Stanford
play encrypt private key so this tool
export your app signing private key from
a Java key store and then encrypts it
immediately ensuring that your private
key is never left in plaintext during
this operation and if your keys are not
stored in a Java key store then we also
provide the source code of a tool so you
can write your own code to export and
encrypt your keys from wherever they
have sought the encryption we use is
public key hybrid encryption based on
ships ISO standard specifically we use
peat
2:56 elliptic curve asymmetric
encryption with aes symmetric encryption
and because we use some asymmetric
encryption once encrypted your app
signing private key can only be accessed
by our internal security management
system so intermediate servers along the
way can't access the key now let's talk
about our secure key management system
and specific dedicated servers for
managing private keys and in managing
these keys we follow industry best
practices so in more detail the keys are
never exposed outside of this system and
these keys can only be used to sign a
apks that you have uploaded and in
particular when we go to sign an apk the
signing operation is performed within
this system so the keys don't leave the
system in order to sign your apk
furthermore all signing operations
performed a logged and internally
auditable access to this system is
tightly restricted now to protect the
keys within this system we store the
keys such that they are strongly
encrypted at rest the keys are never
stored in plain text and to prevent key
loss we make very frequent backups of
our primary storage these backups are
themselves strongly encrypted and we
regularly test restoring from these
backups you can find out more
information about google's security
practices in our public google security
white papers published online finally I
want to talk to you about this new key
we have introduced into the process
called the upload key as James has
explained the upload key is used by
Google Play to verify that the uploaded
a week a comes from the correct
developer we verify the validity of the
upload key signature prior to signing
with the app signing fee now unlike the
app signing key the upload key is only
verified by Google Play and not the
android framework and that means it's
possible to reset it in case the
developer loses that or it is
compromised so if in the unfortunate
situation the upload key does become
lost or compromised you can contact
Google Play Developer operations and
request that your upload can be reset to
a new upload key that you generate this
process will take
couple of days as we will need to
securely verify your identity and then
you can resume uploading apks by signing
them with your new upload key now over
the James to talk about what enrolling
in Google Play app signing enables us to
do for your app thanks nothing so once
Google Play signed your app you can
probably guess what's coming we can also
start to provide optimization services
at your request so how is this possible
you provide us an APK signed with the
upload key we verify your identity and
then remove that signature there is no
window of opportunity before that apk is
signed with your app signing key where
we can apply optimizations to your app
we want to use this opportunity to
provide services the developers think
about it is applying the power of Google
and txt best practices to your app so
the first optimization we decided to
focus on is making apps smaller we think
we can have a great impact here we know
that developers care about apk size
because users to download cancellations
are correlated with app size if a user
attempts to download an app this and it
takes too long or it looks like it's
going to be too big it's more
susceptible to getting cancelled and we
know that larger apps are more likely to
be uninstalled by your user looking to
free up space on that device if you're
interested in what you can do to make
your app smaller make sure you check out
the video from the slimming down your
apk talk which happened this morning so
when looking at how we could reduce app
size we started by looking at what takes
up the most space inside an apk so we
analyzed all the apps in the Play Store
and looked at the proportion of space
taken up by each file type inside the
average apk and the chart on this slide
shows you the results of this analysis
what you can see is that the top
contributors to apk size are dot n so
files or native libraries and PNG files
images and together these take up
roughly 40% of an apk size on average
now if we look inside some a/b case we
can see why these file types take up so
much space here we have an example a BK
where we visualize the contents of the
apt by size the size of the boxes
indicating the relative size of each
component and I'm sure many of your apps
would look similar to this what we see
is it because of the diversity of
devices in the Android ecosystem
developers include native libraries for
different architectures so arm x86 MIT
sometimes the 64-bit variants as well
and durables for different screen
densities low density medium density
high density extra high extra extra high
extra extra extra high we got really
creative at the end there and this is a
good thing because it means that apps
run at their best on each device they
have images at the right density and
native libraries compiled for the
correct architecture for that device but
the consequence of this is that for a
specific device a lot of the content of
an apk is unnecessary so if I have a
phone with a 32-bit ARM architecture and
an HTP ice-cream then I only need the
contents of the boxes in blue and the
boxes in green are completely
unnecessary and unused for that specific
phone but if I had a tablet with an x86
architecture and an xxhdpi screen then I
would need a completely different subset
of the boxes now you could in the past
manually create device specific apks by
generating multiple apks each with only
one density and one native architecture
but it's a lot of effort and in fact we
recommend as you didn't do it because
it's so complicated until we found that
less than 1% of apps on the Play Store
actually do this but now as James has
explained with Google Play app signing
we can automatically generate these apks
for you and deliver to each device only
what that device needs so how does this
work in more detail so you you a
developer uploads a universal apk that
contains drawables for multiple
densities and native libraries for
multiple architectures
then from that Universal apk we generate
multiple apks that are optimized for
specific devices so for native libraries
what we'll do is we'll remove all the
live directories except for the one
corresponding to the devices preferred
architecture so if you have an x86
device we will remove the arm and the
MIPS directories from the apk that we
will deliver to that device for
drawables we will remove all the
drawable resources that would not be
loaded for that device in screen density
so if you have included an mdpi hdpi and
xhdpi version of an image in your apk
then for an mdpi device we will only
keep the mdpi resource in the apk that
we deliver to that device and then after
removing these drawables we modify the
resource table accordingly to lo longer
reference these removed files now
because we only removed the native
libraries and resources that would not
have been loaded on that device in the
first place and keep the ones that would
have been loaded by that device you
should see no difference in the behavior
of your app except of course that it
will be smaller
now we call these apks that we generate
derived apks as they are derived from
the or uploaded apk each of these
derived apts will have the same version
code as the version code in the uploaded
apk and we add an extra field in the
manifest that we call the derived apk ID
in order to distinguish them so then
what does this mean for you if you were
enrolled in Google Play app signing and
have enabled these optimizations so
firstly and most importantly means that
the APK is we deliver to your users a
smaller saving users bandwidth and just
based on disk it also means that if you
are previously reluctant to add support
for new architectures or screen
densities because you worried about
floating your apk then now you don't
need to worry we've had developed it in
the past tell us they don't want to add
support for 64-bit architectures because
it will result in a significant increase
in their apk size but now since we will
only include the necessary architectures
for each device in the apk we sent down
you can add support for new
architectures without affecting apk size
for users finally if you are previously
building multiple apks for different
densities or different native
architectures you won't need to anymore
so instead of uploading for different
apks for different native architectures
or six different apks for different
screen densities or maybe you were
really diligent and had 24 different
apks each for a specific native
architecture and screen density now you
don't need to do that now you can just
upload a single Universal apk and Google
pay will do the work for you
I'll hand back to James now to talk
about some of the results we've seen
with some of our early partners so
hopefully this is pretty cool right
hopefully for you if you're using multi
apk this is going to change how you
build how you do things hopefully make
things a lot better so we're just
getting started exploring this area and
it's really early but we tried it out
with some apps that are in our early
access program and we expect the average
savings to be about 15% however some
apps see even better results delivery
was 33% smaller after optimizations and
the seven minute workout app was nearly
a half smaller at 48 percent when we
talk to developers about these changes
they got really excited one developer
said we just put things in the right
place and Google does the heavy lifting
and that's exactly what we're going for
you can do this yourself but it's
complicated and we want to offer
services that apply best practices
automatically for developers so how do
you try this out now the first to get
started testing the first thing you
should know is that you can enable our
optimizations for specific apks when you
upload them to play that means that for
example you could enable optimizations
for a specific app apk excuse me and
then try it out in your alpha or beta
Channel you are using alpha and beta
channels right we have over 250,000
developers using alpha beta and if you
aren't already using it then you
probably should be they're a great way
to test though new features on a subset
view users before releasing the apk to
everyone once you're satisfied the
optimized making optimizations make
sense for your app you can enable apk
optimizations for all apk is that you
upload if you want to download and
inspect an apk that is signed by play
you can do this at any time once they're
generated before or after they're
released after you upload an apk to the
play console it generally takes less
than five minutes to generate all of the
drives apks and then you can go into the
new artifact library in the Play console
you're going to select the apk that you
upload it and click on the download
button to get this pop-up now you can
download the original apk you can
download a drives a PK by entering in
the drives ID or you can type in a
specific device to get the apk the play
with send to that device you might also
want to try things out locally during
develop without uploading to the play
console to see how your app will perform
when optimized so there are two ways you
can go about this and simulate the
optimizations that we'll do on the
server side while you were doing local
development one way is you can
temporarily modify your Gradle config to
output the density and native
architecture optimized apks just by
adding the lines shown here what this
will do is it will cause your Gradle
build to output multiple apks each
targeted to a single screen density and
native architecture or you can build
your Universal apk that you would upload
to play and then run a new command that
we've added in a apt - that will
generate the optimized apks from the
universal apk this command is actually
what we run on the server to generate
the optimized apk from the apk that you
upload one other thing one other
important thing to note for local
testing is that many api's and services
require that you register your signing
certificate of your app in order for
them to work for example the firebase
SDK the Google Maps API and the Facebook
SDK or required
now if you're testing locally and you've
enrolled in Google Play app signing you
will likely no longer have access to the
app signing fee as it will be managed by
Google Play so you're going to be
signing your local bills with the upload
key or another key remember to register
this local key in addition to your app
signing key with all the relevant api's
and services that your app users in
order to show that you ensure that your
app will continue to function correctly
when testing locally finally one other
thing is that we've also updated how
in-app purchase power in-app purchases
check against check so we've also
updated our in-app purchase checks to
skip the certificate check for users
that are registered as license testers
to make local testing of in-app
purchases easier so if you want to test
in-app purchases without uploading an
apk to the Play console or without
having it signed with the app signing
key all you need to do is register your
account as a license tested in the
Google Play console so over to James now
to wrap things up ok so when can you get
Google Play app signing well it's
available today are optimized ations
were trialing in beta with a few
partners at the moment and we're hoping
to widen the beta in the near future so
if you're interested in optimizations
please go ahead and sign up for a
planning as soon as possible so thank
you very much for listening you can come
and see us later in the sandbox see
across across the way but we'll also
take questions just now if you have any
there's mics here and here in the
audience thanks very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>