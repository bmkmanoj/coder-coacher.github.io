<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[How Lego minifigures increased battery life by more than 80%] by Antoine Cohade | Coder Coacher - Coaching Coders</title><meta content="[How Lego minifigures increased battery life by more than 80%] by Antoine Cohade - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/BeMyApp/">BeMyApp</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[How Lego minifigures increased battery life by more than 80%] by Antoine Cohade</b></h2><h5 class="post__date">2015-09-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YMZPdSrKY5U" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name
I've been working as gaming application
for three years now so my job is on the
daily basis is to work with game
developers in order to improve the
quality of the games and make them run
better on Intel hardware and I'm here
today to talk about a topic
I've been looking into actually since
before I started working at Intel I've
always been really interested in to
power optimization actually since 2006 I
had but one of these brand-new laptop
with a Core 2 Duo and video graphics it
was one of the first one that was
claiming 8 to 10 hours battery life and
so I show up at university first days of
class I was like awesome I'm gonna be
able to play video games the whole day
through my classes and that sounds like
a great plan and I was really
disappointed when after 2 hours or
playing area from power to my laptop
just ran out of battery and since then
every year you see great laptops that
claims 8 to 10 hours battery life and
when you end up playing with them well
battery life's end up being at 2 hours
and it became even more important in the
mobile world where actually people do
always plays on battery and games always
sucks the battery life and looking a
little bit into it I realized that you
can make the hardware as good as you
want if the software is not optimized to
run best on that hardware
well battery life is just gonna go as
fast as possible so today I'm going to
talk about power optimization and I'm
going to talk about the work I've been
doing with Francom I don't know if you
know them it's a studio based in in Oslo
and Norway the work we've been doing on
Lego in order to optimize for their
games for power for power optimization
and how we saved up to 80% of battery
life by doing this so the agenda for
today why power matters why you as the
developer should be considering looking
into power optimization then we're going
to look how power works on system
nowadays we're gonna see how you guys
can actually optimize your game and then
you I'm going to show you what we've
been actually doing with Lego
so that to get such great results all
right off to the first topic so why
power matters when I was putting that
talk together I just spent a couple of
hours on the Google Playstore and I got
that kind of testimonials I'm pretty
sure you as developers don't really want
to have that kind of comments in your
game raise your hand if I'm wrong but
what I want to share here is that users
are becoming power aware they want to be
able to play their games for the whole
day whether it's on their laptop or on
their mobile phones when they are in the
public transport etcetera etcetera so
users are becoming power and they are
starting to realize that it's not only
on the hardware side but also on the
software side that you can achieve great
power saving second point here it's a
bit more technical so it's basically for
what you need to know is that devices
have power envelope which is now on
integrated graphics which is the case of
all of the mobile devices and most of
the laptops is shared between the CPU
and the GPU which means that basically
there is only some power that can be
allocated in total which means that even
if you think that your game is limited
by the GPU optimizing for the CPU can
bring you some great power saving so in
order to prove that I created a small
synthetic workload which is basically
rendering fractals so it's 100% limited
by the GPU and then I was running some
heavy kernels just calculating PI
decimals on the CPU sown on graphics
related at all and this is the result
I've been able to see so on the red line
is a traditional desktop system with
discrete graphics and as you can see the
CPU work does not impact at all the
the performance and this is what happens
on every integrated graphic system
whether it's laptop or mobile it's
basically the more CPU thread you're
running on the CPU the more the CPU is
we're going to need power to run the
thread and the more it's going to take
power away from the GPU slowing down the
performance of the application and you
can actually see that nowadays on on
games and for instance like the audio
sister setting system etc etc that are
running on the CPU can impact the
performance of your game and the last
one here for is that the devices have
varying power behavior which means that
you cannot actually control exactly
what's going on om have a lot of power
they can decide let's say oh the system
has less than 50 percent battery life
let's limit the power available so that
we can last longer on battery but
limiting the power is going to limit the
frequency you can go to and throttle the
performance of your game so here the
point is that if your game is power
optimized basically it's going to use
only ten watts so whether or not you
have 10 or 15 watt available you again
with you're gonna run great on the other
hand if your game was using the whole 14
watts in order to run at the decent
performance going to on to 10 watts and
having only 10 watts to run your game
you're probably going to have a really
end up with a really laggy result so
exploring power efficiency I try to put
it everything in a nutshell I've spent
hours trying to understand everything
that's going on in the hardware and it's
still not clear but basically what
happened is that what you need to know
is that SOC components every component
in your system have States and sleep
states and basically they have either
awake and then consuming some power or
there as soon as they go idle they are
going into sleep States consuming less
and less power and it's the same thing
when actives they also have performance
states so when they're awake or active
the more performance your system need
the more it's going to go into higher
states and so if you want to save power
the only way is just to do the same work
or less work more efficiently in order
to send your system to sleep because it
essentially when your system is going to
go to sleep it is going to save power
and maybe the most important point is
that the package sea state is determined
by the higher of the cause which means
like let's say you have like two cores
plus the graphics running at the same
time let's say to compute your game if
any of the component is active it's
going to prevent your system from going
to sleep and preventing that system come
going to sleep is going to prevent your
system from saving any power so the
important point here is that you need to
pay attention to every single detail
even if you think your game is running
just fine it might be worse just having
a look at the other components and see
how they're actually performing and if
they are not just wasting power for
unknown reasons so I try to put like a
couple of best practices for you guys
like simple stuff that you can do in
your games if you want to save power
so rule number one and it's for every
single game on every single platform
it's to add up to your platform they are
like gazillions number of platforms
different CPUs different graphics
different memory speeds different power
available etcetera etcetera and all of
those factors are impacting the
performance of your game so if you want
to have your game really optimized and
really running great on like all of
those platforms what you need to do is
at runtime when it's first time taught
the game or when you first download and
install the game just scan the hardware
that's available on the system and just
the settings or the performance of the
game so that it's actually number one
I'm gonna run on that platform because
that's really something horrible when
you download the game and you start it
for the first time it's running at two
fps and you need to go into the settings
to change so that it actually is
playable so you can do that detects
basically just run some short game
snippet at 9:00 time when you start the
game for the first time and detect the
performance of the system and then set
the system let's say to a lower
resolution or visual quality settings so
best practice number two and it's also
the easiest is to cap the framerate so
it's something really easy to do and
it's something really important cat
Circus essentially as I told you earlier
if you wanna save power you need to do
less work well capping the framerate
from 60 to 30 fps essentially you're
doing twice less work and this is why
it's like the most the most efficient
way to save power it's also fairly easy
well with both directx and opengl ES 4
so for Windows or Android it's literally
one line of code that you can add into
your code and for those of you using
unity there's also actually I think it's
just one check box on unity where you
can do that and actually save as you can
see a lot a lot of power so this is like
some results I've been measuring on a
Atom processor of power saving from
going to uncap frame rate to capping the
frame rate at 30fps and as you can see
for in some cases you get up to 80%
battery life simply by tapping the frame
rate and something you can do is that
for instance for static scenes on menu
etc is not only kept the framerate at
30fps but kept it even lower so let's
say like kappa 10 FPS and when the user
is actually touching the screen it's
just go to the main menu and raise the
framerate again so that it is it seems
to be
had it higher frame rates frame rates as
I said if you want to save power you
need to do less work
so essentially resolution is a good way
of doing it as you can see that was some
measurement done two years ago already
on a desktop system and it's the energy
that's required to render each frame and
as you can see when going to 800 by 600
from 6 to 16 by 9 essentially you're
gonna double your power consumption so
I'm not telling you to run all of the
games at 800 by 600 but the important
point here is to actually find the right
resolutions which allows you to balance
power efficiency performance and and
visual quality one of the way of doing
that is render for instance at a lower
resolution and upscale as a
post-processing effect just to be able
to have the right amount of power saving
with the right visual quality so if
computing data is taking power moving
data around is also taking quite a lot
of power and that's something usually
people don't talk much about it's the
the bandwidth so especially in the
mobile world where you usually now go to
crazy high resolution like 2k 4k
etcetera tablets well if you want to
render once a 2k frame buffer at 60fps
you're gonna compute you're gonna need
one gigabit plus one gigabyte per second
and the the bandwidth is actually
especially on systems consuming really
low-power have a quite significant
impact so this is like an algorithm
called HDR and basically I was trying to
show how much power does the memory deem
consume in function of the bandwidth and
you can see it's a linear it's a it's a
linear relation and you
so you're gonna tell me alright half of
what eighty 0.81 is not much for as
power consumption for desktop system
that consumes 100 watt but for some
tablets that actually consume like 2 or
3 watts on the CPU side it's actually
quite impactful and basically picking up
the right format for the frame buffer or
the right algorithm can just helping
that additional 15 to 20 percent power
that is going to make your customer
happy
be careful spin loops so spin loops
we've all used them we've all learned
that at university or wherever we've
learned how to code and it's actually
quite hard to forget how to use them
because they are everywhere they used to
reduce the input latency they use for
thread pools etc etc and they are really
really bad because essentially what
they're doing is that instead of sending
your CPU to sleep basically what's
happening is that they just like keeping
it awake without computing anything just
prove any from saving power so they are
most of the time now there are ways to
avoid that you can use interruptions you
can use the post instruction if
necessary if you really need to use them
the post instruction and you probably
get access to the slides afterwards I
pasted it on a page that was showing how
to use that instruction which basically
even if you spin loops is hinting your
CP oh it's time to sleep now
this is just a spin loop you can you can
go to sleep and save power there are
literally a lot you can do and it's in
general a power optimization is
performance optimization so if you've
been doing performance optimization
you're already familiar with those
concept but the additional one so for
people actually developing for Windows
handled lots of focus do you guys know
that when you are tapping your game it's
actually keeping and rendering it the
whole time even though it
just a vignette in the in your taskbar
so you can actually detect how when the
when the your game is not active and
stopped rendering at that time put in to
pose and avoid just rendering for
something that nobody is looking at
color buffer clears so when I learned
graphics I've been told our careers are
coming for free etc as well it's
actually not the K is basically on
traditional hardware unoptimized clears
consists in filling the frame buffer is
each pixel per each pixel one by one and
especially on really like on not so
powerful mobile hardware that can take
up to one millisecond out of well 16
milliseconds if you want to run at 60 F
at 60 fps that's actually quite a lot so
they are optimized clears of course in
the hardware but those are not only
always available so if you want your
clears to be efficient just use either
the black color or the white color those
are optimized in hardware and those are
actually in instantaneous instead of
taking a couple of milliseconds wasted
to the game's optimization using depth
so that's something to the game
developer usually don't really look at
the desk buffer etcetera like oh why do
I need Bev's I'm actually not using any
depth I'm actually creating a 2-d game
and basically what you can do is using
the depth buffer as a mask in order to
rerender in order not to have to
re-render everything at the same time so
let's take a simple example we've all
seen candy crush so typically you have
the candies in the middle that are
changing every frame but everything
that's around the whole like doesn't
need to be rerender every frame so what
you can do is basically only rerender
the middle part of the of your screen
and leave the rest at ease so that you
actually are saving power and
performance by only rendering the part
of the scene that needs to be
we're using CPU activity as I said if
you wanted to be safe our you need to
have all of the parts of your game that
are optimized and I've seen like I've
been working now for three years with
game developers I've seen great stuff
done on the CPU I've seen people using
ray-tracing
in order to simulate the echo in a
tunnel that's great but I'm not quite
sure that on one of those mobile device
you hear the difference between
ray-tracing sounds or not and actually
removing that from the game was helping
us gaining roughly 2 to 3 milliseconds
of rendering so essentially a couple FPS
from just removing ray-traced
sound system uses the deck generation
API is what we've all followed
we've all followed the news this year
dx12 is there and it's coming Vulcan is
coming as well essentially what those
aps do is that they allow you more
control so you have less overhead on the
cpu so you can do more efficient
graphics so that's basically the most
common optimization that everybody can
do on their own on their own games in
order to save power so a bit about Frank
um so it's a Oslo base to do as I said
earlier there are two big games before
they go age of Cannon and the secret
world that were actually the design for
major audience only for a hardcore PC
gamer etc etc and they wanted to have
like big and like terrific graphics
effects etc etc so they never really
targeted mobile and it's the first thing
they did with Lego because Lego has a
different audience it's targeted for
kids so they had to have a game that's
actually rent can be played on every
single device kids are playing on which
is nowadays like mobile so laptops
tablets phones etc whatever is computing
they want to be able to pay their games
on
so they started from a brand new engine
and they and they just had it optimized
as much as they can but they also wanted
to have really high-end features so what
they did is they did an engine that's
actually scaling tremendously well from
you can get awesome visual quality and
play on your desktop with great visual
effect and you can also get mobile
performance and lots of power saving so
this is a list of the features they've
been implementing so as you can see it's
actually not much and it was done fairly
quick and just simply doing this help
them saving those 80% now let me detail
exactly for each of these feature how
much they've been saving so frame
capping is the first thing to do I told
you already so and then I measured with
on a special system laughs that's
actually I have cabled the output and
input of the CPU in order to measure the
exact power that it consumes and same
for the memory and the whole system and
basically simply by capping the frame
rate to 30fps
you get up to well in that case other
system power just 25% battery life
simply by doing that and they actually
decided for a couple of reasons not to
use the flip and sequence to cap the
frame rate they decided to do that on
the CPU side which is an alternative
which allows basically that it's not
dependent on the driver they using it's
not dependent on the system the using is
depending on their CPU side code and
it's most accurate the second one is low
quality shadows so lower res shadow Maps
simple filtering and disable avsm so for
those who don't know what avsm is stands
for adaptive volumetric shadow maps
sorry and I have a screenshot on the
next image and just from doing that
simplifying the shadows they had
so 8% on the soc power and 4% battery
light and as you can see here so that's
before the saving that's after so as you
can see they simplified the shadow and
you remove actually the smoke shadow but
they were not happy they wanted to do
more so basically what it is is simplify
also the lighting a bit further so it's
deferred but simplified and in the
shadows as well only render only dynamic
object because those are the shadows
that actually move and attract the
visual and also disable the some of the
ambient occlusion and in that for that
case again they get an additional 10%
battery life and here you can see that
some of the shadow is staying but some
of the shadow are removed from this
optimization and the last saving in
order to really get to to their goals
they decided to disable all of the
post-processing effect and you can see
it here for instance what you can see
the best is the depth of field so this
part of this red screen is blurred and
when they remove it is actually rendered
normally and so overall they still have
a game that looks amazing and those are
battery random tests so we basically
played the game for a couple hours and
just until the battery runs down and
these are the benefits they were seeing
so it's up to double battery life on
some of the systems
they've been optimizing for and the game
is still I mean there are some
differences in visual quality you can
play the game afterwards like the
difference game but basically it's still
like good looking game with some power
saving so to summarise user cares about
battery life but they also want to be
able to play the games that create
visual quality right so let them choose
let them ask okay do you want to go
power saving or do you want to have high
resolution graphics etc etc do you want
to play for four hours or do you wanna
play for two with the best visual
quality
let's the user choose that's their own
right power optimization is performance
optimization so you've all done power
performance optimization well just do a
little bit more so that you get actually
to save power and the last point is that
focused optimization as so with the
example of Lego can bring you terrific
battery life saving still saving power
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>