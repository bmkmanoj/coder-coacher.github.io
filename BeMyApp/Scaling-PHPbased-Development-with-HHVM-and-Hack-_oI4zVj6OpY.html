<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Scaling PHP-based Development with HHVM and Hack | Coder Coacher - Coaching Coders</title><meta content="Scaling PHP-based Development with HHVM and Hack - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/BeMyApp/">BeMyApp</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Scaling PHP-based Development with HHVM and Hack</b></h2><h5 class="post__date">2016-06-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_oI4zVj6OpY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone welcome to this webinar
featuring ETH Viet Minh hack here we
have duper receipts one of the
co-creator of an actus with the subject
he'll be presented in just a short while
and if you have any questions along the
way please post them on the comments
section below
all questions will be addressed by doing
the interview so that I'll let you work
hi everyone my name is Drew Croskey
and today I'll be talking about HH DM
and act what they are how to use them
and why you should care to start a
little about me I've been working on
compilers and programming languages for
the better part of 10 years and I'm
currently an architect I'm an
engineering manager at mime sequel where
I focus primarily on optimize sequel to
x64 cogent and I also work on
programming language teacher development
my sequel is a high-performance
distributed database and we're doing
some really cool stuff with distributed
computation real time data processing
solutions programming language
development so we're always looking for
good people before I meant sequel I
worked at Facebook where I worked on a
JVM and hack from their inception or
early formative stages through the
respective launches to production and
their open source launches to the public
I also contributed to get popped for PHP
which was hbm's predecessor during my
first year and a half at Facebook so
what does hhp on HTTP imma is it stands
for hip hop virtual machine and it is an
execution engine that is designed to
execute programs written in PHP or hack
a JVM one of the big features of HH PM
is JIT compilation to x64 machine code
and to this end it uses JIT compilation
to achieve superior performance while
still preserving the productive edit
save run workflow the PHP is known for
DP developers really loved the ability
to open their source code and make a
small change or a large change it saved
refresh in the browser and be able to
instantly see their changes without
having to do a build stuff that could
take 30 seconds or more so it's very
important from that hhb unpreserved that
development workflow ajg i'm development
started in 2010 and it launched to
production and open source late 2012
early 2013 three of the top ten websites
in the world according to Alexa rankings
currently run on HH PM namely Facebook
Wikipedia and by you each of them
strives to have a very high level of
compatibility so it's able to run most
popular PHP frameworks and applications
out of the box without having to change
a single I have code and finally before
moving on is worth noting that hbm's
open source you can go to github.com
slash facebook / - hmm and you can see
all the code you can see the views and
floor requests and there's an active
community of developers outside and
Facebook actively contributing to our
github
what's hack how because the new
programming language for each HTM its
development started in 2012 and it was
open sourced in 2014 had Kevin
near-identical syntax is piece being
supports most PHP language features so
in other words a code when you look at
it looks a lot like PHP code but with
some extra new syntax here and there at
the center of the hack universe of the
type checker the type checker is
hands-down the most compelling part of
the hack experience as we'll see in a
minute it greatly improves developer
productivity and compiler tool such as
IDs and static analyzers prior to hack
development beginning agency I'm an
addictive speed a bit language teachers
like scalar type Kent's
user attributes and generators so as the
type checker as type checker development
started it made sense for this language
feature development to continue and
expand as part of the hack programming
language most of the new language
features in hack were designed to
complement acts amazing type checker so
a quick overview of the topics we'll be
talking about today first we will talk
about how to get started with HH dam
attack there's a kind of myth that these
tools are hard to install or hard to you
so I'd like to demonstrate just how easy
it is to get going and then after that
we'll be digging into a few more topics
we'll look at how ATGM can boost your
application performance we'll look at
some demos using hack to demonstrate how
I can improve developer productivity we
have a demo another demo that shows off
asynchronous i/o features in the hack
programming language and we will also
cover a lot of the new features they've
been launched since tax initial released
in 2014
and finally we'll wrap up talking a bit
about the impact the day th scam in the
hack has had on the broader PHP
community ok so you save yourself I
don't try out anything famine pack how
do I get started
so I will walk through what my
experience was setting up hhp I'm a hack
on my machine I have a MacBook and I on
my macbook I am running Mac OS and I
also run a VM on my macbook which is
running a blue tube Linux and this is a
common set up a lot of developers
various tech companies or other
companies will commonly use a Windows or
Mac laptop and then they will either SSH
into a Linux VM running locally on their
machine or the lastest H into some
remote Linux machine so I think my
experience installing here will be very
similar to many other developers
experience so we start by just open em
google and type in installed each expand
boom to 14 2004 and bam first thing I
get is an article written by
digitalocean which is a walk you through
step by step every command and explains
how to configure a Jake Sam in a number
of ways to work with lots of different
web servers for the purposes of this
talk we're just going to do a quick and
dirty install so this the digitalocean
article gives a lot more stuff you can
do after these initial steps but we're
just going to walk through so it's
really just more commands and after
you're done running the
or commands that that's our you know
you're on your Linux VM or on your Linux
machine you should see a screen that
looks something like this so you'll have
a nice friendly screen that explains
HHM has been installed and it gives you
a bunch of basic instructions on how to
look up eight HD am both web servers
like apache nginx and also how to run
each age game at the command line so for
brevity I won't go into setting up hht
I'm with web servers but as I said you
can google and there's any number of
guides on the air that's at sony vaio in
addition to the instructions that are
shown in this friendly text output after
you've done this all I get to be on so
one last thing to get started is to
launch the hack type checker hack is
automatically installed when you install
a HTM but the one thing that you that
the Installer can't magically figure out
is where your code bases so you need to
CD into the root directory of your code
base and you need to create a file
called dot h h config this file can just
be empty there's also you can also put
config settings into it that that's
something that you can read about one
half documentation we won't cover in
that today after you create the dot HH
config in the root directory of your
codebase you then type HH underscore
client enter and you will see output
that looks something like this so
there's couple lines of output the first
couple of lines are printed out because
a J's client notices that the hack type
checkers server is not running in the
background so it automatically kicks it
off for you and then the last line
printed output says no errors using the
caving that the type checker wants the
server started it was able to check your
entire code base and verify that there
weren't many type errors now in this
case my folder is empty
so it's tributing to print out doors but
if I had hack code already in this
folder and I typed 8/8 client they would
type check it for me and then once
you've done this now you can play a
Jake's client and then point in the
future whenever you're in your code root
directory your code base or in a
subdirectory and you can quickly
less than a second find out whether you
have any type mismatches in their
codebase
so moving on now we're going to look at
how to boost application performance
with h h vm so we're going to do a very
simple example basically we're just
going to create a very small function in
this case it's a simple recursive
function that computes the nth Fibonacci
number it isn't particularly interesting
but it's small and it will help
demonstrate the difference between PHP
and h h vm and then when you have this
file all you'd have to do is type h h vm
and the name of the PHP file just as you
would the HP there's some other things
you can do as well so there's a global
analysis mode page h TM offers to give
you additional optimizations it's also
referred to as repo authoritative mode
frequently some people have found this
mode can be mysterious or you know hard
to use it's actually quite easy so this
slide shows how the two commands you
have to run so one command is basically
not going to execute the program it's
just going to analyze it and build up a
byte code repository ahead of time
that's what that file h HP h HB c bears
so the first command just builds that
out the second command will actually
execute the Fibonacci program and it
will use the builds up like code
repository that has all the global
analysis in its to get that extra boost
of speed so now we're actually going to
do it do a demo live so I already have
the Fibonacci program ready to go
and because H VM is
dropped in replacement for PHP you won't
really notice anything different when
you ask you program except for how long
it takes so first we are going to run
this program on HD five point five point
nine and we're going to put time and
front of it so that we will get a
printout of how long this program took
to execute so as you can see PHP took
just under 10 seconds to compute the
37th Fibonacci number using this
recursive function that we've defined
now we are going to run in the same code
but with a chick jam instead so I bring
out the AGM version that I'm running
with and now I just like time matrix
again 50 HP again in time isn't actually
necessary to run the program but I'm
just adding it so that we get a printout
to pile on program to execute now before
I can even finish my sentence h/h am
finished executing we can see it took a
little over half a second to do this so
that's about a difference of about 17
acts on this particular benchmark now
some of you in the audience might be
shouting hey what about PHP 7 they've
made great strides in improving
performance and you'd be correct so I
also have PHP + 7 installed on this
machine so that's the version I'm
running 7.0 point 7 and less you have to
be feet 7 a world on the Fibonacci
benchmark and you'll see that it took a
little over three and a half seconds
which is a substantial improvement over
PHP five point five point nine
excellence
so like the benchmarks are fun but they
can be very misleading what people
really care about is application
performance real applications don't
spend all of their time recursively
computing different Fibonacci numbers
real applications are a mix of many
different language operations and they
also do a fair amount of i/o and IO is
something that jiff calculation can't
speed up for you so the rule of thumb is
to always measure your application see
how it performs I stock PHP vs h h vm
because micro benchmarks can be
extremely misleading it's also
interesting to see that there are some
folks externally that have done an
application benchmarks with PHP 7 versus
80 Hz I'm so shown here Kingstown did a
series of benchmarks this is their final
post I believe is their final post in
the series that compared a very recent
version of PHP 7 to makes me I'm not a
number of applications so the slide here
is showing a graph that compares to
police performance on HH Jam versus 57
shown in red and PHP 5.6 shown of green
agency I'm happens to shine particularly
well on Drupal 8
in fact they noted that they didn't
believe the results at first and so they
actually uninstalled everything
reinstalled everything and repeated the
experiment but then there are other
applications where et GM still performs
better than PHP 7 but not by nearly as
much so this slide is showing how each
HTM forms on WordPress 4.4 now earlier I
mentioned that an ATM has a global
analysis option where you can run it on
your codebase in advance and it can
infer extra things and perform extra
optimizations and it's not often called
repo authoritative mode so in this slide
the length yellow bar is showing rubella
Thor tative mode and it gives me idea if
you get a little extra boost in
performance over running each ATM
normally without people authoritative
mode
application benchmarks will give you a
more accurate picture of what kind of
performance improvement or decrease you
might see when using HH dam versus PHP
and it's also worth noting that most
popular PHP applications have not been
tuned specifically for atm so for some
applications there may be a few small
simple changes that can be made to boost
that applications performance starting
running on 8-hd you might be asking
yourself now okay great HH near animus
fast but does it add you know does it
actually work
do people actually use it so there's a
number of major websites that use HH BAM
in production the largest I'm aware of
our Facebook Baidu Wikipedia XE inbox I
also know of a number of smaller sites
that run H HTM as well and there's a ton
of hosting services out there that
authored PHP and that layoffs also
offered on a to HTM hosting some of
these even have 1-click installs on AWS
or Google cloud for running an H HTM
based web site and one last closing
thought that I'll leave you with before
leaving HTM and moving on to act is that
there have been countless studies on the
impact of response time so shown on this
slide is a well-known paper from 1982 by
Doherty and vitani and this paper is
where the the so called Doherty
threshold comes from this paper found
that when they were analyzing user
behavior with a system if the system
took less than half a second to respond
that users were disproportionately more
productive they were able to get more
done for our then you could account for
it simply you know they already
accounted for the latency but even
accounting for that users were getting
significantly more transactions done per
minute or per hour and they found when
response time started to go above a half
a second that the shape of the curve
changed so it was a very
and a number of major tech companies
have done very similar studies over the
last 15 years or so and study after
study finds that even minor changes like
reducing a lot a page takes the load by
100 milliseconds or 200 milliseconds can
have a non-trivial effects on sales on
how long users spend on the website and
other important engagement metrics so
something to think about even if you
don't have a big data center or you you
know switching the ATM wouldn't
necessarily save you a bunch of money in
terms of operations reducing the latency
and making your site feel snappier can
have a major effect a number of
engagement metrics and sales and other
things that people care about so now
we're moving on we'll be talking about a
hack for the rest of the talk and I'd
like to do a quick demo that shows off
autocomplete in hack which will give you
a pretty visceral feel for the
productivity you can get by using the
hack type checker and for the audience
if you have any questions at this point
please post them in the comments section
I'll be fielding questions that you have
at the end so we're going to jump into
this autocomplete demo and I did a very
similar demo at hack developer day back
in 2014 but this time we have some new
stuff to show off so there's the nuclide
OEE which was open sourced by Facebook
about a year ago we're gonna show that
off so the new play ID is not strictly
necessary to use half you can use that
without stalling nuclide but I wanted to
show it off so I went to new Clio Docs
features remotes and I watched through
the install instructions so if you have
a setup like mine where you're on a Mac
or Windows laptop but then you're SSH in
either into a Linux VM or into a remote
Linux machine you're going to follow the
same instructions so
it turned out that installing nuclide
was actually very easy I've summarized
the steps that I needed to follow to get
basic functionality up and running my
base the boom to 1404 install I only had
just a few dependencies so I had to
install node I knew Clyde requires node
5 or higher I happened to decide to
install node 6 point 2 point 1 so as you
can see that only takes about 6 commands
to install and then I also had to
install a tool called watch man which is
another tool Facebook open sourced and
watch man is used by name Clyde to
monitor the file system and detect when
files that have been changed or new
files have been created and so forth so
I ran these installed commands on my
Linux machine or on my Linux TM and then
now I have to have that once like they
got that out of the way the next step
was to install the ivy on my back so I
went to anime Oh Adam is the app that
nuclide runs aside utilizes an extension
for Adam this will make sense in a
second but anyways you go to adam.com
download for Mac you downloads and you
know I unpack it move it to my
Applications folder then I double-click
on atom it launches and the next thing
that comes up is I had to go to the
Preferences menu and then I when it
popped up that this window popped up
once I went to preferences as you can
see on the left hand side there's an
install button or an install tab rather
so you click on that then this text box
pops up to let you search for extension
packages and I type a new plug into the
text box hit enter nuclide results pops
up and there you can see there's a
little install icon and the install
button in the bottom right corner so i
clicked on that and to
that's about 15 seconds or so and after
that was all done now I am brought to
the nuclide landing page which looks
something like this
and now every time I launched Adam it
will just bring me to this big job
actually so I don't after it beat any of
those steps every time I launch and as
you can see from the website landing
page it's got a number of interesting
features of course I don't have time to
go into a ton of them will mainly just
be focusing on my hack and looking at
some of the neat features you dad but
you're also able to do debugging so
nuclide supports setting breakpoints in
PHP or hack code and then you can step
through your code and do any number of
other things basically things you take
for granted in IDs for other languages
that have integrated debugger nuclide
has has those you know as those basic
features that people take for granted
and other IDs okay so let's actually
open up nuclide and take a look at I
have a sample function here so suppose I
am I have to code and there's a function
that the stuff that hasn't been filled
in yet it's called it'll just throw an
exception and it's my job I'm a
developer it's my job to actually make
this function do what it's supposed to
do so we read the doc block at the top
it tells us this function is mainly
supposed to take a list of posts and
then it's supposed to return all of the
authors of these posts who are also
friends with the specified user so I'm
going to get started here and we're
gonna start with posts which obviously
that's be our starting point we're gonna
somehow need to go from this list of
posts to a list of authors of the posts
so post is a vector so it has a number
of higher-order functions so once I type
arrow I can see a list of the functions
available to me that vector offers
and the function I'm going to want to
use here is maps map will allow me to
call a callback on each elements in this
vector and then create a new vector with
the results of each callback invitation
so I'm type of map and now I'm going to
use that lambda syntax very similar to
these D closures but the syntax is just
a little more concise so my lambda is
going that have one parameter P and then
I want to see okay what methods to my
coffee so the type vector is smart
enough to know at this point that P is a
post because the post variable is a
bacterial folks or those each element as
opposed so it can tell me what methods
are available and I see I have a good
author method so that's gonna do exactly
what I want and now just to kind of show
off some of the other features in
passing I can look at X and I can see
what it's type is going to be back
telling me it's a vector of user so
that's smart enough to know that we
started with a vector post we applied we
did a map with a lambda that returns
user objects so therefore the resulting
vectors can be a vector of users so very
neat that new file aoz you to hover over
a variable and find out its type now I
have a vector of all of the authors of
the posts but I don't want to return all
of those authors I only want to return
the subset of those authors that are
friends with the specified user so as I
said there's a bunch of handy
higher-order functions that collections
offer and filter it fits the bill here
filter we're going to be able to specify
a condition and then it's going to
return a vector only of the elements
that back that condition so we're going
to use a tax lambda syntax again and so
we for each user how do we want it you
know we need to return true or false
true meaning the this usership stood on
pass through the filter false meaning it
should get filtered out so we only want
users who are friend
with specified user and so thankfully I
have Pat and he is friends with method
that I can see and now I just need to
put in the parameter so I can say
updated is friends with user and okay
and now I thought I was I want stuff but
I see a little red arrow and line six
now if I hover over the red arrow it
will tell me what's wrong
it typed a little hard to read so I'll
read it out for those of you who can't
see it is telling me that on Line six
that it's a click on it it will show me
this is a vector it's referring to the
return type and then it says it's
incompatible with Lloyd because this
function implicitly returns void so what
it's telling me is hey you claimed that
this function returned a vector but
you're not returning anything and as I
can see oh geez I forgot to write return
so that I actually returned the final
vector that's produced by filter now
when I hit save red arrow goes away and
so now I know everything type checks
properly so this gives you a pretty good
idea of what's possible with the hack
type checker powering an ie there are
also plug-ins for vim and Emacs to do
very similar things so if you don't like
graphical IDs and instead prefer than
minimax they more Emacs you can get this
exact same experience and before we
leave I just want to show some examples
of how type mismatch can be detected so
we already saw one which was it's a
tected ID was returning void when I
shouldn't be returning a vector here is
friends with is supposed to take a user
but what if I accidentally passed it a
vector of coasts instead so I get this
little red arrow here telling me hey
this is an object of type user and if I
click on it it's going to take me to the
definition of this friends with is
referring to the parameter is the type
patience as its in user so yeah it says
this is not just a flight user it's
incompatible with type vector and it
tells me it points me in line six
because that's how it knows that the
dollar post variable is a vector because
it was told back in this function
signature and this example is pretty
trivial but when you're working on a
large code base or even a medium-sized
code base having the ability to nearly
instantaneously discover these type
mismatches is a godsend because for any
of you in the audience who's ever tried
to do refactoring on a PHP application
if a PHP application is beyond a certain
size it's almost impossible to do
refactoring without breaking something
and not realizing it so after you do
refactoring on a PHP application you off
and that's not a lot of time testing
every part that you touch to make sure
that you didn't accidentally introduced
in there so that was the autocomplete
demo showing off the power attacks type
checker and how to improve developer
productivity the next we'll be moving on
to talking about asynchronous i/o with
hat so I mentioned earlier that JIT
compilation speed or JIT compilation
rather cannot speed up i/o for you the
traditional advice that you will hear
for any language when you notice that
your application is spending a lot of
time blocking i/o the traditional advice
is to use asynchronous i/o api's so what
makes an i/o most io8 guys who are
familiar with are synchronous which
means that they will cause the entire
application or at least that threat of
execution to block and not make any more
progress until the i/o is complete and
then once the i/o
results the I already that thread can
resume and keep executing asynchronous
i/o is the important difference
that you the api's are structured in a
way where you you fire off the i/o
operation in the background but you
don't your threat of execution doesn't
stop it keeps executing and asynchronous
IO API is traditionally can't return the
result value to you because you know
it's not ready yet the function returns
immediately so instead they typically
return some kind of handle object or
promise object that you later can use
with another API to test if the result
is ready from the corresponding i/o
operation this happened background so
for any of you who've run into this
issue and in various languages and then
tried to start using async i/o API is
what you'll find is that without the
assistance of special language features
it can make it it can make your code
very hard to read very hard to maintain
so people like synchronous i/o api's and
they like synchronous style programs
because they're easy to understand it's
easy to follow what order things are
gonna happen in with when you start
changing your applications use async i/o
you end up having to do a lot of
bookkeeping yourself to be smart about
when you actually block on a handle or
promise to actually get the real result
right because async I know the initial
call doesn't block but eventually at
some point you have to call another API
to actually get the result from the
handle or the promise object and that
call will block if the result is ready
so you end up having to do a lot of
things just structure your code to put
that off as far as possible so that
ideally by the time you go to retrieve
the results that you know the
corresponding IO operations that we're
running in the background have already
finished so kak offers a language
feature called a sink and a weight that
makes it a lot easier to take advantage
of basic i/o api's and improve your
applications performance
this feature was inspired by a feature
that I believe was originally a c-sharp
I'm not sure if it C sharp was
influenced by other languages that came
before with similar ideas but a number
of languages have started adopting a
sick weight because it's just really as
you'll see makes it a pleasure to use a
sick guy or guys or at least makes it a
lot better experience using them than it
would be otherwise without this feature
so I believe Python recently added
async/await about a year or two ago
and I know JavaScript Arachna script is
currently debating adding async/await
but I don't think it looks like it's
eventually going to get at it but I
don't think it's officially been added
to the language yet so hack is a little
ahead of the curve act as head async the
weight internally since 2013 and then
it's in 2014 since its public watch so
if you want to use async the weight and
your favorite language doesn't support
it and it exports it right now so let's
take a look at a demo will show off what
you can do with XV single week feature
so I have a program pre-prepared here
and force implicit in the very simple
program just so that you know all the
code fits on the screen and you can read
it and quickly understand what it's
doing so in short what this application
is doing is it's curling two different
URLs so it's contacting these websites
through the HTTP protocol then it's
waiting for their response which is you
know some kind of blob of HTML and
JavaScript tags and so forth so what
it's going to do is it's going to curl
each one of these URLs so if you look in
the body effects URL you will see that
it calls curl exact on line 9
is the blocking i/o API so when the
thread of execution reaches this point
executions going to stop and it's going
to wait until it gets a response back
from the website that it's curling and
then it for demonstration purposes I had
this function to a little bit of extra
work after curl returns you'll see why
in a second so it prints out a message
as soon as curl returned saying I'm done
fetching this URL and then it also wraps
the contents which is going to be a
string that wraps it in this little
uphold their object called URL contents
which holds the original URL and then
the string of contents so just to show
you real quick this is what the URL
contents class looks like very simple
just as a constructor that takes the URL
and the data and then stores them into
properties named URL and data so we know
what fetch does in fact as a single the
contents of a single URL packages them
up in this little URL content object and
returns it and we do the fetch all who's
going to call fetch you are Alex Wyse
I'm still going to be fetching the two
different from two different websites
and then we want to return an array of
URL context objects so the caller of
that job if you're on line 20 you will
see that it will get back the array it's
then gonna loop over the array and then
for each element in the array is gonna
print out the URL and it'll print out
the size of the data on the actual data
would take up the whole screen so for
demonstration purposes I just print out
the size let's run this program now and
we'll see how long it takes a printout
timestamps you get an idea of when each
event happens and then I'm using time as
well so we'll get an idea at the end how
long the whole process so you can see if
Esther makes BM about 5 seconds later
they got a response then it started
fetching from example.com and then about
5 seconds
the whole process took about eleven
seconds and the main reason it took this
long is because it did the IOC really
the second my operation did not start
until the first one was done so this is
where they think weight comes to the
rescue
so I only had to make a few small
changes to the program so you can see it
mirrors the new program is on the right
side and here's the original program on
the left side so you'll see this async
keyword in front of the functions which
means that these are special functions
that can be suspended and resumed and
then for clarity this isn't strictly
necessary but I added return type hints
to these functions so that you can see
that fact URLs no longer returning on
URL contents object it's returning in a
way table of URL content so a way table
is basically hax version of a promise
infection Allah does something similar
instead of returning an array of URL
contents it's now returning an available
of array of URL contents so you'll see
that we've switched out instead of using
the standard curl exact API we're using
a special east synchronous curl API the
pack offers and this asynchronous API is
not gonna return a string it's going to
return an away table of stirring the
await operation is then gonna unpack
that away table and get the string out
of it
so dollar contents will oldest rain and
then URL contents will be constructed as
normal nothing magic going on there and
in fact all this is going to be an array
of away tables of URL contents this
variable here so then it calls it uses a
we call wait handle to basically block
until the results of both of those away
tables are ready and then it's going to
call the results method on each one to
get the result out of the available
objects so that that's all so that you
know this value right here is a way to
we'll look URL context
then finally at the top level we call
fetch all now a common thing that isn't
explained very well when you look at a
sink and waiting in other languages is
how do you enter an async function to
begin with a lot of Doc's will show you
once you're in an async function you can
call other async functions and you can
away - yada yada but you're not allowed
to await outside of an async function so
how can we get started that's where the
join method comes in so at the top level
fetch all is going to return in a way
table of array of URL contacts and then
this part is actually going to say tell
the runtime hey we need to block until
this away tables ready and then it's
going to unpack the result value stored
in this variable here R so R once this
line complete finishes executing is
going to contain just a regular array of
URL contents and then we can just use
for each is normal to loop all right so
we have our timing results on the side
so now let's see how well we do with a
big VM and they sync the eyes because he
actually is able to fix both of them at
the same time the timestamps in between
them show that there was only about 20
milliseconds in between when I started
fetching the water and when it started
fetching the other and then it gets the
results back and it's able to print it
out and you can see that it really
didn't get the contents the sizes match
but it did it about half the time it
only took about 5 and a half seconds
instead of 11 seconds so as I mentioned
earlier basically feature provides a
clean way to be cooperative multitasking
on a single thread so this is important
it does not involve multi thread this is
all on one thread it's just task
switching between different tasks and
it's a little hard to explain without
stepping through which I'll do in a
second but at a high level things you
need to know when nascent functions and
folks it's gonna execute as far as it
can until either it returns or it
reaches in a weight operation on a
weight of all these results not ready
yet
urban async function receives an away
table that represents that the return
value of that async function so we saw
that the demo when an async function
awaits unavailable and the results not
ready yet at that time the async
function stack frame is suspended and
it's moved off the call step and then at
some point later when that available
results becomes available that suspended
suspended stack frame is going to be
restored and put back on the call step
and then the execution of the async
function will resume where it left off
so I'll just walk through real quick how
this actually works so the demo code the
demo code that I showed starts off in
the main which is the top level code it
main then calls special that's all then
calls each a fetch with a THD I'm calm
as its parameter it's gonna print out
and get me touching to the screen and
then it's gonna call our special a
synchronous curl exact API and that's
gonna start IO operation of the
background so then the fetch method
awaits on the available returned by curl
exec and so at this point then a Weibull
is not ready yet so the frame for fetch
is going to get suspended and move off
to the side and then execution and side
effects all will continue that all will
then call fetch again this time passing
in example calm again fetch prints out
another in fetching message the screen
then it calls girl exec which starts
another i/o operation the background and
then it awaits on the available returned
by kernel exec and so that wait was not
ready yet so the frame that frames were
fetched gets suspended as well so we now
have two suspended frames for fetch
hanging out while we're waiting through
these i/o operations to finish off
that's all awaits on the week all week
handle thingy which basically is going
to block until these two i/o operations
are done
so I've returned that and frame get
suspended it returns the main main then
calls join on the away table that was
returned by fetch all that's going to
cause
a special scheduler frame to get erected
and then the scheduler frame is going to
block until one of the i/o operations is
completed at some point example.com zyo
operation clean so it's able to resume
the fetch stack frame related to that so
that finishes executing it prints out
done the done fetching method returns to
his collar the ACE and i/o scheduler
frame now blocks again until the next
eye operation is done so then eventually
the curl to AGM comm finishes so it's
able to resume the stack frame for fetch
fetch then prints out to the screen done
the fetching it returns and so now all
of the dependencies that fetch always
waiting on are finished so a Essos
scheduler is able to reschedule back so
now fetch all picks up where it left off
and if then returns it away table
now the join call in being returns
actually has the results and it's able
to print out to the screening so this is
a quick and dirty thing that for people
who've never seen any sync the way
before it gives you a much more visceral
feel for what's actually happening in
the order that things happening so some
of you might be saying great you support
asynchronous curl what if I need to do
other i/o
well thankfully hack has a number of
nice and i/o api's now you can see it at
the tack documentation under these sync
extensions so in addition to the easting
curl api we also have he synced my
sequel api's and async stream API for
waiting on the results of one or more
streams so we're coming towards the end
of the talk we'll quickly talk a bit
about some of the new features that they
had to have since its initial release
originally I was only going to list all
major pp7
features as a single bullet point but
there was actually a lot of stuff you
got an all coalescing operators
spaceship operator pc-7
added scalar type base and adds strips
one
and weak ones so hack had to be updated
hack already had its own siphon system
but it had to be updated to be
compatible with this new feature in p7
group use declarations and some
improvements of generators some syntax
improvements
aside from PHP seven language features
like tighter coverage have been greatly
improved so the type checker now catches
more things than I'm used to for example
when you access a global constant it
will now detect if there's a type
mismatch things like that and then just
a plethora of new language features
async closures asic lambdas async
generators interface requirements which
is like trade requirements but for
interfaces
there's return type enforcement on
return type annotations on async
functions now so you get a little bit of
extra protection runtime there's just
too many to list them all or say them
all out loud here we have null safe
access operator which a lot of other
languages to have where the base might
be null or it might be an object and if
it's null you just want the access
operator to return null
I'm since quite handy there's a plain
pop crater well we'll dig into that a
second and then finally has some new
array types so flexions are great but if
you have a large PHP code basically are
to use raised ton or if you really like
and value arrays value semantics you
know they don't behave like objects when
you pass them around they pass by value
so for developers that appeals to a
packed has these new array types back
and dipped so Aysen closure basic glam
is pretty much exactly what you think
they'd be you just a basic keyword in
front of a regular piece closure and now
you can do a weight inside of that
closure and then you can do the same
thing with lambda so lambda is the
equals equals greater than arrow and
it's
hack feature that's like a more concise
version of closures so you can also put
these thing keyword from that and now
you can wait inside the body of the
lambda we have immediately executed
lambdas which is basically syntactic
sugar for an async lambda with no
parameters you that immediately invoked
there's a sink generators so you now can
use yield inside of an async function
and this actually works so here's an
example of a function called series that
loops over loops over n times calls
fetch Ives n times awaits on fetch a
presumably fetch Rob is some
asynchronous function that's needs to
i/o and then for each thing it is able
to loop over the items and yield them
and so someone consuming series can use
these for each or weeks syntax which is
shown here we have super constraints on
type bars so we're similar to as except
they worked in the opposite direction
most of the time as constraints or the
time you don't need super constraints
most of the time you only need to ask
constraints but there's a couple of
situations where it comes up this demo
or this example shows a situation where
you have a generic class and so TV which
is a tight very tight bar for the class
is already bound once you instantiate an
object of type C and then let's say you
wanted to implement a concoction but you
want to be able to take another C object
who might be of a superclass its type
bar might not be bound to the exact same
thing so if we try to do this as written
you'll get a type error at the return
statement because it doesn't know what
to use relation to TV is it has no way
of knowing but to you has to be a
superclass of TV for this function so we
use the super keyword to tell the type
checker to you is constrained where it
must be TV or a super type of TV once
you had that then type your error goes
away
class name and consistent construct
there are some situations where
you have a class name as a string stored
in a variable and then you want to write
new dollar variable name normally you
can't do this in hack because there's no
idea what class that your string
variable might be referring to so that's
where consistent construct and class
name come in class name it's a special
kind of string value and the type
variable tells hack that this refers to
a class that is a subtype of T
consistent construct is needed to let
hack know that all subclasses of class C
have the same constructor signature
because by default subclasses are
allowed to have different constructor
signatures finally the pipe operator got
recently added a lot of excitement
around this one so it basically that
chaining style you saw of collections
that was so palpable they've had been
nice left to right you know you can read
it from left to right and understand
what it's doing
pipe operators let you do that with
arrays and a number of other things so
there's a dollar these double dollar
science is where things get substituted
in running a little low on time so of
course I won't be able to dig into it
but it's basically syntactic sugar for
the statement below which as you can see
is a lot harder to read left to right
and follow what it's doing there's also
some new tools and api's have been
released since hacked open source in
2014 was a hack source format or which
will take any hacked file and do all the
indentation for you there's a hack to
PHP converter for those who want to try
hack but I still want their application
to be able to run a Manila PHP the hex
PHP converter will strip various hack
features out so that your program can
run on vanilla PHP it doesn't work for
all hack features so last I checked this
didn't work if you used async functions
but it works for a lot of the other
features and finally to close just a few
thoughts on the impact the day teach a
man hack has had on a broader PHP
community so competition
good thing I think HHMM has demonstrated
that a significant portion of future
users care about runtime performance
they care about reducing their data
center cost so they care about their
application being snappy and hack for
its part I think demonstrated the
importance of type safety for larger
more mature code bases so the impact
that it's actually had you know hmm you
know some of the largest websites in the
world now run on it and they're snappier
and Morris classes because of it a JVM
was almost certainly one of the main
reasons that PC 7 development focused on
improving performance and another
interesting kind of side effect or
feature of hims existence was that I had
drove the creation of a formal language
specification the PHP language speech D
language for the first 20 years of its
life had no formal specification and
once there was a real solid alternate
implementation of GHP that kind of drove
it made necessary writing a formal
specification so that everyone can agree
on what PHP really is down to the
nitty-gritty details and finally tax
language features have noticeably
influenced new futures in stock PHP so
these four features listed here we're
all part of hack or H HTM before hack
existed and they are now part of stock
PHP mostly generators and type
annotation related stuff and I think the
Swift pace finally I think the Swift
pace of tax evolution helps motivate the
PHP community to improve the mainstream
PHP language I think it helps people
come to consensus when they had
different viewpoints a great example
scalar type annotations it was something
that the community had really debated
for years and because they couldn't come
to agreement you know they never got
ahead and even though people in the
community had been trying to add them
since as early as 2009 I think and I
think actions distance helps unify
various folks in the
come to agreement on some of the new
language features that have been
contested for so long or the newly
proposed language features the bank
tested for so long so with that we
resend the talks I'd like to thank you
for listening I'm happy to answer any
questions you may have
I'd also like to take this moment to
thank the entire each HTM and HACC team
past and present for making this
possible and also Facebook engineering
for believing in the PJM enact projects
for allowing them to be open source and
for supporting them so well in open
source and really helping other
companies make use of them so thank you
very much all right thank you dude now
is the time for Q&amp;amp;A if you have any
question you can ask them on the comment
section below so the first question is
how easy to migrate PHP to hack and how
to do it um yes so there's actually a
tool called the hack of Decatur which
will help you which will help you take
PHP code discover where you can add type
annotations basically you can take them
incrementally so your stock PHP
application as is will run on HACC and
then typically you add question mark h/h
to the top of files and you start adding
type annotations and then fixing the
errors that the type checker complains
about so yeah that's how I say you get
started is you know check out the heck
the hack of the cater tool that will
help to tell you where you can add type
annotations try incremental E&amp;amp;N question
mark HH at the top of your files and
then running the hack type checker by
typing eth others for clients and then
fixing the issues and the hack type
checker is really designed to be
incremental so it's not something you
have to do all at one suite it's made so
that you can do it you know a file at a
time or a function of the time as
desired right
I guess that's all the questions that we
have I'm sorry
oh this organ is also recorded so if you
want to come back and watch it again and
review it you can do so by opening the
same youtube link for further question
you can tweet them and mention jus at
your press key thank you again you drew
for during this webinar through my app
and have a good day everyone</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>