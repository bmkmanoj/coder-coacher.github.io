<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>[Android NDK Support] by Xavier Hallade | Coder Coacher - Coaching Coders</title><meta content="[Android NDK Support] by Xavier Hallade - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/BeMyApp/">BeMyApp</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>[Android NDK Support] by Xavier Hallade</b></h2><h5 class="post__date">2015-07-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Gd-zwNTzJ4M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">should mean that I'm
what I'm doing but yeah it's up to you
to decide if it's okay for you can
follow me on Google+ on Twitter too and
I've got to blog I try to pass
interesting and technical stuff so yeah
you can go ahead but first who is
targeting Android bathrooms in room when
developing games of course I mean not
with guns okay cut so many so as already
some experience will be Android NDK
native development kit okay I was
expecting a little bit more people for
offered get the reports audience okay
thanks it changes everything I wasn't
yeah my number was like wonder yeah one
people and perfect thanks so I maybe
talk more about what is V NDK because
she not many of you already know so yeah
I've chosen a broad title so i could
adjust the content a lot c and c++ rod
rain depth so i'll talk about the
android ndk which is the thing you used
to do some sense plus plus for android
applications auto covered with gni so at
the java native interface these are all
the concept that also mix c and c++ with
java and that way java is the main
language when developing android apps
i'll talk about android studio and
results of the belt system C and C++
reports especially because there have
been many news since a week from now
with no religious but our experimental
full of bugs that's a lot of fun and I
mention over IDs to you can use to
develop in c and c++ for android and in
the end if you've got some time joining
so first for the NDK so indicates the
official component from google you just
don't know it inside it you get two
Chainz platforms compilers but allows
you to cross compile C and C++ sources
into shadow object libraries you can
later use inside Android applications so
it allows you to compile C and C++ and
use it in Android applications and
that's your future component from google
so it's really useful for people want to
create one big OpenGL ES code base and
share it across platforms for example
iOS and Android because opengl es is
almost the same on this so to share a
maximal code so with in that case you
can directly use the NDK and you've got
samples to just write your OpenGL ES
code and get it working on all the
platforms so the way it works so I
mentioned you compiled since processor
sources extra but to add this in
vailable in android applications you
need to understand what is Jen I so the
Java native interface because all the
android framework all the android
applications are relying on java so we
are executed by the Android runtime that
is meant to execute java bytecode and so
on so everything you integrate with on
Android it's not in native low level
stuff usually it's a Java world and to
talk to a Java what you need to
understand the jni so Jenna isn't
something new introduced with Android
but something holds introduced with Java
and many people already used it on
server stuff for a long time so on
Android how it works and in fact it's
quite a lot too and respond so on the
Java side you call system that load
library and you'll use this method to
load a dirty so five so shut up like
library that contains your binaries that
you are compiled from your C C++ in
assembly and then on your driver side
till you get in a chief keyword so you
put this native keyword in front of any
method and that means that this method
will be implemented in a dirty souf I
you've been loaded with log library so
on the CC plus side you get the day
night of each header that allows you to
implement everything you told Java it
was going to be native in your sins
fruit resources so we have access to
java primitive types like Jane's J long
and so on java objects j objects j
strings and so on because you talk to
java you need to handle java objects
annual access to Jane I and
tell auntie em so these are both objects
that allows you to talk to the Java
Virtual Machine and the Java environment
where is so all these concepts are
especially important if you are looking
for a simple a low world where you have
an Android application written in Java
and inside your Java you load the
library and you have seen splits versus
implementations because that's a usual
way to do things on Android applications
so usually you don't have just one
android application written only in C
and C++ you always need to have some
parts of Java some these parts of Java
can still be written in C and C++ but
the magic of gni you can write Java in C
and C++ but ugly as hell but you need it
you can even create a new activity which
our main views on Android all from C and
C++ and you don't want to reach that
level of ugliness so you already have a
native activities of each header that is
part of the Nek and you can use it in
your abs that's part of a framework and
that allows you to instantiate all the
Android views and OpenGL ES context and
you terrific gets actually to fred's
main thread from messaging and render
fred and you get going with your OpenGL
ES code you can integrate with it so
that's the specific case that allows you
to create an Android application with
almost no java at actually actually note
that are written from you so when you
load the library and you want to map
implementations to the java metal tab in
the cloud native you need to implement
these methods using a specific naming
and you need to read some java objects
and get java objects so the convention
when using jenna is this one so you need
to return Java primitive objects and you
get at least two variables so the first
one is always with Jenna environment and
then it's a j-class if it's a static
method or J object if it's just
method and for the second variable you
get the instance of the objects or name
of a class the name but the actual class
and then everything can be automatically
mapped if as a function name you use
this ugly SL again it's jen i name so
starting with java followed by packaged
in a package name when the activity the
name of the activity sorry and then the
name of a method if you want to do
something cleaner you can manually call
register natives on this chennai and
you'll get on all the methods you
implement for 4g ni so using rajasthan
natives you can use whatever name you
want and you just give a function
pointers that's cleaner so I mentioned
Jen I types like 10 times here we are
everything you know it's from j objects
and you can have a rise of these
primitives and who pinches are fair
because yeah travis first platform and
you need the same size for all the
elements you deal with Fonterra but on
Android you can have android devices
running on ARM architecture x86
architectures and sometimes a size are
not necessarily the same if you just
take plane c types which is yeah it's a
trap but you get all the generated
voltage type so you need to use these
when you written anything to check our
work as you can get mini surprises but
types of surprises actually so when you
want to have a really a cross-platform
code base and also to take into
consideration but on Android what get is
not the standard gene you see library so
it's the bionics villeroy it's because
everyone likes to rewrite see libraries
all the time because yeah everything
that has been done for 30 years it's not
as good as it is it could be so I ruin
everyone's we're doing it Google
included so where is Bionic it's lighter
than C library that's a good thing is it
has been meant for embedded world make
sense here on
phones and tablets but yeah it's not
binary compatible with C library some
things are missing I'm not sure you can
even close Fred's yet you don't have all
the shared memory segments you would
find on other platforms but you have
access to space you can read stuff that
means that in general everything every
code you have you should at least
recompile it and ya see what happens
first and then fix it but you can't link
usual Linux library are on Android and
that's a roofing static inside like a
specific case no an infant will c plus
plus y by default there is nothing but
the good thing is by default inside the
Nek you can choose which superstorm time
you want to use inside Europe and that
we provide more so by default the system
c++ runtime provides objects and no str
no exceptions not basically nothing on
the object but if you want to achieve it
more things you just choose a number one
time so all these runtimes used in here
you could ask why five of them the
different licenses so some of these are
lgpl some of these aren't need to check
with a lawyer not with me as usual and
they provide different support so some
of them provide more stl stuff for
example remember c++ and genius here are
the one that provides the most of C++ of
11 and a standard template library he
always provided a bit less sometimes you
have to choose if you want to use a CD
chrono or everyone's use a CD Fred it's
not always available on all the I
swear sometimes when you want to choose
a different cluster front time you do it
using a Samba Android make files I'll
put more about this for was it on Nova
ndk but in application 10k you said the
application white variables and
our best year you choose your zippers at
one time each of these photos from times
can be used as a shared or static
library so we shared it's the separate
the iso file and static it's all
compiled into the same to testify again
check with a lawyer and if you're using
a session and I'll to tell you still
need to explicitly say inside your app
Android a 10k that you're going to use
these features one when you have got
this office inside an Android
application so classic execution flow is
you consistent at library usually in the
static block of a class so he closed the
doors of file and then later when your
java encounter some methods that has
been leaked out as native the Android
runtime will directly execute the native
implementation for business odds there
is no new Fred or whatsoever everything
is our and you don't go outside of any
sandbox everything is executed in the
same context of the Android runtime by
recalling fret and once the native
implementation has been executed it goes
back to to the Java so it's really
seamless but that means is that if you
want to do some heavy processing on the
CNC plus west side you should in some
shape some threats as usual you can
create threads from both Java or C and
C++ these are the same kind of fret if
you create a fried function stress press
you still need to attach it to the JVM
else life cycle of a thread can go mad
can go wrong sir so now about Android
studio so the NDK has not already been
properly supported by google I'd say you
should take an example so the usual ID
for android for so long time was eclipse
and then two years ago by released
android studio in alpha i'm not sure and
they fight stuff to support eclipse and
atlas google i/o end of May they simply
made
one switch to android studio but big
difference at this time between Android
studio and eclipse is eclipse was
perfectly supporting that new phrase
eclipse was supporting C and C++ code
editing and the NDK and then at this
time and residue wasn't at all I yeah
where is the same spot as notepad
support c and c++ editing so kind of
soup or chicken gets and they say yeah
any case report was going to enrage to
do one not three and so I've been
waiting for you one for you to put you
free you they say it's what's coming so
let's fry their finally we got it in the
OC one you need to use everything is
experimental this is very buggy that's
the demo looks if you can actually see
it yeah I don't have time to launch and
rescue myself but you can write any
wafer declare is as native in your java
on your driver side and then go to
completion and magics up and residuals
you to just alt enter and it would
create the right function name and
everything in you see file and then you
just press that it will compare the
Doty's of us put them in the APK and it
works so which is quite a big change if
you compare it with what you had to do
before and there is a very little
country you can do very little
configuration to change it so everything
goes inside the belt or grotto where you
define the NDK module and you give them
with your name and that's enough but
yeah in real life you usually want to do
a little bit more like Chan defining
some variables for for a compiler some
see flags and so on this you can still
do what is still missing and the still
into you to make files for wrist work is
if you want to rely on precompiled
library if you get a free complete
version of opencv somewhere or anything
it doesn't really work you're getting
anniversary
so they are walking on it because
everything is experimental every made
you change and so on and we're waiting
for it but while it's not there but
doesn't mean you can't use Android
studio and the full C and C++ editing
supports that just means you need to pay
attention to what you're doing and maybe
some time do some hockey stuff so let me
go for B hockey stuff later I already
mentioned all of this or you don't even
slides and is a good thing so if you
want to go further and further than just
some C and C++ sources inside an Android
projects and everything works you need
to still rely on necklines so and use
the usual way to use the NDK that means
you call the main screen of the NDK
called NDK built but the script that is
reponsible for compiling on your sources
to DOTA suffice so when you do so it
will compile your doses of files inside
the libs folder and of course android
studio we look for his inside gen-i libs
folder which is not the same so you need
to a speech to specifically tell Android
studio but you want him to look into the
libs folder and your notice of us will
be embedded and that's a solution if you
don't even declare and picture nek
module inside your paddle paddle so
because if you do declare and raised in
a key module and rizzuto we try to
compile your sources but it will not
work because you're relying on something
else and you want to make health and so
on so don't do it but if you want the
full C and C++ code eating spots inside
Android studio with your overhead doors
or your over precompiled lips you can
see free to Android NDK block with
everything as if you want it android
studio to compile village himself but
you just / to Demi genitals Ross SRC do
so like this block but instead of gin I
lips it's jen i and you give him a just
direct or even exist and i know it's a
bit hacky but this way you are always
in specificity kingship rod with a
proper headers that are reference and
you still compile using your own neck
fights so yeah some people generate know
about the NDK so I should have put these
slides earlier actually but are on the
Nek project so you put all your sins g+
resources under a folder named jni a
brute of the android project and then
you call any cable at the root of your
android project and it generates with
all these four five so it does it by
looking first at your mag files about to
make files android the 10k and an
application mkay inside n with the 10k
you define your any key modules so this
is the shortest android the 10k you can
have so the first line is mandatory i
need to the curb your local buff when
you clear your variables that's a macro
from the NDK then you define the name of
a module so local module and codify
hello ji then you give your sources and
then we include the micro bad terms we
indicate to build your dirty sulfide its
build shared library we get some of our
options for micros if you do want to
create a precompiler brary or if you
want create an executable but that's not
required for games and you don't sign me
to use this then you get over variables
if you have rightly dependencies between
modules you can declare where includes
and what's the name of library of the
dependencies sorry application 10k is
not that my Nona's make fun but it's
really important because that's here
that you define the application white
variables the two most important ones
are up platform but defense against
which NDK platforms you're compiling
your sources against and remember you
need this number so to be exactly the
same or lower than your applications min
SDK version because all the indicated
phones they are for what compatible so
you can compile for KitKat to work for a
lollipop but that's not true for the
other way around so if you compiled for
lollipop it would crush or KitKat so and
you don't really want that and then the
app ABI variable is
where you declare all the CPU
architectures you're supporting so by
default i recommend to set it to all and
it will compile for all the seven
different IP is spotted by the end
region k if you're supporting only 32
bits you can put of 32 or you can even
list of CPU architectures one by one
that was a quick overview for android
studio forgot to mention of course
novice report is really good in a switch
to do because they waited sea lion from
JetBrains inside android studio so of
course you get refactoring syntax
acceleration but you also get full debug
support with gdb or even other DBS back
end so it's working very well now that
you may also be interesting over ideas
so you can still use the good old
eclipse it will got used to it brightest
you can still have the Android tools you
can see compound with appliques with it
the NDK support isn't that great in my
view because you always need to
configure everything twice so once for
Eclipse to understand where are your
headers answer and so on and once food
your make files to make the NDK
understand where your headers and so on
it's not always reliable and I quite
hate it actually but yeah that's up to
you you can also use any version almost
in version of visual studio with some
plugins like vs android wear it is also
android walks from nvidia which package
is everything and makes you able to get
your projects running from a visual
studio and now also like in three days
from now you can use visual 30 2015 but
just provides android application
templates like the native activity and
you can even up and it's working well it
integrates all the tools directly there
is no plugin footwell they even provide
an emulator based on I pervy that should
work well
and they provide templates to so you can
have a template that shows you all share
open here yes code across Android and
iOS yeah micro starts doing that maybe
an expected but quite cool so we are a
review of time play it's so dark you
from fiji OCT 2015 into town place you
get cross press on Tom planes that
allows you to i get android and iOS
wondering where is windows phone
actually that least yeah anyway that's
quite well maybe haney different project
i'm sure you can still share code but
that's weird not have one project for
all of these yeah maybe first because
it's not a biggie Elias so yeah it's the
usual visual studio I'm sure he'll know
this one over here is with the Android
native activity project and yeah
everything's Aaron works and when you
install visual studio you can ask him to
sort of the cross-platform bits as it
will not work if you don't want to
install the NDK twice and you already
have it installed somewhere you just set
it in the NDK wood and barrel enviable
it needs to bind to a 32-bit version
where is one thing to note because on
Android nothing is always that simple by
default let me go back to view overview
when you use visual studio you always
have only one target so this target can
be x86 this target can be armed if you'd
see sharp you have any cpu for example
but here we are not doing C sharp so
it's x86 or are the thing is by default
if you compile for one architecture or
an over it will give you an apk for one
architecture on over but why when you go
to the Play Store and you hopeful one of
these APK it would be the only one on
the store because by default video
doesn't care about version codes or
anything you that are needed when
publishing apks with different
architectures on the store let me go
back to screenshot that I why did before
you can upload multiple apks from anti /
architectures on the store like this
crib sets you just switch one dance mode
and upload all the apks you want but
visa APK is need to have a different
version code and of course the front
native code inside and the bit that
visual studio is missing is the version
code speed so you always need to give ir
version code from your apks but you
always also need to give a higher
version code for x86 versions of apks
because all the Android activity
ecstatic devices are able to run arm
anak HCG n x86 apks and the store will
only give one with the higher version
code anyway but just means you need to
do to copy bus XML of shown this one so
it will prefix your Russian code with
just a one digit and it will fix all the
thing and then you can publish all your
IP case to the store</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>