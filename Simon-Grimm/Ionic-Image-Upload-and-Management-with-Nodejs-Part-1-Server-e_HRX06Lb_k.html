<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ionic Image Upload and Management with Node.js - Part 1: Server | Coder Coacher - Coaching Coders</title><meta content="Ionic Image Upload and Management with Node.js - Part 1: Server - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Simon-Grimm/">Simon Grimm</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ionic Image Upload and Management with Node.js - Part 1: Server</b></h2><h5 class="post__date">2017-10-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/e_HRX06Lb_k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everyone what's up this assignment from
their tactic and the ioniq Academy this
is the first part of a two-part series
and this series is all about uploading
images with ionic but we will also take
care of the server side so we will
develop simple nodejs server within this
first video and in the second video we
will then develop the ionic app so I've
started already don't fear to create
your own node.js server it's actually
pretty easy and we will go through the
basic steps so of course make sure no J
is installed on your machine and then go
ahead and simply create a new folder
with a few files so the first and most
important file is the package.json so
this file actually describes all the
packages that are needed inside our
application
so we use Express for the server some
course plugin for course issues to
delete files a plugin to better access
the filesystem plug-in to upload your
handling multi-part form data and a path
for resolving a local pet and finally we
will also use Mongoose which is an open
data is mapper or object database mapper
for MongoDB so you need to make sure
that you have MongoDB installed on your
machine and for me on a Mac after
installing MongoDB it's simply running
this command
or this one actually mangoat and this
will start the MongoDB on my meg I guess
on Windows it should be pretty much the
same anyway just make sure you have a
MongoDB on your computer or even on a
remote server if you want to use a
remote MongoDB let's take a look
we also get this pre start script which
will compile our typescript files I try
to write this server with typescript so
you see it on the endings of my files
therefore this will you run the
typescript compiler and inside our TS
country we then have the compiler
options which tells the compiler to put
all of this into a dist folder and once
we run NPM start this will run note on
the dist folder and the generated server
file so that's all for the general stuff
I think you can find all of this as well
inside the according to Toria next to
this files we need three more we need em
HTS routes TS and serve a TS and we
start with this one first of all we need
some imports and the syntax is a bit
different then you would expected with
without typescript so now it looks more
like this and also of course we should
run npm install to install all the files
from our package jason
then we got a motor for the file upload
we need course for our ionic app and
course issues and finally we need to
establish a connection to the MongoDB
using Mongoose so import all of this
then two things we should export here
because we need the name different files
later on first one hit the upload tab so
let's say we want to upload the files to
a folder called uploads and part of our
application you could also have this in
the environment however you like it make
sure to create the folder of your upload
paths manually because we will use the
plug-in in a way where this folder is
not automatically created so we know use
motor that disk storage so we want to
store our files directly on the disk of
the server and now we can use two
functions first one is destination which
tells where this file should go so
request file and call back and call back
now and our upload path so this will
upload the file to this path and also we
want to change the file name on the fly
so let's copy this and the callback is
now and file dot field name which is the
name of the file plus let's say we just
append the date so this makes the files
more or less unique and some sort of way
you could also use a UUID or make it
even more safe however
this is not about security this video so
then we export this as upload and create
the multi passing in the storage option
we defined above
so this is our upload plug-in now we
need to create our actual app using
Express and tell our app to use the
course plug-in so we don't run into any
course issues to load our routes later
we can actually require this as well so
this will be from root I guess
alright so this file will contain our
API routes image ts is the next one we
will take a look at which is the
database model but two more things right
here first of all we need a connection
to the MongoDB so if you have it local
it should be
MongoDB TB localhost and then whatever
you like to call it I would call it
image upload if it's not existing yet it
will be created so just pick whatever
you like then we connect to the database
and at this point you will get an error
if something goes wrong of course this
should be Mongoose and then on arrow we
will lock it out so you will see this
once you start the server and then you
can act and do whatever it is told
otherwise we will lock out connected to
MongoDB alright so then we're connected
to our database and finally we start the
server by calling listen we pepped in
the port we have defined
and then we got the function actually we
could use arrow syntax here as well like
this okay and then we lock out whenever
listening on port yeah and that's it
okay so let's give it a try
we run NPM start the typescript compiles
our stuff to the dist folder we get
connected to MongoDB and listening on
part three thousand so everything is
fine I don't care about the deprecation
warning for now so this one is ready
let's heat over to our actual database
model it's we import Mongoose again from
Mongoose and now what typescript it's a
bit different normally we would just
create a database scheme which would
look like this new Mongoose completion
whatever a new scheme and then we got
the properties like file name original
name a description we might want to
store and finally create a date of the
type date and the default value will be
data now so on creation this will be a
set this would be enough with our
typescript with typescript
we need an interface as well
call it image model and this one extends
no Mouse event but Mongoose document and
now we have the same stuff again but
then we can use this interface if we
like to but I actually think I haven't
used it that much so learning from this
tutorial might be yes you can use tight
grip on the server side it might be good
at some point with some auto-completion
in the server file which is pretty cool
but sometimes it's a bit more tricky in
some areas and you might not find that
many tutorials by now perhaps you from
the future and there are already some
tutorials so in that case just go ahead
and use typescript perhaps I will stick
with typescript in the next time I'm not
yet decided on this Bret you have an
opinion on this feel free to share
anything below the video so we're
finished with our database object once
we store an object in the database it
will has have this field file name
original name description and created
the last line is just to export it make
it a database scheme and model and all
this stuff so we can access it later and
Mongoose knows about this so all of this
was some pre-work for our actual tasks
to upload and create a simple API so now
we get to these things we load the app
and upload from our server file and we
load image from oh I just created file
yes like this
and then we need a few more things so we
need the pair plug in we need the file
system and finally the delete locking
right
what's wrong with pass yes course from
okay now let's create a few routes so we
want to have a post route to actually
upload an image this will be a post to
images then we will have a get request
to images which will return a list of
images we will have another get request
to images slash image ID which will
stream back one image and finally we got
the delete command to image slash ID
which will delete or remove one image
from the server and database so these
are the four routes we're going to
implement perhaps let's start with the
posts so we can actually create some
stuff we use Malta we already have set
up everything and now we use it here as
middleware for our request so before our
code is actually executed request next
before our code here inside executed
this middle way our run and it will
check the request for a data field with
a file and the file key should be image
we will see this later
inside the tutorial for the front-end
that we need this key of course this
could be whatever we like but now
which makes totally sense here so this
means once we get here the actual file
is already uploaded okay so we don't
have to handle anything else here but we
want to store a reference to this
uploaded image inside our MongoDB so we
can later fetch all the images
therefore we create a new image object
and set the properties the uploaded file
will be in request file once we get to
this block so this comes from altar and
then we can use it to set the original
name which no name and finally the
description yeah of course no camel keys
here and finally the description is a
custom field we want to append so we
will send this field with a body of the
request and that's where we get the
field once you get this object
configured you can simply call save on
the object and if there are some error
we can return it perhaps with the 400
also maybe 500 whatever
otherwise we have created something so
201 and we send back the new object I
think we can also say Jason and the new
image okay so this is the first route
the file will be uploaded we don't have
to take care of this we just get the
object inside the request we can use it
to create our own database object save
it and then send it back to the user
let's have some fun
with all the other requests lazy today
perhaps okay
perhaps I'm always a bit lazy if you've
seen more of my videos to get a list of
all images we use our database model and
call find on it without any parameters
the only thing we might want to change
is remove the version key so this
removes one field from the request we
could also remove the description if we
don't want it but I don't think we are
interested in the boys on key here but
we shouldn't disable it globally then I
use Li which will give us not a database
object back but a plain JavaScript
object you will see why in a second so
this means we get an array of images at
this point what's wrong I think nothing
is wrong okay so again if there's an
error just handle it somehow and now it
gets a bit tricky so let's start with
this then image is the length plus plus
so we will iterate through the results
of our database call and here's why each
image has name original name description
created but it has no URL to the actual
image and we want to pass back a URL to
our ionic app so the ionic app can then
simply use this JSON response for an
image source attribute so that's why we
change a tiny part of our response
so we get the object and then we
manually add another property called URL
and we get this by using the protocol of
the request
plus some slashes plus request get host
and then the actual pass to our next
function which will be used to stream
back an image so use slash images slash
image ID and the image ID is this
so underscore ID is always with MongoDB
the automatically created ID okay I hope
this is clear so far if you have any
questions please leave a comment below
once we get to the response or perhaps
we can open it already
this will make totally sense to you okay
so I'm using postman I hope you can see
most of this and I think I've already
uploaded some images yeah so this will
give us back an array of the uploaded
images and as you can see we got the ad
a description original file and created
and the URL which looks then just like
this so a passed to our API this will
not work yet because we haven't
implemented it but in the end this makes
life a lot easier for our ionic app so
let's finish with the next two ones so
to get one image we use first of all the
image ID which was passed in the parents
of our call and then we call find by ID
on our
object use the ID and then we hopefully
get an image back again if we encounter
any error send back some things so we
can react and then we need to make two
things so the first is to set the header
of our request of another result of
course to content type perhaps image
JPEG so we don't expect any movies here
in that case you might need a different
content type or just files we just
expect images so we set the header to
image and then we call create read
stream which returns a new read stream
and the input needs to be the path to
our file so that's why we use path to
join the path of our upload path come on
top loader pet and finally be image dot
file name so in the end this will be
like whatever uploads slash the file
name JPEG and finally we need to type
the result to return it to the user so
this will give us an image back before
we try it try it
let's finish again we use the ID
this time we use fine by ID and remove
image ID error and image
and again super solid arrow handling
don't hate me for this I'm sure you can
do it better I think we need the path
again just like this so an array of
things we want to delete in our case
just one entry and once this is
hopefully deleted we can go ahead and
send the status of what's deleted is a
200 I'm actually not completely sure
what it is I will leave it like this for
now so let's start it again
okay let's try to remove all of these
images for now perhaps this works mmm
because it's in a different folder when
I tried this so let's remove all of them
to clean it up and the last one all
right our images array is empty so let's
upload a new image we make a post
request two images we use form data the
image is a file I would just use picture
of some holidays the description is why
whatever a big description we send it
and we get back the object which was
just now created once we go to images
back we see that now the array has one
object and a URL to this image without
any jpg or something like this but
anyway we can use it we can send it and
we cannot get it I think this should be
images right yes so let me see there it
is
this should be images
so the path we've manually created was
not correct now the path should be right
and if we send it we get back the image
again we can use this with the delete
request to images it is a que accepted
and then the array is empty again okay
so now we have a functional back-end
which is connected to a MongoDB which
has four API routes we can upload an
image through a post request along with
some information you might want to
provide we can get a list of all the
uploaded files because we have stored
the information previously inside our
database to get one image we have a
route which will resolve the route by
its ID to a file which is redirected to
the user and finally we can also delete
a file from the file system oh and
finally let me upload it once again you
see in the upload folder there's the
file with the timestamp created and
stored right inside that folder
ok so perhaps when you see this the
second video is already published
otherwise you will have to wait
maximum of two weeks I guess until the
next part will be released meanwhile you
can build out your server or already try
to build your own ionic front-end but I
hope to see you within the second part
again of this video and if you enjoyed
this video also make sure to subscribe
to my channel for more ionic videos or
even server videos like this there will
be more in the future so check this out
stay subscribed and have a great day
good bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>