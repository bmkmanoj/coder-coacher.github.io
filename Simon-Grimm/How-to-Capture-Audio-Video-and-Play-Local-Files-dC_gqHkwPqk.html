<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to Capture Audio &amp; Video and Play Local Files | Coder Coacher - Coaching Coders</title><meta content="How to Capture Audio &amp; Video and Play Local Files - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Simon-Grimm/">Simon Grimm</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to Capture Audio &amp; Video and Play Local Files</b></h2><h5 class="post__date">2018-01-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dC_gqHkwPqk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone what's up this assignment
from the ionic academy back with a new
quick win on how to capture audio and
video files inside your ionic app and
also how to store and then play those
local files within your app so I've
started a blank new ionic app and the
first thing we need to do is install a
few NPM packages and Cordova plugins so
let me fill in these while I talk about
them so we need the media capture
plug-in which will help to record audio
and video material and we need sorry
ionic native media which we need to play
our audio files and then we need ionic
native file so the general file plug-in
to move some assets around and together
the right URLs so playing those local
video files is a bit tricky and
therefore it took me quite a while to
come up with a solution but I think what
I got is quite nice
so make sure to import all the three of
them right here inside your app module
and also we need the ionic storage
module because we will save the files or
not the files but the reference to the
files within the native ionic storage
module so make sure to add the ionic
storage module for route to your import
and media capture media and file go to
the array of providers so now our app is
setup but you might already know this
we're using a few Cordova plugins so we
can't run this app on the browser or we
can but it won't work so we need to
deploy this to our devices
and to deploy this to iOS we need to add
a little change to the config.xml so go
to the bottom and insert something like
this at some space okay so we need to
define keys for the P list for the Xcode
project and s camera usage and
microphone usage so these descriptions
will end up in our info.plist they will
be merged in so our app will run and
will display this message once we try to
access camera or the phone all right so
that's all for the configuration and
let's head over to home HTML and TS for
the actual code so from this side it's
not really much we have to do right here
at first let's start by adding a few
buttons with an eye on row perhaps but
eye on button perhaps full button and on
click we will call capture audio which
will start the audio capturing process
so the same for the second button but
now capped video and capture video okay
those are the buttons for the functions
and then we will also add a little list
where we display the files that we got
inside the ionic storage so we will
iterate over our media files the item
should be typical because it's not a
button but just an item and we want to
be able to play with the file and also
sometimes the name is a bit alone so
edtech strap right here
and we will just use filename which is
the original name of the file and also
file that size and let's convert it to
megabyte and use the number pipe to
format it and perhaps it megabyte
finally the audio plane works quite nice
but for the video the current code of a
plugin for the video players not really
working so I picked the html5 video
controls and a little workaround to get
this working is adding the ID and
grabbing it from our TS file by using
add view child notation so my video will
be my video of the type any and of
course we need to import view child so
now we can access this and later fill in
the actual video source for that video
additionally we might define a key which
we can use in multiple places to access
the storage let's say this is media
files and then we need a few imports we
need media capture which is media
capture from my owning native we need
the storage which comes from nope not
that come on
okay now auto import so let's fix this
right ionic storage then we got media
which should have an auto import yes
nope not really media from Ed ionic
native media where is it
okay and this is of course storage so
add media from an ink native media and
this is storage and finally I think we
needed the file so auto import file and
that's it all right
so within the ion view did load we will
try to get the saved information from
the storage so we call get with our
media files key media files key and then
we will perhaps get a result in the
beginning this also might be now so
let's have a new array media files right
here and set this to the result but we
will save it as a string so we need to
parse this back using json.parse on the
result or if the result is now we want
to set it to an empty array so this is
the quick syntax for this switch now we
implemented the functions where is it
capture audio and also capture video
alright then we had the play file or
just call it play with a file and
finally we need a way to store media
files so these are the functions we need
to fill out so let's start with capture
audio this is the most easiest of those
so use media capture and then we see the
options so we could also capture an
image but we use audio and video which
is a bit more interesting I think
so we get a result back and we will
simply use our store media files for
this because we can use it in another
place as well for capture video it's a
bit different so first of all let's also
define some options so we can define
options for those plugins those would be
capture video options but I guess it's
not yet here should be from this package
and now you could say something like
limit so only one video and the maximum
duration perhaps 30 seconds whatever you
like and then you can use the capture
video function and just pass the options
to the function the result will be media
files media file and the result is an
array of those files no it's the other
way around of course and perhaps like
this so in this case here it's also the
same we just added a few more types so
what we get here will be an array
although we will only have one file here
anyway it's an array perhaps
we start with a store because this is a
bit easier to store the files we just
get the current media files we just
start and with the result we can check
if they're already stored and if not we
can simply set the media files media
files key to the new files but as I said
before we want to string
by our array so use json.stringify on
the files if we already get an array we
need first of all the actual array from
the information so parse it back to an
array and then simply use concat on that
array with our new files so they will be
appended and then we can use this
function just like before but with a new
array which contains both the old
information and the new information
finally after all this we should add the
new files to our our current media files
so use a concrete here as well with the
new files and then we're good now back
to the capture video so you might think
everything would work now but in the
play block we have to distinguish of
course between the file name and if the
file is a audio file of video file so I
will just make it super easy if else so
if it's an audio file it's pretty easy
to play the audio file so we can create
a new media object I think this comes
from the media package yeah and create a
new object by using this dot media
create which opens a media file and then
use my file local URL so we will inspect
those objects with a name and file later
perhaps add a block here so play my file
and then we can use this audio file to
simply call guess what play
but Ellis said for the video it's
different the URLs did not work the
player did not work the XS was denied so
I had to come up with a way and the way
now is that at this point when this is
the video source or perhaps I don't need
this
first of all we grab our my video native
element and then we say we do dot source
is my file that local URL all right so
this will set the URL for our video tech
for my video and hopefully show the
video and play it but before we can use
it like this we need a little
transformation on the URL of our
captured media files so for the capture
video we can remove this for now and
start with the transformation so let's
say we just want to use the first
captured video because we also say it's
a limit of 1 and then we can grab the
file name which is actually directly in
here
perhaps we also add a lock here my file
captured file so we can see the input
then we need to fix the path a bit this
might be a bit tricky so we use the
local you RL and split this up using the
slashes then we pop up the last element
because we don't need it and then we set
them back together so we can simply call
John and we join them with a slash again
so now the from directory is cleaned the
- directory is actually simply off the
file the data directory of our app and
now we can copy the media file into our
app folder and then we can use it to
play within our video tic so as I said
not really clear not super easy but in
the end it finally works so a copy file
and then we need a few parents so the
past is the from directory where the
current file is the file name is of
course the file name when you wanted to
go to directory and again the new file
name can also be the old one so then we
get back something hopefully and now
this URL will be like file with three
slashes and then something and still
this was not working
so again minor change to fix the URL so
it should be right here and we replace
with a little regular expression file
and then come on with nothing so this
should replace the URL and then we can
finally go back and use our stored media
files function remember it expects an
array so we need to put our new element
into that array and we fake the
parameters a bit so name size should be
of the captured file size and local URL
is now the final URL we built together
okay Brett I will add a lock here as
well
so we can see some Morlocks once we play
this but that's it so far and now you
have to run this on your simulator or
preferred device so let's do this and
check out how the app looks like okay
before starting it I actually changed
something because I noticed again
strange behavior so back in our capture
function where we copy the file actually
it's enough once we've copied it to our
directory to store simply the name and
the size which is what we want to
display and in the play file later on
also i forgot about adding this so index
off was not really working so make sure
you got this at this point we create the
past simply by using the current data
directory and the name and then
replacing the stuff and then setting a
URL the reason is this directory might
change so our app directory gets a new
ideas sometimes and we don't want to use
the full path to a file including this
directory name so therefore we simply
get this directory name from Cordova and
only at our sorry file name same
behavior like we had some time ago for
image copying also of course you can
find all this code on the accordion
quick win which is link below this video
on the page of the ionic Academy so now
let's check out what we got here
let's try by adding capture audio so the
app would like to access my microphone
hello this is a test okay
now let's play it okay you can't hear it
because it's connected to my computer
anyway the audio will play on your
device let's also try to capture a video
now it would like to access the camera
so those were the strings we edit
or config.xml and then perhaps oh this
is a crazy effect well that's a record a
bit of it and parse it let's use this
video and now we see the second entry in
our list let's use it and there it is
our video played within the video Tech
right below using the html5 controls of
course you could now add a few more
so let's unlock it and perhaps if I play
the audio yes that's what the audio
recorded so both are working both the
recorded audio file and also the local
video file of our app so this is the end
because we achieve what we wanted we can
capture audio we can capture video for
video I also edit this copy mechanism
that will copy the video file to our app
directory and then we can have this
switch to see if it's an audio file or
video file either use the media object
to play audio or just use the HTML tag
to display a video if you have any
questions just let me know and of course
make sure to check out the ionic academy
comm where this quick win is hosted but
inside the ionic academy you will find a
lot more videos courses and a great
community so check it out and I will see
you inside the next video
have a great day and take care
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>