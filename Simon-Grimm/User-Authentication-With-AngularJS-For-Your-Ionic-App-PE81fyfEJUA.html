<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>User Authentication With AngularJS For Your Ionic App | Coder Coacher - Coaching Coders</title><meta content="User Authentication With AngularJS For Your Ionic App - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Simon-Grimm/">Simon Grimm</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>User Authentication With AngularJS For Your Ionic App</b></h2><h5 class="post__date">2015-04-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PE81fyfEJUA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys what's up this is Simon from
deaf tactic today with a rather long
video tutorial on how to handle user
authentication inside your angularjs or
ionic app so this video will teach you
how to secure your angularjs app or if
you use ionic your mobile app and this
will use totin based authentication we
will protect our routes based on the
authentication statutes and also on the
role of a user and yeah we will also
intercept requests so this tutorial aims
to be a complete guide for you to secure
your app because I see that many many
people seem to need help with login or
authentication because those articles
are the most viewed on my blog so this
will be a complete guide for you so I
will make a rather long tutorial so
watch this video or go to my blog you
can find the link below the video so
let's start we start with a blank ionic
app so go ahead and type ionic start
whatever your projects name is and the
command-line interface will do its work
and additionally we will also oh no not
yet
so we will also install a boa component
we will use laser so type or install
angular - MUX and we save it to our file
so we will come to angular mocks later
when we use it so for now just install
it okay great
so what we need now is okay we got some
lot of things okay so that's our current
project okay so first of all we need to
create some files so in your JavaScript
folder create control SJS and also
create services dot j s and also we need
constants J s okay so those three files
exist make sure to include them inside
your index so go below your app import
and import the other three ones so we
have services
control us and constant and the last
thing we need to include is our angular
mocks which we installed so this should
be inside lip angular mocks angular
mocks jazz okay I hope that's correct
for now and to use angular mocks we also
need to include it inside our dependency
arrays so after ionic also at ng mock
okay perfect so we will build a simple
app with three tabs and the login screen
you can see some pictures on my blog and
for this we will use some template files
so I'm gonna create a new folder inside
just template and I already prepared
those files because it's just well it's
useless to to create them all now but
first of all let's take a look at how
our index file should look so for now
delete everything inside here and add a
controller which will be the parent
control for our complete app so this is
the app controller and inside we will
have IO
enough power and some styling is always
cool and we have ion nap you where all
of our Muse gets rendered in so that's
already our index file to get the app as
fast as possible
running let's go to our controllers and
add some dummy versions of our
controllers so we will have three
controllers versus the app controller
and we will also have lock in control of
our locking screen and we will have some
sort of dashboard so also create a dash
controller now let's take a look at our
views so as I said the first view we
need will be the login so create a file
inside your templates and I'm just gonna
copy this stuff from the other project I
already created so it's a bit faster
okay so this is our look in you it test
just some title it has a content and the
most important part is we have an input
field for our username which is mapped
to our data username and we have an
input field for the password and we have
a button which will unclick call the
login function with our data object so
no magic here okay
next file main HTML okay so our main
file not very special file this file is
just the basic template for our
locked-in views so here we will have our
tabs at the bottom so we will have three
tabs dashboard the public area and the
secret area which have some links and we
will set up the routine very soon and an
fu component where the view gets
rendered inside so looking and main no
real magic for now okay after the main
or after the login the user will come to
the dashboard
so come on so I will create a dashboard
and copy my dashboard so the dashboard
has some more but it's nothing special
so on the top area we will have a button
for the lock code which we'll just call
the logout function of our controller
and inside of our view we yeah we try to
access some variables we set for our
session for example the user name and
then we will have three buttons so those
buttons will show you what will happen
when user performs develop request to a
server an unauthorized request or
invalid request so for now they won't
work is we don't have connected our
controllers and stuff but I think it's
better if we already have the templates
and so so we can focus on the real
authentication part later on okay next
to our dashboard we will now have two
files which is the public view and also
the admin view so those routes or taps
will be protected by our app so only the
users with the role admin can see the
admin panel of you whatever and the
public will be open to everyone
so in those views there's really like
nothing going on it's just a simple view
with a name okay
and the last one okay perfect so one
thing we might already do is set up some
constants as well we will need them
later sometimes and it's good to have
them right now so we don't have to worry
about them so what we want to define is
some earth events
and those will be not authenticated
which is are not and additionally not
authorized
so those events are used for
broadcasting them through our complete
app so when let's say our HTTP
interceptor sees some request is invalid
he will broadcast one of those events
and our app controller which holds our
complete app will recognize this and
perform the action he should upon
receiving such an event
the second constant is the user roles
and for this example we will just have
some admin role and additionally a
public role this is obviously just a
very very simple example and most of the
time your roles will come from a service
so you will have to deal with that but
this is just to show you how you could
actually implement a role based
authentication and the complete
authentication in general ok so we have
set up some dummy controllers we have
set up our constants we don't have set
up our service but we will come to that
later
so for now what we need to get our app
running as fast as possible is a
configuration for our state provider so
open your fjs and let's do that
okay so we will have a lot of states
here so the first one is when the user
enters our app you will be on the login
screen the URL will be just slash login
the template URL will be as we have
added them to template okay I should
rename this to templates because
template is used everywhere most of the
time
I hope this still works ya think so
so our template URL is template log in
HTML excuse me and the connected
controller will be our login controller
okay that's our first state the second
one is the main state which will be an
abstract state so this is the basic
state so I'm going to use the slash for
this as this will be the most viewed
state and I say abstract true and this
will be the template we created for our
tabs so templates main HTML if you don't
remember it the main HTML is the one
with the three tabs so this tutorial is
also example for how to make a tapped
application with ionic ok next state is
a child state of our main stage okay
some states in that sentence but
whatever it's the dashboard state it's
very straightforward
and now we have to render some views
inside this - tab and this will be the
template templates - or dot HTML and
additionally we will have a controller
here which is the - controller so closed
closed okay this is our first stop now
we need three now two more I'm going to
copy this and the next one is the main
public area obviously it's the public
HTML and this one won't have a
controller it's just for dummy or
testing purposes so this will be inside
the public tab and the last one is the
admin tab
and this will also not have a controller
but there's one more thing this state
will hold a data object which says
authorized roles
user roles
admin you might already know why so this
state has the object with an array
inside we have the admin role we could
obviously have some more roles but for
now we just have the admin role so think
about why we might need this we will see
it later the last thing we need to do
here is some fall by routing so in that
case we just go to our dash
okay so for now I'm gonna add the iOS
platform and I hope our app will come up
already
so we don't have any errors here okay so
we might actually have missed one thing
I always miss that as we've already
included our ng mock backends all our
requests are somehow intercepted so we
need an additional run configuration for
the HTTP back-end and you might see it
yeah nothing's working right now I hope
this will change too so we will have to
tell our HTTP back-end that when I get
requests comes and matches our pattern
okay
pattern should be like this then we
should pass through the request so maybe
this already fixes our problem I don't
know maybe not but we will use this
later to create some dummy responses
like 403 or 401 and therefore we now
need to tell it how to handle the
request to our real files okay perfect
so here's our dashboard your routing to
the dashboard tab as I said we have a
logout button we have three buttons to
perform some actions we have a public
area and we have a admin secret area not
very secret at this moment as you can
see so currently we're when the app
starts inside our dashboard
and we can access all those pages so no
security at all right now but our app is
running and that's the first part of
this tutorial so the next part will be
about the authentication and I hope you
get your app right so if not make sure
your app is right because there's some
more code to come and if you don't have
set up everything correct by now you're
gonna have a problem with the next part
so our app is now ready to get some
authentication so let's start with our
authentication service go to our
services jas and we will make a
beautiful our service and this service
will use some dependencies and our user
roles which is our constants file so
first of all we have some things we need
to set up here this will be just the key
for the totin we're gonna save to our
local storage we will have the username
which will be set later on you will have
a variable indicating if our user is
authenticated which he should be not at
the start we will have role so here are
gonna take a string as role you can
obviously also take an array of roles
but for now
this should show what we're gonna do so
first of all let's make our return
statement so you can see what we gonna
return all so we will have a login
function we will have a logout function
we will have the is authorized function
and also the is authenticated function
well this can all already return is
authenticated
so this function does not have to check
anything else so we got the username
which is obviously also a very very
straightforward function and finally our
roll which is also very easy so those
should be our functions those three are
already implemented here so let's start
with the login function
so our login will get the name in the
password of a user and it will return
the promise
so go ahead like this so we might
resolve or reject the promise and inside
we will just make very easy checks so if
the names equal to admin and the
password is equal to 1 or if the names
equal to user and also the passwords
equal to 1 so obviously at this point
your server comes into play where you
check those credentials and return
whatever true or false and the total so
it's very important because most of the
time on rest api's you will receive some
authentication token and we will see how
to use that so if we're not
authenticated obviously we reject our
promise
just just yeah
returning something excuse me so if we
actually are authenticated our server
should return some token and we should
store those user credentials and for
this example I will just make a dummy
token so this should be your server tone
maybe your name or some more of your
credentials are already inside that tote
or its base fee in base64 encoded
obviously we resolved our promise in
that case and well I'm not gonna show
you a server and everything in this
tutorial but I help you if you're
looking for authentication you already
have something like that running and
know what you get from the service so
for now on a successful login we just
started talking so keep that in mind
okay so our token will be saved to the
local storage and that's where we need
our local token keys so you can grab it
all the time without typing your secret
token or whatever and one thing if you
have a checkbox like keep me locked in
or remember me then you would use local
storage and if you have that switch and
the user does not select keep me locked
in or remember me you might want to save
the token to the session storage so it
gets deleted whenever the session is
over but for now we don't have that
checkbox so we just store it to the
local storage additionally after storing
it we will call use credentials with our
token which will obviously use the
information stored in this total okay
that should be a function
because it's an internal function and
also we need the use credentials which
will receive a token and inside use
credentials as we have set our name dot
totin we need to split the toe and the
dot and we want the first part which be
the username so this will set our
username alright at this point we're
already pretty sure that the user has
the rights to come into our member area
so we can set is authenticated equals
true and also we process the choten if
we might need it later on I'm not
completely sure at this point so the
last thing here is if the user names
equal to admin we want to set our role
to user roles dot admin and you might
know next part if the username is equal
to user you will just have the public
role so this is very easy role based
authentication based on the name you
could obviously have some some
information inside your toe which you
can gather here and set the roles
depending on whatever you got from your
server and one of the very most
important things is to set the default
headers for your next request because
the rest api is most of the time we'll
have some authentication based on the
exhaustion
so if we said the default had us all of
our next requests will be signed with
this eggs off totin okay perfect so what
do we need else we need the logout
function which does not very much we
just want to call the destroy user
credentials function and this function
will obviously as the name indicates
destroy our session so we want to set
the oust own to undefined
we will reset the user name we said if
authenticated to false and we want to
set our default header to undefined
undefined and also we want to remove the
item from our local storage so we say
remove item which has this key so this
will destroy our complete session okay
so what do we need else is authorized
okay
and it's authorized okay is there a
problem
I'm not completely sure oh no it's fine
if authorized function will get
authorized roles and based on those
roles check if the user has this role or
if he does not have it so
if it's not an array we want to make it
an array just in case so this already
for using multiple roles or whatever and
we return if the user is authenticated
and also a authorized roles index
our own role is inside those roles
so if our role is inside those roles we
will be granted access so that's
everything for this okay the other three
functions are already implemented so
there's just one more thing we need to
do whenever our service gets initiated
we want to check if we already have some
user credentials stored so we recognize
the user and can automatically lock him
in so this function will be called
before anything else here so this should
be the last thing we need to implement
so let's make another function load user
credentials and this function will
obviously look for our tote
at position local Toki or for that key
and if this totem does exist we call use
credentials with our totem
so we have already implemented this so
this will authenticate the user and set
the header and so on
ok cerium I think the totem might be
expired at this point or if we load the
credentials yeah you could obviously
make a check to your server totem still
valid but we also have some logic for
this so what we going to do is we make
an auth interceptor which will intercept
all our HTTP calls ok so if you might
use in Delhi totin at this point when a
user makes a request to the server to
get some data this would be the latest
point where you recognize all the tokens
invalid so you actually don't have to
check it up there
okay so this will be our interceptor and
we also apply it all ready to our app in
the run configuration time so we say HTP
provider dot interceptors push our earth
interceptor okay so this will inject our
earth interceptor and inside we will
return a function based on the response
error code yeah something wrong yes
obviously should be close at that point
okay so this is a bit tricky sometimes
but I will explain what it does
broadcast
okay okay so if we receive for one
return value we want to broadcast an art
event not authenticated so if we get a
401 from the server or users obviously
not locked in and if we get a 403 we
want to say huh
users not authorized so he don't have
the role expected for this call or route
or whatever and it will have the respawn
stages and three spawns and we will
return the promise which should reject
the call and everything else so whenever
we make an HTTP request which returns
this or this value we broadcast an event
and we don't let you continue this
request so all of the time when there's
an invalid request you will get noticed
and you will know what to do so this is
our complete user authentication service
right now the last thing we need to do
now is add some controllers and a bit
more logic inside our app so let's go to
our controllers and we start with the
app controller and for the app
controller we will have some more
dependencies stage scope
and some ionic stuff and also all
service and our events okay so the app
controller as I said is the root scope
for all of our others controllers and
this will Howard our user name and it's
also offering a function to set the
current user name so it's up to you if
you like it or not this is not a
must-have obviously you could also set a
complete user object or session or
whatever you like for this example I'm
just setting the user name which is
enough to show you what would you okay
so now we get to we when's we want to
listen to the first one is the not
authorized
so in that case we will show alert
pop-up and this is just the ionic pop-up
with an alert so we have a title
unauthorized and template is just a
string for now saying you're not allowed
to excesses resource okay so whenever
our authentication service broadcast is
not authorised event we want to show
this you're not allowed to access this
resource pop-up very very easy so the
second one was not authenticated okay
it's type right in that case we have to
inform the user that his session is lost
and that he has to login again
additionally at this point we call our
off service and say please logout the
user we could have also done this inside
our interceptor but I feel it fits
better to have it inside a controller
Siri there's no magic in in their
service or factory doing things for
routing or so I just feel better if the
controller handles those stuff so also
the lock code is not changing our state
that's
and to do for our controller so we call
a lockout and we go back to the login
page okay so that's our app controller
next the login controller this
controller is not very big because it
just serves one purpose so we have the
scope to state again the ionic pop up
because we need it some time and
obviously our our service you might if
you follow this video until now you know
that our data from the login is inside
data username and data password so we
create an empty object for the and we
implement our login function which gets
the data object again so at this point
we want to call our all servers lock in
and we give it data user name and the
data password and if this
works out and if it's not working
we will show some Lord pop up I'll just
copy this stuff so at this point the
login is failed and we say please check
your credentials okay so this is fine
okay so if we receive the authenticated
event and our promise gets resolved we
want to send our user to the dashboard
which is the main - state and I want to
reload the page additionally I call
scope set current username so this will
set the username on the root scope which
is our app controller and we will have
to choose the name everywhere inside our
app okay so that's everything for the
lock in controller the last one is the
dashboard controller which shares again
some dependencies oh my my copy them I'm
a bit lazy
we need scope state ionic pop up the our
service and we also need the HTTP
dependency okay the first one is the
very easy one it's the log out
and this protocol also this lockout and
send our user to the login page back ok
so now if you remind the setup of our
dashboard we had the username here which
comes from our roots go we have the
logout function and we have three
buttons for actions so let's implement
them first of all we want the button
showing you how to perform a valid
request and at this point I'll make a
get to localhost where our app is
running slash valid I will come to that
later no worries
so we have an area where we display and
display our response so whenever we get
some response we just set our response
to the result just for dummy testing
purposes okay so our hgp request is
complete the function is complete let's
make two more of them so the next one
was perform unauthorized request and the
last one was performed in valid requests
so here we will go to not authorised and
here we will see the nut hearth
indicated okay so all of them won't get
a result anyway we will see why later
their problem list should be here come
on but instead those will have an arrow
and we might want to display the error
also here
okay so we make some dummy requests to a
back-end which is at the moment not
existing but we have included our ng or
angular mocks so now we can go to our
app and go to where we already have this
path through routing and implement some
more of them oh come on so I'm gonna
copy those whenever we make a get
request to this URL we want to respond
with the message saying this is my valid
response
okay so when we press the first button
we should see this message inside our
scope variable next one oh come on
saying this is the nut 10 ticketed 1 and
this should have the message well we
will won't see this message anyway I
think but the important part here is we
will return the stages 401 so this is to
show you how our HTTP provider
Interceptor works so at this point we
should get not authenticated message
fire to our root scope and our app
controller should recognize this and
delete our session and guide us to the
login bag now the last one which was not
authorized and we will return a
four-three saying not authorized ok so
these are the dummy routes for our
testing if you think we are ready
you're almost correct but there's one
very very very important part missing
here and this is how we protect
everything inside our app you might
think you have already added everything
but no this is the very most point now
so we will have another run function
which will on routes go no typos no stay
change start call a function given the
next next runs from state or is there
anything more no so you might know what
this function is doing whenever our
state is changing this function will be
called so we observe our complete app
and every change of the state will be
recognized so whenever we navigate to
whatever we will come inside this
function and one thing we need to do
here is a service is authenticated and
if our user is not authenticated and
additionally if the next or the name of
the next state is not login we want to
prevent the event from going on or
preventing the default event and instead
go to our login page so if we see on any
change of a root that our user is not
authenticated at this moment we want to
cancel that event so he has no chance to
see that page and we go back to the
login and yeah we might also call log
out here but if he's not authenticated
there is no valid session at all so yeah
and we need this because I got an ya
infinite loop there sometimes so check
if it's not the page you're going to
otherwise you might end up in a very bad
state and now we come to our role based
authentication so if we got this data
object in our next stage and also we got
all the rice rolls in next data just to
prevent some null pointers here we say
all the rice rolls equals next data dot
all the rice rolls and again we ask our
house service but now we call is the
user authorized for those authorized
roles and if he is not again we say
event.prevent default and we say state
go
to the current bond because if he uses
not authorized that doesn't mean he's
not authenticated at all he just has no
rights to see the resource he has
requested so we should stay on the
current page maybe we want to reload it
but we don't want to move anywhere else
additionally at this point you might
also want to broadcast a message saying
PR the VINs not authorized or
encountered so we will see a tiny pop-up
saying oh you're not allowed for this
role or you don't have the permission to
see this but we still want to stay on
the same page and if I don't make any
typos or whatever which I certainly have
done we will see an app which will be
pretty pretty cool I'm not sure
everything's working right now we might
see some problems but those won't be
here obviously so let me take a look how
to fix them okay so there have been some
tiny typos so go to my blog if you need
the complete source code or check out
the github repository so that should
make everything clear and you don't have
any problems so now let's run our app we
should be at the login screen hopefully
and let's see what happens
okay so here's our login screen and
first of all we will log in with the
normal user with the username and the
password form okay so our dashboard says
welcome user we can see the dashboard
and the public area and let's try to
access this admin tab and yes we're not
authorized to see it so the user has no
chance to get to this area
let's try make a valid request okay this
is my valid response with the 200 and
also we see our excel stone is set to
our user server tone whatever okay so
the second one was the one with the
unauthorized request and again the same
message as for the secret route and the
last one is we make requests without a
belly tone so this might happen if a
user locks in the session gets restored
but the token is not valid so if he does
make a request within that session now
this will happen he will be guided to
the lock end and he will be completely a
locked out so there's no chance he can
get to any secret information without
having a belly tone okay let's try the
admin with also the one it says welcome
admin and the one thing that should be
different is this and we can see our
admin tab great so those three will be
the same the lockout is working as well
so this is now at the end of this
tutorial
it was a bit bigger I hope you liked it
if you have any questions just leave a
comment or tweet me and yeah I hope you
understood how to secure your angularjs
or ionic app in a very very easy and
still very good way
so I hoped it's the base for your next
authentication project and I could help
you with this video I would be very glad
if you follow my youtube account or
channel so you will see whenever there's
a new video so thanks for listening and
have a nice day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>