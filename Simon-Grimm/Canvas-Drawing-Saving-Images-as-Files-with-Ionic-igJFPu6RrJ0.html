<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Canvas Drawing + Saving Images as Files with Ionic | Coder Coacher - Coaching Coders</title><meta content="Canvas Drawing + Saving Images as Files with Ionic - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Simon-Grimm/">Simon Grimm</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Canvas Drawing + Saving Images as Files with Ionic</b></h2><h5 class="post__date">2018-04-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/igJFPu6RrJ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey everyone what's up this assignment
from deaf tech tech today we will build
a simple drawing app using the canvas
element and not only stopping there but
also saving the images of our canvas to
the file system using ionic and then
loading them so let's get started
there's a lot to do I've created a blank
new ionic app and you can go ahead and
first of all add the needed Cordova
plugins so the Cordova SQLite storage
plug-in is needed so we can use the
ionic storage and really store the
information in the SQLite database of
the app so run the first command and we
don't need the ionic native package for
the ionic storage because it is already
included when starting a new app second
install the Cordova plug-in file we need
this one to get access to the filesystem
so we can create and write a new file to
our apps data directory and for this we
also need the ionic native package so
once this is done we can go to our app
module and import both file and ionic
storage so file from add ionic native no
code completion today for me I guess
okay at least some and the ionic storage
module from an ionic storage ionic
storage module goes directly to our
inputs with for root so this is setup
and file goes to the array of our
providers and that's all for the setup
phase you can run this on the browser
but the problem is we can only test the
canvas functionality but not the saving
functional
t of the files because this requires
Cordova plugins which we don't have on
our browser anyway let's continue with
our home page I can also bring the I on
a clap in so we can at least see if we
got some typos alright so close this
let's go to the home page CSS and
typescript file perhaps we start today
with a HTML so let's call this ionic
canvas some color just it looks a bit
nicer alright first of all we add no
bounds to the iron content because this
helps when we use the canvas and you
don't get this effect where you can
still scroll a bit more at the top so no
bones for us and then we will put the
canvas into your container which uses
ion fixed and this works not completely
as you might think so you could think
this is now a sticky element but
actually it's in a separate container
and therefore the content of this diff
will be above our iron content so we
have to add a little trick let's call
this fixed container and we will add
some CSS an additional logic for this
inside our class later then we need a
little color selection and we will have
an array of colors inside our controller
so we can say let color of colors and we
will make this more or less duplicate
and we want one example where we got a
little box of the color and below the
box we will have an eye on row using the
radio group and an NG model and
this which will be our selected color so
you will see that this results in two
rows under each other and in here we got
the ion call again using the same energy
for like before perhaps text Center so
the button is in the middle and then I
on radio value will be the eggshell
color and then no value inside so this
is just a row with check boxes and this
should become row of the actual colors
so we can directly use the color for the
background in here and perhaps also add
a little class color block and make this
one typical as well if you want to
so when clicking this we call select
color with the current color and that's
it perhaps we could add the color block
CSS already so simply hate of 40 just
some basic stuff and the colors array
let's bring this in just a basic array
of colors and one selected color in the
beginning so if we save this we see that
this is not exactly how it should look
like but I'm sure this will I think we
need to close the row yeah of course we
need to close this one row oh come on I
on Row Row one to match okay looks a bit
better it's not yet the final result we
will make this look even better with our
fixed container soon but you see that we
already got the color selection and the
Select color function
let's implement this really quick cuz
it's so simple selected color equals
color so now we can both select the
checkbox and also the color above and
this gives us a knife effect for our
color selection but let's continue with
a canvas so we got our rose and then we
create a simple canvas element calling
it image canvas so we can access it as a
view child later on image canvas then we
implement or listen for the touch start
and touch move events that occur on this
canvas element we do this so in the
beginning we can start our drawing using
the event and the position of the event
and then we use a function moved with
the current event to draw the actual
line between two spots and that's
basically our canvas element perhaps we
need a button as well so button I on
button full click and with this button
we want to save the canvas image so here
we will create an image from the canvas
element whatever is inside and store
this image to our file system finally we
craft an ion list below which will
display our loaded images and we only
want to display this if an area has more
elements so otherwise we don't need this
list anyway for some UI add a head of
previous drawings and then we get to the
ion
the actual elements which will be cards
in our case select object of start
images which will be an array and also
we might eat the index so simply do it
like this some more formatting and then
I on card content just like this and the
content will be the actual image source
but we don't have the path of the image
at this point so we need another
function get image path which we will
implement in the controller very soon
and finally we add another row with a
button full color danger you might know
what this will be click remove image
index and then simply the index we could
actually make this and I can only button
and use for the icon deep ion I can
trash okay I think that's all for the
view if we update it yes we don't have
the area yet and also we might want to
add some more CSS for the canvas
display:block yeah now you know I'm
German okay funny characters and the
border one pixel solid just so we see
the actual boundaries of our canvas but
now we get to our controller we already
got our colors but we need a few more
things so first of all we need view
chart we need our image can
this which will be a canvas element and
we need an pew child where's my auto
import okay it works the content of our
page which is needed for the fixed
container logic so this will be of the
type content should be import from ionic
angular directly and then we got another
bucho held and this one is the fixed
container we created earlier fixed
container any then we get more elements
we got the actual canvas element which
we can access through our image canvas
view child using native elements later
then
for the canvas we need a Save eggs
number and save number so this will mark
our starting point inside the drawing
and then we will connect the lines along
the way we got the selected color and of
course we need to store the images which
is an empty array in the beginning so I
think we got all the basics let's see
how the view looks yeah that comes
closer to what we think but we're not
using the complete web and we cannot say
if start images is working or not and if
the fixed container is working but
anyway let's continue by checking our
storage in the beginning
storage storage yes from my own extract
Li and always make sure that the storage
is ready when you use it like in your
constructor early in the page because
otherwise it might not yet be ready so
once our storage is ready we try to get
the array of images from the storage and
therefore let us stablish a const
storage key up here and call it whatever
you like image list for example and then
we can use this storage key all the time
and don't need to check which keys we
have used so when we get data back from
the storage and if the data is actually
not now we can set our stored images to
the data otherwise we will continue with
the empty array now we get to the
initialized logic for the fixed
container so let me bring this in real
quick so these two and these I got this
from an open issue on the ionic github
page inside the tutorial which is linked
below the video you can also find the
link to this basically get some offset
and add some margin to the actual scroll
stuff on the page so if we do it we
won't see a change here because we don't
have something here but normally if we
won't do this and add a scroll list here
we could scroll the complete canvas and
image row out of the view which is not
exactly what we want to do okay finally
I on you did load as well and here we
can set our canvas
and to this dot canvas native element
and then set the width and the hate of
this element so for the width I would
say we take the current platform wood
which would be from also platform that
get no actually it's just with and make
this a string as well and then same for
the hate but let's set a fixed hate of
200 for this element so now we see
suddenly we got a knot lot cleaner UI we
can select the colors with this nice
little ion row and form group we got the
canvas but still nothing in here and
then we got safe image with all also
won't work by now okay so what color is
ready as well
so let's start with our drawing
functions we got start drawing with an
event and we got move or moved also with
event what's the actual name moved and
start drawing fine works even of course
goes there when we start drawing we
simply set our save X to property of
this event so you can expect inspect the
event and you will see that it will be
right here and also we need to set our
initial Y position to this now if we use
it like this we will likely run into
trouble because the canvas is not
completely at the top starting at 0 and
we need to calculate in
another variable so we get the canvas
position from our canvas element using a
get bounding client rect and now we use
the canvas position to subtract two
values right here and this finally fixes
the real position of our canvas and I
think we can can we use it here as well
I think we can so here we do it as well
but we create values current X and the
same here okay so now we're in the move
function and we need to draw our rect
first of all we need to get a context we
can draw on and this can be done by
calling get context 2d and that's now
our drawing context we can do all kinds
of funny things on first of all you can
set up some stuff how the lines should
join each other round looks actually the
best there are two more options but they
don't look as nearly as good as this one
then for the stroke style we use our
current selected color and then we get
the line with which we will simply set
to 5 if you want to you could of course
also add a selection for the will in
here as well then we start the actual
drawing by calling begin path and we let
our line let's scroll this a bit up move
to our saved eggs and saved Y position
and then we say please create a line to
the current X which is the one of this
event and the other well you so we begin
the drawing we start by our initial
point we move to the new information
point and then it's already done we call
closed path and finally stroke to paint
it that's it and once this is done we
can set our saved values to the new ones
and the next time this function is
called everything will work again
magically so if we done this right we
might be able to draw on the canvas now
already sometimes this is not so good or
not really working inside the browser
let's try a different way no yes so with
the io- lab and serve it is not working
but if you specify or select this toggle
device toolbar and get this funny
preview of your egg app which not looks
100% correct as you can see but anyway
you see that we got the different colors
and we can already write on our canvas
the next step is to save our actual
image to the file system we can't test
this on our brother anymore but we are
already fine with what we got here so
let's continue with a safe canvas image
function and also I will bring in
another helper function which is to
convert base64 string to a bowl of data
and you can find this another video
inside the tutorial no need to type all
of this so this is a standard function I
copied from Stack Overflow I guess so to
save our canvas we can create natural
base64 string using canvas
and to data URL
I could also lock this out so you see
that actually there is some data
involved so magic drawing safe image and
we can see we got some data so now we
only need to convert this data and then
save it also what makes sense is to
clean the canvas once we're done and
save this so if you want to clean it
simply get the context again and call
clear rect from 0 0 to canvas and canvas
dot 8 ok so this is completely optional
but I think it makes sense to clear it
in that case so now we need to construct
everything for the file plug-in and of
course we need to import the file
plug-in file make sure it comes from
ionic native and not some other file and
the file expects if we want to call
write file name path and the actual text
file or create file in this case no I
think we've used right file anyway let's
create a new name for the file using the
current time plus dot PNG so it will be
some time stamp to PNG which is unique
enough for this case the path to our
file will be the data directory of
course you could specify something else
but this is directly inside your app you
can use some options if you want but we
don't need them actually
and now we need to convert our data to a
blob and therefore we first of all the
step which took me kind of long to
figure out is this because you see this
string and we need to cut this from the
string to convert it to a blob otherwise
we will always get an error message that
the string is badly formatted or
something so first of all from the data
URL split it actually call the split
function perhaps split at this and then
not take the first but the second
element which is one in an array of
course and then we can create the block
using our function and passing in the
data and also the content type which
would be image PNG so now we finally got
a blob which we can store on our file
system so we can use a write file write
file tap is what we created before file
name is name and then text file blob
array buffer is our blob so then we get
something back and at this point you
could also of course add an error
message to check if it's working on your
device or whatever but in the success
case we have now written a file to our
system but we still need to store the
information all right so store image
should use the image name and this
function will take care of adding it to
our ionic storage so we can later load
all the information again therefore we
call store image with a new name which
is enough to store it we don't want to
store the full path to the file because
this path might change the data startup
and therefore we only use the name and
we will
build the name always new using the data
directory from Cordova which will be the
correct path and then plus the name okay
I hope you still with me
because it will get easier now so the
safe object is just an object in our
case I just put it the image in here you
could also have an array of the strings
but perhaps you want to store more
information with the image when it was
created or whatever and then we push it
to our stored images and of course
that's not enough we need to set this
image now to the storage so we use the
start again set and we can use our
previously created key no need to find
out which key was used at the array
stored images and then something good
will happen or not the list of the
images can get a bit longer and as it is
fixed you might not even notice that a
new image was added therefore I create
the reference to the content so we can
now call scroll to bottom which will
scroll the list to the bottom but
actually we should put this in a nice
little timeout here
because when you execute it immediately
the image might not be loaded yet so
let's add a super short delay and then
scroll the list to the bottom okay just
two more functions left we had the
remove function so let's add this one
and index and then we had the function
to get the actual path to an image
so image name okay these are the last
two functions we need today so first of
all when we remove the image we use our
start images called the splice function
at the index and remove one element so
remove will be now an array consisting
of one element and we don't only need to
remove it from start images I made this
error in the beginning that had to
change the tutorial then we of course
have to remove the real file as well so
therefore we use file data directory
again file name in this case is removed
at the position 0 remember this contains
one element and then the name is that I
am G just like we created the objects
before so once this is done do whatever
you like to with the result or even
catch the error if you want you finally
set the images as well but no need to
scroll again in here so that's our
remove function perhaps moved and if we
want to era para ok
just like this now finally as I said the
image path should be created not using
the absolute path so therefore we only
have the name and need to construct the
path so it will be at somewhere in this
start file that data directory plus
image name and if you're running this
app on iOS you might get into trouble
with the WK webview therefore we need a
little fix in here which comes actually
directly with ionic called normalize URL
yeah this one rewrites an absolute URL
so it works across fire and blah blah
blah and normally this should also come
directly from my own a king EULA so you
might not know this but it exists know
you know it so we get the path we
normalize it and then we return it so
the image displayed will be the right
one okay
the app will not work here with a saving
functionality so of course you can try
it actually this should not have marquee
I guess it's trying to access the
storage and then it's undefined okay
that's also a good point
perhaps I should use undefined in here
anyway we can't use this app in the
browser now anymore so let's build this
for a platform I pick iOS and see how it
looks there okay so there was another
tiny issue with our app and the actual
path can be gotten from object image of
court inside the HTML so make sure you
fix this and then I started the app on
my simulator so again we can draw we can
draw some more and then once we are
finished we can hit save image sorry and
then we can see that we got the first
image in the list now let's add a few
more and we see the swipe or scroll down
event to the bottom after this and also
what we can see is we can scroll this
part of the view which is the ion list
and this area is completely fixed at the
top so perhaps you don't even enjoy the
tutorial but the fixed element at the
top is really useful and amazing so of
course you can now edit and change all
your great drawings if they're not as
good as you might think so easily
removed from the storage and as well the
file system so that's how you create
drawing canvas using ionic
first thing that canvas to an image
saving it loading it and everything you
need to know about the data URL if you
enjoyed this tutorial make sure to
subscribe to my channel and check out
the other ionic videos there's a lot
more and a lot more coming of course and
also check out the ionic Academy com if
you're interested in a great training
resource for ionic covering courses
project and the great community to help
you build your epic ionic apps so I'll
see you inside the next video have a
great day and take care</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>