<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Spring Boot 1.5+ with Micrometer and Prometheus Example | Tech Primers | Coder Coacher - Coaching Coders</title><meta content="Spring Boot 1.5+ with Micrometer and Prometheus Example | Tech Primers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Tech-Primers/">Tech Primers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Spring Boot 1.5+ with Micrometer and Prometheus Example | Tech Primers</b></h2><h5 class="post__date">2018-04-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1_BZAA8T1G0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">press the bell icon on the YouTube app
and never miss any update from tech
primers in the last video we saw what is
micro meter in this particular video we
are going to create a spring boot
application with micro meter and we are
going to use the registry for Prometheus
I have configured Prometheus locally I
have used docker containers and I am
running Prometheus inside a docker
container and what we are going to do is
we are going to create a spring boot
application with one dot file
spring boot version use micrometer and
convert that into the Prometheus format
so micro meter is going to do that for
us and we are going to use the registry
for the Prometheus so as usual let's go
to the spring initializer the start of
spring dot IO I'm going to create a new
project let's use comm tech primers I'll
just use the group as micro meter sorry
and the artifact name I'm going to
provide is micro meter let's say spring
boot - 1.5
all right this remove remit is less a
micrometer spring boot 1.5 and the
dependencies which we are going to use
are the spring MVC I also need the
actuators so that the exposed end points
can be accessed by the spinning
actuators and that's it so we don't need
anything else we need to provide the
micrometer dependency that we will
provide once we open the project in
IntelliJ so let me open the project in
IntelliJ and I'll just fast forward this
so the project is open in IntelliJ and
as you know this is the default
structure which we get so by default
what I have done is I have configured
Prometheus to take the stats from the
process with the port 8 0 9 1 so this is
the Prometheus configuration and if you
see already I have configured Prometheus
to collect information from the endpoint
called 8 0 9 1 / Prometheus so this is
because the spring bootie application
which we are going to create that should
be running in 8 0 9 1 so that Rama Thea
scan cutting collect information so
right now the endpoint is down that's
what this is because we are processes
not up and we are going to use the same
port so what I'll do is I'll just use
the server on port configuration so that
I we can override e spring boot port
also I need to disable the security for
the Prometheus URL by default the URL is
secured so I'm just going to disable
that I'll use the property called
management or security not enabled as
false so this will disable the security
for the Prometheus URL where our stats
will be exposed so now let's come to the
Palmer XML where we can add the
dependencies for the micrometer so I
already have created a code for that and
loaded into the live template so and you
see this is what I'm gonna add so what I
have added is I have added the
micrometer spring legacy dependency for
the latest version of micrometer so this
is going to support spring boot 1.5
version if you are using spring boot 2.0
you don't have to use the legacy 1 you
can use the directly the spring 1 but I
am using the spring boot 1.5 hence I'm
using the micrometer like AC integration
along with that I am going to use
Prometheus to collect the information
from my process so I'm using the
registry for Prometheus if you are using
Atlas or influx DB you can go with the
corresponding library but the process is
almost similar it's exactly the same so
I just added that a particular
dependency here and I don't have to
configure anything to spring boot to say
that register this or that spring boot
will by default
do the registration because we are
adding the spring boot actuators already
we have added that in the dependency
right so that will take care of
identifying what are all the different
registries which are there in the
project and it will try to register so
now let's go on and create some
configuration for the micrometer so I
will just create micrometer
configurations this is just for our
reference I'm just going to create a
custom meter registry customization so
that we can identify that okay this is
the process which we are running so I'll
just add a configuration for that it's
just a beam so that you can add some
custom configurations with which you can
identify that in the Prometheus graph so
it's called meter registry customizer
the argument for that would be meter
registry so by default meter industry is
created and we need to create a meter
registry I'm just using me to you
straight out conflict and we can
configure some common tags so I will
just use the tag as application name as
what will be the application name let's
configure the application name as
micrometre YouTube example so that way I
know this is the current project rate
you can also add multiple common tags if
you if you want which I'll just add only
one for now so this will be visible in
the prometheus graph because this
information will be streamed from this
particular process this is just for our
reference so we are customizing it now
I'll create a simple controller hello
control
let's call it as a Hello controller we
just want to collect the information
from our application row right so I'm
not going to concentrate on any
functionality as such so I'll just
create a simple hello controller and
this is the rest controller we are going
to use the spring MVC so I'll just say
monitor the rest slash slash rest and
I'll create the hello and this will
return hello YouTube
now we need to add some sort of
configuration to this particular rest
endpoint because we are going to monitor
this interesting point so what I am
going to do is I need to monitor
something about this particular West End
point right so let's collect information
about this restrain point so I want to
get how many times this resident point
is hit let's do that so someone has
asked me in the section on how can we
identify or how can we count the number
of connections which are hit to a
particular rest endpoint so this is one
of the way where you can collect
information there is a annotation called
timed created by micrometer where it
will create timely information about
this particular rest endpoint which we
are hitting so I'm just going to use
that here what are the different values
are there is something called value so
the type of name or a metric with which
you can identify this particular rest
endpoint I am just going to call it as
tech primers dot hello dot requests
right this is the name which I provide
to this particular for collecting
information about this particular
resistant point so we can create
multiple let's create one first so that
is the value which I am providing there
is something called histogram so by
default the histogram is true I wanted
history information as well so that I
will just name it as I will just Nabal
and make it as true we can also have
some extra tags so additionally what
I'll do is I'll just add some extra tag
so that we know what is the version so
I'll just create a version as 1.0 so
this is the first version of our
application right so we let stamp it as
version 1.0 these are some additional
tags which we can use while configuring
or while creating dashboards out of the
Prometheus data also there is something
called percentile I'll just mark the
percentiles as 0.95 and 0.99 for now so
we have created one rest endpoint
let's create one more so that I can show
you how Prometheus is collecting
information I'll just create a hello to
so I'll just use the same metric sorry
I'll just use one more metric I'll just
say his load to write hello to request
so that way we will be able to identify
what are the different information about
each of these right so literally we are
monitoring two different rest endpoints
with two different names right so that's
it I think we are set we don't need to
configure anything else we just added a
application with the name micrometer
YouTube example so I think that's it so
let's start our application and we'll
see what's happening in Prometheus so if
we go to the Prometheus UI it collects
or it scraps about the information about
different JVM so right now there are
three JVM is configured one is about the
darker one is about the Prometheus
process in itself and the other one is
the spring demo which is what we are
using so this is the port with which we
are starting our application I think by
default it's using Java 9 let me stop
this guy
you
I'll rebuild it with joy white so that
we don't
get into issues let's run this
so the process is up already let's go
and see whether it is up yea it is up
the Prometheus data is by default
streamed under the path Prometheus and
let's try that yeah so this is how the
Prometheus information looks like and if
you see here the application name is
provided as micrometre YouTube example
this is what we changed right and you
can see the different types of levels
and information which are which are
there here which will be specific to
Prometheus and also we can check for the
ones which we added right so right now
it did not collect anything about the
tech primers because we did not hit any
URL from this particular process so
let's hit the list hello which we
created so this should return hello
YouTube yeah I'd returned hello YouTube
now if I go to Prometheus data this
should give me information about tech
primers hello requests yeah this is what
we added right so this is the new
restrain point which we added and asked
micrometer to collect information about
and I can see the data getting streamed
so this the data should be now our
available in the Prometheus let's check
the targets yeah
the application is detected and the
state is showing us up now let's go to
the graph and just refresh this and we
should be able to see the metrics here
yeah I can see that see this right these
are the different metrics which got
collected we added a tech primers one
and we are going to use the tech primers
hello request seconds count so we are
going to count the number of requests
which got hit right I will just do a
request and notice that there are two
graphs here one with micrometer YouTube
example one with micrometer service 1.5
so this micrometer service 1.5 was
something which I use some time back so
if you see here the time with which I
used was some time ago and I'm using the
application name as micrometer YouTube
example which is what we did right now
so that is what we can see here and the
number of requests hit is only one right
now I'll just increase or I'll hit again
and again so that we get a graph we get
a proper graph and also we created one
more request right we created to
restrain points isn't it we created
hello too as well so I'm hitting that
badly so that we can see in the graph
how Prometheus shows so let me if I have
refreshed enough I think let me go to
Prometheus again
and I can see the spike here see that I
can I can see the spike to six now I'll
also increase the hello ones as well
so let's go to prometheus again and I'll
refresh this
and I can see six right now but let me
see what time did its cap so what Roma
Theodore does is it scraps the
information from that resident point
every now and then so the last crap
happened seven seconds ago
let's see some young some latest start
so we should be able to see our increase
right here it is 10 right now so the
number of requests which we were hitting
it has got increase right now
and I can see that here so you see you
see that that the URL which we were
hitting micrometer YouTube example and I
can see the graph rising as well
so this is how we can collect
information from our process so what we
did in our code is nothing but adding
micrometer as a library and we also
added the micrometer Prometheus
dependency so that
Springwood can by default identify that
this is configured with the Prometheus
and that's what we did right
also we created two collector
information so for example tech primers
hello request and take them as hello to
request I think I showed you only one
let's see the other one so we are
collecting information about how many
times this particular resident point is
hit that is what we did here we are just
checking the count of the number of
requests coming in to this particular
metric and that metric is just
configured using this particular
annotation so this is a micrometer
specific annotation you can configure it
on any any resource or anything if you
want to create a metric or create a
guard or a counter out of a query or
caching information you can do that
customly if you want me to do a video on
that do let me know in the comment
section below so based on the number of
records I will just try to do that but
in order to get things up and running
and quickly test micrometre this is how
you can do it so you can add a at time
death and you will be able to collect
information out of this particular
resource out-of-the-box and as I said we
had only we showed only one right take
primers HTTP hello request there should
be one more yeah see that there is one
more called hello - and this will track
the count of the the second one so this
will track the count of number of hits
for the second
tristant point called hello - that's
what we did right so let's execute that
you
so this should show ya see that our
application name is micrometer YouTube
example and the rest endpoint for that
is the rest hello - if I have if you
created if you if I create more and more
rest endpoints right if I create more
rest endpoint with the same request I
should be able to see that as well so
let me create one more Alka it one more
call three but I will register it with
two let's see what happens so I created
three now let me read on this particular
and I will create four as well one more
so that we will have a variety of rest
endpoints which are configured for the
same metric name I also had the graph on
our dashboard but I don't know if it is
working so I have configured the graph
on our dashboard to use the Prometheus
and it will show up in a different
format it shows up in a graphical format
but I don't know how to configure or use
graph owner with chrome Athiya so it was
not successful that much so your so
let's go to the - both I already created
one dashboard I think where is that they
already use Prometheus
no I don't have any dashboard right now
okay let's try creating a dashboard I'll
just say graph but nothing is coming in
though so I'm not sure what I'm doing
incorrectly but it's okay I can see the
information from Prometheus it's and so
this is prometheus that is just the UI
part which you can configure to any
back-end so you're using Prometheus by
default has something so that is what we
are using here so if this ping butoh
plication is up yeah this ping good
application is up now let's hit the
hello 3 and Halo 4 so that we can show
the information about that in RS 10
point so we hit 3 hello 3 hello 4
well hit a low for more number of times
let me go to the UI and I'll do a ticket
see that there are three different
colors now right on all the application
name is the same instances are same but
if you see here the URI is different
hello - hello 304 and you have the
version numbers these are just the tags
for us to identify so this is how we can
see the graph information inside
Prometheus
so these informations are streamed via
this particular rest endpoint called a
zero and one Prometheus this is where
all the information is just sent to the
Prometheus time series database if you
don't know about what is the time series
database do check out my video on what
is the time series database I have just
mentioned or I have just explained about
that so you will get to know what is the
time series database there and
Prometheus is one of the time series
database and I am just showing you this
graph using Prometheus and how I am
running Prometheus I am running
Prometheus as a docker container in my
laptop so if you see here docker is
running in my laptop and this is the
container so the docker container is
running here and I also have the graph
on our dashboard connected to the rocker
container but it is I am not sure how to
use it so I'm not showing that right now
so if I hit the rest endpoint small
number of times I should be able to see
more information collected
right but yeah that this is how you can
use micrometer see I can see different
different lines here so these are
different rest endpoints of this
particular stats or a metric right so
this is how you can use micrometer to
collect some information and then push
it to param a theist if you see how easy
was it right so from an application
perspective the changes were very
minimal it took some time for me to set
up Prometheus locally but that was okay
if you want me to make a video on that
do let me know I can make a video on how
to set up Prometheus locally if that is
useful I hope you liked the video as
usual this particular code will be
available in github right now so you
should be able to go pull this
particular code from github and then use
it as well for reference if you liked
the video go ahead and like it if you
haven't subscribed to the channel go
ahead and subscribe to it mate Oh again
in the next video thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>