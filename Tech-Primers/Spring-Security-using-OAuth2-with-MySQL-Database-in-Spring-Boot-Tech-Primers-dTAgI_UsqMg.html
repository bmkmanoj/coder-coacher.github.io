<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Spring Security using OAuth2 with MySQL Database in Spring Boot | Tech Primers | Coder Coacher - Coaching Coders</title><meta content="Spring Security using OAuth2 with MySQL Database in Spring Boot | Tech Primers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Tech-Primers/">Tech Primers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Spring Security using OAuth2 with MySQL Database in Spring Boot | Tech Primers</b></h2><h5 class="post__date">2017-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dTAgI_UsqMg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in the previous video on spring security
with or two we saw how we can integrate
earth to inside the spring buddha
plication using spring security and how
we can authorize an authenticated using
your in-memory authentication mechanism
in this particular video we are going to
use a database to authenticate your
username and password so what we are
going to do is we are going to use a my
sequel database which I have running in
my machine and we are going to use that
particular database to authenticate
yourself let's get started
press the bell icon on the YouTube app
and never miss any update from tech
primers
you guys know that I have uploaded the
oauth2 project into github and I'm going
to use the same project so that we can
work on just modifying that project to
make it work with it at a base because I
don't have to create the whole odds over
again and then I don't have to really
explain and recreate everything from the
beginning so what I'm going to do is I'm
going to use the same project which we
saw in the previous video where I had
created the earth two example bit spring
security so what we did is we created
two separate processes so basically we
created two microservices one is called
the odd server the other was called a
client so what I have done is I've just
checked out both of them separately in
my local workspace so I'm going to show
you how you can modify the odd server to
make it connect to the my sequel
database and using the client oh I have
the project downloaded so you can also
work on that and also I will upload this
new project as well into a new
repository so that you can have a
reference right so that I don't have to
recode that that's why I'm just reusing
the same project so if you notice here
in the previous project we had this in
memory or negation right what we are
going to do is we are going to eliminate
this in memory of syndication and we are
going to use the my sequel
authentication so for what for that what
we need to do is we need to remove this
particular piece where we said ok we are
going to use in memory authentication
instead I'm going to use the user
details service so if you have seen my
video on string security the basic
spring security will be my sequel
authentication this might be familiar
because spring as a framework provides
something called user details service
which you can use for changing or
changing the way you authenticate stuff
so in our case we are going to use the
database so we are going to create a
custom user video service so let's see
how we can do that so what I'm going to
do is I'm going to say custom user
detail service right and you need to
create this user detail service so which
is nothing but an interface right we
need to implement that interface and
then we need to work on it so I'll just
auto wire this and I need to create a
service right so what I'm going to do is
I'm just going to create a package just
called service so I am going to create a
java class which is going to called
custom user details service right all
right implement the interface user
detail service okay I'll just rename
this to user details since right so I'm
giving him the object details service s1
right okay so I need to implement the
methods so there will be only one method
which is the load user detail and also
I'm just going on a date with a service
because this is the service which we
created here right so let's fill in this
later so before that we need to create
some models right so we need some models
so what I'm going to do is I'm going to
use the similar concept which we did in
the spring security my sequel database
authentication which is just the plain
spring spring security via the database
so I'm going to use a similar model so
what we need to do is in order to use
this custom user detail service we need
to override the user details right so
I'm going to create that model and I'm
gonna override so let me do that so I'm
going to create the Java class core user
custom user detail and I'm going to
extend this from the user's right so
this is users I'm going to create it now
and I'll implement this from the user
detail details which is provided by
spring so let's implement the stuff
which are provided by spring right you
see lots of these on now let me create
the users right before that let's go to
that let's go to the custom user tale
and let's finish this off right so I
need to add a you know is this so I need
to add the constructor here so what I
will do is I'll just add a default
constructor
I don't need the default constructor
though but I need to provide the list of
users right who I need to pass it to the
users it's a basically a user but still
I have made it as user so I'll just
create a constructor there right so then
we need a we need an object called mod
role right so we need something called
role may not assign the role for the
users so I'm going to create a modal
called role so that we can use it and
let's use the JPA spring JPA to persist
so I have not integrated spring JPA to
this project so what I'm going to do is
I'm going to use the dependency and add
the JPA so I'm going to add the
dependency called spring boot strategy P
and also I'm gonna add the dependency
for my sequel Java connectivity so my
sequel connector Java so this should
integrate me into this spring JPA all
right so we are going to use spring JPA
to persist into the my sequel database
because we need to persist not vs.
basically we need to retrieve the data
from the database right so that's why
I'm using this and also I'll just show
you the database so let me show the
database structure so that you have an
idea before I create the model right so
the database has a table called role
which has the role ID and the role so
what is the role ID there already is a
number and then the role is admin and
there is a table called user it has user
ID it says whether it's active or not
then it has a email address then the
last name first name and the password it
for now I have not encrypted or done
anything just for our reference right
I'm not going to encrypt anything but
you can do the encryption by yourself
right the next one is the user roles so
I'm just going to provide what role is
associated with what user so user ID is
coming from here and the role is coming
from here and this is the joint joining
table basically the normalized table
which is going to say that this
particular user
particular role okay so that is the
basic sector so we need to create this
user role and user underscore oh right
so if you had seen my previous video you
will be familiar with this particular
model because it's the same model I am
gonna use it's the same table I'm gonna
use I'm going to use the entity JP
entity I am going to make it as a table
and what is a table named Tim Liam is
your role right that's what we created
also I'm going to create the role ID
that is what we did then we need the
role basically which is what is what
type of role it is whether it is a admin
or user or something like that and this
is an ID we need to generate this so I'm
going to say generate value the strategy
for this should be auto let let it
create automatically and I need to map
this to the column which says role
underscore ID hey that's what we had in
the database
okay so this is the spring JPA notation
that's what I have done so for the role
table I'm going to say the table name
the column name should be role okay so
I'm going to add some constructor and
who's gonna add tea for constructor for
house on it and I'm going to add some
Gators and setters alright I think that
so we don't need anything else right so
what we have done here is we just
created a role model and then we have
added it with annotations which spring
JPA request now we are coming to the
users so users the table name which we
had was user right so I am going to
annotate it with the name user so that
it maps to the user table so this by
default no map will map to the user
table and there were different themes
right so we need to write all those
fields so one is the ID the next one is
the email address the next is a string
name private string password and also
last name and we had an activist voted
last name we also had an active whether
it said the user is at
one right and I need to annotated these
same way I D generate value right and
strategy should be Auto right and the
column name is user underscore ID right
that's what we created there so the next
one is the email email had the name
email the next one is the name name had
the name name so we can do this and the
next one the name was password so I'm
just typing password same way the next
one was last name so I'm just saying
last on the score name and the last one
was active right it's a doctor now there
was a intermediate table which was
having a relationship right so what we
are going to do is we are going to use
the one too many mapping and map that
relationship here itself so that
whenever you load a user it gives you
the roles for that particular user so we
are going to leverage that one two
mapping feature for from the spring JPA
using hibernate so I'm going to say give
me the set of use set of roles right
of this particular users so I'm gonna
say a Rolls and what we need to do is we
need to join this with the table right
you have to do join table right and what
column do we need to do right you have
to join the table which is the table
name sorry the table name should be user
underscore role right wait let's check
once the table name is your user under
scold Road you have to join the user and
ask or role table with the columns so
you need to say join columns okay and
I'm going to say join the column the
name of the column is user underscore ID
from are ours right okay and I'm going
to say now how do you do inverse join
right so now I am saying that do a
inverse join off of the role underscore
ID right so what I have done
just joined these two using the user ID
column from this particular table to the
role ID from the other table right
that's what I have done here okay and
this is nothing but a one-to-many
relationship because one user can have
many roles right that's why you have a
set of roles so I'm going to say one too
many and I need this particular data
right by default so I'm going to say
cascade the type of cascade has cascade
I'm going to say fetch me a by Iker so
by default seeker but just I want to
mention so that we know it's getting the
data by default okay that's all I guess
I'm going to add a dummy constructor for
hibernate and we have a constructor here
so we need to assign the variable set so
I'm going to say Act two equal to zero
start we are basically just copying the
data from one user to the current user
okay that's what this is going to do so
email equal to users or team in I'm just
going to type this so I'm just gonna say
in everything from the user object to
the current object is there anything
else I think that set equal to use a
short roll right okay now what I'm
to create the getters and setters
basically when you say que todos
unsettles okay that's all so our model
is ready now the user's model is ready
from this user's model we have extended
this guide right so that we can reuse it
in the custom custom user detail so that
spring can reuse them if it is required
right however if you notice here we have
not populated any value here let's do
that right so you call the super so that
is going to just clone the objects now
I'm going to use the password so user
name should be super dot get name
password should be super so this super
is nothing but e coming from the users
that's why we are at the sukkah right we
suck out non expired true I'm going to
make it as - he's a caught non lock true
and his credential non-expiring true and
he's enabled true okay by default I'm
going to enable everything is true right
now we need to populate the the granted
authority so we need their roles so in
order to get the roles what we need to
do we get the roles however it has a
different type right so we need to
convert this into a less so I'm just
gonna do a stream and I'm going to
convert this way since I need to convert
I'm going to use the map so what is
there inside the role it's a road okay
I'm just going to use the lambdas
expression so I'm just saying create a
new simple granted Authority okay using
the road so role underscore that is
general notation which spring request
and then I'm going to say get me role
dot get role right that's what we need
we don't need a ID but we need your role
and finally I'm just go to since we have
multiple roles I'm just going to convert
this into a list so collectors dot two
lists right and we can in fact we can
even directly return this okay so we
create
granted authority with the roles which
we got from the database which got
populated into the user so since we get
the data from the database we need to
create a repository which is not there
right now so I'm going to create a
package let me create a package called
repository and I'm going to create a
class called users repository right and
this is going to be an interface in fact
it's going to be extending from the JPA
repository and the object which we have
is the users and the ID is an integer
right so that's what so we are done here
right however we did not populate the
service correct so we had the service we
did not populate the service so let's do
the population of the service right so
what do we need to do here so we have
the load users by username method so
what is going to come here is the
username so we are going to get the
username first and we are going to use
this username to get the data from the
database so in order to kill the data
from the database we need to get that
data right so I'm going to use the I'll
just say give me the users repository
and I'll get it from that users opposite
right so user repository dot fine bye so
we do not create
fine bye so what I'm going to do is I'm
just going to create a find by name
because name is the name of the user
name in the database so what I'm going
to do is I'm going to create a find by
name right and there could be chances
does this could be present or could
might not be present so this can be an
optional field so optional is a concept
very you it's like a wrapper around an
object so so that I can use it for
controlling so I have an optional object
here right so this particular optional
object what I'm going to do is I'm going
to use this object so let me just create
a variable called users optional so this
is the users optional now what I'm going
to do is I'm going to say users optional
if the value is not present so what I
need to do right if the value is not
present I am going to throw an exception
saying user name not found exception
because that's what this particular
method throws right so I'm going to
throw this particular exception saying
that user name not phone right okay
this got changed I don't know user name
not found exception okay so that's what
we have done here okay
the other thing is I don't want to come
up here I wanted to get the value from
that particular user so let's say if the
user is not there we will throw an
exception if the user is there what do
we need to do right if the user is there
let's map that particular is and
retrieve the value from the user
so what I'm going to do is I'm going to
say convert this particular user right
to a custom user detail custom user
sorry what is that name custom user
detail right here custom user details
and I'm going to pass this users there
so this is why we created this
particular constructor here so that we
can pass it and then we can reuse that
so that it is of type user and of type
the user detail so that spring can use
it so if you see here spring needs our
user details and this particular object
is of type user details here that is why
we had to implement this particular
method and we reuse the users so we had
the users from the database and being
just are converting from the users to
the custom users and then finally we are
going to get that particular value so
that it returns the user detail right so
let me
in fact we can replace this with the
reference method reference right I think
that's it okay if it is not present it
would have thrown an exception if it is
present it just Maps the particular
object into a custom user detail and
then it just gets that particular object
and then returns it to Spring Framework
so how Spring Framework is going to use
it is from here so using the custom
editorial service which we oughta wire
here it Spring Framework is going to use
that and then use this method use this
method called the node user by user name
and then it is going to get the values
from the database okay so I think we are
done so what do we need to do what else
we need to see yeah we need to add the
properties the my sequel property so
what I'm going to do is I'm going to add
the my sequel properties here I just had
a live template already so that I'm I
can just reuse it so I just added the
properties here in one shot okay apart
from that we don't have to do anything
right that's it because we have just
changed only the part where the
authentication is changing that is why
we had to change only this part in the
authorization server config in the
client side we don't have to do any
change so this is the client side where
we have a HTML page which is hosted
under /ui
okay what I'm going to do is I'm going
to start this server I think I have
already started this let me restarted I
had this already starting but let me
restart it meanwhile I will start our
server here right so I am going to start
the authorization server as well so that
this can be contacted from the client
side and we can see without
authentication is happening you're not
using both so the port
let me see the port which er this is
coming up in right the client I think
might be coming up at 8:08 - okay so I'm
going to use localhost:8080 a to /uy
right so this is where our UI is hosted
yep are you eyes up so the client is up
let's see if the server is up once the
server is up let's hit the login so that
we can log into the server okay so what
is happening here is the client is going
to use the authorization server to
authenticate ourselves using the
database information so let's see what
initially if you remember we had the in
mobility tail called Peter and Peter the
user name is Peter and the password is
Peter we are going to try that first to
check if it is still using the immigrant
database then we will see how we can
connect to the new username advancer
which is there in the database so the
server is using 8:08 one if you notice
and it is up right now so I'm going to
click on the log in to auth both here
and this is going to redirect to the
spring login page so what I am gonna do
is I am going to say Peter and Peter
right this was the login which we had
already right let's see what happens if
you notice here we got an error saying
your login attempt was not successful
let me try without a password what is
happening yep the same error came now
I'm going to use the user name and the
password from the database so Sam is the
user name and Sam is the password let me
try that right I'm going to try this
hopefully this should take me to the
secure page yep
if you notice here the URL got changed
and this is directly a it has directly
taken us to the client side however with
a secured you are right and it is saying
that okay welcome to tech promise Sam
okay and this is the secured page right
so let's check if it
really did the database query and yep if
you see here these are the hibernate
queries which we saw great these are the
logs from the Hamlet so it is directly
querying the database and it is directly
getting the user roles and the password
from there right so this is how you can
integrate the database inside the OAuth
2 inside the spring security framework
right so what I'll just summarize what
we did again so that you have a brief
understanding of what is it so if you
want to know the whole complete what
setup with inside the spring boot
project there is a separate video go and
check it out you can you can just check
it out in the suggested link so once the
video is completed if you want to go
there and just provide the link there
you can just go and check out how you
can create it however this video is just
the continuation of that so that you can
integrate the database authentication
for the oauth2 so what we did here is we
just added the user details service here
so what we did is we had the other day
authentication manager inside the
authentication manager we added to use
the detail service this user detail
service is the one which is going to act
as the customization inside the spring
security framework so that you can use
the spring you can use the my sequel
database and in order to overwrite this
particular user ID to detain service I
have created a custom user to detail
service right which is a service and I
have implemented that particular
interface the only method in the
interface is the load user by user name
this is the method which will be we can
override and we can do whatever we want
and return the user details object
finally after we have authenticated so
what we have done here is we are just
using the username and password and then
they are authenticating it so you got we
got the username and password and then
beer giving the user by converting it
into the custom user details object ok
how we are getting the data from the
database we are using the user
repository using this spring JPA
framework and we have the model created
which is called users so this is the
table structure which we have in the
database same way a role is another one
right and we are going to override the
custom user details so this is needed
because if you notice here in the car
detailed service you need a user detail
object right which is nothing but a
model so in order to use that model we
are overriding that particular interface
and then we are implementing the methods
which are used by spring along with that
we have the user uses model here right
and we got the rolls and then we
converted them into a simple granted
Authority and then we are providing it
into the spring framework itself using
me get authorized authorities okay apart
from that what we have done is we have
just added the properties for the
database connection this is my database
connection details which I am using
locally and also in the palm XML we
added some dependencies the first one
was for the JPA integration we are using
this spring data JPA so this is the
dependency and the next one is the my
sequel connector injection so this is
required for connecting to the my sequel
database if you are using a hedge escape
hsql database or any other h2 or any
in-memory database you can just add that
dependency and that should get
automatically auto wire by springboard
right so that is what we did as a part
of this particular video so we just
created a integration with the spring
security we modified the custom user
details and stuff so that we can use
database for authenticating our user
using the OAuth 2 right and the client
side we didn't do any change because we
have not changed anything from our
client right this time ok so that's from
this particular video that's what I
wanted to cover as a part of this
particular video hope you liked it if
you have any questions queries adieu Rob
back in the comment section below if you
haven't subscribe to the channel do
subscribe to it if you are new to the
channel do share this particular channel
to whoever is using spring boot or
DevOps or anything which is new in the
Microsoft Microsoft in this world right
meet again in the next video thank you
very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>