<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Distributed log tracing in Microservices using Spring Cloud Sleuth with Example | Tech Primers | Coder Coacher - Coaching Coders</title><meta content="Distributed log tracing in Microservices using Spring Cloud Sleuth with Example | Tech Primers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Tech-Primers/">Tech Primers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Distributed log tracing in Microservices using Spring Cloud Sleuth with Example | Tech Primers</b></h2><h5 class="post__date">2017-04-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gPKJkY2t7Pc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to tech primers in this video we
are going to see this spring cloud
sleuth implementation with an example so
in the previous video you would have
seen the water spring Club and how
spring cloud uses spring clothes sleuth
for distributed trace logging
okay in this video we're going to see
spring clothes implementation so what I
have done is I have created two apps one
is called the spring cloud the sleuth
clients the other is called a server so
what I'm going to do is I'm going to
call the server from the client so if
you see here this is the start of spring
dot IO so I have added this and Sluis as
the dependency for the project so I have
created two projects already so you can
click the generate option to create it
with all the necessary details filled in
here so I have already opened that in
intelligent so what I'm going to do is
so for example this is the client right
so in decline we are going to have the
rest controller so let me go ahead and
create it so I will create a package
called resource
so I'm going to create a file called
hello source and I'm going to be spring
MVC for so I'm going to annotate it with
thrush controller also I'm going to say
what is the rest you are for so let's
name that a stress slash hello okay and
here we need to have a method something
gets mapping I am going to say the value
was empty
okay so I'm going to James I have just
created at a 10 point here so what we
need to do here is we need to create a
risk client because this is the slows
client I made two calls it a server so
for that we need to create a rest
template so in order for spring sleuth
to automatically inject the trace IDs
across the application so we need to
inject that as a beam so I need to
create a conflict package or I can even
create that in the application but let's
follow some convention here so what I
have done is done play config so I just
created a config file and annotated with
configuration so this we this is nothing
but the Java annotations have a
representation of the XML file so I am
going to create the beam for the rest
template so I am just going to do a
neuro simply so if you do that so there
will be only one instance of the rest
template and that will be used by spring
cloud slow to add the trace already and
the span IDs so what I'm going to do
here is I'm going to authorize that
because our beam is already created okay
using the rest template now we should be
able to do a call get four objects so
what I'm going to do is get four objects
and I'm going to say HTTP localhost so
the port number can be 8 0 8 1 slash
slash hello / server okay and we can say
this that client just for on any
convention
okay I'm going to eternal spring string
key string class okay and I'm going to
say let's add some logging here so what
I'm going to do is I'm going to the
start log statement
saying before calling the server
like you some marketing help oj4 logging
static final logger and i'm going to do
is I'm going to use local factory but
take longer
hello this was class okay can use that
instead of the system or altered printer
okay now we need to get the object
response back here
okay so spring is still needs a response
so I am just going to use exchange the
eyetality
so what this particular first controller
is doing is we are just calling the
server side with this particular URL
with the port 8081 first hello server
and that is going to return a string and
we are just going to return that back to
the UI okay now let's go to the server
project so this is the server project
which is also a new project which is
having nothing so here one what we need
to do is we need to expose that
particular rest endpoint so same way I
need to create a resource package I just
create the similar class hello the
source so there is no necessity to
create the same class but just for the
demo purpose I am just creating a dummy
hello well controller okay so I'm just
going to use the slash hello and here
you have the get mapping and here we are
going to mentioned that it is pizza
you know what we are going to do is we
need to return hello world
okay thus for the login purpose we can
add a static
so I have already login as well here so
so that we can see how the logs are
getting mapped so I have added our weeks
to server here so the only thing we need
to modify here is the application
property so we have added the port
number of 8 0 8 1 so we need to say 0.40
8 1 ok so we need we have we are
changing the spring boots server port to
be 8 0 8 1 so let me start this
particular application so it should
start in the 8 0 8 1 so this is the
server side meanwhile we can go to the
client side and start the client awesome
so this is the client so I'll start the
client so the client should start in
8080 and the server should start in the
80 81
meanwhile we can go to the you web
browser to hit D you are so I need the
8080 so we are going to get the client
supplying to running on a TIG and we are
going to say hello first
hello plant okay let's see the towers
are up so this is the client let's go to
the soul so is uh so what does the
service a address already in use so so
uh trucks is already in use ATT so the
client has started in ATT so why didn't
this property work so let me create an
application Yama
we start this so this should start in
the port 8081
let's see meanwhile if I hit this
particular URL it is going to give me
the exception now so internals over a
four or four month so the destination
URL is not present so if you see here
once I hit the resting point the log
says if you see here we have added a log
right if you go to Peter source in
decline we have added a raw log for
before calling so if you see here before
calling there is a trace idea right here
so this is the trace ID it is added by
the spring clock skew so let's clean
this up clear these logs so the server
side is still not able to pick up the
server port and not sure why
I just already in use so is a dat one
already been used
let me try ad 83 hopefully this should
be free
I'm not sure let's see if it is breathin
you're lucky
okay reality so the port 80 degrees
please the only thing is in declines we
have to no change it to 1883 so let me
change it to 80 83 and restart yeah
meanwhile we can clear these server logs
so that we can have a clearer view you
dogs with the trace ID so what I am
going to do here is I am going to hit
the client the client is going to speak
with the server and imagine this is one
micro service and this is another micro
service so we are going to see the log
traceability across these two different
processes okay that is what spring
clouds Lotus Godot so I have cleaned up
both the docs client under seven so let
me meet the client you are so the client
URL is going to press the hello world
from the server side so we have got the
results back here so if you see here
this is declined
so in declines we have add the
sprinklers rules as our address login
here so if you see here this is get
ready so we have two logs before calling
and after calling the server which we
have added here so let's go to the
server side if you go to the server side
the same law has been added to the trace
so if let's say I want to show it family
I just minimize this window so that I
can show both the options parallel both
the logs parallel
if you see here the left side one is the
server side the server side has the same
trace ID as the client side okay so this
is automatically done by spring cloud
sleuth so let's see it again
this particularly well so you should see
the new request with Tod 30 you can see
the next request has c7 PI 5 the same
tracery is present here the next one
which is displayed easy span ID that is
specific to the instance so if you see
here in the server side that is finally
is completely different and in the
client side the span ID some completely
different
okay so span ID is used for tracking
within the Microsoft and the trace ID is
useful tracking across the micro source
okay so that is all these spring clothes
sleuth work so how does a spring clock
slows desert right so if you remember we
have added the rest template configure
it so what we did is instead of creating
a new instance or new rest template
every time in the resource of error we
call it from instead we ought avoid it
using dB
so when we created this instance spring
cloud sleuth automatically injects this
particular rest of it with the record
headers which is neat for transferring
the data across Microsoft's so that is
how spring clothes Lotus helping us in
adding the trace idea across micro
service okay so that's it for this
particular video so if you want to have
a demo of this particular project so I
have uploaded the code base into github
so you can use the same project so I
will be uploading now these two projects
to github so you can download them and
try it out locally in your system as
well that is for this particular video
meet you again in the next video thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>