<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Advanced data mangling with Promises - #14 React JS prototyping | Coder Coacher - Coaching Coders</title><meta content="Advanced data mangling with Promises - #14 React JS prototyping - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DevTips/">DevTips</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Advanced data mangling with Promises - #14 React JS prototyping</b></h2><h5 class="post__date">2018-01-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QdXya2GN-Rg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we are going to do some
advanced data mangling room and you're
watching jab tips with guest hosts mpj
and David so where were we what what is
the problem that we are trying to solve
it I'm just gonna sign in to the app
yeah so we have this app we want to it's
their ours aggregation and we have to
fetch for each playlist we have to fetch
the songs Y and that playlist we saw
that when we had the playlists here a
list items they didn't contain the
actual songs so where are the songs
because there seems to be a tracks here
yeah so I think that this age rap here
that is actually the the API endpoint
for that specific playlist
oh so we can just do a fetch for that
that hf and we will get the tracks for
that playlist okay so we just add tracks
and them the latest I know it's already
made for us oh oh man it's pre-made so
yes when we're here in the fetch yes
it's fetching the playlists and we're
getting the playlist items you can also
add here a attract URL she would do that
or should we just for each now these add
the songs by fetching we're gonna use
that we have to do some processing
before this one hmm
so after the first then here yeah we
have to do like it then here and we have
in the data here there you know and
again can we go back because I don't
remember how quite how it looked like it
has it
rocks property yeah okay each playlist
has a tracks property hmm and that has a
trap yes
so first let's extract that into a
variable that HRF start simple they are
not tracks dot H no yeah exactly but
data is an array of playlists oh yeah of
course
items and I should just do you want to
you want to hmm we want to keep them
together with each item or do we want to
just have all the tracks in explain to
me what you are intending I'm intending
to do a fetch all of the tracks for all
of the playlists and just put them
together yes it's one big thing yeah
let's do a map actually let's let's do a
map of all the fetches we're gonna do
okay that's a little bit weird yeah stay
with me ah so let's do what we would
write data items so these are the
playlists yeah
and then let's map that and and grab for
every item or it's gonna be playlists
let's call it playlists and for each
playlist we're gonna do a fetch fetch
yep and the thing that we're going to be
fetching is that href so on in the track
so in the current playlist yes it has a
tracks
yes which has an H right yes which is
the one we were fetching exactly and
what are we going to do with that one uh
do something here no that's the correct
one but it also needs the authorization
headers oh yeah of course I don't think
that is public data
all right and that will give us a
promise of the response you can remove
the curly brackets because we don't need
multiple lines like that yeah yeah who's
that parents up
so yeah let's break this and assign this
to a variable just to keep track of what
the hell we are doing here because this
is bit tricky if you're not used to
promises purchase of tracks yes you can
call it that that makes sense and now we
need some indenting so what fetcher
subtracts zombie this is going to be an
array of promises so that's an array of
things we're waiting for it to be fast
whereas ice hasn't we can't know when
it's done precisely that's a concept of
our promise the promise is it's it's an
ethereal object or something that you're
right now just like a promise in real
life yeah really it will eventually
resolve to something hmm
and the thing is like we can also add a
we want to make sure right now those are
going to be like an array of response
objects but we can't use those no we
want to convert into date objects
because we want the Jason because if you
see on line 103 mm-hmm we get get the
Jason of the mead or playlist of it now
I do that all the all these fetches yeah
well dispatchers will also have to
convert it into JSON yep how would I do
that best in exactly the same way you
just append then response JSON on the
fetch yeah this is on the first no this
is on demand
yeah
exactly
so let me break this out in two
variables yes so that we can track it
easily easier is easier or see it easier
I'm gonna add the curly brackets here
because I'm gonna start writing multiple
lines so this first one here it's gonna
be the response promise the promise of
response that will eventually arrive
yeah and then we are going to have the
data promise here that is going to be
there is it's gonna be the response
promise but with the data extracted
exactly into JSON precisely so this way
you can change promises and then we
return the data data promise the process
can be a bit funky to wrap your head
around I have actually I on my channel I
have an episode on promises if you want
to dive further into this but just it's
essentially it's just like promises in
real life it's stuff that we are waiting
for and we have ways to attach things to
the promises that happen when those
promises resolve here we have this array
of track data from missus yes yeah
that's right the thing is that we want
what we want here is we want the actual
track layer we want to wait for them to
resolve and when you have many promises
in an array like this you can use a
method that is built into
javascript called promise dot all to do
that gonna do that
so that means that once not when all the
promises I have delivered yeah then
we're going to do something exactly
then hi all track data's so when we have
the know that we have the track data's
we have to merge them with the with the
playlist data yeah
the playlist data is over here it's now
called data and that's not particularly
good because now we have lots of data
here so I'm we're going to call it this
name this to play list data do not
confuse ourselves too much hmm and this
is gonna be a track data promise in step
yeah makes sense promise so now with
that we have all the track data promises
we wait for them all of them using
promise dot all and when we have all of
the track data's because this will now
be the actual track datas this will be
an array of all the track data for all
the playlists then so playlist a up dot
items
let's I'm gonna break this out because
this is let's make this even clearer
because this is all our place all our
playlists yeah then we're gonna go
through the track datas and here we're
gonna do for each actually hmm for each
track later we are going to assign that
track data to the corresponding playlist
item so the first playlist a playlist
item is gonna get the first track data
the second player zone is gonna get the
second track track Vegas yeah so now
that I think of it I'm doing this in the
wrong way because I'm iterating through
the track data we don't want to do all
we can do that actually
so the first for each the for each
callback receives two arguments I
believe the first one is the actual item
which is the one that you usually use
but it also gets the number in the array
a right position in here right which
starts with 0 yep so the first one is 0
precisely a playlist works the same way
they start with 0 so we can do playlists
dot I the corresponding no bayless dot
we just call this song perhaps mmm it's
almost a track datas me and we just
assigned track yeah track data's let me
track date
yeah data with current track yeah
because item yeah because it's it's kind
of a kind of misleading that is contract
data's because it's it's actually tracks
data's yeah
it's multiple sets of a race or tracks
yeah that's like the tracks for every
place but I'm not gonna be to pick it
with named either way once this promise
and on all it's done we it's going to
result to this track say that and then
it's gonna do this combining of the two
data structures and then we are going to
return track data's no no practice sorry
playlists and then right now the promise
chain is broken
we were returning nothing here we need
to return yeah exactly
I'm gonna break this out it's yet
another variable just to keep track of
were I clarify what is happening with
all the promises let all track data what
tracks data row missus this is a mind
better but it's we're doing quite a bit
I like quite a complicated fetch with
many different data streams here so it's
it's not the code that is complicated as
much as the operation is it's
complicated so when the old tracks data
promises have resolved this resulted
them and this will return a play less
promise and then we return the the
playlist promise at the end like this
promise chain so if if this was the
first time you saw promises you're
probably scared out of your mind but
promises are extremely flexible and
fundamentally very simple but they take
a little bit of time to wrap your head
around so allow yourself to feel
confused because that feeling of
confusion that you're feeling that's
your friend it means you're learning and
this is the advanced data mangling
episode it is it is so we know that this
is a bit more advanced yet so yes if
it's hard don't beat yourself up around
don't beat yourself up about it
this is a bit wrong because now this
will be playlists yeah and this is going
to be what playlist the difference here
now is that we will have access to item
dot track data's here result track days
so possibly we can do something like
this track data's what are those gonna
be I don't know how they how they look
let's actually lock them out to see how
they look all right them no dot track
there's a stack of datas let's see what
that looks like here okay oh and each
item is a track okay cool
all right it has an object that has a
track property and it does have a name
now this is one like this object is one
more level than I would like it to be
because this is the paging objects go
off and we're we're really not gonna
care about that at the moment so I'm
gonna just extract that items out there
do something like that I think that
should fix it you're just selecting the
items yeah I'm putting them on the
playlist yeah to the Tractatus precisely
so now the track data looks like a bit
better
oh we have the added property and added
buying here and it's local do we care
about that well it's what is the default
sort if you're looking is that the added
app is does that matter
no it does no the playlist has an
ordering that's the point of a playlist
yeah and where is that ordering I think
the ordering is in these in this array
Yeah right he is ordered oh okay yeah
then we don't have to care about that we
just we don't okay so let me just map
that out yeah map
item item door what is it Chuck yeah
because we only want to have that sub
field with the track data
yep so let's see how it looks like now
now we have each track with all the
information that we are waiting cool and
the track has a name here so I think we
can possibly here yes do item dot track
data and we map over that so we just get
the information that
we want not get surprised track data and
we're gonna create a new object here and
remember that because we are now doing
this online we need to wrap this in
these extra parens here's we're doing
some multiple lines yeah otherwise it
will think we're doing it on multiple
laps but we're I'm just gonna return an
object here gonna do name dot track date
dot name and now possibly there are a
lot of tracks for each because we
haven't chosen just the top ones ah so
here are all the tracks in each playlist
cool can we just get the like the first
three ones yeah it's just yeah what is
that function slice let's try that and
we should do that before we map yes yes
well we can do it after as well but it
doesn't realize now is I want to have
slice words when they are aren't that
many I think it's so fine oops
alright theory yeah all right so each
one now has a three the top three oh
three cool
okay can we do something about the
duration yeah how did that look in there
yeah acts like I think it was seconds in
the original oh yeah well I was thinking
about our mock data we still consoling
in the south yeah just look at duration
milliseconds okay oh we can just we can
easily fix that then yeah so let's just
go to the place where we are mapping
over the item dot tracks track data's
there yeah so you know what we can
actually do you know I'm doing the mat
data mangling that I'm doing down here
like extracting yes the name we can
actually do that up there oh yeah and so
that we can also do that to count the
total duration will just reduce through
all the duration MS yeah but we already
have code that does that in the in the
counter it's just that the code in that
code expects there to be if you go back
to the fake data see that it expects a
duration of seconds yes but we would
like to have all the durations and not
just the top three you see yeah yeah to
figure out the total hours Oh again what
you mean I guess a frame this yes points
yeah absolution would be in crab soup
and that's why I thought that when we
are here we can just go through and
assign that to the playlist
yeah is that a good idea or bad idea
yeah we know that's a good idea doing
that sign yeah sign the duration like
because we already have a thing that
account oh yeah the direction let's use
that the only thing is let's just fix
that it's in milliseconds instead of
seconds yeah okay you do it so I so here
let's break this up in the line so I'm
gonna do another map here so we're
wrapping over each track I'm gonna take
a chain grab this map instead here mmm
I'm gonna make use of that paste that in
here alright and it's right now we are
basically cleaning up the data a little
bit like we're getting from the east
check that it's working here yeah it has
to top three yeah yeah but we want to
fix the fact that because the track data
in our data structure that we made up
and that we
works on the components that we have is
a duration of seconds yeah but looking
at this data we see that each okay how
would we saw that that it has had a
field that was duration underscore ms4
milliseconds
exactly so we should take that and turn
it into seconds and add it as a duration
if I find myself again here so duration
: track data duration m/s let's see
divided by a thousand oh yeah in seconds
that's pretty cool that is pretty cool
right so we just cleaning the data up in
one single place and everything just
works yeah and if we look for the Joker
no okay we're just filtering the
playlist yeah good morning Vietnam say
that is nine hours and if it has to
where Sanderson that's what's also nine
hours and if I had these guys you know
this episode is not as long yet can we
add filtering for the tracks as well
that would be amazing
can we just how would we how would we do
it you would just make a commit now
before we start doing that it's okay
yeah before we things up yeah when
things are working and it's like oh it's
working
then that's a good spot to make a commit
added sub fetches so you know what let's
remove that console log let's message
this do we have more console logs I'm
pretty sure we have I think we've been
moving good added sub fetches of tracks
you do each place pushing that
okay so now let's ski now let's do the
filter thing yeah and we filter so if I
type type the Joker or something duh it
will only show those yeah let's say
let's I'm gonna let you do this
it's it should be pretty pretty
reasonably simple to add to the filter
function wherever that is this is
getting this it's actually getting a bit
big now on text filter string text
context change yeah that is just
updating the state very sexual I think
it's in the render okay here this is the
fearless yeah playlist to render okay so
now it includes all place that has that
form so what would the logic be like
would it go for either the playlist
title I think it's like we're just to go
on if it's if it's somewhere let's just
make it simple
what do you mean by Reese is somewhere
like if it's if it's in the title or the
you know what's arm tracks yeah okay
let's just do this is gonna need multi
lines yeah registered
this for now yeah and currently it says
return this yeah you need to move the
parents like this now there is a you
need to have a parens
I like the filter gets the function yeah
like that okay so here we return if
there's a plate is so has playlist
matches a playlist
matches playlist yep
sweet and if it matches playlist oh yeah
yeah because then I would just return it
if is playlist for awesome matches track
sweet now we're saying tracks because
Spotify cause the tracks or songs really
college we actually call it songs here
so we let's call it matches song let
matches song equal to okay so for the
playlist it has the songs no no no
because that is just the top songs yeah
we have to do the we actually do have to
do a slice here as well
no but haven't we done that here now we
do that depends on what we want right
yeah do we want it to the filter to work
on all the songs in each playlist or
just the visibles yes because yeah like
it would make a bit of sense to have it
work on all the songs but it will also
be a bit confusing in the interface too
if you wouldn't understand what it was
that it mattered matched yeah I think we
should just go for the simple songs yeah
yeah perhaps that's why people don't
have that in there what
let's do it yeah so whenever we'll write
some text a test match for ya top
science so let's duplicate that slice
operation that we had in playlists
because we need to slice it here as well
do we yeah we returned it here
we had sliced the track data's to the
songs yeah this is just a rendering
function oh wait oh yeah you're right
you're right you're right in this exact
I think we just walk through the song
you all right you're right and filter
them I guess
so on and return if this song it's just
a string
yeah to lowercase includes this it's a
bit repetitive but yeah let's just work
with me now I think I'm with you
that should work right I think so
let's try BAM okay something I think I
did a typo song to lowercase this is not
a function
now the name to have that song dot name
yeah maybe yeah because it has a
duration right yeah I think so yeah it's
an object with duration and name
let's just go try that so if I write a
rabbit this one should pull off did not
work huh seems to match everything leave
I know so there's something incorrect
here do you get any errors in the
console great idea no no just the old
margin warnings okay so let's think this
through if the playlist with the songs
filter out oh wait hang on yeah matches
song is always gonna be true why because
you're filtering it so you're always
getting an array oh sorry this so you
should length is yes greater than zero
exactly but you need to spell length
correctly all right let's try that so I
type a rabbit yeah that's pretty cool
that's pretty cool and I type do we have
something that is repeating itself
somewhere and I don't morning perhaps we
have that in several yeah that's cool
that's pretty cool can't wait like so we
have morning here and now morning here
and both are returned which is exactly
what one that's pretty that's really
cool that's pretty cool
and if you were to want to have the data
underneath I guess we just not slice it
here and just slice it when we render
yeah exactly yeah can you just fix that
so it doesn't you can you can use find
instead of started filter then it would
work actually
oh because that will return only one yep
morning yep
it will also be faster because find will
stop wait supply mapping otherwise it
will create an array of everything and
if I type something incorrect here like
yeah live or them it doesn't find
anything yeah that works and if I delete
it everything here I think this is a
good day's work
this is everything we need of course we
could do like minor details like fixing
this with the name and all that stuff
but for what we want to show this works
just like the overview in the Spotify
application right now yeah with the
addition of having the top songs which
we think is pretty cool yep Oh commit oh
okay let's commit that lets commit that
filter now also applies to the top three
songs per playlist pushing and that's
deploy this was way easier than I
thought
and what this is pretty cool
of course this is not perhaps the most
readable code but it's good enough like
I think it's reaiiy I actually think
it's reasonably reasonably readable
except possibly for the pretty
complicated finishing part I think it's
just white lips oh wait I might be
sensible if we wanted to make this a bit
prettier to break it up into files where
it makes sense again it comes back to
the high fidelity provider we want to
prove a concept we don't want to create
an attainable app because this code will
be at best the developer is going to
look at it for some kind of reference
probably not to be honest the door is
gonna throw it away
yeah the intent is for a stakeholder to
just use his or her own data and just
see it magically work here in the filter
yeah exactly because this this stuff is
way less compelling if it's using sample
data rather than your own data you're
gonna be so much more engaged with the
prototype where it's your data
and I was scooting up the back down
waiting for that one it's on the
Internet in the next episode we will do
the final styling to make it look really
really good sort of it's all it's it's
the almost final episode yeah it's a
final episode where we actually do stuff
we're gonna have like a final episode
where we talk about and wrap up yeah so
you can click here or click in there to
see the final episode will reduce
encoding</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>