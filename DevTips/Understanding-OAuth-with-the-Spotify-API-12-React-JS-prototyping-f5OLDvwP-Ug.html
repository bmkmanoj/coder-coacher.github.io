<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Understanding OAuth with the Spotify API - #12 React JS prototyping | Coder Coacher - Coaching Coders</title><meta content="Understanding OAuth with the Spotify API - #12 React JS prototyping - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DevTips/">DevTips</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Understanding OAuth with the Spotify API - #12 React JS prototyping</b></h2><h5 class="post__date">2018-01-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/f5OLDvwP-Ug" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we are going to be using
OAuth to log in to Spotify giving us
access to a Spotify data of the logged
in user and allowing us to pull that
into our application
you're watching dev tips with guest host
and Vijay and David in the last video we
set up some data fake data we've done
that in a couple of videos and now we
want to setup actual
sign-in with Spotify yeah so we want to
pull the actual data from Spotify and to
do that we are going to be using
something called OAuth the way off works
is a little bit funky because it needs
to be secure and in order to do that it
has to go back and forth the bunch of
times and it's tricky but we need it in
order to not leak the credentials so the
react app that we are building the
better playlist apps needs a token to
fetch data from Spotify and what is a
token a special code yeah that has been
generated that is valid for a couple of
minutes 30 minutes or so
alright so it's like a temporary key
yeah temporary temporary key code and to
get that first the user has to go to a
back-end server which has an
understanding with the Spotify already
so we will have to create sort of like
an account or an app at Spotify yep and
then we have to create a back-end server
yep and have that working and then our
actual react app will take the data that
our back-end server is returning if
everything that was fine with the
signing in exact it sounds complicated
it is a bit complicated but I think we
will just hit it off start building it
and you will get it yeah let's go to
Spotify and create the understanding
between our server and Spotify
all right cool cool my apps signing so
you have to be a Spotify user to create
one of these apps so I'm signing no I
have oh alright
let's create an app right it's called
better lay lists and let's give a
description so when people are trying to
sign in they will understand what is the
purpose of this this will give you an
overview so here we have the application
and these are the important parts
what is this client ID and what is this
client secret because a client ID is
sort of the its this is sort of like the
username and password for the
application that we that we created
client ID is something that is shared
between our front-end and back-end and
that is fair game
there's nothing secret about that but
the client secret is what our back-end
service will use to negotiate with
Spotify in order to get the current okay
so spot if I will only trust the request
if it's given with this secret
precisely and that is why it's so
extremely important that this is not
this is actually why we need the backend
because it needs to be protected inside
the back and not be leaked to the client
because if it we were to build this on
the client side anyone could sort of
like inspect the code behind this and
then they would use them to do bad stuff
your name precisely in this series we
are trying to create things from scratch
as much as possible but within realistic
boundaries for instance we chose to use
create react up in order to not spend
too much time setting up the boilerplate
of that thing and actually get to
building things so if there exists
a thing such as a Korea create react up
400 auth we would have used that but it
didn't exist so I built it like 10
minutes ago
and put it online and we were gonna try
to try to use that so we I created a
template for a back-end service that
provides this authentication flow for us
at mpj that off bridge template okay so
let's let's clone this yep good thing
git clone we can call this better
playlists and background alright thanks
good that's back and and do NPM install
I guess yep and then we probably have to
open the server code let's open this you
know our code editor to see what it
looks like so there's not much here only
thing that is interesting is this server
its server touch is do I even have to
look you don't really have to touch this
because there's no magic in it or
anything because I don't have to run
this locally right I can we just
deployed we can run it locally but let's
start by running it locally otherwise we
will we have to redeploy Roku every time
we make that sucks
so I have to export the client ID and I
get the client ID from here so export
what you can what am I doing here
yeah the the export like a command this
is not no js' or specific to this
application
exporting
most like this this is part of the
command line in the terminal or the the
shell environment as its called
so what this does is that it sets these
as variables in the current terminal
session so if you for instance wrote
echo and then it's for a client ID that
would work you need to have a dollar
sign as well so now this is available in
this in this specific session and it's
also available to software running in
this session as well so it's kind of
like configuring so we're tying into the
machine because you don't want to have
it here in the code for everyone to see
you just want to have it on that machine
that will be running this software
exactly so since these are secrets you
don't you never want to commit secrets
to your git repository because if the
git repository is breach is breached by
hacker is very good if they just get
your code and not your secrets as well
because that means that it can do
enormous amounts of damage yes the code
is not it's damaging but it's it's it's
not that bad okay
let's start it cool that work go to
login to attend to Kay so here it says I
should go to this page let's go there
invalid client ill when it redirect URI
all right I know with this all right
cool I saw that here yeah but what is
this what is the redirect all right so
redirect URI is when we talked about
this a little bit before it's when you
send the user off to login
that's bonafide because we can see in
here that is the user has been sent to
accounts dot spotify dot-com authorized
and blah blah blah but Spotify tells us
that this is bad exactly trying with
something that hasn't done everything
precisely and this if we go back to the
client to the key we can actually look
at the server code for a bit you don't
have to get all of this I'm just trying
to give you a sense of how this thing
ties together it's
completely okay if you don't get half of
the details that's that feeling is
normal so we serve to this the /login
yes and what happened is that
immediately the back end is redirecting
to accounts that Spotify dot-com yes
with all these query strings yes and
they are the ones that we see here yep
these are the query strings precisely
and it also sends a redirect URI and
that is a variable and you see it there
on line seven and it's that one it's
redirecting to itself but slash callback
the thing is that we have to tell
Spotify beforehand that this callback
URI is okay like there are complex
security reasons for this but if we
don't it means hackers have it easier so
we'll just paste it there at it and this
is such a bad UI that you have to scroll
down and save but you have to add it and
then scroll down and save and not write
again cool boom right so now we are on
Spotify and it's asking us to connect
better playlists to your Spotify account
yeah but we didn't we didn't go to
Spotify dot-com we went or a local
server which redirected us to Spotify
sign-in page and because all the the
credentials are okay the secret ID and
the the ID and secret everything is
looking good here yeah and we can click
here to see what kind of data Spotify
would like to get from us yeah or
actually what kind of data the app would
like to get from Spotify about us yes
public information your my subscription
details and my email address yep okay
sure and it slowly and it's loading and
here it redirected to localhost our
other server the react server yeah
our redevelopment server a react
development server and we have specified
that here somewhere right
what did we know didn't know that it was
supposed to go there
I heart coded that it assumes that you
are running a running a redevelopment
sir oh that's awesome but what we see
here is that that it's sending this
access token so this is what we would
have to use to start actually fetching
data exactly so what we are gonna do in
the next episode is to grab that from
the from the URI yeah using javascript
and use that to fetch things from the
Spotify API playlist and stuff okay so
that's in the next video now we would
have to build to deploy this server here
yes or Heroku exactly because we want in
order to use it we we have shown how to
deploy our react front-end to Heroku and
now we are going to deploy another
Heroku app which is the back end we're
going to deploy that separately okay so
then I could just follow your tutorial I
think so yeah I wrote the commands in
soil but it's basically what we already
did
Heroku create my okay so first we have
to create a new Heroku app Wow just like
we did with the pack in the episode
where we put it into proc the great
reactor a stronger rope you see if we
signed in we are yep Heroku create
better playlists back-end cool that
works and then we should run these
exactly so these these commands here
they are the same as the export commands
on Heroku
okay so setting the variable on Heroku
yeah so that they that sticks there and
again the reason why we just don't write
them in the code is for security
purposes so this is the secure way of
doing it
exactly so we copy the clients client ID
set that now we do the same with the
client secret on redirect to variables
that we don't set locally because on
when I wrote this template I can assume
that you are using a react app locally
and I know also that you're running on
localhost 8080 to date however I can't
know what name you chose or your Heroku
s so this will be the react app that we
have pushed to the production server
exactly okay so it's like redirect your
I HTTP so you can copy paste it from up
there but you also need to add slash
callback and used to like give you a
sense of why you need to do that if we
jump back to the code there on line 21
see that this the backing server has
this endpoint slash callback which is
the one like that is receiving the
redirect back from from Spotify which
receives a code which is then uses along
with the secret to grab the access token
and then it takes that access token and
sends it off to our front end alright
and then we have to do the front and URI
what is the front and URI is like not
the back end this it's where our react
app is hosted on in production which is
playlist or Heroku app calm I think no
it has to spin up yeah this is one of
the disadvantages of using the free
version of Heroku if your app goes to
sleep if it's not used for a while so it
takes a little bit of time to spin out
so here yes so we can just use this do
we have to add something to that or is
that just no we don't think to add
anything to that so this is when I'm
signed in and Spotify and Spotify has
approved the app credentials and I have
approved as a user that the app can use
the Spotify data the Spotify site sends
me back to the actual react at and this
is the app yeah that's almost right now
it's right except that you're forgetting
that it's our back-end that actually
sends us to the front-end oh yeah
because it sends back okay exactly
because it's it's only the backend that
is allowed to get the access token so
when when it has received the access
token it just adds it on to the to the
end on the front at URI and $0.12 us
there since a user there if I go to
better playlist background
slash login yes this will work yes okay
I say that with great confidence so
we're going to play better playlist back
and not Heroku ah yes login yes did not
work did we deployed no we have not
deployed it oh we haven't deployed it we
need to actually push it oh yeah so
we're going to oh we actually need to
connect stuff yes but this is not a git
repository yet well perhaps it is when
we created it yes
yeah it has a rocker oh it did he wrote
the Heroku command did that for us so we
can perhaps we should just push it
perhaps we should commit this to your
exact thing I'm not
let's check what now we haven't changed
anything in the code all we have done is
downloads on it right right we've flown
that we cloned it and therefore it's a
git repository yeah I'm done and then we
set all this we don't have to do
anything unless we change it so we can
just go ahead and post to the remote
that is true that is true because we're
the changes that we make or they yeah
push Heroku and then we're posting the
master branch yeah we don't have to do
any I'm a genius
no there we go all right now it should
work reload invalid redirect oh yeah yes
yes here we only have the radio direct
you're right for our development
environment but we should just add for
the new site yes and it's also called
back because it's the same service just
in another place yep
so it has function support for
everything yeah and now this login yes
the backend in production slash login
but you know you know why do you know
why yes cuz it didn't scroll to the
bottom and because I didn't save the
changes and they had put that at the end
it's it's such a horrible UI
ah first coders ever I used to work yes
it just sent me here with access token
because I had already approved yeah
exactly so if I sign out from Spotify
yeah sign out cool did that sign you
see clogging yes yeah it did it long in
to Spotify with Facebook and I was
already yeah yeah and we have the access
token stuff here so I guess where we are
ready for the next episode so in the
next episode we're gonna fix this stuff
we're gonna use the Spotify signing
thing and just fetch all the data from
Spotify for the use of that assignment I
know it's frustrating that there is I
was not a lot of work going on in the
sense it was just setting up this this
flow that is pretty hard to grasp once
you do it for the first time but trust
me the next episode is going to be
awesome because now we have full access
to this 45 API so follow us in the next
episode where we are going to replace
all our fake data with actual bona fide
Spotify data from your Spotify account I
hope I don't have an embarrassment yes
so click here there didn't you continue</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>