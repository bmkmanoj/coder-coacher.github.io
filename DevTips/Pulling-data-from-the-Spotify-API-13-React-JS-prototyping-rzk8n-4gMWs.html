<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Pulling data from the Spotify API - #13 React JS prototyping | Coder Coacher - Coaching Coders</title><meta content="Pulling data from the Spotify API - #13 React JS prototyping - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/DevTips/">DevTips</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Pulling data from the Spotify API - #13 React JS prototyping</b></h2><h5 class="post__date">2018-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rzk8n-4gMWs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this video we're gonna pull data from
Spotify and attach it to the react them
so it will finally become this high
fidelity kick-ass prototype you are
watching dev tips with guest hosts and
PJ and David okay so we have the off
shift
yes they all have the react yet yes and
the earth is Spotify and we just need
the data how do you get the data alright
so the first thing that we need to do is
to extract the access token from the the
earth remember in the last episode where
we know the first thing you need to do
is to add it can't look like this when
you come here it seems like I'm signed
in we should just make a template when
you're not signing on and add a sign-in
button sure
should we do a state or should we just
do this survey data remove the fake
server date and just say do we have
survey data
oh yes way I've surveyed ate that okay
yeah that seems nice so we had
previously done this to fake survey date
damn sure remove that yep now we have no
certain server data cool and I would
just say loading yep because nothing has
happened so we had this thing with
loading press we should just put
something else there we can just put the
bust on here yep let's do to sign in
cool let's do that
so now we have a button unless you're
signed it yeah or unless big we have the
button if you don't have user data yes
exactly so let's do how can we make that
something happens when I click the
button
yeah just add an onclick handler to the
button um click yes and a function yes
sign in we can just have the function
inline here okay we don't need yes that
I create an arrow function and then what
is it look window dot locations what you
want I just type in the arrow function
here yeah it's just gonna return
something no no don't return just window
look just do the redirect here and I
guess equal to localhost a to date but
if when we publish this we don't want to
have local whole story yeah but we can
fix that later let's make it work
locally first so this is the back end
server yes that we are running already
yeah or we might have to start using our
past we are not running it does that
work yeah it goes
yeah of course it goes down but we are
not running it there like our girl back
answers so let's just go to the better
playlists back and and p.m. star yes yep
do we have the maybe we buy we might
let's see yeah it seems like we did so
what I was talking about was we had to
have the credentials there this secret
and the client secret and the client ID
and we still had it in in the turn all
exactly perhaps we should just remind
people how to do that in case we lost it
you just create a new terminal and show
what it would look like if you miss it
you would write exports and then this
fortified client ID equals something yep
we shouldn't do that because then we
would all that's sure the truth so let's
just leave that alright then I login
Spotify I have authenticated with
Facebook and I came here with the access
token yes cool
so now and it didn't ask me about if I
wanted to offer approve because I did
this did that already yeah it remembers
that you are ok with better playlists so
but if one of these sets have signed in
it's just like oh you're David oh you
have it you have approved better
playlists just do the redirect okay so
now we want to use this access token to
fill up the server data objects which
will then remove the button and just
show all the good stuff yeah perhaps we
should just go to the server data and
see well we can just delete this
actually or we should have to keep it
just to see it you have to see how we
want it structure let's just keep on
Sheamus
so perhaps then in the if we go back to
the component did mount thing yeah here
I don't quite remember how to extract
the location how do you do that I
I think there is some kind of query
window.location about query string query
yeah can't console log that out and we
can actually do that in the developer to
introduce you know okay query path name
no queries search search is it search
yeah it's search so that's everything
after the slashes but I think that there
is one that actually gives you it as a
neat object or am is completely
forgetting things here search parents
their earlier
this search grants you know what we can
you let's do this with an NPM module
instead okay so anyway that can react
yes
so what we do here is so our problem is
this like if we just write the search
thing the problem here is that this is
just one big string and what extract out
the value of this field yeah so let's
just find an NPM module to do that for
us
NPM square e string maybe yeah okay
here's an example doing exactly what
won't this
yes but comstor left left craps yeah
and then we have to install it yeah yes
yes exactly
see uh steam ports and just query string
yeah exactly but you do it like the
react thing about import query string
like you need the first thing that you
do is like what you want it like that
yeah so the first thing after import is
what you want it to be called and then
the thing after from is the name of the
package shown and pad
so with this work no no but I want to
show you in what which what way it
doesn't work okay so very straight with
the big capitalist they called it look
variable their indexes are location
window.location yeah probably
and then just console this to see what
it looks like never have it I'm actually
surprised that this word I think that is
query string installed by default in
crate react up can you look in the file
browser and the package dot JSON I think
that this just has a has the query
string already installed mm-hmm
but let's imagine that it wasn't
installed because they get this this I
expected this break as squares wrong was
not installed so you jump to the
terminal yeah
no no the terminal no the terminal sorry
and here we are on this one yeah let's
open up a new tab sorry that you don't
we don't need to break any of the
running things and this is the directory
with better playlist - yes so what you
do here in order to install a module is
to write NPM install - - save query
string query - spring I think it was
called you sure
let's check it yep yep yeah so what this
will do
yes I will install the pull down the
query string and add it to node modules
which will make it available but what it
will also do is as its going to add the
package to package Jason so that when
you check when another person or use
yourself in the future like this out
here yeah it's going to it's going to
install query string also when you run
it
cool all right so now I have the
possibility of getting that token from
the query string yeah was it called
refresh token access to access token so
this means that yeah you can hide the
file browser by hitting come on be the
taxes too can be parsed dot access token
yeah yeah that's it so now we have the
access token so how do we use this with
okay cool okay so this is an a kernel
example and we need to so curl is a
thingamabob that you can use to do HTTP
requests using the terminal but what
we're going through I don't see access
token is this it's there you it's in
that are just working yeah so it's they
don't actually use the word token but
it's like authorization bearer so I
think I think I can do this from my head
let's see if you can do it we're gonna
use the fetch API mm-hmm which is any
thing that we have access to in modern
browsers
it's what replaces HTTP request of XML
HTTP requests and it also makes jQuery
AJAX obsolete so we can just do fetch
sure to do it there yeah fetch Oh
captain no no yes fetch and then it's
that's a function mm-hmm and the first
argument it should have is the API
endpoint so that's the
this whatever we want to fetch yeah so
let's just find a nice endpoint to
access like me I go to end poor API
endpoint reference I think there's a me
there yeah this one yep and it was API
right yes Pacifica yes yeah that's 45
calm well that's the end point exactly
and I think that the second argument is
a ha and we want to pass the token as a
header the thing where exactly there is
it value bearer
oh there's actually a jQuery AJAX
example let's use that as the base and
translate it to the fetcher yeah I think
you can actually use exactly that this
one yeah or everything no no Earl we
already specified oh it's not exactly
the same syntax as jQuery AJAX it's just
pretty close all right try that and you
received what happens with this one
we need that fetch will return a promise
hmm so that means that we want to call
them on that promise
yeah so once because it's gonna take a
while for the browser like a couple of
milliseconds and then once it's done it
should do whatever comes here yeah and
I'm not really good with promises is
that also arrow function stuff yep
precisely so that then function we'll
get our response and on that response
you wanna we want to get that response
as JSON so we call response doc a
response dot JSON hmm that's
method if you want to use the curly
brackets you need to return it as well
okay then we're just not use the curly
brackets and this will in turn return
another promise which we also call then
on but this time it will be the actual
data so let's for now actually
console.log that data out to see if we
actually get this bar just check out
open the console perhaps see yeah we do
that's you that's me that's you all
right but everything here's about me me
me me me I have 11 followers I don't
know what that is this is not the
playlists these are not the play we need
we need this we need the display name so
let's start with that yeah so yeah set
that to these the update the server data
so once I get this I will instead update
the server date down yeah I don't this
is easy this start set stage yes server
data don't juice or dots name can I do
that no no no no I just have to server
day user name and then I take the data
just got yup display name exactly down
there yeah safe
oops what happened oh yeah
so now we end up in that case actually
where we have a user with no playlists
oh yeah yeah because we're having set
the playlist yeah in our test in our
sample data the case where a user didn't
have any playlist we never that kiss
didn't success to me because what we say
here in the react app the app component
we say if we have server data that has
some kind of user data yep everything is
fine yeah we just roll along with
exactly but we only have the name we
don't have the playlist stuff all right
so how do we solve this problem is that
we have to fetch the name from one
endpoint here yeah and then we have to
fetch the playlist from another endpoint
yeah and this is every that my name is
in the response from the playlist
probably not like I think that we even
if it is I think that we should keep it
like this because it's a great
demonstration of the fact that API and
api's are often not perfect and you have
to mix and match things together yeah I
think that we should instead make a
react app handle the case that there
might not be any playlist on the user so
we should just have if this is used it
should do this but we should make an
extra check here for playlist counter
hours counter and the field and
everything will just make the same thing
here if the server that that user has
playlists yeah because this part of the
code is dependent on playlists never
would have to wrap that in a div yep
because yeah
the girls react will not take kindly to
multiple elements being returning these
but we can do with the double ampersand
because we don't have any we don't want
to render anything no it's like this and
then we can't use just indent it cool
typeset your work don't you think about
this stuff
no that stuff happens there
so perhaps okay so revert that so check
we need to fix we need to check if the
user actually has playlist up there as
well should we just do a check here if
there is a user and test playlist and
then set a variable and use that
variable for this check instead what
would that way we will be called user
with the playlist data yeah or we could
just check and playlist render not here
so if this state is you sir and yes
state the server data don't use sort of
playlist exactly some line breaks here I
think I usually break on like before the
let me show you how I did first I like
to place these and Seaquest like that
then I like to place this use these as
like kind of headers or startup
sentences or something I get it
then you will do the same with there :
exactly like that okay yeah that's cute
but you can do that any way you like
like there's no right way is like this
so why why does this work this works
because we're not actually using this
state to serve it at the use of playlist
States we are creating a new playlist to
render yeah and that is otherwise we're
rendering nothing yeah so what is
happening here is that this is actually
running everything here yep it's just
that the playlists to render array is
empty
yeah that's where we see these zero
playlists and zero hours which is sort
of that's good yeah because it says that
I have zero playlists yeah I don't I
have more yes so let's move on so now
it's actually fetching some data to it
we're we're we're beginning to work
through pull data from your stairs
fortifies the playlist data yes let's do
that
so I guess it's sort of the same yeah I
will do the magic vÃ¤ri magic copy
pasting wait yeah no I need to meet yes
oh all right cool do you want me
playlist yeah exactly
and then let's see what we get out of
that
all right so it's an object with an
item's property which is an array of all
playlists okay and it has a name
yep it doesn't have songs we will have
to fix that
yeah so let's just do the items name so
if we get this we will set the server
the user playlists to data dot items
yeah this will get the data we get items
and this array and we'll use that as the
playlists array yep yeah that will
actually work it can read the duration
because we don't have duration in yeah
oh now it starts with the songs but we
don't have any songs because they are
not called songs sweet yeah just I think
that we for now we need a little a
little a lot you just skip the hours
counter for a while I uh
we can disable that for a while yeah can
I just comment it out and I think I
think so we'll get to it
did you alright Tanis
with them man yeah because the
playlists' expect sir you know what
let's just create some mock songs for
now I think it's better okay it let's
pull the powers counter back hmm
and I think you're like yes mapping
inside the when we get the response just
to mangle it to be what we expected to
hear yeah so yeah like data items dot
map mm-hmm so that we transform it to
what it is that we want just item and we
would return the item with just the name
yeah
would that work well we need to return a
new item of course with a name and we
just add a and empty songs already yes
and now you have like we've lost you now
yeah and like I have no idea how many
parents and stuff you really need to
start thinking breaks here okay that I
think that works so when you're using
the arrow function like this and you're
returning returning an object literal
hmm with an arrow function that the
JavaScript interpreter gets confused
because it doesn't me know if you mean
to start an arrow function with multiple
lines or if you're trying to return an
object so what you can do here is you
add parens around the curly brackets
precisely
like that so now it will work try
removing the loading of me and just
keeping the playlist and I think it will
work
this part yeah comment that out yeah
so that is why so sick state we have
like multiple levels here oh oh oh it's
over it's over it's over writing the
server data with a new object oh yeah
extend the old data yeah it does
yeah it doesn't do any clever merging No
so either we do start doing some clever
merging or we simplify and place
playlists at the top level let's
simplify yeah top level outside of user
or top level instead of server data
inside your server data so it's it's
gonna it's gonna work but only on one
level okay so yeah so a learning here is
that you save yourself a lot of time if
you don't have a nested nested reacts
they put multiple levels levels down
because it makes it a lot easier to work
with if you want to learn from our
mistakes okay so now this is fixed but
then we have to use that and just go for
the state playlist everywhere yeah so
we'll just use command D to find all the
places it says serve add a user playlist
yeah but it's just one place like that
yep so
so now possibly should it I think it's
checking for playlists somewhere now we
do all right
now we never have any server data oh
yeah
so then it's it's looking for sorry
so we do the same for you sir yeah but
for now we just comment this out now we
have the user so let's just fix that as
well okay oh yes like or we don't with
the if you uncomment the loading like
the loading of your use of the me
endpoint yes and make that populate the
user alright I'm satisfied yeah alright
so now we have the user on the zip state
so now we instead of checking for state
no server date about you sir
we just state user like that if you're
wondering what David there he selected
the text and he had to come on D several
times which allows him to end it in
multiple places at the same time it's
available in most editors like blah I
know it's hella very available in
sublime text 2 as well I think it's a
bit a little add-on as well it's pretty
sweet yeah so it has my name and it has
my playlists yes but doesn't have the
hours because we don't do the duration
yeah so does yeah ok yeah because we
don't have the songs at all yet yet cool
we could fetch like how many tracks
there are from each playlist and
something hmm well
this is really cool it's just that we've
done a lot of stuff here so could we add
the image of the playlist here oh that
would be cool let's do that where is it
snapshot ID no images they don't have
any images it's not true though this is
some kind of example response from there
yeah in their example or response there
are no images yeah but this is not an
actual response this is just something
that they have copy pasted into there so
if we just a combination we get yeah
let's do that this is an example of how
documentation is not always perfect and
you quite often have to actually inspect
the result of of the API in order to get
figure out what it actually is returning
okay so now we remove this thing and I
will actually use curly braces yep here
and return that object so many curly
braces because I want to console.log
take that of items okay cool see what
everything is working and here we can
see all the the playlists are being
returned and this is what they look like
you know just yes we have images okay
cool so they are objects an array of
objects for two they have different
heights so yeah same image but different
sizes so just just the first one yeah
and it's your so what do you call that
you know we haven't created that on the
data now can just put it here yep just
call it image and it's in item dot
images and the first item because that's
the most resolution yeah sure or is that
stupid let's do that for my is it for
now
it's just get to getting working URL I
want to do one thing later but come on
comma there and then we're gonna use the
image URL in the play list component
image source equals playlist dot image
URL yep boom yeah but we're having to
style it in anyway yeah but we had seems
like we have to do a little bit of
styling here what's the best way to
style this yes add a style here a style
thing which which with with 160 pixels
you need another level of curly brackets
of course better is this yes because
it's so compact then because we're using
percentage yeah sure all right let's
just go for this this works this works
this is not the styling episode no we're
gonna this is fine but you know what I
would like to do because these images
are kind of large they do let's just
grab the one that is of the this
slightly smaller width oh yeah we saw
that in the console
they were checking here getting a
playlist I can we expect these to always
be this I think so
I think so order I think so so grab the
one with yeah let's come in small one
actually so now you can use the array
dot find it works almost exactly like
filter but it only returns one item
have you lost yourself yes here there so
instead of there
yeah don't find and then it's just
exactly like the like filter it takes a
function it filter function no no I
don't have to type return yeah it's just
image image dots with equal 16 yep that
would work and it will does it know to
understand that this is just one object
so I can do the dot exactly precisely
because fine works like filter except
that it X it's just one item yeah and
then we can accept it the width here in
the component to just be sixty sixty we
don't actually have to do that because
it will be six okay is it is it a number
like the image width is number perhaps
is something images oh its height
nobody its height and with the same
thing it's the same okay alright that's
weird
there you are square oh maybe they don't
always have images oh yeah thank you
true maybe it okay
they don't always have a 360 image and
it seems day always and it might be that
one fucking image doesn't have the 60
image who knows my idea was
over-ambitious I think so what happens
if we just do the bad coding no we will
just always be fetching a slightly
larger image that we need it's no
problem
not for this prototype I was just trying
to be fancy that will be a problem ah
yeah that's probably right it doesn't
always have three images three images
but it always had the one big one it
seems well it was has one so it's
possible that and then I started to
sixty yeah okay let's keep it like this
another thing that you may notice is
that I don't have only 20 playlists
because I guess the API doesn't just
give you everything
oh it's fascinating alright right but I
think for this demo it doesn't matter
no I don't have to see all the playlists
yeah we just want to see it work and
that you see your own data so that's
fine we will just discard that for now
yeah does the filtering work by the way
no yeah because we have it it just
depends on the data looking like it did
before
yeah cool let's commit this to get so
what we did what did we do here and we
added proper data yep
placed fake server data with actual
spotify data from the signed-in user uyb
and push and push
now let's push this to your Heroku oh
yeah because that would be cool because
now this is only on localhost yeah but
it should work because we pushed it
should it should actually work master
alright so now we put deploying the
front end application to the front end
Heroku yeah and we don't need to do any
changes on the back end here oh cool
right
it's not dependent on this it lives in
its own hopefully world yeah I think we
won't yeah there's no relate to changes
there it should just work
alright let's try this this is cached
after reload refresh now it's damn it's
unexpected Oh Harry it was cached it was
cached ok ok but what has happened here
no we did we have not added the login
yet we need a login button we forgot a
login button but then do we do it if I
was know this but perhaps the login
white what how are we determining login
I don't know let's go back to the local
local machine and remove the access
token there oh not a true ok cannot read
properly map of undefined
so oh it's check it's doing the way it's
trying to fetch data even though it
doesn't have a token oh so let's fix
that yeah so just return here if the
access token does not exist like that
yep
that should fix that problem then if I
sign in okay so but we remove the extant
here why not if the stage you sir
no I think it might be that problem it's
just that when it's deployed it's not
the the errors or less violent mm in
production they are just hidden in the
console but when we run the react
crate reactive development server it
just explodes in your face
okay so redeploy with that so I'll just
add this commit first deployed deployed
let's go here and update this deployed
at it seems to have to refresh a couple
times sign-in with Spotify it's working
and if I remove the access token no so
my signing stage is with the access
token yep so would this work if you sign
in with your user okay what it would can
we do that yeah sure you can lower
yourself out now I mean while we are
simultaneously signed in because this is
only like with the total bake and only
hang on a minute hang on a minute why is
it a local host
hmm because we hard-coded this I told
you what wait a minute hello yes Tommy
dolly and I was like yeah let's do that
later location I don't port okay is
there a better way to do this or can I
just
well if the location contains localhost
I guess maybe location of the protocol I
mean plus location dots and it's window
look now I think you're overcomplicating
that's it so yes check if window dot
location dot H ref contains can you not
do this on one line and make me crazy
okay let's do like this I'm thinking oh
you're just checking if window dot
location dot href contains localhost hmm
then we redirect to the local host
server or its includes local host we
learned that okay yeah
then we do what it did before we just I
would write it like this if that is true
yep we'll do what we did previously
yeah send it to the local host yep
otherwise yep we're we send it to she
was just hard code yeah play this doctor
Roku app calm slash login
will this work this impacts you are
forgotten one curly brackets it's always
another curly braket think so this works
now and then we have two really
different yes fix personals at work in
production this episode is really long
but it's a lot of content real
programming I know
alright let's try this again
if I click sign in here I ended up at
localhost I still think it's just
because it's cached come on why did
break window
because it's not href you should have
tested it we should have Destiny locally
locally okay so now we stop there let's
just reload refresh a couple of times
and try to sign in refresh tread sign-in
it goes to login but it should go to the
playlist dr. Matthias when he left it's
just here let's try this once again Rory
alright this this this is it I think
this is the time I have a good feeling
about this let's just refresh it a bit
yeah
good feel about this oh it's waiting on
better player yes yes yes yes yes yes
the progress that's progress
I'm very excited about this it's fast
and Vietnam everything's working
ok thank you for watching this extremely
long episode in the next episode we'll
keep on coding and adding the small
songs the preview of which songs are
contained in each place yeah I think
we're also gonna try to get the hours
working again yeah the hours ok so kick
yeah thing here yeah pick the thing
where it's here like or you possibly yak
you probably need a break why not go out
for something else yeah we're gonna get
on you know</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>