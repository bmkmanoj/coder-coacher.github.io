<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MongoDB Tutorial #16 - Nesting Sub Documents | Coder Coacher - Coaching Coders</title><meta content="MongoDB Tutorial #16 - Nesting Sub Documents - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MongoDB Tutorial #16 - Nesting Sub Documents</b></h2><h5 class="post__date">2017-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1ANDrQrP0uQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you're something guys welcome to your
16th mongodb for beginners tutorial and
in this video I'm going to show you how
we can nest our sub documents okay so in
the last tutorial what did we do we went
ahead and created a model for our author
that author model encompass two schemas
we've had a schema for the author itself
with the name age and books and then
within this books right here we had a
schema for the books themselves so they
have a structure as well which is why we
create a schema for them so in this
tutorial what we're gonna do is go ahead
and create a test and mock a test which
is going to test creating some authors
and adding those sub documents to them
and by the way when I talk about sub
documents I'm not about these things
right here these things that were
nesting within your author okay so in
the last tutorial we created this model
and we exported it right there so let's
go ahead now and create a new test so
I'll right through there and you file
and I'm gonna call this nesting
underscore test AF and instead of copy
and pasting for once I'm gonna write
this out from scratch so the first thing
we need to do is require a few things so
I'll say constant so this is for our
search statement later on that's going
to be equal to require this is to be
assert after that I'm gonna say Const
Mongoose
so that equal to require and we want
Mongoose and then finally I want the
author model so I'll say constant author
capital A equals require and we need to
pass an absolute path to this so it's
gonna be double dot forward slash models
forward slash author okay so now we can
go ahead and use this thing in this file
so let's describe our test
so we'll do a describe block and we'll
say nesting records and then we need a
function which is gonna fire and we'll
do it blocks down here so we'll say
create test block and it's gonna be it
create an author we - documents for this
test we're gonna pass the door through
because we're gonna use that later on as
to let mocker know that we've done with
this test later so what do we want to do
well first of all we want to create a
new author so I'm gonna say var Pat's
equals new author like so and then
within here let's just scoot it along
with in here we need to pass through
those properties so and we're gonna give
them a name that's gonna be Patrick
Rothfuss I think your spotlight
correctly and then we're also going to
pass through books like so and then this
is an array remember of objects of book
objects so all we need to do is pass
through the properties of this book
object right there so we could say title
is gonna be name or the wind and the
number of pages which is a number we'll
just say 400 and there we go that there
will create a new author and it's
nesting this sub document within it
alright pretty cool so now what we want
to do is save that to the database so we
need to say Pat and then we'll say dots
Save and remember this is an
asynchronous request
so we're grabbing this author we're
saving it to the database but we don't
know how long it's going to take so we
do dot then and then pass through a
function into this like so so then this
function is only gonna fire once this
action is complete and then once we've
done that what we want to do is actually
go out and find that author we want to
make sure it's saved to the database
okay
in our search statement so we'll say
author don't find one we've seen all
this before when we've found documents
in previous tutorials and we're gonna
find it by the name source a name is
Patrick Rothfuss make sure I've spot
those the same yep okay and then what we
want to do is say dot then function
again this thing here is asynchronous
I don't know how long it's going to take
to find it so we're waiting till it's
found it and we're saying dot then once
you have found it fire this function and
give me the record that you found within
that function yeah so now what we can do
is say assert that the record that we
found dot box dot length is equal to one
okay so what making sure that it has
this sorbets
okay because this is the booked property
right here on the record and the length
of that this is just a JavaScript method
right here or property rather to give us
the length of that array and there's
only one object in it so it should be a
length of what so then we can say good
and save it so if we run this test now
let's come to the command and run NPM
run test then hopefully this should work
and whoop there we go looks like we've
got seven passes and where's our nesting
records right there big green tick
creates an author with sub documents so
this is working but let us just have a
look at Roble Mongo I'm going to go to
collections and I'm don't double click
again to refresh it and then we can see
this new authors collection right there
double click that and we have this
object which has been saved with a name
of Patrick Rothfuss awesome so we have
now created a new author with some
nested data we've saved up to the
database and then we've tested it right
here
that's all very cool but I want to do
one more test so let me just come down
below here and create a new it block and
this time this is going to add a book to
an existing author so this is already
going to
exist there we want to add your book to
it so it adds the book to an author cool
and then we're gonna say sure pass
through done again so we can let mark
know one we've done later and then in
here we're gonna do our second test to
do that so again we're going to create
cut the author in here and save it to
the database first so that we can then
go out grab it and add a new book to it
all right
so I'm going to copy this dude right
here because this only created it for
this test so let's copy it paste it here
and yeah we could have done this outside
and you know done the before each etc
and added the author in then and then
drop the database in fact we will drop
the database in a minute but for the
sake of this tutorial I'm just doing it
inside the separate blocks so in this
one now we've created a new author again
called Patrick Rothfuss and what we're
going to do this time is we're going to
add a new book to it so first of all
we're gonna save this so I'm going to
come down here and I'm gonna say Pat dot
save dot then if we can spell it
correctly then we pass in a function
here this function is going to fire once
the book is successfully saved and
inside this we're going to say author
dot find one again and I'm just going to
copy this thing right here in fact like
so because it's all the same so author
find one we're going to find it by the
name of Patrick Rothfuss then we're
going to fire a function with the record
returned to us like so so inside this
function what do we want to do we want
to add a book see the box collection
right all the books array doesn't really
matter these are just words so we want
to add a book to the books array right
here
how are we going to do that well it's
pretty simple all we need to do is grab
the record which is returned to us first
of all and then we're going to say dot
books which gives us this books array
right here and then we can say dot push
this is just a JavaScript method which
pushes a new object onto the alright and
then we pass through the properties here
so I'm going to say title there's gonna
be Wise Man's Fear say what let's pop
this in double quotes so that we can
have that single thing there okay and
the page is gonna be 500 all right so
now we've created this or rather we've
added this new bulk object onto the
books array right here okay so we've
manipulated that data and then what we
can do is we can say record I remember
this record still refers to the record
which is returned to us so what we've
done is changed it in such that we've
added a new bulk on to the books array
right here so now we can say record save
and that is gonna growl and it's gonna
save this record back to the database
with this new book added in cool right
so because this is asynchronous I'm
gonna say doc then so when this book has
successfully saved what we want to do is
go out and find the book again so it's
returned to us and make sure that new
book has been added on that's what the
test is going to be so let us say author
dot find one and the name is what we're
going to search by and it's gonna be
Patrick Rothfuss then once we've got
that firing of another function with the
record all the results whatever you want
to call this here so the result right
here is going to be what's returned to
us when we find this record again and
what we want to do now is assert that
this result that we've just got dot box
dot length is going to be equal to two
because we've added on that extra book
here makes sense right
and then we just say don't cool so now
what we've done in each test we've
created a new author now if we rule this
again it's just gonna keep creating
authors and adding them in and they're
all going to be called Patrick Rothfuss
we don't want that so what we're gonna
do is a before each hook up here which
is going to drop the database so let's
do before each and then in here I'm
gonna do a function with the dawn
parameter so we can say to maka when
we've done this and it can move on to
the test and then within this we want to
drop the authors collection so we can
start afresh each time so to do that all
we need to say is Mongoose dot
connection dot collections and that
gives us a reference to all our
collections we want the author's
collection remember Mongoose plural
eise's it so authors collection and
we're going to drop that and then within
this drop method we're going to have a
callback function when it's completed
and in that function we can then say
don't and that's going to move on so
it's gonna drop the database first run
this test which we did a minute ago drop
the database then we run this test
create a new author with one book then
we're saving it to the database then
we're finding it again then we're
updating it by saying record which is
returned to us books this array push
this new object onto it a new book then
we're saving it again
then we're finding it again by the name
and then we returned that result and
that result box dot length should equal
to because we've added one to it so
that's what we're testing for so let's
save this and run it again NPM run test
and awesome we have eight passing and in
nesting records we can see this one
create an auth up with sub documents and
also adds a book to an author top stuff
so that is how we nest sub documents and
know a lot of this is starting to look
like a triangle of do
but I just wanted to go through each
step individually to show you exactly
what was doing for this test and we've
used a few different Mongoose methods
along the way so hopefully this will
help compound them into your brain so
there we go guys we've just about
reached the end of this tutorial series
on MongoDB but I will be doing a couple
more series which are going to be using
MongoDB in the future just wanted to get
this one out there first the first one
I'm going to be doing pretty soon is a
REST API tutorial and I'm going to be
using node.js and MongoDB in that so
stay tuned for that one and then later
down the line I'm also going to be doing
a series on authentication with MongoDB
as well so until then I really hope
you've enjoyed this tutorial series
I hope it's taught you something new
please don't forget to share subscribe
and like the videos if you enjoy them
and I'm going to see you in the very
next series</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>