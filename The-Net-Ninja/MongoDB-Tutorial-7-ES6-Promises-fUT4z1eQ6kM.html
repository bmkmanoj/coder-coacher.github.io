<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MongoDB Tutorial #7 - ES6 Promises | Coder Coacher - Coaching Coders</title><meta content="MongoDB Tutorial #7 - ES6 Promises - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MongoDB Tutorial #7 - ES6 Promises</b></h2><h5 class="post__date">2017-01-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fUT4z1eQ6kM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what something guys welcome to your
seventh mongodb for beginners tutorial
and in this video i'm gonna show you how
we can implement the es6 promise library
to use with Mongoose instead of the
default one alright then so in the last
tutorial we saw this error right here
where it says Mongoose is default
promise library is deprecated plug in
your own promise library instead so for
whatever reason
Mongoose doesn't wants us to use the
default Mongoose promise library so what
we're going to do is use es6 promises
instead now this is not going to be a
promise tutorial if you want to learn
more about promises i've got a whole
asynchronous playlist and one particular
video on promises i'll leave a link to
the playlist down below you can check
that out so how do we implement the
default es6 promise library well all we
need to do is come up here at the top
and make a little comment that says es6
promise or promises rather whatever and
then I'm gonna say Mongoose dot promise
with a capital P and I'm gonna set that
equal to the global object dot promise
as well so we're using here
this is es6 default promise on the
global object and we're setting that
equal there we're saying Mongoose top
promise equal to this one so we're using
the default es6 promise instead of the
Mongoose promise with all the writing
that if you like okay so if we save this
now and run the test again let's just
check this out I'm gonna run NPM run
test this is gonna run through the test
again but hopefully we're not going to
see this message here this time okay
cool so it still runs the test but now
we're not getting that error message
about the promises cool so that'll work
however check this out right here when
we run it it says first of all saving
records which is the our describe block
then it says this message right here
connection has been made now make
fireworks then it gives us the it block
now the order of this seems a little bit
wonky ideally we want this thing right
here to be before it even gets to the
describe block okay we want to make sure
the connection is fully made before the
test starts to run and quite evidently
that's not happening so right here we're
connecting to the database and there's
nothing telling Mongo hey look I want
you to wait until we've actually
established
connection before you go ahead and run
the test because running the test before
we make a connection it's pretty stupid
so we want to sort that out and we can
do that using what's known as a hook in
mocha so what is a hook well a hook is a
function which tells mark a look I want
you to run this section of code either
before you run a test or after you run a
test okay so we wanted to run before we
even start any of the tests so how do we
do that well what we're gonna do is say
little comment first of all connect to
the database before tests run and then
underneath here let's spell connect
correctly underneath here what I want to
say is before and then we pass through a
function into here like so and then
basically what's gonna happen is any
code in here is gonna run before we even
start the tests okay
so let's grab all this stuff right here
cut that out and paste it in there
instead so cool now this is gonna run
before the test run but same again Mongo
or rather Mongoose doesn't know when
this is completed because this right
here this is an asynchronous request
right so we need to say when it's been
completed and we know how to do that now
we can pass through this done parameter
right here so I'm going to pass through
the done parameter into this callback
function and then once we've established
a connection which is here when it's
listening for that connection then we
can call don't like so so I'm gonna save
that and check it out in this thing
right here so I'll run the test again
and hopefully this time we're gonna see
that fireworks message at the start okay
cool so now we get that connection has
been made at the very top it's waiting
until we've made that connection before
it even moves on to the tests then we
run the tests awesome so now we've
implemented this es6 promise interface
right here we've also added this before
halt which saves to mocha hey wait until
the connection has been made before you
start running those tests
so we've done that as well one more
thing I want to mention is a couple of
lessons ago I said put up here constant
maka uke was required maka you don't
need to do that I was just being a
plunky you don't need to require it
nothing like that is needed
ok so delete that if you want and let me
go guys that is how we implement the es6
promise library in the next tutorial I'm
going to show you a tool called a robot
manga which is going to give us a
representation of our data in the
database because right now we've already
saved a character we want to actually
see that data in the database because we
can't see it anywhere at the minute so
we're going to use a tool called Robo
Mongo to do that</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>