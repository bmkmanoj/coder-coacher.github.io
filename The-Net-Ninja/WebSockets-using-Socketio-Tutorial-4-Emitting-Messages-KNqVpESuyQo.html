<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>WebSockets (using Socket.io) Tutorial #4 - Emitting Messages | Coder Coacher - Coaching Coders</title><meta content="WebSockets (using Socket.io) Tutorial #4 - Emitting Messages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>WebSockets (using Socket.io) Tutorial #4 - Emitting Messages</b></h2><h5 class="post__date">2017-06-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/KNqVpESuyQo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">yo what's going on gang welcome to your
fourth WebSockets tutorial and in this
video we're finally going to start
creating the chat application and start
emitting messages using socket dial okay
so where are we so far well in the last
tutorial we set up sucky to i/o on the
front end we also set it up on the
server as well so we've got it set up on
both sides now and when we're in a
client a browser and we request the
index page from the server
it's sentinal's then we sell this
WebSocket connection between the two so
now because that transferring data
between the two different things the
server and the client so we're in a
position now where we can start fleshing
out the chat application here then
entering some information some different
chats into this application sending that
data through the WebSocket to the server
the server will receive it then it will
emit data down every other WebSocket
that it's connected to to all these
different clients around here so it will
send it back down to the front end where
we can handle it and then display in the
chat to everyone view in the chatroom
so let's start fleshing out this
chatroom them the first thing I want to
do is get rid of this junk this h1 and
instead we'll create a div with an ID of
a manual check ok cool so this is going
to encompass the whole thing then we
want to deal with an ID of chats -
window this is going to be the window
where everything is displayed and then
also we want another div inside this
with an ID equal to output and this div
right here is where the data is going to
get displayed so when in one client we
send a message the server receives that
then it emits that message to the rest
of the clients so the front and then
we'll handle that receive that message
and output the messages here ok so they
could be inside this div okay so now
underneath the chat window what do we
want to do well we need to import fields
one for the name or the handle and one
for the message they want to send so the
first one input ID equals handle and
then this is going to be of type equal
to text okay we also want a placeholder
and that's going to be equal to handled
okay
cool so now we've got an input for that
we also want an input field for our
message so let's do another import with
an ID this time equal to message and
then a type equal to text and then we
also want a placeholder for this one as
well so say a placeholder is equal to
message cool so now we've got a few
input fields as well finally we just
want a send button to click where we
want to send this message
so we'll do a button with an ID equal to
send like so and then we'll give that a
text of send as well
cool so now we've created this HTML now
what we want to do is start editing the
JavaScript the chat is which also lives
on the front end which is going to help
us interact with this so when someone
enters in a message and click send what
we're then going to do is emit a message
down the WebSocket from this javascript
file which can be received on the server
now before I do that let's just take a
look what this looks like in a browser
so far so I'll refresh over here and now
we can see that chatroom and it looks
like this because of the styles
we've already pasted in that so nothing
special at the minute because if we type
something in here and here click send
nothing is actually happening okay so
let's add in that functionality and
start emitting that message from the
client to the server something the first
thing I want to do is start querying the
Dom and storing some variables so
references to different things in here I
want to get a hold of this the handle
the message and also the send button
right there and also to be honest this
output because that's where we're going
to output the messages so what a handle
into all of these different things
because we're going to interact with
each of those four components so we'll
create variables for each one of those
so I'm going to create a little comment
which says query Don we're going to do
all that stuff down here and I'm just
going to paste this in from my github
repository rather than type them out by
hand but I'm creating for variables
message handle button and output and
each of these are equal to document get
element by ID and we're passing in the
ID of each of these four elements
on the page so if we go to the index we
can see we've got handle message send
and output so they're the four things
we're getting the message handle send an
output and we're storing those elements
now in variables so now we can use them
it's kind of interact with them now the
first thing we want to do is emit an
event when someone clicks send so let's
do another comment saying emit events
and then underneath this will get the
button variable oops all this is wierd
cattles
so emit events and then we need the
button element and we want to say add
event listener so I'll say add event
listener so this is vanilla JavaScript
for listening for particular events now
we want to listen for a click event so
when someone clicks this send button we
want to do something so in parentheses
we're listening for the click event and
then when someone to collect it we need
to fire back a callback function okay
so all these sulfa is just vanilla
JavaScript so inside this callback
function what do we want to do well we
want to emit an event or we want to emit
a message so that we can receive it on
the client we want to send it down the
WebSocket and the way we can do that is
by seeing sockets and that's this thing
up here we created that socket when we
said IO connect so we can get that
socket now and we can say dot emit and
this is going to emit a message down the
WebSocket to the server all right so
this emit function that takes two
parameters and the first one is going to
be the name of the message what do we
want to call this well it's going to be
a chat message so let's call it chat and
the second parameter is going to be what
the actual message is or the data that
we're sending to the server okay so this
is going to be an object that we're
sending to the server so curly braces
and inside this object we're going to
have two parameters first of all the
message secondly the handle so the
message is going to be this thing up
here message dot value and that's going
to get the value of this input field
this message field right and the second
thing we want to send is the handle
source a handle
is handle that's this variable right
here dot value so that value and that's
going to grab whatever's in the handle
box right and then what we're doing is
emitting this chat message so that's
going to go to the server down the web
socket and send this data to the server
right so I mean if we do this at the
minute then nothing what she's going to
happen right yet sending the data but
then when we get to the server it's not
actually doing anything with the data so
what we need to do now is handle this
message on the server so let's go to our
server side code this index file and
let's handle this so inside this
function this callback function remember
we call this function right here when a
connection is established right so
inside this function what we can do now
is listen for that message being sent to
us from the clients that chat message
and the way we can do that is by saying
socket dot upon okay so this socket
refers to that particular socket between
the server and the client that is
sending the message so the socket dot on
and then on the chat message that's
listening out for that chat message
coming into the server then what we want
to do is fire a function and we receive
the data that we send so the data with
this thing right here this object right
so we're sending this from the client
and then on the server we're listening
to this socket and when we receive that
chat message we're going to fire a
callback function and taking that data
object that we send okay so let's just
think for a minute what do we want to do
when we receive it from the client to
the server what do we then want to do
with this message well we want to send
it out to all of the different clients
connected to the server on a web socket
so that every one of you in the chatroom
can see that message right so the way we
can do that is by seeing IO dot sockets
and this is going to refer to all of the
sockets that are connected to the server
so say there's five different browsers
viewing the chat room
all of those have their own individual
socket
this socket collection right here is
referring to all of those different
sockets right and then what we're going
to do is emit a message to each one of
those so we can say dot emit again and
again we need to say what type of
message we're sending back to the
clients this is going to be a chat
message again and then we're going to
send the data we received from the first
client that sent the message and we're
going to send that back to all the
different clients okay so we can send
that back here as a second parameter so
now what we're doing is from the client
we're inputting some data here click and
send that's emitting a message along
this socket between this client and the
server is sending that chat message this
data right here the server then receives
that it's listening out on that socket
for a chat message when it gets that
chat message it's emitting this function
sorry it's firing this function and
we're receiving the data that was sent
then what we're doing is resume again
all sockets and we're emitting a vent or
message down all sockets that is the
chat message and we're going to send the
data back to all sockets so now what we
can do is in the front end when we
receive this one we can handle it and
output it to the screen okay so how do
we do that well in the front end what we
can do is come down here and we can say
listen for events and then what we're
going to do is listen for events on the
front end and the way we do that is by
saying socket and that's that and give
it to a socket for this client okay we
define it right here socket dot on and
we're listening for the chat event from
the server or the chat message then we
can fire back a callback function on the
client side with the data and inside
here we can do something with the data
like output it to the Dom so I can say
now output that's this variable right
here which refers to that output div in
the HTML so I can get that and I can say
dots inner HTML to assign some different
HTML to that div so we're going to say
plus equals so whatever it is currently
I want you to
add this to the HTML right so this is
going to be a string we're going to
output a P tag not capitals and then h2
on the tag then what we're going to do
is tack on some of the data so data and
that's this thing we received right here
from the server dot and we had a handle
property which is here remember so we're
going to output the handle first of all
which is their name then we're going to
tack on again a string : and then strong
we're going to close that strong tag off
then what we're going to do is output
the actual message so again we can say
plus to add on some more data we're
going to add on data message and then
plus again this string and it's going to
close the P tag okay so now when we
refresh over here if we add in a name
let's say I don't know ninja whatever
and a message yo if we click send let's
just quickly go through the steps again
when we click send this event listener
is listening for that click it's saying
ok grab the socket between this client
your client the browser and emit a chat
message ok and send it to the server I
want you to send this data along with
that message so the server is saying
okay well I'm lifting to all my sockets
when I hear that chat message sent to me
I'm going to fire this callback function
and I'm going to receive that data and
pass it to this function so then what it
does is say ok I'll grab all of my
sockets to whichever clients are
connected to me and emit that chats
message and I'm going to send back the
data I receive to all of the different
clients then in the front end in the
different clients we want to then output
it to this chat window so we say ok well
in the front end I'm going to say socket
Don chat so we're listening for that
chat message coming back from the server
we're going to fire this callback
function which is taking that data that
comes with it and we're going to output
this data to the inner HTML of the
output give in the Dom okay and without
putting the handle and the message so
let's give this a whirl and cross our
fingers click send
now we get this in the chat window and
if I add this to a different tab then
let's try again
let's go over here and I say this time
at an old peach or say whoo
if I click send then it shows here and
also here cool so now we've got our
basic functionality working by passing
data from the client to the server then
back from the server to all different
clients ok so in the next tutorial we're
going to take this one step further and
add on that little peach is writing a
message thing right here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>