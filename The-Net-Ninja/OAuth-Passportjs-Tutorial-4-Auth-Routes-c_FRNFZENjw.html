<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>OAuth (Passport.js) Tutorial #4 - Auth Routes | Coder Coacher - Coaching Coders</title><meta content="OAuth (Passport.js) Tutorial #4 - Auth Routes - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>OAuth (Passport.js) Tutorial #4 - Auth Routes</b></h2><h5 class="post__date">2017-10-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c_FRNFZENjw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey gang welcome to your fourth a wharf
tutorial and in this video we're gonna
set up our authentication routes in our
Express application all right then so
far we have this pretty simple Express
application up and running and we're
just responding to one route at the
minute which is forward slash the base
route which is rendering this homepage
template right here now I want to move
on to the authentication side of this
project now if you remember back to the
slides in the first couple of tutorials
I said that when a user wants to login
using Google for example it's gonna go
to a route which looks something like
this forward slash off forward slash
Google and if it was Facebook it would
be /aa /pha spoke now we're going to be
using Google throughout the rest of this
series to sign him with so in our case
they're going to go to full slash auth
/gu GLE now where do we want to put our
login with Google button well I want a
login page right which is going to have
maybe three or four different signing
methods down the line so it could be
Facebook Google github and whatever
other provider so I'm gonna put a little
login button up here in the header and
then when we click on that it's gonna
take us to another page on our website
which is gonna list these different
options for now just going to list the
Google option right and when we click on
that Google option that button then it's
going to direct us to this right here
off Google what to begin with like I
said I just want to pop a button up at
the top which when we click is going to
go to say off and then forward slash
logging that's going to be a login page
with some different login options on it
so let's do that first of all so we're
gonna have various different author out
so far we've seen two forward slash
forward slash login but also forth four
slash auth /gu GLE and don't forget
we've got that callback route as well
which when the user has allowed access
to their Google profile it's going to
read a trip to a call back route on our
application that's going to be some kind
of author out as well so there's a few
different author outs we need to set up
and I could do them directly in the
at dr. J's file but I really don't want
to do that I don't want this to get
messy pretty quickly so I want to start
to modularize our routes so I'm going to
keep all the authentication routes
together in one file and we're going to
create a folder to keep our different
route files in so up here at the top I'm
going to right-click and go to new
folder and we're gonna call this routes
and this is where we'll keep all of our
route files and the first file I wanna
create is going to be called earth
- routes j/s so all of our earth it's
authentication routes are going to be
set up in here now to do this we're
gonna create an instance of the Express
router so to do that I'm going to say
Const and then call it constant router
instead of equal to require and we're
requiring the Express library first of
all but we don't just want to require
Express we want to create an instance of
a router so we'll use a method on this
called router with a capital R and
invoke that method so now this is going
to create an instance of a router for us
which we can attach routes to in this
file then we can export those routes and
use them in our app JS file ok so you'll
see this all become clear in a minute so
let's first of all create our login
write route so I'll say off log in then
underneath will say router and whereas
before we could say something like app
get to respond to a get request from
this route in here because we've created
a router incidents and we don't have the
app variable in here is only an app dot
j/s we set it on right here what we're
going to do is attach these routes to
this router object we've set up then
we're going to export this router object
so that we can use it in up Jes and I'll
show you that later so to begin with
router and we need to set up a route
which is going to be forward slash
logging okay now I said over here that
it's going to be forward slash auth for
slash login now when we're creating
these or router instances we don't need
to pull the first bit these are all
going to be forward slash auth /summon
so we don't need to pull off in this
file we're going to do it later on when
we use these routes in the app yes
so the first one is going to be /login
then we have a function here with the
request object and the response object
and inside this function we need to do
something now what I want to do is
render a template which is going to be
the login screen so up here I'll say
response dot render and we're gonna
render the login page right like so not
logging logging all right so we're gonna
render that page for this route so let's
create that first of all over here in
the views so I've got two new file and
I'm gonna call this login ejs now we
won't do this just yet we'll come back
to this in a minute we'll finish this
routes file first of all so this right
here is going to render a login page
with the Google+ button on so when they
click on that Google+ button it's going
to redirect then to forward slash auth
/gu --gel right so that's the second
route we'll create so down here I'm
gonna say forward slash forward slash
auth with Google and that is gonna be
router don't get and it's gonna be /gu
--gel alright again
we're not putting off before it will do
that later on in app GS so this function
is also going to take the request object
and the response object and inside this
function what do we want to do well
we're going to handle this with passport
later on because this is where we start
interacting with Google and sending them
to that consent screen so I'm not gonna
really do much here at the minute all
I'll do is put a comment saying handle
with passport so we know later on this
is where we're gonna handle this kind of
step with passport and for now we'll
just say response dot send and we'll
send a message to the browser and it's
just gonna say logging in with Google so
then when we go to this will route for
now we know that this is what we're
gonna do in the future and we're just
gonna say logging in with Google for now
until we do that okay so I want to do
one more row and I'm gonna do it above
this and this is gonna be to logout so
we'll say off logout and we'll say
router don't get and it's gonna be
forward slash auth /log out this time so
a user is gonna go to this route if they
want to logout and we need to do that
later on but again we're gonna take the
request and the response object here and
inside this function what I would like
to do is for now just say response to
send logging outs and again we're going
to handle this step with passport later
on so we'll pop a comment here as well
st. handle with passports so we know
we're gonna handle this logout process
later on with passport and if we go
there for now it's just gonna say
logging out alright so the next thing we
need to do is export this router object
right here and we're exporting it so
that then we can import it in a pas so
we'll say module exports set that equal
to router not rotor
Rampton so this thing right here so
we've created this instance of a router
and we've attached these different
routes to it log in log out and Google
and then we're exporting that instance
of the router with all of these handlers
attached to it okay so now we've
exported it we can go ahead and import
it into our app is file so I'm gonna do
that now and I'll say Const off routes
is going to be equal to require and
inside we want to say first of all the
current directory so dot forward slash
then is the routes folder then forward
slash auth - routes alright so now we've
imported that file in here and we can
use them so the way we use a set of
routes that we're going to import is by
saying up don't use and then the routes
right so we'll set those up just above
this home rail source a set up routes
and then underneath this will say up
don't use so what we're saying here is
we want to use some routes or some
middleware that's all these things are
so we're gonna copy that and we're going
to paste it in here right now I said the
forward slash off goes in front of all
of these routes that we just set up so
we all
want to use these when a user goes to
/off and the way we can do that is by
passing a parameter first of all it says
forward slash auth and it's in a string
then the second parameter is the route
that we want to use for this path so if
you go to forward slash auth then
forward slash login logout or Google it
works
make sense RN and cool so now we have
these routes set up and the last thing
we need to do is create that view for
this thing right here the login screen
right so I'm gonna do that
in the login gjs file so let's say HTML
and then tap to make that boilerplate
HTML the title is going to be the login
in the body I'm just gonna paste some
HTML and this is a nav at the top with a
URL inside we have three allies this
time not just one and have these
different routes that we've just set up
so forward slash for the home page then
forward slash forward slash in for the
login page that's going to display this
template then we have the logout link as
well forward slash logout so that's in
the header then so let's see the navitat
top then in the header we have a h1 same
login using then in the main we've got
an a with a class of Google button and a
hate ref of forward slash auth /ik
Google right so this is the route that
we're going to go to when we want to log
in with Google remember so that then
over here when we say forward slash
Google we know that we want to log in
with Google passport is going to handle
this for us and interact with Google to
do that okay but for now all we do when
we go to /or /tpour or see in the
browser so let's go to this file over
here again I just want to add some
styles but instead of me writing them
all out I'm going to copy them from my
repository and paste them in over here
and they're very simple again very
similar to the ones I added in on the
home page I'm also just going to take
these links right here that's on the
login page and I'm going to apply them
to the home page because we've only got
one in there at the min
so let's go to this link and highlight
that and paste those over it so let's
save this now and let's go to the home
page and refresh now we can see these
three links up here we have the home
page which still shows this template
then we have the login page which is
showing the Google+ button right there
and if we go to logout we can see this
message logging out we know that
passport is going to handle this logout
function for us later on but for now
we're just seeing that message if we
click login using Google+ then we get
this message sensible logging in with
Google and again this is what passport
is going to control later on so now
we've set up these basic auth routes in
our application and we have these
different pages set up and we're ready
to go so that in the next tutorial we
can start using passport to control
different parts of the authentication
flow so we're going to do that in the
very next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>