<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>REST API Tutorial (Node, Express &amp; Mongo) #9 - Saving Data to MongoDB | Coder Coacher - Coaching Coders</title><meta content="REST API Tutorial (Node, Express &amp; Mongo) #9 - Saving Data to MongoDB - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>REST API Tutorial (Node, Express &amp; Mongo) #9 - Saving Data to MongoDB</b></h2><h5 class="post__date">2017-03-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cOt8LfcA9wY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">howdy young and welcome to your ninth
REST API tutorial and in this video we
are finally going to connect a MongoDB
and start saving some data to it okay so
now we have set up our schema we have
set up our model and we can readily
accept post requests we created this
handler a few tutorials back I think
it's time that we now connect you to
MongoDB started accepting that data from
post request and saving it to the
database but we can't just accept it and
send it anywhere first of all we need to
connect to MongoDB so the first thing
you need to do is make sure MongoDB is
running in the background so you want to
type this command up right here and then
we need to go out and connect to it
because although MongoDB is running in
the background this application knows
nothing about it whatsoever you know
it's not psychic it's not just going to
automatically say hey I can detect
MongoDB running I'm going to connect to
it we need to explicitly say we want to
connect to it how do we that well we
want to head to our index file right
here and we want to create the
connection string of unite so first of
all I'm going to require Mongoose at the
top right here because we're going to
use that to connect and I'm going to say
conf Mongoose is equal to require
Mongoose okay and then monkeys provides
us with a method called connect which we
can use and pass a connection string to
so we can go out and find the database
that we want to connect to okay so let
us do that now right under here I'm
going to say connect to Mongo DB and
then we'll say Mongoose dot connect and
then we pass in our string right here so
first of all we want to say Mongo DB
that is the protocol then it's pull-up
then it's double forward slash
then we're connecting to localhost and
we're going to go to go ninja attacks
we'll say ninja go okay so this is the
kind of database if you like that we
want to connect to and although that
doesn't exist yet when we connect to it
from this application mongoose is good
go out see that it doesn't exist and
it's going to create it for us so it
doesn't matter that it doesn't exist yet
okay so now we're connected to my
to MongoDB silence there's one more
thing I want to do just quickly and that
is set mongooses promise equal to the
global promise because mongooses version
of the promise is deprecated so all we
need to do that is to save Mongoose dots
promise to the capital P and set that
equal to the global object in nodejs
promise okay so what overriding this
mongers promise you like because that is
deprecated okay cool so now we have
connected to MongoDB and now when our
application runs is going to run this
code connects a MongoDB and then when we
accept a post request we can take that
data and interact successfully with
MongoDB to store it in the database so
how do we actually do that well we're
going to need to go to our post request
handler right here because this is where
people will be sending it with data if
you like and what we want to do is
create a new ninja in here based on the
ninja model that we created in the last
tutorial this thing here so it's going
to have this structure this means your
schema structure and it's based on this
model because we're storing it in the
ninjas collection okay so how do we do
that well first of all what I'm going to
do is just get rid of this consultant
log statement and I'm going to say var
ninja and I'm going to set it equal to a
new ninja object right we can do that
because we've created this ninja model
right here but in order for us to do
this we're going to have to require a
listing this ninja model in this file so
remember we exported it right here so we
can just import it up here at the top so
what I'm going to do is say const ninja
is equal to require and then we need to
find the ninja file which is in the
models folder so first of all we need to
go put a directory so i say dot dots
forward slash to go open directory then
we want to go in the models folder then
it's called ninja gif so we'll just type
ninja ok so now we can use that ninja
model in this file we've created a new
instance of that ninja model so this is
great creating a new record if you will
it's not been sent to MongoDB dress yet
we're just creating it locally here in
the code then we need to send
or rather give this ninja kind of
instance some data if you like okay so
we presume that the user is going to
send some JSON data which is going to
have all these different properties if
we go to the schema you should have a
name a rank and available project so we
can just get that off the request body
which we learn about in a couple of
tutorials ago so I say request body okay
so now we're creating a new ninja
instance and we're using the data which
has been sent to us in the body of the
request
okay so we're basing it on that data so
now what we can do is we can say ninja
which is this thing here this variable
we just created this instance of this
ninja muddle if you like and we can use
a mongoose method called save which will
now go out and save that through the
database in the ninjas collection all
right because right here we said we want
to refer to the ninja collection monger
is plural Isis that calls it ninjas in
the database so we know whenever we're
saving a ninja object we're saving it to
this collection right here okay so there
we go that is how we actually save it to
the database but we can actually make
this a little bit shorter instead of
creating a new instance and then saving
them separately what we can do is use a
mongoose method called ninja create okay
so i'm going to get rid of these and as
i say means open a capital end because
it's the ninja model we're creating a
new instance of that so we can say don't
create that again we pass through the
request dot body which is the data they
are sending to us in the request body
okay and then this is going to do two of
those things together it's going to
create a new instance of the ninja
object locally and then save it to the
database we don't need to call ninja doc
saves or anything like that now it does
it forward in this method which is
really cool okay so it's often good
practice to send back the data which the
user has centel's in the first place
okay to say that everything went okay
and this ninja is saved so what this
does right here is return towards a
promise and basically that means that
this here is going to take sometimes
completely might take second or less or
more
so what we need to do is wait for this
action to be completed and then find
some more code then we're going to send
our response we want to make sure this
is happened correctly before we send our
response make sense so we can't just
send our response here we need to wait
for this to complete and because it
returns to us a promise we can tack on
the dot then method right so this takes
a function as a parameter and gives us
the data which it has saved to the
database okay it returns it to us and
what we can do then in this function is
send our response because this function
only fires once this action has been
completed make sense so now what we want
to do is grab this response paste it in
here and then I'm going to get rid of
that if I will get rid of all of them
and we're just going to send back the
ninja which we have saved through the
database make sense so just to run
through this quickly one more time we're
going to receive a potion quest where
someone is going to attach some JSON
data to the body of that request okay
that JSON data is going to represent a
new ninja with these different
properties name rank availability
once we receive it here we're going to
say ninja create this is a mongoose
method and this is a model so we're
calling this create method on the model
which is going to create a new instance
of a ninja using the data that we
receive from the body of the request
it's going to save that data to the
database for us and then this is going
to wait until the action is complete
once it is is going to research what the
ninja has saved to the database this
function is going to fire then we're
going to send a response with that ninja
in the response so we're going to send
that JSON back to the user the clients
so that it knows everything has been
successful makes sense so now what we
can do is try this out in postman so I'm
going to make sure I'm brewing the app
I'm going to come here and I'm going to
say no more in depth make sure this is
running first of all then I'm going to
open up the postman so let's grab that
and we want to make a post request to
forward slash API forward slash Minges
right and we also want to send in oops
postman chrome is crash let's see why
and this because stupidly in the last
tutorial I think I missed out a
semicolon yep I did
so types boolean okay so let's save that
and try this once more make sure it's
running so yeah now it's listening for
requests okay so let's make this request
so post so forward slash API forward
slash Minges we want to send somebody
Gator the name is Ryu the rank is black
belts and we also need to send
availability or I think the name is
available the property name so let's
have a look yet available so let's send
that as well say available and set this
equal to true okay so if we send this
now which I'll do then we can see we get
back now an object with the name which
Israel rank is black belt available is
true so we sending us back that say word
ninja and notice there's a couple of
extra things on here this is top one
right here and this ID right here so
this ID is that unique identifier that
Mongoose gives to this new ninja
instance when it creates it okay so that
it can be identified if you like from
the database when we come to find
something so it returns that to the end
user which is really useful because now
we have a unique identifier on the front
end which we can attach to this user we
cannot associated to this ninja okay
cool so now we've sent this request how
do we know it's actually saved to the
database because we can't see a visual
representation of it
well that's where a piece of software
called robot mongrel comes in so I'm
just going to open this up and you can
download this by the way from Robo mango
or get completely free click that
download button and when you first fire
it or you might not have this new
collection right here so you just want
to create one and click Next and that's
going to kind of connect to the database
for you I'm going to connect to this and
then hopefully we should see our
database ninja job because like I say
mungus creates this for us
when it doesn't already exist so if we
open this up and go to collections and
then we can see I'm ninjas collection we
can see this object right here with this
unique ID in it if we expand this we can
see the name Israel and the rank is
black belts
and this has successfully worked we have
taken in a post request we have created
a new ninja instance we have saved it to
the database then we've returned that
saved ninja back to the user so we know
it was successful pretty awesome but
just by testicle blessings out here in
postman
so we said in our schema right here that
name was required right and that
availability was defaulted to false so
first of all let's not pass through the
available property and see what happens
so let's go to postman and I'm going to
just change this I'm going to get rid of
available and I'm going to change this
to Yoshi and change this to brown okay
so I'll send this and see what happens
okay this time we get another option
back it's defaulted the available
property to false cool we still get the
rest of the object back which is good
let's just check Roble Mongo and if we
will miss again we can see a second
object the name is Yoshi brown belt
false pot available awesome so that's
worked now I just want to check out
listing right here we said name was
required so let's try sending along some
JSON where the name property is not
there okay so let's open Robo Mongo
again this time what I want to do is
take off the name property I'll put in
available I'm going to set that to be
true and this can be the red belt okay
so what happens when we send this
without a name well it keeps on loadings
nothing happening just yet okay what's
happening well let's open a robot Mongo
and see if anything has saved will play
this no two objects still there so it's
not saved anything else to the database
if we open up our console we can see
this error right here the app has
crashed okay so basically we get into a
validation error which says the name
field is required so cool this
validation right here in this schema is
working so it's not accepting the data
we send the run type of data with the
wrong properties and it's not
exceptin it won't just go and save it to
the database which is really cool
however in post fun right here we're not
getting any response whatsoever it just
says loading so our clients our end user
really has no idea what's going wrong
with this request because they might not
be aware that we need a name property so
we need a way to handle this error and
send back an error to the user so they
know what's gone wrong I'm going to take
a look at that in the very next tutorial</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>