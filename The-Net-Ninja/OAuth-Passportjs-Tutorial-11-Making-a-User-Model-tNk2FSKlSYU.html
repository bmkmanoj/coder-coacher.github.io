<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>OAuth (Passport.js) Tutorial #11 - Making a User Model | Coder Coacher - Coaching Coders</title><meta content="OAuth (Passport.js) Tutorial #11 - Making a User Model - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>OAuth (Passport.js) Tutorial #11 - Making a User Model</b></h2><h5 class="post__date">2017-10-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tNk2FSKlSYU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey well something guys welcome to your
11th hour worth tutorial and in this
video we're gonna start making a user
model okay then so in the ground flow of
things right now we're right about here
and we're in
this passport callback function and what
we're aiming to do at the minute is take
the user that's come back from Google
take some information from their profile
and then store it in our own database
because remember if we do that we can
Callay extra information about that user
and we can also tell if they've been to
our website before and logged in before
so that's what we're doing at the minute
we're in this kind of general area in
the passport car bat function where
we're trying to take that user from
google take the information from their
profile and store it in our own database
and we're using MongoDB so in the last
video we've setup that database using M
lab online and in this video I want to
start to actually save the data or at
least create some kind of a user model
which is going to define what data we
want to store in our database so just a
very quick refresh on models and schemas
first of all and if you want more
information about this feel free to
check out my MongoDB tutorials for
beginners I'll leave the link down below
so we're going to need to set up a user
model and a schema in order to save
users to our database so in basic terms
a model represents our collection in
MongoDB so the user model is going to
represent the collection of user records
inside our database okay so we keep all
of our users stored within the same kind
of collection and we use that user model
to interact with that collection to
retrieve records from it that kind of
thing and a user schema defines the data
structure of a particular record in that
model so for example you can see each
record here has a name ID and age the
schema is going to define those
properties and say look these are the
three properties we want to store in a
record and these are their types they're
a string number and number so we need to
define both of these things a user
schema to say what kind of information
we're going to store in a user record
and then also a user model which is
going to represent our whole
of users okay then so let's create this
user model the first thing I'll do is
create a new folder to keep everything
organized and I'm going to call this
models and inside will create a new file
which is going to be called user - model
J s so this is where we're going to
create our user model using Mongoose so
the first thing we need to do because
we're using Mongoose to create this
model is imported source a Const juice
is equal to require and it's Mongoose so
don't forget we installed that before
and the second thing I want to create is
a constant called schema and I'm using a
capital S for this this is the
convention and set that equal to
Mongoose which we just required dot
schema okay so now if we want to create
a new schema for a particular model a
new data structure if you like we're
gonna say we want to use a new schema
right some Mongoose is providing this
for us it's allowing us to create this
schema this kind of documents or record
data structure so that we can pass that
into a model okay
so let's define this schema first of all
how do we want our users to look well
we'll keep it pretty simple to begin
with now the first thing we're gonna do
is create constant and we're going to
call this user schema right so this is
gonna be the schema for our user model
this is going to define how we want our
user records to look so we're going to
set this equal to a new schema which is
this thing right here right remember we
using Mongoose schema so we're creating
a new schema right here and that is a
function because it's going to create
this schema for us and inside that we
pass an object and in this object is
where we define how we want our records
to look so which properties do we want
them to have well we're going to keep it
simple I'm going to say we want a user
name for each user and that is going to
be a string so on the Left we say what
the property name is going to be on the
right it's the type of that property so
this is a string right the next one is
going to be a Google ID because they're
logging in using
Google so I think it makes sense to
store that Google ID because say for
example a user comes to our website for
the first time and then login using
Google then we're going to retrieve that
Google ID now if they login a second
time we need to identify if that users
been to our website before and the way
we can do that is by storing the first
time around their Google ID so that the
second time they log in using Google we
retrieve the ID from the Google profile
and we can make a lookup to our database
and say okay can I find a record with
this Google ID stored in it and if we do
store that then we can match it up and
retrieve that record from our MongoDB
makes sense so we're going to store this
Google ID so that we can identify
returning users to our website that have
used Google to log in so let's say
Google ID and that's also going to be a
string so I think we're keeping at that
for now these are the two properties we
might add to this later on
but these are the two properties that I
want to be in each of our use of records
so we have that schema now we've defined
how our records in the user model are
going to look so let's create this model
now now this is really simple to do
we'll just say Const user with a capital
u that's again a convention if we're
creating a model we give it a capital
letter to begin with and then this is
gonna be equal to Mongoose dots model so
this is how we create a model and this
is going to take two parameters right
here first of all the model name what do
we want to call this model this
collection if you like well I want to
call it user and MongoDB is going to
pluralize that for us in our database
and we'll see that later on M lab okay
so it's going to say okay well the model
is called user I'm going to call it
collection users right so this user
model is going to represent that users
collection okay now we also need to pass
in a schema because we want to tell
MongoDB look for every record inside
this user model or this user collection
I want you to define the structure of
those records to be like this over here
this schema okay so each of these
records is going to be according to this
user
schema so that's it we've created our
model now that's all there is to it very
simple now we're going to be using this
user model in different files later on
specifically we're going to be using it
in this callback function for passport
right here so what we do need to do is
export this model right here so that we
can use it in another file
so that's import module exports is going
to be equal to user and we don't need to
export the user schema only the user
right because that takes into account
the user schema and this is what we're
going to be using to interact with the
user collection right remember the model
represents the collection so we can use
this model to interact with the
collection to do things like save
records retrieve records update them all
that kind of fun stuff
alright so there we go my friends we've
now created our schema and our model for
users so that in the next tutorial we
can go back into the passport setup over
here into the callback function where we
retrieve their information from their
Google profile we can take that and then
we can use the user model we've just
created to create a new user record in
our database</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>