<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Django Tutorial #20 - Saving Users | Coder Coacher - Coaching Coders</title><meta content="Django Tutorial #20 - Saving Users - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Django Tutorial #20 - Saving Users</b></h2><h5 class="post__date">2017-12-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Xj0MXHrAi9o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's going on guys welcome to your
xx Django tutorial and in this video I'm
gonna finally show you how we can take
our users and save them to the database
all rather than so in the last lesson we
created this form using the user
creation form that Django gave to us so
in this lesson what we want to do is
take the data that the user provides to
us when they click sign up we want to
take that data and create some kind of
new user in our database so I mentioned
in the last tutorial that when we make a
get request to forward slash accounts
forward slash signup then we run this
function right here but also when we
make a post request to forward slash
accounts forward slash signup when we
click this thing right here this
function is also gonna get fired so
inside this function what we need is
some kind of way to detect whether the
request was a post request or a get
request and we can do that really simply
that information comes bundled along in
this request object right here so we can
say if request which is that object dot
method is equal to post and capitals
then do something so this right here
this request dot method if it's a get
request that will equal get if it's a
post request that will equal post so if
it's a post request we can do one thing
get request we can do another so if it's
a post request what do we want to do
well we want to take the data that we've
got from this farm right here and we
want to somehow validate it and the way
we do that is by saying okay well let's
create a new instance of a farm on the
server and set that equal to the user
creation form and then inside we pass
the request dot post information so
request again is this object that comes
shipped along and it has information
about the request that's made and we say
dot post to access the post data all the
data that's come along with the post
request and that will be all the data
that's been supplied in these fields
right here so what we're doing is were
passing in that data into a new instance
of the user creation form and what this
is doing is essentially kind of valid
in that data for us is this data okay do
the passwords much does the user already
exist or not etc so that's going to
return us this instance of a form which
is either valid or invalid and if it's
valid what we want to do is save that
form to the database save that user so
we can check if the form is valid by
saying form dot is underscore valid so
this is a method we can use on this form
and it's going to return true if it's
valid and false if it's invalid so again
we can say if form is valid and if it's
valid it will return true and this code
block right here will execute so if it's
valid we want to take that form data and
save it to the database and again dead
simple to do we say form dot safe and
that right there my friends is going to
save that data to the database and
essentially create a new user for us now
typically the next step would be to log
the user in but we're not going to look
at that in this tutorial so instead
we'll leave a comment right here to
remind us to log the user in and we'll
do that in a later tutorial for now what
we'll do if everything's successful if
the form is valid and we save the user
then what we'll do is redirect the user
to the article list so we'll say return
and then this time we want to return a
redirect now up here we imported render
because we returned a render down here
now we're returning a redirect so we can
also import from the same place jangled
shortcuts the redirect method right
there so we're going to return a
redirect now and where do we want to
redirect to well we want to redirect and
it's in quotes to articles : and then we
want to go to the list URL remember this
is the way we perform URLs on the front
end when we use the URL we can do the
same thing in the back end when we're
doing a redirect so if we're going to
the URLs over here in the articles up
you can see that the app name is
articles which is why we say first of
all articles right here
and then the name of the URL is list
that's why we're sending them to the
list of articles so that's why we have :
list so that's the URL we're sending
them to so that is if the method is a
post request and the form is valid then
what we're doing is sending them to here
we're saving that to the database then
sending them to the article list now
what if the method is a get request well
instead what we want to do is this we
want to just create a new blank instance
of the form not this instance a blank
instance of the form and send that to
the browser so that they can see that if
it's a get request so right here what we
need to do is say else
so this else right here is for this
thing right here so if it's post do all
this else do this so inside this else
statement we want to create a fresh
version of this form right here the user
creation form and then what we're doing
at the bottom is rendering this template
and sending that fresh form right here
okay so there's three scenarios right
here I don't want to run you through all
three the first scenario is that the
request is a post method so we come here
request this post that's fine we pass
the data into this user creation form to
validate it if it's valid then it's
going to save that form and redirect us
to the article list that is scenario one
scenario two is that this function is
fired if request method is post it's not
a Polish request it's a get request so
we don't fire this code instead we go to
the else statement and we create an
instance of the user creation form which
is a blank instance and we send that to
the template right here we return this
render so we're sending them this blank
form right here and that's where a get
request if we request that page right
here the third scenario is that this
function fires request stop method is a
post request we try to validate it here
by passing the data in to the user
creating form form is valid returns
false they've done something wrong maybe
the passwords don't match
therefore this doesn't fire right here
but it goes right to the bottom instead
too
return right here this is outside of
this else statement so it still fires
this right not this but it finds this
and again we're going to return a render
which is the same signup template and
this time the form that we send back is
going to be this form that we earned
that we created right here because it
was a post request and it still created
this instance of the form and this
instance of the form is the validated
version so if there are any errors any
kind of form validation errors such as
the passwords don't match or that
username already exists it's gonna send
those back to the template as well okay
so there are the three different
scenarios so now we have this why don't
we try this out in the front end let's
save it and let's make sure we're
running this in fact we have an error
and that's because stupidly I've not put
double equals there schoolboy error save
this again and hopefully we should be
running this yet we are so now if we
refresh over here then let's just try
this and we will get an error and I'll
explain that error in a minute so I'm
gonna try Mario and then test one two
three four test one two three four I'm
gonna try and sign up and watch this
error so the first error is that we
don't have a trailing slash on the
signup so if we go back to the signup
form right here we can say forward slash
signup at the end because that's the
actual URL we need to post it so now
let's go back and try this once again
type in Mario again test and test and if
we click signup this time we get a
different error and the error this time
is saying that this CSRF token is
missing so this token is essentially a
security thing and when we send data to
the server what we need to do is send a
token with it to say look this data this
request has come from our application
it's not come from another application
trying to make a post request to our
site it's come from our application so
please accept this data so what we need
to do is send
touken with the request inside this form
and it's dead simple to do all we need
to do is open our template tags like so
oops not a hash inside the form and then
within those template tags all we need
to say is si s our F underscore token
and spell it correctly if you can unlike
me okay so now we have this token on the
front end which is going to be sent to
the server when we send the form so that
it says hey okay I can see the token
that's fine another data is coming from
your application so I'll accept it so
let's try this one more time
go back and refresh over here this time
we'll type in Mario again I'm going to
type in test and I'm going to type in
test again sign up and we get an error
it says the password is too short it
must contain at least eight characters
and also this password is too common so
this is like I say one of the cool
things about using the Django inbuilt
forms it allows this kind of error stuff
right here to be shown to the user so
we'll try again we'll use Mario this
time I'll say test one two three four
and test one two three four this time it
is eight characters long
so we'll sign up and this time it works
so now we're redirected to the article
list and if we go over here and refresh
in the admin section then we should at
some point see another user we don't at
the minute but what I'm going to try and
do is the log out and then log back in
again with the same username and if I go
to users then we see the new user right
there so it's updated now so Mario is
now a user and notice he's not an admin
staff status has a big Red Cross through
it so he's just a normal user which
means if he tries to go to this section
right here forward slash admin and tries
to log in using Mario and tests one two
three four because he's not a staff
member or an admin then he's not allowed
into
this section which is cool so now what
happens if we go to accounts forward
slash sign up again and try this time to
add in another user with the same name
so for example Mario and then we'll do
test one two three four and test one two
three four try to sign up and this set
time it says a user with that username
already exists so it doesn't let us
again one of the benefits of using this
form really cool but if we try to use a
new one like Luigi and then test one two
three four and test one two three four
this should hopefully work sign up yep
cool so now if I sign in with Sean and
test wants you to be fought into the
admin section hopefully fingers crossed
we should see both of these new users
Mario and Luigi awesome so there we go
my friends that is how we can use the
user creation form from Django to sign
users up and now we can see those in the
backend so in the next tutorial what
we'll be doing is taking this one step
further and added in a login form so
that the users that we've created here
can actually log into our application on
the front-end</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>