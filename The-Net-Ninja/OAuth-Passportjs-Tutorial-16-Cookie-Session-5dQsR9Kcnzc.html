<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>OAuth (Passport.js) Tutorial #16 - Cookie Session | Coder Coacher - Coaching Coders</title><meta content="OAuth (Passport.js) Tutorial #16 - Cookie Session - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>OAuth (Passport.js) Tutorial #16 - Cookie Session</b></h2><h5 class="post__date">2017-10-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5dQsR9Kcnzc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey gang welcome to your sixteenth
Alworth tutorial and in this video we're
going to talk about our cookie session
alright so in the last video we had a
look at these two functions right here
and serialize user is taking a user
right here from the callback function
and it's saying well okay I want to take
and identify and piece of information
from that user so that we can stuff it
in a cookie send it to the browser so we
still not it's grab the ID and it's
called the done method which is said
okay I'm done here I'm just gonna use
this to stuff in the cooking vice versa
deserialize user is taking an ID when
the browser sends the cookie back and we
receive that ID and then we're finding
the user based on the ID and we're
calling done and passing in that user so
what this is gonna do for is later on is
attach the user property to the request
object inside this thing down here okay
so that we can access it in a route
Handler and we're gonna see that later
on but for now I want to set up our
application so that we can use session
cookies so to do that we're gonna have
to install another module and that's
called cookie session so let's go to app
KS we're gonna have to require that
there in a minute but the first thing I
want to do is open up the console and
I'm gonna say npm install and it's
called cookie - session okay
so that'll just take a minute to install
i'll see you when it's complete
that's all done Maya now so the next
thing I need to do is require cooking
session inside this app J so I'm going
to come under keys and I'll say Const
and call this cookie session and set
that equal to require
and it's cookie
session okay so we're gonna use this
cookie session to control our session I
will use this session right so it's
gonna take our cookie set a max age to
it and encrypt it using a key and send
it to the browser because we don't want
to send our normal ID to the browser
because then anyone can see it it's
using that browser we want to encrypt it
first of all using the key and then send
that's the browser then when they cookie
comes back to us we can decrypt it okay
so the way we're going to set up this
cookie session to run is by using it
down here so I'll say app don't use and
we're gonna use cookie session like so
and this takes in an object as a
parameter and this object needs two
properties first of all the max age so
this is gonna be the max age of the
cookie that we send out so for example
if I want one day this value needs to be
in milliseconds so I'll say 24 for 24
hours in the day times 64 minutes in an
hour times 64 seconds in a minute and
then times 1000 for milliseconds in a
second so now I have a day in
milliseconds inside this max age profit
awesome the next property is going to be
a property called keys so like I said we
want to encrypt our cookie we don't just
want to send the user ID straight to the
browser so this array right here can
take any number of keys and it's going
to use one of those keys to encrypt that
ID so that it's encrypted by the time it
reaches the browser so we can pass in a
string here of anything you want like
that and that's going to encrypt it
however I'm not going to store this key
right here I'm going to store it in our
keys file okay so we can keep it a
little bit more private so I'll delete
that from here and save it and go over
to keys yes all right here is where I'm
going to add in the key for our cookie
session so we'll add in a property
called session which is an object then
the cookie key is gonna be right there
and let's just make him a random string
so I'm gonna say the net ninja is
awesome
I guess I'm guessing no one's gonna
guess that that comes to my website so
that's going to be my cookie key but
it's going to use to encrypt the ID so
let's use this now over here we've
already imported the keys so I can say
Keys dot session dot cookie
key okay so we're going to use that now
this thing right here
to encrypt our cookie when we send it to
the browser so the next thing we need to
do inside this file is to say okay we
want passport to initialize first of all
and then to use cookies we want to use
session cookies right so just two quick
lines we need to do to say that so let's
just say initialize passport right here
and then underneath I'm going to say app
use and we've already imported passport
half way no we've not so let's import
that first of all stay down here Const
passport is equal to require passport
like so then down here I'm gonna say app
dot use and this is some middleware
we're using right here Passport dot
initialize so we're initializing
passport in our application right here I
can never spell this initialize okay so
that's a function and then the next line
we need to write is app dot use again to
say that we want to use passport dot
session to control or login in okay so
we use in session cookies ok so that's
really all we need to do now to set up
our cookies so now what's going to
happen is when we see realize this user
we're going to attach this user ID to a
cookie then this thing over here is
gonna encrypt that cook in and make sure
that it's just a day long then it's
going to send it to the browser and
browser is going to receive that cookie
ok and this is all happening once a user
is logged in because remember once
they've logged in we're firing this
callback function right here which then
skips over here it says dawn etc and it
goes on and on and it sends that
response to the user alright so now
we've set up our cookies in the next
video we're gonna test it out and see if
these cookies are reaching the browser
and what happens when the browser makes
another
request</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>