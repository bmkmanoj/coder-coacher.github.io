<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MongoDB Tutorial #6 - Saving Data to MongoDB | Coder Coacher - Coaching Coders</title><meta content="MongoDB Tutorial #6 - Saving Data to MongoDB - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MongoDB Tutorial #6 - Saving Data to MongoDB</b></h2><h5 class="post__date">2017-01-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2oYtk83FZCA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you know something guys welcome to your
sixth MongoDB for beginners tutorial and
in this video I'm gonna show you how we
can create and save some data to MongoDB
okay now so now we know how to run our
tests in maca we can do something a bit
more useful than test the two numbers up
to five we can start to test different
things with our MongoDB connections such
as saving data to our database so the
first thing we want to do is rename this
demo test file so I'll come to rename
down here and we'll call this instead
saving underscore test so we're going to
test our saving data to the database in
this file so let's get rid of that we're
gonna give it a different string for
describe and we'll save saving records
and then also in the it block I want to
rename it to save a record to the
database okay cool so let's get rid of
that thing there we're not going to
assert that two plus three equals five
anymore
this time what we want to do is create a
new Mario character remember we created
a Mario character model a couple of
lessons back in this file and we did
that with Mongoose so we created a Mario
character schema and a Mario character
model right here so we're going to
create a new Mario character using that
model and we're going to save that
record to the database so how do we
create a new Mario character first of
all well if you remember we exported
this Mario character model right here so
we have access to this model within all
the files when we require this file so
let's first of all require this file in
our test file so that we can use it so
I'm gonna come down here and I'm gonna
say Const Mario car equals require and
then what I want to do is give a path to
this file right here that we're getting
this from so we've seen this model
folder right here we're currently in the
test folder so we need to go up a
directory first of all so that's double
dot forward slash then we want to go
inside the models folder then we want
the Mario car file like that we don't
need to pop JSON node already know
to look for a JavaScript file so now we
can use this in this file so how do we
create a new Mario character all we need
to do is first of all say var car we'll
call this this is just the name of a
variable to store the Mario character in
I'm gonna set that equal to a new Mario
car like so okay and then what we need
to do is pass in an object into this
constructor so inside we want to specify
what the name of this character is and
what the weight is we don't have to give
bulks we can just give one if we want
remember in this file right here we
created the schema so these are the
properties that the Mario character
model is expecting so we can give it one
of these or none of them are whatever
but if we give it a name it has to be a
string if we give it a way it has to be
a number let's just give it a name for
now so I'll say name we're gonna call
this dude Mario the main character and
that is our new character right there so
that's a new record if you like now at
the minute we've only created this
locally it's just sitting around here
doing nothing we've used mongos to
create it but it's not in our database
yet okay so what we need to do is then
save this character to the database this
record so when we create this new
instance of this Mario co2 model when we
create this mongoose gives us a lot of
methods to use that we can work with its
interact with the database and do
something with this model so for example
we could save this instance of the model
these new character to the database
using the save method so that's what
we're gonna do I'm gonna say car which
is this variable right here we store the
instance in dots save okay so Mongoose
gives us that method it allows us to
just get that character that record and
save it directly to the database and
because we've already made a connection
to the database in our connection
Jas file right here we connected to the
database right there now because we've
already done that Mongoose knows where
to go it knows which database to go into
and it goes into that and it saves this
in the Mario characters collection
remember we said what collection this
belongs to or right here so this is
going to be our collection name within
that database so it's all pretty clever
and it does a lot of the heavy lifting
for you so this my friends is gonna grab
that character and it's gonna save it to
the database but what we want to do then
is test this we want to make sure that
this is worked correctly now we can't
just come under here and say assert that
it's been saved and the reason we can't
do that is because this thing right here
this save function is an asynchronous
request and by that I mean it starts as
soon as the code hits here it starts
that process of saving it
but then that save process might take
one second up to two seconds however
long it might take
it's not instantaneous so what will
happen is the codes will carry on
running and it will try to assert
something whether it's saved to the
database before it's actually finished
we don't want that we want to wait for
the process to finish and then assert
that it's been done correctly so because
Mongoose knows that this right here is
an asynchronous request it implements
the promise interface for us and the
promise basically means that we can tack
on the dot the dot then method which
says okay well I want you to wait for
this thing to complete first then we're
going to fire off a function and that
function is going to be placed in here
so this waits for this save action to be
complete then it fires this function so
in here we can assert that this has
successfully been saved but how the hell
do we do that it's not just as simple as
saying 2 plus 3 equals 5 anymore how do
we know that it's saved correctly to the
database well what a cool feature of
Mongoose is that it gives us the dot is
new property so I could say something
like this assert and I'll say car dot is
mute and this is going to either return
true or false it returns true when we've
created this character locally but we've
not yet returned it to the database or
saved it to the database rather so
that's when it's true
so basically saying yes it's new
it returns false when the carrots has
been created and after it's been saved
to the database to say actually it's no
longer new we've saved it now to the
database so then we can use this
property to test whether it's been saved
to the database so we want this
basically to equal false because that
means that it's not new and that it's
been saved to the database makes sense
so if I save this now it's not going to
work because there's one more thing we
need to do like I said a minute ago this
right here is an asynchronous request
right and moeka needs to know when we've
completed the test and it doesn't
automatically know when it's been saved
so we need to explicitly say when it's
complete and to do that we need to pass
in a done parameter right there okay
mocha gives us that and then what we can
do is use that dumb parameter down here
after the test is complete so after
we've made the assertion we can say okay
now this is done fire that done function
we're telling mocha now that our test is
done and you can move on to the next
test which might be down here somewhere
like this next to test yeah so that's
all there is to it quickly again what
we've done is we've got this it block
now which is saying we're saving a
record to the database then what we're
doing is creating this new instance of a
Mario character using the merry old car
model we created that a couple of
lessons ago we passed it a name property
then what we did is we said car dot save
this method is provided to us by
Mongoose that goes out saves this to the
database because this is asynchronous we
returned a promise and we could say dot
then so we're waiting for this save
function to finish and when it has it
fires this next function which asserts
that character is new is equal to false
meaning that this is no longer new it's
now being saved to the database and
that's what we want we want it to be
saved to the database and then what
we're doing is were saying this test is
now done and we can do that because we
passed the done parameter in there so
let's save this now and just check it
out I'm going to open up this and I'm
going to run NPM run test and hopefully
this is all going to work
sweet so that passes and all is good
however I want to show you one thing
right here you see this deprecation
warning it says M promise Mongoose is
default promise library is deprecated
plug in your own promise library instead
so this thing right here that we used
this dot there method this is being
based on mongooses default promise
library remember we're being returned to
promise it and it's saying that for
whatever reason this is now deprecated I
think it saw that the developer has a
bit more flexibility in what promise
library he or she wants to use because
there's quite a lot of them out there
Bluebird queue etc what I'm gonna do is
use es6 ease default promise library and
I'm going to show you how we can
implement that in the very next tutorial
so I'll see you guys then</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>