<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>OAuth (Passport.js) Tutorial #8 - The Redirect URI | Coder Coacher - Coaching Coders</title><meta content="OAuth (Passport.js) Tutorial #8 - The Redirect URI - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>OAuth (Passport.js) Tutorial #8 - The Redirect URI</b></h2><h5 class="post__date">2017-10-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/or1_A4sJ-oY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey gang welcome to your eighth awhile
tutorial and in this video I'm gonna
talk a little bit more about the
redirect URI alright so then in this
video I want to talk about a couple of
things first of all this authorized
redirect URI which is currently set to
whatever so we'll talk about that in a
minute and also I want to talk about how
we can actually kickstart the passport
set up so that we can start the
authentication process because at the
minute although we've kind of set
passport up here in this file and we've
added these keys so that yes when we
wants it we can use the Google API to
authenticate users we're not actually
doing anything with this code at the
minute it's not even executing at all
all right so we're going to talk about
how we can kick start this
authentication process as well but first
of all let's go back to this redirect
URI what is this well I'm just going to
bring up this diagram once again now
remember this flow at this point right
here where a user is granting permission
for us to use their credentials and that
permission screen looks like this
remember so at that point when a user
clicks allow what we're doing is
redirecting back to our server to a
custom redirect URI so this thing right
here is this thing right here where do
we want the redirect to go after a user
clicks allow Google needs to know that
all right so instead of whatever right
here we're going to delete that if we
can so get rid of that and we're going
to go to for slash auth /ik Google
because what authenticating using Google
and in the diagram I said cb4 call back
but now I've decided I want to call this
redirect it just sounds better more
logical so let's save that now and now
Google knows on here that when a user
clicks allow on the consent screen they
know where these applications should
redirect to now this is not the only
place we have to add in that redirect
location we also have to add it in the
setup of this Google strategy right here
as another option down here so let's do
that so this is called callback URL and
this is a string
so we need to pass through the same
string so /off /gu --gel ford / redirect
only this time we don't need to add in
the localhost port 3000 at the start it
automatically knows where it is okay so
it's just going to go from the root and
then this address right here which is
going to be the same as this all right
so now we have that property inside the
Google strategy as well don't forget
your comment and by the way I've just
noticed I've added this parentheses
right here when it doesn't need to be
there because that's just one parameter
this object of the Google strategy the
second parameter is this thing right
here so we don't need this parentheses
which was there initially okay so get
rid of that okay so let's save this file
now we've added in this redirect so
we're going to create that route later
on in earth routes but for now I want to
talk about how we can kick-start this
authentication process so at the minute
this kind of probably doesn't really
make sense anything that we're doing
we're just setting up Passport we're
adding in this callback URL the client
ID the client secret you know setting up
this API online and we're not doing
anything with this code so at the minute
if we go to login and we click through
this Google+ all we're doing is we're
going to forward slash auth /ql and
display this message we don't want to do
that if we open up this diagram again
what we've done is we've clicked this
button and we've gone to /or /tpour this
right and we've handled that route over
here in nodejs
and you can see that if we go to author
outs it's this thing right before slash
auth /gu --gel and we're sending this
message back but at this point we don't
just want to send a message back to the
user same logging in with Google we want
to interact with Google send them over
to that consent screen so that a user
can log in and say yes ok this
application can use my details
so it's this process we want to focus on
now we want to kick-start this
authentication process and passport is
gonna help us do this right so instead
right here of just sending this
respondents login him into Google
instead of that we want to handle
this section with passports so that it
goes to the consent screen so how are we
going to do that exactly well it's
pretty simple all we need to do is get
rid first of all of this junk right the
second parameter and so now we just have
this router get /gu --gel for the first
parameter the second parameter now is
going to be passport authenticate now to
use passport we first need to import it
so I'm going to say at the top Const
passport is going to be equal to a
require passport and now we can use it
down here so when a user goes to /a /li
want passport to take control to
interact with Google and send it to the
consent screen and the way we say we
want passport to do that is by saying
Passport
dot authenticate which is a method and
this method is going to take a parameter
now how do we want to authenticate the
user we want to use the Google strategy
that we've set up right so we can say
Google so when we set this Google
strategy up right now we're attaching it
to the passport object right and we're
importing this Passport object in right
here and it's got that Google strategy
associated with it so when we say Google
in here it knows to activate the Google
strategy to authenticate someone and
it's going to redirect them to the
Google consent screen if you like
alright so that there is the first
parameter this thing Google in this
authenticate method we're telling it
which service we want to use to
authenticate on which strategy so the
second parameter right here is going to
be an object in inside this object we're
going to declare the scope property and
the scope property is basically telling
passport what we want to retrieve from
the user's profile do we want just the
profile information are there emails or
other information and all that goes into
an array now I just want the profile
information so we pass that into a
string but if you wanted all the stuff
you could copy us come and separate them
and add them in alright so the Google
API is going to give you all the
information about the different things
you can pop in here and I'm just going
to put in the profile so if I save this
now we have this route set up so that
when someone goes to file / Google Earth
for /off forward slash Google passport
is going to take control and send them
to the consent screen and it's going to
say we want your profile information
would you allow this app to get it all
right but it's not gonna work just yet
so if I save this at the minute then if
I try to go to forward slash forward
slash
then we're gonna get an error it says
unknown authentication strategy Google
now this is because this code right here
is not running here we've created the
code but nowhere in this application is
this code actually running we don't kick
start it when we say no daman up this
code is running but not this so in order
to get this running what we need to do
is require it from here
and if we require it then it's gonna run
over here on the right make sense so I'm
gonna go back to a pas and say Const
I'll call this passport set up and set
it equal to a require and inside we want
to say dot forward slash for the current
directory then go in the config
directory then get the passport - set up
file okay so now we've required that in
fjs so that when a pas runs it says hey
I need to require this dude over here
this file it goes into it and it runs
the file so now this Google strategy is
associated to this passport object
so therefore in or through all through
outs it knows what this Google thing is
now it knows about that Google strategy
because that code is now run make sense
all right so if we save this again
let's go back and try refreshing first
of all then I'm gonna log in using
Google again this time it's redirecting
me to that consent screen and it's
saying choose an account I can use the
net ninja or another account alright so
let's see what happens I'm going to say
the net ninja hmm now it's trying to
redirect me after I've logged in with
that account so right now we've said in
the past port setup that we want to
redirect to here
gone through the authentication with
Google the consent screen have said a
1-ton login with the net ninja and is
trying to redirect me to this URL right
here forward slash auth forward slash
goggle forward slash redirect and that
currently is up there but it doesn't
exist it's not there yet right we don't
have this handler for it so in order for
this to work and for it to redirect
correctly we need to create this handler
so let's do that
underneath this we'll say in a comment
first of all call back route for Google
to redirect to okay and then we'll say
router don't get and it's gonna be /gu
--gel forward slash or redirect remember
auth is automatically placed in front of
it because we specify that right here so
it's for slash auth for slash Google
forward slash redirect then what we want
to do is take the request and the
response object and fire a function when
someone reaches this route and inside
here all we're gonna do is send a
message will say response dot send and
we're gonna send them a message which
says you reached the call back URI
okay so let's see if this works once
again if I now go back and sign in with
the net ninja then we can see you reach
the callback URI
so this is now working we've now
authenticated with Google and we've said
to pass ball and our application look
yeah this user is allowing you to access
their information now I said before over
here that when we grant permission and
we redirect over here we get information
sent to us right that is not strictly
true what we get sent to us is a code
right here you can see after redirect we
have this query string which says the
code is equal to this thing of him so
this is a code that Google is sending to
us right and at this point we have
access to that code and passport can use
that codes interact with Google to then
grab the information that we want okay
we doesn't come back automatically with
the information but passport can then
access that information so what we're
gonna do in the next tutorial is talk
about this a little bit more and the
next step in the flow which is going to
be all to do with this passport combat
function right here so we'll talk about
that in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>