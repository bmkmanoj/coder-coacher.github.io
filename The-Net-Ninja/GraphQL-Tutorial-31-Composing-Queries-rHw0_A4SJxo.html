<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GraphQL Tutorial #31 - Composing Queries | Coder Coacher - Coaching Coders</title><meta content="GraphQL Tutorial #31 - Composing Queries - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-Net-Ninja/">The Net Ninja</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GraphQL Tutorial #31 - Composing Queries</b></h2><h5 class="post__date">2018-04-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rHw0_A4SJxo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright then so in the last video we
hooked up the functionality of this form
to the components so that when we start
to enter details into these different
form fields or select and author right
here it updates the state of the
component then when we click on the add
important it logs the state of the
components to the console so we can see
the author ID that we've selected the
genre and the name that we've entered
into these new fields now that's cool
we're taking a step forward but we're
not really doing anything with that data
and ideally we'd like to make a mutation
on the graph cue our server to add this
book to the database so let's look at
how we can start doing that the first
step is to actually make this mutation
this query so let's go to the query CS
and add it in right here so we'll store
this in a Const and call it add book
mutation since we're adding a book right
and set that equal to g ql much like we
did with these other queries that we've
composed or created and then we'll do
our template string then inside we want
to open up our curly braces but because
this is a mutation remember we have to
add the keyword mutation before the
first curly brace here alright so what
is the mutation we want to make well if
we remember back to our server-side code
over here let's go into the schema and
we'll take a look at the mutations that
we have down here and one of them was
add author one of them was add book so
this is the name of the mutation we want
to create and it's expecting these three
arguments the name the genre and the
author ID and they are the three things
on this form the name genre and the
author ID so let's make this mutation
now and pass in those three parameters
so it's called add book and we're taking
three parameters the first one is the
name parameter and we don't know that
just yet so we'll enter an empty string
the next is the genre and again we don't
know what that's going to
be yet so let's just put an empty string
and again the same we're gonna do for
author ID just an empty string to begin
with and we'll look at how we can
dynamically populate these later
depending on what the users entered into
the form but for now empty strings are
fine so we're going to make this
mutation which is going to add a book
right and if we call this right now it's
just going to add the book with these
three properties or being empty strings
now that's fine for now when we make the
mutation we can request some data back
and I'm going to choose the name right
and I'm also going to choose to get the
ID of that book back so that is our
mutation let's export it right here so
add book mutation and then what we need
to do is import this mutation into the
add book component right here which is
where we're going to use it when we
enter or submit the form so from this
same file we can just do a comma and say
add book mutation which is there and now
we can use insert here so then now we
have two mutations or rather one
mutation and one query inside this
component that we want to use now down
here all we're doing is we're binding
that one query but we've got to
essentially now that we want to bind to
the components so how do we do that how
can we combine or rather bind both of
these different queries to the component
well there's a couple of different ways
we can do this the way I'm going to show
you is by using the compose method now
we have to import that at the top here
from react Apollo so I'm gonna do a
comment next to this and import compose
right there so we can use this compose
function at the bottom here where we're
binding the queries to the component and
the reason we need this is because we
can't just do something like this we
can't just add in another set of
parentheses and say okay well also I
want to do the add book mutation and
bind that as well this doesn't work we
need to compose the two queries together
right when we're exporting this
component so
let's instead get rid of this and get
rid of graph QL and we're going to
export defaults compose which is the
thing we just imported and then in
parentheses we're going to do something
we're going to compose our queries we're
going to keep add bulk at the end we're
still attaching whatever queries we add
in here to the ad book component so that
stays there but now we can list out the
different queries and mutations that we
want to compose together for this
component right so again we use graph ul
much like we did before and we say we
want to bind the get authors query first
of all right that's the one we initially
had bound to this thing right here and
we're going to give this a name property
this is going to become clear as to why
we give this a name property in a few
minutes when I walk you through how we
attach these queries up here but the
name is going to be the same thing as
the actual variable here get authors
query doesn't have to be but that's what
I'm calling it okay the next query or
mutation I'm going to compose here is
the add book mutation so I'll say graph
QL again and add book mutation and again
we give this an options object right
here and the name property is going to
be this time add book mutation like so
all right so now we have these two
different mutations or rather this
mutation and this query composed
together and they're both now bound to
this component right so that's how it
combined several different queries and
mutations together to one component
because sometimes you do need to bind
multiple queries to one component it's
not always one query all right so then
first of all how does this affect what's
currently going on here
well let's just give this a whirl in the
browser and see what's happening right
then so we get an error and the error is
basically round here if data loading so
let's just take a look at what's going
on here so it says cannot read property
loading of on
defined right so at the minute it's
saying that this data is undefined right
here we're setting data equal to this
drop stop data and then it's saying
cannot read loading of undefined so it's
saying this here is undefined right so
instead let's console.log this dot props
right and let's see what happens here
what's happening to the props now now we
have two different queries or a query
and a mutation attached or bound to this
component let's see how it's attaching
those to the props object so let's save
it and rerun this in a browser and we
can see if we scroll right to the top
before the before the errors we can see
this thing here we have two properties
on here now we have the ad book mutation
and we also have to get authors query
and if we look inside to get authors
query these are all the same properties
as we had before on the date object but
since we're making two different queries
are a query and a mutation now we don't
just get that data property we get the
names of these two different queries
right so the ad book mutation is going
to get the different properties for this
query and they get all of this query
property it's going to have the
different properties of this query right
here so instead of saying data we can
say get authors query so let us go over
here and say the data is equal to list
props get authors query like so okay so
this here is just replacing the data the
name of that property that this stuff is
attached to this particular query and
the reason it has this name is because
we named it like that down here when we
gave this a name property right so let
us save that and see if this works now
we'll go to the browser and you can see
now they're displayed on the screen and
we have this get authors query right
here which is showing all the authors
now right so we have Patrick Rothfuss
Sanderson and terry pratchet
everything's working now cool so now we
know how to compose queries together
and how to access the data from those
queries separately but how do we
actually make this mutation right
because at the minute if I do this book
name and at no test and then the genre
is fantasy and by the way this is
updating because we're console logging
the the prop every time the componentry
renders okay so we'll change that in a
minute
let's select author Patrick Rothfuss if
I do this now then we're still logging
out this state right here but we're not
actually making that mutation right
we're adding or we're binding that
mutation to the component but we're not
really doing anything with it all we're
doing is logging the state still to the
console so how do we now access this
mutation and make it from the react
component
well pretty simply so here we're we're
currently logging this this dot state to
the console we'll get rid of that I also
want to get rid of this console dot log
as well and instead what we're going to
do is call that mutation when we click
on that Add button and we call this
submit form function right so we do that
by seeing this dot props dots ad book
mutation just like that so just like we
said this dot props to get the data from
that get authors query to use the add
the book mutation we say this dot props
ant book mutation right and again the
reason it's this name is because we gave
it that name at the bottom here add book
mutation so whatever we call it there we
can call it right here when we invoke
that function so what's going to happen
here well this is gonna add a book but
it's gonna add that book and it's not
going to have any values because in our
queries when we call the mutation we're
not actually passing any values through
here yes they're on the states right
here okay they're being stored in the
state of this component but we're not
passing what is on the states these
different properties into the mutation
when we call it so let's just try this
out open it open a browser and refresh
now let's add a book name so
we'll say hogfather now this is fantasy
and it's by terry pratchett right so
let's press Plus now and okay nothing
seems to happen
but if we now go to M lab and have a
look at our collection of books we
should see something has been added so
if we go to the bottom there's a new
record here but it has a name of nothing
genre of nothing and an odd author ID of
an empty string as well all empty
strings right there so like I said
that's because when we make this query
we're making it we're calling it right
here right and it's looking at this
query and it's making that mutation but
when we make the mutation is only
passing these through as those variables
so now we need to find a way to
dynamically pass through the variables
that are being stored here the state
into this mutation so that when we add a
new book it's the correct values that
are passed along into that record</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>