<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tutorial: Diving into Android Source Code | Coder Coacher - Coaching Coders</title><meta content="Tutorial: Diving into Android Source Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tutorial: Diving into Android Source Code</b></h2><h5 class="post__date">2013-12-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NsqFOSzoYE8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi I'm Dave Smith I'm a senior Android
develop
an embedded Android enthusiast and I
teach Android classes for new circle
today I'd like to share with you some
tips for navigating the source code of
the android framework as Android
developers I believe this is an
underutilized skill that we should be
striving to hone because Android is an
open source framework we can investigate
its implementation and gain a unique
depth of understanding into how it works
and how to make it best work for us
documentation can be wrong outdated or
even lacked specifics but the source
code can never steer you wrong this is
not to say that the SDK documentation is
of no use but we cannot always rely on
it to explain every behavior that might
affect us
additionally the source code can be
quite instructive in implementing
performant code for requirements that
may be similar to but not quite the same
as the framework components I'm going to
show you a couple different tools and
methods of getting into the source code
from the light and simple to the deep
dive we'll start off with some tools you
can use inside of your browser to
quickly and easily get access to the
source of individual class elements from
right within the SDK documentation
you're likely already familiar with the
first step is going to be to make sure
that you have google chrome installed
both of the source diving tools we're
going to look at in this section are
browser extensions that only work in
chrome if your daily browser preferences
lie elsewhere I'm hopeful that exposure
to these tools will cause you to
reconsider or at least while you're
developing the first tool we're gonna
look at is the Android SDK reference
search by Roman Nurik this extension
provides two major benefits the first is
in addition to the omnibar allowing you
to jump directly to reference
documentation for any class of interest
the second and more salient to our
discussion here is the addition of the
view source link that will be added to
all the dock pages so that you can link
directly from the reference Docs into
the source code for that class from
within the chrome browser we need to
gain access to the Chrome Web Store
now the webstore can be accessed either
from the apps button on your browser
tabs home page or by just going to
Chrome colon slash slash apps and we can
select the store here and we'll have the
option to look up this extension so
we're gonna search for this extension
just SDK reference search how to do it
and the one we're interested in here is
this Android SDK reference search so I
can click on that and you can start to
see just from these screenshots the two
features that I've already talked about
the omnibar search and the view source
link so to install this into our browser
we just need to click on this button up
here answer any questions that may have
for us and we're ready to go so now in
order to use this extension all we have
to do is prefix what we want to search
for by typing ad space and you'll notice
that it automatically turns into the
Android SDK reference search there at
the beginning so now I can start
searching for any framework class that I
would like to get the documentation on
let's say I want to figure out more
about intents service so I can start
typing intent service and you see as I'm
typing it's looking or it's filtering
search results for classes the training
pages and everything else that's on the
SDK site and once I've found the class
that I'm interested in I can just hit
enter and jump directly into that page
on developer.android.com now that's cool
but what we're really interested in is
the fact that now we're here we have
this view source link attached to the
class documentation so if I go ahead and
click on that link now I go from the
documentation into the source code for
this class so you may notice that by
default what I'm looking at is the
master branch but where I am right now
is in the the web repository of the AOSP
so I'm looking at the actual source code
for intent service that is implemented
on this device so at this point I can go
through I can look and see exactly how
intent services put together you can see
in general it's actually an extremely
simple class it's less than 200 line
of code and I can learn what I need to
from this example now I mentioned that
this shows up as the master branch and
you may be more interested in looking at
a specific version that goes along with
a specific version of the Android
releases or the other pieces of the
source code so in order to do that we
may want to change this branch to
something more specific now also there's
a couple ways you can do that but
typically the easiest way is just here
in the URL change this master to the
name of some other branch that you're
interested in viewing so for instance
I'll change this to the latest release
and say we want to look at the KitKat
release branch now you see that the URL
changes here and now what I'm looking at
is the version of intent service that
was basically shipped with the KitKat
release now the next question is usually
how did I come up with that branch name
and if if we go back to this top level
of the framework project that we're in
you can see that there's actually a list
of all these branches and tags for the
Android source so if I click on more I
can get a list for all of these so you
can see if you haven't seen this before
that the Android source is typically
tagged with individual branches and and
reference tags for major releases dev
releases and even point revisions and
bug fixes so if at any point you want to
look at a specific version of the
Android source you can just change from
master which is what the reference
search a plugin does for you you can
change that to any one of these other
branches to look at the specific version
of your class for Froyo gingerbread or
anything along those lines okay so the
other interesting thing to notice here
is that this doesn't just work for
classes in the core framework it works
for pretty much everything that is on
developer.android.com so if I come in
here I can also search for a class like
viewpager a viewpager is interesting
because it's only available in the
support library it's not part of any
specific release of Android but yet
again if I come
in here I have a view source link and if
I click that link it will take me to the
source code for view pager again by
default on the master branch but we can
change that so this also works for any
of the source code that is available in
the support library the app compat
libraries or any of the other
compatibility packages that google has
produced to go along with android next
up is the android resource navigator by
Jeff Gil foe
this extension provides slightly deeper
searchable access into the omni bar for
styles themes and other resources used
by the platform
additionally XML and image resource
references in the github AOSP mirror are
linked so that you can click on them to
jump directly to their implementation
without the need for another search and
in this case whether or not you started
that search from the omni bar so let's
take a look at how to get this installed
here in the browser so if we're here at
the web store we'll go ahead and run a
search for the Android resource
navigator and we'll see that this guy
here is the one we want so we'll pull
that up there and again from the
screenshot you can start to see what
this is going to provide to us so the
abilities to do some more searches of
themes and widgets from inside the omni
bar there we'll go ahead and add that
extension say yes and we're ready to go
now similar to before we're going to run
these searches using a prefix but where
we used ad before this prefix is going
to be a RN space and you'll see that it
shows up with the Android resource
navigator to let you know what we've got
available here so for instance with this
I can do a search for say a specific
system theme so let's use one of the
common themes the holo light with the
dark action bar so I can start typing or
theme holo light and again you can see
that as I'm going through this it's
providing me the results there so I can
pick the one that I need as soon as it
shows up and I'm interested in looking
at the theme for the dark action bar so
I can go ahead and hit enter
there and you'll notice this time it
takes me to get hub rather than the
official web mirror of the AOSP but it's
the same code so and jumps me straight
inside of the platform's themes XML file
to that exact style that I requested so
now I can look exactly at how this
hollow light-dark action bar theme is
implemented in the platform I can see
all of the resources they use all of the
different style values and I think the
most important thing to look at is that
all of these values are actually linked
whereas if you were to look at this page
without having this extension installed
these values would be here but you
wouldn't be able to click on them so
straight from here I can say I want to
look at this background image and see
what they put and it will jump me
straight into that resource so that I
can take a look that that I think over
the the searching of this is probably
the most important piece of that this
extension adds to the platform for you
so in addition to themes I can search
for really just about anything I can
search for widgets tiles so I want to
look at how the the textview or the edit
text are defined in different themes you
know I can go ahead and pull those up
anything that's defined in a resource
file you can search for using the
resource navigator so for instance I
could pull up the theme for alert dialog
and we could see how an alert dialog is
styled inside of the holo holo system
theme so again once this comes up we'll
see it pull up and you'll notice that
again we have all of the attributes here
linked to their implementations so that
we can kind of dive through this theme
and see how did they implement something
do I want to do it the same way what
were those dimensions all of those
pieces so last time I showed you a
drawable but you know for instance here
there's a number of different core
layouts that are used in alert dialog so
I can again click on those layouts and
it'll jump me to another XML file so I
can just quickly look at that layout
file from looking at the theme or style
and it's very fast very seamless a very
efficient way of getting your way around
the platform resources inside of the
android framework when you get to the
point where you want to dive a little
bit deeper into the framework and system
services the browser environment can be
a bit constraining so let's move beyond
this and see what we can accomplish with
the command-line tools that are bundled
into the Android Open Source project for
this we're gonna first need to obtain a
local copy of the source tree so the
best way to do that is if we go back
here to the Chrome browser and we take a
look at source.android.com this is going
to provide us all of the instructions
that we need to obtain a copy of the
Android source and basically get the
specific version that we're interested
in
so from source 10 recom if we click on
the source link there's a section over
here for downloading and building and
underneath that section there is an
aptly named location for downloading the
source so these instructions are what
we're going to just sort of simply walk
through to get you a copy of the Android
sources onto your machine so the first
tool that you're gonna need to work with
is a tool called repo now repo is
essentially just a giant Python script
that Google uses to allow them to more
easily work with a large number of git
repositories that make up the individual
projects of the AOSP and allow them to
work with all of those projects and
bring it into one single concise format
that they can build together as the
single Android open source project so
it's it doesn't have much specific use
for us other than it's the tool that
we're going to use to synchronize the
source from the remote down to our
machine so if we if we walk through the
steps we can see here basically the
steps you need to go through to obtain
the repo command into your command line
environment so that you can execute it
once you have that on your machine we
need to initialize a repository where
we're going to put the Android source
okay so the command that we're going to
use for that is repo in it now what you
provide to repo init is a URL
that represents a manifest of all the
different Android versions that you may
or may not want to check out so in this
case for the Android Open Source Project
we're going to use this URL that's here
in the instructions F for Android Google
source comm now if you were to run this
command just as it's shown here on the
first line what you would end up with is
you would initialize a repository that
would essentially check out the master
branch of AOSP
but we talked before about the fact that
individual releases of Android actually
are branched or tagged by those specific
names inside of the source tree so if as
part of checking out the sources you
actually want to check out a specific
version then you're going to want to use
this version of the command that's down
here underneath that has the - B flag
attached to it so if you would then
instead run repo in it with that same
manifest URL and then the name of the
branch you want to check out now this
could be any of those tag references
that we saw or any of those branch names
like Gingerbread Froyo or KitKat and you
just place that here and run repo in it
now what this command does is it sets up
your environment to check out the
version you're interested in but it
doesn't actually pull down any files so
running this command takes a little
while but it really does nothing more
than initialize the tool in order to
actually get access to the source files
the next step in the final step is to
run a repo sync repo sync is the process
that will go through all of the
individual projects that make up a OSP
and download the appropriate version of
the source code to attach to the branch
or tag that you initialized with so once
we've gone through this whole process
and this sync will take a while so you
may want to do this and then go to lunch
or go take a nap because it's probably
going to take a couple hours to get all
the sources down to your machine but at
this point once we have once we have a
sync completed on our machine then we
can go through and actually investigate
the files and sort of get a feel for how
the structure is put together so once
we've downloaded the source you should
have a directory somewhere
on your machine that looks like this now
this directory in our environment we
just call it the AOSP directory but
you'll know you're in the right place
when you see things like the device
directory frameworks directory or the
hardware directory or the packages
directory so when you see a list that
looks very similar to this one then
we're in the root of our source tree now
the very first step that we have to go
through is we're going to set up the
build environment using a shell script
that comes along with a OSP called env
setup so the first thing that I'm going
to run from the command line here is a
source build env setup the env setup
script is in the build directory that's
all that means
and I'm going to execute that shell
script now the primary purpose of
running this script is to prepare the
build environment to compile an Android
system image it's setting up environment
variables paths as well as some command
line utilities but it loads a good
number of very helpful utility tools
that actually are good for doing some of
the source diving and investigation that
we're interested in even if we're not
actually going to build the Android
source so for instance there's one
utility that gives you basically a list
of all the other commands called hmm so
if I run the hmm command I'll get a
printout that looks just like this of
some of the more common or more popular
commands as well as a complete list of
everything that has actually been loaded
into my shell for one reason or another
as a part of running the script now I'm
just going to walk you through what I
think are the most interesting commands
for doing source diving but if you're
curious you can look through all these
commands here and see what they do
so the commands that I'm going to walk
you through are the go dir command these
grep utilities and the sea root command
so let's take a look at an example of
this the first utility that I want to
show you is the go dir command
now go dir has a very specific purpose
in that it allows you to provide a
search string to jump anywhere in the
Android source
any specific file that may match the
search that you've provided so let me
give you an example let's say I want to
look up intense service like we had
before from the command line here I can
type go dir intent service and hit enter
and what I've provided with is a list of
possible options of all the different
places inside the Android source where a
file that matches intent service lives
so one of the nice things about this is
I can provide partials and I can then
use by picking a specific number I can
jump to a specific directory that has
the file that I'm interested in without
having to figure out what that directory
is and then change my way all the way
down there from the command line so for
instance in this case the one I'm
interested in is the one in the
frameworks directory so I can just hit
number three and immediately my path
jumps to that directory there I didn't
have to do anything it jumped me right
into that location so now I can just
actually go and look at that file and in
this case now I can see that exact same
source code that we saw earlier in the
browser but now I'm looking at it
locally on my machine using the the
command line tools that are available to
us
so go dir is extremely helpful because I
can jump to I can jump to any file
pretty much from anywhere so I don't
have to go back to you know the root
directory or anything like that if I
want to run another search from here
let's say I want to look for the
notification manager system service then
I can just do another go dir for
notification manager and again be
provided with a list so that I can jump
to that location from there so I can
just continually move my way around the
Android source without too much trouble
and not having to continually change
directories up or down the tree so as
I'm tracing source code from one class
to another it's very easy to follow that
path by just jumping from one file even
though those files may or may not be
co-located in common places inside the
Android source now that's helpful
but we don't always know exactly what
file we want to look in next so the next
set of utilities that I want to show you
are these grep utilities so most
developers are familiar with grep as it
is inside of the system but these
rappers such as J grep C grep M grep and
res grep are just wrappers around that
score system utility that allow you to
search through specific portions of the
Android source for whatever it is you
may be looking for so for instance as an
example let's say that I know there is
such a thing called the received Boot
completed intent most developers have
are aware of this or have used it before
but I want to look more about how that's
actually implemented in the Android
source so let's start off by saying well
let's look for a a J grep for receive
boot completed which is going to run a
search for all of the Java source files
inside of the Android source that match
that particular string now you notice it
didn't do anything and I did that on
purpose because grep utilities unlike go
dir have to be run from higher up in the
hierarchy or at the very least from the
root of the source tree otherwise it's
only going to search from the current
directory downwards so what I really
need to do is jump back up to the end
the top of the source tree before I run
this now I'm kind of deep in the source
so I don't want to necessarily have to
type something like this because that's
just plain annoying we've all had to do
that before there is another utility
that is part of the build environment
script that allows me to not have to do
that called C route by type C route from
anywhere inside of the Android source it
will jump me back to the top of the
source tree so now that I've been at the
top of the source let's run that command
again and what we'll see is the result
of where receive boot completed shows up
in all of the Java source files inside
of AOSP
so you know now I can go look at these
results and say alright well I'm
interested in intent Java because that
has some implementation
in it so I'll use my NGO dir command to
open that file up so we figure out which
one it is based on the path and it's
number two so then I can open that file
and then let's say I'm also interested
in the activity manager service
underneath so right from where I am I
can go dir for the activity manager
service and in this case notice it
jumped there without any options so one
of the features of go dir is that if
your search string only matches one
result it will automatically change the
directory for you it will only give you
the list of numbers if there's more than
one option to select from so from here I
can edit or open my next file and I can
open as many of these files as I'd like
as I'm tracing through the execution or
the implementation of how received boot
completed looks inside of the Android
source but that's not the only place
where received luke boot completed
exists let's say that I know for a fact
that because it's an intent its defined
inside of an XML file somewhere so I can
use another one of these utilities
called res grep with my same search
string and if you're smart you'll
remember from the previous example that
we have to jump up first
and this time the results that I get
back will be for all of the XML or
resource files that are inside of the
platform so in this case you'll notice
that the one result that I receive is
for the platform's androidmanifest.xml
file so again I can use my go dir
utility to find that now I know for a
fact that because there's a lot of
applications in the Android source if I
just do a search for Android manifest
I'm gonna get a long list so for my go
dir I'm actually going to provide part
of the path inside of this search string
so that it takes me to the right place
so I can open that file and then I can
actually look at the implementation of
the receive boot completed string okay
and then I'm all done jump my way back
up to the root now there are again two
more pieces or two more utilities that
are based off of grep in in addition to
J grep and res grep there is also C grep
which will allow you to run this exact
same search through all of the C or C++
files that are in the Android source and
M grep which will allow you to run your
search through all of the make files
that are in the Android source so if
you're interested in looking at a
specific module name or package
information that is specific to one of
the module builds when you build the
system image M grep will look through
all the Android item K files that make
up the Android source tree lastly I'd
like to share with you some guidance to
keep you on the right track the Android
source is a big place but hopefully with
these thoughts we can help you find the
signal among the noise most of the core
system applications will be found in
packages apps source code for
applications like browser launcher and
settings can all be found here
additionally a handful of applications
also live in frameworks base packages
most notably system UI which is the
application that is in control of all
the system chrome for the Stata
bar window shade and soft nav buttons
much of the framework is contained in
frameworks based core with a few
individual packages like telephony and
location living in their own directories
under frameworks base it is important to
realize that the Android API s are not
entirely written in Java
many of the framework classes have a
native C or C++ component to them a OSP
typically segments these files into a
separate Java and j'ni directory
the latter standing for Java native
interface and including those native
components the XML and drawable
resources in the framework are located
in the res directory of frameworks base
core you will find this file hierarchy
structured similar to what you would
find in an application project with XML
resources in the drawable layout values
and XML directories and image resources
in the qualified directories such as
drawable hdpi the platform also has its
own Android manifest file which contains
the definition of published system
elements like permissions many of the
system level activities and receivers
are also published here this is where we
saw the implementation of receive boot
completed in our deep dive example
previously most of the system services
available to applications follow a
common implementation pattern as well
the classes that are accessible to the
application such as package manager or
an OK notification manager are typically
found somewhere in frameworks base core
and are very thin wrappers around method
calls to a single service object that's
running in a remote process these
service definitions where most of the
implementation code exists are usually
found in frameworks based services with
names similar to their corresponding
manager such as package manager service
or notification manager service as we
discussed earlier these services are
usually not entirely written in Java and
may very well include a native C or C++
component of their own because of this
the implementation is typically split
between the Java and J
nine directories if you'd like to dive
into more detail about how Android works
then I would encourage you to sign up
for one of the upcoming Android
internals classes that I'll be teaching
for new circle if you'd like to learn
more about our work at double encore you
can visit us at mm core comm thanks very
much for your time today and I hope you
learned something new
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>