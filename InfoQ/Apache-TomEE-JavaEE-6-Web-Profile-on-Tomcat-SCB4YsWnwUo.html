<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Apache TomEE: JavaEE 6 Web Profile on Tomcat | Coder Coacher - Coaching Coders</title><meta content="Apache TomEE: JavaEE 6 Web Profile on Tomcat - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Apache TomEE: JavaEE 6 Web Profile on Tomcat</b></h2><h5 class="post__date">2013-08-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SCB4YsWnwUo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everybody my name is David
Blevins and I'm here to present Apache
Tommy before I get started about myself
and all that stuff when they ask you
some questions about yourself so who
uses Tomcat to raise your hand okay
the entire audience it's pretty it's
pretty common who also uses another app
server like JBoss or GlassFish about
half the room it's usually more about
3/4 the room but it's a pretty common
theme you tend to get as far as you can
on Tomcat and then where it falls short
you end up having to use another app
server like glass face or JBoss because
sometimes it can be too difficult to
build all those things up on Tomcat
yourself that's precisely what Tommy's
about so what is Apache Tommy
you want me to before I say Tommy you
know I I myself have been working in the
Java EE space for I guess maybe 10 plus
almost 15 years since 99 when we when we
started Apache open EJB and then
Geronimo and I've been working on the EE
specifications since 2004 or so eg B 3.0
was my first set of Java EE
specifications and later
ee 6 and now 7 which is just as
completed and so having worked in this
space for a long time I just felt that
the whole world used Tomcat and so to
try and sell people anything else was
just pushing a rock up a hill so why not
take Tomcat and finish it I mean Tom e
specifications and various technologies
have progressed over the years and
Tomcat has stayed same not for the lack
of people needing more things like
jax-rs and JPA and not that these things
don't have better integration then then
what's you know they're in Tomcat you
know so we decided to go ahead and let's
let's let's put Tomcat in the same realm
as all the other Java app servers
so what is Tom what is Tommy it's a Java
EE 6 web profile certified stack it's
pronounced Tommy not Tom EE
it's Tommy like the name you may know
someone called Tommy and they probably
think this 5 server is pretty cool
it's Tomcat through and through so our
very very very very core aspect of it is
to not mess up Tomcat so if we've done
something you know to mess with that
experience it's it's not what we want
it's all Apache components that we've
added to Tomcat so open JPA
open web beans open EJB my faces bean
validation cxf and ActiveMQ and then our
core values that really focused the
project and I think these are you know
kind of an interesting and unique
perspective amongst app servers
specifically is be small so we don't
want to off of the world another large
app server I don't think there's much of
a need for that there's plenty of good
app servers out there but they're fairly
big in size Tommy is small very small be
certified so unlike you know when you
put all the stuff together on Tomcat
yourself it doesn't it's not certified
what certified means that there's a very
large test suite that you have to pass
they all when you integrate all the
stuff together you have to run these you
know tens of thousands of tests that are
provided by Oracle and then when you do
that you're certified and then of course
be Tomcat so if we've done something to
mess with the Tomcat experience then
we've done a really we've done something
seriously wrong we've we've valid you
know violated one of the core tenets of
the project so if your app runs on
Tomcat and it doesn't run on Tommy
that's a big issue so please let us know
and then we will fix that immediately we
take those into the
highest to the highest level of severity
so a lot of this hinges on what is you
know that Tommy is a web profile
certified server the question is of
course what is the web profile so who
has actually heard of the web profile
already all right so who's heard of Java
EE just in general
ok everybody of course so you know how
people would say Java is big and bloated
and in some regards they were correct
and so what we did in ie6 at the
specification level is what we decided
to do is create another version of Java
EE that is basically half the size of
Java the full profile so this smaller
version is called the web profile the
web profile cuts out a lot of the legacy
technologies and allows vendors to
create certified servers that are half
the size of these big bloated legacy
systems so when you talk to somebody and
they say Java EE is big and bloated bla
bla bla bla ask them the question have
you heard of the web profile if they say
no stop listening to everything they
have to say if they say yes then
definitely listen to what they have to
say and communicate that that back to me
and we'll try and make sure that that
feedback reaches this specifications so
what is cut out that is in the full
profile that is not in the web profile
some big examples of that are CORBA cmp
entity beings if you've ever had to work
with C and PN any beans I I apologize
Jax RPC if you ever had to work with
that I'd apologize three times more I've
had to implement all these things and I
can tell you how much of a bear they are
the predecessor or the successor to
these technologies are of course jax-ws
replaces Jack's RPC JPA replaces cmp
entity beans and korva just no one uses
that
we're all into text base type of stuff
like jax-rs
unfortunately in Java EE 6 the web
profile is missing some good
technologies those are listed down on
the bar jax-rs is a really important
technology that's actually now in the
web profile and Java EE 7 jax-ws which
is soap in various types of XML Web
Services that's in the full profile we
do a version of Tommy with it in it
JMS is a very still very useful
technology if it's only in a full
profile up not in the web profile but we
of course we do have a version of Tommy
with it in there and then connectors
which is something people don't really
hear a lot about because it was sort of
one of those specifications that was a
good idea that never went anywhere we've
revised that quite a bit in Java EE 7
and fixed it up and so that's now going
to be a very important part of Java EE
going forward that's not in the web
profile flavors of Tommy's so to address
these basic kind of levels of need we
have three versions of Tommy so the
first one is the web profile contains
the minimum set of technologies required
to pass the Java EE 6 web profile TCK so
we don't go over that by any significant
margin so that you can have the smallest
level of components and still have a
certified portable server so other
vendors like Red Hat Oracle IBM they all
have web profile certified servers and
you can port your applications from
those or to to and from Tommy to them or
from them to Tommy then we also have
Tommy jax-rs which was sort of a forward
thinking type of distribution we
anticipated that jax-rs would be added
to the web profile so we wanted
basically what would be the web profile
and Java EE 7 so that's Tommy jax-rs
it's all the previous technologies plus
the jax-rs which is supplied by cxf
apache cxf
then we have Apache Tommy Plus which is
basically the rest of the stuff that's
useful that's in the full profile but
not in the web profile so it contains
jax-ws connector and JMS we haven't seen
anybody ask for a single technology
outside this specific outside this group
we've never seen anybody ask for cmp
we've never seen anybody ask for CORBA
certainly no one's ever asked for Jack's
RPC and we find this meets a lot of
requirements the really interesting
thing is that in Java EE 7 as much as
Java EE 6 was about shrinking Java EE to
make the web profile Java EE 7 is about
a lot of it is about shrinking the full
profile in some regards so a lot of the
things that I mentioned that are in the
full profile that are quote unquote
non-used legacy technologies those are
now cut in Java EE 7 so CMP is no longer
required part of Java EE 7 full profile
and neither is Jax RPC and CORBA so we
might actually see a version of Tommy
that's full profile certified but yet
still small ok let me give a quick demo
here so with this demo I want to show
Tommy running in Eclipse using the
Tomcat web adapter oh what's that
did the distribution yeah Apache the
software foundation yeah yes so Apache
has received a license for the Java EE
tck in 2004 when Geronimo was created
and so Geronimo certified with that TCK
for several years and then we used it as
well when certifying Tommy
so patchy actually has two certified
Java EE implementations so yeah it's
donated to Apache by Oracle and so yeah
we're one of the four or five
you know vendors with the yeah right
exactly so a quick question who uses
eclipses okay most the room and I'm
guessing you all use the Tomcat adapter
with Eclipse yep of course all right so
so as I mentioned that Tommy is Tomcat
with stuff added to it
and the advantage of that is that all
the Tomcat tools work with Tommy you
don't have to learn a new server and so
this demo I want to show you from
scratch setting up eclipse with Tommy so
I'm just going to extract eclipse right
off the disk right off the zip file or
the tar and then we'll open that up
other logistics distract Tommy also
and this is the plus version of Tommy
this is the largest version of Tommy so
I'm showing you the heaviest thing we
have to offer not the lightest I think
that's only fair you know you can assume
that the heavy that everything else is a
little bit faster and a little bit
lighter from this one and I guess before
we boot up eclipse here I want to show
you just Tommy itself and how you boot
it so probably can't see that there you
go
is this readable by everyone okay great
so first of all you start up Tommy like
you start up Tomcat we haven't changed
anything significant about Tom yet we
haven't removed anything so you boot it
up just like you normally would
well there we go and there's a tomcat
splash page so just the same as usual we
have a little GUI here in the bottom
that's currently protected there's not
much there in the moment but it's one of
the things that we're developing kind of
a console type of tech thing for for
Tommy and then I'll shut this down and
you shut down via the same shutdown
script okay now we'll boot up eclipse
here
and of course it always takes a little
bit of time to start
okay we'll create a temporary workspace
so that way I don't you can see that I
haven't created a workspace in advance
and taking all the fun out of the out of
the demo alright so the first thing
we'll do is we'll say new dynamic web
project you do not select enterprise
project the reason being is in Java EE 6
we changed some things about Java EE
that have been big big problems for a
number of years
you don't need ear files anymore in Java
EE 6 those are pretty much legacy in
Java EE 6 we made it so you can put
everything in the war file you can put
your EJ B's in the war file you can put
your persistence units in the world file
and they all share the same class loader
it's all very simple and you don't have
to create all these little modules and
bind them all together in an ear file
and create yourself an application XML
file it's pointless and then then they
have different class loaders so if you
have a class it need to be shared by an
EJB and a servlet then you need to put
that class in a separate jar and move
that into the ear file Lib directory and
there this point everyone wants to pull
their hair out and kick their computer
and walk out of the door screaming so no
more of that everything's in the war
file everybody knows how to build a war
file done end of story
so we're gonna select dynamic web
project and we'll call it Jack's Kampf
and then here we go setting up Tommy you
say new runtime at-at Apache Tomcat 7
and we'll put a little tag on here
called Tommy not necessary but you know
just nice to see if you have a few
different versions of things in there we
navigate to where we unzipped Tommy and
then we simply say open I know we say
finish
we'll leave all the defaults servlet 3.0
and we say finish okay and then we close
this all right so now we'll go ahead and
create some code here and we'll
right-click on and we'll say new servlet
we'll call it hello servlet that's the
Java package I always do that okay and
then we'll say finish
now of course Eclipse likes to generate
all the boilerplate code which is
complete nonsense although if you get
paid by the line of code is a really
really good bargain
I forgot how to maximize this there we
go
okay so we're just gonna delete all this
stuff
all right and then we'll just have it
return some
set content-type text/html
hello servlet
okay and then to run this we go back to
this window here and we right click on
our servlet we say run as run on server
now we'll pop open this dialog box let's
just click always use the server so we
don't go see this dialog box again and
then we say finish and now it will boot
up Tommy deploy the application and pop
open our web page there it was fairly
quick too
basically this is Tomcat speeds with all
the additional stuff in it so that's
basically using Tommy that's using
Tomcat but we haven't seen anything that
tom can't can't normally do so let's go
off and try something that isn't
normally possible Tomcat so we're gonna
add an EJB so here we'll say new class
and we'll call it hello bean say finish
now I'll annotate it Java x EK b
singleton then we'll make a method here
and have it returned string hello egb
okay now to get a reference to our EJB
into our servlet we simply make a
private field of type hello bean then we
annotate it with Java x ej b and if i
could type today that'd be wonderful EJB
okay
and we'll go ahead and update our output
here just making a local variable I like
hot keys writer append
and we'll have a return
okay now when we save this a clip should
notice that the servlets changed and go
ahead and redeploy the application for
us
there it goes that noticed and it
redeployed and now we can go back to our
webpage which is over here and refresh
there we go
how else are blit hello EJB we haven't
had to chase down any libraries we
haven't had to read any blog posts and
how to integrate this stuff we haven't
had to do all the normal things that we
normally have to do when we're working
with table guy because it's basically
bare-bones so there's a lot more in the
box this is the full pro this is the
basically the Tommy Plus version which
is very close to full profile so let's
do some web services
okay so I annotate my EJB with Java xjd
Vegas web service and now it's both a
local EJB and the remote web service so
I'll go ahead and ping my servlet here
and so that will cause Eclipse to notice
the files changed and reload
and you second now there it goes and it
reloaded okay so first thing to notice
and this may be difficult to see for the
people in the back I'll try and is at
the bottom there is the web service
address we logged that for every web
service so that you don't have to guess
it or go you know searching around
Google for documentation and guessing it
and typing it in and getting it wrong so
we're just gonna copy this go to our web
browser and there we go we have full
wisdom for our now completely new web
service and we haven't had to generate
anything we haven't had to go build
anything we just simply annotate that
component with at web service and now we
have jax-ws web services completely we
can invoke this bean now remotely over
HTTP or locally in the server via just a
reference and we can do transactions and
security and in fact an interesting
aspect of Tommy is how fully integrated
everything is so not only did you not
have to go read the cxf blog post on how
to set C except up into Tomcat and so on
and so forth we've gone to the
additional lengths of making sure that
even things like web service security
works on top of Tomcat realms so if you
have supplied your own Tomcat realm to
persist users to your own database for
example you can use web services
security and those users to log in via
web service and authenticate so you
actually have full control over the
security via the web services fuzz
because of the way we've done the
integration this is normally not even
possible
when you take for example spring in cxf
authority Tomcat it doesn't use the
Tomcat security uses all the spring six
security doesn't doesn't have that
integration that's part of our focus to
keep Tomcat as you know top dog as king
of the hill everything that you do at
Anka you should still able to do and
more okay
so that's EJB jax-ws let's add some
restful stuff
so we annotate it with the path
component which is the sort of now this
makes it a restful service we'll give it
a path of rest and now we have to
annotate this method here to let us know
that we can use a get request to access
this method we just say get and now
we're done we'll go ahead our servlet
again and then of course it should
notice and reload and yes it's done and
just like the web service all the
restful service URLs are of course also
logged so here it is rest service and
that's the URL so we'll grab that we'll
paste that into our browser and now we
get hello EJB the default tech the
default producer type for rest is text
but of course with some additional
annotations you can easily have this
return JSON and XML whatever you want
all of the above there's a you can
really add an unlimited number of return
types on the same method with jax-rs
which is one of the most amazing things
about jax-rs is the amount of time it
can save you so to Java classes in our
project and we have servlets EJB jax-ws
jax-rs
all fully integrated we haven't had to
go thanks we haven't had to go anybody
to water we haven't had to go search
around blog posts we haven't had to hunt
down any libraries we haven't had to go
oh this blog post is incomplete did you
ever try doing this no I didn't need
that so I only went this far well I need
to go this far and now you're at square
one again you know this is this is the
problem with with doing things like this
building your own app server as I call
it the difficult thing becomes when
you've put all the time to building it
so you don't really want to back away
from it but then a new technology comes
out and now you don't know anything
about that technology but you know you
want to try it out you know you want to
use it but now you have to learn it and
figure out how to integrate into Tomcat
all at the same time and this becomes a
really really really hard thing to do
your job is never done as technology is
going to keep moving forward you're
always going to be building that app
server and a good example that is CDI it
came out in Java EE 6 lots of people are
interested a lot of people want to check
it out but simply it's not in the server
that they use because maybe they're
using Tomcat or jetty who's heard of CDI
one hand
okay so CDI is basically a new
technology in Java EE 6 CDI is to spring
and juice
what JPA is to hibernate CDI is the
standard version of a lot of dependency
injection ideas that were added and
created in projects like juice and
spring those were fixed up standardized
and then added to Java EE as a core
technology and in fact a lot of the
platform itself is moving onto CDI the
interesting thing about CGI is not
necessarily the dependency injection I
think that's sort of an old concept and
it's really cool and important but one
thing if it's right I don't have time to
show it to you but write it down for
research later the CDI event model is
the best I've ever seen
it will change the way you want to write
code once you learn it you'll instantly
think of a bunch of places that you can
use it and you'll want to rewrite all
your applications in a really good way
it's a listening concept it's been
around for decades and a half right but
the interesting thing about it is that
you do not need to create or register
these listener managers and then go
register this object with this listener
manager you simply create a method that
says at observes and say type foo then
somebody else can grab the CDI being
manager and say fire this event and pass
in a new food well and a story your
component will get invoked when that
happens
but you haven't had to create a little
registry to register all these listeners
and you haven't had to then go and every
new component you add that wants to
listen for foo has to be registered and
it's actually even inheritance aware so
if you want to say observe object you
will see all events in the whole system
it will make you want to rewrite all of
your code if you're doing anything
loosely coupled it's a perfect
application for it okay so I'm going to
go ahead and add some CDI functionality
to our web app so you can see how that's
done so the first thing you need to do
is you need to add a new file called the
beans XML file you don't need to have
anything in it but its presence turns
CDI on and it has to be in the web-inf
directory of your wor file and now we
can go and create another Java object
we'll call it hello POJO
okay and then we're going to do a
similar thing we're going to make a
public method here hello it's gonna
return
okay now we're not going to annotate
this as anything this is a plain old
Java object go back to our servlet and
in a similar fashion the dependency
injection works private hello
pojo and then we annotate it with Java X
inject inject and when we do this it
will cause Tommy to see that grab the
pojo inject it into our servlet and then
we can go ahead and use it and we'll
update our output to do a similar thing
now we save that and it should cause
Eclipse to notice and we've redeploy
which it did they'll go back to our web
page which is up here somewhere there we
go hello Joe
so now we have plain old dependency
injection spring-like but we haven't had
to add any libraries there's no
complexity we have to have we didn't
need to define the bean in XML and we
didn't need to do anything if you notice
we haven't really written any XML but we
still have a full XML web services will
still have jax-rs we have full EJB
functionality with transaction support
security support we have full dependency
injection we haven't added any unique
libraries and we haven't had to set up
into configuration files and we haven't
added even a web.xml file nothing all
set up for you right off of that very
fast with the normal way of weeks of
time that you would spend working on the
stuff getting it to go like this it's
it's in my mind a game-changer you know
it's it's what we've been trying to do
for the last ten years I mean everybody
and their brothers been been adding more
to Tomcat there is nobody I mean let me
ask the question who is this time
can doesn't add any third part of the
libraries to their what their
applications right of course I mean I
would be absurd it's you know we haven't
added any third-party libraries to our
application so far that's the advantage
of using a circle with more in it you
can have a lighter web applications but
you know it's it's it's it's it's pretty
significant and how it changes the way
you would normally approach things and
the great thing about it is that this
this application that we've written it
just just three Java classes it's
portable to JBoss it's portable to
GlassFish it's portable to WebSphere if
you decide you don't like Tommy you can
pork these things away and on the
reverse if you have had to use these
servers alongside Tomcat now you can
finally move them all onto Tomcat and
have everything on one server so some
interesting kind of fun things about
where Tommy came from so we announced it
in 2011 at JavaOne that was a very first
certified server that we had that was
when we very that was a first release
and the first time he passed the job
that you TCK we announced at a job one
and we got a really big really big
response from that in april we did our
1.0 final release we did a lot of
performance tuning between the beta and
the one point over the first iteration
was focused on feature complete and then
we called that beta we went too fast and
performance that was 1.0 then between
that and the neck following of six
months we completely focused on you know
filling gaps because people try to port
applications from other places to Tommy
and then we need we discover we need a
bunch of features that are not part of
the standard so we did a lot of gap
filling and we bumped the version up
significantly taking a page from tomcat
you know five zero and five five type of
numbering system and then just this last
April we did another our most latest dot
release is probably the most stable
mature by far we serve lots of lots of
feedback so basically every six months
we're focusing
on something very very significant to
move it forward it's taken I guess you
know year and a half or so but we have
something that's you know very very
stable and very mature you can kind of
see the what our life has been like
since we announced that little bump in
the middle is our Java one announcement
and we've just sort of been going crazy
since then that's our website traffic
that's our userlist traffic so we get
slammed on a regular basis and then we
just got Tommy into jelastic here this
last March and our first month in
jelastic we got 7% of their market share
which is really crazy we didn't expect
that nobody did jelastic didn't expect
it we didn't expect it that was the
first month that we're in jelastic the
second month we got 13% of the market
share tying with GlassFish passing up
jetty I was very astonished and as all
of these look like numbers I think
that's easy to look at technology as
numbers I just wanted to show my
personal significant milestone of the
project this was 2011 this was after we
presented Tommy for the very first time
at Jack's in London and the week after
that conference we all got together in
twos France and hacked on Tommy for a
week and we all took vacation to do this
and we all just wanted to do it and we
started out the week at 40% TCK
compliant and we ended the week at 80%
TCT compliant never happens like that
I've worked on Geronimo
for version one two and three major
certifications it takes us months to
make that kind of jump but it's just
what happens when you get the right
people and the right energy and the
right focus we have a significant
advantage in terms of how we run the TCK
we run it in Amazon ec2 so we took a
very modern approach to tack
this problem the teacher Kade running
tens of thousands of tests takes a long
time so what we did was we took and
split them all up on into hundreds of
chunks of tests we throw those units of
work onto an JMS queue we fire up a
hundred spot instances on Amazon ec2 and
they all pull down the work and churn it
away and put it all back to us so
basically we can get results in an hour
so during that week we were able to do
eight complete runs of the TCK one in
lunch time when after we'd hacked for
all morning then as we hack all
afternoon we run it again before we go
and we're sitting there having beers
watching the tcga results rolling it's
come test suite it's a compatibility
test suite it's basically the the what
you get as a licensee for Java is you
get this test suite and you're required
to pass it before you can say that
you're certified and you have to present
that information to Oracle of course and
then they add you to their website as
certified implementation and then you
get to refer to yourself as certified if
you don't then they get really mad and
the lawyers coming at you excuse me are
their performance requirements for
passing the TCK No and the first
requirement first question you asked I
said forget I'm being recorded is what
is the TCK and that that's a test suite
that you must pass to be a licensed
implementation of Java
there are thread security requirements
certainly multi-threaded requirements
and stuff like that but you're allowed
to be as slow as you want to be we're
actually quite light so when we passed
the job at attck we pass it with the
default 64 megabytes of heap space we
don't increase the memory space at all
we're so far i've been saying this for
almost two years were the only one who's
done it to my knowledge no one's
bothered to challenges on it so I'm
gonna assume that that's the case I know
in the case of Geronimo we take a gig of
memory to pack the TCK that's a
significant difference
yeah so and actually I've been doing
work week trying to run with running the
TCK on a Raspberry Pi just for fun Tommy
actually does run pretty well on a
Raspberry Pi and especially the next to
release one six
we've done some specific performance
tuning for a Raspberry Pi so you're some
of the feedback yeah go ahead
well you know the the no we didn't have
problems with circular dependencies
between packages because the things that
we're integrating are distinct projects
like open web beans opening jb the
transaction manager and they're all very
independent so we actually have the
inverse problem integrating them
together not that they're too integrated
so the whole week there is basically
tying knots together making connections
and that gets you big jumps quick now
when i say 40 to 80 here's what it's
like to live in the shoes of someone who
writes an app server when you get this
huge test suite it takes you a couple
months to just to get it to running then
it takes you that gets you up fast and
you're making big gains and then that
forty to eighty usually takes a couple
months not a week or so as you get
closer to a hundred percent it gets
incremented longer to finish that work
and so for us to go from eighty to a
hundred you know that took another six
months
so yeah it's you know it's it's but
still that our whole certification cycle
was about ten months long so that's
really impressive and for drama it's
normally taking this at least a year and
a half often longer so some feedback
we've gotten from people since we
launched this is sort of early feedback
from our 1.0 you know tommy is insanely
fast i've from an architect's which from
XXX - tommy I can tell you Tommy cakes
exercises but in every way memory speed
yeah reliability validation I remove the
server names because I think it's crass
to trash other servers we're not about
that people want to trash other servers
that's their business but we're not
going to do that and then if you're
concerned about performance footprint
but it can accept that you'll support
yourself a little bit you know Tommy's
great actually we're in the process of
fixing that I'm launching off
support company around Tommy to offer a
greater level support that you can
normally get from open source mailing
lists since our point 1.5 release where
we've regained a lot more maturity
obviously we're seeing some very
different names an ideal fit for a
private cloud American Express we have
completely replaced xxs with Tommy at my
department have no regrets conde nast an
amazingly pure stable and simple to
manage Java EE web profile container
Starbucks so it's we compete with JBoss
HTTP speed about even because both use
Tomcat EJB speed is double to double and
a half Tommy's faster than then JBoss
JBoss just uses our mi for the remote
ejv calls
whereas we use our own sort of socket
implementation significantly faster
because we've written and tuned it
the secret of performance is if you can
control the client the server you can
set the buffer size it to be exactly the
same on both sides and then you get a
much better throughput it's actually
quite simple but they don't write their
own protocols so we're definitely a lot
lighter in terms of memory where we take
about a third to a half of what you
would find in a JBoss install in terms
of footprint on disk tommy is 27
megabytes and download size JBoss is 127
megabytes so it's basically smaller and
at about every possible way and speed
wise it's either equivalent or faster
and so it's it's it's pretty it's pretty
great so as what I showed can look like
a lot of magic here are the steps that
we've taken to add these things to
Tomcat we add to configuration files
into the contractor e1 is simply
therefore as a convenience you can add
system properties to it and you don't
have to put them as - D flex simple the
other one is a Tommy XML configuration
file and that's there
because a lot of things that you can do
in a full profile or web profile Java EE
server that you can't configure with via
the Tomcat server XML such as JMS topics
and queues your broker various
persistence things CMP or MTB containers
Jayma you know web service transaction
manager trends there's no transaction
manager in Tomcat by default but there
isn't Tommy of course and so we have
this additional configuration file and
then of course here are the projects
that I mentioned in the Lib directory of
the server so we do that we add this
listener to the server.xml file and then
we basically start when Tomcat starts we
participate in the full lifecycle of
Tomcat and that's how we do integration
Tom connection is a pretty good event
model internally so when it starts it
says I'm starting when it stops it says
I'm starting I'm stopping when it
deploys an application it really gets
for both I'm going to deploy an
application I'm deploying an application
I have just stopped deploying an
application and of course the opposite
and undone deploy so that's enough for
us to hook in fully and when Tomcat is
scanning for servlets we scan for you
jayvees we scan for jax-ws components
testing so as I mentioned we run the
stuff into Amazon ec2 we run it on very
small machines so the t1 micro instance
that we run on is you know it's got 613
megabytes of memory it's quite small we
don't increase the Java memory so we're
taking the the minimum that a Java
process can take on that machine leaving
you with a couple hundred megabytes of
additional space for your application
which is the way it should be that means
you can run Tommy on a t1 micro instance
in Y Amazon ec2 and basically use the
majority of the memory for your
application and not have it hog by the
app server the interesting thing about
that is if you can't do that because
your app server is too big you got to go
to the next level up which is the mo
and that's four times the price and of
course we certify all up to c1 and yeah
it's it's it's pretty great we also have
a ton of our own tests and it's it's
it's pretty it's pretty significant the
amount of testing that we do so the
results are that those what profile is
27 megabytes so Tommy plus version is 47
megabytes so it's another 20 megabytes
to get activemq in there to get cxf in
there and to get connector architecture
and the additional things so you
basically have your choice between 27
megabytes and 47 megabytes of zip size
it runs with the default memory settings
you don't need to bump up the memory
just to start the server or deploy with
basic applications and it's tightly
integrated you know so it's it's very
small it's very small you know it
represents each zip file that you get
represents hundreds of hours of testing
I think it's a significant thing to to
think about it's easy to focus just on
the time saved in terms of integration
which is obviously significant but each
zip file against hundreds of hours of
testing we run the TCK every single day
on Tommy
and so our even trunk is on average 95
200 percent passing what's really stable
and it's certified there's a port of
building there so unlike when you cobble
things together yourself on Tomcat you
can't move that to WebSphere or anything
else like that JBoss you know you have
to rewrite those applications or
significantly modify them and then you
have if you've done integration yourself
you've often find that your
interpretation of the specification was
perhaps different than somebody else's
interpretation of the specification and
you integrated things differently and so
now you maybe have a significant issue
that prevents your application from
moving anywhere at all so some perils of
doing it yourself and I sort of kind of
went into there already there's a
performance penalty that people don't
really realize
people would you would normally think
seeing all these things added the Tomcat
would result in a slower application but
that is only true unless you have not
added things to Tomcat yourself so if
we're both adding things to Tomcat well
then they have effectively similar sized
libraries but there's a big difference
that these days all these libraries were
adding are scanning our web app that's
the way new API is worked in Java EE so
when you say at path on a jax-rs
component and that gets discovered and
deployed what that means is that cxf or
Jersey has read every single class file
in your world looked it we parsed it
with like ASM look to see if it had at
path on and then it sets it aside and
deploys dead so when you add say Jersey
to a simple web app Tomcat will read
every single class file and every single
jar looking for a servlet at web service
then it's done and then Jersey gets its
turn okay now I'm going to take my shot
at really scanning every single class
file in this war and it does the same
thing so if you got a embedded database
in there are they and that gets scanned
everything gets scanned there's no it's
it's very very blind and how it how it
does it
and then you add JPA in there and now
all these entity components now open JP
or hibernate or eclipse link they're
gonna scan every single class file you
see where I'm going with this the same
is true if you had JSF there's at
managed bean and then if you had EJB
there's at singleton if you add jax-ws
now you have at web service all of these
things now get scanned multiple times so
the more things you're cramming onto
Tomcat the more inefficient your startup
gets and so this is one of the things
that we do differently in our
integration because we have the
everything you know integrated very well
and and one of the big things that we
did between the beta and the 1.0 was we
eliminated all this double scanning and
scanning in quadruple scanning so not
only are you not scanning it's a six
times your web application because it
doesn't have all those libraries in the
web application is six times as small so
that one scan is many times faster than
what you would normally get so that's
one significant thing to be to be aware
of another thing is that there's a
there's a fallacy that if you drop open
JPA for example into Tomcat that you're
getting 100% of JPM functionality you're
not you cannot use at persistence
context in a tomcat web publication that
has open jpoa in it it's impossible
because that requires a transaction
manager which requires logic to register
the entity manager with the transaction
manager and then everybody who uses at
persistence context should get the same
entity manager injected into them so if
they're all the same transaction they're
all using the same manager manager using
the same database connection to the same
database that's a lot of integration you
just do not get by throwing open JPA or
hi mating the Tomcat which is why
everybody will use this plain Tomcat
with a JP provider it uses the energy
manager factory directly to compensate
their any managers and then you have to
track them and then you have to use the
the JTA entity transaction and if you
have to and any managers that you want
to coordinate together guess what you
can't they're separate they don't
participate in the same transaction so
you couldn't move data from one database
to another database using this because
they do not share a transaction very
significant and what open web beans for
example only runs 60% of the CDI TCK on
its standalone implementation of CDI
because the other 40% is all integration
and they're not going to write
integration with EJB and jax-rs and
jax-ws and all that stuff so these are
things that we had to do in Tommy to
make it so it's a fallacy to think that
I have open JPA I have my faces and I
have you know open web beans in my
Tomcat application so therefore it's the
same as Tommy it's
not it's about it's about half to 60%
you know when we added all the stuff
into Tomcat you know before we did any
really serious integration work we were
only about forty percent compliant as I
mentioned and you know it's a lot of
work to get from 40 to a hundred percent
and it's a lot more work to get it fast
and it's a lot more work to get it
stable and to keep it tested in a
well-oiled all the time is a very big
network so I've gone by with it with the
portability stuff we have just five
minutes but I want to show you one real
quick thing here there's a significant
testing advantage with Java EE these
days that you may not have been aware of
normally Java gets a hit on a chin for
being untestable there's a new testing
framework called or Kilian which is
supported by all the Java EE app servers
in jboss GlassFish WebSphere WebLogic so
write down our killian and research this
afterwards I'll show it to you briefly
so here it is at a ten thousand foot the
goal of our Kilian is to allow you to
write a test run it on any server this
has been tried before with projects like
cargo and things like that but the
significant thing that's different about
our Killian is that it has adapters for
every single server and getting us used
and now in Java EE 7 the CDI TCK is
using our achillion as its testing
vehicle so all the app servers from now
forever will have to support our Killian
so it's safe to invest in it and have it
stay there so what you do is you can use
plain old J unit tests you say at runs
with our Killian you make plain old at
test annotated test methods and the new
twist here is that you build up your
application in code and return it to
testing framework the testing framework
will create a war file from that and
deploy that into the server for you and
then even as a little perk you don't
have to guess the URL that the server is
running on so you don't have to know the
ports and you don't have to work out
that kind of mechanics that you normally
have to deal with you simply say are
killing a resource URL and that will be
the URL of the web app itself all the
way right up to the to the first flash
of the web app including the port
including HTTP HTTPS or whatever so here
we've just got a war file with three
simple classes in it and the great thing
about that is that now if I want to swap
out say one implementation of something
for a mocked version I just specified
the mock version all right
so I'm gonna just go ahead and run these
little CDI tests and you can kind of see
the speeds that you're that you're
looking at so we have an arquillian
adapter for embedded version of tommy
and there we go so that ran six seconds
all those tests this uses the embedded
version of Tommy
we have an hour Killian dapper for a
separate process running Tommy a
standard booted up server so you can
take that one test that we've written
here and you can run it on your local
machine on an embedded database on
embedded server while you're developing
and then you can take that same test and
then run it on like a QA server that's
running in a completely different
section in the network you don't have to
edit the test because as I said all the
location information is extracted
abstracted from the test and the says
simply builds up a war file and then as
you move that to say some sort of
staging you can run those tests again so
your tests become a significant asset
and resource for you personally and
they're not even Tommy specific if you
decide to go to another server or you're
in a position that you have to support
multiple servers because you have some
sort of product that you sell that needs
to run on many implementations then our
killing is the you know godsend it's
it's a huge game-changer there are some
really great perks about this about
using an embedded server which Tommy has
a wonderful embedded server it's very
much a
focus of the project embedded
technologies I think are the future
running a server as a standalone process
where you then boot the server and then
deploy an application that fits for some
things but if you just have one
application take the server KVI
application bundle them together and
just started as one process like you
would use an embedded database why not
it could it can provide you with some
options that you normally would not get
a great perk of that is it runs as a
plain Java SE application so it's no
what I want to do so we're going to take
and put a breakpoint in this servlet
here we have a servlet with the
constructor simple servlet extends HTTP
servlet and it's got a constructor
normally you don't get constructors and
injection and servlets but this is a new
feature in Java EE 7 which is supported
in in Tommy for about two years now
actually it I was the one who added it
to the specs so we're gonna add a
breakpoint there and then we're gonna go
to our servlet or our test case and
we're gonna run it in debug mode so we
go to run this app and then our code
window is very shrunk there we are we've
stopped at our breakpoint we haven't had
to setup any remote debugging any
booting things on separate ports as a
separate command and coming back to the
IDE nothing weird we're able to debug
this here's our car object that's
injected it's a Lexus is350 it's you
know we can see into our application
completely and we haven't had to set up
anything different and it runs just as
fast as a standard Java SE application
there is really no reason to avoid heavy
technology anymore that is really of the
past that's no longer the reality
so to invest a considerable amount of
time to do it all yourself to avoid all
this heaviness means now you have to
write your own testing framework you've
got to do all the all the integration
testing that's there and if you upgrade
a component and it breaks something and
then you've got to fix that so I
normally ask this and I didn't but for
all the people who have added things to
Tomcat how many of you have written
tests for your integration of those
technologies one hand that's typically
the way it goes so it's not tens of
thousands of tests and it's not all the
additional tests that we have written
which we've discovered weren't covered
by those tens of thousands tests zero
tests so every time something breaks
basically you hope it works and a lot of
times you don't know tell production
it's how many of you have written test
for your applications at all for your
job view applications at all five hands
yeah much less much much less than it
should be should be all the hands this
is not just a good way to test your
application it's a good way to develop I
mean you can write code and just see
what it does as you're working and you
don't have to sit and live for those
continuous deploy build deploy cycles
you can write it as a plain Java as the
application as fast as you would a Java
SE application and run it as fast as you
would a job yes the application complete
GameChanger I mean there's some really
great tools like zero turnaround which
make a little hold job as you know to to
make deploys faster well the server
doesn't mean that the server is running
so fast that it's Java SE speed you
don't really need that and if your test
cases are able to control the exact size
of your file then you don't need you
should keep them small so they can be
closer to unit tests you don't want to
deploy this whole big war file that has
all of these different functionalities
every time for one little test you want
to isolate as much as possible that's a
tenant of good tenant of unit testing
this is a III believe
a turning point for Java you not Tommy
specifically but just the whole movement
I mean Tommy is a part of it but but
what Java is done with itself in the
last just two years huge if this is not
the same thing that we had from 2000 to
2010 this is a completely different
thing the only thing that remains the
same is the name and actually that was
changed some time ago from j2ee to Java
EE so you know I encourage everyone to
look at Java EE differently look at what
you can do on Tomcat differently look at
the motivation if I'm doing the same
thing on Tomcat that Tommy is doing
what's the advantage of me doing it
myself you know it's it's you know if
you do find an advantage of doing
yourself of course let us know and we
all will add that to the project as a
part of what we do we do get that
feedback often actually anyway it's it's
it's a significant it's a significant
change to the way we normally think of
doing work and the way we do work I
really encourage people to to try out
Tommy and you know give it a shot just a
quick thing before I go here's some of
the vendors who have added support for
Tommy in their products in the last year
so we have a Tommy adapter in July in
IntelliJ J rebel has added support for
Tommy in there zero turnaround and you
know in their hot deploy type of
functionality New Relic has support from
monitoring applications in Tommy
staccato has Tommy in their private pass
of course I mentioned jelastic who has
it in their public pass Mehta Works is
sort of a host Tomcat hosting company
they've got Tommy in there and more is
added all the time the secret sauce is
that I go up to them and I say do you
support Tomcat of course they say yes
and I say well then you should add Tommy
support well we don't have the resources
they didn't whether integration well if
you tried it no it's probably gonna work
because it's Tomcat and the same thing
is true for your environments
if you were running Tomcat to get Tommy
in is easy you're already set up for it
you don't have to write new tools you
don't have to write new anything it's
good to go thank you very much I hope
you enjoyed the presentation and I hope
you enjoy trying out Tommy and I look
forward to your your feedback thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>