<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Intro to Android NDK - 07 - The Client | Coder Coacher - Coaching Coders</title><meta content="Intro to Android NDK - 07 - The Client - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Intro to Android NDK - 07 - The Client</b></h2><h5 class="post__date">2012-04-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/9LetlRFsdpI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so let's go and do this the first
step is for us to connect to our UI
right so we're gonna go and define a
some sort of maybe an input of private
edit text input that's we're gonna get
our and from private radio radio group
that's gonna be our type and private
text view this is going to be our output
so those are those are the UI elements
that we're going to be interested in
over here so now that we've here
initialize the UI we can say okay this
dot input is going to essentially come
from we need to go ahead cast this it'll
come from whoops
on some reason we add at the end what
doesn't work is expected a super dot
find view by ID and so ID is gonna be
our dot ID dot input so we've got that
we can do the same thing for the output
so more or less the same thing this is
gonna be a output this is of course we
have to cast it into the the textview
and in between we'll have this dot type
equals radio group super super dot find
you by the order ID doe type and I now
think we have the three that we care but
and of course the last one is the button
we want to know when the button is
actually clicked so we can say button
button equals you know button super dot
find UID there's other ways of doing
this of course but this is just simple
enough to hopefully make sense the real
objective here is not the focus in the
UI but really on the ji part so now that
we have the button we can go and say
button that's going import is command
does the import or if you're the Windows
or Linux machine it'll be a control
shift Oh organized imports and so now
button dot set onclicklistener this we
can make ourselves video and click
listener of course because we are not
yet an onclicklistener this is red so we
can then have Eclipse help us by
allowing us to be an onclicklistener
so I got here I click on the right
button or and now I can select this
double clicking on it adds the onclick
listener as well as the appropriate
import statement here and now this
complains because we're not really still
it on click listener so we click on this
and say add the unimplemented methods
there's only one method which is
essentially you don't click here's the
view that was clicked on now what we do
in the view is we actually now me to you
know do what the user asked us to do
which is to find the end we then need to
go and parse the string into real n and
then go and you know do the calculation
so how do we do this first of all I'm
gonna say string s equals this dot input
dot get text dot to string ok so we now
have something that's supposed to be an
end and we can go and parse it or we can
actually test for well if s is empty and
actually Andrey already has something
called text utils she do control space
it'll do an automatic import is empty s
so if this is already empty which also
includes null then we can just go and
say return there's nothing for us to do
ok otherwise we can go and parse and so
we can go and actually assume I mean we
could we should be chickening errors but
let's keep it simple so I'm gonna say
long N equals long dot parse long of s
and so we now essentially have the end
now that we have the end what we want to
do is start a calculation now let's do
this
simple way which is essentially we're
gonna go and check for what is the type
and then
we're gonna based on the type call the
appropriate algorithm and then update
our UI so let's see I'm gonna go and say
switch this dot type dot get checked
radio button ID I'm interested in which
the radio button was actually checked
now I want to go and say well case r dot
ID dot you know for example jr. so I
know that's what the user clicked on I'm
gonna you know figure out what basically
what I should do so presumably this is
where actually invoke the appropriate
algorithm so how do I do this well
here's what I'll do I'll initialize the
results so long result equals to I don't
know nothing zero and then I'm gonna say
result so the result equals babe lib dot
J R of n that's the easy one that's
actually not in any way shape or form
and the K specific because this is all
pure Java and I'm gonna just duplicate
this case four times so this is gonna be
a ji for example whoops J hi this could
be a ji this or here could be an N R and
this is gonna be an N R and then finally
this one is gonna be an I and this is so
we now have a way of initializing the
result based on what selection the user
typed in and so now that we're done with
this
I guess one more thing I'll do just for
fun is I'll also measure the time it
takes to do this so I can say for
example long T equal system dot current
time Uli's or you can actually go and
use that time this is using the wall
time there's also you know getting time
for the you know from the initial boot
up of the system which
we slightly better but this is what most
draw developers doing anyways t
ecosystem that current time is minus T
and so now we know how long the
separation took and so now what we can
do is we can actually go and create a
string for example something that will
update the UI so we can say you know
this dot outputs dot set text and now
the text could be some sort of a string
for example fib let's actually formatted
string dot format
fib of some sort of percent D which is
going to be the N equals percent D the
result in percent D milliseconds so
we're gonna just need to fill in the
percent es so the end result time and we
now are pretty much done now let's go
and check this out save this the next
step is to try to run this that said
before actually going executors some of
you may be thinking well hey recursive
you know if you were not cheese is not
that fast in fact you know if n was
something like you know twenty thirty
this can easily cause an A&amp;amp;R whether
here or here in R stands for application
unresponsive and is a result of
essentially us locking up the UI thread
don't forget all of this happens on the
UI thread because this is all firing
from the on click event handler so
instead of doing it this way which will
work but it's not necessarily optimal
it's probably better for us to do this
in some sort of a async task now so what
I'll do is I'll actually you know
refactor this code somewhat should have
done this right right from the get-go
but just to be you know just to make it
kind of nice and easy I'm gonna go and
do it now so here's a couple things I'll
do first of all I'll make the end be
final and you'll see in a moment why
then what I'll do is I'll create a new
async task control space
a sink oops
async task and I'm gonna go and say that
the input to the pacing task is just
void Bruges is gonna pass everything
through this coffee this tag there's no
progress and the result is just gonna be
a string for example so we're creating a
new async task and then in this async
task there's gonna be and we're gonna
finally execute it at the end which is
gonna come in later and in this async
task we're going to have true thing as
the the code the method that executes in
the background which is the one that
takes a long time and the method that
runs in the foreground on the UI thread
handling the final result so the matter
that happens in the background it's
called doing background so we can
actually have Eclipse fill in the blanks
for us so here's that method and then
there's gonna be another method which
I'm gonna go to source override
implement methods which is gonna called
on post execute that will actually fire
when our code in the doing background is
finally done executing and then is able
to transfer this output string into the
input so this executes on the correct
thread so let's go and move some code
around I'm gonna take this this code
which is essentially the longer the code
it takes a long time I'm gonna cut it
and I'm gonna go and move it inside of
this doing background okay it's of
course complaining that you know it's
complaining that I don't have a type so
it doesn't really be aware that I'm
gonna come from just to make it slightly
let's actually make it slightly simpler
I'm just gonna go and change this to say
fibonacci evil Fibonacci activity dot
this dot type of course I have to learn
how to type myself
ivana cheap activity dot this dot type
so that this is the reason why I'm doing
this is so that I can reference to this
type variable that exists over here in
another class I can make this more
optimal by making type not be private
and so on and so on but that's not
really there
tractor here so that's this part but
this method is supposed to return some
sort of a string and yet I'm not
returning anything so what I'll do is
I'll take this string which we would
have normally done or return I'm going
to take that string and go and return it
right here so return this done so now
what I need is to take that string
that's gonna come from here from the
doing background and update auy in the
spin post execute which is running on
the correct thread or will run on the
correct thread which is where it's safe
to the WI so again I no longer I'm gonna
you know I just like like I did here to
reference this type I want to self you
were not activity though this here I'm
gonna say if you were not activity dot
this dot output dot set text and I'm
just gonna say result so now I'm
essentially done the only thing that's
somewhat kind of you know missing is
it'd be nice for me to maybe create some
sort of a dialogue that will tell the
user that hey their calculation is
taking place so how do I do this well
for example I can go right here and say
something like final say progress
dialogue progress dialogue dialogue
equals and then I can actually go and
say progress dialogue dot show context
is this the title is I can just make the
title be nothing and then the messages
maybe I don't know some sort of we have
to figure out some sort of a message and
then I'm gonna say true oops
true and then dot and then close it now
I need to justify this message just in
the interest of time I'm gonna hard code
and say calculating cool a thing like
this why do I have trouble typing like
this
and now that I have this dialogue that
will show up I can go and down below
dismiss this dialogue now that
everything's done dismiss and so now I
have some sort of hopefully nice easy to
work so if I did everything correctly we
should now be able to execute it but
just to show you what the final result
looks like we basically have an activity
that implements your click listener we
have the three well references to three
of our UI elements or views we then
connect to our views we prime the button
to let us know when it gets clicked we
then have an onclick handler which
extracts the N or the input it parses it
into a correct you know hopefully into
it doesn't fail into until long and then
goes over here in the on do in in a in
an async task executes the doing
background which goes and based on the
type that the user selected figures out
essentially which of the Fibonacci
library algorithms to run and then
figures out the time it took to do this
formats everything and goes and sends it
back sends us back the result so that we
can go and update the UI with the result
I agree that this is not the best way to
write async tasks for example you should
not create them as an honorable certain
classes and you should support three
attaching them to the activity in case
for example activity rotates and gets
recreated or device rotates against gets
recreated so and of course this is also
not the most optimal way to create
dialogues we should be using unclear
dialogue dialogue and so on and so on
but this is really just to to kind of
get some sort of a client application
build so we can test our a Fibonacci
j'ni code just to show you what we've
done so far is we basically just built
this part we now I just have to package
it all together and then at runtime
we'll have this and hope everything
we're correct li each should execute
four appropriately let's try this out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>