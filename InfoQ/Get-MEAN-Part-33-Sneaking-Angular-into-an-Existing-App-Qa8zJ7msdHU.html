<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Get MEAN! Part 3/3: Sneaking Angular into an Existing App | Coder Coacher - Coaching Coders</title><meta content="Get MEAN! Part 3/3: Sneaking Angular into an Existing App - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Get MEAN! Part 3/3: Sneaking Angular into an Existing App</b></h2><h5 class="post__date">2014-11-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Qa8zJ7msdHU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">um so my name is Alicia and I'm going to
be putting the a into mean has I'm not
heard of like angular like do I really
have to do this no right okay good i'm a
senior engineer right now at a company
called lift which helps people coach
coaches people to achieving their goals
so whether it's like exercising more
becoming more fit more productive
whatever goal that is we hope people get
there so about a year and a half ago we
were mobile first we only had an iphone
app and we wanted to quickly build out
wed and android so i picked angular to
help me get there so how many of you are
in this situation no one no one is ok
how many people are ready using angular
in your production s ok how many of you
are just kind of playing around with
angular ok oh you're good I have an
audience so um when you already have an
existing app there is a way to just
slowly gradually introduce angular into
it you don't have to just follow the
tutorials you normally see online which
is like BAM here you have an angular SBA
right so I kind of want to talk about
some strategies for gradually
introducing angular to your app and then
we can all prop it so instead of
rewriting like everything all at once
into angular we can start small so
typically you would buy an angular into
your top level element and then angular
what kind of take over everything but
you don't actually have to if you don't
have access maybe you'll want to change
your
higher base layout all at the same time
you can just tell angular to only look
at this little thing on this little page
and you can introduce a lot of quick
interactive features build complex which
you eyes quickly with angular without
really touching the rest of your app
then you can go to your boss or
stakeholder and be like hey look at all
this stuff that we can do quickly maybe
with a whole new stack like I mean and
you can convince them to adopt a new
framework and then go from there so
going back to our integrated example
with the other talks we're going to be
building a question widget so let's
pretend that we have our existing media
websites kind of static not too exciting
but we want to be able to allow people
to ask questions directly on the site
and be able to see those questions so
the HTML for that is really simple we
need just a form and then it's a list so
how do we populate that how do we
angular eyes it we tell angular that we
have a module and we're going to bind it
to just this little part of the page and
we could do everything in one controller
but that's module Iser it a bit and we
have two controllers so one is
responsible for handling the submission
of the questions and then the other one
is responsible for just listing out the
questions so here you can see we use ng
model to bind to a property so we
pretend we have a question and here we
use ng-repeat so we have an array of
questions and then we're just going to
list them out on the page pretty simple
stuff
so because we're building out this
feature on the mean stack let's he'll
look at how we actually interact with
the backend API that we built out in the
last two talks so when we want to do
that we can build out of something
called a question service and we use the
factory method and we call a question
and with angular there is a resource
service built right in so you can use it
to very quickly create a service that
will talk to your standard-issue REST
API so just in a few lines of code we
just tell it the URL and that just this
little part here will give us you know
the saving of a new question index of
getting a list of questions getting a
question by ID deleting a question all
that stuff is handled but of course we
also want to be able to upload on a
question so we can define our own method
will call it boat and we can tell it
what the URL is and what the method to
use is and then we have that available
on our question service as well
so now that we have our question service
done what do our controllers look like
Oh actually I should mention like i'm
using resource here for demo but really
you wouldn't really use resources you
would probably just go directly to the
HTTP service because you'll have like a
lot of complex stuff you want to massage
the data going in and out you want to
store all that logic and essential place
you don't want that logic living in your
controllers so this is just for demo but
it does show that you can get something
up and quickly really fast with just a
couple lines of code so we define our
controllers we have one for the forum
and one for listing the questions and
again very simple we have angular that
takes care of the dependencies and we
just have to pass in question and
angular's dependency injection will just
give us our question service so now that
we have the question service we can have
a method that notice we called on our
inner HTML and we can just call save on
it pass it or new question the one that
had the the text bound to the text field
so when that is updated you'll have the
question and then you can just save it
to the service and then the resource
will actually take over make the post
for us and then tell us when it's
successful so every single resource
method you can pass in a success
callback or an error call back right now
we're doing a demo so we don't really
care about errors but when it's
successful we're just going to reset our
question to be a new object so that you
can submit that form again on our list
function we can call question query and
this is where you would pass in
parameters like sort and limit and all
that stuff that we showed in the
previous talk but here we're just going
to grab the entire list of questions and
we're going to say that
and we define our own voting method so
that's now available on the question
service so we just pass it the question
ID of the question that we want to
upload and again just a few simple lines
of code will wire all that up for us and
allow us to have the basics of this I
mean this has more stuff filled out but
the basics of this whole you I will be
there with just what I showed you so I
mean all of this is like not super
exciting why would you want to use
angular anyway so one of the reasons is
that it has powerful filters and one
example is because we kind of punted on
doing the server side paging and sorting
and so on oh let's see what client-side
sweating looks like so angular comes
with an order by filter and you don't
have to do anything in the controller to
be able to take advantage of really
powerful client-side sorting so you can
pass in a predicate parameter into the
order by filter and you can manipulate
this parameter directly so here I'm
saying I have a button I can click it
and the minus sign just means i want to
sort in descending order and you can
sort on any properties of the JavaScript
objects you have and that's another that
nice thing about angular is that it
doesn't force a particular model on you
you can the model are just regular
JavaScript objects of course you can
build your own but it doesn't force a
paradigm on you
so arguably the most powerful future of
angular our directives they allow you to
create reusable components that look
just like HTML so you can then plug in
your own complex components and use them
in more complex ways and be able to
create complex which you is very quickly
of course you can get really far just by
using angular's built-in directives but
you can really get the full power of
angular by building your own so let's
say that we have this list of questions
and we want to just have that list of
questions up here somewhere else would
it be great if we could just put in a
question list element and then just have
our list of questions up here that would
be pretty cool so let's see how we do
that so here's how you write a basic
directive how many of you do already
write your own directives how many you
are thinking about writing your own
directives okay so so you use the
directive method on your module and you
define a canonical name for it so here
we call a question list here it's
question list camel can see and what you
pass into it i will sorry what you
return is a what's called a directive
definition object and this thing has
like a ton of different properties that
you can define on it and you should
consult a book like maybe the one that
Matt showed about all the different
properties i also have another talk that
goes more to this but the basics of it
is you the very basic of it is you can
just tell it what kind of what kind of
thing it can be whether it's an element
or whether it can be an attribute on an
element so here we say that question
list can be either
we don't care and the other thing you
can do is just pass in a template and
that's enough for angular to build the
most basic of directives which is simple
HTML expansion so it'll look in your
HTML for this particular directors that
you've defined and if it finds it it'll
just add your template inside of that
and that in itself can be useful because
you can dry up some code that way but it
doesn't really do anything so to make it
do something we want to add a controller
and this is the exact same controller
that we had before so all we did was
take the HTML we put into another file
so that we can reference it you can add
HTML directly by using template but if
you have anything substantial it's not
really feasible to add that all that in
HTML writing your JavaScript so you
would save it to a different file and
then reference it here and then here's
something interesting which is scope so
scope is something that's a little
tricky in angular because that's where a
lot of problems come from at least based
on Stack Overflow questions that I see
people are always like oh why are things
not updating angular supposed to have
this magical two-way binding that's just
supposed to make stuff show up but it's
not working in frame so that's because
you're probably working at a different
scope than the one you think your you
have so with directives angular gives
you full power over what kind of scope
your directive is going to have so if
you set the scope to false that means
your directive lives within your parents
cope so everything is shared if you set
something on your parents go your child
will know about it and as great
engineers we know that that's bad
because we have no encapsulation the
other thing you can do if you do need to
just know stuff about the parent as you
can set scope to true but it'll allow
the directive to have its own child
scope and things that are defined within
the child scope are not leaked out into
the parent
but the other way the third way is you
can actually pass in an object into
scope and tell angular exactly which
objects you want the your directive to
know about so here we define an empty
object which means that the directive is
totally isolated there's nothing that
travels back and forth between the child
scope and the parent scope so you're
totally encapsulated but that's just a
basic directive it doesn't give us that
much more than just having the template
and the controller defined separately so
what's what's the big deal well when you
have an existing app you often have a
lot of existing JavaScript components
already built and it doesn't make sense
to just like suddenly try to go we write
it all the angular way so you might have
like very complex jQuery components you
might just have a lot of jQuery lying
around already so how can you take
advantage of that but still build it
into your angular code well you can
write your own directive and wrap that
just plain old JavaScript component or
jQuery component or what else have you
into a directive and be able to use it
in your the angular way meaning like you
can just add the HTML like a component
so what I want to show is this category
selector is just a regular select box
underneath but if you work with like
trying to make pretty you is you know
that you can't really style select boxes
so there's like a ton of different ways
that you can kind of replace the Select
box with your own fancy set of divs that
give you basically the same function but
you can style so I just picked one but
it's just plain JavaScript so how can we
have this thing which you know in
typical like jQuery land what you would
do is you would go find the particular
element you want get the class or data
attribute of it and then bind your
widget or whatever to that element right
that's
kind of the traditional way but in
angular what I want to do is I just want
to be able to add this element called a
category selector passive my question
that I want the category to change on
and that's all I want so how do we make
that happen well we define our directive
called category selector it has been
element and this is a new property
replace it just means that instead of
having our template be a child template
or sorry a child of category selector
we're just going to replace the whole
thing we're going to tell angular to
just replace the whole thing with the
template that we're defining here and we
again use an isolate scope so the only
thing that passes back and forth is the
question object so using the equal sign
and again here angular is kind of weird
with the different ways of defining
things but the equal sign means that
it's going to be a two-way data bind so
it's an object that you're passing in
there's two other ways that you can
define it such as with an ampersand you
can actually use a call back that means
that you can find a function that you
can call back to your regular like
controller from within your directive
and have that be a function as a poster
mob charge so here comes the but of
course this doesn't really do anything
other than replace category selector
with like an empty select but it doesn't
do anything at all and when we saw
before we used a controller to have it
actually do stuff but if we want to
access the Dom we can't do it in the
controller if you want to have any
access to the Dom you have to do it in a
directive well you could do in a
controller about just be bad so don't do
and the normally do it is through a link
function but there's also a compile
which happens at different times so when
angular says okay you have a directive
I'm going to run this code there's a
compile stage and a link stage if you
put something in to compile
it means that angular will run that code
before anything is expanded so it's
actually working with literally the
template HTML that you have so at that
time you don't have access to scope but
maybe there's some stuff you want to do
when you don't have access to scope yet
so with our category selector we want to
populate the list of categories like
Mongo express whatever into that select
box before anything happens that doesn't
depend on the scope or anything that
we're doing later on so here we're just
take the categories and then we just
appended of course you could also do
this in HTML but I just wanted to show
you what compile does and the reason
that it matters is that if your
directive lives inside something like an
ng repeat then the compile will make it
run once because it's run on the
template HTML whereas your link function
will get run for every single item in
your ng-repeat so so if something so if
you want to run something intensive that
doesn't actually rely on the scope then
you can run it in the compile and if you
do use compile then the link function is
actually returned from the compile so we
return the link function here and notice
now we have access to the scope and we
can add things or to the scope so the
particular JavaScript little widget here
i'm using is called select FX so when i
create the directive i have the element
which would be the element the category
selector element and which now is the
select element as we replaced it so
we're going to take that select element
and we're going to pass it into our
select FX and that will kind of do its
thing of creating all the divs and make
it making it look nice it exposes a call
back of unchanged so when someone clicks
something it'll fire on change so we can
pass in our own callback function which
when it
we want to get the thing that has
changed to and then assign it to our
question which we have access to because
we bound it from the parent scope now
the weird thing though is that the kind
of weird thing that you have to watch
out for is that once you bind it to the
scope it does change but if you actually
want it it to change in the UI like if I
had something out here that also showed
the category that you selected it
wouldn't show up right away and that's
because angular doesn't know about it
because right now we're running inside
our directive code we're running outside
of the angular context so if you
actually wanted to show up you'd have to
add a scope apply and if we do this then
when we make this change and we had it
like databound outside with the curly
braces then the category would also
change outside and the other thing to
note when you're working with this is
that you want you want it to be bound
both ways right so if we enter in a
question we select we select the
category and then the question have
reset to be empty we want the category
to clear like it does but that doesn't
happen automatically because again we're
inside a different context than then
outside so even though it's two-way data
bound that property doesn't just
automatically happen because our little
JavaScript thing doesn't know that
angular changed the value so if we
wanted that that all happen at the same
time we want to apply a watch to the
property that we're interested in and
then when it changes we can tell our
little JavaScript thing to update itself
so this is just kind of the key thing to
keep in mind when you're building
directives that works with some other
JavaScript library so of course i had to
pare down all of the code a lot to get
it into the presentation but you can
actually download and check out our
entire demo across all three talks at
this github repo and it has links to our
slides as well so you can reference it
later so so right now I talked about
just having angular as like a tiny
little thing on your page and you know
that the full power of angular is
building single page apps but you don't
have to like go single page right away
like we had an existing real sad it had
like a bunch of stuff on it I couldn't
just like go away for three months we
write everything and come back right we
practice continuous deployment you want
to maintain that momentum so what you
can do is if you're just starting with
angular it's just had angular in a
subdirectory and build that part as a
single page app with the angular routing
and everything and then incorporate more
things into it as you go along how you
do that is you define a base tag in your
head and that tells angular that it's
working out of a subdirectory so when
you add angular routing or if you use UI
router which is a very popular
alternative routing library for angular
then it'll only look at routes that
start with whatever you define here so
if you have a link that starts with that
it angle ER will handle it but it'll
leave the rest of your abalone okay so
now you've started incorporating more
and more and more of your stuff into
angular and you're like okay I'm ready
to let go full angular everything so you
have that but maybe you still have some
legacy things that are not angka rice
yet maybe they're just static pages but
you don't really want to spend time
rewriting those in tank
it doesn't really matter that much if
they just stayed legacy so how can you
tell angular to kind of stay away from
that well it's a little trick so if you
have an anchor tag you can just call
target underscore self and that'll tell
angular to just ignore it it'll still be
handled by your regular web server so
yeah that is the end and I hope you all
have fun time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>