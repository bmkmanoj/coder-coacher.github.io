<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Introduction to Node.js with Ryan Dahl | Coder Coacher - Coaching Coders</title><meta content="Introduction to Node.js with Ryan Dahl - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Introduction to Node.js with Ryan Dahl</b></h2><h5 class="post__date">2011-03-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jo_B4LTHi3I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm going to play with nodejs you will
watch me you will be amused and we will
go on with our lives it will be very fun
um but basically I don't have so many
slides I'm just going to open it up and
type and like show you what sort of
things that you might be able to do with
note and I kind of hope that this will
be a bit interactive where you'll say
like no you forgot a semicolon I'll say
no semicolons are optional and then
we'll you know fight it out
no it just interrupts me as you desire
okay so first of all I have to say node
for Windows users although I saw that
there is many Macintosh users is not as
good as it could be
we're working on that soon Windows will
be very supported at the moment it's a
very UNIX II sort of thing but this will
be changing in the next six months or so
so what's that
oh no Windows Windows is very important
just like PHP we don't have so all right
so let me just just for those of you who
are somewhat unfamiliar with downloading
and compiling things yourself note is
one of these things that is sufficiently
under development that you want to
compile it yourself from source okay not
all things are that way if you install
open SSL obviously you just installed
the Macintosh ports or you install the
Debian package or whatever but node is
changing okay it's a living creature and
with that comes some blood some pain and
your necessity to to compile it so this
is how you do it okay I'm not going to
go through the whole procedure but
hopefully this will work in a not
unreasonable amount of time so you
download it and you have to compile it
I'm sorry I can't wait two minutes all
right I'm going to to not do compiling
instructions
figure Makemake install okay and then
you get note which is a command line
thing it's not a GUI it's not a IDE it's
it's something it's it's like Python
right you type it in your command line
if you type it without arguments you
kind of get this weird prompt and you
can type JavaScript in there okay so so
node is a a bunch of sugar on top of a
very complex virtual machine written by
Google called v8 v8 is the JavaScript
engine inside of Chrome it is a beast
okay it's a it's a huge very high
performance virtual machine written by
very smart people that is not what
notice node is a set of libraries on top
of v8 okay that that takes uses its
greatness to do networking things and
the emphasis is on networking it's it's
somehow a general-purpose thing but the
the focus is on doing networking
correctly and so it does it in a
slightly weird way that I hope to
demonstrate with a couple of examples
but first let me just point out that yes
you do have a repo and you can type you
know function add a B return a plus B
and add two numbers right so that works
there's a global variable in node so in
in browser JavaScript you have this
window variable that's like this global
thing that somehow ties you to your site
well that's because you're in the Dom
you you have a window that you're
playing with
and no do you don't have you're not
associated with the browser so you don't
have this window object you have this
process object okay and and so so
process is a global variable and it's
it's kind of central to node so for
example process bid is the pit we get
bugs if we don't have semi
Kohn's that's somewhat true yes but I'm
just on I'm just kind of playing around
so hopefully we won't get any bugs if
you just type process you'll like see
all this stuff in process which is
actually kind of a lot of stuff like
process in which is the environment okay
so so you have this this read eval print
loop which is what you do when you
execute it but of course you can run
scripts too which is the most useful
thing so let me write a little script so
I'm going to do this and hopefully it
doesn't freak you out okay close your
eyes okay so what I'm going to do is
write a program called hello world J yes
yes thank you
so obviously you you open up your text
editor the only one that you ever know
and love right and you start typing a
little program so I'm going to indent it
a little bit because it doesn't work on
the video but so do you all know I'm
just launching it from bash same old
plain stuff do you guys know what set
timeout does does everybody somehow
familiar with browsers and stuff right
and so you have set timeout in the
browser and what set timeout does is it
has two arguments the first argument is
a callback and the second argument is
the number of milliseconds that you want
to wait okay so I'm going to type this
program and I want somebody to tell me
what it does and now you hopefully well
I guess a lot of you raised your hand
but so is intuitively what do you think
this does right okay so so hopefully as
you guys said it prints hello waits two
seconds and then prints world so let's
try that
node hello world hello weights two
seconds and then world and then it exits
okay that's good so so one of the points
I want to make here is that node is
should be somehow familiar to JavaScript
people who people who are familiar with
browser side JavaScript should be should
just feel comfortable not because it's
JavaScript necessarily but because we
use the same work I mean we could have
said we could have called this sleep
right we could have said sleep there and
well you you would probably get it too
but we tried it we try to use the same
terminology where possible so there's
something weird about this which is
different than how you might do this in
a different language just I think in in
PHP you might do something like this do
you say print and PHP so you print and
then you sleep two seconds and then you
then you do world right okay
so right this is how you would do it in
PHP so what what's the difference
between these two these two program like
there's something fundamentally
different here like right okay so notice
in this one the hello happened
immediately right we went right through
that set timeout and here we kind of
stopped on the sleep right so that that
is the fundamental difference in note is
that you never ever stop never do you
sleep never do you fetch a URL from a
website and wait for it to come back
like it not only are you discouraged
from doing it you simply do not have the
ability to do it because it's sealed off
from you you you cannot sleep in node
you can set timeout there's no there's
no weight on States there's no
you text locks there's there's no sort
of possibility of just halting execution
you can idle okay so this program when
it's during those two seconds in between
the hello and the world it's not like
spinning in a busy loop right it just
idles the CPU goes to 0 the the OS
unschedule zit does other things you
know updates my clock or whatever and
then schedules it back when when when
the timeout is done okay so so note is
good at idling it doesn't sleep though
okay so so let me just kind of improve
on this example and maybe I'll go
slightly faster now so let me see P
hello world into hello world - I'm doing
it this way so that I can give it to you
later what if I change that set timeout
to set interval yes hello
world world world so let me do that
hello world oh wait that was the wrong
one hello world world okay maybe we
should have used something less than two
seconds yes Oh excellent question so so
why did the first script end and why is
the sex so notice that that script exits
right now I can type LS but if the on
the second script you know I can type LS
as much as I want I'm not returned to
the prompt that process continues onward
so the so this brings up an important
property of node it exits when there's
nothing left to do so it has this kind
of natural ability to reference count
the callbacks that are pending for for
it be it a network connection a callback
waiting for an HTTP response or a
interval timer that's going to be
executed every once in a while it knows
that there's something to do and so it
doesn't drop out but once all those
things go away it drops out so it's a
good way
design your program such that you do the
things that need to be done and then it
exits naturally you don't prosecute on
exit the process forcefully so this is
all fine and dandy like I'm sure you're
like oh great okay so so javascript in
the console that's cool
I guess but that's actually not so
interesting the interesting part is is
that this comes bundled with a bunch of
kind of good libraries and so let me
write you a web server okay so it has a
pretty advanced hgp a thing library
built in okay that can do both client
and server side hgp and so let me
demonstrate to you what what the HTTP
client looks like so first of all you
have to load the HTTP module and we'll
put a bar in front of that so it's not
global and then you have to create an
HTTP server which you do with create
server and that thing gets a callback
so looks something like that
so that callback is executed every time
a request comes into the server that
makes sense
so which is slightly different than
every time a connection is made to the
server so I'll just call the server s
and we have to bind to a port so I'm
just going to choose port 8000 right
because I'm not route so I can't bind to
lower numbered ports so here's the hello
world thing you you write a header which
is 200 ok content type text plane okay
looks good
can you guys all see that by the way
okay and then you end the response and
we'll just say hello world
so that's your body so headers and body
so let's try that out so I'm going to
run web server ok
not exiting there's stuff to be done
right it's it's listening on a port so
let me go back to my thing here and now
I'm going to curl HTTP localhost port
8000 and I get hello world okay
excellent so we wrote a little webserver
I think we can even do it here you can
do it there too okay so so we can we can
hit hello world excellent that's good
let's inspect those headers that it's
returning for a second okay can you guys
see that right here okay so the headers
are content type type text plane let me
put up the server again so content type
text plane we told it to send right and
there's two other headers connection
keep the live and transfer encoding
chunked okay so why why these headers
what okay wait so first of all let me
also point out that it's HTTP 1.1 which
possibly you don't care about until you
realize that your server can't do HTTP
1.1 and then you get really angry is it
it does hgp 1.1 the most modern version
of HTTP why is it connection keep alive
what does that mean yeah you have it
means there's persistent connections to
the web server so when you go to make a
request to the web server in old in the
olden days you would make the request
get the response and then the TCP
connection would be killed but in modern
hgp this is a persistent connection and
so you can send a request and send
another request and send another request
all on the same connection and get
response response response without going
through the effort of tearing down and
building up that TCP connection every
time that's good you want that you want
persistent connections what about that
what about transfer encoding chunked are
there any H
nerds in the audience yes you people
you're right okay streaming that's
that's right so it's not totally clear
from this example here we we wrote we
said response end and then we gave it
some body right
node doesn't force you to give the
entire body up front the API actually
allows you to do other things let me
make this more explicit let's write part
of the body first
so let's write hello and then do a set
timeout yes okay so can we guess what
this will do yeah so first it writes
hello and then it writes world but it
pauses in between okay so so you're
getting you're making one request to the
server you get back hello one body one
response right hello two seconds pause
and then world and then the response
terminates okay so the body is not
terminated by carriage returns in HTTP I
but let's yeah let's let's test it and
see what happens okay so so if I curl it
oops I get cannot connect to host
because we have to start it okay so we
start the web server and we curl it and
we get hello and then world okay so
that's cool that's cool in all that's
why we needed the transfer encoding
chunked because if we said content
length 12 it wouldn't actually work
because you know we could have we could
have done other things know at that
point where we where we wrote the the
response when we wrote this thing we
actually when we wrote the header here
we don't we don't actually know what's
coming next right maybe we're making a
request to a MySQL database and it's
sending back you know between 50 and a
thousand lines of responses we don't
know how big that body is furthermore we
don't want to buffer it okay we don't
want to go through the extra effort of
inside the web server buffering up that
entire MySQL response before we send it
out to the server what we would rather
do is proxy it to the to the client and
so when this MySQL server starts sending
us a huge response with like many
thousands of rows instead of using up
our server memory we can just send it
directly back to the client so the
browser so the question is how does the
browser know when
the responses completed that's part of h
GP h GP has a way of terminating each
message so there's different ways of
encoding so right there in a GP previous
before one point one you actually didn't
have persistent connections and so the
way that you terminated the response was
you just shut down the connection so
when the connection shut down you
realize that it's done but now that
we're in HTTP 1.1 we can possibly have
more than one response so we need a way
to bound these messages we need a
framing protocol yes you need keep alive
for for the persistent connections but
you need transfer encoding chunked to
send a variable-length response whatever
let's not talk about it so much what I
want to say here is is that when this
server is doing oops if I don't turn it
off all the time okay so if I start it
and do that in between that hello and
that world the server has not shut down
okay it's it's not like it's writing
that response and nothing else can
happen no no quite the opposite that was
not asleep
okay so we drop down and we're idle
before that that two-second timeout
happens the server is idle it can handle
another connection let's see if I can
I'll try to curl it from two terminals
at once see if this this works okay I do
it I have to be very fast okay click
there click there oh wait okay one
more time okay click there click there
okay so you see did you see that it got
the other the other hello and in fact
what if we Apache bench it with a
hundred connections to it and let's just
see how long each each of those request
responses we're doing a hundred in
parallel but each one should it take
exactly two seconds if the server is
doing what it's wanting if the server
was stupid then the first the first
request response should happen in two
seconds but the next one should happen
in four seconds and the next one will
happen in six seconds that would be if
we did asleep but what I'm telling you
is that the server
does the right thing it goes to idle it
can handle another connection so let's
see if we can do this we shouldn't do a
hundred because oh wait yeah I think we
can do that okay so hopefully this will
work does that look right okay okay so
one two okay so hopefully we've done a
hundred request responses and let's see
if we can somewhere in here I think it
tells us okay so taken so concurrency
level one hundred completed requests one
hundred time taken for test two seconds
okay
excellent that is what you want right
you do not want that test to take
hundreds and hundreds of seconds so I
mean obviously this is a contrived
example right but the point that I want
to make is that node handles concurrency
well because of this property that it
never waits for anything it's allowed to
handle more and more connections it's
never halted on on sleeping or
connecting to some database or anything
actually so it can always handle another
connection so it tends to perform much
better especially under high concurrency
than your traditional web server okay
what happens when I add a zero to the
Apache bench to which one this nothing
because it's not running it should be it
should be fine so that's that's 100
concurrent connections but a thousand
responses alright so so it's doing it in
100 batches so I think it should take 10
times 2 which is 20 seconds or something
does that seem reasonable
okay yes so it took 20 seconds obviously
if we increase the concurrency my
computer can't actually handle a
thousand concurrent requests from this
laptop because Macintosh is wait
hold on
fix Macintosh port range okay let's try
that it should it should work okay so
this should be two seconds too many
files I have to have to increase my you
limit operating system limits okay not
not necessarily the server limits
alright so web servers yes
web servers it can do web servers
obviously nobody cares because you don't
actually want to write a web server you
want to use a web framework we have
those okay but I don't make them other
people make them and they give talks to
this is the foundation of what you want
to be underneath your web stack okay
other things that make it more friendly
are on top of it what the API that node
provides is very simple but it's it's
good okay so what I want to do now is
write a little so we can do web web
that's cool I want to do now a little
TCP server okay so getting down here
you're saying you know a cheapie that's
too much that's like way too much
overhead for me I am cool
I do raw TCP okay so so now you t CP
server is okay so here's how it looks I
have to type frantically now
okay so require net that's where the TCP
stuff lives and it looks a lot like the
HTTP server you do create server but
instead of giving a request response
that's a that's an HDPE thing in TCP you
just have sockets so you
get a socket so every time somebody
connects to the server you get that
socket and then we have to bind that
server to a port so we'll bind to port
8000 again look cool okay so what can we
do with these sockets well we can write
stuff to them and we can terminate them
we can do more actually but let's start
with that so it will write hello and
then world and terminate the TCP
connection so let's see
are you a net cat fan or a telnet fan
net cat okay I mean as as sick it as it
is I'm actually more of a telnet fan but
okay so let's just use telnet everybody
loves telnet right okay so we're running
the TCP server if we telnet to port 8000
we get all this crap because it's telnet
but we do get hello world in there okay
and of course you get connection close
by foreign host let's just use telnet
netcat from now on okay hello world
excellent
TCP server this was only sending data we
can of course receive data we are that
we being the server so let's let's do
that now so when somebody when we
receive some data let's just echo it
back to them okay so the way you do that
is you do socket on data and you give a
call back okay so every time some data
or every time a packet arrives on that
socket we're going to do something okay
and what we want to do is is just send
it back to the person who sent it so
what we can do is sock it right data
okay so that's seem like an echo server
to you so we'll get hello world and then
everything after that whatever we write
to it will get sent back the server is
never going to terminate the connection
okay so let's try that
oh wait what no thank you
you guys are so observant yes there's an
end right there so let's let's change
that to right okay hello world okay
net cows line buffered so that's why I'm
not getting it back as I type it so
that's an echo server okay so let's do
something slightly more complicated
which is I mean obviously the server can
be handling many connections at once
let's write a chat server in in node so
that everybody who connects to to it
with with their clients hopefully
there's people in the room can connect
to it and then we'll be able to chat on
telnet to each other via this and
obviously you're not it's going to be
like the crappiest chat server ever yes
exceptions yeah so I'm kind of throwing
that aside yes there there's a lot of
holes in these programs that you would
need to plug in a real life application
let's let's just see if we can get
started with a very crappy very crappy
chat server so chat Jas
okay so again require net net create
server actually you can just abbreviate
the server socket
I'll just abbreviate server with s and
then s has to listen on some port okay
so every time somebody connects what we
want to do is kind of keep a cool of
sockets so that we can broadcast later
on so when data arrives we want to kind
of firehose everybody in the connection
pool okay so so what let's keep an array
obviously not the proper data structure
for this sort of thing but whatever it's
available and let's just say sockets
okay so we'll have like a little empty
array where we're going to keep the
people who connect to the server in so
every time somebody connects to the
server we want to put them into the
sockets so sockets push socket seem
reasonable okay now we have an array
that that gets all of the sockets in it
now what we want to do is every time
somebody says something in the server
function D we want to iterate over the
sockets and write it out to them right
we want a broadcast so what socket that
on yes so right okay RI equals zero
let's iterate over this thing sockets
dot length I plus plus
um I forgot what we're where am i what
are we doing here oh yeah okay uh
sockets I write data that looks
reasonable okay chat server BAM okay so
let's try this puppy out what's that
okay let's try that see if that works
probably won't so node chat J s if I
tell net to localhost at port 8000 I get
something okay wait is somebody typing
something I did this before and people
went to oh crap did crash alrdy man
people Jesus
hold your horses you're ruining my demo
all right we have to make it we have to
improve it people are crashing it
already just like real life okay clearly
this was not good enough so what's the
problem here there's some problem which
is that we're filling up this an array
with sockets and sometimes people are
disconnecting okay and I think that's
what happened somebody connected and
disconnected and now this array has a
dead socket in it it's still in that
array and so when we iterate over that
and we try to write to it the server
blows up and says like I can't write to
that because that socket is dead so what
we have to do is remove those dead
sockets from the array as they
disconnect from the server so we can do
that with not on data but on end or
let's just do on closed actually no
let's do on then and there's two there's
two termination events okay so on end on
the socket end we want to remove it from
the array okay so now those of you who
have good JavaScript skills okay I've
done this like five times now so I think
I can remember it so I think I do
sockets index of socket so I find the
index of that guy and then I do sockets
splice maybe I won anybody we actually
have to test this because I don't know
oops
mm oh wait no okay so pretend we had an
array like this and then we wanted to do
a splice that and then how is a look I
think that's how you remove an element
from an array it I don't think delete
removes it from the array actually it
doesn't change the length of the array
so if we had a if we go delete a zero
say oh oh that does work well well
okay I've been doing it wrong
my entire life it depends on the platter
all right well whatever I know this
works okay yeah so let's let's try that
again so let me start the server node
chat j/s and let me tell that to it so
if I type hello I should get hello back
let's see if anybody else can type
something on there Oh poop
very mature guys what Oh
my IP address yes is that port 8000 all
right
obviously the PHP people ok killing that
server okay so maybe if you noticed when
I first joined I typed hello and I got
hello back
so we're broadcasting to ourselves
actually which is a little bit
unnecessary so let's just let's make it
slightly better it's still a piece of
 but we can make it slightly better
if we just skip one of these which is if
sockets I equals socket then continue or
something right that should work yeah or
if they or whatever so that should fix
the echoing problem
that telnet to that hello okay so so
excellent so let's just watch this for
the rest of the didn't it yes so
networking stuff a cheapy server TCP
server printing the standard out all of
those things are not part of JavaScript
what is JavaScript is like functions and
addition numbers strings arrays objects
which are hashes in Java JavaScript not
not much more Java Script is a very
bare-bones language so JavaScript has a
couple of things hopefully you won't
hack my computer there there's a there's
like a math library there's there's
there's a couple of things that are part
of JavaScript obviously this is too
distracting kill that okay so most of it
is node all of this require stuff is
note yeah
so what are the debugging options for
node so recently so like I said no very
bleeding edge right looks kind of snappy
and cool here but wait till you get in
production and right in the gut so it's
one of those things that's under
development so debugging is is one of
the parts that is half done but I will
show you what it looks like
so let me write a little program here
let's open up our original hello world
program so what if we wanted to debug
this guy right let's put in a function
here
so there's this special debugger
statement which is that and so when you
run this normally you'll just I mean
who's not printing anything even so
we'll just get the original behavior up
sorry so hello world exit because foo
doesn't print anything but if you do
node debug you get this little debugger
prompt it's like gdb
everybody loves gdb right gdb know
everybody loves gdb if you don't love it
you're wrong
so you type run and it will start on
node process and we hit a breakpoint in
foo on hello world line 9 ok and we can
do like a back trace and find out where
we are and we can like list the code and
see that we're on that thing so like I
said v8 the engine on which node is
built is an incredibly professional and
well done VM and does include things
like debugging this this interface is
part of node but the actual debugger the
way that it can step and pause the VM is
all part of v8 itself and so in chrome
you might use the chrome inspector thing
where you can open up a website like
this and do control I maybe know I know
what I'm talking about right option J
okay so this thing right has like
scripts and you can like set breakpoints
and stuff that is v8 v8 runs inside of
Chrome and the way that it handles the
breakpoints is the same way is the same
thing that we interface with okay
so there's several options for debugging
in node there's different clients to
this kind of internal debugger one is
that thing that I just showed you the
gdb like thing but there's other ones
like node inspector which are more
graphical okay there's an eclipse
plug-in for it I'm trying to see if
there's a screenshot or something but
maybe not so anyway there's there some
debugging options it looks like this
looks just like chrome inspector yes so
that's the debugging question like I
said this thing is total crap actually I
mean it's useful and I use it all the
time but it's one of those parts that is
not completely fully baked this this
client to the debugger the debugger
itself is fine just the the client here
is you know what I mean by client the v8
has is a separate process and it
presents its debugger it has a little
protocol and so it opens a port and you
can connect to that port and issue
commands to it it's a little JSON
protocol and in that way you can tell it
to step and step into a function and
list the source code and breakpoints and
whatnot so yes there are some debugging
options but generally they're not as
well fleshed out as one would hope in
other languages yeah I mean basically
the this primitive thing is basically
what I'm using a lot um okay so I want
to do one more demo at least so node can
do a lot of things at once right because
it's not
 okay so what I want to show you
is how we can kind of mash together
these examples that we had into one
process okay so so let me let me copy
that hello world example into hello
world server Jas and what I want to show
you is that so imagine you had a sleep
loop in your program right and imagine
you're programming in Python and you had
something that looks like while true you
know sleep 5 or whatever I don't know
people do in Python something like that
ok so imagine that was your program and
now your boss comes to you
you know may that's some batch operation
it's happening every once in a while
it's it's doing some some some stuff you
know that programs do and now your boss
comes and he says ok that guy over there
that server we need him to now connect
to some website and like pull back data
every second ok so now now you're you're
faced with the Opera with the the task
of refactoring that server into doing
some new thing at some different
interval of time and so now you you get
out your calculator and you're like
alright so he wants me to do it every
two seconds but I've got this loop that
runs every five seconds so I can like
you know multiply the two numbers and
find the common least common denominator
and then I'm going to activate every
time and I'm going to see take the
modulo of the whatever okay you're going
to do some work to make that happen or
or you're going to open another thread
and have two threads doing things right
one doing the new operation and the
other one doing the the old operation
that's a that's a possibility let it
just be said that your thread that you
create it's not it's not free ok it
comes it comes at some cost okay it's
it's a fine solution for some things but
but it's not free so let's in node let's
add this thing okay so say this is
happening every five seconds I'm going
to delete that now we have to do
something every two seconds we have to
get google.com so so we're going to
require hgp and every two seconds we're
going to fetch google.com and the way
that we do that is we do hgp get and and
say just for brevity we're going to just
print out the headers okay so every two
seconds we're going to print the headers
from that so a console.log response
headers okay so that's what an HTTP GET
looks like in node and we're going to do
that every two seconds so notice we've
done this without changing our original
program like not at all there's still
the other things still running right but
we can enter this new thing running at a
different speed without changing what
has already happened and the we're not
doing this in another thread we're not
putting more weight on the OS scheduler
we're doing this in a very simple and
kind of clean way so let me just run
that and see if it actually works why do
I call that server okay excellent so so
yeah
what do you think about that do you
think this is so boring I cannot wait to
go home and have a beer why do they not
serve beers at these things because
that's what I'm thinking yeah ok so what
can you do useful with this before I go
on let me just say now your boss comes
to you and says ok now actually I want a
web server in there too
as he always does so so now you go in
and you just kind of add a couple lines
here and you do HTTP server request
response bla response right head 200 and
hello world let's even put like a little
pause in there because maybe this is
like simulating a database request or
something okay so that's that's kind of
our web server from before it takes one
second to write hello world okay but all
these other things are happening I
forgot to listen on on a port s listen
on port 8000 okay so now the server is
doing a lot of things right so so let me
run that guy okay so so it's it's
printing out hello it's fetching Google
com
and now if I curl it it waits two
seconds and and returns hello world okay
so so mashing things together is the
idea here you're just kind of taking
different inputs and because we're
non-blocking we can kind of smash them
all together into different things right
okay so so the question is the small
examples they look cool that's a cool
dude but you know what actually I'm not
totally convinced that you're
non-blocking style of writing code is is
a something that is maintainable in the
long run that is a very good question
and the answer is we don't know because
this is the first system that's done
that obviously so a lot of people
complain that what you're going to do is
is go oh I have to hgp get something I'm
not going to put in real code because
I'll take too long
so I have to get something here and you
know after I get something I actually
have to like take that response and
connect to the database so I have two DB
query response headers cookie and then I
have like another function called
because after when the data when you
query the database you that's also
access that has to be non-blocking to so
you have another callback and then when
you finally get that response from the
database actually now you have to hit
the memcache server or whatever right so
now you now you have to do something
else so now you have to query database
to actually and do this with you know
here's the DB response so now you have
to use you know DB this is such a
contrived example DB response Row 1 so
DB 2 response and now you have this and
you know it grows infinitely inward and
so the the the the extremely naive sort
of complaint is Jesus I mean you know
how big is your text editor I can't
indent forever ok like that that's not
possible well obviously nobody's asking
you to indent forever you know you can
you're not forced to use anonymous
functions right so what you can do is
you can take this whole thing put it up
here and call this after
after request okay so now we've we've
lost one indention level or maybe not
but now we can take you know the second
one which is this one and put it up here
say oh well this is this is after db1
obviously I should have liked a better
real example here but you can imagine
and then you can take this one and move
it out here so do you have to indent
forever the answer is no that is that is
patently false yes you can give your
functions names and pull them out of
these anonymous functions okay I think
the more so so that would be the answer
to the naive question the more complex
question is is you know is it possible
to actually like abstract multiple
things here into something that you know
I'm doing this complex series of
database calls you know one after
another after another and I want to
present my users with a nice friendly
interface to that and not expose them to
the madness of callbacks that are
happening under under the table and the
answer is yes of course you can do that
okay so what the way that you do that is
is so my contrived example is okay so so
let's imagine that you have this this
hgp get is part of a module that you're
distributing and you're saying oh maybe
you work for joint or whatever the joint
distributes a module that has a function
called get uh just get okay which does a
bunch of stuff and so we are
distributing this module
and the the exposed function is is this
guy here I'll talk about in a second how
you actually structure modules and stuff
the way that you actually allow that got
that guy to be presented to the user is
that you yourself give a call back so
you give a call back as this parameter
and you keep passing it down so so you
do after so you you keep passing it it
down here so does that make sense so
that you can keep passing this this
callback deeper and deeper into your
layers of things that you're doing
I I'm I fear that I like this example is
just wildly too made-up to be followed
by anybody does that make sense so that
you you're always passing this this
callback deeper and deeper db2 response
I'm going to distribute this this code
after and now you can call the callback
okay so so I'm exposing the lower level
one so the users they just do one
callback but internally we've abstracted
all this IO that's happening right into
one callback you can't remove the
callback though you can't make IO happen
and not have a callback a completion
callback that is impossible but that's
good so so the user is explicitly aware
that this get function that joint is
distributing does something on the
network like they don't know what it can
be super complicated but it is not just
adding two numbers together it is going
out and doing stuff on the event loop
and you know resolving DNS addresses and
getting URLs and hitting a database and
bola and when it's all done with that it
will call your callback so that was a
very poor answer but I believe yes you
can abstract and have maintenance and do
these sort of things it's a different
style though to be sure and it takes
some getting used to but we write very
complicated I mean note itself is a
pretty complex program and so far we
haven't said to ourselves oh it you
know we can't do it it's too complicated
now it I believe that the the complexity
is not exploding as we go forward but
we'll have to see we'll have to see what
what the landscape looks like a year
from now when there's real big websites
written on it if that ever happens yes
so the question is what are the Achilles
hills of of node what are
what are the problems here so I would
say the number one problem is immaturity
it's a young platform and it's a
platform that's starting from scratch
right this is not sitting on top of
Python it's not on top of Ruby it's not
on top of Java it is literally from
scratch so if you don't have a driver to
connect to Oracle you have to write one
which is a problem right for a lot of
people if they can't connect to their
database and it's not already there then
that's it they can't use it so that is a
major problem more likely there probably
will be a driver but it's really crappy
and because some guy just did it and you
know it hasn't had years of maintenance
and bug fixes and that sort of thing so
I think the number one problem with the
platform is that it's just young and and
that's something that hopefully will
alleviate itself over the next couple
months or a year I think there's another
problem which touches on the previous
question of code maintainability and
debug ability there's this problem with
event loops which is which is this so
you're always killing your stack your
stacks are very short so so if you're if
you have a threaded program you just
call function after function after
function and then you block and then
call more function you have more
functions and then at some point you hit
an exception and you've got this huge
stack trace and you can say I was there
I was there I was there I was there I
was there but notice in this one so let
me just edit this hello world again so
taking out that let's say we hit an
exception in this callback or let's make
it more
so okay let's do this I'm trying to come
up with a good example here so let's
let's put let's do foo as a function
here it's not an anonymous function okay
so that's the same thing okay but in
inside of foo we do another set timeout
for another second and then inside of
bar we do a we print world okay so
that's going to wait three seconds okay
so let's let's throw in exception here
and let's let's look at what the stack
trace looks like so in a normal program
you would see okay we're in the like the
main function and then we called you
know sleep well and then that dropped
out and then we call bar we called foo
and then we call bar and you would kind
of have that in your stack trace but I
think in this one you'll see that so
that we hit a problem so here's our
stack trace no mention of foo in there
at all okay so so kind of that middle
ground that bar came from disappeared
entirely
because we drop back down to the event
loop after that timeout right so you
have these small stack traces and well
it's it's a problem it's it's something
that we are thinking about ways of
solving but it's basically the same
problem that you have in the web browser
as well I mean if you also have the same
the same single threaded sort of model
it's not impossible but it does get
somewhat annoying to find out where
you're coming from so one way of
alleviating that is by every time
setting you could have a debug mode
which we have kind of a tentative branch
of doing where every time you set up a
new event so say set a start a set
timeout that you would record where you
came
the the the guy who started you and then
you would go do stuff and a new event
would come out and you would record
where you came from then and so when you
hit the exception you would be able to
walk back through history and kind of
see where you are and instead of talking
too much about that I'm going to point
you to some slides that I have on that
is that how you spell Illuminati oh crap
I'm a terrible speller
that looks like PDF okay so so I'll
point you to some slides which talked
more about this problem and the branch
that we are trying to our plans for
solving that but yeah it's a problem so
so in my opinion that would be the
number one achilles hill of of it
there's a other people complain there's
one more complaint which i think is not
valid actually which is that so so node
is have to be careful I'm going a bit
over on time so so node is a single
threaded sort of system right you you
you're in one process you're in one
thread in this process and that means
that if you're on a 32 core box those
other cores are idle with respect to
this task that you're doing on this on
this process so I don't think that this
is a problem because you can you can
start more of them okay there there is a
kernel scheduler that can schedule
processes to these other threads what we
are doing is saying one of these guys
shares nothing with the other threads it
is a shared nothing model in fact it's
so shared nothing that we are kind of
putting a boundary between it and the
other guys at the process layer even at
the OS process not only are you kind of
you know somehow gated off from from
talking to other processes you literally
cannot look at their memory you are
enforced by the operating system to not
look at their memory if you want to talk
to them you have to literally open a
socket and serialized data and send it
to them I think that's a fine solution
why because programs these days very
large website sort of scale programs
that are very large tends to have to
grow beyond one box
like using the 32 cores on one box that
does not scale at like Google scale
right what you need to do is be able to
distribute a program among multiple
machines and part of that is speaking in
serialized message passing sort of
things and so forcing that to happen
even at on the single machine level kind
of enforces this sort of model of
growing as soon as you grow beyond one
process you have to grow to multi
machines it doesn't make sense to use
nodejs to create a peer-to-peer network
yes I mean I think that is why it is
called node is that the idea is that you
have this kind of simple building block
which is a good kind of thick process a
good process in that but you know to
scale out these guys are going to have
to talk to each other and nobody's
saying that's an easy problem to solve
they're going to have to share state
that's right they're going to have to
serialize it and use gossip or use Redis
or use something like that but once you
get to that point like there's different
directions that can be taken and so note
is not trying to solve that problem for
you that's still a problem to be solved
yeah it's not it's not preventing you
from solving that problem I want to very
briefly if I have if you guys don't mind
tell you just just a second about the
kind of larger landscape so node is you
know in one-to-one correspondence with
Ruby
there is a gems sort of thing it's
called NPM node package manager
Issac who writes this is works in the
office next to me our internet is
terrible here but it has this nice
little command you copy that it deletes
your hard drive and then you paste it in
here and what this does is it installs
NPM for you I think I already have it
installed even so I'll just kill that
NPM okay so what you can do is install
things like a popular
very called socket IO and it does what
you think it does it downloads stuff so
if you're working with node having NPM
installed helps a lot because you kind
of have access to this package
repository and the popular web framework
just so you know and don't have to look
around at all the thousands of other web
frameworks for node is Express j/s which
is written by a guy at learn boost
so yes it's a Sinatra like thing and I
think I'll leave it to you to ask me
about other things but there's a lot of
modules for stuff that is invisible how
do you invert the colors whatever okay
so I'm going to end it there but I'm
going to stick around for a minute until
everybody disperses and then if you want
to ask me questions off-camera or
whatever
feel free so thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>