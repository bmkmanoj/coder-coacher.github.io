<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>HTTP/2 is Web Performance Candy - Forward 4 Web Summit | Coder Coacher - Coaching Coders</title><meta content="HTTP/2 is Web Performance Candy - Forward 4 Web Summit - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>HTTP/2 is Web Performance Candy - Forward 4 Web Summit</b></h2><h5 class="post__date">2016-03-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1W-UdX4Yk94" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">it's kind of appropriate we're in the
basement to talk about some little bit
more low-level than an application code
my name is clay I work for New Relic I'm
a developer advocate there i'm joined by
my colleague Jeff Martin's who is the
browser p.m. up front she definitely say
hi to jeff and you know today i'm gonna
be giving you a kind of an introduction
to this new thing called hv two and i
think the why of a talk is always really
important and personally i think thats
this new protocol the successor to the
previous version HD 1.1 has really
important implications for the future of
the web and also api's as well and
whether or not we as a community end up
adopting it or becomes the new ipv6
where you know it's ten years later and
it's you know only thirty percent of
people are using it really depends on
the community and everybody in this room
and one of the massive hurdles to heb to
adoption especially for someone with my
backgrounds who's very focused on
application development is the protocol
itself is very difficult to understand
it's very complex there's quite a lot
going on and that in turn has a lot of
really big implications on how we
actually build web applications but also
rest api is and mobile applications and
this talk ultimately is just an
introduction to what it all means using
some candy it's true and it's an attempt
by me to kind of explain it and and help
people understand you know how it might
impact your day-to-day job if not now
maybe in six months or a year it's
broken up into three parts here the
first is an introduction of the protocol
itself the second is how hb2 is kind of
changing web performance best practices
so we know how it works what does that
actually mean for me is someone who
builds or write software for the web and
then part three is a little bit of
debugging I think if you're brave enough
to actually start implementing it you
really need to know the tools of how you
actually can inspect it and know what's
going on and that's that itself it's
still quite early as it's pretty pretty
brittle material so one of the really
big goals you know I'll be really happy
is
the end of this presentation this makes
sense why is hv to like a party punch
flavor twizzler poem peel and why is a
free 1.1 like a sour patch kids rope i
really hope to explain you know why this
metaphor is useful for understanding the
construction differences between the two
protocols and why in general people are
saying oh hb2 it's a lot faster it's
improved sits a lot more advanced we can
use it to build faster web apps i think
it's really important to get simple
definitions out of the way I I think
probably everyone in here is built
software for the web before but simple
english wikipedia always comes to the
rescue and that's that ultimately this
is a protocol it's a communications
protocol and HP 1.1 as we know anyone
who's look to the chrome web inspector
is just a way to send and receive web
pages and files on the internet and
that's how i was actually created back
in the mid 90s by tim berners-lee and
we're really still suck with that but as
you've known a HP 1.1 and the protocol
itself is now used all over the place in
other things mobile phones mobile AP is
and rest api is an inner and even i like
inner microservice communication is
often done in HT to http and that's we
had so well understood and basically
every single programming language has
some sort of HTTP client or server so
it's been adopted all over the place and
that's really nice as people to write
software that said and this is kind of
obvious that HP 1.1 the protocol is
nearly 20 years old so I've chosen a
nice Netscape Navigator theme for this
slide and it sounds really dated but
back in the late 90s you could say yes
HP 1.1 is the main application protocol
of the information superhighway and
people were really able to look at you
that weird and one of the really really
great things about HP 1.1 as it was
conceived the 90s was that it was simple
you can actually still do this today and
I think many of you have probably done
this but if you use the telnet tool
which is just a way to send texts over
TCP you go two forward Jace or google
com on port 80 you can actually
physically type on your keyboard human
readable HP command
you can get responses back you can add
headers and that's really that's really
simplified the way people have built
clients and servers because ultimately a
hey it's just text you can read that
yourself you can read it in the bugging
tool you can read it over the wire and
it's been very easy to kind of build
this massive infrastructure which by the
way it powers the entire Internet in the
web because it's a very simple and
understandable protocol however since
the late 90s since Netscape Navigator
was the browser you used there have been
a lot of changes in the web itself the
first which is no surprise to everybody
here is that yes we keep writing more
and more JavaScript I'm htp archive.org
has great stats on this always always
interesting to look at it goes about
back about six years from twenty ten to
twenty sixteen yes the trend is clear
we're making more JavaScript requests
that's request to deliver JavaScript web
applications and the size of that
javascript is also increasing as well
the second thing and it's absolutely
related is that yes in the past six
years and absolutely since the late 90s
we're sending more and more bites over
the wire that's JavaScript CSS
everyone's favorite web fonts images of
course an HTML markup as well so you
know it keeps going up the number of
requests keep going up this graph is a
little bit deceptive but in in 2010 it
was about 50 requests on the top Alexa
top 100 sites now it's closer to let me
just see like and read this closer to 90
so more stuff over the wire more
JavaScript more and more everything
built on top of a now 20 year olds web
application protocol and is people have
wisely pointed out this is a great talk
I'll share the slides later I highly
encourage everyone takes a look at these
slides yes we're kind of in the middle
of this website obesity crisis the pages
we go to even for very simple and
straightforward Constance is is all over
the place you know it's it's not
uncommon to go to a web page and then be
faced with I don't know a you know two
megabytes to read a text article all
that said at the lower level down in the
base
on the protocol level HP 1.1 is still
partying like it's 1997 and it's kind of
incredible and to the credit of the web
community and people that write software
that we're even able to build these
really interesting things on this stated
protocol so in twenty two thousand nine
november two thousand nine google comes
along and posts this blog post which i
have rendered in chrome 5v the best
browser of its day in 2009 but the idea
here is that you know they said they
dropped this bomb and said hey we're
researching this new thing called speedy
in lab settings we're seeing web pages
that are loading up to fifty percent
faster using all of these really clever
tricks and this is absolutely the basis
of this talk and kind of a historical
background that kind of has led us to
HTV to which absolutely came out of
research google started with speedy so
final historical know before we actually
go in the protocol itself was ratified
by the internet Engineering Task Force
in May of 2015 and it's slowly being
adopted by different clients and servers
all over the world for on the browser
side according to can I use com that
stands at about sixty two percent every
modern browser Chrome Firefox Safari
both mobile and desktop and and I edge
all support it so more and more browsers
can talk and understand HP to that kind
of leads us to the second part of the
talk and well like what is this hb2
thing and how does it work and you know
why does it lead to these performance
benefits I think it's really important
to understand the why it makes things
faster and it's actually kind of clever
to how they did it so let's start with
those two pieces of candy but we've
haven't unwrapped the pieces of candy
yet the reason they're wrapped is there
in a TLS wrapper hp2 is required by all
browsers to be since / HTS so over the
wire and this is really important
because over the wire let's say you're
some you're some application proxy in a
corporate network that hasn't been
updated in 10 years that proxy
does it know it's HTTP two or HP 1.1
over TLS because all encrypted so
because HP two and A three 1401 are
wrapped in TLS all of these devices that
have no idea or no conception of hb2
work perfectly well it's only when the
traffic is decrypted on the browser and
server side that's the client and server
code actually knows what it is and so if
we unwrap it if we unwrap the TLS we're
ultimately looking at these two pieces
of candy and yes it's kind of obvious
the twizzler pull and peel party punch
flavor is a little more complex and it's
a hazard for construction but we can
imagine both of these as communication
is application protocol data going over
a single TLS connection for both and if
we unwrap that twizzler pull and peel we
see many different streams and that's
kind of the key inside here is that if
once we unwrap it we see all these
different color streams and all of those
streams are where messages are since and
messages are just that gets the post
that elites all of the HP verbs the
response code and the data that come
through client and server communication
and so we've unwrapped it there are
multiple streams in a single connection
can have multiple streams the streams
have an ID and most critically and this
is the really cool thing the streams can
actually have priorities and also
dependencies so one really cutting edge
piece of this new protocol is that it's
now possible for clients to tell servers
that one stream is more important than
another stream or one stream can
potentially depend on another stream if
we go even deeper though streams isn't
it streams themselves are composed of
frames which the spec calls kind of the
fundamental unit of hb2 things like the
kind of the atomic level of the
application protocol and so if we look
at these messages the gatepost which map
by the way perfectly to the standard yet
posts the sender messages in HP 1.1 you
see there instead of being just blobs of
texts that we sent over telnet there now
actually composed of individual binary
frames and this is the really cool thing
about HTTP two in general this is why
it's faster it's this binary framing
layer
so if we actually inspect these messages
in these frames that belong to these
streams over the wire we see they're all
interweaved and we have different frames
with different types that belong to
different streams and then the client of
the server reassemble these three these
binary frames into messages and in the
application code picks them up great
you're good to go you've got to get a
post you got to get you going to post
here's the data the frames and I really
want to underscore this this entire
layer this construction of the protocol
how it's done in binary frames is
absolutely fundamental to all of the
performance increases google and the
researchers in the IETF came up with
this very very clever and I think
personally kind of cool way to reframe
hp1 semantics using this binary layer
and it turns out there are some pretty
significant performance benefits by
doing that and because of that it turns
out unfortunately uh you know that kind
of changes a lot of the assumptions
we've had as a community in the past ten
years if like if we were to flip the hd2
switch on tomorrow it just changes a lot
of the assumptions we made about how to
build fast web pages and a brief aside
just about latency and this is why one
of the new features of hb2 is such a big
deal and that's you know information
can't travel faster than the speed of
light and if you're sending a bit from
one side of the world to another that
absolutely has a cost just to transmit
the data and especially over long
distances of this Web has become more
global as you know people are accessing
api's and websites on a global audience
the cost of moving those HP requests and
responses over TCP absolutely comes at a
cost and so if we imagine there was this
you know hypothetical perfect Great
Circle distance fiber optic cable from
San Francisco to Cape Town and we just
wanted to send a single bit one
direction that's still 79 milliseconds
and magnified over an entire web page
with requests and responses so we're
talking around trips now so round trip
double that it becomes very very
noticeable to people that are using web
applications in that cost of setting up
a TCP
connection the cost of actually you know
creating that connection from point A to
point B absolutely comes at a cost
that's explicit is due to this latency
and so the idea behind hp2 is that we
can now use that TCP connection in a
much smarter way because the binary
frames can now be interweaved and
getting multiple streams in the same
connection that by the way don't block
each other it means that using a single
TCP connection you can send many
different messages including the message
data and responses back and forth which
ends up being really really huge because
HP 1.1 is kind of built with that
assumption that you know what we've got
to absolutely minimize the total number
of connections so this entire class of
web performance hacks or best practices
to reduce the number of TCP connections
on a web page they kind of get thrown
out the window in a hypothetical world
where everything is HB to CSS
concatenation JavaScript concatenation
in lighting assets kind of like you know
we've seen this where people like
injects the base64 of an image into the
HTML source so you can reduce a request
or you bundle a mass amount of
JavaScript files like the Giants you
know to megabyte application j/s or
application dot CSS that doesn't become
necessary anymore because all of those
requests to the same host that it
requests those assets now can be very
intelligently used over the state that
over the same TCP connection without
blocking a same thing for domain
sharding which is a hack that's just
dealt with spreading requests to assets
over many subdomains to kind of get
around a browser limit to the number of
open tcp connections per host but that's
a huge opportunity for web developers
because in this world where we can
unbundle these giant bundled assets
whether its image spriting CSS or
javascript it allows you to cash in in
the you know hypothetical best case
scenario many different small pieces of
your application so when visitors return
to the sites and they want to get you
know some you know the version of jQuery
you've been using for two years they'll
already have it in the cache and if you
change one bite of JavaScript it doesn't
invalidate the entire
patient yes so it allows for much
smaller pieces of the application to be
cashed in a more intelligent way which
which has some really great implications
the second thing which I don't go into
is kind of it reduces the operational
bird burden I don't know how many people
have seen you know the thousand line
grunt file that you know combines in
concatenates and minified javascript
source it's hypothetically reduces the
operational complexity of putting assets
and web pages you just you know throw
some more script tags and in the
protocol layer will handle that in a
much better way if we've unbundled and I
think Khan Academy engineering had a
great post on this it does have one
downside and that's the compression in
compression performance will be impacted
so using Z lib it's much more efficient
to compress one single giant JavaScript
or CSS file and that same file broken up
and do 100 different bits so as you're
as you one bundle and as you're
measuring the total page size you've
really got to watch out for that and
make sure that's you know your total
page request size isn't drastically
impacted as it was with Kahn Academy a
last cool new feature before I go into
some security stuff is header
compression this was a massive feature
that was lacking in HP 1.1 but as we've
added more cookies security headers and
everything else in HP to those headers
can now be compressed and the standard
HP pack is part of the part of the
standard it says itself so implication
there is all of that header data now
compressed less fights over the wire
your total you know your total page size
the number request to build it gets
reduced so really cool stuff there as I
said before one really important thing
and one thing that I think is going to
be a challenge for people implementing
this they don't already have HBS is that
it's absolutely required and that's
great you know we want to build a more
secure web you know different thought
leaders are saying you know hvs should
be on by default that's all great but it
actually has another technical reason
behind it and that's that the TLS has an
extension called a LPN in a LPN is
again another very clever hack or not
hack I shouldn't say hack another clever
clever protocol extension to allow the
climb the server to determine what
application protocol to speak without
additional round trips so when that TLS
connection is established between a
client and their server and you can
actually do this on the command line
using openssl sorry won't work on a Mac
you need to use Linux or upgrade your
openssl client version we can actually
query a can query the client with this
next proto neg option no no other just
empty quotes and I'll actually say what
protocols are advertised by the server
and that's huge because when the client
makes the connection of the server they
can determine whether to tell and speedy
the HTTP HTTP to predecessor a street
1.1 or the new stuff with HB 2 so the
TLS required option has some really
important performance benefits and
that's why a lot of browser vendors have
gone with that in addition to yes we do
want to make the web a more secure place
if you're kind of worried about the
certificate costs and you know the the
pain and process of getting a new TLS
certificate some quick free advice let's
encrypt org has is now in beta free ssl
certificates very great and they've
really done a great job of making that
process of getting a certificate and
adding it to your server software is
straightforward as possible I think it's
a great thing for the web one thing if
you're a business you'll probably end up
wanting to pay although nothing's really
stopping you from using lots encrypts
but so one option worth considering when
getting a certificate for your business
site if it doesn't have HTS is whether
you want to go with an extended
validation certificate an eb certificate
and that's also just known as that giant
green bar when you go to a banking
website that says front and center
here's my business name not not
discussed here but still really cool
could be entirely separate talks streams
server-side push the ability of servers
to send data to clients before the
client requests it extremely cool very
cutting edge people argistix now
experiment with it request
prioritization I kind of discussed but
the idea that you can
or ties some assets in some requests
before others very interesting still
very early and then you know we've
talked about frame types with their
overt in there are 10 different hb2
frame types include like ping and reset
window update those are all very
interesting but kind of beyond the scope
of this introductory talk if you're
interested in more there's a great kind
of article introduction by the creator
of curl which I recommend so if that
like if that hasn't terrified you at
this point I want to talk about just
very practical debugging let's say you
want to roll this out on your
development server your staging server
you know make your blog speak hb2 you're
pretty much going to end up needing to
use wireshark at this point until tool
tools like Charles and other debugging
proxies catch up but it's really not
that bad it's just a lot of steps to get
it to decrypt the traffic because as we
said before it's all over H vs step one
is for Chrome and Firefox you've got to
set this environment variable called SSS
key log you know you give it a log file
name and link to the tutorial and that's
going to capture the RSA premaster keys
which I'm not entirely sure what that is
but anyway it puts the information you'd
in a log file and then in wireshark you
open up settings you say hey Wireshark
here's my secret that you need to
decrypt the traffic so I can actually
see what's going on you plop it in there
you click ok and then you start
capturing and since it's all over HBS
that's port 443 you set it up to point
at point 4 43 you choose your network
interface card and you might have tried
a couple of times but eventually you'll
see all of the individual binary frames
which is actually kind of cool and I
know it's hard to read but you actually
see all of the different levels you have
to drill down to actually see the data
so in this case i'm looking at a header
frame which is just header data
associated with the message first of all
it's encrypted second of all it's
compressed and if you decrypt it
decompress it then you actually see the
text which is just your standard headers
which you recognize from just normal
stuff so a lot of steps interface kind
of rough around the edges but it is
possible to kind of get down to that
level I will suggest one simpler option
and that's just to use Chrome
unfortunately it's harder to understand
than the Wireshark interface which is
which is interesting but if you go to
Chrome net internals there's an HP two
option and Rebecca Murphy has created a
really cool NPM package that actually
can visualize that data by by default
it's it's just one giant text blob but
there is a visualizer and I think we're
going to see lots more you know higher
level and easier use tools going forward
so that brings up kind of the elephant
in the room great HPQ is cool it makes
my site faster probably well what do I
do about all of the people on the old
versions of ie or Firefox or are people
using you know old Android browsers and
that brings up really really difficult
questions you can either just spilled
only for HP 2 and H 31.1 clients old be
penalized if you optimize for HP to you
creates two versions of the site so one
for each client which is a massive
operational undertaking not not only in
how you build your site or you wait for
broader support I think these are the
three things that keep coming up when
when discussing like kind of practical
implementations if that hasn't dis way
to view the real question is well you
know how did how do you eat this HTTP to
performance candy most major servers and
their latest versions supported apache
engine X IAS in the 2016 tech preview
Heroku not yet Google App Engine not
surprisingly from google does support it
amazon s3 not yet either and if you're
kind of shaking your head like you know
it'll take two years upgrade my apache
or nginx or is instance there's a really
compelling CDN option and that's the you
know CD ins and different providers
supports and different ways can
potentially just talked to HP to two
browsers that support it and in the
connection between your CDN and your
origin servers is just in HTTP 1.1 so
potentially a very fast way to get
started especially you know if for stuff
served over a CDN you're seeing more and
more support and a lot of CD and
providers are kind of leading advocate
see in this area that leaves us with you
know where is it today you know how fast
is this being adopted is this you know
the new you know windows in me or
something well it's not nearly as
popular as etag compression but you can
see in this graph it is getting used in
very high traffic sites google and
twitter and wordpress and CloudFlare has
basically turned it on so you're seeing
increased adoption in traffic sites and
also in the number of sites and
hopefully depending on how its received
by developers and implementers will see
it's move up into the right you know
that that said i just want to end on a
note that's you know if you look at all
your users of whatever application
you're building even if that
applications all developers people
ultimately really don't care what
protocol you're using they just want it
to work and it to be fast and i think in
a lot of cases hp2 is a way to improve
customer experience and to to make
things faster and kind of push the web
forward especially as it becomes a more
global and there are more mobile devices
and latency kind of becomes more of an
issue but ultimately you know do these
decisions should never be made you know
because HP to is shiny or it's faster
it's like you know is this actually
going to help people who are using my
site and make it faster and better and
you know on that note thanks thanks very
much and you know end with a pun it
should be too sweet and i'll have my
slides posted very very shortly there's
also a blog post that goes in a little
more detail at bit ly HTV to candy
thanks very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>