<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Single Page Web Applications: JavaScript End-to-End (The Hard Stuff) | Coder Coacher - Coaching Coders</title><meta content="Single Page Web Applications: JavaScript End-to-End (The Hard Stuff) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Single Page Web Applications: JavaScript End-to-End (The Hard Stuff)</b></h2><h5 class="post__date">2013-01-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OrIFaWJ9Glo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Michael Makowski I'm the UI
architect for a company called snap
logic as my shirt might hint to you and
this is a Josh Powell that's with two
L's Josh and I've written a book called
single page web applications JavaScript
end to end we both gave a presentation
yesterday but it appears to have been a
popular presentation given the fact that
we were about one and a half times our
room capacity both of us and also
Michael Jackson cancelled today which
came as a shock to not too many people
apparently I probably told you that six
months ago but so we were asked to
present here in a larger room and so
what we've done is we've blended things
together so I'd like to do is introduce
you to or welcome to an evening at the
improv as we meld our two presentations
together and try to bring the best of
both alright we're going to try to give
you both a little bit of a higher
overview of what an SP a really is and
what its pros and cons are and we're
also going to try to do a little deeper
dive and some of the harder stuff that I
wasn't able to get to yesterday in the
presentation so without further ado I'm
going to break into reading off my
slides alright so yeah alright so slide
number one we're talking about key
JavaScript techniques for successful
large-scale applications I gave a nice
little speech about growing up and I'm
not going to bore people who happen to
be at my presentation yes Jay again but
the crux the punchline was
is when you're younger you can do stuff
and get away with it
when you're older and more mature and a
more complex individual certain rules
about society that no long that
previously didn't apply to you now apply
and such as the case with JavaScript if
you're doing flashing purple monkeys on
the page who cares if you're using a
global variable however if you're doing
an inventory satisfaction system and
your front-end is running with a hundred
thousand lines of JavaScript you're
probably going to need to use a little
more discipline and a convention to be
able to work on such a large project
with multiple developers okay so we're
going to talk about my favorite subject
for a moment that'd be me
as mentioned I'm a co-author of the
single page web applications from end to
end this is currently in MEAP I'm not
going to give you the hard sell you into
it buy it
okay please daddy needs a new car
alright um the and I've already
mentioned I'm a architect at snap logic
a lot of fun there by the way really
excited about our next generation
product which I can't show you this is
actually my fifth a single page
application large-scale commercial
single page application and I was the
architect on four out of the five it was
the primary developer on the fifth the
only problem there is the guy was the
primary architect on that was brighter
than I was so he got the job and as much
as that pains me to say it he was a
brilliant guy still is actually and
prior to stumbling into single page
application development I was actually a
back-end guy had a couple hundred
servers that was responsible for for an
advertising platform on a couple
different continents and we did about
two billion requests per day what
transactions as you might have guessed
it was a
online advertising and just one day had
a task that nobody else seemed to be
able to do and it ended up being a
single page web application and I've
been doing them ever since also a great
experience coming from that environment
into single page web applications
because in that environment where we use
mod Perl to Perl if anybody's ever
worked in Perl here you know that the
structure of your program comes from
convention not from the code itself java
scripts very similar to that and we'll
talk about my first sba in fact I'll
show you an example of it in a little
bit so with that I'm going to hand the
microphone over to Josh and he's going
to talk about his favorite subject yeah
I'm co-author on the book my blog is on
Jay s joshing com I've been doing web
development for 13 years and I love sass
and hate CoffeeScript all right way to
hit the points Josh all right so let's
talk about the parts we're going to
cover today first of all we're going to
look at some example single page web
applications
second of all josh is going to take over
and he is going to talk about the pros
and cons of single page web applications
and kind of what makes one of on a
philosophical higher plane way and then
we're going to look at some key
JavaScript concepts that we found both
working together and then over the years
that are really necessary to know to be
successful with a large-scale
application the fourth part is where you
try to ask questions and we run out of
the room as fast as possible okay that's
the evasive actions that being said
let's talk about some example single
page applications I'm going to show you
today the first one that I wrote back in
2007 which was for AMD's where to buy
site by AMD I mean the people that make
chips and like the sledgehammer AMD 64
those guys second one will show you is
one that I worked with was not the
architect actually but primary developer
four-game crush which is quite a nice
commercial site with a little bit of the
not-quite NSFW edge to it and then we're
going to also go over an exercise that
we have in the book so I'm going to go
over these relatively quickly because we
want to get to some of the the meat that
Josh referred to earlier all right so
the first one we're going to look at is
the AMD where to buy site this was
actually run off of two old amd64
servers that we dug out on the backroom
it was actually run in a total of eight
different countries eventually and we
handled in each one of these tabs here
in some cases on the order of 1500
products at its peak so what I've done
was dug up one of the pages and just
shows you I'm just going to show you
what mmm what magic we had wrought back
in late 2006 early 2007 this is actually
pretty unheard of at the time anybody
here use Newegg besides me there we go
there you go alright so I've got stock a
new egg I'm kidding but I do and one of
my favorite features of it is power
search we can go in and pick all the
attributes you want of this product you
specify it down to like the screen size
and everything and then you press go and
it comes back and says no results found
after chugging away for 20 seconds right
and then you do to do that five or six
different times finding no results until
that seventh time and now that you've
spent five ten minutes doing this the
seventh time you do it you come back
with five hundred results alright
so none of the world's best UX one thing
that I was really proud of with this was
that you could actually click about ten
times in the amount of time that the
previous site
for one round-trip we downloaded the
entire database gzipped this is before
Douglas Crockford came up with the name
Jason I believe in 2007 I'm sorry he
invented it and I was just passing
native JavaScript data structures in and
the actual database for our largest
product group of 1500 came in at about
250 kilobytes compressed in gzipped so
pretty impressive and our the people
that ordered this at AMD were really
happy with that so I was good it come
nice to go back into the Wayback Machine
all right so I'm going to go now to the
a little bit more risque site which is
the game crush and I just want to show
you a little bit of evolution here so
let's go and look at Maeve one of my
favorites apparently this is kind of a
cross between a gaming site and a dating
site what I'm going to do here is it
just pull up a couple of the images that
Maeve has on site and what I want you to
take a look at is notice that on the
right hand side I've got comments that
are being loaded and on the left hand
side I have Maeve I'm focusing on Maeve
right now but the thing that you'll
notice is that as I move forward on
these pictures here the only thing that
updates even though I have multiple
layers on the screen here is the image
of Maeve the only thing that changes is
what needs to change
there's no time wasted on re-rendering
the entire page now imagine that you're
looking at this in the web 2.0 page
right it would lit it would re render
everything this by the way folks is
becoming fast unacceptable right not
what I'm showing you the other way right
I mean I am I just I'm losing all
patience with sites now where when I go
from one page to the next I've got to
wait 15 seconds for all the ads to
re-render right compare that again to
here where you
a forward button or a backward button
and it instantaneously responds and only
the parts that need to change change now
check this out
I'm going to hit the back button a
couple of times and we can see exactly
where I came from or I can hit the
forward button now somebody asked me
yesterday how do you do that my answer
was by the book it's a little bit
complicated and we really don't have
time to go over that but I'm actually
quite proud of that and there's a very
overriding
a technique that you can employ that
will always work for history support
alright now the last one we're going to
take a look at today is an actual
example and this is running nodejs in
the background I'm going to just restart
node right now okay so you'll see here
is an example chat now of course we chat
isn't just limited to instant messaging
but it's probably the most accessible
example of it so let's let's load up
Alfred orell fred is the case maybe I'll
notice that elf Reds online all by
himself we're now going to join in with
oh let's see Barry Barry's named oddly
but notice the Barry instantly shows up
on the user list here of course we've
all seen socket IO examples so we're not
going to worry about too much detail and
now I'm going to sign in again here and
uh-oh what's a good name anyone anyone
what's that Maeve oh yeah I know what
your mind is that sir
okay how do we spell Maeve here ma e ve
isn't even the audience apparently there
we go Maeve
you she's not here in person she's here
in spirit Thank You Maeve okay
notice when I added that that on the
other two windows that those immediately
responded and you'll also notice that as
Maeve here that before I logged in I
wasn't able to actually open the chat
windows but now I am able to open the
chat windows also you'll notice that
there is no refreshing of the page in a
web 2.0 thing if I was going to put this
profound message and share it with
others and then press the Return button
or click on send here what would happen
is that it would of course reload the
entire page but in this case of course
only the changes that are coming across
in this case over a soccer connection I
want to say one more thing about psychic
connections I expect a lot of
communication you currently do over HTTP
and Ajax to go over socket connections
at least the lightweight messages you
know think about a chess game right when
you're when you move a piece the other
client only needs to know that you move
the piece it doesn't need 1200 bytes of
header information to go via and Ajax
through a server right it only needs the
eight byte header associated with the
web connection of the psychic connection
and then the few bytes that indicate
what your move was so you can get your
chest piece move down to probably about
16 bytes versus twelve hundred and
sixteen bytes that you'd use with an
ajax call and that's quite compelling
all right so that those are some example
s pas now josh is going to talk to you
about the philosophy of what an SP a
really is and I think it does a bang-up
job so let's give a hand for the Josh
man all right
all right well what is an SP a what is a
single-page application all right thanks
well it's simply a website where the
page does not reload so if you look at
the traditional web application how it
works today the you know person will
come in make requests to the server
amazon.com and we get a button it Amazon
will you know do a river processing you
need to on the server and it'll return
an HTML page to the client which will
have a list of CSS JavaScript and images
that need to get loaded they may be
cached they may not be if they're not it
makes a whole bunch more request back to
the server which then responds with them
and who something happened all right
quickly go back there and then finally
the page gets loaded but then when you
click on any links or try to navigate do
anything purchase something you have to
do the whole round-trip all over again
and then you have to do it again on the
next one
so the big difference with s pas isn't
the first load the first load is pretty
much the same except that the the HTML
gets rendered on the client-side
but then after that all you do is make a
request for the data to the server the
server doesn't have to spend all of its
time processing HTML strings out of that
data it just quickly gets to the data
and returns it back to the client and
then the client takes it and it does
whatever it needs to do it just changing
the parts of the page that need to
change so what are the benefits of a
single page application the first
benefit is it doesn't feel like a flat
page things move around and are
interactive even today when you go out
and are surfing around the web it feels
very much when you go from page to page
like you're turning the page in a
magazine or newspaper I just refreshing
everything instead you get a more you
know
interactive page that can draw the users
in and you know makes them making things
for much better user experience the page
also loads a lot quickly because so much
is less is being loaded with each
request traditional whether it's a
single page web application yeah they're
reloaded all right another important
point is a single page application
distributes the load off of your servers
you know you've got these tens or
hundreds of thousands of dollars or
millions of dollars worth of servers
sitting around processing strings into
HTML and sending it over across the wire
well why not distribute that string
processing out to all the clients and
let the clients do that it results in a
much cheaper and much more quickly
scalable system another huge benefit of
single page applications it's especially
the kind of about lightening the book is
that you can use one language end-to-end
in your traditional application you on
the client side you've got JavaScript on
the server side you've got Ruby groovy
Python Java lists Perl ASP or something
else and then when working with the
database you have to work with sequel so
and then you've got all the libraries
and plugins and things associated with
each language you have different ways of
thinking associated which each stack you
know they're object-oriented static
strongly typed variables on the server
and you know your sequel on the backend
is they're very different mindsets to be
thinking in and then on the client side
you've got a dynamic loosely typed
language so you've got all these
different skills you have to master and
you end up quite often having to have
different people at different levels of
the system because there there's just so
much to learn or you have to get
somebody who's really skilled he's been
around for a long time who can program
in the entire stack in a single page
application with JavaScript end-to-end
JavaScript on the client JavaScript on
the server javascript in the database so
you don't have to switch context you
don't have to think in one and then
think in another way you just do the
same you think the same sort of process
is all along you
you know you use similar libraries and
plugins between the different systems
you can use the same IDE to work across
them it's just a much cleaner smoother
environment to work in so how do we get
JavaScript end-to-end in the stack we're
using jQuery on the client-side no js'
on the server and MongoDB for the
database you know for the client-side
there of course a whole host of other
frameworks and languages and things you
could use but in fact as long as you're
following a you know standard pattern
framework that you don't actually need
all these all these other libraries you
can do it just using jQuery well you can
just using JavaScript but I wouldn't
recommend that another benefit for
single page applications is you've got
one data format the same way you have
different mindsets when working with
different languages it's the same thing
take traditional Ruby on Rails
application in the front end you're
dealing with JSON format active record
and the server-side and sequel results
from the database so you spend a lot of
your time marshalling data from one data
structure to another imagine you have to
take the Jason transform it into active
record transform it into a sequel to
query the database take the results
transform them back to active record and
then print out jason with them send them
back over the over of the client that's
a lot of marshalling and work involved
in working with the stack now we have
stuff that abstracts us so this away
from us because it's so much of a pain
to work in but it's much better if you
can just use one format from end to end
where you don't have to do all this
marshalling from data you don't have to
have the abstractions you can just take
the data right out of the database pass
it to the server which speaks it
natively and then pass it back into the
UI which is the way it's used so it's
much better to be able to store the data
in the exact format you're going to be
using it in so benefits of an SP a you
dynamic and interactive sites no more
flat two-dimensional pages it loads
quickly because you only update parts of
the page
that need to be updated you distribute
server load onto the client machines
making it a cheaper more scalable
solution you get one language end-to-end
JavaScript and one day of data format
end to end Jason but everything's not
bright and shiny with s pas there are
some pitfalls so some of the pitfalls
are that you can easily break the bat
but back button so that when you section
of the page you expected to be able to
revisit your new press back you could
break out and go to the last site you
are on I think we've all ran into that
in you know flash sites where you can
only link to the front page of the
application and then if you go in and
dig around you can't send links and out
to that Mike demonstrated how how that
worked you must make it Google able
because Google spiders don't execute
JavaScript you're moving lots of code to
the client and things can get messy
because you're suddenly have a hundred
thousand lines of code in JavaScript
which was initially intended as a
scripting language I analytics require
work because you just can't take Google
Analytics and paste the snippet on every
page and call it done and there's a no
sense of what errors are happening on
connected clients because when you're
using a traditional application you've
got your server log which takes all the
errors that are happening and just dumps
them out to the log
whereas now your clients are off using
the site and you have no idea what
errors they're encountering so the
bright side is that all these pitfalls
are solvable and they're all solvable
and though we go over them all in the
book on how to solve them if your my
presentation on yesterday then you I
went through the list of how how it
works but look we'll go over some of
them at the end today after his time you
know we got asked to do this last night
about 6 o'clock in the evening I think
maybe 6:30 so you know excuse the improv
aspect of this
all right so powering things back up
we're going to talk about solving some
of those problems we talked about
earlier I do want to bring mob back up
because she seems to have a fan set here
mmm one thing I do want to show actually
the interesting about this is that as
you notice when I clicked one button
here the only thing that changed was the
image and the comments now what happens
if I take this URL copy it paste it into
a new tab like this any guess and what's
going to happen pretty cool huh the
error message is about the XMPP chat
which wouldn't happen if we were using a
but the bottom line is the entire state
is held there even though now when I
move here I'm again only changing what's
changed so there's a way of delegating
things that allow you to do that okay so
back to that presentation we had running
oh here we go the presentation is
running there we go so if you don't like
single page applications there are other
options so I thought I'd bring those up
here for you here's one you can always
pick if you'd like another one is real
popular these days
Mobile flex and of course what we're
talking about today so let's review a
few points that we brought up already
but this is building to something bigger
as we mentioned with a single page web
application most of the application
moves to the client your back-end is
basically your document store in your
authentication and user database pretty
much everything else moves to the front
end that means you got a code at a lot
much larger scale than you used to on
the front end
if you hit a hundred thousand lines on
in JavaScript you're not alone there's a
lot of sites nowadays that are hitting
that amount or even greater and also
since most of your applications moving
to the front end instead of you having
instead of having one front-end
developer or maybe two and eight
back-end developers you're having one or
two back-end developers and eight
front-end developers that means that all
the convention and discipline that you
previously used on the back end now
actually becomes important on the front
end and actually you can be a little
more loosey-goosey on the server side
now because you know one or two people
can maintain it so what we're going to
talk about now the key concepts that we
found that you really need to understand
to make a successful large-scale single
page application alright and we've got
about 20 minutes to do it
so first of all we're going to talk
about architecture then we're going to
talk about data types and names scope
chains hoisting prototype-based objects
as opposed to class-based some forms of
closures and execution context by the
way if you want to fall asleep do so now
because I'm going to wake your ass up
when execution context comes around
because I because I respect you as an
individual and I think you need to
understand this okay
execution context is one of those hard
things that when you buy a JavaScript
book they always jump over they're like
you know really we should cover this
because it's kind of fundamental of how
JavaScript works but gosh it's kind of
hard to explain so we'll skip over it
all right I've given this presentation
to people who've coded in JavaScript for
two years and one execution object what
right it's amazing how many people are
coding in JavaScript and don't
understand that and it's really
important that you do if you don't go
back to sleep and we'll talk about the
module pattern which kind of pulls
everything together
first of all architecture this is taped
on the wall by my desk and on my
co-workers desk and at the vice
president's desks as well if you're not
careful on a large-scale s.p.a and you
just all just start coding on features
and stuff you're going to find spaghetti
really fast and various other Italian
foods what happens here with this
architecture and this is in the book and
detailed you see where all those red
arrows just kind of descended from the
heavens
there's boilerplate for all of those not
only that this has API calls going in
one direction in data flow going in the
other and so we take great pains to make
sure that we have isolation between
models and between feature
modules so like if you take a look from
the on the far right hand side you see a
user there is not just any normal user
he's a happy user you can tell by the
expression on his face and on the left
we basically have our data source in the
web server in between we have various
modules there's a data layer that exists
that data layer knows nothing about any
of the modules above it in other words
we don't allow it to make any API calls
to any of the modules that come after it
whereas all modules that come after it
may call it and that sort of convention
helps provide a level of isolation that
allows us to have multiple developers
work on multiple modules at one time
because we have an API contract between
our modules I'm not going to go any
further into it because I take up the
rest of the hour but certainly something
you want to think about before you dive
in with your team of eight another point
that we like to do is to name our
variables according to the scope that
they're used in generally we use
underscores for variables that are local
and then if they're of a module scope
we'll use camel click case yeah I know
this is real trivial stuff guys but I'll
tell you what anything you can do to
reduce the cognitive overhead you have
to deal with reading code is is very
useful to redirect and do some sort of
productive activity as opposed to
wasting your time solving a riddle also
when you're doing a single page web
application you should be creating one
global variable
and that's it alright if you're creating
more than one global variable when
you're creating your single page web
application you're doing it wrong okay
also let's talk about variable types
well we all know that javascript is
design dynamically typed or loosely
typed language and we should have no
concern about datatypes it's funny that
I should mention that though because
apparently the people who just released
typescript feel that type is kind of
important also the people who recently
released the closure compiler are
actually quite a while ago actually have
a way of indicating type in comments in
the closure compiler GWT exists arguably
largely because people who are using it
prefer to have a strongly typed language
versus the loose or dynamically typed
JavaScript and finally dirt also
provides a way of indicating type in
JavaScript so if you don't think types
important in JavaScript you go ahead and
continue to feel that way although I
encourage you to go and add a subscript
one-point-five to an array and see what
happens
it's interesting the bottom line is most
variables you'll ever create in
JavaScript never change type and
oftentimes those that do are by mistake
also another thought to keep in mind is
polymorphic interfaces are a really cool
CS trick but the rarely a good idea in
practice now I say really there are
cases where they make a lot of sense but
let me give you a for instance if you're
writing a function that returns a string
return a string all these don't we turn
null for a special value and return
false in a different case or true in a
different case I mean that's really
clever folks but if you're going to
indicate an exceptional situation throw
an
option that's why God invented
exceptions all right so what we do on
large projects is we name our variables
to indicate type and if you don't know
the type or the type changes we call it
data now you don't have to follow this
you can make up your own notation at one
point I used a Hungarian notation which
the Hungarians loved but English
speakers don't this is less precise but
it reads a lot better in English and I
highly encourage you to indicate the
type in your names of course you can
always go back and use closure compiler
or dart or typescript or whatever but I
found in large projects this really
reduces cognitive overhead it also
indicates intent so if you end up with a
file with a name that indicates it's
supposed to be a string and you find a
boolean you know well Oh somebody
screwed up somewhere okay let's talk
about variable scope a little bit scope
in JavaScript as most of us probably
already know is functional in other
words if you want to scope something put
it in a function in this example here
you're seeing this free man text which
is declared at the top level or global
scope and when we log it its value is
presented
however this prisoner text does not
escape outside of this function and
therefore when you try to log it down
here it shows up is not declared you'll
actually get an error
now one problem with JavaScript which by
the way is solves by the use of the word
or the use strict pragma but we won't
get into that but it's very easy to
create global and available as
unintentionally and here we illustrate
that where I'm using a variable I within
a function
I forget to declare it and therefore it
becomes a global whereas in the second
example that does not happen you need to
recognize in JavaScript even though you
can declare and assign things at one
time
inside of JavaScript it's actually two
different steps declaration always
happens at the top of a function and
assignment happens at runtime as
necessary we recommend that you use a
single virus statement per functional
scope there's no need to have multiple
virus statements there's no performance
advantage to it at all all your
variables that you declare with in a
functional scope will be declared by
JavaScript immediately on invocation of
that function so if you think hey I'm
going to hold off on declaring these 25
variables to the bottom to save time
you're not we recommend that you place
one assignment per line although you may
use multiple declarations per line and
we always prefer to declare first an
assign later because that mimics the
JavaScript actual implementation
JavaScript first declares and then
assigns and as I mentioned before and
we'll talk about a little bit further
combining the two can actually cause
confusion will we will illustrate that
all right let me talk about scope chains
this example here I'm going to zip
through really quick notice that we have
this variable called free mean text that
is set
the top-level here in the window context
so I've indicated the context next to
each one of these logs or assignments
and you'll see there are always using
the window context or global context so
it's always coming out with the same
value now here's where things get a
little bit tricky and you got to
remember about scope chains seeing the
first declaration here I've declared
free man text in the window scope in the
second declaration which is in this
visit Supermax function I guess I have a
point I might as well use that hair huh
this is assigned in the window visit
Supermax scope okay so notice the scope
starts piling up as I start going deeper
into functions now here I've declared a
the same name variable in a window dot
visit Supermax dot visit prison scope
okay so when I log it here
that's where scope chain comes into play
JavaScript says hey within my current
scope do I have a variable named free
man text in this case it does and it's
only declared since it's only declared
it gets the default value of undefined
so when you log this you will see
undefined here down a little later here
where my cursor is we have this it's
also logging yet but it's logging it
within the window dot visit Supermax
scope again JavaScript looks in that
scope and says do I have a variable with
that name within the scope chain and the
truth is you do it's up here so it then
provides that value
in this case it's going to log a sign
and then finally at the end here when we
call the log we're back in the global
scope and so it finds the value in that
global scope chain so we don't have
local versus global we have local versus
more local versus more local right now
let's talk about hoisting in this case
we're showing how variables are always
the Declaration of variables always
hoisted to the top of functional scope
so in this example in most languages if
you were to encounter this council log
prisoner texts you would expect an error
because prisoner text has not been
defined yet but in this example and as I
mentioned earlier with JavaScript
since all declarations are hoisted to
the top of the function this prisoner
text variable is defined well as is
declared and it has a value of undefined
so in the first log it will show up is
undefined in the second log the
Declaration which is ordered dependant
comes into play and the declared
variable is shown
okay so now let's take a look at this
free man text here which is in the
window scope and it is assigned it's
defined and assigned when the value is
logged nothing really unusual here
basically I'm using a global variable
within this function that's all kosher
but look what happens here all the same
code the only difference is that we do
this declaration below this log and if
you paid attention in the last example
or you're just a smart cookie or you
knew this before you came in here you'll
know that this declaration gets hoisted
to the top of the internal function and
so therefore the declaration by default
assigns undeclared to the variable so
this council log is not going to provide
us with free man Texas as assigned no
it's going to give us undefined because
the visit prison inner function looks in
its scope chain to find free man text it
finds the local a local copy of that
variable and uses that okay a lot of
people get burned by this one so bottom
line guys put your declarations of all
variables at the top of your functions
and you won't be thrown for a loop let's
see what cut time I got here alright we
got a few minutes
we go to 310 right okay I'm going to hop
over the the object construction for a
little bit and if we get some luck we'll
come back to that because we're running
a little short on time here I want to
talk about that one thing I don't want
you to sleep through which is the
execution object although if you know
you want to come and talk about objects
I'm certain Josh would love to speak
with you about it okay so let's talk
about the execution context object this
is the thing that most JavaScript books
or online guides seem to skip over
because it's just plain too hard to
explain however it's kind of the kernel
of how JavaScript works right the key to
remember is that when JavaScript is
executed every time you run a function
javascript constructs an execution
context object all right let me rephrase
that every time you call a function and
execution context object is created and
by creating closures over the execution
context object is the whole basis of how
we create objects inside of JavaScript
oops
so let's look at an example now what I'm
going to show you isn't necessarily
absolutely correct but conceptually if
you think of execution this way you're
going to do good alright so on the left
hand side we have some code that's
running on the right hand side we have
this concept of an execution object or
execution context object so on the right
hand side we have a invocation of a
function on the right hand side we
showed the object which is empty at this
point when it's run the values for the
execution context object of the
arguments are placed in to the the
object and then this is a to pass
process on the first pass all these
local variables I'm pointing at my
screen here and I realize that you don't
see my finger so I'm going to try to use
the cursor here
all the variables are assigned I'm sorry
now to assign all the variables are
declared not assigned so you see that
here in the execution object and then
inner functions then I'll recursively
added to the execution object in a
similar fashion on the one of the code
on the second pass these as we go
through the code and variables are
assigned the execution context then
actually gets the assignment ok you have
anything to add here Josh yeah let's try
and say that succinctly here
what what this means is that the the way
variable hoisting works quite often
don't hear it described we say what the
result of it is is that the variables
get hoisted to the top and the way that
waisting works is the JavaScript engine
runs over each function twice the first
time it runs over the code it declares
all the variables then it runs over it
again
and it actually assigns all the
variables so it's not magic that gets
the variables hoisted at the top because
it runs over the code twice I knew I was
missing something thanks Josh so let's
take a look at that kind of an action
with the with the closures here
hopefully the execution object is not
accessible in JavaScript it's something
that happens in the background so you
can't actually get access to and log it
or see it but it's there trust me well
actually that's the again that's the if
you recognize that that's there what I'm
going to talk about right now is the
closure closures in how those actually
keep references to the execution context
object so in the case that we're seeing
in front of us here it's a little bit
dense but like my cousin Lenny but you
see here that we have an inner function
that's that is returned okay and so when
I do this log message and I create this
function and provide this argument
called yeah I am assigning back to log
message effectively pointers that point
to the execution object so from that
point forward whenever I run this log
message function it's always going to
log yeah I can call kuri log message a
number of additional times with
different values but my original a
function that was returned is always
going to have the closure over the that
yeah word there yeah sorry about this
in the second example I'm calling this
without assigning the function to
anything I'm just providing a string and
then I'm providing an execution set of
parentheses and so what happens is that
what will be logged is bob newhart rules
for all those fans out of the audience
but there is no variable that captures
the return and therefore there is no
closure the execution context reference
count goes to zero and it can be garbage
collected look at that again again using
our log function we have a function
called log we're creating a function
called log hello
then notice I do a copy of that called
log copy and then I have a staying alive
function again using the career log
message so you can see if I if I run log
hello I'll get hello if I run the copy
of it I'll see hello again down below
here I'm deleting these functions I
delete the log copy and I delete one
reference to the execution context
object but there's still one remaining
it's only when I delete the second and
final remaining reference to the
execution context that it becomes
available to delete this is kind of a
contrived example but you actually see
this in real life you need to be real
careful about cleaning up all your
references to objects or you will get
memory leaks and if you don't believe me
go ahead and use ie6 for a little while
and do some JavaScript attributes on a
Dom object so a couple deep thoughts
about closures it's very easy to create
deep closures this is one reason why as
a general rule you should try to avoid
nesting functions as much as possible if
you think about it a lot of you a lot of
your nested functions you don't
need to nest closure is very good when
you want it
think object inheritance and it's very
bad when you don't the aforementioned
memory leak there are rules like the one
I just mentioned and to help avoid
unintended closures like don't declare a
function in a loop and the final point
which I mentioned before is that the
execution context objects are always
maintained until you get that reference
count to zero so think of an execution
object like a file system and we are now
over time by a whole minute and so I
think it's time to draw the presentation
to a close so stick around okay well I
guess I'll stick around to the next
presenter shows up so it's great I'm
coming up here so if you want to stick
around I'll finish the presentation
we've only have a couple more slides
left all right
hmm I want to talk about self executing
anonymous functions
we mentioned before that javascript does
not offer block scope that's not
actually a hundred percent true
it's practically true if you use
JavaScript 1.7 plus for Mozilla there
are constructions that you can use now
to actually provide block scope but in
practice I found it not very useful
instead what you'll see a lot of is the
concept of an anonymous or
self-executing anonymous function which
by the way if you're doing an interview
for a JavaScript position did these days
you almost will always be asked this by
everybody the interview with so in this
example we're declaring a function like
normal however at the end we're putting
parentheses with an optional set of
arguments in that and what happens with
that is that the function then executes
immediately using the arguments that you
provided in the parentheses at the end
like here I'm showing you the classical
jQuery turkey sandwich implementation
where jQuery is actually what we're
passing in and then we're renaming it as
dollar sign inside this function and in
this example we have this variable
called warning message and notice now
that I have it inside of this functional
scope so when I log it here it says hear
me now and believe me later in the
greatest Saturday Night Live tradition
whereas down here that same variable
scope is not available I get the global
scope and I instead see tornado so the
way that we have local private variables
inside of JavaScript is to use the
self-executing anonymous function
and I mentioned the turkey sandwich
earlier so now we can take that
self-executing anonymous function and
use what we call a module pattern now
back in the early portion of the
presentation you may have remembered me
talking about you should only create one
global variable for your entire
application this is how we do it what we
can do is we can take a variable in this
case SP a and we can assign it to a
function as we've done here and and then
what we're able to do is through the use
of the return statement return all of
our public functions anything that's not
returned is a private function or
variable so for those of us who love the
aspect of private versus public in Java
the same as available via JavaScript
just through a little bit different
syntax and yeah maybe a little more
convoluted but so one more thing here is
a through the magic of closures these
private variables are still available to
all these public methods so when you
return this warned user and then execute
it it will still remember what these
private variables are so they're still
accessible you can create getters and
setters for them if you want to it's a
very useful pattern sure
oh yeah yeah you can do it both ways but
the first the way that you've just
referred to is wrong now that they're
both correct
this one though is just pairing the the
the parentheses in a different way and
both of them work and this just happens
to be the one that we prefer and that we
use consistently throughout the book
okay if you look at our book or if you
look at the way that we name space we
actually create an object called SP a
and then we end up splitting it into
various namespaces and I'm actually
going to I'm going to break form here
since we've got a little bit of time for
the people that stayed a little bit
later I want to show it to you a little
bit in the actual application so I've
got this node application is running
here and let's take a look at public and
I'm going to increase the font size here
let's do a tree here and you'll see that
we actually have SP h @ SP a data SP a
model s PA - L if you remember anything
of that architecture diagram before you
notice these matches actually the names
in that architecture diagram and not by
accident if you take a look at SP AJ s
you'll see here that we declare SP a
first and it has some public functions
and then if I look at s ba da
we're just building off of that original
object what this allows us to do is
break our large project into functional
namespaces and define what those
functions are for each namespace which
improves the ability for us to split the
project up against multiple developers
significantly right so I can say this
shell is responsible for the shell of
the application for the general window
and you Bob are the guy who's going to
get to work on that and Frank I got this
SP a chat function it's going to have a
defined API back to the shell and you
Frank are responsible for doing that you
guys figure out the API and oh by the
way the benefit of doing this is that
when Frank finishes with this chat
function we want to use it on another
project it's really easy to do because
it's isolated and it's got two defined
API okay so so much for going off the
beaten track here let's get on let's get
on on the beaten track
um
yeah that keeps coming up because my
Wireless is trying to hook up even
though I have the wired connection so
some best practice pick only one
namespace for your app as I mentioned
before that should be your only global
variable subdivide as I just mentioned
let's say I have a division called model
which is a recommendation I've got
boilerplate for all this by the way but
let's say have a portion of a model that
requires some SVG handling well then you
can subdivide it you can say SP a model
dot SVG and let's say I've had a
component of the model that is specific
to users I can have s be a model users
okay also we recommend that you use
parallel namespaces for CSS and your
JavaScript files so if you've got
something called SP a shell j/s your CSS
classes that are controlled by that
module should be named SP a - shell -
blank you fill in the blank
the prefix is not optional okay now
you're not required to do that but it's
a very handy convention because we're
generating all of our HTML with our own
modules so why not name the classes
after the modules that control them and
use them and I have to say it one more
time by the book if you want more
because Daddy does need a new car you
haven't seen my car it's disgusting okay
so in grand summary these concepts that
we're talking about not all of them are
unique but we have found over many years
that they are all important for
successful large-scale single page
applications as we mentioned
understanding types scope chain and
hoisting help demystify the otherwise
odd seeming behavior
that you deal with with JavaScript
especially if you come from a different
language where you expect things to work
one way and certainly in JavaScript they
work another another thing to that I
think is very important to take away is
the execution context object is at the
heart of much of the head-scratching
behavior with JavaScript
remember that objects there remember
when you create an object that you are
creating a closure over the execution
object and things start making sense
that used to make me scratch my head a
number of years ago we didn't talk about
objects because we didn't have time but
prototype inheritance can be easy and
useful and fast and we will make this
presentation available so you can take a
look a little bit more about prototype
inheritance and again in summary the
self executing anonymous function
pattern replaces blocks and is the basis
for the module pattern and finally
closures are all about reference counts
it's very much like a UNIX file system
you know if you've ever been a UNIX
administrator you know that until that
last reference to the file goes away the
the file itself is actually not deleted
and that concludes thanks for staying
around guys that concludes the
presentation on on single page web
applications and thank you all for
staying longer giving me the love I need</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>