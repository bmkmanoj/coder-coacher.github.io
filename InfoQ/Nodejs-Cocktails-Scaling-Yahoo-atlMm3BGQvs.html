<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Node.js + Cocktails: Scaling Yahoo! | Coder Coacher - Coaching Coders</title><meta content="Node.js + Cocktails: Scaling Yahoo! - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Node.js + Cocktails: Scaling Yahoo!</b></h2><h5 class="post__date">2013-01-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/atlMm3BGQvs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hi everyone thank you for being here
after lunch I know it's hard probably
some of you when I'm to get living hope
I'll be hanging out so my name is Diego
I work yahoo and so Fontaine engineer
you can get it live from there sorry for
the blue link it's a BF 13 for that
she's my pie so first of all average
pain yeah we're doing bathroom qualities
but we won't put put so a little house
hunting everyone has to live in history
shows that's mine so we're going to talk
about today is how we at Yahoo how is
key I work at a church bathroom I know
we're not as big as to look but I'm
still have a bunch of hundred million
user to fulfill so more than the
performance today I'm going to talk
about how can you scale internship
software development because as you know
probably yeah yahoo has llamado kong has
new to yahoo com Mediacom immaterial
calm so the problem with that is that we
are such a huge level companies clearly
that we need to support a bunch of
browsers and we need to support a bunch
of devices and the problem we're having
right now we're having until a couple
months ago is that for scaling like
horizon
type of application testing oversee all
of that in a minute it was really
painful so the question is why I was
going to school today so we're going to
scale the whole process of development
which means that I'm going to see what
are the new technology we're going to
use for the first beginning on
implementing an application how it can
test it how we can share the code across
multiple teams and multiple apps and how
we're going to do in a really simple way
all this process helping us with the
tool with the cockpit framework with
mojito so it's not about just doing it
but it's doing it fast because as you
probably know the market is the border
between refashion if you don't do that
we're going to be more behind all the
others so far so that's what we have so
far yahoo is a peach tea stack reliable
but all technology so I understand that
bitch is bad it's just saying that right
now for us testing scale as well as
we're going to see in a while so the
problem we're having right now with PHP
are we have a bunch of Mexico half an
svn plenty of cold like for three or
four years old anymore I told you before
had a lot of vertical so I have news the
younger calm even younger calm and all
of the scene has to califica over and
over the same the same platform so I
woke on the platform thing which means
that we'll survive the architecture and
the tools for other things to be able to
do this fast and the problem is right
now they cannot do this fast we don't
have almost any unit tests in the reason
for that is because Roger AK and a team
china has to fork our svn and do
something and basically we cannot afford
to not limitation
and and also we shall test another thing
worth having is the problem went away HP
you want to fourth all the devices right
and say I want to pour iphone so what we
do right now is would have to create a
different entry point please be out of
the boss doesn't provide that the way to
say all right I just wanna support my
web based on the on an iphone so what I
have to do I have to play the new CSS
draw me some little logic for you know
some fancy speeches there so right now
the way we do it it doesn't kill and the
reason is because we're really slow we
cannot you cannot produce as many
features and are many things we will
want then also have an overhead on the
front end which means that PhD is not
the most amazing fastest server-side for
what we go yahoo and what we do the
application would have our back-end we
basically have all the logic or pads and
and basically tell us how how to display
information work displayed and what we
go on the front end is just take that
information and just we get a request we
go to the server because it respond back
and we just have to display so we need
to be a really fast on this week so
that's one of the main reasons the
overhead of fronting among the others
that we decide to go to this powerful
animation no yes right I probably know
most of you are aware of in oh yes is a
server-side JavaScript server on top of
v8 like Google great years ago so we use
not yes one of the reason is because you
have a lot of media that we have to
basically the users going to read out
running from and we need to be really
fast anything handle a lot of more
connections I can talk about perform
at the end the top but also for
fulfilled a prominent we saw before he
just not enough right so we need to
build something on top that allow us to
do what is deployment woody quickly to
multiple devices multiple markets and
multiple languages and so on so forth so
that's why we came out with cotton so
cultural scene a sentence to summarize
is like a plant an umbrella a platform
for development mobile applications
different little products that you know
one is in charge of doing the
presentation ladylike organ city for
mojito and another one is for the
deployment so it is a set of tools that
allow us to do all this development
cycle really really fast and we can
share called an integral part and I want
you can see how so the main piece is
mojito right so this is open source you
can just check it out and there's a lot
of little tools package manager and some
some ways that are specific but now for
Yahoo or have internally but I'm gonna
provide you if if those are no controls
I can provide you are simple and ran CN
similar way to do things basically
you're gonna see that everything I'm
going to talk today you're going to be
able to reproduce it in your company and
your price so let me just open source on
github feel free to fork it issue or do
anything with it is for you guys so how
many of you heard about money to before
i was taking less that's fine so how
many of you over learn heard about me do
before and about their be okay that's
fine so what I would my intention starts
not showing which are the differential
which put a frame or a better or not i
think i said well approach should be
pragmatic and be able to choose the tool
with more suitable for us so the purpose
of my talk is show us show you show you
guys mojito show how it works and may be
suitable for you for the obligation so
as a good espana i wanna do an analogy
with this how many do you know what is
this okay is better than mojito okay so
for the one that you don't know what it
is this is a jamon serrano ringing a
bell nothing so this accurate down and
usually finish me too many in Spain so
the analogy here will be a guy she do
know that just give it a try so I gotta
use the price I brought from Spain
illegally in my plane so her mom so you
guys after the toast please still want
some dessert there is some really fine
amount here I don't bring money into it
you know all right so why is mojito
mojito it's an NEC framework and this
negotiation ideas habit need some down
screams allow us to write the
application set right so what are the
key features a mojito first of all
because of the noise yes we have one
language to from the mall which means
that we can write JavaScript on the
server and the client which you guys
already know that right I'm not getting
anything new but if we can combine that
with another really amazing feature I
think it one of the most key features a
mojito is that we have to run down to
how the client-side and server-side and
the most amazing feature Momiji that we
can basically execute the same code in
the post places so mojito lancers us as
developers to decide on runtime whether
we want to run our code on the client on
the server let's say I have my server
saturated and I cannot handle more
connection can said you know what just
send it to decline in less
the decline handle everything for me or
I have a really low language and I wanna
I'm on an iphone lost everywhere
somewhere else and then it just want to
ship everything with a client because I
know that the connection is going to be
really reliable so basically the point
is that we can share a code I'm going to
see how and all the original except
behind line in a while and a damn one
after / another key feature is how easy
is to create let's see an entry point or
create our ad to make it fulfilled or
working and all the devices so with
mojito out of the pods who have a really
really simple way to do that this drop
in a file or dropping up you somewhere
and everything will work I'm gonna see
also have and another good thing is how
we can handle and create our app for
multiple localization and multiple
languages because example ask Yahoo we
need that is a key feature Brad we need
to serve the same content or around the
globe in different languages so that's
more or less clear let me splain work so
this cocktail Simone veto the mojito
said came for an ailing of intermixing
on the client have this kind of wicked
which is kind of funny crawley your kind
of element to this kind of interactive
right but on the server side half kind
of this model which is kind of an API
isolated bar where we can just call to
create some couch knowledge right so I'm
Molly the mojito we kind of merged both
things together science is so thick on a
mile or so self-contained isolated part
of the credit to give you an example
this is the new search page right so as
you can see on the club will have this
search box which can be I can show you
real quick showing up here Yahoo Yahoo
verticals what we call so for example
here we have to scroll you all right so
we have the search box on the top and
also if we go to oh my god have sales
call you same score a search box are
insane I think so what won't be amazing
we could share across the company all
this component that most like
are going to be the same right so that's
what a mullet most likely is right so
I'm Molly it's a little part isolated
part of the page which is self-contained
if you saw more of you controller Hassan
has a status on all his logic on its own
so it's not sharing anything with other
and you can't do some communication but
with that you are able to basically take
your part of the page put it in
somewhere where any other part of the
team or any other person evening outside
the company can benefit for the modules
you create it is kind of a little inner
world or yeah so you can create in your
application its little modulus I'm gonna
see why the management from darling how
we start from there building any scaling
as i promised you first so i'm going to
go a little then feel free to for this
on jihad is in my github account in
training muy trainee mojito lesson one
and you can also find it on help one
really simple what this app is going to
do is is one module one super money
essentially before and what we're going
to do basically is called an API to get
the weather giving our location and
we're going to get giving this location
we're going to get some tweets money
nothing really complicated right so you
may expect that as i showed you before
this is a normal growth for workflow
we're going to spec trauma from a
clenched advocate private have our
client which basically is going too fast
from the server say a I need the weather
for this long which is an attitude so
the server is going to go to any through
our third-party server right and fetch
the data so that's that's that's the
normal workroom so let's let's see how
this works with the deming so i can
assure mojito it's really simple the
start is going to run it starts there
for me and of course exit 66 the word
much louder the first right now so it's
really important and what i'm going to
do is wanna show you before i'm going to
click here and what's going to happen is
I now to a specialized request which is
that panel i suspicion mojito and
basically here I'm calling the server
and say you know what I need the weather
for this location understanding here the
latitude and longitude right from our
server side while we're doing is calling
some her party server-side API for
example right now or we're keeping
Waikiki right and we're retrieving the
data from the server from a server which
already make a request for an utter
panic right and if we do show twist then
you remove that we freak we're going to
do the same thing right we're going to
go to our server and the chef is gonna
go to put against Twitter and we're
going to render the results in state
we're pulling the the render you want
decline but don't don't worry overlap so
that's the normal workflow but what if
tomorrow I have my server really like
for example he think a CPU bound htp
while Adam can I said I'll kind of
handle more connections what if I can
just do this without changing one line
of code what if I just can't say all
right server on the first flash when I
do the gate give me all the first money
and once i have that without changing
any line of code i can say to my
controller by the way where I had the
logic go to the client so the server is
no longer needed and I gotta go exactly
the same logic but bypassing the server
while if we conclude that it could what
would what would I be if I could do that
so let's do that really quick so this is
a mojito up and I'm going to over the
whole but if you can see here I have my
controller and a couple of models that's
the one hydrogenation is sweeter and
 you up and I as you can see here
this like a financing server which for
mojito means a by the way this team
executed on the server side so when you
ask for some some action on that
controller it has to be you have to use
the tunnel right but a simple as just
rename it is file to comment and say you
know what this piece of code can run
either on the server or on the client
I'm not saying that you have to do that
always but you
to police ability to choose on runtime
or a prayer request what you want to do
right so just under name you know the
components and as simple as that I'm
gonna start my application side it again
let's see how it goes it's Randy's
Grundy runs application game so why not
when i click here what's going to happen
is mojito say all right then have this
controller common and basically I this
guy want to run on the client so we can
either do that right now on lazy loading
times than i do now we can just protect
it we can do a the server ahead of time
can send a son so look at what's going
to happen what's going to happen is the
mojito is going to know that this piece
of code has to run the client and as you
can see here now the call for the third
party is happening on the client so let
it again so now that we calling the atl
twitter is no longer going to the server
is to screen on the client itself you
see right now just fetching the client
side we're hitting the twitter api
without going to the server and we just
need that without changing anything the
line of code imagine how powerful could
be leaves if we can do the same thing
for multiple devices multiple dimensions
and so 140 so that's one of the key
features another key features is how we
can basically shirt same page or allow
and support multiple devices right so
let me go back really quick to the code
is a mojito is a simple as dropping a
new file in this case you can see this I
index that iphone the move so basically
saying you know what this view when you
get the user requests and when you see
that the user rating belongs to an
iphone what i'm going to do is just pick
is you instead so basically what's going
to happen is when i get the page back
mojito's going to know that this is an
iphone you're going to serve this view
instead of this all of you I see
changing the name of the file right now
the move means mu stage template which
means I work we're using more stage for
rendering either on the client on the
server we can have under arrest for
example we do support handlebars already
so there's no more increase in value for
entry points there's no more crazy as
simple as creating and the same apply
for any piece of code if I want to
create a controller a specific for a for
advice you can do that and not only that
but you can customize your let's say
that you are I just want to serve a
different CSS or recent acid when I'm in
China in an iphone and I need a packet
guy who can attest in the environment we
can do that way we can define our own
selector and in a middleware like before
the request arrives you can say write
this for easy trading them for this
cookie of this person i'm going to send
these different context of the page
among its already going to do all of
that for you so that's for the
application part right so let's say that
we already build up our application the
program now who still have the need of
being able to integrate really fast you
have to test our application we have to
deploy in different languages we have to
test that we didn't broke anything so
how we're going to do that is we have we
can build we can integrate mojito with
NEC I the reason why is gonna be taught
at the box provided by the tools for in
good lad for right now what we can do
what we do actually in the mojito itself
we got Travis hook up on the SD and the
github so once we create a new request
or a new code is going to the kid a
tamale will run the CI and we run the
mojito test a mojito and the mojito
features are going to Tokyo right now to
make sure that everything works so out
of the box mojito provide us all these
things to make sure that our code is
well reading well tested and basically
mojito shakeys for getting ready to
production is minimize all the files all
these dependencies and make sure that
you want to get as the minimum amount of
of content to me even in CSS and
JavaScript so let me do an example of
liquid
we can do something like mojitos test up
what we're going to see here mojito has
integrated yourself Yui test which
basically I can I in the field test of
my modules in this case I have this
conversion to this little conversion
thing here what allows me to convert
temperature back and forth so i can
write really quick a test for that it's
a wily normal quiet test nothing else
all within mojito without having to swap
any any other group and basically we can
check here if we're doing things right
in this case I just mistook a proportion
some values right so we're seeing here
that is paying right so we broke
something you should not be able to
committee which would get another the
same thing we can just do mojito JS
leans up and this is going to tell us
well that's because I'm doing the monito
but everyone info test Margie modules
weather
you're going to tell it where the years
in error sorry for someone half on
missing space between comma and render
view so that's that's providers a good
way to measure before committing
anything to this PN that our code passes
a set of standards and so people now get
mad at us because we just commit crappy
code or at least non-islamic go back to
the presentation again mohit the test i
right over that somogyi to shake and
i'll do a quick payment as you can see
here you may want to say but i'm singing
that mojito let me start with a very
quick all right go so as you can see
here we are putting a bunch of the
pennies to write the mojito mean for
running either on the client server so
while shaker dash is basically get your
app production ready it takes the CSS
you need and the JavaScript you mean no
matter which dimension or Madame with
device and kind of only send the pieces
that we need so let's see it works or
into shape we can I do stage basic
evolving strange guy I'm going to roll
out minify all the dependencies and
create the role of journeys on runtime
and you know really in a constant time
you just get the only literature saguni
so I'm going to run that check its gonna
look this thing and look at the
resources now instead of having a bunch
of things we have a reduce the amount of
CSS we minify them we compress it and
everything is automated so right now
every single time we learn we put a new
build on Odin commitment into this game
our CI tool can do all of these ahead of
time for us and use something called
Ron's you can take a you commit to do
just deal it doesn't pass a test or he
doesn't have purchased in which
basically allow us to minimize the
errors from production that was the demo
basically so more than that we still
need the problem of sharing code right
so because of the modules it is isolated
NDC part of the paste we can just say
you know what I can attack that in
in a little package in an NPM package
ranges this is a separate package and
put it in somewhere where other
developer can reduce it right somo me to
allows you also to use NPM packages out
of out of the bug to do that so how we
do that in yahoo has an internal
registry as simple internal that anyone
can create his own NPM registry a
package money empty n stands for note
packet money or the one you know so you
can create a package for your module and
say you know what send it to this global
register for the company so any other
team can use it so remember the search
box for example in this package that
search box which is going to be common
for every property in the company and
instead of time to rebuild the game I
just have to go to my package digestion
which is the you know where you define
your dependencies and put their the
package you need my video will pick that
already and the only thing you have to
do in your code is put some corporations
a worthy one is pay this money that's
the beauty of sharing code the problem
is still with that is that you can have
this chair module you know what I mean
Alateen and I don't like this developer
because i already have to know fixed is
calling on that so how we can reinforce
that the quality of it all the packages
we sent to this registry are good as
well so we can do that a nap level while
we cannot do the same thing at module
level right so the developer is going to
say i don't want to use your coat I'll
leave some first right I mean I did some
so many times and also the problem with
that is as probably you know one of the
problem in OTAs is the anonymous
function how many people here was like
one day the buying some anonymous
function club actress no one I was the
only one all right lucky you so the
value normal function is really painful
I can tell you is true so because we
don't want to do this imagine we want to
keep always our code of the our models
our our global and impact
is there in a good quality while we can
do basically is doing the same thing we
do for our last do it at a moderate
level we want to be able so basically
every time we modify something in our
pockets our little module doesn't have
to be in the end between a little model
we can run the same CI enforcing has to
get a certain coverage from the unit
test make sure that every test passes
and make sure that there's no she has
new territory get in today so in that
way when everything goes and passive I
can be sure that the package I just
pulling on the on the register / quality
company can use this kind of a good
quality code right and basically any
other people on the company can review
the same thing that's how we started to
scale that's how we can basically really
fast starting to with mojito we can
basically create the application for
multiple devices and running without
having to write the collage applies we
just have to ship it to decline in super
easily and now we'll have this package
where allows us to share code really
simple and for us a young for this
virtual one power priorities in may be
going to be suitable for your wife you
can use either internal packages or
publish packages that's a normal NP
anytime so marito will basically
recognize if there's model specific for
the application or just regular NPM
package let's say you want to use the
top five level XO you want to use
backbone for example for one of our
models eventually we do that if we want
another thing is deploying to the club
so at the last step one I will see I
tool or in this case Travis or whatever
you guys have non CI for your company
you can basically as a nice day when
everything goes well we just can push to
be
right so in yahoo we have our own cloud
right now it's not open source yet you
might be in the future we don't know but
if you are a normal developer you on
your own company you can use any other
no DJ no yes standard third party to
upload the jaan mohit obligation for
example no Jitsu and hiraku it might be
suitable for you the only catch here for
example I know that a meteor a Swiss
process out of the box you can just
press a button and deployed v2 this
platform we don't do that yet we're
working on that now it's a man
approached to do once you have your CI
and everything it's working you have to
manually I mean I think I can give you a
scrip to do that working building
scrupulous easy to do that so basically
there's no way out of the box or mojito
right now to do that automatically
that's the only catch and we're working
for for that so the only thing I have
left is what about performance I had a
couple of fish live with a bunch of
matrix and a bunch of its life on how
our app however apps perform how is
better for us no Jess 10 PHP so I
generally thought that is gonna be
easier if I just tell you what how
experience because I think every single
person or every single developer we we
may have different use cases so if I can
show you I can show you that our appt
perform as twice as better crispy and we
can handle a Squatch connections and
with less with half of the hard work and
will be true but this is because for us
Dutch the way we work is that we have
all the packing calls right in another
server while we only do in the front end
is the spice in connection with as much
as fast as we can we ascend the request
clover server to our backend which are
really fast as soon as we get their
answer we get by the way they will flash
right away
the request in decline so if you are
planning to compute Fibonacci on the
server side probably no tis not the
suitable tool for you right but if you
have application which you need
basically to read content on LI or Rick
you have to flash the server side in 20
milliseconds in 20 minutes x + 5
milliseconds probably no yes gonna be a
good talk with you and maybe with mojito
he may also make an interesting point on
your own your application so I think
that's why I had today my message is two
guys tried out is is getting a stable
mojitos really right now we're using in
production research I can show you if
you wanna after a search running with
mojito is performing pretty well and
also is 14 e almost on a dome of every
single device not some even I six we
have to create a lot of CSS for that
that's for sure but we can package that
together using the tool which report so
just this lights are in my personal
webpage you have to repo and we have you
have a training I did with a colleague
of mine a junk when you have to also a
video tutorial where it in a ramp up so
my last my Russian is gonna be mojito is
a bit complicated to bump up by the
symmetric grandpa in a couple of days
it's going to be really faster for if
you want to tackle a lot of devices in a
lot of and a lot of languages in on that
as we saw in the stock so remember to
try it out sometime own and have here
and I'm gonna be on the yahoo Spain if
you guys have any questions or any or do
you want to try it out we want to need
to put any demo or you have have hero to
the super p.m. or mojitos you want
asking some questions as well so feel
free to come by take some come on and
try mojito thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>