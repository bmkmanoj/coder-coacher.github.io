<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Getting the Native Feel: JavaScript for Mobile &amp; Tablet Web Apps | Coder Coacher - Coaching Coders</title><meta content="Getting the Native Feel: JavaScript for Mobile &amp; Tablet Web Apps - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Getting the Native Feel: JavaScript for Mobile &amp; Tablet Web Apps</b></h2><h5 class="post__date">2011-09-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TS0A7s7R3dU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">today I am going to be talking about
getting the native feel that is getting
html5 apps to feel like native apps and
some issues that are related to that I'm
also going to be talking about the
plugin that i wrote to manage touch
event and i'll tell also talk a little
bit about hardware acceleration and jas
optimization and some other further
considerations when you're starting to
think about getting your html5 app to
feel just like native app everybody hear
me in the back okay great so I want to
talk at first about some context which
is a situation that I call I lose in the
I lose paradigm we're forced into
delivering content through an app store
and that's really expensive because each
platform is its own project and we have
to pay part of our profits to another
corporation sometimes thirty percent of
our profits and we have to play by their
rules we spend six months building a
project and suddenly they say no that's
actually not okay we won't allow your
app into our marketplace so that's a big
I lose and and also we lose control over
distribution and our marketing because
if our competitor has an app that's
being promoted in the app store and we
are not being promoted in the app store
there's nothing we can do about that
someone else's control of that this is
not the web this is not an even playing
field so that's the situation we want to
get out of ideally so here's a company
that did that Financial Times they have
an html5 app that feels quite a bit like
a native app and
runs on Android iPad just about any
touch device launches from the home
screen and really raises the bar for
what's possible so it's certainly
something to check out if you're
thinking about doing this type of thing
is built by a deaf shop in London called
asanka and they have a video about how
they built it the lead engineer from
asanka presented to the London Ajax user
group her meetup group our kind of
sister group in London that is and
enough the video right there so if you
want to check out that video that's
really a truck full of information about
how they did it the audio is a little
rough but you know just tolerate it so
they used a lot of html5 technologies
and hacks to achieve this user
experience and one of the things they
did was they prompted the user to save
the app to the Home screen they really
held the user's hand through that
process guided the user through that
user flow and I got it and they can get
the user to bring that app to the to the
home screen and when the app goes to the
home screen it has a Financial Times
icon and the user can launch it from
there it loads very quickly and the URL
bar goes away and so it feels a lot like
a native app in addition they have
really smooth animations and in at a
certain point during registration they
prompt the user to expand the amount of
local storage that the user will allow
the app to have so they take it all the
way to the limit 250 megabytes and that
allows them to provide an offline
experience for the user so this is sort
of like all really edgy stuff in my
opinion and amazing so things that we
can learn a lot from last week Financial
Times was totally kicked out of the app
store for not sharing the full thirty
percent with Apple Financial Times his
response is
okay so what we have we have an html5
app why don't we just direct our users
are there and suddenly that changes the
playing field quite a bit Apple has a
lot less power of suddenly in that
relationship and and Financial Times has
a lot more flexibility they would still
like to be in the App Store sure of
course but maybe they don't absolutely
need to okay what are we doing at hops
to do we're also developing html5 apps
my recent work has which I can't
directly talk about because it's all
hecka stealthy and stuff is uh has been
geared toward mobile and tablet and but
I was approaching these projects and I
was looking at some frameworks like
sencha touch and jquery mobile and I was
realizing that was kind of like I have
to play by the rules of the whole
universe like if I'm going to get into
Jane Cory mobile there's going to be a
lot of dictation over like what my UI is
like and all that stuff and that's not
going to work for our designers here at
hot studio because they're coming up
with a really creative stuff and and so
that wasn't going to work but I really
what I really needed was just kind of
control over what i call the touch
environment and I called the touch
environment because you've got a really
limited amount of things that are going
on with a finger hits the screen right
but you're trying to extract from that a
lot of intention right so the touch
environment is like it's like for
example like if a thing if fingers going
across the screen is that a drag or is
that a swipe like is the user trying to
drag something around and pan something
or were they trying to turn the page
right so I needed to be able to
differentiate between that stuff and
eventually looked at some other
JavaScript frameworks but you know just
nothing was working for me so I wound up
writing my own and that's touchy touchy
here's the github address is layered on
top of on touch start on touch movement
on touch and so any browser that
implements those events can use touchy
mostly that's WebKit but there might be
some other browsers that
implement that as well so it's loosely
based on iOS native gesture recognizers
so iOS has dragged swipe pinch rotate
and long press and tap also as gesture
recognizers I didn't implement tab
because I felt like that was readily
available through touch start but you
know if there's a compelling use case
and I get feedback on this maybe I'll
implement that too but the architecture
is based on cowboy been almonds jQuery
special events article which was he
wrote last year and special events in
jQuery are a kind of a refuel amazing
little hidden corner of jQuery where you
can actually use bind and unbind on your
own homespun events and that's that's
really cool i think so definitely check
out Ben almonds article if you want to
learn more about the inner workings of
how touchy works because it's really
based on his architecture the event
handlers that you would write to handle
events that are they're triggered by
touchy receive a number of parameters in
addition to the jQuery event object they
receive for one they receive a phase of
the event and that's how we sort of
figure out if we're in a drag is this
the start of the drag is are we moving
in the drag or is this the end of the
drag when the finger comes off the
screen and so you can you can imagine on
your drag you would like touch the
screen and the thing would highlight
right but then on move you would want to
like animate it and then release you
would want to take that highlighting
away so that's how we we do that stuff
here's some code example one is pinch to
zoom and on what i'm doing here is i'm
defining an event handler with a handle
touchy pinch and then i'm going to bind
that event handler the events as you can
see are all prefixed with the touchy
name so that there's no name collision
like I didn't want to have named an
event drag for example because there's
the html5 drag right and
you won't have any collision there so
every all the events in this plug-in are
prefixed with that name and the
parameters come into the event handler
we get the event jquery object that is
and we get the jquery wrapped target so
that we're ready to act you know we
don't have to like the wrap jquery
around this or something and then we get
data which is a json object with lots of
detail about what's going on so so for
example scale is a property of data and
we can control our pinch to zoom through
the scale property the other thing other
other properties of that come into a
pinch handler would be things like the
center point between the two fingers in
case we want to like drag and pinched at
the same time right might need to know
that information all the different
events fire kind of different things I
mean they send different information in
the drag object so and then there's a
second example which is a like a wheel
interface or like a turntable or a knob
that kind of an interface I'm handling
that through handy to handle touch you
rotate in this one we have a phase
coming in so that we can know that if
are we in the start or we in the move or
we in the end and I'll show that one to
you right now just give me a moment we
have to switch stuff on the fly
see what got here so here's my whoops
hang on say that's right my Donald is
angling see if we can get some
recognition here yeah okay here we go so
uh here's our here's our interface and
this artworks graciously contributed why
by one of the principles here at hot
studio so I can do this and I can just
kind of like rotate this around right
this is pretty nice smooth animation and
this is a single finger touch as opposed
to some of you might be familiar with on
gesture change which requires two
fingers to do a rotation this can be
configured to do two fingers by the
developer but I kind of think that
single finger is a little bit more
backwards compatible toward older
versions of Android and stuff so anyway
so let's talk a little bit about how
that gets so smooth okay let's let's
leave touchy behind right now let's talk
about event handlers
okay we come back hopefully at some
point hello vga there we go okay so so
event handlers the big rule here is if
you're trying to like get some really
great animations going to feel native
you should be using css3 3d transforms
that is the big the big step that we
need to take and we can spin that by
affecting the style property of an
element or using you know CSS and jquery
or whatever but the real hack here is to
be using if you have a 2d transform
going on to make it into a 3d transform
by including translate Z or translate 3d
as part of the trend a transformed
description you can just append your 2d
transform with one of these and it
instantly becomes a 3d transform and
then you get hardware acceleration
awesome now what's hardware acceleration
hardware acceleration is when you tell
the CPU of the device to not do the
animation you tell it to offload that
job to the GPU the graphics processing
unit which is a specialist in doing that
job as opposed to a generalist and and
it turns out that that makes all the
difference and you get really amazing
effects you can test to make sure that
you have the correct hardware
acceleration going on by launching a
browser with these certain flags
attached to it from the command line and
so if you launch likes a chrome with
these flags or moored Safari you can get
sort of highlighting around these things
if they're being a hardware accelerated
what I have here is launching the iOS
simulator from the command line to get
this effect into sort of like tests due
to our my elements correctly being
accelerated so I want to try to show you
what that looks like if I can gonna have
to move this over to the other screen if
I can here we go whoa okay so it's a
little large but um but this is what it
looks like this is the iOS simulator
and then if we do this that means yes
it's being transformed and it's a by 3d
and we're getting hardware acceleration
okay so the other things you want to
might want to keep in mind when you're
writing your event handlers are
throttling your frame rates want to make
sure that your frame rates on any kind
of animation are not occurring above 60
cycles per second and they might even be
able to be clocked down to like 30
frames a second because that's that's
where video is right but the refresh
rate of the of the screen is at 60 so
you certainly don't need to be above
that and if you do go above that you can
really start to bog things down let's
say you do have a pinch to zoom if
events firing on trying to repaint the
canvas okay so those those touchmove
events on that pinch zoom are going to
be firing like super fast and and the
problem there is going to be that that's
going to fire faster than the animation
can actually occur so it's going to look
all clunky and slow and you're like
what's wrong with my animation the trick
is actually to slow down your animation
not speed it up right it looks like it's
going to slow but you actually want to
slow down your animation so that it can
be smooth and look fast so totally
counterintuitive right that's important
thing to keep in mind you want to
separate reading and modifying of Dom
values into two distinct phases of
operation that you that means like if
you were like reading like the left
value of a animal element and then you
want to change it over here you don't
want to go back and forth between like
figuring out that left value and then
affecting it and then going back and
doing this you want to like do all your
reads at one time and then do all your
rights at one time and that's going to
be a lot more efficient for the browser
also when you're profiling you can name
I'm going to take questions at the end
if you're profiling stuff in sale
you know the inspector with google
chrome or whatever you can name
anonymous functions and then they'll
show up in the profiler and a lot of
people don't realize that you can just
in the same place that you put an
anonymous function you can actually
write like function just you would
normally write like function parentheses
open brace right but you can just
actually say function my test name
parentheses open brace right there in
the same place and you can then it'll
show up in the profiler so that can be
useful things to avoid Dom manipulation
try to do as little Dom manipulation as
possible when you do it hit it all at
once you probably already know this
stuff right do everything in a document
fragment and then hit the Dom right
don't hit the Dom over and over and over
and over and over again just do
everything outside the Dom in a fragment
pop it in accidental browser layout
reflow this is when the browser is like
measuring everything and trying to
figure out like all the floats and all
the relative positions and like where
everything should go you can trigger
this accidentally really easily like
just checking the offset width of any
element on the page boom the whole
browsers like oh I'm going to reflow the
whole thing right now and that's that's
a big problem so don't do that
especially like inside of a loop you
want to do that really intentionally and
intelligently and a really great
resource to learn about this stuff is
actually Paul irish's video that he
published I think a few months ago about
css3 and performance and then he lays
out all the different things that will
trigger this and so there's some other
resource too but Paul's video is a great
starting point animated CSS shadows and
gradients this is another thing that's
kind of really bogged down the browser
they're really awesome the fact that we
can do shadows ingredients now with CSS
but if you try to animate that stuff
it's just a little bit too much it's
just too much for the browser because
though all those gradients are really
like tough for the browser to draw it's
like really careful like little stuff
there you know in that Grady
and then if you try to animate on top of
that it's just going to kill the browser
so you might want to have some
conversations with your designers about
like either we're gonna we're going to
like not put some shadows around the
stuff that we're going to animate or
we're going to or we're going to maybe
go back to some older methods of
providing shadows like image-based
shadows I had a shadow on the rotation
one that I showed you but that was okay
because it wasn't actually moving right
it was staying in one place in one size
as soon as you start like resizing that
shadow everything falls apart some
example uses of Jason css3 HTML rocks
awesome resource totally great there's
tons of stuff there and a lot of stuff
I'm talking about today there's a lot
more information about on that site de
sandra de sandra was a total master it's
like a Jedi so check this guy out he
wrote this thing called isotope and it's
this thing that animates the periodic
table according to you know you're
different desire and maybe some of you
have seen it but he also has a github
page where he like shows all these
different examples of what's possible
css3 and animations and how to how to
how to connect that to JavaScript and
really cool stuff very inspiring lots to
learn from then there's the touchy
examples there's some examples on the
github page and and you can check those
out if you'd like there's not that many
there but there will be more in the
future okay so some further
considerations with html5 apps base64
encoded images these this is something
that Financial Times did with their
images they so basic ste for image isn't
is it's an image that's been translated
into text right usually that means that
the file size is going to be increased
about like 130 percent or one hundred
fifty percent of the original it turns
out that if you gzip that string
it returns to about the same size as the
original image so in addition so that's
cool right in addition and then you can
plug it into your to your application
with a data URI okay so the data URI
uses the base64 string turns it back
into an image and the cool thing about
this is that ok there's a couple to cool
things for one you can put it all in a
JSON object and now you're doing one
HTTP request to get all your images
secondly mobile providers like verizon
will like mess with images because they
think oh here's a jpeg i need to
compress that a little bit more to
optimize their bandwidth right but
that's going to denigrate your images so
that's not what we want and we're like
hey I'm a developer I know what I'm
doing this is what the image is supposed
to look like okay don't mess with it so
if you encode it as a base64 they can't
tell the difference that's pretty cool
so another thing is
requestanimationframe Paul's going to
talk about that later so I'm not going
to talk about that right now but that
has to do its kind of the clocking thing
I was talking about you know with the
refresh rate and as far as offline use
goes for the html5 apps like i mentioned
i'm saving to the home screen has a lot
of benefits especially on mobile
solution excuse me especially on iOS and
but if you couple that with a cache
manifest file a cache manifest is you
declare a bleep ellen i attribute inside
of the HTML tag that directs the browser
to a file which is called the cache
manifest and that's a list of files that
you want the browser to cash and so the
browser can launch the app without
actually having to go to the internet it
has cash these things and so the html5
app is going to launch like that so you
do that for like the skeleton of your
app and then you have local storage to
sort of like populate it right so now
you are offline you don't need the
internet anymore right you've launched
the whole lap got your content and local
storage
got your cache manifest for your
skeleton BAM last thing is w three
widgets divot 3c widgets this is like a
zip file that's packaged up into a
widget that any compliant client can
launch kind of as a little app and this
just received a proposed recommendation
from the w3c but you know we'll see what
happens to this in the future this could
be really cool and this could just die
we'll we'll see okay for the win build
and advocate for optimized html5 apps
because they're better for business and
they're better for developers and
they're better for users in the end
create and contribute to open source
projects make development easier I mean
like when I'm talking about this stuff
like the cache manifest file and stuff
like that it's like there's not a lot of
frameworks out there that sort of are
going to help you out with this stuff so
we kind of need to work together and
build this stuff because this is how
we're going to take html5 to that native
level and we're going to be able to be
judged on the same grounds as native app
so we're actually going to be able to to
be there alongside them so I really want
to encourage everybody to dream big and
push the limits and really and really
take it all the way that you can because
we don't want an I lose situation right
we won't win win for everybody that's an
open system and open systems are going
to win okay so thanks everybody here's
some links at the end of the talk and if
you download the PDF those are all
available to you again that's the
address okay thanks
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>