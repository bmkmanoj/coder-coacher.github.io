<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Rust + Node = Love - Forward 3 Web Summit | Coder Coacher - Coaching Coders</title><meta content="Rust + Node = Love - Forward 3 Web Summit - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Rust + Node = Love - Forward 3 Web Summit</b></h2><h5 class="post__date">2015-08-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/okaNt-dGfUg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everybody I'm Steve sorry I'm gonna
start in a minute late I was told that I
would have an introduction and then that
person disappeared and I didn't want to
make you all sit here so I'm just gonna
do my own introduction so pretend I
didn't say any of that and then we'll
just do this hi everybody I'm Steve I'm
uh so in other news for technical
difficulties I use free software almost
exclusively on my computer and I like to
say free software I love it but it does
not love me
so this screen is actually blank and
that screen has stuff on it so I'll be
turning to look at this every once in a
while because Linux plus projectors I
mean it half works so that's better than
not working at all right I presented a
Linux meetup recently and they did not
take this joke with as good of humor as
you all did I mean I got questions about
like what hardware are you using what is
throw that's weird then aloha always has
a good yeah anyway all right so this
talk is called rust plus no 2 equals
heart and I know that this conference is
a little broader than a JavaScript
conference but really this talk is more
like rust plus insert other language
here equals heart I've actually given a
different version of this talk at a ruby
conference where I substituted in Ruby
for this so if you're not a node person
super hardcore please just substitute
node with programming language of your
choice
although node Python and Java and Ruby
tend to work best directly in this
comparison yeah hi I'm Steve I
historically have done a lot of Ruby
work and I'm actually like relatively
new to server-side JavaScript so I've
been laughing that I only start work in
programming languages that start with ru
so I used to do Ruby and now I do rusts
I'm not sure how many more we can come
up with the star with ru but whatever I
work for Mozilla on rust full-time I do
all the documentation so if you've tried
to learn rust and you did not understand
something I'm sorry it's my fault my
primary like thing is the we call it the
rust programming language or the book
it's about 250 pages currently of just
like introducing the language it turns
out that programming languages are big
and there's lots of stuff to them and so
yeah so I'm full-time dedicated just to
documentation
so I'm here to share with you a couple
of things today this talk is primarily
about three things the first one is this
thing called systems programming in
general the second one is rust and then
the third one is rust and node together
one other fun thing about this font that
I have me actually zoom this so that
emoji on the end there is my favorite
emoji it's it's short name is called
sweat smile
it's basically smiling with a little
Anna Mae's sweat on it it's a little
hard to see with a smaller font but yeah
cool
so I want to talk first about this this
thing called systems programming so this
term has like all terms you know in
computer science a lot of them have very
poor definitions we're very very bad at
agreeing what words mean like have you
ever asked someone object-oriented
programming means you know you get like
five different answers based on you know
three different developers will give you
five different answers about what
object-oriented programming means and
it's the same thing with systems
programming as well and this is like
sort of a problem for me because rust
has tended to historically advertise
itself as a systems programming language
but the problem is is that means people
insert whatever they think systems means
so like all definitional arguments I'm
going to solve this by introducing a new
definition of my own and so when I say
systems programming this is what I mean
by it and sort of what we think about it
in the rest of space this was not my own
idea i blatantly I'm stealing this from
you hooter cats so you may know as a
heavy rails contributor back in the day
and most recently amber Jay s he's also
on the rails core team with me as well
his definition of systems programming is
my favorite so that's systems
programming is the kind of programming
when it matters and the problem with
this definition is that if making a
reference to a thing it does not
actually explain so for example in the
Ruby world we say Ruby is really slow
but it doesn't actually matter because
your database is going to take up much
more of the time than your actual web
request or you know if you're writing in
a language like Python you might say
like it uses more memory than something
lower-level but that doesn't matter
because
I'm actually looking for development
speed time and so you know I'm using
this language for that reason so
programming and engineering in general
is all about trade-offs and choosing the
appropriate trade-off for whatever your
task is and so I like to think about
systems programming as being windows it
matters trade-offs actually do matter so
when you can't afford to use a 300
megabytes of RAM for a rails process
when you can't afford for your
application to respond in a slower
amount of time because a garbage
collection pause cause your application
to freeze or you know when you need some
sort of soft or hard real-time
requirements and so you can't handle
arbitrary pauses at all or you know
control in general so if you're maybe
working with some hardware you need
specifically to know the memory layout
of the stuff that controls that hardware
and you can't just let your language
decide the memory layout of your stuff
you need to define it specifically so
this is what I think of when I think of
systems programming it's like when you
need to care about the details and that
doesn't mean you have to care about
every single detail all of the time but
you have to be able to care about the
details that you want to care about and
so this is sort of where rust is poisons
itself is sort of amongst the lowest
level of the programming stack so you
can rewrite an operating system in rust
if you want to you can write a memory
allocator and rest if you want to one of
the biggest names is using rust in semi
production they're not actually in
production yet but they're hoping to be
soon is Dropbox so they're rewriting
some of their stuff that controls how
their files are stored on the hard
drives in rusts and so that's a you know
kind of a broad spectrum of what I'm
talking about here and now so the thing
about talking about all that super
low-level stuff is when I start talking
about things like where your files are
stored on the file system or I need to
care about the memory layout of my stuff
the reaction of a lot of people in the
web space where I've sort of been in the
last couple years professionally
speaking is there like I don't want to
have to care about all that stuff and
that is a tube super 100% valid thing to
do I I myself cannot care about
everything all of the time it's just not
possible
right because everything is a trade-off
so one of the other things about systems
programming is I think that a lot of
people who are in the web space when
they when I when they see things like
control the way your memory is allocated
or laid out in memory they go oh my god
that is super hard I'm not very good at
programming I don't know how to do this
and so one of the major messages that I
want to tell you is that it is not
actually that hard and you are in fact
that smart and I believe in you and you
totally can do this stuff
I actually know people who think that
web programming is harder than writing
an assembly code because to them
assembly does exactly what it says in
the box there's only a couple of
instructions it's very simple and
straightforward or as to make a website
you like have one programming language
generate a markup language and a
scripting language and a template like
like styling language and then you
bundle them up together and you ship
them onto another computer the other
side on the other side of the world and
you expect that to all like work and so
like web programming is actually very
complicated and there's a lot of moving
parts and if you're a web developer or
if you work in these like higher levels
of the stack you're actually doing
really complicated stuff and it's hard
and you should be proud of the work that
you're doing I I'm not really interested
in saying that like certain kinds of
programming are like better or worse or
harder or easier I think that we as
people are all very different and have
different strengths and abilities and so
it might actually turn out that you
think that writing file systems is
easier than writing ember and that's
totally like legit and so I think that
one of the great strengths of rust is
that we are explicitly interested in
helping you learn this kind of lower
level programming language stuff if you
are interested in it so there's an
example of this this some of the code in
this talk is actually based on in my
official documentation I actually have
an example of writing a library and rust
and then calling it from Ruby Python and
Java scripts there's actually a chapter
in the official documentation just about
the stack and the heap with regards to
memory allocation and what that means so
we're very interested in helping you out
if you have not done this kind of
programming
before and if you're interested in it we
will be happy to explain this stuff to
you and I also know that this is true
because I myself underwent that
relatively recently so I learned si is
my second programming language I'm a
very long time ago and then basically
when I found Ruby I was like cool I
don't need to worry about any that stuff
anymore I'm never writing this ever
again and I saw I went in did Ruby for a
couple years and I forgot all of that
low-level systems the programming stuff
and so when I first started working in
rust about two and a half three years
ago like Christmas 2012 yeah I think
three years ago two and a half I'm
getting old when I started working in
that I I went in the IRC Channel and I
was asking people like how does hello
world work and they all helped and were
friendly and we're willing to explain it
to me and I was like I don't understand
this memory allocation stuff can you
help me out and they're like absolutely
and so we've kept that sort of community
spirit of being helpful and no question
is too like quote-unquote easy or simple
or stupid and so yeah this is sort of an
explicit rest community goal as well
which is really nice alright I have seen
this slide out a little bit because some
more stuff on it yeah all right right
there so enough talking about how sweet
everyone that uses rest is let's talk
about the programming language itself so
rust is a language is trying to
accomplish three goals the first one is
safety the second one is speed and the
third one is concurrency and so there's
a there's many different ways of looking
at programming languages and like
aligning them up against each other for
way too involved internet arguments
about who is like better or worse but
one of the ways that you can sort of
look at programming languages is this
trade-off between speed and safety so
some programming languages and I
actually like think speed and safety is
only sort of half of it so it's like
speed and control versus safety and lack
of control so on one hand you have
programming languages like C and C++ and
those programming languages give you a
high degree of control over what you're
doing and therefore they have no safety
whatsoever right like programming and C
is like driving without a seat belt or
like riding a motorcycle without a
helmet like you can do it and it works
most of the time but it's very dangerous
and languages like Ruby and JavaScript
to some degree and Python are sort of on
the other end of the spectrum and they
don't give you very much control over
how your code executes they do to a
certain degree but not nearly to the
degree that something like C or C++ does
but the advantage that you get is that
they have a significant amount of safety
so for example if you write some Ruby
code that compiles well Ruby does
technically compile whatever I don't get
in those definitions if you write some
Ruby code and run it through the Ruby
interpreter it will not segmentation
faults your app will not crash outright
and that's sort of a guarantee that's
provided by the language whereas you
know if you write some bad C code it
will just crash on you with a terrible
error message and not give you any help
in figuring out what went wrong right so
historically speaking this has been this
trade-off and different languages are
kind of in different places I decided to
randomly put Java here because it like
gives you a large amount of safety but
also does give you some degree of
control but really you can like you know
argue forever about where languages are
placed on this spectrum but we and rust
sort of want to give you the speed of C
and C++ but B safety of Ruby and Python
and as I said earlier engineering is all
about trade-offs and so if someone tells
you that this trade-off doesn't exist
you can have your cake and eat it too
they're probably lying to you which
means I just lied to you so where is the
trade-off in this in the rest world and
basically in rust the way that we
provide this safety is through extensive
compile time checking so there's this
phrase that people use to describe their
early days of programming and rust and
they call that fighting with the borrow
checker and the borrowed checker is the
name for the like most unusual and
unique aspect of rusts compile time
safety checks and so at first when you
start programming and rust you will make
mistakes and unlike your C both plus
where it will compile and then just
crash on you the rust compiler will not
actually compile your code and it will
say hey there's this problem here you
need to address it sorry you don't
actually get your program and so I don't
like to think of this as fighting I like
to think of it as have
a friendly conversation like the
compiler is there to help you it's not
trying to like the positioning and us
fighting means that like the compiler is
out to get you and it's like it's mean I
don't really like that I like to think
about compiled languages that have
really strong type systems like Russ
does as being your friend who is
convincing you that what you're doing is
a stupid idea and stopping you from
actually doing it before you hurt
yourself like so I like to think about
this is more of like having a dialogue
with the compiler where it like informs
you of your mistakes
because the good and bad thing about
machines is they're not like humans so
they never sleep and they always do the
exact same thing all the time right so
they in a certain sense
I mean bugs are mistakes but like
assuming that your code is reasonably
bug free you know they don't make
mistakes they never forget they're
always vigilant against your programming
errors and you as a human you know will
make tons of mistakes I know this is
true now one of the funny side effects
is that when I go back into languages
like Ruby and some degree JavaScript I'm
so used to just like typing crap into
the computer and letting the compiler
tell me what my problems are that I feel
very very like nervous without that kind
of help now that I'm sort of used to
doing this heavy static typing and so
it's interesting when you switch between
programming languages when I was
preparing an alternate version of this
presentation and some well when I was
preparing this presentation actually I
was switching between rust and C and C++
and JavaScript and like when you try to
switch between that many real languages
that quickly I started like mixing the
syntax is up and I was like defining a
function according to the rest syntax
but then writing the function in like
JavaScript syntax and like you know gets
it gets complicated but it's fun that's
why we're here yeah so that's sort of
how russ provides this speed and safety
and like breaks the dichotomy is we have
really strong checks at compile time and
that means that your code can be very
efficient at runtime because you don't
pay any runtime overhead for these
safety features they just compile down
to the same code that your C and C++
code would compile to we've just checked
beforehand that you're not doing
anything terribly dangerous so let's
look at it a little bit of rest code
one cool thing that you can do let's see
if the internet is still working
yeah typing so clay dot rustling org is
actually an online version of the rest
compiler and it says that is loading
yeah there we go
it took me a minute to even connect to
the internet earlier
all right oh there goes awesome cool so
I'm gonna like tilt a little bit like
this so I can do this but
yeah there we go cool so rust is a
strongly statically typed language has a
little bit of sort of ceremony and
syntax it's a JavaScript programmers it
should feel a little bit familiar
because it also uses lots of curly
braces and semicolons although I know
all Java people don't use semicolons I
don't want to get into that whole
argument talking about that I use
semicolons in my JavaScript but yeah
whatever so this is I think I'm like
legally obligated as a person to show
you hello world or you know bad things
will happen to me so here is here's
hello world in rust and the cool thing
is then so you can actually like without
installed in the rest compiler you can
type rust into here and actually try it
out and so this will prints hello world
so we sort of have this kind of thing
one sort of interesting aspect is that
even though we have really strong typing
we also have really strong type
inference so for example these double
mustaches or lobster claws or whatever
you want to call them they're they're
sort of like where the value gets placed
this is like a Python ism we decided not
to use the c style printf scanf
shenanigans and do the like you know
clamps and so this is a strongly type
program but i didn't actually write down
the type of I so rust will automatically
infer if you don't have a good reason to
that your integers are a 32-bit integer
value so you don't have this sort of
heavy burden of like writing out your
types everywhere all the time there's
none of that like type name variable
equals type name over again other stuff
that you might have in some statically
typed languages we do make you write
types in function definitions though or
make this a little bit
all right so
so for example
this will actually fail to compile I'm
gonna tell you that before it runs it's
not a live code mistake
it just doesn't actually work so here I
had to say foo is a function that takes
one argument X that argument X has the
type s 32 which is a 32-bit
floating-point number and we print it
out you know with the hello world and
when I try to pass I in here I get this
compiler error mismatched types expected
F 32 founds I don't know this
underscores like a little placeholder so
in this particular instance that's
because I'm passing an integer to a
thing that has a floating-point value so
rust is complaining that I don't have
these things one cool thing that we've
done is we actually have these error
codes and this this to me feels like
when we first implement this feature I
remember back in my days of like
learning Visual Basic as a kid and I had
this huge thick manual that just had
like descriptions of error codes and so
in some ways that was really awesome
because now you have this eo3 eight
working and so we actually have like
extended compiler error messages that if
you want an expanded version we don't
have print this to your terminal but
this actually like explains this error
occurs when the compiler was unable to
infer the type of variable it can happen
in several cases for example X as an
i-32 it's not a number so we like put a
lot of work into this compiler
diagnostic stuff so that you can like
get an extreme amount of help this
webpage has all of them on it and it is
very long and we're adding more stuff
all the time so that's also another cool
thing that I really enjoy we put a lot
of work into trying to make these error
messages understandable so in that
instance I can change this to be 5.0
floating point number and now rest will
compile and print that out so this is
kind of what I mean in the sense that
you know this seems like sort of a
trivial thing for a person but
converting between number types that are
wrong is a very good way to introduce
subtle errors in your application so
rust will sort of complain about it and
you know make you do the right thing and
this does lead to a little teeny bit of
like a difficulty of barrier to entry
like I said rust sort of make sure that
you dot all your i's and cross all your
T's before your code works so at first
you have to learn all of those things
which can take a little bit of effort
but after a relatively short period of
time you sort of internalize the rules
and a lot of people I've like helped on
IRC and I've watched them sort of to be
like I'm having lots of problems and
then like the second week so like I'm
having less problems the third week
they're like this finally clicked and
now I have no problems whatsoever so
it's also an interesting aspect of this
sort of approach to correctness there's
a little bit of upfront pain okay so
that's a little bit of an intro to some
rust code so it's not totally alien and
so now I want to talk about rust and
node and I did not actually sweep this
out I put Ruby and note is that a rust
in node because like I said switching
between languages all the time is super
hard so node is a really cool technology
I will admit that I have occasionally
hated a little bit on node on the past
but I think that node is actually really
great for a number of different reasons
and so I I don't want to tell you like
rust is really cool so stop writing in
your favorite
drop everything and rewrite stuff in
rust I don't actually think that that's
like a good approach or a thing that you
should do I think that you know you can
like multiple programming languages I
don't know if you've told people that
like to argue on the internet all the
time but you're like allowed to enjoy
multiple things at once you don't have
to tie your entire identity into a
single programming language but instead
of like making this about like rust is
cool and node is drools or like whatever
it's about how both technologies are
cool for different things and so you
should use them together because playing
together is way better than fighting so
one really cool aspect of rust is that
rust can make libraries that pretend
like they're C libraries and since C is
sort of the Latin of programming
languages every programming language
knows how to interface with C code
because you know we buried ourselves
under mountains and mountains of C code
over the last like 40 or 50 years or
whatever and so rust can sort of like
masquerade as C and what's neat about
that is that means that you can put rust
inside of almost any other programming
language because those programming
languages know how to talk C and so in
this case I'm going to show you how to
do this with node you can also do this
with as I said before Ruby JavaScript
Python pretty much whatever Haskell it
doesn't matter and so you don't actually
have to give up a language you already
like when you need this sort of lower
level control you can rewrite portions
of this in a different language so I'm
one example of this I'll use yahuda
again so he his company tilde makes this
product called skylight it's a rails
performance monitoring application
because I don't work for skylight I can
tell you that my version of their pitch
this is not their official marketing of
course my version of their pitch is it's
like New Relic but only for rails and
therefore way better because they focus
on just rails so they sort of like you
install their ruby gem in your
application and then it monitors you
know how slow or fast it is and why and
gives you feedback on what it is
so this ruby gem that you install was
originally written in Ruby but since
they're monitoring performance Ruby's
garbage collector would sometimes pause
in the middle of taking a measurement of
that performance when you see weird
spikes and it's like is that the app
actually
slow or is that the the Ruby garbage
collector decided to pause in the middle
of taking a measurement like I don't
know so you can like work around the
garbage collector and doulas other crap
but basically it didn't it didn't work
out very well so they decided instead to
rewrite this ruby gem in rust and so
that gives you all of this Louisville
control as I've been mentioning and so
that enabled them to write this
collector in a way that was much much
better but what's cool is it's still a
ruby gem so when you like gem install
skylight you're secretly getting rust
code pretending to be ruby code and so
you can do this with your own
application if you find there's a part
of it that is too slow or taking too
long you know you can like get the MVP
back in Silicon Valley so I have to
switch into your language I live in New
York these days so you gotta do your MVP
to find product market fit so you do
that in a slow language first and then
you swap it out with you know a faster
one later I think I got that right
hopefully I won't lose too much hacker
news karma so so this is sort of the
thing I'm saying is like you know build
your app in a different thing and then
replace chunks of it and rust where it's
appropriate and so here that's actually
the end slide I want to show you I've
actually done this I have a little
sample application that is totally
trivial but shows off how to do this so
these slides are also in this repository
but also all this source code so if you
go to my github steep planet for word
2015 the the slides I was just showing
you are actually generated by the rust
documentation tool itself so we actually
wrote a little bit of JavaScript that
you can include so it makes slideshows
which is really neat
because like I can if I had a bunch of
rest code in the slides I could actually
like have the rust compiler type check
my slides so the all that crap is in
there but the real big thing there are
these three directories node RS GE X
resist kicks I named it terribly because
I knew I was going to be speaking it on
stage and so I made it as hard to
pronounce as possible and in this rust
directory so the way that this sort of
works is inside the node directory yeah
so inside the node directory I have this
little application that doesn't do
anything of worse but it will show you
the basic idea
so in it I require this regular
expression library for node you can use
the JavaScript native regular
expressions but I wanted to use another
like extension I actually will show you
a pull request in a minute that compares
all three of them but then chai is just
basically this assert library and so the
documentation for the Reg acts package
has this example of just this regular
expression that is a or B asterik a BB I
did purl before I did Ruby so I like
love regular expressions but I know a
lot of people really hate them so this
is just the example that I went with
because I love them so sorry if you're
not into regular expressions but this
just checks a bunch of very simple small
strings and sees you know if it's true
or false I realized that assert equal to
true is like kind of bad form but I like
the matching with Ag assert false I
don't know and so now I print done and
then I have this other thing that
requires in rust we use dot RS as our
file extension which is also fun because
it's the national TLD of Serbia so I'm
like I have like Brooklyn RS for this
rust meetup that I Fioretti clear uh
nimmy york that i've done twice in last
year and so I have Brooklyn da RS and I
had to like give my credit card to this
like Serbian DNS where the star so
that's fun
so I decided reg X starts with an R as
well so I would name the library RS GE x
after the rust extension like I said you
know I'm now I have to say it on stage
so that's what happens sometimes name
things in a way you can't pronounce what
you know you're gonna have to pronounce
them so anyway the same thing rusts
regular expression library has slightly
different syntax you can see there's
like forward slashes because you can
actually do a regular expression literal
in JavaScript we don't have regular
expression literals in rust so we have
the carrot and the dollar sign for the
end anchors which is more of like a Perl
regular expression thing we run the
exact same tests and then print done so
I actually have a have the code here
can't sight
all right this is bigger
yeah let's get rid of that real quick
okay much better so I have a make file
that then actually compiles all the
stuff so first I compose my slides and
then it goes into the rest directory and
it builds the rest library and then it
goes into the node directory and runs
that script I just showed you you can
see done done so we successfully
executed both sets of regular
expressions and all of those unit tests
passed everything everything worked out
just peachy so that's my sort of live
example of this running you can run it
yourself but I want to actually show you
now the code so in your application you
can see how requiring I used this local
thing because NPM M PM's file
requirement thing was causing me
problems so I just decided use a
relative pass you know you probably
publish this as a package so you would
you would not use the relative path you
just say require rst X but the point is
this from the user of your library this
looks exactly like JavaScript and it
works just like JavaScript but inside
it's all actually Russ code so let's
take a look at that this is the RSG e^x
index.js library and so basically I'm
here I'm using the node FFI module and
the rest module to make this FFI wrapper
I have a fun story about that I'll share
at the end but basically what happens is
is I define okay I need an RSC X type
and I need a pointer to rst X and then
this this line seven loads up the
library so inside the rust directory I
eventually make a dot s o which is a
shared object or if you're on a Mac it's
a die libs I'm on Linux I just hard
coded it it's a presentation it's not
like for general consumption but the
point is is that that shared object is
just like a C shared object so the
example for FF I does this with a C
library but you can do this with just
rust and so there's two functions new
and match and these are sort of the
return types that you would expect so
you sort of make those out of JavaScript
types and then these two other types
that is fine and then in the exports for
this module I say that I'm an export two
functions one is new which is just
calling into the libraries RS new and
match which calls of libraries RS match
and then we're good
fun multi-language in
drop story I had to call this rs match
because matches a keyword and rust and
so I couldn't actually name the function
match and so I was like whatever else
prefix it with RS for rust but I
originally just want to call it a new
and match and so I do that sort of
mapping when I do the exports so this is
all you need if you have the like
library written up you write this little
tiny bit of JavaScript and it knows how
to load all this stuff from what it
thinks is a C library but it's actually
a rust library and then in here this is
some rust code which frankly so the FFI
stuff is like the it's it's as intense
as rust gets I'll say is you have to
shuffle from like the C types to the
rust types so so this is sort of what
this looks like so we make an actual
structure and then here's the
implementation of RS nu which basically
these first three lines are just
converting a C string into a rust string
so rust strings are utf-8 enabled by
default C strings are like whatever crap
you put in there so there's a bunch of
like these lines to basically turn the C
string stuff into the rest during stuff
I literally like copied and pasted this
from some documentation that I wrote so
you know it's relatively boilerplate and
I'm working on some libraries to write
the boilerplate for you so you don't
even need to think about that but we
basically like load up a regular
expression and then because this is a
demo I'm just like leaking memory
everywhere so I have like an allocate
but not a delete function so every time
you make a new regular expression it
just allocates more and more memory so
you know demo is it slides who but you
might implement more and then this match
function does literally the same lines
of code which I probably should have
extracted to a function but you know
we're all nobody's perfect and I just
call out to the rest regular expression
library is match last thing I want to
show you really briefly and I don't
expect you to understand this code
instantly I guess the point is I'm just
telling you it's like relatively easy or
it's like a small number of lines of
code to do this kind of thing
rust actually supports unit testing in
the language itself so I made this
little sub module with the test and then
checked out that if he I had a
particular regulation and some text it
would match against it so I was actually
like checking the validity so anyway
nobody understands piles of code on
slides so I'm not gonna explain more
than that you can check out the details
you know I'd be happy to explain it to
you when I'm not on a stage about
specifically how that all works so yes
this is just like delegating so we now
have basically this is now node calling
out to the FFI library calling out to
what it thinks is a sea library which is
actually a rust library which is calling
into the rust regular expression library
and then performing the match and then
like moving that the whole way back up
the chain so what's fun about this is I
was like yeah you know because like rust
has really fast regular expressions and
so my partner actually is used to
calling me on my crap as partners often
do
oh no the Internet's down so on okay so
I can't actually show you this on this
repository if you click on this pull
request button there's a pull request
with a benchmark that actually
demonstrates the rust ends up being
waste lower than just using a freaking
JavaScript regular expression in the
first place and so this is my message to
you about performance is you need to
actually if you're doing this kind of
stuff you need to actually be doing a
significant amount of work in the rust
side because basically all of that
translation from JavaScript to C to rust
takes up so much time that you lose all
the speed benefits of just matching like
a five character string against a three
character string in the first place
right like javascript is plenty fast at
doing that
so I don't want to tell you that you can
just like instantly rewrite all your
code in rust and automatically faster
like any sort of claims about speed you
have to actually benchmark things and
test them to make sure that they're
actually faster you can't just think
about it because compilers are magic and
they do also stuff you don't think about
so javascript is actually plenty fast in
most cases so if I was doing a
substantial amount of work here I think
I would fare much better but you know
yeah that's just what I want to tell you
is like the point is it's not always
inherently faster and also as I
mentioned before I'm actually running
out of time so I'll just say this really
briefly I'm actually working on some
libraries specifically for node and also
then for Ruby and Python that will
actually eliminate the need for the SFI
library in that chain of things so I can
actually take the v8 internal object
that node is using and just
access it directly in the rust and so I
expect that library to make this kind of
process even faster than it is right now
because the FFI library is very
convenient but it also has a lot of
overhead so look out for that in the
future but I guess I'm saying is making
languages play date with each other is
super fun I plan on doing it to help you
be able to do it in the future and
thank you very much for having me</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>