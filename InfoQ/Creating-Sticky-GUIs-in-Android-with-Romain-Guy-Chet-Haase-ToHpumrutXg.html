<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Creating Sticky GUI's in Android, with Romain Guy &amp; Chet Haase | Coder Coacher - Coaching Coders</title><meta content="Creating Sticky GUI's in Android, with Romain Guy &amp; Chet Haase - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Creating Sticky GUI's in Android, with Romain Guy &amp; Chet Haase</b></h2><h5 class="post__date">2011-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ToHpumrutXg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so hi I'm all Nagi and this is Chet I
weight than that next all right so the
question is what the hell does the title
mean I can tell you what the tail means
when we have to submit our talks to
conferences we have to do with months in
advance and we're busy so we have no
idea what we're going to talk about we
have no idea what we can talk about
because of that already schedules so we
come up with those very fuzzy abstract
titles and the abstracts are often
meaningless so that's one of them see
who is it means whatever you want the
previous talk was called Android
awesomeness because we spoke at a
conference in November and the person
said okay you'll give a keynote and I'll
call it ice cream sandwich from like yet
no because we have no idea when we're
going to release this thing and we're
certainly not going to call or talk
there so we called it android
awesomeness because then we could just
talk about anything what we met with
sticky gooey was not actually the GUI
part but the idea of getting your users
to stick their make them actually enjoy
using their application so we threw
together somewhat of a bag a grab bag of
techniques that you can think about in
the view system and layouts and
performance and animations and GUI Xin
general to create experiences that are
maybe more meaningful or nice for your
users so this is the agenda we're going
to talk about views really quickly then
a few techniques about graphics then
layout will probably goodness kid that
quits mostly about grid layout animation
chat is going is going to go on and on
and on about animations it's going to be
awesome and we're winding up and a half
an hour 845 midnight okay all right
you're going to stay here with us all
night and on performance with so we have
a section at the end where
talk about some performance tips but
actually performance enters into every
one of these topics you should always
keep performance in mind don't you know
Fred about it too much but part of
making a good experience for user is to
make sure that it's a smooth experience
if you've got a nice beautiful animation
that's wonderful unless it's actually a
choppy animation in which case you
should either improve the performance or
if you're doing something that simply
can't be made smooth enough then you
should eliminate it so performance is
always something you should think about
fixed review we talked about it so we've
done with views I excellent on to the
next section graphics do we talk about
graphics yet no ok so there's various
techniques in graphics to add richness
add capabilities adds a more rich and
vibrant experience for your user but all
the time you need to worry about
performance think about what performance
implications some of these graphics have
so one of the areas that you can add
richness is with gradients so i worked
at adobe for a while and it turns out
that the great answer is supposed to be
everywhere i don't know if you've
noticed adobe products feel like they're
just everywhere there's this beautiful
grey gradient in everything so obviously
you need gradients there's actually
various ways that you can use gradients
one is just you know a rich backdrop
that this sort of makes things pop out
but you can also use it for sort of
pseudo 3d effects you can use a
multi-stop grading on button to give the
button around it a more 3d feeling to it
you can use gradients and in shadows to
have more realistic drop shadows again
to make things pop out more 3d look to
them you can also use grading and
effects force a picture reflection so I
wrote a blog I think you did to do in
reflection effects using gradients with
an alpha gradient to sort of show the
reflection of the picture in a more
realistic way than simply copying and
reversing the image below it so if you
want to know how to use gradients
they're very easy maybe you don't use
them because you think they're
complicated in fact they're not so
here's a little bit of XML to show you
how I created a simple gradient that
goes from white to light grey so angle
270 means it's going to be a vertical
gradient it's going to start at the top
and go down starts from a color of white
goes to a color of light grey and it's
going to be a linear gradient versus a
circular radial gradient so you can use
that could but peek good colors don't
choose white and grey that's just guys
like my colors my animations rock but
apparently my colors suck so if you have
a drawable file defined as above then
you would include this in a particular
container as the background to it by
just referencing the resource so there
you're done that container has a
gradient if you wanted to do it
programmatically instead in Java code
then you could define an array with the
do colors that you want and then you
could create this new grading and
drawable such as we did on the slide
here we're talking about resolution I'm
okay so resolution is another area you
should keep in mind for graphics more
from an artifact standpoint be aware of
what resolutions you're writing your
application for what resolutions your
user might see your application in and
put your resources in the correct
directory and create them in an
appropriate resolution so let's see an
artifact here so we paid an artist a lot
of money to come up with a very
professional artwork here these are two
representations these actually both look
awful because they're both scaled up so
you can see it on the slide but on the
screen this was done this was a smaller
version that was very crisp it was done
pixel perfect for the amazing art that
the artist produced this other one was
scaled up to twice as big as it should
have been and the reason was because it
was put in the wrong directory he was
basically grabbed from the wrong
resource directory so if we see the code
here the the one on the top was it was a
file called smiley and it only existed
in this drawable directory which is
basically the same as putting it in
drawable MDB I I was running this on a
Galaxy Nexus so it was actually trying
to look for drawables in a native
resolution of xhdpi so the next image
view actually grabbed a drawable with
this file named smiley xhdpi and it
grabbed it from the correct directory
when it grabs it from the wrong
directory will auto scale it to the
resolution that's native to the device
which is why we get the scaling artifact
up at the top so pay attention to
resolution and do the right thing again
there's articles and resources in the
SDK and on
blog to do this 32-bit images are
basically the format that you should use
this is what you get by default when you
create windows for your application
those are 32-bit windows Engelberg
starting with Gingerbread very important
point prior to Gingerbread we would
actually create 16-bit windows and if
you loaded a bitmap with no format
specified 16 bits if it's opaque right
so you would get you we get a 5 65 or
16-bit image if you loaded a transparent
one hour image with translucency like a
ping file then you would get for Fort
Ord oh no you ok 32-bit 8888 starting
with Gingerbread to get 32-bit images in
both cases but for the windows that we
create as well as for the bitmaps that
we load you can specify images with
lower resolution with lower color depth
but please don't because you'll
basically get artifacts maybe you can't
tell but I bet your users can so can you
can you see in the back the difference
between the three you should look at the
curriculum ok especially on the on the
gray I can see it on the screen I'm not
sure if you can so the one of it up at
the top is RGB 44 44 so we've got four
bits for alpha red green and blue and
it's simply not enough depth to
represent the information in a nice
smooth gradient so we get this banding
effect and you get these really awful
stripes of color as you walk down the
gradient and actually the technical term
we use for RGB 4444 is crap so it's not
difficult but it it's a French word yes
this is cop yes it means crap RGB 565 so
this was the default image format prior
to Gingerbread you can still load images
in this format and you may think that
that's the right thing to do to save
memory but please do other things
instead maybe load less images have less
images cached around you can see a clear
banding effect on my screen I'm not sure
if you can see that as clearly here to
consume oh we can't zoom when the
screens in this mode but anyway don't do
it all of these image were stolen from
the blog that he wrote he has an
application so you can actually run the
application see the effect on your
device
and there's more images and more
description of what's actually going on
as well as when to use dithering and one
not two so you can check that out at the
URL in the bottom of the screen
translucency is a nice graphics effect
to be aware of one of the reasons that
you might use this is for fading things
in and out I find this to be a very
powerful way to use animations when
you're presenting new information or
you're getting rid of old instead of
just blinking it out or in and confusing
the user you can gradually fade these
things out very powerful so it's nice to
be able to know how to use it one of the
things to be aware of is that it's
expensive basically when you're telling
us to draw something with alpha which is
what we do to draw things translucent
Lee then we're basically creating a
temporary buffer we're drawing this
thing into it and then we're copying it
onto the screen the system is doing a
lot more work to draw it onto the screen
we're doing what's called overdraw
because we essentially draw all of these
pixels more than one were months we're
drawing the stuff behind it and then
we're drawing the stuff in the
translucent view itself and then copying
it under the screen and actually it's
very important this morning I fixed a
bug in android 4.0 at work where we had
a performance issue in animation was not
as smooth as it should be and the reason
was the application was using
translucency too much and in a wrong way
and we'll come back to that and in just
what two or three lines of code i just
sent two or three lines of code to to
limit the impact of translucency and the
application was a six times faster so
alpha can be very expensive be careful
when you use it make sure you profile
make sure you test your application same
thing with the notification panel that
we saw before I worked on a performance
issue there with scrolling notifications
up and down where we were getting
probably 15 frames a second felt very
choppy and awful and it turned out the
bug was that someone wanted dim grey
text so they had white text that they
set an alpha on and it turned out that
text occupied most of each of the
notification items and it ended up
causing overdraw on the whole screen and
causing us to do a lot more work than we
really needed to it turns out that just
drawing grey text was cheaper than
drawing white text
making us fade it for you and that's fed
it up to 60 frames a second so little
simple things to be aware of use
translucency when you need to be aware
of the cost the bug affects this morning
was very seminar the application was
trying to fade a white rectangle so it
put a white picture and an image you and
then was changing the Alpha of the image
you well instead you can just you know
change the color of the rectangle to
have an alpha itself so we don't have to
do that whole fancy crazy thing that
we're going to talk about some details
so if you want to use a fading effects
if you're doing this prior to 300 before
the new animation system which everybody
should be using now then you would do
something like create the Alpha
animation and say ok I want to fade from
a value of one to a value of zero i'm
going to set a duration of 300
milliseconds and then i'm going to start
the animation in the new animation
system it's a bit easier this is using
the new view property animator that came
online in three dot one you can simply
say ok for the object i want to fade i
want to animate the Alpha property go
2-0 start now and there's an article
that covers exactly this linked at the
bottom this slides will be posted online
so the hoary if you go up write down all
those links in fact i think a version of
these is already posted this on yeah
blood i posted slides from deb ox last
week on my blog so you can already find
a version of these 3d another nice
graphical effects don't use it too much
it turns out we still like 2d
interactions for the most part on their
screens we use it in very subtle ways
and transient ways in the UI one of the
reasons to not use it too much is
because you might confuse the user
another reason is because it does cost
performance so again like alpha be aware
of what it's costing so we have 3d here
for instance when we originally applied
this reveals 3d effect on the on the
widget it's very easy there's an API on
view you just save you that set rotation
X of that rotation why we have a similar
effects here when when I go from page to
page we have this 3d looking effect in
just the scale and fade but it looks
very much like
3d when you turn the pages of a book we
so that so what we just saw were just
transformations on views this is using
OpenGL it's actually using render script
so this is real what we call real 3d so
it's a lot more work to do but you know
it can look really nice very natural we
have the same effect I believe in then
you find YouTube YouTube where are you
youtube you are here is a pervy yeah the
English alphabet is hard i doesn't do it
on tablet it does it on tablet you have
a nice carousel in 3d so we use 3d
throughout the UI but it's in a very
simple and very often soul ways but the
interaction is always to be some simple
ways that you can access you can get 3d
effects in your application some of our
actually 2d they just happen to look 3d
for instance the gradient that i
mentioned before there's ways to use
these 2d gradients to actually make
things look three-dimensional and really
pop out visually from the screen you can
also simply scale things so when we go
from the launcher screen into the all
apps screen the apps on the home screen
the home screen itself goes into the
background and then the all apps fades
in well that's just doing a fade and a
scale it's not actually doing anything
in 3d at all there's other ways you can
do things that are more physically 3d
such as rotating so the little blue fade
that we saw as we reach the end of the
home screen on the left of the right
that's actually doing a rotation wire on
the y axis of the view container you can
also set the camera distance which
changes the perspective distortion
that's applied when things actually
rotate in 3d you can use full-on 3d
using render script or opengl either
from the sdk level or for opengl you can
use it at the ndk level as well so
that's what games do if you're if you're
using a 3d game on your system chances
are it's using one of these approaches
where it's going full-on and actually
writing you know matrix driven 3d
seeing grass rendering a little bit more
than we do in the UI which is really
simplistic effects for gooeys
consistency is kind of important make
things look consistent across your
application but maybe across the system
as well which is why we provided the
holo theme so the deco can provide some
level of consistency across different
devices and across your application the
system itself and there's a there was
new additions to something what's the
assets just at Studio assets to do yes
so to help with consistency now in the
Eclipse plug-in ADT we have a tool
called assets to do that will generate
for you icons for notifications for tabs
virus icons also for the launcher and it
will generate different icons based on
the API level so if you want to sue to a
notification icon that works on froyo
and on gingerbread in Hong Kong you can
just supply your vector art and go there
are different versions of the icon with
different styles that will match the
platform it will automatically create
the directories for you so you don't
have you know anything to do so you can
also use it outside of Eclipse if you
look for the Android assets to do
there's a website it's a web application
you just drop your your icons it will
generate everything for you it's the
best way to to match what we doing the
platform so speaking of consistency when
you do when you create your layouts try
to follow the guidelines we don't have
many guidelines out there yet we're
working hard on them but when you don't
know what to do just look at some of the
standard applications look at gmail look
at you know maybe the browser and try to
do what they do gmail is usually my
frame of reference and you probably i
hope you well actually i hope you did
not notice but in ICS all the apps look
very much the same so at the top we
always have an action bar so we use the
action bar for navigation you can use
that to switch between different
accounts so you can have tabs you can
have a drop box you have a home button
so here for instance the google talk i
click on the on the talk icon i go back
to the home screen of the application so
you don't have to click back
backpack a bunch of times you can put
all your your actions in the injection
bar if the overflow you have access to
the pop-up menu that we discussed before
use the action bar if you are not
running on honeycomb and up there's an
open source project called
actionbarsherlock that recreates the
action bar four versions of android
prior to three point oh so you can use
actionbarsherlock to make your
application look like those over if I
mean r &amp;amp; fri way the retro action bar
also use the viewpager so the viewpager
is a widget that's part of the support
library the support library works from
donut all the way to ICS and the
viewpager is that component that you can
use to swipe between different views in
you are different pages in your
application so if you want to have that
same ICS feel if you want to have you
know different views and you want easy
access for the user stop using the taboo
stand tab view and things like that
choose the viewpager it's a lot better
and it works on multiple versions of the
platform so good take a look at the
support library there's also a great
simple application this is the google
i/o scheduled application it shows you
how you can create an application that
works on multiple versions of the
platform and that's using the right UI
elements for tablets and phones so it's
a single APK that works on multiple
versions of the platform looks great on
tablets running honeycomb lubish grades
on ICS looks great on for your looks
great on the enterprise so go take a
look at it if you just look for google
i/o schedule on code that google com you
will find the application grid layout we
can yep it's the same slide skip
animation let's talk about animation so
oh so by this is a section this is
slightly fluffy and no code these are
principles that I thought about over the
last several years when I've worked on
several different animation frame works
yet chip has an awesome scam he goes
from company to company and recruits the
same api's
it's good now run out of companies at
some point because i don't know maybe a
sec mobiles in the initial framework so
one reason to add animation to your api
is to add richness but don't make it
superfluous right don't make your users
go nice animation could I just get on
and use the damn application so what you
want to do is have animations that are
helpful instead you want to make your
users more productive not more hateful
you want them to understand what's going
on in your application if there's an
important status that they should know
about maybe you could use a little bit
of subtle animation to inform that about
that about that information instead of
just popping it up there where they may
not see and maybe you know you can
animate it into place and it's going to
be a little more obvious you can also
use it in segwaying between different
states of a UI you is can be really
complicated if you're just blinking
information in and out it's a little bit
hard to understand what's going on and
animation can help the user understand
shared information between states or
information that goes away or comes into
being so animation can be very powerful
it's just important to use it for those
cases where it is actually important and
is doing something useful and it's also
important to do it in a natural and very
quick way so that it feels natural and
provides information but doesn't get in
the way of the user so one of the
principles certainly is to make it fast
get the damn thing over with as quick as
possible now this is not a specific
value I can't say you know make it 300
milliseconds 300 milliseconds happens to
be the default value that we picked for
animator in the new system but that's
not the right duration for every
animation it really depends on what's
going on for example if you're moving a
view sort of 10 pixels to the right and
you take a third of a second to do it
that's too long right you can probably
base the duration on the amount of
distance that that button has to cover
on the other hand if you're moving it
down to the lower right corner on a
tablet maybe 300 milliseconds is really
quick it's going to feel rushed if it
races over there if you've got a complex
choreography maybe you want to move some
items out of the way and then
something in then that overall duration
is going to be longer than a default
that you might use for simply shifting
of you over so the the right answer here
is make it as fast as you can while
still feeling natural and smooth yeah in
my experience every time I write
animations the duration I choose it's
very hard to guess what the duration is
going to be like you know my brain
doesn't know what nine hundred
milliseconds mean so every time I you
know I set my direction and the first
thing I do is lower that number try
lower the number try it lower the number
and keep lowering it until it's it's too
fast but you will pretty much always
choose a direction that's too long by
default so one of the other factors is a
question sorry yeah do we vary duration
by device we do have that possibility in
our build system so I believe that some
animation might be different by device
but most of them are now there's a
probably system values for the UI so not
defaults that we use so the animator
default is 300 milliseconds which means
if you write your application you want
it to look a certain way on a tablet and
look a different way on a phone device
then you would need to set the duration
and a lot of the animations that you see
in the system for instant when you score
released they are based on the on the
user interaction so they based on the
velocity of your finger on the screen so
the emission the duration varies because
we don't even know what the direction is
lecture so the speed is closely related
to the smoothness you want your
animation to look smooth because
otherwise it feels chopping and
unnatural so you want it to actually
look organic as it you know through
blends its way across the screen if you
make an animation too fast let's say oh
I really want to get this over as
quickly as possible and you make it race
down to the bottom side of the screen
it's going to feel unnatural because
it's racing right you guys don't race
but it's also probably going to feel
choppy because there's not enough frame
updates in the duration that you gave it
if you're going to race from the top
left of the tableau down to the bottom
right and you give it 100 milliseconds
well if you're getting 60 frames a
second you're going to get five to six
frames a second
most which five to six frames a second
total which means for every one of those
frames it's popped a significant amount
of space right instead you want to make
that a smooth motion now in that
particular case maybe that means it's
going to take too long for the animation
but then there's some other techniques
that kick in so for instance if you look
at the way we switch between tasks on
ICS or also on honeycomb we have sort of
a squish fade animation where we'll will
scale one activity out and scale another
one in and fade it at the same time now
if we did that good yeah why don't we
when we check this out
so it's hard to see yeah you can see
that that squishy effect that your scale
effect and the scale effect doesn't
start at zero it doesn't go from zero to
one hundred percent it starts I believe
at fifty percent maybe something like
that but the idea is if you take too
long to go in a smooth way from zero
percent to one hundred percent so we
start completely transparent at fifty
percent of the size and then we start
from there so the omission is still fast
but it's still smooth feeling natural is
important as well this relates to the
timing that you have in general we don't
move linearly in our world robots do but
they don't live in my world right we
accelerate into movement that we
decelerate out of it unless we hit a
wall you don't want your animations to
move linearly you don't want that object
to move from the left to the right of
the screen in a linear fashion because
it's going to look very robotic also if
there's any choppiness along the way
it's going to look much more obvious
because your eye is really good at
tracking linear behavior yeah actually
find that fascinating because the brain
is really good at doing that because
it's how you catch food or how you avoid
death well that was a long time ago I
think that now our brain is really good
at that just so that people can complain
on the internet about animations and
applications so the important thing to
you to do here is to use more natural or
organic timing by default we accelerate
in and out of animations in Android this
is true prior to 30 as well as in the
new animation system in 30 so that if
you don't do anything about
interpolation then you will get an
accelerating in and accelerating out
feeling to your animation which is
usually fine but there's a lot of other
situations where what you really want to
do is start fast and then ease out or
you want to start off slow and then
accelerate out maybe if something leaves
the screen so again it's just like the
duration there is no right answer here
except don't use linear right don't use
linear interpolator it exists there it's
actually fine if you're doing a fading
thing because then it's not as obvious
the the linear behavior but if you're
doing anything with
movement on the screen lineare is
basically not the way to go make your
animations simple so I had an example
before where we're moving things out of
the way and then fading things in so
let's say you have a list of items here
and you want to remove an object and you
want to fade the rest you want to move
the other objects in to fill the space
that it used to occupy now you could
actually fade that object out as at the
same time as you moved everything else
around it that would be what I would
call an awful animation because there's
basically completely disjoint actions
happening at the same time one of the
problems is the the graphics are
actually going to overlap you're going
to see this fading guy overlapping with
the other guys that are collapsing on
top of them at the same time so there's
automatic noise on the screen but also
it's just different actions there is a
removal happening and there's a movement
happening I would separate those actions
keep the animation simple so that you
fade this guy out that's one action you
move the other guys in you can overlap
them a little bit so that as this guy is
just at the tail end when he's almost
gone maybe the other guys are starting
to move but basically choreograph your
animations to keep the overall motion as
simple and as intuitive as possible for
the user don't make them too noisy
wizard that a cough did someone have a
cough okay purposeful this relates to
the first point when we got into the
section its have a reason to have the
animation don't just have an animation
because it's cool i like to play with
animation code but i don't think i would
expose it to the users unless it had a
reason for being there the most powerful
ones that i can think of our segues
between states of the application using
animations to convey information to the
user like this object is going away now
this other one is coming into being use
them to to help take the user naturally
between these different states of the
application and just a quick summary the
admissions are hard the API is are
pretty easy to use but you should spend
quite a bit of time tweaking animations
tweaking the directions making sure they
feel natural they feel good we spend
hours and hours you know India feels
like tweaking every animation it's
sometimes annoying but it definitely
works it actually there's another
example of what was it the
they're actually several their
principles I worked on a performance
issue again in the notification panel we
wanted to have it so that when you click
to the close button we would swipe out
all of these guys and then we would
close notification panel and there were
conflicting constraints there where we
want the animation to be as short as
possible but we also want the animation
to be smooth and it turns out that if
you're doing all these things at the
same time if you're doing all the things
separately then they can each be smooth
if you're doing them all at the same
time then it's going to be choppy so you
can either have a short animation that's
choppy or you can have a really long
animation that's smooth and I worked a
lot on basically doing the animations
separate but overlapping them just a
little bit so that we could speed things
up make the duration as small as
possible but so that we didn't have too
many things and too much noise happening
on the screen all at the same time so
yeah we do spend a lot of time on the
stuff so now just a bunch of tips about
performance how can you make sure
applications go faster because you need
this should go always faster the first
the first thing you should do whenever
you're right code and this is knowing
because after four years on Android
whenever I write code for you know like
I read small applications at home just
for my own propose on my desktop I start
writing my code and I'm doing all those
optimizations that I used to do on
Android and then I stop and realize wait
I'm on the desktop I don't need to do
that but that you need to do on mobile
phones so avoid allocations allocating
objects you have to run code to run the
Constructors of the objects it's pretty
expensive but what's really expensive
really is getting rid of the objects
every time we have to post your
application to launch the garbage
collector we're going to oppose your
application for a few milliseconds so
starting with Gingerbread we have a
concurrent garbage collector so I think
now the GC pause is all about two to
three milliseconds most of the time but
in previous versions of Android GC pass
could be a hundred milliseconds 200
milliseconds so if it happens in the
middle of an animation when in the
middle of a scroll it's extremely
annoying for the user because they feel
like the application is sluggish it's
not necessarily the code that you're
running at the moment it happens it just
you know the district decided well it's
time to clean memory so try to reuse
object as much as you can
and do it in the right places don't do
it you know when when user click on the
button in the button click listener it's
okay to allocate a bit of memory like
that doesn't happen very often but in
your drawing methods in your layout
methods in the touch event handling
methods be very careful about what to do
I've seen this error in a lot of
tutorials and ebooks they show you how
to create I know how to override the
draw method on view and usually the
first thing they do is create a new
paint object when the draw method is
called well the draw method is hopefully
going to be called 60 times per second
so you're going to create 60 paint
objects per second and they accumulate
and then the GC will trigger and then
you will have a pass and your
application will feel sluggish most of
our IP eyes are designed so that you can
reuse objects so here we have a very
simple example so I was talking about
the draw method do not create the paint
object in the draw method pre-allocate
the object our credit in your
constructor and then use it in the draw
method you can change the content of the
paint as you go so you can use a single
paint but just don't create one every
time here's another example of API that
that's meant to reuse object so this is
new in Android 3.0 when you load a
bitmap from a resource if you know ahead
of time the size of those bitmaps one
since you're creating a music player and
you know that every bitmap overnight low
is 256 x 256 you can pre-allocate a
bitmap and then when use the bitmap
factory there's an option called in
bitmap that means you want to decode the
resource inside that bitmaps you pre
educated so that way you can keep
decoding images in the same array of
memory so you can reuse the same chunk
of memory you don't allocate new objects
every time so 11 tip about lettering in
general is use allocation tracker used
it very heavily to track down a little
bits of garbage that we were allocating
during animations right and if the
framework is doing this this means it
has nothing to do with your application
code it meant every time through an
animation frame we're actually
allocating objects and eventually we
would juice
pause in the middle of the animation not
huge but enough that there was a
noticeable hiccup so I use allocation
tracker to figure where we were creating
these things and clean that stuff up
that's absolutely the tool you should
use to figure out where your garbage is
coming from and make sure that you can
get rid of it if you need to so you can
find the allocation tracker in the
Eclipse plugin or if you launch DDMS
there's a tab called allocation tracker
it's very easy to use you just click
start you play with the app you click
get education and you will see all the
allocations you made again most of IP is
that are meant to be used in performance
sensitive areas lets you reuse object if
there's an API that you have to use a
lot and doesn't let you reuse memory let
us know file by file feature requests
and hopefully we'll try to improve that
if used bitmaps we talked about the 32
bits bitmaps what's very important is
that you should use bitmaps in a format
that's compatible with the target so you
have a 32 bits window you should use
only 32 bits bitmaps because if use a
16-bit bitmaps and you draw it on a 32
bits window we have to do a conversion
we can't just copy the bits so we have
to do this conversion and we try to
optimize the code for those conversions
but if you run that code 60 times the
second is very expensive it's going to
slow down your application so you can
query the format of the target if you
called for instant get window in the
oncreate method of your activity you can
query the format of the windows so you
will know if the window is 16-bit or
32-bit and then based on that you can
decide how you load your bitmaps so that
they have the the proper format again if
you go look on on my blog I have a long
article explaining this in more details
try to use pre scaling this is a mistake
I still in a lot of applications when
you say to bitmap as the background of a
view for instance by default we're going
to stretch the bitmap so that it matches
the bounds of the view so if the bitmap
is smaller or bigger than the view as it
is on screen we're going to have to do
some a lot of expensive operations every
time we draw the bitmap so again if
you're animating 60 times per second we
have to do all this work again and again
and again so if you know that's going to
happen
just do pre scaling there's a method on
bittner on the bitmap class called
create scale bitmap that will just do
the scaling for you once so query the
size of your view and if this if the
view is as a different size and your
bitmap just do the pre scaling once get
rid of the origin or bitmap and use the
scale bitmap if you use a hardware
acceleration you're in luck because GPUs
are really good at doing that it's
pretty much free to do the scaling so if
you're using a hard R acceleration in
your targeting honeycomb and up don't
worry about it you can actually save
memory by by having smaller bitmaps as
long as it looks good on screen let the
system do this gallon we're drawing it's
another mistake I still a lot in
applications including our own
applications so to repaint part of the
screen there's a method on you called in
the validate invalidate means please
redraw the view we also have a version
of invalidate the text or rectangle that
is very important to use for instance
let's say you have a while you can take
the example it takes you there's a
blinking cursor in the middle of the
text view instead of repainting the
entire text every time the cursor blinks
we only tell the system to redraw the
part of the screen that contains the
cursor so you should do the same if you
have an application and you have custom
views make sure you tell us exactly what
part of the screen needs to be redrawn
so that we can save a lot of work when
we have to redraw the screen when I when
I was working on the launcher app the
first time we implemented drag-and-drop
we had performance issues like the icons
what the icon was not following the
finger when you were trying to move an
icon on the desktop and the reason was
on every touch event we were asking the
system to redraw the entire screen the
only change we made was pretty much to
use this code so this is how it works we
have an object at the next Y position we
know the width and the height of the
object we move the object so we increase
its position by some speed and then what
we do is we set a rectangle to be to
encompass the old position of the object
and then we use the Union operation to
make the union between the old position
of the object and the new position of
the object that gives us a bigger
that contains all the pixels that we
have to redraw and then we can
invalidate that region of the screen by
making that change why it was on the
only t-mobile g1 at the time but we went
from something like 20 FPS to 60 FPS
when dragging an icon it's very easy to
do in your code and you're going to see
that big differences and it does matter
even if you're our hardware accelerated
drawing requires to execute a lot of
code so the less code you'll run the
better it is check mention of a bra
before so other draw is when you paint
to the same pixels on screen several
times a very simple mistake to do is you
know I have an application I have a
white background because this is a
background my theme I put a view in my
application the view is to tell parents
your parents it covers the entire
background and I had the background to
that view so i won't see the white
background anymore but the system
doesn't know that so it's going to draw
the white background then it's going to
draw your your own background and we've
drawn the screen twice when we actually
need to draw it once so overdraw also
happens when you have translucent
objects if you stack a lot of
translucent objects we have to draw them
all it's very expensive we touch a lot
of pixels so try to avoid that in your
application and the only time when it's
necessary is unfortunately when use the
set alpha method on view when you want
to fade of you and I'm going to show you
what happens when you do so so let's say
that you're writing code for android 3.0
and up you just write that line of code
it looks very harmless it's very simple
your feigning of you it's actually very
expensive so here's what happens if you
don't have alpha let's say that we have
a view with the background and two
children we just draw everybody directly
on that on the screen that's really
straightforward nothing crazy going on
with the Alpha we first draw everybody
inside the buffer so the buffer you can
see the buffers a bitmap and then we
draw the bitmap on screen so we draw
everybody wants and then we drive area
basically a second time because of the
buffer and the reason why we do that is
this so in that patch of case when you
have a background and two children so
here the background is this black circle
and the children are the other the icons
were to apply the Alpha individually to
every element we would get this effect
here it kind of look like it looks like
x-rays this is not the result we want we
not we want the entire thing to be
translucent not each individual items if
we go through an intermediate buffer and
then we applied the alpha to the buffer
we get the result on the right and
that's why I set off I can be very
expensive so be very careful when you
set afire it's okay to use it just be
careful when you use it layers it's a
new idea introduced in the honeycomb if
you want more details about them you can
refer to our talk that you gave at
Google i/o lawyers are layers are
awesome domen to avoid over bra so the
idea is that if you know that is going
to need to do this i delta for instance
but things are not going to change you
can tell the system to draw everything
into a layer it's can be seen pretty
much as an off-screen bitmap and then
we're going to keep that bitmap around
and we're going to made that so if you
want to move at least for this is a
pretty complex subject you can tell us
well before you start the animation
render the entire list inside the layer
then please animate the layer so for us
it's very cheap because the layer is
just a bit map so we can move that very
easily unfortunately layers use a lot of
memory so use them only tempo are you
when you need them so to these layers
before Android three it's called drawing
cash it's a method on view so you just
say set drawing cash enabled true and
starting from now that view will render
into a bitmap instead of rendering on
the screen directly and if you want you
can force the rendering to happen in the
layer by calling calling build drawing
cash it's completely optional with
Android 3 and up we have a new API
called set layer type and we needed that
new API because of hardware rendering
bitmaps are fine when you're doing
software but we can be even more
efficient when we're using the GPU so
you can use this API called set layer
type and use a layer type hardware it
will create a bitmap that is on the GPU
so
would be even faster to render that view
if harder acceleration is disabled and
you use that API and us for a hardware
layer it's going to basically create a
bitmap so it's going to be safe it's
completely safe you can use it all the
time and again you can force the layer
to be built by calling a build layer and
this is how you should use it so this is
an example of animation code so here
we're creating an animation where we
want to rotate of you in 3d so before we
create the animation we set the view to
have a layer because we want to run out
of you once in the layer and then we
want to animate the layer itself much
more efficient and then we add a
listener and at the end of jan emotion
we discard the layer we want to reclaim
the memory we don't need the layer
anymore so this is a very simple pattern
whenever you write animations with the
new animation api try to follow this
pattern and we're going to try to make
it a loser in future versions yeah for
more information refer to that so google
talk so there's actually a couple
reasons to key players or the drawing
cash transient one as you mentioned was
you don't want to take out the extra
memory but also if you're actually going
to change that object and you have a
layer set on it you're actually making
us do more work it's going to cost more
because now we have to update the layer
as well as the screen right so layers
are really only intended to be used
transiently because of the memory issues
but also only during those periods where
the object is not being is not changing
so basically if you're moving an object
around on the screen that's great to add
a layer on it if you're moving it and
you're also changing the contents know
laters
yes in the other api's you just turn up
the drawing cash at the end of the
animation and we use layers ourselves
throughout the system in launcher every
time you swipe between pages of icons
every page becomes a layer before we
start the animation use the GPU if you
can or if you want so you can use opengl
you can use a render script and you can
use the hard work canvas so the hard
work canvas is just this new why knowing
pipelines that we have in honeycomb we
mentioned it before you have to obtain
it's a very simple attribute that you
can set on your application tag you have
more control over it you can set it /
window / activity you can disable it on
views research the blog for more
information if you Stargate SDK version
14 it's the same layout I wrote several
articles on the generated blog about
layouts and how you can optimize them
but basically the idea is exactly what
grid layout is about try to avoid deep
trees of layouts the deeper the tree the
more work we have to do in the framework
and it can makes a big difference so I
mentioned several solutions here we have
you can use related layout you can use
grid layout you can use the merge tag
and something called Camp Android balls
I won't go into details please go check
the blog at android com we have 0 ND sdk
actually if you go in the
resources tab we have links to those
articles that tell you what you should
be doing so sometimes it's also
appropriate to use a custom view instead
if you're drawing all sorts of little
intricate things inside a container well
maybe having a deeply nested hierarchy
or even a complex single level hierarchy
is not the solution maybe instead you
could actually use a custom view to draw
these individual elements yeah actually
sometimes when you win dessert when you
have a particular layout in mind and you
don't and you can't really make it work
with your existing layouts don't be
afraid of creating a custom view our
custom it out because you know exactly
what you want so it's pretty easy to do
what's hard to do is create a layout
that works no in the general case so if
you want to write a layout to be
integrating the platform that's hard if
you're right it because you know that
you just want a star on their left and a
stand or right and some text in the
middle that's very easy to do my
favorite example is gmail in gmail you
can see you have the Stars and yet the
tick marks and you have the the name of
the sender and you have a snippet of the
email that's a custom you would start a
layout it's one thing of you that they
created in gmail because they know
exactly what they need to display in so
a lot faster through 22 process there
was a talk that romantic devix last year
well now freely available in parlays com
where he wrote a layout on the flyer was
about a half an hour coding exercise to
right was it flowlayout fruity out you
so you can see how easy it is to write a
custom layout on the fly on stage and
speaking of layouts do profiling if you
don't know trace you or hierarchy viewer
I hate that name it's hard for me to
comments and I picked that name so I'm
stupid if you download those tools how
many of you have used Harkov you were
before ok so the you should work with
you guys you have to eat hearty you are
it's meant to help you debug you eyes
and the new version of Harkov you will
also give you profit gives you profiling
information it tells you how long it
takes to measure layout and draw your UI
so as you make changes in your xml files
it's very hard by just reading an xml
file to guess how fast or slow its going
to be so user RQ where it will tell you
if you on the right path and we have
value stocks that explains more
but tools that you can use to profile
performance processing if you do a lot
of data processing image processing
audio processing cryptography you
probably don't want to use the Java
programming language because it runs in
the vm the vm is pretty good but you can
go faster you can use Jane I with the
JDK but let's face it jenna is kind of a
pain in the ass to use and also it has
prime with compatibility if you want to
run on Google TV for instance that that
uses x86 CPUs and you compile your your
native code for arm CPUs for phones it's
not gonna work so instead you should
take a look at renderscript render
script is meant to do heavy processing
really quickly it does the the power
processing for you using multiple cores
it's portable and we gave a talk yeah
the doc is available online somewhere
right another small graphics also render
script is two things render script is to
do rendering hence the render script and
as for doing script no no I needs to do
complete what we call compute so compute
is just heavy processing and the idea is
that not now but soon hopefully we
although it will be able to run that
code on the cpu and it makes sense on
the GPU if it makes sense for your
script and we have we have examples in
the SDK we have an image processing
example it's simple processing does you
know it applies levels and curves and
bearers on an image so you can go take a
look it's pretty easy to do the compute
part is very simple and so what is your
than Jane I the most important part
about performance try to be consistent
if you cannot do 60 FPS don't try do 30
FPS instead it's better to do 30 FPS all
the time then do 60 FPS most of the time
this is actually a technique that most
games do use on consoles like there are
very very few games that run at 60fps on
PlayStation and Xbox instead the targets
30 FPS because they know they can
guarantee that that that frame rate so
if you feel like you know you're doing
maybe because of the UI you God may be
here because of you know what your
client wants you can't do 360 FPS just
just do targets 30 FPS it's much better
and again use profiling tools and
everything let's keep that yeah so
performance it's a big topic we could
talk about it for days but you guys
would be tired to see our stock you
should look at performance throughout
direction of your project every time
performs the performance go down your
application into a regression it's a
real bug you shouldn't wait until the
end of the project to take care of it
because sometimes trying to fix
performance at the end it can be very
difficult we all know the famous quote
premature optimization is the root of
all evil that's not what we're talking
about don't try to be smart ahead of
time just apply all those real concepts
they're not you know big optimizations
are just good practices that that work
in every application because if you have
to do that at the end of your of your
cycle you're going to be screwed didn't
the other than that and when you have
questions use the tools right so these
are the tools that you should be using
there are also the tools that we use
internally trace view hierarchy viewer
hat or J hat allocation tracker all the
stuff is stuff that we use every single
day for tracking down problems in the
framework but you should be using the
same tools for your applications and we
have a new tool in the Eclipse plugin
called lint awesome yeah lint does lint
is a is a much better version of layout
up in the static analysis of your
layouts and I believe some of your of
your code and tells you what you could
fix in your application to improve
performance so it will tell you all here
you're using a linear layout with an
image when it takes you when instead of
doing that you can just use one text you
when you will tell you how it will even
let it will even offer a solution so you
just say you know please fix it for me
it shows you the before and after and
you can say ok and fixes your
application it does a lot more than that
it will tell you if you forgot to
translate a string in a specific
language I know it has lots and lots of
features I think you can go to
tools that android com there's a quick
overview of lint and what it can do it's
a really really good tool and it works
from the comment line so you can
integrate it on your own with your build
system with your continuous integration
system so you can run it offline you can
generate HTML reports and you can
automatically mail them to developers
before you do a release for more
information we mentioned the android
blog several times go there to check out
articles on all of this stuff we each
have to have technical blogs where we
post up we're also both on Google+ where
we tend to post up as well if you want
to follow information like we talked
about tonight and I think that's it yes
so if you want to stay around and ask a
few questions we can answer questions
for five minutes because I think
everybody's tired and if you have
questions and thank you very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>